<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7259334">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7259389">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7259443">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7259494">package</span>&nbsp;<span class="ident" id="7259502">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7259507">import</span>&nbsp;<span class="op" id="7259514">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7259517">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7259526">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7259542">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7259561">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7259575">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7259591">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7259607">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7259617">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7259624">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7259630">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7259642">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7259649">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7259655">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7259666">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7259683">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7259694">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7259705">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="7259712">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7259715">//&nbsp;zeroSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;returns&nbsp;an&nbsp;unlimited&nbsp;number&nbsp;of&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="7259793">type</span>&nbsp;<span class="ident" id="7259798">zeroSource</span>&nbsp;<span class="keyword" id="7259809">struct</span><span class="op" id="7259815">{</span><span class="op" id="7259816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7259819">func</span>&nbsp;<span class="op" id="7259824">(</span><span class="ident" id="7259825">zeroSource</span><span class="op" id="7259835">)</span>&nbsp;<span class="ident" id="7259837">Read</span><span class="op" id="7259841">(</span><span class="ident" id="7259842">b</span>&nbsp;<span class="op" id="7259844">[</span><span class="op" id="7259845">]</span><span class="builtintype" id="7259846">byte</span><span class="op" id="7259850">)</span>&nbsp;<span class="op" id="7259852">(</span><span class="ident" id="7259853">n</span>&nbsp;<span class="builtintype" id="7259855">int</span><span class="op" id="7259858">,</span>&nbsp;<span class="ident" id="7259860">err</span>&nbsp;<span class="builtintype" id="7259864">error</span><span class="op" id="7259869">)</span>&nbsp;<span class="op" id="7259871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7259874">for</span>&nbsp;<span class="ident" id="7259878">i</span>&nbsp;<span class="op" id="7259880">:=</span>&nbsp;<span class="keyword" id="7259883">range</span>&nbsp;<span class="ident" id="7259889">b</span>&nbsp;<span class="op" id="7259891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7259895">b</span><span class="op" id="7259896">[</span><span class="ident" id="7259897">i</span><span class="op" id="7259898">]</span>&nbsp;<span class="op" id="7259900">=</span>&nbsp;<span class="num" id="7259902">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7259905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7259909">return</span>&nbsp;<span class="builtinfunc" id="7259916">len</span><span class="op" id="7259919">(</span><span class="ident" id="7259920">b</span><span class="op" id="7259921">)</span><span class="op" id="7259922">,</span>&nbsp;<span class="ident" id="7259924">nil</span><br>
<span class="lineno"></span><span class="op" id="7259928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7259931">var</span>&nbsp;<span class="ident" id="7259935">testConfig</span>&nbsp;<span class="op" id="7259946">*</span><span class="ident" id="7259947">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="7259955">func</span>&nbsp;<span class="ident" id="7259960">init</span><span class="op" id="7259964">(</span><span class="op" id="7259965">)</span>&nbsp;<span class="op" id="7259967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7259970">testConfig</span>&nbsp;<span class="op" id="7259981">=</span>&nbsp;<span class="op" id="7259983">&amp;</span><span class="ident" id="7259984">Config</span><span class="op" id="7259990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7259994">Time</span><span class="op" id="7259998">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7260014">func</span><span class="op" id="7260018">(</span><span class="op" id="7260019">)</span>&nbsp;<span class="ident" id="7260021">time</span><span class="op" id="7260025">.</span><span class="ident" id="7260026">Time</span>&nbsp;<span class="op" id="7260031">{</span>&nbsp;<span class="keyword" id="7260033">return</span>&nbsp;<span class="ident" id="7260040">time</span><span class="op" id="7260044">.</span><span class="ident" id="7260045">Unix</span><span class="op" id="7260049">(</span><span class="num" id="7260050">0</span><span class="op" id="7260051">,</span>&nbsp;<span class="num" id="7260053">0</span><span class="op" id="7260054">)</span>&nbsp;<span class="op" id="7260056">}</span><span class="op" id="7260057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260061">Rand</span><span class="op" id="7260065">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7260081">zeroSource</span><span class="op" id="7260091">{</span><span class="op" id="7260092">}</span><span class="op" id="7260093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260097">Certificates</span><span class="op" id="7260109">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7260117">make</span><span class="op" id="7260121">(</span><span class="op" id="7260122">[</span><span class="op" id="7260123">]</span><span class="ident" id="7260124">Certificate</span><span class="op" id="7260135">,</span>&nbsp;<span class="num" id="7260137">2</span><span class="op" id="7260138">)</span><span class="op" id="7260139">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260143">InsecureSkipVerify</span><span class="op" id="7260161">:</span>&nbsp;<span class="builtintype" id="7260163">true</span><span class="op" id="7260167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260171">MinVersion</span><span class="op" id="7260181">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7260191">VersionSSL30</span><span class="op" id="7260203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260207">MaxVersion</span><span class="op" id="7260217">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7260227">VersionTLS12</span><span class="op" id="7260239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7260242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260245">testConfig</span><span class="op" id="7260255">.</span><span class="ident" id="7260256">Certificates</span><span class="op" id="7260268">[</span><span class="num" id="7260269">0</span><span class="op" id="7260270">]</span><span class="op" id="7260271">.</span><span class="ident" id="7260272">Certificate</span>&nbsp;<span class="op" id="7260284">=</span>&nbsp;<span class="op" id="7260286">[</span><span class="op" id="7260287">]</span><span class="op" id="7260288">[</span><span class="op" id="7260289">]</span><span class="builtintype" id="7260290">byte</span><span class="op" id="7260294">{</span><span class="ident" id="7260295">testRSACertificate</span><span class="op" id="7260313">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260316">testConfig</span><span class="op" id="7260326">.</span><span class="ident" id="7260327">Certificates</span><span class="op" id="7260339">[</span><span class="num" id="7260340">0</span><span class="op" id="7260341">]</span><span class="op" id="7260342">.</span><span class="ident" id="7260343">PrivateKey</span>&nbsp;<span class="op" id="7260354">=</span>&nbsp;<span class="ident" id="7260356">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260375">testConfig</span><span class="op" id="7260385">.</span><span class="ident" id="7260386">Certificates</span><span class="op" id="7260398">[</span><span class="num" id="7260399">1</span><span class="op" id="7260400">]</span><span class="op" id="7260401">.</span><span class="ident" id="7260402">Certificate</span>&nbsp;<span class="op" id="7260414">=</span>&nbsp;<span class="op" id="7260416">[</span><span class="op" id="7260417">]</span><span class="op" id="7260418">[</span><span class="op" id="7260419">]</span><span class="builtintype" id="7260420">byte</span><span class="op" id="7260424">{</span><span class="ident" id="7260425">testSNICertificate</span><span class="op" id="7260443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260446">testConfig</span><span class="op" id="7260456">.</span><span class="ident" id="7260457">Certificates</span><span class="op" id="7260469">[</span><span class="num" id="7260470">1</span><span class="op" id="7260471">]</span><span class="op" id="7260472">.</span><span class="ident" id="7260473">PrivateKey</span>&nbsp;<span class="op" id="7260484">=</span>&nbsp;<span class="ident" id="7260486">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260505">testConfig</span><span class="op" id="7260515">.</span><span class="ident" id="7260516">BuildNameToCertificate</span><span class="op" id="7260538">(</span><span class="op" id="7260539">)</span><br>
<span class="lineno"></span><span class="op" id="7260541">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="7260544">func</span>&nbsp;<span class="ident" id="7260549">testClientHelloFailure</span><span class="op" id="7260571">(</span><span class="ident" id="7260572">t</span>&nbsp;<span class="op" id="7260574">*</span><span class="ident" id="7260575">testing</span><span class="op" id="7260582">.</span><span class="ident" id="7260583">T</span><span class="op" id="7260584">,</span>&nbsp;<span class="ident" id="7260586">m</span>&nbsp;<span class="ident" id="7260588">handshakeMessage</span><span class="op" id="7260604">,</span>&nbsp;<span class="ident" id="7260606">expectedSubStr</span>&nbsp;<span class="builtintype" id="7260621">string</span><span class="op" id="7260627">)</span>&nbsp;<span class="op" id="7260629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7260632">//&nbsp;Create&nbsp;in-memory&nbsp;network&nbsp;connection,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7260673">//&nbsp;send&nbsp;message&nbsp;to&nbsp;server.&nbsp;&nbsp;Should&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7260716">//&nbsp;expected&nbsp;error.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260736">c</span><span class="op" id="7260737">,</span>&nbsp;<span class="ident" id="7260739">s</span>&nbsp;<span class="op" id="7260741">:=</span>&nbsp;<span class="ident" id="7260744">net</span><span class="op" id="7260747">.</span><span class="ident" id="7260748">Pipe</span><span class="op" id="7260752">(</span><span class="op" id="7260753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7260756">go</span>&nbsp;<span class="keyword" id="7260759">func</span><span class="op" id="7260763">(</span><span class="op" id="7260764">)</span>&nbsp;<span class="op" id="7260766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260770">cli</span>&nbsp;<span class="op" id="7260774">:=</span>&nbsp;<span class="ident" id="7260777">Client</span><span class="op" id="7260783">(</span><span class="ident" id="7260784">c</span><span class="op" id="7260785">,</span>&nbsp;<span class="ident" id="7260787">testConfig</span><span class="op" id="7260797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7260801">if</span>&nbsp;<span class="ident" id="7260804">ch</span><span class="op" id="7260806">,</span>&nbsp;<span class="ident" id="7260808">ok</span>&nbsp;<span class="op" id="7260811">:=</span>&nbsp;<span class="ident" id="7260814">m</span><span class="op" id="7260815">.</span><span class="op" id="7260816">(</span><span class="op" id="7260817">*</span><span class="ident" id="7260818">clientHelloMsg</span><span class="op" id="7260832">)</span><span class="op" id="7260833">;</span>&nbsp;<span class="ident" id="7260835">ok</span>&nbsp;<span class="op" id="7260838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260843">cli</span><span class="op" id="7260846">.</span><span class="ident" id="7260847">vers</span>&nbsp;<span class="op" id="7260852">=</span>&nbsp;<span class="ident" id="7260854">ch</span><span class="op" id="7260856">.</span><span class="ident" id="7260857">vers</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7260864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260868">cli</span><span class="op" id="7260871">.</span><span class="ident" id="7260872">writeRecord</span><span class="op" id="7260883">(</span><span class="ident" id="7260884">recordTypeHandshake</span><span class="op" id="7260903">,</span>&nbsp;<span class="ident" id="7260905">m</span><span class="op" id="7260906">.</span><span class="ident" id="7260907">marshal</span><span class="op" id="7260914">(</span><span class="op" id="7260915">)</span><span class="op" id="7260916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260920">c</span><span class="op" id="7260921">.</span><span class="ident" id="7260922">Close</span><span class="op" id="7260927">(</span><span class="op" id="7260928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7260931">}</span><span class="op" id="7260932">(</span><span class="op" id="7260933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260936">err</span>&nbsp;<span class="op" id="7260940">:=</span>&nbsp;<span class="ident" id="7260943">Server</span><span class="op" id="7260949">(</span><span class="ident" id="7260950">s</span><span class="op" id="7260951">,</span>&nbsp;<span class="ident" id="7260953">testConfig</span><span class="op" id="7260963">)</span><span class="op" id="7260964">.</span><span class="ident" id="7260965">Handshake</span><span class="op" id="7260974">(</span><span class="op" id="7260975">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7260978">s</span><span class="op" id="7260979">.</span><span class="ident" id="7260980">Close</span><span class="op" id="7260985">(</span><span class="op" id="7260986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7260989">if</span>&nbsp;<span class="ident" id="7260992">err</span>&nbsp;<span class="op" id="7260996">==</span>&nbsp;<span class="ident" id="7260999">nil</span>&nbsp;<span class="op" id="7261003">||</span>&nbsp;<span class="op" id="7261006">!</span><span class="ident" id="7261007">strings</span><span class="op" id="7261014">.</span><span class="ident" id="7261015">Contains</span><span class="op" id="7261023">(</span><span class="ident" id="7261024">err</span><span class="op" id="7261027">.</span><span class="ident" id="7261028">Error</span><span class="op" id="7261033">(</span><span class="op" id="7261034">)</span><span class="op" id="7261035">,</span>&nbsp;<span class="ident" id="7261037">expectedSubStr</span><span class="op" id="7261051">)</span>&nbsp;<span class="op" id="7261053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261057">t</span><span class="op" id="7261058">.</span><span class="ident" id="7261059">Errorf</span><span class="op" id="7261065">(</span><span class="string" id="7261066">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected&nbsp;to&nbsp;match&nbsp;substring&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="7261115">,</span>&nbsp;<span class="ident" id="7261117">err</span><span class="op" id="7261120">,</span>&nbsp;<span class="ident" id="7261122">expectedSubStr</span><span class="op" id="7261136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7261139">}</span><br>
<span class="lineno"></span><span class="op" id="7261141">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7261144">func</span>&nbsp;<span class="ident" id="7261149">TestSimpleError</span><span class="op" id="7261164">(</span><span class="ident" id="7261165">t</span>&nbsp;<span class="op" id="7261167">*</span><span class="ident" id="7261168">testing</span><span class="op" id="7261175">.</span><span class="ident" id="7261176">T</span><span class="op" id="7261177">)</span>&nbsp;<span class="op" id="7261179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261182">testClientHelloFailure</span><span class="op" id="7261204">(</span><span class="ident" id="7261205">t</span><span class="op" id="7261206">,</span>&nbsp;<span class="op" id="7261208">&amp;</span><span class="ident" id="7261209">serverHelloDoneMsg</span><span class="op" id="7261227">{</span><span class="op" id="7261228">}</span><span class="op" id="7261229">,</span>&nbsp;<span class="string" id="7261231">&#34;unexpected&nbsp;handshake&nbsp;message&#34;</span><span class="op" id="7261261">)</span><br>
<span class="lineno"></span><span class="op" id="7261263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7261266">var</span>&nbsp;<span class="ident" id="7261270">badProtocolVersions</span>&nbsp;<span class="op" id="7261290">=</span>&nbsp;<span class="op" id="7261292">[</span><span class="op" id="7261293">]</span><span class="builtintype" id="7261294">uint16</span><span class="op" id="7261300">{</span><span class="num" id="7261301">0x0000</span><span class="op" id="7261307">,</span>&nbsp;<span class="num" id="7261309">0x0005</span><span class="op" id="7261315">,</span>&nbsp;<span class="num" id="7261317">0x0100</span><span class="op" id="7261323">,</span>&nbsp;<span class="num" id="7261325">0x0105</span><span class="op" id="7261331">,</span>&nbsp;<span class="num" id="7261333">0x0200</span><span class="op" id="7261339">,</span>&nbsp;<span class="num" id="7261341">0x0205</span><span class="op" id="7261347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7261350">func</span>&nbsp;<span class="ident" id="7261355">TestRejectBadProtocolVersion</span><span class="op" id="7261383">(</span><span class="ident" id="7261384">t</span>&nbsp;<span class="op" id="7261386">*</span><span class="ident" id="7261387">testing</span><span class="op" id="7261394">.</span><span class="ident" id="7261395">T</span><span class="op" id="7261396">)</span>&nbsp;<span class="op" id="7261398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7261401">for</span>&nbsp;<span class="ident" id="7261405">_</span><span class="op" id="7261406">,</span>&nbsp;<span class="ident" id="7261408">v</span>&nbsp;<span class="op" id="7261410">:=</span>&nbsp;<span class="keyword" id="7261413">range</span>&nbsp;<span class="ident" id="7261419">badProtocolVersions</span>&nbsp;<span class="op" id="7261439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261443">testClientHelloFailure</span><span class="op" id="7261465">(</span><span class="ident" id="7261466">t</span><span class="op" id="7261467">,</span>&nbsp;<span class="op" id="7261469">&amp;</span><span class="ident" id="7261470">clientHelloMsg</span><span class="op" id="7261484">{</span><span class="ident" id="7261485">vers</span><span class="op" id="7261489">:</span>&nbsp;<span class="ident" id="7261491">v</span><span class="op" id="7261492">}</span><span class="op" id="7261493">,</span>&nbsp;<span class="string" id="7261495">&#34;unsupported,&nbsp;maximum&nbsp;protocol&nbsp;version&#34;</span><span class="op" id="7261534">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7261537">}</span><br>
<span class="lineno"></span><span class="op" id="7261539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7261542">func</span>&nbsp;<span class="ident" id="7261547">TestNoSuiteOverlap</span><span class="op" id="7261565">(</span><span class="ident" id="7261566">t</span>&nbsp;<span class="op" id="7261568">*</span><span class="ident" id="7261569">testing</span><span class="op" id="7261576">.</span><span class="ident" id="7261577">T</span><span class="op" id="7261578">)</span>&nbsp;<span class="op" id="7261580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261583">clientHello</span>&nbsp;<span class="op" id="7261595">:=</span>&nbsp;<span class="op" id="7261598">&amp;</span><span class="ident" id="7261599">clientHelloMsg</span><span class="op" id="7261613">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261617">vers</span><span class="op" id="7261621">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7261637">0x0301</span><span class="op" id="7261643">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261647">cipherSuites</span><span class="op" id="7261659">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7261667">[</span><span class="op" id="7261668">]</span><span class="builtintype" id="7261669">uint16</span><span class="op" id="7261675">{</span><span class="num" id="7261676">0xff00</span><span class="op" id="7261682">}</span><span class="op" id="7261683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261687">compressionMethods</span><span class="op" id="7261705">:</span>&nbsp;<span class="op" id="7261707">[</span><span class="op" id="7261708">]</span><span class="builtintype" id="7261709">uint8</span><span class="op" id="7261714">{</span><span class="num" id="7261715">0</span><span class="op" id="7261716">}</span><span class="op" id="7261717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7261720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261723">testClientHelloFailure</span><span class="op" id="7261745">(</span><span class="ident" id="7261746">t</span><span class="op" id="7261747">,</span>&nbsp;<span class="ident" id="7261749">clientHello</span><span class="op" id="7261760">,</span>&nbsp;<span class="string" id="7261762">&#34;no&nbsp;cipher&nbsp;suite&nbsp;supported&nbsp;by&nbsp;both&nbsp;client&nbsp;and&nbsp;server&#34;</span><span class="op" id="7261815">)</span><br>
<span class="lineno">95</span><span class="op" id="7261817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7261820">func</span>&nbsp;<span class="ident" id="7261825">TestNoCompressionOverlap</span><span class="op" id="7261849">(</span><span class="ident" id="7261850">t</span>&nbsp;<span class="op" id="7261852">*</span><span class="ident" id="7261853">testing</span><span class="op" id="7261860">.</span><span class="ident" id="7261861">T</span><span class="op" id="7261862">)</span>&nbsp;<span class="op" id="7261864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261867">clientHello</span>&nbsp;<span class="op" id="7261879">:=</span>&nbsp;<span class="op" id="7261882">&amp;</span><span class="ident" id="7261883">clientHelloMsg</span><span class="op" id="7261897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261901">vers</span><span class="op" id="7261905">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7261921">0x0301</span><span class="op" id="7261927">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261931">cipherSuites</span><span class="op" id="7261943">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7261951">[</span><span class="op" id="7261952">]</span><span class="builtintype" id="7261953">uint16</span><span class="op" id="7261959">{</span><span class="ident" id="7261960">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7261984">}</span><span class="op" id="7261985">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7261989">compressionMethods</span><span class="op" id="7262007">:</span>&nbsp;<span class="op" id="7262009">[</span><span class="op" id="7262010">]</span><span class="builtintype" id="7262011">uint8</span><span class="op" id="7262016">{</span><span class="num" id="7262017">0xff</span><span class="op" id="7262021">}</span><span class="op" id="7262022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7262025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262028">testClientHelloFailure</span><span class="op" id="7262050">(</span><span class="ident" id="7262051">t</span><span class="op" id="7262052">,</span>&nbsp;<span class="ident" id="7262054">clientHello</span><span class="op" id="7262065">,</span>&nbsp;<span class="string" id="7262067">&#34;client&nbsp;does&nbsp;not&nbsp;support&nbsp;uncompressed&nbsp;connections&#34;</span><span class="op" id="7262117">)</span><br>
<span class="lineno"></span><span class="op" id="7262119">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7262122">func</span>&nbsp;<span class="ident" id="7262127">TestTLS12OnlyCipherSuites</span><span class="op" id="7262152">(</span><span class="ident" id="7262153">t</span>&nbsp;<span class="op" id="7262155">*</span><span class="ident" id="7262156">testing</span><span class="op" id="7262163">.</span><span class="ident" id="7262164">T</span><span class="op" id="7262165">)</span>&nbsp;<span class="op" id="7262167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7262170">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;Server&nbsp;doesn&#39;t&nbsp;select&nbsp;a&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suite&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7262241">//&nbsp;the&nbsp;client&nbsp;negotiates&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7262276">var</span>&nbsp;<span class="ident" id="7262280">zeros</span>&nbsp;<span class="op" id="7262286">[</span><span class="num" id="7262287">32</span><span class="op" id="7262289">]</span><span class="builtintype" id="7262290">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262297">clientHello</span>&nbsp;<span class="op" id="7262309">:=</span>&nbsp;<span class="op" id="7262312">&amp;</span><span class="ident" id="7262313">clientHelloMsg</span><span class="op" id="7262327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262331">vers</span><span class="op" id="7262335">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7262339">VersionTLS11</span><span class="op" id="7262351">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262355">random</span><span class="op" id="7262361">:</span>&nbsp;<span class="ident" id="7262363">zeros</span><span class="op" id="7262368">[</span><span class="op" id="7262369">:</span><span class="op" id="7262370">]</span><span class="op" id="7262371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262375">cipherSuites</span><span class="op" id="7262387">:</span>&nbsp;<span class="op" id="7262389">[</span><span class="op" id="7262390">]</span><span class="builtintype" id="7262391">uint16</span><span class="op" id="7262397">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7262402">//&nbsp;The&nbsp;Server,&nbsp;by&nbsp;default,&nbsp;will&nbsp;use&nbsp;the&nbsp;client&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7262454">//&nbsp;preference&nbsp;order.&nbsp;So&nbsp;the&nbsp;GCM&nbsp;cipher&nbsp;suite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7262502">//&nbsp;will&nbsp;be&nbsp;selected&nbsp;unless&nbsp;it&#39;s&nbsp;excluded&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7262554">//&nbsp;of&nbsp;the&nbsp;version&nbsp;in&nbsp;this&nbsp;ClientHello.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262596">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><span class="op" id="7262633">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262638">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7262662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7262666">}</span><span class="op" id="7262667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262671">compressionMethods</span><span class="op" id="7262689">:</span>&nbsp;<span class="op" id="7262691">[</span><span class="op" id="7262692">]</span><span class="builtintype" id="7262693">uint8</span><span class="op" id="7262698">{</span><span class="ident" id="7262699">compressionNone</span><span class="op" id="7262714">}</span><span class="op" id="7262715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262719">supportedCurves</span><span class="op" id="7262734">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7262739">[</span><span class="op" id="7262740">]</span><span class="ident" id="7262741">CurveID</span><span class="op" id="7262748">{</span><span class="ident" id="7262749">CurveP256</span><span class="op" id="7262758">,</span>&nbsp;<span class="ident" id="7262760">CurveP384</span><span class="op" id="7262769">,</span>&nbsp;<span class="ident" id="7262771">CurveP521</span><span class="op" id="7262780">}</span><span class="op" id="7262781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262785">supportedPoints</span><span class="op" id="7262800">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7262805">[</span><span class="op" id="7262806">]</span><span class="builtintype" id="7262807">uint8</span><span class="op" id="7262812">{</span><span class="ident" id="7262813">pointFormatUncompressed</span><span class="op" id="7262836">}</span><span class="op" id="7262837">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7262840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262844">c</span><span class="op" id="7262845">,</span>&nbsp;<span class="ident" id="7262847">s</span>&nbsp;<span class="op" id="7262849">:=</span>&nbsp;<span class="ident" id="7262852">net</span><span class="op" id="7262855">.</span><span class="ident" id="7262856">Pipe</span><span class="op" id="7262860">(</span><span class="op" id="7262861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7262864">var</span>&nbsp;<span class="ident" id="7262868">reply</span>&nbsp;<span class="keyword" id="7262874">interface</span><span class="op" id="7262883">{</span><span class="op" id="7262884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7262887">var</span>&nbsp;<span class="ident" id="7262891">clientErr</span>&nbsp;<span class="builtintype" id="7262901">error</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7262908">go</span>&nbsp;<span class="keyword" id="7262911">func</span><span class="op" id="7262915">(</span><span class="op" id="7262916">)</span>&nbsp;<span class="op" id="7262918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262922">cli</span>&nbsp;<span class="op" id="7262926">:=</span>&nbsp;<span class="ident" id="7262929">Client</span><span class="op" id="7262935">(</span><span class="ident" id="7262936">c</span><span class="op" id="7262937">,</span>&nbsp;<span class="ident" id="7262939">testConfig</span><span class="op" id="7262949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262953">cli</span><span class="op" id="7262956">.</span><span class="ident" id="7262957">vers</span>&nbsp;<span class="op" id="7262962">=</span>&nbsp;<span class="ident" id="7262964">clientHello</span><span class="op" id="7262975">.</span><span class="ident" id="7262976">vers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7262983">cli</span><span class="op" id="7262986">.</span><span class="ident" id="7262987">writeRecord</span><span class="op" id="7262998">(</span><span class="ident" id="7262999">recordTypeHandshake</span><span class="op" id="7263018">,</span>&nbsp;<span class="ident" id="7263020">clientHello</span><span class="op" id="7263031">.</span><span class="ident" id="7263032">marshal</span><span class="op" id="7263039">(</span><span class="op" id="7263040">)</span><span class="op" id="7263041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263045">reply</span><span class="op" id="7263050">,</span>&nbsp;<span class="ident" id="7263052">clientErr</span>&nbsp;<span class="op" id="7263062">=</span>&nbsp;<span class="ident" id="7263064">cli</span><span class="op" id="7263067">.</span><span class="ident" id="7263068">readHandshake</span><span class="op" id="7263081">(</span><span class="op" id="7263082">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263086">c</span><span class="op" id="7263087">.</span><span class="ident" id="7263088">Close</span><span class="op" id="7263093">(</span><span class="op" id="7263094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7263097">}</span><span class="op" id="7263098">(</span><span class="op" id="7263099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263102">config</span>&nbsp;<span class="op" id="7263109">:=</span>&nbsp;<span class="op" id="7263112">*</span><span class="ident" id="7263113">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263125">config</span><span class="op" id="7263131">.</span><span class="ident" id="7263132">CipherSuites</span>&nbsp;<span class="op" id="7263145">=</span>&nbsp;<span class="ident" id="7263147">clientHello</span><span class="op" id="7263158">.</span><span class="ident" id="7263159">cipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263173">Server</span><span class="op" id="7263179">(</span><span class="ident" id="7263180">s</span><span class="op" id="7263181">,</span>&nbsp;<span class="op" id="7263183">&amp;</span><span class="ident" id="7263184">config</span><span class="op" id="7263190">)</span><span class="op" id="7263191">.</span><span class="ident" id="7263192">Handshake</span><span class="op" id="7263201">(</span><span class="op" id="7263202">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263205">s</span><span class="op" id="7263206">.</span><span class="ident" id="7263207">Close</span><span class="op" id="7263212">(</span><span class="op" id="7263213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7263216">if</span>&nbsp;<span class="ident" id="7263219">clientErr</span>&nbsp;<span class="op" id="7263229">!=</span>&nbsp;<span class="ident" id="7263232">nil</span>&nbsp;<span class="op" id="7263236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263240">t</span><span class="op" id="7263241">.</span><span class="ident" id="7263242">Fatal</span><span class="op" id="7263247">(</span><span class="ident" id="7263248">clientErr</span><span class="op" id="7263257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7263260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263263">serverHello</span><span class="op" id="7263274">,</span>&nbsp;<span class="ident" id="7263276">ok</span>&nbsp;<span class="op" id="7263279">:=</span>&nbsp;<span class="ident" id="7263282">reply</span><span class="op" id="7263287">.</span><span class="op" id="7263288">(</span><span class="op" id="7263289">*</span><span class="ident" id="7263290">serverHelloMsg</span><span class="op" id="7263304">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7263307">if</span>&nbsp;<span class="op" id="7263310">!</span><span class="ident" id="7263311">ok</span>&nbsp;<span class="op" id="7263314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263318">t</span><span class="op" id="7263319">.</span><span class="ident" id="7263320">Fatalf</span><span class="op" id="7263326">(</span><span class="string" id="7263327">&#34;didn&#39;t&nbsp;get&nbsp;ServerHello&nbsp;message&nbsp;in&nbsp;reply.&nbsp;Got&nbsp;%v\n&#34;</span><span class="op" id="7263378">,</span>&nbsp;<span class="ident" id="7263380">reply</span><span class="op" id="7263385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7263388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7263391">if</span>&nbsp;<span class="ident" id="7263394">s</span>&nbsp;<span class="op" id="7263396">:=</span>&nbsp;<span class="ident" id="7263399">serverHello</span><span class="op" id="7263410">.</span><span class="ident" id="7263411">cipherSuite</span><span class="op" id="7263422">;</span>&nbsp;<span class="ident" id="7263424">s</span>&nbsp;<span class="op" id="7263426">!=</span>&nbsp;<span class="ident" id="7263429">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="7263454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263458">t</span><span class="op" id="7263459">.</span><span class="ident" id="7263460">Fatalf</span><span class="op" id="7263466">(</span><span class="string" id="7263467">&#34;bad&nbsp;cipher&nbsp;suite&nbsp;from&nbsp;server:&nbsp;%x&#34;</span><span class="op" id="7263501">,</span>&nbsp;<span class="ident" id="7263503">s</span><span class="op" id="7263504">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7263507">}</span><br>
<span class="lineno"></span><span class="op" id="7263509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7263512">func</span>&nbsp;<span class="ident" id="7263517">TestAlertForwarding</span><span class="op" id="7263536">(</span><span class="ident" id="7263537">t</span>&nbsp;<span class="op" id="7263539">*</span><span class="ident" id="7263540">testing</span><span class="op" id="7263547">.</span><span class="ident" id="7263548">T</span><span class="op" id="7263549">)</span>&nbsp;<span class="op" id="7263551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263554">c</span><span class="op" id="7263555">,</span>&nbsp;<span class="ident" id="7263557">s</span>&nbsp;<span class="op" id="7263559">:=</span>&nbsp;<span class="ident" id="7263562">net</span><span class="op" id="7263565">.</span><span class="ident" id="7263566">Pipe</span><span class="op" id="7263570">(</span><span class="op" id="7263571">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7263574">go</span>&nbsp;<span class="keyword" id="7263577">func</span><span class="op" id="7263581">(</span><span class="op" id="7263582">)</span>&nbsp;<span class="op" id="7263584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263588">Client</span><span class="op" id="7263594">(</span><span class="ident" id="7263595">c</span><span class="op" id="7263596">,</span>&nbsp;<span class="ident" id="7263598">testConfig</span><span class="op" id="7263608">)</span><span class="op" id="7263609">.</span><span class="ident" id="7263610">sendAlert</span><span class="op" id="7263619">(</span><span class="ident" id="7263620">alertUnknownCA</span><span class="op" id="7263634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263638">c</span><span class="op" id="7263639">.</span><span class="ident" id="7263640">Close</span><span class="op" id="7263645">(</span><span class="op" id="7263646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7263649">}</span><span class="op" id="7263650">(</span><span class="op" id="7263651">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263655">err</span>&nbsp;<span class="op" id="7263659">:=</span>&nbsp;<span class="ident" id="7263662">Server</span><span class="op" id="7263668">(</span><span class="ident" id="7263669">s</span><span class="op" id="7263670">,</span>&nbsp;<span class="ident" id="7263672">testConfig</span><span class="op" id="7263682">)</span><span class="op" id="7263683">.</span><span class="ident" id="7263684">Handshake</span><span class="op" id="7263693">(</span><span class="op" id="7263694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263697">s</span><span class="op" id="7263698">.</span><span class="ident" id="7263699">Close</span><span class="op" id="7263704">(</span><span class="op" id="7263705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7263708">if</span>&nbsp;<span class="ident" id="7263711">e</span><span class="op" id="7263712">,</span>&nbsp;<span class="ident" id="7263714">ok</span>&nbsp;<span class="op" id="7263717">:=</span>&nbsp;<span class="ident" id="7263720">err</span><span class="op" id="7263723">.</span><span class="op" id="7263724">(</span><span class="op" id="7263725">*</span><span class="ident" id="7263726">net</span><span class="op" id="7263729">.</span><span class="ident" id="7263730">OpError</span><span class="op" id="7263737">)</span><span class="op" id="7263738">;</span>&nbsp;<span class="op" id="7263740">!</span><span class="ident" id="7263741">ok</span>&nbsp;<span class="op" id="7263744">||</span>&nbsp;<span class="ident" id="7263747">e</span><span class="op" id="7263748">.</span><span class="ident" id="7263749">Err</span>&nbsp;<span class="op" id="7263753">!=</span>&nbsp;<span class="builtintype" id="7263756">error</span><span class="op" id="7263761">(</span><span class="ident" id="7263762">alertUnknownCA</span><span class="op" id="7263776">)</span>&nbsp;<span class="op" id="7263778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263782">t</span><span class="op" id="7263783">.</span><span class="ident" id="7263784">Errorf</span><span class="op" id="7263790">(</span><span class="string" id="7263791">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="7263820">,</span>&nbsp;<span class="ident" id="7263822">err</span><span class="op" id="7263825">,</span>&nbsp;<span class="builtintype" id="7263827">error</span><span class="op" id="7263832">(</span><span class="ident" id="7263833">alertUnknownCA</span><span class="op" id="7263847">)</span><span class="op" id="7263848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7263851">}</span><br>
<span class="lineno">165</span><span class="op" id="7263853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7263856">func</span>&nbsp;<span class="ident" id="7263861">TestClose</span><span class="op" id="7263870">(</span><span class="ident" id="7263871">t</span>&nbsp;<span class="op" id="7263873">*</span><span class="ident" id="7263874">testing</span><span class="op" id="7263881">.</span><span class="ident" id="7263882">T</span><span class="op" id="7263883">)</span>&nbsp;<span class="op" id="7263885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263888">c</span><span class="op" id="7263889">,</span>&nbsp;<span class="ident" id="7263891">s</span>&nbsp;<span class="op" id="7263893">:=</span>&nbsp;<span class="ident" id="7263896">net</span><span class="op" id="7263899">.</span><span class="ident" id="7263900">Pipe</span><span class="op" id="7263904">(</span><span class="op" id="7263905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7263908">go</span>&nbsp;<span class="ident" id="7263911">c</span><span class="op" id="7263912">.</span><span class="ident" id="7263913">Close</span><span class="op" id="7263918">(</span><span class="op" id="7263919">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263923">err</span>&nbsp;<span class="op" id="7263927">:=</span>&nbsp;<span class="ident" id="7263930">Server</span><span class="op" id="7263936">(</span><span class="ident" id="7263937">s</span><span class="op" id="7263938">,</span>&nbsp;<span class="ident" id="7263940">testConfig</span><span class="op" id="7263950">)</span><span class="op" id="7263951">.</span><span class="ident" id="7263952">Handshake</span><span class="op" id="7263961">(</span><span class="op" id="7263962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263965">s</span><span class="op" id="7263966">.</span><span class="ident" id="7263967">Close</span><span class="op" id="7263972">(</span><span class="op" id="7263973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7263976">if</span>&nbsp;<span class="ident" id="7263979">err</span>&nbsp;<span class="op" id="7263983">!=</span>&nbsp;<span class="ident" id="7263986">io</span><span class="op" id="7263988">.</span><span class="ident" id="7263989">EOF</span>&nbsp;<span class="op" id="7263993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7263997">t</span><span class="op" id="7263998">.</span><span class="ident" id="7263999">Errorf</span><span class="op" id="7264005">(</span><span class="string" id="7264006">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="7264035">,</span>&nbsp;<span class="ident" id="7264037">err</span><span class="op" id="7264040">,</span>&nbsp;<span class="ident" id="7264042">io</span><span class="op" id="7264044">.</span><span class="ident" id="7264045">EOF</span><span class="op" id="7264048">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7264051">}</span><br>
<span class="lineno"></span><span class="op" id="7264053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7264056">func</span>&nbsp;<span class="ident" id="7264061">testHandshake</span><span class="op" id="7264074">(</span><span class="ident" id="7264075">clientConfig</span><span class="op" id="7264087">,</span>&nbsp;<span class="ident" id="7264089">serverConfig</span>&nbsp;<span class="op" id="7264102">*</span><span class="ident" id="7264103">Config</span><span class="op" id="7264109">)</span>&nbsp;<span class="op" id="7264111">(</span><span class="ident" id="7264112">state</span>&nbsp;<span class="ident" id="7264118">ConnectionState</span><span class="op" id="7264133">,</span>&nbsp;<span class="ident" id="7264135">err</span>&nbsp;<span class="builtintype" id="7264139">error</span><span class="op" id="7264144">)</span>&nbsp;<span class="op" id="7264146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264149">c</span><span class="op" id="7264150">,</span>&nbsp;<span class="ident" id="7264152">s</span>&nbsp;<span class="op" id="7264154">:=</span>&nbsp;<span class="ident" id="7264157">net</span><span class="op" id="7264160">.</span><span class="ident" id="7264161">Pipe</span><span class="op" id="7264165">(</span><span class="op" id="7264166">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264169">done</span>&nbsp;<span class="op" id="7264174">:=</span>&nbsp;<span class="builtinfunc" id="7264177">make</span><span class="op" id="7264181">(</span><span class="keyword" id="7264182">chan</span>&nbsp;<span class="builtintype" id="7264187">bool</span><span class="op" id="7264191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7264194">go</span>&nbsp;<span class="keyword" id="7264197">func</span><span class="op" id="7264201">(</span><span class="op" id="7264202">)</span>&nbsp;<span class="op" id="7264204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264208">cli</span>&nbsp;<span class="op" id="7264212">:=</span>&nbsp;<span class="ident" id="7264215">Client</span><span class="op" id="7264221">(</span><span class="ident" id="7264222">c</span><span class="op" id="7264223">,</span>&nbsp;<span class="ident" id="7264225">clientConfig</span><span class="op" id="7264237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264241">cli</span><span class="op" id="7264244">.</span><span class="ident" id="7264245">Handshake</span><span class="op" id="7264254">(</span><span class="op" id="7264255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264259">c</span><span class="op" id="7264260">.</span><span class="ident" id="7264261">Close</span><span class="op" id="7264266">(</span><span class="op" id="7264267">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264271">done</span>&nbsp;<span class="op" id="7264276">&lt;-</span>&nbsp;<span class="builtintype" id="7264279">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7264285">}</span><span class="op" id="7264286">(</span><span class="op" id="7264287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264290">server</span>&nbsp;<span class="op" id="7264297">:=</span>&nbsp;<span class="ident" id="7264300">Server</span><span class="op" id="7264306">(</span><span class="ident" id="7264307">s</span><span class="op" id="7264308">,</span>&nbsp;<span class="ident" id="7264310">serverConfig</span><span class="op" id="7264322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264325">err</span>&nbsp;<span class="op" id="7264329">=</span>&nbsp;<span class="ident" id="7264331">server</span><span class="op" id="7264337">.</span><span class="ident" id="7264338">Handshake</span><span class="op" id="7264347">(</span><span class="op" id="7264348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7264351">if</span>&nbsp;<span class="ident" id="7264354">err</span>&nbsp;<span class="op" id="7264358">==</span>&nbsp;<span class="ident" id="7264361">nil</span>&nbsp;<span class="op" id="7264365">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264369">state</span>&nbsp;<span class="op" id="7264375">=</span>&nbsp;<span class="ident" id="7264377">server</span><span class="op" id="7264383">.</span><span class="ident" id="7264384">ConnectionState</span><span class="op" id="7264399">(</span><span class="op" id="7264400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7264403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264406">s</span><span class="op" id="7264407">.</span><span class="ident" id="7264408">Close</span><span class="op" id="7264413">(</span><span class="op" id="7264414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7264417">&lt;-</span><span class="ident" id="7264419">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7264425">return</span><br>
<span class="lineno">195</span><span class="op" id="7264432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7264435">func</span>&nbsp;<span class="ident" id="7264440">TestVersion</span><span class="op" id="7264451">(</span><span class="ident" id="7264452">t</span>&nbsp;<span class="op" id="7264454">*</span><span class="ident" id="7264455">testing</span><span class="op" id="7264462">.</span><span class="ident" id="7264463">T</span><span class="op" id="7264464">)</span>&nbsp;<span class="op" id="7264466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264469">serverConfig</span>&nbsp;<span class="op" id="7264482">:=</span>&nbsp;<span class="op" id="7264485">&amp;</span><span class="ident" id="7264486">Config</span><span class="op" id="7264492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264496">Certificates</span><span class="op" id="7264508">:</span>&nbsp;<span class="ident" id="7264510">testConfig</span><span class="op" id="7264520">.</span><span class="ident" id="7264521">Certificates</span><span class="op" id="7264533">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264537">MaxVersion</span><span class="op" id="7264547">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7264551">VersionTLS11</span><span class="op" id="7264563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7264566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264569">clientConfig</span>&nbsp;<span class="op" id="7264582">:=</span>&nbsp;<span class="op" id="7264585">&amp;</span><span class="ident" id="7264586">Config</span><span class="op" id="7264592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264596">InsecureSkipVerify</span><span class="op" id="7264614">:</span>&nbsp;<span class="builtintype" id="7264616">true</span><span class="op" id="7264620">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7264623">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264626">state</span><span class="op" id="7264631">,</span>&nbsp;<span class="ident" id="7264633">err</span>&nbsp;<span class="op" id="7264637">:=</span>&nbsp;<span class="ident" id="7264640">testHandshake</span><span class="op" id="7264653">(</span><span class="ident" id="7264654">clientConfig</span><span class="op" id="7264666">,</span>&nbsp;<span class="ident" id="7264668">serverConfig</span><span class="op" id="7264680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7264683">if</span>&nbsp;<span class="ident" id="7264686">err</span>&nbsp;<span class="op" id="7264690">!=</span>&nbsp;<span class="ident" id="7264693">nil</span>&nbsp;<span class="op" id="7264697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264701">t</span><span class="op" id="7264702">.</span><span class="ident" id="7264703">Fatalf</span><span class="op" id="7264709">(</span><span class="string" id="7264710">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7264732">,</span>&nbsp;<span class="ident" id="7264734">err</span><span class="op" id="7264737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7264740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7264743">if</span>&nbsp;<span class="ident" id="7264746">state</span><span class="op" id="7264751">.</span><span class="ident" id="7264752">Version</span>&nbsp;<span class="op" id="7264760">!=</span>&nbsp;<span class="ident" id="7264763">VersionTLS11</span>&nbsp;<span class="op" id="7264776">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264780">t</span><span class="op" id="7264781">.</span><span class="ident" id="7264782">Fatalf</span><span class="op" id="7264788">(</span><span class="string" id="7264789">&#34;Incorrect&nbsp;version&nbsp;%x,&nbsp;should&nbsp;be&nbsp;%x&#34;</span><span class="op" id="7264825">,</span>&nbsp;<span class="ident" id="7264827">state</span><span class="op" id="7264832">.</span><span class="ident" id="7264833">Version</span><span class="op" id="7264840">,</span>&nbsp;<span class="ident" id="7264842">VersionTLS11</span><span class="op" id="7264854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7264857">}</span><br>
<span class="lineno"></span><span class="op" id="7264859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7264862">func</span>&nbsp;<span class="ident" id="7264867">TestCipherSuitePreference</span><span class="op" id="7264892">(</span><span class="ident" id="7264893">t</span>&nbsp;<span class="op" id="7264895">*</span><span class="ident" id="7264896">testing</span><span class="op" id="7264903">.</span><span class="ident" id="7264904">T</span><span class="op" id="7264905">)</span>&nbsp;<span class="op" id="7264907">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264910">serverConfig</span>&nbsp;<span class="op" id="7264923">:=</span>&nbsp;<span class="op" id="7264926">&amp;</span><span class="ident" id="7264927">Config</span><span class="op" id="7264933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7264937">CipherSuites</span><span class="op" id="7264949">:</span>&nbsp;<span class="op" id="7264951">[</span><span class="op" id="7264952">]</span><span class="builtintype" id="7264953">uint16</span><span class="op" id="7264959">{</span><span class="ident" id="7264960">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7264984">,</span>&nbsp;<span class="ident" id="7264986">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="7265014">,</span>&nbsp;<span class="ident" id="7265016">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="7265046">}</span><span class="op" id="7265047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7265051">Certificates</span><span class="op" id="7265063">:</span>&nbsp;<span class="ident" id="7265065">testConfig</span><span class="op" id="7265075">.</span><span class="ident" id="7265076">Certificates</span><span class="op" id="7265088">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7265092">MaxVersion</span><span class="op" id="7265102">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7265106">VersionTLS11</span><span class="op" id="7265118">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7265121">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7265124">clientConfig</span>&nbsp;<span class="op" id="7265137">:=</span>&nbsp;<span class="op" id="7265140">&amp;</span><span class="ident" id="7265141">Config</span><span class="op" id="7265147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7265151">CipherSuites</span><span class="op" id="7265163">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7265171">[</span><span class="op" id="7265172">]</span><span class="builtintype" id="7265173">uint16</span><span class="op" id="7265179">{</span><span class="ident" id="7265180">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="7265208">,</span>&nbsp;<span class="ident" id="7265210">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7265234">}</span><span class="op" id="7265235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7265239">InsecureSkipVerify</span><span class="op" id="7265257">:</span>&nbsp;<span class="builtintype" id="7265259">true</span><span class="op" id="7265263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7265266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7265269">state</span><span class="op" id="7265274">,</span>&nbsp;<span class="ident" id="7265276">err</span>&nbsp;<span class="op" id="7265280">:=</span>&nbsp;<span class="ident" id="7265283">testHandshake</span><span class="op" id="7265296">(</span><span class="ident" id="7265297">clientConfig</span><span class="op" id="7265309">,</span>&nbsp;<span class="ident" id="7265311">serverConfig</span><span class="op" id="7265323">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7265326">if</span>&nbsp;<span class="ident" id="7265329">err</span>&nbsp;<span class="op" id="7265333">!=</span>&nbsp;<span class="ident" id="7265336">nil</span>&nbsp;<span class="op" id="7265340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7265344">t</span><span class="op" id="7265345">.</span><span class="ident" id="7265346">Fatalf</span><span class="op" id="7265352">(</span><span class="string" id="7265353">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7265375">,</span>&nbsp;<span class="ident" id="7265377">err</span><span class="op" id="7265380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7265383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7265386">if</span>&nbsp;<span class="ident" id="7265389">state</span><span class="op" id="7265394">.</span><span class="ident" id="7265395">CipherSuite</span>&nbsp;<span class="op" id="7265407">!=</span>&nbsp;<span class="ident" id="7265410">TLS_RSA_WITH_AES_128_CBC_SHA</span>&nbsp;<span class="op" id="7265439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7265443">//&nbsp;By&nbsp;default&nbsp;the&nbsp;server&nbsp;should&nbsp;use&nbsp;the&nbsp;client&#39;s&nbsp;preference.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7265506">t</span><span class="op" id="7265507">.</span><span class="ident" id="7265508">Fatalf</span><span class="op" id="7265514">(</span><span class="string" id="7265515">&#34;Client&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="7265557">,</span>&nbsp;<span class="ident" id="7265559">state</span><span class="op" id="7265564">.</span><span class="ident" id="7265565">CipherSuite</span><span class="op" id="7265576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7265579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7265583">serverConfig</span><span class="op" id="7265595">.</span><span class="ident" id="7265596">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7265621">=</span>&nbsp;<span class="builtintype" id="7265623">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7265629">state</span><span class="op" id="7265634">,</span>&nbsp;<span class="ident" id="7265636">err</span>&nbsp;<span class="op" id="7265640">=</span>&nbsp;<span class="ident" id="7265642">testHandshake</span><span class="op" id="7265655">(</span><span class="ident" id="7265656">clientConfig</span><span class="op" id="7265668">,</span>&nbsp;<span class="ident" id="7265670">serverConfig</span><span class="op" id="7265682">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7265685">if</span>&nbsp;<span class="ident" id="7265688">err</span>&nbsp;<span class="op" id="7265692">!=</span>&nbsp;<span class="ident" id="7265695">nil</span>&nbsp;<span class="op" id="7265699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7265703">t</span><span class="op" id="7265704">.</span><span class="ident" id="7265705">Fatalf</span><span class="op" id="7265711">(</span><span class="string" id="7265712">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7265734">,</span>&nbsp;<span class="ident" id="7265736">err</span><span class="op" id="7265739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7265742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7265745">if</span>&nbsp;<span class="ident" id="7265748">state</span><span class="op" id="7265753">.</span><span class="ident" id="7265754">CipherSuite</span>&nbsp;<span class="op" id="7265766">!=</span>&nbsp;<span class="ident" id="7265769">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="7265794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7265798">t</span><span class="op" id="7265799">.</span><span class="ident" id="7265800">Fatalf</span><span class="op" id="7265806">(</span><span class="string" id="7265807">&#34;Server&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="7265849">,</span>&nbsp;<span class="ident" id="7265851">state</span><span class="op" id="7265856">.</span><span class="ident" id="7265857">CipherSuite</span><span class="op" id="7265868">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7265871">}</span><br>
<span class="lineno"></span><span class="op" id="7265873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7265876">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7265951">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="7265967">//&nbsp;serverTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;server&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7266047">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="7266066">type</span>&nbsp;<span class="ident" id="7266071">serverTest</span>&nbsp;<span class="keyword" id="7266082">struct</span>&nbsp;<span class="op" id="7266089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7266092">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7266165">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7266206">name</span>&nbsp;<span class="builtintype" id="7266211">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7266219">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7266285">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7266330">command</span>&nbsp;<span class="op" id="7266338">[</span><span class="op" id="7266339">]</span><span class="builtintype" id="7266340">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7266348">//&nbsp;expectedPeerCerts&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;PEM&nbsp;blocks&nbsp;of&nbsp;expected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7266412">//&nbsp;certificates&nbsp;from&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7266446">expectedPeerCerts</span>&nbsp;<span class="op" id="7266464">[</span><span class="op" id="7266465">]</span><span class="builtintype" id="7266466">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7266474">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7266545">config</span>&nbsp;<span class="op" id="7266552">*</span><span class="ident" id="7266553">Config</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7266561">//&nbsp;expectAlert,&nbsp;if&nbsp;true,&nbsp;indicates&nbsp;that&nbsp;a&nbsp;fatal&nbsp;alert&nbsp;should&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7266635">//&nbsp;when&nbsp;handshaking&nbsp;with&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7266673">expectAlert</span>&nbsp;<span class="builtintype" id="7266685">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7266691">//&nbsp;expectHandshakeErrorIncluding,&nbsp;when&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7266760">//&nbsp;that&nbsp;must&nbsp;be&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;error&nbsp;resulting&nbsp;from&nbsp;the&nbsp;handshake.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7266832">expectHandshakeErrorIncluding</span>&nbsp;<span class="builtintype" id="7266862">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7266870">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7266939">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;false&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7267012">//&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7267049">validate</span>&nbsp;<span class="keyword" id="7267058">func</span><span class="op" id="7267062">(</span><span class="ident" id="7267063">ConnectionState</span><span class="op" id="7267078">)</span>&nbsp;<span class="builtintype" id="7267080">error</span><br>
<span class="lineno">270</span><span class="op" id="7267086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7267089">var</span>&nbsp;<span class="ident" id="7267093">defaultClientCommand</span>&nbsp;<span class="op" id="7267114">=</span>&nbsp;<span class="op" id="7267116">[</span><span class="op" id="7267117">]</span><span class="builtintype" id="7267118">string</span><span class="op" id="7267124">{</span><span class="string" id="7267125">&#34;openssl&#34;</span><span class="op" id="7267134">,</span>&nbsp;<span class="string" id="7267136">&#34;s_client&#34;</span><span class="op" id="7267146">,</span>&nbsp;<span class="string" id="7267148">&#34;-no_ticket&#34;</span><span class="op" id="7267160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7267163">//&nbsp;connFromCommand&nbsp;starts&nbsp;opens&nbsp;a&nbsp;listening&nbsp;socket&nbsp;and&nbsp;starts&nbsp;the&nbsp;reference</span><br>
<span class="lineno">275</span><span class="comment" id="7267239">//&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;it.&nbsp;It&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;that&nbsp;wraps&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="7267319">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="7267334">func</span>&nbsp;<span class="op" id="7267339">(</span><span class="ident" id="7267340">test</span>&nbsp;<span class="op" id="7267345">*</span><span class="ident" id="7267346">serverTest</span><span class="op" id="7267356">)</span>&nbsp;<span class="ident" id="7267358">connFromCommand</span><span class="op" id="7267373">(</span><span class="op" id="7267374">)</span>&nbsp;<span class="op" id="7267376">(</span><span class="ident" id="7267377">conn</span>&nbsp;<span class="op" id="7267382">*</span><span class="ident" id="7267383">recordingConn</span><span class="op" id="7267396">,</span>&nbsp;<span class="ident" id="7267398">child</span>&nbsp;<span class="op" id="7267404">*</span><span class="ident" id="7267405">exec</span><span class="op" id="7267409">.</span><span class="ident" id="7267410">Cmd</span><span class="op" id="7267413">,</span>&nbsp;<span class="ident" id="7267415">err</span>&nbsp;<span class="builtintype" id="7267419">error</span><span class="op" id="7267424">)</span>&nbsp;<span class="op" id="7267426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7267429">l</span><span class="op" id="7267430">,</span>&nbsp;<span class="ident" id="7267432">err</span>&nbsp;<span class="op" id="7267436">:=</span>&nbsp;<span class="ident" id="7267439">net</span><span class="op" id="7267442">.</span><span class="ident" id="7267443">ListenTCP</span><span class="op" id="7267452">(</span><span class="string" id="7267453">&#34;tcp&#34;</span><span class="op" id="7267458">,</span>&nbsp;<span class="op" id="7267460">&amp;</span><span class="ident" id="7267461">net</span><span class="op" id="7267464">.</span><span class="ident" id="7267465">TCPAddr</span><span class="op" id="7267472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7267476">IP</span><span class="op" id="7267478">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7267482">net</span><span class="op" id="7267485">.</span><span class="ident" id="7267486">IPv4</span><span class="op" id="7267490">(</span><span class="num" id="7267491">127</span><span class="op" id="7267494">,</span>&nbsp;<span class="num" id="7267496">0</span><span class="op" id="7267497">,</span>&nbsp;<span class="num" id="7267499">0</span><span class="op" id="7267500">,</span>&nbsp;<span class="num" id="7267502">1</span><span class="op" id="7267503">)</span><span class="op" id="7267504">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7267508">Port</span><span class="op" id="7267512">:</span>&nbsp;<span class="num" id="7267514">0</span><span class="op" id="7267515">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7267518">}</span><span class="op" id="7267519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7267522">if</span>&nbsp;<span class="ident" id="7267525">err</span>&nbsp;<span class="op" id="7267529">!=</span>&nbsp;<span class="ident" id="7267532">nil</span>&nbsp;<span class="op" id="7267536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7267540">return</span>&nbsp;<span class="ident" id="7267547">nil</span><span class="op" id="7267550">,</span>&nbsp;<span class="ident" id="7267552">nil</span><span class="op" id="7267555">,</span>&nbsp;<span class="ident" id="7267557">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7267562">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7267565">defer</span>&nbsp;<span class="ident" id="7267571">l</span><span class="op" id="7267572">.</span><span class="ident" id="7267573">Close</span><span class="op" id="7267578">(</span><span class="op" id="7267579">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7267583">port</span>&nbsp;<span class="op" id="7267588">:=</span>&nbsp;<span class="ident" id="7267591">l</span><span class="op" id="7267592">.</span><span class="ident" id="7267593">Addr</span><span class="op" id="7267597">(</span><span class="op" id="7267598">)</span><span class="op" id="7267599">.</span><span class="op" id="7267600">(</span><span class="op" id="7267601">*</span><span class="ident" id="7267602">net</span><span class="op" id="7267605">.</span><span class="ident" id="7267606">TCPAddr</span><span class="op" id="7267613">)</span><span class="op" id="7267614">.</span><span class="ident" id="7267615">Port</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7267622">var</span>&nbsp;<span class="ident" id="7267626">command</span>&nbsp;<span class="op" id="7267634">[</span><span class="op" id="7267635">]</span><span class="builtintype" id="7267636">string</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7267644">command</span>&nbsp;<span class="op" id="7267652">=</span>&nbsp;<span class="builtinfunc" id="7267654">append</span><span class="op" id="7267660">(</span><span class="ident" id="7267661">command</span><span class="op" id="7267668">,</span>&nbsp;<span class="ident" id="7267670">test</span><span class="op" id="7267674">.</span><span class="ident" id="7267675">command</span><span class="op" id="7267682">...</span><span class="op" id="7267685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7267688">if</span>&nbsp;<span class="builtinfunc" id="7267691">len</span><span class="op" id="7267694">(</span><span class="ident" id="7267695">command</span><span class="op" id="7267702">)</span>&nbsp;<span class="op" id="7267704">==</span>&nbsp;<span class="num" id="7267707">0</span>&nbsp;<span class="op" id="7267709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7267713">command</span>&nbsp;<span class="op" id="7267721">=</span>&nbsp;<span class="ident" id="7267723">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7267745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7267748">command</span>&nbsp;<span class="op" id="7267756">=</span>&nbsp;<span class="builtinfunc" id="7267758">append</span><span class="op" id="7267764">(</span><span class="ident" id="7267765">command</span><span class="op" id="7267772">,</span>&nbsp;<span class="string" id="7267774">&#34;-connect&#34;</span><span class="op" id="7267784">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7267787">command</span>&nbsp;<span class="op" id="7267795">=</span>&nbsp;<span class="builtinfunc" id="7267797">append</span><span class="op" id="7267803">(</span><span class="ident" id="7267804">command</span><span class="op" id="7267811">,</span>&nbsp;<span class="ident" id="7267813">fmt</span><span class="op" id="7267816">.</span><span class="ident" id="7267817">Sprintf</span><span class="op" id="7267824">(</span><span class="string" id="7267825">&#34;127.0.0.1:%d&#34;</span><span class="op" id="7267839">,</span>&nbsp;<span class="ident" id="7267841">port</span><span class="op" id="7267845">)</span><span class="op" id="7267846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7267849">cmd</span>&nbsp;<span class="op" id="7267853">:=</span>&nbsp;<span class="ident" id="7267856">exec</span><span class="op" id="7267860">.</span><span class="ident" id="7267861">Command</span><span class="op" id="7267868">(</span><span class="ident" id="7267869">command</span><span class="op" id="7267876">[</span><span class="num" id="7267877">0</span><span class="op" id="7267878">]</span><span class="op" id="7267879">,</span>&nbsp;<span class="ident" id="7267881">command</span><span class="op" id="7267888">[</span><span class="num" id="7267889">1</span><span class="op" id="7267890">:</span><span class="op" id="7267891">]</span><span class="op" id="7267892">...</span><span class="op" id="7267895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7267898">cmd</span><span class="op" id="7267901">.</span><span class="ident" id="7267902">Stdin</span>&nbsp;<span class="op" id="7267908">=</span>&nbsp;<span class="ident" id="7267910">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7267915">var</span>&nbsp;<span class="ident" id="7267919">output</span>&nbsp;<span class="ident" id="7267926">bytes</span><span class="op" id="7267931">.</span><span class="ident" id="7267932">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7267940">cmd</span><span class="op" id="7267943">.</span><span class="ident" id="7267944">Stdout</span>&nbsp;<span class="op" id="7267951">=</span>&nbsp;<span class="op" id="7267953">&amp;</span><span class="ident" id="7267954">output</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7267962">cmd</span><span class="op" id="7267965">.</span><span class="ident" id="7267966">Stderr</span>&nbsp;<span class="op" id="7267973">=</span>&nbsp;<span class="op" id="7267975">&amp;</span><span class="ident" id="7267976">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7267984">if</span>&nbsp;<span class="ident" id="7267987">err</span>&nbsp;<span class="op" id="7267991">:=</span>&nbsp;<span class="ident" id="7267994">cmd</span><span class="op" id="7267997">.</span><span class="ident" id="7267998">Start</span><span class="op" id="7268003">(</span><span class="op" id="7268004">)</span><span class="op" id="7268005">;</span>&nbsp;<span class="ident" id="7268007">err</span>&nbsp;<span class="op" id="7268011">!=</span>&nbsp;<span class="ident" id="7268014">nil</span>&nbsp;<span class="op" id="7268018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7268022">return</span>&nbsp;<span class="ident" id="7268029">nil</span><span class="op" id="7268032">,</span>&nbsp;<span class="ident" id="7268034">nil</span><span class="op" id="7268037">,</span>&nbsp;<span class="ident" id="7268039">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7268044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7268048">connChan</span>&nbsp;<span class="op" id="7268057">:=</span>&nbsp;<span class="builtinfunc" id="7268060">make</span><span class="op" id="7268064">(</span><span class="keyword" id="7268065">chan</span>&nbsp;<span class="keyword" id="7268070">interface</span><span class="op" id="7268079">{</span><span class="op" id="7268080">}</span><span class="op" id="7268081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7268084">go</span>&nbsp;<span class="keyword" id="7268087">func</span><span class="op" id="7268091">(</span><span class="op" id="7268092">)</span>&nbsp;<span class="op" id="7268094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7268098">tcpConn</span><span class="op" id="7268105">,</span>&nbsp;<span class="ident" id="7268107">err</span>&nbsp;<span class="op" id="7268111">:=</span>&nbsp;<span class="ident" id="7268114">l</span><span class="op" id="7268115">.</span><span class="ident" id="7268116">Accept</span><span class="op" id="7268122">(</span><span class="op" id="7268123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7268127">if</span>&nbsp;<span class="ident" id="7268130">err</span>&nbsp;<span class="op" id="7268134">!=</span>&nbsp;<span class="ident" id="7268137">nil</span>&nbsp;<span class="op" id="7268141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7268146">connChan</span>&nbsp;<span class="op" id="7268155">&lt;-</span>&nbsp;<span class="ident" id="7268158">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7268164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7268168">connChan</span>&nbsp;<span class="op" id="7268177">&lt;-</span>&nbsp;<span class="ident" id="7268180">tcpConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7268189">}</span><span class="op" id="7268190">(</span><span class="op" id="7268191">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7268195">var</span>&nbsp;<span class="ident" id="7268199">tcpConn</span>&nbsp;<span class="ident" id="7268207">net</span><span class="op" id="7268210">.</span><span class="ident" id="7268211">Conn</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7268217">select</span>&nbsp;<span class="op" id="7268224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7268227">case</span>&nbsp;<span class="ident" id="7268232">connOrError</span>&nbsp;<span class="op" id="7268244">:=</span>&nbsp;<span class="op" id="7268247">&lt;-</span><span class="ident" id="7268249">connChan</span><span class="op" id="7268257">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7268261">if</span>&nbsp;<span class="ident" id="7268264">err</span><span class="op" id="7268267">,</span>&nbsp;<span class="ident" id="7268269">ok</span>&nbsp;<span class="op" id="7268272">:=</span>&nbsp;<span class="ident" id="7268275">connOrError</span><span class="op" id="7268286">.</span><span class="op" id="7268287">(</span><span class="builtintype" id="7268288">error</span><span class="op" id="7268293">)</span><span class="op" id="7268294">;</span>&nbsp;<span class="ident" id="7268296">ok</span>&nbsp;<span class="op" id="7268299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7268304">return</span>&nbsp;<span class="ident" id="7268311">nil</span><span class="op" id="7268314">,</span>&nbsp;<span class="ident" id="7268316">nil</span><span class="op" id="7268319">,</span>&nbsp;<span class="ident" id="7268321">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7268327">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7268331">tcpConn</span>&nbsp;<span class="op" id="7268339">=</span>&nbsp;<span class="ident" id="7268341">connOrError</span><span class="op" id="7268352">.</span><span class="op" id="7268353">(</span><span class="ident" id="7268354">net</span><span class="op" id="7268357">.</span><span class="ident" id="7268358">Conn</span><span class="op" id="7268362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7268365">case</span>&nbsp;<span class="op" id="7268370">&lt;-</span><span class="ident" id="7268372">time</span><span class="op" id="7268376">.</span><span class="ident" id="7268377">After</span><span class="op" id="7268382">(</span><span class="num" id="7268383">2</span>&nbsp;<span class="op" id="7268385">*</span>&nbsp;<span class="ident" id="7268387">time</span><span class="op" id="7268391">.</span><span class="ident" id="7268392">Second</span><span class="op" id="7268398">)</span><span class="op" id="7268399">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7268403">output</span><span class="op" id="7268409">.</span><span class="ident" id="7268410">WriteTo</span><span class="op" id="7268417">(</span><span class="ident" id="7268418">os</span><span class="op" id="7268420">.</span><span class="ident" id="7268421">Stdout</span><span class="op" id="7268427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7268431">return</span>&nbsp;<span class="ident" id="7268438">nil</span><span class="op" id="7268441">,</span>&nbsp;<span class="ident" id="7268443">nil</span><span class="op" id="7268446">,</span>&nbsp;<span class="ident" id="7268448">errors</span><span class="op" id="7268454">.</span><span class="ident" id="7268455">New</span><span class="op" id="7268458">(</span><span class="string" id="7268459">&#34;timed&nbsp;out&nbsp;waiting&nbsp;for&nbsp;connection&nbsp;from&nbsp;child&nbsp;process&#34;</span><span class="op" id="7268512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7268515">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7268519">record</span>&nbsp;<span class="op" id="7268526">:=</span>&nbsp;<span class="op" id="7268529">&amp;</span><span class="ident" id="7268530">recordingConn</span><span class="op" id="7268543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7268547">Conn</span><span class="op" id="7268551">:</span>&nbsp;<span class="ident" id="7268553">tcpConn</span><span class="op" id="7268560">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7268563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7268567">return</span>&nbsp;<span class="ident" id="7268574">record</span><span class="op" id="7268580">,</span>&nbsp;<span class="ident" id="7268582">cmd</span><span class="op" id="7268585">,</span>&nbsp;<span class="ident" id="7268587">nil</span><br>
<span class="lineno"></span><span class="op" id="7268591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7268594">func</span>&nbsp;<span class="op" id="7268599">(</span><span class="ident" id="7268600">test</span>&nbsp;<span class="op" id="7268605">*</span><span class="ident" id="7268606">serverTest</span><span class="op" id="7268616">)</span>&nbsp;<span class="ident" id="7268618">dataPath</span><span class="op" id="7268626">(</span><span class="op" id="7268627">)</span>&nbsp;<span class="builtintype" id="7268629">string</span>&nbsp;<span class="op" id="7268636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7268639">return</span>&nbsp;<span class="ident" id="7268646">filepath</span><span class="op" id="7268654">.</span><span class="ident" id="7268655">Join</span><span class="op" id="7268659">(</span><span class="string" id="7268660">&#34;testdata&#34;</span><span class="op" id="7268670">,</span>&nbsp;<span class="string" id="7268672">&#34;Server-&#34;</span><span class="op" id="7268681">+</span><span class="ident" id="7268682">test</span><span class="op" id="7268686">.</span><span class="ident" id="7268687">name</span><span class="op" id="7268691">)</span><br>
<span class="lineno">335</span><span class="op" id="7268693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7268696">func</span>&nbsp;<span class="op" id="7268701">(</span><span class="ident" id="7268702">test</span>&nbsp;<span class="op" id="7268707">*</span><span class="ident" id="7268708">serverTest</span><span class="op" id="7268718">)</span>&nbsp;<span class="ident" id="7268720">loadData</span><span class="op" id="7268728">(</span><span class="op" id="7268729">)</span>&nbsp;<span class="op" id="7268731">(</span><span class="ident" id="7268732">flows</span>&nbsp;<span class="op" id="7268738">[</span><span class="op" id="7268739">]</span><span class="op" id="7268740">[</span><span class="op" id="7268741">]</span><span class="builtintype" id="7268742">byte</span><span class="op" id="7268746">,</span>&nbsp;<span class="ident" id="7268748">err</span>&nbsp;<span class="builtintype" id="7268752">error</span><span class="op" id="7268757">)</span>&nbsp;<span class="op" id="7268759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7268762">in</span><span class="op" id="7268764">,</span>&nbsp;<span class="ident" id="7268766">err</span>&nbsp;<span class="op" id="7268770">:=</span>&nbsp;<span class="ident" id="7268773">os</span><span class="op" id="7268775">.</span><span class="ident" id="7268776">Open</span><span class="op" id="7268780">(</span><span class="ident" id="7268781">test</span><span class="op" id="7268785">.</span><span class="ident" id="7268786">dataPath</span><span class="op" id="7268794">(</span><span class="op" id="7268795">)</span><span class="op" id="7268796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7268799">if</span>&nbsp;<span class="ident" id="7268802">err</span>&nbsp;<span class="op" id="7268806">!=</span>&nbsp;<span class="ident" id="7268809">nil</span>&nbsp;<span class="op" id="7268813">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7268817">return</span>&nbsp;<span class="ident" id="7268824">nil</span><span class="op" id="7268827">,</span>&nbsp;<span class="ident" id="7268829">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7268834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7268837">defer</span>&nbsp;<span class="ident" id="7268843">in</span><span class="op" id="7268845">.</span><span class="ident" id="7268846">Close</span><span class="op" id="7268851">(</span><span class="op" id="7268852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7268855">return</span>&nbsp;<span class="ident" id="7268862">parseTestData</span><span class="op" id="7268875">(</span><span class="ident" id="7268876">in</span><span class="op" id="7268878">)</span><br>
<span class="lineno"></span><span class="op" id="7268880">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="7268883">func</span>&nbsp;<span class="op" id="7268888">(</span><span class="ident" id="7268889">test</span>&nbsp;<span class="op" id="7268894">*</span><span class="ident" id="7268895">serverTest</span><span class="op" id="7268905">)</span>&nbsp;<span class="ident" id="7268907">run</span><span class="op" id="7268910">(</span><span class="ident" id="7268911">t</span>&nbsp;<span class="op" id="7268913">*</span><span class="ident" id="7268914">testing</span><span class="op" id="7268921">.</span><span class="ident" id="7268922">T</span><span class="op" id="7268923">,</span>&nbsp;<span class="ident" id="7268925">write</span>&nbsp;<span class="builtintype" id="7268931">bool</span><span class="op" id="7268935">)</span>&nbsp;<span class="op" id="7268937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7268940">var</span>&nbsp;<span class="ident" id="7268944">clientConn</span><span class="op" id="7268954">,</span>&nbsp;<span class="ident" id="7268956">serverConn</span>&nbsp;<span class="ident" id="7268967">net</span><span class="op" id="7268970">.</span><span class="ident" id="7268971">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7268977">var</span>&nbsp;<span class="ident" id="7268981">recordingConn</span>&nbsp;<span class="op" id="7268995">*</span><span class="ident" id="7268996">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7269011">var</span>&nbsp;<span class="ident" id="7269015">childProcess</span>&nbsp;<span class="op" id="7269028">*</span><span class="ident" id="7269029">exec</span><span class="op" id="7269033">.</span><span class="ident" id="7269034">Cmd</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7269040">if</span>&nbsp;<span class="ident" id="7269043">write</span>&nbsp;<span class="op" id="7269049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7269053">var</span>&nbsp;<span class="ident" id="7269057">err</span>&nbsp;<span class="builtintype" id="7269061">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7269069">recordingConn</span><span class="op" id="7269082">,</span>&nbsp;<span class="ident" id="7269084">childProcess</span><span class="op" id="7269096">,</span>&nbsp;<span class="ident" id="7269098">err</span>&nbsp;<span class="op" id="7269102">=</span>&nbsp;<span class="ident" id="7269104">test</span><span class="op" id="7269108">.</span><span class="ident" id="7269109">connFromCommand</span><span class="op" id="7269124">(</span><span class="op" id="7269125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7269129">if</span>&nbsp;<span class="ident" id="7269132">err</span>&nbsp;<span class="op" id="7269136">!=</span>&nbsp;<span class="ident" id="7269139">nil</span>&nbsp;<span class="op" id="7269143">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7269148">t</span><span class="op" id="7269149">.</span><span class="ident" id="7269150">Fatalf</span><span class="op" id="7269156">(</span><span class="string" id="7269157">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="7269189">,</span>&nbsp;<span class="ident" id="7269191">err</span><span class="op" id="7269194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7269198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7269202">serverConn</span>&nbsp;<span class="op" id="7269213">=</span>&nbsp;<span class="ident" id="7269215">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7269230">}</span>&nbsp;<span class="keyword" id="7269232">else</span>&nbsp;<span class="op" id="7269237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7269241">clientConn</span><span class="op" id="7269251">,</span>&nbsp;<span class="ident" id="7269253">serverConn</span>&nbsp;<span class="op" id="7269264">=</span>&nbsp;<span class="ident" id="7269266">net</span><span class="op" id="7269269">.</span><span class="ident" id="7269270">Pipe</span><span class="op" id="7269274">(</span><span class="op" id="7269275">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7269278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7269281">config</span>&nbsp;<span class="op" id="7269288">:=</span>&nbsp;<span class="ident" id="7269291">test</span><span class="op" id="7269295">.</span><span class="ident" id="7269296">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7269304">if</span>&nbsp;<span class="ident" id="7269307">config</span>&nbsp;<span class="op" id="7269314">==</span>&nbsp;<span class="ident" id="7269317">nil</span>&nbsp;<span class="op" id="7269321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7269325">config</span>&nbsp;<span class="op" id="7269332">=</span>&nbsp;<span class="ident" id="7269334">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7269346">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7269349">server</span>&nbsp;<span class="op" id="7269356">:=</span>&nbsp;<span class="ident" id="7269359">Server</span><span class="op" id="7269365">(</span><span class="ident" id="7269366">serverConn</span><span class="op" id="7269376">,</span>&nbsp;<span class="ident" id="7269378">config</span><span class="op" id="7269384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7269387">connStateChan</span>&nbsp;<span class="op" id="7269401">:=</span>&nbsp;<span class="builtinfunc" id="7269404">make</span><span class="op" id="7269408">(</span><span class="keyword" id="7269409">chan</span>&nbsp;<span class="ident" id="7269414">ConnectionState</span><span class="op" id="7269429">,</span>&nbsp;<span class="num" id="7269431">1</span><span class="op" id="7269432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7269435">go</span>&nbsp;<span class="keyword" id="7269438">func</span><span class="op" id="7269442">(</span><span class="op" id="7269443">)</span>&nbsp;<span class="op" id="7269445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7269449">var</span>&nbsp;<span class="ident" id="7269453">err</span>&nbsp;<span class="builtintype" id="7269457">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7269465">if</span>&nbsp;<span class="ident" id="7269468">_</span><span class="op" id="7269469">,</span>&nbsp;<span class="ident" id="7269471">err</span>&nbsp;<span class="op" id="7269475">=</span>&nbsp;<span class="ident" id="7269477">server</span><span class="op" id="7269483">.</span><span class="ident" id="7269484">Write</span><span class="op" id="7269489">(</span><span class="op" id="7269490">[</span><span class="op" id="7269491">]</span><span class="builtintype" id="7269492">byte</span><span class="op" id="7269496">(</span><span class="string" id="7269497">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="7269513">)</span><span class="op" id="7269514">)</span><span class="op" id="7269515">;</span>&nbsp;<span class="ident" id="7269517">err</span>&nbsp;<span class="op" id="7269521">!=</span>&nbsp;<span class="ident" id="7269524">nil</span>&nbsp;<span class="op" id="7269528">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7269533">t</span><span class="op" id="7269534">.</span><span class="ident" id="7269535">Logf</span><span class="op" id="7269539">(</span><span class="string" id="7269540">&#34;Error&nbsp;from&nbsp;Server.Write:&nbsp;%s&#34;</span><span class="op" id="7269569">,</span>&nbsp;<span class="ident" id="7269571">err</span><span class="op" id="7269574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7269578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7269582">if</span>&nbsp;<span class="builtinfunc" id="7269585">len</span><span class="op" id="7269588">(</span><span class="ident" id="7269589">test</span><span class="op" id="7269593">.</span><span class="ident" id="7269594">expectHandshakeErrorIncluding</span><span class="op" id="7269623">)</span>&nbsp;<span class="op" id="7269625">&gt;</span>&nbsp;<span class="num" id="7269627">0</span>&nbsp;<span class="op" id="7269629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7269634">if</span>&nbsp;<span class="ident" id="7269637">err</span>&nbsp;<span class="op" id="7269641">==</span>&nbsp;<span class="ident" id="7269644">nil</span>&nbsp;<span class="op" id="7269648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7269654">t</span><span class="op" id="7269655">.</span><span class="ident" id="7269656">Errorf</span><span class="op" id="7269662">(</span><span class="string" id="7269663">&#34;Error&nbsp;expected,&nbsp;but&nbsp;no&nbsp;error&nbsp;returned&#34;</span><span class="op" id="7269702">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7269707">}</span>&nbsp;<span class="keyword" id="7269709">else</span>&nbsp;<span class="keyword" id="7269714">if</span>&nbsp;<span class="ident" id="7269717">s</span>&nbsp;<span class="op" id="7269719">:=</span>&nbsp;<span class="ident" id="7269722">err</span><span class="op" id="7269725">.</span><span class="ident" id="7269726">Error</span><span class="op" id="7269731">(</span><span class="op" id="7269732">)</span><span class="op" id="7269733">;</span>&nbsp;<span class="op" id="7269735">!</span><span class="ident" id="7269736">strings</span><span class="op" id="7269743">.</span><span class="ident" id="7269744">Contains</span><span class="op" id="7269752">(</span><span class="ident" id="7269753">s</span><span class="op" id="7269754">,</span>&nbsp;<span class="ident" id="7269756">test</span><span class="op" id="7269760">.</span><span class="ident" id="7269761">expectHandshakeErrorIncluding</span><span class="op" id="7269790">)</span>&nbsp;<span class="op" id="7269792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7269798">t</span><span class="op" id="7269799">.</span><span class="ident" id="7269800">Errorf</span><span class="op" id="7269806">(</span><span class="string" id="7269807">&#34;Error&nbsp;expected&nbsp;containing&nbsp;&#39;%s&#39;&nbsp;but&nbsp;got&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="7269852">,</span>&nbsp;<span class="ident" id="7269854">test</span><span class="op" id="7269858">.</span><span class="ident" id="7269859">expectHandshakeErrorIncluding</span><span class="op" id="7269888">,</span>&nbsp;<span class="ident" id="7269890">s</span><span class="op" id="7269891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7269896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7269900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7269904">server</span><span class="op" id="7269910">.</span><span class="ident" id="7269911">Close</span><span class="op" id="7269916">(</span><span class="op" id="7269917">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7269921">serverConn</span><span class="op" id="7269931">.</span><span class="ident" id="7269932">Close</span><span class="op" id="7269937">(</span><span class="op" id="7269938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7269942">connStateChan</span>&nbsp;<span class="op" id="7269956">&lt;-</span>&nbsp;<span class="ident" id="7269959">server</span><span class="op" id="7269965">.</span><span class="ident" id="7269966">ConnectionState</span><span class="op" id="7269981">(</span><span class="op" id="7269982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7269985">}</span><span class="op" id="7269986">(</span><span class="op" id="7269987">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7269991">if</span>&nbsp;<span class="op" id="7269994">!</span><span class="ident" id="7269995">write</span>&nbsp;<span class="op" id="7270001">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7270005">flows</span><span class="op" id="7270010">,</span>&nbsp;<span class="ident" id="7270012">err</span>&nbsp;<span class="op" id="7270016">:=</span>&nbsp;<span class="ident" id="7270019">test</span><span class="op" id="7270023">.</span><span class="ident" id="7270024">loadData</span><span class="op" id="7270032">(</span><span class="op" id="7270033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7270037">if</span>&nbsp;<span class="ident" id="7270040">err</span>&nbsp;<span class="op" id="7270044">!=</span>&nbsp;<span class="ident" id="7270047">nil</span>&nbsp;<span class="op" id="7270051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7270056">if</span>&nbsp;<span class="op" id="7270059">!</span><span class="ident" id="7270060">test</span><span class="op" id="7270064">.</span><span class="ident" id="7270065">expectAlert</span>&nbsp;<span class="op" id="7270077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7270083">t</span><span class="op" id="7270084">.</span><span class="ident" id="7270085">Fatalf</span><span class="op" id="7270091">(</span><span class="string" id="7270092">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s&#34;</span><span class="op" id="7270125">,</span>&nbsp;<span class="ident" id="7270127">test</span><span class="op" id="7270131">.</span><span class="ident" id="7270132">name</span><span class="op" id="7270136">,</span>&nbsp;<span class="ident" id="7270138">test</span><span class="op" id="7270142">.</span><span class="ident" id="7270143">dataPath</span><span class="op" id="7270151">(</span><span class="op" id="7270152">)</span><span class="op" id="7270153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7270158">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7270162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7270166">for</span>&nbsp;<span class="ident" id="7270170">i</span><span class="op" id="7270171">,</span>&nbsp;<span class="ident" id="7270173">b</span>&nbsp;<span class="op" id="7270175">:=</span>&nbsp;<span class="keyword" id="7270178">range</span>&nbsp;<span class="ident" id="7270184">flows</span>&nbsp;<span class="op" id="7270190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7270195">if</span>&nbsp;<span class="ident" id="7270198">i</span><span class="op" id="7270199">%</span><span class="num" id="7270200">2</span>&nbsp;<span class="op" id="7270202">==</span>&nbsp;<span class="num" id="7270205">0</span>&nbsp;<span class="op" id="7270207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7270213">clientConn</span><span class="op" id="7270223">.</span><span class="ident" id="7270224">Write</span><span class="op" id="7270229">(</span><span class="ident" id="7270230">b</span><span class="op" id="7270231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7270237">continue</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7270249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7270254">bb</span>&nbsp;<span class="op" id="7270257">:=</span>&nbsp;<span class="builtinfunc" id="7270260">make</span><span class="op" id="7270264">(</span><span class="op" id="7270265">[</span><span class="op" id="7270266">]</span><span class="builtintype" id="7270267">byte</span><span class="op" id="7270271">,</span>&nbsp;<span class="builtinfunc" id="7270273">len</span><span class="op" id="7270276">(</span><span class="ident" id="7270277">b</span><span class="op" id="7270278">)</span><span class="op" id="7270279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7270284">n</span><span class="op" id="7270285">,</span>&nbsp;<span class="ident" id="7270287">err</span>&nbsp;<span class="op" id="7270291">:=</span>&nbsp;<span class="ident" id="7270294">io</span><span class="op" id="7270296">.</span><span class="ident" id="7270297">ReadFull</span><span class="op" id="7270305">(</span><span class="ident" id="7270306">clientConn</span><span class="op" id="7270316">,</span>&nbsp;<span class="ident" id="7270318">bb</span><span class="op" id="7270320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7270325">if</span>&nbsp;<span class="ident" id="7270328">test</span><span class="op" id="7270332">.</span><span class="ident" id="7270333">expectAlert</span>&nbsp;<span class="op" id="7270345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7270351">if</span>&nbsp;<span class="ident" id="7270354">err</span>&nbsp;<span class="op" id="7270358">==</span>&nbsp;<span class="ident" id="7270361">nil</span>&nbsp;<span class="op" id="7270365">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7270372">t</span><span class="op" id="7270373">.</span><span class="ident" id="7270374">Fatal</span><span class="op" id="7270379">(</span><span class="string" id="7270380">&#34;Expected&nbsp;read&nbsp;failure&nbsp;but&nbsp;read&nbsp;succeeded&#34;</span><span class="op" id="7270422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7270428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7270433">}</span>&nbsp;<span class="keyword" id="7270435">else</span>&nbsp;<span class="op" id="7270440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7270446">if</span>&nbsp;<span class="ident" id="7270449">err</span>&nbsp;<span class="op" id="7270453">!=</span>&nbsp;<span class="ident" id="7270456">nil</span>&nbsp;<span class="op" id="7270460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7270467">t</span><span class="op" id="7270468">.</span><span class="ident" id="7270469">Fatalf</span><span class="op" id="7270475">(</span><span class="string" id="7270476">&#34;%s&nbsp;#%d:&nbsp;%s\nRead&nbsp;%d,&nbsp;wanted&nbsp;%d,&nbsp;got&nbsp;%x,&nbsp;wanted&nbsp;%x\n&#34;</span><span class="op" id="7270529">,</span>&nbsp;<span class="ident" id="7270531">test</span><span class="op" id="7270535">.</span><span class="ident" id="7270536">name</span><span class="op" id="7270540">,</span>&nbsp;<span class="ident" id="7270542">i</span><span class="op" id="7270543">+</span><span class="num" id="7270544">1</span><span class="op" id="7270545">,</span>&nbsp;<span class="ident" id="7270547">err</span><span class="op" id="7270550">,</span>&nbsp;<span class="ident" id="7270552">n</span><span class="op" id="7270553">,</span>&nbsp;<span class="builtinfunc" id="7270555">len</span><span class="op" id="7270558">(</span><span class="ident" id="7270559">bb</span><span class="op" id="7270561">)</span><span class="op" id="7270562">,</span>&nbsp;<span class="ident" id="7270564">bb</span><span class="op" id="7270566">[</span><span class="op" id="7270567">:</span><span class="ident" id="7270568">n</span><span class="op" id="7270569">]</span><span class="op" id="7270570">,</span>&nbsp;<span class="ident" id="7270572">b</span><span class="op" id="7270573">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7270579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7270585">if</span>&nbsp;<span class="op" id="7270588">!</span><span class="ident" id="7270589">bytes</span><span class="op" id="7270594">.</span><span class="ident" id="7270595">Equal</span><span class="op" id="7270600">(</span><span class="ident" id="7270601">b</span><span class="op" id="7270602">,</span>&nbsp;<span class="ident" id="7270604">bb</span><span class="op" id="7270606">)</span>&nbsp;<span class="op" id="7270608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7270615">t</span><span class="op" id="7270616">.</span><span class="ident" id="7270617">Fatalf</span><span class="op" id="7270623">(</span><span class="string" id="7270624">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="7270666">,</span>&nbsp;<span class="ident" id="7270668">test</span><span class="op" id="7270672">.</span><span class="ident" id="7270673">name</span><span class="op" id="7270677">,</span>&nbsp;<span class="ident" id="7270679">i</span><span class="op" id="7270680">+</span><span class="num" id="7270681">1</span><span class="op" id="7270682">,</span>&nbsp;<span class="ident" id="7270684">bb</span><span class="op" id="7270686">,</span>&nbsp;<span class="ident" id="7270688">b</span><span class="op" id="7270689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7270695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7270700">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7270704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7270708">clientConn</span><span class="op" id="7270718">.</span><span class="ident" id="7270719">Close</span><span class="op" id="7270724">(</span><span class="op" id="7270725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7270728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7270732">connState</span>&nbsp;<span class="op" id="7270742">:=</span>&nbsp;<span class="op" id="7270745">&lt;-</span><span class="ident" id="7270747">connStateChan</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7270762">peerCerts</span>&nbsp;<span class="op" id="7270772">:=</span>&nbsp;<span class="ident" id="7270775">connState</span><span class="op" id="7270784">.</span><span class="ident" id="7270785">PeerCertificates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7270803">if</span>&nbsp;<span class="builtinfunc" id="7270806">len</span><span class="op" id="7270809">(</span><span class="ident" id="7270810">peerCerts</span><span class="op" id="7270819">)</span>&nbsp;<span class="op" id="7270821">==</span>&nbsp;<span class="builtinfunc" id="7270824">len</span><span class="op" id="7270827">(</span><span class="ident" id="7270828">test</span><span class="op" id="7270832">.</span><span class="ident" id="7270833">expectedPeerCerts</span><span class="op" id="7270850">)</span>&nbsp;<span class="op" id="7270852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7270856">for</span>&nbsp;<span class="ident" id="7270860">i</span><span class="op" id="7270861">,</span>&nbsp;<span class="ident" id="7270863">peerCert</span>&nbsp;<span class="op" id="7270872">:=</span>&nbsp;<span class="keyword" id="7270875">range</span>&nbsp;<span class="ident" id="7270881">peerCerts</span>&nbsp;<span class="op" id="7270891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7270896">block</span><span class="op" id="7270901">,</span>&nbsp;<span class="ident" id="7270903">_</span>&nbsp;<span class="op" id="7270905">:=</span>&nbsp;<span class="ident" id="7270908">pem</span><span class="op" id="7270911">.</span><span class="ident" id="7270912">Decode</span><span class="op" id="7270918">(</span><span class="op" id="7270919">[</span><span class="op" id="7270920">]</span><span class="builtintype" id="7270921">byte</span><span class="op" id="7270925">(</span><span class="ident" id="7270926">test</span><span class="op" id="7270930">.</span><span class="ident" id="7270931">expectedPeerCerts</span><span class="op" id="7270948">[</span><span class="ident" id="7270949">i</span><span class="op" id="7270950">]</span><span class="op" id="7270951">)</span><span class="op" id="7270952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7270957">if</span>&nbsp;<span class="op" id="7270960">!</span><span class="ident" id="7270961">bytes</span><span class="op" id="7270966">.</span><span class="ident" id="7270967">Equal</span><span class="op" id="7270972">(</span><span class="ident" id="7270973">block</span><span class="op" id="7270978">.</span><span class="ident" id="7270979">Bytes</span><span class="op" id="7270984">,</span>&nbsp;<span class="ident" id="7270986">peerCert</span><span class="op" id="7270994">.</span><span class="ident" id="7270995">Raw</span><span class="op" id="7270998">)</span>&nbsp;<span class="op" id="7271000">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7271006">t</span><span class="op" id="7271007">.</span><span class="ident" id="7271008">Fatalf</span><span class="op" id="7271014">(</span><span class="string" id="7271015">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;cert&nbsp;%d&#34;</span><span class="op" id="7271045">,</span>&nbsp;<span class="ident" id="7271047">test</span><span class="op" id="7271051">.</span><span class="ident" id="7271052">name</span><span class="op" id="7271056">,</span>&nbsp;<span class="ident" id="7271058">i</span><span class="op" id="7271059">+</span><span class="num" id="7271060">1</span><span class="op" id="7271061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7271066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7271070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7271073">}</span>&nbsp;<span class="keyword" id="7271075">else</span>&nbsp;<span class="op" id="7271080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7271084">t</span><span class="op" id="7271085">.</span><span class="ident" id="7271086">Fatalf</span><span class="op" id="7271092">(</span><span class="string" id="7271093">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;list&nbsp;length:&nbsp;%d&nbsp;(wanted)&nbsp;!=&nbsp;%d&nbsp;(got)&#34;</span><span class="op" id="7271152">,</span>&nbsp;<span class="ident" id="7271154">test</span><span class="op" id="7271158">.</span><span class="ident" id="7271159">name</span><span class="op" id="7271163">,</span>&nbsp;<span class="builtinfunc" id="7271165">len</span><span class="op" id="7271168">(</span><span class="ident" id="7271169">test</span><span class="op" id="7271173">.</span><span class="ident" id="7271174">expectedPeerCerts</span><span class="op" id="7271191">)</span><span class="op" id="7271192">,</span>&nbsp;<span class="builtinfunc" id="7271194">len</span><span class="op" id="7271197">(</span><span class="ident" id="7271198">peerCerts</span><span class="op" id="7271207">)</span><span class="op" id="7271208">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7271211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7271215">if</span>&nbsp;<span class="ident" id="7271218">test</span><span class="op" id="7271222">.</span><span class="ident" id="7271223">validate</span>&nbsp;<span class="op" id="7271232">!=</span>&nbsp;<span class="ident" id="7271235">nil</span>&nbsp;<span class="op" id="7271239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7271243">if</span>&nbsp;<span class="ident" id="7271246">err</span>&nbsp;<span class="op" id="7271250">:=</span>&nbsp;<span class="ident" id="7271253">test</span><span class="op" id="7271257">.</span><span class="ident" id="7271258">validate</span><span class="op" id="7271266">(</span><span class="ident" id="7271267">connState</span><span class="op" id="7271276">)</span><span class="op" id="7271277">;</span>&nbsp;<span class="ident" id="7271279">err</span>&nbsp;<span class="op" id="7271283">!=</span>&nbsp;<span class="ident" id="7271286">nil</span>&nbsp;<span class="op" id="7271290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7271295">t</span><span class="op" id="7271296">.</span><span class="ident" id="7271297">Fatalf</span><span class="op" id="7271303">(</span><span class="string" id="7271304">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7271342">,</span>&nbsp;<span class="ident" id="7271344">err</span><span class="op" id="7271347">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7271351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7271354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7271358">if</span>&nbsp;<span class="ident" id="7271361">write</span>&nbsp;<span class="op" id="7271367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7271371">path</span>&nbsp;<span class="op" id="7271376">:=</span>&nbsp;<span class="ident" id="7271379">test</span><span class="op" id="7271383">.</span><span class="ident" id="7271384">dataPath</span><span class="op" id="7271392">(</span><span class="op" id="7271393">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7271397">out</span><span class="op" id="7271400">,</span>&nbsp;<span class="ident" id="7271402">err</span>&nbsp;<span class="op" id="7271406">:=</span>&nbsp;<span class="ident" id="7271409">os</span><span class="op" id="7271411">.</span><span class="ident" id="7271412">OpenFile</span><span class="op" id="7271420">(</span><span class="ident" id="7271421">path</span><span class="op" id="7271425">,</span>&nbsp;<span class="ident" id="7271427">os</span><span class="op" id="7271429">.</span><span class="ident" id="7271430">O_WRONLY</span><span class="op" id="7271438">|</span><span class="ident" id="7271439">os</span><span class="op" id="7271441">.</span><span class="ident" id="7271442">O_CREATE</span><span class="op" id="7271450">|</span><span class="ident" id="7271451">os</span><span class="op" id="7271453">.</span><span class="ident" id="7271454">O_TRUNC</span><span class="op" id="7271461">,</span>&nbsp;<span class="num" id="7271463">0644</span><span class="op" id="7271467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7271471">if</span>&nbsp;<span class="ident" id="7271474">err</span>&nbsp;<span class="op" id="7271478">!=</span>&nbsp;<span class="ident" id="7271481">nil</span>&nbsp;<span class="op" id="7271485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7271490">t</span><span class="op" id="7271491">.</span><span class="ident" id="7271492">Fatalf</span><span class="op" id="7271498">(</span><span class="string" id="7271499">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="7271533">,</span>&nbsp;<span class="ident" id="7271535">err</span><span class="op" id="7271538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7271542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7271546">defer</span>&nbsp;<span class="ident" id="7271552">out</span><span class="op" id="7271555">.</span><span class="ident" id="7271556">Close</span><span class="op" id="7271561">(</span><span class="op" id="7271562">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7271566">recordingConn</span><span class="op" id="7271579">.</span><span class="ident" id="7271580">Close</span><span class="op" id="7271585">(</span><span class="op" id="7271586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7271590">if</span>&nbsp;<span class="builtinfunc" id="7271593">len</span><span class="op" id="7271596">(</span><span class="ident" id="7271597">recordingConn</span><span class="op" id="7271610">.</span><span class="ident" id="7271611">flows</span><span class="op" id="7271616">)</span>&nbsp;<span class="op" id="7271618">&lt;</span>&nbsp;<span class="num" id="7271620">3</span>&nbsp;<span class="op" id="7271622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7271627">childProcess</span><span class="op" id="7271639">.</span><span class="ident" id="7271640">Stdout</span><span class="op" id="7271646">.</span><span class="op" id="7271647">(</span><span class="op" id="7271648">*</span><span class="ident" id="7271649">bytes</span><span class="op" id="7271654">.</span><span class="ident" id="7271655">Buffer</span><span class="op" id="7271661">)</span><span class="op" id="7271662">.</span><span class="ident" id="7271663">WriteTo</span><span class="op" id="7271670">(</span><span class="ident" id="7271671">os</span><span class="op" id="7271673">.</span><span class="ident" id="7271674">Stdout</span><span class="op" id="7271680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7271685">if</span>&nbsp;<span class="builtinfunc" id="7271688">len</span><span class="op" id="7271691">(</span><span class="ident" id="7271692">test</span><span class="op" id="7271696">.</span><span class="ident" id="7271697">expectHandshakeErrorIncluding</span><span class="op" id="7271726">)</span>&nbsp;<span class="op" id="7271728">==</span>&nbsp;<span class="num" id="7271731">0</span>&nbsp;<span class="op" id="7271733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7271739">t</span><span class="op" id="7271740">.</span><span class="ident" id="7271741">Fatalf</span><span class="op" id="7271747">(</span><span class="string" id="7271748">&#34;Handshake&nbsp;failed&#34;</span><span class="op" id="7271766">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7271771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7271775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7271779">recordingConn</span><span class="op" id="7271792">.</span><span class="ident" id="7271793">WriteTo</span><span class="op" id="7271800">(</span><span class="ident" id="7271801">out</span><span class="op" id="7271804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7271808">fmt</span><span class="op" id="7271811">.</span><span class="ident" id="7271812">Printf</span><span class="op" id="7271818">(</span><span class="string" id="7271819">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="7271831">,</span>&nbsp;<span class="ident" id="7271833">path</span><span class="op" id="7271837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7271841">childProcess</span><span class="op" id="7271853">.</span><span class="ident" id="7271854">Wait</span><span class="op" id="7271858">(</span><span class="op" id="7271859">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7271862">}</span><br>
<span class="lineno"></span><span class="op" id="7271864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7271867">func</span>&nbsp;<span class="ident" id="7271872">runServerTestForVersion</span><span class="op" id="7271895">(</span><span class="ident" id="7271896">t</span>&nbsp;<span class="op" id="7271898">*</span><span class="ident" id="7271899">testing</span><span class="op" id="7271906">.</span><span class="ident" id="7271907">T</span><span class="op" id="7271908">,</span>&nbsp;<span class="ident" id="7271910">template</span>&nbsp;<span class="op" id="7271919">*</span><span class="ident" id="7271920">serverTest</span><span class="op" id="7271930">,</span>&nbsp;<span class="ident" id="7271932">prefix</span><span class="op" id="7271938">,</span>&nbsp;<span class="ident" id="7271940">option</span>&nbsp;<span class="builtintype" id="7271947">string</span><span class="op" id="7271953">)</span>&nbsp;<span class="op" id="7271955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7271958">test</span>&nbsp;<span class="op" id="7271963">:=</span>&nbsp;<span class="op" id="7271966">*</span><span class="ident" id="7271967">template</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7271977">test</span><span class="op" id="7271981">.</span><span class="ident" id="7271982">name</span>&nbsp;<span class="op" id="7271987">=</span>&nbsp;<span class="ident" id="7271989">prefix</span>&nbsp;<span class="op" id="7271996">+</span>&nbsp;<span class="ident" id="7271998">test</span><span class="op" id="7272002">.</span><span class="ident" id="7272003">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7272009">if</span>&nbsp;<span class="builtinfunc" id="7272012">len</span><span class="op" id="7272015">(</span><span class="ident" id="7272016">test</span><span class="op" id="7272020">.</span><span class="ident" id="7272021">command</span><span class="op" id="7272028">)</span>&nbsp;<span class="op" id="7272030">==</span>&nbsp;<span class="num" id="7272033">0</span>&nbsp;<span class="op" id="7272035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272039">test</span><span class="op" id="7272043">.</span><span class="ident" id="7272044">command</span>&nbsp;<span class="op" id="7272052">=</span>&nbsp;<span class="ident" id="7272054">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7272076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272079">test</span><span class="op" id="7272083">.</span><span class="ident" id="7272084">command</span>&nbsp;<span class="op" id="7272092">=</span>&nbsp;<span class="builtinfunc" id="7272094">append</span><span class="op" id="7272100">(</span><span class="op" id="7272101">[</span><span class="op" id="7272102">]</span><span class="builtintype" id="7272103">string</span><span class="op" id="7272109">(</span><span class="ident" id="7272110">nil</span><span class="op" id="7272113">)</span><span class="op" id="7272114">,</span>&nbsp;<span class="ident" id="7272116">test</span><span class="op" id="7272120">.</span><span class="ident" id="7272121">command</span><span class="op" id="7272128">...</span><span class="op" id="7272131">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272134">test</span><span class="op" id="7272138">.</span><span class="ident" id="7272139">command</span>&nbsp;<span class="op" id="7272147">=</span>&nbsp;<span class="builtinfunc" id="7272149">append</span><span class="op" id="7272155">(</span><span class="ident" id="7272156">test</span><span class="op" id="7272160">.</span><span class="ident" id="7272161">command</span><span class="op" id="7272168">,</span>&nbsp;<span class="ident" id="7272170">option</span><span class="op" id="7272176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272179">test</span><span class="op" id="7272183">.</span><span class="ident" id="7272184">run</span><span class="op" id="7272187">(</span><span class="ident" id="7272188">t</span><span class="op" id="7272189">,</span>&nbsp;<span class="op" id="7272191">*</span><span class="ident" id="7272192">update</span><span class="op" id="7272198">)</span><br>
<span class="lineno"></span><span class="op" id="7272200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7272203">func</span>&nbsp;<span class="ident" id="7272208">runServerTestSSLv3</span><span class="op" id="7272226">(</span><span class="ident" id="7272227">t</span>&nbsp;<span class="op" id="7272229">*</span><span class="ident" id="7272230">testing</span><span class="op" id="7272237">.</span><span class="ident" id="7272238">T</span><span class="op" id="7272239">,</span>&nbsp;<span class="ident" id="7272241">template</span>&nbsp;<span class="op" id="7272250">*</span><span class="ident" id="7272251">serverTest</span><span class="op" id="7272261">)</span>&nbsp;<span class="op" id="7272263">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272266">runServerTestForVersion</span><span class="op" id="7272289">(</span><span class="ident" id="7272290">t</span><span class="op" id="7272291">,</span>&nbsp;<span class="ident" id="7272293">template</span><span class="op" id="7272301">,</span>&nbsp;<span class="string" id="7272303">&#34;SSLv3-&#34;</span><span class="op" id="7272311">,</span>&nbsp;<span class="string" id="7272313">&#34;-ssl3&#34;</span><span class="op" id="7272320">)</span><br>
<span class="lineno"></span><span class="op" id="7272322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7272325">func</span>&nbsp;<span class="ident" id="7272330">runServerTestTLS10</span><span class="op" id="7272348">(</span><span class="ident" id="7272349">t</span>&nbsp;<span class="op" id="7272351">*</span><span class="ident" id="7272352">testing</span><span class="op" id="7272359">.</span><span class="ident" id="7272360">T</span><span class="op" id="7272361">,</span>&nbsp;<span class="ident" id="7272363">template</span>&nbsp;<span class="op" id="7272372">*</span><span class="ident" id="7272373">serverTest</span><span class="op" id="7272383">)</span>&nbsp;<span class="op" id="7272385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272388">runServerTestForVersion</span><span class="op" id="7272411">(</span><span class="ident" id="7272412">t</span><span class="op" id="7272413">,</span>&nbsp;<span class="ident" id="7272415">template</span><span class="op" id="7272423">,</span>&nbsp;<span class="string" id="7272425">&#34;TLSv10-&#34;</span><span class="op" id="7272434">,</span>&nbsp;<span class="string" id="7272436">&#34;-tls1&#34;</span><span class="op" id="7272443">)</span><br>
<span class="lineno">470</span><span class="op" id="7272445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7272448">func</span>&nbsp;<span class="ident" id="7272453">runServerTestTLS11</span><span class="op" id="7272471">(</span><span class="ident" id="7272472">t</span>&nbsp;<span class="op" id="7272474">*</span><span class="ident" id="7272475">testing</span><span class="op" id="7272482">.</span><span class="ident" id="7272483">T</span><span class="op" id="7272484">,</span>&nbsp;<span class="ident" id="7272486">template</span>&nbsp;<span class="op" id="7272495">*</span><span class="ident" id="7272496">serverTest</span><span class="op" id="7272506">)</span>&nbsp;<span class="op" id="7272508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272511">runServerTestForVersion</span><span class="op" id="7272534">(</span><span class="ident" id="7272535">t</span><span class="op" id="7272536">,</span>&nbsp;<span class="ident" id="7272538">template</span><span class="op" id="7272546">,</span>&nbsp;<span class="string" id="7272548">&#34;TLSv11-&#34;</span><span class="op" id="7272557">,</span>&nbsp;<span class="string" id="7272559">&#34;-tls1_1&#34;</span><span class="op" id="7272568">)</span><br>
<span class="lineno"></span><span class="op" id="7272570">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="7272573">func</span>&nbsp;<span class="ident" id="7272578">runServerTestTLS12</span><span class="op" id="7272596">(</span><span class="ident" id="7272597">t</span>&nbsp;<span class="op" id="7272599">*</span><span class="ident" id="7272600">testing</span><span class="op" id="7272607">.</span><span class="ident" id="7272608">T</span><span class="op" id="7272609">,</span>&nbsp;<span class="ident" id="7272611">template</span>&nbsp;<span class="op" id="7272620">*</span><span class="ident" id="7272621">serverTest</span><span class="op" id="7272631">)</span>&nbsp;<span class="op" id="7272633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272636">runServerTestForVersion</span><span class="op" id="7272659">(</span><span class="ident" id="7272660">t</span><span class="op" id="7272661">,</span>&nbsp;<span class="ident" id="7272663">template</span><span class="op" id="7272671">,</span>&nbsp;<span class="string" id="7272673">&#34;TLSv12-&#34;</span><span class="op" id="7272682">,</span>&nbsp;<span class="string" id="7272684">&#34;-tls1_2&#34;</span><span class="op" id="7272693">)</span><br>
<span class="lineno"></span><span class="op" id="7272695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="7272698">func</span>&nbsp;<span class="ident" id="7272703">TestHandshakeServerRSARC4</span><span class="op" id="7272728">(</span><span class="ident" id="7272729">t</span>&nbsp;<span class="op" id="7272731">*</span><span class="ident" id="7272732">testing</span><span class="op" id="7272739">.</span><span class="ident" id="7272740">T</span><span class="op" id="7272741">)</span>&nbsp;<span class="op" id="7272743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272746">test</span>&nbsp;<span class="op" id="7272751">:=</span>&nbsp;<span class="op" id="7272754">&amp;</span><span class="ident" id="7272755">serverTest</span><span class="op" id="7272765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272769">name</span><span class="op" id="7272773">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7272778">&#34;RSA-RC4&#34;</span><span class="op" id="7272787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272791">command</span><span class="op" id="7272798">:</span>&nbsp;<span class="op" id="7272800">[</span><span class="op" id="7272801">]</span><span class="builtintype" id="7272802">string</span><span class="op" id="7272808">{</span><span class="string" id="7272809">&#34;openssl&#34;</span><span class="op" id="7272818">,</span>&nbsp;<span class="string" id="7272820">&#34;s_client&#34;</span><span class="op" id="7272830">,</span>&nbsp;<span class="string" id="7272832">&#34;-no_ticket&#34;</span><span class="op" id="7272844">,</span>&nbsp;<span class="string" id="7272846">&#34;-cipher&#34;</span><span class="op" id="7272855">,</span>&nbsp;<span class="string" id="7272857">&#34;RC4-SHA&#34;</span><span class="op" id="7272866">}</span><span class="op" id="7272867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7272870">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272873">runServerTestSSLv3</span><span class="op" id="7272891">(</span><span class="ident" id="7272892">t</span><span class="op" id="7272893">,</span>&nbsp;<span class="ident" id="7272895">test</span><span class="op" id="7272899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272902">runServerTestTLS10</span><span class="op" id="7272920">(</span><span class="ident" id="7272921">t</span><span class="op" id="7272922">,</span>&nbsp;<span class="ident" id="7272924">test</span><span class="op" id="7272928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272931">runServerTestTLS11</span><span class="op" id="7272949">(</span><span class="ident" id="7272950">t</span><span class="op" id="7272951">,</span>&nbsp;<span class="ident" id="7272953">test</span><span class="op" id="7272957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272960">runServerTestTLS12</span><span class="op" id="7272978">(</span><span class="ident" id="7272979">t</span><span class="op" id="7272980">,</span>&nbsp;<span class="ident" id="7272982">test</span><span class="op" id="7272986">)</span><br>
<span class="lineno"></span><span class="op" id="7272988">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="keyword" id="7272991">func</span>&nbsp;<span class="ident" id="7272996">TestHandshakeServerRSA3DES</span><span class="op" id="7273022">(</span><span class="ident" id="7273023">t</span>&nbsp;<span class="op" id="7273025">*</span><span class="ident" id="7273026">testing</span><span class="op" id="7273033">.</span><span class="ident" id="7273034">T</span><span class="op" id="7273035">)</span>&nbsp;<span class="op" id="7273037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273040">test</span>&nbsp;<span class="op" id="7273045">:=</span>&nbsp;<span class="op" id="7273048">&amp;</span><span class="ident" id="7273049">serverTest</span><span class="op" id="7273059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273063">name</span><span class="op" id="7273067">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7273072">&#34;RSA-3DES&#34;</span><span class="op" id="7273082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273086">command</span><span class="op" id="7273093">:</span>&nbsp;<span class="op" id="7273095">[</span><span class="op" id="7273096">]</span><span class="builtintype" id="7273097">string</span><span class="op" id="7273103">{</span><span class="string" id="7273104">&#34;openssl&#34;</span><span class="op" id="7273113">,</span>&nbsp;<span class="string" id="7273115">&#34;s_client&#34;</span><span class="op" id="7273125">,</span>&nbsp;<span class="string" id="7273127">&#34;-no_ticket&#34;</span><span class="op" id="7273139">,</span>&nbsp;<span class="string" id="7273141">&#34;-cipher&#34;</span><span class="op" id="7273150">,</span>&nbsp;<span class="string" id="7273152">&#34;DES-CBC3-SHA&#34;</span><span class="op" id="7273166">}</span><span class="op" id="7273167">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7273170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273173">runServerTestSSLv3</span><span class="op" id="7273191">(</span><span class="ident" id="7273192">t</span><span class="op" id="7273193">,</span>&nbsp;<span class="ident" id="7273195">test</span><span class="op" id="7273199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273202">runServerTestTLS10</span><span class="op" id="7273220">(</span><span class="ident" id="7273221">t</span><span class="op" id="7273222">,</span>&nbsp;<span class="ident" id="7273224">test</span><span class="op" id="7273228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273231">runServerTestTLS12</span><span class="op" id="7273249">(</span><span class="ident" id="7273250">t</span><span class="op" id="7273251">,</span>&nbsp;<span class="ident" id="7273253">test</span><span class="op" id="7273257">)</span><br>
<span class="lineno"></span><span class="op" id="7273259">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="7273262">func</span>&nbsp;<span class="ident" id="7273267">TestHandshakeServerRSAAES</span><span class="op" id="7273292">(</span><span class="ident" id="7273293">t</span>&nbsp;<span class="op" id="7273295">*</span><span class="ident" id="7273296">testing</span><span class="op" id="7273303">.</span><span class="ident" id="7273304">T</span><span class="op" id="7273305">)</span>&nbsp;<span class="op" id="7273307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273310">test</span>&nbsp;<span class="op" id="7273315">:=</span>&nbsp;<span class="op" id="7273318">&amp;</span><span class="ident" id="7273319">serverTest</span><span class="op" id="7273329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273333">name</span><span class="op" id="7273337">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7273342">&#34;RSA-AES&#34;</span><span class="op" id="7273351">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273355">command</span><span class="op" id="7273362">:</span>&nbsp;<span class="op" id="7273364">[</span><span class="op" id="7273365">]</span><span class="builtintype" id="7273366">string</span><span class="op" id="7273372">{</span><span class="string" id="7273373">&#34;openssl&#34;</span><span class="op" id="7273382">,</span>&nbsp;<span class="string" id="7273384">&#34;s_client&#34;</span><span class="op" id="7273394">,</span>&nbsp;<span class="string" id="7273396">&#34;-no_ticket&#34;</span><span class="op" id="7273408">,</span>&nbsp;<span class="string" id="7273410">&#34;-cipher&#34;</span><span class="op" id="7273419">,</span>&nbsp;<span class="string" id="7273421">&#34;AES128-SHA&#34;</span><span class="op" id="7273433">}</span><span class="op" id="7273434">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7273437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273440">runServerTestSSLv3</span><span class="op" id="7273458">(</span><span class="ident" id="7273459">t</span><span class="op" id="7273460">,</span>&nbsp;<span class="ident" id="7273462">test</span><span class="op" id="7273466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273469">runServerTestTLS10</span><span class="op" id="7273487">(</span><span class="ident" id="7273488">t</span><span class="op" id="7273489">,</span>&nbsp;<span class="ident" id="7273491">test</span><span class="op" id="7273495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273498">runServerTestTLS12</span><span class="op" id="7273516">(</span><span class="ident" id="7273517">t</span><span class="op" id="7273518">,</span>&nbsp;<span class="ident" id="7273520">test</span><span class="op" id="7273524">)</span><br>
<span class="lineno"></span><span class="op" id="7273526">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="keyword" id="7273529">func</span>&nbsp;<span class="ident" id="7273534">TestHandshakeServerAESGCM</span><span class="op" id="7273559">(</span><span class="ident" id="7273560">t</span>&nbsp;<span class="op" id="7273562">*</span><span class="ident" id="7273563">testing</span><span class="op" id="7273570">.</span><span class="ident" id="7273571">T</span><span class="op" id="7273572">)</span>&nbsp;<span class="op" id="7273574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273577">test</span>&nbsp;<span class="op" id="7273582">:=</span>&nbsp;<span class="op" id="7273585">&amp;</span><span class="ident" id="7273586">serverTest</span><span class="op" id="7273596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273600">name</span><span class="op" id="7273604">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7273609">&#34;RSA-AES-GCM&#34;</span><span class="op" id="7273622">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273626">command</span><span class="op" id="7273633">:</span>&nbsp;<span class="op" id="7273635">[</span><span class="op" id="7273636">]</span><span class="builtintype" id="7273637">string</span><span class="op" id="7273643">{</span><span class="string" id="7273644">&#34;openssl&#34;</span><span class="op" id="7273653">,</span>&nbsp;<span class="string" id="7273655">&#34;s_client&#34;</span><span class="op" id="7273665">,</span>&nbsp;<span class="string" id="7273667">&#34;-no_ticket&#34;</span><span class="op" id="7273679">,</span>&nbsp;<span class="string" id="7273681">&#34;-cipher&#34;</span><span class="op" id="7273690">,</span>&nbsp;<span class="string" id="7273692">&#34;ECDHE-RSA-AES128-GCM-SHA256&#34;</span><span class="op" id="7273721">}</span><span class="op" id="7273722">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7273725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273728">runServerTestTLS12</span><span class="op" id="7273746">(</span><span class="ident" id="7273747">t</span><span class="op" id="7273748">,</span>&nbsp;<span class="ident" id="7273750">test</span><span class="op" id="7273754">)</span><br>
<span class="lineno"></span><span class="op" id="7273756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7273759">func</span>&nbsp;<span class="ident" id="7273764">TestHandshakeServerECDHEECDSAAES</span><span class="op" id="7273796">(</span><span class="ident" id="7273797">t</span>&nbsp;<span class="op" id="7273799">*</span><span class="ident" id="7273800">testing</span><span class="op" id="7273807">.</span><span class="ident" id="7273808">T</span><span class="op" id="7273809">)</span>&nbsp;<span class="op" id="7273811">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273814">config</span>&nbsp;<span class="op" id="7273821">:=</span>&nbsp;<span class="op" id="7273824">*</span><span class="ident" id="7273825">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273837">config</span><span class="op" id="7273843">.</span><span class="ident" id="7273844">Certificates</span>&nbsp;<span class="op" id="7273857">=</span>&nbsp;<span class="builtinfunc" id="7273859">make</span><span class="op" id="7273863">(</span><span class="op" id="7273864">[</span><span class="op" id="7273865">]</span><span class="ident" id="7273866">Certificate</span><span class="op" id="7273877">,</span>&nbsp;<span class="num" id="7273879">1</span><span class="op" id="7273880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273883">config</span><span class="op" id="7273889">.</span><span class="ident" id="7273890">Certificates</span><span class="op" id="7273902">[</span><span class="num" id="7273903">0</span><span class="op" id="7273904">]</span><span class="op" id="7273905">.</span><span class="ident" id="7273906">Certificate</span>&nbsp;<span class="op" id="7273918">=</span>&nbsp;<span class="op" id="7273920">[</span><span class="op" id="7273921">]</span><span class="op" id="7273922">[</span><span class="op" id="7273923">]</span><span class="builtintype" id="7273924">byte</span><span class="op" id="7273928">{</span><span class="ident" id="7273929">testECDSACertificate</span><span class="op" id="7273949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273952">config</span><span class="op" id="7273958">.</span><span class="ident" id="7273959">Certificates</span><span class="op" id="7273971">[</span><span class="num" id="7273972">0</span><span class="op" id="7273973">]</span><span class="op" id="7273974">.</span><span class="ident" id="7273975">PrivateKey</span>&nbsp;<span class="op" id="7273986">=</span>&nbsp;<span class="ident" id="7273988">testECDSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274009">config</span><span class="op" id="7274015">.</span><span class="ident" id="7274016">BuildNameToCertificate</span><span class="op" id="7274038">(</span><span class="op" id="7274039">)</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274043">test</span>&nbsp;<span class="op" id="7274048">:=</span>&nbsp;<span class="op" id="7274051">&amp;</span><span class="ident" id="7274052">serverTest</span><span class="op" id="7274062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274066">name</span><span class="op" id="7274070">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7274075">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="7274092">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274096">command</span><span class="op" id="7274103">:</span>&nbsp;<span class="op" id="7274105">[</span><span class="op" id="7274106">]</span><span class="builtintype" id="7274107">string</span><span class="op" id="7274113">{</span><span class="string" id="7274114">&#34;openssl&#34;</span><span class="op" id="7274123">,</span>&nbsp;<span class="string" id="7274125">&#34;s_client&#34;</span><span class="op" id="7274135">,</span>&nbsp;<span class="string" id="7274137">&#34;-no_ticket&#34;</span><span class="op" id="7274149">,</span>&nbsp;<span class="string" id="7274151">&#34;-cipher&#34;</span><span class="op" id="7274160">,</span>&nbsp;<span class="string" id="7274162">&#34;ECDHE-ECDSA-AES256-SHA&#34;</span><span class="op" id="7274186">}</span><span class="op" id="7274187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274191">config</span><span class="op" id="7274197">:</span>&nbsp;&nbsp;<span class="op" id="7274200">&amp;</span><span class="ident" id="7274201">config</span><span class="op" id="7274207">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7274210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274213">runServerTestTLS10</span><span class="op" id="7274231">(</span><span class="ident" id="7274232">t</span><span class="op" id="7274233">,</span>&nbsp;<span class="ident" id="7274235">test</span><span class="op" id="7274239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274242">runServerTestTLS12</span><span class="op" id="7274260">(</span><span class="ident" id="7274261">t</span><span class="op" id="7274262">,</span>&nbsp;<span class="ident" id="7274264">test</span><span class="op" id="7274268">)</span><br>
<span class="lineno"></span><span class="op" id="7274270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="7274273">func</span>&nbsp;<span class="ident" id="7274278">TestHandshakeServerALPN</span><span class="op" id="7274301">(</span><span class="ident" id="7274302">t</span>&nbsp;<span class="op" id="7274304">*</span><span class="ident" id="7274305">testing</span><span class="op" id="7274312">.</span><span class="ident" id="7274313">T</span><span class="op" id="7274314">)</span>&nbsp;<span class="op" id="7274316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274319">config</span>&nbsp;<span class="op" id="7274326">:=</span>&nbsp;<span class="op" id="7274329">*</span><span class="ident" id="7274330">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274342">config</span><span class="op" id="7274348">.</span><span class="ident" id="7274349">NextProtos</span>&nbsp;<span class="op" id="7274360">=</span>&nbsp;<span class="op" id="7274362">[</span><span class="op" id="7274363">]</span><span class="builtintype" id="7274364">string</span><span class="op" id="7274370">{</span><span class="string" id="7274371">&#34;proto1&#34;</span><span class="op" id="7274379">,</span>&nbsp;<span class="string" id="7274381">&#34;proto2&#34;</span><span class="op" id="7274389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274393">test</span>&nbsp;<span class="op" id="7274398">:=</span>&nbsp;<span class="op" id="7274401">&amp;</span><span class="ident" id="7274402">serverTest</span><span class="op" id="7274412">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274416">name</span><span class="op" id="7274420">:</span>&nbsp;<span class="string" id="7274422">&#34;ALPN&#34;</span><span class="op" id="7274428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7274432">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7274498">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274541">command</span><span class="op" id="7274548">:</span>&nbsp;<span class="op" id="7274550">[</span><span class="op" id="7274551">]</span><span class="builtintype" id="7274552">string</span><span class="op" id="7274558">{</span><span class="string" id="7274559">&#34;openssl&#34;</span><span class="op" id="7274568">,</span>&nbsp;<span class="string" id="7274570">&#34;s_client&#34;</span><span class="op" id="7274580">,</span>&nbsp;<span class="string" id="7274582">&#34;-alpn&#34;</span><span class="op" id="7274589">,</span>&nbsp;<span class="string" id="7274591">&#34;proto2,proto1&#34;</span><span class="op" id="7274606">}</span><span class="op" id="7274607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274611">config</span><span class="op" id="7274617">:</span>&nbsp;&nbsp;<span class="op" id="7274620">&amp;</span><span class="ident" id="7274621">config</span><span class="op" id="7274627">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274631">validate</span><span class="op" id="7274639">:</span>&nbsp;<span class="keyword" id="7274641">func</span><span class="op" id="7274645">(</span><span class="ident" id="7274646">state</span>&nbsp;<span class="ident" id="7274652">ConnectionState</span><span class="op" id="7274667">)</span>&nbsp;<span class="builtintype" id="7274669">error</span>&nbsp;<span class="op" id="7274675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7274680">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7274739">if</span>&nbsp;<span class="ident" id="7274742">state</span><span class="op" id="7274747">.</span><span class="ident" id="7274748">NegotiatedProtocol</span>&nbsp;<span class="op" id="7274767">!=</span>&nbsp;<span class="string" id="7274770">&#34;proto1&#34;</span>&nbsp;<span class="op" id="7274779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7274785">return</span>&nbsp;<span class="ident" id="7274792">fmt</span><span class="op" id="7274795">.</span><span class="ident" id="7274796">Errorf</span><span class="op" id="7274802">(</span><span class="string" id="7274803">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="7274835">,</span>&nbsp;<span class="ident" id="7274837">state</span><span class="op" id="7274842">.</span><span class="ident" id="7274843">NegotiatedProtocol</span><span class="op" id="7274861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7274866">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7274871">return</span>&nbsp;<span class="ident" id="7274878">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7274884">}</span><span class="op" id="7274885">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7274888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274891">runServerTestTLS12</span><span class="op" id="7274909">(</span><span class="ident" id="7274910">t</span><span class="op" id="7274911">,</span>&nbsp;<span class="ident" id="7274913">test</span><span class="op" id="7274917">)</span><br>
<span class="lineno"></span><span class="op" id="7274919">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="7274922">func</span>&nbsp;<span class="ident" id="7274927">TestHandshakeServerALPNNoMatch</span><span class="op" id="7274957">(</span><span class="ident" id="7274958">t</span>&nbsp;<span class="op" id="7274960">*</span><span class="ident" id="7274961">testing</span><span class="op" id="7274968">.</span><span class="ident" id="7274969">T</span><span class="op" id="7274970">)</span>&nbsp;<span class="op" id="7274972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274975">config</span>&nbsp;<span class="op" id="7274982">:=</span>&nbsp;<span class="op" id="7274985">*</span><span class="ident" id="7274986">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274998">config</span><span class="op" id="7275004">.</span><span class="ident" id="7275005">NextProtos</span>&nbsp;<span class="op" id="7275016">=</span>&nbsp;<span class="op" id="7275018">[</span><span class="op" id="7275019">]</span><span class="builtintype" id="7275020">string</span><span class="op" id="7275026">{</span><span class="string" id="7275027">&#34;proto3&#34;</span><span class="op" id="7275035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7275039">test</span>&nbsp;<span class="op" id="7275044">:=</span>&nbsp;<span class="op" id="7275047">&amp;</span><span class="ident" id="7275048">serverTest</span><span class="op" id="7275058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7275062">name</span><span class="op" id="7275066">:</span>&nbsp;<span class="string" id="7275068">&#34;ALPN-NoMatch&#34;</span><span class="op" id="7275082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7275086">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7275152">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7275195">command</span><span class="op" id="7275202">:</span>&nbsp;<span class="op" id="7275204">[</span><span class="op" id="7275205">]</span><span class="builtintype" id="7275206">string</span><span class="op" id="7275212">{</span><span class="string" id="7275213">&#34;openssl&#34;</span><span class="op" id="7275222">,</span>&nbsp;<span class="string" id="7275224">&#34;s_client&#34;</span><span class="op" id="7275234">,</span>&nbsp;<span class="string" id="7275236">&#34;-alpn&#34;</span><span class="op" id="7275243">,</span>&nbsp;<span class="string" id="7275245">&#34;proto2,proto1&#34;</span><span class="op" id="7275260">}</span><span class="op" id="7275261">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7275265">config</span><span class="op" id="7275271">:</span>&nbsp;&nbsp;<span class="op" id="7275274">&amp;</span><span class="ident" id="7275275">config</span><span class="op" id="7275281">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7275285">validate</span><span class="op" id="7275293">:</span>&nbsp;<span class="keyword" id="7275295">func</span><span class="op" id="7275299">(</span><span class="ident" id="7275300">state</span>&nbsp;<span class="ident" id="7275306">ConnectionState</span><span class="op" id="7275321">)</span>&nbsp;<span class="builtintype" id="7275323">error</span>&nbsp;<span class="op" id="7275329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7275334">//&nbsp;Rather&nbsp;than&nbsp;reject&nbsp;the&nbsp;connection,&nbsp;Go&nbsp;doesn&#39;t&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7275393">//&nbsp;a&nbsp;protocol&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;overlap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7275436">if</span>&nbsp;<span class="ident" id="7275439">state</span><span class="op" id="7275444">.</span><span class="ident" id="7275445">NegotiatedProtocol</span>&nbsp;<span class="op" id="7275464">!=</span>&nbsp;<span class="string" id="7275467">&#34;&#34;</span>&nbsp;<span class="op" id="7275470">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7275476">return</span>&nbsp;<span class="ident" id="7275483">fmt</span><span class="op" id="7275486">.</span><span class="ident" id="7275487">Errorf</span><span class="op" id="7275493">(</span><span class="string" id="7275494">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="7275522">,</span>&nbsp;<span class="ident" id="7275524">state</span><span class="op" id="7275529">.</span><span class="ident" id="7275530">NegotiatedProtocol</span><span class="op" id="7275548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7275553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7275558">return</span>&nbsp;<span class="ident" id="7275565">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7275571">}</span><span class="op" id="7275572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7275575">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7275578">runServerTestTLS12</span><span class="op" id="7275596">(</span><span class="ident" id="7275597">t</span><span class="op" id="7275598">,</span>&nbsp;<span class="ident" id="7275600">test</span><span class="op" id="7275604">)</span><br>
<span class="lineno"></span><span class="op" id="7275606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7275609">//&nbsp;TestHandshakeServerSNI&nbsp;involves&nbsp;a&nbsp;client&nbsp;sending&nbsp;an&nbsp;SNI&nbsp;extension&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="7275681">//&nbsp;&#34;snitest.com&#34;,&nbsp;which&nbsp;happens&nbsp;to&nbsp;match&nbsp;the&nbsp;CN&nbsp;of&nbsp;testSNICertificate.&nbsp;The&nbsp;test</span><br>
<span class="lineno">580</span><span class="comment" id="7275761">//&nbsp;verifies&nbsp;that&nbsp;the&nbsp;server&nbsp;correctly&nbsp;selects&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="7275825">func</span>&nbsp;<span class="ident" id="7275830">TestHandshakeServerSNI</span><span class="op" id="7275852">(</span><span class="ident" id="7275853">t</span>&nbsp;<span class="op" id="7275855">*</span><span class="ident" id="7275856">testing</span><span class="op" id="7275863">.</span><span class="ident" id="7275864">T</span><span class="op" id="7275865">)</span>&nbsp;<span class="op" id="7275867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7275870">test</span>&nbsp;<span class="op" id="7275875">:=</span>&nbsp;<span class="op" id="7275878">&amp;</span><span class="ident" id="7275879">serverTest</span><span class="op" id="7275889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7275893">name</span><span class="op" id="7275897">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7275902">&#34;SNI&#34;</span><span class="op" id="7275907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7275911">command</span><span class="op" id="7275918">:</span>&nbsp;<span class="op" id="7275920">[</span><span class="op" id="7275921">]</span><span class="builtintype" id="7275922">string</span><span class="op" id="7275928">{</span><span class="string" id="7275929">&#34;openssl&#34;</span><span class="op" id="7275938">,</span>&nbsp;<span class="string" id="7275940">&#34;s_client&#34;</span><span class="op" id="7275950">,</span>&nbsp;<span class="string" id="7275952">&#34;-no_ticket&#34;</span><span class="op" id="7275964">,</span>&nbsp;<span class="string" id="7275966">&#34;-cipher&#34;</span><span class="op" id="7275975">,</span>&nbsp;<span class="string" id="7275977">&#34;AES128-SHA&#34;</span><span class="op" id="7275989">,</span>&nbsp;<span class="string" id="7275991">&#34;-servername&#34;</span><span class="op" id="7276004">,</span>&nbsp;<span class="string" id="7276006">&#34;snitest.com&#34;</span><span class="op" id="7276019">}</span><span class="op" id="7276020">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7276023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7276026">runServerTestTLS12</span><span class="op" id="7276044">(</span><span class="ident" id="7276045">t</span><span class="op" id="7276046">,</span>&nbsp;<span class="ident" id="7276048">test</span><span class="op" id="7276052">)</span><br>
<span class="lineno"></span><span class="op" id="7276054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7276057">//&nbsp;TestHandshakeServerSNICertForName&nbsp;is&nbsp;similar&nbsp;to&nbsp;TestHandshakeServerSNI,&nbsp;but</span><br>
<span class="lineno">590</span><span class="comment" id="7276136">//&nbsp;tests&nbsp;the&nbsp;dynamic&nbsp;GetCertificate&nbsp;method</span><br>
<span class="lineno"></span><span class="keyword" id="7276179">func</span>&nbsp;<span class="ident" id="7276184">TestHandshakeServerSNIGetCertificate</span><span class="op" id="7276220">(</span><span class="ident" id="7276221">t</span>&nbsp;<span class="op" id="7276223">*</span><span class="ident" id="7276224">testing</span><span class="op" id="7276231">.</span><span class="ident" id="7276232">T</span><span class="op" id="7276233">)</span>&nbsp;<span class="op" id="7276235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7276238">config</span>&nbsp;<span class="op" id="7276245">:=</span>&nbsp;<span class="op" id="7276248">*</span><span class="ident" id="7276249">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7276262">//&nbsp;Replace&nbsp;the&nbsp;NameToCertificate&nbsp;map&nbsp;with&nbsp;a&nbsp;GetCertificate&nbsp;function</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7276331">nameToCert</span>&nbsp;<span class="op" id="7276342">:=</span>&nbsp;<span class="ident" id="7276345">config</span><span class="op" id="7276351">.</span><span class="ident" id="7276352">NameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7276371">config</span><span class="op" id="7276377">.</span><span class="ident" id="7276378">NameToCertificate</span>&nbsp;<span class="op" id="7276396">=</span>&nbsp;<span class="ident" id="7276398">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7276403">config</span><span class="op" id="7276409">.</span><span class="ident" id="7276410">GetCertificate</span>&nbsp;<span class="op" id="7276425">=</span>&nbsp;<span class="keyword" id="7276427">func</span><span class="op" id="7276431">(</span><span class="ident" id="7276432">clientHello</span>&nbsp;<span class="op" id="7276444">*</span><span class="ident" id="7276445">ClientHelloInfo</span><span class="op" id="7276460">)</span>&nbsp;<span class="op" id="7276462">(</span><span class="op" id="7276463">*</span><span class="ident" id="7276464">Certificate</span><span class="op" id="7276475">,</span>&nbsp;<span class="builtintype" id="7276477">error</span><span class="op" id="7276482">)</span>&nbsp;<span class="op" id="7276484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7276488">cert</span><span class="op" id="7276492">,</span>&nbsp;<span class="ident" id="7276494">_</span>&nbsp;<span class="op" id="7276496">:=</span>&nbsp;<span class="ident" id="7276499">nameToCert</span><span class="op" id="7276509">[</span><span class="ident" id="7276510">clientHello</span><span class="op" id="7276521">.</span><span class="ident" id="7276522">ServerName</span><span class="op" id="7276532">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7276536">return</span>&nbsp;<span class="ident" id="7276543">cert</span><span class="op" id="7276547">,</span>&nbsp;<span class="ident" id="7276549">nil</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7276554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7276557">test</span>&nbsp;<span class="op" id="7276562">:=</span>&nbsp;<span class="op" id="7276565">&amp;</span><span class="ident" id="7276566">serverTest</span><span class="op" id="7276576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7276580">name</span><span class="op" id="7276584">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7276589">&#34;SNI&#34;</span><span class="op" id="7276594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7276598">command</span><span class="op" id="7276605">:</span>&nbsp;<span class="op" id="7276607">[</span><span class="op" id="7276608">]</span><span class="builtintype" id="7276609">string</span><span class="op" id="7276615">{</span><span class="string" id="7276616">&#34;openssl&#34;</span><span class="op" id="7276625">,</span>&nbsp;<span class="string" id="7276627">&#34;s_client&#34;</span><span class="op" id="7276637">,</span>&nbsp;<span class="string" id="7276639">&#34;-no_ticket&#34;</span><span class="op" id="7276651">,</span>&nbsp;<span class="string" id="7276653">&#34;-cipher&#34;</span><span class="op" id="7276662">,</span>&nbsp;<span class="string" id="7276664">&#34;AES128-SHA&#34;</span><span class="op" id="7276676">,</span>&nbsp;<span class="string" id="7276678">&#34;-servername&#34;</span><span class="op" id="7276691">,</span>&nbsp;<span class="string" id="7276693">&#34;snitest.com&#34;</span><span class="op" id="7276706">}</span><span class="op" id="7276707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7276711">config</span><span class="op" id="7276717">:</span>&nbsp;&nbsp;<span class="op" id="7276720">&amp;</span><span class="ident" id="7276721">config</span><span class="op" id="7276727">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7276730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7276733">runServerTestTLS12</span><span class="op" id="7276751">(</span><span class="ident" id="7276752">t</span><span class="op" id="7276753">,</span>&nbsp;<span class="ident" id="7276755">test</span><span class="op" id="7276759">)</span><br>
<span class="lineno"></span><span class="op" id="7276761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7276764">//&nbsp;TestHandshakeServerSNICertForNameNotFound&nbsp;is&nbsp;similar&nbsp;to</span><br>
<span class="lineno">610</span><span class="comment" id="7276823">//&nbsp;TestHandshakeServerSNICertForName,&nbsp;but&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7276898">//&nbsp;GetCertificate&nbsp;method&nbsp;doesn&#39;t&nbsp;return&nbsp;a&nbsp;cert,&nbsp;we&nbsp;fall&nbsp;back&nbsp;to&nbsp;what&#39;s&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7276972">//&nbsp;the&nbsp;NameToCertificate&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="7277002">func</span>&nbsp;<span class="ident" id="7277007">TestHandshakeServerSNIGetCertificateNotFound</span><span class="op" id="7277051">(</span><span class="ident" id="7277052">t</span>&nbsp;<span class="op" id="7277054">*</span><span class="ident" id="7277055">testing</span><span class="op" id="7277062">.</span><span class="ident" id="7277063">T</span><span class="op" id="7277064">)</span>&nbsp;<span class="op" id="7277066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7277069">config</span>&nbsp;<span class="op" id="7277076">:=</span>&nbsp;<span class="op" id="7277079">*</span><span class="ident" id="7277080">testConfig</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7277093">config</span><span class="op" id="7277099">.</span><span class="ident" id="7277100">GetCertificate</span>&nbsp;<span class="op" id="7277115">=</span>&nbsp;<span class="keyword" id="7277117">func</span><span class="op" id="7277121">(</span><span class="ident" id="7277122">clientHello</span>&nbsp;<span class="op" id="7277134">*</span><span class="ident" id="7277135">ClientHelloInfo</span><span class="op" id="7277150">)</span>&nbsp;<span class="op" id="7277152">(</span><span class="op" id="7277153">*</span><span class="ident" id="7277154">Certificate</span><span class="op" id="7277165">,</span>&nbsp;<span class="builtintype" id="7277167">error</span><span class="op" id="7277172">)</span>&nbsp;<span class="op" id="7277174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7277178">return</span>&nbsp;<span class="ident" id="7277185">nil</span><span class="op" id="7277188">,</span>&nbsp;<span class="ident" id="7277190">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7277195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7277198">test</span>&nbsp;<span class="op" id="7277203">:=</span>&nbsp;<span class="op" id="7277206">&amp;</span><span class="ident" id="7277207">serverTest</span><span class="op" id="7277217">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7277221">name</span><span class="op" id="7277225">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7277230">&#34;SNI&#34;</span><span class="op" id="7277235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7277239">command</span><span class="op" id="7277246">:</span>&nbsp;<span class="op" id="7277248">[</span><span class="op" id="7277249">]</span><span class="builtintype" id="7277250">string</span><span class="op" id="7277256">{</span><span class="string" id="7277257">&#34;openssl&#34;</span><span class="op" id="7277266">,</span>&nbsp;<span class="string" id="7277268">&#34;s_client&#34;</span><span class="op" id="7277278">,</span>&nbsp;<span class="string" id="7277280">&#34;-no_ticket&#34;</span><span class="op" id="7277292">,</span>&nbsp;<span class="string" id="7277294">&#34;-cipher&#34;</span><span class="op" id="7277303">,</span>&nbsp;<span class="string" id="7277305">&#34;AES128-SHA&#34;</span><span class="op" id="7277317">,</span>&nbsp;<span class="string" id="7277319">&#34;-servername&#34;</span><span class="op" id="7277332">,</span>&nbsp;<span class="string" id="7277334">&#34;snitest.com&#34;</span><span class="op" id="7277347">}</span><span class="op" id="7277348">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7277352">config</span><span class="op" id="7277358">:</span>&nbsp;&nbsp;<span class="op" id="7277361">&amp;</span><span class="ident" id="7277362">config</span><span class="op" id="7277368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7277371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7277374">runServerTestTLS12</span><span class="op" id="7277392">(</span><span class="ident" id="7277393">t</span><span class="op" id="7277394">,</span>&nbsp;<span class="ident" id="7277396">test</span><span class="op" id="7277400">)</span><br>
<span class="lineno">625</span><span class="op" id="7277402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7277405">//&nbsp;TestHandshakeServerSNICertForNameError&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;errors&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7277481">//&nbsp;GetCertificate&nbsp;result&nbsp;in&nbsp;a&nbsp;tls&nbsp;alert.</span><br>
<span class="lineno"></span><span class="keyword" id="7277522">func</span>&nbsp;<span class="ident" id="7277527">TestHandshakeServerSNIGetCertificateError</span><span class="op" id="7277568">(</span><span class="ident" id="7277569">t</span>&nbsp;<span class="op" id="7277571">*</span><span class="ident" id="7277572">testing</span><span class="op" id="7277579">.</span><span class="ident" id="7277580">T</span><span class="op" id="7277581">)</span>&nbsp;<span class="op" id="7277583">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7277586">config</span>&nbsp;<span class="op" id="7277593">:=</span>&nbsp;<span class="op" id="7277596">*</span><span class="ident" id="7277597">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7277610">config</span><span class="op" id="7277616">.</span><span class="ident" id="7277617">GetCertificate</span>&nbsp;<span class="op" id="7277632">=</span>&nbsp;<span class="keyword" id="7277634">func</span><span class="op" id="7277638">(</span><span class="ident" id="7277639">clientHello</span>&nbsp;<span class="op" id="7277651">*</span><span class="ident" id="7277652">ClientHelloInfo</span><span class="op" id="7277667">)</span>&nbsp;<span class="op" id="7277669">(</span><span class="op" id="7277670">*</span><span class="ident" id="7277671">Certificate</span><span class="op" id="7277682">,</span>&nbsp;<span class="builtintype" id="7277684">error</span><span class="op" id="7277689">)</span>&nbsp;<span class="op" id="7277691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7277695">return</span>&nbsp;<span class="ident" id="7277702">nil</span><span class="op" id="7277705">,</span>&nbsp;<span class="ident" id="7277707">fmt</span><span class="op" id="7277710">.</span><span class="ident" id="7277711">Errorf</span><span class="op" id="7277717">(</span><span class="string" id="7277718">&#34;Test&nbsp;error&nbsp;in&nbsp;GetCertificate&#34;</span><span class="op" id="7277748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7277751">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7277754">test</span>&nbsp;<span class="op" id="7277759">:=</span>&nbsp;<span class="op" id="7277762">&amp;</span><span class="ident" id="7277763">serverTest</span><span class="op" id="7277773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7277777">name</span><span class="op" id="7277781">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7277790">&#34;SNI&#34;</span><span class="op" id="7277795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7277799">command</span><span class="op" id="7277806">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7277812">[</span><span class="op" id="7277813">]</span><span class="builtintype" id="7277814">string</span><span class="op" id="7277820">{</span><span class="string" id="7277821">&#34;openssl&#34;</span><span class="op" id="7277830">,</span>&nbsp;<span class="string" id="7277832">&#34;s_client&#34;</span><span class="op" id="7277842">,</span>&nbsp;<span class="string" id="7277844">&#34;-no_ticket&#34;</span><span class="op" id="7277856">,</span>&nbsp;<span class="string" id="7277858">&#34;-cipher&#34;</span><span class="op" id="7277867">,</span>&nbsp;<span class="string" id="7277869">&#34;AES128-SHA&#34;</span><span class="op" id="7277881">,</span>&nbsp;<span class="string" id="7277883">&#34;-servername&#34;</span><span class="op" id="7277896">,</span>&nbsp;<span class="string" id="7277898">&#34;snitest.com&#34;</span><span class="op" id="7277911">}</span><span class="op" id="7277912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7277916">config</span><span class="op" id="7277922">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7277929">&amp;</span><span class="ident" id="7277930">config</span><span class="op" id="7277936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7277940">expectAlert</span><span class="op" id="7277951">:</span>&nbsp;<span class="builtintype" id="7277953">true</span><span class="op" id="7277957">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7277960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7277963">runServerTestTLS12</span><span class="op" id="7277981">(</span><span class="ident" id="7277982">t</span><span class="op" id="7277983">,</span>&nbsp;<span class="ident" id="7277985">test</span><span class="op" id="7277989">)</span><br>
<span class="lineno"></span><span class="op" id="7277991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7277994">//&nbsp;TestCipherSuiteCertPreferance&nbsp;ensures&nbsp;that&nbsp;we&nbsp;select&nbsp;an&nbsp;RSA&nbsp;ciphersuite&nbsp;with</span><br>
<span class="lineno">645</span><span class="comment" id="7278074">//&nbsp;an&nbsp;RSA&nbsp;certificate&nbsp;and&nbsp;an&nbsp;ECDSA&nbsp;ciphersuite&nbsp;with&nbsp;an&nbsp;ECDSA&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="7278148">func</span>&nbsp;<span class="ident" id="7278153">TestCipherSuiteCertPreferenceECDSA</span><span class="op" id="7278187">(</span><span class="ident" id="7278188">t</span>&nbsp;<span class="op" id="7278190">*</span><span class="ident" id="7278191">testing</span><span class="op" id="7278198">.</span><span class="ident" id="7278199">T</span><span class="op" id="7278200">)</span>&nbsp;<span class="op" id="7278202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278205">config</span>&nbsp;<span class="op" id="7278212">:=</span>&nbsp;<span class="op" id="7278215">*</span><span class="ident" id="7278216">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278228">config</span><span class="op" id="7278234">.</span><span class="ident" id="7278235">CipherSuites</span>&nbsp;<span class="op" id="7278248">=</span>&nbsp;<span class="op" id="7278250">[</span><span class="op" id="7278251">]</span><span class="builtintype" id="7278252">uint16</span><span class="op" id="7278258">{</span><span class="ident" id="7278259">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7278295">,</span>&nbsp;<span class="ident" id="7278297">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7278331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278334">config</span><span class="op" id="7278340">.</span><span class="ident" id="7278341">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7278366">=</span>&nbsp;<span class="builtintype" id="7278368">true</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278375">test</span>&nbsp;<span class="op" id="7278380">:=</span>&nbsp;<span class="op" id="7278383">&amp;</span><span class="ident" id="7278384">serverTest</span><span class="op" id="7278394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278398">name</span><span class="op" id="7278402">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7278406">&#34;CipherSuiteCertPreferenceRSA&#34;</span><span class="op" id="7278436">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278440">config</span><span class="op" id="7278446">:</span>&nbsp;<span class="op" id="7278448">&amp;</span><span class="ident" id="7278449">config</span><span class="op" id="7278455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7278458">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278461">runServerTestTLS12</span><span class="op" id="7278479">(</span><span class="ident" id="7278480">t</span><span class="op" id="7278481">,</span>&nbsp;<span class="ident" id="7278483">test</span><span class="op" id="7278487">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278491">config</span>&nbsp;<span class="op" id="7278498">=</span>&nbsp;<span class="op" id="7278500">*</span><span class="ident" id="7278501">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278513">config</span><span class="op" id="7278519">.</span><span class="ident" id="7278520">CipherSuites</span>&nbsp;<span class="op" id="7278533">=</span>&nbsp;<span class="op" id="7278535">[</span><span class="op" id="7278536">]</span><span class="builtintype" id="7278537">uint16</span><span class="op" id="7278543">{</span><span class="ident" id="7278544">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7278578">,</span>&nbsp;<span class="ident" id="7278580">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7278616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278619">config</span><span class="op" id="7278625">.</span><span class="ident" id="7278626">Certificates</span>&nbsp;<span class="op" id="7278639">=</span>&nbsp;<span class="op" id="7278641">[</span><span class="op" id="7278642">]</span><span class="ident" id="7278643">Certificate</span><span class="op" id="7278654">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7278658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278663">Certificate</span><span class="op" id="7278674">:</span>&nbsp;<span class="op" id="7278676">[</span><span class="op" id="7278677">]</span><span class="op" id="7278678">[</span><span class="op" id="7278679">]</span><span class="builtintype" id="7278680">byte</span><span class="op" id="7278684">{</span><span class="ident" id="7278685">testECDSACertificate</span><span class="op" id="7278705">}</span><span class="op" id="7278706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278711">PrivateKey</span><span class="op" id="7278721">:</span>&nbsp;&nbsp;<span class="ident" id="7278724">testECDSAPrivateKey</span><span class="op" id="7278743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7278747">}</span><span class="op" id="7278748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7278751">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278754">config</span><span class="op" id="7278760">.</span><span class="ident" id="7278761">BuildNameToCertificate</span><span class="op" id="7278783">(</span><span class="op" id="7278784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278787">config</span><span class="op" id="7278793">.</span><span class="ident" id="7278794">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7278819">=</span>&nbsp;<span class="builtintype" id="7278821">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278828">test</span>&nbsp;<span class="op" id="7278833">=</span>&nbsp;<span class="op" id="7278835">&amp;</span><span class="ident" id="7278836">serverTest</span><span class="op" id="7278846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278850">name</span><span class="op" id="7278854">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7278858">&#34;CipherSuiteCertPreferenceECDSA&#34;</span><span class="op" id="7278890">,</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278894">config</span><span class="op" id="7278900">:</span>&nbsp;<span class="op" id="7278902">&amp;</span><span class="ident" id="7278903">config</span><span class="op" id="7278909">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7278912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278915">runServerTestTLS12</span><span class="op" id="7278933">(</span><span class="ident" id="7278934">t</span><span class="op" id="7278935">,</span>&nbsp;<span class="ident" id="7278937">test</span><span class="op" id="7278941">)</span><br>
<span class="lineno"></span><span class="op" id="7278943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="7278946">func</span>&nbsp;<span class="ident" id="7278951">TestResumption</span><span class="op" id="7278965">(</span><span class="ident" id="7278966">t</span>&nbsp;<span class="op" id="7278968">*</span><span class="ident" id="7278969">testing</span><span class="op" id="7278976">.</span><span class="ident" id="7278977">T</span><span class="op" id="7278978">)</span>&nbsp;<span class="op" id="7278980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7278983">sessionFilePath</span>&nbsp;<span class="op" id="7278999">:=</span>&nbsp;<span class="ident" id="7279002">tempFile</span><span class="op" id="7279010">(</span><span class="string" id="7279011">&#34;&#34;</span><span class="op" id="7279013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7279016">defer</span>&nbsp;<span class="ident" id="7279022">os</span><span class="op" id="7279024">.</span><span class="ident" id="7279025">Remove</span><span class="op" id="7279031">(</span><span class="ident" id="7279032">sessionFilePath</span><span class="op" id="7279047">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279051">test</span>&nbsp;<span class="op" id="7279056">:=</span>&nbsp;<span class="op" id="7279059">&amp;</span><span class="ident" id="7279060">serverTest</span><span class="op" id="7279070">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279074">name</span><span class="op" id="7279078">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7279083">&#34;IssueTicket&#34;</span><span class="op" id="7279096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279100">command</span><span class="op" id="7279107">:</span>&nbsp;<span class="op" id="7279109">[</span><span class="op" id="7279110">]</span><span class="builtintype" id="7279111">string</span><span class="op" id="7279117">{</span><span class="string" id="7279118">&#34;openssl&#34;</span><span class="op" id="7279127">,</span>&nbsp;<span class="string" id="7279129">&#34;s_client&#34;</span><span class="op" id="7279139">,</span>&nbsp;<span class="string" id="7279141">&#34;-cipher&#34;</span><span class="op" id="7279150">,</span>&nbsp;<span class="string" id="7279152">&#34;RC4-SHA&#34;</span><span class="op" id="7279161">,</span>&nbsp;<span class="string" id="7279163">&#34;-sess_out&#34;</span><span class="op" id="7279174">,</span>&nbsp;<span class="ident" id="7279176">sessionFilePath</span><span class="op" id="7279191">}</span><span class="op" id="7279192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7279195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279198">runServerTestTLS12</span><span class="op" id="7279216">(</span><span class="ident" id="7279217">t</span><span class="op" id="7279218">,</span>&nbsp;<span class="ident" id="7279220">test</span><span class="op" id="7279224">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279228">test</span>&nbsp;<span class="op" id="7279233">=</span>&nbsp;<span class="op" id="7279235">&amp;</span><span class="ident" id="7279236">serverTest</span><span class="op" id="7279246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279250">name</span><span class="op" id="7279254">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7279259">&#34;Resume&#34;</span><span class="op" id="7279267">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279271">command</span><span class="op" id="7279278">:</span>&nbsp;<span class="op" id="7279280">[</span><span class="op" id="7279281">]</span><span class="builtintype" id="7279282">string</span><span class="op" id="7279288">{</span><span class="string" id="7279289">&#34;openssl&#34;</span><span class="op" id="7279298">,</span>&nbsp;<span class="string" id="7279300">&#34;s_client&#34;</span><span class="op" id="7279310">,</span>&nbsp;<span class="string" id="7279312">&#34;-cipher&#34;</span><span class="op" id="7279321">,</span>&nbsp;<span class="string" id="7279323">&#34;RC4-SHA&#34;</span><span class="op" id="7279332">,</span>&nbsp;<span class="string" id="7279334">&#34;-sess_in&#34;</span><span class="op" id="7279344">,</span>&nbsp;<span class="ident" id="7279346">sessionFilePath</span><span class="op" id="7279361">}</span><span class="op" id="7279362">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7279365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279368">runServerTestTLS12</span><span class="op" id="7279386">(</span><span class="ident" id="7279387">t</span><span class="op" id="7279388">,</span>&nbsp;<span class="ident" id="7279390">test</span><span class="op" id="7279394">)</span><br>
<span class="lineno">690</span><span class="op" id="7279396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7279399">func</span>&nbsp;<span class="ident" id="7279404">TestResumptionDisabled</span><span class="op" id="7279426">(</span><span class="ident" id="7279427">t</span>&nbsp;<span class="op" id="7279429">*</span><span class="ident" id="7279430">testing</span><span class="op" id="7279437">.</span><span class="ident" id="7279438">T</span><span class="op" id="7279439">)</span>&nbsp;<span class="op" id="7279441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279444">sessionFilePath</span>&nbsp;<span class="op" id="7279460">:=</span>&nbsp;<span class="ident" id="7279463">tempFile</span><span class="op" id="7279471">(</span><span class="string" id="7279472">&#34;&#34;</span><span class="op" id="7279474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7279477">defer</span>&nbsp;<span class="ident" id="7279483">os</span><span class="op" id="7279485">.</span><span class="ident" id="7279486">Remove</span><span class="op" id="7279492">(</span><span class="ident" id="7279493">sessionFilePath</span><span class="op" id="7279508">)</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279512">config</span>&nbsp;<span class="op" id="7279519">:=</span>&nbsp;<span class="op" id="7279522">*</span><span class="ident" id="7279523">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279536">test</span>&nbsp;<span class="op" id="7279541">:=</span>&nbsp;<span class="op" id="7279544">&amp;</span><span class="ident" id="7279545">serverTest</span><span class="op" id="7279555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279559">name</span><span class="op" id="7279563">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7279568">&#34;IssueTicketPreDisable&#34;</span><span class="op" id="7279591">,</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279595">command</span><span class="op" id="7279602">:</span>&nbsp;<span class="op" id="7279604">[</span><span class="op" id="7279605">]</span><span class="builtintype" id="7279606">string</span><span class="op" id="7279612">{</span><span class="string" id="7279613">&#34;openssl&#34;</span><span class="op" id="7279622">,</span>&nbsp;<span class="string" id="7279624">&#34;s_client&#34;</span><span class="op" id="7279634">,</span>&nbsp;<span class="string" id="7279636">&#34;-cipher&#34;</span><span class="op" id="7279645">,</span>&nbsp;<span class="string" id="7279647">&#34;RC4-SHA&#34;</span><span class="op" id="7279656">,</span>&nbsp;<span class="string" id="7279658">&#34;-sess_out&#34;</span><span class="op" id="7279669">,</span>&nbsp;<span class="ident" id="7279671">sessionFilePath</span><span class="op" id="7279686">}</span><span class="op" id="7279687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279691">config</span><span class="op" id="7279697">:</span>&nbsp;&nbsp;<span class="op" id="7279700">&amp;</span><span class="ident" id="7279701">config</span><span class="op" id="7279707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7279710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279713">runServerTestTLS12</span><span class="op" id="7279731">(</span><span class="ident" id="7279732">t</span><span class="op" id="7279733">,</span>&nbsp;<span class="ident" id="7279735">test</span><span class="op" id="7279739">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279743">config</span><span class="op" id="7279749">.</span><span class="ident" id="7279750">SessionTicketsDisabled</span>&nbsp;<span class="op" id="7279773">=</span>&nbsp;<span class="builtintype" id="7279775">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279782">test</span>&nbsp;<span class="op" id="7279787">=</span>&nbsp;<span class="op" id="7279789">&amp;</span><span class="ident" id="7279790">serverTest</span><span class="op" id="7279800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279804">name</span><span class="op" id="7279808">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7279813">&#34;ResumeDisabled&#34;</span><span class="op" id="7279829">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279833">command</span><span class="op" id="7279840">:</span>&nbsp;<span class="op" id="7279842">[</span><span class="op" id="7279843">]</span><span class="builtintype" id="7279844">string</span><span class="op" id="7279850">{</span><span class="string" id="7279851">&#34;openssl&#34;</span><span class="op" id="7279860">,</span>&nbsp;<span class="string" id="7279862">&#34;s_client&#34;</span><span class="op" id="7279872">,</span>&nbsp;<span class="string" id="7279874">&#34;-cipher&#34;</span><span class="op" id="7279883">,</span>&nbsp;<span class="string" id="7279885">&#34;RC4-SHA&#34;</span><span class="op" id="7279894">,</span>&nbsp;<span class="string" id="7279896">&#34;-sess_in&#34;</span><span class="op" id="7279906">,</span>&nbsp;<span class="ident" id="7279908">sessionFilePath</span><span class="op" id="7279923">}</span><span class="op" id="7279924">,</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279928">config</span><span class="op" id="7279934">:</span>&nbsp;&nbsp;<span class="op" id="7279937">&amp;</span><span class="ident" id="7279938">config</span><span class="op" id="7279944">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7279947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7279950">runServerTestTLS12</span><span class="op" id="7279968">(</span><span class="ident" id="7279969">t</span><span class="op" id="7279970">,</span>&nbsp;<span class="ident" id="7279972">test</span><span class="op" id="7279976">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7279980">//&nbsp;One&nbsp;needs&nbsp;to&nbsp;manually&nbsp;confirm&nbsp;that&nbsp;the&nbsp;handshake&nbsp;in&nbsp;the&nbsp;golden&nbsp;data</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7280052">//&nbsp;file&nbsp;for&nbsp;ResumeDisabled&nbsp;does&nbsp;not&nbsp;include&nbsp;a&nbsp;resumption&nbsp;handshake.</span><br>
<span class="lineno"></span><span class="op" id="7280120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7280123">func</span>&nbsp;<span class="ident" id="7280128">TestFallbackSCSV</span><span class="op" id="7280144">(</span><span class="ident" id="7280145">t</span>&nbsp;<span class="op" id="7280147">*</span><span class="ident" id="7280148">testing</span><span class="op" id="7280155">.</span><span class="ident" id="7280156">T</span><span class="op" id="7280157">)</span>&nbsp;<span class="op" id="7280159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7280162">test</span>&nbsp;<span class="op" id="7280167">:=</span>&nbsp;<span class="op" id="7280170">&amp;</span><span class="ident" id="7280171">serverTest</span><span class="op" id="7280181">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7280185">name</span><span class="op" id="7280189">:</span>&nbsp;<span class="string" id="7280191">&#34;FallbackSCSV&#34;</span><span class="op" id="7280205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7280209">//&nbsp;OpenSSL&nbsp;1.0.1j&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;-fallback_scsv&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7280270">command</span><span class="op" id="7280277">:</span>&nbsp;<span class="op" id="7280279">[</span><span class="op" id="7280280">]</span><span class="builtintype" id="7280281">string</span><span class="op" id="7280287">{</span><span class="string" id="7280288">&#34;openssl&#34;</span><span class="op" id="7280297">,</span>&nbsp;<span class="string" id="7280299">&#34;s_client&#34;</span><span class="op" id="7280309">,</span>&nbsp;<span class="string" id="7280311">&#34;-fallback_scsv&#34;</span><span class="op" id="7280327">}</span><span class="op" id="7280328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7280332">expectHandshakeErrorIncluding</span><span class="op" id="7280361">:</span>&nbsp;<span class="string" id="7280363">&#34;inppropriate&nbsp;protocol&nbsp;fallback&#34;</span><span class="op" id="7280395">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7280398">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7280401">runServerTestTLS11</span><span class="op" id="7280419">(</span><span class="ident" id="7280420">t</span><span class="op" id="7280421">,</span>&nbsp;<span class="ident" id="7280423">test</span><span class="op" id="7280427">)</span><br>
<span class="lineno"></span><span class="op" id="7280429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7280432">//&nbsp;cert.pem&nbsp;and&nbsp;key.pem&nbsp;were&nbsp;generated&nbsp;with&nbsp;generate_cert.go</span><br>
<span class="lineno"></span><span class="comment" id="7280493">//&nbsp;Thus,&nbsp;they&nbsp;have&nbsp;no&nbsp;ExtKeyUsage&nbsp;fields&nbsp;and&nbsp;trigger&nbsp;an&nbsp;error</span><br>
<span class="lineno">730</span><span class="comment" id="7280555">//&nbsp;when&nbsp;verification&nbsp;is&nbsp;turned&nbsp;on.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7280591">const</span>&nbsp;<span class="ident" id="7280597">clientCertificatePEM</span>&nbsp;<span class="op" id="7280618">=</span>&nbsp;<span class="string" id="7280620">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB7TCCAVigAwIBAgIBADALBgkqhkiG9w0BAQUwJjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno">735</span>bzESMBAGA1UEAxMJMTI3LjAuMC4xMB4XDTExMTIwODA3NTUxMloXDTEyMTIwNzA4<br>
<span class="lineno"></span>MDAxMlowJjEQMA4GA1UEChMHQWNtZSBDbzESMBAGA1UEAxMJMTI3LjAuMC4xMIGc<br>
<span class="lineno"></span>MAsGCSqGSIb3DQEBAQOBjAAwgYgCgYBO0Hsx44Jk2VnAwoekXh6LczPHY1PfZpIG<br>
<span class="lineno"></span>hPZk1Y/kNqcdK+izIDZFI7Xjla7t4PUgnI2V339aEu+H5Fto5OkOdOwEin/ekyfE<br>
<span class="lineno"></span>ARl6vfLcPRSr0FTKIQzQTW6HLlzF0rtNS0/Otiz3fojsfNcCkXSmHgwa2uNKWi7e<br>
<span class="lineno">740</span>E5xMQIhZkwIDAQABozIwMDAOBgNVHQ8BAf8EBAMCAKAwDQYDVR0OBAYEBAECAwQw<br>
<span class="lineno"></span>DwYDVR0jBAgwBoAEAQIDBDALBgkqhkiG9w0BAQUDgYEANh+zegx1yW43RmEr1b3A<br>
<span class="lineno"></span>p0vMRpqBWHyFeSnIyMZn3TJWRSt1tukkqVCavh9a+hoV2cxVlXIWg7nCto/9iIw4<br>
<span class="lineno"></span>hB2rXZIxE0/9gzvGnfERYraL7KtnvshksBFQRlgXa5kc0x38BvEO5ZaoDPl4ILdE<br>
<span class="lineno"></span>GFGNEH5PlGffo05wc46QkYU=<br>
<span class="lineno">745</span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7281353">const</span>&nbsp;<span class="ident" id="7281359">clientKeyPEM</span>&nbsp;<span class="op" id="7281372">=</span>&nbsp;<span class="string" id="7281374">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIICWgIBAAKBgE7QezHjgmTZWcDCh6ReHotzM8djU99mkgaE9mTVj+Q2px0r6LMg<br>
<span class="lineno">750</span>NkUjteOVru3g9SCcjZXff1oS74fkW2jk6Q507ASKf96TJ8QBGXq98tw9FKvQVMoh<br>
<span class="lineno"></span>DNBNbocuXMXSu01LT862LPd+iOx81wKRdKYeDBra40paLt4TnExAiFmTAgMBAAEC<br>
<span class="lineno"></span>gYBxvXd8yNteFTns8A/2yomEMC4yeosJJSpp1CsN3BJ7g8/qTnrVPxBy+RU+qr63<br>
<span class="lineno"></span>t2WquaOu/cr5P8iEsa6lk20tf8pjKLNXeX0b1RTzK8rJLbS7nGzP3tvOhL096VtQ<br>
<span class="lineno"></span>dAo4ROEaro0TzYpHmpciSvxVIeEIAAdFDObDJPKqcJAxyQJBAJizfYgK8Gzx9fsx<br>
<span class="lineno">755</span>hxp+VteCbVPg2euASH5Yv3K5LukRdKoSzHE2grUVQgN/LafC0eZibRanxHegYSr7<br>
<span class="lineno"></span>7qaswKUCQQCEIWor/X4XTMdVj3Oj+vpiw75y/S9gh682+myZL+d/02IEkwnB098P<br>
<span class="lineno"></span>RkKVpenBHyrGg0oeN5La7URILWKj7CPXAkBKo6F+d+phNjwIFoN1Xb/RA32w/D1I<br>
<span class="lineno"></span>saG9sF+UEhRt9AxUfW/U/tIQ9V0ZHHcSg1XaCM5Nvp934brdKdvTOKnJAkBD5h/3<br>
<span class="lineno"></span>Rybatlvg/fzBEaJFyq09zhngkxlZOUtBVTqzl17RVvY2orgH02U4HbCHy4phxOn7<br>
<span class="lineno">760</span>qTdQRYlHRftgnWK1AkANibn9PRYJ7mJyJ9Dyj2QeNcSkSTzrt0tPvUMf4+meJymN<br>
<span class="lineno"></span>1Ntu5+S1DLLzfxlaljWG6ylW6DNxujCyuXIV2rvA<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7282261">const</span>&nbsp;<span class="ident" id="7282267">clientECDSACertificatePEM</span>&nbsp;<span class="op" id="7282293">=</span>&nbsp;<span class="string" id="7282295">`<br>
<span class="lineno">765</span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/DCCAV4CCQCaMIRsJjXZFzAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTMyNTUzWhcNMjIxMTEyMTMyNTUzWjBBMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTEMMAoGA1UECBMDTlNXMRAwDgYDVQQHEwdQeXJtb250MRIwEAYDVQQDEwlK<br>
<span class="lineno">770</span>b2VsIFNpbmcwgZswEAYHKoZIzj0CAQYFK4EEACMDgYYABACVjJF1FMBexFe01MNv<br>
<span class="lineno"></span>ja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd3kfDdq0Z9kUs<br>
<span class="lineno"></span>jLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx+U56jb0JuK7q<br>
<span class="lineno"></span>ixgnTy5w/hOWusPTQBbNZU6sER7m8TAJBgcqhkjOPQQBA4GMADCBiAJCAOAUxGBg<br>
<span class="lineno"></span>C3JosDJdYUoCdFzCgbkWqD8pyDbHgf9stlvZcPE4O1BIKJTLCRpS8V3ujfK58PDa<br>
<span class="lineno">775</span>2RU6+b0DeoeiIzXsAkIBo9SKeDUcSpoj0gq+KxAxnZxfvuiRs9oa9V2jI/Umi0Vw<br>
<span class="lineno"></span>jWVim34BmT0Y9hCaOGGbLlfk+syxis7iI6CH8OFnUes=<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7283048">const</span>&nbsp;<span class="ident" id="7283054">clientECDSAKeyPEM</span>&nbsp;<span class="op" id="7283072">=</span>&nbsp;<span class="string" id="7283074">`<br>
<span class="lineno">780</span>-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBkJN9X4IqZIguiEVKMqeBUP5xtRsEv4HJEtOpOGLELwO53SD78Ew8<br>
<span class="lineno">785</span>k+wLWoqizS3NpQyMtrU8JFdWfj+C57UNkOugBwYFK4EEACOhgYkDgYYABACVjJF1<br>
<span class="lineno"></span>FMBexFe01MNvja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd<br>
<span class="lineno"></span>3kfDdq0Z9kUsjLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx<br>
<span class="lineno"></span>+U56jb0JuK7qixgnTy5w/hOWusPTQBbNZU6sER7m8Q==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno">790</span><br>
<span class="lineno"></span><span class="keyword" id="7283514">func</span>&nbsp;<span class="ident" id="7283519">TestClientAuth</span><span class="op" id="7283533">(</span><span class="ident" id="7283534">t</span>&nbsp;<span class="op" id="7283536">*</span><span class="ident" id="7283537">testing</span><span class="op" id="7283544">.</span><span class="ident" id="7283545">T</span><span class="op" id="7283546">)</span>&nbsp;<span class="op" id="7283548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7283551">var</span>&nbsp;<span class="ident" id="7283555">certPath</span><span class="op" id="7283563">,</span>&nbsp;<span class="ident" id="7283565">keyPath</span><span class="op" id="7283572">,</span>&nbsp;<span class="ident" id="7283574">ecdsaCertPath</span><span class="op" id="7283587">,</span>&nbsp;<span class="ident" id="7283589">ecdsaKeyPath</span>&nbsp;<span class="builtintype" id="7283602">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7283611">if</span>&nbsp;<span class="op" id="7283614">*</span><span class="ident" id="7283615">update</span>&nbsp;<span class="op" id="7283622">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7283626">certPath</span>&nbsp;<span class="op" id="7283635">=</span>&nbsp;<span class="ident" id="7283637">tempFile</span><span class="op" id="7283645">(</span><span class="ident" id="7283646">clientCertificatePEM</span><span class="op" id="7283666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7283670">defer</span>&nbsp;<span class="ident" id="7283676">os</span><span class="op" id="7283678">.</span><span class="ident" id="7283679">Remove</span><span class="op" id="7283685">(</span><span class="ident" id="7283686">certPath</span><span class="op" id="7283694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7283698">keyPath</span>&nbsp;<span class="op" id="7283706">=</span>&nbsp;<span class="ident" id="7283708">tempFile</span><span class="op" id="7283716">(</span><span class="ident" id="7283717">clientKeyPEM</span><span class="op" id="7283729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7283733">defer</span>&nbsp;<span class="ident" id="7283739">os</span><span class="op" id="7283741">.</span><span class="ident" id="7283742">Remove</span><span class="op" id="7283748">(</span><span class="ident" id="7283749">keyPath</span><span class="op" id="7283756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7283760">ecdsaCertPath</span>&nbsp;<span class="op" id="7283774">=</span>&nbsp;<span class="ident" id="7283776">tempFile</span><span class="op" id="7283784">(</span><span class="ident" id="7283785">clientECDSACertificatePEM</span><span class="op" id="7283810">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7283814">defer</span>&nbsp;<span class="ident" id="7283820">os</span><span class="op" id="7283822">.</span><span class="ident" id="7283823">Remove</span><span class="op" id="7283829">(</span><span class="ident" id="7283830">ecdsaCertPath</span><span class="op" id="7283843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7283847">ecdsaKeyPath</span>&nbsp;<span class="op" id="7283860">=</span>&nbsp;<span class="ident" id="7283862">tempFile</span><span class="op" id="7283870">(</span><span class="ident" id="7283871">clientECDSAKeyPEM</span><span class="op" id="7283888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7283892">defer</span>&nbsp;<span class="ident" id="7283898">os</span><span class="op" id="7283900">.</span><span class="ident" id="7283901">Remove</span><span class="op" id="7283907">(</span><span class="ident" id="7283908">ecdsaKeyPath</span><span class="op" id="7283920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7283923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7283927">config</span>&nbsp;<span class="op" id="7283934">:=</span>&nbsp;<span class="op" id="7283937">*</span><span class="ident" id="7283938">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7283950">config</span><span class="op" id="7283956">.</span><span class="ident" id="7283957">ClientAuth</span>&nbsp;<span class="op" id="7283968">=</span>&nbsp;<span class="ident" id="7283970">RequestClientCert</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7283990">test</span>&nbsp;<span class="op" id="7283995">:=</span>&nbsp;<span class="op" id="7283998">&amp;</span><span class="ident" id="7283999">serverTest</span><span class="op" id="7284009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284013">name</span><span class="op" id="7284017">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7284022">&#34;ClientAuthRequestedNotGiven&#34;</span><span class="op" id="7284051">,</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284055">command</span><span class="op" id="7284062">:</span>&nbsp;<span class="op" id="7284064">[</span><span class="op" id="7284065">]</span><span class="builtintype" id="7284066">string</span><span class="op" id="7284072">{</span><span class="string" id="7284073">&#34;openssl&#34;</span><span class="op" id="7284082">,</span>&nbsp;<span class="string" id="7284084">&#34;s_client&#34;</span><span class="op" id="7284094">,</span>&nbsp;<span class="string" id="7284096">&#34;-no_ticket&#34;</span><span class="op" id="7284108">,</span>&nbsp;<span class="string" id="7284110">&#34;-cipher&#34;</span><span class="op" id="7284119">,</span>&nbsp;<span class="string" id="7284121">&#34;RC4-SHA&#34;</span><span class="op" id="7284130">}</span><span class="op" id="7284131">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284135">config</span><span class="op" id="7284141">:</span>&nbsp;&nbsp;<span class="op" id="7284144">&amp;</span><span class="ident" id="7284145">config</span><span class="op" id="7284151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284157">runServerTestTLS12</span><span class="op" id="7284175">(</span><span class="ident" id="7284176">t</span><span class="op" id="7284177">,</span>&nbsp;<span class="ident" id="7284179">test</span><span class="op" id="7284183">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284187">test</span>&nbsp;<span class="op" id="7284192">=</span>&nbsp;<span class="op" id="7284194">&amp;</span><span class="ident" id="7284195">serverTest</span><span class="op" id="7284205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284209">name</span><span class="op" id="7284213">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7284228">&#34;ClientAuthRequestedAndGiven&#34;</span><span class="op" id="7284257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284261">command</span><span class="op" id="7284268">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7284280">[</span><span class="op" id="7284281">]</span><span class="builtintype" id="7284282">string</span><span class="op" id="7284288">{</span><span class="string" id="7284289">&#34;openssl&#34;</span><span class="op" id="7284298">,</span>&nbsp;<span class="string" id="7284300">&#34;s_client&#34;</span><span class="op" id="7284310">,</span>&nbsp;<span class="string" id="7284312">&#34;-no_ticket&#34;</span><span class="op" id="7284324">,</span>&nbsp;<span class="string" id="7284326">&#34;-cipher&#34;</span><span class="op" id="7284335">,</span>&nbsp;<span class="string" id="7284337">&#34;RC4-SHA&#34;</span><span class="op" id="7284346">,</span>&nbsp;<span class="string" id="7284348">&#34;-cert&#34;</span><span class="op" id="7284355">,</span>&nbsp;<span class="ident" id="7284357">certPath</span><span class="op" id="7284365">,</span>&nbsp;<span class="string" id="7284367">&#34;-key&#34;</span><span class="op" id="7284373">,</span>&nbsp;<span class="ident" id="7284375">keyPath</span><span class="op" id="7284382">}</span><span class="op" id="7284383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284387">config</span><span class="op" id="7284393">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7284406">&amp;</span><span class="ident" id="7284407">config</span><span class="op" id="7284413">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284417">expectedPeerCerts</span><span class="op" id="7284434">:</span>&nbsp;<span class="op" id="7284436">[</span><span class="op" id="7284437">]</span><span class="builtintype" id="7284438">string</span><span class="op" id="7284444">{</span><span class="ident" id="7284445">clientCertificatePEM</span><span class="op" id="7284465">}</span><span class="op" id="7284466">,</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284472">runServerTestTLS12</span><span class="op" id="7284490">(</span><span class="ident" id="7284491">t</span><span class="op" id="7284492">,</span>&nbsp;<span class="ident" id="7284494">test</span><span class="op" id="7284498">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284502">test</span>&nbsp;<span class="op" id="7284507">=</span>&nbsp;<span class="op" id="7284509">&amp;</span><span class="ident" id="7284510">serverTest</span><span class="op" id="7284520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284524">name</span><span class="op" id="7284528">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7284543">&#34;ClientAuthRequestedAndECDSAGiven&#34;</span><span class="op" id="7284577">,</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284581">command</span><span class="op" id="7284588">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7284600">[</span><span class="op" id="7284601">]</span><span class="builtintype" id="7284602">string</span><span class="op" id="7284608">{</span><span class="string" id="7284609">&#34;openssl&#34;</span><span class="op" id="7284618">,</span>&nbsp;<span class="string" id="7284620">&#34;s_client&#34;</span><span class="op" id="7284630">,</span>&nbsp;<span class="string" id="7284632">&#34;-no_ticket&#34;</span><span class="op" id="7284644">,</span>&nbsp;<span class="string" id="7284646">&#34;-cipher&#34;</span><span class="op" id="7284655">,</span>&nbsp;<span class="string" id="7284657">&#34;RC4-SHA&#34;</span><span class="op" id="7284666">,</span>&nbsp;<span class="string" id="7284668">&#34;-cert&#34;</span><span class="op" id="7284675">,</span>&nbsp;<span class="ident" id="7284677">ecdsaCertPath</span><span class="op" id="7284690">,</span>&nbsp;<span class="string" id="7284692">&#34;-key&#34;</span><span class="op" id="7284698">,</span>&nbsp;<span class="ident" id="7284700">ecdsaKeyPath</span><span class="op" id="7284712">}</span><span class="op" id="7284713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284717">config</span><span class="op" id="7284723">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7284736">&amp;</span><span class="ident" id="7284737">config</span><span class="op" id="7284743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284747">expectedPeerCerts</span><span class="op" id="7284764">:</span>&nbsp;<span class="op" id="7284766">[</span><span class="op" id="7284767">]</span><span class="builtintype" id="7284768">string</span><span class="op" id="7284774">{</span><span class="ident" id="7284775">clientECDSACertificatePEM</span><span class="op" id="7284800">}</span><span class="op" id="7284801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284807">runServerTestTLS12</span><span class="op" id="7284825">(</span><span class="ident" id="7284826">t</span><span class="op" id="7284827">,</span>&nbsp;<span class="ident" id="7284829">test</span><span class="op" id="7284833">)</span><br>
<span class="lineno">830</span><span class="op" id="7284835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7284838">func</span>&nbsp;<span class="ident" id="7284843">bigFromString</span><span class="op" id="7284856">(</span><span class="ident" id="7284857">s</span>&nbsp;<span class="builtintype" id="7284859">string</span><span class="op" id="7284865">)</span>&nbsp;<span class="op" id="7284867">*</span><span class="ident" id="7284868">big</span><span class="op" id="7284871">.</span><span class="ident" id="7284872">Int</span>&nbsp;<span class="op" id="7284876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284879">ret</span>&nbsp;<span class="op" id="7284883">:=</span>&nbsp;<span class="builtinfunc" id="7284886">new</span><span class="op" id="7284889">(</span><span class="ident" id="7284890">big</span><span class="op" id="7284893">.</span><span class="ident" id="7284894">Int</span><span class="op" id="7284897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284900">ret</span><span class="op" id="7284903">.</span><span class="ident" id="7284904">SetString</span><span class="op" id="7284913">(</span><span class="ident" id="7284914">s</span><span class="op" id="7284915">,</span>&nbsp;<span class="num" id="7284917">10</span><span class="op" id="7284919">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7284922">return</span>&nbsp;<span class="ident" id="7284929">ret</span><br>
<span class="lineno"></span><span class="op" id="7284933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7284936">func</span>&nbsp;<span class="ident" id="7284941">fromHex</span><span class="op" id="7284948">(</span><span class="ident" id="7284949">s</span>&nbsp;<span class="builtintype" id="7284951">string</span><span class="op" id="7284957">)</span>&nbsp;<span class="op" id="7284959">[</span><span class="op" id="7284960">]</span><span class="builtintype" id="7284961">byte</span>&nbsp;<span class="op" id="7284966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284969">b</span><span class="op" id="7284970">,</span>&nbsp;<span class="ident" id="7284972">_</span>&nbsp;<span class="op" id="7284974">:=</span>&nbsp;<span class="ident" id="7284977">hex</span><span class="op" id="7284980">.</span><span class="ident" id="7284981">DecodeString</span><span class="op" id="7284993">(</span><span class="ident" id="7284994">s</span><span class="op" id="7284995">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7284998">return</span>&nbsp;<span class="ident" id="7285005">b</span><br>
<span class="lineno"></span><span class="op" id="7285007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7285010">var</span>&nbsp;<span class="ident" id="7285014">testRSACertificate</span>&nbsp;<span class="op" id="7285033">=</span>&nbsp;<span class="ident" id="7285035">fromHex</span><span class="op" id="7285042">(</span><span class="string" id="7285043">&#34;308202b030820219a00302010202090085b0bba48a7fb8ca300d06092a864886f70d01010505003045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3130303432343039303933385a170d3131303432343039303933385a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819f300d06092a864886f70d010101050003818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a381a73081a4301d0603551d0e04160414b1ade2855acfcb28db69ce2369ded3268e18883930750603551d23046e306c8014b1ade2855acfcb28db69ce2369ded3268e188839a149a4473045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746482090085b0bba48a7fb8ca300c0603551d13040530030101ff300d06092a864886f70d010105050003818100086c4524c76bb159ab0c52ccf2b014d7879d7a6475b55a9566e4c52b8eae12661feb4f38b36e60d392fdf74108b52513b1187a24fb301dbaed98b917ece7d73159db95d31d78ea50565cd5825a2d5a5f33c4b6d8c97590968c0f5298b5cd981f89205ff2a01ca31b9694dda9fd57e970e8266d71999b266e3850296c90a7bdd9&#34;</span><span class="op" id="7286429">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span><span class="keyword" id="7286432">var</span>&nbsp;<span class="ident" id="7286436">testECDSACertificate</span>&nbsp;<span class="op" id="7286457">=</span>&nbsp;<span class="ident" id="7286459">fromHex</span><span class="op" id="7286466">(</span><span class="string" id="7286467">&#34;3082020030820162020900b8bf2d47a0d2ebf4300906072a8648ce3d04013045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3132313132323135303633325a170d3232313132303135303633325a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819b301006072a8648ce3d020106052b81040023038186000400c4a1edbe98f90b4873367ec316561122f23d53c33b4d213dcd6b75e6f6b0dc9adf26c1bcb287f072327cb3642f1c90bcea6823107efee325c0483a69e0286dd33700ef0462dd0da09c706283d881d36431aa9e9731bd96b068c09b23de76643f1a5c7fe9120e5858b65f70dd9bd8ead5d7f5d5ccb9b69f30665b669a20e227e5bffe3b300906072a8648ce3d040103818c0030818802420188a24febe245c5487d1bacf5ed989dae4770c05e1bb62fbdf1b64db76140d311a2ceee0b7e927eff769dc33b7ea53fcefa10e259ec472d7cacda4e970e15a06fd00242014dfcbe67139c2d050ebd3fa38c25c13313830d9406bbd4377af6ec7ac9862eddd711697f857c56defb31782be4c7780daecbbe9e4e3624317b6a0f399512078f2a&#34;</span><span class="op" id="7287501">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7287504">var</span>&nbsp;<span class="ident" id="7287508">testSNICertificate</span>&nbsp;<span class="op" id="7287527">=</span>&nbsp;<span class="ident" id="7287529">fromHex</span><span class="op" id="7287536">(</span><span class="string" id="7287537">&#34;308201f23082015da003020102020100300b06092a864886f70d01010530283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d301e170d3132303431313137343033355a170d3133303431313137343533355a30283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d30819d300b06092a864886f70d01010103818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a3323030300e0603551d0f0101ff0404030200a0300d0603551d0e0406040401020304300f0603551d2304083006800401020304300b06092a864886f70d0101050381810089c6455f1c1f5ef8eb1ab174ee2439059f5c4259bb1a8d86cdb1d056f56a717da40e95ab90f59e8deaf627c157995094db0802266eb34fc6842dea8a4b68d9c1389103ab84fb9e1f85d9b5d23ff2312c8670fbb540148245a4ebafe264d90c8a4cf4f85b0fac12ac2fc4a3154bad52462868af96c62c6525d652b6e31845bdcc&#34;</span><span class="op" id="7288543">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7288546">var</span>&nbsp;<span class="ident" id="7288550">testRSAPrivateKey</span>&nbsp;<span class="op" id="7288568">=</span>&nbsp;<span class="op" id="7288570">&amp;</span><span class="ident" id="7288571">rsa</span><span class="op" id="7288574">.</span><span class="ident" id="7288575">PrivateKey</span><span class="op" id="7288585">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288588">PublicKey</span><span class="op" id="7288597">:</span>&nbsp;<span class="ident" id="7288599">rsa</span><span class="op" id="7288602">.</span><span class="ident" id="7288603">PublicKey</span><span class="op" id="7288612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288616">N</span><span class="op" id="7288617">:</span>&nbsp;<span class="ident" id="7288619">bigFromString</span><span class="op" id="7288632">(</span><span class="string" id="7288633">&#34;131650079503776001033793877885499001334664249354723305978524647182322416328664556247316495448366990052837680518067798333412266673813370895702118944398081598789828837447552603077848001020611640547221687072142537202428102790818451901395596882588063427854225330436740647715202971973145151161964464812406232198521&#34;</span><span class="op" id="7288944">)</span><span class="op" id="7288945">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288949">E</span><span class="op" id="7288950">:</span>&nbsp;<span class="num" id="7288952">65537</span><span class="op" id="7288957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7288960">}</span><span class="op" id="7288961">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288964">D</span><span class="op" id="7288965">:</span>&nbsp;<span class="ident" id="7288967">bigFromString</span><span class="op" id="7288980">(</span><span class="string" id="7288981">&#34;29354450337804273969007277378287027274721892607543397931919078829901848876371746653677097639302788129485893852488285045793268732234230875671682624082413996177431586734171663258657462237320300610850244186316880055243099640544518318093544057213190320837094958164973959123058337475052510833916491060913053867729&#34;</span><span class="op" id="7289291">)</span><span class="op" id="7289292">,</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289295">Primes</span><span class="op" id="7289301">:</span>&nbsp;<span class="op" id="7289303">[</span><span class="op" id="7289304">]</span><span class="op" id="7289305">*</span><span class="ident" id="7289306">big</span><span class="op" id="7289309">.</span><span class="ident" id="7289310">Int</span><span class="op" id="7289313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289317">bigFromString</span><span class="op" id="7289330">(</span><span class="string" id="7289331">&#34;11969277782311800166562047708379380720136961987713178380670422671426759650127150688426177829077494755200794297055316163155755835813760102405344560929062149&#34;</span><span class="op" id="7289488">)</span><span class="op" id="7289489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289493">bigFromString</span><span class="op" id="7289506">(</span><span class="string" id="7289507">&#34;10998999429884441391899182616418192492905073053684657075974935218461686523870125521822756579792315215543092255516093840728890783887287417039645833477273829&#34;</span><span class="op" id="7289664">)</span><span class="op" id="7289665">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7289668">}</span><span class="op" id="7289669">,</span><br>
<span class="lineno"></span><span class="op" id="7289671">}</span><br>
<span class="lineno">860</span><br>
<span class="lineno"></span><span class="keyword" id="7289674">var</span>&nbsp;<span class="ident" id="7289678">testECDSAPrivateKey</span>&nbsp;<span class="op" id="7289698">=</span>&nbsp;<span class="op" id="7289700">&amp;</span><span class="ident" id="7289701">ecdsa</span><span class="op" id="7289706">.</span><span class="ident" id="7289707">PrivateKey</span><span class="op" id="7289717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289720">PublicKey</span><span class="op" id="7289729">:</span>&nbsp;<span class="ident" id="7289731">ecdsa</span><span class="op" id="7289736">.</span><span class="ident" id="7289737">PublicKey</span><span class="op" id="7289746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289750">Curve</span><span class="op" id="7289755">:</span>&nbsp;<span class="ident" id="7289757">elliptic</span><span class="op" id="7289765">.</span><span class="ident" id="7289766">P521</span><span class="op" id="7289770">(</span><span class="op" id="7289771">)</span><span class="op" id="7289772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289776">X</span><span class="op" id="7289777">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7289783">bigFromString</span><span class="op" id="7289796">(</span><span class="string" id="7289797">&#34;2636411247892461147287360222306590634450676461695221912739908880441342231985950069527906976759812296359387337367668045707086543273113073382714101597903639351&#34;</span><span class="op" id="7289956">)</span><span class="op" id="7289957">,</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289961">Y</span><span class="op" id="7289962">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7289968">bigFromString</span><span class="op" id="7289981">(</span><span class="string" id="7289982">&#34;3204695818431246682253994090650952614555094516658732116404513121125038617915183037601737180082382202488628239201196033284060130040574800684774115478859677243&#34;</span><span class="op" id="7290141">)</span><span class="op" id="7290142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7290145">}</span><span class="op" id="7290146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290149">D</span><span class="op" id="7290150">:</span>&nbsp;<span class="ident" id="7290152">bigFromString</span><span class="op" id="7290165">(</span><span class="string" id="7290166">&#34;5477294338614160138026852784385529180817726002953041720191098180813046231640184669647735805135001309477695746518160084669446643325196003346204701381388769751&#34;</span><span class="op" id="7290325">)</span><span class="op" id="7290326">,</span><br>
<span class="lineno"></span><span class="op" id="7290328">}</span>
</div>
</body>
</html>
