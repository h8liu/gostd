<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html" class="current">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4109617">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4109672">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4109726">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4109777">//&nbsp;HTTP&nbsp;file&nbsp;system&nbsp;request&nbsp;handler</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4109814">package</span>&nbsp;<span class="ident" id="4109822">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4109828">import</span>&nbsp;<span class="op" id="4109835">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4109838">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4109848">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4109855">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4109861">&#34;mime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4109869">&#34;mime/multipart&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4109887">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4109904">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4109915">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4109921">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4109929">&#34;path/filepath&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4109946">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4109957">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4109968">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4109975">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4109978">//&nbsp;A&nbsp;Dir&nbsp;implements&nbsp;FileSystem&nbsp;using&nbsp;the&nbsp;native&nbsp;file&nbsp;system&nbsp;restricted&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4110054">//&nbsp;specific&nbsp;directory&nbsp;tree.</span><br>
<span class="lineno"></span><span class="comment" id="4110082">//</span><br>
<span class="lineno"></span><span class="comment" id="4110085">//&nbsp;While&nbsp;the&nbsp;FileSystem.Open&nbsp;method&nbsp;takes&nbsp;&#39;/&#39;-separated&nbsp;paths,&nbsp;a&nbsp;Dir&#39;s&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="4110163">//&nbsp;value&nbsp;is&nbsp;a&nbsp;filename&nbsp;on&nbsp;the&nbsp;native&nbsp;file&nbsp;system,&nbsp;not&nbsp;a&nbsp;URL,&nbsp;so&nbsp;it&nbsp;is&nbsp;separated</span><br>
<span class="lineno">30</span><span class="comment" id="4110243">//&nbsp;by&nbsp;filepath.Separator,&nbsp;which&nbsp;isn&#39;t&nbsp;necessarily&nbsp;&#39;/&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="4110298">//</span><br>
<span class="lineno"></span><span class="comment" id="4110301">//&nbsp;An&nbsp;empty&nbsp;Dir&nbsp;is&nbsp;treated&nbsp;as&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4110336">type</span>&nbsp;<span class="ident" id="4110341">Dir</span>&nbsp;<span class="builtintype" id="4110345">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="4110353">func</span>&nbsp;<span class="op" id="4110358">(</span><span class="ident" id="4110359">d</span>&nbsp;<span class="ident" id="4110361"><a href="/gostd/net/http/fs.go.html#4110341">Dir</a></span><span class="op" id="4110364">)</span>&nbsp;<span class="ident" id="4110366">Open</span><span class="op" id="4110370">(</span><span class="ident" id="4110371">name</span>&nbsp;<span class="builtintype" id="4110376">string</span><span class="op" id="4110382">)</span>&nbsp;<span class="op" id="4110384">(</span><span class="ident" id="4110385"><a href="/gostd/net/http/fs.go.html#4111213">File</a></span><span class="op" id="4110389">,</span>&nbsp;<span class="builtintype" id="4110391">error</span><span class="op" id="4110396">)</span>&nbsp;<span class="op" id="4110398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110401">if</span>&nbsp;<span class="ident" id="4110404"><a href="/gostd/net/http/fs.go.html#4109929">filepath</a></span><span class="op" id="4110412">.</span><span class="ident" id="4110413"><a href="/gostd/path/filepath/path.go.html#3779295">Separator</a></span>&nbsp;<span class="op" id="4110423">!=</span>&nbsp;<span class="string" id="4110426">&#39;/&#39;</span>&nbsp;<span class="op" id="4110430">&amp;&amp;</span>&nbsp;<span class="ident" id="4110433"><a href="/gostd/net/http/fs.go.html#4109957">strings</a></span><span class="op" id="4110440">.</span><span class="ident" id="4110441"><a href="/gostd/strings/strings.go.html#2970424">IndexRune</a></span><span class="op" id="4110450">(</span><span class="ident" id="4110451"><a href="/gostd/net/http/fs.go.html#4110371">name</a></span><span class="op" id="4110455">,</span>&nbsp;<span class="ident" id="4110457"><a href="/gostd/net/http/fs.go.html#4109929">filepath</a></span><span class="op" id="4110465">.</span><span class="ident" id="4110466"><a href="/gostd/path/filepath/path.go.html#3779295">Separator</a></span><span class="op" id="4110475">)</span>&nbsp;<span class="op" id="4110477">&gt;=</span>&nbsp;<span class="num" id="4110480">0</span>&nbsp;<span class="op" id="4110482">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110487"><a href="/gostd/net/http/fs.go.html#4109957">strings</a></span><span class="op" id="4110494">.</span><span class="ident" id="4110495"><a href="/gostd/strings/strings.go.html#2968416">Contains</a></span><span class="op" id="4110503">(</span><span class="ident" id="4110504"><a href="/gostd/net/http/fs.go.html#4110371">name</a></span><span class="op" id="4110508">,</span>&nbsp;<span class="string" id="4110510">&#34;\x00&#34;</span><span class="op" id="4110516">)</span>&nbsp;<span class="op" id="4110518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110522">return</span>&nbsp;<span class="builtintype" id="4110529">nil</span><span class="op" id="4110532">,</span>&nbsp;<span class="ident" id="4110534"><a href="/gostd/net/http/fs.go.html#4109838">errors</a></span><span class="op" id="4110540">.</span><span class="ident" id="4110541"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4110544">(</span><span class="string" id="4110545">&#34;http:&nbsp;invalid&nbsp;character&nbsp;in&nbsp;file&nbsp;path&#34;</span><span class="op" id="4110583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110586">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110589">dir</span>&nbsp;<span class="op" id="4110593">:=</span>&nbsp;<span class="builtintype" id="4110596">string</span><span class="op" id="4110602">(</span><span class="ident" id="4110603"><a href="/gostd/net/http/fs.go.html#4110359">d</a></span><span class="op" id="4110604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110607">if</span>&nbsp;<span class="ident" id="4110610"><a href="/gostd/net/http/fs.go.html#4110589">dir</a></span>&nbsp;<span class="op" id="4110614">==</span>&nbsp;<span class="string" id="4110617">&#34;&#34;</span>&nbsp;<span class="op" id="4110620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110624"><a href="/gostd/net/http/fs.go.html#4110589">dir</a></span>&nbsp;<span class="op" id="4110628">=</span>&nbsp;<span class="string" id="4110630">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110638">f</span><span class="op" id="4110639">,</span>&nbsp;<span class="ident" id="4110641">err</span>&nbsp;<span class="op" id="4110645">:=</span>&nbsp;<span class="ident" id="4110648"><a href="/gostd/net/http/fs.go.html#4109915">os</a></span><span class="op" id="4110650">.</span><span class="ident" id="4110651"><a href="/gostd/os/file.go.html#2446863">Open</a></span><span class="op" id="4110655">(</span><span class="ident" id="4110656"><a href="/gostd/net/http/fs.go.html#4109929">filepath</a></span><span class="op" id="4110664">.</span><span class="ident" id="4110665"><a href="/gostd/path/filepath/path.go.html#3783597">Join</a></span><span class="op" id="4110669">(</span><span class="ident" id="4110670"><a href="/gostd/net/http/fs.go.html#4110589">dir</a></span><span class="op" id="4110673">,</span>&nbsp;<span class="ident" id="4110675"><a href="/gostd/net/http/fs.go.html#4109929">filepath</a></span><span class="op" id="4110683">.</span><span class="ident" id="4110684"><a href="/gostd/path/filepath/path.go.html#3782541">FromSlash</a></span><span class="op" id="4110693">(</span><span class="ident" id="4110694"><a href="/gostd/net/http/fs.go.html#4109921">path</a></span><span class="op" id="4110698">.</span><span class="ident" id="4110699"><a href="/gostd/path/path.go.html#3922001">Clean</a></span><span class="op" id="4110704">(</span><span class="string" id="4110705">&#34;/&#34;</span><span class="op" id="4110708">+</span><span class="ident" id="4110709"><a href="/gostd/net/http/fs.go.html#4110371">name</a></span><span class="op" id="4110713">)</span><span class="op" id="4110714">)</span><span class="op" id="4110715">)</span><span class="op" id="4110716">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110719">if</span>&nbsp;<span class="ident" id="4110722"><a href="/gostd/net/http/fs.go.html#4110641">err</a></span>&nbsp;<span class="op" id="4110726">!=</span>&nbsp;<span class="builtintype" id="4110729">nil</span>&nbsp;<span class="op" id="4110733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110737">return</span>&nbsp;<span class="builtintype" id="4110744">nil</span><span class="op" id="4110747">,</span>&nbsp;<span class="ident" id="4110749"><a href="/gostd/net/http/fs.go.html#4110641">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110757">return</span>&nbsp;<span class="ident" id="4110764"><a href="/gostd/net/http/fs.go.html#4110638">f</a></span><span class="op" id="4110765">,</span>&nbsp;<span class="builtintype" id="4110767">nil</span><br>
<span class="lineno"></span><span class="op" id="4110771">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4110774">//&nbsp;A&nbsp;FileSystem&nbsp;implements&nbsp;access&nbsp;to&nbsp;a&nbsp;collection&nbsp;of&nbsp;named&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4110840">//&nbsp;The&nbsp;elements&nbsp;in&nbsp;a&nbsp;file&nbsp;path&nbsp;are&nbsp;separated&nbsp;by&nbsp;slash&nbsp;(&#39;/&#39;,&nbsp;U+002F)</span><br>
<span class="lineno"></span><span class="comment" id="4110908">//&nbsp;characters,&nbsp;regardless&nbsp;of&nbsp;host&nbsp;operating&nbsp;system&nbsp;convention.</span><br>
<span class="lineno"></span><span class="keyword" id="4110971">type</span>&nbsp;<span class="ident" id="4110976">FileSystem</span>&nbsp;<span class="keyword" id="4110987">interface</span>&nbsp;<span class="op" id="4110997">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111000">Open</span><span class="op" id="4111004">(</span><span class="ident" id="4111005">name</span>&nbsp;<span class="builtintype" id="4111010">string</span><span class="op" id="4111016">)</span>&nbsp;<span class="op" id="4111018">(</span><span class="ident" id="4111019"><a href="/gostd/net/http/fs.go.html#4111213">File</a></span><span class="op" id="4111023">,</span>&nbsp;<span class="builtintype" id="4111025">error</span><span class="op" id="4111030">)</span><br>
<span class="lineno"></span><span class="op" id="4111032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4111035">//&nbsp;A&nbsp;File&nbsp;is&nbsp;returned&nbsp;by&nbsp;a&nbsp;FileSystem&#39;s&nbsp;Open&nbsp;method&nbsp;and&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4111098">//&nbsp;served&nbsp;by&nbsp;the&nbsp;FileServer&nbsp;implementation.</span><br>
<span class="lineno">60</span><span class="comment" id="4111142">//</span><br>
<span class="lineno"></span><span class="comment" id="4111145">//&nbsp;The&nbsp;methods&nbsp;should&nbsp;behave&nbsp;the&nbsp;same&nbsp;as&nbsp;those&nbsp;on&nbsp;an&nbsp;*os.File.</span><br>
<span class="lineno"></span><span class="keyword" id="4111208">type</span>&nbsp;<span class="ident" id="4111213">File</span>&nbsp;<span class="keyword" id="4111218">interface</span>&nbsp;<span class="op" id="4111228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111231"><a href="/gostd/net/http/fs.go.html#4109855">io</a></span><span class="op" id="4111233">.</span><span class="ident" id="4111234"><a href="/gostd/io/io.go.html#1422563">Closer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111242"><a href="/gostd/net/http/fs.go.html#4109855">io</a></span><span class="op" id="4111244">.</span><span class="ident" id="4111245"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111253">Readdir</span><span class="op" id="4111260">(</span><span class="ident" id="4111261">count</span>&nbsp;<span class="builtintype" id="4111267">int</span><span class="op" id="4111270">)</span>&nbsp;<span class="op" id="4111272">(</span><span class="op" id="4111273">[</span><span class="op" id="4111274">]</span><span class="ident" id="4111275"><a href="/gostd/net/http/fs.go.html#4109915">os</a></span><span class="op" id="4111277">.</span><span class="ident" id="4111278"><a href="/gostd/os/types.go.html#2472460">FileInfo</a></span><span class="op" id="4111286">,</span>&nbsp;<span class="builtintype" id="4111288">error</span><span class="op" id="4111293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111296">Seek</span><span class="op" id="4111300">(</span><span class="ident" id="4111301">offset</span>&nbsp;<span class="builtintype" id="4111308">int64</span><span class="op" id="4111313">,</span>&nbsp;<span class="ident" id="4111315">whence</span>&nbsp;<span class="builtintype" id="4111322">int</span><span class="op" id="4111325">)</span>&nbsp;<span class="op" id="4111327">(</span><span class="builtintype" id="4111328">int64</span><span class="op" id="4111333">,</span>&nbsp;<span class="builtintype" id="4111335">error</span><span class="op" id="4111340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111343">Stat</span><span class="op" id="4111347">(</span><span class="op" id="4111348">)</span>&nbsp;<span class="op" id="4111350">(</span><span class="ident" id="4111351"><a href="/gostd/net/http/fs.go.html#4109915">os</a></span><span class="op" id="4111353">.</span><span class="ident" id="4111354"><a href="/gostd/os/types.go.html#2472460">FileInfo</a></span><span class="op" id="4111362">,</span>&nbsp;<span class="builtintype" id="4111364">error</span><span class="op" id="4111369">)</span><br>
<span class="lineno"></span><span class="op" id="4111371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="4111374">func</span>&nbsp;<span class="ident" id="4111379">dirList</span><span class="op" id="4111386">(</span><span class="ident" id="4111387">w</span>&nbsp;<span class="ident" id="4111389"><a href="/gostd/net/http/server.go.html#4170569">ResponseWriter</a></span><span class="op" id="4111403">,</span>&nbsp;<span class="ident" id="4111405">f</span>&nbsp;<span class="ident" id="4111407"><a href="/gostd/net/http/fs.go.html#4111213">File</a></span><span class="op" id="4111411">)</span>&nbsp;<span class="op" id="4111413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111416"><a href="/gostd/net/http/fs.go.html#4111387">w</a></span><span class="op" id="4111417">.</span><span class="ident" id="4111418"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="4111424">(</span><span class="op" id="4111425">)</span><span class="op" id="4111426">.</span><span class="ident" id="4111427"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="4111430">(</span><span class="string" id="4111431">&#34;Content-Type&#34;</span><span class="op" id="4111445">,</span>&nbsp;<span class="string" id="4111447">&#34;text/html;&nbsp;charset=utf-8&#34;</span><span class="op" id="4111473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111476"><a href="/gostd/net/http/fs.go.html#4109848">fmt</a></span><span class="op" id="4111479">.</span><span class="ident" id="4111480"><a href="/gostd/fmt/print.go.html#2143118">Fprintf</a></span><span class="op" id="4111487">(</span><span class="ident" id="4111488"><a href="/gostd/net/http/fs.go.html#4111387">w</a></span><span class="op" id="4111489">,</span>&nbsp;<span class="string" id="4111491">&#34;&lt;pre&gt;\n&#34;</span><span class="op" id="4111500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111503">for</span>&nbsp;<span class="op" id="4111507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111511">dirs</span><span class="op" id="4111515">,</span>&nbsp;<span class="ident" id="4111517">err</span>&nbsp;<span class="op" id="4111521">:=</span>&nbsp;<span class="ident" id="4111524"><a href="/gostd/net/http/fs.go.html#4111405">f</a></span><span class="op" id="4111525">.</span><span class="ident" id="4111526"><a href="/gostd/net/http/fs.go.html#4111253">Readdir</a></span><span class="op" id="4111533">(</span><span class="num" id="4111534">100</span><span class="op" id="4111537">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111541">if</span>&nbsp;<span class="ident" id="4111544"><a href="/gostd/net/http/fs.go.html#4111517">err</a></span>&nbsp;<span class="op" id="4111548">!=</span>&nbsp;<span class="builtintype" id="4111551">nil</span>&nbsp;<span class="op" id="4111555">||</span>&nbsp;<span class="builtinfunc" id="4111558">len</span><span class="op" id="4111561">(</span><span class="ident" id="4111562"><a href="/gostd/net/http/fs.go.html#4111511">dirs</a></span><span class="op" id="4111566">)</span>&nbsp;<span class="op" id="4111568">==</span>&nbsp;<span class="num" id="4111571">0</span>&nbsp;<span class="op" id="4111573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111578">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4111586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111590">for</span>&nbsp;<span class="ident" id="4111594">_</span><span class="op" id="4111595">,</span>&nbsp;<span class="ident" id="4111597">d</span>&nbsp;<span class="op" id="4111599">:=</span>&nbsp;<span class="keyword" id="4111602">range</span>&nbsp;<span class="ident" id="4111608"><a href="/gostd/net/http/fs.go.html#4111511">dirs</a></span>&nbsp;<span class="op" id="4111613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111618">name</span>&nbsp;<span class="op" id="4111623">:=</span>&nbsp;<span class="ident" id="4111626"><a href="/gostd/net/http/fs.go.html#4111597">d</a></span><span class="op" id="4111627">.</span><span class="ident" id="4111628"><a href="/gostd/os/types.go.html#2472482">Name</a></span><span class="op" id="4111632">(</span><span class="op" id="4111633">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111638">if</span>&nbsp;<span class="ident" id="4111641"><a href="/gostd/net/http/fs.go.html#4111597">d</a></span><span class="op" id="4111642">.</span><span class="ident" id="4111643"><a href="/gostd/os/types.go.html#2472696">IsDir</a></span><span class="op" id="4111648">(</span><span class="op" id="4111649">)</span>&nbsp;<span class="op" id="4111651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111657"><a href="/gostd/net/http/fs.go.html#4111618">name</a></span>&nbsp;<span class="op" id="4111662">+=</span>&nbsp;<span class="string" id="4111665">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4111672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4111677">//&nbsp;name&nbsp;may&nbsp;contain&nbsp;&#39;?&#39;&nbsp;or&nbsp;&#39;#&#39;,&nbsp;which&nbsp;must&nbsp;be&nbsp;escaped&nbsp;to&nbsp;remain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4111744">//&nbsp;part&nbsp;of&nbsp;the&nbsp;URL&nbsp;path,&nbsp;and&nbsp;not&nbsp;indicate&nbsp;the&nbsp;start&nbsp;of&nbsp;a&nbsp;query</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4111810">//&nbsp;string&nbsp;or&nbsp;fragment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111836">url</span>&nbsp;<span class="op" id="4111840">:=</span>&nbsp;<span class="ident" id="4111843"><a href="/gostd/net/http/fs.go.html#4109904">url</a></span><span class="op" id="4111846">.</span><span class="ident" id="4111847"><a href="/gostd/net/url/url.go.html#3751194">URL</a></span><span class="op" id="4111850">{</span><span class="ident" id="4111851"><a href="/gostd/net/url/url.go.html#3751366">Path</a></span><span class="op" id="4111855">:</span>&nbsp;<span class="ident" id="4111857"><a href="/gostd/net/http/fs.go.html#4111618">name</a></span><span class="op" id="4111861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111866"><a href="/gostd/net/http/fs.go.html#4109848">fmt</a></span><span class="op" id="4111869">.</span><span class="ident" id="4111870"><a href="/gostd/fmt/print.go.html#2143118">Fprintf</a></span><span class="op" id="4111877">(</span><span class="ident" id="4111878"><a href="/gostd/net/http/fs.go.html#4111387">w</a></span><span class="op" id="4111879">,</span>&nbsp;<span class="string" id="4111881">&#34;&lt;a&nbsp;href=\&#34;%s\&#34;&gt;%s&lt;/a&gt;\n&#34;</span><span class="op" id="4111906">,</span>&nbsp;<span class="ident" id="4111908"><a href="/gostd/net/http/fs.go.html#4111836">url</a></span><span class="op" id="4111911">.</span><span class="ident" id="4111912"><a href="/gostd/net/url/url.go.html#3757924">String</a></span><span class="op" id="4111918">(</span><span class="op" id="4111919">)</span><span class="op" id="4111920">,</span>&nbsp;<span class="ident" id="4111922"><a href="/gostd/net/http/server.go.html#4208927">htmlReplacer</a></span><span class="op" id="4111934">.</span><span class="ident" id="4111935"><a href="/gostd/strings/replace.go.html#2950171">Replace</a></span><span class="op" id="4111942">(</span><span class="ident" id="4111943"><a href="/gostd/net/http/fs.go.html#4111618">name</a></span><span class="op" id="4111947">)</span><span class="op" id="4111948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4111952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4111955">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111958"><a href="/gostd/net/http/fs.go.html#4109848">fmt</a></span><span class="op" id="4111961">.</span><span class="ident" id="4111962"><a href="/gostd/fmt/print.go.html#2143118">Fprintf</a></span><span class="op" id="4111969">(</span><span class="ident" id="4111970"><a href="/gostd/net/http/fs.go.html#4111387">w</a></span><span class="op" id="4111971">,</span>&nbsp;<span class="string" id="4111973">&#34;&lt;/pre&gt;\n&#34;</span><span class="op" id="4111983">)</span><br>
<span class="lineno"></span><span class="op" id="4111985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4111988">//&nbsp;ServeContent&nbsp;replies&nbsp;to&nbsp;the&nbsp;request&nbsp;using&nbsp;the&nbsp;content&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4112052">//&nbsp;provided&nbsp;ReadSeeker.&nbsp;&nbsp;The&nbsp;main&nbsp;benefit&nbsp;of&nbsp;ServeContent&nbsp;over&nbsp;io.Copy</span><br>
<span class="lineno">95</span><span class="comment" id="4112123">//&nbsp;is&nbsp;that&nbsp;it&nbsp;handles&nbsp;Range&nbsp;requests&nbsp;properly,&nbsp;sets&nbsp;the&nbsp;MIME&nbsp;type,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4112194">//&nbsp;handles&nbsp;If-Modified-Since&nbsp;requests.</span><br>
<span class="lineno"></span><span class="comment" id="4112233">//</span><br>
<span class="lineno"></span><span class="comment" id="4112236">//&nbsp;If&nbsp;the&nbsp;response&#39;s&nbsp;Content-Type&nbsp;header&nbsp;is&nbsp;not&nbsp;set,&nbsp;ServeContent</span><br>
<span class="lineno"></span><span class="comment" id="4112302">//&nbsp;first&nbsp;tries&nbsp;to&nbsp;deduce&nbsp;the&nbsp;type&nbsp;from&nbsp;name&#39;s&nbsp;file&nbsp;extension&nbsp;and,</span><br>
<span class="lineno">100</span><span class="comment" id="4112368">//&nbsp;if&nbsp;that&nbsp;fails,&nbsp;falls&nbsp;back&nbsp;to&nbsp;reading&nbsp;the&nbsp;first&nbsp;block&nbsp;of&nbsp;the&nbsp;content</span><br>
<span class="lineno"></span><span class="comment" id="4112439">//&nbsp;and&nbsp;passing&nbsp;it&nbsp;to&nbsp;DetectContentType.</span><br>
<span class="lineno"></span><span class="comment" id="4112479">//&nbsp;The&nbsp;name&nbsp;is&nbsp;otherwise&nbsp;unused;&nbsp;in&nbsp;particular&nbsp;it&nbsp;can&nbsp;be&nbsp;empty&nbsp;and&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4112549">//&nbsp;never&nbsp;sent&nbsp;in&nbsp;the&nbsp;response.</span><br>
<span class="lineno"></span><span class="comment" id="4112580">//</span><br>
<span class="lineno">105</span><span class="comment" id="4112583">//&nbsp;If&nbsp;modtime&nbsp;is&nbsp;not&nbsp;the&nbsp;zero&nbsp;time,&nbsp;ServeContent&nbsp;includes&nbsp;it&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4112649">//&nbsp;Last-Modified&nbsp;header&nbsp;in&nbsp;the&nbsp;response.&nbsp;&nbsp;If&nbsp;the&nbsp;request&nbsp;includes&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="4112718">//&nbsp;If-Modified-Since&nbsp;header,&nbsp;ServeContent&nbsp;uses&nbsp;modtime&nbsp;to&nbsp;decide</span><br>
<span class="lineno"></span><span class="comment" id="4112783">//&nbsp;whether&nbsp;the&nbsp;content&nbsp;needs&nbsp;to&nbsp;be&nbsp;sent&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span><span class="comment" id="4112831">//</span><br>
<span class="lineno">110</span><span class="comment" id="4112834">//&nbsp;The&nbsp;content&#39;s&nbsp;Seek&nbsp;method&nbsp;must&nbsp;work:&nbsp;ServeContent&nbsp;uses</span><br>
<span class="lineno"></span><span class="comment" id="4112892">//&nbsp;a&nbsp;seek&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;content&nbsp;to&nbsp;determine&nbsp;its&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="4112951">//</span><br>
<span class="lineno"></span><span class="comment" id="4112954">//&nbsp;If&nbsp;the&nbsp;caller&nbsp;has&nbsp;set&nbsp;w&#39;s&nbsp;ETag&nbsp;header,&nbsp;ServeContent&nbsp;uses&nbsp;it&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4113020">//&nbsp;handle&nbsp;requests&nbsp;using&nbsp;If-Range&nbsp;and&nbsp;If-None-Match.</span><br>
<span class="lineno">115</span><span class="comment" id="4113073">//</span><br>
<span class="lineno"></span><span class="comment" id="4113076">//&nbsp;Note&nbsp;that&nbsp;*os.File&nbsp;implements&nbsp;the&nbsp;io.ReadSeeker&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4113138">func</span>&nbsp;<span class="ident" id="4113143">ServeContent</span><span class="op" id="4113155">(</span><span class="ident" id="4113156">w</span>&nbsp;<span class="ident" id="4113158"><a href="/gostd/net/http/server.go.html#4170569">ResponseWriter</a></span><span class="op" id="4113172">,</span>&nbsp;<span class="ident" id="4113174">req</span>&nbsp;<span class="op" id="4113178">*</span><span class="ident" id="4113179"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4113186">,</span>&nbsp;<span class="ident" id="4113188">name</span>&nbsp;<span class="builtintype" id="4113193">string</span><span class="op" id="4113199">,</span>&nbsp;<span class="ident" id="4113201">modtime</span>&nbsp;<span class="ident" id="4113209"><a href="/gostd/net/http/fs.go.html#4109968">time</a></span><span class="op" id="4113213">.</span><span class="ident" id="4113214"><a href="/gostd/time/time.go.html#2722087">Time</a></span><span class="op" id="4113218">,</span>&nbsp;<span class="ident" id="4113220">content</span>&nbsp;<span class="ident" id="4113228"><a href="/gostd/net/http/fs.go.html#4109855">io</a></span><span class="op" id="4113230">.</span><span class="ident" id="4113231"><a href="/gostd/io/io.go.html#1423813">ReadSeeker</a></span><span class="op" id="4113241">)</span>&nbsp;<span class="op" id="4113243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4113246">sizeFunc</span>&nbsp;<span class="op" id="4113255">:=</span>&nbsp;<span class="keyword" id="4113258">func</span><span class="op" id="4113262">(</span><span class="op" id="4113263">)</span>&nbsp;<span class="op" id="4113265">(</span><span class="builtintype" id="4113266">int64</span><span class="op" id="4113271">,</span>&nbsp;<span class="builtintype" id="4113273">error</span><span class="op" id="4113278">)</span>&nbsp;<span class="op" id="4113280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4113284">size</span><span class="op" id="4113288">,</span>&nbsp;<span class="ident" id="4113290">err</span>&nbsp;<span class="op" id="4113294">:=</span>&nbsp;<span class="ident" id="4113297"><a href="/gostd/net/http/fs.go.html#4113220">content</a></span><span class="op" id="4113304">.</span><span class="ident" id="4113305"><a href="/gostd/io/io.go.html#1423159">Seek</a></span><span class="op" id="4113309">(</span><span class="num" id="4113310">0</span><span class="op" id="4113311">,</span>&nbsp;<span class="ident" id="4113313"><a href="/gostd/net/http/fs.go.html#4109915">os</a></span><span class="op" id="4113315">.</span><span class="ident" id="4113316"><a href="/gostd/os/file.go.html#2442749">SEEK_END</a></span><span class="op" id="4113324">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4113328">if</span>&nbsp;<span class="ident" id="4113331"><a href="/gostd/net/http/fs.go.html#4113290">err</a></span>&nbsp;<span class="op" id="4113335">!=</span>&nbsp;<span class="builtintype" id="4113338">nil</span>&nbsp;<span class="op" id="4113342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4113347">return</span>&nbsp;<span class="num" id="4113354">0</span><span class="op" id="4113355">,</span>&nbsp;<span class="ident" id="4113357"><a href="/gostd/net/http/fs.go.html#4113755">errSeeker</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4113369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4113373">_</span><span class="op" id="4113374">,</span>&nbsp;<span class="ident" id="4113376"><a href="/gostd/net/http/fs.go.html#4113290">err</a></span>&nbsp;<span class="op" id="4113380">=</span>&nbsp;<span class="ident" id="4113382"><a href="/gostd/net/http/fs.go.html#4113220">content</a></span><span class="op" id="4113389">.</span><span class="ident" id="4113390"><a href="/gostd/io/io.go.html#1423159">Seek</a></span><span class="op" id="4113394">(</span><span class="num" id="4113395">0</span><span class="op" id="4113396">,</span>&nbsp;<span class="ident" id="4113398"><a href="/gostd/net/http/fs.go.html#4109915">os</a></span><span class="op" id="4113400">.</span><span class="ident" id="4113401"><a href="/gostd/os/file.go.html#2442631">SEEK_SET</a></span><span class="op" id="4113409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4113413">if</span>&nbsp;<span class="ident" id="4113416"><a href="/gostd/net/http/fs.go.html#4113290">err</a></span>&nbsp;<span class="op" id="4113420">!=</span>&nbsp;<span class="builtintype" id="4113423">nil</span>&nbsp;<span class="op" id="4113427">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4113432">return</span>&nbsp;<span class="num" id="4113439">0</span><span class="op" id="4113440">,</span>&nbsp;<span class="ident" id="4113442"><a href="/gostd/net/http/fs.go.html#4113755">errSeeker</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4113454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4113458">return</span>&nbsp;<span class="ident" id="4113465"><a href="/gostd/net/http/fs.go.html#4113284">size</a></span><span class="op" id="4113469">,</span>&nbsp;<span class="builtintype" id="4113471">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4113476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4113479"><a href="/gostd/net/http/fs.go.html#4114074">serveContent</a></span><span class="op" id="4113491">(</span><span class="ident" id="4113492"><a href="/gostd/net/http/fs.go.html#4113156">w</a></span><span class="op" id="4113493">,</span>&nbsp;<span class="ident" id="4113495"><a href="/gostd/net/http/fs.go.html#4113174">req</a></span><span class="op" id="4113498">,</span>&nbsp;<span class="ident" id="4113500"><a href="/gostd/net/http/fs.go.html#4113188">name</a></span><span class="op" id="4113504">,</span>&nbsp;<span class="ident" id="4113506"><a href="/gostd/net/http/fs.go.html#4113201">modtime</a></span><span class="op" id="4113513">,</span>&nbsp;<span class="ident" id="4113515"><a href="/gostd/net/http/fs.go.html#4113246">sizeFunc</a></span><span class="op" id="4113523">,</span>&nbsp;<span class="ident" id="4113525"><a href="/gostd/net/http/fs.go.html#4113220">content</a></span><span class="op" id="4113532">)</span><br>
<span class="lineno">130</span><span class="op" id="4113534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4113537">//&nbsp;errSeeker&nbsp;is&nbsp;returned&nbsp;by&nbsp;ServeContent&#39;s&nbsp;sizeFunc&nbsp;when&nbsp;the&nbsp;content</span><br>
<span class="lineno"></span><span class="comment" id="4113606">//&nbsp;doesn&#39;t&nbsp;seek&nbsp;properly.&nbsp;The&nbsp;underlying&nbsp;Seeker&#39;s&nbsp;error&nbsp;text&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="4113673">//&nbsp;included&nbsp;in&nbsp;the&nbsp;sizeFunc&nbsp;reply&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;sent&nbsp;over&nbsp;HTTP&nbsp;to&nbsp;end</span><br>
<span class="lineno">135</span><span class="comment" id="4113741">//&nbsp;users.</span><br>
<span class="lineno"></span><span class="keyword" id="4113751">var</span>&nbsp;<span class="ident" id="4113755">errSeeker</span>&nbsp;<span class="op" id="4113765">=</span>&nbsp;<span class="ident" id="4113767"><a href="/gostd/net/http/fs.go.html#4109838">errors</a></span><span class="op" id="4113773">.</span><span class="ident" id="4113774"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4113777">(</span><span class="string" id="4113778">&#34;seeker&nbsp;can&#39;t&nbsp;seek&#34;</span><span class="op" id="4113797">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4113800">//&nbsp;if&nbsp;name&nbsp;is&nbsp;empty,&nbsp;filename&nbsp;is&nbsp;unknown.&nbsp;(used&nbsp;for&nbsp;mime&nbsp;type,&nbsp;before&nbsp;sniffing)</span><br>
<span class="lineno"></span><span class="comment" id="4113880">//&nbsp;if&nbsp;modtime.IsZero(),&nbsp;modtime&nbsp;is&nbsp;unknown.</span><br>
<span class="lineno">140</span><span class="comment" id="4113924">//&nbsp;content&nbsp;must&nbsp;be&nbsp;seeked&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="4113980">//&nbsp;The&nbsp;sizeFunc&nbsp;is&nbsp;called&nbsp;at&nbsp;most&nbsp;once.&nbsp;Its&nbsp;error,&nbsp;if&nbsp;any,&nbsp;is&nbsp;sent&nbsp;in&nbsp;the&nbsp;HTTP&nbsp;response.</span><br>
<span class="lineno"></span><span class="keyword" id="4114069">func</span>&nbsp;<span class="ident" id="4114074">serveContent</span><span class="op" id="4114086">(</span><span class="ident" id="4114087">w</span>&nbsp;<span class="ident" id="4114089"><a href="/gostd/net/http/server.go.html#4170569">ResponseWriter</a></span><span class="op" id="4114103">,</span>&nbsp;<span class="ident" id="4114105">r</span>&nbsp;<span class="op" id="4114107">*</span><span class="ident" id="4114108"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4114115">,</span>&nbsp;<span class="ident" id="4114117">name</span>&nbsp;<span class="builtintype" id="4114122">string</span><span class="op" id="4114128">,</span>&nbsp;<span class="ident" id="4114130">modtime</span>&nbsp;<span class="ident" id="4114138"><a href="/gostd/net/http/fs.go.html#4109968">time</a></span><span class="op" id="4114142">.</span><span class="ident" id="4114143"><a href="/gostd/time/time.go.html#2722087">Time</a></span><span class="op" id="4114147">,</span>&nbsp;<span class="ident" id="4114149">sizeFunc</span>&nbsp;<span class="keyword" id="4114158">func</span><span class="op" id="4114162">(</span><span class="op" id="4114163">)</span>&nbsp;<span class="op" id="4114165">(</span><span class="builtintype" id="4114166">int64</span><span class="op" id="4114171">,</span>&nbsp;<span class="builtintype" id="4114173">error</span><span class="op" id="4114178">)</span><span class="op" id="4114179">,</span>&nbsp;<span class="ident" id="4114181">content</span>&nbsp;<span class="ident" id="4114189"><a href="/gostd/net/http/fs.go.html#4109855">io</a></span><span class="op" id="4114191">.</span><span class="ident" id="4114192"><a href="/gostd/io/io.go.html#1423813">ReadSeeker</a></span><span class="op" id="4114202">)</span>&nbsp;<span class="op" id="4114204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114207">if</span>&nbsp;<span class="ident" id="4114210"><a href="/gostd/net/http/fs.go.html#4117704">checkLastModified</a></span><span class="op" id="4114227">(</span><span class="ident" id="4114228"><a href="/gostd/net/http/fs.go.html#4114087">w</a></span><span class="op" id="4114229">,</span>&nbsp;<span class="ident" id="4114231"><a href="/gostd/net/http/fs.go.html#4114105">r</a></span><span class="op" id="4114232">,</span>&nbsp;<span class="ident" id="4114234"><a href="/gostd/net/http/fs.go.html#4114130">modtime</a></span><span class="op" id="4114241">)</span>&nbsp;<span class="op" id="4114243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114247">return</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4114255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114258">rangeReq</span><span class="op" id="4114266">,</span>&nbsp;<span class="ident" id="4114268">done</span>&nbsp;<span class="op" id="4114273">:=</span>&nbsp;<span class="ident" id="4114276"><a href="/gostd/net/http/fs.go.html#4118666">checkETag</a></span><span class="op" id="4114285">(</span><span class="ident" id="4114286"><a href="/gostd/net/http/fs.go.html#4114087">w</a></span><span class="op" id="4114287">,</span>&nbsp;<span class="ident" id="4114289"><a href="/gostd/net/http/fs.go.html#4114105">r</a></span><span class="op" id="4114290">,</span>&nbsp;<span class="ident" id="4114292"><a href="/gostd/net/http/fs.go.html#4114130">modtime</a></span><span class="op" id="4114299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114302">if</span>&nbsp;<span class="ident" id="4114305"><a href="/gostd/net/http/fs.go.html#4114268">done</a></span>&nbsp;<span class="op" id="4114310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114314">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4114322">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114326">code</span>&nbsp;<span class="op" id="4114331">:=</span>&nbsp;<span class="ident" id="4114334"><a href="/gostd/net/http/status.go.html#4236210">StatusOK</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4114345">//&nbsp;If&nbsp;Content-Type&nbsp;isn&#39;t&nbsp;set,&nbsp;use&nbsp;the&nbsp;file&#39;s&nbsp;extension&nbsp;to&nbsp;find&nbsp;it,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4114417">//&nbsp;if&nbsp;the&nbsp;Content-Type&nbsp;is&nbsp;unset&nbsp;explicitly,&nbsp;do&nbsp;not&nbsp;sniff&nbsp;the&nbsp;type.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114485">ctypes</span><span class="op" id="4114491">,</span>&nbsp;<span class="ident" id="4114493">haveType</span>&nbsp;<span class="op" id="4114502">:=</span>&nbsp;<span class="ident" id="4114505"><a href="/gostd/net/http/fs.go.html#4114087">w</a></span><span class="op" id="4114506">.</span><span class="ident" id="4114507"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="4114513">(</span><span class="op" id="4114514">)</span><span class="op" id="4114515">[</span><span class="string" id="4114516">&#34;Content-Type&#34;</span><span class="op" id="4114530">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114533">var</span>&nbsp;<span class="ident" id="4114537">ctype</span>&nbsp;<span class="builtintype" id="4114543">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114551">if</span>&nbsp;<span class="op" id="4114554">!</span><span class="ident" id="4114555"><a href="/gostd/net/http/fs.go.html#4114493">haveType</a></span>&nbsp;<span class="op" id="4114564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114568"><a href="/gostd/net/http/fs.go.html#4114537">ctype</a></span>&nbsp;<span class="op" id="4114574">=</span>&nbsp;<span class="ident" id="4114576"><a href="/gostd/net/http/fs.go.html#4109861">mime</a></span><span class="op" id="4114580">.</span><span class="ident" id="4114581"><a href="/gostd/mime/type.go.html#4304594">TypeByExtension</a></span><span class="op" id="4114596">(</span><span class="ident" id="4114597"><a href="/gostd/net/http/fs.go.html#4109929">filepath</a></span><span class="op" id="4114605">.</span><span class="ident" id="4114606"><a href="/gostd/path/filepath/path.go.html#3783932">Ext</a></span><span class="op" id="4114609">(</span><span class="ident" id="4114610"><a href="/gostd/net/http/fs.go.html#4114117">name</a></span><span class="op" id="4114614">)</span><span class="op" id="4114615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114619">if</span>&nbsp;<span class="ident" id="4114622"><a href="/gostd/net/http/fs.go.html#4114537">ctype</a></span>&nbsp;<span class="op" id="4114628">==</span>&nbsp;<span class="string" id="4114631">&#34;&#34;</span>&nbsp;<span class="op" id="4114634">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4114639">//&nbsp;read&nbsp;a&nbsp;chunk&nbsp;to&nbsp;decide&nbsp;between&nbsp;utf-8&nbsp;text&nbsp;and&nbsp;binary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114698">var</span>&nbsp;<span class="ident" id="4114702">buf</span>&nbsp;<span class="op" id="4114706">[</span><span class="ident" id="4114707"><a href="/gostd/net/http/sniff.go.html#4230912">sniffLen</a></span><span class="op" id="4114715">]</span><span class="builtintype" id="4114716">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114724">n</span><span class="op" id="4114725">,</span>&nbsp;<span class="ident" id="4114727">_</span>&nbsp;<span class="op" id="4114729">:=</span>&nbsp;<span class="ident" id="4114732"><a href="/gostd/net/http/fs.go.html#4109855">io</a></span><span class="op" id="4114734">.</span><span class="ident" id="4114735"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="4114743">(</span><span class="ident" id="4114744"><a href="/gostd/net/http/fs.go.html#4114181">content</a></span><span class="op" id="4114751">,</span>&nbsp;<span class="ident" id="4114753"><a href="/gostd/net/http/fs.go.html#4114702">buf</a></span><span class="op" id="4114756">[</span><span class="op" id="4114757">:</span><span class="op" id="4114758">]</span><span class="op" id="4114759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114764"><a href="/gostd/net/http/fs.go.html#4114537">ctype</a></span>&nbsp;<span class="op" id="4114770">=</span>&nbsp;<span class="ident" id="4114772"><a href="/gostd/net/http/sniff.go.html#4231277">DetectContentType</a></span><span class="op" id="4114789">(</span><span class="ident" id="4114790"><a href="/gostd/net/http/fs.go.html#4114702">buf</a></span><span class="op" id="4114793">[</span><span class="op" id="4114794">:</span><span class="ident" id="4114795"><a href="/gostd/net/http/fs.go.html#4114724">n</a></span><span class="op" id="4114796">]</span><span class="op" id="4114797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114802">_</span><span class="op" id="4114803">,</span>&nbsp;<span class="ident" id="4114805">err</span>&nbsp;<span class="op" id="4114809">:=</span>&nbsp;<span class="ident" id="4114812"><a href="/gostd/net/http/fs.go.html#4114181">content</a></span><span class="op" id="4114819">.</span><span class="ident" id="4114820"><a href="/gostd/io/io.go.html#1423159">Seek</a></span><span class="op" id="4114824">(</span><span class="num" id="4114825">0</span><span class="op" id="4114826">,</span>&nbsp;<span class="ident" id="4114828"><a href="/gostd/net/http/fs.go.html#4109915">os</a></span><span class="op" id="4114830">.</span><span class="ident" id="4114831"><a href="/gostd/os/file.go.html#2442631">SEEK_SET</a></span><span class="op" id="4114839">)</span>&nbsp;<span class="comment" id="4114841">//&nbsp;rewind&nbsp;to&nbsp;output&nbsp;whole&nbsp;file</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114875">if</span>&nbsp;<span class="ident" id="4114878"><a href="/gostd/net/http/fs.go.html#4114805">err</a></span>&nbsp;<span class="op" id="4114882">!=</span>&nbsp;<span class="builtintype" id="4114885">nil</span>&nbsp;<span class="op" id="4114889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114895"><a href="/gostd/net/http/server.go.html#4205918">Error</a></span><span class="op" id="4114900">(</span><span class="ident" id="4114901"><a href="/gostd/net/http/fs.go.html#4114087">w</a></span><span class="op" id="4114902">,</span>&nbsp;<span class="string" id="4114904">&#34;seeker&nbsp;can&#39;t&nbsp;seek&#34;</span><span class="op" id="4114923">,</span>&nbsp;<span class="ident" id="4114925"><a href="/gostd/net/http/status.go.html#4237466">StatusInternalServerError</a></span><span class="op" id="4114950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4114956">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4114966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4114970">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4114974"><a href="/gostd/net/http/fs.go.html#4114087">w</a></span><span class="op" id="4114975">.</span><span class="ident" id="4114976"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="4114982">(</span><span class="op" id="4114983">)</span><span class="op" id="4114984">.</span><span class="ident" id="4114985"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="4114988">(</span><span class="string" id="4114989">&#34;Content-Type&#34;</span><span class="op" id="4115003">,</span>&nbsp;<span class="ident" id="4115005"><a href="/gostd/net/http/fs.go.html#4114537">ctype</a></span><span class="op" id="4115010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4115013">}</span>&nbsp;<span class="keyword" id="4115015">else</span>&nbsp;<span class="keyword" id="4115020">if</span>&nbsp;<span class="builtinfunc" id="4115023">len</span><span class="op" id="4115026">(</span><span class="ident" id="4115027"><a href="/gostd/net/http/fs.go.html#4114485">ctypes</a></span><span class="op" id="4115033">)</span>&nbsp;<span class="op" id="4115035">&gt;</span>&nbsp;<span class="num" id="4115037">0</span>&nbsp;<span class="op" id="4115039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115043"><a href="/gostd/net/http/fs.go.html#4114537">ctype</a></span>&nbsp;<span class="op" id="4115049">=</span>&nbsp;<span class="ident" id="4115051"><a href="/gostd/net/http/fs.go.html#4114485">ctypes</a></span><span class="op" id="4115057">[</span><span class="num" id="4115058">0</span><span class="op" id="4115059">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4115062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115066">size</span><span class="op" id="4115070">,</span>&nbsp;<span class="ident" id="4115072">err</span>&nbsp;<span class="op" id="4115076">:=</span>&nbsp;<span class="ident" id="4115079"><a href="/gostd/net/http/fs.go.html#4114149">sizeFunc</a></span><span class="op" id="4115087">(</span><span class="op" id="4115088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115091">if</span>&nbsp;<span class="ident" id="4115094"><a href="/gostd/net/http/fs.go.html#4115072">err</a></span>&nbsp;<span class="op" id="4115098">!=</span>&nbsp;<span class="builtintype" id="4115101">nil</span>&nbsp;<span class="op" id="4115105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115109"><a href="/gostd/net/http/server.go.html#4205918">Error</a></span><span class="op" id="4115114">(</span><span class="ident" id="4115115"><a href="/gostd/net/http/fs.go.html#4114087">w</a></span><span class="op" id="4115116">,</span>&nbsp;<span class="ident" id="4115118"><a href="/gostd/net/http/fs.go.html#4115072">err</a></span><span class="op" id="4115121">.</span><span class="ident" id="4115122">Error</span><span class="op" id="4115127">(</span><span class="op" id="4115128">)</span><span class="op" id="4115129">,</span>&nbsp;<span class="ident" id="4115131"><a href="/gostd/net/http/status.go.html#4237466">StatusInternalServerError</a></span><span class="op" id="4115156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115160">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4115168">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115172">//&nbsp;handle&nbsp;Content-Range&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115205">sendSize</span>&nbsp;<span class="op" id="4115214">:=</span>&nbsp;<span class="ident" id="4115217"><a href="/gostd/net/http/fs.go.html#4115066">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115223">var</span>&nbsp;<span class="ident" id="4115227">sendContent</span>&nbsp;<span class="ident" id="4115239"><a href="/gostd/net/http/fs.go.html#4109855">io</a></span><span class="op" id="4115241">.</span><span class="ident" id="4115242"><a href="/gostd/io/io.go.html#1421823">Reader</a></span>&nbsp;<span class="op" id="4115249">=</span>&nbsp;<span class="ident" id="4115251"><a href="/gostd/net/http/fs.go.html#4114181">content</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115260">if</span>&nbsp;<span class="ident" id="4115263"><a href="/gostd/net/http/fs.go.html#4115066">size</a></span>&nbsp;<span class="op" id="4115268">&gt;=</span>&nbsp;<span class="num" id="4115271">0</span>&nbsp;<span class="op" id="4115273">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115277">ranges</span><span class="op" id="4115283">,</span>&nbsp;<span class="ident" id="4115285">err</span>&nbsp;<span class="op" id="4115289">:=</span>&nbsp;<span class="ident" id="4115292"><a href="/gostd/net/http/fs.go.html#4123623">parseRange</a></span><span class="op" id="4115302">(</span><span class="ident" id="4115303"><a href="/gostd/net/http/fs.go.html#4114258">rangeReq</a></span><span class="op" id="4115311">,</span>&nbsp;<span class="ident" id="4115313"><a href="/gostd/net/http/fs.go.html#4115066">size</a></span><span class="op" id="4115317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115321">if</span>&nbsp;<span class="ident" id="4115324"><a href="/gostd/net/http/fs.go.html#4115285">err</a></span>&nbsp;<span class="op" id="4115328">!=</span>&nbsp;<span class="builtintype" id="4115331">nil</span>&nbsp;<span class="op" id="4115335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115340"><a href="/gostd/net/http/server.go.html#4205918">Error</a></span><span class="op" id="4115345">(</span><span class="ident" id="4115346"><a href="/gostd/net/http/fs.go.html#4114087">w</a></span><span class="op" id="4115347">,</span>&nbsp;<span class="ident" id="4115349"><a href="/gostd/net/http/fs.go.html#4115285">err</a></span><span class="op" id="4115352">.</span><span class="ident" id="4115353">Error</span><span class="op" id="4115358">(</span><span class="op" id="4115359">)</span><span class="op" id="4115360">,</span>&nbsp;<span class="ident" id="4115362"><a href="/gostd/net/http/status.go.html#4237339">StatusRequestedRangeNotSatisfiable</a></span><span class="op" id="4115396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115401">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4115410">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115414">if</span>&nbsp;<span class="ident" id="4115417"><a href="/gostd/net/http/fs.go.html#4125650">sumRangesSize</a></span><span class="op" id="4115430">(</span><span class="ident" id="4115431"><a href="/gostd/net/http/fs.go.html#4115277">ranges</a></span><span class="op" id="4115437">)</span>&nbsp;<span class="op" id="4115439">&gt;</span>&nbsp;<span class="ident" id="4115441"><a href="/gostd/net/http/fs.go.html#4115066">size</a></span>&nbsp;<span class="op" id="4115446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115451">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;all&nbsp;the&nbsp;ranges</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115501">//&nbsp;is&nbsp;larger&nbsp;than&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;file&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115546">//&nbsp;itself,&nbsp;so&nbsp;this&nbsp;is&nbsp;probably&nbsp;an&nbsp;attack,&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115596">//&nbsp;dumb&nbsp;client.&nbsp;&nbsp;Ignore&nbsp;the&nbsp;range&nbsp;request.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4115642"><a href="/gostd/net/http/fs.go.html#4115277">ranges</a></span>&nbsp;<span class="op" id="4115649">=</span>&nbsp;<span class="builtintype" id="4115651">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4115657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115661">switch</span>&nbsp;<span class="op" id="4115668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4115672">case</span>&nbsp;<span class="builtinfunc" id="4115677">len</span><span class="op" id="4115680">(</span><span class="ident" id="4115681"><a href="/gostd/net/http/fs.go.html#4115277">ranges</a></span><span class="op" id="4115687">)</span>&nbsp;<span class="op" id="4115689">==</span>&nbsp;<span class="num" id="4115692">1</span><span class="op" id="4115693">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115698">//&nbsp;RFC&nbsp;2616,&nbsp;Section&nbsp;14.16:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115729">//&nbsp;&#34;When&nbsp;an&nbsp;HTTP&nbsp;message&nbsp;includes&nbsp;the&nbsp;content&nbsp;of&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115790">//&nbsp;range&nbsp;(for&nbsp;example,&nbsp;a&nbsp;response&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115846">//&nbsp;single&nbsp;range,&nbsp;or&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;a&nbsp;set&nbsp;of&nbsp;ranges</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115902">//&nbsp;that&nbsp;overlap&nbsp;without&nbsp;any&nbsp;holes),&nbsp;this&nbsp;content&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4115957">//&nbsp;transmitted&nbsp;with&nbsp;a&nbsp;Content-Range&nbsp;header,&nbsp;and&nbsp;a</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4116010">//&nbsp;Content-Length&nbsp;header&nbsp;showing&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4116066">//&nbsp;actually&nbsp;transferred.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4116094">//&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4116104">//&nbsp;A&nbsp;response&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;a&nbsp;single&nbsp;range&nbsp;MUST&nbsp;NOT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4116162">//&nbsp;be&nbsp;sent&nbsp;using&nbsp;the&nbsp;multipart/byteranges&nbsp;media&nbsp;type.&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116220">ra</span>&nbsp;<span class="op" id="4116223">:=</span>&nbsp;<span class="ident" id="4116226"><a href="/gostd/net/http/fs.go.html#4115277">ranges</a></span><span class="op" id="4116232">[</span><span class="num" id="4116233">0</span><span class="op" id="4116234">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116239">if</span>&nbsp;<span class="ident" id="4116242">_</span><span class="op" id="4116243">,</span>&nbsp;<span class="ident" id="4116245">err</span>&nbsp;<span class="op" id="4116249">:=</span>&nbsp;<span class="ident" id="4116252"><a href="/gostd/net/http/fs.go.html#4114181">content</a></span><span class="op" id="4116259">.</span><span class="ident" id="4116260"><a href="/gostd/io/io.go.html#1423159">Seek</a></span><span class="op" id="4116264">(</span><span class="ident" id="4116265"><a href="/gostd/net/http/fs.go.html#4116220">ra</a></span><span class="op" id="4116267">.</span><span class="ident" id="4116268"><a href="/gostd/net/http/fs.go.html#4123208">start</a></span><span class="op" id="4116273">,</span>&nbsp;<span class="ident" id="4116275"><a href="/gostd/net/http/fs.go.html#4109915">os</a></span><span class="op" id="4116277">.</span><span class="ident" id="4116278"><a href="/gostd/os/file.go.html#2442631">SEEK_SET</a></span><span class="op" id="4116286">)</span><span class="op" id="4116287">;</span>&nbsp;<span class="ident" id="4116289"><a href="/gostd/net/http/fs.go.html#4116245">err</a></span>&nbsp;<span class="op" id="4116293">!=</span>&nbsp;<span class="builtintype" id="4116296">nil</span>&nbsp;<span class="op" id="4116300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116306"><a href="/gostd/net/http/server.go.html#4205918">Error</a></span><span class="op" id="4116311">(</span><span class="ident" id="4116312"><a href="/gostd/net/http/fs.go.html#4114087">w</a></span><span class="op" id="4116313">,</span>&nbsp;<span class="ident" id="4116315"><a href="/gostd/net/http/fs.go.html#4116245">err</a></span><span class="op" id="4116318">.</span><span class="ident" id="4116319">Error</span><span class="op" id="4116324">(</span><span class="op" id="4116325">)</span><span class="op" id="4116326">,</span>&nbsp;<span class="ident" id="4116328"><a href="/gostd/net/http/status.go.html#4237339">StatusRequestedRangeNotSatisfiable</a></span><span class="op" id="4116362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116368">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4116378">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116383"><a href="/gostd/net/http/fs.go.html#4115205">sendSize</a></span>&nbsp;<span class="op" id="4116392">=</span>&nbsp;<span class="ident" id="4116394"><a href="/gostd/net/http/fs.go.html#4116220">ra</a></span><span class="op" id="4116396">.</span><span class="ident" id="4116397"><a href="/gostd/net/http/fs.go.html#4123215">length</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116407"><a href="/gostd/net/http/fs.go.html#4114326">code</a></span>&nbsp;<span class="op" id="4116412">=</span>&nbsp;<span class="ident" id="4116414"><a href="/gostd/net/http/status.go.html#4236414">StatusPartialContent</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116438"><a href="/gostd/net/http/fs.go.html#4114087">w</a></span><span class="op" id="4116439">.</span><span class="ident" id="4116440"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="4116446">(</span><span class="op" id="4116447">)</span><span class="op" id="4116448">.</span><span class="ident" id="4116449"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="4116452">(</span><span class="string" id="4116453">&#34;Content-Range&#34;</span><span class="op" id="4116468">,</span>&nbsp;<span class="ident" id="4116470"><a href="/gostd/net/http/fs.go.html#4116220">ra</a></span><span class="op" id="4116472">.</span><span class="ident" id="4116473"><a href="/gostd/net/http/fs.go.html#4123250">contentRange</a></span><span class="op" id="4116485">(</span><span class="ident" id="4116486"><a href="/gostd/net/http/fs.go.html#4115066">size</a></span><span class="op" id="4116490">)</span><span class="op" id="4116491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116495">case</span>&nbsp;<span class="builtinfunc" id="4116500">len</span><span class="op" id="4116503">(</span><span class="ident" id="4116504"><a href="/gostd/net/http/fs.go.html#4115277">ranges</a></span><span class="op" id="4116510">)</span>&nbsp;<span class="op" id="4116512">&gt;</span>&nbsp;<span class="num" id="4116514">1</span><span class="op" id="4116515">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116520"><a href="/gostd/net/http/fs.go.html#4115205">sendSize</a></span>&nbsp;<span class="op" id="4116529">=</span>&nbsp;<span class="ident" id="4116531"><a href="/gostd/net/http/fs.go.html#4125344">rangesMIMESize</a></span><span class="op" id="4116545">(</span><span class="ident" id="4116546"><a href="/gostd/net/http/fs.go.html#4115277">ranges</a></span><span class="op" id="4116552">,</span>&nbsp;<span class="ident" id="4116554"><a href="/gostd/net/http/fs.go.html#4114537">ctype</a></span><span class="op" id="4116559">,</span>&nbsp;<span class="ident" id="4116561"><a href="/gostd/net/http/fs.go.html#4115066">size</a></span><span class="op" id="4116565">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116570"><a href="/gostd/net/http/fs.go.html#4114326">code</a></span>&nbsp;<span class="op" id="4116575">=</span>&nbsp;<span class="ident" id="4116577"><a href="/gostd/net/http/status.go.html#4236414">StatusPartialContent</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116602">pr</span><span class="op" id="4116604">,</span>&nbsp;<span class="ident" id="4116606">pw</span>&nbsp;<span class="op" id="4116609">:=</span>&nbsp;<span class="ident" id="4116612"><a href="/gostd/net/http/fs.go.html#4109855">io</a></span><span class="op" id="4116614">.</span><span class="ident" id="4116615"><a href="/gostd/io/pipe.go.html#1440333">Pipe</a></span><span class="op" id="4116619">(</span><span class="op" id="4116620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116625">mw</span>&nbsp;<span class="op" id="4116628">:=</span>&nbsp;<span class="ident" id="4116631"><a href="/gostd/net/http/fs.go.html#4109869">multipart</a></span><span class="op" id="4116640">.</span><span class="ident" id="4116641"><a href="/gostd/mime/multipart/writer.go.html#4324179">NewWriter</a></span><span class="op" id="4116650">(</span><span class="ident" id="4116651"><a href="/gostd/net/http/fs.go.html#4116606">pw</a></span><span class="op" id="4116653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116658"><a href="/gostd/net/http/fs.go.html#4114087">w</a></span><span class="op" id="4116659">.</span><span class="ident" id="4116660"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="4116666">(</span><span class="op" id="4116667">)</span><span class="op" id="4116668">.</span><span class="ident" id="4116669"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="4116672">(</span><span class="string" id="4116673">&#34;Content-Type&#34;</span><span class="op" id="4116687">,</span>&nbsp;<span class="string" id="4116689">&#34;multipart/byteranges;&nbsp;boundary=&#34;</span><span class="op" id="4116722">+</span><span class="ident" id="4116723"><a href="/gostd/net/http/fs.go.html#4116625">mw</a></span><span class="op" id="4116725">.</span><span class="ident" id="4116726"><a href="/gostd/mime/multipart/writer.go.html#4324340">Boundary</a></span><span class="op" id="4116734">(</span><span class="op" id="4116735">)</span><span class="op" id="4116736">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116741"><a href="/gostd/net/http/fs.go.html#4115227">sendContent</a></span>&nbsp;<span class="op" id="4116753">=</span>&nbsp;<span class="ident" id="4116755"><a href="/gostd/net/http/fs.go.html#4116602">pr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116761">defer</span>&nbsp;<span class="ident" id="4116767"><a href="/gostd/net/http/fs.go.html#4116602">pr</a></span><span class="op" id="4116769">.</span><span class="ident" id="4116770"><a href="/gostd/io/pipe.go.html#1438720">Close</a></span><span class="op" id="4116775">(</span><span class="op" id="4116776">)</span>&nbsp;<span class="comment" id="4116778">//&nbsp;cause&nbsp;writing&nbsp;goroutine&nbsp;to&nbsp;fail&nbsp;and&nbsp;exit&nbsp;if&nbsp;CopyN&nbsp;doesn&#39;t&nbsp;finish.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116850">go</span>&nbsp;<span class="keyword" id="4116853">func</span><span class="op" id="4116857">(</span><span class="op" id="4116858">)</span>&nbsp;<span class="op" id="4116860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116866">for</span>&nbsp;<span class="ident" id="4116870">_</span><span class="op" id="4116871">,</span>&nbsp;<span class="ident" id="4116873">ra</span>&nbsp;<span class="op" id="4116876">:=</span>&nbsp;<span class="keyword" id="4116879">range</span>&nbsp;<span class="ident" id="4116885"><a href="/gostd/net/http/fs.go.html#4115277">ranges</a></span>&nbsp;<span class="op" id="4116892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116899">part</span><span class="op" id="4116903">,</span>&nbsp;<span class="ident" id="4116905">err</span>&nbsp;<span class="op" id="4116909">:=</span>&nbsp;<span class="ident" id="4116912"><a href="/gostd/net/http/fs.go.html#4116625">mw</a></span><span class="op" id="4116914">.</span><span class="ident" id="4116915"><a href="/gostd/mime/multipart/writer.go.html#4325830">CreatePart</a></span><span class="op" id="4116925">(</span><span class="ident" id="4116926"><a href="/gostd/net/http/fs.go.html#4116873">ra</a></span><span class="op" id="4116928">.</span><span class="ident" id="4116929"><a href="/gostd/net/http/fs.go.html#4123379">mimeHeader</a></span><span class="op" id="4116939">(</span><span class="ident" id="4116940"><a href="/gostd/net/http/fs.go.html#4114537">ctype</a></span><span class="op" id="4116945">,</span>&nbsp;<span class="ident" id="4116947"><a href="/gostd/net/http/fs.go.html#4115066">size</a></span><span class="op" id="4116951">)</span><span class="op" id="4116952">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4116959">if</span>&nbsp;<span class="ident" id="4116962"><a href="/gostd/net/http/fs.go.html#4116905">err</a></span>&nbsp;<span class="op" id="4116966">!=</span>&nbsp;<span class="builtintype" id="4116969">nil</span>&nbsp;<span class="op" id="4116973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4116981"><a href="/gostd/net/http/fs.go.html#4116606">pw</a></span><span class="op" id="4116983">.</span><span class="ident" id="4116984"><a href="/gostd/io/pipe.go.html#1439738">CloseWithError</a></span><span class="op" id="4116998">(</span><span class="ident" id="4116999"><a href="/gostd/net/http/fs.go.html#4116905">err</a></span><span class="op" id="4117002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117010">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117029">if</span>&nbsp;<span class="ident" id="4117032">_</span><span class="op" id="4117033">,</span>&nbsp;<span class="ident" id="4117035">err</span>&nbsp;<span class="op" id="4117039">:=</span>&nbsp;<span class="ident" id="4117042"><a href="/gostd/net/http/fs.go.html#4114181">content</a></span><span class="op" id="4117049">.</span><span class="ident" id="4117050"><a href="/gostd/io/io.go.html#1423159">Seek</a></span><span class="op" id="4117054">(</span><span class="ident" id="4117055"><a href="/gostd/net/http/fs.go.html#4116873">ra</a></span><span class="op" id="4117057">.</span><span class="ident" id="4117058"><a href="/gostd/net/http/fs.go.html#4123208">start</a></span><span class="op" id="4117063">,</span>&nbsp;<span class="ident" id="4117065"><a href="/gostd/net/http/fs.go.html#4109915">os</a></span><span class="op" id="4117067">.</span><span class="ident" id="4117068"><a href="/gostd/os/file.go.html#2442631">SEEK_SET</a></span><span class="op" id="4117076">)</span><span class="op" id="4117077">;</span>&nbsp;<span class="ident" id="4117079"><a href="/gostd/net/http/fs.go.html#4117035">err</a></span>&nbsp;<span class="op" id="4117083">!=</span>&nbsp;<span class="builtintype" id="4117086">nil</span>&nbsp;<span class="op" id="4117090">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117098"><a href="/gostd/net/http/fs.go.html#4116606">pw</a></span><span class="op" id="4117100">.</span><span class="ident" id="4117101"><a href="/gostd/io/pipe.go.html#1439738">CloseWithError</a></span><span class="op" id="4117115">(</span><span class="ident" id="4117116"><a href="/gostd/net/http/fs.go.html#4117035">err</a></span><span class="op" id="4117119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117127">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117146">if</span>&nbsp;<span class="ident" id="4117149">_</span><span class="op" id="4117150">,</span>&nbsp;<span class="ident" id="4117152">err</span>&nbsp;<span class="op" id="4117156">:=</span>&nbsp;<span class="ident" id="4117159"><a href="/gostd/net/http/fs.go.html#4109855">io</a></span><span class="op" id="4117161">.</span><span class="ident" id="4117162"><a href="/gostd/io/io.go.html#1430100">CopyN</a></span><span class="op" id="4117167">(</span><span class="ident" id="4117168"><a href="/gostd/net/http/fs.go.html#4116899">part</a></span><span class="op" id="4117172">,</span>&nbsp;<span class="ident" id="4117174"><a href="/gostd/net/http/fs.go.html#4114181">content</a></span><span class="op" id="4117181">,</span>&nbsp;<span class="ident" id="4117183"><a href="/gostd/net/http/fs.go.html#4116873">ra</a></span><span class="op" id="4117185">.</span><span class="ident" id="4117186"><a href="/gostd/net/http/fs.go.html#4123215">length</a></span><span class="op" id="4117192">)</span><span class="op" id="4117193">;</span>&nbsp;<span class="ident" id="4117195"><a href="/gostd/net/http/fs.go.html#4117152">err</a></span>&nbsp;<span class="op" id="4117199">!=</span>&nbsp;<span class="builtintype" id="4117202">nil</span>&nbsp;<span class="op" id="4117206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117214"><a href="/gostd/net/http/fs.go.html#4116606">pw</a></span><span class="op" id="4117216">.</span><span class="ident" id="4117217"><a href="/gostd/io/pipe.go.html#1439738">CloseWithError</a></span><span class="op" id="4117231">(</span><span class="ident" id="4117232"><a href="/gostd/net/http/fs.go.html#4117152">err</a></span><span class="op" id="4117235">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117243">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117267"><a href="/gostd/net/http/fs.go.html#4116625">mw</a></span><span class="op" id="4117269">.</span><span class="ident" id="4117270"><a href="/gostd/mime/multipart/writer.go.html#4327790">Close</a></span><span class="op" id="4117275">(</span><span class="op" id="4117276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117282"><a href="/gostd/net/http/fs.go.html#4116606">pw</a></span><span class="op" id="4117284">.</span><span class="ident" id="4117285"><a href="/gostd/io/pipe.go.html#1439540">Close</a></span><span class="op" id="4117290">(</span><span class="op" id="4117291">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117296">}</span><span class="op" id="4117297">(</span><span class="op" id="4117298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117307"><a href="/gostd/net/http/fs.go.html#4114087">w</a></span><span class="op" id="4117308">.</span><span class="ident" id="4117309"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="4117315">(</span><span class="op" id="4117316">)</span><span class="op" id="4117317">.</span><span class="ident" id="4117318"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="4117321">(</span><span class="string" id="4117322">&#34;Accept-Ranges&#34;</span><span class="op" id="4117337">,</span>&nbsp;<span class="string" id="4117339">&#34;bytes&#34;</span><span class="op" id="4117346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117350">if</span>&nbsp;<span class="ident" id="4117353"><a href="/gostd/net/http/fs.go.html#4114087">w</a></span><span class="op" id="4117354">.</span><span class="ident" id="4117355"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="4117361">(</span><span class="op" id="4117362">)</span><span class="op" id="4117363">.</span><span class="ident" id="4117364"><a href="/gostd/net/http/header.go.html#4126793">Get</a></span><span class="op" id="4117367">(</span><span class="string" id="4117368">&#34;Content-Encoding&#34;</span><span class="op" id="4117386">)</span>&nbsp;<span class="op" id="4117388">==</span>&nbsp;<span class="string" id="4117391">&#34;&#34;</span>&nbsp;<span class="op" id="4117394">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117399"><a href="/gostd/net/http/fs.go.html#4114087">w</a></span><span class="op" id="4117400">.</span><span class="ident" id="4117401"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="4117407">(</span><span class="op" id="4117408">)</span><span class="op" id="4117409">.</span><span class="ident" id="4117410"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="4117413">(</span><span class="string" id="4117414">&#34;Content-Length&#34;</span><span class="op" id="4117430">,</span>&nbsp;<span class="ident" id="4117432"><a href="/gostd/net/http/fs.go.html#4109946">strconv</a></span><span class="op" id="4117439">.</span><span class="ident" id="4117440"><a href="/gostd/strconv/itoa.go.html#2407133">FormatInt</a></span><span class="op" id="4117449">(</span><span class="ident" id="4117450"><a href="/gostd/net/http/fs.go.html#4115205">sendSize</a></span><span class="op" id="4117458">,</span>&nbsp;<span class="num" id="4117460">10</span><span class="op" id="4117462">)</span><span class="op" id="4117463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117474"><a href="/gostd/net/http/fs.go.html#4114087">w</a></span><span class="op" id="4117475">.</span><span class="ident" id="4117476"><a href="/gostd/net/http/server.go.html#4171422">WriteHeader</a></span><span class="op" id="4117487">(</span><span class="ident" id="4117488"><a href="/gostd/net/http/fs.go.html#4114326">code</a></span><span class="op" id="4117492">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117496">if</span>&nbsp;<span class="ident" id="4117499"><a href="/gostd/net/http/fs.go.html#4114105">r</a></span><span class="op" id="4117500">.</span><span class="ident" id="4117501"><a href="/gostd/net/http/request.go.html#4136084">Method</a></span>&nbsp;<span class="op" id="4117508">!=</span>&nbsp;<span class="string" id="4117511">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="4117518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4117522"><a href="/gostd/net/http/fs.go.html#4109855">io</a></span><span class="op" id="4117524">.</span><span class="ident" id="4117525"><a href="/gostd/io/io.go.html#1430100">CopyN</a></span><span class="op" id="4117530">(</span><span class="ident" id="4117531"><a href="/gostd/net/http/fs.go.html#4114087">w</a></span><span class="op" id="4117532">,</span>&nbsp;<span class="ident" id="4117534"><a href="/gostd/net/http/fs.go.html#4115227">sendContent</a></span><span class="op" id="4117545">,</span>&nbsp;<span class="ident" id="4117547"><a href="/gostd/net/http/fs.go.html#4115205">sendSize</a></span><span class="op" id="4117555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117558">}</span><br>
<span class="lineno"></span><span class="op" id="4117560">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="4117563">//&nbsp;modtime&nbsp;is&nbsp;the&nbsp;modification&nbsp;time&nbsp;of&nbsp;the&nbsp;resource&nbsp;to&nbsp;be&nbsp;served,&nbsp;or&nbsp;IsZero().</span><br>
<span class="lineno"></span><span class="comment" id="4117642">//&nbsp;return&nbsp;value&nbsp;is&nbsp;whether&nbsp;this&nbsp;request&nbsp;is&nbsp;now&nbsp;complete.</span><br>
<span class="lineno"></span><span class="keyword" id="4117699">func</span>&nbsp;<span class="ident" id="4117704">checkLastModified</span><span class="op" id="4117721">(</span><span class="ident" id="4117722">w</span>&nbsp;<span class="ident" id="4117724"><a href="/gostd/net/http/server.go.html#4170569">ResponseWriter</a></span><span class="op" id="4117738">,</span>&nbsp;<span class="ident" id="4117740">r</span>&nbsp;<span class="op" id="4117742">*</span><span class="ident" id="4117743"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4117750">,</span>&nbsp;<span class="ident" id="4117752">modtime</span>&nbsp;<span class="ident" id="4117760"><a href="/gostd/net/http/fs.go.html#4109968">time</a></span><span class="op" id="4117764">.</span><span class="ident" id="4117765"><a href="/gostd/time/time.go.html#2722087">Time</a></span><span class="op" id="4117769">)</span>&nbsp;<span class="builtintype" id="4117771">bool</span>&nbsp;<span class="op" id="4117776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117779">if</span>&nbsp;<span class="ident" id="4117782"><a href="/gostd/net/http/fs.go.html#4117752">modtime</a></span><span class="op" id="4117789">.</span><span class="ident" id="4117790"><a href="/gostd/time/time.go.html#2728744">IsZero</a></span><span class="op" id="4117796">(</span><span class="op" id="4117797">)</span>&nbsp;<span class="op" id="4117799">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117803">return</span>&nbsp;<span class="builtintype" id="4117810">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4117817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4117821">//&nbsp;The&nbsp;Date-Modified&nbsp;header&nbsp;truncates&nbsp;sub-second&nbsp;precision,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4117885">//&nbsp;use&nbsp;mtime&nbsp;&lt;&nbsp;t+1s&nbsp;instead&nbsp;of&nbsp;mtime&nbsp;&lt;=&nbsp;t&nbsp;to&nbsp;check&nbsp;for&nbsp;unmodified.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4117953">if</span>&nbsp;<span class="ident" id="4117956">t</span><span class="op" id="4117957">,</span>&nbsp;<span class="ident" id="4117959">err</span>&nbsp;<span class="op" id="4117963">:=</span>&nbsp;<span class="ident" id="4117966"><a href="/gostd/net/http/fs.go.html#4109968">time</a></span><span class="op" id="4117970">.</span><span class="ident" id="4117971"><a href="/gostd/time/format.go.html#2699353">Parse</a></span><span class="op" id="4117976">(</span><span class="ident" id="4117977"><a href="/gostd/net/http/server.go.html#4184253">TimeFormat</a></span><span class="op" id="4117987">,</span>&nbsp;<span class="ident" id="4117989"><a href="/gostd/net/http/fs.go.html#4117740">r</a></span><span class="op" id="4117990">.</span><span class="ident" id="4117991"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="4117997">.</span><span class="ident" id="4117998"><a href="/gostd/net/http/header.go.html#4126793">Get</a></span><span class="op" id="4118001">(</span><span class="string" id="4118002">&#34;If-Modified-Since&#34;</span><span class="op" id="4118021">)</span><span class="op" id="4118022">)</span><span class="op" id="4118023">;</span>&nbsp;<span class="ident" id="4118025"><a href="/gostd/net/http/fs.go.html#4117959">err</a></span>&nbsp;<span class="op" id="4118029">==</span>&nbsp;<span class="builtintype" id="4118032">nil</span>&nbsp;<span class="op" id="4118036">&amp;&amp;</span>&nbsp;<span class="ident" id="4118039"><a href="/gostd/net/http/fs.go.html#4117752">modtime</a></span><span class="op" id="4118046">.</span><span class="ident" id="4118047"><a href="/gostd/time/time.go.html#2722823">Before</a></span><span class="op" id="4118053">(</span><span class="ident" id="4118054"><a href="/gostd/net/http/fs.go.html#4117956">t</a></span><span class="op" id="4118055">.</span><span class="ident" id="4118056"><a href="/gostd/time/time.go.html#2738615">Add</a></span><span class="op" id="4118059">(</span><span class="num" id="4118060">1</span><span class="op" id="4118061">*</span><span class="ident" id="4118062"><a href="/gostd/net/http/fs.go.html#4109968">time</a></span><span class="op" id="4118066">.</span><span class="ident" id="4118067"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="4118073">)</span><span class="op" id="4118074">)</span>&nbsp;<span class="op" id="4118076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118080">h</span>&nbsp;<span class="op" id="4118082">:=</span>&nbsp;<span class="ident" id="4118085"><a href="/gostd/net/http/fs.go.html#4117722">w</a></span><span class="op" id="4118086">.</span><span class="ident" id="4118087"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="4118093">(</span><span class="op" id="4118094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4118098">delete</span><span class="op" id="4118104">(</span><span class="ident" id="4118105"><a href="/gostd/net/http/fs.go.html#4118080">h</a></span><span class="op" id="4118106">,</span>&nbsp;<span class="string" id="4118108">&#34;Content-Type&#34;</span><span class="op" id="4118122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4118126">delete</span><span class="op" id="4118132">(</span><span class="ident" id="4118133"><a href="/gostd/net/http/fs.go.html#4118080">h</a></span><span class="op" id="4118134">,</span>&nbsp;<span class="string" id="4118136">&#34;Content-Length&#34;</span><span class="op" id="4118152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118156"><a href="/gostd/net/http/fs.go.html#4117722">w</a></span><span class="op" id="4118157">.</span><span class="ident" id="4118158"><a href="/gostd/net/http/server.go.html#4171422">WriteHeader</a></span><span class="op" id="4118169">(</span><span class="ident" id="4118170"><a href="/gostd/net/http/status.go.html#4236573">StatusNotModified</a></span><span class="op" id="4118187">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4118191">return</span>&nbsp;<span class="builtintype" id="4118198">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4118204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118207"><a href="/gostd/net/http/fs.go.html#4117722">w</a></span><span class="op" id="4118208">.</span><span class="ident" id="4118209"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="4118215">(</span><span class="op" id="4118216">)</span><span class="op" id="4118217">.</span><span class="ident" id="4118218"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="4118221">(</span><span class="string" id="4118222">&#34;Last-Modified&#34;</span><span class="op" id="4118237">,</span>&nbsp;<span class="ident" id="4118239"><a href="/gostd/net/http/fs.go.html#4117752">modtime</a></span><span class="op" id="4118246">.</span><span class="ident" id="4118247"><a href="/gostd/time/time.go.html#2743233">UTC</a></span><span class="op" id="4118250">(</span><span class="op" id="4118251">)</span><span class="op" id="4118252">.</span><span class="ident" id="4118253"><a href="/gostd/time/format.go.html#2690960">Format</a></span><span class="op" id="4118259">(</span><span class="ident" id="4118260"><a href="/gostd/net/http/server.go.html#4184253">TimeFormat</a></span><span class="op" id="4118270">)</span><span class="op" id="4118271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4118274">return</span>&nbsp;<span class="builtintype" id="4118281">false</span><br>
<span class="lineno"></span><span class="op" id="4118287">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="4118290">//&nbsp;checkETag&nbsp;implements&nbsp;If-None-Match&nbsp;and&nbsp;If-Range&nbsp;checks.</span><br>
<span class="lineno"></span><span class="comment" id="4118349">//</span><br>
<span class="lineno"></span><span class="comment" id="4118352">//&nbsp;The&nbsp;ETag&nbsp;or&nbsp;modtime&nbsp;must&nbsp;have&nbsp;been&nbsp;previously&nbsp;set&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4118412">//&nbsp;ResponseWriter&#39;s&nbsp;headers.&nbsp;&nbsp;The&nbsp;modtime&nbsp;is&nbsp;only&nbsp;compared&nbsp;at&nbsp;second</span><br>
<span class="lineno">285</span><span class="comment" id="4118481">//&nbsp;granularity&nbsp;and&nbsp;may&nbsp;be&nbsp;the&nbsp;zero&nbsp;value&nbsp;to&nbsp;mean&nbsp;unknown.</span><br>
<span class="lineno"></span><span class="comment" id="4118539">//</span><br>
<span class="lineno"></span><span class="comment" id="4118542">//&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;effective&nbsp;request&nbsp;&#34;Range&#34;&nbsp;header&nbsp;to&nbsp;use&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4118613">//&nbsp;whether&nbsp;this&nbsp;request&nbsp;is&nbsp;now&nbsp;considered&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="4118661">func</span>&nbsp;<span class="ident" id="4118666">checkETag</span><span class="op" id="4118675">(</span><span class="ident" id="4118676">w</span>&nbsp;<span class="ident" id="4118678"><a href="/gostd/net/http/server.go.html#4170569">ResponseWriter</a></span><span class="op" id="4118692">,</span>&nbsp;<span class="ident" id="4118694">r</span>&nbsp;<span class="op" id="4118696">*</span><span class="ident" id="4118697"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4118704">,</span>&nbsp;<span class="ident" id="4118706">modtime</span>&nbsp;<span class="ident" id="4118714"><a href="/gostd/net/http/fs.go.html#4109968">time</a></span><span class="op" id="4118718">.</span><span class="ident" id="4118719"><a href="/gostd/time/time.go.html#2722087">Time</a></span><span class="op" id="4118723">)</span>&nbsp;<span class="op" id="4118725">(</span><span class="ident" id="4118726">rangeReq</span>&nbsp;<span class="builtintype" id="4118735">string</span><span class="op" id="4118741">,</span>&nbsp;<span class="ident" id="4118743">done</span>&nbsp;<span class="builtintype" id="4118748">bool</span><span class="op" id="4118752">)</span>&nbsp;<span class="op" id="4118754">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118757">etag</span>&nbsp;<span class="op" id="4118762">:=</span>&nbsp;<span class="ident" id="4118765"><a href="/gostd/net/http/fs.go.html#4118676">w</a></span><span class="op" id="4118766">.</span><span class="ident" id="4118767"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="4118773">(</span><span class="op" id="4118774">)</span><span class="op" id="4118775">.</span><span class="ident" id="4118776"><a href="/gostd/net/http/header.go.html#4126950">get</a></span><span class="op" id="4118779">(</span><span class="string" id="4118780">&#34;Etag&#34;</span><span class="op" id="4118786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4118789"><a href="/gostd/net/http/fs.go.html#4118726">rangeReq</a></span>&nbsp;<span class="op" id="4118798">=</span>&nbsp;<span class="ident" id="4118800"><a href="/gostd/net/http/fs.go.html#4118694">r</a></span><span class="op" id="4118801">.</span><span class="ident" id="4118802"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="4118808">.</span><span class="ident" id="4118809"><a href="/gostd/net/http/header.go.html#4126950">get</a></span><span class="op" id="4118812">(</span><span class="string" id="4118813">&#34;Range&#34;</span><span class="op" id="4118820">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4118824">//&nbsp;Invalidate&nbsp;the&nbsp;range&nbsp;request&nbsp;if&nbsp;the&nbsp;entity&nbsp;doesn&#39;t&nbsp;match&nbsp;the&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4118893">//&nbsp;the&nbsp;client&nbsp;was&nbsp;expecting.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4118923">//&nbsp;&#34;If-Range:&nbsp;version&#34;&nbsp;means&nbsp;&#34;ignore&nbsp;the&nbsp;Range:&nbsp;header&nbsp;unless&nbsp;version&nbsp;matches&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4119006">//&nbsp;current&nbsp;file.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4119025">//&nbsp;We&nbsp;only&nbsp;support&nbsp;ETag&nbsp;versions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4119060">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;have&nbsp;set&nbsp;the&nbsp;ETag&nbsp;on&nbsp;the&nbsp;response&nbsp;already.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119123">if</span>&nbsp;<span class="ident" id="4119126">ir</span>&nbsp;<span class="op" id="4119129">:=</span>&nbsp;<span class="ident" id="4119132"><a href="/gostd/net/http/fs.go.html#4118694">r</a></span><span class="op" id="4119133">.</span><span class="ident" id="4119134"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="4119140">.</span><span class="ident" id="4119141"><a href="/gostd/net/http/header.go.html#4126950">get</a></span><span class="op" id="4119144">(</span><span class="string" id="4119145">&#34;If-Range&#34;</span><span class="op" id="4119155">)</span><span class="op" id="4119156">;</span>&nbsp;<span class="ident" id="4119158"><a href="/gostd/net/http/fs.go.html#4119126">ir</a></span>&nbsp;<span class="op" id="4119161">!=</span>&nbsp;<span class="string" id="4119164">&#34;&#34;</span>&nbsp;<span class="op" id="4119167">&amp;&amp;</span>&nbsp;<span class="ident" id="4119170"><a href="/gostd/net/http/fs.go.html#4119126">ir</a></span>&nbsp;<span class="op" id="4119173">!=</span>&nbsp;<span class="ident" id="4119176"><a href="/gostd/net/http/fs.go.html#4118757">etag</a></span>&nbsp;<span class="op" id="4119181">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4119185">//&nbsp;The&nbsp;If-Range&nbsp;value&nbsp;is&nbsp;typically&nbsp;the&nbsp;ETag&nbsp;value,&nbsp;but&nbsp;it&nbsp;may&nbsp;also&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4119257">//&nbsp;the&nbsp;modtime&nbsp;date.&nbsp;See&nbsp;golang.org/issue/8367.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119307">timeMatches</span>&nbsp;<span class="op" id="4119319">:=</span>&nbsp;<span class="builtintype" id="4119322">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119330">if</span>&nbsp;<span class="op" id="4119333">!</span><span class="ident" id="4119334"><a href="/gostd/net/http/fs.go.html#4118706">modtime</a></span><span class="op" id="4119341">.</span><span class="ident" id="4119342"><a href="/gostd/time/time.go.html#2728744">IsZero</a></span><span class="op" id="4119348">(</span><span class="op" id="4119349">)</span>&nbsp;<span class="op" id="4119351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119356">if</span>&nbsp;<span class="ident" id="4119359">t</span><span class="op" id="4119360">,</span>&nbsp;<span class="ident" id="4119362">err</span>&nbsp;<span class="op" id="4119366">:=</span>&nbsp;<span class="ident" id="4119369"><a href="/gostd/net/http/header.go.html#4127675">ParseTime</a></span><span class="op" id="4119378">(</span><span class="ident" id="4119379"><a href="/gostd/net/http/fs.go.html#4119126">ir</a></span><span class="op" id="4119381">)</span><span class="op" id="4119382">;</span>&nbsp;<span class="ident" id="4119384"><a href="/gostd/net/http/fs.go.html#4119362">err</a></span>&nbsp;<span class="op" id="4119388">==</span>&nbsp;<span class="builtintype" id="4119391">nil</span>&nbsp;<span class="op" id="4119395">&amp;&amp;</span>&nbsp;<span class="ident" id="4119398"><a href="/gostd/net/http/fs.go.html#4119359">t</a></span><span class="op" id="4119399">.</span><span class="ident" id="4119400"><a href="/gostd/time/time.go.html#2744150">Unix</a></span><span class="op" id="4119404">(</span><span class="op" id="4119405">)</span>&nbsp;<span class="op" id="4119407">==</span>&nbsp;<span class="ident" id="4119410"><a href="/gostd/net/http/fs.go.html#4118706">modtime</a></span><span class="op" id="4119417">.</span><span class="ident" id="4119418"><a href="/gostd/time/time.go.html#2744150">Unix</a></span><span class="op" id="4119422">(</span><span class="op" id="4119423">)</span>&nbsp;<span class="op" id="4119425">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119431"><a href="/gostd/net/http/fs.go.html#4119307">timeMatches</a></span>&nbsp;<span class="op" id="4119443">=</span>&nbsp;<span class="builtintype" id="4119445">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119461">if</span>&nbsp;<span class="op" id="4119464">!</span><span class="ident" id="4119465"><a href="/gostd/net/http/fs.go.html#4119307">timeMatches</a></span>&nbsp;<span class="op" id="4119477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4119482"><a href="/gostd/net/http/fs.go.html#4118726">rangeReq</a></span>&nbsp;<span class="op" id="4119491">=</span>&nbsp;<span class="string" id="4119493">&#34;&#34;</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119505">if</span>&nbsp;<span class="ident" id="4119508">inm</span>&nbsp;<span class="op" id="4119512">:=</span>&nbsp;<span class="ident" id="4119515"><a href="/gostd/net/http/fs.go.html#4118694">r</a></span><span class="op" id="4119516">.</span><span class="ident" id="4119517"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="4119523">.</span><span class="ident" id="4119524"><a href="/gostd/net/http/header.go.html#4126950">get</a></span><span class="op" id="4119527">(</span><span class="string" id="4119528">&#34;If-None-Match&#34;</span><span class="op" id="4119543">)</span><span class="op" id="4119544">;</span>&nbsp;<span class="ident" id="4119546"><a href="/gostd/net/http/fs.go.html#4119508">inm</a></span>&nbsp;<span class="op" id="4119550">!=</span>&nbsp;<span class="string" id="4119553">&#34;&#34;</span>&nbsp;<span class="op" id="4119556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4119560">//&nbsp;Must&nbsp;know&nbsp;ETag.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119581">if</span>&nbsp;<span class="ident" id="4119584"><a href="/gostd/net/http/fs.go.html#4118757">etag</a></span>&nbsp;<span class="op" id="4119589">==</span>&nbsp;<span class="string" id="4119592">&#34;&#34;</span>&nbsp;<span class="op" id="4119595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119600">return</span>&nbsp;<span class="ident" id="4119607"><a href="/gostd/net/http/fs.go.html#4118726">rangeReq</a></span><span class="op" id="4119615">,</span>&nbsp;<span class="builtintype" id="4119617">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4119630">//&nbsp;TODO(bradfitz):&nbsp;non-GET/HEAD&nbsp;requests&nbsp;require&nbsp;more&nbsp;work:</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4119692">//&nbsp;sending&nbsp;a&nbsp;different&nbsp;status&nbsp;code&nbsp;on&nbsp;matches,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4119745">//&nbsp;also&nbsp;can&#39;t&nbsp;use&nbsp;weak&nbsp;cache&nbsp;validators&nbsp;(those&nbsp;with&nbsp;a&nbsp;&#34;W/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4119805">//&nbsp;prefix).&nbsp;&nbsp;But&nbsp;most&nbsp;users&nbsp;of&nbsp;ServeContent&nbsp;will&nbsp;be&nbsp;using</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4119865">//&nbsp;it&nbsp;on&nbsp;GET&nbsp;or&nbsp;HEAD,&nbsp;so&nbsp;only&nbsp;support&nbsp;those&nbsp;for&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119920">if</span>&nbsp;<span class="ident" id="4119923"><a href="/gostd/net/http/fs.go.html#4118694">r</a></span><span class="op" id="4119924">.</span><span class="ident" id="4119925"><a href="/gostd/net/http/request.go.html#4136084">Method</a></span>&nbsp;<span class="op" id="4119932">!=</span>&nbsp;<span class="string" id="4119935">&#34;GET&#34;</span>&nbsp;<span class="op" id="4119941">&amp;&amp;</span>&nbsp;<span class="ident" id="4119944"><a href="/gostd/net/http/fs.go.html#4118694">r</a></span><span class="op" id="4119945">.</span><span class="ident" id="4119946"><a href="/gostd/net/http/request.go.html#4136084">Method</a></span>&nbsp;<span class="op" id="4119953">!=</span>&nbsp;<span class="string" id="4119956">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="4119963">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4119968">return</span>&nbsp;<span class="ident" id="4119975"><a href="/gostd/net/http/fs.go.html#4118726">rangeReq</a></span><span class="op" id="4119983">,</span>&nbsp;<span class="builtintype" id="4119985">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4119993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4119998">//&nbsp;TODO(bradfitz):&nbsp;deal&nbsp;with&nbsp;comma-separated&nbsp;or&nbsp;multiple-valued</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4120064">//&nbsp;list&nbsp;of&nbsp;If-None-match&nbsp;values.&nbsp;&nbsp;For&nbsp;now&nbsp;just&nbsp;handle&nbsp;the&nbsp;common</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4120131">//&nbsp;case&nbsp;of&nbsp;a&nbsp;single&nbsp;item.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120159">if</span>&nbsp;<span class="ident" id="4120162"><a href="/gostd/net/http/fs.go.html#4119508">inm</a></span>&nbsp;<span class="op" id="4120166">==</span>&nbsp;<span class="ident" id="4120169"><a href="/gostd/net/http/fs.go.html#4118757">etag</a></span>&nbsp;<span class="op" id="4120174">||</span>&nbsp;<span class="ident" id="4120177"><a href="/gostd/net/http/fs.go.html#4119508">inm</a></span>&nbsp;<span class="op" id="4120181">==</span>&nbsp;<span class="string" id="4120184">&#34;*&#34;</span>&nbsp;<span class="op" id="4120188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120193">h</span>&nbsp;<span class="op" id="4120195">:=</span>&nbsp;<span class="ident" id="4120198"><a href="/gostd/net/http/fs.go.html#4118676">w</a></span><span class="op" id="4120199">.</span><span class="ident" id="4120200"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="4120206">(</span><span class="op" id="4120207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4120212">delete</span><span class="op" id="4120218">(</span><span class="ident" id="4120219"><a href="/gostd/net/http/fs.go.html#4120193">h</a></span><span class="op" id="4120220">,</span>&nbsp;<span class="string" id="4120222">&#34;Content-Type&#34;</span><span class="op" id="4120236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4120241">delete</span><span class="op" id="4120247">(</span><span class="ident" id="4120248"><a href="/gostd/net/http/fs.go.html#4120193">h</a></span><span class="op" id="4120249">,</span>&nbsp;<span class="string" id="4120251">&#34;Content-Length&#34;</span><span class="op" id="4120267">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120272"><a href="/gostd/net/http/fs.go.html#4118676">w</a></span><span class="op" id="4120273">.</span><span class="ident" id="4120274"><a href="/gostd/net/http/server.go.html#4171422">WriteHeader</a></span><span class="op" id="4120285">(</span><span class="ident" id="4120286"><a href="/gostd/net/http/status.go.html#4236573">StatusNotModified</a></span><span class="op" id="4120303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120308">return</span>&nbsp;<span class="string" id="4120315">&#34;&#34;</span><span class="op" id="4120317">,</span>&nbsp;<span class="builtintype" id="4120319">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4120326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4120329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120332">return</span>&nbsp;<span class="ident" id="4120339"><a href="/gostd/net/http/fs.go.html#4118726">rangeReq</a></span><span class="op" id="4120347">,</span>&nbsp;<span class="builtintype" id="4120349">false</span><br>
<span class="lineno">340</span><span class="op" id="4120355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4120358">//&nbsp;name&nbsp;is&nbsp;&#39;/&#39;-separated,&nbsp;not&nbsp;filepath.Separator.</span><br>
<span class="lineno"></span><span class="keyword" id="4120408">func</span>&nbsp;<span class="ident" id="4120413">serveFile</span><span class="op" id="4120422">(</span><span class="ident" id="4120423">w</span>&nbsp;<span class="ident" id="4120425"><a href="/gostd/net/http/server.go.html#4170569">ResponseWriter</a></span><span class="op" id="4120439">,</span>&nbsp;<span class="ident" id="4120441">r</span>&nbsp;<span class="op" id="4120443">*</span><span class="ident" id="4120444"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4120451">,</span>&nbsp;<span class="ident" id="4120453">fs</span>&nbsp;<span class="ident" id="4120456"><a href="/gostd/net/http/fs.go.html#4110976">FileSystem</a></span><span class="op" id="4120466">,</span>&nbsp;<span class="ident" id="4120468">name</span>&nbsp;<span class="builtintype" id="4120473">string</span><span class="op" id="4120479">,</span>&nbsp;<span class="ident" id="4120481">redirect</span>&nbsp;<span class="builtintype" id="4120490">bool</span><span class="op" id="4120494">)</span>&nbsp;<span class="op" id="4120496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120499">const</span>&nbsp;<span class="ident" id="4120505">indexPage</span>&nbsp;<span class="op" id="4120515">=</span>&nbsp;<span class="string" id="4120517">&#34;/index.html&#34;</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4120533">//&nbsp;redirect&nbsp;.../index.html&nbsp;to&nbsp;.../</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4120569">//&nbsp;can&#39;t&nbsp;use&nbsp;Redirect()&nbsp;because&nbsp;that&nbsp;would&nbsp;make&nbsp;the&nbsp;path&nbsp;absolute,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4120637">//&nbsp;which&nbsp;would&nbsp;be&nbsp;a&nbsp;problem&nbsp;running&nbsp;under&nbsp;StripPrefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120692">if</span>&nbsp;<span class="ident" id="4120695"><a href="/gostd/net/http/fs.go.html#4109957">strings</a></span><span class="op" id="4120702">.</span><span class="ident" id="4120703"><a href="/gostd/strings/strings.go.html#2975527">HasSuffix</a></span><span class="op" id="4120712">(</span><span class="ident" id="4120713"><a href="/gostd/net/http/fs.go.html#4120441">r</a></span><span class="op" id="4120714">.</span><span class="ident" id="4120715"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="4120718">.</span><span class="ident" id="4120719"><a href="/gostd/net/url/url.go.html#3751366">Path</a></span><span class="op" id="4120723">,</span>&nbsp;<span class="ident" id="4120725"><a href="/gostd/net/http/fs.go.html#4120505">indexPage</a></span><span class="op" id="4120734">)</span>&nbsp;<span class="op" id="4120736">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120740"><a href="/gostd/net/http/fs.go.html#4122098">localRedirect</a></span><span class="op" id="4120753">(</span><span class="ident" id="4120754"><a href="/gostd/net/http/fs.go.html#4120423">w</a></span><span class="op" id="4120755">,</span>&nbsp;<span class="ident" id="4120757"><a href="/gostd/net/http/fs.go.html#4120441">r</a></span><span class="op" id="4120758">,</span>&nbsp;<span class="string" id="4120760">&#34;./&#34;</span><span class="op" id="4120764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120768">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4120776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120780">f</span><span class="op" id="4120781">,</span>&nbsp;<span class="ident" id="4120783">err</span>&nbsp;<span class="op" id="4120787">:=</span>&nbsp;<span class="ident" id="4120790"><a href="/gostd/net/http/fs.go.html#4120453">fs</a></span><span class="op" id="4120792">.</span><span class="ident" id="4120793"><a href="/gostd/net/http/fs.go.html#4111000">Open</a></span><span class="op" id="4120797">(</span><span class="ident" id="4120798"><a href="/gostd/net/http/fs.go.html#4120468">name</a></span><span class="op" id="4120802">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120805">if</span>&nbsp;<span class="ident" id="4120808"><a href="/gostd/net/http/fs.go.html#4120783">err</a></span>&nbsp;<span class="op" id="4120812">!=</span>&nbsp;<span class="builtintype" id="4120815">nil</span>&nbsp;<span class="op" id="4120819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4120823">//&nbsp;TODO&nbsp;expose&nbsp;actual&nbsp;error?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120854"><a href="/gostd/net/http/server.go.html#4206151">NotFound</a></span><span class="op" id="4120862">(</span><span class="ident" id="4120863"><a href="/gostd/net/http/fs.go.html#4120423">w</a></span><span class="op" id="4120864">,</span>&nbsp;<span class="ident" id="4120866"><a href="/gostd/net/http/fs.go.html#4120441">r</a></span><span class="op" id="4120867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120871">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4120879">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120882">defer</span>&nbsp;<span class="ident" id="4120888"><a href="/gostd/net/http/fs.go.html#4120780">f</a></span><span class="op" id="4120889">.</span><span class="ident" id="4120890"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="4120895">(</span><span class="op" id="4120896">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120900">d</span><span class="op" id="4120901">,</span>&nbsp;<span class="ident" id="4120903">err1</span>&nbsp;<span class="op" id="4120908">:=</span>&nbsp;<span class="ident" id="4120911"><a href="/gostd/net/http/fs.go.html#4120780">f</a></span><span class="op" id="4120912">.</span><span class="ident" id="4120913"><a href="/gostd/net/http/fs.go.html#4111343">Stat</a></span><span class="op" id="4120917">(</span><span class="op" id="4120918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120921">if</span>&nbsp;<span class="ident" id="4120924"><a href="/gostd/net/http/fs.go.html#4120903">err1</a></span>&nbsp;<span class="op" id="4120929">!=</span>&nbsp;<span class="builtintype" id="4120932">nil</span>&nbsp;<span class="op" id="4120936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4120940">//&nbsp;TODO&nbsp;expose&nbsp;actual&nbsp;error?</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4120971"><a href="/gostd/net/http/server.go.html#4206151">NotFound</a></span><span class="op" id="4120979">(</span><span class="ident" id="4120980"><a href="/gostd/net/http/fs.go.html#4120423">w</a></span><span class="op" id="4120981">,</span>&nbsp;<span class="ident" id="4120983"><a href="/gostd/net/http/fs.go.html#4120441">r</a></span><span class="op" id="4120984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4120988">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4120996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121000">if</span>&nbsp;<span class="ident" id="4121003"><a href="/gostd/net/http/fs.go.html#4120481">redirect</a></span>&nbsp;<span class="op" id="4121012">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4121016">//&nbsp;redirect&nbsp;to&nbsp;canonical&nbsp;path:&nbsp;/&nbsp;at&nbsp;end&nbsp;of&nbsp;directory&nbsp;url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4121075">//&nbsp;r.URL.Path&nbsp;always&nbsp;begins&nbsp;with&nbsp;/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121112">url</span>&nbsp;<span class="op" id="4121116">:=</span>&nbsp;<span class="ident" id="4121119"><a href="/gostd/net/http/fs.go.html#4120441">r</a></span><span class="op" id="4121120">.</span><span class="ident" id="4121121"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="4121124">.</span><span class="ident" id="4121125"><a href="/gostd/net/url/url.go.html#3751366">Path</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121132">if</span>&nbsp;<span class="ident" id="4121135"><a href="/gostd/net/http/fs.go.html#4120900">d</a></span><span class="op" id="4121136">.</span><span class="ident" id="4121137"><a href="/gostd/os/types.go.html#2472696">IsDir</a></span><span class="op" id="4121142">(</span><span class="op" id="4121143">)</span>&nbsp;<span class="op" id="4121145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121150">if</span>&nbsp;<span class="ident" id="4121153"><a href="/gostd/net/http/fs.go.html#4121112">url</a></span><span class="op" id="4121156">[</span><span class="builtinfunc" id="4121157">len</span><span class="op" id="4121160">(</span><span class="ident" id="4121161"><a href="/gostd/net/http/fs.go.html#4121112">url</a></span><span class="op" id="4121164">)</span><span class="op" id="4121165">-</span><span class="num" id="4121166">1</span><span class="op" id="4121167">]</span>&nbsp;<span class="op" id="4121169">!=</span>&nbsp;<span class="string" id="4121172">&#39;/&#39;</span>&nbsp;<span class="op" id="4121176">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121182"><a href="/gostd/net/http/fs.go.html#4122098">localRedirect</a></span><span class="op" id="4121195">(</span><span class="ident" id="4121196"><a href="/gostd/net/http/fs.go.html#4120423">w</a></span><span class="op" id="4121197">,</span>&nbsp;<span class="ident" id="4121199"><a href="/gostd/net/http/fs.go.html#4120441">r</a></span><span class="op" id="4121200">,</span>&nbsp;<span class="ident" id="4121202"><a href="/gostd/net/http/fs.go.html#4109921">path</a></span><span class="op" id="4121206">.</span><span class="ident" id="4121207"><a href="/gostd/path/path.go.html#3924660">Base</a></span><span class="op" id="4121211">(</span><span class="ident" id="4121212"><a href="/gostd/net/http/fs.go.html#4121112">url</a></span><span class="op" id="4121215">)</span><span class="op" id="4121216">+</span><span class="string" id="4121217">&#34;/&#34;</span><span class="op" id="4121220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121226">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4121236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4121240">}</span>&nbsp;<span class="keyword" id="4121242">else</span>&nbsp;<span class="op" id="4121247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121252">if</span>&nbsp;<span class="ident" id="4121255"><a href="/gostd/net/http/fs.go.html#4121112">url</a></span><span class="op" id="4121258">[</span><span class="builtinfunc" id="4121259">len</span><span class="op" id="4121262">(</span><span class="ident" id="4121263"><a href="/gostd/net/http/fs.go.html#4121112">url</a></span><span class="op" id="4121266">)</span><span class="op" id="4121267">-</span><span class="num" id="4121268">1</span><span class="op" id="4121269">]</span>&nbsp;<span class="op" id="4121271">==</span>&nbsp;<span class="string" id="4121274">&#39;/&#39;</span>&nbsp;<span class="op" id="4121278">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121284"><a href="/gostd/net/http/fs.go.html#4122098">localRedirect</a></span><span class="op" id="4121297">(</span><span class="ident" id="4121298"><a href="/gostd/net/http/fs.go.html#4120423">w</a></span><span class="op" id="4121299">,</span>&nbsp;<span class="ident" id="4121301"><a href="/gostd/net/http/fs.go.html#4120441">r</a></span><span class="op" id="4121302">,</span>&nbsp;<span class="string" id="4121304">&#34;../&#34;</span><span class="op" id="4121309">+</span><span class="ident" id="4121310"><a href="/gostd/net/http/fs.go.html#4109921">path</a></span><span class="op" id="4121314">.</span><span class="ident" id="4121315"><a href="/gostd/path/path.go.html#3924660">Base</a></span><span class="op" id="4121319">(</span><span class="ident" id="4121320"><a href="/gostd/net/http/fs.go.html#4121112">url</a></span><span class="op" id="4121323">)</span><span class="op" id="4121324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121330">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4121340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4121344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4121347">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4121351">//&nbsp;use&nbsp;contents&nbsp;of&nbsp;index.html&nbsp;for&nbsp;directory,&nbsp;if&nbsp;present</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121408">if</span>&nbsp;<span class="ident" id="4121411"><a href="/gostd/net/http/fs.go.html#4120900">d</a></span><span class="op" id="4121412">.</span><span class="ident" id="4121413"><a href="/gostd/os/types.go.html#2472696">IsDir</a></span><span class="op" id="4121418">(</span><span class="op" id="4121419">)</span>&nbsp;<span class="op" id="4121421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121425">index</span>&nbsp;<span class="op" id="4121431">:=</span>&nbsp;<span class="ident" id="4121434"><a href="/gostd/net/http/fs.go.html#4109957">strings</a></span><span class="op" id="4121441">.</span><span class="ident" id="4121442"><a href="/gostd/strings/strings.go.html#2982965">TrimSuffix</a></span><span class="op" id="4121452">(</span><span class="ident" id="4121453"><a href="/gostd/net/http/fs.go.html#4120468">name</a></span><span class="op" id="4121457">,</span>&nbsp;<span class="string" id="4121459">&#34;/&#34;</span><span class="op" id="4121462">)</span>&nbsp;<span class="op" id="4121464">+</span>&nbsp;<span class="ident" id="4121466"><a href="/gostd/net/http/fs.go.html#4120505">indexPage</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121478">ff</span><span class="op" id="4121480">,</span>&nbsp;<span class="ident" id="4121482">err</span>&nbsp;<span class="op" id="4121486">:=</span>&nbsp;<span class="ident" id="4121489"><a href="/gostd/net/http/fs.go.html#4120453">fs</a></span><span class="op" id="4121491">.</span><span class="ident" id="4121492"><a href="/gostd/net/http/fs.go.html#4111000">Open</a></span><span class="op" id="4121496">(</span><span class="ident" id="4121497"><a href="/gostd/net/http/fs.go.html#4121425">index</a></span><span class="op" id="4121502">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121506">if</span>&nbsp;<span class="ident" id="4121509"><a href="/gostd/net/http/fs.go.html#4121482">err</a></span>&nbsp;<span class="op" id="4121513">==</span>&nbsp;<span class="builtintype" id="4121516">nil</span>&nbsp;<span class="op" id="4121520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121525">defer</span>&nbsp;<span class="ident" id="4121531"><a href="/gostd/net/http/fs.go.html#4121478">ff</a></span><span class="op" id="4121533">.</span><span class="ident" id="4121534"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="4121539">(</span><span class="op" id="4121540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121545">dd</span><span class="op" id="4121547">,</span>&nbsp;<span class="ident" id="4121549">err</span>&nbsp;<span class="op" id="4121553">:=</span>&nbsp;<span class="ident" id="4121556"><a href="/gostd/net/http/fs.go.html#4121478">ff</a></span><span class="op" id="4121558">.</span><span class="ident" id="4121559"><a href="/gostd/net/http/fs.go.html#4111343">Stat</a></span><span class="op" id="4121563">(</span><span class="op" id="4121564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121569">if</span>&nbsp;<span class="ident" id="4121572"><a href="/gostd/net/http/fs.go.html#4121549">err</a></span>&nbsp;<span class="op" id="4121576">==</span>&nbsp;<span class="builtintype" id="4121579">nil</span>&nbsp;<span class="op" id="4121583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121589"><a href="/gostd/net/http/fs.go.html#4120468">name</a></span>&nbsp;<span class="op" id="4121594">=</span>&nbsp;<span class="ident" id="4121596"><a href="/gostd/net/http/fs.go.html#4121425">index</a></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121606"><a href="/gostd/net/http/fs.go.html#4120900">d</a></span>&nbsp;<span class="op" id="4121608">=</span>&nbsp;<span class="ident" id="4121610"><a href="/gostd/net/http/fs.go.html#4121545">dd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121617"><a href="/gostd/net/http/fs.go.html#4120780">f</a></span>&nbsp;<span class="op" id="4121619">=</span>&nbsp;<span class="ident" id="4121621"><a href="/gostd/net/http/fs.go.html#4121478">ff</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4121627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4121631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4121634">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4121638">//&nbsp;Still&nbsp;a&nbsp;directory?&nbsp;(we&nbsp;didn&#39;t&nbsp;find&nbsp;an&nbsp;index.html&nbsp;file)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121697">if</span>&nbsp;<span class="ident" id="4121700"><a href="/gostd/net/http/fs.go.html#4120900">d</a></span><span class="op" id="4121701">.</span><span class="ident" id="4121702"><a href="/gostd/os/types.go.html#2472696">IsDir</a></span><span class="op" id="4121707">(</span><span class="op" id="4121708">)</span>&nbsp;<span class="op" id="4121710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121714">if</span>&nbsp;<span class="ident" id="4121717"><a href="/gostd/net/http/fs.go.html#4117704">checkLastModified</a></span><span class="op" id="4121734">(</span><span class="ident" id="4121735"><a href="/gostd/net/http/fs.go.html#4120423">w</a></span><span class="op" id="4121736">,</span>&nbsp;<span class="ident" id="4121738"><a href="/gostd/net/http/fs.go.html#4120441">r</a></span><span class="op" id="4121739">,</span>&nbsp;<span class="ident" id="4121741"><a href="/gostd/net/http/fs.go.html#4120900">d</a></span><span class="op" id="4121742">.</span><span class="ident" id="4121743"><a href="/gostd/os/types.go.html#2472654">ModTime</a></span><span class="op" id="4121750">(</span><span class="op" id="4121751">)</span><span class="op" id="4121752">)</span>&nbsp;<span class="op" id="4121754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121759">return</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4121768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121772"><a href="/gostd/net/http/fs.go.html#4111379">dirList</a></span><span class="op" id="4121779">(</span><span class="ident" id="4121780"><a href="/gostd/net/http/fs.go.html#4120423">w</a></span><span class="op" id="4121781">,</span>&nbsp;<span class="ident" id="4121783"><a href="/gostd/net/http/fs.go.html#4120780">f</a></span><span class="op" id="4121784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4121788">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4121796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4121800">//&nbsp;serveContent&nbsp;will&nbsp;check&nbsp;modification&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121846">sizeFunc</span>&nbsp;<span class="op" id="4121855">:=</span>&nbsp;<span class="keyword" id="4121858">func</span><span class="op" id="4121862">(</span><span class="op" id="4121863">)</span>&nbsp;<span class="op" id="4121865">(</span><span class="builtintype" id="4121866">int64</span><span class="op" id="4121871">,</span>&nbsp;<span class="builtintype" id="4121873">error</span><span class="op" id="4121878">)</span>&nbsp;<span class="op" id="4121880">{</span>&nbsp;<span class="keyword" id="4121882">return</span>&nbsp;<span class="ident" id="4121889"><a href="/gostd/net/http/fs.go.html#4120900">d</a></span><span class="op" id="4121890">.</span><span class="ident" id="4121891"><a href="/gostd/os/types.go.html#2472528">Size</a></span><span class="op" id="4121895">(</span><span class="op" id="4121896">)</span><span class="op" id="4121897">,</span>&nbsp;<span class="builtintype" id="4121899">nil</span>&nbsp;<span class="op" id="4121903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4121906"><a href="/gostd/net/http/fs.go.html#4114074">serveContent</a></span><span class="op" id="4121918">(</span><span class="ident" id="4121919"><a href="/gostd/net/http/fs.go.html#4120423">w</a></span><span class="op" id="4121920">,</span>&nbsp;<span class="ident" id="4121922"><a href="/gostd/net/http/fs.go.html#4120441">r</a></span><span class="op" id="4121923">,</span>&nbsp;<span class="ident" id="4121925"><a href="/gostd/net/http/fs.go.html#4120900">d</a></span><span class="op" id="4121926">.</span><span class="ident" id="4121927"><a href="/gostd/os/types.go.html#2472482">Name</a></span><span class="op" id="4121931">(</span><span class="op" id="4121932">)</span><span class="op" id="4121933">,</span>&nbsp;<span class="ident" id="4121935"><a href="/gostd/net/http/fs.go.html#4120900">d</a></span><span class="op" id="4121936">.</span><span class="ident" id="4121937"><a href="/gostd/os/types.go.html#2472654">ModTime</a></span><span class="op" id="4121944">(</span><span class="op" id="4121945">)</span><span class="op" id="4121946">,</span>&nbsp;<span class="ident" id="4121948"><a href="/gostd/net/http/fs.go.html#4121846">sizeFunc</a></span><span class="op" id="4121956">,</span>&nbsp;<span class="ident" id="4121958"><a href="/gostd/net/http/fs.go.html#4120780">f</a></span><span class="op" id="4121959">)</span><br>
<span class="lineno"></span><span class="op" id="4121961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="4121964">//&nbsp;localRedirect&nbsp;gives&nbsp;a&nbsp;Moved&nbsp;Permanently&nbsp;response.</span><br>
<span class="lineno"></span><span class="comment" id="4122017">//&nbsp;It&nbsp;does&nbsp;not&nbsp;convert&nbsp;relative&nbsp;paths&nbsp;to&nbsp;absolute&nbsp;paths&nbsp;like&nbsp;Redirect&nbsp;does.</span><br>
<span class="lineno"></span><span class="keyword" id="4122093">func</span>&nbsp;<span class="ident" id="4122098">localRedirect</span><span class="op" id="4122111">(</span><span class="ident" id="4122112">w</span>&nbsp;<span class="ident" id="4122114"><a href="/gostd/net/http/server.go.html#4170569">ResponseWriter</a></span><span class="op" id="4122128">,</span>&nbsp;<span class="ident" id="4122130">r</span>&nbsp;<span class="op" id="4122132">*</span><span class="ident" id="4122133"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4122140">,</span>&nbsp;<span class="ident" id="4122142">newPath</span>&nbsp;<span class="builtintype" id="4122150">string</span><span class="op" id="4122156">)</span>&nbsp;<span class="op" id="4122158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122161">if</span>&nbsp;<span class="ident" id="4122164">q</span>&nbsp;<span class="op" id="4122166">:=</span>&nbsp;<span class="ident" id="4122169"><a href="/gostd/net/http/fs.go.html#4122130">r</a></span><span class="op" id="4122170">.</span><span class="ident" id="4122171"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="4122174">.</span><span class="ident" id="4122175"><a href="/gostd/net/url/url.go.html#3751383">RawQuery</a></span><span class="op" id="4122183">;</span>&nbsp;<span class="ident" id="4122185"><a href="/gostd/net/http/fs.go.html#4122164">q</a></span>&nbsp;<span class="op" id="4122187">!=</span>&nbsp;<span class="string" id="4122190">&#34;&#34;</span>&nbsp;<span class="op" id="4122193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4122197"><a href="/gostd/net/http/fs.go.html#4122142">newPath</a></span>&nbsp;<span class="op" id="4122205">+=</span>&nbsp;<span class="string" id="4122208">&#34;?&#34;</span>&nbsp;<span class="op" id="4122212">+</span>&nbsp;<span class="ident" id="4122214"><a href="/gostd/net/http/fs.go.html#4122164">q</a></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4122217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4122220"><a href="/gostd/net/http/fs.go.html#4122112">w</a></span><span class="op" id="4122221">.</span><span class="ident" id="4122222"><a href="/gostd/net/http/server.go.html#4170747">Header</a></span><span class="op" id="4122228">(</span><span class="op" id="4122229">)</span><span class="op" id="4122230">.</span><span class="ident" id="4122231"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="4122234">(</span><span class="string" id="4122235">&#34;Location&#34;</span><span class="op" id="4122245">,</span>&nbsp;<span class="ident" id="4122247"><a href="/gostd/net/http/fs.go.html#4122142">newPath</a></span><span class="op" id="4122254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4122257"><a href="/gostd/net/http/fs.go.html#4122112">w</a></span><span class="op" id="4122258">.</span><span class="ident" id="4122259"><a href="/gostd/net/http/server.go.html#4171422">WriteHeader</a></span><span class="op" id="4122270">(</span><span class="ident" id="4122271"><a href="/gostd/net/http/status.go.html#4236480">StatusMovedPermanently</a></span><span class="op" id="4122293">)</span><br>
<span class="lineno"></span><span class="op" id="4122295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span><span class="comment" id="4122298">//&nbsp;ServeFile&nbsp;replies&nbsp;to&nbsp;the&nbsp;request&nbsp;with&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;named&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="4122384">func</span>&nbsp;<span class="ident" id="4122389">ServeFile</span><span class="op" id="4122398">(</span><span class="ident" id="4122399">w</span>&nbsp;<span class="ident" id="4122401"><a href="/gostd/net/http/server.go.html#4170569">ResponseWriter</a></span><span class="op" id="4122415">,</span>&nbsp;<span class="ident" id="4122417">r</span>&nbsp;<span class="op" id="4122419">*</span><span class="ident" id="4122420"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4122427">,</span>&nbsp;<span class="ident" id="4122429">name</span>&nbsp;<span class="builtintype" id="4122434">string</span><span class="op" id="4122440">)</span>&nbsp;<span class="op" id="4122442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4122445">dir</span><span class="op" id="4122448">,</span>&nbsp;<span class="ident" id="4122450">file</span>&nbsp;<span class="op" id="4122455">:=</span>&nbsp;<span class="ident" id="4122458"><a href="/gostd/net/http/fs.go.html#4109929">filepath</a></span><span class="op" id="4122466">.</span><span class="ident" id="4122467"><a href="/gostd/path/filepath/path.go.html#3783242">Split</a></span><span class="op" id="4122472">(</span><span class="ident" id="4122473"><a href="/gostd/net/http/fs.go.html#4122429">name</a></span><span class="op" id="4122477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4122480"><a href="/gostd/net/http/fs.go.html#4120413">serveFile</a></span><span class="op" id="4122489">(</span><span class="ident" id="4122490"><a href="/gostd/net/http/fs.go.html#4122399">w</a></span><span class="op" id="4122491">,</span>&nbsp;<span class="ident" id="4122493"><a href="/gostd/net/http/fs.go.html#4122417">r</a></span><span class="op" id="4122494">,</span>&nbsp;<span class="ident" id="4122496"><a href="/gostd/net/http/fs.go.html#4110341">Dir</a></span><span class="op" id="4122499">(</span><span class="ident" id="4122500"><a href="/gostd/net/http/fs.go.html#4122445">dir</a></span><span class="op" id="4122503">)</span><span class="op" id="4122504">,</span>&nbsp;<span class="ident" id="4122506"><a href="/gostd/net/http/fs.go.html#4122450">file</a></span><span class="op" id="4122510">,</span>&nbsp;<span class="builtintype" id="4122512">false</span><span class="op" id="4122517">)</span><br>
<span class="lineno"></span><span class="op" id="4122519">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span><span class="keyword" id="4122522">type</span>&nbsp;<span class="ident" id="4122527">fileHandler</span>&nbsp;<span class="keyword" id="4122539">struct</span>&nbsp;<span class="op" id="4122546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4122549">root</span>&nbsp;<span class="ident" id="4122554"><a href="/gostd/net/http/fs.go.html#4110976">FileSystem</a></span><br>
<span class="lineno"></span><span class="op" id="4122565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="comment" id="4122568">//&nbsp;FileServer&nbsp;returns&nbsp;a&nbsp;handler&nbsp;that&nbsp;serves&nbsp;HTTP&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="4122626">//&nbsp;with&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;file&nbsp;system&nbsp;rooted&nbsp;at&nbsp;root.</span><br>
<span class="lineno"></span><span class="comment" id="4122682">//</span><br>
<span class="lineno"></span><span class="comment" id="4122685">//&nbsp;To&nbsp;use&nbsp;the&nbsp;operating&nbsp;system&#39;s&nbsp;file&nbsp;system&nbsp;implementation,</span><br>
<span class="lineno"></span><span class="comment" id="4122746">//&nbsp;use&nbsp;http.Dir:</span><br>
<span class="lineno">440</span><span class="comment" id="4122763">//</span><br>
<span class="lineno"></span><span class="comment" id="4122766">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http.Handle(&#34;/&#34;,&nbsp;http.FileServer(http.Dir(&#34;/tmp&#34;)))</span><br>
<span class="lineno"></span><span class="keyword" id="4122825">func</span>&nbsp;<span class="ident" id="4122830">FileServer</span><span class="op" id="4122840">(</span><span class="ident" id="4122841">root</span>&nbsp;<span class="ident" id="4122846"><a href="/gostd/net/http/fs.go.html#4110976">FileSystem</a></span><span class="op" id="4122856">)</span>&nbsp;<span class="ident" id="4122858"><a href="/gostd/net/http/server.go.html#4170413">Handler</a></span>&nbsp;<span class="op" id="4122866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122869">return</span>&nbsp;<span class="op" id="4122876">&amp;</span><span class="ident" id="4122877"><a href="/gostd/net/http/fs.go.html#4122527">fileHandler</a></span><span class="op" id="4122888">{</span><span class="ident" id="4122889"><a href="/gostd/net/http/fs.go.html#4122841">root</a></span><span class="op" id="4122893">}</span><br>
<span class="lineno"></span><span class="op" id="4122895">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="4122898">func</span>&nbsp;<span class="op" id="4122903">(</span><span class="ident" id="4122904">f</span>&nbsp;<span class="op" id="4122906">*</span><span class="ident" id="4122907"><a href="/gostd/net/http/fs.go.html#4122527">fileHandler</a></span><span class="op" id="4122918">)</span>&nbsp;<span class="ident" id="4122920">ServeHTTP</span><span class="op" id="4122929">(</span><span class="ident" id="4122930">w</span>&nbsp;<span class="ident" id="4122932"><a href="/gostd/net/http/server.go.html#4170569">ResponseWriter</a></span><span class="op" id="4122946">,</span>&nbsp;<span class="ident" id="4122948">r</span>&nbsp;<span class="op" id="4122950">*</span><span class="ident" id="4122951"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4122958">)</span>&nbsp;<span class="op" id="4122960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4122963">upath</span>&nbsp;<span class="op" id="4122969">:=</span>&nbsp;<span class="ident" id="4122972"><a href="/gostd/net/http/fs.go.html#4122948">r</a></span><span class="op" id="4122973">.</span><span class="ident" id="4122974"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="4122977">.</span><span class="ident" id="4122978"><a href="/gostd/net/url/url.go.html#3751366">Path</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4122984">if</span>&nbsp;<span class="op" id="4122987">!</span><span class="ident" id="4122988"><a href="/gostd/net/http/fs.go.html#4109957">strings</a></span><span class="op" id="4122995">.</span><span class="ident" id="4122996"><a href="/gostd/strings/strings.go.html#2975366">HasPrefix</a></span><span class="op" id="4123005">(</span><span class="ident" id="4123006"><a href="/gostd/net/http/fs.go.html#4122963">upath</a></span><span class="op" id="4123011">,</span>&nbsp;<span class="string" id="4123013">&#34;/&#34;</span><span class="op" id="4123016">)</span>&nbsp;<span class="op" id="4123018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123022"><a href="/gostd/net/http/fs.go.html#4122963">upath</a></span>&nbsp;<span class="op" id="4123028">=</span>&nbsp;<span class="string" id="4123030">&#34;/&#34;</span>&nbsp;<span class="op" id="4123034">+</span>&nbsp;<span class="ident" id="4123036"><a href="/gostd/net/http/fs.go.html#4122963">upath</a></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123044"><a href="/gostd/net/http/fs.go.html#4122948">r</a></span><span class="op" id="4123045">.</span><span class="ident" id="4123046"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="4123049">.</span><span class="ident" id="4123050"><a href="/gostd/net/url/url.go.html#3751366">Path</a></span>&nbsp;<span class="op" id="4123055">=</span>&nbsp;<span class="ident" id="4123057"><a href="/gostd/net/http/fs.go.html#4122963">upath</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4123064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123067"><a href="/gostd/net/http/fs.go.html#4120413">serveFile</a></span><span class="op" id="4123076">(</span><span class="ident" id="4123077"><a href="/gostd/net/http/fs.go.html#4122930">w</a></span><span class="op" id="4123078">,</span>&nbsp;<span class="ident" id="4123080"><a href="/gostd/net/http/fs.go.html#4122948">r</a></span><span class="op" id="4123081">,</span>&nbsp;<span class="ident" id="4123083"><a href="/gostd/net/http/fs.go.html#4122904">f</a></span><span class="op" id="4123084">.</span><span class="ident" id="4123085"><a href="/gostd/net/http/fs.go.html#4122549">root</a></span><span class="op" id="4123089">,</span>&nbsp;<span class="ident" id="4123091"><a href="/gostd/net/http/fs.go.html#4109921">path</a></span><span class="op" id="4123095">.</span><span class="ident" id="4123096"><a href="/gostd/path/path.go.html#3922001">Clean</a></span><span class="op" id="4123101">(</span><span class="ident" id="4123102"><a href="/gostd/net/http/fs.go.html#4122963">upath</a></span><span class="op" id="4123107">)</span><span class="op" id="4123108">,</span>&nbsp;<span class="builtintype" id="4123110">true</span><span class="op" id="4123114">)</span><br>
<span class="lineno"></span><span class="op" id="4123116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="4123119">//&nbsp;httpRange&nbsp;specifies&nbsp;the&nbsp;byte&nbsp;range&nbsp;to&nbsp;be&nbsp;sent&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="keyword" id="4123183">type</span>&nbsp;<span class="ident" id="4123188">httpRange</span>&nbsp;<span class="keyword" id="4123198">struct</span>&nbsp;<span class="op" id="4123205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123208">start</span><span class="op" id="4123213">,</span>&nbsp;<span class="ident" id="4123215">length</span>&nbsp;<span class="builtintype" id="4123222">int64</span><br>
<span class="lineno"></span><span class="op" id="4123228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="keyword" id="4123231">func</span>&nbsp;<span class="op" id="4123236">(</span><span class="ident" id="4123237">r</span>&nbsp;<span class="ident" id="4123239"><a href="/gostd/net/http/fs.go.html#4123188">httpRange</a></span><span class="op" id="4123248">)</span>&nbsp;<span class="ident" id="4123250">contentRange</span><span class="op" id="4123262">(</span><span class="ident" id="4123263">size</span>&nbsp;<span class="builtintype" id="4123268">int64</span><span class="op" id="4123273">)</span>&nbsp;<span class="builtintype" id="4123275">string</span>&nbsp;<span class="op" id="4123282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123285">return</span>&nbsp;<span class="ident" id="4123292"><a href="/gostd/net/http/fs.go.html#4109848">fmt</a></span><span class="op" id="4123295">.</span><span class="ident" id="4123296"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="4123303">(</span><span class="string" id="4123304">&#34;bytes&nbsp;%d-%d/%d&#34;</span><span class="op" id="4123320">,</span>&nbsp;<span class="ident" id="4123322"><a href="/gostd/net/http/fs.go.html#4123237">r</a></span><span class="op" id="4123323">.</span><span class="ident" id="4123324"><a href="/gostd/net/http/fs.go.html#4123208">start</a></span><span class="op" id="4123329">,</span>&nbsp;<span class="ident" id="4123331"><a href="/gostd/net/http/fs.go.html#4123237">r</a></span><span class="op" id="4123332">.</span><span class="ident" id="4123333"><a href="/gostd/net/http/fs.go.html#4123208">start</a></span><span class="op" id="4123338">+</span><span class="ident" id="4123339"><a href="/gostd/net/http/fs.go.html#4123237">r</a></span><span class="op" id="4123340">.</span><span class="ident" id="4123341"><a href="/gostd/net/http/fs.go.html#4123215">length</a></span><span class="op" id="4123347">-</span><span class="num" id="4123348">1</span><span class="op" id="4123349">,</span>&nbsp;<span class="ident" id="4123351"><a href="/gostd/net/http/fs.go.html#4123263">size</a></span><span class="op" id="4123355">)</span><br>
<span class="lineno"></span><span class="op" id="4123357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4123360">func</span>&nbsp;<span class="op" id="4123365">(</span><span class="ident" id="4123366">r</span>&nbsp;<span class="ident" id="4123368"><a href="/gostd/net/http/fs.go.html#4123188">httpRange</a></span><span class="op" id="4123377">)</span>&nbsp;<span class="ident" id="4123379">mimeHeader</span><span class="op" id="4123389">(</span><span class="ident" id="4123390">contentType</span>&nbsp;<span class="builtintype" id="4123402">string</span><span class="op" id="4123408">,</span>&nbsp;<span class="ident" id="4123410">size</span>&nbsp;<span class="builtintype" id="4123415">int64</span><span class="op" id="4123420">)</span>&nbsp;<span class="ident" id="4123422"><a href="/gostd/net/http/fs.go.html#4109887">textproto</a></span><span class="op" id="4123431">.</span><span class="ident" id="4123432"><a href="/gostd/net/textproto/header.go.html#4328626">MIMEHeader</a></span>&nbsp;<span class="op" id="4123443">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123446">return</span>&nbsp;<span class="ident" id="4123453"><a href="/gostd/net/http/fs.go.html#4109887">textproto</a></span><span class="op" id="4123462">.</span><span class="ident" id="4123463"><a href="/gostd/net/textproto/header.go.html#4328626">MIMEHeader</a></span><span class="op" id="4123473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4123477">&#34;Content-Range&#34;</span><span class="op" id="4123492">:</span>&nbsp;<span class="op" id="4123494">{</span><span class="ident" id="4123495"><a href="/gostd/net/http/fs.go.html#4123366">r</a></span><span class="op" id="4123496">.</span><span class="ident" id="4123497"><a href="/gostd/net/http/fs.go.html#4123250">contentRange</a></span><span class="op" id="4123509">(</span><span class="ident" id="4123510"><a href="/gostd/net/http/fs.go.html#4123410">size</a></span><span class="op" id="4123514">)</span><span class="op" id="4123515">}</span><span class="op" id="4123516">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4123520">&#34;Content-Type&#34;</span><span class="op" id="4123534">:</span>&nbsp;&nbsp;<span class="op" id="4123537">{</span><span class="ident" id="4123538"><a href="/gostd/net/http/fs.go.html#4123390">contentType</a></span><span class="op" id="4123549">}</span><span class="op" id="4123550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4123553">}</span><br>
<span class="lineno"></span><span class="op" id="4123555">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="4123558">//&nbsp;parseRange&nbsp;parses&nbsp;a&nbsp;Range&nbsp;header&nbsp;string&nbsp;as&nbsp;per&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="keyword" id="4123618">func</span>&nbsp;<span class="ident" id="4123623">parseRange</span><span class="op" id="4123633">(</span><span class="ident" id="4123634">s</span>&nbsp;<span class="builtintype" id="4123636">string</span><span class="op" id="4123642">,</span>&nbsp;<span class="ident" id="4123644">size</span>&nbsp;<span class="builtintype" id="4123649">int64</span><span class="op" id="4123654">)</span>&nbsp;<span class="op" id="4123656">(</span><span class="op" id="4123657">[</span><span class="op" id="4123658">]</span><span class="ident" id="4123659"><a href="/gostd/net/http/fs.go.html#4123188">httpRange</a></span><span class="op" id="4123668">,</span>&nbsp;<span class="builtintype" id="4123670">error</span><span class="op" id="4123675">)</span>&nbsp;<span class="op" id="4123677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123680">if</span>&nbsp;<span class="ident" id="4123683"><a href="/gostd/net/http/fs.go.html#4123634">s</a></span>&nbsp;<span class="op" id="4123685">==</span>&nbsp;<span class="string" id="4123688">&#34;&#34;</span>&nbsp;<span class="op" id="4123691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123695">return</span>&nbsp;<span class="builtintype" id="4123702">nil</span><span class="op" id="4123705">,</span>&nbsp;<span class="builtintype" id="4123707">nil</span>&nbsp;<span class="comment" id="4123711">//&nbsp;header&nbsp;not&nbsp;present</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4123734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123737">const</span>&nbsp;<span class="ident" id="4123743">b</span>&nbsp;<span class="op" id="4123745">=</span>&nbsp;<span class="string" id="4123747">&#34;bytes=&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123757">if</span>&nbsp;<span class="op" id="4123760">!</span><span class="ident" id="4123761"><a href="/gostd/net/http/fs.go.html#4109957">strings</a></span><span class="op" id="4123768">.</span><span class="ident" id="4123769"><a href="/gostd/strings/strings.go.html#2975366">HasPrefix</a></span><span class="op" id="4123778">(</span><span class="ident" id="4123779"><a href="/gostd/net/http/fs.go.html#4123634">s</a></span><span class="op" id="4123780">,</span>&nbsp;<span class="ident" id="4123782"><a href="/gostd/net/http/fs.go.html#4123743">b</a></span><span class="op" id="4123783">)</span>&nbsp;<span class="op" id="4123785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123789">return</span>&nbsp;<span class="builtintype" id="4123796">nil</span><span class="op" id="4123799">,</span>&nbsp;<span class="ident" id="4123801"><a href="/gostd/net/http/fs.go.html#4109838">errors</a></span><span class="op" id="4123807">.</span><span class="ident" id="4123808"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4123811">(</span><span class="string" id="4123812">&#34;invalid&nbsp;range&#34;</span><span class="op" id="4123827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4123830">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123833">var</span>&nbsp;<span class="ident" id="4123837">ranges</span>&nbsp;<span class="op" id="4123844">[</span><span class="op" id="4123845">]</span><span class="ident" id="4123846"><a href="/gostd/net/http/fs.go.html#4123188">httpRange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123857">for</span>&nbsp;<span class="ident" id="4123861">_</span><span class="op" id="4123862">,</span>&nbsp;<span class="ident" id="4123864">ra</span>&nbsp;<span class="op" id="4123867">:=</span>&nbsp;<span class="keyword" id="4123870">range</span>&nbsp;<span class="ident" id="4123876"><a href="/gostd/net/http/fs.go.html#4109957">strings</a></span><span class="op" id="4123883">.</span><span class="ident" id="4123884"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="4123889">(</span><span class="ident" id="4123890"><a href="/gostd/net/http/fs.go.html#4123634">s</a></span><span class="op" id="4123891">[</span><span class="builtinfunc" id="4123892">len</span><span class="op" id="4123895">(</span><span class="ident" id="4123896"><a href="/gostd/net/http/fs.go.html#4123743">b</a></span><span class="op" id="4123897">)</span><span class="op" id="4123898">:</span><span class="op" id="4123899">]</span><span class="op" id="4123900">,</span>&nbsp;<span class="string" id="4123902">&#34;,&#34;</span><span class="op" id="4123905">)</span>&nbsp;<span class="op" id="4123907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123911"><a href="/gostd/net/http/fs.go.html#4123864">ra</a></span>&nbsp;<span class="op" id="4123914">=</span>&nbsp;<span class="ident" id="4123916"><a href="/gostd/net/http/fs.go.html#4109957">strings</a></span><span class="op" id="4123923">.</span><span class="ident" id="4123924"><a href="/gostd/strings/strings.go.html#2982525">TrimSpace</a></span><span class="op" id="4123933">(</span><span class="ident" id="4123934"><a href="/gostd/net/http/fs.go.html#4123864">ra</a></span><span class="op" id="4123936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123940">if</span>&nbsp;<span class="ident" id="4123943"><a href="/gostd/net/http/fs.go.html#4123864">ra</a></span>&nbsp;<span class="op" id="4123946">==</span>&nbsp;<span class="string" id="4123949">&#34;&#34;</span>&nbsp;<span class="op" id="4123952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4123957">continue</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4123968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4123972">i</span>&nbsp;<span class="op" id="4123974">:=</span>&nbsp;<span class="ident" id="4123977"><a href="/gostd/net/http/fs.go.html#4109957">strings</a></span><span class="op" id="4123984">.</span><span class="ident" id="4123985"><a href="/gostd/strings/strings.go.html#2968883">Index</a></span><span class="op" id="4123990">(</span><span class="ident" id="4123991"><a href="/gostd/net/http/fs.go.html#4123864">ra</a></span><span class="op" id="4123993">,</span>&nbsp;<span class="string" id="4123995">&#34;-&#34;</span><span class="op" id="4123998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124002">if</span>&nbsp;<span class="ident" id="4124005"><a href="/gostd/net/http/fs.go.html#4123972">i</a></span>&nbsp;<span class="op" id="4124007">&lt;</span>&nbsp;<span class="num" id="4124009">0</span>&nbsp;<span class="op" id="4124011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124016">return</span>&nbsp;<span class="builtintype" id="4124023">nil</span><span class="op" id="4124026">,</span>&nbsp;<span class="ident" id="4124028"><a href="/gostd/net/http/fs.go.html#4109838">errors</a></span><span class="op" id="4124034">.</span><span class="ident" id="4124035"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4124038">(</span><span class="string" id="4124039">&#34;invalid&nbsp;range&#34;</span><span class="op" id="4124054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4124058">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124062">start</span><span class="op" id="4124067">,</span>&nbsp;<span class="ident" id="4124069">end</span>&nbsp;<span class="op" id="4124073">:=</span>&nbsp;<span class="ident" id="4124076"><a href="/gostd/net/http/fs.go.html#4109957">strings</a></span><span class="op" id="4124083">.</span><span class="ident" id="4124084"><a href="/gostd/strings/strings.go.html#2982525">TrimSpace</a></span><span class="op" id="4124093">(</span><span class="ident" id="4124094"><a href="/gostd/net/http/fs.go.html#4123864">ra</a></span><span class="op" id="4124096">[</span><span class="op" id="4124097">:</span><span class="ident" id="4124098"><a href="/gostd/net/http/fs.go.html#4123972">i</a></span><span class="op" id="4124099">]</span><span class="op" id="4124100">)</span><span class="op" id="4124101">,</span>&nbsp;<span class="ident" id="4124103"><a href="/gostd/net/http/fs.go.html#4109957">strings</a></span><span class="op" id="4124110">.</span><span class="ident" id="4124111"><a href="/gostd/strings/strings.go.html#2982525">TrimSpace</a></span><span class="op" id="4124120">(</span><span class="ident" id="4124121"><a href="/gostd/net/http/fs.go.html#4123864">ra</a></span><span class="op" id="4124123">[</span><span class="ident" id="4124124"><a href="/gostd/net/http/fs.go.html#4123972">i</a></span><span class="op" id="4124125">+</span><span class="num" id="4124126">1</span><span class="op" id="4124127">:</span><span class="op" id="4124128">]</span><span class="op" id="4124129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124133">var</span>&nbsp;<span class="ident" id="4124137">r</span>&nbsp;<span class="ident" id="4124139"><a href="/gostd/net/http/fs.go.html#4123188">httpRange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124151">if</span>&nbsp;<span class="ident" id="4124154"><a href="/gostd/net/http/fs.go.html#4124062">start</a></span>&nbsp;<span class="op" id="4124160">==</span>&nbsp;<span class="string" id="4124163">&#34;&#34;</span>&nbsp;<span class="op" id="4124166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124171">//&nbsp;If&nbsp;no&nbsp;start&nbsp;is&nbsp;specified,&nbsp;end&nbsp;specifies&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124221">//&nbsp;range&nbsp;start&nbsp;relative&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124272">i</span><span class="op" id="4124273">,</span>&nbsp;<span class="ident" id="4124275">err</span>&nbsp;<span class="op" id="4124279">:=</span>&nbsp;<span class="ident" id="4124282"><a href="/gostd/net/http/fs.go.html#4109946">strconv</a></span><span class="op" id="4124289">.</span><span class="ident" id="4124290"><a href="/gostd/strconv/atoi.go.html#2356133">ParseInt</a></span><span class="op" id="4124298">(</span><span class="ident" id="4124299"><a href="/gostd/net/http/fs.go.html#4124069">end</a></span><span class="op" id="4124302">,</span>&nbsp;<span class="num" id="4124304">10</span><span class="op" id="4124306">,</span>&nbsp;<span class="num" id="4124308">64</span><span class="op" id="4124310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124315">if</span>&nbsp;<span class="ident" id="4124318"><a href="/gostd/net/http/fs.go.html#4124275">err</a></span>&nbsp;<span class="op" id="4124322">!=</span>&nbsp;<span class="builtintype" id="4124325">nil</span>&nbsp;<span class="op" id="4124329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124335">return</span>&nbsp;<span class="builtintype" id="4124342">nil</span><span class="op" id="4124345">,</span>&nbsp;<span class="ident" id="4124347"><a href="/gostd/net/http/fs.go.html#4109838">errors</a></span><span class="op" id="4124353">.</span><span class="ident" id="4124354"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4124357">(</span><span class="string" id="4124358">&#34;invalid&nbsp;range&#34;</span><span class="op" id="4124373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4124378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124383">if</span>&nbsp;<span class="ident" id="4124386"><a href="/gostd/net/http/fs.go.html#4124272">i</a></span>&nbsp;<span class="op" id="4124388">&gt;</span>&nbsp;<span class="ident" id="4124390"><a href="/gostd/net/http/fs.go.html#4123644">size</a></span>&nbsp;<span class="op" id="4124395">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124401"><a href="/gostd/net/http/fs.go.html#4124272">i</a></span>&nbsp;<span class="op" id="4124403">=</span>&nbsp;<span class="ident" id="4124405"><a href="/gostd/net/http/fs.go.html#4123644">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4124413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124418"><a href="/gostd/net/http/fs.go.html#4124137">r</a></span><span class="op" id="4124419">.</span><span class="ident" id="4124420"><a href="/gostd/net/http/fs.go.html#4123208">start</a></span>&nbsp;<span class="op" id="4124426">=</span>&nbsp;<span class="ident" id="4124428"><a href="/gostd/net/http/fs.go.html#4123644">size</a></span>&nbsp;<span class="op" id="4124433">-</span>&nbsp;<span class="ident" id="4124435"><a href="/gostd/net/http/fs.go.html#4124272">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124440"><a href="/gostd/net/http/fs.go.html#4124137">r</a></span><span class="op" id="4124441">.</span><span class="ident" id="4124442"><a href="/gostd/net/http/fs.go.html#4123215">length</a></span>&nbsp;<span class="op" id="4124449">=</span>&nbsp;<span class="ident" id="4124451"><a href="/gostd/net/http/fs.go.html#4123644">size</a></span>&nbsp;<span class="op" id="4124456">-</span>&nbsp;<span class="ident" id="4124458"><a href="/gostd/net/http/fs.go.html#4124137">r</a></span><span class="op" id="4124459">.</span><span class="ident" id="4124460"><a href="/gostd/net/http/fs.go.html#4123208">start</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4124468">}</span>&nbsp;<span class="keyword" id="4124470">else</span>&nbsp;<span class="op" id="4124475">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124480">i</span><span class="op" id="4124481">,</span>&nbsp;<span class="ident" id="4124483">err</span>&nbsp;<span class="op" id="4124487">:=</span>&nbsp;<span class="ident" id="4124490"><a href="/gostd/net/http/fs.go.html#4109946">strconv</a></span><span class="op" id="4124497">.</span><span class="ident" id="4124498"><a href="/gostd/strconv/atoi.go.html#2356133">ParseInt</a></span><span class="op" id="4124506">(</span><span class="ident" id="4124507"><a href="/gostd/net/http/fs.go.html#4124062">start</a></span><span class="op" id="4124512">,</span>&nbsp;<span class="num" id="4124514">10</span><span class="op" id="4124516">,</span>&nbsp;<span class="num" id="4124518">64</span><span class="op" id="4124520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124525">if</span>&nbsp;<span class="ident" id="4124528"><a href="/gostd/net/http/fs.go.html#4124483">err</a></span>&nbsp;<span class="op" id="4124532">!=</span>&nbsp;<span class="builtintype" id="4124535">nil</span>&nbsp;<span class="op" id="4124539">||</span>&nbsp;<span class="ident" id="4124542"><a href="/gostd/net/http/fs.go.html#4124480">i</a></span>&nbsp;<span class="op" id="4124544">&gt;</span>&nbsp;<span class="ident" id="4124546"><a href="/gostd/net/http/fs.go.html#4123644">size</a></span>&nbsp;<span class="op" id="4124551">||</span>&nbsp;<span class="ident" id="4124554"><a href="/gostd/net/http/fs.go.html#4124480">i</a></span>&nbsp;<span class="op" id="4124556">&lt;</span>&nbsp;<span class="num" id="4124558">0</span>&nbsp;<span class="op" id="4124560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124566">return</span>&nbsp;<span class="builtintype" id="4124573">nil</span><span class="op" id="4124576">,</span>&nbsp;<span class="ident" id="4124578"><a href="/gostd/net/http/fs.go.html#4109838">errors</a></span><span class="op" id="4124584">.</span><span class="ident" id="4124585"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4124588">(</span><span class="string" id="4124589">&#34;invalid&nbsp;range&#34;</span><span class="op" id="4124604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4124609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124614"><a href="/gostd/net/http/fs.go.html#4124137">r</a></span><span class="op" id="4124615">.</span><span class="ident" id="4124616"><a href="/gostd/net/http/fs.go.html#4123208">start</a></span>&nbsp;<span class="op" id="4124622">=</span>&nbsp;<span class="ident" id="4124624"><a href="/gostd/net/http/fs.go.html#4124480">i</a></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124629">if</span>&nbsp;<span class="ident" id="4124632"><a href="/gostd/net/http/fs.go.html#4124069">end</a></span>&nbsp;<span class="op" id="4124636">==</span>&nbsp;<span class="string" id="4124639">&#34;&#34;</span>&nbsp;<span class="op" id="4124642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4124648">//&nbsp;If&nbsp;no&nbsp;end&nbsp;is&nbsp;specified,&nbsp;range&nbsp;extends&nbsp;to&nbsp;end&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124713"><a href="/gostd/net/http/fs.go.html#4124137">r</a></span><span class="op" id="4124714">.</span><span class="ident" id="4124715"><a href="/gostd/net/http/fs.go.html#4123215">length</a></span>&nbsp;<span class="op" id="4124722">=</span>&nbsp;<span class="ident" id="4124724"><a href="/gostd/net/http/fs.go.html#4123644">size</a></span>&nbsp;<span class="op" id="4124729">-</span>&nbsp;<span class="ident" id="4124731"><a href="/gostd/net/http/fs.go.html#4124137">r</a></span><span class="op" id="4124732">.</span><span class="ident" id="4124733"><a href="/gostd/net/http/fs.go.html#4123208">start</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4124742">}</span>&nbsp;<span class="keyword" id="4124744">else</span>&nbsp;<span class="op" id="4124749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124755">i</span><span class="op" id="4124756">,</span>&nbsp;<span class="ident" id="4124758">err</span>&nbsp;<span class="op" id="4124762">:=</span>&nbsp;<span class="ident" id="4124765"><a href="/gostd/net/http/fs.go.html#4109946">strconv</a></span><span class="op" id="4124772">.</span><span class="ident" id="4124773"><a href="/gostd/strconv/atoi.go.html#2356133">ParseInt</a></span><span class="op" id="4124781">(</span><span class="ident" id="4124782"><a href="/gostd/net/http/fs.go.html#4124069">end</a></span><span class="op" id="4124785">,</span>&nbsp;<span class="num" id="4124787">10</span><span class="op" id="4124789">,</span>&nbsp;<span class="num" id="4124791">64</span><span class="op" id="4124793">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124799">if</span>&nbsp;<span class="ident" id="4124802"><a href="/gostd/net/http/fs.go.html#4124758">err</a></span>&nbsp;<span class="op" id="4124806">!=</span>&nbsp;<span class="builtintype" id="4124809">nil</span>&nbsp;<span class="op" id="4124813">||</span>&nbsp;<span class="ident" id="4124816"><a href="/gostd/net/http/fs.go.html#4124137">r</a></span><span class="op" id="4124817">.</span><span class="ident" id="4124818"><a href="/gostd/net/http/fs.go.html#4123208">start</a></span>&nbsp;<span class="op" id="4124824">&gt;</span>&nbsp;<span class="ident" id="4124826"><a href="/gostd/net/http/fs.go.html#4124755">i</a></span>&nbsp;<span class="op" id="4124828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124835">return</span>&nbsp;<span class="builtintype" id="4124842">nil</span><span class="op" id="4124845">,</span>&nbsp;<span class="ident" id="4124847"><a href="/gostd/net/http/fs.go.html#4109838">errors</a></span><span class="op" id="4124853">.</span><span class="ident" id="4124854"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4124857">(</span><span class="string" id="4124858">&#34;invalid&nbsp;range&#34;</span><span class="op" id="4124873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4124879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124885">if</span>&nbsp;<span class="ident" id="4124888"><a href="/gostd/net/http/fs.go.html#4124755">i</a></span>&nbsp;<span class="op" id="4124890">&gt;=</span>&nbsp;<span class="ident" id="4124893"><a href="/gostd/net/http/fs.go.html#4123644">size</a></span>&nbsp;<span class="op" id="4124898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124905"><a href="/gostd/net/http/fs.go.html#4124755">i</a></span>&nbsp;<span class="op" id="4124907">=</span>&nbsp;<span class="ident" id="4124909"><a href="/gostd/net/http/fs.go.html#4123644">size</a></span>&nbsp;<span class="op" id="4124914">-</span>&nbsp;<span class="num" id="4124916">1</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4124922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124928"><a href="/gostd/net/http/fs.go.html#4124137">r</a></span><span class="op" id="4124929">.</span><span class="ident" id="4124930"><a href="/gostd/net/http/fs.go.html#4123215">length</a></span>&nbsp;<span class="op" id="4124937">=</span>&nbsp;<span class="ident" id="4124939"><a href="/gostd/net/http/fs.go.html#4124755">i</a></span>&nbsp;<span class="op" id="4124941">-</span>&nbsp;<span class="ident" id="4124943"><a href="/gostd/net/http/fs.go.html#4124137">r</a></span><span class="op" id="4124944">.</span><span class="ident" id="4124945"><a href="/gostd/net/http/fs.go.html#4123208">start</a></span>&nbsp;<span class="op" id="4124951">+</span>&nbsp;<span class="num" id="4124953">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4124958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4124962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4124966"><a href="/gostd/net/http/fs.go.html#4123837">ranges</a></span>&nbsp;<span class="op" id="4124973">=</span>&nbsp;<span class="builtinfunc" id="4124975">append</span><span class="op" id="4124981">(</span><span class="ident" id="4124982"><a href="/gostd/net/http/fs.go.html#4123837">ranges</a></span><span class="op" id="4124988">,</span>&nbsp;<span class="ident" id="4124990"><a href="/gostd/net/http/fs.go.html#4124137">r</a></span><span class="op" id="4124991">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4124994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4124997">return</span>&nbsp;<span class="ident" id="4125004"><a href="/gostd/net/http/fs.go.html#4123837">ranges</a></span><span class="op" id="4125010">,</span>&nbsp;<span class="builtintype" id="4125012">nil</span><br>
<span class="lineno"></span><span class="op" id="4125016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4125019">//&nbsp;countingWriter&nbsp;counts&nbsp;how&nbsp;many&nbsp;bytes&nbsp;have&nbsp;been&nbsp;written&nbsp;to&nbsp;it.</span><br>
<span class="lineno">530</span><span class="keyword" id="4125084">type</span>&nbsp;<span class="ident" id="4125089">countingWriter</span>&nbsp;<span class="builtintype" id="4125104">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4125111">func</span>&nbsp;<span class="op" id="4125116">(</span><span class="ident" id="4125117">w</span>&nbsp;<span class="op" id="4125119">*</span><span class="ident" id="4125120"><a href="/gostd/net/http/fs.go.html#4125089">countingWriter</a></span><span class="op" id="4125134">)</span>&nbsp;<span class="ident" id="4125136">Write</span><span class="op" id="4125141">(</span><span class="ident" id="4125142">p</span>&nbsp;<span class="op" id="4125144">[</span><span class="op" id="4125145">]</span><span class="builtintype" id="4125146">byte</span><span class="op" id="4125150">)</span>&nbsp;<span class="op" id="4125152">(</span><span class="ident" id="4125153">n</span>&nbsp;<span class="builtintype" id="4125155">int</span><span class="op" id="4125158">,</span>&nbsp;<span class="ident" id="4125160">err</span>&nbsp;<span class="builtintype" id="4125164">error</span><span class="op" id="4125169">)</span>&nbsp;<span class="op" id="4125171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4125174">*</span><span class="ident" id="4125175"><a href="/gostd/net/http/fs.go.html#4125117">w</a></span>&nbsp;<span class="op" id="4125177">+=</span>&nbsp;<span class="ident" id="4125180"><a href="/gostd/net/http/fs.go.html#4125089">countingWriter</a></span><span class="op" id="4125194">(</span><span class="builtinfunc" id="4125195">len</span><span class="op" id="4125198">(</span><span class="ident" id="4125199"><a href="/gostd/net/http/fs.go.html#4125142">p</a></span><span class="op" id="4125200">)</span><span class="op" id="4125201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4125204">return</span>&nbsp;<span class="builtinfunc" id="4125211">len</span><span class="op" id="4125214">(</span><span class="ident" id="4125215"><a href="/gostd/net/http/fs.go.html#4125142">p</a></span><span class="op" id="4125216">)</span><span class="op" id="4125217">,</span>&nbsp;<span class="builtintype" id="4125219">nil</span><br>
<span class="lineno">535</span><span class="op" id="4125223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4125226">//&nbsp;rangesMIMESize&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;it&nbsp;takes&nbsp;to&nbsp;encode&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4125295">//&nbsp;provided&nbsp;ranges&nbsp;as&nbsp;a&nbsp;multipart&nbsp;response.</span><br>
<span class="lineno"></span><span class="keyword" id="4125339">func</span>&nbsp;<span class="ident" id="4125344">rangesMIMESize</span><span class="op" id="4125358">(</span><span class="ident" id="4125359">ranges</span>&nbsp;<span class="op" id="4125366">[</span><span class="op" id="4125367">]</span><span class="ident" id="4125368"><a href="/gostd/net/http/fs.go.html#4123188">httpRange</a></span><span class="op" id="4125377">,</span>&nbsp;<span class="ident" id="4125379">contentType</span>&nbsp;<span class="builtintype" id="4125391">string</span><span class="op" id="4125397">,</span>&nbsp;<span class="ident" id="4125399">contentSize</span>&nbsp;<span class="builtintype" id="4125411">int64</span><span class="op" id="4125416">)</span>&nbsp;<span class="op" id="4125418">(</span><span class="ident" id="4125419">encSize</span>&nbsp;<span class="builtintype" id="4125427">int64</span><span class="op" id="4125432">)</span>&nbsp;<span class="op" id="4125434">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4125437">var</span>&nbsp;<span class="ident" id="4125441">w</span>&nbsp;<span class="ident" id="4125443"><a href="/gostd/net/http/fs.go.html#4125089">countingWriter</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125459">mw</span>&nbsp;<span class="op" id="4125462">:=</span>&nbsp;<span class="ident" id="4125465"><a href="/gostd/net/http/fs.go.html#4109869">multipart</a></span><span class="op" id="4125474">.</span><span class="ident" id="4125475"><a href="/gostd/mime/multipart/writer.go.html#4324179">NewWriter</a></span><span class="op" id="4125484">(</span><span class="op" id="4125485">&amp;</span><span class="ident" id="4125486"><a href="/gostd/net/http/fs.go.html#4125441">w</a></span><span class="op" id="4125487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4125490">for</span>&nbsp;<span class="ident" id="4125494">_</span><span class="op" id="4125495">,</span>&nbsp;<span class="ident" id="4125497">ra</span>&nbsp;<span class="op" id="4125500">:=</span>&nbsp;<span class="keyword" id="4125503">range</span>&nbsp;<span class="ident" id="4125509"><a href="/gostd/net/http/fs.go.html#4125359">ranges</a></span>&nbsp;<span class="op" id="4125516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125520"><a href="/gostd/net/http/fs.go.html#4125459">mw</a></span><span class="op" id="4125522">.</span><span class="ident" id="4125523"><a href="/gostd/mime/multipart/writer.go.html#4325830">CreatePart</a></span><span class="op" id="4125533">(</span><span class="ident" id="4125534"><a href="/gostd/net/http/fs.go.html#4125497">ra</a></span><span class="op" id="4125536">.</span><span class="ident" id="4125537"><a href="/gostd/net/http/fs.go.html#4123379">mimeHeader</a></span><span class="op" id="4125547">(</span><span class="ident" id="4125548"><a href="/gostd/net/http/fs.go.html#4125379">contentType</a></span><span class="op" id="4125559">,</span>&nbsp;<span class="ident" id="4125561"><a href="/gostd/net/http/fs.go.html#4125399">contentSize</a></span><span class="op" id="4125572">)</span><span class="op" id="4125573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125577"><a href="/gostd/net/http/fs.go.html#4125419">encSize</a></span>&nbsp;<span class="op" id="4125585">+=</span>&nbsp;<span class="ident" id="4125588"><a href="/gostd/net/http/fs.go.html#4125497">ra</a></span><span class="op" id="4125590">.</span><span class="ident" id="4125591"><a href="/gostd/net/http/fs.go.html#4123215">length</a></span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4125599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125602"><a href="/gostd/net/http/fs.go.html#4125459">mw</a></span><span class="op" id="4125604">.</span><span class="ident" id="4125605"><a href="/gostd/mime/multipart/writer.go.html#4327790">Close</a></span><span class="op" id="4125610">(</span><span class="op" id="4125611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125614"><a href="/gostd/net/http/fs.go.html#4125419">encSize</a></span>&nbsp;<span class="op" id="4125622">+=</span>&nbsp;<span class="builtintype" id="4125625">int64</span><span class="op" id="4125630">(</span><span class="ident" id="4125631"><a href="/gostd/net/http/fs.go.html#4125441">w</a></span><span class="op" id="4125632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4125635">return</span><br>
<span class="lineno"></span><span class="op" id="4125642">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="keyword" id="4125645">func</span>&nbsp;<span class="ident" id="4125650">sumRangesSize</span><span class="op" id="4125663">(</span><span class="ident" id="4125664">ranges</span>&nbsp;<span class="op" id="4125671">[</span><span class="op" id="4125672">]</span><span class="ident" id="4125673"><a href="/gostd/net/http/fs.go.html#4123188">httpRange</a></span><span class="op" id="4125682">)</span>&nbsp;<span class="op" id="4125684">(</span><span class="ident" id="4125685">size</span>&nbsp;<span class="builtintype" id="4125690">int64</span><span class="op" id="4125695">)</span>&nbsp;<span class="op" id="4125697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4125700">for</span>&nbsp;<span class="ident" id="4125704">_</span><span class="op" id="4125705">,</span>&nbsp;<span class="ident" id="4125707">ra</span>&nbsp;<span class="op" id="4125710">:=</span>&nbsp;<span class="keyword" id="4125713">range</span>&nbsp;<span class="ident" id="4125719"><a href="/gostd/net/http/fs.go.html#4125664">ranges</a></span>&nbsp;<span class="op" id="4125726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4125730"><a href="/gostd/net/http/fs.go.html#4125685">size</a></span>&nbsp;<span class="op" id="4125735">+=</span>&nbsp;<span class="ident" id="4125738"><a href="/gostd/net/http/fs.go.html#4125707">ra</a></span><span class="op" id="4125740">.</span><span class="ident" id="4125741"><a href="/gostd/net/http/fs.go.html#4123215">length</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4125749">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4125752">return</span><br>
<span class="lineno"></span><span class="op" id="4125759">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
