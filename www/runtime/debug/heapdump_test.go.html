<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6750230">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6750285">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6750339">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6750390">package</span>&nbsp;<span class="ident" id="6750398">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6750405">import</span>&nbsp;<span class="op" id="6750412">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6750415">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6750428">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6750434">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6750445">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6750455">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6750458">func</span>&nbsp;<span class="ident" id="6750463">TestWriteHeapDumpNonempty</span><span class="op" id="6750488">(</span><span class="ident" id="6750489">t</span>&nbsp;<span class="op" id="6750491">*</span><span class="ident" id="6750492"><a href="/runtime/debug/heapdump_test.go.html#6750445">testing</a></span><span class="op" id="6750499">.</span><span class="ident" id="6750500">T</span><span class="op" id="6750501">)</span>&nbsp;<span class="op" id="6750503">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6750506">if</span>&nbsp;<span class="ident" id="6750509"><a href="/runtime/debug/heapdump_test.go.html#6750434">runtime</a></span><span class="op" id="6750516">.</span><span class="ident" id="6750517">GOOS</span>&nbsp;<span class="op" id="6750522">==</span>&nbsp;<span class="string" id="6750525">&#34;nacl&#34;</span>&nbsp;<span class="op" id="6750532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750536"><a href="/runtime/debug/heapdump_test.go.html#6750489">t</a></span><span class="op" id="6750537">.</span><span class="ident" id="6750538">Skip</span><span class="op" id="6750542">(</span><span class="string" id="6750543">&#34;WriteHeapDump&nbsp;is&nbsp;not&nbsp;available&nbsp;on&nbsp;NaCl.&#34;</span><span class="op" id="6750584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750590">f</span><span class="op" id="6750591">,</span>&nbsp;<span class="ident" id="6750593">err</span>&nbsp;<span class="op" id="6750597">:=</span>&nbsp;<span class="ident" id="6750600"><a href="/runtime/debug/heapdump_test.go.html#6750415">ioutil</a></span><span class="op" id="6750606">.</span><span class="ident" id="6750607">TempFile</span><span class="op" id="6750615">(</span><span class="string" id="6750616">&#34;&#34;</span><span class="op" id="6750618">,</span>&nbsp;<span class="string" id="6750620">&#34;heapdumptest&#34;</span><span class="op" id="6750634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6750637">if</span>&nbsp;<span class="ident" id="6750640"><a href="/runtime/debug/heapdump_test.go.html#6750593">err</a></span>&nbsp;<span class="op" id="6750644">!=</span>&nbsp;<span class="ident" id="6750647">nil</span>&nbsp;<span class="op" id="6750651">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750655"><a href="/runtime/debug/heapdump_test.go.html#6750489">t</a></span><span class="op" id="6750656">.</span><span class="ident" id="6750657">Fatalf</span><span class="op" id="6750663">(</span><span class="string" id="6750664">&#34;TempFile&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6750685">,</span>&nbsp;<span class="ident" id="6750687"><a href="/runtime/debug/heapdump_test.go.html#6750593">err</a></span><span class="op" id="6750690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6750696">defer</span>&nbsp;<span class="ident" id="6750702"><a href="/runtime/debug/heapdump_test.go.html#6750428">os</a></span><span class="op" id="6750704">.</span><span class="ident" id="6750705">Remove</span><span class="op" id="6750711">(</span><span class="ident" id="6750712"><a href="/runtime/debug/heapdump_test.go.html#6750590">f</a></span><span class="op" id="6750713">.</span><span class="ident" id="6750714">Name</span><span class="op" id="6750718">(</span><span class="op" id="6750719">)</span><span class="op" id="6750720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6750723">defer</span>&nbsp;<span class="ident" id="6750729"><a href="/runtime/debug/heapdump_test.go.html#6750590">f</a></span><span class="op" id="6750730">.</span><span class="ident" id="6750731">Close</span><span class="op" id="6750736">(</span><span class="op" id="6750737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750740"><a href="/runtime/debug/garbage.go.html#6454975">WriteHeapDump</a></span><span class="op" id="6750753">(</span><span class="ident" id="6750754"><a href="/runtime/debug/heapdump_test.go.html#6750590">f</a></span><span class="op" id="6750755">.</span><span class="ident" id="6750756">Fd</span><span class="op" id="6750758">(</span><span class="op" id="6750759">)</span><span class="op" id="6750760">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750763">fi</span><span class="op" id="6750765">,</span>&nbsp;<span class="ident" id="6750767"><a href="/runtime/debug/heapdump_test.go.html#6750593">err</a></span>&nbsp;<span class="op" id="6750771">:=</span>&nbsp;<span class="ident" id="6750774"><a href="/runtime/debug/heapdump_test.go.html#6750590">f</a></span><span class="op" id="6750775">.</span><span class="ident" id="6750776">Stat</span><span class="op" id="6750780">(</span><span class="op" id="6750781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6750784">if</span>&nbsp;<span class="ident" id="6750787"><a href="/runtime/debug/heapdump_test.go.html#6750593">err</a></span>&nbsp;<span class="op" id="6750791">!=</span>&nbsp;<span class="ident" id="6750794">nil</span>&nbsp;<span class="op" id="6750798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750802"><a href="/runtime/debug/heapdump_test.go.html#6750489">t</a></span><span class="op" id="6750803">.</span><span class="ident" id="6750804">Fatalf</span><span class="op" id="6750810">(</span><span class="string" id="6750811">&#34;Stat&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6750828">,</span>&nbsp;<span class="ident" id="6750830"><a href="/runtime/debug/heapdump_test.go.html#6750593">err</a></span><span class="op" id="6750833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6750839">const</span>&nbsp;<span class="ident" id="6750845">minSize</span>&nbsp;<span class="op" id="6750853">=</span>&nbsp;<span class="num" id="6750855">1</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6750858">if</span>&nbsp;<span class="ident" id="6750861">size</span>&nbsp;<span class="op" id="6750866">:=</span>&nbsp;<span class="ident" id="6750869"><a href="/runtime/debug/heapdump_test.go.html#6750763">fi</a></span><span class="op" id="6750871">.</span><span class="ident" id="6750872">Size</span><span class="op" id="6750876">(</span><span class="op" id="6750877">)</span><span class="op" id="6750878">;</span>&nbsp;<span class="ident" id="6750880"><a href="/runtime/debug/heapdump_test.go.html#6750861">size</a></span>&nbsp;<span class="op" id="6750885">&lt;</span>&nbsp;<span class="ident" id="6750887"><a href="/runtime/debug/heapdump_test.go.html#6750845">minSize</a></span>&nbsp;<span class="op" id="6750895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6750899"><a href="/runtime/debug/heapdump_test.go.html#6750489">t</a></span><span class="op" id="6750900">.</span><span class="ident" id="6750901">Fatalf</span><span class="op" id="6750907">(</span><span class="string" id="6750908">&#34;Heap&nbsp;dump&nbsp;size&nbsp;%d&nbsp;bytes,&nbsp;expected&nbsp;at&nbsp;least&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="6750961">,</span>&nbsp;<span class="ident" id="6750963"><a href="/runtime/debug/heapdump_test.go.html#6750861">size</a></span><span class="op" id="6750967">,</span>&nbsp;<span class="ident" id="6750969"><a href="/runtime/debug/heapdump_test.go.html#6750845">minSize</a></span><span class="op" id="6750976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6750979">}</span><br>
<span class="lineno"></span><span class="op" id="6750981">}</span>
</div>
</body>
</html>
