<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4856085">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4856140">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4856194">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4856245">//&nbsp;Package&nbsp;iotest&nbsp;implements&nbsp;Readers&nbsp;and&nbsp;Writers&nbsp;useful&nbsp;mainly&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="4856321">package</span>&nbsp;<span class="ident" id="4856329">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4856337">import</span>&nbsp;<span class="op" id="4856344">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4856347">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4856357">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4856362">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4856365">//&nbsp;OneByteReader&nbsp;returns&nbsp;a&nbsp;Reader&nbsp;that&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="4856415">//&nbsp;each&nbsp;non-empty&nbsp;Read&nbsp;by&nbsp;reading&nbsp;one&nbsp;byte&nbsp;from&nbsp;r.</span><br>
<span class="lineno">15</span><span class="keyword" id="4856466">func</span>&nbsp;<span class="ident" id="4856471">OneByteReader</span><span class="op" id="4856484">(</span><span class="ident" id="4856485">r</span>&nbsp;<span class="ident" id="4856487"><a href="/testing/iotest/reader.go.html#4856357">io</a></span><span class="op" id="4856489">.</span><span class="ident" id="4856490">Reader</span><span class="op" id="4856496">)</span>&nbsp;<span class="ident" id="4856498"><a href="/testing/iotest/reader.go.html#4856357">io</a></span><span class="op" id="4856500">.</span><span class="ident" id="4856501">Reader</span>&nbsp;<span class="op" id="4856508">{</span>&nbsp;<span class="keyword" id="4856510">return</span>&nbsp;<span class="op" id="4856517">&amp;</span><span class="ident" id="4856518"><a href="/testing/iotest/reader.go.html#4856543">oneByteReader</a></span><span class="op" id="4856531">{</span><span class="ident" id="4856532"><a href="/testing/iotest/reader.go.html#4856485">r</a></span><span class="op" id="4856533">}</span>&nbsp;<span class="op" id="4856535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4856538">type</span>&nbsp;<span class="ident" id="4856543">oneByteReader</span>&nbsp;<span class="keyword" id="4856557">struct</span>&nbsp;<span class="op" id="4856564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856567">r</span>&nbsp;<span class="ident" id="4856569"><a href="/testing/iotest/reader.go.html#4856357">io</a></span><span class="op" id="4856571">.</span><span class="ident" id="4856572">Reader</span><br>
<span class="lineno"></span><span class="op" id="4856579">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="4856582">func</span>&nbsp;<span class="op" id="4856587">(</span><span class="ident" id="4856588">r</span>&nbsp;<span class="op" id="4856590">*</span><span class="ident" id="4856591"><a href="/testing/iotest/reader.go.html#4856543">oneByteReader</a></span><span class="op" id="4856604">)</span>&nbsp;<span class="ident" id="4856606">Read</span><span class="op" id="4856610">(</span><span class="ident" id="4856611">p</span>&nbsp;<span class="op" id="4856613">[</span><span class="op" id="4856614">]</span><span class="builtintype" id="4856615">byte</span><span class="op" id="4856619">)</span>&nbsp;<span class="op" id="4856621">(</span><span class="builtintype" id="4856622">int</span><span class="op" id="4856625">,</span>&nbsp;<span class="builtintype" id="4856627">error</span><span class="op" id="4856632">)</span>&nbsp;<span class="op" id="4856634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856637">if</span>&nbsp;<span class="builtinfunc" id="4856640">len</span><span class="op" id="4856643">(</span><span class="ident" id="4856644"><a href="/testing/iotest/reader.go.html#4856611">p</a></span><span class="op" id="4856645">)</span>&nbsp;<span class="op" id="4856647">==</span>&nbsp;<span class="num" id="4856650">0</span>&nbsp;<span class="op" id="4856652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856656">return</span>&nbsp;<span class="num" id="4856663">0</span><span class="op" id="4856664">,</span>&nbsp;<span class="ident" id="4856666">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856671">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856674">return</span>&nbsp;<span class="ident" id="4856681"><a href="/testing/iotest/reader.go.html#4856588">r</a></span><span class="op" id="4856682">.</span><span class="ident" id="4856683">r</span><span class="op" id="4856684">.</span><span class="ident" id="4856685">Read</span><span class="op" id="4856689">(</span><span class="ident" id="4856690"><a href="/testing/iotest/reader.go.html#4856611">p</a></span><span class="op" id="4856691">[</span><span class="num" id="4856692">0</span><span class="op" id="4856693">:</span><span class="num" id="4856694">1</span><span class="op" id="4856695">]</span><span class="op" id="4856696">)</span><br>
<span class="lineno"></span><span class="op" id="4856698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4856701">//&nbsp;HalfReader&nbsp;returns&nbsp;a&nbsp;Reader&nbsp;that&nbsp;implements&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="4856753">//&nbsp;by&nbsp;reading&nbsp;half&nbsp;as&nbsp;many&nbsp;requested&nbsp;bytes&nbsp;from&nbsp;r.</span><br>
<span class="lineno">30</span><span class="keyword" id="4856804">func</span>&nbsp;<span class="ident" id="4856809">HalfReader</span><span class="op" id="4856819">(</span><span class="ident" id="4856820">r</span>&nbsp;<span class="ident" id="4856822"><a href="/testing/iotest/reader.go.html#4856357">io</a></span><span class="op" id="4856824">.</span><span class="ident" id="4856825">Reader</span><span class="op" id="4856831">)</span>&nbsp;<span class="ident" id="4856833"><a href="/testing/iotest/reader.go.html#4856357">io</a></span><span class="op" id="4856835">.</span><span class="ident" id="4856836">Reader</span>&nbsp;<span class="op" id="4856843">{</span>&nbsp;<span class="keyword" id="4856845">return</span>&nbsp;<span class="op" id="4856852">&amp;</span><span class="ident" id="4856853"><a href="/testing/iotest/reader.go.html#4856875">halfReader</a></span><span class="op" id="4856863">{</span><span class="ident" id="4856864"><a href="/testing/iotest/reader.go.html#4856820">r</a></span><span class="op" id="4856865">}</span>&nbsp;<span class="op" id="4856867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4856870">type</span>&nbsp;<span class="ident" id="4856875">halfReader</span>&nbsp;<span class="keyword" id="4856886">struct</span>&nbsp;<span class="op" id="4856893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856896">r</span>&nbsp;<span class="ident" id="4856898"><a href="/testing/iotest/reader.go.html#4856357">io</a></span><span class="op" id="4856900">.</span><span class="ident" id="4856901">Reader</span><br>
<span class="lineno"></span><span class="op" id="4856908">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="4856911">func</span>&nbsp;<span class="op" id="4856916">(</span><span class="ident" id="4856917">r</span>&nbsp;<span class="op" id="4856919">*</span><span class="ident" id="4856920"><a href="/testing/iotest/reader.go.html#4856875">halfReader</a></span><span class="op" id="4856930">)</span>&nbsp;<span class="ident" id="4856932">Read</span><span class="op" id="4856936">(</span><span class="ident" id="4856937">p</span>&nbsp;<span class="op" id="4856939">[</span><span class="op" id="4856940">]</span><span class="builtintype" id="4856941">byte</span><span class="op" id="4856945">)</span>&nbsp;<span class="op" id="4856947">(</span><span class="builtintype" id="4856948">int</span><span class="op" id="4856951">,</span>&nbsp;<span class="builtintype" id="4856953">error</span><span class="op" id="4856958">)</span>&nbsp;<span class="op" id="4856960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856963">return</span>&nbsp;<span class="ident" id="4856970"><a href="/testing/iotest/reader.go.html#4856917">r</a></span><span class="op" id="4856971">.</span><span class="ident" id="4856972">r</span><span class="op" id="4856973">.</span><span class="ident" id="4856974">Read</span><span class="op" id="4856978">(</span><span class="ident" id="4856979"><a href="/testing/iotest/reader.go.html#4856937">p</a></span><span class="op" id="4856980">[</span><span class="num" id="4856981">0</span>&nbsp;<span class="op" id="4856983">:</span>&nbsp;<span class="op" id="4856985">(</span><span class="builtinfunc" id="4856986">len</span><span class="op" id="4856989">(</span><span class="ident" id="4856990"><a href="/testing/iotest/reader.go.html#4856937">p</a></span><span class="op" id="4856991">)</span><span class="op" id="4856992">+</span><span class="num" id="4856993">1</span><span class="op" id="4856994">)</span><span class="op" id="4856995">/</span><span class="num" id="4856996">2</span><span class="op" id="4856997">]</span><span class="op" id="4856998">)</span><br>
<span class="lineno"></span><span class="op" id="4857000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="4857003">//&nbsp;DataErrReader&nbsp;changes&nbsp;the&nbsp;way&nbsp;errors&nbsp;are&nbsp;handled&nbsp;by&nbsp;a&nbsp;Reader.&nbsp;Normally,&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4857080">//&nbsp;Reader&nbsp;returns&nbsp;an&nbsp;error&nbsp;(typically&nbsp;EOF)&nbsp;from&nbsp;the&nbsp;first&nbsp;Read&nbsp;call&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4857158">//&nbsp;last&nbsp;piece&nbsp;of&nbsp;data&nbsp;is&nbsp;read.&nbsp;DataErrReader&nbsp;wraps&nbsp;a&nbsp;Reader&nbsp;and&nbsp;changes&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="4857234">//&nbsp;behavior&nbsp;so&nbsp;the&nbsp;final&nbsp;error&nbsp;is&nbsp;returned&nbsp;along&nbsp;with&nbsp;the&nbsp;final&nbsp;data,&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4857312">//&nbsp;of&nbsp;in&nbsp;the&nbsp;first&nbsp;call&nbsp;after&nbsp;the&nbsp;final&nbsp;data.</span><br>
<span class="lineno">45</span><span class="keyword" id="4857358">func</span>&nbsp;<span class="ident" id="4857363">DataErrReader</span><span class="op" id="4857376">(</span><span class="ident" id="4857377">r</span>&nbsp;<span class="ident" id="4857379"><a href="/testing/iotest/reader.go.html#4856357">io</a></span><span class="op" id="4857381">.</span><span class="ident" id="4857382">Reader</span><span class="op" id="4857388">)</span>&nbsp;<span class="ident" id="4857390"><a href="/testing/iotest/reader.go.html#4856357">io</a></span><span class="op" id="4857392">.</span><span class="ident" id="4857393">Reader</span>&nbsp;<span class="op" id="4857400">{</span>&nbsp;<span class="keyword" id="4857402">return</span>&nbsp;<span class="op" id="4857409">&amp;</span><span class="ident" id="4857410"><a href="/testing/iotest/reader.go.html#4857460">dataErrReader</a></span><span class="op" id="4857423">{</span><span class="ident" id="4857424"><a href="/testing/iotest/reader.go.html#4857377">r</a></span><span class="op" id="4857425">,</span>&nbsp;<span class="ident" id="4857427">nil</span><span class="op" id="4857430">,</span>&nbsp;<span class="builtinfunc" id="4857432">make</span><span class="op" id="4857436">(</span><span class="op" id="4857437">[</span><span class="op" id="4857438">]</span><span class="builtintype" id="4857439">byte</span><span class="op" id="4857443">,</span>&nbsp;<span class="num" id="4857445">1024</span><span class="op" id="4857449">)</span><span class="op" id="4857450">}</span>&nbsp;<span class="op" id="4857452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4857455">type</span>&nbsp;<span class="ident" id="4857460">dataErrReader</span>&nbsp;<span class="keyword" id="4857474">struct</span>&nbsp;<span class="op" id="4857481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857484">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4857491"><a href="/testing/iotest/reader.go.html#4856357">io</a></span><span class="op" id="4857493">.</span><span class="ident" id="4857494">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857502">unread</span>&nbsp;<span class="op" id="4857509">[</span><span class="op" id="4857510">]</span><span class="builtintype" id="4857511">byte</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857517">data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4857524">[</span><span class="op" id="4857525">]</span><span class="builtintype" id="4857526">byte</span><br>
<span class="lineno"></span><span class="op" id="4857531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4857534">func</span>&nbsp;<span class="op" id="4857539">(</span><span class="ident" id="4857540">r</span>&nbsp;<span class="op" id="4857542">*</span><span class="ident" id="4857543"><a href="/testing/iotest/reader.go.html#4857460">dataErrReader</a></span><span class="op" id="4857556">)</span>&nbsp;<span class="ident" id="4857558">Read</span><span class="op" id="4857562">(</span><span class="ident" id="4857563">p</span>&nbsp;<span class="op" id="4857565">[</span><span class="op" id="4857566">]</span><span class="builtintype" id="4857567">byte</span><span class="op" id="4857571">)</span>&nbsp;<span class="op" id="4857573">(</span><span class="ident" id="4857574">n</span>&nbsp;<span class="builtintype" id="4857576">int</span><span class="op" id="4857579">,</span>&nbsp;<span class="ident" id="4857581">err</span>&nbsp;<span class="builtintype" id="4857585">error</span><span class="op" id="4857590">)</span>&nbsp;<span class="op" id="4857592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4857595">//&nbsp;loop&nbsp;because&nbsp;first&nbsp;call&nbsp;needs&nbsp;two&nbsp;reads:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4857640">//&nbsp;one&nbsp;to&nbsp;get&nbsp;data&nbsp;and&nbsp;a&nbsp;second&nbsp;to&nbsp;look&nbsp;for&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857695">for</span>&nbsp;<span class="op" id="4857699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857703">if</span>&nbsp;<span class="builtinfunc" id="4857706">len</span><span class="op" id="4857709">(</span><span class="ident" id="4857710"><a href="/testing/iotest/reader.go.html#4857540">r</a></span><span class="op" id="4857711">.</span><span class="ident" id="4857712">unread</span><span class="op" id="4857718">)</span>&nbsp;<span class="op" id="4857720">==</span>&nbsp;<span class="num" id="4857723">0</span>&nbsp;<span class="op" id="4857725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857730">n1</span><span class="op" id="4857732">,</span>&nbsp;<span class="ident" id="4857734">err1</span>&nbsp;<span class="op" id="4857739">:=</span>&nbsp;<span class="ident" id="4857742"><a href="/testing/iotest/reader.go.html#4857540">r</a></span><span class="op" id="4857743">.</span><span class="ident" id="4857744">r</span><span class="op" id="4857745">.</span><span class="ident" id="4857746">Read</span><span class="op" id="4857750">(</span><span class="ident" id="4857751"><a href="/testing/iotest/reader.go.html#4857540">r</a></span><span class="op" id="4857752">.</span><span class="ident" id="4857753">data</span><span class="op" id="4857757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857762"><a href="/testing/iotest/reader.go.html#4857540">r</a></span><span class="op" id="4857763">.</span><span class="ident" id="4857764">unread</span>&nbsp;<span class="op" id="4857771">=</span>&nbsp;<span class="ident" id="4857773"><a href="/testing/iotest/reader.go.html#4857540">r</a></span><span class="op" id="4857774">.</span><span class="ident" id="4857775">data</span><span class="op" id="4857779">[</span><span class="num" id="4857780">0</span><span class="op" id="4857781">:</span><span class="ident" id="4857782"><a href="/testing/iotest/reader.go.html#4857730">n1</a></span><span class="op" id="4857784">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857789"><a href="/testing/iotest/reader.go.html#4857581">err</a></span>&nbsp;<span class="op" id="4857793">=</span>&nbsp;<span class="ident" id="4857795"><a href="/testing/iotest/reader.go.html#4857734">err1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857806">if</span>&nbsp;<span class="ident" id="4857809"><a href="/testing/iotest/reader.go.html#4857574">n</a></span>&nbsp;<span class="op" id="4857811">&gt;</span>&nbsp;<span class="num" id="4857813">0</span>&nbsp;<span class="op" id="4857815">||</span>&nbsp;<span class="ident" id="4857818"><a href="/testing/iotest/reader.go.html#4857581">err</a></span>&nbsp;<span class="op" id="4857822">!=</span>&nbsp;<span class="ident" id="4857825">nil</span>&nbsp;<span class="op" id="4857829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857834">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857842">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857846"><a href="/testing/iotest/reader.go.html#4857574">n</a></span>&nbsp;<span class="op" id="4857848">=</span>&nbsp;<span class="builtinfunc" id="4857850">copy</span><span class="op" id="4857854">(</span><span class="ident" id="4857855"><a href="/testing/iotest/reader.go.html#4857563">p</a></span><span class="op" id="4857856">,</span>&nbsp;<span class="ident" id="4857858"><a href="/testing/iotest/reader.go.html#4857540">r</a></span><span class="op" id="4857859">.</span><span class="ident" id="4857860">unread</span><span class="op" id="4857866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857870"><a href="/testing/iotest/reader.go.html#4857540">r</a></span><span class="op" id="4857871">.</span><span class="ident" id="4857872">unread</span>&nbsp;<span class="op" id="4857879">=</span>&nbsp;<span class="ident" id="4857881"><a href="/testing/iotest/reader.go.html#4857540">r</a></span><span class="op" id="4857882">.</span><span class="ident" id="4857883">unread</span><span class="op" id="4857889">[</span><span class="ident" id="4857890"><a href="/testing/iotest/reader.go.html#4857574">n</a></span><span class="op" id="4857891">:</span><span class="op" id="4857892">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857898">return</span><br>
<span class="lineno"></span><span class="op" id="4857905">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4857908">var</span>&nbsp;<span class="ident" id="4857912">ErrTimeout</span>&nbsp;<span class="op" id="4857923">=</span>&nbsp;<span class="ident" id="4857925"><a href="/testing/iotest/reader.go.html#4856347">errors</a></span><span class="op" id="4857931">.</span><span class="ident" id="4857932">New</span><span class="op" id="4857935">(</span><span class="string" id="4857936">&#34;timeout&#34;</span><span class="op" id="4857945">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4857948">//&nbsp;TimeoutReader&nbsp;returns&nbsp;ErrTimeout&nbsp;on&nbsp;the&nbsp;second&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="4858003">//&nbsp;with&nbsp;no&nbsp;data.&nbsp;&nbsp;Subsequent&nbsp;calls&nbsp;to&nbsp;read&nbsp;succeed.</span><br>
<span class="lineno">75</span><span class="keyword" id="4858055">func</span>&nbsp;<span class="ident" id="4858060">TimeoutReader</span><span class="op" id="4858073">(</span><span class="ident" id="4858074">r</span>&nbsp;<span class="ident" id="4858076"><a href="/testing/iotest/reader.go.html#4856357">io</a></span><span class="op" id="4858078">.</span><span class="ident" id="4858079">Reader</span><span class="op" id="4858085">)</span>&nbsp;<span class="ident" id="4858087"><a href="/testing/iotest/reader.go.html#4856357">io</a></span><span class="op" id="4858089">.</span><span class="ident" id="4858090">Reader</span>&nbsp;<span class="op" id="4858097">{</span>&nbsp;<span class="keyword" id="4858099">return</span>&nbsp;<span class="op" id="4858106">&amp;</span><span class="ident" id="4858107"><a href="/testing/iotest/reader.go.html#4858135">timeoutReader</a></span><span class="op" id="4858120">{</span><span class="ident" id="4858121"><a href="/testing/iotest/reader.go.html#4858074">r</a></span><span class="op" id="4858122">,</span>&nbsp;<span class="num" id="4858124">0</span><span class="op" id="4858125">}</span>&nbsp;<span class="op" id="4858127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4858130">type</span>&nbsp;<span class="ident" id="4858135">timeoutReader</span>&nbsp;<span class="keyword" id="4858149">struct</span>&nbsp;<span class="op" id="4858156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858159">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4858165"><a href="/testing/iotest/reader.go.html#4856357">io</a></span><span class="op" id="4858167">.</span><span class="ident" id="4858168">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858176">count</span>&nbsp;<span class="builtintype" id="4858182">int</span><br>
<span class="lineno">80</span><span class="op" id="4858186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4858189">func</span>&nbsp;<span class="op" id="4858194">(</span><span class="ident" id="4858195">r</span>&nbsp;<span class="op" id="4858197">*</span><span class="ident" id="4858198"><a href="/testing/iotest/reader.go.html#4858135">timeoutReader</a></span><span class="op" id="4858211">)</span>&nbsp;<span class="ident" id="4858213">Read</span><span class="op" id="4858217">(</span><span class="ident" id="4858218">p</span>&nbsp;<span class="op" id="4858220">[</span><span class="op" id="4858221">]</span><span class="builtintype" id="4858222">byte</span><span class="op" id="4858226">)</span>&nbsp;<span class="op" id="4858228">(</span><span class="builtintype" id="4858229">int</span><span class="op" id="4858232">,</span>&nbsp;<span class="builtintype" id="4858234">error</span><span class="op" id="4858239">)</span>&nbsp;<span class="op" id="4858241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858244"><a href="/testing/iotest/reader.go.html#4858195">r</a></span><span class="op" id="4858245">.</span><span class="ident" id="4858246">count</span><span class="op" id="4858251">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858255">if</span>&nbsp;<span class="ident" id="4858258"><a href="/testing/iotest/reader.go.html#4858195">r</a></span><span class="op" id="4858259">.</span><span class="ident" id="4858260">count</span>&nbsp;<span class="op" id="4858266">==</span>&nbsp;<span class="num" id="4858269">2</span>&nbsp;<span class="op" id="4858271">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858275">return</span>&nbsp;<span class="num" id="4858282">0</span><span class="op" id="4858283">,</span>&nbsp;<span class="ident" id="4858285"><a href="/testing/iotest/reader.go.html#4857912">ErrTimeout</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858300">return</span>&nbsp;<span class="ident" id="4858307"><a href="/testing/iotest/reader.go.html#4858195">r</a></span><span class="op" id="4858308">.</span><span class="ident" id="4858309">r</span><span class="op" id="4858310">.</span><span class="ident" id="4858311">Read</span><span class="op" id="4858315">(</span><span class="ident" id="4858316"><a href="/testing/iotest/reader.go.html#4858218">p</a></span><span class="op" id="4858317">)</span><br>
<span class="lineno"></span><span class="op" id="4858319">}</span>
</div>
</body>
</html>
