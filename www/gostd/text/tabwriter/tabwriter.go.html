<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/tabwriter</h2>
<ul>
<li><a href="/gostd/text/tabwriter/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/tabwriter/tabwriter.go.html">tabwriter.go</a></li>
<li><a href="/gostd/text/tabwriter/tabwriter_test.go.html">tabwriter_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4636177">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4636232">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4636286">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4636337">//&nbsp;Package&nbsp;tabwriter&nbsp;implements&nbsp;a&nbsp;write&nbsp;filter&nbsp;(tabwriter.Writer)&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4636408">//&nbsp;translates&nbsp;tabbed&nbsp;columns&nbsp;in&nbsp;input&nbsp;into&nbsp;properly&nbsp;aligned&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="4636474">//</span><br>
<span class="lineno"></span><span class="comment" id="4636477">//&nbsp;The&nbsp;package&nbsp;is&nbsp;using&nbsp;the&nbsp;Elastic&nbsp;Tabstops&nbsp;algorithm&nbsp;described&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="4636545">//&nbsp;http://nickgravgaard.com/elastictabstops/index.html.</span><br>
<span class="lineno">10</span><span class="comment" id="4636601">//</span><br>
<span class="lineno"></span><span class="keyword" id="4636604">package</span>&nbsp;<span class="ident" id="4636612">tabwriter</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4636623">import</span>&nbsp;<span class="op" id="4636630">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636633">&#34;bytes&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636642">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4636648">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4636663">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4636666">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">20</span><span class="comment" id="4636746">//&nbsp;Filter&nbsp;implementation</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4636772">//&nbsp;A&nbsp;cell&nbsp;represents&nbsp;a&nbsp;segment&nbsp;of&nbsp;text&nbsp;terminated&nbsp;by&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks.</span><br>
<span class="lineno"></span><span class="comment" id="4636846">//&nbsp;The&nbsp;text&nbsp;itself&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;separate&nbsp;buffer;&nbsp;cell&nbsp;only&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4636921">//&nbsp;segment&#39;s&nbsp;size&nbsp;in&nbsp;bytes,&nbsp;its&nbsp;width&nbsp;in&nbsp;runes,&nbsp;and&nbsp;whether&nbsp;it&#39;s&nbsp;an&nbsp;htab</span><br>
<span class="lineno">25</span><span class="comment" id="4636994">//&nbsp;(&#39;\t&#39;)&nbsp;terminated&nbsp;cell.</span><br>
<span class="lineno"></span><span class="comment" id="4637021">//</span><br>
<span class="lineno"></span><span class="keyword" id="4637024">type</span>&nbsp;<span class="ident" id="4637029">cell</span>&nbsp;<span class="keyword" id="4637034">struct</span>&nbsp;<span class="op" id="4637041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637044">size</span>&nbsp;&nbsp;<span class="builtintype" id="4637050">int</span>&nbsp;&nbsp;<span class="comment" id="4637055">//&nbsp;cell&nbsp;size&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637078">width</span>&nbsp;<span class="builtintype" id="4637084">int</span>&nbsp;&nbsp;<span class="comment" id="4637089">//&nbsp;cell&nbsp;width&nbsp;in&nbsp;runes</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637113">htab</span>&nbsp;&nbsp;<span class="builtintype" id="4637119">bool</span>&nbsp;<span class="comment" id="4637124">//&nbsp;true&nbsp;if&nbsp;the&nbsp;cell&nbsp;is&nbsp;terminated&nbsp;by&nbsp;an&nbsp;htab&nbsp;(&#39;\t&#39;)</span><br>
<span class="lineno"></span><span class="op" id="4637176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4637179">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;filter&nbsp;that&nbsp;inserts&nbsp;padding&nbsp;around&nbsp;tab-delimited</span><br>
<span class="lineno"></span><span class="comment" id="4637245">//&nbsp;columns&nbsp;in&nbsp;its&nbsp;input&nbsp;to&nbsp;align&nbsp;them&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno">35</span><span class="comment" id="4637298">//</span><br>
<span class="lineno"></span><span class="comment" id="4637301">//&nbsp;The&nbsp;Writer&nbsp;treats&nbsp;incoming&nbsp;bytes&nbsp;as&nbsp;UTF-8&nbsp;encoded&nbsp;text&nbsp;consisting</span><br>
<span class="lineno"></span><span class="comment" id="4637370">//&nbsp;of&nbsp;cells&nbsp;terminated&nbsp;by&nbsp;(horizontal&nbsp;or&nbsp;vertical)&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4637434">//&nbsp;breaks&nbsp;(newline&nbsp;or&nbsp;formfeed&nbsp;characters).&nbsp;Cells&nbsp;in&nbsp;adjacent&nbsp;lines</span><br>
<span class="lineno"></span><span class="comment" id="4637502">//&nbsp;constitute&nbsp;a&nbsp;column.&nbsp;The&nbsp;Writer&nbsp;inserts&nbsp;padding&nbsp;as&nbsp;needed&nbsp;to</span><br>
<span class="lineno">40</span><span class="comment" id="4637566">//&nbsp;make&nbsp;all&nbsp;cells&nbsp;in&nbsp;a&nbsp;column&nbsp;have&nbsp;the&nbsp;same&nbsp;width,&nbsp;effectively</span><br>
<span class="lineno"></span><span class="comment" id="4637629">//&nbsp;aligning&nbsp;the&nbsp;columns.&nbsp;It&nbsp;assumes&nbsp;that&nbsp;all&nbsp;characters&nbsp;have&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4637694">//&nbsp;same&nbsp;width&nbsp;except&nbsp;for&nbsp;tabs&nbsp;for&nbsp;which&nbsp;a&nbsp;tabwidth&nbsp;must&nbsp;be&nbsp;specified.</span><br>
<span class="lineno"></span><span class="comment" id="4637764">//&nbsp;Note&nbsp;that&nbsp;cells&nbsp;are&nbsp;tab-terminated,&nbsp;not&nbsp;tab-separated:&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="4637831">//&nbsp;non-tab&nbsp;text&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;line&nbsp;does&nbsp;not&nbsp;form&nbsp;a&nbsp;column&nbsp;cell.</span><br>
<span class="lineno">45</span><span class="comment" id="4637897">//</span><br>
<span class="lineno"></span><span class="comment" id="4637900">//&nbsp;The&nbsp;Writer&nbsp;assumes&nbsp;that&nbsp;all&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;have&nbsp;the&nbsp;same&nbsp;width;</span><br>
<span class="lineno"></span><span class="comment" id="4637972">//&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;true&nbsp;in&nbsp;some&nbsp;fonts.</span><br>
<span class="lineno"></span><span class="comment" id="4638011">//</span><br>
<span class="lineno"></span><span class="comment" id="4638014">//&nbsp;If&nbsp;DiscardEmptyColumns&nbsp;is&nbsp;set,&nbsp;empty&nbsp;columns&nbsp;that&nbsp;are&nbsp;terminated</span><br>
<span class="lineno">50</span><span class="comment" id="4638082">//&nbsp;entirely&nbsp;by&nbsp;vertical&nbsp;(or&nbsp;&#34;soft&#34;)&nbsp;tabs&nbsp;are&nbsp;discarded.&nbsp;Columns</span><br>
<span class="lineno"></span><span class="comment" id="4638146">//&nbsp;terminated&nbsp;by&nbsp;horizontal&nbsp;(or&nbsp;&#34;hard&#34;)&nbsp;tabs&nbsp;are&nbsp;not&nbsp;affected&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4638211">//&nbsp;this&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="4638225">//</span><br>
<span class="lineno"></span><span class="comment" id="4638228">//&nbsp;If&nbsp;a&nbsp;Writer&nbsp;is&nbsp;configured&nbsp;to&nbsp;filter&nbsp;HTML,&nbsp;HTML&nbsp;tags&nbsp;and&nbsp;entities</span><br>
<span class="lineno">55</span><span class="comment" id="4638296">//&nbsp;are&nbsp;passed&nbsp;through.&nbsp;The&nbsp;widths&nbsp;of&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4638355">//&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;(tags)&nbsp;and&nbsp;one&nbsp;(entities)&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="4638428">//</span><br>
<span class="lineno"></span><span class="comment" id="4638431">//&nbsp;A&nbsp;segment&nbsp;of&nbsp;text&nbsp;may&nbsp;be&nbsp;escaped&nbsp;by&nbsp;bracketing&nbsp;it&nbsp;with&nbsp;Escape</span><br>
<span class="lineno"></span><span class="comment" id="4638496">//&nbsp;characters.&nbsp;The&nbsp;tabwriter&nbsp;passes&nbsp;escaped&nbsp;text&nbsp;segments&nbsp;through</span><br>
<span class="lineno">60</span><span class="comment" id="4638562">//&nbsp;unchanged.&nbsp;In&nbsp;particular,&nbsp;it&nbsp;does&nbsp;not&nbsp;interpret&nbsp;any&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4638630">//&nbsp;breaks&nbsp;within&nbsp;the&nbsp;segment.&nbsp;If&nbsp;the&nbsp;StripEscape&nbsp;flag&nbsp;is&nbsp;set,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4638696">//&nbsp;Escape&nbsp;characters&nbsp;are&nbsp;stripped&nbsp;from&nbsp;the&nbsp;output;&nbsp;otherwise&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="4638762">//&nbsp;are&nbsp;passed&nbsp;through&nbsp;as&nbsp;well.&nbsp;For&nbsp;the&nbsp;purpose&nbsp;of&nbsp;formatting,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4638828">//&nbsp;width&nbsp;of&nbsp;the&nbsp;escaped&nbsp;text&nbsp;is&nbsp;always&nbsp;computed&nbsp;excluding&nbsp;the&nbsp;Escape</span><br>
<span class="lineno">65</span><span class="comment" id="4638897">//&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="4638912">//</span><br>
<span class="lineno"></span><span class="comment" id="4638915">//&nbsp;The&nbsp;formfeed&nbsp;character&nbsp;(&#39;\f&#39;)&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline&nbsp;but&nbsp;it&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="4638980">//&nbsp;terminates&nbsp;all&nbsp;columns&nbsp;in&nbsp;the&nbsp;current&nbsp;line&nbsp;(effectively&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="4639047">//&nbsp;Flush).&nbsp;Cells&nbsp;in&nbsp;the&nbsp;next&nbsp;line&nbsp;start&nbsp;new&nbsp;columns.&nbsp;Unless&nbsp;found</span><br>
<span class="lineno">70</span><span class="comment" id="4639113">//&nbsp;inside&nbsp;an&nbsp;HTML&nbsp;tag&nbsp;or&nbsp;inside&nbsp;an&nbsp;escaped&nbsp;text&nbsp;segment,&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="4639179">//&nbsp;characters&nbsp;appear&nbsp;as&nbsp;newlines&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="4639227">//</span><br>
<span class="lineno"></span><span class="comment" id="4639230">//&nbsp;The&nbsp;Writer&nbsp;must&nbsp;buffer&nbsp;input&nbsp;internally,&nbsp;because&nbsp;proper&nbsp;spacing</span><br>
<span class="lineno"></span><span class="comment" id="4639297">//&nbsp;of&nbsp;one&nbsp;line&nbsp;may&nbsp;depend&nbsp;on&nbsp;the&nbsp;cells&nbsp;in&nbsp;future&nbsp;lines.&nbsp;Clients&nbsp;must</span><br>
<span class="lineno">75</span><span class="comment" id="4639366">//&nbsp;call&nbsp;Flush&nbsp;when&nbsp;done&nbsp;calling&nbsp;Write.</span><br>
<span class="lineno"></span><span class="comment" id="4639405">//</span><br>
<span class="lineno"></span><span class="keyword" id="4639408">type</span>&nbsp;<span class="ident" id="4639413">Writer</span>&nbsp;<span class="keyword" id="4639420">struct</span>&nbsp;<span class="op" id="4639427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639430">//&nbsp;configuration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639448">output</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4639457">io</span><span class="op" id="4639459">.</span><span class="ident" id="4639460">Writer</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639468">minwidth</span>&nbsp;<span class="builtintype" id="4639477">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639482">tabwidth</span>&nbsp;<span class="builtintype" id="4639491">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639496">padding</span>&nbsp;&nbsp;<span class="builtintype" id="4639505">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639510">padbytes</span>&nbsp;<span class="op" id="4639519">[</span><span class="num" id="4639520">8</span><span class="op" id="4639521">]</span><span class="builtintype" id="4639522">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639528">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4639537">uint</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639544">//&nbsp;current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639562">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4639570">bytes</span><span class="op" id="4639575">.</span><span class="ident" id="4639576">Buffer</span>&nbsp;<span class="comment" id="4639583">//&nbsp;collected&nbsp;text&nbsp;excluding&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639632">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4639640">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4639653">//&nbsp;buffer&nbsp;position&nbsp;up&nbsp;to&nbsp;which&nbsp;cell.width&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;has&nbsp;been&nbsp;computed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639733">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4639741">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4639754">//&nbsp;current&nbsp;incomplete&nbsp;cell;&nbsp;cell.width&nbsp;is&nbsp;up&nbsp;to&nbsp;buf[pos]&nbsp;excluding&nbsp;ignored&nbsp;sections</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639839">endChar</span>&nbsp;<span class="builtintype" id="4639847">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4639860">//&nbsp;terminating&nbsp;char&nbsp;of&nbsp;escaped&nbsp;sequence&nbsp;(Escape&nbsp;for&nbsp;escapes,&nbsp;&#39;&gt;&#39;,&nbsp;&#39;;&#39;&nbsp;for&nbsp;HTML&nbsp;tags/entities,&nbsp;or&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639961">lines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4639969">[</span><span class="op" id="4639970">]</span><span class="op" id="4639971">[</span><span class="op" id="4639972">]</span><span class="ident" id="4639973">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4639982">//&nbsp;list&nbsp;of&nbsp;lines;&nbsp;each&nbsp;line&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640030">widths</span>&nbsp;&nbsp;<span class="op" id="4640038">[</span><span class="op" id="4640039">]</span><span class="builtintype" id="4640040">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4640051">//&nbsp;list&nbsp;of&nbsp;column&nbsp;widths&nbsp;in&nbsp;runes&nbsp;-&nbsp;re-used&nbsp;during&nbsp;formatting</span><br>
<span class="lineno"></span><span class="op" id="4640113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4640116">func</span>&nbsp;<span class="op" id="4640121">(</span><span class="ident" id="4640122">b</span>&nbsp;<span class="op" id="4640124">*</span><span class="ident" id="4640125">Writer</span><span class="op" id="4640131">)</span>&nbsp;<span class="ident" id="4640133">addLine</span><span class="op" id="4640140">(</span><span class="op" id="4640141">)</span>&nbsp;<span class="op" id="4640143">{</span>&nbsp;<span class="ident" id="4640145">b</span><span class="op" id="4640146">.</span><span class="ident" id="4640147">lines</span>&nbsp;<span class="op" id="4640153">=</span>&nbsp;<span class="builtinfunc" id="4640155">append</span><span class="op" id="4640161">(</span><span class="ident" id="4640162">b</span><span class="op" id="4640163">.</span><span class="ident" id="4640164">lines</span><span class="op" id="4640169">,</span>&nbsp;<span class="op" id="4640171">[</span><span class="op" id="4640172">]</span><span class="ident" id="4640173">cell</span><span class="op" id="4640177">{</span><span class="op" id="4640178">}</span><span class="op" id="4640179">)</span>&nbsp;<span class="op" id="4640181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4640184">//&nbsp;Reset&nbsp;the&nbsp;current&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4640212">func</span>&nbsp;<span class="op" id="4640217">(</span><span class="ident" id="4640218">b</span>&nbsp;<span class="op" id="4640220">*</span><span class="ident" id="4640221">Writer</span><span class="op" id="4640227">)</span>&nbsp;<span class="ident" id="4640229">reset</span><span class="op" id="4640234">(</span><span class="op" id="4640235">)</span>&nbsp;<span class="op" id="4640237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640240">b</span><span class="op" id="4640241">.</span><span class="ident" id="4640242">buf</span><span class="op" id="4640245">.</span><span class="ident" id="4640246">Reset</span><span class="op" id="4640251">(</span><span class="op" id="4640252">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640255">b</span><span class="op" id="4640256">.</span><span class="ident" id="4640257">pos</span>&nbsp;<span class="op" id="4640261">=</span>&nbsp;<span class="num" id="4640263">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640266">b</span><span class="op" id="4640267">.</span><span class="ident" id="4640268">cell</span>&nbsp;<span class="op" id="4640273">=</span>&nbsp;<span class="ident" id="4640275">cell</span><span class="op" id="4640279">{</span><span class="op" id="4640280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640283">b</span><span class="op" id="4640284">.</span><span class="ident" id="4640285">endChar</span>&nbsp;<span class="op" id="4640293">=</span>&nbsp;<span class="num" id="4640295">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640298">b</span><span class="op" id="4640299">.</span><span class="ident" id="4640300">lines</span>&nbsp;<span class="op" id="4640306">=</span>&nbsp;<span class="ident" id="4640308">b</span><span class="op" id="4640309">.</span><span class="ident" id="4640310">lines</span><span class="op" id="4640315">[</span><span class="num" id="4640316">0</span><span class="op" id="4640317">:</span><span class="num" id="4640318">0</span><span class="op" id="4640319">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640322">b</span><span class="op" id="4640323">.</span><span class="ident" id="4640324">widths</span>&nbsp;<span class="op" id="4640331">=</span>&nbsp;<span class="ident" id="4640333">b</span><span class="op" id="4640334">.</span><span class="ident" id="4640335">widths</span><span class="op" id="4640341">[</span><span class="num" id="4640342">0</span><span class="op" id="4640343">:</span><span class="num" id="4640344">0</span><span class="op" id="4640345">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640348">b</span><span class="op" id="4640349">.</span><span class="ident" id="4640350">addLine</span><span class="op" id="4640357">(</span><span class="op" id="4640358">)</span><br>
<span class="lineno"></span><span class="op" id="4640360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4640363">//&nbsp;Internal&nbsp;representation&nbsp;(current&nbsp;state):</span><br>
<span class="lineno"></span><span class="comment" id="4640407">//</span><br>
<span class="lineno">110</span><span class="comment" id="4640410">//&nbsp;-&nbsp;all&nbsp;text&nbsp;written&nbsp;is&nbsp;appended&nbsp;to&nbsp;buf;&nbsp;tabs&nbsp;and&nbsp;line&nbsp;breaks&nbsp;are&nbsp;stripped&nbsp;away</span><br>
<span class="lineno"></span><span class="comment" id="4640491">//&nbsp;-&nbsp;at&nbsp;any&nbsp;given&nbsp;time&nbsp;there&nbsp;is&nbsp;a&nbsp;(possibly&nbsp;empty)&nbsp;incomplete&nbsp;cell&nbsp;at&nbsp;the&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="4640569">//&nbsp;&nbsp;&nbsp;(the&nbsp;cell&nbsp;starts&nbsp;after&nbsp;a&nbsp;tab&nbsp;or&nbsp;line&nbsp;break)</span><br>
<span class="lineno"></span><span class="comment" id="4640618">//&nbsp;-&nbsp;cell.size&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;belonging&nbsp;to&nbsp;the&nbsp;cell&nbsp;so&nbsp;far</span><br>
<span class="lineno"></span><span class="comment" id="4640685">//&nbsp;-&nbsp;cell.width&nbsp;is&nbsp;text&nbsp;width&nbsp;in&nbsp;runes&nbsp;of&nbsp;that&nbsp;cell&nbsp;from&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;cell&nbsp;to</span><br>
<span class="lineno">115</span><span class="comment" id="4640767">//&nbsp;&nbsp;&nbsp;position&nbsp;pos;&nbsp;html&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are&nbsp;excluded&nbsp;from&nbsp;this&nbsp;width&nbsp;if&nbsp;html</span><br>
<span class="lineno"></span><span class="comment" id="4640846">//&nbsp;&nbsp;&nbsp;filtering&nbsp;is&nbsp;enabled</span><br>
<span class="lineno"></span><span class="comment" id="4640872">//&nbsp;-&nbsp;the&nbsp;sizes&nbsp;and&nbsp;widths&nbsp;of&nbsp;processed&nbsp;text&nbsp;are&nbsp;kept&nbsp;in&nbsp;the&nbsp;lines&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="4640943">//&nbsp;&nbsp;&nbsp;which&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;cells&nbsp;for&nbsp;each&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4640993">//&nbsp;-&nbsp;the&nbsp;widths&nbsp;list&nbsp;is&nbsp;a&nbsp;temporary&nbsp;list&nbsp;with&nbsp;current&nbsp;widths&nbsp;used&nbsp;during</span><br>
<span class="lineno">120</span><span class="comment" id="4641066">//&nbsp;&nbsp;&nbsp;formatting;&nbsp;it&nbsp;is&nbsp;kept&nbsp;in&nbsp;Writer&nbsp;because&nbsp;it&#39;s&nbsp;re-used</span><br>
<span class="lineno"></span><span class="comment" id="4641125">//</span><br>
<span class="lineno"></span><span class="comment" id="4641128">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;----------&nbsp;size&nbsp;----------&gt;|</span><br>
<span class="lineno"></span><span class="comment" id="4641181">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="4641234">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;-&nbsp;width&nbsp;-&gt;|&lt;-&nbsp;ignored&nbsp;-&gt;|&nbsp;&nbsp;|</span><br>
<span class="lineno">125</span><span class="comment" id="4641287">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="4641340">//&nbsp;[---processed---tab------------&lt;tag&gt;...&lt;/tag&gt;...]</span><br>
<span class="lineno"></span><span class="comment" id="4641393">//&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</span><br>
<span class="lineno"></span><span class="comment" id="4641443">//&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="4641493">//&nbsp;buf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;&nbsp;pos</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4641546">//&nbsp;Formatting&nbsp;can&nbsp;be&nbsp;controlled&nbsp;with&nbsp;these&nbsp;flags.</span><br>
<span class="lineno"></span><span class="keyword" id="4641596">const</span>&nbsp;<span class="op" id="4641602">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4641605">//&nbsp;Ignore&nbsp;html&nbsp;tags&nbsp;and&nbsp;treat&nbsp;entities&nbsp;(starting&nbsp;with&nbsp;&#39;&amp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4641664">//&nbsp;and&nbsp;ending&nbsp;in&nbsp;&#39;;&#39;)&nbsp;as&nbsp;single&nbsp;characters&nbsp;(width&nbsp;=&nbsp;1).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641721">FilterHTML</span>&nbsp;<span class="builtintype" id="4641732">uint</span>&nbsp;<span class="op" id="4641737">=</span>&nbsp;<span class="num" id="4641739">1</span>&nbsp;<span class="op" id="4641741">&lt;&lt;</span>&nbsp;<span class="ident" id="4641744">iota</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4641751">//&nbsp;Strip&nbsp;Escape&nbsp;characters&nbsp;bracketing&nbsp;escaped&nbsp;text&nbsp;segments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4641812">//&nbsp;instead&nbsp;of&nbsp;passing&nbsp;them&nbsp;through&nbsp;unchanged&nbsp;with&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641873">StripEscape</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4641887">//&nbsp;Force&nbsp;right-alignment&nbsp;of&nbsp;cell&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4641930">//&nbsp;Default&nbsp;is&nbsp;left-alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641961">AlignRight</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4641974">//&nbsp;Handle&nbsp;empty&nbsp;columns&nbsp;as&nbsp;if&nbsp;they&nbsp;were&nbsp;not&nbsp;present&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4642030">//&nbsp;the&nbsp;input&nbsp;in&nbsp;the&nbsp;first&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642064">DiscardEmptyColumns</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4642086">//&nbsp;Always&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;columns&nbsp;(i.e.,&nbsp;padding&nbsp;of</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4642148">//&nbsp;leading&nbsp;empty&nbsp;cells&nbsp;on&nbsp;the&nbsp;left)&nbsp;independent&nbsp;of&nbsp;padchar.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642209">TabIndent</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4642221">//&nbsp;Print&nbsp;a&nbsp;vertical&nbsp;bar&nbsp;(&#39;|&#39;)&nbsp;between&nbsp;columns&nbsp;(after&nbsp;formatting).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4642288">//&nbsp;Discarded&nbsp;columns&nbsp;appear&nbsp;as&nbsp;zero-width&nbsp;columns&nbsp;(&#34;||&#34;).</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642347">Debug</span><br>
<span class="lineno"></span><span class="op" id="4642353">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4642356">//&nbsp;A&nbsp;Writer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;with&nbsp;a&nbsp;call&nbsp;to&nbsp;Init.&nbsp;The&nbsp;first&nbsp;parameter&nbsp;(output)</span><br>
<span class="lineno"></span><span class="comment" id="4642438">//&nbsp;specifies&nbsp;the&nbsp;filter&nbsp;output.&nbsp;The&nbsp;remaining&nbsp;parameters&nbsp;control&nbsp;the&nbsp;formatting:</span><br>
<span class="lineno">160</span><span class="comment" id="4642519">//</span><br>
<span class="lineno"></span><span class="comment" id="4642522">//&nbsp;&nbsp;&nbsp;&nbspminwidth&nbsp;&nbsp;&nbsp;&nbspminimal&nbsp;cell&nbsp;width&nbsp;including&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span><span class="comment" id="4642575">//&nbsp;&nbsp;&nbsp;&nbsptabwidth&nbsp;&nbsp;&nbsp;&nbspwidth&nbsp;of&nbsp;tab&nbsp;characters&nbsp;(equivalent&nbsp;number&nbsp;of&nbsp;spaces)</span><br>
<span class="lineno"></span><span class="comment" id="4642641">//&nbsp;&nbsp;&nbsp;&nbsppadding&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsppadding&nbsp;added&nbsp;to&nbsp;a&nbsp;cell&nbsp;before&nbsp;computing&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="4642704">//&nbsp;&nbsp;&nbsp;&nbsppadchar&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspASCII&nbsp;char&nbsp;used&nbsp;for&nbsp;padding</span><br>
<span class="lineno">165</span><span class="comment" id="4642744">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;padchar&nbsp;==&nbsp;&#39;\t&#39;,&nbsp;the&nbsp;Writer&nbsp;will&nbsp;assume&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4642801">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspwidth&nbsp;of&nbsp;a&nbsp;&#39;\t&#39;&nbsp;in&nbsp;the&nbsp;formatted&nbsp;output&nbsp;is&nbsp;tabwidth,</span><br>
<span class="lineno"></span><span class="comment" id="4642859">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspand&nbsp;cells&nbsp;are&nbsp;left-aligned&nbsp;independent&nbsp;of&nbsp;align_left</span><br>
<span class="lineno"></span><span class="comment" id="4642917">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp(for&nbsp;correct-looking&nbsp;results,&nbsp;tabwidth&nbsp;must&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="4642977">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspto&nbsp;the&nbsp;tab&nbsp;width&nbsp;in&nbsp;the&nbsp;viewer&nbsp;displaying&nbsp;the&nbsp;result)</span><br>
<span class="lineno">170</span><span class="comment" id="4643036">//&nbsp;&nbsp;&nbsp;&nbspflags&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspformatting&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="4643065">//</span><br>
<span class="lineno"></span><span class="keyword" id="4643068">func</span>&nbsp;<span class="op" id="4643073">(</span><span class="ident" id="4643074">b</span>&nbsp;<span class="op" id="4643076">*</span><span class="ident" id="4643077">Writer</span><span class="op" id="4643083">)</span>&nbsp;<span class="ident" id="4643085">Init</span><span class="op" id="4643089">(</span><span class="ident" id="4643090">output</span>&nbsp;<span class="ident" id="4643097">io</span><span class="op" id="4643099">.</span><span class="ident" id="4643100">Writer</span><span class="op" id="4643106">,</span>&nbsp;<span class="ident" id="4643108">minwidth</span><span class="op" id="4643116">,</span>&nbsp;<span class="ident" id="4643118">tabwidth</span><span class="op" id="4643126">,</span>&nbsp;<span class="ident" id="4643128">padding</span>&nbsp;<span class="builtintype" id="4643136">int</span><span class="op" id="4643139">,</span>&nbsp;<span class="ident" id="4643141">padchar</span>&nbsp;<span class="builtintype" id="4643149">byte</span><span class="op" id="4643153">,</span>&nbsp;<span class="ident" id="4643155">flags</span>&nbsp;<span class="builtintype" id="4643161">uint</span><span class="op" id="4643165">)</span>&nbsp;<span class="op" id="4643167">*</span><span class="ident" id="4643168">Writer</span>&nbsp;<span class="op" id="4643175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643178">if</span>&nbsp;<span class="ident" id="4643181">minwidth</span>&nbsp;<span class="op" id="4643190">&lt;</span>&nbsp;<span class="num" id="4643192">0</span>&nbsp;<span class="op" id="4643194">||</span>&nbsp;<span class="ident" id="4643197">tabwidth</span>&nbsp;<span class="op" id="4643206">&lt;</span>&nbsp;<span class="num" id="4643208">0</span>&nbsp;<span class="op" id="4643210">||</span>&nbsp;<span class="ident" id="4643213">padding</span>&nbsp;<span class="op" id="4643221">&lt;</span>&nbsp;<span class="num" id="4643223">0</span>&nbsp;<span class="op" id="4643225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4643229">panic</span><span class="op" id="4643234">(</span><span class="string" id="4643235">&#34;negative&nbsp;minwidth,&nbsp;tabwidth,&nbsp;or&nbsp;padding&#34;</span><span class="op" id="4643276">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4643279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643282">b</span><span class="op" id="4643283">.</span><span class="ident" id="4643284">output</span>&nbsp;<span class="op" id="4643291">=</span>&nbsp;<span class="ident" id="4643293">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643301">b</span><span class="op" id="4643302">.</span><span class="ident" id="4643303">minwidth</span>&nbsp;<span class="op" id="4643312">=</span>&nbsp;<span class="ident" id="4643314">minwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643324">b</span><span class="op" id="4643325">.</span><span class="ident" id="4643326">tabwidth</span>&nbsp;<span class="op" id="4643335">=</span>&nbsp;<span class="ident" id="4643337">tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643347">b</span><span class="op" id="4643348">.</span><span class="ident" id="4643349">padding</span>&nbsp;<span class="op" id="4643357">=</span>&nbsp;<span class="ident" id="4643359">padding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643368">for</span>&nbsp;<span class="ident" id="4643372">i</span>&nbsp;<span class="op" id="4643374">:=</span>&nbsp;<span class="keyword" id="4643377">range</span>&nbsp;<span class="ident" id="4643383">b</span><span class="op" id="4643384">.</span><span class="ident" id="4643385">padbytes</span>&nbsp;<span class="op" id="4643394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643398">b</span><span class="op" id="4643399">.</span><span class="ident" id="4643400">padbytes</span><span class="op" id="4643408">[</span><span class="ident" id="4643409">i</span><span class="op" id="4643410">]</span>&nbsp;<span class="op" id="4643412">=</span>&nbsp;<span class="ident" id="4643414">padchar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4643423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643426">if</span>&nbsp;<span class="ident" id="4643429">padchar</span>&nbsp;<span class="op" id="4643437">==</span>&nbsp;<span class="string" id="4643440">&#39;\t&#39;</span>&nbsp;<span class="op" id="4643445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4643449">//&nbsp;tab&nbsp;padding&nbsp;enforces&nbsp;left-alignment</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643490">flags</span>&nbsp;<span class="op" id="4643496">&amp;^=</span>&nbsp;<span class="ident" id="4643500">AlignRight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4643512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643515">b</span><span class="op" id="4643516">.</span><span class="ident" id="4643517">flags</span>&nbsp;<span class="op" id="4643523">=</span>&nbsp;<span class="ident" id="4643525">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643533">b</span><span class="op" id="4643534">.</span><span class="ident" id="4643535">reset</span><span class="op" id="4643540">(</span><span class="op" id="4643541">)</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643545">return</span>&nbsp;<span class="ident" id="4643552">b</span><br>
<span class="lineno"></span><span class="op" id="4643554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4643557">//&nbsp;debugging&nbsp;support&nbsp;(keep&nbsp;code&nbsp;around)</span><br>
<span class="lineno">195</span><span class="keyword" id="4643597">func</span>&nbsp;<span class="op" id="4643602">(</span><span class="ident" id="4643603">b</span>&nbsp;<span class="op" id="4643605">*</span><span class="ident" id="4643606">Writer</span><span class="op" id="4643612">)</span>&nbsp;<span class="ident" id="4643614">dump</span><span class="op" id="4643618">(</span><span class="op" id="4643619">)</span>&nbsp;<span class="op" id="4643621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643624">pos</span>&nbsp;<span class="op" id="4643628">:=</span>&nbsp;<span class="num" id="4643631">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643634">for</span>&nbsp;<span class="ident" id="4643638">i</span><span class="op" id="4643639">,</span>&nbsp;<span class="ident" id="4643641">line</span>&nbsp;<span class="op" id="4643646">:=</span>&nbsp;<span class="keyword" id="4643649">range</span>&nbsp;<span class="ident" id="4643655">b</span><span class="op" id="4643656">.</span><span class="ident" id="4643657">lines</span>&nbsp;<span class="op" id="4643663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4643667">print</span><span class="op" id="4643672">(</span><span class="string" id="4643673">&#34;(&#34;</span><span class="op" id="4643676">,</span>&nbsp;<span class="ident" id="4643678">i</span><span class="op" id="4643679">,</span>&nbsp;<span class="string" id="4643681">&#34;)&nbsp;&#34;</span><span class="op" id="4643685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643689">for</span>&nbsp;<span class="ident" id="4643693">_</span><span class="op" id="4643694">,</span>&nbsp;<span class="ident" id="4643696">c</span>&nbsp;<span class="op" id="4643698">:=</span>&nbsp;<span class="keyword" id="4643701">range</span>&nbsp;<span class="ident" id="4643707">line</span>&nbsp;<span class="op" id="4643712">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4643717">print</span><span class="op" id="4643722">(</span><span class="string" id="4643723">&#34;[&#34;</span><span class="op" id="4643726">,</span>&nbsp;<span class="builtintype" id="4643728">string</span><span class="op" id="4643734">(</span><span class="ident" id="4643735">b</span><span class="op" id="4643736">.</span><span class="ident" id="4643737">buf</span><span class="op" id="4643740">.</span><span class="ident" id="4643741">Bytes</span><span class="op" id="4643746">(</span><span class="op" id="4643747">)</span><span class="op" id="4643748">[</span><span class="ident" id="4643749">pos</span><span class="op" id="4643752">:</span><span class="ident" id="4643753">pos</span><span class="op" id="4643756">+</span><span class="ident" id="4643757">c</span><span class="op" id="4643758">.</span><span class="ident" id="4643759">size</span><span class="op" id="4643763">]</span><span class="op" id="4643764">)</span><span class="op" id="4643765">,</span>&nbsp;<span class="string" id="4643767">&#34;]&#34;</span><span class="op" id="4643770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643775">pos</span>&nbsp;<span class="op" id="4643779">+=</span>&nbsp;<span class="ident" id="4643782">c</span><span class="op" id="4643783">.</span><span class="ident" id="4643784">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4643791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4643795">print</span><span class="op" id="4643800">(</span><span class="string" id="4643801">&#34;\n&#34;</span><span class="op" id="4643805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4643808">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4643811">print</span><span class="op" id="4643816">(</span><span class="string" id="4643817">&#34;\n&#34;</span><span class="op" id="4643821">)</span><br>
<span class="lineno"></span><span class="op" id="4643823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4643826">//&nbsp;local&nbsp;error&nbsp;wrapper&nbsp;so&nbsp;we&nbsp;can&nbsp;distinguish&nbsp;errors&nbsp;we&nbsp;want&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4643896">//&nbsp;as&nbsp;errors&nbsp;from&nbsp;genuine&nbsp;panics&nbsp;(which&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;return&nbsp;as&nbsp;errors)</span><br>
<span class="lineno">210</span><span class="keyword" id="4643971">type</span>&nbsp;<span class="ident" id="4643976">osError</span>&nbsp;<span class="keyword" id="4643984">struct</span>&nbsp;<span class="op" id="4643991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643994">err</span>&nbsp;<span class="builtintype" id="4643998">error</span><br>
<span class="lineno"></span><span class="op" id="4644004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4644007">func</span>&nbsp;<span class="op" id="4644012">(</span><span class="ident" id="4644013">b</span>&nbsp;<span class="op" id="4644015">*</span><span class="ident" id="4644016">Writer</span><span class="op" id="4644022">)</span>&nbsp;<span class="ident" id="4644024">write0</span><span class="op" id="4644030">(</span><span class="ident" id="4644031">buf</span>&nbsp;<span class="op" id="4644035">[</span><span class="op" id="4644036">]</span><span class="builtintype" id="4644037">byte</span><span class="op" id="4644041">)</span>&nbsp;<span class="op" id="4644043">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644046">n</span><span class="op" id="4644047">,</span>&nbsp;<span class="ident" id="4644049">err</span>&nbsp;<span class="op" id="4644053">:=</span>&nbsp;<span class="ident" id="4644056">b</span><span class="op" id="4644057">.</span><span class="ident" id="4644058">output</span><span class="op" id="4644064">.</span><span class="ident" id="4644065">Write</span><span class="op" id="4644070">(</span><span class="ident" id="4644071">buf</span><span class="op" id="4644074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644077">if</span>&nbsp;<span class="ident" id="4644080">n</span>&nbsp;<span class="op" id="4644082">!=</span>&nbsp;<span class="builtinfunc" id="4644085">len</span><span class="op" id="4644088">(</span><span class="ident" id="4644089">buf</span><span class="op" id="4644092">)</span>&nbsp;<span class="op" id="4644094">&amp;&amp;</span>&nbsp;<span class="ident" id="4644097">err</span>&nbsp;<span class="op" id="4644101">==</span>&nbsp;<span class="ident" id="4644104">nil</span>&nbsp;<span class="op" id="4644108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644112">err</span>&nbsp;<span class="op" id="4644116">=</span>&nbsp;<span class="ident" id="4644118">io</span><span class="op" id="4644120">.</span><span class="ident" id="4644121">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644139">if</span>&nbsp;<span class="ident" id="4644142">err</span>&nbsp;<span class="op" id="4644146">!=</span>&nbsp;<span class="ident" id="4644149">nil</span>&nbsp;<span class="op" id="4644153">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4644157">panic</span><span class="op" id="4644162">(</span><span class="ident" id="4644163">osError</span><span class="op" id="4644170">{</span><span class="ident" id="4644171">err</span><span class="op" id="4644174">}</span><span class="op" id="4644175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644178">}</span><br>
<span class="lineno"></span><span class="op" id="4644180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4644183">func</span>&nbsp;<span class="op" id="4644188">(</span><span class="ident" id="4644189">b</span>&nbsp;<span class="op" id="4644191">*</span><span class="ident" id="4644192">Writer</span><span class="op" id="4644198">)</span>&nbsp;<span class="ident" id="4644200">writeN</span><span class="op" id="4644206">(</span><span class="ident" id="4644207">src</span>&nbsp;<span class="op" id="4644211">[</span><span class="op" id="4644212">]</span><span class="builtintype" id="4644213">byte</span><span class="op" id="4644217">,</span>&nbsp;<span class="ident" id="4644219">n</span>&nbsp;<span class="builtintype" id="4644221">int</span><span class="op" id="4644224">)</span>&nbsp;<span class="op" id="4644226">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644229">for</span>&nbsp;<span class="ident" id="4644233">n</span>&nbsp;<span class="op" id="4644235">&gt;</span>&nbsp;<span class="builtinfunc" id="4644237">len</span><span class="op" id="4644240">(</span><span class="ident" id="4644241">src</span><span class="op" id="4644244">)</span>&nbsp;<span class="op" id="4644246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644250">b</span><span class="op" id="4644251">.</span><span class="ident" id="4644252">write0</span><span class="op" id="4644258">(</span><span class="ident" id="4644259">src</span><span class="op" id="4644262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644266">n</span>&nbsp;<span class="op" id="4644268">-=</span>&nbsp;<span class="builtinfunc" id="4644271">len</span><span class="op" id="4644274">(</span><span class="ident" id="4644275">src</span><span class="op" id="4644278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644284">b</span><span class="op" id="4644285">.</span><span class="ident" id="4644286">write0</span><span class="op" id="4644292">(</span><span class="ident" id="4644293">src</span><span class="op" id="4644296">[</span><span class="num" id="4644297">0</span><span class="op" id="4644298">:</span><span class="ident" id="4644299">n</span><span class="op" id="4644300">]</span><span class="op" id="4644301">)</span><br>
<span class="lineno">230</span><span class="op" id="4644303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4644306">var</span>&nbsp;<span class="op" id="4644310">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644313">newline</span>&nbsp;<span class="op" id="4644321">=</span>&nbsp;<span class="op" id="4644323">[</span><span class="op" id="4644324">]</span><span class="builtintype" id="4644325">byte</span><span class="op" id="4644329">{</span><span class="string" id="4644330">&#39;\n&#39;</span><span class="op" id="4644334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644337">tabs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4644345">=</span>&nbsp;<span class="op" id="4644347">[</span><span class="op" id="4644348">]</span><span class="builtintype" id="4644349">byte</span><span class="op" id="4644353">(</span><span class="string" id="4644354">&#34;\t\t\t\t\t\t\t\t&#34;</span><span class="op" id="4644372">)</span><br>
<span class="lineno">235</span><span class="op" id="4644374">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4644377">func</span>&nbsp;<span class="op" id="4644382">(</span><span class="ident" id="4644383">b</span>&nbsp;<span class="op" id="4644385">*</span><span class="ident" id="4644386">Writer</span><span class="op" id="4644392">)</span>&nbsp;<span class="ident" id="4644394">writePadding</span><span class="op" id="4644406">(</span><span class="ident" id="4644407">textw</span><span class="op" id="4644412">,</span>&nbsp;<span class="ident" id="4644414">cellw</span>&nbsp;<span class="builtintype" id="4644420">int</span><span class="op" id="4644423">,</span>&nbsp;<span class="ident" id="4644425">useTabs</span>&nbsp;<span class="builtintype" id="4644433">bool</span><span class="op" id="4644437">)</span>&nbsp;<span class="op" id="4644439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644442">if</span>&nbsp;<span class="ident" id="4644445">b</span><span class="op" id="4644446">.</span><span class="ident" id="4644447">padbytes</span><span class="op" id="4644455">[</span><span class="num" id="4644456">0</span><span class="op" id="4644457">]</span>&nbsp;<span class="op" id="4644459">==</span>&nbsp;<span class="string" id="4644462">&#39;\t&#39;</span>&nbsp;<span class="op" id="4644467">||</span>&nbsp;<span class="ident" id="4644470">useTabs</span>&nbsp;<span class="op" id="4644478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4644482">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;tabs</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644513">if</span>&nbsp;<span class="ident" id="4644516">b</span><span class="op" id="4644517">.</span><span class="ident" id="4644518">tabwidth</span>&nbsp;<span class="op" id="4644527">==</span>&nbsp;<span class="num" id="4644530">0</span>&nbsp;<span class="op" id="4644532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644537">return</span>&nbsp;<span class="comment" id="4644544">//&nbsp;tabs&nbsp;have&nbsp;no&nbsp;width&nbsp;-&nbsp;can&#39;t&nbsp;do&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4644595">//&nbsp;make&nbsp;cellw&nbsp;the&nbsp;smallest&nbsp;multiple&nbsp;of&nbsp;b.tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644647">cellw</span>&nbsp;<span class="op" id="4644653">=</span>&nbsp;<span class="op" id="4644655">(</span><span class="ident" id="4644656">cellw</span>&nbsp;<span class="op" id="4644662">+</span>&nbsp;<span class="ident" id="4644664">b</span><span class="op" id="4644665">.</span><span class="ident" id="4644666">tabwidth</span>&nbsp;<span class="op" id="4644675">-</span>&nbsp;<span class="num" id="4644677">1</span><span class="op" id="4644678">)</span>&nbsp;<span class="op" id="4644680">/</span>&nbsp;<span class="ident" id="4644682">b</span><span class="op" id="4644683">.</span><span class="ident" id="4644684">tabwidth</span>&nbsp;<span class="op" id="4644693">*</span>&nbsp;<span class="ident" id="4644695">b</span><span class="op" id="4644696">.</span><span class="ident" id="4644697">tabwidth</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644708">n</span>&nbsp;<span class="op" id="4644710">:=</span>&nbsp;<span class="ident" id="4644713">cellw</span>&nbsp;<span class="op" id="4644719">-</span>&nbsp;<span class="ident" id="4644721">textw</span>&nbsp;<span class="comment" id="4644727">//&nbsp;amount&nbsp;of&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644750">if</span>&nbsp;<span class="ident" id="4644753">n</span>&nbsp;<span class="op" id="4644755">&lt;</span>&nbsp;<span class="num" id="4644757">0</span>&nbsp;<span class="op" id="4644759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4644764">panic</span><span class="op" id="4644769">(</span><span class="string" id="4644770">&#34;internal&nbsp;error&#34;</span><span class="op" id="4644786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644794">b</span><span class="op" id="4644795">.</span><span class="ident" id="4644796">writeN</span><span class="op" id="4644802">(</span><span class="ident" id="4644803">tabs</span><span class="op" id="4644807">,</span>&nbsp;<span class="op" id="4644809">(</span><span class="ident" id="4644810">n</span><span class="op" id="4644811">+</span><span class="ident" id="4644812">b</span><span class="op" id="4644813">.</span><span class="ident" id="4644814">tabwidth</span><span class="op" id="4644822">-</span><span class="num" id="4644823">1</span><span class="op" id="4644824">)</span><span class="op" id="4644825">/</span><span class="ident" id="4644826">b</span><span class="op" id="4644827">.</span><span class="ident" id="4644828">tabwidth</span><span class="op" id="4644836">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644840">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4644852">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;non-tab&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644896">b</span><span class="op" id="4644897">.</span><span class="ident" id="4644898">writeN</span><span class="op" id="4644904">(</span><span class="ident" id="4644905">b</span><span class="op" id="4644906">.</span><span class="ident" id="4644907">padbytes</span><span class="op" id="4644915">[</span><span class="num" id="4644916">0</span><span class="op" id="4644917">:</span><span class="op" id="4644918">]</span><span class="op" id="4644919">,</span>&nbsp;<span class="ident" id="4644921">cellw</span><span class="op" id="4644926">-</span><span class="ident" id="4644927">textw</span><span class="op" id="4644932">)</span><br>
<span class="lineno">255</span><span class="op" id="4644934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4644937">var</span>&nbsp;<span class="ident" id="4644941">vbar</span>&nbsp;<span class="op" id="4644946">=</span>&nbsp;<span class="op" id="4644948">[</span><span class="op" id="4644949">]</span><span class="builtintype" id="4644950">byte</span><span class="op" id="4644954">{</span><span class="string" id="4644955">&#39;|&#39;</span><span class="op" id="4644958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4644961">func</span>&nbsp;<span class="op" id="4644966">(</span><span class="ident" id="4644967">b</span>&nbsp;<span class="op" id="4644969">*</span><span class="ident" id="4644970">Writer</span><span class="op" id="4644976">)</span>&nbsp;<span class="ident" id="4644978">writeLines</span><span class="op" id="4644988">(</span><span class="ident" id="4644989">pos0</span>&nbsp;<span class="builtintype" id="4644994">int</span><span class="op" id="4644997">,</span>&nbsp;<span class="ident" id="4644999">line0</span><span class="op" id="4645004">,</span>&nbsp;<span class="ident" id="4645006">line1</span>&nbsp;<span class="builtintype" id="4645012">int</span><span class="op" id="4645015">)</span>&nbsp;<span class="op" id="4645017">(</span><span class="ident" id="4645018">pos</span>&nbsp;<span class="builtintype" id="4645022">int</span><span class="op" id="4645025">)</span>&nbsp;<span class="op" id="4645027">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645030">pos</span>&nbsp;<span class="op" id="4645034">=</span>&nbsp;<span class="ident" id="4645036">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4645042">for</span>&nbsp;<span class="ident" id="4645046">i</span>&nbsp;<span class="op" id="4645048">:=</span>&nbsp;<span class="ident" id="4645051">line0</span><span class="op" id="4645056">;</span>&nbsp;<span class="ident" id="4645058">i</span>&nbsp;<span class="op" id="4645060">&lt;</span>&nbsp;<span class="ident" id="4645062">line1</span><span class="op" id="4645067">;</span>&nbsp;<span class="ident" id="4645069">i</span><span class="op" id="4645070">++</span>&nbsp;<span class="op" id="4645073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645077">line</span>&nbsp;<span class="op" id="4645082">:=</span>&nbsp;<span class="ident" id="4645085">b</span><span class="op" id="4645086">.</span><span class="ident" id="4645087">lines</span><span class="op" id="4645092">[</span><span class="ident" id="4645093">i</span><span class="op" id="4645094">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4645099">//&nbsp;if&nbsp;TabIndent&nbsp;is&nbsp;set,&nbsp;use&nbsp;tabs&nbsp;to&nbsp;pad&nbsp;leading&nbsp;empty&nbsp;cells</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645161">useTabs</span>&nbsp;<span class="op" id="4645169">:=</span>&nbsp;<span class="ident" id="4645172">b</span><span class="op" id="4645173">.</span><span class="ident" id="4645174">flags</span><span class="op" id="4645179">&amp;</span><span class="ident" id="4645180">TabIndent</span>&nbsp;<span class="op" id="4645190">!=</span>&nbsp;<span class="num" id="4645193">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4645198">for</span>&nbsp;<span class="ident" id="4645202">j</span><span class="op" id="4645203">,</span>&nbsp;<span class="ident" id="4645205">c</span>&nbsp;<span class="op" id="4645207">:=</span>&nbsp;<span class="keyword" id="4645210">range</span>&nbsp;<span class="ident" id="4645216">line</span>&nbsp;<span class="op" id="4645221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4645226">if</span>&nbsp;<span class="ident" id="4645229">j</span>&nbsp;<span class="op" id="4645231">&gt;</span>&nbsp;<span class="num" id="4645233">0</span>&nbsp;<span class="op" id="4645235">&amp;&amp;</span>&nbsp;<span class="ident" id="4645238">b</span><span class="op" id="4645239">.</span><span class="ident" id="4645240">flags</span><span class="op" id="4645245">&amp;</span><span class="ident" id="4645246">Debug</span>&nbsp;<span class="op" id="4645252">!=</span>&nbsp;<span class="num" id="4645255">0</span>&nbsp;<span class="op" id="4645257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4645263">//&nbsp;indicate&nbsp;column&nbsp;break</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645292">b</span><span class="op" id="4645293">.</span><span class="ident" id="4645294">write0</span><span class="op" id="4645300">(</span><span class="ident" id="4645301">vbar</span><span class="op" id="4645305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4645316">if</span>&nbsp;<span class="ident" id="4645319">c</span><span class="op" id="4645320">.</span><span class="ident" id="4645321">size</span>&nbsp;<span class="op" id="4645326">==</span>&nbsp;<span class="num" id="4645329">0</span>&nbsp;<span class="op" id="4645331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4645337">//&nbsp;empty&nbsp;cell</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4645355">if</span>&nbsp;<span class="ident" id="4645358">j</span>&nbsp;<span class="op" id="4645360">&lt;</span>&nbsp;<span class="builtinfunc" id="4645362">len</span><span class="op" id="4645365">(</span><span class="ident" id="4645366">b</span><span class="op" id="4645367">.</span><span class="ident" id="4645368">widths</span><span class="op" id="4645374">)</span>&nbsp;<span class="op" id="4645376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645383">b</span><span class="op" id="4645384">.</span><span class="ident" id="4645385">writePadding</span><span class="op" id="4645397">(</span><span class="ident" id="4645398">c</span><span class="op" id="4645399">.</span><span class="ident" id="4645400">width</span><span class="op" id="4645405">,</span>&nbsp;<span class="ident" id="4645407">b</span><span class="op" id="4645408">.</span><span class="ident" id="4645409">widths</span><span class="op" id="4645415">[</span><span class="ident" id="4645416">j</span><span class="op" id="4645417">]</span><span class="op" id="4645418">,</span>&nbsp;<span class="ident" id="4645420">useTabs</span><span class="op" id="4645427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645438">}</span>&nbsp;<span class="keyword" id="4645440">else</span>&nbsp;<span class="op" id="4645445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4645451">//&nbsp;non-empty&nbsp;cell</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645473">useTabs</span>&nbsp;<span class="op" id="4645481">=</span>&nbsp;<span class="builtintype" id="4645483">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4645493">if</span>&nbsp;<span class="ident" id="4645496">b</span><span class="op" id="4645497">.</span><span class="ident" id="4645498">flags</span><span class="op" id="4645503">&amp;</span><span class="ident" id="4645504">AlignRight</span>&nbsp;<span class="op" id="4645515">==</span>&nbsp;<span class="num" id="4645518">0</span>&nbsp;<span class="op" id="4645520">{</span>&nbsp;<span class="comment" id="4645522">//&nbsp;align&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645541">b</span><span class="op" id="4645542">.</span><span class="ident" id="4645543">write0</span><span class="op" id="4645549">(</span><span class="ident" id="4645550">b</span><span class="op" id="4645551">.</span><span class="ident" id="4645552">buf</span><span class="op" id="4645555">.</span><span class="ident" id="4645556">Bytes</span><span class="op" id="4645561">(</span><span class="op" id="4645562">)</span><span class="op" id="4645563">[</span><span class="ident" id="4645564">pos</span>&nbsp;<span class="op" id="4645568">:</span>&nbsp;<span class="ident" id="4645570">pos</span><span class="op" id="4645573">+</span><span class="ident" id="4645574">c</span><span class="op" id="4645575">.</span><span class="ident" id="4645576">size</span><span class="op" id="4645580">]</span><span class="op" id="4645581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645588">pos</span>&nbsp;<span class="op" id="4645592">+=</span>&nbsp;<span class="ident" id="4645595">c</span><span class="op" id="4645596">.</span><span class="ident" id="4645597">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4645607">if</span>&nbsp;<span class="ident" id="4645610">j</span>&nbsp;<span class="op" id="4645612">&lt;</span>&nbsp;<span class="builtinfunc" id="4645614">len</span><span class="op" id="4645617">(</span><span class="ident" id="4645618">b</span><span class="op" id="4645619">.</span><span class="ident" id="4645620">widths</span><span class="op" id="4645626">)</span>&nbsp;<span class="op" id="4645628">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645636">b</span><span class="op" id="4645637">.</span><span class="ident" id="4645638">writePadding</span><span class="op" id="4645650">(</span><span class="ident" id="4645651">c</span><span class="op" id="4645652">.</span><span class="ident" id="4645653">width</span><span class="op" id="4645658">,</span>&nbsp;<span class="ident" id="4645660">b</span><span class="op" id="4645661">.</span><span class="ident" id="4645662">widths</span><span class="op" id="4645668">[</span><span class="ident" id="4645669">j</span><span class="op" id="4645670">]</span><span class="op" id="4645671">,</span>&nbsp;<span class="builtintype" id="4645673">false</span><span class="op" id="4645678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645691">}</span>&nbsp;<span class="keyword" id="4645693">else</span>&nbsp;<span class="op" id="4645698">{</span>&nbsp;<span class="comment" id="4645700">//&nbsp;align&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4645720">if</span>&nbsp;<span class="ident" id="4645723">j</span>&nbsp;<span class="op" id="4645725">&lt;</span>&nbsp;<span class="builtinfunc" id="4645727">len</span><span class="op" id="4645730">(</span><span class="ident" id="4645731">b</span><span class="op" id="4645732">.</span><span class="ident" id="4645733">widths</span><span class="op" id="4645739">)</span>&nbsp;<span class="op" id="4645741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645749">b</span><span class="op" id="4645750">.</span><span class="ident" id="4645751">writePadding</span><span class="op" id="4645763">(</span><span class="ident" id="4645764">c</span><span class="op" id="4645765">.</span><span class="ident" id="4645766">width</span><span class="op" id="4645771">,</span>&nbsp;<span class="ident" id="4645773">b</span><span class="op" id="4645774">.</span><span class="ident" id="4645775">widths</span><span class="op" id="4645781">[</span><span class="ident" id="4645782">j</span><span class="op" id="4645783">]</span><span class="op" id="4645784">,</span>&nbsp;<span class="builtintype" id="4645786">false</span><span class="op" id="4645791">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645805">b</span><span class="op" id="4645806">.</span><span class="ident" id="4645807">write0</span><span class="op" id="4645813">(</span><span class="ident" id="4645814">b</span><span class="op" id="4645815">.</span><span class="ident" id="4645816">buf</span><span class="op" id="4645819">.</span><span class="ident" id="4645820">Bytes</span><span class="op" id="4645825">(</span><span class="op" id="4645826">)</span><span class="op" id="4645827">[</span><span class="ident" id="4645828">pos</span>&nbsp;<span class="op" id="4645832">:</span>&nbsp;<span class="ident" id="4645834">pos</span><span class="op" id="4645837">+</span><span class="ident" id="4645838">c</span><span class="op" id="4645839">.</span><span class="ident" id="4645840">size</span><span class="op" id="4645844">]</span><span class="op" id="4645845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4645852">pos</span>&nbsp;<span class="op" id="4645856">+=</span>&nbsp;<span class="ident" id="4645859">c</span><span class="op" id="4645860">.</span><span class="ident" id="4645861">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645875">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4645879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4645884">if</span>&nbsp;<span class="ident" id="4645887">i</span><span class="op" id="4645888">+</span><span class="num" id="4645889">1</span>&nbsp;<span class="op" id="4645891">==</span>&nbsp;<span class="builtinfunc" id="4645894">len</span><span class="op" id="4645897">(</span><span class="ident" id="4645898">b</span><span class="op" id="4645899">.</span><span class="ident" id="4645900">lines</span><span class="op" id="4645905">)</span>&nbsp;<span class="op" id="4645907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4645912">//&nbsp;last&nbsp;buffered&nbsp;line&nbsp;-&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;newline,&nbsp;so&nbsp;just&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4645978">//&nbsp;any&nbsp;outstanding&nbsp;buffered&nbsp;data</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646014">b</span><span class="op" id="4646015">.</span><span class="ident" id="4646016">write0</span><span class="op" id="4646022">(</span><span class="ident" id="4646023">b</span><span class="op" id="4646024">.</span><span class="ident" id="4646025">buf</span><span class="op" id="4646028">.</span><span class="ident" id="4646029">Bytes</span><span class="op" id="4646034">(</span><span class="op" id="4646035">)</span><span class="op" id="4646036">[</span><span class="ident" id="4646037">pos</span>&nbsp;<span class="op" id="4646041">:</span>&nbsp;<span class="ident" id="4646043">pos</span><span class="op" id="4646046">+</span><span class="ident" id="4646047">b</span><span class="op" id="4646048">.</span><span class="ident" id="4646049">cell</span><span class="op" id="4646053">.</span><span class="ident" id="4646054">size</span><span class="op" id="4646058">]</span><span class="op" id="4646059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646064">pos</span>&nbsp;<span class="op" id="4646068">+=</span>&nbsp;<span class="ident" id="4646071">b</span><span class="op" id="4646072">.</span><span class="ident" id="4646073">cell</span><span class="op" id="4646077">.</span><span class="ident" id="4646078">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4646085">}</span>&nbsp;<span class="keyword" id="4646087">else</span>&nbsp;<span class="op" id="4646092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4646097">//&nbsp;not&nbsp;the&nbsp;last&nbsp;line&nbsp;-&nbsp;write&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646137">b</span><span class="op" id="4646138">.</span><span class="ident" id="4646139">write0</span><span class="op" id="4646145">(</span><span class="ident" id="4646146">newline</span><span class="op" id="4646153">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4646157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4646160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4646163">return</span><br>
<span class="lineno"></span><span class="op" id="4646170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="4646173">//&nbsp;Format&nbsp;the&nbsp;text&nbsp;between&nbsp;line0&nbsp;and&nbsp;line1&nbsp;(excluding&nbsp;line1);&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="4646239">//&nbsp;is&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;line0.</span><br>
<span class="lineno"></span><span class="comment" id="4646306">//&nbsp;Returns&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4646371">//&nbsp;line1&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="4646402">//</span><br>
<span class="lineno">315</span><span class="keyword" id="4646405">func</span>&nbsp;<span class="op" id="4646410">(</span><span class="ident" id="4646411">b</span>&nbsp;<span class="op" id="4646413">*</span><span class="ident" id="4646414">Writer</span><span class="op" id="4646420">)</span>&nbsp;<span class="ident" id="4646422">format</span><span class="op" id="4646428">(</span><span class="ident" id="4646429">pos0</span>&nbsp;<span class="builtintype" id="4646434">int</span><span class="op" id="4646437">,</span>&nbsp;<span class="ident" id="4646439">line0</span><span class="op" id="4646444">,</span>&nbsp;<span class="ident" id="4646446">line1</span>&nbsp;<span class="builtintype" id="4646452">int</span><span class="op" id="4646455">)</span>&nbsp;<span class="op" id="4646457">(</span><span class="ident" id="4646458">pos</span>&nbsp;<span class="builtintype" id="4646462">int</span><span class="op" id="4646465">)</span>&nbsp;<span class="op" id="4646467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646470">pos</span>&nbsp;<span class="op" id="4646474">=</span>&nbsp;<span class="ident" id="4646476">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646482">column</span>&nbsp;<span class="op" id="4646489">:=</span>&nbsp;<span class="builtinfunc" id="4646492">len</span><span class="op" id="4646495">(</span><span class="ident" id="4646496">b</span><span class="op" id="4646497">.</span><span class="ident" id="4646498">widths</span><span class="op" id="4646504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4646507">for</span>&nbsp;<span class="ident" id="4646511">this</span>&nbsp;<span class="op" id="4646516">:=</span>&nbsp;<span class="ident" id="4646519">line0</span><span class="op" id="4646524">;</span>&nbsp;<span class="ident" id="4646526">this</span>&nbsp;<span class="op" id="4646531">&lt;</span>&nbsp;<span class="ident" id="4646533">line1</span><span class="op" id="4646538">;</span>&nbsp;<span class="ident" id="4646540">this</span><span class="op" id="4646544">++</span>&nbsp;<span class="op" id="4646547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646551">line</span>&nbsp;<span class="op" id="4646556">:=</span>&nbsp;<span class="ident" id="4646559">b</span><span class="op" id="4646560">.</span><span class="ident" id="4646561">lines</span><span class="op" id="4646566">[</span><span class="ident" id="4646567">this</span><span class="op" id="4646571">]</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4646576">if</span>&nbsp;<span class="ident" id="4646579">column</span>&nbsp;<span class="op" id="4646586">&lt;</span>&nbsp;<span class="builtinfunc" id="4646588">len</span><span class="op" id="4646591">(</span><span class="ident" id="4646592">line</span><span class="op" id="4646596">)</span><span class="op" id="4646597">-</span><span class="num" id="4646598">1</span>&nbsp;<span class="op" id="4646600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4646605">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column&nbsp;=&gt;&nbsp;this&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4646651">//&nbsp;has&nbsp;more&nbsp;cells&nbsp;than&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4646695">//&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;is&nbsp;ignored&nbsp;because&nbsp;cells&nbsp;are</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4646754">//&nbsp;tab-terminated;&nbsp;the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4646813">//&nbsp;text&nbsp;before&nbsp;the&nbsp;newline/formfeed&nbsp;and&nbsp;does&nbsp;not&nbsp;belong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4646872">//&nbsp;to&nbsp;a&nbsp;column)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4646892">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;beginning&nbsp;of&nbsp;block</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646945">pos</span>&nbsp;<span class="op" id="4646949">=</span>&nbsp;<span class="ident" id="4646951">b</span><span class="op" id="4646952">.</span><span class="ident" id="4646953">writeLines</span><span class="op" id="4646963">(</span><span class="ident" id="4646964">pos</span><span class="op" id="4646967">,</span>&nbsp;<span class="ident" id="4646969">line0</span><span class="op" id="4646974">,</span>&nbsp;<span class="ident" id="4646976">this</span><span class="op" id="4646980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4646985">line0</span>&nbsp;<span class="op" id="4646991">=</span>&nbsp;<span class="ident" id="4646993">this</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4647002">//&nbsp;column&nbsp;block&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647027">width</span>&nbsp;<span class="op" id="4647033">:=</span>&nbsp;<span class="ident" id="4647036">b</span><span class="op" id="4647037">.</span><span class="ident" id="4647038">minwidth</span>&nbsp;<span class="comment" id="4647047">//&nbsp;minimal&nbsp;column&nbsp;width</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647074">discardable</span>&nbsp;<span class="op" id="4647086">:=</span>&nbsp;<span class="builtintype" id="4647089">true</span>&nbsp;<span class="comment" id="4647094">//&nbsp;true&nbsp;if&nbsp;all&nbsp;cells&nbsp;in&nbsp;this&nbsp;column&nbsp;are&nbsp;empty&nbsp;and&nbsp;&#34;soft&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647154">for</span>&nbsp;<span class="op" id="4647158">;</span>&nbsp;<span class="ident" id="4647160">this</span>&nbsp;<span class="op" id="4647165">&lt;</span>&nbsp;<span class="ident" id="4647167">line1</span><span class="op" id="4647172">;</span>&nbsp;<span class="ident" id="4647174">this</span><span class="op" id="4647178">++</span>&nbsp;<span class="op" id="4647181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647187">line</span>&nbsp;<span class="op" id="4647192">=</span>&nbsp;<span class="ident" id="4647194">b</span><span class="op" id="4647195">.</span><span class="ident" id="4647196">lines</span><span class="op" id="4647201">[</span><span class="ident" id="4647202">this</span><span class="op" id="4647206">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647212">if</span>&nbsp;<span class="ident" id="4647215">column</span>&nbsp;<span class="op" id="4647222">&lt;</span>&nbsp;<span class="builtinfunc" id="4647224">len</span><span class="op" id="4647227">(</span><span class="ident" id="4647228">line</span><span class="op" id="4647232">)</span><span class="op" id="4647233">-</span><span class="num" id="4647234">1</span>&nbsp;<span class="op" id="4647236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4647243">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647278">c</span>&nbsp;<span class="op" id="4647280">:=</span>&nbsp;<span class="ident" id="4647283">line</span><span class="op" id="4647287">[</span><span class="ident" id="4647288">column</span><span class="op" id="4647294">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4647301">//&nbsp;update&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647322">if</span>&nbsp;<span class="ident" id="4647325">w</span>&nbsp;<span class="op" id="4647327">:=</span>&nbsp;<span class="ident" id="4647330">c</span><span class="op" id="4647331">.</span><span class="ident" id="4647332">width</span>&nbsp;<span class="op" id="4647338">+</span>&nbsp;<span class="ident" id="4647340">b</span><span class="op" id="4647341">.</span><span class="ident" id="4647342">padding</span><span class="op" id="4647349">;</span>&nbsp;<span class="ident" id="4647351">w</span>&nbsp;<span class="op" id="4647353">&gt;</span>&nbsp;<span class="ident" id="4647355">width</span>&nbsp;<span class="op" id="4647361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647369">width</span>&nbsp;<span class="op" id="4647375">=</span>&nbsp;<span class="ident" id="4647377">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4647384">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4647391">//&nbsp;update&nbsp;discardable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647418">if</span>&nbsp;<span class="ident" id="4647421">c</span><span class="op" id="4647422">.</span><span class="ident" id="4647423">width</span>&nbsp;<span class="op" id="4647429">&gt;</span>&nbsp;<span class="num" id="4647431">0</span>&nbsp;<span class="op" id="4647433">||</span>&nbsp;<span class="ident" id="4647436">c</span><span class="op" id="4647437">.</span><span class="ident" id="4647438">htab</span>&nbsp;<span class="op" id="4647443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647451">discardable</span>&nbsp;<span class="op" id="4647463">=</span>&nbsp;<span class="builtintype" id="4647465">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4647476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4647482">}</span>&nbsp;<span class="keyword" id="4647484">else</span>&nbsp;<span class="op" id="4647489">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647496">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4647506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4647511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4647516">//&nbsp;column&nbsp;block&nbsp;end</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4647540">//&nbsp;discard&nbsp;empty&nbsp;columns&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647581">if</span>&nbsp;<span class="ident" id="4647584">discardable</span>&nbsp;<span class="op" id="4647596">&amp;&amp;</span>&nbsp;<span class="ident" id="4647599">b</span><span class="op" id="4647600">.</span><span class="ident" id="4647601">flags</span><span class="op" id="4647606">&amp;</span><span class="ident" id="4647607">DiscardEmptyColumns</span>&nbsp;<span class="op" id="4647627">!=</span>&nbsp;<span class="num" id="4647630">0</span>&nbsp;<span class="op" id="4647632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647638">width</span>&nbsp;<span class="op" id="4647644">=</span>&nbsp;<span class="num" id="4647646">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4647651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4647657">//&nbsp;format&nbsp;and&nbsp;print&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;right&nbsp;of&nbsp;this&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4647720">//&nbsp;(we&nbsp;know&nbsp;the&nbsp;widths&nbsp;of&nbsp;this&nbsp;column&nbsp;and&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;left)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647790">b</span><span class="op" id="4647791">.</span><span class="ident" id="4647792">widths</span>&nbsp;<span class="op" id="4647799">=</span>&nbsp;<span class="builtinfunc" id="4647801">append</span><span class="op" id="4647807">(</span><span class="ident" id="4647808">b</span><span class="op" id="4647809">.</span><span class="ident" id="4647810">widths</span><span class="op" id="4647816">,</span>&nbsp;<span class="ident" id="4647818">width</span><span class="op" id="4647823">)</span>&nbsp;<span class="comment" id="4647825">//&nbsp;push&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647842">pos</span>&nbsp;<span class="op" id="4647846">=</span>&nbsp;<span class="ident" id="4647848">b</span><span class="op" id="4647849">.</span><span class="ident" id="4647850">format</span><span class="op" id="4647856">(</span><span class="ident" id="4647857">pos</span><span class="op" id="4647860">,</span>&nbsp;<span class="ident" id="4647862">line0</span><span class="op" id="4647867">,</span>&nbsp;<span class="ident" id="4647869">this</span><span class="op" id="4647873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647878">b</span><span class="op" id="4647879">.</span><span class="ident" id="4647880">widths</span>&nbsp;<span class="op" id="4647887">=</span>&nbsp;<span class="ident" id="4647889">b</span><span class="op" id="4647890">.</span><span class="ident" id="4647891">widths</span><span class="op" id="4647897">[</span><span class="num" id="4647898">0</span>&nbsp;<span class="op" id="4647900">:</span>&nbsp;<span class="builtinfunc" id="4647902">len</span><span class="op" id="4647905">(</span><span class="ident" id="4647906">b</span><span class="op" id="4647907">.</span><span class="ident" id="4647908">widths</span><span class="op" id="4647914">)</span><span class="op" id="4647915">-</span><span class="num" id="4647916">1</span><span class="op" id="4647917">]</span>&nbsp;<span class="comment" id="4647919">//&nbsp;pop&nbsp;width</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4647935">line0</span>&nbsp;<span class="op" id="4647941">=</span>&nbsp;<span class="ident" id="4647943">this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4647950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4647953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4647957">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;end</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4647993">return</span>&nbsp;<span class="ident" id="4648000">b</span><span class="op" id="4648001">.</span><span class="ident" id="4648002">writeLines</span><span class="op" id="4648012">(</span><span class="ident" id="4648013">pos</span><span class="op" id="4648016">,</span>&nbsp;<span class="ident" id="4648018">line0</span><span class="op" id="4648023">,</span>&nbsp;<span class="ident" id="4648025">line1</span><span class="op" id="4648030">)</span><br>
<span class="lineno"></span><span class="op" id="4648032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4648035">//&nbsp;Append&nbsp;text&nbsp;to&nbsp;current&nbsp;cell.</span><br>
<span class="lineno"></span><span class="keyword" id="4648067">func</span>&nbsp;<span class="op" id="4648072">(</span><span class="ident" id="4648073">b</span>&nbsp;<span class="op" id="4648075">*</span><span class="ident" id="4648076">Writer</span><span class="op" id="4648082">)</span>&nbsp;<span class="builtinfunc" id="4648084">append</span><span class="op" id="4648090">(</span><span class="ident" id="4648091">text</span>&nbsp;<span class="op" id="4648096">[</span><span class="op" id="4648097">]</span><span class="builtintype" id="4648098">byte</span><span class="op" id="4648102">)</span>&nbsp;<span class="op" id="4648104">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4648107">b</span><span class="op" id="4648108">.</span><span class="ident" id="4648109">buf</span><span class="op" id="4648112">.</span><span class="ident" id="4648113">Write</span><span class="op" id="4648118">(</span><span class="ident" id="4648119">text</span><span class="op" id="4648123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4648126">b</span><span class="op" id="4648127">.</span><span class="ident" id="4648128">cell</span><span class="op" id="4648132">.</span><span class="ident" id="4648133">size</span>&nbsp;<span class="op" id="4648138">+=</span>&nbsp;<span class="builtinfunc" id="4648141">len</span><span class="op" id="4648144">(</span><span class="ident" id="4648145">text</span><span class="op" id="4648149">)</span><br>
<span class="lineno"></span><span class="op" id="4648151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4648154">//&nbsp;Update&nbsp;the&nbsp;cell&nbsp;width.</span><br>
<span class="lineno">380</span><span class="keyword" id="4648180">func</span>&nbsp;<span class="op" id="4648185">(</span><span class="ident" id="4648186">b</span>&nbsp;<span class="op" id="4648188">*</span><span class="ident" id="4648189">Writer</span><span class="op" id="4648195">)</span>&nbsp;<span class="ident" id="4648197">updateWidth</span><span class="op" id="4648208">(</span><span class="op" id="4648209">)</span>&nbsp;<span class="op" id="4648211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4648214">b</span><span class="op" id="4648215">.</span><span class="ident" id="4648216">cell</span><span class="op" id="4648220">.</span><span class="ident" id="4648221">width</span>&nbsp;<span class="op" id="4648227">+=</span>&nbsp;<span class="ident" id="4648230">utf8</span><span class="op" id="4648234">.</span><span class="ident" id="4648235">RuneCount</span><span class="op" id="4648244">(</span><span class="ident" id="4648245">b</span><span class="op" id="4648246">.</span><span class="ident" id="4648247">buf</span><span class="op" id="4648250">.</span><span class="ident" id="4648251">Bytes</span><span class="op" id="4648256">(</span><span class="op" id="4648257">)</span><span class="op" id="4648258">[</span><span class="ident" id="4648259">b</span><span class="op" id="4648260">.</span><span class="ident" id="4648261">pos</span><span class="op" id="4648264">:</span><span class="ident" id="4648265">b</span><span class="op" id="4648266">.</span><span class="ident" id="4648267">buf</span><span class="op" id="4648270">.</span><span class="ident" id="4648271">Len</span><span class="op" id="4648274">(</span><span class="op" id="4648275">)</span><span class="op" id="4648276">]</span><span class="op" id="4648277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4648280">b</span><span class="op" id="4648281">.</span><span class="ident" id="4648282">pos</span>&nbsp;<span class="op" id="4648286">=</span>&nbsp;<span class="ident" id="4648288">b</span><span class="op" id="4648289">.</span><span class="ident" id="4648290">buf</span><span class="op" id="4648293">.</span><span class="ident" id="4648294">Len</span><span class="op" id="4648297">(</span><span class="op" id="4648298">)</span><br>
<span class="lineno"></span><span class="op" id="4648300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="4648303">//&nbsp;To&nbsp;escape&nbsp;a&nbsp;text&nbsp;segment,&nbsp;bracket&nbsp;it&nbsp;with&nbsp;Escape&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="4648367">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;tab&nbsp;in&nbsp;this&nbsp;string&nbsp;&#34;Ignore&nbsp;this&nbsp;tab:&nbsp;\xff\t\xff&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4648437">//&nbsp;does&nbsp;not&nbsp;terminate&nbsp;a&nbsp;cell&nbsp;and&nbsp;constitutes&nbsp;a&nbsp;single&nbsp;character&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4648504">//&nbsp;width&nbsp;one&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="4648542">//</span><br>
<span class="lineno">390</span><span class="comment" id="4648545">//&nbsp;The&nbsp;value&nbsp;0xff&nbsp;was&nbsp;chosen&nbsp;because&nbsp;it&nbsp;cannot&nbsp;appear&nbsp;in&nbsp;a&nbsp;valid&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="4648626">//</span><br>
<span class="lineno"></span><span class="keyword" id="4648629">const</span>&nbsp;<span class="ident" id="4648635">Escape</span>&nbsp;<span class="op" id="4648642">=</span>&nbsp;<span class="string" id="4648644">&#39;\xff&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4648652">//&nbsp;Start&nbsp;escaped&nbsp;mode.</span><br>
<span class="lineno">395</span><span class="keyword" id="4648675">func</span>&nbsp;<span class="op" id="4648680">(</span><span class="ident" id="4648681">b</span>&nbsp;<span class="op" id="4648683">*</span><span class="ident" id="4648684">Writer</span><span class="op" id="4648690">)</span>&nbsp;<span class="ident" id="4648692">startEscape</span><span class="op" id="4648703">(</span><span class="ident" id="4648704">ch</span>&nbsp;<span class="builtintype" id="4648707">byte</span><span class="op" id="4648711">)</span>&nbsp;<span class="op" id="4648713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4648716">switch</span>&nbsp;<span class="ident" id="4648723">ch</span>&nbsp;<span class="op" id="4648726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4648729">case</span>&nbsp;<span class="ident" id="4648734">Escape</span><span class="op" id="4648740">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4648744">b</span><span class="op" id="4648745">.</span><span class="ident" id="4648746">endChar</span>&nbsp;<span class="op" id="4648754">=</span>&nbsp;<span class="ident" id="4648756">Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4648764">case</span>&nbsp;<span class="string" id="4648769">&#39;&lt;&#39;</span><span class="op" id="4648772">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4648776">b</span><span class="op" id="4648777">.</span><span class="ident" id="4648778">endChar</span>&nbsp;<span class="op" id="4648786">=</span>&nbsp;<span class="string" id="4648788">&#39;&gt;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4648793">case</span>&nbsp;<span class="string" id="4648798">&#39;&amp;&#39;</span><span class="op" id="4648801">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4648805">b</span><span class="op" id="4648806">.</span><span class="ident" id="4648807">endChar</span>&nbsp;<span class="op" id="4648815">=</span>&nbsp;<span class="string" id="4648817">&#39;;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4648822">}</span><br>
<span class="lineno"></span><span class="op" id="4648824">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="4648827">//&nbsp;Terminate&nbsp;escaped&nbsp;mode.&nbsp;If&nbsp;the&nbsp;escaped&nbsp;text&nbsp;was&nbsp;an&nbsp;HTML&nbsp;tag,&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="4648901">//&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;for&nbsp;formatting&nbsp;purposes;&nbsp;if&nbsp;it&nbsp;was&nbsp;an&nbsp;HTML&nbsp;entity,</span><br>
<span class="lineno"></span><span class="comment" id="4648977">//&nbsp;its&nbsp;width&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;one.&nbsp;In&nbsp;all&nbsp;other&nbsp;cases,&nbsp;the&nbsp;width&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4649049">//&nbsp;unicode&nbsp;width&nbsp;of&nbsp;the&nbsp;text.</span><br>
<span class="lineno">410</span><span class="comment" id="4649079">//</span><br>
<span class="lineno"></span><span class="keyword" id="4649082">func</span>&nbsp;<span class="op" id="4649087">(</span><span class="ident" id="4649088">b</span>&nbsp;<span class="op" id="4649090">*</span><span class="ident" id="4649091">Writer</span><span class="op" id="4649097">)</span>&nbsp;<span class="ident" id="4649099">endEscape</span><span class="op" id="4649108">(</span><span class="op" id="4649109">)</span>&nbsp;<span class="op" id="4649111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649114">switch</span>&nbsp;<span class="ident" id="4649121">b</span><span class="op" id="4649122">.</span><span class="ident" id="4649123">endChar</span>&nbsp;<span class="op" id="4649131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649134">case</span>&nbsp;<span class="ident" id="4649139">Escape</span><span class="op" id="4649145">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649149">b</span><span class="op" id="4649150">.</span><span class="ident" id="4649151">updateWidth</span><span class="op" id="4649162">(</span><span class="op" id="4649163">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649167">if</span>&nbsp;<span class="ident" id="4649170">b</span><span class="op" id="4649171">.</span><span class="ident" id="4649172">flags</span><span class="op" id="4649177">&amp;</span><span class="ident" id="4649178">StripEscape</span>&nbsp;<span class="op" id="4649190">==</span>&nbsp;<span class="num" id="4649193">0</span>&nbsp;<span class="op" id="4649195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649200">b</span><span class="op" id="4649201">.</span><span class="ident" id="4649202">cell</span><span class="op" id="4649206">.</span><span class="ident" id="4649207">width</span>&nbsp;<span class="op" id="4649213">-=</span>&nbsp;<span class="num" id="4649216">2</span>&nbsp;<span class="comment" id="4649218">//&nbsp;don&#39;t&nbsp;count&nbsp;the&nbsp;Escape&nbsp;chars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4649252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649255">case</span>&nbsp;<span class="string" id="4649260">&#39;&gt;&#39;</span><span class="op" id="4649263">:</span>&nbsp;<span class="comment" id="4649265">//&nbsp;tag&nbsp;of&nbsp;zero&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649287">case</span>&nbsp;<span class="string" id="4649292">&#39;;&#39;</span><span class="op" id="4649295">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649299">b</span><span class="op" id="4649300">.</span><span class="ident" id="4649301">cell</span><span class="op" id="4649305">.</span><span class="ident" id="4649306">width</span><span class="op" id="4649311">++</span>&nbsp;<span class="comment" id="4649314">//&nbsp;entity,&nbsp;count&nbsp;as&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4649344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649347">b</span><span class="op" id="4649348">.</span><span class="ident" id="4649349">pos</span>&nbsp;<span class="op" id="4649353">=</span>&nbsp;<span class="ident" id="4649355">b</span><span class="op" id="4649356">.</span><span class="ident" id="4649357">buf</span><span class="op" id="4649360">.</span><span class="ident" id="4649361">Len</span><span class="op" id="4649364">(</span><span class="op" id="4649365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649368">b</span><span class="op" id="4649369">.</span><span class="ident" id="4649370">endChar</span>&nbsp;<span class="op" id="4649378">=</span>&nbsp;<span class="num" id="4649380">0</span><br>
<span class="lineno"></span><span class="op" id="4649382">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="comment" id="4649385">//&nbsp;Terminate&nbsp;the&nbsp;current&nbsp;cell&nbsp;by&nbsp;adding&nbsp;it&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;cells&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4649456">//&nbsp;current&nbsp;line.&nbsp;Returns&nbsp;the&nbsp;number&nbsp;of&nbsp;cells&nbsp;in&nbsp;that&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="4649515">//</span><br>
<span class="lineno"></span><span class="keyword" id="4649518">func</span>&nbsp;<span class="op" id="4649523">(</span><span class="ident" id="4649524">b</span>&nbsp;<span class="op" id="4649526">*</span><span class="ident" id="4649527">Writer</span><span class="op" id="4649533">)</span>&nbsp;<span class="ident" id="4649535">terminateCell</span><span class="op" id="4649548">(</span><span class="ident" id="4649549">htab</span>&nbsp;<span class="builtintype" id="4649554">bool</span><span class="op" id="4649558">)</span>&nbsp;<span class="builtintype" id="4649560">int</span>&nbsp;<span class="op" id="4649564">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649567">b</span><span class="op" id="4649568">.</span><span class="ident" id="4649569">cell</span><span class="op" id="4649573">.</span><span class="ident" id="4649574">htab</span>&nbsp;<span class="op" id="4649579">=</span>&nbsp;<span class="ident" id="4649581">htab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649587">line</span>&nbsp;<span class="op" id="4649592">:=</span>&nbsp;<span class="op" id="4649595">&amp;</span><span class="ident" id="4649596">b</span><span class="op" id="4649597">.</span><span class="ident" id="4649598">lines</span><span class="op" id="4649603">[</span><span class="builtinfunc" id="4649604">len</span><span class="op" id="4649607">(</span><span class="ident" id="4649608">b</span><span class="op" id="4649609">.</span><span class="ident" id="4649610">lines</span><span class="op" id="4649615">)</span><span class="op" id="4649616">-</span><span class="num" id="4649617">1</span><span class="op" id="4649618">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4649621">*</span><span class="ident" id="4649622">line</span>&nbsp;<span class="op" id="4649627">=</span>&nbsp;<span class="builtinfunc" id="4649629">append</span><span class="op" id="4649635">(</span><span class="op" id="4649636">*</span><span class="ident" id="4649637">line</span><span class="op" id="4649641">,</span>&nbsp;<span class="ident" id="4649643">b</span><span class="op" id="4649644">.</span><span class="ident" id="4649645">cell</span><span class="op" id="4649649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4649652">b</span><span class="op" id="4649653">.</span><span class="ident" id="4649654">cell</span>&nbsp;<span class="op" id="4649659">=</span>&nbsp;<span class="ident" id="4649661">cell</span><span class="op" id="4649665">{</span><span class="op" id="4649666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649669">return</span>&nbsp;<span class="builtinfunc" id="4649676">len</span><span class="op" id="4649679">(</span><span class="op" id="4649680">*</span><span class="ident" id="4649681">line</span><span class="op" id="4649685">)</span><br>
<span class="lineno">435</span><span class="op" id="4649687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4649690">func</span>&nbsp;<span class="ident" id="4649695">handlePanic</span><span class="op" id="4649706">(</span><span class="ident" id="4649707">err</span>&nbsp;<span class="op" id="4649711">*</span><span class="builtintype" id="4649712">error</span><span class="op" id="4649717">,</span>&nbsp;<span class="ident" id="4649719">op</span>&nbsp;<span class="builtintype" id="4649722">string</span><span class="op" id="4649728">)</span>&nbsp;<span class="op" id="4649730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649733">if</span>&nbsp;<span class="ident" id="4649736">e</span>&nbsp;<span class="op" id="4649738">:=</span>&nbsp;<span class="builtinfunc" id="4649741">recover</span><span class="op" id="4649748">(</span><span class="op" id="4649749">)</span><span class="op" id="4649750">;</span>&nbsp;<span class="ident" id="4649752">e</span>&nbsp;<span class="op" id="4649754">!=</span>&nbsp;<span class="ident" id="4649757">nil</span>&nbsp;<span class="op" id="4649761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649765">if</span>&nbsp;<span class="ident" id="4649768">nerr</span><span class="op" id="4649772">,</span>&nbsp;<span class="ident" id="4649774">ok</span>&nbsp;<span class="op" id="4649777">:=</span>&nbsp;<span class="ident" id="4649780">e</span><span class="op" id="4649781">.</span><span class="op" id="4649782">(</span><span class="ident" id="4649783">osError</span><span class="op" id="4649790">)</span><span class="op" id="4649791">;</span>&nbsp;<span class="ident" id="4649793">ok</span>&nbsp;<span class="op" id="4649796">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4649801">*</span><span class="ident" id="4649802">err</span>&nbsp;<span class="op" id="4649806">=</span>&nbsp;<span class="ident" id="4649808">nerr</span><span class="op" id="4649812">.</span><span class="ident" id="4649813">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4649820">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4649829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4649833">panic</span><span class="op" id="4649838">(</span><span class="string" id="4649839">&#34;tabwriter:&nbsp;panic&nbsp;during&nbsp;&#34;</span>&nbsp;<span class="op" id="4649866">+</span>&nbsp;<span class="ident" id="4649868">op</span><span class="op" id="4649870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4649873">}</span><br>
<span class="lineno">445</span><span class="op" id="4649875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4649878">//&nbsp;Flush&nbsp;should&nbsp;be&nbsp;called&nbsp;after&nbsp;the&nbsp;last&nbsp;call&nbsp;to&nbsp;Write&nbsp;to&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="4649943">//&nbsp;that&nbsp;any&nbsp;data&nbsp;buffered&nbsp;in&nbsp;the&nbsp;Writer&nbsp;is&nbsp;written&nbsp;to&nbsp;output.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="4650009">//&nbsp;incomplete&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;end&nbsp;is&nbsp;considered</span><br>
<span class="lineno">450</span><span class="comment" id="4650064">//&nbsp;complete&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="4650101">//</span><br>
<span class="lineno"></span><span class="keyword" id="4650104">func</span>&nbsp;<span class="op" id="4650109">(</span><span class="ident" id="4650110">b</span>&nbsp;<span class="op" id="4650112">*</span><span class="ident" id="4650113">Writer</span><span class="op" id="4650119">)</span>&nbsp;<span class="ident" id="4650121">Flush</span><span class="op" id="4650126">(</span><span class="op" id="4650127">)</span>&nbsp;<span class="op" id="4650129">(</span><span class="ident" id="4650130">err</span>&nbsp;<span class="builtintype" id="4650134">error</span><span class="op" id="4650139">)</span>&nbsp;<span class="op" id="4650141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650144">defer</span>&nbsp;<span class="ident" id="4650150">b</span><span class="op" id="4650151">.</span><span class="ident" id="4650152">reset</span><span class="op" id="4650157">(</span><span class="op" id="4650158">)</span>&nbsp;<span class="comment" id="4650160">//&nbsp;even&nbsp;in&nbsp;the&nbsp;presence&nbsp;of&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650195">defer</span>&nbsp;<span class="ident" id="4650201">handlePanic</span><span class="op" id="4650212">(</span><span class="op" id="4650213">&amp;</span><span class="ident" id="4650214">err</span><span class="op" id="4650217">,</span>&nbsp;<span class="string" id="4650219">&#34;Flush&#34;</span><span class="op" id="4650226">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4650230">//&nbsp;add&nbsp;current&nbsp;cell&nbsp;if&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650264">if</span>&nbsp;<span class="ident" id="4650267">b</span><span class="op" id="4650268">.</span><span class="ident" id="4650269">cell</span><span class="op" id="4650273">.</span><span class="ident" id="4650274">size</span>&nbsp;<span class="op" id="4650279">&gt;</span>&nbsp;<span class="num" id="4650281">0</span>&nbsp;<span class="op" id="4650283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650287">if</span>&nbsp;<span class="ident" id="4650290">b</span><span class="op" id="4650291">.</span><span class="ident" id="4650292">endChar</span>&nbsp;<span class="op" id="4650300">!=</span>&nbsp;<span class="num" id="4650303">0</span>&nbsp;<span class="op" id="4650305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4650310">//&nbsp;inside&nbsp;escape&nbsp;-&nbsp;terminate&nbsp;it&nbsp;even&nbsp;if&nbsp;incomplete</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650364">b</span><span class="op" id="4650365">.</span><span class="ident" id="4650366">endEscape</span><span class="op" id="4650375">(</span><span class="op" id="4650376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4650380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650384">b</span><span class="op" id="4650385">.</span><span class="ident" id="4650386">terminateCell</span><span class="op" id="4650399">(</span><span class="builtintype" id="4650400">false</span><span class="op" id="4650405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4650408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4650412">//&nbsp;format&nbsp;contents&nbsp;of&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650442">b</span><span class="op" id="4650443">.</span><span class="ident" id="4650444">format</span><span class="op" id="4650450">(</span><span class="num" id="4650451">0</span><span class="op" id="4650452">,</span>&nbsp;<span class="num" id="4650454">0</span><span class="op" id="4650455">,</span>&nbsp;<span class="builtinfunc" id="4650457">len</span><span class="op" id="4650460">(</span><span class="ident" id="4650461">b</span><span class="op" id="4650462">.</span><span class="ident" id="4650463">lines</span><span class="op" id="4650468">)</span><span class="op" id="4650469">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650473">return</span><br>
<span class="lineno"></span><span class="op" id="4650480">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="4650483">var</span>&nbsp;<span class="ident" id="4650487">hbar</span>&nbsp;<span class="op" id="4650492">=</span>&nbsp;<span class="op" id="4650494">[</span><span class="op" id="4650495">]</span><span class="builtintype" id="4650496">byte</span><span class="op" id="4650500">(</span><span class="string" id="4650501">&#34;---\n&#34;</span><span class="op" id="4650508">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4650511">//&nbsp;Write&nbsp;writes&nbsp;buf&nbsp;to&nbsp;the&nbsp;writer&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="4650548">//&nbsp;The&nbsp;only&nbsp;errors&nbsp;returned&nbsp;are&nbsp;ones&nbsp;encountered</span><br>
<span class="lineno">475</span><span class="comment" id="4650597">//&nbsp;while&nbsp;writing&nbsp;to&nbsp;the&nbsp;underlying&nbsp;output&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="4650647">//</span><br>
<span class="lineno"></span><span class="keyword" id="4650650">func</span>&nbsp;<span class="op" id="4650655">(</span><span class="ident" id="4650656">b</span>&nbsp;<span class="op" id="4650658">*</span><span class="ident" id="4650659">Writer</span><span class="op" id="4650665">)</span>&nbsp;<span class="ident" id="4650667">Write</span><span class="op" id="4650672">(</span><span class="ident" id="4650673">buf</span>&nbsp;<span class="op" id="4650677">[</span><span class="op" id="4650678">]</span><span class="builtintype" id="4650679">byte</span><span class="op" id="4650683">)</span>&nbsp;<span class="op" id="4650685">(</span><span class="ident" id="4650686">n</span>&nbsp;<span class="builtintype" id="4650688">int</span><span class="op" id="4650691">,</span>&nbsp;<span class="ident" id="4650693">err</span>&nbsp;<span class="builtintype" id="4650697">error</span><span class="op" id="4650702">)</span>&nbsp;<span class="op" id="4650704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650707">defer</span>&nbsp;<span class="ident" id="4650713">handlePanic</span><span class="op" id="4650724">(</span><span class="op" id="4650725">&amp;</span><span class="ident" id="4650726">err</span><span class="op" id="4650729">,</span>&nbsp;<span class="string" id="4650731">&#34;Write&#34;</span><span class="op" id="4650738">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4650742">//&nbsp;split&nbsp;text&nbsp;into&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650768">n</span>&nbsp;<span class="op" id="4650770">=</span>&nbsp;<span class="num" id="4650772">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650775">for</span>&nbsp;<span class="ident" id="4650779">i</span><span class="op" id="4650780">,</span>&nbsp;<span class="ident" id="4650782">ch</span>&nbsp;<span class="op" id="4650785">:=</span>&nbsp;<span class="keyword" id="4650788">range</span>&nbsp;<span class="ident" id="4650794">buf</span>&nbsp;<span class="op" id="4650798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650802">if</span>&nbsp;<span class="ident" id="4650805">b</span><span class="op" id="4650806">.</span><span class="ident" id="4650807">endChar</span>&nbsp;<span class="op" id="4650815">==</span>&nbsp;<span class="num" id="4650818">0</span>&nbsp;<span class="op" id="4650820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4650825">//&nbsp;outside&nbsp;escape</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650846">switch</span>&nbsp;<span class="ident" id="4650853">ch</span>&nbsp;<span class="op" id="4650856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4650861">case</span>&nbsp;<span class="string" id="4650866">&#39;\t&#39;</span><span class="op" id="4650870">,</span>&nbsp;<span class="string" id="4650872">&#39;\v&#39;</span><span class="op" id="4650876">,</span>&nbsp;<span class="string" id="4650878">&#39;\n&#39;</span><span class="op" id="4650882">,</span>&nbsp;<span class="string" id="4650884">&#39;\f&#39;</span><span class="op" id="4650888">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4650894">//&nbsp;end&nbsp;of&nbsp;cell</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650913">b</span><span class="op" id="4650914">.</span><span class="builtinfunc" id="4650915">append</span><span class="op" id="4650921">(</span><span class="ident" id="4650922">buf</span><span class="op" id="4650925">[</span><span class="ident" id="4650926">n</span><span class="op" id="4650927">:</span><span class="ident" id="4650928">i</span><span class="op" id="4650929">]</span><span class="op" id="4650930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650936">b</span><span class="op" id="4650937">.</span><span class="ident" id="4650938">updateWidth</span><span class="op" id="4650949">(</span><span class="op" id="4650950">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650956">n</span>&nbsp;<span class="op" id="4650958">=</span>&nbsp;<span class="ident" id="4650960">i</span>&nbsp;<span class="op" id="4650962">+</span>&nbsp;<span class="num" id="4650964">1</span>&nbsp;<span class="comment" id="4650966">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4650985">ncells</span>&nbsp;<span class="op" id="4650992">:=</span>&nbsp;<span class="ident" id="4650995">b</span><span class="op" id="4650996">.</span><span class="ident" id="4650997">terminateCell</span><span class="op" id="4651010">(</span><span class="ident" id="4651011">ch</span>&nbsp;<span class="op" id="4651014">==</span>&nbsp;<span class="string" id="4651017">&#39;\t&#39;</span><span class="op" id="4651021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651027">if</span>&nbsp;<span class="ident" id="4651030">ch</span>&nbsp;<span class="op" id="4651033">==</span>&nbsp;<span class="string" id="4651036">&#39;\n&#39;</span>&nbsp;<span class="op" id="4651041">||</span>&nbsp;<span class="ident" id="4651044">ch</span>&nbsp;<span class="op" id="4651047">==</span>&nbsp;<span class="string" id="4651050">&#39;\f&#39;</span>&nbsp;<span class="op" id="4651055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4651062">//&nbsp;terminate&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651085">b</span><span class="op" id="4651086">.</span><span class="ident" id="4651087">addLine</span><span class="op" id="4651094">(</span><span class="op" id="4651095">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651102">if</span>&nbsp;<span class="ident" id="4651105">ch</span>&nbsp;<span class="op" id="4651108">==</span>&nbsp;<span class="string" id="4651111">&#39;\f&#39;</span>&nbsp;<span class="op" id="4651116">||</span>&nbsp;<span class="ident" id="4651119">ncells</span>&nbsp;<span class="op" id="4651126">==</span>&nbsp;<span class="num" id="4651129">1</span>&nbsp;<span class="op" id="4651131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4651139">//&nbsp;A&nbsp;&#39;\f&#39;&nbsp;always&nbsp;forces&nbsp;a&nbsp;flush.&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;previous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4651205">//&nbsp;line&nbsp;has&nbsp;only&nbsp;one&nbsp;cell&nbsp;which&nbsp;does&nbsp;not&nbsp;have&nbsp;an&nbsp;impact&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4651270">//&nbsp;the&nbsp;formatting&nbsp;of&nbsp;the&nbsp;following&nbsp;lines&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4651336">//&nbsp;line&nbsp;is&nbsp;ignored&nbsp;by&nbsp;format()),&nbsp;thus&nbsp;we&nbsp;can&nbsp;flush&nbsp;the</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4651397">//&nbsp;Writer&nbsp;contents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651423">if</span>&nbsp;<span class="ident" id="4651426">err</span>&nbsp;<span class="op" id="4651430">=</span>&nbsp;<span class="ident" id="4651432">b</span><span class="op" id="4651433">.</span><span class="ident" id="4651434">Flush</span><span class="op" id="4651439">(</span><span class="op" id="4651440">)</span><span class="op" id="4651441">;</span>&nbsp;<span class="ident" id="4651443">err</span>&nbsp;<span class="op" id="4651447">!=</span>&nbsp;<span class="ident" id="4651450">nil</span>&nbsp;<span class="op" id="4651454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651463">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4651476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651484">if</span>&nbsp;<span class="ident" id="4651487">ch</span>&nbsp;<span class="op" id="4651490">==</span>&nbsp;<span class="string" id="4651493">&#39;\f&#39;</span>&nbsp;<span class="op" id="4651498">&amp;&amp;</span>&nbsp;<span class="ident" id="4651501">b</span><span class="op" id="4651502">.</span><span class="ident" id="4651503">flags</span><span class="op" id="4651508">&amp;</span><span class="ident" id="4651509">Debug</span>&nbsp;<span class="op" id="4651515">!=</span>&nbsp;<span class="num" id="4651518">0</span>&nbsp;<span class="op" id="4651520">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4651529">//&nbsp;indicate&nbsp;section&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651562">b</span><span class="op" id="4651563">.</span><span class="ident" id="4651564">write0</span><span class="op" id="4651570">(</span><span class="ident" id="4651571">hbar</span><span class="op" id="4651575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4651583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4651590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4651596">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651602">case</span>&nbsp;<span class="ident" id="4651607">Escape</span><span class="op" id="4651613">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4651619">//&nbsp;start&nbsp;of&nbsp;escaped&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651652">b</span><span class="op" id="4651653">.</span><span class="builtinfunc" id="4651654">append</span><span class="op" id="4651660">(</span><span class="ident" id="4651661">buf</span><span class="op" id="4651664">[</span><span class="ident" id="4651665">n</span><span class="op" id="4651666">:</span><span class="ident" id="4651667">i</span><span class="op" id="4651668">]</span><span class="op" id="4651669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651675">b</span><span class="op" id="4651676">.</span><span class="ident" id="4651677">updateWidth</span><span class="op" id="4651688">(</span><span class="op" id="4651689">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651695">n</span>&nbsp;<span class="op" id="4651697">=</span>&nbsp;<span class="ident" id="4651699">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651705">if</span>&nbsp;<span class="ident" id="4651708">b</span><span class="op" id="4651709">.</span><span class="ident" id="4651710">flags</span><span class="op" id="4651715">&amp;</span><span class="ident" id="4651716">StripEscape</span>&nbsp;<span class="op" id="4651728">!=</span>&nbsp;<span class="num" id="4651731">0</span>&nbsp;<span class="op" id="4651733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651740">n</span><span class="op" id="4651741">++</span>&nbsp;<span class="comment" id="4651744">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4651764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651770">b</span><span class="op" id="4651771">.</span><span class="ident" id="4651772">startEscape</span><span class="op" id="4651783">(</span><span class="ident" id="4651784">Escape</span><span class="op" id="4651790">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651796">case</span>&nbsp;<span class="string" id="4651801">&#39;&lt;&#39;</span><span class="op" id="4651804">,</span>&nbsp;<span class="string" id="4651806">&#39;&amp;&#39;</span><span class="op" id="4651809">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4651815">//&nbsp;possibly&nbsp;an&nbsp;html&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4651850">if</span>&nbsp;<span class="ident" id="4651853">b</span><span class="op" id="4651854">.</span><span class="ident" id="4651855">flags</span><span class="op" id="4651860">&amp;</span><span class="ident" id="4651861">FilterHTML</span>&nbsp;<span class="op" id="4651872">!=</span>&nbsp;<span class="num" id="4651875">0</span>&nbsp;<span class="op" id="4651877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4651884">//&nbsp;begin&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651912">b</span><span class="op" id="4651913">.</span><span class="builtinfunc" id="4651914">append</span><span class="op" id="4651920">(</span><span class="ident" id="4651921">buf</span><span class="op" id="4651924">[</span><span class="ident" id="4651925">n</span><span class="op" id="4651926">:</span><span class="ident" id="4651927">i</span><span class="op" id="4651928">]</span><span class="op" id="4651929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651936">b</span><span class="op" id="4651937">.</span><span class="ident" id="4651938">updateWidth</span><span class="op" id="4651949">(</span><span class="op" id="4651950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651957">n</span>&nbsp;<span class="op" id="4651959">=</span>&nbsp;<span class="ident" id="4651961">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4651968">b</span><span class="op" id="4651969">.</span><span class="ident" id="4651970">startEscape</span><span class="op" id="4651981">(</span><span class="ident" id="4651982">ch</span><span class="op" id="4651984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4651990">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4651995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4652000">}</span>&nbsp;<span class="keyword" id="4652002">else</span>&nbsp;<span class="op" id="4652007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4652012">//&nbsp;inside&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4652032">if</span>&nbsp;<span class="ident" id="4652035">ch</span>&nbsp;<span class="op" id="4652038">==</span>&nbsp;<span class="ident" id="4652041">b</span><span class="op" id="4652042">.</span><span class="ident" id="4652043">endChar</span>&nbsp;<span class="op" id="4652051">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4652057">//&nbsp;end&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652082">j</span>&nbsp;<span class="op" id="4652084">:=</span>&nbsp;<span class="ident" id="4652087">i</span>&nbsp;<span class="op" id="4652089">+</span>&nbsp;<span class="num" id="4652091">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4652097">if</span>&nbsp;<span class="ident" id="4652100">ch</span>&nbsp;<span class="op" id="4652103">==</span>&nbsp;<span class="ident" id="4652106">Escape</span>&nbsp;<span class="op" id="4652113">&amp;&amp;</span>&nbsp;<span class="ident" id="4652116">b</span><span class="op" id="4652117">.</span><span class="ident" id="4652118">flags</span><span class="op" id="4652123">&amp;</span><span class="ident" id="4652124">StripEscape</span>&nbsp;<span class="op" id="4652136">!=</span>&nbsp;<span class="num" id="4652139">0</span>&nbsp;<span class="op" id="4652141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652148">j</span>&nbsp;<span class="op" id="4652150">=</span>&nbsp;<span class="ident" id="4652152">i</span>&nbsp;<span class="comment" id="4652154">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4652174">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652180">b</span><span class="op" id="4652181">.</span><span class="builtinfunc" id="4652182">append</span><span class="op" id="4652188">(</span><span class="ident" id="4652189">buf</span><span class="op" id="4652192">[</span><span class="ident" id="4652193">n</span><span class="op" id="4652194">:</span><span class="ident" id="4652195">j</span><span class="op" id="4652196">]</span><span class="op" id="4652197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652203">n</span>&nbsp;<span class="op" id="4652205">=</span>&nbsp;<span class="ident" id="4652207">i</span>&nbsp;<span class="op" id="4652209">+</span>&nbsp;<span class="num" id="4652211">1</span>&nbsp;<span class="comment" id="4652213">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652232">b</span><span class="op" id="4652233">.</span><span class="ident" id="4652234">endEscape</span><span class="op" id="4652243">(</span><span class="op" id="4652244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4652249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4652253">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4652256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4652260">//&nbsp;append&nbsp;leftover&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652285">b</span><span class="op" id="4652286">.</span><span class="builtinfunc" id="4652287">append</span><span class="op" id="4652293">(</span><span class="ident" id="4652294">buf</span><span class="op" id="4652297">[</span><span class="ident" id="4652298">n</span><span class="op" id="4652299">:</span><span class="op" id="4652300">]</span><span class="op" id="4652301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4652304">n</span>&nbsp;<span class="op" id="4652306">=</span>&nbsp;<span class="builtinfunc" id="4652308">len</span><span class="op" id="4652311">(</span><span class="ident" id="4652312">buf</span><span class="op" id="4652315">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4652318">return</span><br>
<span class="lineno"></span><span class="op" id="4652325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4652328">//&nbsp;NewWriter&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;tabwriter.Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4652391">//&nbsp;The&nbsp;parameters&nbsp;are&nbsp;the&nbsp;same&nbsp;as&nbsp;for&nbsp;the&nbsp;Init&nbsp;function.</span><br>
<span class="lineno">555</span><span class="comment" id="4652448">//</span><br>
<span class="lineno"></span><span class="keyword" id="4652451">func</span>&nbsp;<span class="ident" id="4652456">NewWriter</span><span class="op" id="4652465">(</span><span class="ident" id="4652466">output</span>&nbsp;<span class="ident" id="4652473">io</span><span class="op" id="4652475">.</span><span class="ident" id="4652476">Writer</span><span class="op" id="4652482">,</span>&nbsp;<span class="ident" id="4652484">minwidth</span><span class="op" id="4652492">,</span>&nbsp;<span class="ident" id="4652494">tabwidth</span><span class="op" id="4652502">,</span>&nbsp;<span class="ident" id="4652504">padding</span>&nbsp;<span class="builtintype" id="4652512">int</span><span class="op" id="4652515">,</span>&nbsp;<span class="ident" id="4652517">padchar</span>&nbsp;<span class="builtintype" id="4652525">byte</span><span class="op" id="4652529">,</span>&nbsp;<span class="ident" id="4652531">flags</span>&nbsp;<span class="builtintype" id="4652537">uint</span><span class="op" id="4652541">)</span>&nbsp;<span class="op" id="4652543">*</span><span class="ident" id="4652544">Writer</span>&nbsp;<span class="op" id="4652551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4652554">return</span>&nbsp;<span class="builtinfunc" id="4652561">new</span><span class="op" id="4652564">(</span><span class="ident" id="4652565">Writer</span><span class="op" id="4652571">)</span><span class="op" id="4652572">.</span><span class="ident" id="4652573">Init</span><span class="op" id="4652577">(</span><span class="ident" id="4652578">output</span><span class="op" id="4652584">,</span>&nbsp;<span class="ident" id="4652586">minwidth</span><span class="op" id="4652594">,</span>&nbsp;<span class="ident" id="4652596">tabwidth</span><span class="op" id="4652604">,</span>&nbsp;<span class="ident" id="4652606">padding</span><span class="op" id="4652613">,</span>&nbsp;<span class="ident" id="4652615">padchar</span><span class="op" id="4652622">,</span>&nbsp;<span class="ident" id="4652624">flags</span><span class="op" id="4652629">)</span><br>
<span class="lineno"></span><span class="op" id="4652631">}</span>
</div>
</body>
</html>
