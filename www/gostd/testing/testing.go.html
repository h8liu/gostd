<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6198883">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6198938">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6198992">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6199043">//&nbsp;Package&nbsp;testing&nbsp;provides&nbsp;support&nbsp;for&nbsp;automated&nbsp;testing&nbsp;of&nbsp;Go&nbsp;packages.</span><br>
<span class="lineno"></span><span class="comment" id="6199117">//&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;in&nbsp;concert&nbsp;with&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command,&nbsp;which&nbsp;automates</span><br>
<span class="lineno"></span><span class="comment" id="6199203">//&nbsp;execution&nbsp;of&nbsp;any&nbsp;function&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6199244">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestXxx(*testing.T)</span><br>
<span class="lineno"></span><span class="comment" id="6199276">//&nbsp;where&nbsp;Xxx&nbsp;can&nbsp;be&nbsp;any&nbsp;alphanumeric&nbsp;string&nbsp;(but&nbsp;the&nbsp;first&nbsp;letter&nbsp;must&nbsp;not&nbsp;be&nbsp;in</span><br>
<span class="lineno">10</span><span class="comment" id="6199357">//&nbsp;[a-z])&nbsp;and&nbsp;serves&nbsp;to&nbsp;identify&nbsp;the&nbsp;test&nbsp;routine.</span><br>
<span class="lineno"></span><span class="comment" id="6199408">//</span><br>
<span class="lineno"></span><span class="comment" id="6199411">//&nbsp;Within&nbsp;these&nbsp;functions,&nbsp;use&nbsp;the&nbsp;Error,&nbsp;Fail&nbsp;or&nbsp;related&nbsp;methods&nbsp;to&nbsp;signal&nbsp;failure.</span><br>
<span class="lineno"></span><span class="comment" id="6199496">//</span><br>
<span class="lineno"></span><span class="comment" id="6199499">//&nbsp;To&nbsp;write&nbsp;a&nbsp;new&nbsp;test&nbsp;suite,&nbsp;create&nbsp;a&nbsp;file&nbsp;whose&nbsp;name&nbsp;ends&nbsp;_test.go&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="6199573">//&nbsp;contains&nbsp;the&nbsp;TestXxx&nbsp;functions&nbsp;as&nbsp;described&nbsp;here.&nbsp;Put&nbsp;the&nbsp;file&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="6199651">//&nbsp;package&nbsp;as&nbsp;the&nbsp;one&nbsp;being&nbsp;tested.&nbsp;The&nbsp;file&nbsp;will&nbsp;be&nbsp;excluded&nbsp;from&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="6199726">//&nbsp;package&nbsp;builds&nbsp;but&nbsp;will&nbsp;be&nbsp;included&nbsp;when&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span><span class="comment" id="6199802">//&nbsp;For&nbsp;more&nbsp;detail,&nbsp;run&nbsp;``go&nbsp;help&nbsp;test&#39;&#39;&nbsp;and&nbsp;``go&nbsp;help&nbsp;testflag&#39;&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="6199869">//</span><br>
<span class="lineno">20</span><span class="comment" id="6199872">//&nbsp;Tests&nbsp;and&nbsp;benchmarks&nbsp;may&nbsp;be&nbsp;skipped&nbsp;if&nbsp;not&nbsp;applicable&nbsp;with&nbsp;a&nbsp;call&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6199944">//&nbsp;the&nbsp;Skip&nbsp;method&nbsp;of&nbsp;*T&nbsp;and&nbsp;*B:</span><br>
<span class="lineno"></span><span class="comment" id="6199977">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestTimeConsuming(t&nbsp;*testing.T)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6200023">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;testing.Short()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6200055">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.Skip(&#34;skipping&nbsp;test&nbsp;in&nbsp;short&nbsp;mode.&#34;)</span><br>
<span class="lineno">25</span><span class="comment" id="6200109">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6200122">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="6200137">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6200146">//</span><br>
<span class="lineno"></span><span class="comment" id="6200149">//&nbsp;Benchmarks</span><br>
<span class="lineno">30</span><span class="comment" id="6200163">//</span><br>
<span class="lineno"></span><span class="comment" id="6200166">//&nbsp;Functions&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6200191">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkXxx(*testing.B)</span><br>
<span class="lineno"></span><span class="comment" id="6200228">//&nbsp;are&nbsp;considered&nbsp;benchmarks,&nbsp;and&nbsp;are&nbsp;executed&nbsp;by&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="6200305">//&nbsp;its&nbsp;-bench&nbsp;flag&nbsp;is&nbsp;provided.&nbsp;Benchmarks&nbsp;are&nbsp;run&nbsp;sequentially.</span><br>
<span class="lineno">35</span><span class="comment" id="6200370">//</span><br>
<span class="lineno"></span><span class="comment" id="6200373">//&nbsp;For&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;testing&nbsp;flags,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="6200420">//&nbsp;http://golang.org/cmd/go/#hdr-Description_of_testing_flags.</span><br>
<span class="lineno"></span><span class="comment" id="6200483">//</span><br>
<span class="lineno"></span><span class="comment" id="6200486">//&nbsp;A&nbsp;sample&nbsp;benchmark&nbsp;function&nbsp;looks&nbsp;like&nbsp;this:</span><br>
<span class="lineno">40</span><span class="comment" id="6200534">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkHello(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6200577">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6200615">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Sprintf(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6200651">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6200664">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">45</span><span class="comment" id="6200673">//</span><br>
<span class="lineno"></span><span class="comment" id="6200676">//&nbsp;The&nbsp;benchmark&nbsp;function&nbsp;must&nbsp;run&nbsp;the&nbsp;target&nbsp;code&nbsp;b.N&nbsp;times.</span><br>
<span class="lineno"></span><span class="comment" id="6200738">//&nbsp;During&nbsp;benchark&nbsp;execution,&nbsp;b.N&nbsp;is&nbsp;adjusted&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;lasts</span><br>
<span class="lineno"></span><span class="comment" id="6200819">//&nbsp;long&nbsp;enough&nbsp;to&nbsp;be&nbsp;timed&nbsp;reliably.&nbsp;&nbsp;The&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="6200868">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp;10000000&nbsp;&nbsp;&nbsp;&nbsp;282&nbsp;ns/op</span><br>
<span class="lineno">50</span><span class="comment" id="6200915">//&nbsp;means&nbsp;that&nbsp;the&nbsp;loop&nbsp;ran&nbsp;10000000&nbsp;times&nbsp;at&nbsp;a&nbsp;speed&nbsp;of&nbsp;282&nbsp;ns&nbsp;per&nbsp;loop.</span><br>
<span class="lineno"></span><span class="comment" id="6200988">//</span><br>
<span class="lineno"></span><span class="comment" id="6200991">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;some&nbsp;expensive&nbsp;setup&nbsp;before&nbsp;running,&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="6201062">//&nbsp;may&nbsp;be&nbsp;reset:</span><br>
<span class="lineno"></span><span class="comment" id="6201079">//</span><br>
<span class="lineno">55</span><span class="comment" id="6201082">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkBigLen(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6201126">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big&nbsp;:=&nbsp;NewBig()</span><br>
<span class="lineno"></span><span class="comment" id="6201153">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.ResetTimer()</span><br>
<span class="lineno"></span><span class="comment" id="6201179">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6201217">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big.Len()</span><br>
<span class="lineno">60</span><span class="comment" id="6201242">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6201255">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6201264">//</span><br>
<span class="lineno"></span><span class="comment" id="6201267">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;to&nbsp;test&nbsp;performance&nbsp;in&nbsp;a&nbsp;parallel&nbsp;setting,&nbsp;it&nbsp;may&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="6201345">//&nbsp;the&nbsp;RunParallel&nbsp;helper&nbsp;function;&nbsp;such&nbsp;benchmarks&nbsp;are&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;with</span><br>
<span class="lineno">65</span><span class="comment" id="6201426">//&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag:</span><br>
<span class="lineno"></span><span class="comment" id="6201452">//</span><br>
<span class="lineno"></span><span class="comment" id="6201455">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkTemplateParallel(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6201509">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ&nbsp;:=&nbsp;template.Must(template.New(&#34;test&#34;).Parse(&#34;Hello,&nbsp;{{.}}!&#34;))</span><br>
<span class="lineno"></span><span class="comment" id="6201588">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.RunParallel(func(pb&nbsp;*testing.PB)&nbsp;{</span><br>
<span class="lineno">70</span><span class="comment" id="6201636">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;buf&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span><span class="comment" id="6201672">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;pb.Next()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6201703">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.Reset()</span><br>
<span class="lineno"></span><span class="comment" id="6201734">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ.Execute(&amp;buf,&nbsp;&#34;World&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6201782">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">75</span><span class="comment" id="6201799">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><br>
<span class="lineno"></span><span class="comment" id="6201813">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6201822">//</span><br>
<span class="lineno"></span><span class="comment" id="6201825">//&nbsp;Examples</span><br>
<span class="lineno"></span><span class="comment" id="6201837">//</span><br>
<span class="lineno">80</span><span class="comment" id="6201840">//&nbsp;The&nbsp;package&nbsp;also&nbsp;runs&nbsp;and&nbsp;verifies&nbsp;example&nbsp;code.&nbsp;Example&nbsp;functions&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="6201914">//&nbsp;include&nbsp;a&nbsp;concluding&nbsp;line&nbsp;comment&nbsp;that&nbsp;begins&nbsp;with&nbsp;&#34;Output:&#34;&nbsp;and&nbsp;is&nbsp;compared&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6201999">//&nbsp;the&nbsp;standard&nbsp;output&nbsp;of&nbsp;the&nbsp;function&nbsp;when&nbsp;the&nbsp;tests&nbsp;are&nbsp;run.&nbsp;(The&nbsp;comparison</span><br>
<span class="lineno"></span><span class="comment" id="6202078">//&nbsp;ignores&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space.)&nbsp;These&nbsp;are&nbsp;examples&nbsp;of&nbsp;an&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="6202152">//</span><br>
<span class="lineno">85</span><span class="comment" id="6202155">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleHello()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6202184">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6202220">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:&nbsp;hello</span><br>
<span class="lineno"></span><span class="comment" id="6202252">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6202261">//</span><br>
<span class="lineno">90</span><span class="comment" id="6202264">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleSalutations()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6202299">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello,&nbsp;and&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6202340">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;goodbye&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6202378">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:</span><br>
<span class="lineno"></span><span class="comment" id="6202404">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;hello,&nbsp;and</span><br>
<span class="lineno">95</span><span class="comment" id="6202433">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;goodbye</span><br>
<span class="lineno"></span><span class="comment" id="6202459">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6202468">//</span><br>
<span class="lineno"></span><span class="comment" id="6202471">//&nbsp;Example&nbsp;functions&nbsp;without&nbsp;output&nbsp;comments&nbsp;are&nbsp;compiled&nbsp;but&nbsp;not&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="6202547">//</span><br>
<span class="lineno">100</span><span class="comment" id="6202550">//&nbsp;The&nbsp;naming&nbsp;convention&nbsp;to&nbsp;declare&nbsp;examples&nbsp;for&nbsp;the&nbsp;package,&nbsp;a&nbsp;function&nbsp;F,&nbsp;a&nbsp;type&nbsp;T&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6202639">//&nbsp;method&nbsp;M&nbsp;on&nbsp;type&nbsp;T&nbsp;are:</span><br>
<span class="lineno"></span><span class="comment" id="6202666">//</span><br>
<span class="lineno"></span><span class="comment" id="6202669">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6202699">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">105</span><span class="comment" id="6202730">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6202761">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6202794">//</span><br>
<span class="lineno"></span><span class="comment" id="6202797">//&nbsp;Multiple&nbsp;example&nbsp;functions&nbsp;for&nbsp;a&nbsp;package/type/function/method&nbsp;may&nbsp;be&nbsp;provided&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6202881">//&nbsp;appending&nbsp;a&nbsp;distinct&nbsp;suffix&nbsp;to&nbsp;the&nbsp;name.&nbsp;The&nbsp;suffix&nbsp;must&nbsp;start&nbsp;with&nbsp;a</span><br>
<span class="lineno">110</span><span class="comment" id="6202954">//&nbsp;lower-case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="comment" id="6202976">//</span><br>
<span class="lineno"></span><span class="comment" id="6202979">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6203016">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6203054">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">115</span><span class="comment" id="6203092">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6203132">//</span><br>
<span class="lineno"></span><span class="comment" id="6203135">//&nbsp;The&nbsp;entire&nbsp;test&nbsp;file&nbsp;is&nbsp;presented&nbsp;as&nbsp;the&nbsp;example&nbsp;when&nbsp;it&nbsp;contains&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="6203213">//&nbsp;example&nbsp;function,&nbsp;at&nbsp;least&nbsp;one&nbsp;other&nbsp;function,&nbsp;type,&nbsp;variable,&nbsp;or&nbsp;constant</span><br>
<span class="lineno"></span><span class="comment" id="6203291">//&nbsp;declaration,&nbsp;and&nbsp;no&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;functions.</span><br>
<span class="lineno">120</span><span class="comment" id="6203343">//</span><br>
<span class="lineno"></span><span class="comment" id="6203346">//&nbsp;Main</span><br>
<span class="lineno"></span><span class="comment" id="6203354">//</span><br>
<span class="lineno"></span><span class="comment" id="6203357">//&nbsp;It&nbsp;is&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;program&nbsp;to&nbsp;do&nbsp;extra&nbsp;setup&nbsp;or&nbsp;teardown</span><br>
<span class="lineno"></span><span class="comment" id="6203435">//&nbsp;before&nbsp;or&nbsp;after&nbsp;testing.&nbsp;It&nbsp;is&nbsp;also&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;to&nbsp;control</span><br>
<span class="lineno">125</span><span class="comment" id="6203516">//&nbsp;which&nbsp;code&nbsp;runs&nbsp;on&nbsp;the&nbsp;main&nbsp;thread.&nbsp;To&nbsp;support&nbsp;these&nbsp;and&nbsp;other&nbsp;cases,</span><br>
<span class="lineno"></span><span class="comment" id="6203589">//&nbsp;if&nbsp;a&nbsp;test&nbsp;file&nbsp;contains&nbsp;a&nbsp;function:</span><br>
<span class="lineno"></span><span class="comment" id="6203628">//</span><br>
<span class="lineno"></span><span class="comment" id="6203631">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;TestMain(m&nbsp;*testing.M)</span><br>
<span class="lineno"></span><span class="comment" id="6203662">//</span><br>
<span class="lineno">130</span><span class="comment" id="6203665">//&nbsp;then&nbsp;the&nbsp;generated&nbsp;test&nbsp;will&nbsp;call&nbsp;TestMain(m)&nbsp;instead&nbsp;of&nbsp;running&nbsp;the&nbsp;tests</span><br>
<span class="lineno"></span><span class="comment" id="6203743">//&nbsp;directly.&nbsp;TestMain&nbsp;runs&nbsp;in&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;and&nbsp;can&nbsp;do&nbsp;whatever&nbsp;setup</span><br>
<span class="lineno"></span><span class="comment" id="6203818">//&nbsp;and&nbsp;teardown&nbsp;is&nbsp;necessary&nbsp;around&nbsp;a&nbsp;call&nbsp;to&nbsp;m.Run.&nbsp;It&nbsp;should&nbsp;then&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="6203891">//&nbsp;os.Exit&nbsp;with&nbsp;the&nbsp;result&nbsp;of&nbsp;m.Run.</span><br>
<span class="lineno"></span><span class="comment" id="6203928">//</span><br>
<span class="lineno">135</span><span class="comment" id="6203931">//&nbsp;The&nbsp;minimal&nbsp;implementation&nbsp;of&nbsp;TestMain&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="6203977">//</span><br>
<span class="lineno"></span><span class="comment" id="6203980">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;TestMain(m&nbsp;*testing.M)&nbsp;{&nbsp;os.Exit(m.Run())&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6204032">//</span><br>
<span class="lineno"></span><span class="comment" id="6204035">//&nbsp;In&nbsp;effect,&nbsp;that&nbsp;is&nbsp;the&nbsp;implementation&nbsp;used&nbsp;when&nbsp;no&nbsp;TestMain&nbsp;is&nbsp;explicitly&nbsp;defined.</span><br>
<span class="lineno">140</span><span class="keyword" id="6204121">package</span>&nbsp;<span class="ident" id="6204129">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6204138">import</span>&nbsp;<span class="op" id="6204145">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6204148">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6204157">&#34;flag&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6204165">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6204172">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6204178">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6204189">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6204206">&#34;strconv&#34;</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6204217">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6204228">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6204236">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6204243">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="6204246">var</span>&nbsp;<span class="op" id="6204250">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6204253">//&nbsp;The&nbsp;short&nbsp;flag&nbsp;requests&nbsp;that&nbsp;tests&nbsp;run&nbsp;more&nbsp;quickly,&nbsp;but&nbsp;its&nbsp;functionality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6204332">//&nbsp;is&nbsp;provided&nbsp;by&nbsp;test&nbsp;writers&nbsp;themselves.&nbsp;&nbsp;The&nbsp;testing&nbsp;package&nbsp;is&nbsp;just&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6204409">//&nbsp;home.&nbsp;&nbsp;The&nbsp;all.bash&nbsp;installation&nbsp;script&nbsp;sets&nbsp;it&nbsp;to&nbsp;make&nbsp;installation&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6204487">//&nbsp;efficient,&nbsp;but&nbsp;by&nbsp;default&nbsp;the&nbsp;flag&nbsp;is&nbsp;off&nbsp;so&nbsp;a&nbsp;plain&nbsp;&#34;go&nbsp;test&#34;&nbsp;will&nbsp;do&nbsp;a</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6204564">//&nbsp;full&nbsp;test&nbsp;of&nbsp;the&nbsp;package.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204594">short</span>&nbsp;<span class="op" id="6204600">=</span>&nbsp;<span class="ident" id="6204602">flag</span><span class="op" id="6204606">.</span><span class="ident" id="6204607">Bool</span><span class="op" id="6204611">(</span><span class="string" id="6204612">&#34;test.short&#34;</span><span class="op" id="6204624">,</span>&nbsp;<span class="builtintype" id="6204626">false</span><span class="op" id="6204631">,</span>&nbsp;<span class="string" id="6204633">&#34;run&nbsp;smaller&nbsp;test&nbsp;suite&nbsp;to&nbsp;save&nbsp;time&#34;</span><span class="op" id="6204670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6204674">//&nbsp;The&nbsp;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;create&nbsp;profile&nbsp;files&nbsp;and&nbsp;the&nbsp;like.&nbsp;When&nbsp;run&nbsp;from</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6204753">//&nbsp;&#34;go&nbsp;test&#34;,&nbsp;the&nbsp;binary&nbsp;always&nbsp;runs&nbsp;in&nbsp;the&nbsp;source&nbsp;directory&nbsp;for&nbsp;the&nbsp;package;</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6204832">//&nbsp;this&nbsp;flag&nbsp;lets&nbsp;&#34;go&nbsp;test&#34;&nbsp;tell&nbsp;the&nbsp;binary&nbsp;to&nbsp;write&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;directory&nbsp;where</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6204919">//&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204953">outputDir</span>&nbsp;<span class="op" id="6204963">=</span>&nbsp;<span class="ident" id="6204965">flag</span><span class="op" id="6204969">.</span><span class="ident" id="6204970">String</span><span class="op" id="6204976">(</span><span class="string" id="6204977">&#34;test.outputdir&#34;</span><span class="op" id="6204993">,</span>&nbsp;<span class="string" id="6204995">&#34;&#34;</span><span class="op" id="6204997">,</span>&nbsp;<span class="string" id="6204999">&#34;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;write&nbsp;profiles&#34;</span><span class="op" id="6205037">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6205041">//&nbsp;Report&nbsp;as&nbsp;tests&nbsp;are&nbsp;run;&nbsp;default&nbsp;is&nbsp;silent&nbsp;for&nbsp;success.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205101">chatty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6205118">=</span>&nbsp;<span class="ident" id="6205120">flag</span><span class="op" id="6205124">.</span><span class="ident" id="6205125">Bool</span><span class="op" id="6205129">(</span><span class="string" id="6205130">&#34;test.v&#34;</span><span class="op" id="6205138">,</span>&nbsp;<span class="builtintype" id="6205140">false</span><span class="op" id="6205145">,</span>&nbsp;<span class="string" id="6205147">&#34;verbose:&nbsp;print&nbsp;additional&nbsp;output&#34;</span><span class="op" id="6205181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205184">coverProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6205201">=</span>&nbsp;<span class="ident" id="6205203">flag</span><span class="op" id="6205207">.</span><span class="ident" id="6205208">String</span><span class="op" id="6205214">(</span><span class="string" id="6205215">&#34;test.coverprofile&#34;</span><span class="op" id="6205234">,</span>&nbsp;<span class="string" id="6205236">&#34;&#34;</span><span class="op" id="6205238">,</span>&nbsp;<span class="string" id="6205240">&#34;write&nbsp;a&nbsp;coverage&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6205300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205303">match</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6205320">=</span>&nbsp;<span class="ident" id="6205322">flag</span><span class="op" id="6205326">.</span><span class="ident" id="6205327">String</span><span class="op" id="6205333">(</span><span class="string" id="6205334">&#34;test.run&#34;</span><span class="op" id="6205344">,</span>&nbsp;<span class="string" id="6205346">&#34;&#34;</span><span class="op" id="6205348">,</span>&nbsp;<span class="string" id="6205350">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;tests&nbsp;and&nbsp;examples&nbsp;to&nbsp;run&#34;</span><span class="op" id="6205406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205409">memProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6205426">=</span>&nbsp;<span class="ident" id="6205428">flag</span><span class="op" id="6205432">.</span><span class="ident" id="6205433">String</span><span class="op" id="6205439">(</span><span class="string" id="6205440">&#34;test.memprofile&#34;</span><span class="op" id="6205457">,</span>&nbsp;<span class="string" id="6205459">&#34;&#34;</span><span class="op" id="6205461">,</span>&nbsp;<span class="string" id="6205463">&#34;write&nbsp;a&nbsp;memory&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6205521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205524">memProfileRate</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6205541">=</span>&nbsp;<span class="ident" id="6205543">flag</span><span class="op" id="6205547">.</span><span class="ident" id="6205548">Int</span><span class="op" id="6205551">(</span><span class="string" id="6205552">&#34;test.memprofilerate&#34;</span><span class="op" id="6205573">,</span>&nbsp;<span class="num" id="6205575">0</span><span class="op" id="6205576">,</span>&nbsp;<span class="string" id="6205578">&#34;if&nbsp;&gt;=0,&nbsp;sets&nbsp;runtime.MemProfileRate&#34;</span><span class="op" id="6205615">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205618">cpuProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6205635">=</span>&nbsp;<span class="ident" id="6205637">flag</span><span class="op" id="6205641">.</span><span class="ident" id="6205642">String</span><span class="op" id="6205648">(</span><span class="string" id="6205649">&#34;test.cpuprofile&#34;</span><span class="op" id="6205666">,</span>&nbsp;<span class="string" id="6205668">&#34;&#34;</span><span class="op" id="6205670">,</span>&nbsp;<span class="string" id="6205672">&#34;write&nbsp;a&nbsp;cpu&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;during&nbsp;execution&#34;</span><span class="op" id="6205728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205731">blockProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6205748">=</span>&nbsp;<span class="ident" id="6205750">flag</span><span class="op" id="6205754">.</span><span class="ident" id="6205755">String</span><span class="op" id="6205761">(</span><span class="string" id="6205762">&#34;test.blockprofile&#34;</span><span class="op" id="6205781">,</span>&nbsp;<span class="string" id="6205783">&#34;&#34;</span><span class="op" id="6205785">,</span>&nbsp;<span class="string" id="6205787">&#34;write&nbsp;a&nbsp;goroutine&nbsp;blocking&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6205857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205860">blockProfileRate</span>&nbsp;<span class="op" id="6205877">=</span>&nbsp;<span class="ident" id="6205879">flag</span><span class="op" id="6205883">.</span><span class="ident" id="6205884">Int</span><span class="op" id="6205887">(</span><span class="string" id="6205888">&#34;test.blockprofilerate&#34;</span><span class="op" id="6205911">,</span>&nbsp;<span class="num" id="6205913">1</span><span class="op" id="6205914">,</span>&nbsp;<span class="string" id="6205916">&#34;if&nbsp;&gt;=&nbsp;0,&nbsp;calls&nbsp;runtime.SetBlockProfileRate()&#34;</span><span class="op" id="6205962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205965">timeout</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6205982">=</span>&nbsp;<span class="ident" id="6205984">flag</span><span class="op" id="6205988">.</span><span class="ident" id="6205989">Duration</span><span class="op" id="6205997">(</span><span class="string" id="6205998">&#34;test.timeout&#34;</span><span class="op" id="6206012">,</span>&nbsp;<span class="num" id="6206014">0</span><span class="op" id="6206015">,</span>&nbsp;<span class="string" id="6206017">&#34;if&nbsp;positive,&nbsp;sets&nbsp;an&nbsp;aggregate&nbsp;time&nbsp;limit&nbsp;for&nbsp;all&nbsp;tests&#34;</span><span class="op" id="6206074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206077">cpuListStr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6206094">=</span>&nbsp;<span class="ident" id="6206096">flag</span><span class="op" id="6206100">.</span><span class="ident" id="6206101">String</span><span class="op" id="6206107">(</span><span class="string" id="6206108">&#34;test.cpu&#34;</span><span class="op" id="6206118">,</span>&nbsp;<span class="string" id="6206120">&#34;&#34;</span><span class="op" id="6206122">,</span>&nbsp;<span class="string" id="6206124">&#34;comma-separated&nbsp;list&nbsp;of&nbsp;number&nbsp;of&nbsp;CPUs&nbsp;to&nbsp;use&nbsp;for&nbsp;each&nbsp;test&#34;</span><span class="op" id="6206185">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206188">parallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6206205">=</span>&nbsp;<span class="ident" id="6206207">flag</span><span class="op" id="6206211">.</span><span class="ident" id="6206212">Int</span><span class="op" id="6206215">(</span><span class="string" id="6206216">&#34;test.parallel&#34;</span><span class="op" id="6206231">,</span>&nbsp;<span class="ident" id="6206233">runtime</span><span class="op" id="6206240">.</span><span class="ident" id="6206241">GOMAXPROCS</span><span class="op" id="6206251">(</span><span class="num" id="6206252">0</span><span class="op" id="6206253">)</span><span class="op" id="6206254">,</span>&nbsp;<span class="string" id="6206256">&#34;maximum&nbsp;test&nbsp;parallelism&#34;</span><span class="op" id="6206282">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206286">haveExamples</span>&nbsp;<span class="builtintype" id="6206299">bool</span>&nbsp;<span class="comment" id="6206304">//&nbsp;are&nbsp;there&nbsp;examples?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206329">cpuList</span>&nbsp;<span class="op" id="6206337">[</span><span class="op" id="6206338">]</span><span class="builtintype" id="6206339">int</span><br>
<span class="lineno">185</span><span class="op" id="6206343">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6206346">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;elements&nbsp;common&nbsp;between&nbsp;T&nbsp;and&nbsp;B&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6206402">//&nbsp;captures&nbsp;common&nbsp;methods&nbsp;such&nbsp;as&nbsp;Errorf.</span><br>
<span class="lineno"></span><span class="keyword" id="6206445">type</span>&nbsp;<span class="ident" id="6206450">common</span>&nbsp;<span class="keyword" id="6206457">struct</span>&nbsp;<span class="op" id="6206464">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206467">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6206476">sync</span><span class="op" id="6206480">.</span><span class="ident" id="6206481">RWMutex</span>&nbsp;<span class="comment" id="6206489">//&nbsp;guards&nbsp;output&nbsp;and&nbsp;failed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206518">output</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6206527">[</span><span class="op" id="6206528">]</span><span class="builtintype" id="6206529">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6206540">//&nbsp;Output&nbsp;generated&nbsp;by&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206583">failed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6206592">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6206605">//&nbsp;Test&nbsp;or&nbsp;benchmark&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206639">skipped</span>&nbsp;&nbsp;<span class="builtintype" id="6206648">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6206661">//&nbsp;Test&nbsp;of&nbsp;benchmark&nbsp;has&nbsp;been&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206701">finished</span>&nbsp;<span class="builtintype" id="6206710">bool</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206717">start</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6206726">time</span><span class="op" id="6206730">.</span><span class="ident" id="6206731">Time</span>&nbsp;<span class="comment" id="6206736">//&nbsp;Time&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;started</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206771">duration</span>&nbsp;<span class="ident" id="6206780">time</span><span class="op" id="6206784">.</span><span class="ident" id="6206785">Duration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206795">self</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6206804">interface</span><span class="op" id="6206813">{</span><span class="op" id="6206814">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6206821">//&nbsp;To&nbsp;be&nbsp;sent&nbsp;on&nbsp;signal&nbsp;channel&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206865">signal</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6206874">chan</span>&nbsp;<span class="keyword" id="6206879">interface</span><span class="op" id="6206888">{</span><span class="op" id="6206889">}</span>&nbsp;<span class="comment" id="6206891">//&nbsp;Output&nbsp;for&nbsp;serial&nbsp;tests.</span><br>
<span class="lineno">200</span><span class="op" id="6206919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6206922">//&nbsp;Short&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.short&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6206976">func</span>&nbsp;<span class="ident" id="6206981">Short</span><span class="op" id="6206986">(</span><span class="op" id="6206987">)</span>&nbsp;<span class="builtintype" id="6206989">bool</span>&nbsp;<span class="op" id="6206994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6206997">return</span>&nbsp;<span class="op" id="6207004">*</span><span class="ident" id="6207005">short</span><br>
<span class="lineno">205</span><span class="op" id="6207011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6207014">//&nbsp;Verbose&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6207066">func</span>&nbsp;<span class="ident" id="6207071">Verbose</span><span class="op" id="6207078">(</span><span class="op" id="6207079">)</span>&nbsp;<span class="builtintype" id="6207081">bool</span>&nbsp;<span class="op" id="6207086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6207089">return</span>&nbsp;<span class="op" id="6207096">*</span><span class="ident" id="6207097">chatty</span><br>
<span class="lineno">210</span><span class="op" id="6207104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6207107">//&nbsp;decorate&nbsp;prefixes&nbsp;the&nbsp;string&nbsp;with&nbsp;the&nbsp;file&nbsp;and&nbsp;line&nbsp;of&nbsp;the&nbsp;call&nbsp;site</span><br>
<span class="lineno"></span><span class="comment" id="6207179">//&nbsp;and&nbsp;inserts&nbsp;the&nbsp;final&nbsp;newline&nbsp;if&nbsp;needed&nbsp;and&nbsp;indentation&nbsp;tabs&nbsp;for&nbsp;formatting.</span><br>
<span class="lineno"></span><span class="keyword" id="6207259">func</span>&nbsp;<span class="ident" id="6207264">decorate</span><span class="op" id="6207272">(</span><span class="ident" id="6207273">s</span>&nbsp;<span class="builtintype" id="6207275">string</span><span class="op" id="6207281">)</span>&nbsp;<span class="builtintype" id="6207283">string</span>&nbsp;<span class="op" id="6207290">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207293">_</span><span class="op" id="6207294">,</span>&nbsp;<span class="ident" id="6207296">file</span><span class="op" id="6207300">,</span>&nbsp;<span class="ident" id="6207302">line</span><span class="op" id="6207306">,</span>&nbsp;<span class="ident" id="6207308">ok</span>&nbsp;<span class="op" id="6207311">:=</span>&nbsp;<span class="ident" id="6207314">runtime</span><span class="op" id="6207321">.</span><span class="ident" id="6207322">Caller</span><span class="op" id="6207328">(</span><span class="num" id="6207329">3</span><span class="op" id="6207330">)</span>&nbsp;<span class="comment" id="6207332">//&nbsp;decorate&nbsp;+&nbsp;log&nbsp;+&nbsp;public&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6207370">if</span>&nbsp;<span class="ident" id="6207373">ok</span>&nbsp;<span class="op" id="6207376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6207380">//&nbsp;Truncate&nbsp;file&nbsp;name&nbsp;at&nbsp;last&nbsp;file&nbsp;name&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6207433">if</span>&nbsp;<span class="ident" id="6207436">index</span>&nbsp;<span class="op" id="6207442">:=</span>&nbsp;<span class="ident" id="6207445">strings</span><span class="op" id="6207452">.</span><span class="ident" id="6207453">LastIndex</span><span class="op" id="6207462">(</span><span class="ident" id="6207463">file</span><span class="op" id="6207467">,</span>&nbsp;<span class="string" id="6207469">&#34;/&#34;</span><span class="op" id="6207472">)</span><span class="op" id="6207473">;</span>&nbsp;<span class="ident" id="6207475">index</span>&nbsp;<span class="op" id="6207481">&gt;=</span>&nbsp;<span class="num" id="6207484">0</span>&nbsp;<span class="op" id="6207486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207491">file</span>&nbsp;<span class="op" id="6207496">=</span>&nbsp;<span class="ident" id="6207498">file</span><span class="op" id="6207502">[</span><span class="ident" id="6207503">index</span><span class="op" id="6207508">+</span><span class="num" id="6207509">1</span><span class="op" id="6207510">:</span><span class="op" id="6207511">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6207515">}</span>&nbsp;<span class="keyword" id="6207517">else</span>&nbsp;<span class="keyword" id="6207522">if</span>&nbsp;<span class="ident" id="6207525">index</span>&nbsp;<span class="op" id="6207531">=</span>&nbsp;<span class="ident" id="6207533">strings</span><span class="op" id="6207540">.</span><span class="ident" id="6207541">LastIndex</span><span class="op" id="6207550">(</span><span class="ident" id="6207551">file</span><span class="op" id="6207555">,</span>&nbsp;<span class="string" id="6207557">&#34;\\&#34;</span><span class="op" id="6207561">)</span><span class="op" id="6207562">;</span>&nbsp;<span class="ident" id="6207564">index</span>&nbsp;<span class="op" id="6207570">&gt;=</span>&nbsp;<span class="num" id="6207573">0</span>&nbsp;<span class="op" id="6207575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207580">file</span>&nbsp;<span class="op" id="6207585">=</span>&nbsp;<span class="ident" id="6207587">file</span><span class="op" id="6207591">[</span><span class="ident" id="6207592">index</span><span class="op" id="6207597">+</span><span class="num" id="6207598">1</span><span class="op" id="6207599">:</span><span class="op" id="6207600">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6207604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6207607">}</span>&nbsp;<span class="keyword" id="6207609">else</span>&nbsp;<span class="op" id="6207614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207618">file</span>&nbsp;<span class="op" id="6207623">=</span>&nbsp;<span class="string" id="6207625">&#34;???&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207633">line</span>&nbsp;<span class="op" id="6207638">=</span>&nbsp;<span class="num" id="6207640">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6207643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207646">buf</span>&nbsp;<span class="op" id="6207650">:=</span>&nbsp;<span class="builtinfunc" id="6207653">new</span><span class="op" id="6207656">(</span><span class="ident" id="6207657">bytes</span><span class="op" id="6207662">.</span><span class="ident" id="6207663">Buffer</span><span class="op" id="6207669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6207672">//&nbsp;Every&nbsp;line&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;one&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207717">buf</span><span class="op" id="6207720">.</span><span class="ident" id="6207721">WriteByte</span><span class="op" id="6207730">(</span><span class="string" id="6207731">&#39;\t&#39;</span><span class="op" id="6207735">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207738">fmt</span><span class="op" id="6207741">.</span><span class="ident" id="6207742">Fprintf</span><span class="op" id="6207749">(</span><span class="ident" id="6207750">buf</span><span class="op" id="6207753">,</span>&nbsp;<span class="string" id="6207755">&#34;%s:%d:&nbsp;&#34;</span><span class="op" id="6207764">,</span>&nbsp;<span class="ident" id="6207766">file</span><span class="op" id="6207770">,</span>&nbsp;<span class="ident" id="6207772">line</span><span class="op" id="6207776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207779">lines</span>&nbsp;<span class="op" id="6207785">:=</span>&nbsp;<span class="ident" id="6207788">strings</span><span class="op" id="6207795">.</span><span class="ident" id="6207796">Split</span><span class="op" id="6207801">(</span><span class="ident" id="6207802">s</span><span class="op" id="6207803">,</span>&nbsp;<span class="string" id="6207805">&#34;\n&#34;</span><span class="op" id="6207809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6207812">if</span>&nbsp;<span class="ident" id="6207815">l</span>&nbsp;<span class="op" id="6207817">:=</span>&nbsp;<span class="builtinfunc" id="6207820">len</span><span class="op" id="6207823">(</span><span class="ident" id="6207824">lines</span><span class="op" id="6207829">)</span><span class="op" id="6207830">;</span>&nbsp;<span class="ident" id="6207832">l</span>&nbsp;<span class="op" id="6207834">&gt;</span>&nbsp;<span class="num" id="6207836">1</span>&nbsp;<span class="op" id="6207838">&amp;&amp;</span>&nbsp;<span class="ident" id="6207841">lines</span><span class="op" id="6207846">[</span><span class="ident" id="6207847">l</span><span class="op" id="6207848">-</span><span class="num" id="6207849">1</span><span class="op" id="6207850">]</span>&nbsp;<span class="op" id="6207852">==</span>&nbsp;<span class="string" id="6207855">&#34;&#34;</span>&nbsp;<span class="op" id="6207858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207862">lines</span>&nbsp;<span class="op" id="6207868">=</span>&nbsp;<span class="ident" id="6207870">lines</span><span class="op" id="6207875">[</span><span class="op" id="6207876">:</span><span class="ident" id="6207877">l</span><span class="op" id="6207878">-</span><span class="num" id="6207879">1</span><span class="op" id="6207880">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6207883">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6207886">for</span>&nbsp;<span class="ident" id="6207890">i</span><span class="op" id="6207891">,</span>&nbsp;<span class="ident" id="6207893">line</span>&nbsp;<span class="op" id="6207898">:=</span>&nbsp;<span class="keyword" id="6207901">range</span>&nbsp;<span class="ident" id="6207907">lines</span>&nbsp;<span class="op" id="6207913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6207917">if</span>&nbsp;<span class="ident" id="6207920">i</span>&nbsp;<span class="op" id="6207922">&gt;</span>&nbsp;<span class="num" id="6207924">0</span>&nbsp;<span class="op" id="6207926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6207931">//&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;lines&nbsp;are&nbsp;indented&nbsp;an&nbsp;extra&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207992">buf</span><span class="op" id="6207995">.</span><span class="ident" id="6207996">WriteString</span><span class="op" id="6208007">(</span><span class="string" id="6208008">&#34;\n\t\t&#34;</span><span class="op" id="6208016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6208020">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208024">buf</span><span class="op" id="6208027">.</span><span class="ident" id="6208028">WriteString</span><span class="op" id="6208039">(</span><span class="ident" id="6208040">line</span><span class="op" id="6208044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6208047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208050">buf</span><span class="op" id="6208053">.</span><span class="ident" id="6208054">WriteByte</span><span class="op" id="6208063">(</span><span class="string" id="6208064">&#39;\n&#39;</span><span class="op" id="6208068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6208071">return</span>&nbsp;<span class="ident" id="6208078">buf</span><span class="op" id="6208081">.</span><span class="ident" id="6208082">String</span><span class="op" id="6208088">(</span><span class="op" id="6208089">)</span><br>
<span class="lineno"></span><span class="op" id="6208091">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="6208094">//&nbsp;fmtDuration&nbsp;returns&nbsp;a&nbsp;string&nbsp;representing&nbsp;d&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;87.00s&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="6208163">func</span>&nbsp;<span class="ident" id="6208168">fmtDuration</span><span class="op" id="6208179">(</span><span class="ident" id="6208180">d</span>&nbsp;<span class="ident" id="6208182">time</span><span class="op" id="6208186">.</span><span class="ident" id="6208187">Duration</span><span class="op" id="6208195">)</span>&nbsp;<span class="builtintype" id="6208197">string</span>&nbsp;<span class="op" id="6208204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6208207">return</span>&nbsp;<span class="ident" id="6208214">fmt</span><span class="op" id="6208217">.</span><span class="ident" id="6208218">Sprintf</span><span class="op" id="6208225">(</span><span class="string" id="6208226">&#34;%.2fs&#34;</span><span class="op" id="6208233">,</span>&nbsp;<span class="ident" id="6208235">d</span><span class="op" id="6208236">.</span><span class="ident" id="6208237">Seconds</span><span class="op" id="6208244">(</span><span class="op" id="6208245">)</span><span class="op" id="6208246">)</span><br>
<span class="lineno"></span><span class="op" id="6208248">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="comment" id="6208251">//&nbsp;TB&nbsp;is&nbsp;the&nbsp;interface&nbsp;common&nbsp;to&nbsp;T&nbsp;and&nbsp;B.</span><br>
<span class="lineno"></span><span class="keyword" id="6208293">type</span>&nbsp;<span class="ident" id="6208298">TB</span>&nbsp;<span class="keyword" id="6208301">interface</span>&nbsp;<span class="op" id="6208311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208314">Error</span><span class="op" id="6208319">(</span><span class="ident" id="6208320">args</span>&nbsp;<span class="op" id="6208325">...</span><span class="keyword" id="6208328">interface</span><span class="op" id="6208337">{</span><span class="op" id="6208338">}</span><span class="op" id="6208339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208342">Errorf</span><span class="op" id="6208348">(</span><span class="ident" id="6208349">format</span>&nbsp;<span class="builtintype" id="6208356">string</span><span class="op" id="6208362">,</span>&nbsp;<span class="ident" id="6208364">args</span>&nbsp;<span class="op" id="6208369">...</span><span class="keyword" id="6208372">interface</span><span class="op" id="6208381">{</span><span class="op" id="6208382">}</span><span class="op" id="6208383">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208386">Fail</span><span class="op" id="6208390">(</span><span class="op" id="6208391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208394">FailNow</span><span class="op" id="6208401">(</span><span class="op" id="6208402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208405">Failed</span><span class="op" id="6208411">(</span><span class="op" id="6208412">)</span>&nbsp;<span class="builtintype" id="6208414">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208420">Fatal</span><span class="op" id="6208425">(</span><span class="ident" id="6208426">args</span>&nbsp;<span class="op" id="6208431">...</span><span class="keyword" id="6208434">interface</span><span class="op" id="6208443">{</span><span class="op" id="6208444">}</span><span class="op" id="6208445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208448">Fatalf</span><span class="op" id="6208454">(</span><span class="ident" id="6208455">format</span>&nbsp;<span class="builtintype" id="6208462">string</span><span class="op" id="6208468">,</span>&nbsp;<span class="ident" id="6208470">args</span>&nbsp;<span class="op" id="6208475">...</span><span class="keyword" id="6208478">interface</span><span class="op" id="6208487">{</span><span class="op" id="6208488">}</span><span class="op" id="6208489">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208492">Log</span><span class="op" id="6208495">(</span><span class="ident" id="6208496">args</span>&nbsp;<span class="op" id="6208501">...</span><span class="keyword" id="6208504">interface</span><span class="op" id="6208513">{</span><span class="op" id="6208514">}</span><span class="op" id="6208515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208518">Logf</span><span class="op" id="6208522">(</span><span class="ident" id="6208523">format</span>&nbsp;<span class="builtintype" id="6208530">string</span><span class="op" id="6208536">,</span>&nbsp;<span class="ident" id="6208538">args</span>&nbsp;<span class="op" id="6208543">...</span><span class="keyword" id="6208546">interface</span><span class="op" id="6208555">{</span><span class="op" id="6208556">}</span><span class="op" id="6208557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208560">Skip</span><span class="op" id="6208564">(</span><span class="ident" id="6208565">args</span>&nbsp;<span class="op" id="6208570">...</span><span class="keyword" id="6208573">interface</span><span class="op" id="6208582">{</span><span class="op" id="6208583">}</span><span class="op" id="6208584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208587">SkipNow</span><span class="op" id="6208594">(</span><span class="op" id="6208595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208598">Skipf</span><span class="op" id="6208603">(</span><span class="ident" id="6208604">format</span>&nbsp;<span class="builtintype" id="6208611">string</span><span class="op" id="6208617">,</span>&nbsp;<span class="ident" id="6208619">args</span>&nbsp;<span class="op" id="6208624">...</span><span class="keyword" id="6208627">interface</span><span class="op" id="6208636">{</span><span class="op" id="6208637">}</span><span class="op" id="6208638">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208641">Skipped</span><span class="op" id="6208648">(</span><span class="op" id="6208649">)</span>&nbsp;<span class="builtintype" id="6208651">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6208658">//&nbsp;A&nbsp;private&nbsp;method&nbsp;to&nbsp;prevent&nbsp;users&nbsp;implementing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6208713">//&nbsp;interface&nbsp;and&nbsp;so&nbsp;future&nbsp;additions&nbsp;to&nbsp;it&nbsp;will&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6208766">//&nbsp;violate&nbsp;Go&nbsp;1&nbsp;compatibility.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208798">private</span><span class="op" id="6208805">(</span><span class="op" id="6208806">)</span><br>
<span class="lineno"></span><span class="op" id="6208808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6208811">var</span>&nbsp;<span class="ident" id="6208815">_</span>&nbsp;<span class="ident" id="6208817">TB</span>&nbsp;<span class="op" id="6208820">=</span>&nbsp;<span class="op" id="6208822">(</span><span class="op" id="6208823">*</span><span class="ident" id="6208824">T</span><span class="op" id="6208825">)</span><span class="op" id="6208826">(</span><span class="ident" id="6208827">nil</span><span class="op" id="6208830">)</span><br>
<span class="lineno"></span><span class="keyword" id="6208832">var</span>&nbsp;<span class="ident" id="6208836">_</span>&nbsp;<span class="ident" id="6208838">TB</span>&nbsp;<span class="op" id="6208841">=</span>&nbsp;<span class="op" id="6208843">(</span><span class="op" id="6208844">*</span><span class="ident" id="6208845">B</span><span class="op" id="6208846">)</span><span class="op" id="6208847">(</span><span class="ident" id="6208848">nil</span><span class="op" id="6208851">)</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="6208854">//&nbsp;T&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Test&nbsp;functions&nbsp;to&nbsp;manage&nbsp;test&nbsp;state&nbsp;and&nbsp;support&nbsp;formatted&nbsp;test&nbsp;logs.</span><br>
<span class="lineno"></span><span class="comment" id="6208948">//&nbsp;Logs&nbsp;are&nbsp;accumulated&nbsp;during&nbsp;execution&nbsp;and&nbsp;dumped&nbsp;to&nbsp;standard&nbsp;error&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="6209029">type</span>&nbsp;<span class="ident" id="6209034">T</span>&nbsp;<span class="keyword" id="6209036">struct</span>&nbsp;<span class="op" id="6209043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209046">common</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209054">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6209068">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6209078">//&nbsp;Name&nbsp;of&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209096">startParallel</span>&nbsp;<span class="keyword" id="6209110">chan</span>&nbsp;<span class="builtintype" id="6209115">bool</span>&nbsp;<span class="comment" id="6209120">//&nbsp;Parallel&nbsp;tests&nbsp;will&nbsp;wait&nbsp;on&nbsp;this.</span><br>
<span class="lineno"></span><span class="op" id="6209157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6209160">func</span>&nbsp;<span class="op" id="6209165">(</span><span class="ident" id="6209166">c</span>&nbsp;<span class="op" id="6209168">*</span><span class="ident" id="6209169">common</span><span class="op" id="6209175">)</span>&nbsp;<span class="ident" id="6209177">private</span><span class="op" id="6209184">(</span><span class="op" id="6209185">)</span>&nbsp;<span class="op" id="6209187">{</span><span class="op" id="6209188">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="6209191">//&nbsp;Fail&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;but&nbsp;continues&nbsp;execution.</span><br>
<span class="lineno"></span><span class="keyword" id="6209260">func</span>&nbsp;<span class="op" id="6209265">(</span><span class="ident" id="6209266">c</span>&nbsp;<span class="op" id="6209268">*</span><span class="ident" id="6209269">common</span><span class="op" id="6209275">)</span>&nbsp;<span class="ident" id="6209277">Fail</span><span class="op" id="6209281">(</span><span class="op" id="6209282">)</span>&nbsp;<span class="op" id="6209284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209287">c</span><span class="op" id="6209288">.</span><span class="ident" id="6209289">mu</span><span class="op" id="6209291">.</span><span class="ident" id="6209292">Lock</span><span class="op" id="6209296">(</span><span class="op" id="6209297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209300">defer</span>&nbsp;<span class="ident" id="6209306">c</span><span class="op" id="6209307">.</span><span class="ident" id="6209308">mu</span><span class="op" id="6209310">.</span><span class="ident" id="6209311">Unlock</span><span class="op" id="6209317">(</span><span class="op" id="6209318">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209321">c</span><span class="op" id="6209322">.</span><span class="ident" id="6209323">failed</span>&nbsp;<span class="op" id="6209330">=</span>&nbsp;<span class="builtintype" id="6209332">true</span><br>
<span class="lineno"></span><span class="op" id="6209337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6209340">//&nbsp;Failed&nbsp;reports&nbsp;whether&nbsp;the&nbsp;function&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="6209391">func</span>&nbsp;<span class="op" id="6209396">(</span><span class="ident" id="6209397">c</span>&nbsp;<span class="op" id="6209399">*</span><span class="ident" id="6209400">common</span><span class="op" id="6209406">)</span>&nbsp;<span class="ident" id="6209408">Failed</span><span class="op" id="6209414">(</span><span class="op" id="6209415">)</span>&nbsp;<span class="builtintype" id="6209417">bool</span>&nbsp;<span class="op" id="6209422">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209425">c</span><span class="op" id="6209426">.</span><span class="ident" id="6209427">mu</span><span class="op" id="6209429">.</span><span class="ident" id="6209430">RLock</span><span class="op" id="6209435">(</span><span class="op" id="6209436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209439">defer</span>&nbsp;<span class="ident" id="6209445">c</span><span class="op" id="6209446">.</span><span class="ident" id="6209447">mu</span><span class="op" id="6209449">.</span><span class="ident" id="6209450">RUnlock</span><span class="op" id="6209457">(</span><span class="op" id="6209458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209461">return</span>&nbsp;<span class="ident" id="6209468">c</span><span class="op" id="6209469">.</span><span class="ident" id="6209470">failed</span><br>
<span class="lineno"></span><span class="op" id="6209477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="6209480">//&nbsp;FailNow&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="6209552">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span><span class="comment" id="6209610">//&nbsp;FailNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6209667">//&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;function,&nbsp;not&nbsp;from&nbsp;other&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="6209724">//&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;FailNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno">305</span><span class="comment" id="6209782">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="6209809">func</span>&nbsp;<span class="op" id="6209814">(</span><span class="ident" id="6209815">c</span>&nbsp;<span class="op" id="6209817">*</span><span class="ident" id="6209818">common</span><span class="op" id="6209824">)</span>&nbsp;<span class="ident" id="6209826">FailNow</span><span class="op" id="6209833">(</span><span class="op" id="6209834">)</span>&nbsp;<span class="op" id="6209836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209839">c</span><span class="op" id="6209840">.</span><span class="ident" id="6209841">Fail</span><span class="op" id="6209845">(</span><span class="op" id="6209846">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6209850">//&nbsp;Calling&nbsp;runtime.Goexit&nbsp;will&nbsp;exit&nbsp;the&nbsp;goroutine,&nbsp;which</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6209908">//&nbsp;will&nbsp;run&nbsp;the&nbsp;deferred&nbsp;functions&nbsp;in&nbsp;this&nbsp;goroutine,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6209963">//&nbsp;which&nbsp;will&nbsp;eventually&nbsp;run&nbsp;the&nbsp;deferred&nbsp;lines&nbsp;in&nbsp;tRunner,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210024">//&nbsp;which&nbsp;will&nbsp;signal&nbsp;to&nbsp;the&nbsp;test&nbsp;loop&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210087">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210091">//&nbsp;A&nbsp;previous&nbsp;version&nbsp;of&nbsp;this&nbsp;code&nbsp;said:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210133">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210137">//&nbsp;&nbsp;&nbsp;&nbspc.duration&nbsp;=&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210158">//&nbsp;&nbsp;&nbsp;&nbspc.signal&nbsp;&lt;-&nbsp;c.self</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210181">//&nbsp;&nbsp;&nbsp;&nbspruntime.Goexit()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210202">//</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210206">//&nbsp;This&nbsp;previous&nbsp;version&nbsp;duplicated&nbsp;code&nbsp;(those&nbsp;lines&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210268">//&nbsp;tRunner&nbsp;no&nbsp;matter&nbsp;what),&nbsp;but&nbsp;worse&nbsp;the&nbsp;goroutine&nbsp;teardown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210330">//&nbsp;implicit&nbsp;in&nbsp;runtime.Goexit&nbsp;was&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210392">//&nbsp;before&nbsp;the&nbsp;test&nbsp;exited.&nbsp;&nbsp;If&nbsp;a&nbsp;test&nbsp;deferred&nbsp;an&nbsp;important&nbsp;cleanup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210461">//&nbsp;function&nbsp;(like&nbsp;removing&nbsp;temporary&nbsp;files),&nbsp;there&nbsp;was&nbsp;no&nbsp;guarantee</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210530">//&nbsp;it&nbsp;would&nbsp;run&nbsp;on&nbsp;a&nbsp;test&nbsp;failure.&nbsp;&nbsp;Because&nbsp;we&nbsp;send&nbsp;on&nbsp;c.signal&nbsp;during</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210602">//&nbsp;a&nbsp;top-of-stack&nbsp;deferred&nbsp;function&nbsp;now,&nbsp;we&nbsp;know&nbsp;that&nbsp;the&nbsp;send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210666">//&nbsp;only&nbsp;happens&nbsp;after&nbsp;any&nbsp;other&nbsp;stacked&nbsp;defers&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210730">c</span><span class="op" id="6210731">.</span><span class="ident" id="6210732">finished</span>&nbsp;<span class="op" id="6210741">=</span>&nbsp;<span class="builtintype" id="6210743">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210749">runtime</span><span class="op" id="6210756">.</span><span class="ident" id="6210757">Goexit</span><span class="op" id="6210763">(</span><span class="op" id="6210764">)</span><br>
<span class="lineno">330</span><span class="op" id="6210766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6210769">//&nbsp;log&nbsp;generates&nbsp;the&nbsp;output.&nbsp;It&#39;s&nbsp;always&nbsp;at&nbsp;the&nbsp;same&nbsp;stack&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="6210835">func</span>&nbsp;<span class="op" id="6210840">(</span><span class="ident" id="6210841">c</span>&nbsp;<span class="op" id="6210843">*</span><span class="ident" id="6210844">common</span><span class="op" id="6210850">)</span>&nbsp;<span class="ident" id="6210852">log</span><span class="op" id="6210855">(</span><span class="ident" id="6210856">s</span>&nbsp;<span class="builtintype" id="6210858">string</span><span class="op" id="6210864">)</span>&nbsp;<span class="op" id="6210866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210869">c</span><span class="op" id="6210870">.</span><span class="ident" id="6210871">mu</span><span class="op" id="6210873">.</span><span class="ident" id="6210874">Lock</span><span class="op" id="6210878">(</span><span class="op" id="6210879">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210882">defer</span>&nbsp;<span class="ident" id="6210888">c</span><span class="op" id="6210889">.</span><span class="ident" id="6210890">mu</span><span class="op" id="6210892">.</span><span class="ident" id="6210893">Unlock</span><span class="op" id="6210899">(</span><span class="op" id="6210900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210903">c</span><span class="op" id="6210904">.</span><span class="ident" id="6210905">output</span>&nbsp;<span class="op" id="6210912">=</span>&nbsp;<span class="builtinfunc" id="6210914">append</span><span class="op" id="6210920">(</span><span class="ident" id="6210921">c</span><span class="op" id="6210922">.</span><span class="ident" id="6210923">output</span><span class="op" id="6210929">,</span>&nbsp;<span class="ident" id="6210931">decorate</span><span class="op" id="6210939">(</span><span class="ident" id="6210940">s</span><span class="op" id="6210941">)</span><span class="op" id="6210942">...</span><span class="op" id="6210945">)</span><br>
<span class="lineno"></span><span class="op" id="6210947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6210950">//&nbsp;Log&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;using&nbsp;default&nbsp;formatting,&nbsp;analogous&nbsp;to&nbsp;Println,</span><br>
<span class="lineno">340</span><span class="comment" id="6211027">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6211102">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6211148">func</span>&nbsp;<span class="op" id="6211153">(</span><span class="ident" id="6211154">c</span>&nbsp;<span class="op" id="6211156">*</span><span class="ident" id="6211157">common</span><span class="op" id="6211163">)</span>&nbsp;<span class="ident" id="6211165">Log</span><span class="op" id="6211168">(</span><span class="ident" id="6211169">args</span>&nbsp;<span class="op" id="6211174">...</span><span class="keyword" id="6211177">interface</span><span class="op" id="6211186">{</span><span class="op" id="6211187">}</span><span class="op" id="6211188">)</span>&nbsp;<span class="op" id="6211190">{</span>&nbsp;<span class="ident" id="6211192">c</span><span class="op" id="6211193">.</span><span class="ident" id="6211194">log</span><span class="op" id="6211197">(</span><span class="ident" id="6211198">fmt</span><span class="op" id="6211201">.</span><span class="ident" id="6211202">Sprintln</span><span class="op" id="6211210">(</span><span class="ident" id="6211211">args</span><span class="op" id="6211215">...</span><span class="op" id="6211218">)</span><span class="op" id="6211219">)</span>&nbsp;<span class="op" id="6211221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6211224">//&nbsp;Logf&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;according&nbsp;to&nbsp;the&nbsp;format,&nbsp;analogous&nbsp;to&nbsp;Printf,</span><br>
<span class="lineno">345</span><span class="comment" id="6211300">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6211375">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6211421">func</span>&nbsp;<span class="op" id="6211426">(</span><span class="ident" id="6211427">c</span>&nbsp;<span class="op" id="6211429">*</span><span class="ident" id="6211430">common</span><span class="op" id="6211436">)</span>&nbsp;<span class="ident" id="6211438">Logf</span><span class="op" id="6211442">(</span><span class="ident" id="6211443">format</span>&nbsp;<span class="builtintype" id="6211450">string</span><span class="op" id="6211456">,</span>&nbsp;<span class="ident" id="6211458">args</span>&nbsp;<span class="op" id="6211463">...</span><span class="keyword" id="6211466">interface</span><span class="op" id="6211475">{</span><span class="op" id="6211476">}</span><span class="op" id="6211477">)</span>&nbsp;<span class="op" id="6211479">{</span>&nbsp;<span class="ident" id="6211481">c</span><span class="op" id="6211482">.</span><span class="ident" id="6211483">log</span><span class="op" id="6211486">(</span><span class="ident" id="6211487">fmt</span><span class="op" id="6211490">.</span><span class="ident" id="6211491">Sprintf</span><span class="op" id="6211498">(</span><span class="ident" id="6211499">format</span><span class="op" id="6211505">,</span>&nbsp;<span class="ident" id="6211507">args</span><span class="op" id="6211511">...</span><span class="op" id="6211514">)</span><span class="op" id="6211515">)</span>&nbsp;<span class="op" id="6211517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6211520">//&nbsp;Error&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno">350</span><span class="keyword" id="6211568">func</span>&nbsp;<span class="op" id="6211573">(</span><span class="ident" id="6211574">c</span>&nbsp;<span class="op" id="6211576">*</span><span class="ident" id="6211577">common</span><span class="op" id="6211583">)</span>&nbsp;<span class="ident" id="6211585">Error</span><span class="op" id="6211590">(</span><span class="ident" id="6211591">args</span>&nbsp;<span class="op" id="6211596">...</span><span class="keyword" id="6211599">interface</span><span class="op" id="6211608">{</span><span class="op" id="6211609">}</span><span class="op" id="6211610">)</span>&nbsp;<span class="op" id="6211612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211615">c</span><span class="op" id="6211616">.</span><span class="ident" id="6211617">log</span><span class="op" id="6211620">(</span><span class="ident" id="6211621">fmt</span><span class="op" id="6211624">.</span><span class="ident" id="6211625">Sprintln</span><span class="op" id="6211633">(</span><span class="ident" id="6211634">args</span><span class="op" id="6211638">...</span><span class="op" id="6211641">)</span><span class="op" id="6211642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211645">c</span><span class="op" id="6211646">.</span><span class="ident" id="6211647">Fail</span><span class="op" id="6211651">(</span><span class="op" id="6211652">)</span><br>
<span class="lineno"></span><span class="op" id="6211654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="6211657">//&nbsp;Errorf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno"></span><span class="keyword" id="6211707">func</span>&nbsp;<span class="op" id="6211712">(</span><span class="ident" id="6211713">c</span>&nbsp;<span class="op" id="6211715">*</span><span class="ident" id="6211716">common</span><span class="op" id="6211722">)</span>&nbsp;<span class="ident" id="6211724">Errorf</span><span class="op" id="6211730">(</span><span class="ident" id="6211731">format</span>&nbsp;<span class="builtintype" id="6211738">string</span><span class="op" id="6211744">,</span>&nbsp;<span class="ident" id="6211746">args</span>&nbsp;<span class="op" id="6211751">...</span><span class="keyword" id="6211754">interface</span><span class="op" id="6211763">{</span><span class="op" id="6211764">}</span><span class="op" id="6211765">)</span>&nbsp;<span class="op" id="6211767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211770">c</span><span class="op" id="6211771">.</span><span class="ident" id="6211772">log</span><span class="op" id="6211775">(</span><span class="ident" id="6211776">fmt</span><span class="op" id="6211779">.</span><span class="ident" id="6211780">Sprintf</span><span class="op" id="6211787">(</span><span class="ident" id="6211788">format</span><span class="op" id="6211794">,</span>&nbsp;<span class="ident" id="6211796">args</span><span class="op" id="6211800">...</span><span class="op" id="6211803">)</span><span class="op" id="6211804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211807">c</span><span class="op" id="6211808">.</span><span class="ident" id="6211809">Fail</span><span class="op" id="6211813">(</span><span class="op" id="6211814">)</span><br>
<span class="lineno"></span><span class="op" id="6211816">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="6211819">//&nbsp;Fatal&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6211870">func</span>&nbsp;<span class="op" id="6211875">(</span><span class="ident" id="6211876">c</span>&nbsp;<span class="op" id="6211878">*</span><span class="ident" id="6211879">common</span><span class="op" id="6211885">)</span>&nbsp;<span class="ident" id="6211887">Fatal</span><span class="op" id="6211892">(</span><span class="ident" id="6211893">args</span>&nbsp;<span class="op" id="6211898">...</span><span class="keyword" id="6211901">interface</span><span class="op" id="6211910">{</span><span class="op" id="6211911">}</span><span class="op" id="6211912">)</span>&nbsp;<span class="op" id="6211914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211917">c</span><span class="op" id="6211918">.</span><span class="ident" id="6211919">log</span><span class="op" id="6211922">(</span><span class="ident" id="6211923">fmt</span><span class="op" id="6211926">.</span><span class="ident" id="6211927">Sprintln</span><span class="op" id="6211935">(</span><span class="ident" id="6211936">args</span><span class="op" id="6211940">...</span><span class="op" id="6211943">)</span><span class="op" id="6211944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211947">c</span><span class="op" id="6211948">.</span><span class="ident" id="6211949">FailNow</span><span class="op" id="6211956">(</span><span class="op" id="6211957">)</span><br>
<span class="lineno">365</span><span class="op" id="6211959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6211962">//&nbsp;Fatalf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6212015">func</span>&nbsp;<span class="op" id="6212020">(</span><span class="ident" id="6212021">c</span>&nbsp;<span class="op" id="6212023">*</span><span class="ident" id="6212024">common</span><span class="op" id="6212030">)</span>&nbsp;<span class="ident" id="6212032">Fatalf</span><span class="op" id="6212038">(</span><span class="ident" id="6212039">format</span>&nbsp;<span class="builtintype" id="6212046">string</span><span class="op" id="6212052">,</span>&nbsp;<span class="ident" id="6212054">args</span>&nbsp;<span class="op" id="6212059">...</span><span class="keyword" id="6212062">interface</span><span class="op" id="6212071">{</span><span class="op" id="6212072">}</span><span class="op" id="6212073">)</span>&nbsp;<span class="op" id="6212075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212078">c</span><span class="op" id="6212079">.</span><span class="ident" id="6212080">log</span><span class="op" id="6212083">(</span><span class="ident" id="6212084">fmt</span><span class="op" id="6212087">.</span><span class="ident" id="6212088">Sprintf</span><span class="op" id="6212095">(</span><span class="ident" id="6212096">format</span><span class="op" id="6212102">,</span>&nbsp;<span class="ident" id="6212104">args</span><span class="op" id="6212108">...</span><span class="op" id="6212111">)</span><span class="op" id="6212112">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212115">c</span><span class="op" id="6212116">.</span><span class="ident" id="6212117">FailNow</span><span class="op" id="6212124">(</span><span class="op" id="6212125">)</span><br>
<span class="lineno"></span><span class="op" id="6212127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6212130">//&nbsp;Skip&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6212180">func</span>&nbsp;<span class="op" id="6212185">(</span><span class="ident" id="6212186">c</span>&nbsp;<span class="op" id="6212188">*</span><span class="ident" id="6212189">common</span><span class="op" id="6212195">)</span>&nbsp;<span class="ident" id="6212197">Skip</span><span class="op" id="6212201">(</span><span class="ident" id="6212202">args</span>&nbsp;<span class="op" id="6212207">...</span><span class="keyword" id="6212210">interface</span><span class="op" id="6212219">{</span><span class="op" id="6212220">}</span><span class="op" id="6212221">)</span>&nbsp;<span class="op" id="6212223">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212226">c</span><span class="op" id="6212227">.</span><span class="ident" id="6212228">log</span><span class="op" id="6212231">(</span><span class="ident" id="6212232">fmt</span><span class="op" id="6212235">.</span><span class="ident" id="6212236">Sprintln</span><span class="op" id="6212244">(</span><span class="ident" id="6212245">args</span><span class="op" id="6212249">...</span><span class="op" id="6212252">)</span><span class="op" id="6212253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212256">c</span><span class="op" id="6212257">.</span><span class="ident" id="6212258">SkipNow</span><span class="op" id="6212265">(</span><span class="op" id="6212266">)</span><br>
<span class="lineno"></span><span class="op" id="6212268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6212271">//&nbsp;Skipf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno">380</span><span class="keyword" id="6212323">func</span>&nbsp;<span class="op" id="6212328">(</span><span class="ident" id="6212329">c</span>&nbsp;<span class="op" id="6212331">*</span><span class="ident" id="6212332">common</span><span class="op" id="6212338">)</span>&nbsp;<span class="ident" id="6212340">Skipf</span><span class="op" id="6212345">(</span><span class="ident" id="6212346">format</span>&nbsp;<span class="builtintype" id="6212353">string</span><span class="op" id="6212359">,</span>&nbsp;<span class="ident" id="6212361">args</span>&nbsp;<span class="op" id="6212366">...</span><span class="keyword" id="6212369">interface</span><span class="op" id="6212378">{</span><span class="op" id="6212379">}</span><span class="op" id="6212380">)</span>&nbsp;<span class="op" id="6212382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212385">c</span><span class="op" id="6212386">.</span><span class="ident" id="6212387">log</span><span class="op" id="6212390">(</span><span class="ident" id="6212391">fmt</span><span class="op" id="6212394">.</span><span class="ident" id="6212395">Sprintf</span><span class="op" id="6212402">(</span><span class="ident" id="6212403">format</span><span class="op" id="6212409">,</span>&nbsp;<span class="ident" id="6212411">args</span><span class="op" id="6212415">...</span><span class="op" id="6212418">)</span><span class="op" id="6212419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212422">c</span><span class="op" id="6212423">.</span><span class="ident" id="6212424">SkipNow</span><span class="op" id="6212431">(</span><span class="op" id="6212432">)</span><br>
<span class="lineno"></span><span class="op" id="6212434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="6212437">//&nbsp;SkipNow&nbsp;marks&nbsp;the&nbsp;test&nbsp;as&nbsp;having&nbsp;been&nbsp;skipped&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="6212511">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.&nbsp;See&nbsp;also&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="comment" id="6212587">//&nbsp;SkipNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the&nbsp;test,&nbsp;not&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="6212659">//&nbsp;other&nbsp;goroutines&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;SkipNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno"></span><span class="comment" id="6212734">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno">390</span><span class="keyword" id="6212761">func</span>&nbsp;<span class="op" id="6212766">(</span><span class="ident" id="6212767">c</span>&nbsp;<span class="op" id="6212769">*</span><span class="ident" id="6212770">common</span><span class="op" id="6212776">)</span>&nbsp;<span class="ident" id="6212778">SkipNow</span><span class="op" id="6212785">(</span><span class="op" id="6212786">)</span>&nbsp;<span class="op" id="6212788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212791">c</span><span class="op" id="6212792">.</span><span class="ident" id="6212793">skip</span><span class="op" id="6212797">(</span><span class="op" id="6212798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212801">c</span><span class="op" id="6212802">.</span><span class="ident" id="6212803">finished</span>&nbsp;<span class="op" id="6212812">=</span>&nbsp;<span class="builtintype" id="6212814">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212820">runtime</span><span class="op" id="6212827">.</span><span class="ident" id="6212828">Goexit</span><span class="op" id="6212834">(</span><span class="op" id="6212835">)</span><br>
<span class="lineno"></span><span class="op" id="6212837">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="6212840">func</span>&nbsp;<span class="op" id="6212845">(</span><span class="ident" id="6212846">c</span>&nbsp;<span class="op" id="6212848">*</span><span class="ident" id="6212849">common</span><span class="op" id="6212855">)</span>&nbsp;<span class="ident" id="6212857">skip</span><span class="op" id="6212861">(</span><span class="op" id="6212862">)</span>&nbsp;<span class="op" id="6212864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212867">c</span><span class="op" id="6212868">.</span><span class="ident" id="6212869">mu</span><span class="op" id="6212871">.</span><span class="ident" id="6212872">Lock</span><span class="op" id="6212876">(</span><span class="op" id="6212877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212880">defer</span>&nbsp;<span class="ident" id="6212886">c</span><span class="op" id="6212887">.</span><span class="ident" id="6212888">mu</span><span class="op" id="6212890">.</span><span class="ident" id="6212891">Unlock</span><span class="op" id="6212897">(</span><span class="op" id="6212898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212901">c</span><span class="op" id="6212902">.</span><span class="ident" id="6212903">skipped</span>&nbsp;<span class="op" id="6212911">=</span>&nbsp;<span class="builtintype" id="6212913">true</span><br>
<span class="lineno">400</span><span class="op" id="6212918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6212921">//&nbsp;Skipped&nbsp;reports&nbsp;whether&nbsp;the&nbsp;test&nbsp;was&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="6212970">func</span>&nbsp;<span class="op" id="6212975">(</span><span class="ident" id="6212976">c</span>&nbsp;<span class="op" id="6212978">*</span><span class="ident" id="6212979">common</span><span class="op" id="6212985">)</span>&nbsp;<span class="ident" id="6212987">Skipped</span><span class="op" id="6212994">(</span><span class="op" id="6212995">)</span>&nbsp;<span class="builtintype" id="6212997">bool</span>&nbsp;<span class="op" id="6213002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213005">c</span><span class="op" id="6213006">.</span><span class="ident" id="6213007">mu</span><span class="op" id="6213009">.</span><span class="ident" id="6213010">RLock</span><span class="op" id="6213015">(</span><span class="op" id="6213016">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213019">defer</span>&nbsp;<span class="ident" id="6213025">c</span><span class="op" id="6213026">.</span><span class="ident" id="6213027">mu</span><span class="op" id="6213029">.</span><span class="ident" id="6213030">RUnlock</span><span class="op" id="6213037">(</span><span class="op" id="6213038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213041">return</span>&nbsp;<span class="ident" id="6213048">c</span><span class="op" id="6213049">.</span><span class="ident" id="6213050">skipped</span><br>
<span class="lineno"></span><span class="op" id="6213058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6213061">//&nbsp;Parallel&nbsp;signals&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;to&nbsp;be&nbsp;run&nbsp;in&nbsp;parallel&nbsp;with&nbsp;(and&nbsp;only&nbsp;with)</span><br>
<span class="lineno">410</span><span class="comment" id="6213142">//&nbsp;other&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="6213167">func</span>&nbsp;<span class="op" id="6213172">(</span><span class="ident" id="6213173">t</span>&nbsp;<span class="op" id="6213175">*</span><span class="ident" id="6213176">T</span><span class="op" id="6213177">)</span>&nbsp;<span class="ident" id="6213179">Parallel</span><span class="op" id="6213187">(</span><span class="op" id="6213188">)</span>&nbsp;<span class="op" id="6213190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213193">t</span><span class="op" id="6213194">.</span><span class="ident" id="6213195">signal</span>&nbsp;<span class="op" id="6213202">&lt;-</span>&nbsp;<span class="op" id="6213205">(</span><span class="op" id="6213206">*</span><span class="ident" id="6213207">T</span><span class="op" id="6213208">)</span><span class="op" id="6213209">(</span><span class="ident" id="6213210">nil</span><span class="op" id="6213213">)</span>&nbsp;<span class="comment" id="6213215">//&nbsp;Release&nbsp;main&nbsp;testing&nbsp;loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213245">&lt;-</span><span class="ident" id="6213247">t</span><span class="op" id="6213248">.</span><span class="ident" id="6213249">startParallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6213267">//&nbsp;Wait&nbsp;for&nbsp;serial&nbsp;tests&nbsp;to&nbsp;finish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213303">//&nbsp;Assuming&nbsp;Parallel&nbsp;is&nbsp;the&nbsp;first&nbsp;thing&nbsp;a&nbsp;test&nbsp;does,&nbsp;which&nbsp;is&nbsp;reasonable,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213378">//&nbsp;reinitialize&nbsp;the&nbsp;test&#39;s&nbsp;start&nbsp;time&nbsp;because&nbsp;it&#39;s&nbsp;actually&nbsp;starting&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213453">t</span><span class="op" id="6213454">.</span><span class="ident" id="6213455">start</span>&nbsp;<span class="op" id="6213461">=</span>&nbsp;<span class="ident" id="6213463">time</span><span class="op" id="6213467">.</span><span class="ident" id="6213468">Now</span><span class="op" id="6213471">(</span><span class="op" id="6213472">)</span><br>
<span class="lineno"></span><span class="op" id="6213474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6213477">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno">420</span><span class="comment" id="6213566">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6213595">type</span>&nbsp;<span class="ident" id="6213600">InternalTest</span>&nbsp;<span class="keyword" id="6213613">struct</span>&nbsp;<span class="op" id="6213620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213623">Name</span>&nbsp;<span class="builtintype" id="6213628">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213636">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6213641">func</span><span class="op" id="6213645">(</span><span class="op" id="6213646">*</span><span class="ident" id="6213647">T</span><span class="op" id="6213648">)</span><br>
<span class="lineno"></span><span class="op" id="6213650">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="6213653">func</span>&nbsp;<span class="ident" id="6213658">tRunner</span><span class="op" id="6213665">(</span><span class="ident" id="6213666">t</span>&nbsp;<span class="op" id="6213668">*</span><span class="ident" id="6213669">T</span><span class="op" id="6213670">,</span>&nbsp;<span class="ident" id="6213672">test</span>&nbsp;<span class="op" id="6213677">*</span><span class="ident" id="6213678">InternalTest</span><span class="op" id="6213690">)</span>&nbsp;<span class="op" id="6213692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213695">//&nbsp;When&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;done,&nbsp;either&nbsp;because&nbsp;test.F(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213753">//&nbsp;returned&nbsp;normally&nbsp;or&nbsp;because&nbsp;a&nbsp;test&nbsp;failure&nbsp;triggered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213811">//&nbsp;a&nbsp;call&nbsp;to&nbsp;runtime.Goexit,&nbsp;record&nbsp;the&nbsp;duration&nbsp;and&nbsp;send</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213870">//&nbsp;a&nbsp;signal&nbsp;saying&nbsp;that&nbsp;the&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213913">defer</span>&nbsp;<span class="keyword" id="6213919">func</span><span class="op" id="6213923">(</span><span class="op" id="6213924">)</span>&nbsp;<span class="op" id="6213926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213930">t</span><span class="op" id="6213931">.</span><span class="ident" id="6213932">duration</span>&nbsp;<span class="op" id="6213941">=</span>&nbsp;<span class="ident" id="6213943">time</span><span class="op" id="6213947">.</span><span class="ident" id="6213948">Now</span><span class="op" id="6213951">(</span><span class="op" id="6213952">)</span><span class="op" id="6213953">.</span><span class="ident" id="6213954">Sub</span><span class="op" id="6213957">(</span><span class="ident" id="6213958">t</span><span class="op" id="6213959">.</span><span class="ident" id="6213960">start</span><span class="op" id="6213965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213969">//&nbsp;If&nbsp;the&nbsp;test&nbsp;panicked,&nbsp;print&nbsp;any&nbsp;test&nbsp;output&nbsp;before&nbsp;dying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214032">err</span>&nbsp;<span class="op" id="6214036">:=</span>&nbsp;<span class="builtinfunc" id="6214039">recover</span><span class="op" id="6214046">(</span><span class="op" id="6214047">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214051">if</span>&nbsp;<span class="op" id="6214054">!</span><span class="ident" id="6214055">t</span><span class="op" id="6214056">.</span><span class="ident" id="6214057">finished</span>&nbsp;<span class="op" id="6214066">&amp;&amp;</span>&nbsp;<span class="ident" id="6214069">err</span>&nbsp;<span class="op" id="6214073">==</span>&nbsp;<span class="ident" id="6214076">nil</span>&nbsp;<span class="op" id="6214080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214085">err</span>&nbsp;<span class="op" id="6214089">=</span>&nbsp;<span class="ident" id="6214091">fmt</span><span class="op" id="6214094">.</span><span class="ident" id="6214095">Errorf</span><span class="op" id="6214101">(</span><span class="string" id="6214102">&#34;test&nbsp;executed&nbsp;panic(nil)&nbsp;or&nbsp;runtime.Goexit&#34;</span><span class="op" id="6214146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6214150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214154">if</span>&nbsp;<span class="ident" id="6214157">err</span>&nbsp;<span class="op" id="6214161">!=</span>&nbsp;<span class="ident" id="6214164">nil</span>&nbsp;<span class="op" id="6214168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214173">t</span><span class="op" id="6214174">.</span><span class="ident" id="6214175">Fail</span><span class="op" id="6214179">(</span><span class="op" id="6214180">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214185">t</span><span class="op" id="6214186">.</span><span class="ident" id="6214187">report</span><span class="op" id="6214193">(</span><span class="op" id="6214194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6214199">panic</span><span class="op" id="6214204">(</span><span class="ident" id="6214205">err</span><span class="op" id="6214208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6214212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214216">t</span><span class="op" id="6214217">.</span><span class="ident" id="6214218">signal</span>&nbsp;<span class="op" id="6214225">&lt;-</span>&nbsp;<span class="ident" id="6214228">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6214231">}</span><span class="op" id="6214232">(</span><span class="op" id="6214233">)</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214237">t</span><span class="op" id="6214238">.</span><span class="ident" id="6214239">start</span>&nbsp;<span class="op" id="6214245">=</span>&nbsp;<span class="ident" id="6214247">time</span><span class="op" id="6214251">.</span><span class="ident" id="6214252">Now</span><span class="op" id="6214255">(</span><span class="op" id="6214256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214259">test</span><span class="op" id="6214263">.</span><span class="ident" id="6214264">F</span><span class="op" id="6214265">(</span><span class="ident" id="6214266">t</span><span class="op" id="6214267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214270">t</span><span class="op" id="6214271">.</span><span class="ident" id="6214272">finished</span>&nbsp;<span class="op" id="6214281">=</span>&nbsp;<span class="builtintype" id="6214283">true</span><br>
<span class="lineno"></span><span class="op" id="6214288">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="comment" id="6214291">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6214384">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6214413">func</span>&nbsp;<span class="ident" id="6214418">Main</span><span class="op" id="6214422">(</span><span class="ident" id="6214423">matchString</span>&nbsp;<span class="keyword" id="6214435">func</span><span class="op" id="6214439">(</span><span class="ident" id="6214440">pat</span><span class="op" id="6214443">,</span>&nbsp;<span class="ident" id="6214445">str</span>&nbsp;<span class="builtintype" id="6214449">string</span><span class="op" id="6214455">)</span>&nbsp;<span class="op" id="6214457">(</span><span class="builtintype" id="6214458">bool</span><span class="op" id="6214462">,</span>&nbsp;<span class="builtintype" id="6214464">error</span><span class="op" id="6214469">)</span><span class="op" id="6214470">,</span>&nbsp;<span class="ident" id="6214472">tests</span>&nbsp;<span class="op" id="6214478">[</span><span class="op" id="6214479">]</span><span class="ident" id="6214480">InternalTest</span><span class="op" id="6214492">,</span>&nbsp;<span class="ident" id="6214494">benchmarks</span>&nbsp;<span class="op" id="6214505">[</span><span class="op" id="6214506">]</span><span class="ident" id="6214507">InternalBenchmark</span><span class="op" id="6214524">,</span>&nbsp;<span class="ident" id="6214526">examples</span>&nbsp;<span class="op" id="6214535">[</span><span class="op" id="6214536">]</span><span class="ident" id="6214537">InternalExample</span><span class="op" id="6214552">)</span>&nbsp;<span class="op" id="6214554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214557">os</span><span class="op" id="6214559">.</span><span class="ident" id="6214560">Exit</span><span class="op" id="6214564">(</span><span class="ident" id="6214565">MainStart</span><span class="op" id="6214574">(</span><span class="ident" id="6214575">matchString</span><span class="op" id="6214586">,</span>&nbsp;<span class="ident" id="6214588">tests</span><span class="op" id="6214593">,</span>&nbsp;<span class="ident" id="6214595">benchmarks</span><span class="op" id="6214605">,</span>&nbsp;<span class="ident" id="6214607">examples</span><span class="op" id="6214615">)</span><span class="op" id="6214616">.</span><span class="ident" id="6214617">Run</span><span class="op" id="6214620">(</span><span class="op" id="6214621">)</span><span class="op" id="6214622">)</span><br>
<span class="lineno">455</span><span class="op" id="6214624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6214627">//&nbsp;M&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;a&nbsp;TestMain&nbsp;function&nbsp;to&nbsp;run&nbsp;the&nbsp;actual&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="6214697">type</span>&nbsp;<span class="ident" id="6214702">M</span>&nbsp;<span class="keyword" id="6214704">struct</span>&nbsp;<span class="op" id="6214711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214714">matchString</span>&nbsp;<span class="keyword" id="6214726">func</span><span class="op" id="6214730">(</span><span class="ident" id="6214731">pat</span><span class="op" id="6214734">,</span>&nbsp;<span class="ident" id="6214736">str</span>&nbsp;<span class="builtintype" id="6214740">string</span><span class="op" id="6214746">)</span>&nbsp;<span class="op" id="6214748">(</span><span class="builtintype" id="6214749">bool</span><span class="op" id="6214753">,</span>&nbsp;<span class="builtintype" id="6214755">error</span><span class="op" id="6214760">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214763">tests</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6214775">[</span><span class="op" id="6214776">]</span><span class="ident" id="6214777">InternalTest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214791">benchmarks</span>&nbsp;&nbsp;<span class="op" id="6214803">[</span><span class="op" id="6214804">]</span><span class="ident" id="6214805">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214824">examples</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6214836">[</span><span class="op" id="6214837">]</span><span class="ident" id="6214838">InternalExample</span><br>
<span class="lineno"></span><span class="op" id="6214854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="comment" id="6214857">//&nbsp;MainStart&nbsp;is&nbsp;meant&nbsp;for&nbsp;use&nbsp;by&nbsp;tests&nbsp;generated&nbsp;by&nbsp;&#39;go&nbsp;test&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="6214920">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;called&nbsp;directly&nbsp;and&nbsp;is&nbsp;not&nbsp;subject&nbsp;to&nbsp;the&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;document.</span><br>
<span class="lineno"></span><span class="comment" id="6215016">//&nbsp;It&nbsp;may&nbsp;change&nbsp;signature&nbsp;from&nbsp;release&nbsp;to&nbsp;release.</span><br>
<span class="lineno"></span><span class="keyword" id="6215068">func</span>&nbsp;<span class="ident" id="6215073">MainStart</span><span class="op" id="6215082">(</span><span class="ident" id="6215083">matchString</span>&nbsp;<span class="keyword" id="6215095">func</span><span class="op" id="6215099">(</span><span class="ident" id="6215100">pat</span><span class="op" id="6215103">,</span>&nbsp;<span class="ident" id="6215105">str</span>&nbsp;<span class="builtintype" id="6215109">string</span><span class="op" id="6215115">)</span>&nbsp;<span class="op" id="6215117">(</span><span class="builtintype" id="6215118">bool</span><span class="op" id="6215122">,</span>&nbsp;<span class="builtintype" id="6215124">error</span><span class="op" id="6215129">)</span><span class="op" id="6215130">,</span>&nbsp;<span class="ident" id="6215132">tests</span>&nbsp;<span class="op" id="6215138">[</span><span class="op" id="6215139">]</span><span class="ident" id="6215140">InternalTest</span><span class="op" id="6215152">,</span>&nbsp;<span class="ident" id="6215154">benchmarks</span>&nbsp;<span class="op" id="6215165">[</span><span class="op" id="6215166">]</span><span class="ident" id="6215167">InternalBenchmark</span><span class="op" id="6215184">,</span>&nbsp;<span class="ident" id="6215186">examples</span>&nbsp;<span class="op" id="6215195">[</span><span class="op" id="6215196">]</span><span class="ident" id="6215197">InternalExample</span><span class="op" id="6215212">)</span>&nbsp;<span class="op" id="6215214">*</span><span class="ident" id="6215215">M</span>&nbsp;<span class="op" id="6215217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6215220">return</span>&nbsp;<span class="op" id="6215227">&amp;</span><span class="ident" id="6215228">M</span><span class="op" id="6215229">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215233">matchString</span><span class="op" id="6215244">:</span>&nbsp;<span class="ident" id="6215246">matchString</span><span class="op" id="6215257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215261">tests</span><span class="op" id="6215266">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6215274">tests</span><span class="op" id="6215279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215283">benchmarks</span><span class="op" id="6215293">:</span>&nbsp;&nbsp;<span class="ident" id="6215296">benchmarks</span><span class="op" id="6215306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215310">examples</span><span class="op" id="6215318">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6215323">examples</span><span class="op" id="6215331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6215334">}</span><br>
<span class="lineno">475</span><span class="op" id="6215336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6215339">//&nbsp;Run&nbsp;runs&nbsp;the&nbsp;tests.&nbsp;It&nbsp;returns&nbsp;an&nbsp;exit&nbsp;code&nbsp;to&nbsp;pass&nbsp;to&nbsp;os.Exit.</span><br>
<span class="lineno"></span><span class="keyword" id="6215406">func</span>&nbsp;<span class="op" id="6215411">(</span><span class="ident" id="6215412">m</span>&nbsp;<span class="op" id="6215414">*</span><span class="ident" id="6215415">M</span><span class="op" id="6215416">)</span>&nbsp;<span class="ident" id="6215418">Run</span><span class="op" id="6215421">(</span><span class="op" id="6215422">)</span>&nbsp;<span class="builtintype" id="6215424">int</span>&nbsp;<span class="op" id="6215428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215431">flag</span><span class="op" id="6215435">.</span><span class="ident" id="6215436">Parse</span><span class="op" id="6215441">(</span><span class="op" id="6215442">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215445">parseCpuList</span><span class="op" id="6215457">(</span><span class="op" id="6215458">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215462">before</span><span class="op" id="6215468">(</span><span class="op" id="6215469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215472">startAlarm</span><span class="op" id="6215482">(</span><span class="op" id="6215483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215486">haveExamples</span>&nbsp;<span class="op" id="6215499">=</span>&nbsp;<span class="builtinfunc" id="6215501">len</span><span class="op" id="6215504">(</span><span class="ident" id="6215505">m</span><span class="op" id="6215506">.</span><span class="ident" id="6215507">examples</span><span class="op" id="6215515">)</span>&nbsp;<span class="op" id="6215517">&gt;</span>&nbsp;<span class="num" id="6215519">0</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215522">testOk</span>&nbsp;<span class="op" id="6215529">:=</span>&nbsp;<span class="ident" id="6215532">RunTests</span><span class="op" id="6215540">(</span><span class="ident" id="6215541">m</span><span class="op" id="6215542">.</span><span class="ident" id="6215543">matchString</span><span class="op" id="6215554">,</span>&nbsp;<span class="ident" id="6215556">m</span><span class="op" id="6215557">.</span><span class="ident" id="6215558">tests</span><span class="op" id="6215563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215566">exampleOk</span>&nbsp;<span class="op" id="6215576">:=</span>&nbsp;<span class="ident" id="6215579">RunExamples</span><span class="op" id="6215590">(</span><span class="ident" id="6215591">m</span><span class="op" id="6215592">.</span><span class="ident" id="6215593">matchString</span><span class="op" id="6215604">,</span>&nbsp;<span class="ident" id="6215606">m</span><span class="op" id="6215607">.</span><span class="ident" id="6215608">examples</span><span class="op" id="6215616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215619">stopAlarm</span><span class="op" id="6215628">(</span><span class="op" id="6215629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6215632">if</span>&nbsp;<span class="op" id="6215635">!</span><span class="ident" id="6215636">testOk</span>&nbsp;<span class="op" id="6215643">||</span>&nbsp;<span class="op" id="6215646">!</span><span class="ident" id="6215647">exampleOk</span>&nbsp;<span class="op" id="6215657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215661">fmt</span><span class="op" id="6215664">.</span><span class="ident" id="6215665">Println</span><span class="op" id="6215672">(</span><span class="string" id="6215673">&#34;FAIL&#34;</span><span class="op" id="6215679">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215683">after</span><span class="op" id="6215688">(</span><span class="op" id="6215689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6215693">return</span>&nbsp;<span class="num" id="6215700">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6215703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215706">fmt</span><span class="op" id="6215709">.</span><span class="ident" id="6215710">Println</span><span class="op" id="6215717">(</span><span class="string" id="6215718">&#34;PASS&#34;</span><span class="op" id="6215724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215727">RunBenchmarks</span><span class="op" id="6215740">(</span><span class="ident" id="6215741">m</span><span class="op" id="6215742">.</span><span class="ident" id="6215743">matchString</span><span class="op" id="6215754">,</span>&nbsp;<span class="ident" id="6215756">m</span><span class="op" id="6215757">.</span><span class="ident" id="6215758">benchmarks</span><span class="op" id="6215768">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215771">after</span><span class="op" id="6215776">(</span><span class="op" id="6215777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6215780">return</span>&nbsp;<span class="num" id="6215787">0</span><br>
<span class="lineno"></span><span class="op" id="6215789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6215792">func</span>&nbsp;<span class="op" id="6215797">(</span><span class="ident" id="6215798">t</span>&nbsp;<span class="op" id="6215800">*</span><span class="ident" id="6215801">T</span><span class="op" id="6215802">)</span>&nbsp;<span class="ident" id="6215804">report</span><span class="op" id="6215810">(</span><span class="op" id="6215811">)</span>&nbsp;<span class="op" id="6215813">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215816">dstr</span>&nbsp;<span class="op" id="6215821">:=</span>&nbsp;<span class="ident" id="6215824">fmtDuration</span><span class="op" id="6215835">(</span><span class="ident" id="6215836">t</span><span class="op" id="6215837">.</span><span class="ident" id="6215838">duration</span><span class="op" id="6215846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215849">format</span>&nbsp;<span class="op" id="6215856">:=</span>&nbsp;<span class="string" id="6215859">&#34;---&nbsp;%s:&nbsp;%s&nbsp;(%s)\n%s&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6215882">if</span>&nbsp;<span class="ident" id="6215885">t</span><span class="op" id="6215886">.</span><span class="ident" id="6215887">Failed</span><span class="op" id="6215893">(</span><span class="op" id="6215894">)</span>&nbsp;<span class="op" id="6215896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215900">fmt</span><span class="op" id="6215903">.</span><span class="ident" id="6215904">Printf</span><span class="op" id="6215910">(</span><span class="ident" id="6215911">format</span><span class="op" id="6215917">,</span>&nbsp;<span class="string" id="6215919">&#34;FAIL&#34;</span><span class="op" id="6215925">,</span>&nbsp;<span class="ident" id="6215927">t</span><span class="op" id="6215928">.</span><span class="ident" id="6215929">name</span><span class="op" id="6215933">,</span>&nbsp;<span class="ident" id="6215935">dstr</span><span class="op" id="6215939">,</span>&nbsp;<span class="ident" id="6215941">t</span><span class="op" id="6215942">.</span><span class="ident" id="6215943">output</span><span class="op" id="6215949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6215952">}</span>&nbsp;<span class="keyword" id="6215954">else</span>&nbsp;<span class="keyword" id="6215959">if</span>&nbsp;<span class="op" id="6215962">*</span><span class="ident" id="6215963">chatty</span>&nbsp;<span class="op" id="6215970">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6215974">if</span>&nbsp;<span class="ident" id="6215977">t</span><span class="op" id="6215978">.</span><span class="ident" id="6215979">Skipped</span><span class="op" id="6215986">(</span><span class="op" id="6215987">)</span>&nbsp;<span class="op" id="6215989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215994">fmt</span><span class="op" id="6215997">.</span><span class="ident" id="6215998">Printf</span><span class="op" id="6216004">(</span><span class="ident" id="6216005">format</span><span class="op" id="6216011">,</span>&nbsp;<span class="string" id="6216013">&#34;SKIP&#34;</span><span class="op" id="6216019">,</span>&nbsp;<span class="ident" id="6216021">t</span><span class="op" id="6216022">.</span><span class="ident" id="6216023">name</span><span class="op" id="6216027">,</span>&nbsp;<span class="ident" id="6216029">dstr</span><span class="op" id="6216033">,</span>&nbsp;<span class="ident" id="6216035">t</span><span class="op" id="6216036">.</span><span class="ident" id="6216037">output</span><span class="op" id="6216043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6216047">}</span>&nbsp;<span class="keyword" id="6216049">else</span>&nbsp;<span class="op" id="6216054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216059">fmt</span><span class="op" id="6216062">.</span><span class="ident" id="6216063">Printf</span><span class="op" id="6216069">(</span><span class="ident" id="6216070">format</span><span class="op" id="6216076">,</span>&nbsp;<span class="string" id="6216078">&#34;PASS&#34;</span><span class="op" id="6216084">,</span>&nbsp;<span class="ident" id="6216086">t</span><span class="op" id="6216087">.</span><span class="ident" id="6216088">name</span><span class="op" id="6216092">,</span>&nbsp;<span class="ident" id="6216094">dstr</span><span class="op" id="6216098">,</span>&nbsp;<span class="ident" id="6216100">t</span><span class="op" id="6216101">.</span><span class="ident" id="6216102">output</span><span class="op" id="6216108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6216112">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6216115">}</span><br>
<span class="lineno"></span><span class="op" id="6216117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6216120">func</span>&nbsp;<span class="ident" id="6216125">RunTests</span><span class="op" id="6216133">(</span><span class="ident" id="6216134">matchString</span>&nbsp;<span class="keyword" id="6216146">func</span><span class="op" id="6216150">(</span><span class="ident" id="6216151">pat</span><span class="op" id="6216154">,</span>&nbsp;<span class="ident" id="6216156">str</span>&nbsp;<span class="builtintype" id="6216160">string</span><span class="op" id="6216166">)</span>&nbsp;<span class="op" id="6216168">(</span><span class="builtintype" id="6216169">bool</span><span class="op" id="6216173">,</span>&nbsp;<span class="builtintype" id="6216175">error</span><span class="op" id="6216180">)</span><span class="op" id="6216181">,</span>&nbsp;<span class="ident" id="6216183">tests</span>&nbsp;<span class="op" id="6216189">[</span><span class="op" id="6216190">]</span><span class="ident" id="6216191">InternalTest</span><span class="op" id="6216203">)</span>&nbsp;<span class="op" id="6216205">(</span><span class="ident" id="6216206">ok</span>&nbsp;<span class="builtintype" id="6216209">bool</span><span class="op" id="6216213">)</span>&nbsp;<span class="op" id="6216215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216218">ok</span>&nbsp;<span class="op" id="6216221">=</span>&nbsp;<span class="builtintype" id="6216223">true</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6216229">if</span>&nbsp;<span class="builtinfunc" id="6216232">len</span><span class="op" id="6216235">(</span><span class="ident" id="6216236">tests</span><span class="op" id="6216241">)</span>&nbsp;<span class="op" id="6216243">==</span>&nbsp;<span class="num" id="6216246">0</span>&nbsp;<span class="op" id="6216248">&amp;&amp;</span>&nbsp;<span class="op" id="6216251">!</span><span class="ident" id="6216252">haveExamples</span>&nbsp;<span class="op" id="6216265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216269">fmt</span><span class="op" id="6216272">.</span><span class="ident" id="6216273">Fprintln</span><span class="op" id="6216281">(</span><span class="ident" id="6216282">os</span><span class="op" id="6216284">.</span><span class="ident" id="6216285">Stderr</span><span class="op" id="6216291">,</span>&nbsp;<span class="string" id="6216293">&#34;testing:&nbsp;warning:&nbsp;no&nbsp;tests&nbsp;to&nbsp;run&#34;</span><span class="op" id="6216328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6216332">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6216340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6216343">for</span>&nbsp;<span class="ident" id="6216347">_</span><span class="op" id="6216348">,</span>&nbsp;<span class="ident" id="6216350">procs</span>&nbsp;<span class="op" id="6216356">:=</span>&nbsp;<span class="keyword" id="6216359">range</span>&nbsp;<span class="ident" id="6216365">cpuList</span>&nbsp;<span class="op" id="6216373">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216377">runtime</span><span class="op" id="6216384">.</span><span class="ident" id="6216385">GOMAXPROCS</span><span class="op" id="6216395">(</span><span class="ident" id="6216396">procs</span><span class="op" id="6216401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6216405">//&nbsp;We&nbsp;build&nbsp;a&nbsp;new&nbsp;channel&nbsp;tree&nbsp;for&nbsp;each&nbsp;run&nbsp;of&nbsp;the&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6216464">//&nbsp;collector&nbsp;merges&nbsp;in&nbsp;one&nbsp;channel&nbsp;all&nbsp;the&nbsp;upstream&nbsp;signals&nbsp;from&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6216547">//&nbsp;If&nbsp;all&nbsp;tests&nbsp;pump&nbsp;to&nbsp;the&nbsp;same&nbsp;channel,&nbsp;a&nbsp;bug&nbsp;can&nbsp;occur&nbsp;where&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6216620">//&nbsp;kicks&nbsp;off&nbsp;a&nbsp;goroutine&nbsp;that&nbsp;Fails,&nbsp;yet&nbsp;the&nbsp;test&nbsp;still&nbsp;delivers&nbsp;a&nbsp;completion&nbsp;signal,</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6216708">//&nbsp;which&nbsp;skews&nbsp;the&nbsp;counting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6216739">var</span>&nbsp;<span class="ident" id="6216743">collector</span>&nbsp;<span class="op" id="6216753">=</span>&nbsp;<span class="builtinfunc" id="6216755">make</span><span class="op" id="6216759">(</span><span class="keyword" id="6216760">chan</span>&nbsp;<span class="keyword" id="6216765">interface</span><span class="op" id="6216774">{</span><span class="op" id="6216775">}</span><span class="op" id="6216776">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216781">numParallel</span>&nbsp;<span class="op" id="6216793">:=</span>&nbsp;<span class="num" id="6216796">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216800">startParallel</span>&nbsp;<span class="op" id="6216814">:=</span>&nbsp;<span class="builtinfunc" id="6216817">make</span><span class="op" id="6216821">(</span><span class="keyword" id="6216822">chan</span>&nbsp;<span class="builtintype" id="6216827">bool</span><span class="op" id="6216831">)</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6216836">for</span>&nbsp;<span class="ident" id="6216840">i</span>&nbsp;<span class="op" id="6216842">:=</span>&nbsp;<span class="num" id="6216845">0</span><span class="op" id="6216846">;</span>&nbsp;<span class="ident" id="6216848">i</span>&nbsp;<span class="op" id="6216850">&lt;</span>&nbsp;<span class="builtinfunc" id="6216852">len</span><span class="op" id="6216855">(</span><span class="ident" id="6216856">tests</span><span class="op" id="6216861">)</span><span class="op" id="6216862">;</span>&nbsp;<span class="ident" id="6216864">i</span><span class="op" id="6216865">++</span>&nbsp;<span class="op" id="6216868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216873">matched</span><span class="op" id="6216880">,</span>&nbsp;<span class="ident" id="6216882">err</span>&nbsp;<span class="op" id="6216886">:=</span>&nbsp;<span class="ident" id="6216889">matchString</span><span class="op" id="6216900">(</span><span class="op" id="6216901">*</span><span class="ident" id="6216902">match</span><span class="op" id="6216907">,</span>&nbsp;<span class="ident" id="6216909">tests</span><span class="op" id="6216914">[</span><span class="ident" id="6216915">i</span><span class="op" id="6216916">]</span><span class="op" id="6216917">.</span><span class="ident" id="6216918">Name</span><span class="op" id="6216922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6216927">if</span>&nbsp;<span class="ident" id="6216930">err</span>&nbsp;<span class="op" id="6216934">!=</span>&nbsp;<span class="ident" id="6216937">nil</span>&nbsp;<span class="op" id="6216941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216947">fmt</span><span class="op" id="6216950">.</span><span class="ident" id="6216951">Fprintf</span><span class="op" id="6216958">(</span><span class="ident" id="6216959">os</span><span class="op" id="6216961">.</span><span class="ident" id="6216962">Stderr</span><span class="op" id="6216968">,</span>&nbsp;<span class="string" id="6216970">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.run:&nbsp;%s\n&#34;</span><span class="op" id="6217015">,</span>&nbsp;<span class="ident" id="6217017">err</span><span class="op" id="6217020">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217026">os</span><span class="op" id="6217028">.</span><span class="ident" id="6217029">Exit</span><span class="op" id="6217033">(</span><span class="num" id="6217034">1</span><span class="op" id="6217035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6217040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217045">if</span>&nbsp;<span class="op" id="6217048">!</span><span class="ident" id="6217049">matched</span>&nbsp;<span class="op" id="6217057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217063">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6217075">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217080">testName</span>&nbsp;<span class="op" id="6217089">:=</span>&nbsp;<span class="ident" id="6217092">tests</span><span class="op" id="6217097">[</span><span class="ident" id="6217098">i</span><span class="op" id="6217099">]</span><span class="op" id="6217100">.</span><span class="ident" id="6217101">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217109">if</span>&nbsp;<span class="ident" id="6217112">procs</span>&nbsp;<span class="op" id="6217118">!=</span>&nbsp;<span class="num" id="6217121">1</span>&nbsp;<span class="op" id="6217123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217129">testName</span>&nbsp;<span class="op" id="6217138">=</span>&nbsp;<span class="ident" id="6217140">fmt</span><span class="op" id="6217143">.</span><span class="ident" id="6217144">Sprintf</span><span class="op" id="6217151">(</span><span class="string" id="6217152">&#34;%s-%d&#34;</span><span class="op" id="6217159">,</span>&nbsp;<span class="ident" id="6217161">tests</span><span class="op" id="6217166">[</span><span class="ident" id="6217167">i</span><span class="op" id="6217168">]</span><span class="op" id="6217169">.</span><span class="ident" id="6217170">Name</span><span class="op" id="6217174">,</span>&nbsp;<span class="ident" id="6217176">procs</span><span class="op" id="6217181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6217186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217191">t</span>&nbsp;<span class="op" id="6217193">:=</span>&nbsp;<span class="op" id="6217196">&amp;</span><span class="ident" id="6217197">T</span><span class="op" id="6217198">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217204">common</span><span class="op" id="6217210">:</span>&nbsp;<span class="ident" id="6217212">common</span><span class="op" id="6217218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217225">signal</span><span class="op" id="6217231">:</span>&nbsp;<span class="builtinfunc" id="6217233">make</span><span class="op" id="6217237">(</span><span class="keyword" id="6217238">chan</span>&nbsp;<span class="keyword" id="6217243">interface</span><span class="op" id="6217252">{</span><span class="op" id="6217253">}</span><span class="op" id="6217254">)</span><span class="op" id="6217255">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6217261">}</span><span class="op" id="6217262">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217268">name</span><span class="op" id="6217272">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6217283">testName</span><span class="op" id="6217291">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217297">startParallel</span><span class="op" id="6217310">:</span>&nbsp;<span class="ident" id="6217312">startParallel</span><span class="op" id="6217325">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6217330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217335">t</span><span class="op" id="6217336">.</span><span class="ident" id="6217337">self</span>&nbsp;<span class="op" id="6217342">=</span>&nbsp;<span class="ident" id="6217344">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217349">if</span>&nbsp;<span class="op" id="6217352">*</span><span class="ident" id="6217353">chatty</span>&nbsp;<span class="op" id="6217360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217366">fmt</span><span class="op" id="6217369">.</span><span class="ident" id="6217370">Printf</span><span class="op" id="6217376">(</span><span class="string" id="6217377">&#34;===&nbsp;RUN&nbsp;%s\n&#34;</span><span class="op" id="6217391">,</span>&nbsp;<span class="ident" id="6217393">t</span><span class="op" id="6217394">.</span><span class="ident" id="6217395">name</span><span class="op" id="6217399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6217404">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217409">go</span>&nbsp;<span class="ident" id="6217412">tRunner</span><span class="op" id="6217419">(</span><span class="ident" id="6217420">t</span><span class="op" id="6217421">,</span>&nbsp;<span class="op" id="6217423">&amp;</span><span class="ident" id="6217424">tests</span><span class="op" id="6217429">[</span><span class="ident" id="6217430">i</span><span class="op" id="6217431">]</span><span class="op" id="6217432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217437">out</span>&nbsp;<span class="op" id="6217441">:=</span>&nbsp;<span class="op" id="6217444">(</span><span class="op" id="6217445">&lt;-</span><span class="ident" id="6217447">t</span><span class="op" id="6217448">.</span><span class="ident" id="6217449">signal</span><span class="op" id="6217455">)</span><span class="op" id="6217456">.</span><span class="op" id="6217457">(</span><span class="op" id="6217458">*</span><span class="ident" id="6217459">T</span><span class="op" id="6217460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217465">if</span>&nbsp;<span class="ident" id="6217468">out</span>&nbsp;<span class="op" id="6217472">==</span>&nbsp;<span class="ident" id="6217475">nil</span>&nbsp;<span class="op" id="6217479">{</span>&nbsp;<span class="comment" id="6217481">//&nbsp;Parallel&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217502">go</span>&nbsp;<span class="keyword" id="6217505">func</span><span class="op" id="6217509">(</span><span class="op" id="6217510">)</span>&nbsp;<span class="op" id="6217512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217519">collector</span>&nbsp;<span class="op" id="6217529">&lt;-</span>&nbsp;<span class="op" id="6217532">&lt;-</span><span class="ident" id="6217534">t</span><span class="op" id="6217535">.</span><span class="ident" id="6217536">signal</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6217547">}</span><span class="op" id="6217548">(</span><span class="op" id="6217549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217555">numParallel</span><span class="op" id="6217566">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217573">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6217585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217590">t</span><span class="op" id="6217591">.</span><span class="ident" id="6217592">report</span><span class="op" id="6217598">(</span><span class="op" id="6217599">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217604">ok</span>&nbsp;<span class="op" id="6217607">=</span>&nbsp;<span class="ident" id="6217609">ok</span>&nbsp;<span class="op" id="6217612">&amp;&amp;</span>&nbsp;<span class="op" id="6217615">!</span><span class="ident" id="6217616">out</span><span class="op" id="6217619">.</span><span class="ident" id="6217620">Failed</span><span class="op" id="6217626">(</span><span class="op" id="6217627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6217631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217636">running</span>&nbsp;<span class="op" id="6217644">:=</span>&nbsp;<span class="num" id="6217647">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217651">for</span>&nbsp;<span class="ident" id="6217655">numParallel</span><span class="op" id="6217666">+</span><span class="ident" id="6217667">running</span>&nbsp;<span class="op" id="6217675">&gt;</span>&nbsp;<span class="num" id="6217677">0</span>&nbsp;<span class="op" id="6217679">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217684">if</span>&nbsp;<span class="ident" id="6217687">running</span>&nbsp;<span class="op" id="6217695">&lt;</span>&nbsp;<span class="op" id="6217697">*</span><span class="ident" id="6217698">parallel</span>&nbsp;<span class="op" id="6217707">&amp;&amp;</span>&nbsp;<span class="ident" id="6217710">numParallel</span>&nbsp;<span class="op" id="6217722">&gt;</span>&nbsp;<span class="num" id="6217724">0</span>&nbsp;<span class="op" id="6217726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217732">startParallel</span>&nbsp;<span class="op" id="6217746">&lt;-</span>&nbsp;<span class="builtintype" id="6217749">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217758">running</span><span class="op" id="6217765">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217772">numParallel</span><span class="op" id="6217783">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217790">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6217802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217807">t</span>&nbsp;<span class="op" id="6217809">:=</span>&nbsp;<span class="op" id="6217812">(</span><span class="op" id="6217813">&lt;-</span><span class="ident" id="6217815">collector</span><span class="op" id="6217824">)</span><span class="op" id="6217825">.</span><span class="op" id="6217826">(</span><span class="op" id="6217827">*</span><span class="ident" id="6217828">T</span><span class="op" id="6217829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217834">t</span><span class="op" id="6217835">.</span><span class="ident" id="6217836">report</span><span class="op" id="6217842">(</span><span class="op" id="6217843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217848">ok</span>&nbsp;<span class="op" id="6217851">=</span>&nbsp;<span class="ident" id="6217853">ok</span>&nbsp;<span class="op" id="6217856">&amp;&amp;</span>&nbsp;<span class="op" id="6217859">!</span><span class="ident" id="6217860">t</span><span class="op" id="6217861">.</span><span class="ident" id="6217862">Failed</span><span class="op" id="6217868">(</span><span class="op" id="6217869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217874">running</span><span class="op" id="6217881">--</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6217886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6217889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217892">return</span><br>
<span class="lineno"></span><span class="op" id="6217899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="comment" id="6217902">//&nbsp;before&nbsp;runs&nbsp;before&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6217937">func</span>&nbsp;<span class="ident" id="6217942">before</span><span class="op" id="6217948">(</span><span class="op" id="6217949">)</span>&nbsp;<span class="op" id="6217951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217954">if</span>&nbsp;<span class="op" id="6217957">*</span><span class="ident" id="6217958">memProfileRate</span>&nbsp;<span class="op" id="6217973">&gt;</span>&nbsp;<span class="num" id="6217975">0</span>&nbsp;<span class="op" id="6217977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217981">runtime</span><span class="op" id="6217988">.</span><span class="ident" id="6217989">MemProfileRate</span>&nbsp;<span class="op" id="6218004">=</span>&nbsp;<span class="op" id="6218006">*</span><span class="ident" id="6218007">memProfileRate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218023">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218026">if</span>&nbsp;<span class="op" id="6218029">*</span><span class="ident" id="6218030">cpuProfile</span>&nbsp;<span class="op" id="6218041">!=</span>&nbsp;<span class="string" id="6218044">&#34;&#34;</span>&nbsp;<span class="op" id="6218047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218051">f</span><span class="op" id="6218052">,</span>&nbsp;<span class="ident" id="6218054">err</span>&nbsp;<span class="op" id="6218058">:=</span>&nbsp;<span class="ident" id="6218061">os</span><span class="op" id="6218063">.</span><span class="ident" id="6218064">Create</span><span class="op" id="6218070">(</span><span class="ident" id="6218071">toOutputDir</span><span class="op" id="6218082">(</span><span class="op" id="6218083">*</span><span class="ident" id="6218084">cpuProfile</span><span class="op" id="6218094">)</span><span class="op" id="6218095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218099">if</span>&nbsp;<span class="ident" id="6218102">err</span>&nbsp;<span class="op" id="6218106">!=</span>&nbsp;<span class="ident" id="6218109">nil</span>&nbsp;<span class="op" id="6218113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218118">fmt</span><span class="op" id="6218121">.</span><span class="ident" id="6218122">Fprintf</span><span class="op" id="6218129">(</span><span class="ident" id="6218130">os</span><span class="op" id="6218132">.</span><span class="ident" id="6218133">Stderr</span><span class="op" id="6218139">,</span>&nbsp;<span class="string" id="6218141">&#34;testing:&nbsp;%s&#34;</span><span class="op" id="6218154">,</span>&nbsp;<span class="ident" id="6218156">err</span><span class="op" id="6218159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218164">return</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218177">if</span>&nbsp;<span class="ident" id="6218180">err</span>&nbsp;<span class="op" id="6218184">:=</span>&nbsp;<span class="ident" id="6218187">pprof</span><span class="op" id="6218192">.</span><span class="ident" id="6218193">StartCPUProfile</span><span class="op" id="6218208">(</span><span class="ident" id="6218209">f</span><span class="op" id="6218210">)</span><span class="op" id="6218211">;</span>&nbsp;<span class="ident" id="6218213">err</span>&nbsp;<span class="op" id="6218217">!=</span>&nbsp;<span class="ident" id="6218220">nil</span>&nbsp;<span class="op" id="6218224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218229">fmt</span><span class="op" id="6218232">.</span><span class="ident" id="6218233">Fprintf</span><span class="op" id="6218240">(</span><span class="ident" id="6218241">os</span><span class="op" id="6218243">.</span><span class="ident" id="6218244">Stderr</span><span class="op" id="6218250">,</span>&nbsp;<span class="string" id="6218252">&#34;testing:&nbsp;can&#39;t&nbsp;start&nbsp;cpu&nbsp;profile:&nbsp;%s&#34;</span><span class="op" id="6218290">,</span>&nbsp;<span class="ident" id="6218292">err</span><span class="op" id="6218295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218300">f</span><span class="op" id="6218301">.</span><span class="ident" id="6218302">Close</span><span class="op" id="6218307">(</span><span class="op" id="6218308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218313">return</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6218326">//&nbsp;Could&nbsp;save&nbsp;f&nbsp;so&nbsp;after&nbsp;can&nbsp;call&nbsp;f.Close;&nbsp;not&nbsp;worth&nbsp;the&nbsp;effort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218395">if</span>&nbsp;<span class="op" id="6218398">*</span><span class="ident" id="6218399">blockProfile</span>&nbsp;<span class="op" id="6218412">!=</span>&nbsp;<span class="string" id="6218415">&#34;&#34;</span>&nbsp;<span class="op" id="6218418">&amp;&amp;</span>&nbsp;<span class="op" id="6218421">*</span><span class="ident" id="6218422">blockProfileRate</span>&nbsp;<span class="op" id="6218439">&gt;=</span>&nbsp;<span class="num" id="6218442">0</span>&nbsp;<span class="op" id="6218444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218448">runtime</span><span class="op" id="6218455">.</span><span class="ident" id="6218456">SetBlockProfileRate</span><span class="op" id="6218475">(</span><span class="op" id="6218476">*</span><span class="ident" id="6218477">blockProfileRate</span><span class="op" id="6218493">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218499">if</span>&nbsp;<span class="op" id="6218502">*</span><span class="ident" id="6218503">coverProfile</span>&nbsp;<span class="op" id="6218516">!=</span>&nbsp;<span class="string" id="6218519">&#34;&#34;</span>&nbsp;<span class="op" id="6218522">&amp;&amp;</span>&nbsp;<span class="ident" id="6218525">cover</span><span class="op" id="6218530">.</span><span class="ident" id="6218531">Mode</span>&nbsp;<span class="op" id="6218536">==</span>&nbsp;<span class="string" id="6218539">&#34;&#34;</span>&nbsp;<span class="op" id="6218542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218546">fmt</span><span class="op" id="6218549">.</span><span class="ident" id="6218550">Fprintf</span><span class="op" id="6218557">(</span><span class="ident" id="6218558">os</span><span class="op" id="6218560">.</span><span class="ident" id="6218561">Stderr</span><span class="op" id="6218567">,</span>&nbsp;<span class="string" id="6218569">&#34;testing:&nbsp;cannot&nbsp;use&nbsp;-test.coverprofile&nbsp;because&nbsp;test&nbsp;binary&nbsp;was&nbsp;not&nbsp;built&nbsp;with&nbsp;coverage&nbsp;enabled\n&#34;</span><span class="op" id="6218667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218671">os</span><span class="op" id="6218673">.</span><span class="ident" id="6218674">Exit</span><span class="op" id="6218678">(</span><span class="num" id="6218679">2</span><span class="op" id="6218680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218683">}</span><br>
<span class="lineno">610</span><span class="op" id="6218685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6218688">//&nbsp;after&nbsp;runs&nbsp;after&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6218721">func</span>&nbsp;<span class="ident" id="6218726">after</span><span class="op" id="6218731">(</span><span class="op" id="6218732">)</span>&nbsp;<span class="op" id="6218734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218737">if</span>&nbsp;<span class="op" id="6218740">*</span><span class="ident" id="6218741">cpuProfile</span>&nbsp;<span class="op" id="6218752">!=</span>&nbsp;<span class="string" id="6218755">&#34;&#34;</span>&nbsp;<span class="op" id="6218758">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218762">pprof</span><span class="op" id="6218767">.</span><span class="ident" id="6218768">StopCPUProfile</span><span class="op" id="6218782">(</span><span class="op" id="6218783">)</span>&nbsp;<span class="comment" id="6218785">//&nbsp;flushes&nbsp;profile&nbsp;to&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218816">if</span>&nbsp;<span class="op" id="6218819">*</span><span class="ident" id="6218820">memProfile</span>&nbsp;<span class="op" id="6218831">!=</span>&nbsp;<span class="string" id="6218834">&#34;&#34;</span>&nbsp;<span class="op" id="6218837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218841">f</span><span class="op" id="6218842">,</span>&nbsp;<span class="ident" id="6218844">err</span>&nbsp;<span class="op" id="6218848">:=</span>&nbsp;<span class="ident" id="6218851">os</span><span class="op" id="6218853">.</span><span class="ident" id="6218854">Create</span><span class="op" id="6218860">(</span><span class="ident" id="6218861">toOutputDir</span><span class="op" id="6218872">(</span><span class="op" id="6218873">*</span><span class="ident" id="6218874">memProfile</span><span class="op" id="6218884">)</span><span class="op" id="6218885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218889">if</span>&nbsp;<span class="ident" id="6218892">err</span>&nbsp;<span class="op" id="6218896">!=</span>&nbsp;<span class="ident" id="6218899">nil</span>&nbsp;<span class="op" id="6218903">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218908">fmt</span><span class="op" id="6218911">.</span><span class="ident" id="6218912">Fprintf</span><span class="op" id="6218919">(</span><span class="ident" id="6218920">os</span><span class="op" id="6218922">.</span><span class="ident" id="6218923">Stderr</span><span class="op" id="6218929">,</span>&nbsp;<span class="string" id="6218931">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="6218946">,</span>&nbsp;<span class="ident" id="6218948">err</span><span class="op" id="6218951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218956">os</span><span class="op" id="6218958">.</span><span class="ident" id="6218959">Exit</span><span class="op" id="6218963">(</span><span class="num" id="6218964">2</span><span class="op" id="6218965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218973">runtime</span><span class="op" id="6218980">.</span><span class="ident" id="6218981">GC</span><span class="op" id="6218983">(</span><span class="op" id="6218984">)</span>&nbsp;<span class="comment" id="6218986">//&nbsp;materialize&nbsp;all&nbsp;statistics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219018">if</span>&nbsp;<span class="ident" id="6219021">err</span>&nbsp;<span class="op" id="6219025">=</span>&nbsp;<span class="ident" id="6219027">pprof</span><span class="op" id="6219032">.</span><span class="ident" id="6219033">WriteHeapProfile</span><span class="op" id="6219049">(</span><span class="ident" id="6219050">f</span><span class="op" id="6219051">)</span><span class="op" id="6219052">;</span>&nbsp;<span class="ident" id="6219054">err</span>&nbsp;<span class="op" id="6219058">!=</span>&nbsp;<span class="ident" id="6219061">nil</span>&nbsp;<span class="op" id="6219065">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219070">fmt</span><span class="op" id="6219073">.</span><span class="ident" id="6219074">Fprintf</span><span class="op" id="6219081">(</span><span class="ident" id="6219082">os</span><span class="op" id="6219084">.</span><span class="ident" id="6219085">Stderr</span><span class="op" id="6219091">,</span>&nbsp;<span class="string" id="6219093">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="6219124">,</span>&nbsp;<span class="op" id="6219126">*</span><span class="ident" id="6219127">memProfile</span><span class="op" id="6219137">,</span>&nbsp;<span class="ident" id="6219139">err</span><span class="op" id="6219142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219147">os</span><span class="op" id="6219149">.</span><span class="ident" id="6219150">Exit</span><span class="op" id="6219154">(</span><span class="num" id="6219155">2</span><span class="op" id="6219156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6219160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219164">f</span><span class="op" id="6219165">.</span><span class="ident" id="6219166">Close</span><span class="op" id="6219171">(</span><span class="op" id="6219172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6219175">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219178">if</span>&nbsp;<span class="op" id="6219181">*</span><span class="ident" id="6219182">blockProfile</span>&nbsp;<span class="op" id="6219195">!=</span>&nbsp;<span class="string" id="6219198">&#34;&#34;</span>&nbsp;<span class="op" id="6219201">&amp;&amp;</span>&nbsp;<span class="op" id="6219204">*</span><span class="ident" id="6219205">blockProfileRate</span>&nbsp;<span class="op" id="6219222">&gt;=</span>&nbsp;<span class="num" id="6219225">0</span>&nbsp;<span class="op" id="6219227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219231">f</span><span class="op" id="6219232">,</span>&nbsp;<span class="ident" id="6219234">err</span>&nbsp;<span class="op" id="6219238">:=</span>&nbsp;<span class="ident" id="6219241">os</span><span class="op" id="6219243">.</span><span class="ident" id="6219244">Create</span><span class="op" id="6219250">(</span><span class="ident" id="6219251">toOutputDir</span><span class="op" id="6219262">(</span><span class="op" id="6219263">*</span><span class="ident" id="6219264">blockProfile</span><span class="op" id="6219276">)</span><span class="op" id="6219277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219281">if</span>&nbsp;<span class="ident" id="6219284">err</span>&nbsp;<span class="op" id="6219288">!=</span>&nbsp;<span class="ident" id="6219291">nil</span>&nbsp;<span class="op" id="6219295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219300">fmt</span><span class="op" id="6219303">.</span><span class="ident" id="6219304">Fprintf</span><span class="op" id="6219311">(</span><span class="ident" id="6219312">os</span><span class="op" id="6219314">.</span><span class="ident" id="6219315">Stderr</span><span class="op" id="6219321">,</span>&nbsp;<span class="string" id="6219323">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="6219338">,</span>&nbsp;<span class="ident" id="6219340">err</span><span class="op" id="6219343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219348">os</span><span class="op" id="6219350">.</span><span class="ident" id="6219351">Exit</span><span class="op" id="6219355">(</span><span class="num" id="6219356">2</span><span class="op" id="6219357">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6219361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219365">if</span>&nbsp;<span class="ident" id="6219368">err</span>&nbsp;<span class="op" id="6219372">=</span>&nbsp;<span class="ident" id="6219374">pprof</span><span class="op" id="6219379">.</span><span class="ident" id="6219380">Lookup</span><span class="op" id="6219386">(</span><span class="string" id="6219387">&#34;block&#34;</span><span class="op" id="6219394">)</span><span class="op" id="6219395">.</span><span class="ident" id="6219396">WriteTo</span><span class="op" id="6219403">(</span><span class="ident" id="6219404">f</span><span class="op" id="6219405">,</span>&nbsp;<span class="num" id="6219407">0</span><span class="op" id="6219408">)</span><span class="op" id="6219409">;</span>&nbsp;<span class="ident" id="6219411">err</span>&nbsp;<span class="op" id="6219415">!=</span>&nbsp;<span class="ident" id="6219418">nil</span>&nbsp;<span class="op" id="6219422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219427">fmt</span><span class="op" id="6219430">.</span><span class="ident" id="6219431">Fprintf</span><span class="op" id="6219438">(</span><span class="ident" id="6219439">os</span><span class="op" id="6219441">.</span><span class="ident" id="6219442">Stderr</span><span class="op" id="6219448">,</span>&nbsp;<span class="string" id="6219450">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="6219481">,</span>&nbsp;<span class="op" id="6219483">*</span><span class="ident" id="6219484">blockProfile</span><span class="op" id="6219496">,</span>&nbsp;<span class="ident" id="6219498">err</span><span class="op" id="6219501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219506">os</span><span class="op" id="6219508">.</span><span class="ident" id="6219509">Exit</span><span class="op" id="6219513">(</span><span class="num" id="6219514">2</span><span class="op" id="6219515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6219519">}</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219523">f</span><span class="op" id="6219524">.</span><span class="ident" id="6219525">Close</span><span class="op" id="6219530">(</span><span class="op" id="6219531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6219534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219537">if</span>&nbsp;<span class="ident" id="6219540">cover</span><span class="op" id="6219545">.</span><span class="ident" id="6219546">Mode</span>&nbsp;<span class="op" id="6219551">!=</span>&nbsp;<span class="string" id="6219554">&#34;&#34;</span>&nbsp;<span class="op" id="6219557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219561">coverReport</span><span class="op" id="6219572">(</span><span class="op" id="6219573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6219576">}</span><br>
<span class="lineno">645</span><span class="op" id="6219578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6219581">//&nbsp;toOutputDir&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;relocated,&nbsp;if&nbsp;required,&nbsp;to&nbsp;outputDir.</span><br>
<span class="lineno"></span><span class="comment" id="6219656">//&nbsp;Simple&nbsp;implementation&nbsp;to&nbsp;avoid&nbsp;pulling&nbsp;in&nbsp;path/filepath.</span><br>
<span class="lineno"></span><span class="keyword" id="6219716">func</span>&nbsp;<span class="ident" id="6219721">toOutputDir</span><span class="op" id="6219732">(</span><span class="ident" id="6219733">path</span>&nbsp;<span class="builtintype" id="6219738">string</span><span class="op" id="6219744">)</span>&nbsp;<span class="builtintype" id="6219746">string</span>&nbsp;<span class="op" id="6219753">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219756">if</span>&nbsp;<span class="op" id="6219759">*</span><span class="ident" id="6219760">outputDir</span>&nbsp;<span class="op" id="6219770">==</span>&nbsp;<span class="string" id="6219773">&#34;&#34;</span>&nbsp;<span class="op" id="6219776">||</span>&nbsp;<span class="ident" id="6219779">path</span>&nbsp;<span class="op" id="6219784">==</span>&nbsp;<span class="string" id="6219787">&#34;&#34;</span>&nbsp;<span class="op" id="6219790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219794">return</span>&nbsp;<span class="ident" id="6219801">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6219807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219810">if</span>&nbsp;<span class="ident" id="6219813">runtime</span><span class="op" id="6219820">.</span><span class="ident" id="6219821">GOOS</span>&nbsp;<span class="op" id="6219826">==</span>&nbsp;<span class="string" id="6219829">&#34;windows&#34;</span>&nbsp;<span class="op" id="6219839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6219843">//&nbsp;On&nbsp;Windows,&nbsp;it&#39;s&nbsp;clumsy,&nbsp;but&nbsp;we&nbsp;can&nbsp;be&nbsp;almost&nbsp;always&nbsp;correct</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6219909">//&nbsp;by&nbsp;just&nbsp;looking&nbsp;for&nbsp;a&nbsp;drive&nbsp;letter&nbsp;and&nbsp;a&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6219962">//&nbsp;Absolute&nbsp;paths&nbsp;always&nbsp;have&nbsp;a&nbsp;drive&nbsp;letter&nbsp;(ignoring&nbsp;UNC).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6220025">//&nbsp;Problem:&nbsp;if&nbsp;path&nbsp;==&nbsp;&#34;C:A&#34;&nbsp;and&nbsp;outputdir&nbsp;==&nbsp;&#34;C:\Go&#34;&nbsp;it&#39;s&nbsp;unclear</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6220094">//&nbsp;what&nbsp;to&nbsp;do,&nbsp;but&nbsp;even&nbsp;then&nbsp;path/filepath&nbsp;doesn&#39;t&nbsp;help.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6220153">//&nbsp;TODO:&nbsp;Worth&nbsp;doing&nbsp;better?&nbsp;Probably&nbsp;not,&nbsp;because&nbsp;we&#39;re&nbsp;here&nbsp;only</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6220222">//&nbsp;under&nbsp;the&nbsp;management&nbsp;of&nbsp;go&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6220260">if</span>&nbsp;<span class="builtinfunc" id="6220263">len</span><span class="op" id="6220266">(</span><span class="ident" id="6220267">path</span><span class="op" id="6220271">)</span>&nbsp;<span class="op" id="6220273">&gt;=</span>&nbsp;<span class="num" id="6220276">2</span>&nbsp;<span class="op" id="6220278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6220283">letter</span><span class="op" id="6220289">,</span>&nbsp;<span class="ident" id="6220291">colon</span>&nbsp;<span class="op" id="6220297">:=</span>&nbsp;<span class="ident" id="6220300">path</span><span class="op" id="6220304">[</span><span class="num" id="6220305">0</span><span class="op" id="6220306">]</span><span class="op" id="6220307">,</span>&nbsp;<span class="ident" id="6220309">path</span><span class="op" id="6220313">[</span><span class="num" id="6220314">1</span><span class="op" id="6220315">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6220320">if</span>&nbsp;<span class="op" id="6220323">(</span><span class="string" id="6220324">&#39;a&#39;</span>&nbsp;<span class="op" id="6220328">&lt;=</span>&nbsp;<span class="ident" id="6220331">letter</span>&nbsp;<span class="op" id="6220338">&amp;&amp;</span>&nbsp;<span class="ident" id="6220341">letter</span>&nbsp;<span class="op" id="6220348">&lt;=</span>&nbsp;<span class="string" id="6220351">&#39;z&#39;</span>&nbsp;<span class="op" id="6220355">||</span>&nbsp;<span class="string" id="6220358">&#39;A&#39;</span>&nbsp;<span class="op" id="6220362">&lt;=</span>&nbsp;<span class="ident" id="6220365">letter</span>&nbsp;<span class="op" id="6220372">&amp;&amp;</span>&nbsp;<span class="ident" id="6220375">letter</span>&nbsp;<span class="op" id="6220382">&lt;=</span>&nbsp;<span class="string" id="6220385">&#39;Z&#39;</span><span class="op" id="6220388">)</span>&nbsp;<span class="op" id="6220390">&amp;&amp;</span>&nbsp;<span class="ident" id="6220393">colon</span>&nbsp;<span class="op" id="6220399">==</span>&nbsp;<span class="string" id="6220402">&#39;:&#39;</span>&nbsp;<span class="op" id="6220406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6220412">//&nbsp;If&nbsp;path&nbsp;starts&nbsp;with&nbsp;a&nbsp;drive&nbsp;letter&nbsp;we&#39;re&nbsp;stuck&nbsp;with&nbsp;it&nbsp;regardless.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6220486">return</span>&nbsp;<span class="ident" id="6220493">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6220501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6220505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6220508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6220511">if</span>&nbsp;<span class="ident" id="6220514">os</span><span class="op" id="6220516">.</span><span class="ident" id="6220517">IsPathSeparator</span><span class="op" id="6220532">(</span><span class="ident" id="6220533">path</span><span class="op" id="6220537">[</span><span class="num" id="6220538">0</span><span class="op" id="6220539">]</span><span class="op" id="6220540">)</span>&nbsp;<span class="op" id="6220542">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6220546">return</span>&nbsp;<span class="ident" id="6220553">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6220559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6220562">return</span>&nbsp;<span class="ident" id="6220569">fmt</span><span class="op" id="6220572">.</span><span class="ident" id="6220573">Sprintf</span><span class="op" id="6220580">(</span><span class="string" id="6220581">&#34;%s%c%s&#34;</span><span class="op" id="6220589">,</span>&nbsp;<span class="op" id="6220591">*</span><span class="ident" id="6220592">outputDir</span><span class="op" id="6220601">,</span>&nbsp;<span class="ident" id="6220603">os</span><span class="op" id="6220605">.</span><span class="ident" id="6220606">PathSeparator</span><span class="op" id="6220619">,</span>&nbsp;<span class="ident" id="6220621">path</span><span class="op" id="6220625">)</span><br>
<span class="lineno"></span><span class="op" id="6220627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="6220630">var</span>&nbsp;<span class="ident" id="6220634">timer</span>&nbsp;<span class="op" id="6220640">*</span><span class="ident" id="6220641">time</span><span class="op" id="6220645">.</span><span class="ident" id="6220646">Timer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6220653">//&nbsp;startAlarm&nbsp;starts&nbsp;an&nbsp;alarm&nbsp;if&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="6220697">func</span>&nbsp;<span class="ident" id="6220702">startAlarm</span><span class="op" id="6220712">(</span><span class="op" id="6220713">)</span>&nbsp;<span class="op" id="6220715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6220718">if</span>&nbsp;<span class="op" id="6220721">*</span><span class="ident" id="6220722">timeout</span>&nbsp;<span class="op" id="6220730">&gt;</span>&nbsp;<span class="num" id="6220732">0</span>&nbsp;<span class="op" id="6220734">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6220738">timer</span>&nbsp;<span class="op" id="6220744">=</span>&nbsp;<span class="ident" id="6220746">time</span><span class="op" id="6220750">.</span><span class="ident" id="6220751">AfterFunc</span><span class="op" id="6220760">(</span><span class="op" id="6220761">*</span><span class="ident" id="6220762">timeout</span><span class="op" id="6220769">,</span>&nbsp;<span class="keyword" id="6220771">func</span><span class="op" id="6220775">(</span><span class="op" id="6220776">)</span>&nbsp;<span class="op" id="6220778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6220783">panic</span><span class="op" id="6220788">(</span><span class="ident" id="6220789">fmt</span><span class="op" id="6220792">.</span><span class="ident" id="6220793">Sprintf</span><span class="op" id="6220800">(</span><span class="string" id="6220801">&#34;test&nbsp;timed&nbsp;out&nbsp;after&nbsp;%v&#34;</span><span class="op" id="6220826">,</span>&nbsp;<span class="op" id="6220828">*</span><span class="ident" id="6220829">timeout</span><span class="op" id="6220836">)</span><span class="op" id="6220837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6220841">}</span><span class="op" id="6220842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6220845">}</span><br>
<span class="lineno"></span><span class="op" id="6220847">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="6220850">//&nbsp;stopAlarm&nbsp;turns&nbsp;off&nbsp;the&nbsp;alarm.</span><br>
<span class="lineno"></span><span class="keyword" id="6220884">func</span>&nbsp;<span class="ident" id="6220889">stopAlarm</span><span class="op" id="6220898">(</span><span class="op" id="6220899">)</span>&nbsp;<span class="op" id="6220901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6220904">if</span>&nbsp;<span class="op" id="6220907">*</span><span class="ident" id="6220908">timeout</span>&nbsp;<span class="op" id="6220916">&gt;</span>&nbsp;<span class="num" id="6220918">0</span>&nbsp;<span class="op" id="6220920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6220924">timer</span><span class="op" id="6220929">.</span><span class="ident" id="6220930">Stop</span><span class="op" id="6220934">(</span><span class="op" id="6220935">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6220938">}</span><br>
<span class="lineno"></span><span class="op" id="6220940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6220943">func</span>&nbsp;<span class="ident" id="6220948">parseCpuList</span><span class="op" id="6220960">(</span><span class="op" id="6220961">)</span>&nbsp;<span class="op" id="6220963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6220966">for</span>&nbsp;<span class="ident" id="6220970">_</span><span class="op" id="6220971">,</span>&nbsp;<span class="ident" id="6220973">val</span>&nbsp;<span class="op" id="6220977">:=</span>&nbsp;<span class="keyword" id="6220980">range</span>&nbsp;<span class="ident" id="6220986">strings</span><span class="op" id="6220993">.</span><span class="ident" id="6220994">Split</span><span class="op" id="6220999">(</span><span class="op" id="6221000">*</span><span class="ident" id="6221001">cpuListStr</span><span class="op" id="6221011">,</span>&nbsp;<span class="string" id="6221013">&#34;,&#34;</span><span class="op" id="6221016">)</span>&nbsp;<span class="op" id="6221018">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6221022">val</span>&nbsp;<span class="op" id="6221026">=</span>&nbsp;<span class="ident" id="6221028">strings</span><span class="op" id="6221035">.</span><span class="ident" id="6221036">TrimSpace</span><span class="op" id="6221045">(</span><span class="ident" id="6221046">val</span><span class="op" id="6221049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6221053">if</span>&nbsp;<span class="ident" id="6221056">val</span>&nbsp;<span class="op" id="6221060">==</span>&nbsp;<span class="string" id="6221063">&#34;&#34;</span>&nbsp;<span class="op" id="6221066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6221071">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6221082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6221086">cpu</span><span class="op" id="6221089">,</span>&nbsp;<span class="ident" id="6221091">err</span>&nbsp;<span class="op" id="6221095">:=</span>&nbsp;<span class="ident" id="6221098">strconv</span><span class="op" id="6221105">.</span><span class="ident" id="6221106">Atoi</span><span class="op" id="6221110">(</span><span class="ident" id="6221111">val</span><span class="op" id="6221114">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6221118">if</span>&nbsp;<span class="ident" id="6221121">err</span>&nbsp;<span class="op" id="6221125">!=</span>&nbsp;<span class="ident" id="6221128">nil</span>&nbsp;<span class="op" id="6221132">||</span>&nbsp;<span class="ident" id="6221135">cpu</span>&nbsp;<span class="op" id="6221139">&lt;=</span>&nbsp;<span class="num" id="6221142">0</span>&nbsp;<span class="op" id="6221144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6221149">fmt</span><span class="op" id="6221152">.</span><span class="ident" id="6221153">Fprintf</span><span class="op" id="6221160">(</span><span class="ident" id="6221161">os</span><span class="op" id="6221163">.</span><span class="ident" id="6221164">Stderr</span><span class="op" id="6221170">,</span>&nbsp;<span class="string" id="6221172">&#34;testing:&nbsp;invalid&nbsp;value&nbsp;%q&nbsp;for&nbsp;-test.cpu\n&#34;</span><span class="op" id="6221215">,</span>&nbsp;<span class="ident" id="6221217">val</span><span class="op" id="6221220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6221225">os</span><span class="op" id="6221227">.</span><span class="ident" id="6221228">Exit</span><span class="op" id="6221232">(</span><span class="num" id="6221233">1</span><span class="op" id="6221234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6221238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6221242">cpuList</span>&nbsp;<span class="op" id="6221250">=</span>&nbsp;<span class="builtinfunc" id="6221252">append</span><span class="op" id="6221258">(</span><span class="ident" id="6221259">cpuList</span><span class="op" id="6221266">,</span>&nbsp;<span class="ident" id="6221268">cpu</span><span class="op" id="6221271">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6221274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6221277">if</span>&nbsp;<span class="ident" id="6221280">cpuList</span>&nbsp;<span class="op" id="6221288">==</span>&nbsp;<span class="ident" id="6221291">nil</span>&nbsp;<span class="op" id="6221295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6221299">cpuList</span>&nbsp;<span class="op" id="6221307">=</span>&nbsp;<span class="builtinfunc" id="6221309">append</span><span class="op" id="6221315">(</span><span class="ident" id="6221316">cpuList</span><span class="op" id="6221323">,</span>&nbsp;<span class="ident" id="6221325">runtime</span><span class="op" id="6221332">.</span><span class="ident" id="6221333">GOMAXPROCS</span><span class="op" id="6221343">(</span><span class="op" id="6221344">-</span><span class="num" id="6221345">1</span><span class="op" id="6221346">)</span><span class="op" id="6221347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6221350">}</span><br>
<span class="lineno"></span><span class="op" id="6221352">}</span>
</div>
</body>
</html>
