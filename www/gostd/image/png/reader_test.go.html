<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6492250">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6492305">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6492359">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6492410">package</span>&nbsp;<span class="ident" id="6492418">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6492423">import</span>&nbsp;<span class="op" id="6492430">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492433">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492442">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492449">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492458">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492473">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492479">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492492">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492498">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492509">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6492519">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6492522">var</span>&nbsp;<span class="ident" id="6492526">filenames</span>&nbsp;<span class="op" id="6492536">=</span>&nbsp;<span class="op" id="6492538">[</span><span class="op" id="6492539">]</span><span class="builtintype" id="6492540">string</span><span class="op" id="6492546">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492549">&#34;basn0g01&#34;</span><span class="op" id="6492559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492562">&#34;basn0g01-30&#34;</span><span class="op" id="6492575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492578">&#34;basn0g02&#34;</span><span class="op" id="6492588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492591">&#34;basn0g02-29&#34;</span><span class="op" id="6492604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492607">&#34;basn0g04&#34;</span><span class="op" id="6492617">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492620">&#34;basn0g04-31&#34;</span><span class="op" id="6492633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492636">&#34;basn0g08&#34;</span><span class="op" id="6492646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492649">&#34;basn0g16&#34;</span><span class="op" id="6492659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492662">&#34;basn2c08&#34;</span><span class="op" id="6492672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492675">&#34;basn2c16&#34;</span><span class="op" id="6492685">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492688">&#34;basn3p01&#34;</span><span class="op" id="6492698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492701">&#34;basn3p02&#34;</span><span class="op" id="6492711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492714">&#34;basn3p04&#34;</span><span class="op" id="6492724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492727">&#34;basn3p04-31i&#34;</span><span class="op" id="6492741">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492744">&#34;basn3p08&#34;</span><span class="op" id="6492754">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492757">&#34;basn3p08-trns&#34;</span><span class="op" id="6492772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492775">&#34;basn4a08&#34;</span><span class="op" id="6492785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492788">&#34;basn4a16&#34;</span><span class="op" id="6492798">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492801">&#34;basn6a08&#34;</span><span class="op" id="6492811">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492814">&#34;basn6a16&#34;</span><span class="op" id="6492824">,</span><br>
<span class="lineno">40</span><span class="op" id="6492826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6492829">var</span>&nbsp;<span class="ident" id="6492833">filenamesPaletted</span>&nbsp;<span class="op" id="6492851">=</span>&nbsp;<span class="op" id="6492853">[</span><span class="op" id="6492854">]</span><span class="builtintype" id="6492855">string</span><span class="op" id="6492861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492864">&#34;basn3p01&#34;</span><span class="op" id="6492874">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492877">&#34;basn3p02&#34;</span><span class="op" id="6492887">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492890">&#34;basn3p04&#34;</span><span class="op" id="6492900">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492903">&#34;basn3p08&#34;</span><span class="op" id="6492913">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492916">&#34;basn3p08-trns&#34;</span><span class="op" id="6492931">,</span><br>
<span class="lineno"></span><span class="op" id="6492933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="6492936">var</span>&nbsp;<span class="ident" id="6492940">filenamesShort</span>&nbsp;<span class="op" id="6492955">=</span>&nbsp;<span class="op" id="6492957">[</span><span class="op" id="6492958">]</span><span class="builtintype" id="6492959">string</span><span class="op" id="6492965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492968">&#34;basn0g01&#34;</span><span class="op" id="6492978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492981">&#34;basn0g04-31&#34;</span><span class="op" id="6492994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6492997">&#34;basn6a16&#34;</span><span class="op" id="6493007">,</span><br>
<span class="lineno"></span><span class="op" id="6493009">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="6493012">func</span>&nbsp;<span class="ident" id="6493017">readPNG</span><span class="op" id="6493024">(</span><span class="ident" id="6493025">filename</span>&nbsp;<span class="builtintype" id="6493034">string</span><span class="op" id="6493040">)</span>&nbsp;<span class="op" id="6493042">(</span><span class="ident" id="6493043">image</span><span class="op" id="6493048">.</span><span class="ident" id="6493049">Image</span><span class="op" id="6493054">,</span>&nbsp;<span class="builtintype" id="6493056">error</span><span class="op" id="6493061">)</span>&nbsp;<span class="op" id="6493063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6493066">f</span><span class="op" id="6493067">,</span>&nbsp;<span class="ident" id="6493069">err</span>&nbsp;<span class="op" id="6493073">:=</span>&nbsp;<span class="ident" id="6493076">os</span><span class="op" id="6493078">.</span><span class="ident" id="6493079">Open</span><span class="op" id="6493083">(</span><span class="ident" id="6493084">filename</span><span class="op" id="6493092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493095">if</span>&nbsp;<span class="ident" id="6493098">err</span>&nbsp;<span class="op" id="6493102">!=</span>&nbsp;<span class="ident" id="6493105">nil</span>&nbsp;<span class="op" id="6493109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493113">return</span>&nbsp;<span class="ident" id="6493120">nil</span><span class="op" id="6493123">,</span>&nbsp;<span class="ident" id="6493125">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6493130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493133">defer</span>&nbsp;<span class="ident" id="6493139">f</span><span class="op" id="6493140">.</span><span class="ident" id="6493141">Close</span><span class="op" id="6493146">(</span><span class="op" id="6493147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493150">return</span>&nbsp;<span class="ident" id="6493157">Decode</span><span class="op" id="6493163">(</span><span class="ident" id="6493164">f</span><span class="op" id="6493165">)</span><br>
<span class="lineno"></span><span class="op" id="6493167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="6493170">//&nbsp;An&nbsp;approximation&nbsp;of&nbsp;the&nbsp;sng&nbsp;command-line&nbsp;tool.</span><br>
<span class="lineno"></span><span class="keyword" id="6493220">func</span>&nbsp;<span class="ident" id="6493225">sng</span><span class="op" id="6493228">(</span><span class="ident" id="6493229">w</span>&nbsp;<span class="ident" id="6493231">io</span><span class="op" id="6493233">.</span><span class="ident" id="6493234">WriteCloser</span><span class="op" id="6493245">,</span>&nbsp;<span class="ident" id="6493247">filename</span>&nbsp;<span class="builtintype" id="6493256">string</span><span class="op" id="6493262">,</span>&nbsp;<span class="ident" id="6493264">png</span>&nbsp;<span class="ident" id="6493268">image</span><span class="op" id="6493273">.</span><span class="ident" id="6493274">Image</span><span class="op" id="6493279">)</span>&nbsp;<span class="op" id="6493281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493284">defer</span>&nbsp;<span class="ident" id="6493290">w</span><span class="op" id="6493291">.</span><span class="ident" id="6493292">Close</span><span class="op" id="6493297">(</span><span class="op" id="6493298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6493301">bounds</span>&nbsp;<span class="op" id="6493308">:=</span>&nbsp;<span class="ident" id="6493311">png</span><span class="op" id="6493314">.</span><span class="ident" id="6493315">Bounds</span><span class="op" id="6493321">(</span><span class="op" id="6493322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6493325">cm</span>&nbsp;<span class="op" id="6493328">:=</span>&nbsp;<span class="ident" id="6493331">png</span><span class="op" id="6493334">.</span><span class="ident" id="6493335">ColorModel</span><span class="op" id="6493345">(</span><span class="op" id="6493346">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493349">var</span>&nbsp;<span class="ident" id="6493353">bitdepth</span>&nbsp;<span class="builtintype" id="6493362">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493367">switch</span>&nbsp;<span class="ident" id="6493374">cm</span>&nbsp;<span class="op" id="6493377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493380">case</span>&nbsp;<span class="ident" id="6493385">color</span><span class="op" id="6493390">.</span><span class="ident" id="6493391">RGBAModel</span><span class="op" id="6493400">,</span>&nbsp;<span class="ident" id="6493402">color</span><span class="op" id="6493407">.</span><span class="ident" id="6493408">NRGBAModel</span><span class="op" id="6493418">,</span>&nbsp;<span class="ident" id="6493420">color</span><span class="op" id="6493425">.</span><span class="ident" id="6493426">AlphaModel</span><span class="op" id="6493436">,</span>&nbsp;<span class="ident" id="6493438">color</span><span class="op" id="6493443">.</span><span class="ident" id="6493444">GrayModel</span><span class="op" id="6493453">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6493457">bitdepth</span>&nbsp;<span class="op" id="6493466">=</span>&nbsp;<span class="num" id="6493468">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493471">default</span><span class="op" id="6493478">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6493482">bitdepth</span>&nbsp;<span class="op" id="6493491">=</span>&nbsp;<span class="num" id="6493493">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6493497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6493500">cpm</span><span class="op" id="6493503">,</span>&nbsp;<span class="ident" id="6493505">_</span>&nbsp;<span class="op" id="6493507">:=</span>&nbsp;<span class="ident" id="6493510">cm</span><span class="op" id="6493512">.</span><span class="op" id="6493513">(</span><span class="ident" id="6493514">color</span><span class="op" id="6493519">.</span><span class="ident" id="6493520">Palette</span><span class="op" id="6493527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493530">var</span>&nbsp;<span class="ident" id="6493534">paletted</span>&nbsp;<span class="op" id="6493543">*</span><span class="ident" id="6493544">image</span><span class="op" id="6493549">.</span><span class="ident" id="6493550">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493560">if</span>&nbsp;<span class="ident" id="6493563">cpm</span>&nbsp;<span class="op" id="6493567">!=</span>&nbsp;<span class="ident" id="6493570">nil</span>&nbsp;<span class="op" id="6493574">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493578">switch</span>&nbsp;<span class="op" id="6493585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493589">case</span>&nbsp;<span class="builtinfunc" id="6493594">len</span><span class="op" id="6493597">(</span><span class="ident" id="6493598">cpm</span><span class="op" id="6493601">)</span>&nbsp;<span class="op" id="6493603">&lt;=</span>&nbsp;<span class="num" id="6493606">2</span><span class="op" id="6493607">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6493612">bitdepth</span>&nbsp;<span class="op" id="6493621">=</span>&nbsp;<span class="num" id="6493623">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493627">case</span>&nbsp;<span class="builtinfunc" id="6493632">len</span><span class="op" id="6493635">(</span><span class="ident" id="6493636">cpm</span><span class="op" id="6493639">)</span>&nbsp;<span class="op" id="6493641">&lt;=</span>&nbsp;<span class="num" id="6493644">4</span><span class="op" id="6493645">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6493650">bitdepth</span>&nbsp;<span class="op" id="6493659">=</span>&nbsp;<span class="num" id="6493661">2</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493665">case</span>&nbsp;<span class="builtinfunc" id="6493670">len</span><span class="op" id="6493673">(</span><span class="ident" id="6493674">cpm</span><span class="op" id="6493677">)</span>&nbsp;<span class="op" id="6493679">&lt;=</span>&nbsp;<span class="num" id="6493682">16</span><span class="op" id="6493684">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6493689">bitdepth</span>&nbsp;<span class="op" id="6493698">=</span>&nbsp;<span class="num" id="6493700">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493704">default</span><span class="op" id="6493711">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6493716">bitdepth</span>&nbsp;<span class="op" id="6493725">=</span>&nbsp;<span class="num" id="6493727">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6493731">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6493735">paletted</span>&nbsp;<span class="op" id="6493744">=</span>&nbsp;<span class="ident" id="6493746">png</span><span class="op" id="6493749">.</span><span class="op" id="6493750">(</span><span class="op" id="6493751">*</span><span class="ident" id="6493752">image</span><span class="op" id="6493757">.</span><span class="ident" id="6493758">Paletted</span><span class="op" id="6493766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6493769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6493773">//&nbsp;Write&nbsp;the&nbsp;filename&nbsp;and&nbsp;IHDR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6493806">io</span><span class="op" id="6493808">.</span><span class="ident" id="6493809">WriteString</span><span class="op" id="6493820">(</span><span class="ident" id="6493821">w</span><span class="op" id="6493822">,</span>&nbsp;<span class="string" id="6493824">&#34;#SNG:&nbsp;from&nbsp;&#34;</span><span class="op" id="6493837">+</span><span class="ident" id="6493838">filename</span><span class="op" id="6493846">+</span><span class="string" id="6493847">&#34;.png\nIHDR&nbsp;{\n&#34;</span><span class="op" id="6493863">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6493866">fmt</span><span class="op" id="6493869">.</span><span class="ident" id="6493870">Fprintf</span><span class="op" id="6493877">(</span><span class="ident" id="6493878">w</span><span class="op" id="6493879">,</span>&nbsp;<span class="string" id="6493881">&#34;&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;%d;&nbsp;height:&nbsp;%d;&nbsp;bitdepth:&nbsp;%d;\n&#34;</span><span class="op" id="6493925">,</span>&nbsp;<span class="ident" id="6493927">bounds</span><span class="op" id="6493933">.</span><span class="ident" id="6493934">Dx</span><span class="op" id="6493936">(</span><span class="op" id="6493937">)</span><span class="op" id="6493938">,</span>&nbsp;<span class="ident" id="6493940">bounds</span><span class="op" id="6493946">.</span><span class="ident" id="6493947">Dy</span><span class="op" id="6493949">(</span><span class="op" id="6493950">)</span><span class="op" id="6493951">,</span>&nbsp;<span class="ident" id="6493953">bitdepth</span><span class="op" id="6493961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493964">switch</span>&nbsp;<span class="op" id="6493971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6493974">case</span>&nbsp;<span class="ident" id="6493979">cm</span>&nbsp;<span class="op" id="6493982">==</span>&nbsp;<span class="ident" id="6493985">color</span><span class="op" id="6493990">.</span><span class="ident" id="6493991">RGBAModel</span><span class="op" id="6494000">,</span>&nbsp;<span class="ident" id="6494002">cm</span>&nbsp;<span class="op" id="6494005">==</span>&nbsp;<span class="ident" id="6494008">color</span><span class="op" id="6494013">.</span><span class="ident" id="6494014">RGBA64Model</span><span class="op" id="6494025">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6494029">io</span><span class="op" id="6494031">.</span><span class="ident" id="6494032">WriteString</span><span class="op" id="6494043">(</span><span class="ident" id="6494044">w</span><span class="op" id="6494045">,</span>&nbsp;<span class="string" id="6494047">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color;\n&#34;</span><span class="op" id="6494067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6494070">case</span>&nbsp;<span class="ident" id="6494075">cm</span>&nbsp;<span class="op" id="6494078">==</span>&nbsp;<span class="ident" id="6494081">color</span><span class="op" id="6494086">.</span><span class="ident" id="6494087">NRGBAModel</span><span class="op" id="6494097">,</span>&nbsp;<span class="ident" id="6494099">cm</span>&nbsp;<span class="op" id="6494102">==</span>&nbsp;<span class="ident" id="6494105">color</span><span class="op" id="6494110">.</span><span class="ident" id="6494111">NRGBA64Model</span><span class="op" id="6494123">:</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6494127">io</span><span class="op" id="6494129">.</span><span class="ident" id="6494130">WriteString</span><span class="op" id="6494141">(</span><span class="ident" id="6494142">w</span><span class="op" id="6494143">,</span>&nbsp;<span class="string" id="6494145">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;alpha;\n&#34;</span><span class="op" id="6494171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6494174">case</span>&nbsp;<span class="ident" id="6494179">cm</span>&nbsp;<span class="op" id="6494182">==</span>&nbsp;<span class="ident" id="6494185">color</span><span class="op" id="6494190">.</span><span class="ident" id="6494191">GrayModel</span><span class="op" id="6494200">,</span>&nbsp;<span class="ident" id="6494202">cm</span>&nbsp;<span class="op" id="6494205">==</span>&nbsp;<span class="ident" id="6494208">color</span><span class="op" id="6494213">.</span><span class="ident" id="6494214">Gray16Model</span><span class="op" id="6494225">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6494229">io</span><span class="op" id="6494231">.</span><span class="ident" id="6494232">WriteString</span><span class="op" id="6494243">(</span><span class="ident" id="6494244">w</span><span class="op" id="6494245">,</span>&nbsp;<span class="string" id="6494247">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;grayscale;\n&#34;</span><span class="op" id="6494271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6494274">case</span>&nbsp;<span class="ident" id="6494279">cpm</span>&nbsp;<span class="op" id="6494283">!=</span>&nbsp;<span class="ident" id="6494286">nil</span><span class="op" id="6494289">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6494293">io</span><span class="op" id="6494295">.</span><span class="ident" id="6494296">WriteString</span><span class="op" id="6494307">(</span><span class="ident" id="6494308">w</span><span class="op" id="6494309">,</span>&nbsp;<span class="string" id="6494311">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;palette;\n&#34;</span><span class="op" id="6494339">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6494342">default</span><span class="op" id="6494349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6494353">io</span><span class="op" id="6494355">.</span><span class="ident" id="6494356">WriteString</span><span class="op" id="6494367">(</span><span class="ident" id="6494368">w</span><span class="op" id="6494369">,</span>&nbsp;<span class="string" id="6494371">&#34;unknown&nbsp;PNG&nbsp;decoder&nbsp;color&nbsp;model\n&#34;</span><span class="op" id="6494406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6494409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6494412">io</span><span class="op" id="6494414">.</span><span class="ident" id="6494415">WriteString</span><span class="op" id="6494426">(</span><span class="ident" id="6494427">w</span><span class="op" id="6494428">,</span>&nbsp;<span class="string" id="6494430">&#34;}\n&#34;</span><span class="op" id="6494435">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6494439">//&nbsp;We&nbsp;fake&nbsp;a&nbsp;gAMA&nbsp;output.&nbsp;The&nbsp;test&nbsp;files&nbsp;have&nbsp;a&nbsp;gAMA&nbsp;chunk&nbsp;but&nbsp;the&nbsp;go&nbsp;PNG&nbsp;parser&nbsp;ignores&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6494532">//&nbsp;(the&nbsp;PNG&nbsp;spec&nbsp;section&nbsp;11.3&nbsp;says&nbsp;&#34;Ancillary&nbsp;chunks&nbsp;may&nbsp;be&nbsp;ignored&nbsp;by&nbsp;a&nbsp;decoder&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6494617">io</span><span class="op" id="6494619">.</span><span class="ident" id="6494620">WriteString</span><span class="op" id="6494631">(</span><span class="ident" id="6494632">w</span><span class="op" id="6494633">,</span>&nbsp;<span class="string" id="6494635">&#34;gAMA&nbsp;{1.0000}\n&#34;</span><span class="op" id="6494652">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6494656">//&nbsp;Write&nbsp;the&nbsp;PLTE&nbsp;and&nbsp;tRNS&nbsp;(if&nbsp;applicable).</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6494701">if</span>&nbsp;<span class="ident" id="6494704">cpm</span>&nbsp;<span class="op" id="6494708">!=</span>&nbsp;<span class="ident" id="6494711">nil</span>&nbsp;<span class="op" id="6494715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6494719">lastAlpha</span>&nbsp;<span class="op" id="6494729">:=</span>&nbsp;<span class="op" id="6494732">-</span><span class="num" id="6494733">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6494737">io</span><span class="op" id="6494739">.</span><span class="ident" id="6494740">WriteString</span><span class="op" id="6494751">(</span><span class="ident" id="6494752">w</span><span class="op" id="6494753">,</span>&nbsp;<span class="string" id="6494755">&#34;PLTE&nbsp;{\n&#34;</span><span class="op" id="6494765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6494769">for</span>&nbsp;<span class="ident" id="6494773">i</span><span class="op" id="6494774">,</span>&nbsp;<span class="ident" id="6494776">c</span>&nbsp;<span class="op" id="6494778">:=</span>&nbsp;<span class="keyword" id="6494781">range</span>&nbsp;<span class="ident" id="6494787">cpm</span>&nbsp;<span class="op" id="6494791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6494796">var</span>&nbsp;<span class="ident" id="6494800">r</span><span class="op" id="6494801">,</span>&nbsp;<span class="ident" id="6494803">g</span><span class="op" id="6494804">,</span>&nbsp;<span class="ident" id="6494806">b</span><span class="op" id="6494807">,</span>&nbsp;<span class="ident" id="6494809">a</span>&nbsp;<span class="builtintype" id="6494811">uint8</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6494820">switch</span>&nbsp;<span class="ident" id="6494827">c</span>&nbsp;<span class="op" id="6494829">:=</span>&nbsp;<span class="ident" id="6494832">c</span><span class="op" id="6494833">.</span><span class="op" id="6494834">(</span><span class="keyword" id="6494835">type</span><span class="op" id="6494839">)</span>&nbsp;<span class="op" id="6494841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6494846">case</span>&nbsp;<span class="ident" id="6494851">color</span><span class="op" id="6494856">.</span><span class="ident" id="6494857">RGBA</span><span class="op" id="6494861">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6494867">r</span><span class="op" id="6494868">,</span>&nbsp;<span class="ident" id="6494870">g</span><span class="op" id="6494871">,</span>&nbsp;<span class="ident" id="6494873">b</span><span class="op" id="6494874">,</span>&nbsp;<span class="ident" id="6494876">a</span>&nbsp;<span class="op" id="6494878">=</span>&nbsp;<span class="ident" id="6494880">c</span><span class="op" id="6494881">.</span><span class="ident" id="6494882">R</span><span class="op" id="6494883">,</span>&nbsp;<span class="ident" id="6494885">c</span><span class="op" id="6494886">.</span><span class="ident" id="6494887">G</span><span class="op" id="6494888">,</span>&nbsp;<span class="ident" id="6494890">c</span><span class="op" id="6494891">.</span><span class="ident" id="6494892">B</span><span class="op" id="6494893">,</span>&nbsp;<span class="num" id="6494895">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6494903">case</span>&nbsp;<span class="ident" id="6494908">color</span><span class="op" id="6494913">.</span><span class="ident" id="6494914">NRGBA</span><span class="op" id="6494919">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6494925">r</span><span class="op" id="6494926">,</span>&nbsp;<span class="ident" id="6494928">g</span><span class="op" id="6494929">,</span>&nbsp;<span class="ident" id="6494931">b</span><span class="op" id="6494932">,</span>&nbsp;<span class="ident" id="6494934">a</span>&nbsp;<span class="op" id="6494936">=</span>&nbsp;<span class="ident" id="6494938">c</span><span class="op" id="6494939">.</span><span class="ident" id="6494940">R</span><span class="op" id="6494941">,</span>&nbsp;<span class="ident" id="6494943">c</span><span class="op" id="6494944">.</span><span class="ident" id="6494945">G</span><span class="op" id="6494946">,</span>&nbsp;<span class="ident" id="6494948">c</span><span class="op" id="6494949">.</span><span class="ident" id="6494950">B</span><span class="op" id="6494951">,</span>&nbsp;<span class="ident" id="6494953">c</span><span class="op" id="6494954">.</span><span class="ident" id="6494955">A</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6494960">default</span><span class="op" id="6494967">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6494973">panic</span><span class="op" id="6494978">(</span><span class="string" id="6494979">&#34;unknown&nbsp;palette&nbsp;color&nbsp;type&#34;</span><span class="op" id="6495007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6495012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495017">if</span>&nbsp;<span class="ident" id="6495020">a</span>&nbsp;<span class="op" id="6495022">!=</span>&nbsp;<span class="num" id="6495025">0xff</span>&nbsp;<span class="op" id="6495030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495036">lastAlpha</span>&nbsp;<span class="op" id="6495046">=</span>&nbsp;<span class="ident" id="6495048">i</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6495053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495058">fmt</span><span class="op" id="6495061">.</span><span class="ident" id="6495062">Fprintf</span><span class="op" id="6495069">(</span><span class="ident" id="6495070">w</span><span class="op" id="6495071">,</span>&nbsp;<span class="string" id="6495073">&#34;&nbsp;&nbsp;&nbsp;&nbsp;(%3d,%3d,%3d)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;rgb&nbsp;=&nbsp;(0x%02x,0x%02x,0x%02x)\n&#34;</span><span class="op" id="6495129">,</span>&nbsp;<span class="ident" id="6495131">r</span><span class="op" id="6495132">,</span>&nbsp;<span class="ident" id="6495134">g</span><span class="op" id="6495135">,</span>&nbsp;<span class="ident" id="6495137">b</span><span class="op" id="6495138">,</span>&nbsp;<span class="ident" id="6495140">r</span><span class="op" id="6495141">,</span>&nbsp;<span class="ident" id="6495143">g</span><span class="op" id="6495144">,</span>&nbsp;<span class="ident" id="6495146">b</span><span class="op" id="6495147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6495151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495155">io</span><span class="op" id="6495157">.</span><span class="ident" id="6495158">WriteString</span><span class="op" id="6495169">(</span><span class="ident" id="6495170">w</span><span class="op" id="6495171">,</span>&nbsp;<span class="string" id="6495173">&#34;}\n&#34;</span><span class="op" id="6495178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495182">if</span>&nbsp;<span class="ident" id="6495185">lastAlpha</span>&nbsp;<span class="op" id="6495195">!=</span>&nbsp;<span class="op" id="6495198">-</span><span class="num" id="6495199">1</span>&nbsp;<span class="op" id="6495201">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495206">io</span><span class="op" id="6495208">.</span><span class="ident" id="6495209">WriteString</span><span class="op" id="6495220">(</span><span class="ident" id="6495221">w</span><span class="op" id="6495222">,</span>&nbsp;<span class="string" id="6495224">&#34;tRNS&nbsp;{\n&#34;</span><span class="op" id="6495234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495239">for</span>&nbsp;<span class="ident" id="6495243">i</span>&nbsp;<span class="op" id="6495245">:=</span>&nbsp;<span class="num" id="6495248">0</span><span class="op" id="6495249">;</span>&nbsp;<span class="ident" id="6495251">i</span>&nbsp;<span class="op" id="6495253">&lt;=</span>&nbsp;<span class="ident" id="6495256">lastAlpha</span><span class="op" id="6495265">;</span>&nbsp;<span class="ident" id="6495267">i</span><span class="op" id="6495268">++</span>&nbsp;<span class="op" id="6495271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495277">_</span><span class="op" id="6495278">,</span>&nbsp;<span class="ident" id="6495280">_</span><span class="op" id="6495281">,</span>&nbsp;<span class="ident" id="6495283">_</span><span class="op" id="6495284">,</span>&nbsp;<span class="ident" id="6495286">a</span>&nbsp;<span class="op" id="6495288">:=</span>&nbsp;<span class="ident" id="6495291">cpm</span><span class="op" id="6495294">[</span><span class="ident" id="6495295">i</span><span class="op" id="6495296">]</span><span class="op" id="6495297">.</span><span class="ident" id="6495298">RGBA</span><span class="op" id="6495302">(</span><span class="op" id="6495303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495309">a</span>&nbsp;<span class="op" id="6495311">&gt;&gt;=</span>&nbsp;<span class="num" id="6495315">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495321">fmt</span><span class="op" id="6495324">.</span><span class="ident" id="6495325">Fprintf</span><span class="op" id="6495332">(</span><span class="ident" id="6495333">w</span><span class="op" id="6495334">,</span>&nbsp;<span class="string" id="6495336">&#34;&nbsp;%d&#34;</span><span class="op" id="6495341">,</span>&nbsp;<span class="ident" id="6495343">a</span><span class="op" id="6495344">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6495349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495354">io</span><span class="op" id="6495356">.</span><span class="ident" id="6495357">WriteString</span><span class="op" id="6495368">(</span><span class="ident" id="6495369">w</span><span class="op" id="6495370">,</span>&nbsp;<span class="string" id="6495372">&#34;}\n&#34;</span><span class="op" id="6495377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6495381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6495384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6495388">//&nbsp;Write&nbsp;the&nbsp;IMAGE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495409">io</span><span class="op" id="6495411">.</span><span class="ident" id="6495412">WriteString</span><span class="op" id="6495423">(</span><span class="ident" id="6495424">w</span><span class="op" id="6495425">,</span>&nbsp;<span class="string" id="6495427">&#34;IMAGE&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;pixels&nbsp;hex\n&#34;</span><span class="op" id="6495454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495457">for</span>&nbsp;<span class="ident" id="6495461">y</span>&nbsp;<span class="op" id="6495463">:=</span>&nbsp;<span class="ident" id="6495466">bounds</span><span class="op" id="6495472">.</span><span class="ident" id="6495473">Min</span><span class="op" id="6495476">.</span><span class="ident" id="6495477">Y</span><span class="op" id="6495478">;</span>&nbsp;<span class="ident" id="6495480">y</span>&nbsp;<span class="op" id="6495482">&lt;</span>&nbsp;<span class="ident" id="6495484">bounds</span><span class="op" id="6495490">.</span><span class="ident" id="6495491">Max</span><span class="op" id="6495494">.</span><span class="ident" id="6495495">Y</span><span class="op" id="6495496">;</span>&nbsp;<span class="ident" id="6495498">y</span><span class="op" id="6495499">++</span>&nbsp;<span class="op" id="6495502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495506">switch</span>&nbsp;<span class="op" id="6495513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495517">case</span>&nbsp;<span class="ident" id="6495522">cm</span>&nbsp;<span class="op" id="6495525">==</span>&nbsp;<span class="ident" id="6495528">color</span><span class="op" id="6495533">.</span><span class="ident" id="6495534">GrayModel</span><span class="op" id="6495543">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495548">for</span>&nbsp;<span class="ident" id="6495552">x</span>&nbsp;<span class="op" id="6495554">:=</span>&nbsp;<span class="ident" id="6495557">bounds</span><span class="op" id="6495563">.</span><span class="ident" id="6495564">Min</span><span class="op" id="6495567">.</span><span class="ident" id="6495568">X</span><span class="op" id="6495569">;</span>&nbsp;<span class="ident" id="6495571">x</span>&nbsp;<span class="op" id="6495573">&lt;</span>&nbsp;<span class="ident" id="6495575">bounds</span><span class="op" id="6495581">.</span><span class="ident" id="6495582">Max</span><span class="op" id="6495585">.</span><span class="ident" id="6495586">X</span><span class="op" id="6495587">;</span>&nbsp;<span class="ident" id="6495589">x</span><span class="op" id="6495590">++</span>&nbsp;<span class="op" id="6495593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495599">gray</span>&nbsp;<span class="op" id="6495604">:=</span>&nbsp;<span class="ident" id="6495607">png</span><span class="op" id="6495610">.</span><span class="ident" id="6495611">At</span><span class="op" id="6495613">(</span><span class="ident" id="6495614">x</span><span class="op" id="6495615">,</span>&nbsp;<span class="ident" id="6495617">y</span><span class="op" id="6495618">)</span><span class="op" id="6495619">.</span><span class="op" id="6495620">(</span><span class="ident" id="6495621">color</span><span class="op" id="6495626">.</span><span class="ident" id="6495627">Gray</span><span class="op" id="6495631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495637">fmt</span><span class="op" id="6495640">.</span><span class="ident" id="6495641">Fprintf</span><span class="op" id="6495648">(</span><span class="ident" id="6495649">w</span><span class="op" id="6495650">,</span>&nbsp;<span class="string" id="6495652">&#34;%02x&#34;</span><span class="op" id="6495658">,</span>&nbsp;<span class="ident" id="6495660">gray</span><span class="op" id="6495664">.</span><span class="ident" id="6495665">Y</span><span class="op" id="6495666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6495671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495675">case</span>&nbsp;<span class="ident" id="6495680">cm</span>&nbsp;<span class="op" id="6495683">==</span>&nbsp;<span class="ident" id="6495686">color</span><span class="op" id="6495691">.</span><span class="ident" id="6495692">Gray16Model</span><span class="op" id="6495703">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495708">for</span>&nbsp;<span class="ident" id="6495712">x</span>&nbsp;<span class="op" id="6495714">:=</span>&nbsp;<span class="ident" id="6495717">bounds</span><span class="op" id="6495723">.</span><span class="ident" id="6495724">Min</span><span class="op" id="6495727">.</span><span class="ident" id="6495728">X</span><span class="op" id="6495729">;</span>&nbsp;<span class="ident" id="6495731">x</span>&nbsp;<span class="op" id="6495733">&lt;</span>&nbsp;<span class="ident" id="6495735">bounds</span><span class="op" id="6495741">.</span><span class="ident" id="6495742">Max</span><span class="op" id="6495745">.</span><span class="ident" id="6495746">X</span><span class="op" id="6495747">;</span>&nbsp;<span class="ident" id="6495749">x</span><span class="op" id="6495750">++</span>&nbsp;<span class="op" id="6495753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495759">gray16</span>&nbsp;<span class="op" id="6495766">:=</span>&nbsp;<span class="ident" id="6495769">png</span><span class="op" id="6495772">.</span><span class="ident" id="6495773">At</span><span class="op" id="6495775">(</span><span class="ident" id="6495776">x</span><span class="op" id="6495777">,</span>&nbsp;<span class="ident" id="6495779">y</span><span class="op" id="6495780">)</span><span class="op" id="6495781">.</span><span class="op" id="6495782">(</span><span class="ident" id="6495783">color</span><span class="op" id="6495788">.</span><span class="ident" id="6495789">Gray16</span><span class="op" id="6495795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495801">fmt</span><span class="op" id="6495804">.</span><span class="ident" id="6495805">Fprintf</span><span class="op" id="6495812">(</span><span class="ident" id="6495813">w</span><span class="op" id="6495814">,</span>&nbsp;<span class="string" id="6495816">&#34;%04x&nbsp;&#34;</span><span class="op" id="6495823">,</span>&nbsp;<span class="ident" id="6495825">gray16</span><span class="op" id="6495831">.</span><span class="ident" id="6495832">Y</span><span class="op" id="6495833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6495838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495842">case</span>&nbsp;<span class="ident" id="6495847">cm</span>&nbsp;<span class="op" id="6495850">==</span>&nbsp;<span class="ident" id="6495853">color</span><span class="op" id="6495858">.</span><span class="ident" id="6495859">RGBAModel</span><span class="op" id="6495868">:</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6495873">for</span>&nbsp;<span class="ident" id="6495877">x</span>&nbsp;<span class="op" id="6495879">:=</span>&nbsp;<span class="ident" id="6495882">bounds</span><span class="op" id="6495888">.</span><span class="ident" id="6495889">Min</span><span class="op" id="6495892">.</span><span class="ident" id="6495893">X</span><span class="op" id="6495894">;</span>&nbsp;<span class="ident" id="6495896">x</span>&nbsp;<span class="op" id="6495898">&lt;</span>&nbsp;<span class="ident" id="6495900">bounds</span><span class="op" id="6495906">.</span><span class="ident" id="6495907">Max</span><span class="op" id="6495910">.</span><span class="ident" id="6495911">X</span><span class="op" id="6495912">;</span>&nbsp;<span class="ident" id="6495914">x</span><span class="op" id="6495915">++</span>&nbsp;<span class="op" id="6495918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495924">rgba</span>&nbsp;<span class="op" id="6495929">:=</span>&nbsp;<span class="ident" id="6495932">png</span><span class="op" id="6495935">.</span><span class="ident" id="6495936">At</span><span class="op" id="6495938">(</span><span class="ident" id="6495939">x</span><span class="op" id="6495940">,</span>&nbsp;<span class="ident" id="6495942">y</span><span class="op" id="6495943">)</span><span class="op" id="6495944">.</span><span class="op" id="6495945">(</span><span class="ident" id="6495946">color</span><span class="op" id="6495951">.</span><span class="ident" id="6495952">RGBA</span><span class="op" id="6495956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6495962">fmt</span><span class="op" id="6495965">.</span><span class="ident" id="6495966">Fprintf</span><span class="op" id="6495973">(</span><span class="ident" id="6495974">w</span><span class="op" id="6495975">,</span>&nbsp;<span class="string" id="6495977">&#34;%02x%02x%02x&nbsp;&#34;</span><span class="op" id="6495992">,</span>&nbsp;<span class="ident" id="6495994">rgba</span><span class="op" id="6495998">.</span><span class="ident" id="6495999">R</span><span class="op" id="6496000">,</span>&nbsp;<span class="ident" id="6496002">rgba</span><span class="op" id="6496006">.</span><span class="ident" id="6496007">G</span><span class="op" id="6496008">,</span>&nbsp;<span class="ident" id="6496010">rgba</span><span class="op" id="6496014">.</span><span class="ident" id="6496015">B</span><span class="op" id="6496016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6496021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496025">case</span>&nbsp;<span class="ident" id="6496030">cm</span>&nbsp;<span class="op" id="6496033">==</span>&nbsp;<span class="ident" id="6496036">color</span><span class="op" id="6496041">.</span><span class="ident" id="6496042">RGBA64Model</span><span class="op" id="6496053">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496058">for</span>&nbsp;<span class="ident" id="6496062">x</span>&nbsp;<span class="op" id="6496064">:=</span>&nbsp;<span class="ident" id="6496067">bounds</span><span class="op" id="6496073">.</span><span class="ident" id="6496074">Min</span><span class="op" id="6496077">.</span><span class="ident" id="6496078">X</span><span class="op" id="6496079">;</span>&nbsp;<span class="ident" id="6496081">x</span>&nbsp;<span class="op" id="6496083">&lt;</span>&nbsp;<span class="ident" id="6496085">bounds</span><span class="op" id="6496091">.</span><span class="ident" id="6496092">Max</span><span class="op" id="6496095">.</span><span class="ident" id="6496096">X</span><span class="op" id="6496097">;</span>&nbsp;<span class="ident" id="6496099">x</span><span class="op" id="6496100">++</span>&nbsp;<span class="op" id="6496103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496109">rgba64</span>&nbsp;<span class="op" id="6496116">:=</span>&nbsp;<span class="ident" id="6496119">png</span><span class="op" id="6496122">.</span><span class="ident" id="6496123">At</span><span class="op" id="6496125">(</span><span class="ident" id="6496126">x</span><span class="op" id="6496127">,</span>&nbsp;<span class="ident" id="6496129">y</span><span class="op" id="6496130">)</span><span class="op" id="6496131">.</span><span class="op" id="6496132">(</span><span class="ident" id="6496133">color</span><span class="op" id="6496138">.</span><span class="ident" id="6496139">RGBA64</span><span class="op" id="6496145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496151">fmt</span><span class="op" id="6496154">.</span><span class="ident" id="6496155">Fprintf</span><span class="op" id="6496162">(</span><span class="ident" id="6496163">w</span><span class="op" id="6496164">,</span>&nbsp;<span class="string" id="6496166">&#34;%04x%04x%04x&nbsp;&#34;</span><span class="op" id="6496181">,</span>&nbsp;<span class="ident" id="6496183">rgba64</span><span class="op" id="6496189">.</span><span class="ident" id="6496190">R</span><span class="op" id="6496191">,</span>&nbsp;<span class="ident" id="6496193">rgba64</span><span class="op" id="6496199">.</span><span class="ident" id="6496200">G</span><span class="op" id="6496201">,</span>&nbsp;<span class="ident" id="6496203">rgba64</span><span class="op" id="6496209">.</span><span class="ident" id="6496210">B</span><span class="op" id="6496211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6496216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496220">case</span>&nbsp;<span class="ident" id="6496225">cm</span>&nbsp;<span class="op" id="6496228">==</span>&nbsp;<span class="ident" id="6496231">color</span><span class="op" id="6496236">.</span><span class="ident" id="6496237">NRGBAModel</span><span class="op" id="6496247">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496252">for</span>&nbsp;<span class="ident" id="6496256">x</span>&nbsp;<span class="op" id="6496258">:=</span>&nbsp;<span class="ident" id="6496261">bounds</span><span class="op" id="6496267">.</span><span class="ident" id="6496268">Min</span><span class="op" id="6496271">.</span><span class="ident" id="6496272">X</span><span class="op" id="6496273">;</span>&nbsp;<span class="ident" id="6496275">x</span>&nbsp;<span class="op" id="6496277">&lt;</span>&nbsp;<span class="ident" id="6496279">bounds</span><span class="op" id="6496285">.</span><span class="ident" id="6496286">Max</span><span class="op" id="6496289">.</span><span class="ident" id="6496290">X</span><span class="op" id="6496291">;</span>&nbsp;<span class="ident" id="6496293">x</span><span class="op" id="6496294">++</span>&nbsp;<span class="op" id="6496297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496303">nrgba</span>&nbsp;<span class="op" id="6496309">:=</span>&nbsp;<span class="ident" id="6496312">png</span><span class="op" id="6496315">.</span><span class="ident" id="6496316">At</span><span class="op" id="6496318">(</span><span class="ident" id="6496319">x</span><span class="op" id="6496320">,</span>&nbsp;<span class="ident" id="6496322">y</span><span class="op" id="6496323">)</span><span class="op" id="6496324">.</span><span class="op" id="6496325">(</span><span class="ident" id="6496326">color</span><span class="op" id="6496331">.</span><span class="ident" id="6496332">NRGBA</span><span class="op" id="6496337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496343">fmt</span><span class="op" id="6496346">.</span><span class="ident" id="6496347">Fprintf</span><span class="op" id="6496354">(</span><span class="ident" id="6496355">w</span><span class="op" id="6496356">,</span>&nbsp;<span class="string" id="6496358">&#34;%02x%02x%02x%02x&nbsp;&#34;</span><span class="op" id="6496377">,</span>&nbsp;<span class="ident" id="6496379">nrgba</span><span class="op" id="6496384">.</span><span class="ident" id="6496385">R</span><span class="op" id="6496386">,</span>&nbsp;<span class="ident" id="6496388">nrgba</span><span class="op" id="6496393">.</span><span class="ident" id="6496394">G</span><span class="op" id="6496395">,</span>&nbsp;<span class="ident" id="6496397">nrgba</span><span class="op" id="6496402">.</span><span class="ident" id="6496403">B</span><span class="op" id="6496404">,</span>&nbsp;<span class="ident" id="6496406">nrgba</span><span class="op" id="6496411">.</span><span class="ident" id="6496412">A</span><span class="op" id="6496413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6496418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496422">case</span>&nbsp;<span class="ident" id="6496427">cm</span>&nbsp;<span class="op" id="6496430">==</span>&nbsp;<span class="ident" id="6496433">color</span><span class="op" id="6496438">.</span><span class="ident" id="6496439">NRGBA64Model</span><span class="op" id="6496451">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496456">for</span>&nbsp;<span class="ident" id="6496460">x</span>&nbsp;<span class="op" id="6496462">:=</span>&nbsp;<span class="ident" id="6496465">bounds</span><span class="op" id="6496471">.</span><span class="ident" id="6496472">Min</span><span class="op" id="6496475">.</span><span class="ident" id="6496476">X</span><span class="op" id="6496477">;</span>&nbsp;<span class="ident" id="6496479">x</span>&nbsp;<span class="op" id="6496481">&lt;</span>&nbsp;<span class="ident" id="6496483">bounds</span><span class="op" id="6496489">.</span><span class="ident" id="6496490">Max</span><span class="op" id="6496493">.</span><span class="ident" id="6496494">X</span><span class="op" id="6496495">;</span>&nbsp;<span class="ident" id="6496497">x</span><span class="op" id="6496498">++</span>&nbsp;<span class="op" id="6496501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496507">nrgba64</span>&nbsp;<span class="op" id="6496515">:=</span>&nbsp;<span class="ident" id="6496518">png</span><span class="op" id="6496521">.</span><span class="ident" id="6496522">At</span><span class="op" id="6496524">(</span><span class="ident" id="6496525">x</span><span class="op" id="6496526">,</span>&nbsp;<span class="ident" id="6496528">y</span><span class="op" id="6496529">)</span><span class="op" id="6496530">.</span><span class="op" id="6496531">(</span><span class="ident" id="6496532">color</span><span class="op" id="6496537">.</span><span class="ident" id="6496538">NRGBA64</span><span class="op" id="6496545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496551">fmt</span><span class="op" id="6496554">.</span><span class="ident" id="6496555">Fprintf</span><span class="op" id="6496562">(</span><span class="ident" id="6496563">w</span><span class="op" id="6496564">,</span>&nbsp;<span class="string" id="6496566">&#34;%04x%04x%04x%04x&nbsp;&#34;</span><span class="op" id="6496585">,</span>&nbsp;<span class="ident" id="6496587">nrgba64</span><span class="op" id="6496594">.</span><span class="ident" id="6496595">R</span><span class="op" id="6496596">,</span>&nbsp;<span class="ident" id="6496598">nrgba64</span><span class="op" id="6496605">.</span><span class="ident" id="6496606">G</span><span class="op" id="6496607">,</span>&nbsp;<span class="ident" id="6496609">nrgba64</span><span class="op" id="6496616">.</span><span class="ident" id="6496617">B</span><span class="op" id="6496618">,</span>&nbsp;<span class="ident" id="6496620">nrgba64</span><span class="op" id="6496627">.</span><span class="ident" id="6496628">A</span><span class="op" id="6496629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6496634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496638">case</span>&nbsp;<span class="ident" id="6496643">cpm</span>&nbsp;<span class="op" id="6496647">!=</span>&nbsp;<span class="ident" id="6496650">nil</span><span class="op" id="6496653">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496658">var</span>&nbsp;<span class="ident" id="6496662">b</span><span class="op" id="6496663">,</span>&nbsp;<span class="ident" id="6496665">c</span>&nbsp;<span class="builtintype" id="6496667">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496674">for</span>&nbsp;<span class="ident" id="6496678">x</span>&nbsp;<span class="op" id="6496680">:=</span>&nbsp;<span class="ident" id="6496683">bounds</span><span class="op" id="6496689">.</span><span class="ident" id="6496690">Min</span><span class="op" id="6496693">.</span><span class="ident" id="6496694">X</span><span class="op" id="6496695">;</span>&nbsp;<span class="ident" id="6496697">x</span>&nbsp;<span class="op" id="6496699">&lt;</span>&nbsp;<span class="ident" id="6496701">bounds</span><span class="op" id="6496707">.</span><span class="ident" id="6496708">Max</span><span class="op" id="6496711">.</span><span class="ident" id="6496712">X</span><span class="op" id="6496713">;</span>&nbsp;<span class="ident" id="6496715">x</span><span class="op" id="6496716">++</span>&nbsp;<span class="op" id="6496719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496725">b</span>&nbsp;<span class="op" id="6496727">=</span>&nbsp;<span class="ident" id="6496729">b</span><span class="op" id="6496730">&lt;&lt;</span><span class="builtintype" id="6496732">uint</span><span class="op" id="6496736">(</span><span class="ident" id="6496737">bitdepth</span><span class="op" id="6496745">)</span>&nbsp;<span class="op" id="6496747">|</span>&nbsp;<span class="builtintype" id="6496749">int</span><span class="op" id="6496752">(</span><span class="ident" id="6496753">paletted</span><span class="op" id="6496761">.</span><span class="ident" id="6496762">ColorIndexAt</span><span class="op" id="6496774">(</span><span class="ident" id="6496775">x</span><span class="op" id="6496776">,</span>&nbsp;<span class="ident" id="6496778">y</span><span class="op" id="6496779">)</span><span class="op" id="6496780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496786">c</span><span class="op" id="6496787">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496794">if</span>&nbsp;<span class="ident" id="6496797">c</span>&nbsp;<span class="op" id="6496799">==</span>&nbsp;<span class="num" id="6496802">8</span><span class="op" id="6496803">/</span><span class="ident" id="6496804">bitdepth</span>&nbsp;<span class="op" id="6496813">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496820">fmt</span><span class="op" id="6496823">.</span><span class="ident" id="6496824">Fprintf</span><span class="op" id="6496831">(</span><span class="ident" id="6496832">w</span><span class="op" id="6496833">,</span>&nbsp;<span class="string" id="6496835">&#34;%02x&#34;</span><span class="op" id="6496841">,</span>&nbsp;<span class="ident" id="6496843">b</span><span class="op" id="6496844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496851">b</span>&nbsp;<span class="op" id="6496853">=</span>&nbsp;<span class="num" id="6496855">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496862">c</span>&nbsp;<span class="op" id="6496864">=</span>&nbsp;<span class="num" id="6496866">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6496872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6496877">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496882">if</span>&nbsp;<span class="ident" id="6496885">c</span>&nbsp;<span class="op" id="6496887">!=</span>&nbsp;<span class="num" id="6496890">0</span>&nbsp;<span class="op" id="6496892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6496898">for</span>&nbsp;<span class="ident" id="6496902">c</span>&nbsp;<span class="op" id="6496904">!=</span>&nbsp;<span class="num" id="6496907">8</span><span class="op" id="6496908">/</span><span class="ident" id="6496909">bitdepth</span>&nbsp;<span class="op" id="6496918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496925">b</span>&nbsp;<span class="op" id="6496927">=</span>&nbsp;<span class="ident" id="6496929">b</span>&nbsp;<span class="op" id="6496931">&lt;&lt;</span>&nbsp;<span class="builtintype" id="6496934">uint</span><span class="op" id="6496938">(</span><span class="ident" id="6496939">bitdepth</span><span class="op" id="6496947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496954">c</span><span class="op" id="6496955">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6496962">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6496968">fmt</span><span class="op" id="6496971">.</span><span class="ident" id="6496972">Fprintf</span><span class="op" id="6496979">(</span><span class="ident" id="6496980">w</span><span class="op" id="6496981">,</span>&nbsp;<span class="string" id="6496983">&#34;%02x&#34;</span><span class="op" id="6496989">,</span>&nbsp;<span class="ident" id="6496991">b</span><span class="op" id="6496992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6496997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497005">io</span><span class="op" id="6497007">.</span><span class="ident" id="6497008">WriteString</span><span class="op" id="6497019">(</span><span class="ident" id="6497020">w</span><span class="op" id="6497021">,</span>&nbsp;<span class="string" id="6497023">&#34;\n&#34;</span><span class="op" id="6497027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497030">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497033">io</span><span class="op" id="6497035">.</span><span class="ident" id="6497036">WriteString</span><span class="op" id="6497047">(</span><span class="ident" id="6497048">w</span><span class="op" id="6497049">,</span>&nbsp;<span class="string" id="6497051">&#34;}\n&#34;</span><span class="op" id="6497056">)</span><br>
<span class="lineno"></span><span class="op" id="6497058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6497061">func</span>&nbsp;<span class="ident" id="6497066">TestReader</span><span class="op" id="6497076">(</span><span class="ident" id="6497077">t</span>&nbsp;<span class="op" id="6497079">*</span><span class="ident" id="6497080">testing</span><span class="op" id="6497087">.</span><span class="ident" id="6497088">T</span><span class="op" id="6497089">)</span>&nbsp;<span class="op" id="6497091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497094">names</span>&nbsp;<span class="op" id="6497100">:=</span>&nbsp;<span class="ident" id="6497103">filenames</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497114">if</span>&nbsp;<span class="ident" id="6497117">testing</span><span class="op" id="6497124">.</span><span class="ident" id="6497125">Short</span><span class="op" id="6497130">(</span><span class="op" id="6497131">)</span>&nbsp;<span class="op" id="6497133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497137">names</span>&nbsp;<span class="op" id="6497143">=</span>&nbsp;<span class="ident" id="6497145">filenamesShort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497164">for</span>&nbsp;<span class="ident" id="6497168">_</span><span class="op" id="6497169">,</span>&nbsp;<span class="ident" id="6497171">fn</span>&nbsp;<span class="op" id="6497174">:=</span>&nbsp;<span class="keyword" id="6497177">range</span>&nbsp;<span class="ident" id="6497183">names</span>&nbsp;<span class="op" id="6497189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6497193">//&nbsp;Read&nbsp;the&nbsp;.png&nbsp;file.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497218">img</span><span class="op" id="6497221">,</span>&nbsp;<span class="ident" id="6497223">err</span>&nbsp;<span class="op" id="6497227">:=</span>&nbsp;<span class="ident" id="6497230">readPNG</span><span class="op" id="6497237">(</span><span class="string" id="6497238">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="6497259">+</span>&nbsp;<span class="ident" id="6497261">fn</span>&nbsp;<span class="op" id="6497264">+</span>&nbsp;<span class="string" id="6497266">&#34;.png&#34;</span><span class="op" id="6497272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497276">if</span>&nbsp;<span class="ident" id="6497279">err</span>&nbsp;<span class="op" id="6497283">!=</span>&nbsp;<span class="ident" id="6497286">nil</span>&nbsp;<span class="op" id="6497290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497295">t</span><span class="op" id="6497296">.</span><span class="ident" id="6497297">Error</span><span class="op" id="6497302">(</span><span class="ident" id="6497303">fn</span><span class="op" id="6497305">,</span>&nbsp;<span class="ident" id="6497307">err</span><span class="op" id="6497310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497315">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497326">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497331">if</span>&nbsp;<span class="ident" id="6497334">fn</span>&nbsp;<span class="op" id="6497337">==</span>&nbsp;<span class="string" id="6497340">&#34;basn4a16&#34;</span>&nbsp;<span class="op" id="6497351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6497356">//&nbsp;basn4a16.sng&nbsp;is&nbsp;gray&nbsp;+&nbsp;alpha&nbsp;but&nbsp;sng()&nbsp;will&nbsp;produce&nbsp;true&nbsp;color&nbsp;+&nbsp;alpha</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6497433">//&nbsp;so&nbsp;we&nbsp;just&nbsp;check&nbsp;a&nbsp;single&nbsp;random&nbsp;pixel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497479">c</span>&nbsp;<span class="op" id="6497481">:=</span>&nbsp;<span class="ident" id="6497484">img</span><span class="op" id="6497487">.</span><span class="ident" id="6497488">At</span><span class="op" id="6497490">(</span><span class="num" id="6497491">2</span><span class="op" id="6497492">,</span>&nbsp;<span class="num" id="6497494">1</span><span class="op" id="6497495">)</span><span class="op" id="6497496">.</span><span class="op" id="6497497">(</span><span class="ident" id="6497498">color</span><span class="op" id="6497503">.</span><span class="ident" id="6497504">NRGBA64</span><span class="op" id="6497511">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497516">if</span>&nbsp;<span class="ident" id="6497519">c</span><span class="op" id="6497520">.</span><span class="ident" id="6497521">R</span>&nbsp;<span class="op" id="6497523">!=</span>&nbsp;<span class="num" id="6497526">0x11a7</span>&nbsp;<span class="op" id="6497533">||</span>&nbsp;<span class="ident" id="6497536">c</span><span class="op" id="6497537">.</span><span class="ident" id="6497538">G</span>&nbsp;<span class="op" id="6497540">!=</span>&nbsp;<span class="num" id="6497543">0x11a7</span>&nbsp;<span class="op" id="6497550">||</span>&nbsp;<span class="ident" id="6497553">c</span><span class="op" id="6497554">.</span><span class="ident" id="6497555">B</span>&nbsp;<span class="op" id="6497557">!=</span>&nbsp;<span class="num" id="6497560">0x11a7</span>&nbsp;<span class="op" id="6497567">||</span>&nbsp;<span class="ident" id="6497570">c</span><span class="op" id="6497571">.</span><span class="ident" id="6497572">A</span>&nbsp;<span class="op" id="6497574">!=</span>&nbsp;<span class="num" id="6497577">0x1085</span>&nbsp;<span class="op" id="6497584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497590">t</span><span class="op" id="6497591">.</span><span class="ident" id="6497592">Error</span><span class="op" id="6497597">(</span><span class="ident" id="6497598">fn</span><span class="op" id="6497600">,</span>&nbsp;<span class="ident" id="6497602">fmt</span><span class="op" id="6497605">.</span><span class="ident" id="6497606">Errorf</span><span class="op" id="6497612">(</span><span class="string" id="6497613">&#34;wrong&nbsp;pixel&nbsp;value&nbsp;at&nbsp;(2,&nbsp;1):&nbsp;%x&#34;</span><span class="op" id="6497646">,</span>&nbsp;<span class="ident" id="6497648">c</span><span class="op" id="6497649">)</span><span class="op" id="6497650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497660">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497671">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497676">piper</span><span class="op" id="6497681">,</span>&nbsp;<span class="ident" id="6497683">pipew</span>&nbsp;<span class="op" id="6497689">:=</span>&nbsp;<span class="ident" id="6497692">io</span><span class="op" id="6497694">.</span><span class="ident" id="6497695">Pipe</span><span class="op" id="6497699">(</span><span class="op" id="6497700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497704">pb</span>&nbsp;<span class="op" id="6497707">:=</span>&nbsp;<span class="ident" id="6497710">bufio</span><span class="op" id="6497715">.</span><span class="ident" id="6497716">NewScanner</span><span class="op" id="6497726">(</span><span class="ident" id="6497727">piper</span><span class="op" id="6497732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497736">go</span>&nbsp;<span class="ident" id="6497739">sng</span><span class="op" id="6497742">(</span><span class="ident" id="6497743">pipew</span><span class="op" id="6497748">,</span>&nbsp;<span class="ident" id="6497750">fn</span><span class="op" id="6497752">,</span>&nbsp;<span class="ident" id="6497754">img</span><span class="op" id="6497757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497761">defer</span>&nbsp;<span class="ident" id="6497767">piper</span><span class="op" id="6497772">.</span><span class="ident" id="6497773">Close</span><span class="op" id="6497778">(</span><span class="op" id="6497779">)</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6497784">//&nbsp;Read&nbsp;the&nbsp;.sng&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497809">sf</span><span class="op" id="6497811">,</span>&nbsp;<span class="ident" id="6497813">err</span>&nbsp;<span class="op" id="6497817">:=</span>&nbsp;<span class="ident" id="6497820">os</span><span class="op" id="6497822">.</span><span class="ident" id="6497823">Open</span><span class="op" id="6497827">(</span><span class="string" id="6497828">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="6497849">+</span>&nbsp;<span class="ident" id="6497851">fn</span>&nbsp;<span class="op" id="6497854">+</span>&nbsp;<span class="string" id="6497856">&#34;.sng&#34;</span><span class="op" id="6497862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497866">if</span>&nbsp;<span class="ident" id="6497869">err</span>&nbsp;<span class="op" id="6497873">!=</span>&nbsp;<span class="ident" id="6497876">nil</span>&nbsp;<span class="op" id="6497880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497885">t</span><span class="op" id="6497886">.</span><span class="ident" id="6497887">Error</span><span class="op" id="6497892">(</span><span class="ident" id="6497893">fn</span><span class="op" id="6497895">,</span>&nbsp;<span class="ident" id="6497897">err</span><span class="op" id="6497900">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497905">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6497916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497920">defer</span>&nbsp;<span class="ident" id="6497926">sf</span><span class="op" id="6497928">.</span><span class="ident" id="6497929">Close</span><span class="op" id="6497934">(</span><span class="op" id="6497935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497939">sb</span>&nbsp;<span class="op" id="6497942">:=</span>&nbsp;<span class="ident" id="6497945">bufio</span><span class="op" id="6497950">.</span><span class="ident" id="6497951">NewScanner</span><span class="op" id="6497961">(</span><span class="ident" id="6497962">sf</span><span class="op" id="6497964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6497968">if</span>&nbsp;<span class="ident" id="6497971">err</span>&nbsp;<span class="op" id="6497975">!=</span>&nbsp;<span class="ident" id="6497978">nil</span>&nbsp;<span class="op" id="6497982">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497987">t</span><span class="op" id="6497988">.</span><span class="ident" id="6497989">Error</span><span class="op" id="6497994">(</span><span class="ident" id="6497995">fn</span><span class="op" id="6497997">,</span>&nbsp;<span class="ident" id="6497999">err</span><span class="op" id="6498002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498007">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6498023">//&nbsp;Compare&nbsp;the&nbsp;two,&nbsp;in&nbsp;SNG&nbsp;format,&nbsp;line&nbsp;by&nbsp;line.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498074">for</span>&nbsp;<span class="op" id="6498078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498083">pdone</span>&nbsp;<span class="op" id="6498089">:=</span>&nbsp;<span class="op" id="6498092">!</span><span class="ident" id="6498093">pb</span><span class="op" id="6498095">.</span><span class="ident" id="6498096">Scan</span><span class="op" id="6498100">(</span><span class="op" id="6498101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498106">sdone</span>&nbsp;<span class="op" id="6498112">:=</span>&nbsp;<span class="op" id="6498115">!</span><span class="ident" id="6498116">sb</span><span class="op" id="6498118">.</span><span class="ident" id="6498119">Scan</span><span class="op" id="6498123">(</span><span class="op" id="6498124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498129">if</span>&nbsp;<span class="ident" id="6498132">pdone</span>&nbsp;<span class="op" id="6498138">&amp;&amp;</span>&nbsp;<span class="ident" id="6498141">sdone</span>&nbsp;<span class="op" id="6498147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498153">break</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498167">if</span>&nbsp;<span class="ident" id="6498170">pdone</span>&nbsp;<span class="op" id="6498176">||</span>&nbsp;<span class="ident" id="6498179">sdone</span>&nbsp;<span class="op" id="6498185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498191">t</span><span class="op" id="6498192">.</span><span class="ident" id="6498193">Errorf</span><span class="op" id="6498199">(</span><span class="string" id="6498200">&#34;%s:&nbsp;Different&nbsp;sizes&#34;</span><span class="op" id="6498221">,</span>&nbsp;<span class="ident" id="6498223">fn</span><span class="op" id="6498225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498231">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498240">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498245">ps</span>&nbsp;<span class="op" id="6498248">:=</span>&nbsp;<span class="ident" id="6498251">pb</span><span class="op" id="6498253">.</span><span class="ident" id="6498254">Text</span><span class="op" id="6498258">(</span><span class="op" id="6498259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498264">ss</span>&nbsp;<span class="op" id="6498267">:=</span>&nbsp;<span class="ident" id="6498270">sb</span><span class="op" id="6498272">.</span><span class="ident" id="6498273">Text</span><span class="op" id="6498277">(</span><span class="op" id="6498278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498283">if</span>&nbsp;<span class="ident" id="6498286">ps</span>&nbsp;<span class="op" id="6498289">!=</span>&nbsp;<span class="ident" id="6498292">ss</span>&nbsp;<span class="op" id="6498295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498301">t</span><span class="op" id="6498302">.</span><span class="ident" id="6498303">Errorf</span><span class="op" id="6498309">(</span><span class="string" id="6498310">&#34;%s:&nbsp;Mismatch\n%sversus\n%s\n&#34;</span><span class="op" id="6498340">,</span>&nbsp;<span class="ident" id="6498342">fn</span><span class="op" id="6498344">,</span>&nbsp;<span class="ident" id="6498346">ps</span><span class="op" id="6498348">,</span>&nbsp;<span class="ident" id="6498350">ss</span><span class="op" id="6498352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498358">break</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498375">if</span>&nbsp;<span class="ident" id="6498378">pb</span><span class="op" id="6498380">.</span><span class="ident" id="6498381">Err</span><span class="op" id="6498384">(</span><span class="op" id="6498385">)</span>&nbsp;<span class="op" id="6498387">!=</span>&nbsp;<span class="ident" id="6498390">nil</span>&nbsp;<span class="op" id="6498394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498399">t</span><span class="op" id="6498400">.</span><span class="ident" id="6498401">Error</span><span class="op" id="6498406">(</span><span class="ident" id="6498407">fn</span><span class="op" id="6498409">,</span>&nbsp;<span class="ident" id="6498411">pb</span><span class="op" id="6498413">.</span><span class="ident" id="6498414">Err</span><span class="op" id="6498417">(</span><span class="op" id="6498418">)</span><span class="op" id="6498419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498423">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498427">if</span>&nbsp;<span class="ident" id="6498430">sb</span><span class="op" id="6498432">.</span><span class="ident" id="6498433">Err</span><span class="op" id="6498436">(</span><span class="op" id="6498437">)</span>&nbsp;<span class="op" id="6498439">!=</span>&nbsp;<span class="ident" id="6498442">nil</span>&nbsp;<span class="op" id="6498446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498451">t</span><span class="op" id="6498452">.</span><span class="ident" id="6498453">Error</span><span class="op" id="6498458">(</span><span class="ident" id="6498459">fn</span><span class="op" id="6498461">,</span>&nbsp;<span class="ident" id="6498463">sb</span><span class="op" id="6498465">.</span><span class="ident" id="6498466">Err</span><span class="op" id="6498469">(</span><span class="op" id="6498470">)</span><span class="op" id="6498471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498478">}</span><br>
<span class="lineno"></span><span class="op" id="6498480">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="6498483">var</span>&nbsp;<span class="ident" id="6498487">readerErrors</span>&nbsp;<span class="op" id="6498500">=</span>&nbsp;<span class="op" id="6498502">[</span><span class="op" id="6498503">]</span><span class="keyword" id="6498504">struct</span>&nbsp;<span class="op" id="6498511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498514">file</span>&nbsp;<span class="builtintype" id="6498519">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498527">err</span>&nbsp;&nbsp;<span class="builtintype" id="6498532">string</span><br>
<span class="lineno"></span><span class="op" id="6498539">}</span><span class="op" id="6498540">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498543">{</span><span class="string" id="6498544">&#34;invalid-zlib.png&#34;</span><span class="op" id="6498562">,</span>&nbsp;<span class="string" id="6498564">&#34;zlib:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="6498588">}</span><span class="op" id="6498589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498592">{</span><span class="string" id="6498593">&#34;invalid-crc32.png&#34;</span><span class="op" id="6498612">,</span>&nbsp;<span class="string" id="6498614">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="6498632">}</span><span class="op" id="6498633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498636">{</span><span class="string" id="6498637">&#34;invalid-noend.png&#34;</span><span class="op" id="6498656">,</span>&nbsp;<span class="string" id="6498658">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="6498674">}</span><span class="op" id="6498675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498678">{</span><span class="string" id="6498679">&#34;invalid-trunc.png&#34;</span><span class="op" id="6498698">,</span>&nbsp;<span class="string" id="6498700">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="6498716">}</span><span class="op" id="6498717">,</span><br>
<span class="lineno"></span><span class="op" id="6498719">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="6498722">func</span>&nbsp;<span class="ident" id="6498727">TestReaderError</span><span class="op" id="6498742">(</span><span class="ident" id="6498743">t</span>&nbsp;<span class="op" id="6498745">*</span><span class="ident" id="6498746">testing</span><span class="op" id="6498753">.</span><span class="ident" id="6498754">T</span><span class="op" id="6498755">)</span>&nbsp;<span class="op" id="6498757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498760">for</span>&nbsp;<span class="ident" id="6498764">_</span><span class="op" id="6498765">,</span>&nbsp;<span class="ident" id="6498767">tt</span>&nbsp;<span class="op" id="6498770">:=</span>&nbsp;<span class="keyword" id="6498773">range</span>&nbsp;<span class="ident" id="6498779">readerErrors</span>&nbsp;<span class="op" id="6498792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498796">img</span><span class="op" id="6498799">,</span>&nbsp;<span class="ident" id="6498801">err</span>&nbsp;<span class="op" id="6498805">:=</span>&nbsp;<span class="ident" id="6498808">readPNG</span><span class="op" id="6498815">(</span><span class="string" id="6498816">&#34;testdata/&#34;</span>&nbsp;<span class="op" id="6498828">+</span>&nbsp;<span class="ident" id="6498830">tt</span><span class="op" id="6498832">.</span><span class="ident" id="6498833">file</span><span class="op" id="6498837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498841">if</span>&nbsp;<span class="ident" id="6498844">err</span>&nbsp;<span class="op" id="6498848">==</span>&nbsp;<span class="ident" id="6498851">nil</span>&nbsp;<span class="op" id="6498855">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498860">t</span><span class="op" id="6498861">.</span><span class="ident" id="6498862">Errorf</span><span class="op" id="6498868">(</span><span class="string" id="6498869">&#34;decoding&nbsp;%s:&nbsp;missing&nbsp;error&#34;</span><span class="op" id="6498897">,</span>&nbsp;<span class="ident" id="6498899">tt</span><span class="op" id="6498901">.</span><span class="ident" id="6498902">file</span><span class="op" id="6498906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498911">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498926">if</span>&nbsp;<span class="op" id="6498929">!</span><span class="ident" id="6498930">strings</span><span class="op" id="6498937">.</span><span class="ident" id="6498938">Contains</span><span class="op" id="6498946">(</span><span class="ident" id="6498947">err</span><span class="op" id="6498950">.</span><span class="ident" id="6498951">Error</span><span class="op" id="6498956">(</span><span class="op" id="6498957">)</span><span class="op" id="6498958">,</span>&nbsp;<span class="ident" id="6498960">tt</span><span class="op" id="6498962">.</span><span class="ident" id="6498963">err</span><span class="op" id="6498966">)</span>&nbsp;<span class="op" id="6498968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498973">t</span><span class="op" id="6498974">.</span><span class="ident" id="6498975">Errorf</span><span class="op" id="6498981">(</span><span class="string" id="6498982">&#34;decoding&nbsp;%s:&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6499008">,</span>&nbsp;<span class="ident" id="6499010">tt</span><span class="op" id="6499012">.</span><span class="ident" id="6499013">file</span><span class="op" id="6499017">,</span>&nbsp;<span class="ident" id="6499019">err</span><span class="op" id="6499022">,</span>&nbsp;<span class="ident" id="6499024">tt</span><span class="op" id="6499026">.</span><span class="ident" id="6499027">err</span><span class="op" id="6499030">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499038">if</span>&nbsp;<span class="ident" id="6499041">img</span>&nbsp;<span class="op" id="6499045">!=</span>&nbsp;<span class="ident" id="6499048">nil</span>&nbsp;<span class="op" id="6499052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499057">t</span><span class="op" id="6499058">.</span><span class="ident" id="6499059">Errorf</span><span class="op" id="6499065">(</span><span class="string" id="6499066">&#34;decoding&nbsp;%s:&nbsp;have&nbsp;image&nbsp;+&nbsp;error&#34;</span><span class="op" id="6499099">,</span>&nbsp;<span class="ident" id="6499101">tt</span><span class="op" id="6499103">.</span><span class="ident" id="6499104">file</span><span class="op" id="6499108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499115">}</span><br>
<span class="lineno">295</span><span class="op" id="6499117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6499120">func</span>&nbsp;<span class="ident" id="6499125">TestPalettedDecodeConfig</span><span class="op" id="6499149">(</span><span class="ident" id="6499150">t</span>&nbsp;<span class="op" id="6499152">*</span><span class="ident" id="6499153">testing</span><span class="op" id="6499160">.</span><span class="ident" id="6499161">T</span><span class="op" id="6499162">)</span>&nbsp;<span class="op" id="6499164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499167">for</span>&nbsp;<span class="ident" id="6499171">_</span><span class="op" id="6499172">,</span>&nbsp;<span class="ident" id="6499174">fn</span>&nbsp;<span class="op" id="6499177">:=</span>&nbsp;<span class="keyword" id="6499180">range</span>&nbsp;<span class="ident" id="6499186">filenamesPaletted</span>&nbsp;<span class="op" id="6499204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499208">f</span><span class="op" id="6499209">,</span>&nbsp;<span class="ident" id="6499211">err</span>&nbsp;<span class="op" id="6499215">:=</span>&nbsp;<span class="ident" id="6499218">os</span><span class="op" id="6499220">.</span><span class="ident" id="6499221">Open</span><span class="op" id="6499225">(</span><span class="string" id="6499226">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="6499247">+</span>&nbsp;<span class="ident" id="6499249">fn</span>&nbsp;<span class="op" id="6499252">+</span>&nbsp;<span class="string" id="6499254">&#34;.png&#34;</span><span class="op" id="6499260">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499264">if</span>&nbsp;<span class="ident" id="6499267">err</span>&nbsp;<span class="op" id="6499271">!=</span>&nbsp;<span class="ident" id="6499274">nil</span>&nbsp;<span class="op" id="6499278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499283">t</span><span class="op" id="6499284">.</span><span class="ident" id="6499285">Errorf</span><span class="op" id="6499291">(</span><span class="string" id="6499292">&#34;%s:&nbsp;open&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6499313">,</span>&nbsp;<span class="ident" id="6499315">fn</span><span class="op" id="6499317">,</span>&nbsp;<span class="ident" id="6499319">err</span><span class="op" id="6499322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499327">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499342">defer</span>&nbsp;<span class="ident" id="6499348">f</span><span class="op" id="6499349">.</span><span class="ident" id="6499350">Close</span><span class="op" id="6499355">(</span><span class="op" id="6499356">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499360">cfg</span><span class="op" id="6499363">,</span>&nbsp;<span class="ident" id="6499365">err</span>&nbsp;<span class="op" id="6499369">:=</span>&nbsp;<span class="ident" id="6499372">DecodeConfig</span><span class="op" id="6499384">(</span><span class="ident" id="6499385">f</span><span class="op" id="6499386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499390">if</span>&nbsp;<span class="ident" id="6499393">err</span>&nbsp;<span class="op" id="6499397">!=</span>&nbsp;<span class="ident" id="6499400">nil</span>&nbsp;<span class="op" id="6499404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499409">t</span><span class="op" id="6499410">.</span><span class="ident" id="6499411">Errorf</span><span class="op" id="6499417">(</span><span class="string" id="6499418">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="6499426">,</span>&nbsp;<span class="ident" id="6499428">fn</span><span class="op" id="6499430">,</span>&nbsp;<span class="ident" id="6499432">err</span><span class="op" id="6499435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499440">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499451">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499455">pal</span><span class="op" id="6499458">,</span>&nbsp;<span class="ident" id="6499460">ok</span>&nbsp;<span class="op" id="6499463">:=</span>&nbsp;<span class="ident" id="6499466">cfg</span><span class="op" id="6499469">.</span><span class="ident" id="6499470">ColorModel</span><span class="op" id="6499480">.</span><span class="op" id="6499481">(</span><span class="ident" id="6499482">color</span><span class="op" id="6499487">.</span><span class="ident" id="6499488">Palette</span><span class="op" id="6499495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499499">if</span>&nbsp;<span class="op" id="6499502">!</span><span class="ident" id="6499503">ok</span>&nbsp;<span class="op" id="6499506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499511">t</span><span class="op" id="6499512">.</span><span class="ident" id="6499513">Errorf</span><span class="op" id="6499519">(</span><span class="string" id="6499520">&#34;%s:&nbsp;expected&nbsp;paletted&nbsp;color&nbsp;model&#34;</span><span class="op" id="6499555">,</span>&nbsp;<span class="ident" id="6499557">fn</span><span class="op" id="6499559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499564">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499575">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499579">if</span>&nbsp;<span class="ident" id="6499582">pal</span>&nbsp;<span class="op" id="6499586">==</span>&nbsp;<span class="ident" id="6499589">nil</span>&nbsp;<span class="op" id="6499593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499598">t</span><span class="op" id="6499599">.</span><span class="ident" id="6499600">Errorf</span><span class="op" id="6499606">(</span><span class="string" id="6499607">&#34;%s:&nbsp;palette&nbsp;not&nbsp;initialized&#34;</span><span class="op" id="6499636">,</span>&nbsp;<span class="ident" id="6499638">fn</span><span class="op" id="6499640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499645">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499659">}</span><br>
<span class="lineno">320</span><span class="op" id="6499661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6499664">func</span>&nbsp;<span class="ident" id="6499669">benchmarkDecode</span><span class="op" id="6499684">(</span><span class="ident" id="6499685">b</span>&nbsp;<span class="op" id="6499687">*</span><span class="ident" id="6499688">testing</span><span class="op" id="6499695">.</span><span class="ident" id="6499696">B</span><span class="op" id="6499697">,</span>&nbsp;<span class="ident" id="6499699">filename</span>&nbsp;<span class="builtintype" id="6499708">string</span><span class="op" id="6499714">,</span>&nbsp;<span class="ident" id="6499716">bytesPerPixel</span>&nbsp;<span class="builtintype" id="6499730">int</span><span class="op" id="6499733">)</span>&nbsp;<span class="op" id="6499735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499738">b</span><span class="op" id="6499739">.</span><span class="ident" id="6499740">StopTimer</span><span class="op" id="6499749">(</span><span class="op" id="6499750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499753">data</span><span class="op" id="6499757">,</span>&nbsp;<span class="ident" id="6499759">err</span>&nbsp;<span class="op" id="6499763">:=</span>&nbsp;<span class="ident" id="6499766">ioutil</span><span class="op" id="6499772">.</span><span class="ident" id="6499773">ReadFile</span><span class="op" id="6499781">(</span><span class="ident" id="6499782">filename</span><span class="op" id="6499790">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499793">if</span>&nbsp;<span class="ident" id="6499796">err</span>&nbsp;<span class="op" id="6499800">!=</span>&nbsp;<span class="ident" id="6499803">nil</span>&nbsp;<span class="op" id="6499807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499811">b</span><span class="op" id="6499812">.</span><span class="ident" id="6499813">Fatal</span><span class="op" id="6499818">(</span><span class="ident" id="6499819">err</span><span class="op" id="6499822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499828">s</span>&nbsp;<span class="op" id="6499830">:=</span>&nbsp;<span class="builtintype" id="6499833">string</span><span class="op" id="6499839">(</span><span class="ident" id="6499840">data</span><span class="op" id="6499844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499847">cfg</span><span class="op" id="6499850">,</span>&nbsp;<span class="ident" id="6499852">err</span>&nbsp;<span class="op" id="6499856">:=</span>&nbsp;<span class="ident" id="6499859">DecodeConfig</span><span class="op" id="6499871">(</span><span class="ident" id="6499872">strings</span><span class="op" id="6499879">.</span><span class="ident" id="6499880">NewReader</span><span class="op" id="6499889">(</span><span class="ident" id="6499890">s</span><span class="op" id="6499891">)</span><span class="op" id="6499892">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499895">if</span>&nbsp;<span class="ident" id="6499898">err</span>&nbsp;<span class="op" id="6499902">!=</span>&nbsp;<span class="ident" id="6499905">nil</span>&nbsp;<span class="op" id="6499909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499913">b</span><span class="op" id="6499914">.</span><span class="ident" id="6499915">Fatal</span><span class="op" id="6499920">(</span><span class="ident" id="6499921">err</span><span class="op" id="6499924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499930">b</span><span class="op" id="6499931">.</span><span class="ident" id="6499932">SetBytes</span><span class="op" id="6499940">(</span><span class="ident" id="6499941">int64</span><span class="op" id="6499946">(</span><span class="ident" id="6499947">cfg</span><span class="op" id="6499950">.</span><span class="ident" id="6499951">Width</span>&nbsp;<span class="op" id="6499957">*</span>&nbsp;<span class="ident" id="6499959">cfg</span><span class="op" id="6499962">.</span><span class="ident" id="6499963">Height</span>&nbsp;<span class="op" id="6499970">*</span>&nbsp;<span class="ident" id="6499972">bytesPerPixel</span><span class="op" id="6499985">)</span><span class="op" id="6499986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499989">b</span><span class="op" id="6499990">.</span><span class="ident" id="6499991">StartTimer</span><span class="op" id="6500001">(</span><span class="op" id="6500002">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6500005">for</span>&nbsp;<span class="ident" id="6500009">i</span>&nbsp;<span class="op" id="6500011">:=</span>&nbsp;<span class="num" id="6500014">0</span><span class="op" id="6500015">;</span>&nbsp;<span class="ident" id="6500017">i</span>&nbsp;<span class="op" id="6500019">&lt;</span>&nbsp;<span class="ident" id="6500021">b</span><span class="op" id="6500022">.</span><span class="ident" id="6500023">N</span><span class="op" id="6500024">;</span>&nbsp;<span class="ident" id="6500026">i</span><span class="op" id="6500027">++</span>&nbsp;<span class="op" id="6500030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500034">Decode</span><span class="op" id="6500040">(</span><span class="ident" id="6500041">strings</span><span class="op" id="6500048">.</span><span class="ident" id="6500049">NewReader</span><span class="op" id="6500058">(</span><span class="ident" id="6500059">s</span><span class="op" id="6500060">)</span><span class="op" id="6500061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6500064">}</span><br>
<span class="lineno"></span><span class="op" id="6500066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="6500069">func</span>&nbsp;<span class="ident" id="6500074">BenchmarkDecodeGray</span><span class="op" id="6500093">(</span><span class="ident" id="6500094">b</span>&nbsp;<span class="op" id="6500096">*</span><span class="ident" id="6500097">testing</span><span class="op" id="6500104">.</span><span class="ident" id="6500105">B</span><span class="op" id="6500106">)</span>&nbsp;<span class="op" id="6500108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500111">benchmarkDecode</span><span class="op" id="6500126">(</span><span class="ident" id="6500127">b</span><span class="op" id="6500128">,</span>&nbsp;<span class="string" id="6500130">&#34;testdata/benchGray.png&#34;</span><span class="op" id="6500154">,</span>&nbsp;<span class="num" id="6500156">1</span><span class="op" id="6500157">)</span><br>
<span class="lineno"></span><span class="op" id="6500159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6500162">func</span>&nbsp;<span class="ident" id="6500167">BenchmarkDecodeNRGBAGradient</span><span class="op" id="6500195">(</span><span class="ident" id="6500196">b</span>&nbsp;<span class="op" id="6500198">*</span><span class="ident" id="6500199">testing</span><span class="op" id="6500206">.</span><span class="ident" id="6500207">B</span><span class="op" id="6500208">)</span>&nbsp;<span class="op" id="6500210">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500213">benchmarkDecode</span><span class="op" id="6500228">(</span><span class="ident" id="6500229">b</span><span class="op" id="6500230">,</span>&nbsp;<span class="string" id="6500232">&#34;testdata/benchNRGBA-gradient.png&#34;</span><span class="op" id="6500266">,</span>&nbsp;<span class="num" id="6500268">4</span><span class="op" id="6500269">)</span><br>
<span class="lineno"></span><span class="op" id="6500271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6500274">func</span>&nbsp;<span class="ident" id="6500279">BenchmarkDecodeNRGBAOpaque</span><span class="op" id="6500305">(</span><span class="ident" id="6500306">b</span>&nbsp;<span class="op" id="6500308">*</span><span class="ident" id="6500309">testing</span><span class="op" id="6500316">.</span><span class="ident" id="6500317">B</span><span class="op" id="6500318">)</span>&nbsp;<span class="op" id="6500320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500323">benchmarkDecode</span><span class="op" id="6500338">(</span><span class="ident" id="6500339">b</span><span class="op" id="6500340">,</span>&nbsp;<span class="string" id="6500342">&#34;testdata/benchNRGBA-opaque.png&#34;</span><span class="op" id="6500374">,</span>&nbsp;<span class="num" id="6500376">4</span><span class="op" id="6500377">)</span><br>
<span class="lineno">350</span><span class="op" id="6500379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6500382">func</span>&nbsp;<span class="ident" id="6500387">BenchmarkDecodePaletted</span><span class="op" id="6500410">(</span><span class="ident" id="6500411">b</span>&nbsp;<span class="op" id="6500413">*</span><span class="ident" id="6500414">testing</span><span class="op" id="6500421">.</span><span class="ident" id="6500422">B</span><span class="op" id="6500423">)</span>&nbsp;<span class="op" id="6500425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500428">benchmarkDecode</span><span class="op" id="6500443">(</span><span class="ident" id="6500444">b</span><span class="op" id="6500445">,</span>&nbsp;<span class="string" id="6500447">&#34;testdata/benchPaletted.png&#34;</span><span class="op" id="6500475">,</span>&nbsp;<span class="num" id="6500477">1</span><span class="op" id="6500478">)</span><br>
<span class="lineno"></span><span class="op" id="6500480">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="6500483">func</span>&nbsp;<span class="ident" id="6500488">BenchmarkDecodeRGB</span><span class="op" id="6500506">(</span><span class="ident" id="6500507">b</span>&nbsp;<span class="op" id="6500509">*</span><span class="ident" id="6500510">testing</span><span class="op" id="6500517">.</span><span class="ident" id="6500518">B</span><span class="op" id="6500519">)</span>&nbsp;<span class="op" id="6500521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500524">benchmarkDecode</span><span class="op" id="6500539">(</span><span class="ident" id="6500540">b</span><span class="op" id="6500541">,</span>&nbsp;<span class="string" id="6500543">&#34;testdata/benchRGB.png&#34;</span><span class="op" id="6500566">,</span>&nbsp;<span class="num" id="6500568">4</span><span class="op" id="6500569">)</span><br>
<span class="lineno"></span><span class="op" id="6500571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="keyword" id="6500574">func</span>&nbsp;<span class="ident" id="6500579">BenchmarkDecodeInterlacing</span><span class="op" id="6500605">(</span><span class="ident" id="6500606">b</span>&nbsp;<span class="op" id="6500608">*</span><span class="ident" id="6500609">testing</span><span class="op" id="6500616">.</span><span class="ident" id="6500617">B</span><span class="op" id="6500618">)</span>&nbsp;<span class="op" id="6500620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500623">benchmarkDecode</span><span class="op" id="6500638">(</span><span class="ident" id="6500639">b</span><span class="op" id="6500640">,</span>&nbsp;<span class="string" id="6500642">&#34;testdata/benchRGB-interlace.png&#34;</span><span class="op" id="6500675">,</span>&nbsp;<span class="num" id="6500677">4</span><span class="op" id="6500678">)</span><br>
<span class="lineno"></span><span class="op" id="6500680">}</span>
</div>
</body>
</html>
