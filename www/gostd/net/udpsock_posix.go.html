<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html" class="current">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3193191">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3193247">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3193301">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3193352">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3193430">package</span>&nbsp;<span class="ident" id="3193438">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3193443">import</span>&nbsp;<span class="op" id="3193450">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3193453">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3193464">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3193471">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3193474">func</span>&nbsp;<span class="ident" id="3193479">sockaddrToUDP</span><span class="op" id="3193492">(</span><span class="ident" id="3193493">sa</span>&nbsp;<span class="ident" id="3193496">syscall</span><span class="op" id="3193503">.</span><span class="ident" id="3193504">Sockaddr</span><span class="op" id="3193512">)</span>&nbsp;<span class="ident" id="3193514">Addr</span>&nbsp;<span class="op" id="3193519">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193522">switch</span>&nbsp;<span class="ident" id="3193529">sa</span>&nbsp;<span class="op" id="3193532">:=</span>&nbsp;<span class="ident" id="3193535">sa</span><span class="op" id="3193537">.</span><span class="op" id="3193538">(</span><span class="keyword" id="3193539">type</span><span class="op" id="3193543">)</span>&nbsp;<span class="op" id="3193545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193548">case</span>&nbsp;<span class="op" id="3193553">*</span><span class="ident" id="3193554">syscall</span><span class="op" id="3193561">.</span><span class="ident" id="3193562">SockaddrInet4</span><span class="op" id="3193575">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193579">return</span>&nbsp;<span class="op" id="3193586">&amp;</span><span class="ident" id="3193587">UDPAddr</span><span class="op" id="3193594">{</span><span class="ident" id="3193595">IP</span><span class="op" id="3193597">:</span>&nbsp;<span class="ident" id="3193599">sa</span><span class="op" id="3193601">.</span><span class="ident" id="3193602">Addr</span><span class="op" id="3193606">[</span><span class="num" id="3193607">0</span><span class="op" id="3193608">:</span><span class="op" id="3193609">]</span><span class="op" id="3193610">,</span>&nbsp;<span class="ident" id="3193612">Port</span><span class="op" id="3193616">:</span>&nbsp;<span class="ident" id="3193618">sa</span><span class="op" id="3193620">.</span><span class="ident" id="3193621">Port</span><span class="op" id="3193625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193628">case</span>&nbsp;<span class="op" id="3193633">*</span><span class="ident" id="3193634">syscall</span><span class="op" id="3193641">.</span><span class="ident" id="3193642">SockaddrInet6</span><span class="op" id="3193655">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193659">return</span>&nbsp;<span class="op" id="3193666">&amp;</span><span class="ident" id="3193667">UDPAddr</span><span class="op" id="3193674">{</span><span class="ident" id="3193675">IP</span><span class="op" id="3193677">:</span>&nbsp;<span class="ident" id="3193679">sa</span><span class="op" id="3193681">.</span><span class="ident" id="3193682">Addr</span><span class="op" id="3193686">[</span><span class="num" id="3193687">0</span><span class="op" id="3193688">:</span><span class="op" id="3193689">]</span><span class="op" id="3193690">,</span>&nbsp;<span class="ident" id="3193692">Port</span><span class="op" id="3193696">:</span>&nbsp;<span class="ident" id="3193698">sa</span><span class="op" id="3193700">.</span><span class="ident" id="3193701">Port</span><span class="op" id="3193705">,</span>&nbsp;<span class="ident" id="3193707">Zone</span><span class="op" id="3193711">:</span>&nbsp;<span class="ident" id="3193713">zoneToString</span><span class="op" id="3193725">(</span><span class="builtintype" id="3193726">int</span><span class="op" id="3193729">(</span><span class="ident" id="3193730">sa</span><span class="op" id="3193732">.</span><span class="ident" id="3193733">ZoneId</span><span class="op" id="3193739">)</span><span class="op" id="3193740">)</span><span class="op" id="3193741">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3193744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193747">return</span>&nbsp;<span class="ident" id="3193754">nil</span><br>
<span class="lineno"></span><span class="op" id="3193758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3193761">func</span>&nbsp;<span class="op" id="3193766">(</span><span class="ident" id="3193767">a</span>&nbsp;<span class="op" id="3193769">*</span><span class="ident" id="3193770">UDPAddr</span><span class="op" id="3193777">)</span>&nbsp;<span class="ident" id="3193779">family</span><span class="op" id="3193785">(</span><span class="op" id="3193786">)</span>&nbsp;<span class="builtintype" id="3193788">int</span>&nbsp;<span class="op" id="3193792">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193795">if</span>&nbsp;<span class="ident" id="3193798">a</span>&nbsp;<span class="op" id="3193800">==</span>&nbsp;<span class="ident" id="3193803">nil</span>&nbsp;<span class="op" id="3193807">||</span>&nbsp;<span class="builtinfunc" id="3193810">len</span><span class="op" id="3193813">(</span><span class="ident" id="3193814">a</span><span class="op" id="3193815">.</span><span class="ident" id="3193816">IP</span><span class="op" id="3193818">)</span>&nbsp;<span class="op" id="3193820">&lt;=</span>&nbsp;<span class="ident" id="3193823">IPv4len</span>&nbsp;<span class="op" id="3193831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193835">return</span>&nbsp;<span class="ident" id="3193842">syscall</span><span class="op" id="3193849">.</span><span class="ident" id="3193850">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3193859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193862">if</span>&nbsp;<span class="ident" id="3193865">a</span><span class="op" id="3193866">.</span><span class="ident" id="3193867">IP</span><span class="op" id="3193869">.</span><span class="ident" id="3193870">To4</span><span class="op" id="3193873">(</span><span class="op" id="3193874">)</span>&nbsp;<span class="op" id="3193876">!=</span>&nbsp;<span class="ident" id="3193879">nil</span>&nbsp;<span class="op" id="3193883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193887">return</span>&nbsp;<span class="ident" id="3193894">syscall</span><span class="op" id="3193901">.</span><span class="ident" id="3193902">AF_INET</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3193911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193914">return</span>&nbsp;<span class="ident" id="3193921">syscall</span><span class="op" id="3193928">.</span><span class="ident" id="3193929">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="3193938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3193941">func</span>&nbsp;<span class="op" id="3193946">(</span><span class="ident" id="3193947">a</span>&nbsp;<span class="op" id="3193949">*</span><span class="ident" id="3193950">UDPAddr</span><span class="op" id="3193957">)</span>&nbsp;<span class="ident" id="3193959">isWildcard</span><span class="op" id="3193969">(</span><span class="op" id="3193970">)</span>&nbsp;<span class="builtintype" id="3193972">bool</span>&nbsp;<span class="op" id="3193977">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3193980">if</span>&nbsp;<span class="ident" id="3193983">a</span>&nbsp;<span class="op" id="3193985">==</span>&nbsp;<span class="ident" id="3193988">nil</span>&nbsp;<span class="op" id="3193992">||</span>&nbsp;<span class="ident" id="3193995">a</span><span class="op" id="3193996">.</span><span class="ident" id="3193997">IP</span>&nbsp;<span class="op" id="3194000">==</span>&nbsp;<span class="ident" id="3194003">nil</span>&nbsp;<span class="op" id="3194007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194011">return</span>&nbsp;<span class="builtintype" id="3194018">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3194024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194027">return</span>&nbsp;<span class="ident" id="3194034">a</span><span class="op" id="3194035">.</span><span class="ident" id="3194036">IP</span><span class="op" id="3194038">.</span><span class="ident" id="3194039">IsUnspecified</span><span class="op" id="3194052">(</span><span class="op" id="3194053">)</span><br>
<span class="lineno"></span><span class="op" id="3194055">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="3194058">func</span>&nbsp;<span class="op" id="3194063">(</span><span class="ident" id="3194064">a</span>&nbsp;<span class="op" id="3194066">*</span><span class="ident" id="3194067">UDPAddr</span><span class="op" id="3194074">)</span>&nbsp;<span class="ident" id="3194076">sockaddr</span><span class="op" id="3194084">(</span><span class="ident" id="3194085">family</span>&nbsp;<span class="builtintype" id="3194092">int</span><span class="op" id="3194095">)</span>&nbsp;<span class="op" id="3194097">(</span><span class="ident" id="3194098">syscall</span><span class="op" id="3194105">.</span><span class="ident" id="3194106">Sockaddr</span><span class="op" id="3194114">,</span>&nbsp;<span class="builtintype" id="3194116">error</span><span class="op" id="3194121">)</span>&nbsp;<span class="op" id="3194123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194126">if</span>&nbsp;<span class="ident" id="3194129">a</span>&nbsp;<span class="op" id="3194131">==</span>&nbsp;<span class="ident" id="3194134">nil</span>&nbsp;<span class="op" id="3194138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194142">return</span>&nbsp;<span class="ident" id="3194149">nil</span><span class="op" id="3194152">,</span>&nbsp;<span class="ident" id="3194154">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3194159">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194162">return</span>&nbsp;<span class="ident" id="3194169">ipToSockaddr</span><span class="op" id="3194181">(</span><span class="ident" id="3194182">family</span><span class="op" id="3194188">,</span>&nbsp;<span class="ident" id="3194190">a</span><span class="op" id="3194191">.</span><span class="ident" id="3194192">IP</span><span class="op" id="3194194">,</span>&nbsp;<span class="ident" id="3194196">a</span><span class="op" id="3194197">.</span><span class="ident" id="3194198">Port</span><span class="op" id="3194202">,</span>&nbsp;<span class="ident" id="3194204">a</span><span class="op" id="3194205">.</span><span class="ident" id="3194206">Zone</span><span class="op" id="3194210">)</span><br>
<span class="lineno"></span><span class="op" id="3194212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3194215">//&nbsp;UDPConn&nbsp;is&nbsp;the&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;and&nbsp;PacketConn&nbsp;interfaces</span><br>
<span class="lineno"></span><span class="comment" id="3194286">//&nbsp;for&nbsp;UDP&nbsp;network&nbsp;connections.</span><br>
<span class="lineno">50</span><span class="keyword" id="3194318">type</span>&nbsp;<span class="ident" id="3194323">UDPConn</span>&nbsp;<span class="keyword" id="3194331">struct</span>&nbsp;<span class="op" id="3194338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3194341">conn</span><br>
<span class="lineno"></span><span class="op" id="3194346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3194349">func</span>&nbsp;<span class="ident" id="3194354">newUDPConn</span><span class="op" id="3194364">(</span><span class="ident" id="3194365">fd</span>&nbsp;<span class="op" id="3194368">*</span><span class="ident" id="3194369">netFD</span><span class="op" id="3194374">)</span>&nbsp;<span class="op" id="3194376">*</span><span class="ident" id="3194377">UDPConn</span>&nbsp;<span class="op" id="3194385">{</span>&nbsp;<span class="keyword" id="3194387">return</span>&nbsp;<span class="op" id="3194394">&amp;</span><span class="ident" id="3194395">UDPConn</span><span class="op" id="3194402">{</span><span class="ident" id="3194403">conn</span><span class="op" id="3194407">{</span><span class="ident" id="3194408">fd</span><span class="op" id="3194410">}</span><span class="op" id="3194411">}</span>&nbsp;<span class="op" id="3194413">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="3194416">//&nbsp;ReadFromUDP&nbsp;reads&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3194486">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;return&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3194557">//&nbsp;that&nbsp;was&nbsp;on&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3194584">//</span><br>
<span class="lineno">60</span><span class="comment" id="3194587">//&nbsp;ReadFromUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3194651">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3194718">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3194738">func</span>&nbsp;<span class="op" id="3194743">(</span><span class="ident" id="3194744">c</span>&nbsp;<span class="op" id="3194746">*</span><span class="ident" id="3194747">UDPConn</span><span class="op" id="3194754">)</span>&nbsp;<span class="ident" id="3194756">ReadFromUDP</span><span class="op" id="3194767">(</span><span class="ident" id="3194768">b</span>&nbsp;<span class="op" id="3194770">[</span><span class="op" id="3194771">]</span><span class="builtintype" id="3194772">byte</span><span class="op" id="3194776">)</span>&nbsp;<span class="op" id="3194778">(</span><span class="ident" id="3194779">n</span>&nbsp;<span class="builtintype" id="3194781">int</span><span class="op" id="3194784">,</span>&nbsp;<span class="ident" id="3194786">addr</span>&nbsp;<span class="op" id="3194791">*</span><span class="ident" id="3194792">UDPAddr</span><span class="op" id="3194799">,</span>&nbsp;<span class="ident" id="3194801">err</span>&nbsp;<span class="builtintype" id="3194805">error</span><span class="op" id="3194810">)</span>&nbsp;<span class="op" id="3194812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194815">if</span>&nbsp;<span class="op" id="3194818">!</span><span class="ident" id="3194819">c</span><span class="op" id="3194820">.</span><span class="ident" id="3194821">ok</span><span class="op" id="3194823">(</span><span class="op" id="3194824">)</span>&nbsp;<span class="op" id="3194826">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194830">return</span>&nbsp;<span class="num" id="3194837">0</span><span class="op" id="3194838">,</span>&nbsp;<span class="ident" id="3194840">nil</span><span class="op" id="3194843">,</span>&nbsp;<span class="ident" id="3194845">syscall</span><span class="op" id="3194852">.</span><span class="ident" id="3194853">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3194861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3194864">n</span><span class="op" id="3194865">,</span>&nbsp;<span class="ident" id="3194867">sa</span><span class="op" id="3194869">,</span>&nbsp;<span class="ident" id="3194871">err</span>&nbsp;<span class="op" id="3194875">:=</span>&nbsp;<span class="ident" id="3194878">c</span><span class="op" id="3194879">.</span><span class="ident" id="3194880">fd</span><span class="op" id="3194882">.</span><span class="ident" id="3194883">readFrom</span><span class="op" id="3194891">(</span><span class="ident" id="3194892">b</span><span class="op" id="3194893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194896">switch</span>&nbsp;<span class="ident" id="3194903">sa</span>&nbsp;<span class="op" id="3194906">:=</span>&nbsp;<span class="ident" id="3194909">sa</span><span class="op" id="3194911">.</span><span class="op" id="3194912">(</span><span class="keyword" id="3194913">type</span><span class="op" id="3194917">)</span>&nbsp;<span class="op" id="3194919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3194922">case</span>&nbsp;<span class="op" id="3194927">*</span><span class="ident" id="3194928">syscall</span><span class="op" id="3194935">.</span><span class="ident" id="3194936">SockaddrInet4</span><span class="op" id="3194949">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3194953">addr</span>&nbsp;<span class="op" id="3194958">=</span>&nbsp;<span class="op" id="3194960">&amp;</span><span class="ident" id="3194961">UDPAddr</span><span class="op" id="3194968">{</span><span class="ident" id="3194969">IP</span><span class="op" id="3194971">:</span>&nbsp;<span class="ident" id="3194973">sa</span><span class="op" id="3194975">.</span><span class="ident" id="3194976">Addr</span><span class="op" id="3194980">[</span><span class="num" id="3194981">0</span><span class="op" id="3194982">:</span><span class="op" id="3194983">]</span><span class="op" id="3194984">,</span>&nbsp;<span class="ident" id="3194986">Port</span><span class="op" id="3194990">:</span>&nbsp;<span class="ident" id="3194992">sa</span><span class="op" id="3194994">.</span><span class="ident" id="3194995">Port</span><span class="op" id="3194999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195002">case</span>&nbsp;<span class="op" id="3195007">*</span><span class="ident" id="3195008">syscall</span><span class="op" id="3195015">.</span><span class="ident" id="3195016">SockaddrInet6</span><span class="op" id="3195029">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3195033">addr</span>&nbsp;<span class="op" id="3195038">=</span>&nbsp;<span class="op" id="3195040">&amp;</span><span class="ident" id="3195041">UDPAddr</span><span class="op" id="3195048">{</span><span class="ident" id="3195049">IP</span><span class="op" id="3195051">:</span>&nbsp;<span class="ident" id="3195053">sa</span><span class="op" id="3195055">.</span><span class="ident" id="3195056">Addr</span><span class="op" id="3195060">[</span><span class="num" id="3195061">0</span><span class="op" id="3195062">:</span><span class="op" id="3195063">]</span><span class="op" id="3195064">,</span>&nbsp;<span class="ident" id="3195066">Port</span><span class="op" id="3195070">:</span>&nbsp;<span class="ident" id="3195072">sa</span><span class="op" id="3195074">.</span><span class="ident" id="3195075">Port</span><span class="op" id="3195079">,</span>&nbsp;<span class="ident" id="3195081">Zone</span><span class="op" id="3195085">:</span>&nbsp;<span class="ident" id="3195087">zoneToString</span><span class="op" id="3195099">(</span><span class="builtintype" id="3195100">int</span><span class="op" id="3195103">(</span><span class="ident" id="3195104">sa</span><span class="op" id="3195106">.</span><span class="ident" id="3195107">ZoneId</span><span class="op" id="3195113">)</span><span class="op" id="3195114">)</span><span class="op" id="3195115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3195118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195121">return</span><br>
<span class="lineno">75</span><span class="op" id="3195128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3195131">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3195186">func</span>&nbsp;<span class="op" id="3195191">(</span><span class="ident" id="3195192">c</span>&nbsp;<span class="op" id="3195194">*</span><span class="ident" id="3195195">UDPConn</span><span class="op" id="3195202">)</span>&nbsp;<span class="ident" id="3195204">ReadFrom</span><span class="op" id="3195212">(</span><span class="ident" id="3195213">b</span>&nbsp;<span class="op" id="3195215">[</span><span class="op" id="3195216">]</span><span class="builtintype" id="3195217">byte</span><span class="op" id="3195221">)</span>&nbsp;<span class="op" id="3195223">(</span><span class="builtintype" id="3195224">int</span><span class="op" id="3195227">,</span>&nbsp;<span class="ident" id="3195229">Addr</span><span class="op" id="3195233">,</span>&nbsp;<span class="builtintype" id="3195235">error</span><span class="op" id="3195240">)</span>&nbsp;<span class="op" id="3195242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195245">if</span>&nbsp;<span class="op" id="3195248">!</span><span class="ident" id="3195249">c</span><span class="op" id="3195250">.</span><span class="ident" id="3195251">ok</span><span class="op" id="3195253">(</span><span class="op" id="3195254">)</span>&nbsp;<span class="op" id="3195256">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195260">return</span>&nbsp;<span class="num" id="3195267">0</span><span class="op" id="3195268">,</span>&nbsp;<span class="ident" id="3195270">nil</span><span class="op" id="3195273">,</span>&nbsp;<span class="ident" id="3195275">syscall</span><span class="op" id="3195282">.</span><span class="ident" id="3195283">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3195291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3195294">n</span><span class="op" id="3195295">,</span>&nbsp;<span class="ident" id="3195297">addr</span><span class="op" id="3195301">,</span>&nbsp;<span class="ident" id="3195303">err</span>&nbsp;<span class="op" id="3195307">:=</span>&nbsp;<span class="ident" id="3195310">c</span><span class="op" id="3195311">.</span><span class="ident" id="3195312">ReadFromUDP</span><span class="op" id="3195323">(</span><span class="ident" id="3195324">b</span><span class="op" id="3195325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195328">return</span>&nbsp;<span class="ident" id="3195335">n</span><span class="op" id="3195336">,</span>&nbsp;<span class="ident" id="3195338">addr</span><span class="op" id="3195342">.</span><span class="ident" id="3195343">toAddr</span><span class="op" id="3195349">(</span><span class="op" id="3195350">)</span><span class="op" id="3195351">,</span>&nbsp;<span class="ident" id="3195353">err</span><br>
<span class="lineno"></span><span class="op" id="3195357">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3195360">//&nbsp;ReadMsgUDP&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3195428">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3195496">//&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3195564">//&nbsp;flags&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno">90</span><span class="comment" id="3195631">//&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="3195642">func</span>&nbsp;<span class="op" id="3195647">(</span><span class="ident" id="3195648">c</span>&nbsp;<span class="op" id="3195650">*</span><span class="ident" id="3195651">UDPConn</span><span class="op" id="3195658">)</span>&nbsp;<span class="ident" id="3195660">ReadMsgUDP</span><span class="op" id="3195670">(</span><span class="ident" id="3195671">b</span><span class="op" id="3195672">,</span>&nbsp;<span class="ident" id="3195674">oob</span>&nbsp;<span class="op" id="3195678">[</span><span class="op" id="3195679">]</span><span class="builtintype" id="3195680">byte</span><span class="op" id="3195684">)</span>&nbsp;<span class="op" id="3195686">(</span><span class="ident" id="3195687">n</span><span class="op" id="3195688">,</span>&nbsp;<span class="ident" id="3195690">oobn</span><span class="op" id="3195694">,</span>&nbsp;<span class="ident" id="3195696">flags</span>&nbsp;<span class="builtintype" id="3195702">int</span><span class="op" id="3195705">,</span>&nbsp;<span class="ident" id="3195707">addr</span>&nbsp;<span class="op" id="3195712">*</span><span class="ident" id="3195713">UDPAddr</span><span class="op" id="3195720">,</span>&nbsp;<span class="ident" id="3195722">err</span>&nbsp;<span class="builtintype" id="3195726">error</span><span class="op" id="3195731">)</span>&nbsp;<span class="op" id="3195733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195736">if</span>&nbsp;<span class="op" id="3195739">!</span><span class="ident" id="3195740">c</span><span class="op" id="3195741">.</span><span class="ident" id="3195742">ok</span><span class="op" id="3195744">(</span><span class="op" id="3195745">)</span>&nbsp;<span class="op" id="3195747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195751">return</span>&nbsp;<span class="num" id="3195758">0</span><span class="op" id="3195759">,</span>&nbsp;<span class="num" id="3195761">0</span><span class="op" id="3195762">,</span>&nbsp;<span class="num" id="3195764">0</span><span class="op" id="3195765">,</span>&nbsp;<span class="ident" id="3195767">nil</span><span class="op" id="3195770">,</span>&nbsp;<span class="ident" id="3195772">syscall</span><span class="op" id="3195779">.</span><span class="ident" id="3195780">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3195788">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195791">var</span>&nbsp;<span class="ident" id="3195795">sa</span>&nbsp;<span class="ident" id="3195798">syscall</span><span class="op" id="3195805">.</span><span class="ident" id="3195806">Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3195816">n</span><span class="op" id="3195817">,</span>&nbsp;<span class="ident" id="3195819">oobn</span><span class="op" id="3195823">,</span>&nbsp;<span class="ident" id="3195825">flags</span><span class="op" id="3195830">,</span>&nbsp;<span class="ident" id="3195832">sa</span><span class="op" id="3195834">,</span>&nbsp;<span class="ident" id="3195836">err</span>&nbsp;<span class="op" id="3195840">=</span>&nbsp;<span class="ident" id="3195842">c</span><span class="op" id="3195843">.</span><span class="ident" id="3195844">fd</span><span class="op" id="3195846">.</span><span class="ident" id="3195847">readMsg</span><span class="op" id="3195854">(</span><span class="ident" id="3195855">b</span><span class="op" id="3195856">,</span>&nbsp;<span class="ident" id="3195858">oob</span><span class="op" id="3195861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195864">switch</span>&nbsp;<span class="ident" id="3195871">sa</span>&nbsp;<span class="op" id="3195874">:=</span>&nbsp;<span class="ident" id="3195877">sa</span><span class="op" id="3195879">.</span><span class="op" id="3195880">(</span><span class="keyword" id="3195881">type</span><span class="op" id="3195885">)</span>&nbsp;<span class="op" id="3195887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195890">case</span>&nbsp;<span class="op" id="3195895">*</span><span class="ident" id="3195896">syscall</span><span class="op" id="3195903">.</span><span class="ident" id="3195904">SockaddrInet4</span><span class="op" id="3195917">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3195921">addr</span>&nbsp;<span class="op" id="3195926">=</span>&nbsp;<span class="op" id="3195928">&amp;</span><span class="ident" id="3195929">UDPAddr</span><span class="op" id="3195936">{</span><span class="ident" id="3195937">IP</span><span class="op" id="3195939">:</span>&nbsp;<span class="ident" id="3195941">sa</span><span class="op" id="3195943">.</span><span class="ident" id="3195944">Addr</span><span class="op" id="3195948">[</span><span class="num" id="3195949">0</span><span class="op" id="3195950">:</span><span class="op" id="3195951">]</span><span class="op" id="3195952">,</span>&nbsp;<span class="ident" id="3195954">Port</span><span class="op" id="3195958">:</span>&nbsp;<span class="ident" id="3195960">sa</span><span class="op" id="3195962">.</span><span class="ident" id="3195963">Port</span><span class="op" id="3195967">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3195970">case</span>&nbsp;<span class="op" id="3195975">*</span><span class="ident" id="3195976">syscall</span><span class="op" id="3195983">.</span><span class="ident" id="3195984">SockaddrInet6</span><span class="op" id="3195997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3196001">addr</span>&nbsp;<span class="op" id="3196006">=</span>&nbsp;<span class="op" id="3196008">&amp;</span><span class="ident" id="3196009">UDPAddr</span><span class="op" id="3196016">{</span><span class="ident" id="3196017">IP</span><span class="op" id="3196019">:</span>&nbsp;<span class="ident" id="3196021">sa</span><span class="op" id="3196023">.</span><span class="ident" id="3196024">Addr</span><span class="op" id="3196028">[</span><span class="num" id="3196029">0</span><span class="op" id="3196030">:</span><span class="op" id="3196031">]</span><span class="op" id="3196032">,</span>&nbsp;<span class="ident" id="3196034">Port</span><span class="op" id="3196038">:</span>&nbsp;<span class="ident" id="3196040">sa</span><span class="op" id="3196042">.</span><span class="ident" id="3196043">Port</span><span class="op" id="3196047">,</span>&nbsp;<span class="ident" id="3196049">Zone</span><span class="op" id="3196053">:</span>&nbsp;<span class="ident" id="3196055">zoneToString</span><span class="op" id="3196067">(</span><span class="builtintype" id="3196068">int</span><span class="op" id="3196071">(</span><span class="ident" id="3196072">sa</span><span class="op" id="3196074">.</span><span class="ident" id="3196075">ZoneId</span><span class="op" id="3196081">)</span><span class="op" id="3196082">)</span><span class="op" id="3196083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3196086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3196089">return</span><br>
<span class="lineno"></span><span class="op" id="3196096">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="3196099">//&nbsp;WriteToUDP&nbsp;writes&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3196168">//&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3196179">//</span><br>
<span class="lineno"></span><span class="comment" id="3196182">//&nbsp;WriteToUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">110</span><span class="comment" id="3196245">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3196312">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3196381">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3196394">func</span>&nbsp;<span class="op" id="3196399">(</span><span class="ident" id="3196400">c</span>&nbsp;<span class="op" id="3196402">*</span><span class="ident" id="3196403">UDPConn</span><span class="op" id="3196410">)</span>&nbsp;<span class="ident" id="3196412">WriteToUDP</span><span class="op" id="3196422">(</span><span class="ident" id="3196423">b</span>&nbsp;<span class="op" id="3196425">[</span><span class="op" id="3196426">]</span><span class="builtintype" id="3196427">byte</span><span class="op" id="3196431">,</span>&nbsp;<span class="ident" id="3196433">addr</span>&nbsp;<span class="op" id="3196438">*</span><span class="ident" id="3196439">UDPAddr</span><span class="op" id="3196446">)</span>&nbsp;<span class="op" id="3196448">(</span><span class="builtintype" id="3196449">int</span><span class="op" id="3196452">,</span>&nbsp;<span class="builtintype" id="3196454">error</span><span class="op" id="3196459">)</span>&nbsp;<span class="op" id="3196461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3196464">if</span>&nbsp;<span class="op" id="3196467">!</span><span class="ident" id="3196468">c</span><span class="op" id="3196469">.</span><span class="ident" id="3196470">ok</span><span class="op" id="3196472">(</span><span class="op" id="3196473">)</span>&nbsp;<span class="op" id="3196475">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3196479">return</span>&nbsp;<span class="num" id="3196486">0</span><span class="op" id="3196487">,</span>&nbsp;<span class="ident" id="3196489">syscall</span><span class="op" id="3196496">.</span><span class="ident" id="3196497">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3196505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3196508">if</span>&nbsp;<span class="ident" id="3196511">c</span><span class="op" id="3196512">.</span><span class="ident" id="3196513">fd</span><span class="op" id="3196515">.</span><span class="ident" id="3196516">isConnected</span>&nbsp;<span class="op" id="3196528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3196532">return</span>&nbsp;<span class="num" id="3196539">0</span><span class="op" id="3196540">,</span>&nbsp;<span class="op" id="3196542">&amp;</span><span class="ident" id="3196543">OpError</span><span class="op" id="3196550">{</span><span class="string" id="3196551">&#34;write&#34;</span><span class="op" id="3196558">,</span>&nbsp;<span class="ident" id="3196560">c</span><span class="op" id="3196561">.</span><span class="ident" id="3196562">fd</span><span class="op" id="3196564">.</span><span class="ident" id="3196565">net</span><span class="op" id="3196568">,</span>&nbsp;<span class="ident" id="3196570">addr</span><span class="op" id="3196574">,</span>&nbsp;<span class="ident" id="3196576">ErrWriteToConnected</span><span class="op" id="3196595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3196598">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3196601">if</span>&nbsp;<span class="ident" id="3196604">addr</span>&nbsp;<span class="op" id="3196609">==</span>&nbsp;<span class="ident" id="3196612">nil</span>&nbsp;<span class="op" id="3196616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3196620">return</span>&nbsp;<span class="num" id="3196627">0</span><span class="op" id="3196628">,</span>&nbsp;<span class="op" id="3196630">&amp;</span><span class="ident" id="3196631">OpError</span><span class="op" id="3196638">{</span><span class="ident" id="3196639">Op</span><span class="op" id="3196641">:</span>&nbsp;<span class="string" id="3196643">&#34;write&#34;</span><span class="op" id="3196650">,</span>&nbsp;<span class="ident" id="3196652">Net</span><span class="op" id="3196655">:</span>&nbsp;<span class="ident" id="3196657">c</span><span class="op" id="3196658">.</span><span class="ident" id="3196659">fd</span><span class="op" id="3196661">.</span><span class="ident" id="3196662">net</span><span class="op" id="3196665">,</span>&nbsp;<span class="ident" id="3196667">Addr</span><span class="op" id="3196671">:</span>&nbsp;<span class="ident" id="3196673">nil</span><span class="op" id="3196676">,</span>&nbsp;<span class="ident" id="3196678">Err</span><span class="op" id="3196681">:</span>&nbsp;<span class="ident" id="3196683">errMissingAddress</span><span class="op" id="3196700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3196703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3196706">sa</span><span class="op" id="3196708">,</span>&nbsp;<span class="ident" id="3196710">err</span>&nbsp;<span class="op" id="3196714">:=</span>&nbsp;<span class="ident" id="3196717">addr</span><span class="op" id="3196721">.</span><span class="ident" id="3196722">sockaddr</span><span class="op" id="3196730">(</span><span class="ident" id="3196731">c</span><span class="op" id="3196732">.</span><span class="ident" id="3196733">fd</span><span class="op" id="3196735">.</span><span class="ident" id="3196736">family</span><span class="op" id="3196742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3196745">if</span>&nbsp;<span class="ident" id="3196748">err</span>&nbsp;<span class="op" id="3196752">!=</span>&nbsp;<span class="ident" id="3196755">nil</span>&nbsp;<span class="op" id="3196759">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3196763">return</span>&nbsp;<span class="num" id="3196770">0</span><span class="op" id="3196771">,</span>&nbsp;<span class="op" id="3196773">&amp;</span><span class="ident" id="3196774">OpError</span><span class="op" id="3196781">{</span><span class="string" id="3196782">&#34;write&#34;</span><span class="op" id="3196789">,</span>&nbsp;<span class="ident" id="3196791">c</span><span class="op" id="3196792">.</span><span class="ident" id="3196793">fd</span><span class="op" id="3196795">.</span><span class="ident" id="3196796">net</span><span class="op" id="3196799">,</span>&nbsp;<span class="ident" id="3196801">addr</span><span class="op" id="3196805">,</span>&nbsp;<span class="ident" id="3196807">err</span><span class="op" id="3196810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3196813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3196816">return</span>&nbsp;<span class="ident" id="3196823">c</span><span class="op" id="3196824">.</span><span class="ident" id="3196825">fd</span><span class="op" id="3196827">.</span><span class="ident" id="3196828">writeTo</span><span class="op" id="3196835">(</span><span class="ident" id="3196836">b</span><span class="op" id="3196837">,</span>&nbsp;<span class="ident" id="3196839">sa</span><span class="op" id="3196841">)</span><br>
<span class="lineno"></span><span class="op" id="3196843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3196846">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3196899">func</span>&nbsp;<span class="op" id="3196904">(</span><span class="ident" id="3196905">c</span>&nbsp;<span class="op" id="3196907">*</span><span class="ident" id="3196908">UDPConn</span><span class="op" id="3196915">)</span>&nbsp;<span class="ident" id="3196917">WriteTo</span><span class="op" id="3196924">(</span><span class="ident" id="3196925">b</span>&nbsp;<span class="op" id="3196927">[</span><span class="op" id="3196928">]</span><span class="builtintype" id="3196929">byte</span><span class="op" id="3196933">,</span>&nbsp;<span class="ident" id="3196935">addr</span>&nbsp;<span class="ident" id="3196940">Addr</span><span class="op" id="3196944">)</span>&nbsp;<span class="op" id="3196946">(</span><span class="builtintype" id="3196947">int</span><span class="op" id="3196950">,</span>&nbsp;<span class="builtintype" id="3196952">error</span><span class="op" id="3196957">)</span>&nbsp;<span class="op" id="3196959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3196962">if</span>&nbsp;<span class="op" id="3196965">!</span><span class="ident" id="3196966">c</span><span class="op" id="3196967">.</span><span class="ident" id="3196968">ok</span><span class="op" id="3196970">(</span><span class="op" id="3196971">)</span>&nbsp;<span class="op" id="3196973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3196977">return</span>&nbsp;<span class="num" id="3196984">0</span><span class="op" id="3196985">,</span>&nbsp;<span class="ident" id="3196987">syscall</span><span class="op" id="3196994">.</span><span class="ident" id="3196995">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3197003">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3197006">a</span><span class="op" id="3197007">,</span>&nbsp;<span class="ident" id="3197009">ok</span>&nbsp;<span class="op" id="3197012">:=</span>&nbsp;<span class="ident" id="3197015">addr</span><span class="op" id="3197019">.</span><span class="op" id="3197020">(</span><span class="op" id="3197021">*</span><span class="ident" id="3197022">UDPAddr</span><span class="op" id="3197029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3197032">if</span>&nbsp;<span class="op" id="3197035">!</span><span class="ident" id="3197036">ok</span>&nbsp;<span class="op" id="3197039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3197043">return</span>&nbsp;<span class="num" id="3197050">0</span><span class="op" id="3197051">,</span>&nbsp;<span class="op" id="3197053">&amp;</span><span class="ident" id="3197054">OpError</span><span class="op" id="3197061">{</span><span class="string" id="3197062">&#34;write&#34;</span><span class="op" id="3197069">,</span>&nbsp;<span class="ident" id="3197071">c</span><span class="op" id="3197072">.</span><span class="ident" id="3197073">fd</span><span class="op" id="3197075">.</span><span class="ident" id="3197076">net</span><span class="op" id="3197079">,</span>&nbsp;<span class="ident" id="3197081">addr</span><span class="op" id="3197085">,</span>&nbsp;<span class="ident" id="3197087">syscall</span><span class="op" id="3197094">.</span><span class="ident" id="3197095">EINVAL</span><span class="op" id="3197101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3197104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3197107">return</span>&nbsp;<span class="ident" id="3197114">c</span><span class="op" id="3197115">.</span><span class="ident" id="3197116">WriteToUDP</span><span class="op" id="3197126">(</span><span class="ident" id="3197127">b</span><span class="op" id="3197128">,</span>&nbsp;<span class="ident" id="3197130">a</span><span class="op" id="3197131">)</span><br>
<span class="lineno">140</span><span class="op" id="3197133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3197136">//&nbsp;WriteMsgUDP&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3197207">//&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3197274">//&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">145</span><span class="keyword" id="3197326">func</span>&nbsp;<span class="op" id="3197331">(</span><span class="ident" id="3197332">c</span>&nbsp;<span class="op" id="3197334">*</span><span class="ident" id="3197335">UDPConn</span><span class="op" id="3197342">)</span>&nbsp;<span class="ident" id="3197344">WriteMsgUDP</span><span class="op" id="3197355">(</span><span class="ident" id="3197356">b</span><span class="op" id="3197357">,</span>&nbsp;<span class="ident" id="3197359">oob</span>&nbsp;<span class="op" id="3197363">[</span><span class="op" id="3197364">]</span><span class="builtintype" id="3197365">byte</span><span class="op" id="3197369">,</span>&nbsp;<span class="ident" id="3197371">addr</span>&nbsp;<span class="op" id="3197376">*</span><span class="ident" id="3197377">UDPAddr</span><span class="op" id="3197384">)</span>&nbsp;<span class="op" id="3197386">(</span><span class="ident" id="3197387">n</span><span class="op" id="3197388">,</span>&nbsp;<span class="ident" id="3197390">oobn</span>&nbsp;<span class="builtintype" id="3197395">int</span><span class="op" id="3197398">,</span>&nbsp;<span class="ident" id="3197400">err</span>&nbsp;<span class="builtintype" id="3197404">error</span><span class="op" id="3197409">)</span>&nbsp;<span class="op" id="3197411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3197414">if</span>&nbsp;<span class="op" id="3197417">!</span><span class="ident" id="3197418">c</span><span class="op" id="3197419">.</span><span class="ident" id="3197420">ok</span><span class="op" id="3197422">(</span><span class="op" id="3197423">)</span>&nbsp;<span class="op" id="3197425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3197429">return</span>&nbsp;<span class="num" id="3197436">0</span><span class="op" id="3197437">,</span>&nbsp;<span class="num" id="3197439">0</span><span class="op" id="3197440">,</span>&nbsp;<span class="ident" id="3197442">syscall</span><span class="op" id="3197449">.</span><span class="ident" id="3197450">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3197458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3197461">if</span>&nbsp;<span class="ident" id="3197464">c</span><span class="op" id="3197465">.</span><span class="ident" id="3197466">fd</span><span class="op" id="3197468">.</span><span class="ident" id="3197469">isConnected</span>&nbsp;<span class="op" id="3197481">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3197485">return</span>&nbsp;<span class="num" id="3197492">0</span><span class="op" id="3197493">,</span>&nbsp;<span class="num" id="3197495">0</span><span class="op" id="3197496">,</span>&nbsp;<span class="op" id="3197498">&amp;</span><span class="ident" id="3197499">OpError</span><span class="op" id="3197506">{</span><span class="string" id="3197507">&#34;write&#34;</span><span class="op" id="3197514">,</span>&nbsp;<span class="ident" id="3197516">c</span><span class="op" id="3197517">.</span><span class="ident" id="3197518">fd</span><span class="op" id="3197520">.</span><span class="ident" id="3197521">net</span><span class="op" id="3197524">,</span>&nbsp;<span class="ident" id="3197526">addr</span><span class="op" id="3197530">,</span>&nbsp;<span class="ident" id="3197532">ErrWriteToConnected</span><span class="op" id="3197551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3197554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3197557">if</span>&nbsp;<span class="ident" id="3197560">addr</span>&nbsp;<span class="op" id="3197565">==</span>&nbsp;<span class="ident" id="3197568">nil</span>&nbsp;<span class="op" id="3197572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3197576">return</span>&nbsp;<span class="num" id="3197583">0</span><span class="op" id="3197584">,</span>&nbsp;<span class="num" id="3197586">0</span><span class="op" id="3197587">,</span>&nbsp;<span class="op" id="3197589">&amp;</span><span class="ident" id="3197590">OpError</span><span class="op" id="3197597">{</span><span class="ident" id="3197598">Op</span><span class="op" id="3197600">:</span>&nbsp;<span class="string" id="3197602">&#34;write&#34;</span><span class="op" id="3197609">,</span>&nbsp;<span class="ident" id="3197611">Net</span><span class="op" id="3197614">:</span>&nbsp;<span class="ident" id="3197616">c</span><span class="op" id="3197617">.</span><span class="ident" id="3197618">fd</span><span class="op" id="3197620">.</span><span class="ident" id="3197621">net</span><span class="op" id="3197624">,</span>&nbsp;<span class="ident" id="3197626">Addr</span><span class="op" id="3197630">:</span>&nbsp;<span class="ident" id="3197632">nil</span><span class="op" id="3197635">,</span>&nbsp;<span class="ident" id="3197637">Err</span><span class="op" id="3197640">:</span>&nbsp;<span class="ident" id="3197642">errMissingAddress</span><span class="op" id="3197659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3197662">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3197665">sa</span><span class="op" id="3197667">,</span>&nbsp;<span class="ident" id="3197669">err</span>&nbsp;<span class="op" id="3197673">:=</span>&nbsp;<span class="ident" id="3197676">addr</span><span class="op" id="3197680">.</span><span class="ident" id="3197681">sockaddr</span><span class="op" id="3197689">(</span><span class="ident" id="3197690">c</span><span class="op" id="3197691">.</span><span class="ident" id="3197692">fd</span><span class="op" id="3197694">.</span><span class="ident" id="3197695">family</span><span class="op" id="3197701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3197704">if</span>&nbsp;<span class="ident" id="3197707">err</span>&nbsp;<span class="op" id="3197711">!=</span>&nbsp;<span class="ident" id="3197714">nil</span>&nbsp;<span class="op" id="3197718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3197722">return</span>&nbsp;<span class="num" id="3197729">0</span><span class="op" id="3197730">,</span>&nbsp;<span class="num" id="3197732">0</span><span class="op" id="3197733">,</span>&nbsp;<span class="op" id="3197735">&amp;</span><span class="ident" id="3197736">OpError</span><span class="op" id="3197743">{</span><span class="string" id="3197744">&#34;write&#34;</span><span class="op" id="3197751">,</span>&nbsp;<span class="ident" id="3197753">c</span><span class="op" id="3197754">.</span><span class="ident" id="3197755">fd</span><span class="op" id="3197757">.</span><span class="ident" id="3197758">net</span><span class="op" id="3197761">,</span>&nbsp;<span class="ident" id="3197763">addr</span><span class="op" id="3197767">,</span>&nbsp;<span class="ident" id="3197769">err</span><span class="op" id="3197772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3197775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3197778">return</span>&nbsp;<span class="ident" id="3197785">c</span><span class="op" id="3197786">.</span><span class="ident" id="3197787">fd</span><span class="op" id="3197789">.</span><span class="ident" id="3197790">writeMsg</span><span class="op" id="3197798">(</span><span class="ident" id="3197799">b</span><span class="op" id="3197800">,</span>&nbsp;<span class="ident" id="3197802">oob</span><span class="op" id="3197805">,</span>&nbsp;<span class="ident" id="3197807">sa</span><span class="op" id="3197809">)</span><br>
<span class="lineno">160</span><span class="op" id="3197811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3197814">//&nbsp;DialUDP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="3197882">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil,&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3197953">//&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno">165</span><span class="keyword" id="3198002">func</span>&nbsp;<span class="ident" id="3198007">DialUDP</span><span class="op" id="3198014">(</span><span class="ident" id="3198015">net</span>&nbsp;<span class="builtintype" id="3198019">string</span><span class="op" id="3198025">,</span>&nbsp;<span class="ident" id="3198027">laddr</span><span class="op" id="3198032">,</span>&nbsp;<span class="ident" id="3198034">raddr</span>&nbsp;<span class="op" id="3198040">*</span><span class="ident" id="3198041">UDPAddr</span><span class="op" id="3198048">)</span>&nbsp;<span class="op" id="3198050">(</span><span class="op" id="3198051">*</span><span class="ident" id="3198052">UDPConn</span><span class="op" id="3198059">,</span>&nbsp;<span class="builtintype" id="3198061">error</span><span class="op" id="3198066">)</span>&nbsp;<span class="op" id="3198068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3198071">switch</span>&nbsp;<span class="ident" id="3198078">net</span>&nbsp;<span class="op" id="3198082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3198085">case</span>&nbsp;<span class="string" id="3198090">&#34;udp&#34;</span><span class="op" id="3198095">,</span>&nbsp;<span class="string" id="3198097">&#34;udp4&#34;</span><span class="op" id="3198103">,</span>&nbsp;<span class="string" id="3198105">&#34;udp6&#34;</span><span class="op" id="3198111">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3198114">default</span><span class="op" id="3198121">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3198125">return</span>&nbsp;<span class="ident" id="3198132">nil</span><span class="op" id="3198135">,</span>&nbsp;<span class="op" id="3198137">&amp;</span><span class="ident" id="3198138">OpError</span><span class="op" id="3198145">{</span><span class="ident" id="3198146">Op</span><span class="op" id="3198148">:</span>&nbsp;<span class="string" id="3198150">&#34;dial&#34;</span><span class="op" id="3198156">,</span>&nbsp;<span class="ident" id="3198158">Net</span><span class="op" id="3198161">:</span>&nbsp;<span class="ident" id="3198163">net</span><span class="op" id="3198166">,</span>&nbsp;<span class="ident" id="3198168">Addr</span><span class="op" id="3198172">:</span>&nbsp;<span class="ident" id="3198174">raddr</span><span class="op" id="3198179">,</span>&nbsp;<span class="ident" id="3198181">Err</span><span class="op" id="3198184">:</span>&nbsp;<span class="ident" id="3198186">UnknownNetworkError</span><span class="op" id="3198205">(</span><span class="ident" id="3198206">net</span><span class="op" id="3198209">)</span><span class="op" id="3198210">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3198213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3198216">if</span>&nbsp;<span class="ident" id="3198219">raddr</span>&nbsp;<span class="op" id="3198225">==</span>&nbsp;<span class="ident" id="3198228">nil</span>&nbsp;<span class="op" id="3198232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3198236">return</span>&nbsp;<span class="ident" id="3198243">nil</span><span class="op" id="3198246">,</span>&nbsp;<span class="op" id="3198248">&amp;</span><span class="ident" id="3198249">OpError</span><span class="op" id="3198256">{</span><span class="ident" id="3198257">Op</span><span class="op" id="3198259">:</span>&nbsp;<span class="string" id="3198261">&#34;dial&#34;</span><span class="op" id="3198267">,</span>&nbsp;<span class="ident" id="3198269">Net</span><span class="op" id="3198272">:</span>&nbsp;<span class="ident" id="3198274">net</span><span class="op" id="3198277">,</span>&nbsp;<span class="ident" id="3198279">Addr</span><span class="op" id="3198283">:</span>&nbsp;<span class="ident" id="3198285">nil</span><span class="op" id="3198288">,</span>&nbsp;<span class="ident" id="3198290">Err</span><span class="op" id="3198293">:</span>&nbsp;<span class="ident" id="3198295">errMissingAddress</span><span class="op" id="3198312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3198315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3198318">return</span>&nbsp;<span class="ident" id="3198325">dialUDP</span><span class="op" id="3198332">(</span><span class="ident" id="3198333">net</span><span class="op" id="3198336">,</span>&nbsp;<span class="ident" id="3198338">laddr</span><span class="op" id="3198343">,</span>&nbsp;<span class="ident" id="3198345">raddr</span><span class="op" id="3198350">,</span>&nbsp;<span class="ident" id="3198352">noDeadline</span><span class="op" id="3198362">)</span><br>
<span class="lineno">175</span><span class="op" id="3198364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3198367">func</span>&nbsp;<span class="ident" id="3198372">dialUDP</span><span class="op" id="3198379">(</span><span class="ident" id="3198380">net</span>&nbsp;<span class="builtintype" id="3198384">string</span><span class="op" id="3198390">,</span>&nbsp;<span class="ident" id="3198392">laddr</span><span class="op" id="3198397">,</span>&nbsp;<span class="ident" id="3198399">raddr</span>&nbsp;<span class="op" id="3198405">*</span><span class="ident" id="3198406">UDPAddr</span><span class="op" id="3198413">,</span>&nbsp;<span class="ident" id="3198415">deadline</span>&nbsp;<span class="ident" id="3198424">time</span><span class="op" id="3198428">.</span><span class="ident" id="3198429">Time</span><span class="op" id="3198433">)</span>&nbsp;<span class="op" id="3198435">(</span><span class="op" id="3198436">*</span><span class="ident" id="3198437">UDPConn</span><span class="op" id="3198444">,</span>&nbsp;<span class="builtintype" id="3198446">error</span><span class="op" id="3198451">)</span>&nbsp;<span class="op" id="3198453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3198456">fd</span><span class="op" id="3198458">,</span>&nbsp;<span class="ident" id="3198460">err</span>&nbsp;<span class="op" id="3198464">:=</span>&nbsp;<span class="ident" id="3198467">internetSocket</span><span class="op" id="3198481">(</span><span class="ident" id="3198482">net</span><span class="op" id="3198485">,</span>&nbsp;<span class="ident" id="3198487">laddr</span><span class="op" id="3198492">,</span>&nbsp;<span class="ident" id="3198494">raddr</span><span class="op" id="3198499">,</span>&nbsp;<span class="ident" id="3198501">deadline</span><span class="op" id="3198509">,</span>&nbsp;<span class="ident" id="3198511">syscall</span><span class="op" id="3198518">.</span><span class="ident" id="3198519">SOCK_DGRAM</span><span class="op" id="3198529">,</span>&nbsp;<span class="num" id="3198531">0</span><span class="op" id="3198532">,</span>&nbsp;<span class="string" id="3198534">&#34;dial&#34;</span><span class="op" id="3198540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3198543">if</span>&nbsp;<span class="ident" id="3198546">err</span>&nbsp;<span class="op" id="3198550">!=</span>&nbsp;<span class="ident" id="3198553">nil</span>&nbsp;<span class="op" id="3198557">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3198561">return</span>&nbsp;<span class="ident" id="3198568">nil</span><span class="op" id="3198571">,</span>&nbsp;<span class="op" id="3198573">&amp;</span><span class="ident" id="3198574">OpError</span><span class="op" id="3198581">{</span><span class="ident" id="3198582">Op</span><span class="op" id="3198584">:</span>&nbsp;<span class="string" id="3198586">&#34;dial&#34;</span><span class="op" id="3198592">,</span>&nbsp;<span class="ident" id="3198594">Net</span><span class="op" id="3198597">:</span>&nbsp;<span class="ident" id="3198599">net</span><span class="op" id="3198602">,</span>&nbsp;<span class="ident" id="3198604">Addr</span><span class="op" id="3198608">:</span>&nbsp;<span class="ident" id="3198610">raddr</span><span class="op" id="3198615">,</span>&nbsp;<span class="ident" id="3198617">Err</span><span class="op" id="3198620">:</span>&nbsp;<span class="ident" id="3198622">err</span><span class="op" id="3198625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3198628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3198631">return</span>&nbsp;<span class="ident" id="3198638">newUDPConn</span><span class="op" id="3198648">(</span><span class="ident" id="3198649">fd</span><span class="op" id="3198651">)</span><span class="op" id="3198652">,</span>&nbsp;<span class="ident" id="3198654">nil</span><br>
<span class="lineno"></span><span class="op" id="3198658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="3198661">//&nbsp;ListenUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;UDP&nbsp;packets&nbsp;addressed&nbsp;to&nbsp;the&nbsp;local</span><br>
<span class="lineno"></span><span class="comment" id="3198730">//&nbsp;address&nbsp;laddr.&nbsp;&nbsp;Net&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="3198801">//&nbsp;a&nbsp;port&nbsp;of&nbsp;0,&nbsp;ListenUDP&nbsp;will&nbsp;choose&nbsp;an&nbsp;available&nbsp;port.</span><br>
<span class="lineno"></span><span class="comment" id="3198858">//&nbsp;The&nbsp;LocalAddr&nbsp;method&nbsp;of&nbsp;the&nbsp;returned&nbsp;UDPConn&nbsp;can&nbsp;be&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3198921">//&nbsp;discover&nbsp;the&nbsp;port.&nbsp;&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo</span><br>
<span class="lineno">190</span><span class="comment" id="3198991">//&nbsp;methods&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;UDP&nbsp;packets&nbsp;with&nbsp;per-packet</span><br>
<span class="lineno"></span><span class="comment" id="3199062">//&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3199077">func</span>&nbsp;<span class="ident" id="3199082">ListenUDP</span><span class="op" id="3199091">(</span><span class="ident" id="3199092">net</span>&nbsp;<span class="builtintype" id="3199096">string</span><span class="op" id="3199102">,</span>&nbsp;<span class="ident" id="3199104">laddr</span>&nbsp;<span class="op" id="3199110">*</span><span class="ident" id="3199111">UDPAddr</span><span class="op" id="3199118">)</span>&nbsp;<span class="op" id="3199120">(</span><span class="op" id="3199121">*</span><span class="ident" id="3199122">UDPConn</span><span class="op" id="3199129">,</span>&nbsp;<span class="builtintype" id="3199131">error</span><span class="op" id="3199136">)</span>&nbsp;<span class="op" id="3199138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3199141">switch</span>&nbsp;<span class="ident" id="3199148">net</span>&nbsp;<span class="op" id="3199152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3199155">case</span>&nbsp;<span class="string" id="3199160">&#34;udp&#34;</span><span class="op" id="3199165">,</span>&nbsp;<span class="string" id="3199167">&#34;udp4&#34;</span><span class="op" id="3199173">,</span>&nbsp;<span class="string" id="3199175">&#34;udp6&#34;</span><span class="op" id="3199181">:</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3199184">default</span><span class="op" id="3199191">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3199195">return</span>&nbsp;<span class="ident" id="3199202">nil</span><span class="op" id="3199205">,</span>&nbsp;<span class="op" id="3199207">&amp;</span><span class="ident" id="3199208">OpError</span><span class="op" id="3199215">{</span><span class="ident" id="3199216">Op</span><span class="op" id="3199218">:</span>&nbsp;<span class="string" id="3199220">&#34;listen&#34;</span><span class="op" id="3199228">,</span>&nbsp;<span class="ident" id="3199230">Net</span><span class="op" id="3199233">:</span>&nbsp;<span class="ident" id="3199235">net</span><span class="op" id="3199238">,</span>&nbsp;<span class="ident" id="3199240">Addr</span><span class="op" id="3199244">:</span>&nbsp;<span class="ident" id="3199246">laddr</span><span class="op" id="3199251">,</span>&nbsp;<span class="ident" id="3199253">Err</span><span class="op" id="3199256">:</span>&nbsp;<span class="ident" id="3199258">UnknownNetworkError</span><span class="op" id="3199277">(</span><span class="ident" id="3199278">net</span><span class="op" id="3199281">)</span><span class="op" id="3199282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3199285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3199288">if</span>&nbsp;<span class="ident" id="3199291">laddr</span>&nbsp;<span class="op" id="3199297">==</span>&nbsp;<span class="ident" id="3199300">nil</span>&nbsp;<span class="op" id="3199304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3199308">laddr</span>&nbsp;<span class="op" id="3199314">=</span>&nbsp;<span class="op" id="3199316">&amp;</span><span class="ident" id="3199317">UDPAddr</span><span class="op" id="3199324">{</span><span class="op" id="3199325">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3199328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3199331">fd</span><span class="op" id="3199333">,</span>&nbsp;<span class="ident" id="3199335">err</span>&nbsp;<span class="op" id="3199339">:=</span>&nbsp;<span class="ident" id="3199342">internetSocket</span><span class="op" id="3199356">(</span><span class="ident" id="3199357">net</span><span class="op" id="3199360">,</span>&nbsp;<span class="ident" id="3199362">laddr</span><span class="op" id="3199367">,</span>&nbsp;<span class="ident" id="3199369">nil</span><span class="op" id="3199372">,</span>&nbsp;<span class="ident" id="3199374">noDeadline</span><span class="op" id="3199384">,</span>&nbsp;<span class="ident" id="3199386">syscall</span><span class="op" id="3199393">.</span><span class="ident" id="3199394">SOCK_DGRAM</span><span class="op" id="3199404">,</span>&nbsp;<span class="num" id="3199406">0</span><span class="op" id="3199407">,</span>&nbsp;<span class="string" id="3199409">&#34;listen&#34;</span><span class="op" id="3199417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3199420">if</span>&nbsp;<span class="ident" id="3199423">err</span>&nbsp;<span class="op" id="3199427">!=</span>&nbsp;<span class="ident" id="3199430">nil</span>&nbsp;<span class="op" id="3199434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3199438">return</span>&nbsp;<span class="ident" id="3199445">nil</span><span class="op" id="3199448">,</span>&nbsp;<span class="op" id="3199450">&amp;</span><span class="ident" id="3199451">OpError</span><span class="op" id="3199458">{</span><span class="ident" id="3199459">Op</span><span class="op" id="3199461">:</span>&nbsp;<span class="string" id="3199463">&#34;listen&#34;</span><span class="op" id="3199471">,</span>&nbsp;<span class="ident" id="3199473">Net</span><span class="op" id="3199476">:</span>&nbsp;<span class="ident" id="3199478">net</span><span class="op" id="3199481">,</span>&nbsp;<span class="ident" id="3199483">Addr</span><span class="op" id="3199487">:</span>&nbsp;<span class="ident" id="3199489">laddr</span><span class="op" id="3199494">,</span>&nbsp;<span class="ident" id="3199496">Err</span><span class="op" id="3199499">:</span>&nbsp;<span class="ident" id="3199501">err</span><span class="op" id="3199504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3199507">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3199510">return</span>&nbsp;<span class="ident" id="3199517">newUDPConn</span><span class="op" id="3199527">(</span><span class="ident" id="3199528">fd</span><span class="op" id="3199530">)</span><span class="op" id="3199531">,</span>&nbsp;<span class="ident" id="3199533">nil</span><br>
<span class="lineno"></span><span class="op" id="3199537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3199540">//&nbsp;ListenMulticastUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;multicast&nbsp;UDP&nbsp;packets</span><br>
<span class="lineno"></span><span class="comment" id="3199605">//&nbsp;addressed&nbsp;to&nbsp;the&nbsp;group&nbsp;address&nbsp;gaddr&nbsp;on&nbsp;ifi,&nbsp;which&nbsp;specifies&nbsp;the</span><br>
<span class="lineno">210</span><span class="comment" id="3199673">//&nbsp;interface&nbsp;to&nbsp;join.&nbsp;&nbsp;ListenMulticastUDP&nbsp;uses&nbsp;default&nbsp;multicast</span><br>
<span class="lineno"></span><span class="comment" id="3199738">//&nbsp;interface&nbsp;if&nbsp;ifi&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3199766">func</span>&nbsp;<span class="ident" id="3199771">ListenMulticastUDP</span><span class="op" id="3199789">(</span><span class="ident" id="3199790">net</span>&nbsp;<span class="builtintype" id="3199794">string</span><span class="op" id="3199800">,</span>&nbsp;<span class="ident" id="3199802">ifi</span>&nbsp;<span class="op" id="3199806">*</span><span class="ident" id="3199807">Interface</span><span class="op" id="3199816">,</span>&nbsp;<span class="ident" id="3199818">gaddr</span>&nbsp;<span class="op" id="3199824">*</span><span class="ident" id="3199825">UDPAddr</span><span class="op" id="3199832">)</span>&nbsp;<span class="op" id="3199834">(</span><span class="op" id="3199835">*</span><span class="ident" id="3199836">UDPConn</span><span class="op" id="3199843">,</span>&nbsp;<span class="builtintype" id="3199845">error</span><span class="op" id="3199850">)</span>&nbsp;<span class="op" id="3199852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3199855">switch</span>&nbsp;<span class="ident" id="3199862">net</span>&nbsp;<span class="op" id="3199866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3199869">case</span>&nbsp;<span class="string" id="3199874">&#34;udp&#34;</span><span class="op" id="3199879">,</span>&nbsp;<span class="string" id="3199881">&#34;udp4&#34;</span><span class="op" id="3199887">,</span>&nbsp;<span class="string" id="3199889">&#34;udp6&#34;</span><span class="op" id="3199895">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3199898">default</span><span class="op" id="3199905">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3199909">return</span>&nbsp;<span class="ident" id="3199916">nil</span><span class="op" id="3199919">,</span>&nbsp;<span class="op" id="3199921">&amp;</span><span class="ident" id="3199922">OpError</span><span class="op" id="3199929">{</span><span class="ident" id="3199930">Op</span><span class="op" id="3199932">:</span>&nbsp;<span class="string" id="3199934">&#34;listen&#34;</span><span class="op" id="3199942">,</span>&nbsp;<span class="ident" id="3199944">Net</span><span class="op" id="3199947">:</span>&nbsp;<span class="ident" id="3199949">net</span><span class="op" id="3199952">,</span>&nbsp;<span class="ident" id="3199954">Addr</span><span class="op" id="3199958">:</span>&nbsp;<span class="ident" id="3199960">gaddr</span><span class="op" id="3199965">,</span>&nbsp;<span class="ident" id="3199967">Err</span><span class="op" id="3199970">:</span>&nbsp;<span class="ident" id="3199972">UnknownNetworkError</span><span class="op" id="3199991">(</span><span class="ident" id="3199992">net</span><span class="op" id="3199995">)</span><span class="op" id="3199996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3199999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3200002">if</span>&nbsp;<span class="ident" id="3200005">gaddr</span>&nbsp;<span class="op" id="3200011">==</span>&nbsp;<span class="ident" id="3200014">nil</span>&nbsp;<span class="op" id="3200018">||</span>&nbsp;<span class="ident" id="3200021">gaddr</span><span class="op" id="3200026">.</span><span class="ident" id="3200027">IP</span>&nbsp;<span class="op" id="3200030">==</span>&nbsp;<span class="ident" id="3200033">nil</span>&nbsp;<span class="op" id="3200037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3200041">return</span>&nbsp;<span class="ident" id="3200048">nil</span><span class="op" id="3200051">,</span>&nbsp;<span class="op" id="3200053">&amp;</span><span class="ident" id="3200054">OpError</span><span class="op" id="3200061">{</span><span class="ident" id="3200062">Op</span><span class="op" id="3200064">:</span>&nbsp;<span class="string" id="3200066">&#34;listen&#34;</span><span class="op" id="3200074">,</span>&nbsp;<span class="ident" id="3200076">Net</span><span class="op" id="3200079">:</span>&nbsp;<span class="ident" id="3200081">net</span><span class="op" id="3200084">,</span>&nbsp;<span class="ident" id="3200086">Addr</span><span class="op" id="3200090">:</span>&nbsp;<span class="ident" id="3200092">nil</span><span class="op" id="3200095">,</span>&nbsp;<span class="ident" id="3200097">Err</span><span class="op" id="3200100">:</span>&nbsp;<span class="ident" id="3200102">errMissingAddress</span><span class="op" id="3200119">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3200122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3200125">fd</span><span class="op" id="3200127">,</span>&nbsp;<span class="ident" id="3200129">err</span>&nbsp;<span class="op" id="3200133">:=</span>&nbsp;<span class="ident" id="3200136">internetSocket</span><span class="op" id="3200150">(</span><span class="ident" id="3200151">net</span><span class="op" id="3200154">,</span>&nbsp;<span class="ident" id="3200156">gaddr</span><span class="op" id="3200161">,</span>&nbsp;<span class="ident" id="3200163">nil</span><span class="op" id="3200166">,</span>&nbsp;<span class="ident" id="3200168">noDeadline</span><span class="op" id="3200178">,</span>&nbsp;<span class="ident" id="3200180">syscall</span><span class="op" id="3200187">.</span><span class="ident" id="3200188">SOCK_DGRAM</span><span class="op" id="3200198">,</span>&nbsp;<span class="num" id="3200200">0</span><span class="op" id="3200201">,</span>&nbsp;<span class="string" id="3200203">&#34;listen&#34;</span><span class="op" id="3200211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3200214">if</span>&nbsp;<span class="ident" id="3200217">err</span>&nbsp;<span class="op" id="3200221">!=</span>&nbsp;<span class="ident" id="3200224">nil</span>&nbsp;<span class="op" id="3200228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3200232">return</span>&nbsp;<span class="ident" id="3200239">nil</span><span class="op" id="3200242">,</span>&nbsp;<span class="op" id="3200244">&amp;</span><span class="ident" id="3200245">OpError</span><span class="op" id="3200252">{</span><span class="ident" id="3200253">Op</span><span class="op" id="3200255">:</span>&nbsp;<span class="string" id="3200257">&#34;listen&#34;</span><span class="op" id="3200265">,</span>&nbsp;<span class="ident" id="3200267">Net</span><span class="op" id="3200270">:</span>&nbsp;<span class="ident" id="3200272">net</span><span class="op" id="3200275">,</span>&nbsp;<span class="ident" id="3200277">Addr</span><span class="op" id="3200281">:</span>&nbsp;<span class="ident" id="3200283">gaddr</span><span class="op" id="3200288">,</span>&nbsp;<span class="ident" id="3200290">Err</span><span class="op" id="3200293">:</span>&nbsp;<span class="ident" id="3200295">err</span><span class="op" id="3200298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3200301">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3200304">c</span>&nbsp;<span class="op" id="3200306">:=</span>&nbsp;<span class="ident" id="3200309">newUDPConn</span><span class="op" id="3200319">(</span><span class="ident" id="3200320">fd</span><span class="op" id="3200322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3200325">if</span>&nbsp;<span class="ident" id="3200328">ip4</span>&nbsp;<span class="op" id="3200332">:=</span>&nbsp;<span class="ident" id="3200335">gaddr</span><span class="op" id="3200340">.</span><span class="ident" id="3200341">IP</span><span class="op" id="3200343">.</span><span class="ident" id="3200344">To4</span><span class="op" id="3200347">(</span><span class="op" id="3200348">)</span><span class="op" id="3200349">;</span>&nbsp;<span class="ident" id="3200351">ip4</span>&nbsp;<span class="op" id="3200355">!=</span>&nbsp;<span class="ident" id="3200358">nil</span>&nbsp;<span class="op" id="3200362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3200366">if</span>&nbsp;<span class="ident" id="3200369">err</span>&nbsp;<span class="op" id="3200373">:=</span>&nbsp;<span class="ident" id="3200376">listenIPv4MulticastUDP</span><span class="op" id="3200398">(</span><span class="ident" id="3200399">c</span><span class="op" id="3200400">,</span>&nbsp;<span class="ident" id="3200402">ifi</span><span class="op" id="3200405">,</span>&nbsp;<span class="ident" id="3200407">ip4</span><span class="op" id="3200410">)</span><span class="op" id="3200411">;</span>&nbsp;<span class="ident" id="3200413">err</span>&nbsp;<span class="op" id="3200417">!=</span>&nbsp;<span class="ident" id="3200420">nil</span>&nbsp;<span class="op" id="3200424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3200429">c</span><span class="op" id="3200430">.</span><span class="ident" id="3200431">Close</span><span class="op" id="3200436">(</span><span class="op" id="3200437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3200442">return</span>&nbsp;<span class="ident" id="3200449">nil</span><span class="op" id="3200452">,</span>&nbsp;<span class="op" id="3200454">&amp;</span><span class="ident" id="3200455">OpError</span><span class="op" id="3200462">{</span><span class="ident" id="3200463">Op</span><span class="op" id="3200465">:</span>&nbsp;<span class="string" id="3200467">&#34;listen&#34;</span><span class="op" id="3200475">,</span>&nbsp;<span class="ident" id="3200477">Net</span><span class="op" id="3200480">:</span>&nbsp;<span class="ident" id="3200482">net</span><span class="op" id="3200485">,</span>&nbsp;<span class="ident" id="3200487">Addr</span><span class="op" id="3200491">:</span>&nbsp;<span class="op" id="3200493">&amp;</span><span class="ident" id="3200494">IPAddr</span><span class="op" id="3200500">{</span><span class="ident" id="3200501">IP</span><span class="op" id="3200503">:</span>&nbsp;<span class="ident" id="3200505">ip4</span><span class="op" id="3200508">}</span><span class="op" id="3200509">,</span>&nbsp;<span class="ident" id="3200511">Err</span><span class="op" id="3200514">:</span>&nbsp;<span class="ident" id="3200516">err</span><span class="op" id="3200519">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3200523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3200526">}</span>&nbsp;<span class="keyword" id="3200528">else</span>&nbsp;<span class="op" id="3200533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3200537">if</span>&nbsp;<span class="ident" id="3200540">err</span>&nbsp;<span class="op" id="3200544">:=</span>&nbsp;<span class="ident" id="3200547">listenIPv6MulticastUDP</span><span class="op" id="3200569">(</span><span class="ident" id="3200570">c</span><span class="op" id="3200571">,</span>&nbsp;<span class="ident" id="3200573">ifi</span><span class="op" id="3200576">,</span>&nbsp;<span class="ident" id="3200578">gaddr</span><span class="op" id="3200583">.</span><span class="ident" id="3200584">IP</span><span class="op" id="3200586">)</span><span class="op" id="3200587">;</span>&nbsp;<span class="ident" id="3200589">err</span>&nbsp;<span class="op" id="3200593">!=</span>&nbsp;<span class="ident" id="3200596">nil</span>&nbsp;<span class="op" id="3200600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3200605">c</span><span class="op" id="3200606">.</span><span class="ident" id="3200607">Close</span><span class="op" id="3200612">(</span><span class="op" id="3200613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3200618">return</span>&nbsp;<span class="ident" id="3200625">nil</span><span class="op" id="3200628">,</span>&nbsp;<span class="op" id="3200630">&amp;</span><span class="ident" id="3200631">OpError</span><span class="op" id="3200638">{</span><span class="ident" id="3200639">Op</span><span class="op" id="3200641">:</span>&nbsp;<span class="string" id="3200643">&#34;listen&#34;</span><span class="op" id="3200651">,</span>&nbsp;<span class="ident" id="3200653">Net</span><span class="op" id="3200656">:</span>&nbsp;<span class="ident" id="3200658">net</span><span class="op" id="3200661">,</span>&nbsp;<span class="ident" id="3200663">Addr</span><span class="op" id="3200667">:</span>&nbsp;<span class="op" id="3200669">&amp;</span><span class="ident" id="3200670">IPAddr</span><span class="op" id="3200676">{</span><span class="ident" id="3200677">IP</span><span class="op" id="3200679">:</span>&nbsp;<span class="ident" id="3200681">gaddr</span><span class="op" id="3200686">.</span><span class="ident" id="3200687">IP</span><span class="op" id="3200689">}</span><span class="op" id="3200690">,</span>&nbsp;<span class="ident" id="3200692">Err</span><span class="op" id="3200695">:</span>&nbsp;<span class="ident" id="3200697">err</span><span class="op" id="3200700">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3200704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3200707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3200710">return</span>&nbsp;<span class="ident" id="3200717">c</span><span class="op" id="3200718">,</span>&nbsp;<span class="ident" id="3200720">nil</span><br>
<span class="lineno"></span><span class="op" id="3200724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="3200727">func</span>&nbsp;<span class="ident" id="3200732">listenIPv4MulticastUDP</span><span class="op" id="3200754">(</span><span class="ident" id="3200755">c</span>&nbsp;<span class="op" id="3200757">*</span><span class="ident" id="3200758">UDPConn</span><span class="op" id="3200765">,</span>&nbsp;<span class="ident" id="3200767">ifi</span>&nbsp;<span class="op" id="3200771">*</span><span class="ident" id="3200772">Interface</span><span class="op" id="3200781">,</span>&nbsp;<span class="ident" id="3200783">ip</span>&nbsp;<span class="ident" id="3200786">IP</span><span class="op" id="3200788">)</span>&nbsp;<span class="builtintype" id="3200790">error</span>&nbsp;<span class="op" id="3200796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3200799">if</span>&nbsp;<span class="ident" id="3200802">ifi</span>&nbsp;<span class="op" id="3200806">!=</span>&nbsp;<span class="ident" id="3200809">nil</span>&nbsp;<span class="op" id="3200813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3200817">if</span>&nbsp;<span class="ident" id="3200820">err</span>&nbsp;<span class="op" id="3200824">:=</span>&nbsp;<span class="ident" id="3200827">setIPv4MulticastInterface</span><span class="op" id="3200852">(</span><span class="ident" id="3200853">c</span><span class="op" id="3200854">.</span><span class="ident" id="3200855">fd</span><span class="op" id="3200857">,</span>&nbsp;<span class="ident" id="3200859">ifi</span><span class="op" id="3200862">)</span><span class="op" id="3200863">;</span>&nbsp;<span class="ident" id="3200865">err</span>&nbsp;<span class="op" id="3200869">!=</span>&nbsp;<span class="ident" id="3200872">nil</span>&nbsp;<span class="op" id="3200876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3200881">return</span>&nbsp;<span class="ident" id="3200888">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3200894">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3200897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3200900">if</span>&nbsp;<span class="ident" id="3200903">err</span>&nbsp;<span class="op" id="3200907">:=</span>&nbsp;<span class="ident" id="3200910">setIPv4MulticastLoopback</span><span class="op" id="3200934">(</span><span class="ident" id="3200935">c</span><span class="op" id="3200936">.</span><span class="ident" id="3200937">fd</span><span class="op" id="3200939">,</span>&nbsp;<span class="builtintype" id="3200941">false</span><span class="op" id="3200946">)</span><span class="op" id="3200947">;</span>&nbsp;<span class="ident" id="3200949">err</span>&nbsp;<span class="op" id="3200953">!=</span>&nbsp;<span class="ident" id="3200956">nil</span>&nbsp;<span class="op" id="3200960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3200964">return</span>&nbsp;<span class="ident" id="3200971">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3200976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3200979">if</span>&nbsp;<span class="ident" id="3200982">err</span>&nbsp;<span class="op" id="3200986">:=</span>&nbsp;<span class="ident" id="3200989">joinIPv4Group</span><span class="op" id="3201002">(</span><span class="ident" id="3201003">c</span><span class="op" id="3201004">.</span><span class="ident" id="3201005">fd</span><span class="op" id="3201007">,</span>&nbsp;<span class="ident" id="3201009">ifi</span><span class="op" id="3201012">,</span>&nbsp;<span class="ident" id="3201014">ip</span><span class="op" id="3201016">)</span><span class="op" id="3201017">;</span>&nbsp;<span class="ident" id="3201019">err</span>&nbsp;<span class="op" id="3201023">!=</span>&nbsp;<span class="ident" id="3201026">nil</span>&nbsp;<span class="op" id="3201030">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3201034">return</span>&nbsp;<span class="ident" id="3201041">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3201046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3201049">return</span>&nbsp;<span class="ident" id="3201056">nil</span><br>
<span class="lineno"></span><span class="op" id="3201060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="3201063">func</span>&nbsp;<span class="ident" id="3201068">listenIPv6MulticastUDP</span><span class="op" id="3201090">(</span><span class="ident" id="3201091">c</span>&nbsp;<span class="op" id="3201093">*</span><span class="ident" id="3201094">UDPConn</span><span class="op" id="3201101">,</span>&nbsp;<span class="ident" id="3201103">ifi</span>&nbsp;<span class="op" id="3201107">*</span><span class="ident" id="3201108">Interface</span><span class="op" id="3201117">,</span>&nbsp;<span class="ident" id="3201119">ip</span>&nbsp;<span class="ident" id="3201122">IP</span><span class="op" id="3201124">)</span>&nbsp;<span class="builtintype" id="3201126">error</span>&nbsp;<span class="op" id="3201132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3201135">if</span>&nbsp;<span class="ident" id="3201138">ifi</span>&nbsp;<span class="op" id="3201142">!=</span>&nbsp;<span class="ident" id="3201145">nil</span>&nbsp;<span class="op" id="3201149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3201153">if</span>&nbsp;<span class="ident" id="3201156">err</span>&nbsp;<span class="op" id="3201160">:=</span>&nbsp;<span class="ident" id="3201163">setIPv6MulticastInterface</span><span class="op" id="3201188">(</span><span class="ident" id="3201189">c</span><span class="op" id="3201190">.</span><span class="ident" id="3201191">fd</span><span class="op" id="3201193">,</span>&nbsp;<span class="ident" id="3201195">ifi</span><span class="op" id="3201198">)</span><span class="op" id="3201199">;</span>&nbsp;<span class="ident" id="3201201">err</span>&nbsp;<span class="op" id="3201205">!=</span>&nbsp;<span class="ident" id="3201208">nil</span>&nbsp;<span class="op" id="3201212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3201217">return</span>&nbsp;<span class="ident" id="3201224">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3201230">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3201233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3201236">if</span>&nbsp;<span class="ident" id="3201239">err</span>&nbsp;<span class="op" id="3201243">:=</span>&nbsp;<span class="ident" id="3201246">setIPv6MulticastLoopback</span><span class="op" id="3201270">(</span><span class="ident" id="3201271">c</span><span class="op" id="3201272">.</span><span class="ident" id="3201273">fd</span><span class="op" id="3201275">,</span>&nbsp;<span class="builtintype" id="3201277">false</span><span class="op" id="3201282">)</span><span class="op" id="3201283">;</span>&nbsp;<span class="ident" id="3201285">err</span>&nbsp;<span class="op" id="3201289">!=</span>&nbsp;<span class="ident" id="3201292">nil</span>&nbsp;<span class="op" id="3201296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3201300">return</span>&nbsp;<span class="ident" id="3201307">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3201312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3201315">if</span>&nbsp;<span class="ident" id="3201318">err</span>&nbsp;<span class="op" id="3201322">:=</span>&nbsp;<span class="ident" id="3201325">joinIPv6Group</span><span class="op" id="3201338">(</span><span class="ident" id="3201339">c</span><span class="op" id="3201340">.</span><span class="ident" id="3201341">fd</span><span class="op" id="3201343">,</span>&nbsp;<span class="ident" id="3201345">ifi</span><span class="op" id="3201348">,</span>&nbsp;<span class="ident" id="3201350">ip</span><span class="op" id="3201352">)</span><span class="op" id="3201353">;</span>&nbsp;<span class="ident" id="3201355">err</span>&nbsp;<span class="op" id="3201359">!=</span>&nbsp;<span class="ident" id="3201362">nil</span>&nbsp;<span class="op" id="3201366">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3201370">return</span>&nbsp;<span class="ident" id="3201377">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3201382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3201385">return</span>&nbsp;<span class="ident" id="3201392">nil</span><br>
<span class="lineno"></span><span class="op" id="3201396">}</span>
</div>
</body>
</html>
