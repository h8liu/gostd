<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2079034">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2079089">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2079143">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2079194">package</span>&nbsp;<span class="ident" id="2079202">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2079211">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;the&nbsp;implementation&nbsp;of&nbsp;Go&nbsp;select&nbsp;statements.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2079278">import</span>&nbsp;<span class="string" id="2079285">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2079295">const</span>&nbsp;<span class="op" id="2079301">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2079304">debugSelect</span>&nbsp;<span class="op" id="2079316">=</span>&nbsp;<span class="builtintype" id="2079318">false</span><br>
<span class="lineno"></span><span class="op" id="2079324">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="2079327">var</span>&nbsp;<span class="op" id="2079331">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2079334">chansendpc</span>&nbsp;<span class="op" id="2079345">=</span>&nbsp;<span class="ident" id="2079347"><a href="/runtime/proc.go.html#2068560">funcPC</a></span><span class="op" id="2079353">(</span><span class="ident" id="2079354"><a href="/runtime/chan.go.html#1887446">chansend</a></span><span class="op" id="2079362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2079365">chanrecvpc</span>&nbsp;<span class="op" id="2079376">=</span>&nbsp;<span class="ident" id="2079378"><a href="/runtime/proc.go.html#2068560">funcPC</a></span><span class="op" id="2079384">(</span><span class="ident" id="2079385"><a href="/runtime/chan.go.html#1892893">chanrecv</a></span><span class="op" id="2079393">)</span><br>
<span class="lineno"></span><span class="op" id="2079395">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="2079398">func</span>&nbsp;<span class="ident" id="2079403">selectsize</span><span class="op" id="2079413">(</span><span class="ident" id="2079414">size</span>&nbsp;<span class="builtintype" id="2079419">uintptr</span><span class="op" id="2079426">)</span>&nbsp;<span class="builtintype" id="2079428">uintptr</span>&nbsp;<span class="op" id="2079436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2079439">selsize</span>&nbsp;<span class="op" id="2079447">:=</span>&nbsp;<span class="ident" id="2079450"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2079456">.</span><span class="ident" id="2079457">Sizeof</span><span class="op" id="2079463">(</span><span class="ident" id="2079464"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2079471">{</span><span class="op" id="2079472">}</span><span class="op" id="2079473">)</span>&nbsp;<span class="op" id="2079475">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2079479">(</span><span class="ident" id="2079480"><a href="/runtime/select.go.html#2079414">size</a></span><span class="op" id="2079484">-</span><span class="num" id="2079485">1</span><span class="op" id="2079486">)</span><span class="op" id="2079487">*</span><span class="ident" id="2079488"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2079494">.</span><span class="ident" id="2079495">Sizeof</span><span class="op" id="2079501">(</span><span class="ident" id="2079502"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2079509">{</span><span class="op" id="2079510">}</span><span class="op" id="2079511">.</span><span class="ident" id="2079512">scase</span><span class="op" id="2079517">[</span><span class="num" id="2079518">0</span><span class="op" id="2079519">]</span><span class="op" id="2079520">)</span>&nbsp;<span class="op" id="2079522">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2079526"><a href="/runtime/select.go.html#2079414">size</a></span><span class="op" id="2079530">*</span><span class="ident" id="2079531"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2079537">.</span><span class="ident" id="2079538">Sizeof</span><span class="op" id="2079544">(</span><span class="op" id="2079545">*</span><span class="ident" id="2079546"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2079553">{</span><span class="op" id="2079554">}</span><span class="op" id="2079555">.</span><span class="ident" id="2079556">lockorder</span><span class="op" id="2079565">)</span>&nbsp;<span class="op" id="2079567">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2079571"><a href="/runtime/select.go.html#2079414">size</a></span><span class="op" id="2079575">*</span><span class="ident" id="2079576"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2079582">.</span><span class="ident" id="2079583">Sizeof</span><span class="op" id="2079589">(</span><span class="op" id="2079590">*</span><span class="ident" id="2079591"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2079598">{</span><span class="op" id="2079599">}</span><span class="op" id="2079600">.</span><span class="ident" id="2079601">pollorder</span><span class="op" id="2079610">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2079613">return</span>&nbsp;<span class="ident" id="2079620"><a href="/runtime/malloc.go.html#2001621">round</a></span><span class="op" id="2079625">(</span><span class="ident" id="2079626"><a href="/runtime/select.go.html#2079439">selsize</a></span><span class="op" id="2079633">,</span>&nbsp;<span class="ident" id="2079635"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184939">_Int64Align</a></span><span class="op" id="2079646">)</span><br>
<span class="lineno"></span><span class="op" id="2079648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2079651">func</span>&nbsp;<span class="ident" id="2079656">newselect</span><span class="op" id="2079665">(</span><span class="ident" id="2079666">sel</span>&nbsp;<span class="op" id="2079670">*</span><span class="ident" id="2079671"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2079678">,</span>&nbsp;<span class="ident" id="2079680">selsize</span>&nbsp;<span class="ident" id="2079688">int64</span><span class="op" id="2079693">,</span>&nbsp;<span class="ident" id="2079695">size</span>&nbsp;<span class="builtintype" id="2079700">int32</span><span class="op" id="2079705">)</span>&nbsp;<span class="op" id="2079707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2079710">if</span>&nbsp;<span class="ident" id="2079713"><a href="/runtime/select.go.html#2079680">selsize</a></span>&nbsp;<span class="op" id="2079721">!=</span>&nbsp;<span class="ident" id="2079724">int64</span><span class="op" id="2079729">(</span><span class="ident" id="2079730"><a href="/runtime/select.go.html#2079403">selectsize</a></span><span class="op" id="2079740">(</span><span class="builtintype" id="2079741">uintptr</span><span class="op" id="2079748">(</span><span class="ident" id="2079749"><a href="/runtime/select.go.html#2079695">size</a></span><span class="op" id="2079753">)</span><span class="op" id="2079754">)</span><span class="op" id="2079755">)</span>&nbsp;<span class="op" id="2079757">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2079761">print</span><span class="op" id="2079766">(</span><span class="string" id="2079767">&#34;runtime:&nbsp;bad&nbsp;select&nbsp;size&nbsp;&#34;</span><span class="op" id="2079794">,</span>&nbsp;<span class="ident" id="2079796"><a href="/runtime/select.go.html#2079680">selsize</a></span><span class="op" id="2079803">,</span>&nbsp;<span class="string" id="2079805">&#34;,&nbsp;want&nbsp;&#34;</span><span class="op" id="2079814">,</span>&nbsp;<span class="ident" id="2079816"><a href="/runtime/select.go.html#2079403">selectsize</a></span><span class="op" id="2079826">(</span><span class="builtintype" id="2079827">uintptr</span><span class="op" id="2079834">(</span><span class="ident" id="2079835"><a href="/runtime/select.go.html#2079695">size</a></span><span class="op" id="2079839">)</span><span class="op" id="2079840">)</span><span class="op" id="2079841">,</span>&nbsp;<span class="string" id="2079843">&#34;\n&#34;</span><span class="op" id="2079847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2079851"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2079858">(</span><span class="string" id="2079859">&#34;bad&nbsp;select&nbsp;size&#34;</span><span class="op" id="2079876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2079879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2079882"><a href="/runtime/select.go.html#2079666">sel</a></span><span class="op" id="2079885">.</span><span class="ident" id="2079886">tcase</span>&nbsp;<span class="op" id="2079892">=</span>&nbsp;<span class="builtintype" id="2079894">uint16</span><span class="op" id="2079900">(</span><span class="ident" id="2079901"><a href="/runtime/select.go.html#2079695">size</a></span><span class="op" id="2079905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2079908"><a href="/runtime/select.go.html#2079666">sel</a></span><span class="op" id="2079911">.</span><span class="ident" id="2079912">ncase</span>&nbsp;<span class="op" id="2079918">=</span>&nbsp;<span class="num" id="2079920">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2079923"><a href="/runtime/select.go.html#2079666">sel</a></span><span class="op" id="2079926">.</span><span class="ident" id="2079927">lockorder</span>&nbsp;<span class="op" id="2079937">=</span>&nbsp;<span class="op" id="2079939">(</span><span class="op" id="2079940">*</span><span class="op" id="2079941">*</span><span class="ident" id="2079942"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="2079947">)</span><span class="op" id="2079948">(</span><span class="ident" id="2079949"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="2079952">(</span><span class="ident" id="2079953"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2079959">.</span><span class="ident" id="2079960">Pointer</span><span class="op" id="2079967">(</span><span class="op" id="2079968">&amp;</span><span class="ident" id="2079969"><a href="/runtime/select.go.html#2079666">sel</a></span><span class="op" id="2079972">.</span><span class="ident" id="2079973">scase</span><span class="op" id="2079978">)</span><span class="op" id="2079979">,</span>&nbsp;<span class="builtintype" id="2079981">uintptr</span><span class="op" id="2079988">(</span><span class="ident" id="2079989"><a href="/runtime/select.go.html#2079695">size</a></span><span class="op" id="2079993">)</span><span class="op" id="2079994">*</span><span class="ident" id="2079995"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2080001">.</span><span class="ident" id="2080002">Sizeof</span><span class="op" id="2080008">(</span><span class="ident" id="2080009"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2080016">{</span><span class="op" id="2080017">}</span><span class="op" id="2080018">.</span><span class="ident" id="2080019">scase</span><span class="op" id="2080024">[</span><span class="num" id="2080025">0</span><span class="op" id="2080026">]</span><span class="op" id="2080027">)</span><span class="op" id="2080028">)</span><span class="op" id="2080029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2080032"><a href="/runtime/select.go.html#2079666">sel</a></span><span class="op" id="2080035">.</span><span class="ident" id="2080036">pollorder</span>&nbsp;<span class="op" id="2080046">=</span>&nbsp;<span class="op" id="2080048">(</span><span class="op" id="2080049">*</span><span class="builtintype" id="2080050">uint16</span><span class="op" id="2080056">)</span><span class="op" id="2080057">(</span><span class="ident" id="2080058"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="2080061">(</span><span class="ident" id="2080062"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2080068">.</span><span class="ident" id="2080069">Pointer</span><span class="op" id="2080076">(</span><span class="ident" id="2080077"><a href="/runtime/select.go.html#2079666">sel</a></span><span class="op" id="2080080">.</span><span class="ident" id="2080081">lockorder</span><span class="op" id="2080090">)</span><span class="op" id="2080091">,</span>&nbsp;<span class="builtintype" id="2080093">uintptr</span><span class="op" id="2080100">(</span><span class="ident" id="2080101"><a href="/runtime/select.go.html#2079695">size</a></span><span class="op" id="2080105">)</span><span class="op" id="2080106">*</span><span class="ident" id="2080107"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2080113">.</span><span class="ident" id="2080114">Sizeof</span><span class="op" id="2080120">(</span><span class="op" id="2080121">*</span><span class="ident" id="2080122"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2080129">{</span><span class="op" id="2080130">}</span><span class="op" id="2080131">.</span><span class="ident" id="2080132">lockorder</span><span class="op" id="2080141">)</span><span class="op" id="2080142">)</span><span class="op" id="2080143">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2080147">if</span>&nbsp;<span class="ident" id="2080150"><a href="/runtime/select.go.html#2079304">debugSelect</a></span>&nbsp;<span class="op" id="2080162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2080166">print</span><span class="op" id="2080171">(</span><span class="string" id="2080172">&#34;newselect&nbsp;s=&#34;</span><span class="op" id="2080186">,</span>&nbsp;<span class="ident" id="2080188"><a href="/runtime/select.go.html#2079666">sel</a></span><span class="op" id="2080191">,</span>&nbsp;<span class="string" id="2080193">&#34;&nbsp;size=&#34;</span><span class="op" id="2080201">,</span>&nbsp;<span class="ident" id="2080203"><a href="/runtime/select.go.html#2079695">size</a></span><span class="op" id="2080207">,</span>&nbsp;<span class="string" id="2080209">&#34;\n&#34;</span><span class="op" id="2080213">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2080216">}</span><br>
<span class="lineno"></span><span class="op" id="2080218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2080221">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="2080234">func</span>&nbsp;<span class="ident" id="2080239">selectsend</span><span class="op" id="2080249">(</span><span class="ident" id="2080250">sel</span>&nbsp;<span class="op" id="2080254">*</span><span class="ident" id="2080255"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2080262">,</span>&nbsp;<span class="ident" id="2080264">c</span>&nbsp;<span class="op" id="2080266">*</span><span class="ident" id="2080267"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="2080272">,</span>&nbsp;<span class="ident" id="2080274">elem</span>&nbsp;<span class="ident" id="2080279"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2080285">.</span><span class="ident" id="2080286">Pointer</span><span class="op" id="2080293">)</span>&nbsp;<span class="op" id="2080295">(</span><span class="ident" id="2080296">selected</span>&nbsp;<span class="builtintype" id="2080305">bool</span><span class="op" id="2080309">)</span>&nbsp;<span class="op" id="2080311">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2080314">//&nbsp;nil&nbsp;cases&nbsp;do&nbsp;not&nbsp;compete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2080343">if</span>&nbsp;<span class="ident" id="2080346"><a href="/runtime/select.go.html#2080264">c</a></span>&nbsp;<span class="op" id="2080348">!=</span>&nbsp;<span class="ident" id="2080351">nil</span>&nbsp;<span class="op" id="2080355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2080359"><a href="/runtime/select.go.html#2080555">selectsendImpl</a></span><span class="op" id="2080373">(</span><span class="ident" id="2080374"><a href="/runtime/select.go.html#2080250">sel</a></span><span class="op" id="2080377">,</span>&nbsp;<span class="ident" id="2080379"><a href="/runtime/select.go.html#2080264">c</a></span><span class="op" id="2080380">,</span>&nbsp;<span class="ident" id="2080382"><a href="/runtime/stubs.go.html#2139499">getcallerpc</a></span><span class="op" id="2080393">(</span><span class="ident" id="2080394"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2080400">.</span><span class="ident" id="2080401">Pointer</span><span class="op" id="2080408">(</span><span class="op" id="2080409">&amp;</span><span class="ident" id="2080410"><a href="/runtime/select.go.html#2080250">sel</a></span><span class="op" id="2080413">)</span><span class="op" id="2080414">)</span><span class="op" id="2080415">,</span>&nbsp;<span class="ident" id="2080417"><a href="/runtime/select.go.html#2080274">elem</a></span><span class="op" id="2080421">,</span>&nbsp;<span class="builtintype" id="2080423">uintptr</span><span class="op" id="2080430">(</span><span class="ident" id="2080431"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2080437">.</span><span class="ident" id="2080438">Pointer</span><span class="op" id="2080445">(</span><span class="op" id="2080446">&amp;</span><span class="ident" id="2080447"><a href="/runtime/select.go.html#2080296">selected</a></span><span class="op" id="2080455">)</span><span class="op" id="2080456">)</span><span class="op" id="2080457">-</span><span class="builtintype" id="2080458">uintptr</span><span class="op" id="2080465">(</span><span class="ident" id="2080466"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2080472">.</span><span class="ident" id="2080473">Pointer</span><span class="op" id="2080480">(</span><span class="op" id="2080481">&amp;</span><span class="ident" id="2080482"><a href="/runtime/select.go.html#2080250">sel</a></span><span class="op" id="2080485">)</span><span class="op" id="2080486">)</span><span class="op" id="2080487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2080490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2080493">return</span><br>
<span class="lineno">50</span><span class="op" id="2080500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2080503">//&nbsp;cut&nbsp;in&nbsp;half&nbsp;to&nbsp;give&nbsp;stack&nbsp;a&nbsp;chance&nbsp;to&nbsp;split</span><br>
<span class="lineno"></span><span class="keyword" id="2080550">func</span>&nbsp;<span class="ident" id="2080555">selectsendImpl</span><span class="op" id="2080569">(</span><span class="ident" id="2080570">sel</span>&nbsp;<span class="op" id="2080574">*</span><span class="ident" id="2080575"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2080582">,</span>&nbsp;<span class="ident" id="2080584">c</span>&nbsp;<span class="op" id="2080586">*</span><span class="ident" id="2080587"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="2080592">,</span>&nbsp;<span class="ident" id="2080594">pc</span>&nbsp;<span class="builtintype" id="2080597">uintptr</span><span class="op" id="2080604">,</span>&nbsp;<span class="ident" id="2080606">elem</span>&nbsp;<span class="ident" id="2080611"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2080617">.</span><span class="ident" id="2080618">Pointer</span><span class="op" id="2080625">,</span>&nbsp;<span class="ident" id="2080627">so</span>&nbsp;<span class="builtintype" id="2080630">uintptr</span><span class="op" id="2080637">)</span>&nbsp;<span class="op" id="2080639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2080642">i</span>&nbsp;<span class="op" id="2080644">:=</span>&nbsp;<span class="ident" id="2080647"><a href="/runtime/select.go.html#2080570">sel</a></span><span class="op" id="2080650">.</span><span class="ident" id="2080651">ncase</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2080658">if</span>&nbsp;<span class="ident" id="2080661"><a href="/runtime/select.go.html#2080642">i</a></span>&nbsp;<span class="op" id="2080663">&gt;=</span>&nbsp;<span class="ident" id="2080666"><a href="/runtime/select.go.html#2080570">sel</a></span><span class="op" id="2080669">.</span><span class="ident" id="2080670">tcase</span>&nbsp;<span class="op" id="2080676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2080680"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2080687">(</span><span class="string" id="2080688">&#34;selectsend:&nbsp;too&nbsp;many&nbsp;cases&#34;</span><span class="op" id="2080716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2080719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2080722"><a href="/runtime/select.go.html#2080570">sel</a></span><span class="op" id="2080725">.</span><span class="ident" id="2080726">ncase</span>&nbsp;<span class="op" id="2080732">=</span>&nbsp;<span class="ident" id="2080734"><a href="/runtime/select.go.html#2080642">i</a></span>&nbsp;<span class="op" id="2080736">+</span>&nbsp;<span class="num" id="2080738">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2080741">cas</span>&nbsp;<span class="op" id="2080745">:=</span>&nbsp;<span class="op" id="2080748">(</span><span class="op" id="2080749">*</span><span class="ident" id="2080750"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189959">scase</a></span><span class="op" id="2080755">)</span><span class="op" id="2080756">(</span><span class="ident" id="2080757"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="2080760">(</span><span class="ident" id="2080761"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2080767">.</span><span class="ident" id="2080768">Pointer</span><span class="op" id="2080775">(</span><span class="op" id="2080776">&amp;</span><span class="ident" id="2080777"><a href="/runtime/select.go.html#2080570">sel</a></span><span class="op" id="2080780">.</span><span class="ident" id="2080781">scase</span><span class="op" id="2080786">)</span><span class="op" id="2080787">,</span>&nbsp;<span class="builtintype" id="2080789">uintptr</span><span class="op" id="2080796">(</span><span class="ident" id="2080797"><a href="/runtime/select.go.html#2080642">i</a></span><span class="op" id="2080798">)</span><span class="op" id="2080799">*</span><span class="ident" id="2080800"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2080806">.</span><span class="ident" id="2080807">Sizeof</span><span class="op" id="2080813">(</span><span class="ident" id="2080814"><a href="/runtime/select.go.html#2080570">sel</a></span><span class="op" id="2080817">.</span><span class="ident" id="2080818">scase</span><span class="op" id="2080823">[</span><span class="num" id="2080824">0</span><span class="op" id="2080825">]</span><span class="op" id="2080826">)</span><span class="op" id="2080827">)</span><span class="op" id="2080828">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2080832"><a href="/runtime/select.go.html#2080741">cas</a></span><span class="op" id="2080835">.</span><span class="ident" id="2080836">pc</span>&nbsp;<span class="op" id="2080839">=</span>&nbsp;<span class="ident" id="2080841"><a href="/runtime/select.go.html#2080594">pc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2080845"><a href="/runtime/select.go.html#2080741">cas</a></span><span class="op" id="2080848">.</span><span class="ident" id="2080849">_chan</span>&nbsp;<span class="op" id="2080855">=</span>&nbsp;<span class="ident" id="2080857"><a href="/runtime/select.go.html#2080584">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2080860"><a href="/runtime/select.go.html#2080741">cas</a></span><span class="op" id="2080863">.</span><span class="ident" id="2080864">so</span>&nbsp;<span class="op" id="2080867">=</span>&nbsp;<span class="builtintype" id="2080869">uint16</span><span class="op" id="2080875">(</span><span class="ident" id="2080876"><a href="/runtime/select.go.html#2080627">so</a></span><span class="op" id="2080878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2080881"><a href="/runtime/select.go.html#2080741">cas</a></span><span class="op" id="2080884">.</span><span class="ident" id="2080885">kind</span>&nbsp;<span class="op" id="2080890">=</span>&nbsp;<span class="ident" id="2080892"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189917">_CaseSend</a></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2080903"><a href="/runtime/select.go.html#2080741">cas</a></span><span class="op" id="2080906">.</span><span class="ident" id="2080907">elem</span>&nbsp;<span class="op" id="2080912">=</span>&nbsp;<span class="ident" id="2080914"><a href="/runtime/select.go.html#2080606">elem</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2080921">if</span>&nbsp;<span class="ident" id="2080924"><a href="/runtime/select.go.html#2079304">debugSelect</a></span>&nbsp;<span class="op" id="2080936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2080940">print</span><span class="op" id="2080945">(</span><span class="string" id="2080946">&#34;selectsend&nbsp;s=&#34;</span><span class="op" id="2080961">,</span>&nbsp;<span class="ident" id="2080963"><a href="/runtime/select.go.html#2080570">sel</a></span><span class="op" id="2080966">,</span>&nbsp;<span class="string" id="2080968">&#34;&nbsp;pc=&#34;</span><span class="op" id="2080974">,</span>&nbsp;<span class="ident" id="2080976"><a href="/runtime/print1.go.html#2057919">hex</a></span><span class="op" id="2080979">(</span><span class="ident" id="2080980"><a href="/runtime/select.go.html#2080741">cas</a></span><span class="op" id="2080983">.</span><span class="ident" id="2080984">pc</span><span class="op" id="2080986">)</span><span class="op" id="2080987">,</span>&nbsp;<span class="string" id="2080989">&#34;&nbsp;chan=&#34;</span><span class="op" id="2080997">,</span>&nbsp;<span class="ident" id="2080999"><a href="/runtime/select.go.html#2080741">cas</a></span><span class="op" id="2081002">.</span><span class="ident" id="2081003">_chan</span><span class="op" id="2081008">,</span>&nbsp;<span class="string" id="2081010">&#34;&nbsp;so=&#34;</span><span class="op" id="2081016">,</span>&nbsp;<span class="ident" id="2081018"><a href="/runtime/select.go.html#2080741">cas</a></span><span class="op" id="2081021">.</span><span class="ident" id="2081022">so</span><span class="op" id="2081024">,</span>&nbsp;<span class="string" id="2081026">&#34;\n&#34;</span><span class="op" id="2081030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2081033">}</span><br>
<span class="lineno">70</span><span class="op" id="2081035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2081038">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="2081051">func</span>&nbsp;<span class="ident" id="2081056">selectrecv</span><span class="op" id="2081066">(</span><span class="ident" id="2081067">sel</span>&nbsp;<span class="op" id="2081071">*</span><span class="ident" id="2081072"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2081079">,</span>&nbsp;<span class="ident" id="2081081">c</span>&nbsp;<span class="op" id="2081083">*</span><span class="ident" id="2081084"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="2081089">,</span>&nbsp;<span class="ident" id="2081091">elem</span>&nbsp;<span class="ident" id="2081096"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2081102">.</span><span class="ident" id="2081103">Pointer</span><span class="op" id="2081110">)</span>&nbsp;<span class="op" id="2081112">(</span><span class="ident" id="2081113">selected</span>&nbsp;<span class="builtintype" id="2081122">bool</span><span class="op" id="2081126">)</span>&nbsp;<span class="op" id="2081128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2081131">//&nbsp;nil&nbsp;cases&nbsp;do&nbsp;not&nbsp;compete</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2081160">if</span>&nbsp;<span class="ident" id="2081163"><a href="/runtime/select.go.html#2081081">c</a></span>&nbsp;<span class="op" id="2081165">!=</span>&nbsp;<span class="ident" id="2081168">nil</span>&nbsp;<span class="op" id="2081172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081176"><a href="/runtime/select.go.html#2081639">selectrecvImpl</a></span><span class="op" id="2081190">(</span><span class="ident" id="2081191"><a href="/runtime/select.go.html#2081067">sel</a></span><span class="op" id="2081194">,</span>&nbsp;<span class="ident" id="2081196"><a href="/runtime/select.go.html#2081081">c</a></span><span class="op" id="2081197">,</span>&nbsp;<span class="ident" id="2081199"><a href="/runtime/stubs.go.html#2139499">getcallerpc</a></span><span class="op" id="2081210">(</span><span class="ident" id="2081211"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2081217">.</span><span class="ident" id="2081218">Pointer</span><span class="op" id="2081225">(</span><span class="op" id="2081226">&amp;</span><span class="ident" id="2081227"><a href="/runtime/select.go.html#2081067">sel</a></span><span class="op" id="2081230">)</span><span class="op" id="2081231">)</span><span class="op" id="2081232">,</span>&nbsp;<span class="ident" id="2081234"><a href="/runtime/select.go.html#2081091">elem</a></span><span class="op" id="2081238">,</span>&nbsp;<span class="ident" id="2081240">nil</span><span class="op" id="2081243">,</span>&nbsp;<span class="builtintype" id="2081245">uintptr</span><span class="op" id="2081252">(</span><span class="ident" id="2081253"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2081259">.</span><span class="ident" id="2081260">Pointer</span><span class="op" id="2081267">(</span><span class="op" id="2081268">&amp;</span><span class="ident" id="2081269"><a href="/runtime/select.go.html#2081113">selected</a></span><span class="op" id="2081277">)</span><span class="op" id="2081278">)</span><span class="op" id="2081279">-</span><span class="builtintype" id="2081280">uintptr</span><span class="op" id="2081287">(</span><span class="ident" id="2081288"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2081294">.</span><span class="ident" id="2081295">Pointer</span><span class="op" id="2081302">(</span><span class="op" id="2081303">&amp;</span><span class="ident" id="2081304"><a href="/runtime/select.go.html#2081067">sel</a></span><span class="op" id="2081307">)</span><span class="op" id="2081308">)</span><span class="op" id="2081309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2081312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2081315">return</span><br>
<span class="lineno"></span><span class="op" id="2081322">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="2081325">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="2081338">func</span>&nbsp;<span class="ident" id="2081343">selectrecv2</span><span class="op" id="2081354">(</span><span class="ident" id="2081355">sel</span>&nbsp;<span class="op" id="2081359">*</span><span class="ident" id="2081360"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2081367">,</span>&nbsp;<span class="ident" id="2081369">c</span>&nbsp;<span class="op" id="2081371">*</span><span class="ident" id="2081372"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="2081377">,</span>&nbsp;<span class="ident" id="2081379">elem</span>&nbsp;<span class="ident" id="2081384"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2081390">.</span><span class="ident" id="2081391">Pointer</span><span class="op" id="2081398">,</span>&nbsp;<span class="ident" id="2081400">received</span>&nbsp;<span class="op" id="2081409">*</span><span class="builtintype" id="2081410">bool</span><span class="op" id="2081414">)</span>&nbsp;<span class="op" id="2081416">(</span><span class="ident" id="2081417">selected</span>&nbsp;<span class="builtintype" id="2081426">bool</span><span class="op" id="2081430">)</span>&nbsp;<span class="op" id="2081432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2081435">//&nbsp;nil&nbsp;cases&nbsp;do&nbsp;not&nbsp;compete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2081464">if</span>&nbsp;<span class="ident" id="2081467"><a href="/runtime/select.go.html#2081369">c</a></span>&nbsp;<span class="op" id="2081469">!=</span>&nbsp;<span class="ident" id="2081472">nil</span>&nbsp;<span class="op" id="2081476">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081480"><a href="/runtime/select.go.html#2081639">selectrecvImpl</a></span><span class="op" id="2081494">(</span><span class="ident" id="2081495"><a href="/runtime/select.go.html#2081355">sel</a></span><span class="op" id="2081498">,</span>&nbsp;<span class="ident" id="2081500"><a href="/runtime/select.go.html#2081369">c</a></span><span class="op" id="2081501">,</span>&nbsp;<span class="ident" id="2081503"><a href="/runtime/stubs.go.html#2139499">getcallerpc</a></span><span class="op" id="2081514">(</span><span class="ident" id="2081515"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2081521">.</span><span class="ident" id="2081522">Pointer</span><span class="op" id="2081529">(</span><span class="op" id="2081530">&amp;</span><span class="ident" id="2081531"><a href="/runtime/select.go.html#2081355">sel</a></span><span class="op" id="2081534">)</span><span class="op" id="2081535">)</span><span class="op" id="2081536">,</span>&nbsp;<span class="ident" id="2081538"><a href="/runtime/select.go.html#2081379">elem</a></span><span class="op" id="2081542">,</span>&nbsp;<span class="ident" id="2081544"><a href="/runtime/select.go.html#2081400">received</a></span><span class="op" id="2081552">,</span>&nbsp;<span class="builtintype" id="2081554">uintptr</span><span class="op" id="2081561">(</span><span class="ident" id="2081562"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2081568">.</span><span class="ident" id="2081569">Pointer</span><span class="op" id="2081576">(</span><span class="op" id="2081577">&amp;</span><span class="ident" id="2081578"><a href="/runtime/select.go.html#2081417">selected</a></span><span class="op" id="2081586">)</span><span class="op" id="2081587">)</span><span class="op" id="2081588">-</span><span class="builtintype" id="2081589">uintptr</span><span class="op" id="2081596">(</span><span class="ident" id="2081597"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2081603">.</span><span class="ident" id="2081604">Pointer</span><span class="op" id="2081611">(</span><span class="op" id="2081612">&amp;</span><span class="ident" id="2081613"><a href="/runtime/select.go.html#2081355">sel</a></span><span class="op" id="2081616">)</span><span class="op" id="2081617">)</span><span class="op" id="2081618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2081621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2081624">return</span><br>
<span class="lineno"></span><span class="op" id="2081631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="2081634">func</span>&nbsp;<span class="ident" id="2081639">selectrecvImpl</span><span class="op" id="2081653">(</span><span class="ident" id="2081654">sel</span>&nbsp;<span class="op" id="2081658">*</span><span class="ident" id="2081659"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2081666">,</span>&nbsp;<span class="ident" id="2081668">c</span>&nbsp;<span class="op" id="2081670">*</span><span class="ident" id="2081671"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="2081676">,</span>&nbsp;<span class="ident" id="2081678">pc</span>&nbsp;<span class="builtintype" id="2081681">uintptr</span><span class="op" id="2081688">,</span>&nbsp;<span class="ident" id="2081690">elem</span>&nbsp;<span class="ident" id="2081695"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2081701">.</span><span class="ident" id="2081702">Pointer</span><span class="op" id="2081709">,</span>&nbsp;<span class="ident" id="2081711">received</span>&nbsp;<span class="op" id="2081720">*</span><span class="builtintype" id="2081721">bool</span><span class="op" id="2081725">,</span>&nbsp;<span class="ident" id="2081727">so</span>&nbsp;<span class="builtintype" id="2081730">uintptr</span><span class="op" id="2081737">)</span>&nbsp;<span class="op" id="2081739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081742">i</span>&nbsp;<span class="op" id="2081744">:=</span>&nbsp;<span class="ident" id="2081747"><a href="/runtime/select.go.html#2081654">sel</a></span><span class="op" id="2081750">.</span><span class="ident" id="2081751">ncase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2081758">if</span>&nbsp;<span class="ident" id="2081761"><a href="/runtime/select.go.html#2081742">i</a></span>&nbsp;<span class="op" id="2081763">&gt;=</span>&nbsp;<span class="ident" id="2081766"><a href="/runtime/select.go.html#2081654">sel</a></span><span class="op" id="2081769">.</span><span class="ident" id="2081770">tcase</span>&nbsp;<span class="op" id="2081776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081780"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2081787">(</span><span class="string" id="2081788">&#34;selectrecv:&nbsp;too&nbsp;many&nbsp;cases&#34;</span><span class="op" id="2081816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2081819">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081822"><a href="/runtime/select.go.html#2081654">sel</a></span><span class="op" id="2081825">.</span><span class="ident" id="2081826">ncase</span>&nbsp;<span class="op" id="2081832">=</span>&nbsp;<span class="ident" id="2081834"><a href="/runtime/select.go.html#2081742">i</a></span>&nbsp;<span class="op" id="2081836">+</span>&nbsp;<span class="num" id="2081838">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081841">cas</span>&nbsp;<span class="op" id="2081845">:=</span>&nbsp;<span class="op" id="2081848">(</span><span class="op" id="2081849">*</span><span class="ident" id="2081850"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189959">scase</a></span><span class="op" id="2081855">)</span><span class="op" id="2081856">(</span><span class="ident" id="2081857"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="2081860">(</span><span class="ident" id="2081861"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2081867">.</span><span class="ident" id="2081868">Pointer</span><span class="op" id="2081875">(</span><span class="op" id="2081876">&amp;</span><span class="ident" id="2081877"><a href="/runtime/select.go.html#2081654">sel</a></span><span class="op" id="2081880">.</span><span class="ident" id="2081881">scase</span><span class="op" id="2081886">)</span><span class="op" id="2081887">,</span>&nbsp;<span class="builtintype" id="2081889">uintptr</span><span class="op" id="2081896">(</span><span class="ident" id="2081897"><a href="/runtime/select.go.html#2081742">i</a></span><span class="op" id="2081898">)</span><span class="op" id="2081899">*</span><span class="ident" id="2081900"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2081906">.</span><span class="ident" id="2081907">Sizeof</span><span class="op" id="2081913">(</span><span class="ident" id="2081914"><a href="/runtime/select.go.html#2081654">sel</a></span><span class="op" id="2081917">.</span><span class="ident" id="2081918">scase</span><span class="op" id="2081923">[</span><span class="num" id="2081924">0</span><span class="op" id="2081925">]</span><span class="op" id="2081926">)</span><span class="op" id="2081927">)</span><span class="op" id="2081928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081931"><a href="/runtime/select.go.html#2081841">cas</a></span><span class="op" id="2081934">.</span><span class="ident" id="2081935">pc</span>&nbsp;<span class="op" id="2081938">=</span>&nbsp;<span class="ident" id="2081940"><a href="/runtime/select.go.html#2081678">pc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081944"><a href="/runtime/select.go.html#2081841">cas</a></span><span class="op" id="2081947">.</span><span class="ident" id="2081948">_chan</span>&nbsp;<span class="op" id="2081954">=</span>&nbsp;<span class="ident" id="2081956"><a href="/runtime/select.go.html#2081668">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081959"><a href="/runtime/select.go.html#2081841">cas</a></span><span class="op" id="2081962">.</span><span class="ident" id="2081963">so</span>&nbsp;<span class="op" id="2081966">=</span>&nbsp;<span class="builtintype" id="2081968">uint16</span><span class="op" id="2081974">(</span><span class="ident" id="2081975"><a href="/runtime/select.go.html#2081727">so</a></span><span class="op" id="2081977">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2081980"><a href="/runtime/select.go.html#2081841">cas</a></span><span class="op" id="2081983">.</span><span class="ident" id="2081984">kind</span>&nbsp;<span class="op" id="2081989">=</span>&nbsp;<span class="ident" id="2081991"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189897">_CaseRecv</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082002"><a href="/runtime/select.go.html#2081841">cas</a></span><span class="op" id="2082005">.</span><span class="ident" id="2082006">elem</span>&nbsp;<span class="op" id="2082011">=</span>&nbsp;<span class="ident" id="2082013"><a href="/runtime/select.go.html#2081690">elem</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082019"><a href="/runtime/select.go.html#2081841">cas</a></span><span class="op" id="2082022">.</span><span class="ident" id="2082023">receivedp</span>&nbsp;<span class="op" id="2082033">=</span>&nbsp;<span class="ident" id="2082035"><a href="/runtime/select.go.html#2081711">received</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2082046">if</span>&nbsp;<span class="ident" id="2082049"><a href="/runtime/select.go.html#2079304">debugSelect</a></span>&nbsp;<span class="op" id="2082061">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2082065">print</span><span class="op" id="2082070">(</span><span class="string" id="2082071">&#34;selectrecv&nbsp;s=&#34;</span><span class="op" id="2082086">,</span>&nbsp;<span class="ident" id="2082088"><a href="/runtime/select.go.html#2081654">sel</a></span><span class="op" id="2082091">,</span>&nbsp;<span class="string" id="2082093">&#34;&nbsp;pc=&#34;</span><span class="op" id="2082099">,</span>&nbsp;<span class="ident" id="2082101"><a href="/runtime/print1.go.html#2057919">hex</a></span><span class="op" id="2082104">(</span><span class="ident" id="2082105"><a href="/runtime/select.go.html#2081841">cas</a></span><span class="op" id="2082108">.</span><span class="ident" id="2082109">pc</span><span class="op" id="2082111">)</span><span class="op" id="2082112">,</span>&nbsp;<span class="string" id="2082114">&#34;&nbsp;chan=&#34;</span><span class="op" id="2082122">,</span>&nbsp;<span class="ident" id="2082124"><a href="/runtime/select.go.html#2081841">cas</a></span><span class="op" id="2082127">.</span><span class="ident" id="2082128">_chan</span><span class="op" id="2082133">,</span>&nbsp;<span class="string" id="2082135">&#34;&nbsp;so=&#34;</span><span class="op" id="2082141">,</span>&nbsp;<span class="ident" id="2082143"><a href="/runtime/select.go.html#2081841">cas</a></span><span class="op" id="2082146">.</span><span class="ident" id="2082147">so</span><span class="op" id="2082149">,</span>&nbsp;<span class="string" id="2082151">&#34;\n&#34;</span><span class="op" id="2082155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2082158">}</span><br>
<span class="lineno"></span><span class="op" id="2082160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2082163">//go:nosplit</span><br>
<span class="lineno">110</span><span class="keyword" id="2082176">func</span>&nbsp;<span class="ident" id="2082181">selectdefault</span><span class="op" id="2082194">(</span><span class="ident" id="2082195">sel</span>&nbsp;<span class="op" id="2082199">*</span><span class="ident" id="2082200"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2082207">)</span>&nbsp;<span class="op" id="2082209">(</span><span class="ident" id="2082210">selected</span>&nbsp;<span class="builtintype" id="2082219">bool</span><span class="op" id="2082223">)</span>&nbsp;<span class="op" id="2082225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082228"><a href="/runtime/select.go.html#2082368">selectdefaultImpl</a></span><span class="op" id="2082245">(</span><span class="ident" id="2082246"><a href="/runtime/select.go.html#2082195">sel</a></span><span class="op" id="2082249">,</span>&nbsp;<span class="ident" id="2082251"><a href="/runtime/stubs.go.html#2139499">getcallerpc</a></span><span class="op" id="2082262">(</span><span class="ident" id="2082263"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2082269">.</span><span class="ident" id="2082270">Pointer</span><span class="op" id="2082277">(</span><span class="op" id="2082278">&amp;</span><span class="ident" id="2082279"><a href="/runtime/select.go.html#2082195">sel</a></span><span class="op" id="2082282">)</span><span class="op" id="2082283">)</span><span class="op" id="2082284">,</span>&nbsp;<span class="builtintype" id="2082286">uintptr</span><span class="op" id="2082293">(</span><span class="ident" id="2082294"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2082300">.</span><span class="ident" id="2082301">Pointer</span><span class="op" id="2082308">(</span><span class="op" id="2082309">&amp;</span><span class="ident" id="2082310"><a href="/runtime/select.go.html#2082210">selected</a></span><span class="op" id="2082318">)</span><span class="op" id="2082319">)</span><span class="op" id="2082320">-</span><span class="builtintype" id="2082321">uintptr</span><span class="op" id="2082328">(</span><span class="ident" id="2082329"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2082335">.</span><span class="ident" id="2082336">Pointer</span><span class="op" id="2082343">(</span><span class="op" id="2082344">&amp;</span><span class="ident" id="2082345"><a href="/runtime/select.go.html#2082195">sel</a></span><span class="op" id="2082348">)</span><span class="op" id="2082349">)</span><span class="op" id="2082350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2082353">return</span><br>
<span class="lineno"></span><span class="op" id="2082360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="2082363">func</span>&nbsp;<span class="ident" id="2082368">selectdefaultImpl</span><span class="op" id="2082385">(</span><span class="ident" id="2082386">sel</span>&nbsp;<span class="op" id="2082390">*</span><span class="ident" id="2082391"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2082398">,</span>&nbsp;<span class="ident" id="2082400">callerpc</span>&nbsp;<span class="builtintype" id="2082409">uintptr</span><span class="op" id="2082416">,</span>&nbsp;<span class="ident" id="2082418">so</span>&nbsp;<span class="builtintype" id="2082421">uintptr</span><span class="op" id="2082428">)</span>&nbsp;<span class="op" id="2082430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082433">i</span>&nbsp;<span class="op" id="2082435">:=</span>&nbsp;<span class="ident" id="2082438"><a href="/runtime/select.go.html#2082386">sel</a></span><span class="op" id="2082441">.</span><span class="ident" id="2082442">ncase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2082449">if</span>&nbsp;<span class="ident" id="2082452"><a href="/runtime/select.go.html#2082433">i</a></span>&nbsp;<span class="op" id="2082454">&gt;=</span>&nbsp;<span class="ident" id="2082457"><a href="/runtime/select.go.html#2082386">sel</a></span><span class="op" id="2082460">.</span><span class="ident" id="2082461">tcase</span>&nbsp;<span class="op" id="2082467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082471"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2082478">(</span><span class="string" id="2082479">&#34;selectdefault:&nbsp;too&nbsp;many&nbsp;cases&#34;</span><span class="op" id="2082510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2082513">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082516"><a href="/runtime/select.go.html#2082386">sel</a></span><span class="op" id="2082519">.</span><span class="ident" id="2082520">ncase</span>&nbsp;<span class="op" id="2082526">=</span>&nbsp;<span class="ident" id="2082528"><a href="/runtime/select.go.html#2082433">i</a></span>&nbsp;<span class="op" id="2082530">+</span>&nbsp;<span class="num" id="2082532">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082535">cas</span>&nbsp;<span class="op" id="2082539">:=</span>&nbsp;<span class="op" id="2082542">(</span><span class="op" id="2082543">*</span><span class="ident" id="2082544"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189959">scase</a></span><span class="op" id="2082549">)</span><span class="op" id="2082550">(</span><span class="ident" id="2082551"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="2082554">(</span><span class="ident" id="2082555"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2082561">.</span><span class="ident" id="2082562">Pointer</span><span class="op" id="2082569">(</span><span class="op" id="2082570">&amp;</span><span class="ident" id="2082571"><a href="/runtime/select.go.html#2082386">sel</a></span><span class="op" id="2082574">.</span><span class="ident" id="2082575">scase</span><span class="op" id="2082580">)</span><span class="op" id="2082581">,</span>&nbsp;<span class="builtintype" id="2082583">uintptr</span><span class="op" id="2082590">(</span><span class="ident" id="2082591"><a href="/runtime/select.go.html#2082433">i</a></span><span class="op" id="2082592">)</span><span class="op" id="2082593">*</span><span class="ident" id="2082594"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2082600">.</span><span class="ident" id="2082601">Sizeof</span><span class="op" id="2082607">(</span><span class="ident" id="2082608"><a href="/runtime/select.go.html#2082386">sel</a></span><span class="op" id="2082611">.</span><span class="ident" id="2082612">scase</span><span class="op" id="2082617">[</span><span class="num" id="2082618">0</span><span class="op" id="2082619">]</span><span class="op" id="2082620">)</span><span class="op" id="2082621">)</span><span class="op" id="2082622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082625"><a href="/runtime/select.go.html#2082535">cas</a></span><span class="op" id="2082628">.</span><span class="ident" id="2082629">pc</span>&nbsp;<span class="op" id="2082632">=</span>&nbsp;<span class="ident" id="2082634"><a href="/runtime/select.go.html#2082400">callerpc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082644"><a href="/runtime/select.go.html#2082535">cas</a></span><span class="op" id="2082647">.</span><span class="ident" id="2082648">_chan</span>&nbsp;<span class="op" id="2082654">=</span>&nbsp;<span class="ident" id="2082656">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082661"><a href="/runtime/select.go.html#2082535">cas</a></span><span class="op" id="2082664">.</span><span class="ident" id="2082665">so</span>&nbsp;<span class="op" id="2082668">=</span>&nbsp;<span class="builtintype" id="2082670">uint16</span><span class="op" id="2082676">(</span><span class="ident" id="2082677"><a href="/runtime/select.go.html#2082418">so</a></span><span class="op" id="2082679">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082682"><a href="/runtime/select.go.html#2082535">cas</a></span><span class="op" id="2082685">.</span><span class="ident" id="2082686">kind</span>&nbsp;<span class="op" id="2082691">=</span>&nbsp;<span class="ident" id="2082693"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189937">_CaseDefault</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2082708">if</span>&nbsp;<span class="ident" id="2082711"><a href="/runtime/select.go.html#2079304">debugSelect</a></span>&nbsp;<span class="op" id="2082723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2082727">print</span><span class="op" id="2082732">(</span><span class="string" id="2082733">&#34;selectdefault&nbsp;s=&#34;</span><span class="op" id="2082751">,</span>&nbsp;<span class="ident" id="2082753"><a href="/runtime/select.go.html#2082386">sel</a></span><span class="op" id="2082756">,</span>&nbsp;<span class="string" id="2082758">&#34;&nbsp;pc=&#34;</span><span class="op" id="2082764">,</span>&nbsp;<span class="ident" id="2082766"><a href="/runtime/print1.go.html#2057919">hex</a></span><span class="op" id="2082769">(</span><span class="ident" id="2082770"><a href="/runtime/select.go.html#2082535">cas</a></span><span class="op" id="2082773">.</span><span class="ident" id="2082774">pc</span><span class="op" id="2082776">)</span><span class="op" id="2082777">,</span>&nbsp;<span class="string" id="2082779">&#34;&nbsp;so=&#34;</span><span class="op" id="2082785">,</span>&nbsp;<span class="ident" id="2082787"><a href="/runtime/select.go.html#2082535">cas</a></span><span class="op" id="2082790">.</span><span class="ident" id="2082791">so</span><span class="op" id="2082793">,</span>&nbsp;<span class="string" id="2082795">&#34;\n&#34;</span><span class="op" id="2082799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2082802">}</span><br>
<span class="lineno">130</span><span class="op" id="2082804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2082807">func</span>&nbsp;<span class="ident" id="2082812">sellock</span><span class="op" id="2082819">(</span><span class="ident" id="2082820">sel</span>&nbsp;<span class="op" id="2082824">*</span><span class="ident" id="2082825"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2082832">)</span>&nbsp;<span class="op" id="2082834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082837">lockslice</span>&nbsp;<span class="op" id="2082847">:=</span>&nbsp;<span class="ident" id="2082850"><a href="/runtime/slice.go.html#2106458">sliceStruct</a></span><span class="op" id="2082861">{</span><span class="ident" id="2082862"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2082868">.</span><span class="ident" id="2082869">Pointer</span><span class="op" id="2082876">(</span><span class="ident" id="2082877"><a href="/runtime/select.go.html#2082820">sel</a></span><span class="op" id="2082880">.</span><span class="ident" id="2082881">lockorder</span><span class="op" id="2082890">)</span><span class="op" id="2082891">,</span>&nbsp;<span class="builtintype" id="2082893">int</span><span class="op" id="2082896">(</span><span class="ident" id="2082897"><a href="/runtime/select.go.html#2082820">sel</a></span><span class="op" id="2082900">.</span><span class="ident" id="2082901">ncase</span><span class="op" id="2082906">)</span><span class="op" id="2082907">,</span>&nbsp;<span class="builtintype" id="2082909">int</span><span class="op" id="2082912">(</span><span class="ident" id="2082913"><a href="/runtime/select.go.html#2082820">sel</a></span><span class="op" id="2082916">.</span><span class="ident" id="2082917">ncase</span><span class="op" id="2082922">)</span><span class="op" id="2082923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2082926">lockorder</span>&nbsp;<span class="op" id="2082936">:=</span>&nbsp;<span class="op" id="2082939">*</span><span class="op" id="2082940">(</span><span class="op" id="2082941">*</span><span class="op" id="2082942">[</span><span class="op" id="2082943">]</span><span class="op" id="2082944">*</span><span class="ident" id="2082945"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="2082950">)</span><span class="op" id="2082951">(</span><span class="ident" id="2082952"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2082958">.</span><span class="ident" id="2082959">Pointer</span><span class="op" id="2082966">(</span><span class="op" id="2082967">&amp;</span><span class="ident" id="2082968"><a href="/runtime/select.go.html#2082837">lockslice</a></span><span class="op" id="2082977">)</span><span class="op" id="2082978">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2082981">var</span>&nbsp;<span class="ident" id="2082985">c</span>&nbsp;<span class="op" id="2082987">*</span><span class="ident" id="2082988"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2082995">for</span>&nbsp;<span class="ident" id="2082999">_</span><span class="op" id="2083000">,</span>&nbsp;<span class="ident" id="2083002">c0</span>&nbsp;<span class="op" id="2083005">:=</span>&nbsp;<span class="keyword" id="2083008">range</span>&nbsp;<span class="ident" id="2083014"><a href="/runtime/select.go.html#2082926">lockorder</a></span>&nbsp;<span class="op" id="2083024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2083028">if</span>&nbsp;<span class="ident" id="2083031"><a href="/runtime/select.go.html#2083002">c0</a></span>&nbsp;<span class="op" id="2083034">!=</span>&nbsp;<span class="ident" id="2083037">nil</span>&nbsp;<span class="op" id="2083041">&amp;&amp;</span>&nbsp;<span class="ident" id="2083044"><a href="/runtime/select.go.html#2083002">c0</a></span>&nbsp;<span class="op" id="2083047">!=</span>&nbsp;<span class="ident" id="2083050"><a href="/runtime/select.go.html#2082985">c</a></span>&nbsp;<span class="op" id="2083052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2083057"><a href="/runtime/select.go.html#2082985">c</a></span>&nbsp;<span class="op" id="2083059">=</span>&nbsp;<span class="ident" id="2083061"><a href="/runtime/select.go.html#2083002">c0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2083067"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2083071">(</span><span class="op" id="2083072">&amp;</span><span class="ident" id="2083073"><a href="/runtime/select.go.html#2082985">c</a></span><span class="op" id="2083074">.</span><span class="ident" id="2083075">lock</span><span class="op" id="2083079">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2083083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2083086">}</span><br>
<span class="lineno"></span><span class="op" id="2083088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2083091">func</span>&nbsp;<span class="ident" id="2083096">selunlock</span><span class="op" id="2083105">(</span><span class="ident" id="2083106">sel</span>&nbsp;<span class="op" id="2083110">*</span><span class="ident" id="2083111"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2083118">)</span>&nbsp;<span class="op" id="2083120">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2083123">//&nbsp;We&nbsp;must&nbsp;be&nbsp;very&nbsp;careful&nbsp;here&nbsp;to&nbsp;not&nbsp;touch&nbsp;sel&nbsp;after&nbsp;we&nbsp;have&nbsp;unlocked</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2083196">//&nbsp;the&nbsp;last&nbsp;lock,&nbsp;because&nbsp;sel&nbsp;can&nbsp;be&nbsp;freed&nbsp;right&nbsp;after&nbsp;the&nbsp;last&nbsp;unlock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2083269">//&nbsp;Consider&nbsp;the&nbsp;following&nbsp;situation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2083307">//&nbsp;First&nbsp;M&nbsp;calls&nbsp;runtimepark()&nbsp;in&nbsp;runtimeselectgo()&nbsp;passing&nbsp;the&nbsp;sel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2083381">//&nbsp;Once&nbsp;runtimepark()&nbsp;has&nbsp;unlocked&nbsp;the&nbsp;last&nbsp;lock,&nbsp;another&nbsp;M&nbsp;makes</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2083450">//&nbsp;the&nbsp;G&nbsp;that&nbsp;calls&nbsp;select&nbsp;runnable&nbsp;again&nbsp;and&nbsp;schedules&nbsp;it&nbsp;for&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2083525">//&nbsp;When&nbsp;the&nbsp;G&nbsp;runs&nbsp;on&nbsp;another&nbsp;M,&nbsp;it&nbsp;locks&nbsp;all&nbsp;the&nbsp;locks&nbsp;and&nbsp;frees&nbsp;sel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2083597">//&nbsp;Now&nbsp;if&nbsp;the&nbsp;first&nbsp;M&nbsp;touches&nbsp;sel,&nbsp;it&nbsp;will&nbsp;access&nbsp;freed&nbsp;memory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2083662">n</span>&nbsp;<span class="op" id="2083664">:=</span>&nbsp;<span class="builtintype" id="2083667">int</span><span class="op" id="2083670">(</span><span class="ident" id="2083671"><a href="/runtime/select.go.html#2083106">sel</a></span><span class="op" id="2083674">.</span><span class="ident" id="2083675">ncase</span><span class="op" id="2083680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2083683">r</span>&nbsp;<span class="op" id="2083685">:=</span>&nbsp;<span class="num" id="2083688">0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2083691">lockslice</span>&nbsp;<span class="op" id="2083701">:=</span>&nbsp;<span class="ident" id="2083704"><a href="/runtime/slice.go.html#2106458">sliceStruct</a></span><span class="op" id="2083715">{</span><span class="ident" id="2083716"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2083722">.</span><span class="ident" id="2083723">Pointer</span><span class="op" id="2083730">(</span><span class="ident" id="2083731"><a href="/runtime/select.go.html#2083106">sel</a></span><span class="op" id="2083734">.</span><span class="ident" id="2083735">lockorder</span><span class="op" id="2083744">)</span><span class="op" id="2083745">,</span>&nbsp;<span class="ident" id="2083747"><a href="/runtime/select.go.html#2083662">n</a></span><span class="op" id="2083748">,</span>&nbsp;<span class="ident" id="2083750"><a href="/runtime/select.go.html#2083662">n</a></span><span class="op" id="2083751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2083754">lockorder</span>&nbsp;<span class="op" id="2083764">:=</span>&nbsp;<span class="op" id="2083767">*</span><span class="op" id="2083768">(</span><span class="op" id="2083769">*</span><span class="op" id="2083770">[</span><span class="op" id="2083771">]</span><span class="op" id="2083772">*</span><span class="ident" id="2083773"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="2083778">)</span><span class="op" id="2083779">(</span><span class="ident" id="2083780"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2083786">.</span><span class="ident" id="2083787">Pointer</span><span class="op" id="2083794">(</span><span class="op" id="2083795">&amp;</span><span class="ident" id="2083796"><a href="/runtime/select.go.html#2083691">lockslice</a></span><span class="op" id="2083805">)</span><span class="op" id="2083806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2083809">//&nbsp;skip&nbsp;the&nbsp;default&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2083835">if</span>&nbsp;<span class="ident" id="2083838"><a href="/runtime/select.go.html#2083662">n</a></span>&nbsp;<span class="op" id="2083840">&gt;</span>&nbsp;<span class="num" id="2083842">0</span>&nbsp;<span class="op" id="2083844">&amp;&amp;</span>&nbsp;<span class="ident" id="2083847"><a href="/runtime/select.go.html#2083754">lockorder</a></span><span class="op" id="2083856">[</span><span class="num" id="2083857">0</span><span class="op" id="2083858">]</span>&nbsp;<span class="op" id="2083860">==</span>&nbsp;<span class="ident" id="2083863">nil</span>&nbsp;<span class="op" id="2083867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2083871"><a href="/runtime/select.go.html#2083683">r</a></span>&nbsp;<span class="op" id="2083873">=</span>&nbsp;<span class="num" id="2083875">1</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2083878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2083881">for</span>&nbsp;<span class="ident" id="2083885">i</span>&nbsp;<span class="op" id="2083887">:=</span>&nbsp;<span class="ident" id="2083890"><a href="/runtime/select.go.html#2083662">n</a></span>&nbsp;<span class="op" id="2083892">-</span>&nbsp;<span class="num" id="2083894">1</span><span class="op" id="2083895">;</span>&nbsp;<span class="ident" id="2083897"><a href="/runtime/select.go.html#2083885">i</a></span>&nbsp;<span class="op" id="2083899">&gt;=</span>&nbsp;<span class="ident" id="2083902"><a href="/runtime/select.go.html#2083683">r</a></span><span class="op" id="2083903">;</span>&nbsp;<span class="ident" id="2083905"><a href="/runtime/select.go.html#2083885">i</a></span><span class="op" id="2083906">--</span>&nbsp;<span class="op" id="2083909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2083913">c</span>&nbsp;<span class="op" id="2083915">:=</span>&nbsp;<span class="ident" id="2083918"><a href="/runtime/select.go.html#2083754">lockorder</a></span><span class="op" id="2083927">[</span><span class="ident" id="2083928"><a href="/runtime/select.go.html#2083885">i</a></span><span class="op" id="2083929">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2083933">if</span>&nbsp;<span class="ident" id="2083936"><a href="/runtime/select.go.html#2083885">i</a></span>&nbsp;<span class="op" id="2083938">&gt;</span>&nbsp;<span class="num" id="2083940">0</span>&nbsp;<span class="op" id="2083942">&amp;&amp;</span>&nbsp;<span class="ident" id="2083945"><a href="/runtime/select.go.html#2083913">c</a></span>&nbsp;<span class="op" id="2083947">==</span>&nbsp;<span class="ident" id="2083950"><a href="/runtime/select.go.html#2083754">lockorder</a></span><span class="op" id="2083959">[</span><span class="ident" id="2083960"><a href="/runtime/select.go.html#2083885">i</a></span><span class="op" id="2083961">-</span><span class="num" id="2083962">1</span><span class="op" id="2083963">]</span>&nbsp;<span class="op" id="2083965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2083970">continue</span>&nbsp;<span class="comment" id="2083979">//&nbsp;will&nbsp;unlock&nbsp;it&nbsp;on&nbsp;the&nbsp;next&nbsp;iteration</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084025"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2084031">(</span><span class="op" id="2084032">&amp;</span><span class="ident" id="2084033"><a href="/runtime/select.go.html#2083913">c</a></span><span class="op" id="2084034">.</span><span class="ident" id="2084035">lock</span><span class="op" id="2084039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084042">}</span><br>
<span class="lineno"></span><span class="op" id="2084044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="2084047">func</span>&nbsp;<span class="ident" id="2084052">selparkcommit</span><span class="op" id="2084065">(</span><span class="ident" id="2084066">gp</span>&nbsp;<span class="op" id="2084069">*</span><span class="ident" id="2084070"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span><span class="op" id="2084071">,</span>&nbsp;<span class="ident" id="2084073">sel</span>&nbsp;<span class="op" id="2084077">*</span><span class="ident" id="2084078"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2084085">)</span>&nbsp;<span class="builtintype" id="2084087">bool</span>&nbsp;<span class="op" id="2084092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084095"><a href="/runtime/select.go.html#2083096">selunlock</a></span><span class="op" id="2084104">(</span><span class="ident" id="2084105"><a href="/runtime/select.go.html#2084073">sel</a></span><span class="op" id="2084108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084111">return</span>&nbsp;<span class="builtintype" id="2084118">true</span><br>
<span class="lineno"></span><span class="op" id="2084123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="2084126">func</span>&nbsp;<span class="ident" id="2084131">block</span><span class="op" id="2084136">(</span><span class="op" id="2084137">)</span>&nbsp;<span class="op" id="2084139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084142"><a href="/runtime/proc.go.html#2066373">gopark</a></span><span class="op" id="2084148">(</span><span class="ident" id="2084149">nil</span><span class="op" id="2084152">,</span>&nbsp;<span class="ident" id="2084154">nil</span><span class="op" id="2084157">,</span>&nbsp;<span class="string" id="2084159">&#34;select&nbsp;(no&nbsp;cases)&#34;</span><span class="op" id="2084178">)</span>&nbsp;<span class="comment" id="2084180">//&nbsp;forever</span><br>
<span class="lineno"></span><span class="op" id="2084191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2084194">//&nbsp;overwrites&nbsp;return&nbsp;pc&nbsp;on&nbsp;stack&nbsp;to&nbsp;signal&nbsp;which&nbsp;case&nbsp;of&nbsp;the&nbsp;select</span><br>
<span class="lineno">180</span><span class="comment" id="2084262">//&nbsp;to&nbsp;run,&nbsp;so&nbsp;cannot&nbsp;appear&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;a&nbsp;split&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="2084319">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="2084332">func</span>&nbsp;<span class="ident" id="2084337">selectgo</span><span class="op" id="2084345">(</span><span class="ident" id="2084346">sel</span>&nbsp;<span class="op" id="2084350">*</span><span class="ident" id="2084351"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2084358">)</span>&nbsp;<span class="op" id="2084360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084363">pc</span><span class="op" id="2084365">,</span>&nbsp;<span class="ident" id="2084367">offset</span>&nbsp;<span class="op" id="2084374">:=</span>&nbsp;<span class="ident" id="2084377"><a href="/runtime/select.go.html#2084585">selectgoImpl</a></span><span class="op" id="2084389">(</span><span class="ident" id="2084390"><a href="/runtime/select.go.html#2084346">sel</a></span><span class="op" id="2084393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084396">*</span><span class="op" id="2084397">(</span><span class="op" id="2084398">*</span><span class="builtintype" id="2084399">bool</span><span class="op" id="2084403">)</span><span class="op" id="2084404">(</span><span class="ident" id="2084405"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="2084408">(</span><span class="ident" id="2084409"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2084415">.</span><span class="ident" id="2084416">Pointer</span><span class="op" id="2084423">(</span><span class="op" id="2084424">&amp;</span><span class="ident" id="2084425"><a href="/runtime/select.go.html#2084346">sel</a></span><span class="op" id="2084428">)</span><span class="op" id="2084429">,</span>&nbsp;<span class="builtintype" id="2084431">uintptr</span><span class="op" id="2084438">(</span><span class="ident" id="2084439"><a href="/runtime/select.go.html#2084367">offset</a></span><span class="op" id="2084445">)</span><span class="op" id="2084446">)</span><span class="op" id="2084447">)</span>&nbsp;<span class="op" id="2084449">=</span>&nbsp;<span class="builtintype" id="2084451">true</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084457"><a href="/runtime/stubs.go.html#2138226">setcallerpc</a></span><span class="op" id="2084468">(</span><span class="ident" id="2084469"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2084475">.</span><span class="ident" id="2084476">Pointer</span><span class="op" id="2084483">(</span><span class="op" id="2084484">&amp;</span><span class="ident" id="2084485"><a href="/runtime/select.go.html#2084346">sel</a></span><span class="op" id="2084488">)</span><span class="op" id="2084489">,</span>&nbsp;<span class="ident" id="2084491"><a href="/runtime/select.go.html#2084363">pc</a></span><span class="op" id="2084493">)</span><br>
<span class="lineno"></span><span class="op" id="2084495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2084498">//&nbsp;selectgoImpl&nbsp;returns&nbsp;scase.pc&nbsp;and&nbsp;scase.so&nbsp;for&nbsp;the&nbsp;select</span><br>
<span class="lineno"></span><span class="comment" id="2084559">//&nbsp;case&nbsp;which&nbsp;fired.</span><br>
<span class="lineno">190</span><span class="keyword" id="2084580">func</span>&nbsp;<span class="ident" id="2084585">selectgoImpl</span><span class="op" id="2084597">(</span><span class="ident" id="2084598">sel</span>&nbsp;<span class="op" id="2084602">*</span><span class="ident" id="2084603"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2084610">)</span>&nbsp;<span class="op" id="2084612">(</span><span class="builtintype" id="2084613">uintptr</span><span class="op" id="2084620">,</span>&nbsp;<span class="builtintype" id="2084622">uint16</span><span class="op" id="2084628">)</span>&nbsp;<span class="op" id="2084630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084633">if</span>&nbsp;<span class="ident" id="2084636"><a href="/runtime/select.go.html#2079304">debugSelect</a></span>&nbsp;<span class="op" id="2084648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2084652">print</span><span class="op" id="2084657">(</span><span class="string" id="2084658">&#34;select:&nbsp;sel=&#34;</span><span class="op" id="2084672">,</span>&nbsp;<span class="ident" id="2084674"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2084677">,</span>&nbsp;<span class="string" id="2084679">&#34;\n&#34;</span><span class="op" id="2084683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084690">scaseslice</span>&nbsp;<span class="op" id="2084701">:=</span>&nbsp;<span class="ident" id="2084704"><a href="/runtime/slice.go.html#2106458">sliceStruct</a></span><span class="op" id="2084715">{</span><span class="ident" id="2084716"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2084722">.</span><span class="ident" id="2084723">Pointer</span><span class="op" id="2084730">(</span><span class="op" id="2084731">&amp;</span><span class="ident" id="2084732"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2084735">.</span><span class="ident" id="2084736">scase</span><span class="op" id="2084741">)</span><span class="op" id="2084742">,</span>&nbsp;<span class="builtintype" id="2084744">int</span><span class="op" id="2084747">(</span><span class="ident" id="2084748"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2084751">.</span><span class="ident" id="2084752">ncase</span><span class="op" id="2084757">)</span><span class="op" id="2084758">,</span>&nbsp;<span class="builtintype" id="2084760">int</span><span class="op" id="2084763">(</span><span class="ident" id="2084764"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2084767">.</span><span class="ident" id="2084768">ncase</span><span class="op" id="2084773">)</span><span class="op" id="2084774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084777">scases</span>&nbsp;<span class="op" id="2084784">:=</span>&nbsp;<span class="op" id="2084787">*</span><span class="op" id="2084788">(</span><span class="op" id="2084789">*</span><span class="op" id="2084790">[</span><span class="op" id="2084791">]</span><span class="ident" id="2084792"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189959">scase</a></span><span class="op" id="2084797">)</span><span class="op" id="2084798">(</span><span class="ident" id="2084799"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2084805">.</span><span class="ident" id="2084806">Pointer</span><span class="op" id="2084813">(</span><span class="op" id="2084814">&amp;</span><span class="ident" id="2084815"><a href="/runtime/select.go.html#2084690">scaseslice</a></span><span class="op" id="2084825">)</span><span class="op" id="2084826">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084830">var</span>&nbsp;<span class="ident" id="2084834">t0</span>&nbsp;<span class="ident" id="2084837">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084844">if</span>&nbsp;<span class="ident" id="2084847"><a href="/runtime/mprof.go.html#2019313">blockprofilerate</a></span>&nbsp;<span class="op" id="2084864">&gt;</span>&nbsp;<span class="num" id="2084866">0</span>&nbsp;<span class="op" id="2084868">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084872"><a href="/runtime/select.go.html#2084834">t0</a></span>&nbsp;<span class="op" id="2084875">=</span>&nbsp;<span class="ident" id="2084877"><a href="/runtime/stubs.go.html#2137246">cputicks</a></span><span class="op" id="2084885">(</span><span class="op" id="2084886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084890">for</span>&nbsp;<span class="ident" id="2084894">i</span>&nbsp;<span class="op" id="2084896">:=</span>&nbsp;<span class="num" id="2084899">0</span><span class="op" id="2084900">;</span>&nbsp;<span class="ident" id="2084902"><a href="/runtime/select.go.html#2084894">i</a></span>&nbsp;<span class="op" id="2084904">&lt;</span>&nbsp;<span class="builtintype" id="2084906">int</span><span class="op" id="2084909">(</span><span class="ident" id="2084910"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2084913">.</span><span class="ident" id="2084914">ncase</span><span class="op" id="2084919">)</span><span class="op" id="2084920">;</span>&nbsp;<span class="ident" id="2084922"><a href="/runtime/select.go.html#2084894">i</a></span><span class="op" id="2084923">++</span>&nbsp;<span class="op" id="2084926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084931"><a href="/runtime/select.go.html#2084777">scases</a></span><span class="op" id="2084937">[</span><span class="ident" id="2084938"><a href="/runtime/select.go.html#2084894">i</a></span><span class="op" id="2084939">]</span><span class="op" id="2084940">.</span><span class="ident" id="2084941">releasetime</span>&nbsp;<span class="op" id="2084953">=</span>&nbsp;<span class="op" id="2084955">-</span><span class="num" id="2084956">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2084963">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2084967">//&nbsp;The&nbsp;compiler&nbsp;rewrites&nbsp;selects&nbsp;that&nbsp;statically&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2085022">//&nbsp;only&nbsp;0&nbsp;or&nbsp;1&nbsp;cases&nbsp;plus&nbsp;default&nbsp;into&nbsp;simpler&nbsp;constructs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2085082">//&nbsp;The&nbsp;only&nbsp;way&nbsp;we&nbsp;can&nbsp;end&nbsp;up&nbsp;with&nbsp;such&nbsp;small&nbsp;sel.ncase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2085139">//&nbsp;values&nbsp;here&nbsp;is&nbsp;for&nbsp;a&nbsp;larger&nbsp;select&nbsp;in&nbsp;which&nbsp;most&nbsp;channels</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2085201">//&nbsp;have&nbsp;been&nbsp;nilled&nbsp;out.&nbsp;&nbsp;The&nbsp;general&nbsp;code&nbsp;handles&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2085259">//&nbsp;cases&nbsp;correctly,&nbsp;and&nbsp;they&nbsp;are&nbsp;rare&nbsp;enough&nbsp;not&nbsp;to&nbsp;bother</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2085319">//&nbsp;optimizing&nbsp;(and&nbsp;needing&nbsp;to&nbsp;test).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2085358">//&nbsp;generate&nbsp;permuted&nbsp;order</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085386">pollslice</span>&nbsp;<span class="op" id="2085396">:=</span>&nbsp;<span class="ident" id="2085399"><a href="/runtime/slice.go.html#2106458">sliceStruct</a></span><span class="op" id="2085410">{</span><span class="ident" id="2085411"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2085417">.</span><span class="ident" id="2085418">Pointer</span><span class="op" id="2085425">(</span><span class="ident" id="2085426"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2085429">.</span><span class="ident" id="2085430">pollorder</span><span class="op" id="2085439">)</span><span class="op" id="2085440">,</span>&nbsp;<span class="builtintype" id="2085442">int</span><span class="op" id="2085445">(</span><span class="ident" id="2085446"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2085449">.</span><span class="ident" id="2085450">ncase</span><span class="op" id="2085455">)</span><span class="op" id="2085456">,</span>&nbsp;<span class="builtintype" id="2085458">int</span><span class="op" id="2085461">(</span><span class="ident" id="2085462"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2085465">.</span><span class="ident" id="2085466">ncase</span><span class="op" id="2085471">)</span><span class="op" id="2085472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085475">pollorder</span>&nbsp;<span class="op" id="2085485">:=</span>&nbsp;<span class="op" id="2085488">*</span><span class="op" id="2085489">(</span><span class="op" id="2085490">*</span><span class="op" id="2085491">[</span><span class="op" id="2085492">]</span><span class="builtintype" id="2085493">uint16</span><span class="op" id="2085499">)</span><span class="op" id="2085500">(</span><span class="ident" id="2085501"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2085507">.</span><span class="ident" id="2085508">Pointer</span><span class="op" id="2085515">(</span><span class="op" id="2085516">&amp;</span><span class="ident" id="2085517"><a href="/runtime/select.go.html#2085386">pollslice</a></span><span class="op" id="2085526">)</span><span class="op" id="2085527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085530">for</span>&nbsp;<span class="ident" id="2085534">i</span>&nbsp;<span class="op" id="2085536">:=</span>&nbsp;<span class="num" id="2085539">0</span><span class="op" id="2085540">;</span>&nbsp;<span class="ident" id="2085542"><a href="/runtime/select.go.html#2085534">i</a></span>&nbsp;<span class="op" id="2085544">&lt;</span>&nbsp;<span class="builtintype" id="2085546">int</span><span class="op" id="2085549">(</span><span class="ident" id="2085550"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2085553">.</span><span class="ident" id="2085554">ncase</span><span class="op" id="2085559">)</span><span class="op" id="2085560">;</span>&nbsp;<span class="ident" id="2085562"><a href="/runtime/select.go.html#2085534">i</a></span><span class="op" id="2085563">++</span>&nbsp;<span class="op" id="2085566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085570"><a href="/runtime/select.go.html#2085475">pollorder</a></span><span class="op" id="2085579">[</span><span class="ident" id="2085580"><a href="/runtime/select.go.html#2085534">i</a></span><span class="op" id="2085581">]</span>&nbsp;<span class="op" id="2085583">=</span>&nbsp;<span class="builtintype" id="2085585">uint16</span><span class="op" id="2085591">(</span><span class="ident" id="2085592"><a href="/runtime/select.go.html#2085534">i</a></span><span class="op" id="2085593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2085596">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085599">for</span>&nbsp;<span class="ident" id="2085603">i</span>&nbsp;<span class="op" id="2085605">:=</span>&nbsp;<span class="num" id="2085608">1</span><span class="op" id="2085609">;</span>&nbsp;<span class="ident" id="2085611"><a href="/runtime/select.go.html#2085603">i</a></span>&nbsp;<span class="op" id="2085613">&lt;</span>&nbsp;<span class="builtintype" id="2085615">int</span><span class="op" id="2085618">(</span><span class="ident" id="2085619"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2085622">.</span><span class="ident" id="2085623">ncase</span><span class="op" id="2085628">)</span><span class="op" id="2085629">;</span>&nbsp;<span class="ident" id="2085631"><a href="/runtime/select.go.html#2085603">i</a></span><span class="op" id="2085632">++</span>&nbsp;<span class="op" id="2085635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085639">o</span>&nbsp;<span class="op" id="2085641">:=</span>&nbsp;<span class="ident" id="2085644"><a href="/runtime/select.go.html#2085475">pollorder</a></span><span class="op" id="2085653">[</span><span class="ident" id="2085654"><a href="/runtime/select.go.html#2085603">i</a></span><span class="op" id="2085655">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085659">j</span>&nbsp;<span class="op" id="2085661">:=</span>&nbsp;<span class="builtintype" id="2085664">int</span><span class="op" id="2085667">(</span><span class="ident" id="2085668"><a href="/runtime/stubs.go.html#2136047">fastrand1</a></span><span class="op" id="2085677">(</span><span class="op" id="2085678">)</span><span class="op" id="2085679">)</span>&nbsp;<span class="op" id="2085681">%</span>&nbsp;<span class="op" id="2085683">(</span><span class="ident" id="2085684"><a href="/runtime/select.go.html#2085603">i</a></span>&nbsp;<span class="op" id="2085686">+</span>&nbsp;<span class="num" id="2085688">1</span><span class="op" id="2085689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085693"><a href="/runtime/select.go.html#2085475">pollorder</a></span><span class="op" id="2085702">[</span><span class="ident" id="2085703"><a href="/runtime/select.go.html#2085603">i</a></span><span class="op" id="2085704">]</span>&nbsp;<span class="op" id="2085706">=</span>&nbsp;<span class="ident" id="2085708"><a href="/runtime/select.go.html#2085475">pollorder</a></span><span class="op" id="2085717">[</span><span class="ident" id="2085718"><a href="/runtime/select.go.html#2085659">j</a></span><span class="op" id="2085719">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085723"><a href="/runtime/select.go.html#2085475">pollorder</a></span><span class="op" id="2085732">[</span><span class="ident" id="2085733"><a href="/runtime/select.go.html#2085659">j</a></span><span class="op" id="2085734">]</span>&nbsp;<span class="op" id="2085736">=</span>&nbsp;<span class="ident" id="2085738"><a href="/runtime/select.go.html#2085639">o</a></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2085741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2085745">//&nbsp;sort&nbsp;the&nbsp;cases&nbsp;by&nbsp;Hchan&nbsp;address&nbsp;to&nbsp;get&nbsp;the&nbsp;locking&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2085807">//&nbsp;simple&nbsp;heap&nbsp;sort,&nbsp;to&nbsp;guarantee&nbsp;n&nbsp;log&nbsp;n&nbsp;time&nbsp;and&nbsp;constant&nbsp;stack&nbsp;footprint.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085885">lockslice</span>&nbsp;<span class="op" id="2085895">:=</span>&nbsp;<span class="ident" id="2085898"><a href="/runtime/slice.go.html#2106458">sliceStruct</a></span><span class="op" id="2085909">{</span><span class="ident" id="2085910"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2085916">.</span><span class="ident" id="2085917">Pointer</span><span class="op" id="2085924">(</span><span class="ident" id="2085925"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2085928">.</span><span class="ident" id="2085929">lockorder</span><span class="op" id="2085938">)</span><span class="op" id="2085939">,</span>&nbsp;<span class="builtintype" id="2085941">int</span><span class="op" id="2085944">(</span><span class="ident" id="2085945"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2085948">.</span><span class="ident" id="2085949">ncase</span><span class="op" id="2085954">)</span><span class="op" id="2085955">,</span>&nbsp;<span class="builtintype" id="2085957">int</span><span class="op" id="2085960">(</span><span class="ident" id="2085961"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2085964">.</span><span class="ident" id="2085965">ncase</span><span class="op" id="2085970">)</span><span class="op" id="2085971">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085974">lockorder</span>&nbsp;<span class="op" id="2085984">:=</span>&nbsp;<span class="op" id="2085987">*</span><span class="op" id="2085988">(</span><span class="op" id="2085989">*</span><span class="op" id="2085990">[</span><span class="op" id="2085991">]</span><span class="op" id="2085992">*</span><span class="ident" id="2085993"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="2085998">)</span><span class="op" id="2085999">(</span><span class="ident" id="2086000"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2086006">.</span><span class="ident" id="2086007">Pointer</span><span class="op" id="2086014">(</span><span class="op" id="2086015">&amp;</span><span class="ident" id="2086016"><a href="/runtime/select.go.html#2085885">lockslice</a></span><span class="op" id="2086025">)</span><span class="op" id="2086026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086029">for</span>&nbsp;<span class="ident" id="2086033">i</span>&nbsp;<span class="op" id="2086035">:=</span>&nbsp;<span class="num" id="2086038">0</span><span class="op" id="2086039">;</span>&nbsp;<span class="ident" id="2086041"><a href="/runtime/select.go.html#2086033">i</a></span>&nbsp;<span class="op" id="2086043">&lt;</span>&nbsp;<span class="builtintype" id="2086045">int</span><span class="op" id="2086048">(</span><span class="ident" id="2086049"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2086052">.</span><span class="ident" id="2086053">ncase</span><span class="op" id="2086058">)</span><span class="op" id="2086059">;</span>&nbsp;<span class="ident" id="2086061"><a href="/runtime/select.go.html#2086033">i</a></span><span class="op" id="2086062">++</span>&nbsp;<span class="op" id="2086065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086069">j</span>&nbsp;<span class="op" id="2086071">:=</span>&nbsp;<span class="ident" id="2086074"><a href="/runtime/select.go.html#2086033">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086078">c</span>&nbsp;<span class="op" id="2086080">:=</span>&nbsp;<span class="ident" id="2086083"><a href="/runtime/select.go.html#2084777">scases</a></span><span class="op" id="2086089">[</span><span class="ident" id="2086090"><a href="/runtime/select.go.html#2086069">j</a></span><span class="op" id="2086091">]</span><span class="op" id="2086092">.</span><span class="ident" id="2086093">_chan</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086101">for</span>&nbsp;<span class="ident" id="2086105"><a href="/runtime/select.go.html#2086069">j</a></span>&nbsp;<span class="op" id="2086107">&gt;</span>&nbsp;<span class="num" id="2086109">0</span>&nbsp;<span class="op" id="2086111">&amp;&amp;</span>&nbsp;<span class="ident" id="2086114"><a href="/runtime/select.go.html#2085974">lockorder</a></span><span class="op" id="2086123">[</span><span class="op" id="2086124">(</span><span class="ident" id="2086125"><a href="/runtime/select.go.html#2086069">j</a></span><span class="op" id="2086126">-</span><span class="num" id="2086127">1</span><span class="op" id="2086128">)</span><span class="op" id="2086129">/</span><span class="num" id="2086130">2</span><span class="op" id="2086131">]</span><span class="op" id="2086132">.</span><span class="ident" id="2086133">sortkey</span><span class="op" id="2086140">(</span><span class="op" id="2086141">)</span>&nbsp;<span class="op" id="2086143">&lt;</span>&nbsp;<span class="ident" id="2086145"><a href="/runtime/select.go.html#2086078">c</a></span><span class="op" id="2086146">.</span><span class="ident" id="2086147">sortkey</span><span class="op" id="2086154">(</span><span class="op" id="2086155">)</span>&nbsp;<span class="op" id="2086157">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086162">k</span>&nbsp;<span class="op" id="2086164">:=</span>&nbsp;<span class="op" id="2086167">(</span><span class="ident" id="2086168"><a href="/runtime/select.go.html#2086069">j</a></span>&nbsp;<span class="op" id="2086170">-</span>&nbsp;<span class="num" id="2086172">1</span><span class="op" id="2086173">)</span>&nbsp;<span class="op" id="2086175">/</span>&nbsp;<span class="num" id="2086177">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086182"><a href="/runtime/select.go.html#2085974">lockorder</a></span><span class="op" id="2086191">[</span><span class="ident" id="2086192"><a href="/runtime/select.go.html#2086069">j</a></span><span class="op" id="2086193">]</span>&nbsp;<span class="op" id="2086195">=</span>&nbsp;<span class="ident" id="2086197"><a href="/runtime/select.go.html#2085974">lockorder</a></span><span class="op" id="2086206">[</span><span class="ident" id="2086207"><a href="/runtime/select.go.html#2086162">k</a></span><span class="op" id="2086208">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086213"><a href="/runtime/select.go.html#2086069">j</a></span>&nbsp;<span class="op" id="2086215">=</span>&nbsp;<span class="ident" id="2086217"><a href="/runtime/select.go.html#2086162">k</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086225"><a href="/runtime/select.go.html#2085974">lockorder</a></span><span class="op" id="2086234">[</span><span class="ident" id="2086235"><a href="/runtime/select.go.html#2086069">j</a></span><span class="op" id="2086236">]</span>&nbsp;<span class="op" id="2086238">=</span>&nbsp;<span class="ident" id="2086240"><a href="/runtime/select.go.html#2086078">c</a></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086246">for</span>&nbsp;<span class="ident" id="2086250">i</span>&nbsp;<span class="op" id="2086252">:=</span>&nbsp;<span class="builtintype" id="2086255">int</span><span class="op" id="2086258">(</span><span class="ident" id="2086259"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2086262">.</span><span class="ident" id="2086263">ncase</span><span class="op" id="2086268">)</span>&nbsp;<span class="op" id="2086270">-</span>&nbsp;<span class="num" id="2086272">1</span><span class="op" id="2086273">;</span>&nbsp;<span class="ident" id="2086275"><a href="/runtime/select.go.html#2086250">i</a></span>&nbsp;<span class="op" id="2086277">&gt;=</span>&nbsp;<span class="num" id="2086280">0</span><span class="op" id="2086281">;</span>&nbsp;<span class="ident" id="2086283"><a href="/runtime/select.go.html#2086250">i</a></span><span class="op" id="2086284">--</span>&nbsp;<span class="op" id="2086287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086291">c</span>&nbsp;<span class="op" id="2086293">:=</span>&nbsp;<span class="ident" id="2086296"><a href="/runtime/select.go.html#2085974">lockorder</a></span><span class="op" id="2086305">[</span><span class="ident" id="2086306"><a href="/runtime/select.go.html#2086250">i</a></span><span class="op" id="2086307">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086311"><a href="/runtime/select.go.html#2085974">lockorder</a></span><span class="op" id="2086320">[</span><span class="ident" id="2086321"><a href="/runtime/select.go.html#2086250">i</a></span><span class="op" id="2086322">]</span>&nbsp;<span class="op" id="2086324">=</span>&nbsp;<span class="ident" id="2086326"><a href="/runtime/select.go.html#2085974">lockorder</a></span><span class="op" id="2086335">[</span><span class="num" id="2086336">0</span><span class="op" id="2086337">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086341">j</span>&nbsp;<span class="op" id="2086343">:=</span>&nbsp;<span class="num" id="2086346">0</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086350">for</span>&nbsp;<span class="op" id="2086354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086359">k</span>&nbsp;<span class="op" id="2086361">:=</span>&nbsp;<span class="ident" id="2086364"><a href="/runtime/select.go.html#2086341">j</a></span><span class="op" id="2086365">*</span><span class="num" id="2086366">2</span>&nbsp;<span class="op" id="2086368">+</span>&nbsp;<span class="num" id="2086370">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086375">if</span>&nbsp;<span class="ident" id="2086378"><a href="/runtime/select.go.html#2086359">k</a></span>&nbsp;<span class="op" id="2086380">&gt;=</span>&nbsp;<span class="ident" id="2086383"><a href="/runtime/select.go.html#2086250">i</a></span>&nbsp;<span class="op" id="2086385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086391">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086400">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086405">if</span>&nbsp;<span class="ident" id="2086408"><a href="/runtime/select.go.html#2086359">k</a></span><span class="op" id="2086409">+</span><span class="num" id="2086410">1</span>&nbsp;<span class="op" id="2086412">&lt;</span>&nbsp;<span class="ident" id="2086414"><a href="/runtime/select.go.html#2086250">i</a></span>&nbsp;<span class="op" id="2086416">&amp;&amp;</span>&nbsp;<span class="ident" id="2086419"><a href="/runtime/select.go.html#2085974">lockorder</a></span><span class="op" id="2086428">[</span><span class="ident" id="2086429"><a href="/runtime/select.go.html#2086359">k</a></span><span class="op" id="2086430">]</span><span class="op" id="2086431">.</span><span class="ident" id="2086432">sortkey</span><span class="op" id="2086439">(</span><span class="op" id="2086440">)</span>&nbsp;<span class="op" id="2086442">&lt;</span>&nbsp;<span class="ident" id="2086444"><a href="/runtime/select.go.html#2085974">lockorder</a></span><span class="op" id="2086453">[</span><span class="ident" id="2086454"><a href="/runtime/select.go.html#2086359">k</a></span><span class="op" id="2086455">+</span><span class="num" id="2086456">1</span><span class="op" id="2086457">]</span><span class="op" id="2086458">.</span><span class="ident" id="2086459">sortkey</span><span class="op" id="2086466">(</span><span class="op" id="2086467">)</span>&nbsp;<span class="op" id="2086469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086475"><a href="/runtime/select.go.html#2086359">k</a></span><span class="op" id="2086476">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086487">if</span>&nbsp;<span class="ident" id="2086490"><a href="/runtime/select.go.html#2086291">c</a></span><span class="op" id="2086491">.</span><span class="ident" id="2086492">sortkey</span><span class="op" id="2086499">(</span><span class="op" id="2086500">)</span>&nbsp;<span class="op" id="2086502">&lt;</span>&nbsp;<span class="ident" id="2086504"><a href="/runtime/select.go.html#2085974">lockorder</a></span><span class="op" id="2086513">[</span><span class="ident" id="2086514"><a href="/runtime/select.go.html#2086359">k</a></span><span class="op" id="2086515">]</span><span class="op" id="2086516">.</span><span class="ident" id="2086517">sortkey</span><span class="op" id="2086524">(</span><span class="op" id="2086525">)</span>&nbsp;<span class="op" id="2086527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086533"><a href="/runtime/select.go.html#2085974">lockorder</a></span><span class="op" id="2086542">[</span><span class="ident" id="2086543"><a href="/runtime/select.go.html#2086341">j</a></span><span class="op" id="2086544">]</span>&nbsp;<span class="op" id="2086546">=</span>&nbsp;<span class="ident" id="2086548"><a href="/runtime/select.go.html#2085974">lockorder</a></span><span class="op" id="2086557">[</span><span class="ident" id="2086558"><a href="/runtime/select.go.html#2086359">k</a></span><span class="op" id="2086559">]</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086565"><a href="/runtime/select.go.html#2086341">j</a></span>&nbsp;<span class="op" id="2086567">=</span>&nbsp;<span class="ident" id="2086569"><a href="/runtime/select.go.html#2086359">k</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086575">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086592">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086600">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086604"><a href="/runtime/select.go.html#2085974">lockorder</a></span><span class="op" id="2086613">[</span><span class="ident" id="2086614"><a href="/runtime/select.go.html#2086341">j</a></span><span class="op" id="2086615">]</span>&nbsp;<span class="op" id="2086617">=</span>&nbsp;<span class="ident" id="2086619"><a href="/runtime/select.go.html#2086291">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2086625">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfor&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i+1&nbsp;&lt;&nbsp;int(sel.ncase);&nbsp;i++&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;lockorder[i].sortkey()&nbsp;&gt;&nbsp;lockorder[i+1].sortkey()&nbsp;{<br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspprint(&#34;i=&#34;,&nbsp;i,&nbsp;&#34;&nbsp;x=&#34;,&nbsp;lockorder[i],&nbsp;&#34;&nbsp;y=&#34;,&nbsp;lockorder[i+1],&nbsp;&#34;\n&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspgothrow(&#34;select:&nbsp;broken&nbsp;sort&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp*/</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2086847">//&nbsp;lock&nbsp;all&nbsp;the&nbsp;channels&nbsp;involved&nbsp;in&nbsp;the&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086896"><a href="/runtime/select.go.html#2082812">sellock</a></span><span class="op" id="2086903">(</span><span class="ident" id="2086904"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2086907">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086911">var</span>&nbsp;<span class="op" id="2086915">(</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086919">gp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2086926">*</span><span class="ident" id="2086927"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086931">done</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2086938">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086947">sg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2086954">*</span><span class="ident" id="2086955"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179851">sudog</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086963">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2086970">*</span><span class="ident" id="2086971"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086979">k</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2086986">*</span><span class="ident" id="2086987"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189959">scase</a></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086995">sglist</span>&nbsp;<span class="op" id="2087002">*</span><span class="ident" id="2087003"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179851">sudog</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087011">sgnext</span>&nbsp;<span class="op" id="2087018">*</span><span class="ident" id="2087019"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179851">sudog</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087026">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="2087029">loop</span><span class="op" id="2087033">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2087036">//&nbsp;pass&nbsp;1&nbsp;-&nbsp;look&nbsp;for&nbsp;something&nbsp;already&nbsp;waiting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087084">var</span>&nbsp;<span class="ident" id="2087088">dfl</span>&nbsp;<span class="op" id="2087092">*</span><span class="ident" id="2087093"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189959">scase</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087100">var</span>&nbsp;<span class="ident" id="2087104">cas</span>&nbsp;<span class="op" id="2087108">*</span><span class="ident" id="2087109"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189959">scase</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087116">for</span>&nbsp;<span class="ident" id="2087120">i</span>&nbsp;<span class="op" id="2087122">:=</span>&nbsp;<span class="num" id="2087125">0</span><span class="op" id="2087126">;</span>&nbsp;<span class="ident" id="2087128"><a href="/runtime/select.go.html#2087120">i</a></span>&nbsp;<span class="op" id="2087130">&lt;</span>&nbsp;<span class="builtintype" id="2087132">int</span><span class="op" id="2087135">(</span><span class="ident" id="2087136"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2087139">.</span><span class="ident" id="2087140">ncase</span><span class="op" id="2087145">)</span><span class="op" id="2087146">;</span>&nbsp;<span class="ident" id="2087148"><a href="/runtime/select.go.html#2087120">i</a></span><span class="op" id="2087149">++</span>&nbsp;<span class="op" id="2087152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087156"><a href="/runtime/select.go.html#2087104">cas</a></span>&nbsp;<span class="op" id="2087160">=</span>&nbsp;<span class="op" id="2087162">&amp;</span><span class="ident" id="2087163"><a href="/runtime/select.go.html#2084777">scases</a></span><span class="op" id="2087169">[</span><span class="ident" id="2087170"><a href="/runtime/select.go.html#2085475">pollorder</a></span><span class="op" id="2087179">[</span><span class="ident" id="2087180"><a href="/runtime/select.go.html#2087120">i</a></span><span class="op" id="2087181">]</span><span class="op" id="2087182">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087186"><a href="/runtime/select.go.html#2086963">c</a></span>&nbsp;<span class="op" id="2087188">=</span>&nbsp;<span class="ident" id="2087190"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2087193">.</span><span class="ident" id="2087194">_chan</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087203">switch</span>&nbsp;<span class="ident" id="2087210"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2087213">.</span><span class="ident" id="2087214">kind</span>&nbsp;<span class="op" id="2087219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087223">case</span>&nbsp;<span class="ident" id="2087228"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189897">_CaseRecv</a></span><span class="op" id="2087237">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087242">if</span>&nbsp;<span class="ident" id="2087245"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2087246">.</span><span class="ident" id="2087247">dataqsiz</span>&nbsp;<span class="op" id="2087256">&gt;</span>&nbsp;<span class="num" id="2087258">0</span>&nbsp;<span class="op" id="2087260">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087266">if</span>&nbsp;<span class="ident" id="2087269"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2087270">.</span><span class="ident" id="2087271">qcount</span>&nbsp;<span class="op" id="2087278">&gt;</span>&nbsp;<span class="num" id="2087280">0</span>&nbsp;<span class="op" id="2087282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087289">goto</span>&nbsp;<span class="ident" id="2087294">asyncrecv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087313">}</span>&nbsp;<span class="keyword" id="2087315">else</span>&nbsp;<span class="op" id="2087320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087326"><a href="/runtime/select.go.html#2086947">sg</a></span>&nbsp;<span class="op" id="2087329">=</span>&nbsp;<span class="ident" id="2087331"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2087332">.</span><span class="ident" id="2087333">sendq</span><span class="op" id="2087338">.</span><span class="ident" id="2087339">dequeue</span><span class="op" id="2087346">(</span><span class="op" id="2087347">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087353">if</span>&nbsp;<span class="ident" id="2087356"><a href="/runtime/select.go.html#2086947">sg</a></span>&nbsp;<span class="op" id="2087359">!=</span>&nbsp;<span class="ident" id="2087362">nil</span>&nbsp;<span class="op" id="2087366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087373">goto</span>&nbsp;<span class="ident" id="2087378">syncrecv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087401">if</span>&nbsp;<span class="ident" id="2087404"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2087405">.</span><span class="ident" id="2087406">closed</span>&nbsp;<span class="op" id="2087413">!=</span>&nbsp;<span class="num" id="2087416">0</span>&nbsp;<span class="op" id="2087418">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087424">goto</span>&nbsp;<span class="ident" id="2087429">rclose</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087444">case</span>&nbsp;<span class="ident" id="2087449"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189917">_CaseSend</a></span><span class="op" id="2087458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087463">if</span>&nbsp;<span class="ident" id="2087466"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="2087478">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087484"><a href="/runtime/race0.go.html#2070294">racereadpc</a></span><span class="op" id="2087494">(</span><span class="ident" id="2087495"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2087501">.</span><span class="ident" id="2087502">Pointer</span><span class="op" id="2087509">(</span><span class="ident" id="2087510"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2087511">)</span><span class="op" id="2087512">,</span>&nbsp;<span class="ident" id="2087514"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2087517">.</span><span class="ident" id="2087518">pc</span><span class="op" id="2087520">,</span>&nbsp;<span class="ident" id="2087522"><a href="/runtime/select.go.html#2079334">chansendpc</a></span><span class="op" id="2087532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087542">if</span>&nbsp;<span class="ident" id="2087545"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2087546">.</span><span class="ident" id="2087547">closed</span>&nbsp;<span class="op" id="2087554">!=</span>&nbsp;<span class="num" id="2087557">0</span>&nbsp;<span class="op" id="2087559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087565">goto</span>&nbsp;<span class="ident" id="2087570">sclose</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087580">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087585">if</span>&nbsp;<span class="ident" id="2087588"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2087589">.</span><span class="ident" id="2087590">dataqsiz</span>&nbsp;<span class="op" id="2087599">&gt;</span>&nbsp;<span class="num" id="2087601">0</span>&nbsp;<span class="op" id="2087603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087609">if</span>&nbsp;<span class="ident" id="2087612"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2087613">.</span><span class="ident" id="2087614">qcount</span>&nbsp;<span class="op" id="2087621">&lt;</span>&nbsp;<span class="ident" id="2087623"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2087624">.</span><span class="ident" id="2087625">dataqsiz</span>&nbsp;<span class="op" id="2087634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087641">goto</span>&nbsp;<span class="ident" id="2087646">asyncsend</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087665">}</span>&nbsp;<span class="keyword" id="2087667">else</span>&nbsp;<span class="op" id="2087672">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087678"><a href="/runtime/select.go.html#2086947">sg</a></span>&nbsp;<span class="op" id="2087681">=</span>&nbsp;<span class="ident" id="2087683"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2087684">.</span><span class="ident" id="2087685">recvq</span><span class="op" id="2087690">.</span><span class="ident" id="2087691">dequeue</span><span class="op" id="2087698">(</span><span class="op" id="2087699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087705">if</span>&nbsp;<span class="ident" id="2087708"><a href="/runtime/select.go.html#2086947">sg</a></span>&nbsp;<span class="op" id="2087711">!=</span>&nbsp;<span class="ident" id="2087714">nil</span>&nbsp;<span class="op" id="2087718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087725">goto</span>&nbsp;<span class="ident" id="2087730">syncsend</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087748">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087753">case</span>&nbsp;<span class="ident" id="2087758"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189937">_CaseDefault</a></span><span class="op" id="2087770">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087775"><a href="/runtime/select.go.html#2087088">dfl</a></span>&nbsp;<span class="op" id="2087779">=</span>&nbsp;<span class="ident" id="2087781"><a href="/runtime/select.go.html#2087104">cas</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087790">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087794">if</span>&nbsp;<span class="ident" id="2087797"><a href="/runtime/select.go.html#2087088">dfl</a></span>&nbsp;<span class="op" id="2087801">!=</span>&nbsp;<span class="ident" id="2087804">nil</span>&nbsp;<span class="op" id="2087808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087812"><a href="/runtime/select.go.html#2083096">selunlock</a></span><span class="op" id="2087821">(</span><span class="ident" id="2087822"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2087825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087829"><a href="/runtime/select.go.html#2087104">cas</a></span>&nbsp;<span class="op" id="2087833">=</span>&nbsp;<span class="ident" id="2087835"><a href="/runtime/select.go.html#2087088">dfl</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087841">goto</span>&nbsp;<span class="ident" id="2087846">retc</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2087856">//&nbsp;pass&nbsp;2&nbsp;-&nbsp;enqueue&nbsp;on&nbsp;all&nbsp;chans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087890"><a href="/runtime/select.go.html#2086919">gp</a></span>&nbsp;<span class="op" id="2087893">=</span>&nbsp;<span class="ident" id="2087895"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="2087899">(</span><span class="op" id="2087900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087903"><a href="/runtime/select.go.html#2086931">done</a></span>&nbsp;<span class="op" id="2087908">=</span>&nbsp;<span class="num" id="2087910">0</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087913">for</span>&nbsp;<span class="ident" id="2087917">i</span>&nbsp;<span class="op" id="2087919">:=</span>&nbsp;<span class="num" id="2087922">0</span><span class="op" id="2087923">;</span>&nbsp;<span class="ident" id="2087925"><a href="/runtime/select.go.html#2087917">i</a></span>&nbsp;<span class="op" id="2087927">&lt;</span>&nbsp;<span class="builtintype" id="2087929">int</span><span class="op" id="2087932">(</span><span class="ident" id="2087933"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2087936">.</span><span class="ident" id="2087937">ncase</span><span class="op" id="2087942">)</span><span class="op" id="2087943">;</span>&nbsp;<span class="ident" id="2087945"><a href="/runtime/select.go.html#2087917">i</a></span><span class="op" id="2087946">++</span>&nbsp;<span class="op" id="2087949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087953"><a href="/runtime/select.go.html#2087104">cas</a></span>&nbsp;<span class="op" id="2087957">=</span>&nbsp;<span class="op" id="2087959">&amp;</span><span class="ident" id="2087960"><a href="/runtime/select.go.html#2084777">scases</a></span><span class="op" id="2087966">[</span><span class="ident" id="2087967"><a href="/runtime/select.go.html#2085475">pollorder</a></span><span class="op" id="2087976">[</span><span class="ident" id="2087977"><a href="/runtime/select.go.html#2087917">i</a></span><span class="op" id="2087978">]</span><span class="op" id="2087979">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087983"><a href="/runtime/select.go.html#2086963">c</a></span>&nbsp;<span class="op" id="2087985">=</span>&nbsp;<span class="ident" id="2087987"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2087990">.</span><span class="ident" id="2087991">_chan</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087999">sg</span>&nbsp;<span class="op" id="2088002">:=</span>&nbsp;<span class="ident" id="2088005"><a href="/runtime/proc.go.html#2067140">acquireSudog</a></span><span class="op" id="2088017">(</span><span class="op" id="2088018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088022"><a href="/runtime/select.go.html#2087999">sg</a></span><span class="op" id="2088024">.</span><span class="ident" id="2088025">g</span>&nbsp;<span class="op" id="2088027">=</span>&nbsp;<span class="ident" id="2088029"><a href="/runtime/select.go.html#2086919">gp</a></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2088034">//&nbsp;Note:&nbsp;selectdone&nbsp;is&nbsp;adjusted&nbsp;for&nbsp;stack&nbsp;copies&nbsp;in&nbsp;stack.c:adjustsudogs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088109"><a href="/runtime/select.go.html#2087999">sg</a></span><span class="op" id="2088111">.</span><span class="ident" id="2088112">selectdone</span>&nbsp;<span class="op" id="2088123">=</span>&nbsp;<span class="op" id="2088125">(</span><span class="op" id="2088126">*</span><span class="builtintype" id="2088127">uint32</span><span class="op" id="2088133">)</span><span class="op" id="2088134">(</span><span class="ident" id="2088135"><a href="/runtime/stubs.go.html#2136422">noescape</a></span><span class="op" id="2088143">(</span><span class="ident" id="2088144"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2088150">.</span><span class="ident" id="2088151">Pointer</span><span class="op" id="2088158">(</span><span class="op" id="2088159">&amp;</span><span class="ident" id="2088160"><a href="/runtime/select.go.html#2086931">done</a></span><span class="op" id="2088164">)</span><span class="op" id="2088165">)</span><span class="op" id="2088166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088170"><a href="/runtime/select.go.html#2087999">sg</a></span><span class="op" id="2088172">.</span><span class="ident" id="2088173">elem</span>&nbsp;<span class="op" id="2088178">=</span>&nbsp;<span class="ident" id="2088180"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2088183">.</span><span class="ident" id="2088184">elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088191"><a href="/runtime/select.go.html#2087999">sg</a></span><span class="op" id="2088193">.</span><span class="ident" id="2088194">releasetime</span>&nbsp;<span class="op" id="2088206">=</span>&nbsp;<span class="num" id="2088208">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2088212">if</span>&nbsp;<span class="ident" id="2088215"><a href="/runtime/select.go.html#2084834">t0</a></span>&nbsp;<span class="op" id="2088218">!=</span>&nbsp;<span class="num" id="2088221">0</span>&nbsp;<span class="op" id="2088223">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088228"><a href="/runtime/select.go.html#2087999">sg</a></span><span class="op" id="2088230">.</span><span class="ident" id="2088231">releasetime</span>&nbsp;<span class="op" id="2088243">=</span>&nbsp;<span class="op" id="2088245">-</span><span class="num" id="2088246">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2088250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088254"><a href="/runtime/select.go.html#2087999">sg</a></span><span class="op" id="2088256">.</span><span class="ident" id="2088257">waitlink</span>&nbsp;<span class="op" id="2088266">=</span>&nbsp;<span class="ident" id="2088268"><a href="/runtime/select.go.html#2086919">gp</a></span><span class="op" id="2088270">.</span><span class="ident" id="2088271">waiting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088281"><a href="/runtime/select.go.html#2086919">gp</a></span><span class="op" id="2088283">.</span><span class="ident" id="2088284">waiting</span>&nbsp;<span class="op" id="2088292">=</span>&nbsp;<span class="ident" id="2088294"><a href="/runtime/select.go.html#2087999">sg</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2088300">switch</span>&nbsp;<span class="ident" id="2088307"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2088310">.</span><span class="ident" id="2088311">kind</span>&nbsp;<span class="op" id="2088316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2088320">case</span>&nbsp;<span class="ident" id="2088325"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189897">_CaseRecv</a></span><span class="op" id="2088334">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088339"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2088340">.</span><span class="ident" id="2088341">recvq</span><span class="op" id="2088346">.</span><span class="ident" id="2088347">enqueue</span><span class="op" id="2088354">(</span><span class="ident" id="2088355"><a href="/runtime/select.go.html#2087999">sg</a></span><span class="op" id="2088357">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2088362">case</span>&nbsp;<span class="ident" id="2088367"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189917">_CaseSend</a></span><span class="op" id="2088376">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088381"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2088382">.</span><span class="ident" id="2088383">sendq</span><span class="op" id="2088388">.</span><span class="ident" id="2088389">enqueue</span><span class="op" id="2088396">(</span><span class="ident" id="2088397"><a href="/runtime/select.go.html#2087999">sg</a></span><span class="op" id="2088399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2088403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2088406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2088410">//&nbsp;wait&nbsp;for&nbsp;someone&nbsp;to&nbsp;wake&nbsp;us&nbsp;up</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088445"><a href="/runtime/select.go.html#2086919">gp</a></span><span class="op" id="2088447">.</span><span class="ident" id="2088448">param</span>&nbsp;<span class="op" id="2088454">=</span>&nbsp;<span class="ident" id="2088456">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088461"><a href="/runtime/proc.go.html#2066373">gopark</a></span><span class="op" id="2088467">(</span><span class="ident" id="2088468"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2088474">.</span><span class="ident" id="2088475">Pointer</span><span class="op" id="2088482">(</span><span class="ident" id="2088483"><a href="/runtime/proc.go.html#2068560">funcPC</a></span><span class="op" id="2088489">(</span><span class="ident" id="2088490"><a href="/runtime/select.go.html#2084052">selparkcommit</a></span><span class="op" id="2088503">)</span><span class="op" id="2088504">)</span><span class="op" id="2088505">,</span>&nbsp;<span class="ident" id="2088507"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2088513">.</span><span class="ident" id="2088514">Pointer</span><span class="op" id="2088521">(</span><span class="ident" id="2088522"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2088525">)</span><span class="op" id="2088526">,</span>&nbsp;<span class="string" id="2088528">&#34;select&#34;</span><span class="op" id="2088536">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2088540">//&nbsp;someone&nbsp;woke&nbsp;us&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088563"><a href="/runtime/select.go.html#2082812">sellock</a></span><span class="op" id="2088570">(</span><span class="ident" id="2088571"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2088574">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088577"><a href="/runtime/select.go.html#2086947">sg</a></span>&nbsp;<span class="op" id="2088580">=</span>&nbsp;<span class="op" id="2088582">(</span><span class="op" id="2088583">*</span><span class="ident" id="2088584"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179851">sudog</a></span><span class="op" id="2088589">)</span><span class="op" id="2088590">(</span><span class="ident" id="2088591"><a href="/runtime/select.go.html#2086919">gp</a></span><span class="op" id="2088593">.</span><span class="ident" id="2088594">param</span><span class="op" id="2088599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088602"><a href="/runtime/select.go.html#2086919">gp</a></span><span class="op" id="2088604">.</span><span class="ident" id="2088605">param</span>&nbsp;<span class="op" id="2088611">=</span>&nbsp;<span class="ident" id="2088613">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2088619">//&nbsp;pass&nbsp;3&nbsp;-&nbsp;dequeue&nbsp;from&nbsp;unsuccessful&nbsp;chans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2088664">//&nbsp;otherwise&nbsp;they&nbsp;stack&nbsp;up&nbsp;on&nbsp;quiet&nbsp;channels</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2088710">//&nbsp;record&nbsp;the&nbsp;successful&nbsp;case,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2088750">//&nbsp;We&nbsp;singly-linked&nbsp;up&nbsp;the&nbsp;SudoGs&nbsp;in&nbsp;case&nbsp;order,&nbsp;so&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2088808">//&nbsp;iterating&nbsp;through&nbsp;the&nbsp;linked&nbsp;list&nbsp;they&nbsp;are&nbsp;in&nbsp;reverse&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088873"><a href="/runtime/select.go.html#2087104">cas</a></span>&nbsp;<span class="op" id="2088877">=</span>&nbsp;<span class="ident" id="2088879">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2088884"><a href="/runtime/select.go.html#2086995">sglist</a></span>&nbsp;<span class="op" id="2088891">=</span>&nbsp;<span class="ident" id="2088893"><a href="/runtime/select.go.html#2086919">gp</a></span><span class="op" id="2088895">.</span><span class="ident" id="2088896">waiting</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2088905">//&nbsp;Clear&nbsp;all&nbsp;selectdone&nbsp;and&nbsp;elem&nbsp;before&nbsp;unlinking&nbsp;from&nbsp;gp.waiting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2088973">//&nbsp;They&nbsp;must&nbsp;be&nbsp;cleared&nbsp;before&nbsp;being&nbsp;put&nbsp;back&nbsp;into&nbsp;the&nbsp;sudog&nbsp;cache.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2089042">//&nbsp;Clear&nbsp;before&nbsp;unlinking,&nbsp;because&nbsp;if&nbsp;a&nbsp;stack&nbsp;copy&nbsp;happens&nbsp;after&nbsp;the&nbsp;unlink,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2089120">//&nbsp;they&nbsp;will&nbsp;not&nbsp;be&nbsp;updated,&nbsp;they&nbsp;will&nbsp;be&nbsp;left&nbsp;pointing&nbsp;to&nbsp;the&nbsp;old&nbsp;stack,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2089195">//&nbsp;which&nbsp;creates&nbsp;dangling&nbsp;pointers,&nbsp;which&nbsp;may&nbsp;be&nbsp;detected&nbsp;by&nbsp;the</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2089261">//&nbsp;garbage&nbsp;collector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2089284">for</span>&nbsp;<span class="ident" id="2089288">sg1</span>&nbsp;<span class="op" id="2089292">:=</span>&nbsp;<span class="ident" id="2089295"><a href="/runtime/select.go.html#2086919">gp</a></span><span class="op" id="2089297">.</span><span class="ident" id="2089298">waiting</span><span class="op" id="2089305">;</span>&nbsp;<span class="ident" id="2089307"><a href="/runtime/select.go.html#2089288">sg1</a></span>&nbsp;<span class="op" id="2089311">!=</span>&nbsp;<span class="ident" id="2089314">nil</span><span class="op" id="2089317">;</span>&nbsp;<span class="ident" id="2089319"><a href="/runtime/select.go.html#2089288">sg1</a></span>&nbsp;<span class="op" id="2089323">=</span>&nbsp;<span class="ident" id="2089325"><a href="/runtime/select.go.html#2089288">sg1</a></span><span class="op" id="2089328">.</span><span class="ident" id="2089329">waitlink</span>&nbsp;<span class="op" id="2089338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089342"><a href="/runtime/select.go.html#2089288">sg1</a></span><span class="op" id="2089345">.</span><span class="ident" id="2089346">selectdone</span>&nbsp;<span class="op" id="2089357">=</span>&nbsp;<span class="ident" id="2089359">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089365"><a href="/runtime/select.go.html#2089288">sg1</a></span><span class="op" id="2089368">.</span><span class="ident" id="2089369">elem</span>&nbsp;<span class="op" id="2089374">=</span>&nbsp;<span class="ident" id="2089376">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2089381">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089384"><a href="/runtime/select.go.html#2086919">gp</a></span><span class="op" id="2089386">.</span><span class="ident" id="2089387">waiting</span>&nbsp;<span class="op" id="2089395">=</span>&nbsp;<span class="ident" id="2089397">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2089402">for</span>&nbsp;<span class="ident" id="2089406">i</span>&nbsp;<span class="op" id="2089408">:=</span>&nbsp;<span class="builtintype" id="2089411">int</span><span class="op" id="2089414">(</span><span class="ident" id="2089415"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2089418">.</span><span class="ident" id="2089419">ncase</span><span class="op" id="2089424">)</span>&nbsp;<span class="op" id="2089426">-</span>&nbsp;<span class="num" id="2089428">1</span><span class="op" id="2089429">;</span>&nbsp;<span class="ident" id="2089431"><a href="/runtime/select.go.html#2089406">i</a></span>&nbsp;<span class="op" id="2089433">&gt;=</span>&nbsp;<span class="num" id="2089436">0</span><span class="op" id="2089437">;</span>&nbsp;<span class="ident" id="2089439"><a href="/runtime/select.go.html#2089406">i</a></span><span class="op" id="2089440">--</span>&nbsp;<span class="op" id="2089443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089447"><a href="/runtime/select.go.html#2086979">k</a></span>&nbsp;<span class="op" id="2089449">=</span>&nbsp;<span class="op" id="2089451">&amp;</span><span class="ident" id="2089452"><a href="/runtime/select.go.html#2084777">scases</a></span><span class="op" id="2089458">[</span><span class="ident" id="2089459"><a href="/runtime/select.go.html#2085475">pollorder</a></span><span class="op" id="2089468">[</span><span class="ident" id="2089469"><a href="/runtime/select.go.html#2089406">i</a></span><span class="op" id="2089470">]</span><span class="op" id="2089471">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2089475">if</span>&nbsp;<span class="ident" id="2089478"><a href="/runtime/select.go.html#2086995">sglist</a></span><span class="op" id="2089484">.</span><span class="ident" id="2089485">releasetime</span>&nbsp;<span class="op" id="2089497">&gt;</span>&nbsp;<span class="num" id="2089499">0</span>&nbsp;<span class="op" id="2089501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089506"><a href="/runtime/select.go.html#2086979">k</a></span><span class="op" id="2089507">.</span><span class="ident" id="2089508">releasetime</span>&nbsp;<span class="op" id="2089520">=</span>&nbsp;<span class="ident" id="2089522"><a href="/runtime/select.go.html#2086995">sglist</a></span><span class="op" id="2089528">.</span><span class="ident" id="2089529">releasetime</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2089543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2089547">if</span>&nbsp;<span class="ident" id="2089550"><a href="/runtime/select.go.html#2086947">sg</a></span>&nbsp;<span class="op" id="2089553">==</span>&nbsp;<span class="ident" id="2089556"><a href="/runtime/select.go.html#2086995">sglist</a></span>&nbsp;<span class="op" id="2089563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089568"><a href="/runtime/select.go.html#2087104">cas</a></span>&nbsp;<span class="op" id="2089572">=</span>&nbsp;<span class="ident" id="2089574"><a href="/runtime/select.go.html#2086979">k</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2089578">}</span>&nbsp;<span class="keyword" id="2089580">else</span>&nbsp;<span class="op" id="2089585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089590"><a href="/runtime/select.go.html#2086963">c</a></span>&nbsp;<span class="op" id="2089592">=</span>&nbsp;<span class="ident" id="2089594"><a href="/runtime/select.go.html#2086979">k</a></span><span class="op" id="2089595">.</span><span class="ident" id="2089596">_chan</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2089605">if</span>&nbsp;<span class="ident" id="2089608"><a href="/runtime/select.go.html#2086979">k</a></span><span class="op" id="2089609">.</span><span class="ident" id="2089610">kind</span>&nbsp;<span class="op" id="2089615">==</span>&nbsp;<span class="ident" id="2089618"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189917">_CaseSend</a></span>&nbsp;<span class="op" id="2089628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089634"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2089635">.</span><span class="ident" id="2089636">sendq</span><span class="op" id="2089641">.</span><span class="ident" id="2089642">dequeueSudoG</span><span class="op" id="2089654">(</span><span class="ident" id="2089655"><a href="/runtime/select.go.html#2086995">sglist</a></span><span class="op" id="2089661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2089666">}</span>&nbsp;<span class="keyword" id="2089668">else</span>&nbsp;<span class="op" id="2089673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089679"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2089680">.</span><span class="ident" id="2089681">recvq</span><span class="op" id="2089686">.</span><span class="ident" id="2089687">dequeueSudoG</span><span class="op" id="2089699">(</span><span class="ident" id="2089700"><a href="/runtime/select.go.html#2086995">sglist</a></span><span class="op" id="2089706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2089711">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2089715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089719"><a href="/runtime/select.go.html#2087011">sgnext</a></span>&nbsp;<span class="op" id="2089726">=</span>&nbsp;<span class="ident" id="2089728"><a href="/runtime/select.go.html#2086995">sglist</a></span><span class="op" id="2089734">.</span><span class="ident" id="2089735">waitlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089746"><a href="/runtime/select.go.html#2086995">sglist</a></span><span class="op" id="2089752">.</span><span class="ident" id="2089753">waitlink</span>&nbsp;<span class="op" id="2089762">=</span>&nbsp;<span class="ident" id="2089764">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089770"><a href="/runtime/proc.go.html#2067870">releaseSudog</a></span><span class="op" id="2089782">(</span><span class="ident" id="2089783"><a href="/runtime/select.go.html#2086995">sglist</a></span><span class="op" id="2089789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089793"><a href="/runtime/select.go.html#2086995">sglist</a></span>&nbsp;<span class="op" id="2089800">=</span>&nbsp;<span class="ident" id="2089802"><a href="/runtime/select.go.html#2087011">sgnext</a></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2089810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2089814">if</span>&nbsp;<span class="ident" id="2089817"><a href="/runtime/select.go.html#2087104">cas</a></span>&nbsp;<span class="op" id="2089821">==</span>&nbsp;<span class="ident" id="2089824">nil</span>&nbsp;<span class="op" id="2089828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2089832">goto</span>&nbsp;<span class="ident" id="2089837">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2089843">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089847"><a href="/runtime/select.go.html#2086963">c</a></span>&nbsp;<span class="op" id="2089849">=</span>&nbsp;<span class="ident" id="2089851"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2089854">.</span><span class="ident" id="2089855">_chan</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2089863">if</span>&nbsp;<span class="ident" id="2089866"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2089867">.</span><span class="ident" id="2089868">dataqsiz</span>&nbsp;<span class="op" id="2089877">&gt;</span>&nbsp;<span class="num" id="2089879">0</span>&nbsp;<span class="op" id="2089881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2089885"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2089892">(</span><span class="string" id="2089893">&#34;selectgo:&nbsp;shouldn&#39;t&nbsp;happen&#34;</span><span class="op" id="2089921">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2089924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2089928">if</span>&nbsp;<span class="ident" id="2089931"><a href="/runtime/select.go.html#2079304">debugSelect</a></span>&nbsp;<span class="op" id="2089943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2089947">print</span><span class="op" id="2089952">(</span><span class="string" id="2089953">&#34;wait-return:&nbsp;sel=&#34;</span><span class="op" id="2089972">,</span>&nbsp;<span class="ident" id="2089974"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2089977">,</span>&nbsp;<span class="string" id="2089979">&#34;&nbsp;c=&#34;</span><span class="op" id="2089984">,</span>&nbsp;<span class="ident" id="2089986"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2089987">,</span>&nbsp;<span class="string" id="2089989">&#34;&nbsp;cas=&#34;</span><span class="op" id="2089996">,</span>&nbsp;<span class="ident" id="2089998"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090001">,</span>&nbsp;<span class="string" id="2090003">&#34;&nbsp;kind=&#34;</span><span class="op" id="2090011">,</span>&nbsp;<span class="ident" id="2090013"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090016">.</span><span class="ident" id="2090017">kind</span><span class="op" id="2090021">,</span>&nbsp;<span class="string" id="2090023">&#34;\n&#34;</span><span class="op" id="2090027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2090030">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2090034">if</span>&nbsp;<span class="ident" id="2090037"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090040">.</span><span class="ident" id="2090041">kind</span>&nbsp;<span class="op" id="2090046">==</span>&nbsp;<span class="ident" id="2090049"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189897">_CaseRecv</a></span>&nbsp;<span class="op" id="2090059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2090063">if</span>&nbsp;<span class="ident" id="2090066"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090069">.</span><span class="ident" id="2090070">receivedp</span>&nbsp;<span class="op" id="2090080">!=</span>&nbsp;<span class="ident" id="2090083">nil</span>&nbsp;<span class="op" id="2090087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2090092">*</span><span class="ident" id="2090093"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090096">.</span><span class="ident" id="2090097">receivedp</span>&nbsp;<span class="op" id="2090107">=</span>&nbsp;<span class="builtintype" id="2090109">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2090116">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2090119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2090123">if</span>&nbsp;<span class="ident" id="2090126"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="2090138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2090142">if</span>&nbsp;<span class="ident" id="2090145"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090148">.</span><span class="ident" id="2090149">kind</span>&nbsp;<span class="op" id="2090154">==</span>&nbsp;<span class="ident" id="2090157"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189897">_CaseRecv</a></span>&nbsp;<span class="op" id="2090167">&amp;&amp;</span>&nbsp;<span class="ident" id="2090170"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090173">.</span><span class="ident" id="2090174">elem</span>&nbsp;<span class="op" id="2090179">!=</span>&nbsp;<span class="ident" id="2090182">nil</span>&nbsp;<span class="op" id="2090186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2090191"><a href="/runtime/race0.go.html#2069814">raceWriteObjectPC</a></span><span class="op" id="2090208">(</span><span class="ident" id="2090209"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090210">.</span><span class="ident" id="2090211">elemtype</span><span class="op" id="2090219">,</span>&nbsp;<span class="ident" id="2090221"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090224">.</span><span class="ident" id="2090225">elem</span><span class="op" id="2090229">,</span>&nbsp;<span class="ident" id="2090231"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090234">.</span><span class="ident" id="2090235">pc</span><span class="op" id="2090237">,</span>&nbsp;<span class="ident" id="2090239"><a href="/runtime/select.go.html#2079365">chanrecvpc</a></span><span class="op" id="2090249">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2090253">}</span>&nbsp;<span class="keyword" id="2090255">else</span>&nbsp;<span class="keyword" id="2090260">if</span>&nbsp;<span class="ident" id="2090263"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090266">.</span><span class="ident" id="2090267">kind</span>&nbsp;<span class="op" id="2090272">==</span>&nbsp;<span class="ident" id="2090275"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189917">_CaseSend</a></span>&nbsp;<span class="op" id="2090285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2090290"><a href="/runtime/race0.go.html#2069718">raceReadObjectPC</a></span><span class="op" id="2090306">(</span><span class="ident" id="2090307"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090308">.</span><span class="ident" id="2090309">elemtype</span><span class="op" id="2090317">,</span>&nbsp;<span class="ident" id="2090319"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090322">.</span><span class="ident" id="2090323">elem</span><span class="op" id="2090327">,</span>&nbsp;<span class="ident" id="2090329"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090332">.</span><span class="ident" id="2090333">pc</span><span class="op" id="2090335">,</span>&nbsp;<span class="ident" id="2090337"><a href="/runtime/select.go.html#2079334">chansendpc</a></span><span class="op" id="2090347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2090351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2090354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2090358"><a href="/runtime/select.go.html#2083096">selunlock</a></span><span class="op" id="2090367">(</span><span class="ident" id="2090368"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2090371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2090374">goto</span>&nbsp;<span class="ident" id="2090379">retc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="2090385">asyncrecv</span><span class="op" id="2090394">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2090397">//&nbsp;can&nbsp;receive&nbsp;from&nbsp;buffer</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2090425">if</span>&nbsp;<span class="ident" id="2090428"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="2090440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2090444">if</span>&nbsp;<span class="ident" id="2090447"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090450">.</span><span class="ident" id="2090451">elem</span>&nbsp;<span class="op" id="2090456">!=</span>&nbsp;<span class="ident" id="2090459">nil</span>&nbsp;<span class="op" id="2090463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2090468"><a href="/runtime/race0.go.html#2069814">raceWriteObjectPC</a></span><span class="op" id="2090485">(</span><span class="ident" id="2090486"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090487">.</span><span class="ident" id="2090488">elemtype</span><span class="op" id="2090496">,</span>&nbsp;<span class="ident" id="2090498"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090501">.</span><span class="ident" id="2090502">elem</span><span class="op" id="2090506">,</span>&nbsp;<span class="ident" id="2090508"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090511">.</span><span class="ident" id="2090512">pc</span><span class="op" id="2090514">,</span>&nbsp;<span class="ident" id="2090516"><a href="/runtime/select.go.html#2079365">chanrecvpc</a></span><span class="op" id="2090526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2090530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2090534"><a href="/runtime/race0.go.html#2070582">raceacquire</a></span><span class="op" id="2090545">(</span><span class="ident" id="2090546"><a href="/runtime/chan.go.html#1886811">chanbuf</a></span><span class="op" id="2090553">(</span><span class="ident" id="2090554"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090555">,</span>&nbsp;<span class="ident" id="2090557"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090558">.</span><span class="ident" id="2090559">recvx</span><span class="op" id="2090564">)</span><span class="op" id="2090565">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2090569"><a href="/runtime/race0.go.html#2070774">racerelease</a></span><span class="op" id="2090580">(</span><span class="ident" id="2090581"><a href="/runtime/chan.go.html#1886811">chanbuf</a></span><span class="op" id="2090588">(</span><span class="ident" id="2090589"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090590">,</span>&nbsp;<span class="ident" id="2090592"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090593">.</span><span class="ident" id="2090594">recvx</span><span class="op" id="2090599">)</span><span class="op" id="2090600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2090603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2090606">if</span>&nbsp;<span class="ident" id="2090609"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090612">.</span><span class="ident" id="2090613">receivedp</span>&nbsp;<span class="op" id="2090623">!=</span>&nbsp;<span class="ident" id="2090626">nil</span>&nbsp;<span class="op" id="2090630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2090634">*</span><span class="ident" id="2090635"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090638">.</span><span class="ident" id="2090639">receivedp</span>&nbsp;<span class="op" id="2090649">=</span>&nbsp;<span class="builtintype" id="2090651">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2090657">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2090660">if</span>&nbsp;<span class="ident" id="2090663"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090666">.</span><span class="ident" id="2090667">elem</span>&nbsp;<span class="op" id="2090672">!=</span>&nbsp;<span class="ident" id="2090675">nil</span>&nbsp;<span class="op" id="2090679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2090683"><a href="/runtime/stubs.go.html#2135810">memmove</a></span><span class="op" id="2090690">(</span><span class="ident" id="2090691"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2090694">.</span><span class="ident" id="2090695">elem</span><span class="op" id="2090699">,</span>&nbsp;<span class="ident" id="2090701"><a href="/runtime/chan.go.html#1886811">chanbuf</a></span><span class="op" id="2090708">(</span><span class="ident" id="2090709"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090710">,</span>&nbsp;<span class="ident" id="2090712"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090713">.</span><span class="ident" id="2090714">recvx</span><span class="op" id="2090719">)</span><span class="op" id="2090720">,</span>&nbsp;<span class="builtintype" id="2090722">uintptr</span><span class="op" id="2090729">(</span><span class="ident" id="2090730"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090731">.</span><span class="ident" id="2090732">elemsize</span><span class="op" id="2090740">)</span><span class="op" id="2090741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2090744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2090747"><a href="/runtime/stubs.go.html#2135687">memclr</a></span><span class="op" id="2090753">(</span><span class="ident" id="2090754"><a href="/runtime/chan.go.html#1886811">chanbuf</a></span><span class="op" id="2090761">(</span><span class="ident" id="2090762"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090763">,</span>&nbsp;<span class="ident" id="2090765"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090766">.</span><span class="ident" id="2090767">recvx</span><span class="op" id="2090772">)</span><span class="op" id="2090773">,</span>&nbsp;<span class="builtintype" id="2090775">uintptr</span><span class="op" id="2090782">(</span><span class="ident" id="2090783"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090784">.</span><span class="ident" id="2090785">elemsize</span><span class="op" id="2090793">)</span><span class="op" id="2090794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2090797"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090798">.</span><span class="ident" id="2090799">recvx</span><span class="op" id="2090804">++</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2090808">if</span>&nbsp;<span class="ident" id="2090811"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090812">.</span><span class="ident" id="2090813">recvx</span>&nbsp;<span class="op" id="2090819">==</span>&nbsp;<span class="ident" id="2090822"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090823">.</span><span class="ident" id="2090824">dataqsiz</span>&nbsp;<span class="op" id="2090833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2090837"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090838">.</span><span class="ident" id="2090839">recvx</span>&nbsp;<span class="op" id="2090845">=</span>&nbsp;<span class="num" id="2090847">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2090850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2090853"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090854">.</span><span class="ident" id="2090855">qcount</span><span class="op" id="2090861">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2090865"><a href="/runtime/select.go.html#2086947">sg</a></span>&nbsp;<span class="op" id="2090868">=</span>&nbsp;<span class="ident" id="2090870"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2090871">.</span><span class="ident" id="2090872">sendq</span><span class="op" id="2090877">.</span><span class="ident" id="2090878">dequeue</span><span class="op" id="2090885">(</span><span class="op" id="2090886">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2090889">if</span>&nbsp;<span class="ident" id="2090892"><a href="/runtime/select.go.html#2086947">sg</a></span>&nbsp;<span class="op" id="2090895">!=</span>&nbsp;<span class="ident" id="2090898">nil</span>&nbsp;<span class="op" id="2090902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2090906"><a href="/runtime/select.go.html#2086919">gp</a></span>&nbsp;<span class="op" id="2090909">=</span>&nbsp;<span class="ident" id="2090911"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2090913">.</span><span class="ident" id="2090914">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2090918"><a href="/runtime/select.go.html#2083096">selunlock</a></span><span class="op" id="2090927">(</span><span class="ident" id="2090928"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2090931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2090935">if</span>&nbsp;<span class="ident" id="2090938"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2090940">.</span><span class="ident" id="2090941">releasetime</span>&nbsp;<span class="op" id="2090953">!=</span>&nbsp;<span class="num" id="2090956">0</span>&nbsp;<span class="op" id="2090958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2090963"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2090965">.</span><span class="ident" id="2090966">releasetime</span>&nbsp;<span class="op" id="2090978">=</span>&nbsp;<span class="ident" id="2090980"><a href="/runtime/stubs.go.html#2137246">cputicks</a></span><span class="op" id="2090988">(</span><span class="op" id="2090989">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2090993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2090997"><a href="/runtime/proc.go.html#2067021">goready</a></span><span class="op" id="2091004">(</span><span class="ident" id="2091005"><a href="/runtime/select.go.html#2086919">gp</a></span><span class="op" id="2091007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2091010">}</span>&nbsp;<span class="keyword" id="2091012">else</span>&nbsp;<span class="op" id="2091017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091021"><a href="/runtime/select.go.html#2083096">selunlock</a></span><span class="op" id="2091030">(</span><span class="ident" id="2091031"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2091034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2091037">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2091040">goto</span>&nbsp;<span class="ident" id="2091045">retc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="2091051">asyncsend</span><span class="op" id="2091060">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2091063">//&nbsp;can&nbsp;send&nbsp;to&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2091086">if</span>&nbsp;<span class="ident" id="2091089"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="2091101">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091105"><a href="/runtime/race0.go.html#2070582">raceacquire</a></span><span class="op" id="2091116">(</span><span class="ident" id="2091117"><a href="/runtime/chan.go.html#1886811">chanbuf</a></span><span class="op" id="2091124">(</span><span class="ident" id="2091125"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2091126">,</span>&nbsp;<span class="ident" id="2091128"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2091129">.</span><span class="ident" id="2091130">sendx</span><span class="op" id="2091135">)</span><span class="op" id="2091136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091140"><a href="/runtime/race0.go.html#2070774">racerelease</a></span><span class="op" id="2091151">(</span><span class="ident" id="2091152"><a href="/runtime/chan.go.html#1886811">chanbuf</a></span><span class="op" id="2091159">(</span><span class="ident" id="2091160"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2091161">,</span>&nbsp;<span class="ident" id="2091163"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2091164">.</span><span class="ident" id="2091165">sendx</span><span class="op" id="2091170">)</span><span class="op" id="2091171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091175"><a href="/runtime/race0.go.html#2069718">raceReadObjectPC</a></span><span class="op" id="2091191">(</span><span class="ident" id="2091192"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2091193">.</span><span class="ident" id="2091194">elemtype</span><span class="op" id="2091202">,</span>&nbsp;<span class="ident" id="2091204"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2091207">.</span><span class="ident" id="2091208">elem</span><span class="op" id="2091212">,</span>&nbsp;<span class="ident" id="2091214"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2091217">.</span><span class="ident" id="2091218">pc</span><span class="op" id="2091220">,</span>&nbsp;<span class="ident" id="2091222"><a href="/runtime/select.go.html#2079334">chansendpc</a></span><span class="op" id="2091232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2091235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091238"><a href="/runtime/stubs.go.html#2135810">memmove</a></span><span class="op" id="2091245">(</span><span class="ident" id="2091246"><a href="/runtime/chan.go.html#1886811">chanbuf</a></span><span class="op" id="2091253">(</span><span class="ident" id="2091254"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2091255">,</span>&nbsp;<span class="ident" id="2091257"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2091258">.</span><span class="ident" id="2091259">sendx</span><span class="op" id="2091264">)</span><span class="op" id="2091265">,</span>&nbsp;<span class="ident" id="2091267"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2091270">.</span><span class="ident" id="2091271">elem</span><span class="op" id="2091275">,</span>&nbsp;<span class="builtintype" id="2091277">uintptr</span><span class="op" id="2091284">(</span><span class="ident" id="2091285"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2091286">.</span><span class="ident" id="2091287">elemsize</span><span class="op" id="2091295">)</span><span class="op" id="2091296">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091299"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2091300">.</span><span class="ident" id="2091301">sendx</span><span class="op" id="2091306">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2091310">if</span>&nbsp;<span class="ident" id="2091313"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2091314">.</span><span class="ident" id="2091315">sendx</span>&nbsp;<span class="op" id="2091321">==</span>&nbsp;<span class="ident" id="2091324"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2091325">.</span><span class="ident" id="2091326">dataqsiz</span>&nbsp;<span class="op" id="2091335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091339"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2091340">.</span><span class="ident" id="2091341">sendx</span>&nbsp;<span class="op" id="2091347">=</span>&nbsp;<span class="num" id="2091349">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2091352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091355"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2091356">.</span><span class="ident" id="2091357">qcount</span><span class="op" id="2091363">++</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091367"><a href="/runtime/select.go.html#2086947">sg</a></span>&nbsp;<span class="op" id="2091370">=</span>&nbsp;<span class="ident" id="2091372"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2091373">.</span><span class="ident" id="2091374">recvq</span><span class="op" id="2091379">.</span><span class="ident" id="2091380">dequeue</span><span class="op" id="2091387">(</span><span class="op" id="2091388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2091391">if</span>&nbsp;<span class="ident" id="2091394"><a href="/runtime/select.go.html#2086947">sg</a></span>&nbsp;<span class="op" id="2091397">!=</span>&nbsp;<span class="ident" id="2091400">nil</span>&nbsp;<span class="op" id="2091404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091408"><a href="/runtime/select.go.html#2086919">gp</a></span>&nbsp;<span class="op" id="2091411">=</span>&nbsp;<span class="ident" id="2091413"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2091415">.</span><span class="ident" id="2091416">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091420"><a href="/runtime/select.go.html#2083096">selunlock</a></span><span class="op" id="2091429">(</span><span class="ident" id="2091430"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2091433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2091437">if</span>&nbsp;<span class="ident" id="2091440"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2091442">.</span><span class="ident" id="2091443">releasetime</span>&nbsp;<span class="op" id="2091455">!=</span>&nbsp;<span class="num" id="2091458">0</span>&nbsp;<span class="op" id="2091460">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091465"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2091467">.</span><span class="ident" id="2091468">releasetime</span>&nbsp;<span class="op" id="2091480">=</span>&nbsp;<span class="ident" id="2091482"><a href="/runtime/stubs.go.html#2137246">cputicks</a></span><span class="op" id="2091490">(</span><span class="op" id="2091491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2091495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091499"><a href="/runtime/proc.go.html#2067021">goready</a></span><span class="op" id="2091506">(</span><span class="ident" id="2091507"><a href="/runtime/select.go.html#2086919">gp</a></span><span class="op" id="2091509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2091512">}</span>&nbsp;<span class="keyword" id="2091514">else</span>&nbsp;<span class="op" id="2091519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091523"><a href="/runtime/select.go.html#2083096">selunlock</a></span><span class="op" id="2091532">(</span><span class="ident" id="2091533"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2091536">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2091539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2091542">goto</span>&nbsp;<span class="ident" id="2091547">retc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="2091553">syncrecv</span><span class="op" id="2091561">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2091564">//&nbsp;can&nbsp;receive&nbsp;from&nbsp;sleeping&nbsp;sender&nbsp;(sg)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2091606">if</span>&nbsp;<span class="ident" id="2091609"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="2091621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2091625">if</span>&nbsp;<span class="ident" id="2091628"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2091631">.</span><span class="ident" id="2091632">elem</span>&nbsp;<span class="op" id="2091637">!=</span>&nbsp;<span class="ident" id="2091640">nil</span>&nbsp;<span class="op" id="2091644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091649"><a href="/runtime/race0.go.html#2069814">raceWriteObjectPC</a></span><span class="op" id="2091666">(</span><span class="ident" id="2091667"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2091668">.</span><span class="ident" id="2091669">elemtype</span><span class="op" id="2091677">,</span>&nbsp;<span class="ident" id="2091679"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2091682">.</span><span class="ident" id="2091683">elem</span><span class="op" id="2091687">,</span>&nbsp;<span class="ident" id="2091689"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2091692">.</span><span class="ident" id="2091693">pc</span><span class="op" id="2091695">,</span>&nbsp;<span class="ident" id="2091697"><a href="/runtime/select.go.html#2079365">chanrecvpc</a></span><span class="op" id="2091707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2091711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091715"><a href="/runtime/chan.go.html#1899350">racesync</a></span><span class="op" id="2091723">(</span><span class="ident" id="2091724"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2091725">,</span>&nbsp;<span class="ident" id="2091727"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2091729">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2091732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091735"><a href="/runtime/select.go.html#2083096">selunlock</a></span><span class="op" id="2091744">(</span><span class="ident" id="2091745"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2091748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2091751">if</span>&nbsp;<span class="ident" id="2091754"><a href="/runtime/select.go.html#2079304">debugSelect</a></span>&nbsp;<span class="op" id="2091766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2091770">print</span><span class="op" id="2091775">(</span><span class="string" id="2091776">&#34;syncrecv:&nbsp;sel=&#34;</span><span class="op" id="2091792">,</span>&nbsp;<span class="ident" id="2091794"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2091797">,</span>&nbsp;<span class="string" id="2091799">&#34;&nbsp;c=&#34;</span><span class="op" id="2091804">,</span>&nbsp;<span class="ident" id="2091806"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2091807">,</span>&nbsp;<span class="string" id="2091809">&#34;\n&#34;</span><span class="op" id="2091813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2091816">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2091819">if</span>&nbsp;<span class="ident" id="2091822"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2091825">.</span><span class="ident" id="2091826">receivedp</span>&nbsp;<span class="op" id="2091836">!=</span>&nbsp;<span class="ident" id="2091839">nil</span>&nbsp;<span class="op" id="2091843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2091847">*</span><span class="ident" id="2091848"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2091851">.</span><span class="ident" id="2091852">receivedp</span>&nbsp;<span class="op" id="2091862">=</span>&nbsp;<span class="builtintype" id="2091864">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2091870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2091873">if</span>&nbsp;<span class="ident" id="2091876"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2091879">.</span><span class="ident" id="2091880">elem</span>&nbsp;<span class="op" id="2091885">!=</span>&nbsp;<span class="ident" id="2091888">nil</span>&nbsp;<span class="op" id="2091892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091896"><a href="/runtime/stubs.go.html#2135810">memmove</a></span><span class="op" id="2091903">(</span><span class="ident" id="2091904"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2091907">.</span><span class="ident" id="2091908">elem</span><span class="op" id="2091912">,</span>&nbsp;<span class="ident" id="2091914"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2091916">.</span><span class="ident" id="2091917">elem</span><span class="op" id="2091921">,</span>&nbsp;<span class="builtintype" id="2091923">uintptr</span><span class="op" id="2091930">(</span><span class="ident" id="2091931"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2091932">.</span><span class="ident" id="2091933">elemsize</span><span class="op" id="2091941">)</span><span class="op" id="2091942">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2091945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091948"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2091950">.</span><span class="ident" id="2091951">elem</span>&nbsp;<span class="op" id="2091956">=</span>&nbsp;<span class="ident" id="2091958">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091963"><a href="/runtime/select.go.html#2086919">gp</a></span>&nbsp;<span class="op" id="2091966">=</span>&nbsp;<span class="ident" id="2091968"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2091970">.</span><span class="ident" id="2091971">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2091974"><a href="/runtime/select.go.html#2086919">gp</a></span><span class="op" id="2091976">.</span><span class="ident" id="2091977">param</span>&nbsp;<span class="op" id="2091983">=</span>&nbsp;<span class="ident" id="2091985"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2091991">.</span><span class="ident" id="2091992">Pointer</span><span class="op" id="2091999">(</span><span class="ident" id="2092000"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2092002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2092005">if</span>&nbsp;<span class="ident" id="2092008"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2092010">.</span><span class="ident" id="2092011">releasetime</span>&nbsp;<span class="op" id="2092023">!=</span>&nbsp;<span class="num" id="2092026">0</span>&nbsp;<span class="op" id="2092028">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2092032"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2092034">.</span><span class="ident" id="2092035">releasetime</span>&nbsp;<span class="op" id="2092047">=</span>&nbsp;<span class="ident" id="2092049"><a href="/runtime/stubs.go.html#2137246">cputicks</a></span><span class="op" id="2092057">(</span><span class="op" id="2092058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2092061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2092064"><a href="/runtime/proc.go.html#2067021">goready</a></span><span class="op" id="2092071">(</span><span class="ident" id="2092072"><a href="/runtime/select.go.html#2086919">gp</a></span><span class="op" id="2092074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2092077">goto</span>&nbsp;<span class="ident" id="2092082">retc</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="ident" id="2092088">rclose</span><span class="op" id="2092094">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2092097">//&nbsp;read&nbsp;at&nbsp;end&nbsp;of&nbsp;closed&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2092131"><a href="/runtime/select.go.html#2083096">selunlock</a></span><span class="op" id="2092140">(</span><span class="ident" id="2092141"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2092144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2092147">if</span>&nbsp;<span class="ident" id="2092150"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2092153">.</span><span class="ident" id="2092154">receivedp</span>&nbsp;<span class="op" id="2092164">!=</span>&nbsp;<span class="ident" id="2092167">nil</span>&nbsp;<span class="op" id="2092171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2092175">*</span><span class="ident" id="2092176"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2092179">.</span><span class="ident" id="2092180">receivedp</span>&nbsp;<span class="op" id="2092190">=</span>&nbsp;<span class="builtintype" id="2092192">false</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2092199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2092202">if</span>&nbsp;<span class="ident" id="2092205"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2092208">.</span><span class="ident" id="2092209">elem</span>&nbsp;<span class="op" id="2092214">!=</span>&nbsp;<span class="ident" id="2092217">nil</span>&nbsp;<span class="op" id="2092221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2092225"><a href="/runtime/stubs.go.html#2135687">memclr</a></span><span class="op" id="2092231">(</span><span class="ident" id="2092232"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2092235">.</span><span class="ident" id="2092236">elem</span><span class="op" id="2092240">,</span>&nbsp;<span class="builtintype" id="2092242">uintptr</span><span class="op" id="2092249">(</span><span class="ident" id="2092250"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2092251">.</span><span class="ident" id="2092252">elemsize</span><span class="op" id="2092260">)</span><span class="op" id="2092261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2092264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2092267">if</span>&nbsp;<span class="ident" id="2092270"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="2092282">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2092286"><a href="/runtime/race0.go.html#2070582">raceacquire</a></span><span class="op" id="2092297">(</span><span class="ident" id="2092298"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2092304">.</span><span class="ident" id="2092305">Pointer</span><span class="op" id="2092312">(</span><span class="ident" id="2092313"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2092314">)</span><span class="op" id="2092315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2092318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2092321">goto</span>&nbsp;<span class="ident" id="2092326">retc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="2092332">syncsend</span><span class="op" id="2092340">:</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2092343">//&nbsp;can&nbsp;send&nbsp;to&nbsp;sleeping&nbsp;receiver&nbsp;(sg)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2092382">if</span>&nbsp;<span class="ident" id="2092385"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="2092397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2092401"><a href="/runtime/race0.go.html#2069718">raceReadObjectPC</a></span><span class="op" id="2092417">(</span><span class="ident" id="2092418"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2092419">.</span><span class="ident" id="2092420">elemtype</span><span class="op" id="2092428">,</span>&nbsp;<span class="ident" id="2092430"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2092433">.</span><span class="ident" id="2092434">elem</span><span class="op" id="2092438">,</span>&nbsp;<span class="ident" id="2092440"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2092443">.</span><span class="ident" id="2092444">pc</span><span class="op" id="2092446">,</span>&nbsp;<span class="ident" id="2092448"><a href="/runtime/select.go.html#2079334">chansendpc</a></span><span class="op" id="2092458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2092462"><a href="/runtime/chan.go.html#1899350">racesync</a></span><span class="op" id="2092470">(</span><span class="ident" id="2092471"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2092472">,</span>&nbsp;<span class="ident" id="2092474"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2092476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2092479">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2092482"><a href="/runtime/select.go.html#2083096">selunlock</a></span><span class="op" id="2092491">(</span><span class="ident" id="2092492"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2092495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2092498">if</span>&nbsp;<span class="ident" id="2092501"><a href="/runtime/select.go.html#2079304">debugSelect</a></span>&nbsp;<span class="op" id="2092513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2092517">print</span><span class="op" id="2092522">(</span><span class="string" id="2092523">&#34;syncsend:&nbsp;sel=&#34;</span><span class="op" id="2092539">,</span>&nbsp;<span class="ident" id="2092541"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2092544">,</span>&nbsp;<span class="string" id="2092546">&#34;&nbsp;c=&#34;</span><span class="op" id="2092551">,</span>&nbsp;<span class="ident" id="2092553"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2092554">,</span>&nbsp;<span class="string" id="2092556">&#34;\n&#34;</span><span class="op" id="2092560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2092563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2092566">if</span>&nbsp;<span class="ident" id="2092569"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2092571">.</span><span class="ident" id="2092572">elem</span>&nbsp;<span class="op" id="2092577">!=</span>&nbsp;<span class="ident" id="2092580">nil</span>&nbsp;<span class="op" id="2092584">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2092588"><a href="/runtime/stubs.go.html#2135810">memmove</a></span><span class="op" id="2092595">(</span><span class="ident" id="2092596"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2092598">.</span><span class="ident" id="2092599">elem</span><span class="op" id="2092603">,</span>&nbsp;<span class="ident" id="2092605"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2092608">.</span><span class="ident" id="2092609">elem</span><span class="op" id="2092613">,</span>&nbsp;<span class="builtintype" id="2092615">uintptr</span><span class="op" id="2092622">(</span><span class="ident" id="2092623"><a href="/runtime/select.go.html#2086963">c</a></span><span class="op" id="2092624">.</span><span class="ident" id="2092625">elemsize</span><span class="op" id="2092633">)</span><span class="op" id="2092634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2092637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2092640"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2092642">.</span><span class="ident" id="2092643">elem</span>&nbsp;<span class="op" id="2092648">=</span>&nbsp;<span class="ident" id="2092650">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2092655"><a href="/runtime/select.go.html#2086919">gp</a></span>&nbsp;<span class="op" id="2092658">=</span>&nbsp;<span class="ident" id="2092660"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2092662">.</span><span class="ident" id="2092663">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2092666"><a href="/runtime/select.go.html#2086919">gp</a></span><span class="op" id="2092668">.</span><span class="ident" id="2092669">param</span>&nbsp;<span class="op" id="2092675">=</span>&nbsp;<span class="ident" id="2092677"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2092683">.</span><span class="ident" id="2092684">Pointer</span><span class="op" id="2092691">(</span><span class="ident" id="2092692"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2092694">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2092697">if</span>&nbsp;<span class="ident" id="2092700"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2092702">.</span><span class="ident" id="2092703">releasetime</span>&nbsp;<span class="op" id="2092715">!=</span>&nbsp;<span class="num" id="2092718">0</span>&nbsp;<span class="op" id="2092720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2092724"><a href="/runtime/select.go.html#2086947">sg</a></span><span class="op" id="2092726">.</span><span class="ident" id="2092727">releasetime</span>&nbsp;<span class="op" id="2092739">=</span>&nbsp;<span class="ident" id="2092741"><a href="/runtime/stubs.go.html#2137246">cputicks</a></span><span class="op" id="2092749">(</span><span class="op" id="2092750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2092753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2092756"><a href="/runtime/proc.go.html#2067021">goready</a></span><span class="op" id="2092763">(</span><span class="ident" id="2092764"><a href="/runtime/select.go.html#2086919">gp</a></span><span class="op" id="2092766">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">565</span><span class="ident" id="2092769">retc</span><span class="op" id="2092773">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2092776">if</span>&nbsp;<span class="ident" id="2092779"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2092782">.</span><span class="ident" id="2092783">releasetime</span>&nbsp;<span class="op" id="2092795">&gt;</span>&nbsp;<span class="num" id="2092797">0</span>&nbsp;<span class="op" id="2092799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2092803"><a href="/runtime/mprof.go.html#2020096">blockevent</a></span><span class="op" id="2092813">(</span><span class="ident" id="2092814"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2092817">.</span><span class="ident" id="2092818">releasetime</span><span class="op" id="2092829">-</span><span class="ident" id="2092830"><a href="/runtime/select.go.html#2084834">t0</a></span><span class="op" id="2092832">,</span>&nbsp;<span class="num" id="2092834">2</span><span class="op" id="2092835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2092838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2092841">return</span>&nbsp;<span class="ident" id="2092848"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2092851">.</span><span class="ident" id="2092852">pc</span><span class="op" id="2092854">,</span>&nbsp;<span class="ident" id="2092856"><a href="/runtime/select.go.html#2087104">cas</a></span><span class="op" id="2092859">.</span><span class="ident" id="2092860">so</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="ident" id="2092864">sclose</span><span class="op" id="2092870">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2092873">//&nbsp;send&nbsp;on&nbsp;closed&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2092900"><a href="/runtime/select.go.html#2083096">selunlock</a></span><span class="op" id="2092909">(</span><span class="ident" id="2092910"><a href="/runtime/select.go.html#2084598">sel</a></span><span class="op" id="2092913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2092916">panic</span><span class="op" id="2092921">(</span><span class="string" id="2092922">&#34;send&nbsp;on&nbsp;closed&nbsp;channel&#34;</span><span class="op" id="2092946">)</span><br>
<span class="lineno">575</span><span class="op" id="2092948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2092951">func</span>&nbsp;<span class="op" id="2092956">(</span><span class="ident" id="2092957">c</span>&nbsp;<span class="op" id="2092959">*</span><span class="ident" id="2092960"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span><span class="op" id="2092965">)</span>&nbsp;<span class="ident" id="2092967">sortkey</span><span class="op" id="2092974">(</span><span class="op" id="2092975">)</span>&nbsp;<span class="builtintype" id="2092977">uintptr</span>&nbsp;<span class="op" id="2092985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2092988">//&nbsp;TODO(khr):&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;moving&nbsp;garbage&nbsp;collector,&nbsp;we&#39;ll&nbsp;need&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2093056">//&nbsp;change&nbsp;this&nbsp;function.</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2093082">return</span>&nbsp;<span class="builtintype" id="2093089">uintptr</span><span class="op" id="2093096">(</span><span class="ident" id="2093097"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2093103">.</span><span class="ident" id="2093104">Pointer</span><span class="op" id="2093111">(</span><span class="ident" id="2093112"><a href="/runtime/select.go.html#2092957">c</a></span><span class="op" id="2093113">)</span><span class="op" id="2093114">)</span><br>
<span class="lineno"></span><span class="op" id="2093116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2093119">//&nbsp;A&nbsp;runtimeSelect&nbsp;is&nbsp;a&nbsp;single&nbsp;case&nbsp;passed&nbsp;to&nbsp;rselect.</span><br>
<span class="lineno"></span><span class="comment" id="2093174">//&nbsp;This&nbsp;must&nbsp;match&nbsp;../reflect/value.go:/runtimeSelect</span><br>
<span class="lineno">585</span><span class="keyword" id="2093228">type</span>&nbsp;<span class="ident" id="2093233">runtimeSelect</span>&nbsp;<span class="keyword" id="2093247">struct</span>&nbsp;<span class="op" id="2093254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093257">dir</span>&nbsp;<span class="ident" id="2093261"><a href="/runtime/select.go.html#2093501">selectDir</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093272">typ</span>&nbsp;<span class="ident" id="2093276"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2093282">.</span><span class="ident" id="2093283">Pointer</span>&nbsp;<span class="comment" id="2093291">//&nbsp;channel&nbsp;type&nbsp;(not&nbsp;used&nbsp;here)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093324">ch</span>&nbsp;&nbsp;<span class="op" id="2093328">*</span><span class="ident" id="2093329"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189723">hchan</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2093343">//&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093355">val</span>&nbsp;<span class="ident" id="2093359"><a href="/runtime/select.go.html#2079285">unsafe</a></span><span class="op" id="2093365">.</span><span class="ident" id="2093366">Pointer</span>&nbsp;<span class="comment" id="2093374">//&nbsp;ptr&nbsp;to&nbsp;data&nbsp;(SendDir)&nbsp;or&nbsp;ptr&nbsp;to&nbsp;receive&nbsp;buffer&nbsp;(RecvDir)</span><br>
<span class="lineno">590</span><span class="op" id="2093434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2093437">//&nbsp;These&nbsp;values&nbsp;must&nbsp;match&nbsp;../reflect/value.go:/SelectDir.</span><br>
<span class="lineno"></span><span class="keyword" id="2093496">type</span>&nbsp;<span class="ident" id="2093501">selectDir</span>&nbsp;<span class="builtintype" id="2093511">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="keyword" id="2093516">const</span>&nbsp;<span class="op" id="2093522">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093525">_</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2093539"><a href="/runtime/select.go.html#2093501">selectDir</a></span>&nbsp;<span class="op" id="2093549">=</span>&nbsp;<span class="ident" id="2093551">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093557">selectSend</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2093581">//&nbsp;case&nbsp;Chan&nbsp;&lt;-&nbsp;Send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093603">selectRecv</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2093627">//&nbsp;case&nbsp;&lt;-Chan:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093644">selectDefault</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2093668">//&nbsp;default</span><br>
<span class="lineno">600</span><span class="op" id="2093679">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2093682">func</span>&nbsp;<span class="ident" id="2093687">reflect_rselect</span><span class="op" id="2093702">(</span><span class="ident" id="2093703">cases</span>&nbsp;<span class="op" id="2093709">[</span><span class="op" id="2093710">]</span><span class="ident" id="2093711"><a href="/runtime/select.go.html#2093233">runtimeSelect</a></span><span class="op" id="2093724">)</span>&nbsp;<span class="op" id="2093726">(</span><span class="ident" id="2093727">chosen</span>&nbsp;<span class="builtintype" id="2093734">int</span><span class="op" id="2093737">,</span>&nbsp;<span class="ident" id="2093739">recvOK</span>&nbsp;<span class="builtintype" id="2093746">bool</span><span class="op" id="2093750">)</span>&nbsp;<span class="op" id="2093752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2093755">//&nbsp;flagNoScan&nbsp;is&nbsp;safe&nbsp;here,&nbsp;because&nbsp;all&nbsp;objects&nbsp;are&nbsp;also&nbsp;referenced&nbsp;from&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093836">size</span>&nbsp;<span class="op" id="2093841">:=</span>&nbsp;<span class="ident" id="2093844"><a href="/runtime/select.go.html#2079403">selectsize</a></span><span class="op" id="2093854">(</span><span class="builtintype" id="2093855">uintptr</span><span class="op" id="2093862">(</span><span class="builtinfunc" id="2093863">len</span><span class="op" id="2093866">(</span><span class="ident" id="2093867"><a href="/runtime/select.go.html#2093703">cases</a></span><span class="op" id="2093872">)</span><span class="op" id="2093873">)</span><span class="op" id="2093874">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093877">sel</span>&nbsp;<span class="op" id="2093881">:=</span>&nbsp;<span class="op" id="2093884">(</span><span class="op" id="2093885">*</span><span class="ident" id="2093886"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2190089">_select</a></span><span class="op" id="2093893">)</span><span class="op" id="2093894">(</span><span class="ident" id="2093895"><a href="/runtime/malloc.go.html#1982729">mallocgc</a></span><span class="op" id="2093903">(</span><span class="ident" id="2093904"><a href="/runtime/select.go.html#2093836">size</a></span><span class="op" id="2093908">,</span>&nbsp;<span class="ident" id="2093910">nil</span><span class="op" id="2093913">,</span>&nbsp;<span class="ident" id="2093915"><a href="/runtime/malloc.go.html#1981957">flagNoScan</a></span><span class="op" id="2093925">)</span><span class="op" id="2093926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093929"><a href="/runtime/select.go.html#2079656">newselect</a></span><span class="op" id="2093938">(</span><span class="ident" id="2093939"><a href="/runtime/select.go.html#2093877">sel</a></span><span class="op" id="2093942">,</span>&nbsp;<span class="ident" id="2093944">int64</span><span class="op" id="2093949">(</span><span class="ident" id="2093950"><a href="/runtime/select.go.html#2093836">size</a></span><span class="op" id="2093954">)</span><span class="op" id="2093955">,</span>&nbsp;<span class="builtintype" id="2093957">int32</span><span class="op" id="2093962">(</span><span class="builtinfunc" id="2093963">len</span><span class="op" id="2093966">(</span><span class="ident" id="2093967"><a href="/runtime/select.go.html#2093703">cases</a></span><span class="op" id="2093972">)</span><span class="op" id="2093973">)</span><span class="op" id="2093974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093977">r</span>&nbsp;<span class="op" id="2093979">:=</span>&nbsp;<span class="builtinfunc" id="2093982">new</span><span class="op" id="2093985">(</span><span class="builtintype" id="2093986">bool</span><span class="op" id="2093990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2093993">for</span>&nbsp;<span class="ident" id="2093997">i</span>&nbsp;<span class="op" id="2093999">:=</span>&nbsp;<span class="keyword" id="2094002">range</span>&nbsp;<span class="ident" id="2094008"><a href="/runtime/select.go.html#2093703">cases</a></span>&nbsp;<span class="op" id="2094014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094018">rc</span>&nbsp;<span class="op" id="2094021">:=</span>&nbsp;<span class="op" id="2094024">&amp;</span><span class="ident" id="2094025"><a href="/runtime/select.go.html#2093703">cases</a></span><span class="op" id="2094030">[</span><span class="ident" id="2094031"><a href="/runtime/select.go.html#2093997">i</a></span><span class="op" id="2094032">]</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094036">switch</span>&nbsp;<span class="ident" id="2094043"><a href="/runtime/select.go.html#2094018">rc</a></span><span class="op" id="2094045">.</span><span class="ident" id="2094046">dir</span>&nbsp;<span class="op" id="2094050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094054">case</span>&nbsp;<span class="ident" id="2094059"><a href="/runtime/select.go.html#2093644">selectDefault</a></span><span class="op" id="2094072">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094077"><a href="/runtime/select.go.html#2082368">selectdefaultImpl</a></span><span class="op" id="2094094">(</span><span class="ident" id="2094095"><a href="/runtime/select.go.html#2093877">sel</a></span><span class="op" id="2094098">,</span>&nbsp;<span class="builtintype" id="2094100">uintptr</span><span class="op" id="2094107">(</span><span class="ident" id="2094108"><a href="/runtime/select.go.html#2093997">i</a></span><span class="op" id="2094109">)</span><span class="op" id="2094110">,</span>&nbsp;<span class="num" id="2094112">0</span><span class="op" id="2094113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094117">case</span>&nbsp;<span class="ident" id="2094122"><a href="/runtime/select.go.html#2093557">selectSend</a></span><span class="op" id="2094132">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094137">if</span>&nbsp;<span class="ident" id="2094140"><a href="/runtime/select.go.html#2094018">rc</a></span><span class="op" id="2094142">.</span><span class="ident" id="2094143">ch</span>&nbsp;<span class="op" id="2094146">==</span>&nbsp;<span class="ident" id="2094149">nil</span>&nbsp;<span class="op" id="2094153">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094159">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2094168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094173"><a href="/runtime/select.go.html#2080555">selectsendImpl</a></span><span class="op" id="2094187">(</span><span class="ident" id="2094188"><a href="/runtime/select.go.html#2093877">sel</a></span><span class="op" id="2094191">,</span>&nbsp;<span class="ident" id="2094193"><a href="/runtime/select.go.html#2094018">rc</a></span><span class="op" id="2094195">.</span><span class="ident" id="2094196">ch</span><span class="op" id="2094198">,</span>&nbsp;<span class="builtintype" id="2094200">uintptr</span><span class="op" id="2094207">(</span><span class="ident" id="2094208"><a href="/runtime/select.go.html#2093997">i</a></span><span class="op" id="2094209">)</span><span class="op" id="2094210">,</span>&nbsp;<span class="ident" id="2094212"><a href="/runtime/select.go.html#2094018">rc</a></span><span class="op" id="2094214">.</span><span class="ident" id="2094215">val</span><span class="op" id="2094218">,</span>&nbsp;<span class="num" id="2094220">0</span><span class="op" id="2094221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094225">case</span>&nbsp;<span class="ident" id="2094230"><a href="/runtime/select.go.html#2093603">selectRecv</a></span><span class="op" id="2094240">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094245">if</span>&nbsp;<span class="ident" id="2094248"><a href="/runtime/select.go.html#2094018">rc</a></span><span class="op" id="2094250">.</span><span class="ident" id="2094251">ch</span>&nbsp;<span class="op" id="2094254">==</span>&nbsp;<span class="ident" id="2094257">nil</span>&nbsp;<span class="op" id="2094261">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094267">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2094276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094281"><a href="/runtime/select.go.html#2081639">selectrecvImpl</a></span><span class="op" id="2094295">(</span><span class="ident" id="2094296"><a href="/runtime/select.go.html#2093877">sel</a></span><span class="op" id="2094299">,</span>&nbsp;<span class="ident" id="2094301"><a href="/runtime/select.go.html#2094018">rc</a></span><span class="op" id="2094303">.</span><span class="ident" id="2094304">ch</span><span class="op" id="2094306">,</span>&nbsp;<span class="builtintype" id="2094308">uintptr</span><span class="op" id="2094315">(</span><span class="ident" id="2094316"><a href="/runtime/select.go.html#2093997">i</a></span><span class="op" id="2094317">)</span><span class="op" id="2094318">,</span>&nbsp;<span class="ident" id="2094320"><a href="/runtime/select.go.html#2094018">rc</a></span><span class="op" id="2094322">.</span><span class="ident" id="2094323">val</span><span class="op" id="2094326">,</span>&nbsp;<span class="ident" id="2094328"><a href="/runtime/select.go.html#2093977">r</a></span><span class="op" id="2094329">,</span>&nbsp;<span class="num" id="2094331">0</span><span class="op" id="2094332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2094336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2094339">}</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094343">pc</span><span class="op" id="2094345">,</span>&nbsp;<span class="ident" id="2094347">_</span>&nbsp;<span class="op" id="2094349">:=</span>&nbsp;<span class="ident" id="2094352"><a href="/runtime/select.go.html#2084585">selectgoImpl</a></span><span class="op" id="2094364">(</span><span class="ident" id="2094365"><a href="/runtime/select.go.html#2093877">sel</a></span><span class="op" id="2094368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094371"><a href="/runtime/select.go.html#2093727">chosen</a></span>&nbsp;<span class="op" id="2094378">=</span>&nbsp;<span class="builtintype" id="2094380">int</span><span class="op" id="2094383">(</span><span class="ident" id="2094384"><a href="/runtime/select.go.html#2094343">pc</a></span><span class="op" id="2094386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094389"><a href="/runtime/select.go.html#2093739">recvOK</a></span>&nbsp;<span class="op" id="2094396">=</span>&nbsp;<span class="op" id="2094398">*</span><span class="ident" id="2094399"><a href="/runtime/select.go.html#2093977">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094402">return</span><br>
<span class="lineno">630</span><span class="op" id="2094409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2094412">func</span>&nbsp;<span class="op" id="2094417">(</span><span class="ident" id="2094418">q</span>&nbsp;<span class="op" id="2094420">*</span><span class="ident" id="2094421"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2189673">waitq</a></span><span class="op" id="2094426">)</span>&nbsp;<span class="ident" id="2094428">dequeueSudoG</span><span class="op" id="2094440">(</span><span class="ident" id="2094441">s</span>&nbsp;<span class="op" id="2094443">*</span><span class="ident" id="2094444"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179851">sudog</a></span><span class="op" id="2094449">)</span>&nbsp;<span class="op" id="2094451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094454">var</span>&nbsp;<span class="ident" id="2094458">prevsgp</span>&nbsp;<span class="op" id="2094466">*</span><span class="ident" id="2094467"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179851">sudog</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094474">l</span>&nbsp;<span class="op" id="2094476">:=</span>&nbsp;<span class="op" id="2094479">&amp;</span><span class="ident" id="2094480"><a href="/runtime/select.go.html#2094418">q</a></span><span class="op" id="2094481">.</span><span class="ident" id="2094482">first</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094489">for</span>&nbsp;<span class="op" id="2094493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094497">sgp</span>&nbsp;<span class="op" id="2094501">:=</span>&nbsp;<span class="op" id="2094504">*</span><span class="ident" id="2094505"><a href="/runtime/select.go.html#2094474">l</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094509">if</span>&nbsp;<span class="ident" id="2094512"><a href="/runtime/select.go.html#2094497">sgp</a></span>&nbsp;<span class="op" id="2094516">==</span>&nbsp;<span class="ident" id="2094519">nil</span>&nbsp;<span class="op" id="2094523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094528">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2094537">}</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094541">if</span>&nbsp;<span class="ident" id="2094544"><a href="/runtime/select.go.html#2094497">sgp</a></span>&nbsp;<span class="op" id="2094548">==</span>&nbsp;<span class="ident" id="2094551"><a href="/runtime/select.go.html#2094441">s</a></span>&nbsp;<span class="op" id="2094553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2094558">*</span><span class="ident" id="2094559"><a href="/runtime/select.go.html#2094474">l</a></span>&nbsp;<span class="op" id="2094561">=</span>&nbsp;<span class="ident" id="2094563"><a href="/runtime/select.go.html#2094497">sgp</a></span><span class="op" id="2094566">.</span><span class="ident" id="2094567">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094575">if</span>&nbsp;<span class="ident" id="2094578"><a href="/runtime/select.go.html#2094418">q</a></span><span class="op" id="2094579">.</span><span class="ident" id="2094580">last</span>&nbsp;<span class="op" id="2094585">==</span>&nbsp;<span class="ident" id="2094588"><a href="/runtime/select.go.html#2094497">sgp</a></span>&nbsp;<span class="op" id="2094592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094598"><a href="/runtime/select.go.html#2094418">q</a></span><span class="op" id="2094599">.</span><span class="ident" id="2094600">last</span>&nbsp;<span class="op" id="2094605">=</span>&nbsp;<span class="ident" id="2094607"><a href="/runtime/select.go.html#2094458">prevsgp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2094618">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094623"><a href="/runtime/select.go.html#2094441">s</a></span><span class="op" id="2094624">.</span><span class="ident" id="2094625">next</span>&nbsp;<span class="op" id="2094630">=</span>&nbsp;<span class="ident" id="2094632">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094639">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2094648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094652"><a href="/runtime/select.go.html#2094474">l</a></span>&nbsp;<span class="op" id="2094654">=</span>&nbsp;<span class="op" id="2094656">&amp;</span><span class="ident" id="2094657"><a href="/runtime/select.go.html#2094497">sgp</a></span><span class="op" id="2094660">.</span><span class="ident" id="2094661">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094668"><a href="/runtime/select.go.html#2094458">prevsgp</a></span>&nbsp;<span class="op" id="2094676">=</span>&nbsp;<span class="ident" id="2094678"><a href="/runtime/select.go.html#2094497">sgp</a></span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2094683">}</span><br>
<span class="lineno"></span><span class="op" id="2094685">}</span>
</div>
</body>
</html>
