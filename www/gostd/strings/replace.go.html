<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strings</h2>
<ul>
<li><a href="/gostd/strings/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/strings/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/strings/reader.go.html">reader.go</a></li>
<li><a href="/gostd/strings/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/strings/replace.go.html" class="current">replace.go</a></li>
<li><a href="/gostd/strings/replace_test.go.html">replace_test.go</a></li>
<li><a href="/gostd/strings/search.go.html">search.go</a></li>
<li><a href="/gostd/strings/search_test.go.html">search_test.go</a></li>
<li><a href="/gostd/strings/strings.go.html">strings.go</a></li>
<li><a href="/gostd/strings/strings_decl.go.html">strings_decl.go</a></li>
<li><a href="/gostd/strings/strings_test.go.html">strings_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2948375">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2948430">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2948484">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2948535">package</span>&nbsp;<span class="ident" id="2948543">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2948552">import</span>&nbsp;<span class="string" id="2948559">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2948565">//&nbsp;Replacer&nbsp;replaces&nbsp;a&nbsp;list&nbsp;of&nbsp;strings&nbsp;with&nbsp;replacements.</span><br>
<span class="lineno">10</span><span class="comment" id="2948623">//&nbsp;It&nbsp;is&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="2948680">type</span>&nbsp;<span class="ident" id="2948685">Replacer</span>&nbsp;<span class="keyword" id="2948694">struct</span>&nbsp;<span class="op" id="2948701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2948704">r</span>&nbsp;<span class="ident" id="2948706"><a href="/gostd/strings/replace.go.html#2948801">replacer</a></span><br>
<span class="lineno"></span><span class="op" id="2948715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2948718">//&nbsp;replacer&nbsp;is&nbsp;the&nbsp;interface&nbsp;that&nbsp;a&nbsp;replacement&nbsp;algorithm&nbsp;needs&nbsp;to&nbsp;implement.</span><br>
<span class="lineno"></span><span class="keyword" id="2948796">type</span>&nbsp;<span class="ident" id="2948801">replacer</span>&nbsp;<span class="keyword" id="2948810">interface</span>&nbsp;<span class="op" id="2948820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2948823">Replace</span><span class="op" id="2948830">(</span><span class="ident" id="2948831">s</span>&nbsp;<span class="builtintype" id="2948833">string</span><span class="op" id="2948839">)</span>&nbsp;<span class="builtintype" id="2948841">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2948849">WriteString</span><span class="op" id="2948860">(</span><span class="ident" id="2948861">w</span>&nbsp;<span class="ident" id="2948863"><a href="/gostd/strings/replace.go.html#2948559">io</a></span><span class="op" id="2948865">.</span><span class="ident" id="2948866"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="2948872">,</span>&nbsp;<span class="ident" id="2948874">s</span>&nbsp;<span class="builtintype" id="2948876">string</span><span class="op" id="2948882">)</span>&nbsp;<span class="op" id="2948884">(</span><span class="ident" id="2948885">n</span>&nbsp;<span class="builtintype" id="2948887">int</span><span class="op" id="2948890">,</span>&nbsp;<span class="ident" id="2948892">err</span>&nbsp;<span class="builtintype" id="2948896">error</span><span class="op" id="2948901">)</span><br>
<span class="lineno"></span><span class="op" id="2948903">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="2948906">//&nbsp;NewReplacer&nbsp;returns&nbsp;a&nbsp;new&nbsp;Replacer&nbsp;from&nbsp;a&nbsp;list&nbsp;of&nbsp;old,&nbsp;new&nbsp;string&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="comment" id="2948982">//&nbsp;Replacements&nbsp;are&nbsp;performed&nbsp;in&nbsp;order,&nbsp;without&nbsp;overlapping&nbsp;matches.</span><br>
<span class="lineno"></span><span class="keyword" id="2949051">func</span>&nbsp;<span class="ident" id="2949056">NewReplacer</span><span class="op" id="2949067">(</span><span class="ident" id="2949068">oldnew</span>&nbsp;<span class="op" id="2949075">...</span><span class="builtintype" id="2949078">string</span><span class="op" id="2949084">)</span>&nbsp;<span class="op" id="2949086">*</span><span class="ident" id="2949087"><a href="/gostd/strings/replace.go.html#2948685">Replacer</a></span>&nbsp;<span class="op" id="2949096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2949099">if</span>&nbsp;<span class="builtinfunc" id="2949102">len</span><span class="op" id="2949105">(</span><span class="ident" id="2949106"><a href="/gostd/strings/replace.go.html#2949068">oldnew</a></span><span class="op" id="2949112">)</span><span class="op" id="2949113">%</span><span class="num" id="2949114">2</span>&nbsp;<span class="op" id="2949116">==</span>&nbsp;<span class="num" id="2949119">1</span>&nbsp;<span class="op" id="2949121">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2949125">panic</span><span class="op" id="2949130">(</span><span class="string" id="2949131">&#34;strings.NewReplacer:&nbsp;odd&nbsp;argument&nbsp;count&#34;</span><span class="op" id="2949172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2949175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2949179">if</span>&nbsp;<span class="builtinfunc" id="2949182">len</span><span class="op" id="2949185">(</span><span class="ident" id="2949186"><a href="/gostd/strings/replace.go.html#2949068">oldnew</a></span><span class="op" id="2949192">)</span>&nbsp;<span class="op" id="2949194">==</span>&nbsp;<span class="num" id="2949197">2</span>&nbsp;<span class="op" id="2949199">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2949202">len</span><span class="op" id="2949205">(</span><span class="ident" id="2949206"><a href="/gostd/strings/replace.go.html#2949068">oldnew</a></span><span class="op" id="2949212">[</span><span class="num" id="2949213">0</span><span class="op" id="2949214">]</span><span class="op" id="2949215">)</span>&nbsp;<span class="op" id="2949217">&gt;</span>&nbsp;<span class="num" id="2949219">1</span>&nbsp;<span class="op" id="2949221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2949225">return</span>&nbsp;<span class="op" id="2949232">&amp;</span><span class="ident" id="2949233"><a href="/gostd/strings/replace.go.html#2948685">Replacer</a></span><span class="op" id="2949241">{</span><span class="ident" id="2949242"><a href="/gostd/strings/replace.go.html#2948704">r</a></span><span class="op" id="2949243">:</span>&nbsp;<span class="ident" id="2949245"><a href="/gostd/strings/replace.go.html#2958041">makeSingleStringReplacer</a></span><span class="op" id="2949269">(</span><span class="ident" id="2949270"><a href="/gostd/strings/replace.go.html#2949068">oldnew</a></span><span class="op" id="2949276">[</span><span class="num" id="2949277">0</span><span class="op" id="2949278">]</span><span class="op" id="2949279">,</span>&nbsp;<span class="ident" id="2949281"><a href="/gostd/strings/replace.go.html#2949068">oldnew</a></span><span class="op" id="2949287">[</span><span class="num" id="2949288">1</span><span class="op" id="2949289">]</span><span class="op" id="2949290">)</span><span class="op" id="2949291">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2949294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949298">allNewBytes</span>&nbsp;<span class="op" id="2949310">:=</span>&nbsp;<span class="builtintype" id="2949313">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2949319">for</span>&nbsp;<span class="ident" id="2949323">i</span>&nbsp;<span class="op" id="2949325">:=</span>&nbsp;<span class="num" id="2949328">0</span><span class="op" id="2949329">;</span>&nbsp;<span class="ident" id="2949331"><a href="/gostd/strings/replace.go.html#2949323">i</a></span>&nbsp;<span class="op" id="2949333">&lt;</span>&nbsp;<span class="builtinfunc" id="2949335">len</span><span class="op" id="2949338">(</span><span class="ident" id="2949339"><a href="/gostd/strings/replace.go.html#2949068">oldnew</a></span><span class="op" id="2949345">)</span><span class="op" id="2949346">;</span>&nbsp;<span class="ident" id="2949348"><a href="/gostd/strings/replace.go.html#2949323">i</a></span>&nbsp;<span class="op" id="2949350">+=</span>&nbsp;<span class="num" id="2949353">2</span>&nbsp;<span class="op" id="2949355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2949359">if</span>&nbsp;<span class="builtinfunc" id="2949362">len</span><span class="op" id="2949365">(</span><span class="ident" id="2949366"><a href="/gostd/strings/replace.go.html#2949068">oldnew</a></span><span class="op" id="2949372">[</span><span class="ident" id="2949373"><a href="/gostd/strings/replace.go.html#2949323">i</a></span><span class="op" id="2949374">]</span><span class="op" id="2949375">)</span>&nbsp;<span class="op" id="2949377">!=</span>&nbsp;<span class="num" id="2949380">1</span>&nbsp;<span class="op" id="2949382">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2949387">return</span>&nbsp;<span class="op" id="2949394">&amp;</span><span class="ident" id="2949395"><a href="/gostd/strings/replace.go.html#2948685">Replacer</a></span><span class="op" id="2949403">{</span><span class="ident" id="2949404"><a href="/gostd/strings/replace.go.html#2948704">r</a></span><span class="op" id="2949405">:</span>&nbsp;<span class="ident" id="2949407"><a href="/gostd/strings/replace.go.html#2955311">makeGenericReplacer</a></span><span class="op" id="2949426">(</span><span class="ident" id="2949427"><a href="/gostd/strings/replace.go.html#2949068">oldnew</a></span><span class="op" id="2949433">)</span><span class="op" id="2949434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2949438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2949442">if</span>&nbsp;<span class="builtinfunc" id="2949445">len</span><span class="op" id="2949448">(</span><span class="ident" id="2949449"><a href="/gostd/strings/replace.go.html#2949068">oldnew</a></span><span class="op" id="2949455">[</span><span class="ident" id="2949456"><a href="/gostd/strings/replace.go.html#2949323">i</a></span><span class="op" id="2949457">+</span><span class="num" id="2949458">1</span><span class="op" id="2949459">]</span><span class="op" id="2949460">)</span>&nbsp;<span class="op" id="2949462">!=</span>&nbsp;<span class="num" id="2949465">1</span>&nbsp;<span class="op" id="2949467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949472"><a href="/gostd/strings/replace.go.html#2949298">allNewBytes</a></span>&nbsp;<span class="op" id="2949484">=</span>&nbsp;<span class="builtintype" id="2949486">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2949494">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2949497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2949501">if</span>&nbsp;<span class="ident" id="2949504"><a href="/gostd/strings/replace.go.html#2949298">allNewBytes</a></span>&nbsp;<span class="op" id="2949516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949520">r</span>&nbsp;<span class="op" id="2949522">:=</span>&nbsp;<span class="ident" id="2949525"><a href="/gostd/strings/replace.go.html#2959212">byteReplacer</a></span><span class="op" id="2949537">{</span><span class="op" id="2949538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2949542">for</span>&nbsp;<span class="ident" id="2949546">i</span>&nbsp;<span class="op" id="2949548">:=</span>&nbsp;<span class="keyword" id="2949551">range</span>&nbsp;<span class="ident" id="2949557"><a href="/gostd/strings/replace.go.html#2949520">r</a></span>&nbsp;<span class="op" id="2949559">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949564"><a href="/gostd/strings/replace.go.html#2949520">r</a></span><span class="op" id="2949565">[</span><span class="ident" id="2949566"><a href="/gostd/strings/replace.go.html#2949546">i</a></span><span class="op" id="2949567">]</span>&nbsp;<span class="op" id="2949569">=</span>&nbsp;<span class="builtintype" id="2949571">byte</span><span class="op" id="2949575">(</span><span class="ident" id="2949576"><a href="/gostd/strings/replace.go.html#2949546">i</a></span><span class="op" id="2949577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2949581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2949585">//&nbsp;The&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;old-&gt;new&nbsp;map&nbsp;takes&nbsp;precedence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2949644">//&nbsp;over&nbsp;the&nbsp;others&nbsp;with&nbsp;the&nbsp;same&nbsp;old&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2949691">for</span>&nbsp;<span class="ident" id="2949695">i</span>&nbsp;<span class="op" id="2949697">:=</span>&nbsp;<span class="builtinfunc" id="2949700">len</span><span class="op" id="2949703">(</span><span class="ident" id="2949704"><a href="/gostd/strings/replace.go.html#2949068">oldnew</a></span><span class="op" id="2949710">)</span>&nbsp;<span class="op" id="2949712">-</span>&nbsp;<span class="num" id="2949714">2</span><span class="op" id="2949715">;</span>&nbsp;<span class="ident" id="2949717"><a href="/gostd/strings/replace.go.html#2949695">i</a></span>&nbsp;<span class="op" id="2949719">&gt;=</span>&nbsp;<span class="num" id="2949722">0</span><span class="op" id="2949723">;</span>&nbsp;<span class="ident" id="2949725"><a href="/gostd/strings/replace.go.html#2949695">i</a></span>&nbsp;<span class="op" id="2949727">-=</span>&nbsp;<span class="num" id="2949730">2</span>&nbsp;<span class="op" id="2949732">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949737">o</span>&nbsp;<span class="op" id="2949739">:=</span>&nbsp;<span class="ident" id="2949742"><a href="/gostd/strings/replace.go.html#2949068">oldnew</a></span><span class="op" id="2949748">[</span><span class="ident" id="2949749"><a href="/gostd/strings/replace.go.html#2949695">i</a></span><span class="op" id="2949750">]</span><span class="op" id="2949751">[</span><span class="num" id="2949752">0</span><span class="op" id="2949753">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949758">n</span>&nbsp;<span class="op" id="2949760">:=</span>&nbsp;<span class="ident" id="2949763"><a href="/gostd/strings/replace.go.html#2949068">oldnew</a></span><span class="op" id="2949769">[</span><span class="ident" id="2949770"><a href="/gostd/strings/replace.go.html#2949695">i</a></span><span class="op" id="2949771">+</span><span class="num" id="2949772">1</span><span class="op" id="2949773">]</span><span class="op" id="2949774">[</span><span class="num" id="2949775">0</span><span class="op" id="2949776">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949781"><a href="/gostd/strings/replace.go.html#2949520">r</a></span><span class="op" id="2949782">[</span><span class="ident" id="2949783"><a href="/gostd/strings/replace.go.html#2949737">o</a></span><span class="op" id="2949784">]</span>&nbsp;<span class="op" id="2949786">=</span>&nbsp;<span class="ident" id="2949788"><a href="/gostd/strings/replace.go.html#2949758">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2949792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2949796">return</span>&nbsp;<span class="op" id="2949803">&amp;</span><span class="ident" id="2949804"><a href="/gostd/strings/replace.go.html#2948685">Replacer</a></span><span class="op" id="2949812">{</span><span class="ident" id="2949813"><a href="/gostd/strings/replace.go.html#2948704">r</a></span><span class="op" id="2949814">:</span>&nbsp;<span class="op" id="2949816">&amp;</span><span class="ident" id="2949817"><a href="/gostd/strings/replace.go.html#2949520">r</a></span><span class="op" id="2949818">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2949821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949825">r</span>&nbsp;<span class="op" id="2949827">:=</span>&nbsp;<span class="ident" id="2949830"><a href="/gostd/strings/replace.go.html#2960257">byteStringReplacer</a></span><span class="op" id="2949848">{</span><span class="op" id="2949849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2949852">//&nbsp;The&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;old-&gt;new&nbsp;map&nbsp;takes&nbsp;precedence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2949910">//&nbsp;over&nbsp;the&nbsp;others&nbsp;with&nbsp;the&nbsp;same&nbsp;old&nbsp;string.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2949956">for</span>&nbsp;<span class="ident" id="2949960">i</span>&nbsp;<span class="op" id="2949962">:=</span>&nbsp;<span class="builtinfunc" id="2949965">len</span><span class="op" id="2949968">(</span><span class="ident" id="2949969"><a href="/gostd/strings/replace.go.html#2949068">oldnew</a></span><span class="op" id="2949975">)</span>&nbsp;<span class="op" id="2949977">-</span>&nbsp;<span class="num" id="2949979">2</span><span class="op" id="2949980">;</span>&nbsp;<span class="ident" id="2949982"><a href="/gostd/strings/replace.go.html#2949960">i</a></span>&nbsp;<span class="op" id="2949984">&gt;=</span>&nbsp;<span class="num" id="2949987">0</span><span class="op" id="2949988">;</span>&nbsp;<span class="ident" id="2949990"><a href="/gostd/strings/replace.go.html#2949960">i</a></span>&nbsp;<span class="op" id="2949992">-=</span>&nbsp;<span class="num" id="2949995">2</span>&nbsp;<span class="op" id="2949997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950001">o</span>&nbsp;<span class="op" id="2950003">:=</span>&nbsp;<span class="ident" id="2950006"><a href="/gostd/strings/replace.go.html#2949068">oldnew</a></span><span class="op" id="2950012">[</span><span class="ident" id="2950013"><a href="/gostd/strings/replace.go.html#2949960">i</a></span><span class="op" id="2950014">]</span><span class="op" id="2950015">[</span><span class="num" id="2950016">0</span><span class="op" id="2950017">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950021">n</span>&nbsp;<span class="op" id="2950023">:=</span>&nbsp;<span class="ident" id="2950026"><a href="/gostd/strings/replace.go.html#2949068">oldnew</a></span><span class="op" id="2950032">[</span><span class="ident" id="2950033"><a href="/gostd/strings/replace.go.html#2949960">i</a></span><span class="op" id="2950034">+</span><span class="num" id="2950035">1</span><span class="op" id="2950036">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950040"><a href="/gostd/strings/replace.go.html#2949825">r</a></span><span class="op" id="2950041">[</span><span class="ident" id="2950042"><a href="/gostd/strings/replace.go.html#2950001">o</a></span><span class="op" id="2950043">]</span>&nbsp;<span class="op" id="2950045">=</span>&nbsp;<span class="op" id="2950047">[</span><span class="op" id="2950048">]</span><span class="builtintype" id="2950049">byte</span><span class="op" id="2950053">(</span><span class="ident" id="2950054"><a href="/gostd/strings/replace.go.html#2950021">n</a></span><span class="op" id="2950055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2950058">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2950061">return</span>&nbsp;<span class="op" id="2950068">&amp;</span><span class="ident" id="2950069"><a href="/gostd/strings/replace.go.html#2948685">Replacer</a></span><span class="op" id="2950077">{</span><span class="ident" id="2950078"><a href="/gostd/strings/replace.go.html#2948704">r</a></span><span class="op" id="2950079">:</span>&nbsp;<span class="op" id="2950081">&amp;</span><span class="ident" id="2950082"><a href="/gostd/strings/replace.go.html#2949825">r</a></span><span class="op" id="2950083">}</span><br>
<span class="lineno"></span><span class="op" id="2950085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2950088">//&nbsp;Replace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;s&nbsp;with&nbsp;all&nbsp;replacements&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="2950152">func</span>&nbsp;<span class="op" id="2950157">(</span><span class="ident" id="2950158">r</span>&nbsp;<span class="op" id="2950160">*</span><span class="ident" id="2950161"><a href="/gostd/strings/replace.go.html#2948685">Replacer</a></span><span class="op" id="2950169">)</span>&nbsp;<span class="ident" id="2950171">Replace</span><span class="op" id="2950178">(</span><span class="ident" id="2950179">s</span>&nbsp;<span class="builtintype" id="2950181">string</span><span class="op" id="2950187">)</span>&nbsp;<span class="builtintype" id="2950189">string</span>&nbsp;<span class="op" id="2950196">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2950199">return</span>&nbsp;<span class="ident" id="2950206"><a href="/gostd/strings/replace.go.html#2950158">r</a></span><span class="op" id="2950207">.</span><span class="ident" id="2950208"><a href="/gostd/strings/replace.go.html#2948704">r</a></span><span class="op" id="2950209">.</span><span class="ident" id="2950210"><a href="/gostd/strings/replace.go.html#2948823">Replace</a></span><span class="op" id="2950217">(</span><span class="ident" id="2950218"><a href="/gostd/strings/replace.go.html#2950179">s</a></span><span class="op" id="2950219">)</span><br>
<span class="lineno"></span><span class="op" id="2950221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2950224">//&nbsp;WriteString&nbsp;writes&nbsp;s&nbsp;to&nbsp;w&nbsp;with&nbsp;all&nbsp;replacements&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="2950286">func</span>&nbsp;<span class="op" id="2950291">(</span><span class="ident" id="2950292">r</span>&nbsp;<span class="op" id="2950294">*</span><span class="ident" id="2950295"><a href="/gostd/strings/replace.go.html#2948685">Replacer</a></span><span class="op" id="2950303">)</span>&nbsp;<span class="ident" id="2950305">WriteString</span><span class="op" id="2950316">(</span><span class="ident" id="2950317">w</span>&nbsp;<span class="ident" id="2950319"><a href="/gostd/strings/replace.go.html#2948559">io</a></span><span class="op" id="2950321">.</span><span class="ident" id="2950322"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="2950328">,</span>&nbsp;<span class="ident" id="2950330">s</span>&nbsp;<span class="builtintype" id="2950332">string</span><span class="op" id="2950338">)</span>&nbsp;<span class="op" id="2950340">(</span><span class="ident" id="2950341">n</span>&nbsp;<span class="builtintype" id="2950343">int</span><span class="op" id="2950346">,</span>&nbsp;<span class="ident" id="2950348">err</span>&nbsp;<span class="builtintype" id="2950352">error</span><span class="op" id="2950357">)</span>&nbsp;<span class="op" id="2950359">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2950362">return</span>&nbsp;<span class="ident" id="2950369"><a href="/gostd/strings/replace.go.html#2950292">r</a></span><span class="op" id="2950370">.</span><span class="ident" id="2950371"><a href="/gostd/strings/replace.go.html#2948704">r</a></span><span class="op" id="2950372">.</span><span class="ident" id="2950373"><a href="/gostd/strings/replace.go.html#2948849">WriteString</a></span><span class="op" id="2950384">(</span><span class="ident" id="2950385"><a href="/gostd/strings/replace.go.html#2950317">w</a></span><span class="op" id="2950386">,</span>&nbsp;<span class="ident" id="2950388"><a href="/gostd/strings/replace.go.html#2950330">s</a></span><span class="op" id="2950389">)</span><br>
<span class="lineno"></span><span class="op" id="2950391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2950394">//&nbsp;trieNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;a&nbsp;lookup&nbsp;trie&nbsp;for&nbsp;prioritized&nbsp;key/value&nbsp;pairs.&nbsp;Keys</span><br>
<span class="lineno"></span><span class="comment" id="2950471">//&nbsp;and&nbsp;values&nbsp;may&nbsp;be&nbsp;empty.&nbsp;For&nbsp;example,&nbsp;the&nbsp;trie&nbsp;containing&nbsp;keys&nbsp;&#34;ax&#34;,&nbsp;&#34;ay&#34;,</span><br>
<span class="lineno">80</span><span class="comment" id="2950549">//&nbsp;&#34;bcbc&#34;,&nbsp;&#34;x&#34;&nbsp;and&nbsp;&#34;xy&#34;&nbsp;could&nbsp;have&nbsp;eight&nbsp;nodes:</span><br>
<span class="lineno"></span><span class="comment" id="2950597">//</span><br>
<span class="lineno"></span><span class="comment" id="2950600">//&nbsp;&nbsp;n0&nbsp;&nbsp;-</span><br>
<span class="lineno"></span><span class="comment" id="2950610">//&nbsp;&nbsp;n1&nbsp;&nbsp;a-</span><br>
<span class="lineno"></span><span class="comment" id="2950621">//&nbsp;&nbsp;n2&nbsp;&nbsp;.x+</span><br>
<span class="lineno">85</span><span class="comment" id="2950633">//&nbsp;&nbsp;n3&nbsp;&nbsp;.y+</span><br>
<span class="lineno"></span><span class="comment" id="2950645">//&nbsp;&nbsp;n4&nbsp;&nbsp;b-</span><br>
<span class="lineno"></span><span class="comment" id="2950656">//&nbsp;&nbsp;n5&nbsp;&nbsp;.cbc+</span><br>
<span class="lineno"></span><span class="comment" id="2950670">//&nbsp;&nbsp;n6&nbsp;&nbsp;x+</span><br>
<span class="lineno"></span><span class="comment" id="2950681">//&nbsp;&nbsp;n7&nbsp;&nbsp;.y+</span><br>
<span class="lineno">90</span><span class="comment" id="2950693">//</span><br>
<span class="lineno"></span><span class="comment" id="2950696">//&nbsp;n0&nbsp;is&nbsp;the&nbsp;root&nbsp;node,&nbsp;and&nbsp;its&nbsp;children&nbsp;are&nbsp;n1,&nbsp;n4&nbsp;and&nbsp;n6;&nbsp;n1&#39;s&nbsp;children&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="2950774">//&nbsp;n2&nbsp;and&nbsp;n3;&nbsp;n4&#39;s&nbsp;child&nbsp;is&nbsp;n5;&nbsp;n6&#39;s&nbsp;child&nbsp;is&nbsp;n7.&nbsp;Nodes&nbsp;n0,&nbsp;n1&nbsp;and&nbsp;n4&nbsp;(marked</span><br>
<span class="lineno"></span><span class="comment" id="2950852">//&nbsp;with&nbsp;a&nbsp;trailing&nbsp;&#34;-&#34;)&nbsp;are&nbsp;partial&nbsp;keys,&nbsp;and&nbsp;nodes&nbsp;n2,&nbsp;n3,&nbsp;n5,&nbsp;n6&nbsp;and&nbsp;n7</span><br>
<span class="lineno"></span><span class="comment" id="2950926">//&nbsp;(marked&nbsp;with&nbsp;a&nbsp;trailing&nbsp;&#34;+&#34;)&nbsp;are&nbsp;complete&nbsp;keys.</span><br>
<span class="lineno">95</span><span class="keyword" id="2950977">type</span>&nbsp;<span class="ident" id="2950982">trieNode</span>&nbsp;<span class="keyword" id="2950991">struct</span>&nbsp;<span class="op" id="2950998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951001">//&nbsp;value&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;trie&nbsp;node&#39;s&nbsp;key/value&nbsp;pair.&nbsp;It&nbsp;is&nbsp;empty&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951074">//&nbsp;this&nbsp;node&nbsp;is&nbsp;not&nbsp;a&nbsp;complete&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2951111">value</span>&nbsp;<span class="builtintype" id="2951117">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951125">//&nbsp;priority&nbsp;is&nbsp;the&nbsp;priority&nbsp;(higher&nbsp;is&nbsp;more&nbsp;important)&nbsp;of&nbsp;the&nbsp;trie&nbsp;node&#39;s</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951200">//&nbsp;key/value&nbsp;pair;&nbsp;keys&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;matched&nbsp;shortest-&nbsp;or&nbsp;longest-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951275">//&nbsp;first.&nbsp;Priority&nbsp;is&nbsp;positive&nbsp;if&nbsp;this&nbsp;node&nbsp;is&nbsp;a&nbsp;complete&nbsp;key,&nbsp;and&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951348">//&nbsp;otherwise.&nbsp;In&nbsp;the&nbsp;example&nbsp;above,&nbsp;positive/zero&nbsp;priorities&nbsp;are&nbsp;marked</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951421">//&nbsp;with&nbsp;a&nbsp;trailing&nbsp;&#34;+&#34;&nbsp;or&nbsp;&#34;-&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2951453">priority</span>&nbsp;<span class="builtintype" id="2951462">int</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951468">//&nbsp;A&nbsp;trie&nbsp;node&nbsp;may&nbsp;have&nbsp;zero,&nbsp;one&nbsp;or&nbsp;more&nbsp;child&nbsp;nodes:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951524">//&nbsp;&nbsp;*&nbsp;if&nbsp;the&nbsp;remaining&nbsp;fields&nbsp;are&nbsp;zero,&nbsp;there&nbsp;are&nbsp;no&nbsp;children.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951588">//&nbsp;&nbsp;*&nbsp;if&nbsp;prefix&nbsp;and&nbsp;next&nbsp;are&nbsp;non-zero,&nbsp;there&nbsp;is&nbsp;one&nbsp;child&nbsp;in&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951656">//&nbsp;&nbsp;*&nbsp;if&nbsp;table&nbsp;is&nbsp;non-zero,&nbsp;it&nbsp;defines&nbsp;all&nbsp;the&nbsp;children.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951714">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951718">//&nbsp;Prefixes&nbsp;are&nbsp;preferred&nbsp;over&nbsp;tables&nbsp;when&nbsp;there&nbsp;is&nbsp;one&nbsp;child,&nbsp;but&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951790">//&nbsp;root&nbsp;node&nbsp;always&nbsp;uses&nbsp;a&nbsp;table&nbsp;for&nbsp;lookup&nbsp;efficiency.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951848">//&nbsp;prefix&nbsp;is&nbsp;the&nbsp;difference&nbsp;in&nbsp;keys&nbsp;between&nbsp;this&nbsp;trie&nbsp;node&nbsp;and&nbsp;the&nbsp;next.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951922">//&nbsp;In&nbsp;the&nbsp;example&nbsp;above,&nbsp;node&nbsp;n4&nbsp;has&nbsp;prefix&nbsp;&#34;cbc&#34;&nbsp;and&nbsp;n4&#39;s&nbsp;next&nbsp;node&nbsp;is&nbsp;n5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951999">//&nbsp;Node&nbsp;n5&nbsp;has&nbsp;no&nbsp;children&nbsp;and&nbsp;so&nbsp;has&nbsp;zero&nbsp;prefix,&nbsp;next&nbsp;and&nbsp;table&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2952074">prefix</span>&nbsp;<span class="builtintype" id="2952081">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2952089">next</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2952096">*</span><span class="ident" id="2952097"><a href="/gostd/strings/replace.go.html#2950982">trieNode</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2952108">//&nbsp;table&nbsp;is&nbsp;a&nbsp;lookup&nbsp;table&nbsp;indexed&nbsp;by&nbsp;the&nbsp;next&nbsp;byte&nbsp;in&nbsp;the&nbsp;key,&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2952179">//&nbsp;remapping&nbsp;that&nbsp;byte&nbsp;through&nbsp;genericReplacer.mapping&nbsp;to&nbsp;create&nbsp;a&nbsp;dense</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2952253">//&nbsp;index.&nbsp;In&nbsp;the&nbsp;example&nbsp;above,&nbsp;the&nbsp;keys&nbsp;only&nbsp;use&nbsp;&#39;a&#39;,&nbsp;&#39;b&#39;,&nbsp;&#39;c&#39;,&nbsp;&#39;x&#39;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2952327">//&nbsp;&#39;y&#39;,&nbsp;which&nbsp;remap&nbsp;to&nbsp;0,&nbsp;1,&nbsp;2,&nbsp;3&nbsp;and&nbsp;4.&nbsp;All&nbsp;other&nbsp;bytes&nbsp;remap&nbsp;to&nbsp;5,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2952401">//&nbsp;genericReplacer.tableSize&nbsp;will&nbsp;be&nbsp;5.&nbsp;Node&nbsp;n0&#39;s&nbsp;table&nbsp;will&nbsp;be</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2952466">//&nbsp;[]*trieNode{&nbsp;0:n1,&nbsp;1:n4,&nbsp;3:n6&nbsp;},&nbsp;where&nbsp;the&nbsp;0,&nbsp;1&nbsp;and&nbsp;3&nbsp;are&nbsp;the&nbsp;remapped</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2952541">//&nbsp;&#39;a&#39;,&nbsp;&#39;b&#39;&nbsp;and&nbsp;&#39;x&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2952563">table</span>&nbsp;<span class="op" id="2952569">[</span><span class="op" id="2952570">]</span><span class="op" id="2952571">*</span><span class="ident" id="2952572"><a href="/gostd/strings/replace.go.html#2950982">trieNode</a></span><br>
<span class="lineno"></span><span class="op" id="2952581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2952584">func</span>&nbsp;<span class="op" id="2952589">(</span><span class="ident" id="2952590">t</span>&nbsp;<span class="op" id="2952592">*</span><span class="ident" id="2952593"><a href="/gostd/strings/replace.go.html#2950982">trieNode</a></span><span class="op" id="2952601">)</span>&nbsp;<span class="ident" id="2952603">add</span><span class="op" id="2952606">(</span><span class="ident" id="2952607">key</span><span class="op" id="2952610">,</span>&nbsp;<span class="ident" id="2952612">val</span>&nbsp;<span class="builtintype" id="2952616">string</span><span class="op" id="2952622">,</span>&nbsp;<span class="ident" id="2952624">priority</span>&nbsp;<span class="builtintype" id="2952633">int</span><span class="op" id="2952636">,</span>&nbsp;<span class="ident" id="2952638">r</span>&nbsp;<span class="op" id="2952640">*</span><span class="ident" id="2952641"><a href="/gostd/strings/replace.go.html#2955061">genericReplacer</a></span><span class="op" id="2952656">)</span>&nbsp;<span class="op" id="2952658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2952661">if</span>&nbsp;<span class="ident" id="2952664"><a href="/gostd/strings/replace.go.html#2952607">key</a></span>&nbsp;<span class="op" id="2952668">==</span>&nbsp;<span class="string" id="2952671">&#34;&#34;</span>&nbsp;<span class="op" id="2952674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2952678">if</span>&nbsp;<span class="ident" id="2952681"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2952682">.</span><span class="ident" id="2952683"><a href="/gostd/strings/replace.go.html#2951453">priority</a></span>&nbsp;<span class="op" id="2952692">==</span>&nbsp;<span class="num" id="2952695">0</span>&nbsp;<span class="op" id="2952697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2952702"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2952703">.</span><span class="ident" id="2952704"><a href="/gostd/strings/replace.go.html#2951111">value</a></span>&nbsp;<span class="op" id="2952710">=</span>&nbsp;<span class="ident" id="2952712"><a href="/gostd/strings/replace.go.html#2952612">val</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2952719"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2952720">.</span><span class="ident" id="2952721"><a href="/gostd/strings/replace.go.html#2951453">priority</a></span>&nbsp;<span class="op" id="2952730">=</span>&nbsp;<span class="ident" id="2952732"><a href="/gostd/strings/replace.go.html#2952624">priority</a></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2952743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2952747">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2952755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2952759">if</span>&nbsp;<span class="ident" id="2952762"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2952763">.</span><span class="ident" id="2952764"><a href="/gostd/strings/replace.go.html#2952074">prefix</a></span>&nbsp;<span class="op" id="2952771">!=</span>&nbsp;<span class="string" id="2952774">&#34;&#34;</span>&nbsp;<span class="op" id="2952777">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2952781">//&nbsp;Need&nbsp;to&nbsp;split&nbsp;the&nbsp;prefix&nbsp;among&nbsp;multiple&nbsp;nodes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2952833">var</span>&nbsp;<span class="ident" id="2952837">n</span>&nbsp;<span class="builtintype" id="2952839">int</span>&nbsp;<span class="comment" id="2952843">//&nbsp;length&nbsp;of&nbsp;the&nbsp;longest&nbsp;common&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2952884">for</span>&nbsp;<span class="op" id="2952888">;</span>&nbsp;<span class="ident" id="2952890"><a href="/gostd/strings/replace.go.html#2952837">n</a></span>&nbsp;<span class="op" id="2952892">&lt;</span>&nbsp;<span class="builtinfunc" id="2952894">len</span><span class="op" id="2952897">(</span><span class="ident" id="2952898"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2952899">.</span><span class="ident" id="2952900"><a href="/gostd/strings/replace.go.html#2952074">prefix</a></span><span class="op" id="2952906">)</span>&nbsp;<span class="op" id="2952908">&amp;&amp;</span>&nbsp;<span class="ident" id="2952911"><a href="/gostd/strings/replace.go.html#2952837">n</a></span>&nbsp;<span class="op" id="2952913">&lt;</span>&nbsp;<span class="builtinfunc" id="2952915">len</span><span class="op" id="2952918">(</span><span class="ident" id="2952919"><a href="/gostd/strings/replace.go.html#2952607">key</a></span><span class="op" id="2952922">)</span><span class="op" id="2952923">;</span>&nbsp;<span class="ident" id="2952925"><a href="/gostd/strings/replace.go.html#2952837">n</a></span><span class="op" id="2952926">++</span>&nbsp;<span class="op" id="2952929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2952934">if</span>&nbsp;<span class="ident" id="2952937"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2952938">.</span><span class="ident" id="2952939"><a href="/gostd/strings/replace.go.html#2952074">prefix</a></span><span class="op" id="2952945">[</span><span class="ident" id="2952946"><a href="/gostd/strings/replace.go.html#2952837">n</a></span><span class="op" id="2952947">]</span>&nbsp;<span class="op" id="2952949">!=</span>&nbsp;<span class="ident" id="2952952"><a href="/gostd/strings/replace.go.html#2952607">key</a></span><span class="op" id="2952955">[</span><span class="ident" id="2952956"><a href="/gostd/strings/replace.go.html#2952837">n</a></span><span class="op" id="2952957">]</span>&nbsp;<span class="op" id="2952959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2952965">break</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2952974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2952978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2952982">if</span>&nbsp;<span class="ident" id="2952985"><a href="/gostd/strings/replace.go.html#2952837">n</a></span>&nbsp;<span class="op" id="2952987">==</span>&nbsp;<span class="builtinfunc" id="2952990">len</span><span class="op" id="2952993">(</span><span class="ident" id="2952994"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2952995">.</span><span class="ident" id="2952996"><a href="/gostd/strings/replace.go.html#2952074">prefix</a></span><span class="op" id="2953002">)</span>&nbsp;<span class="op" id="2953004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953009"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2953010">.</span><span class="ident" id="2953011"><a href="/gostd/strings/replace.go.html#2952089">next</a></span><span class="op" id="2953015">.</span><span class="ident" id="2953016"><a href="/gostd/strings/replace.go.html#2952603">add</a></span><span class="op" id="2953019">(</span><span class="ident" id="2953020"><a href="/gostd/strings/replace.go.html#2952607">key</a></span><span class="op" id="2953023">[</span><span class="ident" id="2953024"><a href="/gostd/strings/replace.go.html#2952837">n</a></span><span class="op" id="2953025">:</span><span class="op" id="2953026">]</span><span class="op" id="2953027">,</span>&nbsp;<span class="ident" id="2953029"><a href="/gostd/strings/replace.go.html#2952612">val</a></span><span class="op" id="2953032">,</span>&nbsp;<span class="ident" id="2953034"><a href="/gostd/strings/replace.go.html#2952624">priority</a></span><span class="op" id="2953042">,</span>&nbsp;<span class="ident" id="2953044"><a href="/gostd/strings/replace.go.html#2952638">r</a></span><span class="op" id="2953045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2953049">}</span>&nbsp;<span class="keyword" id="2953051">else</span>&nbsp;<span class="keyword" id="2953056">if</span>&nbsp;<span class="ident" id="2953059"><a href="/gostd/strings/replace.go.html#2952837">n</a></span>&nbsp;<span class="op" id="2953061">==</span>&nbsp;<span class="num" id="2953064">0</span>&nbsp;<span class="op" id="2953066">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2953071">//&nbsp;First&nbsp;byte&nbsp;differs,&nbsp;start&nbsp;a&nbsp;new&nbsp;lookup&nbsp;table&nbsp;here.&nbsp;Looking&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2953139">//&nbsp;what&nbsp;is&nbsp;currently&nbsp;t.prefix[0]&nbsp;will&nbsp;lead&nbsp;to&nbsp;prefixNode,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2953204">//&nbsp;looking&nbsp;up&nbsp;key[0]&nbsp;will&nbsp;lead&nbsp;to&nbsp;keyNode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2953250">var</span>&nbsp;<span class="ident" id="2953254">prefixNode</span>&nbsp;<span class="op" id="2953265">*</span><span class="ident" id="2953266"><a href="/gostd/strings/replace.go.html#2950982">trieNode</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2953278">if</span>&nbsp;<span class="builtinfunc" id="2953281">len</span><span class="op" id="2953284">(</span><span class="ident" id="2953285"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2953286">.</span><span class="ident" id="2953287"><a href="/gostd/strings/replace.go.html#2952074">prefix</a></span><span class="op" id="2953293">)</span>&nbsp;<span class="op" id="2953295">==</span>&nbsp;<span class="num" id="2953298">1</span>&nbsp;<span class="op" id="2953300">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953306"><a href="/gostd/strings/replace.go.html#2953254">prefixNode</a></span>&nbsp;<span class="op" id="2953317">=</span>&nbsp;<span class="ident" id="2953319"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2953320">.</span><span class="ident" id="2953321"><a href="/gostd/strings/replace.go.html#2952089">next</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2953329">}</span>&nbsp;<span class="keyword" id="2953331">else</span>&nbsp;<span class="op" id="2953336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953342"><a href="/gostd/strings/replace.go.html#2953254">prefixNode</a></span>&nbsp;<span class="op" id="2953353">=</span>&nbsp;<span class="op" id="2953355">&amp;</span><span class="ident" id="2953356"><a href="/gostd/strings/replace.go.html#2950982">trieNode</a></span><span class="op" id="2953364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953371"><a href="/gostd/strings/replace.go.html#2952074">prefix</a></span><span class="op" id="2953377">:</span>&nbsp;<span class="ident" id="2953379"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2953380">.</span><span class="ident" id="2953381"><a href="/gostd/strings/replace.go.html#2952074">prefix</a></span><span class="op" id="2953387">[</span><span class="num" id="2953388">1</span><span class="op" id="2953389">:</span><span class="op" id="2953390">]</span><span class="op" id="2953391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953398"><a href="/gostd/strings/replace.go.html#2952089">next</a></span><span class="op" id="2953402">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2953406"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2953407">.</span><span class="ident" id="2953408"><a href="/gostd/strings/replace.go.html#2952089">next</a></span><span class="op" id="2953412">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2953418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2953423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953428">keyNode</span>&nbsp;<span class="op" id="2953436">:=</span>&nbsp;<span class="builtinfunc" id="2953439">new</span><span class="op" id="2953442">(</span><span class="ident" id="2953443"><a href="/gostd/strings/replace.go.html#2950982">trieNode</a></span><span class="op" id="2953451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953456"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2953457">.</span><span class="ident" id="2953458"><a href="/gostd/strings/replace.go.html#2952563">table</a></span>&nbsp;<span class="op" id="2953464">=</span>&nbsp;<span class="builtinfunc" id="2953466">make</span><span class="op" id="2953470">(</span><span class="op" id="2953471">[</span><span class="op" id="2953472">]</span><span class="op" id="2953473">*</span><span class="ident" id="2953474"><a href="/gostd/strings/replace.go.html#2950982">trieNode</a></span><span class="op" id="2953482">,</span>&nbsp;<span class="ident" id="2953484"><a href="/gostd/strings/replace.go.html#2952638">r</a></span><span class="op" id="2953485">.</span><span class="ident" id="2953486"><a href="/gostd/strings/replace.go.html#2955201">tableSize</a></span><span class="op" id="2953495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953500"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2953501">.</span><span class="ident" id="2953502"><a href="/gostd/strings/replace.go.html#2952563">table</a></span><span class="op" id="2953507">[</span><span class="ident" id="2953508"><a href="/gostd/strings/replace.go.html#2952638">r</a></span><span class="op" id="2953509">.</span><span class="ident" id="2953510"><a href="/gostd/strings/replace.go.html#2955285">mapping</a></span><span class="op" id="2953517">[</span><span class="ident" id="2953518"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2953519">.</span><span class="ident" id="2953520"><a href="/gostd/strings/replace.go.html#2952074">prefix</a></span><span class="op" id="2953526">[</span><span class="num" id="2953527">0</span><span class="op" id="2953528">]</span><span class="op" id="2953529">]</span><span class="op" id="2953530">]</span>&nbsp;<span class="op" id="2953532">=</span>&nbsp;<span class="ident" id="2953534"><a href="/gostd/strings/replace.go.html#2953254">prefixNode</a></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953548"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2953549">.</span><span class="ident" id="2953550"><a href="/gostd/strings/replace.go.html#2952563">table</a></span><span class="op" id="2953555">[</span><span class="ident" id="2953556"><a href="/gostd/strings/replace.go.html#2952638">r</a></span><span class="op" id="2953557">.</span><span class="ident" id="2953558"><a href="/gostd/strings/replace.go.html#2955285">mapping</a></span><span class="op" id="2953565">[</span><span class="ident" id="2953566"><a href="/gostd/strings/replace.go.html#2952607">key</a></span><span class="op" id="2953569">[</span><span class="num" id="2953570">0</span><span class="op" id="2953571">]</span><span class="op" id="2953572">]</span><span class="op" id="2953573">]</span>&nbsp;<span class="op" id="2953575">=</span>&nbsp;<span class="ident" id="2953577"><a href="/gostd/strings/replace.go.html#2953428">keyNode</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953588"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2953589">.</span><span class="ident" id="2953590"><a href="/gostd/strings/replace.go.html#2952074">prefix</a></span>&nbsp;<span class="op" id="2953597">=</span>&nbsp;<span class="string" id="2953599">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953605"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2953606">.</span><span class="ident" id="2953607"><a href="/gostd/strings/replace.go.html#2952089">next</a></span>&nbsp;<span class="op" id="2953612">=</span>&nbsp;<span class="builtintype" id="2953614">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953621"><a href="/gostd/strings/replace.go.html#2953428">keyNode</a></span><span class="op" id="2953628">.</span><span class="ident" id="2953629"><a href="/gostd/strings/replace.go.html#2952603">add</a></span><span class="op" id="2953632">(</span><span class="ident" id="2953633"><a href="/gostd/strings/replace.go.html#2952607">key</a></span><span class="op" id="2953636">[</span><span class="num" id="2953637">1</span><span class="op" id="2953638">:</span><span class="op" id="2953639">]</span><span class="op" id="2953640">,</span>&nbsp;<span class="ident" id="2953642"><a href="/gostd/strings/replace.go.html#2952612">val</a></span><span class="op" id="2953645">,</span>&nbsp;<span class="ident" id="2953647"><a href="/gostd/strings/replace.go.html#2952624">priority</a></span><span class="op" id="2953655">,</span>&nbsp;<span class="ident" id="2953657"><a href="/gostd/strings/replace.go.html#2952638">r</a></span><span class="op" id="2953658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2953662">}</span>&nbsp;<span class="keyword" id="2953664">else</span>&nbsp;<span class="op" id="2953669">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2953674">//&nbsp;Insert&nbsp;new&nbsp;node&nbsp;after&nbsp;the&nbsp;common&nbsp;section&nbsp;of&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953736">next</span>&nbsp;<span class="op" id="2953741">:=</span>&nbsp;<span class="op" id="2953744">&amp;</span><span class="ident" id="2953745"><a href="/gostd/strings/replace.go.html#2950982">trieNode</a></span><span class="op" id="2953753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953759"><a href="/gostd/strings/replace.go.html#2952074">prefix</a></span><span class="op" id="2953765">:</span>&nbsp;<span class="ident" id="2953767"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2953768">.</span><span class="ident" id="2953769"><a href="/gostd/strings/replace.go.html#2952074">prefix</a></span><span class="op" id="2953775">[</span><span class="ident" id="2953776"><a href="/gostd/strings/replace.go.html#2952837">n</a></span><span class="op" id="2953777">:</span><span class="op" id="2953778">]</span><span class="op" id="2953779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953785"><a href="/gostd/strings/replace.go.html#2952089">next</a></span><span class="op" id="2953789">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2953793"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2953794">.</span><span class="ident" id="2953795"><a href="/gostd/strings/replace.go.html#2952089">next</a></span><span class="op" id="2953799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2953804">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953809"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2953810">.</span><span class="ident" id="2953811"><a href="/gostd/strings/replace.go.html#2952074">prefix</a></span>&nbsp;<span class="op" id="2953818">=</span>&nbsp;<span class="ident" id="2953820"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2953821">.</span><span class="ident" id="2953822"><a href="/gostd/strings/replace.go.html#2952074">prefix</a></span><span class="op" id="2953828">[</span><span class="op" id="2953829">:</span><span class="ident" id="2953830"><a href="/gostd/strings/replace.go.html#2952837">n</a></span><span class="op" id="2953831">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953836"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2953837">.</span><span class="ident" id="2953838"><a href="/gostd/strings/replace.go.html#2952089">next</a></span>&nbsp;<span class="op" id="2953843">=</span>&nbsp;<span class="ident" id="2953845"><a href="/gostd/strings/replace.go.html#2953736">next</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953853"><a href="/gostd/strings/replace.go.html#2953736">next</a></span><span class="op" id="2953857">.</span><span class="ident" id="2953858"><a href="/gostd/strings/replace.go.html#2952603">add</a></span><span class="op" id="2953861">(</span><span class="ident" id="2953862"><a href="/gostd/strings/replace.go.html#2952607">key</a></span><span class="op" id="2953865">[</span><span class="ident" id="2953866"><a href="/gostd/strings/replace.go.html#2952837">n</a></span><span class="op" id="2953867">:</span><span class="op" id="2953868">]</span><span class="op" id="2953869">,</span>&nbsp;<span class="ident" id="2953871"><a href="/gostd/strings/replace.go.html#2952612">val</a></span><span class="op" id="2953874">,</span>&nbsp;<span class="ident" id="2953876"><a href="/gostd/strings/replace.go.html#2952624">priority</a></span><span class="op" id="2953884">,</span>&nbsp;<span class="ident" id="2953886"><a href="/gostd/strings/replace.go.html#2952638">r</a></span><span class="op" id="2953887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2953891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2953894">}</span>&nbsp;<span class="keyword" id="2953896">else</span>&nbsp;<span class="keyword" id="2953901">if</span>&nbsp;<span class="ident" id="2953904"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2953905">.</span><span class="ident" id="2953906"><a href="/gostd/strings/replace.go.html#2952563">table</a></span>&nbsp;<span class="op" id="2953912">!=</span>&nbsp;<span class="builtintype" id="2953915">nil</span>&nbsp;<span class="op" id="2953919">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2953923">//&nbsp;Insert&nbsp;into&nbsp;existing&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953956">m</span>&nbsp;<span class="op" id="2953958">:=</span>&nbsp;<span class="ident" id="2953961"><a href="/gostd/strings/replace.go.html#2952638">r</a></span><span class="op" id="2953962">.</span><span class="ident" id="2953963"><a href="/gostd/strings/replace.go.html#2955285">mapping</a></span><span class="op" id="2953970">[</span><span class="ident" id="2953971"><a href="/gostd/strings/replace.go.html#2952607">key</a></span><span class="op" id="2953974">[</span><span class="num" id="2953975">0</span><span class="op" id="2953976">]</span><span class="op" id="2953977">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2953981">if</span>&nbsp;<span class="ident" id="2953984"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2953985">.</span><span class="ident" id="2953986"><a href="/gostd/strings/replace.go.html#2952563">table</a></span><span class="op" id="2953991">[</span><span class="ident" id="2953992"><a href="/gostd/strings/replace.go.html#2953956">m</a></span><span class="op" id="2953993">]</span>&nbsp;<span class="op" id="2953995">==</span>&nbsp;<span class="builtintype" id="2953998">nil</span>&nbsp;<span class="op" id="2954002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954007"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2954008">.</span><span class="ident" id="2954009"><a href="/gostd/strings/replace.go.html#2952563">table</a></span><span class="op" id="2954014">[</span><span class="ident" id="2954015"><a href="/gostd/strings/replace.go.html#2953956">m</a></span><span class="op" id="2954016">]</span>&nbsp;<span class="op" id="2954018">=</span>&nbsp;<span class="builtinfunc" id="2954020">new</span><span class="op" id="2954023">(</span><span class="ident" id="2954024"><a href="/gostd/strings/replace.go.html#2950982">trieNode</a></span><span class="op" id="2954032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2954036">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954040"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2954041">.</span><span class="ident" id="2954042"><a href="/gostd/strings/replace.go.html#2952563">table</a></span><span class="op" id="2954047">[</span><span class="ident" id="2954048"><a href="/gostd/strings/replace.go.html#2953956">m</a></span><span class="op" id="2954049">]</span><span class="op" id="2954050">.</span><span class="ident" id="2954051"><a href="/gostd/strings/replace.go.html#2952603">add</a></span><span class="op" id="2954054">(</span><span class="ident" id="2954055"><a href="/gostd/strings/replace.go.html#2952607">key</a></span><span class="op" id="2954058">[</span><span class="num" id="2954059">1</span><span class="op" id="2954060">:</span><span class="op" id="2954061">]</span><span class="op" id="2954062">,</span>&nbsp;<span class="ident" id="2954064"><a href="/gostd/strings/replace.go.html#2952612">val</a></span><span class="op" id="2954067">,</span>&nbsp;<span class="ident" id="2954069"><a href="/gostd/strings/replace.go.html#2952624">priority</a></span><span class="op" id="2954077">,</span>&nbsp;<span class="ident" id="2954079"><a href="/gostd/strings/replace.go.html#2952638">r</a></span><span class="op" id="2954080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2954083">}</span>&nbsp;<span class="keyword" id="2954085">else</span>&nbsp;<span class="op" id="2954090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954094"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2954095">.</span><span class="ident" id="2954096"><a href="/gostd/strings/replace.go.html#2952074">prefix</a></span>&nbsp;<span class="op" id="2954103">=</span>&nbsp;<span class="ident" id="2954105"><a href="/gostd/strings/replace.go.html#2952607">key</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954111"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2954112">.</span><span class="ident" id="2954113"><a href="/gostd/strings/replace.go.html#2952089">next</a></span>&nbsp;<span class="op" id="2954118">=</span>&nbsp;<span class="builtinfunc" id="2954120">new</span><span class="op" id="2954123">(</span><span class="ident" id="2954124"><a href="/gostd/strings/replace.go.html#2950982">trieNode</a></span><span class="op" id="2954132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954136"><a href="/gostd/strings/replace.go.html#2952590">t</a></span><span class="op" id="2954137">.</span><span class="ident" id="2954138"><a href="/gostd/strings/replace.go.html#2952089">next</a></span><span class="op" id="2954142">.</span><span class="ident" id="2954143"><a href="/gostd/strings/replace.go.html#2952603">add</a></span><span class="op" id="2954146">(</span><span class="string" id="2954147">&#34;&#34;</span><span class="op" id="2954149">,</span>&nbsp;<span class="ident" id="2954151"><a href="/gostd/strings/replace.go.html#2952612">val</a></span><span class="op" id="2954154">,</span>&nbsp;<span class="ident" id="2954156"><a href="/gostd/strings/replace.go.html#2952624">priority</a></span><span class="op" id="2954164">,</span>&nbsp;<span class="ident" id="2954166"><a href="/gostd/strings/replace.go.html#2952638">r</a></span><span class="op" id="2954167">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2954170">}</span><br>
<span class="lineno"></span><span class="op" id="2954172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2954175">func</span>&nbsp;<span class="op" id="2954180">(</span><span class="ident" id="2954181">r</span>&nbsp;<span class="op" id="2954183">*</span><span class="ident" id="2954184"><a href="/gostd/strings/replace.go.html#2955061">genericReplacer</a></span><span class="op" id="2954199">)</span>&nbsp;<span class="ident" id="2954201">lookup</span><span class="op" id="2954207">(</span><span class="ident" id="2954208">s</span>&nbsp;<span class="builtintype" id="2954210">string</span><span class="op" id="2954216">,</span>&nbsp;<span class="ident" id="2954218">ignoreRoot</span>&nbsp;<span class="builtintype" id="2954229">bool</span><span class="op" id="2954233">)</span>&nbsp;<span class="op" id="2954235">(</span><span class="ident" id="2954236">val</span>&nbsp;<span class="builtintype" id="2954240">string</span><span class="op" id="2954246">,</span>&nbsp;<span class="ident" id="2954248">keylen</span>&nbsp;<span class="builtintype" id="2954255">int</span><span class="op" id="2954258">,</span>&nbsp;<span class="ident" id="2954260">found</span>&nbsp;<span class="builtintype" id="2954266">bool</span><span class="op" id="2954270">)</span>&nbsp;<span class="op" id="2954272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2954275">//&nbsp;Iterate&nbsp;down&nbsp;the&nbsp;trie&nbsp;to&nbsp;the&nbsp;end,&nbsp;and&nbsp;grab&nbsp;the&nbsp;value&nbsp;and&nbsp;keylen&nbsp;with</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2954348">//&nbsp;the&nbsp;highest&nbsp;priority.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954374">bestPriority</span>&nbsp;<span class="op" id="2954387">:=</span>&nbsp;<span class="num" id="2954390">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954393">node</span>&nbsp;<span class="op" id="2954398">:=</span>&nbsp;<span class="op" id="2954401">&amp;</span><span class="ident" id="2954402"><a href="/gostd/strings/replace.go.html#2954181">r</a></span><span class="op" id="2954403">.</span><span class="ident" id="2954404"><a href="/gostd/strings/replace.go.html#2955087">root</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954410">n</span>&nbsp;<span class="op" id="2954412">:=</span>&nbsp;<span class="num" id="2954415">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2954418">for</span>&nbsp;<span class="ident" id="2954422"><a href="/gostd/strings/replace.go.html#2954393">node</a></span>&nbsp;<span class="op" id="2954427">!=</span>&nbsp;<span class="builtintype" id="2954430">nil</span>&nbsp;<span class="op" id="2954434">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2954438">if</span>&nbsp;<span class="ident" id="2954441"><a href="/gostd/strings/replace.go.html#2954393">node</a></span><span class="op" id="2954445">.</span><span class="ident" id="2954446"><a href="/gostd/strings/replace.go.html#2951453">priority</a></span>&nbsp;<span class="op" id="2954455">&gt;</span>&nbsp;<span class="ident" id="2954457"><a href="/gostd/strings/replace.go.html#2954374">bestPriority</a></span>&nbsp;<span class="op" id="2954470">&amp;&amp;</span>&nbsp;<span class="op" id="2954473">!</span><span class="op" id="2954474">(</span><span class="ident" id="2954475"><a href="/gostd/strings/replace.go.html#2954218">ignoreRoot</a></span>&nbsp;<span class="op" id="2954486">&amp;&amp;</span>&nbsp;<span class="ident" id="2954489"><a href="/gostd/strings/replace.go.html#2954393">node</a></span>&nbsp;<span class="op" id="2954494">==</span>&nbsp;<span class="op" id="2954497">&amp;</span><span class="ident" id="2954498"><a href="/gostd/strings/replace.go.html#2954181">r</a></span><span class="op" id="2954499">.</span><span class="ident" id="2954500"><a href="/gostd/strings/replace.go.html#2955087">root</a></span><span class="op" id="2954504">)</span>&nbsp;<span class="op" id="2954506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954511"><a href="/gostd/strings/replace.go.html#2954374">bestPriority</a></span>&nbsp;<span class="op" id="2954524">=</span>&nbsp;<span class="ident" id="2954526"><a href="/gostd/strings/replace.go.html#2954393">node</a></span><span class="op" id="2954530">.</span><span class="ident" id="2954531"><a href="/gostd/strings/replace.go.html#2951453">priority</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954543"><a href="/gostd/strings/replace.go.html#2954236">val</a></span>&nbsp;<span class="op" id="2954547">=</span>&nbsp;<span class="ident" id="2954549"><a href="/gostd/strings/replace.go.html#2954393">node</a></span><span class="op" id="2954553">.</span><span class="ident" id="2954554"><a href="/gostd/strings/replace.go.html#2951111">value</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954563"><a href="/gostd/strings/replace.go.html#2954248">keylen</a></span>&nbsp;<span class="op" id="2954570">=</span>&nbsp;<span class="ident" id="2954572"><a href="/gostd/strings/replace.go.html#2954410">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954577"><a href="/gostd/strings/replace.go.html#2954260">found</a></span>&nbsp;<span class="op" id="2954583">=</span>&nbsp;<span class="builtintype" id="2954585">true</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2954592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2954597">if</span>&nbsp;<span class="ident" id="2954600"><a href="/gostd/strings/replace.go.html#2954208">s</a></span>&nbsp;<span class="op" id="2954602">==</span>&nbsp;<span class="string" id="2954605">&#34;&#34;</span>&nbsp;<span class="op" id="2954608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2954613">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2954621">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2954625">if</span>&nbsp;<span class="ident" id="2954628"><a href="/gostd/strings/replace.go.html#2954393">node</a></span><span class="op" id="2954632">.</span><span class="ident" id="2954633"><a href="/gostd/strings/replace.go.html#2952563">table</a></span>&nbsp;<span class="op" id="2954639">!=</span>&nbsp;<span class="builtintype" id="2954642">nil</span>&nbsp;<span class="op" id="2954646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954651">index</span>&nbsp;<span class="op" id="2954657">:=</span>&nbsp;<span class="ident" id="2954660"><a href="/gostd/strings/replace.go.html#2954181">r</a></span><span class="op" id="2954661">.</span><span class="ident" id="2954662"><a href="/gostd/strings/replace.go.html#2955285">mapping</a></span><span class="op" id="2954669">[</span><span class="ident" id="2954670"><a href="/gostd/strings/replace.go.html#2954208">s</a></span><span class="op" id="2954671">[</span><span class="num" id="2954672">0</span><span class="op" id="2954673">]</span><span class="op" id="2954674">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2954679">if</span>&nbsp;<span class="builtintype" id="2954682">int</span><span class="op" id="2954685">(</span><span class="ident" id="2954686"><a href="/gostd/strings/replace.go.html#2954651">index</a></span><span class="op" id="2954691">)</span>&nbsp;<span class="op" id="2954693">==</span>&nbsp;<span class="ident" id="2954696"><a href="/gostd/strings/replace.go.html#2954181">r</a></span><span class="op" id="2954697">.</span><span class="ident" id="2954698"><a href="/gostd/strings/replace.go.html#2955201">tableSize</a></span>&nbsp;<span class="op" id="2954708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2954714">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2954723">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954728"><a href="/gostd/strings/replace.go.html#2954393">node</a></span>&nbsp;<span class="op" id="2954733">=</span>&nbsp;<span class="ident" id="2954735"><a href="/gostd/strings/replace.go.html#2954393">node</a></span><span class="op" id="2954739">.</span><span class="ident" id="2954740"><a href="/gostd/strings/replace.go.html#2952563">table</a></span><span class="op" id="2954745">[</span><span class="ident" id="2954746"><a href="/gostd/strings/replace.go.html#2954651">index</a></span><span class="op" id="2954751">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954756"><a href="/gostd/strings/replace.go.html#2954208">s</a></span>&nbsp;<span class="op" id="2954758">=</span>&nbsp;<span class="ident" id="2954760"><a href="/gostd/strings/replace.go.html#2954208">s</a></span><span class="op" id="2954761">[</span><span class="num" id="2954762">1</span><span class="op" id="2954763">:</span><span class="op" id="2954764">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954769"><a href="/gostd/strings/replace.go.html#2954410">n</a></span><span class="op" id="2954770">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2954775">}</span>&nbsp;<span class="keyword" id="2954777">else</span>&nbsp;<span class="keyword" id="2954782">if</span>&nbsp;<span class="ident" id="2954785"><a href="/gostd/strings/replace.go.html#2954393">node</a></span><span class="op" id="2954789">.</span><span class="ident" id="2954790"><a href="/gostd/strings/replace.go.html#2952074">prefix</a></span>&nbsp;<span class="op" id="2954797">!=</span>&nbsp;<span class="string" id="2954800">&#34;&#34;</span>&nbsp;<span class="op" id="2954803">&amp;&amp;</span>&nbsp;<span class="ident" id="2954806"><a href="/gostd/strings/strings.go.html#2975366">HasPrefix</a></span><span class="op" id="2954815">(</span><span class="ident" id="2954816"><a href="/gostd/strings/replace.go.html#2954208">s</a></span><span class="op" id="2954817">,</span>&nbsp;<span class="ident" id="2954819"><a href="/gostd/strings/replace.go.html#2954393">node</a></span><span class="op" id="2954823">.</span><span class="ident" id="2954824"><a href="/gostd/strings/replace.go.html#2952074">prefix</a></span><span class="op" id="2954830">)</span>&nbsp;<span class="op" id="2954832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954837"><a href="/gostd/strings/replace.go.html#2954410">n</a></span>&nbsp;<span class="op" id="2954839">+=</span>&nbsp;<span class="builtinfunc" id="2954842">len</span><span class="op" id="2954845">(</span><span class="ident" id="2954846"><a href="/gostd/strings/replace.go.html#2954393">node</a></span><span class="op" id="2954850">.</span><span class="ident" id="2954851"><a href="/gostd/strings/replace.go.html#2952074">prefix</a></span><span class="op" id="2954857">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954862"><a href="/gostd/strings/replace.go.html#2954208">s</a></span>&nbsp;<span class="op" id="2954864">=</span>&nbsp;<span class="ident" id="2954866"><a href="/gostd/strings/replace.go.html#2954208">s</a></span><span class="op" id="2954867">[</span><span class="builtinfunc" id="2954868">len</span><span class="op" id="2954871">(</span><span class="ident" id="2954872"><a href="/gostd/strings/replace.go.html#2954393">node</a></span><span class="op" id="2954876">.</span><span class="ident" id="2954877"><a href="/gostd/strings/replace.go.html#2952074">prefix</a></span><span class="op" id="2954883">)</span><span class="op" id="2954884">:</span><span class="op" id="2954885">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954890"><a href="/gostd/strings/replace.go.html#2954393">node</a></span>&nbsp;<span class="op" id="2954895">=</span>&nbsp;<span class="ident" id="2954897"><a href="/gostd/strings/replace.go.html#2954393">node</a></span><span class="op" id="2954901">.</span><span class="ident" id="2954902"><a href="/gostd/strings/replace.go.html#2952089">next</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2954909">}</span>&nbsp;<span class="keyword" id="2954911">else</span>&nbsp;<span class="op" id="2954916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2954921">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2954929">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2954932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2954935">return</span><br>
<span class="lineno"></span><span class="op" id="2954942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2954945">//&nbsp;genericReplacer&nbsp;is&nbsp;the&nbsp;fully&nbsp;generic&nbsp;algorithm.</span><br>
<span class="lineno">230</span><span class="comment" id="2954996">//&nbsp;It&#39;s&nbsp;used&nbsp;as&nbsp;a&nbsp;fallback&nbsp;when&nbsp;nothing&nbsp;faster&nbsp;can&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="2955056">type</span>&nbsp;<span class="ident" id="2955061">genericReplacer</span>&nbsp;<span class="keyword" id="2955077">struct</span>&nbsp;<span class="op" id="2955084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955087">root</span>&nbsp;<span class="ident" id="2955092"><a href="/gostd/strings/replace.go.html#2950982">trieNode</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2955102">//&nbsp;tableSize&nbsp;is&nbsp;the&nbsp;size&nbsp;of&nbsp;a&nbsp;trie&nbsp;node&#39;s&nbsp;lookup&nbsp;table.&nbsp;It&nbsp;is&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2955176">//&nbsp;of&nbsp;unique&nbsp;key&nbsp;bytes.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955201">tableSize</span>&nbsp;<span class="builtintype" id="2955211">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2955216">//&nbsp;mapping&nbsp;maps&nbsp;from&nbsp;key&nbsp;bytes&nbsp;to&nbsp;a&nbsp;dense&nbsp;index&nbsp;for&nbsp;trieNode.table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955285">mapping</span>&nbsp;<span class="op" id="2955293">[</span><span class="num" id="2955294">256</span><span class="op" id="2955297">]</span><span class="builtintype" id="2955298">byte</span><br>
<span class="lineno"></span><span class="op" id="2955303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="2955306">func</span>&nbsp;<span class="ident" id="2955311">makeGenericReplacer</span><span class="op" id="2955330">(</span><span class="ident" id="2955331">oldnew</span>&nbsp;<span class="op" id="2955338">[</span><span class="op" id="2955339">]</span><span class="builtintype" id="2955340">string</span><span class="op" id="2955346">)</span>&nbsp;<span class="op" id="2955348">*</span><span class="ident" id="2955349"><a href="/gostd/strings/replace.go.html#2955061">genericReplacer</a></span>&nbsp;<span class="op" id="2955365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955368">r</span>&nbsp;<span class="op" id="2955370">:=</span>&nbsp;<span class="builtinfunc" id="2955373">new</span><span class="op" id="2955376">(</span><span class="ident" id="2955377"><a href="/gostd/strings/replace.go.html#2955061">genericReplacer</a></span><span class="op" id="2955392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2955395">//&nbsp;Find&nbsp;each&nbsp;byte&nbsp;used,&nbsp;then&nbsp;assign&nbsp;them&nbsp;each&nbsp;an&nbsp;index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2955452">for</span>&nbsp;<span class="ident" id="2955456">i</span>&nbsp;<span class="op" id="2955458">:=</span>&nbsp;<span class="num" id="2955461">0</span><span class="op" id="2955462">;</span>&nbsp;<span class="ident" id="2955464"><a href="/gostd/strings/replace.go.html#2955456">i</a></span>&nbsp;<span class="op" id="2955466">&lt;</span>&nbsp;<span class="builtinfunc" id="2955468">len</span><span class="op" id="2955471">(</span><span class="ident" id="2955472"><a href="/gostd/strings/replace.go.html#2955331">oldnew</a></span><span class="op" id="2955478">)</span><span class="op" id="2955479">;</span>&nbsp;<span class="ident" id="2955481"><a href="/gostd/strings/replace.go.html#2955456">i</a></span>&nbsp;<span class="op" id="2955483">+=</span>&nbsp;<span class="num" id="2955486">2</span>&nbsp;<span class="op" id="2955488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955492">key</span>&nbsp;<span class="op" id="2955496">:=</span>&nbsp;<span class="ident" id="2955499"><a href="/gostd/strings/replace.go.html#2955331">oldnew</a></span><span class="op" id="2955505">[</span><span class="ident" id="2955506"><a href="/gostd/strings/replace.go.html#2955456">i</a></span><span class="op" id="2955507">]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2955511">for</span>&nbsp;<span class="ident" id="2955515">j</span>&nbsp;<span class="op" id="2955517">:=</span>&nbsp;<span class="num" id="2955520">0</span><span class="op" id="2955521">;</span>&nbsp;<span class="ident" id="2955523"><a href="/gostd/strings/replace.go.html#2955515">j</a></span>&nbsp;<span class="op" id="2955525">&lt;</span>&nbsp;<span class="builtinfunc" id="2955527">len</span><span class="op" id="2955530">(</span><span class="ident" id="2955531"><a href="/gostd/strings/replace.go.html#2955492">key</a></span><span class="op" id="2955534">)</span><span class="op" id="2955535">;</span>&nbsp;<span class="ident" id="2955537"><a href="/gostd/strings/replace.go.html#2955515">j</a></span><span class="op" id="2955538">++</span>&nbsp;<span class="op" id="2955541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955546"><a href="/gostd/strings/replace.go.html#2955368">r</a></span><span class="op" id="2955547">.</span><span class="ident" id="2955548"><a href="/gostd/strings/replace.go.html#2955285">mapping</a></span><span class="op" id="2955555">[</span><span class="ident" id="2955556"><a href="/gostd/strings/replace.go.html#2955492">key</a></span><span class="op" id="2955559">[</span><span class="ident" id="2955560"><a href="/gostd/strings/replace.go.html#2955515">j</a></span><span class="op" id="2955561">]</span><span class="op" id="2955562">]</span>&nbsp;<span class="op" id="2955564">=</span>&nbsp;<span class="num" id="2955566">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2955570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2955573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2955577">for</span>&nbsp;<span class="ident" id="2955581">_</span><span class="op" id="2955582">,</span>&nbsp;<span class="ident" id="2955584">b</span>&nbsp;<span class="op" id="2955586">:=</span>&nbsp;<span class="keyword" id="2955589">range</span>&nbsp;<span class="ident" id="2955595"><a href="/gostd/strings/replace.go.html#2955368">r</a></span><span class="op" id="2955596">.</span><span class="ident" id="2955597"><a href="/gostd/strings/replace.go.html#2955285">mapping</a></span>&nbsp;<span class="op" id="2955605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955609"><a href="/gostd/strings/replace.go.html#2955368">r</a></span><span class="op" id="2955610">.</span><span class="ident" id="2955611"><a href="/gostd/strings/replace.go.html#2955201">tableSize</a></span>&nbsp;<span class="op" id="2955621">+=</span>&nbsp;<span class="builtintype" id="2955624">int</span><span class="op" id="2955627">(</span><span class="ident" id="2955628"><a href="/gostd/strings/replace.go.html#2955584">b</a></span><span class="op" id="2955629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2955632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2955636">var</span>&nbsp;<span class="ident" id="2955640">index</span>&nbsp;<span class="builtintype" id="2955646">byte</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2955652">for</span>&nbsp;<span class="ident" id="2955656">i</span><span class="op" id="2955657">,</span>&nbsp;<span class="ident" id="2955659">b</span>&nbsp;<span class="op" id="2955661">:=</span>&nbsp;<span class="keyword" id="2955664">range</span>&nbsp;<span class="ident" id="2955670"><a href="/gostd/strings/replace.go.html#2955368">r</a></span><span class="op" id="2955671">.</span><span class="ident" id="2955672"><a href="/gostd/strings/replace.go.html#2955285">mapping</a></span>&nbsp;<span class="op" id="2955680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2955684">if</span>&nbsp;<span class="ident" id="2955687"><a href="/gostd/strings/replace.go.html#2955659">b</a></span>&nbsp;<span class="op" id="2955689">==</span>&nbsp;<span class="num" id="2955692">0</span>&nbsp;<span class="op" id="2955694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955699"><a href="/gostd/strings/replace.go.html#2955368">r</a></span><span class="op" id="2955700">.</span><span class="ident" id="2955701"><a href="/gostd/strings/replace.go.html#2955285">mapping</a></span><span class="op" id="2955708">[</span><span class="ident" id="2955709"><a href="/gostd/strings/replace.go.html#2955656">i</a></span><span class="op" id="2955710">]</span>&nbsp;<span class="op" id="2955712">=</span>&nbsp;<span class="builtintype" id="2955714">byte</span><span class="op" id="2955718">(</span><span class="ident" id="2955719"><a href="/gostd/strings/replace.go.html#2955368">r</a></span><span class="op" id="2955720">.</span><span class="ident" id="2955721"><a href="/gostd/strings/replace.go.html#2955201">tableSize</a></span><span class="op" id="2955730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2955734">}</span>&nbsp;<span class="keyword" id="2955736">else</span>&nbsp;<span class="op" id="2955741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955746"><a href="/gostd/strings/replace.go.html#2955368">r</a></span><span class="op" id="2955747">.</span><span class="ident" id="2955748"><a href="/gostd/strings/replace.go.html#2955285">mapping</a></span><span class="op" id="2955755">[</span><span class="ident" id="2955756"><a href="/gostd/strings/replace.go.html#2955656">i</a></span><span class="op" id="2955757">]</span>&nbsp;<span class="op" id="2955759">=</span>&nbsp;<span class="ident" id="2955761"><a href="/gostd/strings/replace.go.html#2955640">index</a></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955770"><a href="/gostd/strings/replace.go.html#2955640">index</a></span><span class="op" id="2955775">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2955780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2955783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2955786">//&nbsp;Ensure&nbsp;root&nbsp;node&nbsp;uses&nbsp;a&nbsp;lookup&nbsp;table&nbsp;(for&nbsp;performance).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955846"><a href="/gostd/strings/replace.go.html#2955368">r</a></span><span class="op" id="2955847">.</span><span class="ident" id="2955848"><a href="/gostd/strings/replace.go.html#2955087">root</a></span><span class="op" id="2955852">.</span><span class="ident" id="2955853"><a href="/gostd/strings/replace.go.html#2952563">table</a></span>&nbsp;<span class="op" id="2955859">=</span>&nbsp;<span class="builtinfunc" id="2955861">make</span><span class="op" id="2955865">(</span><span class="op" id="2955866">[</span><span class="op" id="2955867">]</span><span class="op" id="2955868">*</span><span class="ident" id="2955869"><a href="/gostd/strings/replace.go.html#2950982">trieNode</a></span><span class="op" id="2955877">,</span>&nbsp;<span class="ident" id="2955879"><a href="/gostd/strings/replace.go.html#2955368">r</a></span><span class="op" id="2955880">.</span><span class="ident" id="2955881"><a href="/gostd/strings/replace.go.html#2955201">tableSize</a></span><span class="op" id="2955890">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2955894">for</span>&nbsp;<span class="ident" id="2955898">i</span>&nbsp;<span class="op" id="2955900">:=</span>&nbsp;<span class="num" id="2955903">0</span><span class="op" id="2955904">;</span>&nbsp;<span class="ident" id="2955906"><a href="/gostd/strings/replace.go.html#2955898">i</a></span>&nbsp;<span class="op" id="2955908">&lt;</span>&nbsp;<span class="builtinfunc" id="2955910">len</span><span class="op" id="2955913">(</span><span class="ident" id="2955914"><a href="/gostd/strings/replace.go.html#2955331">oldnew</a></span><span class="op" id="2955920">)</span><span class="op" id="2955921">;</span>&nbsp;<span class="ident" id="2955923"><a href="/gostd/strings/replace.go.html#2955898">i</a></span>&nbsp;<span class="op" id="2955925">+=</span>&nbsp;<span class="num" id="2955928">2</span>&nbsp;<span class="op" id="2955930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955934"><a href="/gostd/strings/replace.go.html#2955368">r</a></span><span class="op" id="2955935">.</span><span class="ident" id="2955936"><a href="/gostd/strings/replace.go.html#2955087">root</a></span><span class="op" id="2955940">.</span><span class="ident" id="2955941"><a href="/gostd/strings/replace.go.html#2952603">add</a></span><span class="op" id="2955944">(</span><span class="ident" id="2955945"><a href="/gostd/strings/replace.go.html#2955331">oldnew</a></span><span class="op" id="2955951">[</span><span class="ident" id="2955952"><a href="/gostd/strings/replace.go.html#2955898">i</a></span><span class="op" id="2955953">]</span><span class="op" id="2955954">,</span>&nbsp;<span class="ident" id="2955956"><a href="/gostd/strings/replace.go.html#2955331">oldnew</a></span><span class="op" id="2955962">[</span><span class="ident" id="2955963"><a href="/gostd/strings/replace.go.html#2955898">i</a></span><span class="op" id="2955964">+</span><span class="num" id="2955965">1</span><span class="op" id="2955966">]</span><span class="op" id="2955967">,</span>&nbsp;<span class="builtinfunc" id="2955969">len</span><span class="op" id="2955972">(</span><span class="ident" id="2955973"><a href="/gostd/strings/replace.go.html#2955331">oldnew</a></span><span class="op" id="2955979">)</span><span class="op" id="2955980">-</span><span class="ident" id="2955981"><a href="/gostd/strings/replace.go.html#2955898">i</a></span><span class="op" id="2955982">,</span>&nbsp;<span class="ident" id="2955984"><a href="/gostd/strings/replace.go.html#2955368">r</a></span><span class="op" id="2955985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2955988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2955991">return</span>&nbsp;<span class="ident" id="2955998"><a href="/gostd/strings/replace.go.html#2955368">r</a></span><br>
<span class="lineno">270</span><span class="op" id="2956000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2956003">type</span>&nbsp;<span class="ident" id="2956008">appendSliceWriter</span>&nbsp;<span class="op" id="2956026">[</span><span class="op" id="2956027">]</span><span class="builtintype" id="2956028">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2956034">//&nbsp;Write&nbsp;writes&nbsp;to&nbsp;the&nbsp;buffer&nbsp;to&nbsp;satisfy&nbsp;io.Writer.</span><br>
<span class="lineno">275</span><span class="keyword" id="2956086">func</span>&nbsp;<span class="op" id="2956091">(</span><span class="ident" id="2956092">w</span>&nbsp;<span class="op" id="2956094">*</span><span class="ident" id="2956095"><a href="/gostd/strings/replace.go.html#2956008">appendSliceWriter</a></span><span class="op" id="2956112">)</span>&nbsp;<span class="ident" id="2956114">Write</span><span class="op" id="2956119">(</span><span class="ident" id="2956120">p</span>&nbsp;<span class="op" id="2956122">[</span><span class="op" id="2956123">]</span><span class="builtintype" id="2956124">byte</span><span class="op" id="2956128">)</span>&nbsp;<span class="op" id="2956130">(</span><span class="builtintype" id="2956131">int</span><span class="op" id="2956134">,</span>&nbsp;<span class="builtintype" id="2956136">error</span><span class="op" id="2956141">)</span>&nbsp;<span class="op" id="2956143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2956146">*</span><span class="ident" id="2956147"><a href="/gostd/strings/replace.go.html#2956092">w</a></span>&nbsp;<span class="op" id="2956149">=</span>&nbsp;<span class="builtinfunc" id="2956151">append</span><span class="op" id="2956157">(</span><span class="op" id="2956158">*</span><span class="ident" id="2956159"><a href="/gostd/strings/replace.go.html#2956092">w</a></span><span class="op" id="2956160">,</span>&nbsp;<span class="ident" id="2956162"><a href="/gostd/strings/replace.go.html#2956120">p</a></span><span class="op" id="2956163">...</span><span class="op" id="2956166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2956169">return</span>&nbsp;<span class="builtinfunc" id="2956176">len</span><span class="op" id="2956179">(</span><span class="ident" id="2956180"><a href="/gostd/strings/replace.go.html#2956120">p</a></span><span class="op" id="2956181">)</span><span class="op" id="2956182">,</span>&nbsp;<span class="builtintype" id="2956184">nil</span><br>
<span class="lineno"></span><span class="op" id="2956188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="comment" id="2956191">//&nbsp;WriteString&nbsp;writes&nbsp;to&nbsp;the&nbsp;buffer&nbsp;without&nbsp;string-&gt;[]byte-&gt;string&nbsp;allocations.</span><br>
<span class="lineno"></span><span class="keyword" id="2956271">func</span>&nbsp;<span class="op" id="2956276">(</span><span class="ident" id="2956277">w</span>&nbsp;<span class="op" id="2956279">*</span><span class="ident" id="2956280"><a href="/gostd/strings/replace.go.html#2956008">appendSliceWriter</a></span><span class="op" id="2956297">)</span>&nbsp;<span class="ident" id="2956299">WriteString</span><span class="op" id="2956310">(</span><span class="ident" id="2956311">s</span>&nbsp;<span class="builtintype" id="2956313">string</span><span class="op" id="2956319">)</span>&nbsp;<span class="op" id="2956321">(</span><span class="builtintype" id="2956322">int</span><span class="op" id="2956325">,</span>&nbsp;<span class="builtintype" id="2956327">error</span><span class="op" id="2956332">)</span>&nbsp;<span class="op" id="2956334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2956337">*</span><span class="ident" id="2956338"><a href="/gostd/strings/replace.go.html#2956277">w</a></span>&nbsp;<span class="op" id="2956340">=</span>&nbsp;<span class="builtinfunc" id="2956342">append</span><span class="op" id="2956348">(</span><span class="op" id="2956349">*</span><span class="ident" id="2956350"><a href="/gostd/strings/replace.go.html#2956277">w</a></span><span class="op" id="2956351">,</span>&nbsp;<span class="ident" id="2956353"><a href="/gostd/strings/replace.go.html#2956311">s</a></span><span class="op" id="2956354">...</span><span class="op" id="2956357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2956360">return</span>&nbsp;<span class="builtinfunc" id="2956367">len</span><span class="op" id="2956370">(</span><span class="ident" id="2956371"><a href="/gostd/strings/replace.go.html#2956311">s</a></span><span class="op" id="2956372">)</span><span class="op" id="2956373">,</span>&nbsp;<span class="builtintype" id="2956375">nil</span><br>
<span class="lineno"></span><span class="op" id="2956379">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="2956382">type</span>&nbsp;<span class="ident" id="2956387">stringWriterIface</span>&nbsp;<span class="keyword" id="2956405">interface</span>&nbsp;<span class="op" id="2956415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2956418">WriteString</span><span class="op" id="2956429">(</span><span class="builtintype" id="2956430">string</span><span class="op" id="2956436">)</span>&nbsp;<span class="op" id="2956438">(</span><span class="builtintype" id="2956439">int</span><span class="op" id="2956442">,</span>&nbsp;<span class="builtintype" id="2956444">error</span><span class="op" id="2956449">)</span><br>
<span class="lineno"></span><span class="op" id="2956451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="2956454">type</span>&nbsp;<span class="ident" id="2956459">stringWriter</span>&nbsp;<span class="keyword" id="2956472">struct</span>&nbsp;<span class="op" id="2956479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2956482">w</span>&nbsp;<span class="ident" id="2956484"><a href="/gostd/strings/replace.go.html#2948559">io</a></span><span class="op" id="2956486">.</span><span class="ident" id="2956487"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><br>
<span class="lineno"></span><span class="op" id="2956494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2956497">func</span>&nbsp;<span class="op" id="2956502">(</span><span class="ident" id="2956503">w</span>&nbsp;<span class="ident" id="2956505"><a href="/gostd/strings/replace.go.html#2956459">stringWriter</a></span><span class="op" id="2956517">)</span>&nbsp;<span class="ident" id="2956519">WriteString</span><span class="op" id="2956530">(</span><span class="ident" id="2956531">s</span>&nbsp;<span class="builtintype" id="2956533">string</span><span class="op" id="2956539">)</span>&nbsp;<span class="op" id="2956541">(</span><span class="builtintype" id="2956542">int</span><span class="op" id="2956545">,</span>&nbsp;<span class="builtintype" id="2956547">error</span><span class="op" id="2956552">)</span>&nbsp;<span class="op" id="2956554">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2956557">return</span>&nbsp;<span class="ident" id="2956564"><a href="/gostd/strings/replace.go.html#2956503">w</a></span><span class="op" id="2956565">.</span><span class="ident" id="2956566"><a href="/gostd/strings/replace.go.html#2956482">w</a></span><span class="op" id="2956567">.</span><span class="ident" id="2956568"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="2956573">(</span><span class="op" id="2956574">[</span><span class="op" id="2956575">]</span><span class="builtintype" id="2956576">byte</span><span class="op" id="2956580">(</span><span class="ident" id="2956581"><a href="/gostd/strings/replace.go.html#2956531">s</a></span><span class="op" id="2956582">)</span><span class="op" id="2956583">)</span><br>
<span class="lineno"></span><span class="op" id="2956585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2956588">func</span>&nbsp;<span class="ident" id="2956593">getStringWriter</span><span class="op" id="2956608">(</span><span class="ident" id="2956609">w</span>&nbsp;<span class="ident" id="2956611"><a href="/gostd/strings/replace.go.html#2948559">io</a></span><span class="op" id="2956613">.</span><span class="ident" id="2956614"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="2956620">)</span>&nbsp;<span class="ident" id="2956622"><a href="/gostd/strings/replace.go.html#2956387">stringWriterIface</a></span>&nbsp;<span class="op" id="2956640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2956643">sw</span><span class="op" id="2956645">,</span>&nbsp;<span class="ident" id="2956647">ok</span>&nbsp;<span class="op" id="2956650">:=</span>&nbsp;<span class="ident" id="2956653"><a href="/gostd/strings/replace.go.html#2956609">w</a></span><span class="op" id="2956654">.</span><span class="op" id="2956655">(</span><span class="ident" id="2956656"><a href="/gostd/strings/replace.go.html#2956387">stringWriterIface</a></span><span class="op" id="2956673">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2956676">if</span>&nbsp;<span class="op" id="2956679">!</span><span class="ident" id="2956680"><a href="/gostd/strings/replace.go.html#2956647">ok</a></span>&nbsp;<span class="op" id="2956683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2956687"><a href="/gostd/strings/replace.go.html#2956643">sw</a></span>&nbsp;<span class="op" id="2956690">=</span>&nbsp;<span class="ident" id="2956692"><a href="/gostd/strings/replace.go.html#2956459">stringWriter</a></span><span class="op" id="2956704">{</span><span class="ident" id="2956705"><a href="/gostd/strings/replace.go.html#2956609">w</a></span><span class="op" id="2956706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2956709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2956712">return</span>&nbsp;<span class="ident" id="2956719"><a href="/gostd/strings/replace.go.html#2956643">sw</a></span><br>
<span class="lineno"></span><span class="op" id="2956722">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="keyword" id="2956725">func</span>&nbsp;<span class="op" id="2956730">(</span><span class="ident" id="2956731">r</span>&nbsp;<span class="op" id="2956733">*</span><span class="ident" id="2956734"><a href="/gostd/strings/replace.go.html#2955061">genericReplacer</a></span><span class="op" id="2956749">)</span>&nbsp;<span class="ident" id="2956751">Replace</span><span class="op" id="2956758">(</span><span class="ident" id="2956759">s</span>&nbsp;<span class="builtintype" id="2956761">string</span><span class="op" id="2956767">)</span>&nbsp;<span class="builtintype" id="2956769">string</span>&nbsp;<span class="op" id="2956776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2956779">buf</span>&nbsp;<span class="op" id="2956783">:=</span>&nbsp;<span class="builtinfunc" id="2956786">make</span><span class="op" id="2956790">(</span><span class="ident" id="2956791"><a href="/gostd/strings/replace.go.html#2956008">appendSliceWriter</a></span><span class="op" id="2956808">,</span>&nbsp;<span class="num" id="2956810">0</span><span class="op" id="2956811">,</span>&nbsp;<span class="builtinfunc" id="2956813">len</span><span class="op" id="2956816">(</span><span class="ident" id="2956817"><a href="/gostd/strings/replace.go.html#2956759">s</a></span><span class="op" id="2956818">)</span><span class="op" id="2956819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2956822"><a href="/gostd/strings/replace.go.html#2956731">r</a></span><span class="op" id="2956823">.</span><span class="ident" id="2956824"><a href="/gostd/strings/replace.go.html#2956894">WriteString</a></span><span class="op" id="2956835">(</span><span class="op" id="2956836">&amp;</span><span class="ident" id="2956837"><a href="/gostd/strings/replace.go.html#2956779">buf</a></span><span class="op" id="2956840">,</span>&nbsp;<span class="ident" id="2956842"><a href="/gostd/strings/replace.go.html#2956759">s</a></span><span class="op" id="2956843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2956846">return</span>&nbsp;<span class="builtintype" id="2956853">string</span><span class="op" id="2956859">(</span><span class="ident" id="2956860"><a href="/gostd/strings/replace.go.html#2956779">buf</a></span><span class="op" id="2956863">)</span><br>
<span class="lineno">310</span><span class="op" id="2956865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2956868">func</span>&nbsp;<span class="op" id="2956873">(</span><span class="ident" id="2956874">r</span>&nbsp;<span class="op" id="2956876">*</span><span class="ident" id="2956877"><a href="/gostd/strings/replace.go.html#2955061">genericReplacer</a></span><span class="op" id="2956892">)</span>&nbsp;<span class="ident" id="2956894">WriteString</span><span class="op" id="2956905">(</span><span class="ident" id="2956906">w</span>&nbsp;<span class="ident" id="2956908"><a href="/gostd/strings/replace.go.html#2948559">io</a></span><span class="op" id="2956910">.</span><span class="ident" id="2956911"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="2956917">,</span>&nbsp;<span class="ident" id="2956919">s</span>&nbsp;<span class="builtintype" id="2956921">string</span><span class="op" id="2956927">)</span>&nbsp;<span class="op" id="2956929">(</span><span class="ident" id="2956930">n</span>&nbsp;<span class="builtintype" id="2956932">int</span><span class="op" id="2956935">,</span>&nbsp;<span class="ident" id="2956937">err</span>&nbsp;<span class="builtintype" id="2956941">error</span><span class="op" id="2956946">)</span>&nbsp;<span class="op" id="2956948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2956951">sw</span>&nbsp;<span class="op" id="2956954">:=</span>&nbsp;<span class="ident" id="2956957"><a href="/gostd/strings/replace.go.html#2956593">getStringWriter</a></span><span class="op" id="2956972">(</span><span class="ident" id="2956973"><a href="/gostd/strings/replace.go.html#2956906">w</a></span><span class="op" id="2956974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2956977">var</span>&nbsp;<span class="ident" id="2956981">last</span><span class="op" id="2956985">,</span>&nbsp;<span class="ident" id="2956987">wn</span>&nbsp;<span class="builtintype" id="2956990">int</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2956995">var</span>&nbsp;<span class="ident" id="2956999">prevMatchEmpty</span>&nbsp;<span class="builtintype" id="2957014">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2957020">for</span>&nbsp;<span class="ident" id="2957024">i</span>&nbsp;<span class="op" id="2957026">:=</span>&nbsp;<span class="num" id="2957029">0</span><span class="op" id="2957030">;</span>&nbsp;<span class="ident" id="2957032"><a href="/gostd/strings/replace.go.html#2957024">i</a></span>&nbsp;<span class="op" id="2957034">&lt;=</span>&nbsp;<span class="builtinfunc" id="2957037">len</span><span class="op" id="2957040">(</span><span class="ident" id="2957041"><a href="/gostd/strings/replace.go.html#2956919">s</a></span><span class="op" id="2957042">)</span><span class="op" id="2957043">;</span>&nbsp;<span class="op" id="2957045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2957049">//&nbsp;Fast&nbsp;path:&nbsp;s[i]&nbsp;is&nbsp;not&nbsp;a&nbsp;prefix&nbsp;of&nbsp;any&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2957102">if</span>&nbsp;<span class="ident" id="2957105"><a href="/gostd/strings/replace.go.html#2957024">i</a></span>&nbsp;<span class="op" id="2957107">!=</span>&nbsp;<span class="builtinfunc" id="2957110">len</span><span class="op" id="2957113">(</span><span class="ident" id="2957114"><a href="/gostd/strings/replace.go.html#2956919">s</a></span><span class="op" id="2957115">)</span>&nbsp;<span class="op" id="2957117">&amp;&amp;</span>&nbsp;<span class="ident" id="2957120"><a href="/gostd/strings/replace.go.html#2956874">r</a></span><span class="op" id="2957121">.</span><span class="ident" id="2957122"><a href="/gostd/strings/replace.go.html#2955087">root</a></span><span class="op" id="2957126">.</span><span class="ident" id="2957127"><a href="/gostd/strings/replace.go.html#2951453">priority</a></span>&nbsp;<span class="op" id="2957136">==</span>&nbsp;<span class="num" id="2957139">0</span>&nbsp;<span class="op" id="2957141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2957146">index</span>&nbsp;<span class="op" id="2957152">:=</span>&nbsp;<span class="builtintype" id="2957155">int</span><span class="op" id="2957158">(</span><span class="ident" id="2957159"><a href="/gostd/strings/replace.go.html#2956874">r</a></span><span class="op" id="2957160">.</span><span class="ident" id="2957161"><a href="/gostd/strings/replace.go.html#2955285">mapping</a></span><span class="op" id="2957168">[</span><span class="ident" id="2957169"><a href="/gostd/strings/replace.go.html#2956919">s</a></span><span class="op" id="2957170">[</span><span class="ident" id="2957171"><a href="/gostd/strings/replace.go.html#2957024">i</a></span><span class="op" id="2957172">]</span><span class="op" id="2957173">]</span><span class="op" id="2957174">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2957179">if</span>&nbsp;<span class="ident" id="2957182"><a href="/gostd/strings/replace.go.html#2957146">index</a></span>&nbsp;<span class="op" id="2957188">==</span>&nbsp;<span class="ident" id="2957191"><a href="/gostd/strings/replace.go.html#2956874">r</a></span><span class="op" id="2957192">.</span><span class="ident" id="2957193"><a href="/gostd/strings/replace.go.html#2955201">tableSize</a></span>&nbsp;<span class="op" id="2957203">||</span>&nbsp;<span class="ident" id="2957206"><a href="/gostd/strings/replace.go.html#2956874">r</a></span><span class="op" id="2957207">.</span><span class="ident" id="2957208"><a href="/gostd/strings/replace.go.html#2955087">root</a></span><span class="op" id="2957212">.</span><span class="ident" id="2957213"><a href="/gostd/strings/replace.go.html#2952563">table</a></span><span class="op" id="2957218">[</span><span class="ident" id="2957219"><a href="/gostd/strings/replace.go.html#2957146">index</a></span><span class="op" id="2957224">]</span>&nbsp;<span class="op" id="2957226">==</span>&nbsp;<span class="builtintype" id="2957229">nil</span>&nbsp;<span class="op" id="2957233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2957239"><a href="/gostd/strings/replace.go.html#2957024">i</a></span><span class="op" id="2957240">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2957247">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2957259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2957263">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2957268">//&nbsp;Ignore&nbsp;the&nbsp;empty&nbsp;match&nbsp;iff&nbsp;the&nbsp;previous&nbsp;loop&nbsp;found&nbsp;the&nbsp;empty&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2957341">val</span><span class="op" id="2957344">,</span>&nbsp;<span class="ident" id="2957346">keylen</span><span class="op" id="2957352">,</span>&nbsp;<span class="ident" id="2957354">match</span>&nbsp;<span class="op" id="2957360">:=</span>&nbsp;<span class="ident" id="2957363"><a href="/gostd/strings/replace.go.html#2956874">r</a></span><span class="op" id="2957364">.</span><span class="ident" id="2957365"><a href="/gostd/strings/replace.go.html#2954201">lookup</a></span><span class="op" id="2957371">(</span><span class="ident" id="2957372"><a href="/gostd/strings/replace.go.html#2956919">s</a></span><span class="op" id="2957373">[</span><span class="ident" id="2957374"><a href="/gostd/strings/replace.go.html#2957024">i</a></span><span class="op" id="2957375">:</span><span class="op" id="2957376">]</span><span class="op" id="2957377">,</span>&nbsp;<span class="ident" id="2957379"><a href="/gostd/strings/replace.go.html#2956999">prevMatchEmpty</a></span><span class="op" id="2957393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2957397"><a href="/gostd/strings/replace.go.html#2956999">prevMatchEmpty</a></span>&nbsp;<span class="op" id="2957412">=</span>&nbsp;<span class="ident" id="2957414"><a href="/gostd/strings/replace.go.html#2957354">match</a></span>&nbsp;<span class="op" id="2957420">&amp;&amp;</span>&nbsp;<span class="ident" id="2957423"><a href="/gostd/strings/replace.go.html#2957346">keylen</a></span>&nbsp;<span class="op" id="2957430">==</span>&nbsp;<span class="num" id="2957433">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2957437">if</span>&nbsp;<span class="ident" id="2957440"><a href="/gostd/strings/replace.go.html#2957354">match</a></span>&nbsp;<span class="op" id="2957446">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2957451"><a href="/gostd/strings/replace.go.html#2956987">wn</a></span><span class="op" id="2957453">,</span>&nbsp;<span class="ident" id="2957455"><a href="/gostd/strings/replace.go.html#2956937">err</a></span>&nbsp;<span class="op" id="2957459">=</span>&nbsp;<span class="ident" id="2957461"><a href="/gostd/strings/replace.go.html#2956951">sw</a></span><span class="op" id="2957463">.</span><span class="ident" id="2957464"><a href="/gostd/strings/replace.go.html#2956418">WriteString</a></span><span class="op" id="2957475">(</span><span class="ident" id="2957476"><a href="/gostd/strings/replace.go.html#2956919">s</a></span><span class="op" id="2957477">[</span><span class="ident" id="2957478"><a href="/gostd/strings/replace.go.html#2956981">last</a></span><span class="op" id="2957482">:</span><span class="ident" id="2957483"><a href="/gostd/strings/replace.go.html#2957024">i</a></span><span class="op" id="2957484">]</span><span class="op" id="2957485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2957490"><a href="/gostd/strings/replace.go.html#2956930">n</a></span>&nbsp;<span class="op" id="2957492">+=</span>&nbsp;<span class="ident" id="2957495"><a href="/gostd/strings/replace.go.html#2956987">wn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2957501">if</span>&nbsp;<span class="ident" id="2957504"><a href="/gostd/strings/replace.go.html#2956937">err</a></span>&nbsp;<span class="op" id="2957508">!=</span>&nbsp;<span class="builtintype" id="2957511">nil</span>&nbsp;<span class="op" id="2957515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2957521">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2957531">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2957536"><a href="/gostd/strings/replace.go.html#2956987">wn</a></span><span class="op" id="2957538">,</span>&nbsp;<span class="ident" id="2957540"><a href="/gostd/strings/replace.go.html#2956937">err</a></span>&nbsp;<span class="op" id="2957544">=</span>&nbsp;<span class="ident" id="2957546"><a href="/gostd/strings/replace.go.html#2956951">sw</a></span><span class="op" id="2957548">.</span><span class="ident" id="2957549"><a href="/gostd/strings/replace.go.html#2956418">WriteString</a></span><span class="op" id="2957560">(</span><span class="ident" id="2957561"><a href="/gostd/strings/replace.go.html#2957341">val</a></span><span class="op" id="2957564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2957569"><a href="/gostd/strings/replace.go.html#2956930">n</a></span>&nbsp;<span class="op" id="2957571">+=</span>&nbsp;<span class="ident" id="2957574"><a href="/gostd/strings/replace.go.html#2956987">wn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2957580">if</span>&nbsp;<span class="ident" id="2957583"><a href="/gostd/strings/replace.go.html#2956937">err</a></span>&nbsp;<span class="op" id="2957587">!=</span>&nbsp;<span class="builtintype" id="2957590">nil</span>&nbsp;<span class="op" id="2957594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2957600">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2957610">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2957615"><a href="/gostd/strings/replace.go.html#2957024">i</a></span>&nbsp;<span class="op" id="2957617">+=</span>&nbsp;<span class="ident" id="2957620"><a href="/gostd/strings/replace.go.html#2957346">keylen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2957630"><a href="/gostd/strings/replace.go.html#2956981">last</a></span>&nbsp;<span class="op" id="2957635">=</span>&nbsp;<span class="ident" id="2957637"><a href="/gostd/strings/replace.go.html#2957024">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2957642">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2957653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2957657"><a href="/gostd/strings/replace.go.html#2957024">i</a></span><span class="op" id="2957658">++</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2957662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2957665">if</span>&nbsp;<span class="ident" id="2957668"><a href="/gostd/strings/replace.go.html#2956981">last</a></span>&nbsp;<span class="op" id="2957673">!=</span>&nbsp;<span class="builtinfunc" id="2957676">len</span><span class="op" id="2957679">(</span><span class="ident" id="2957680"><a href="/gostd/strings/replace.go.html#2956919">s</a></span><span class="op" id="2957681">)</span>&nbsp;<span class="op" id="2957683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2957687"><a href="/gostd/strings/replace.go.html#2956987">wn</a></span><span class="op" id="2957689">,</span>&nbsp;<span class="ident" id="2957691"><a href="/gostd/strings/replace.go.html#2956937">err</a></span>&nbsp;<span class="op" id="2957695">=</span>&nbsp;<span class="ident" id="2957697"><a href="/gostd/strings/replace.go.html#2956951">sw</a></span><span class="op" id="2957699">.</span><span class="ident" id="2957700"><a href="/gostd/strings/replace.go.html#2956418">WriteString</a></span><span class="op" id="2957711">(</span><span class="ident" id="2957712"><a href="/gostd/strings/replace.go.html#2956919">s</a></span><span class="op" id="2957713">[</span><span class="ident" id="2957714"><a href="/gostd/strings/replace.go.html#2956981">last</a></span><span class="op" id="2957718">:</span><span class="op" id="2957719">]</span><span class="op" id="2957720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2957724"><a href="/gostd/strings/replace.go.html#2956930">n</a></span>&nbsp;<span class="op" id="2957726">+=</span>&nbsp;<span class="ident" id="2957729"><a href="/gostd/strings/replace.go.html#2956987">wn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2957733">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2957736">return</span><br>
<span class="lineno"></span><span class="op" id="2957743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2957746">//&nbsp;singleStringReplacer&nbsp;is&nbsp;the&nbsp;implementation&nbsp;that&#39;s&nbsp;used&nbsp;when&nbsp;there&nbsp;is&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="2957823">//&nbsp;one&nbsp;string&nbsp;to&nbsp;replace&nbsp;(and&nbsp;that&nbsp;string&nbsp;has&nbsp;more&nbsp;than&nbsp;one&nbsp;byte).</span><br>
<span class="lineno">355</span><span class="keyword" id="2957890">type</span>&nbsp;<span class="ident" id="2957895">singleStringReplacer</span>&nbsp;<span class="keyword" id="2957916">struct</span>&nbsp;<span class="op" id="2957923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2957926">finder</span>&nbsp;<span class="op" id="2957933">*</span><span class="ident" id="2957934"><a href="/gostd/strings/search.go.html#2961807">stringFinder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2957948">//&nbsp;value&nbsp;is&nbsp;the&nbsp;new&nbsp;string&nbsp;that&nbsp;replaces&nbsp;that&nbsp;pattern&nbsp;when&nbsp;it&#39;s&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958020">value</span>&nbsp;<span class="builtintype" id="2958026">string</span><br>
<span class="lineno"></span><span class="op" id="2958033">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="2958036">func</span>&nbsp;<span class="ident" id="2958041">makeSingleStringReplacer</span><span class="op" id="2958065">(</span><span class="ident" id="2958066">pattern</span>&nbsp;<span class="builtintype" id="2958074">string</span><span class="op" id="2958080">,</span>&nbsp;<span class="ident" id="2958082">value</span>&nbsp;<span class="builtintype" id="2958088">string</span><span class="op" id="2958094">)</span>&nbsp;<span class="op" id="2958096">*</span><span class="ident" id="2958097"><a href="/gostd/strings/replace.go.html#2957895">singleStringReplacer</a></span>&nbsp;<span class="op" id="2958118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2958121">return</span>&nbsp;<span class="op" id="2958128">&amp;</span><span class="ident" id="2958129"><a href="/gostd/strings/replace.go.html#2957895">singleStringReplacer</a></span><span class="op" id="2958149">{</span><span class="ident" id="2958150"><a href="/gostd/strings/replace.go.html#2957926">finder</a></span><span class="op" id="2958156">:</span>&nbsp;<span class="ident" id="2958158"><a href="/gostd/strings/search.go.html#2963551">makeStringFinder</a></span><span class="op" id="2958174">(</span><span class="ident" id="2958175"><a href="/gostd/strings/replace.go.html#2958066">pattern</a></span><span class="op" id="2958182">)</span><span class="op" id="2958183">,</span>&nbsp;<span class="ident" id="2958185"><a href="/gostd/strings/replace.go.html#2958020">value</a></span><span class="op" id="2958190">:</span>&nbsp;<span class="ident" id="2958192"><a href="/gostd/strings/replace.go.html#2958082">value</a></span><span class="op" id="2958197">}</span><br>
<span class="lineno"></span><span class="op" id="2958199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="keyword" id="2958202">func</span>&nbsp;<span class="op" id="2958207">(</span><span class="ident" id="2958208">r</span>&nbsp;<span class="op" id="2958210">*</span><span class="ident" id="2958211"><a href="/gostd/strings/replace.go.html#2957895">singleStringReplacer</a></span><span class="op" id="2958231">)</span>&nbsp;<span class="ident" id="2958233">Replace</span><span class="op" id="2958240">(</span><span class="ident" id="2958241">s</span>&nbsp;<span class="builtintype" id="2958243">string</span><span class="op" id="2958249">)</span>&nbsp;<span class="builtintype" id="2958251">string</span>&nbsp;<span class="op" id="2958258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2958261">var</span>&nbsp;<span class="ident" id="2958265">buf</span>&nbsp;<span class="op" id="2958269">[</span><span class="op" id="2958270">]</span><span class="builtintype" id="2958271">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958277">i</span><span class="op" id="2958278">,</span>&nbsp;<span class="ident" id="2958280">matched</span>&nbsp;<span class="op" id="2958288">:=</span>&nbsp;<span class="num" id="2958291">0</span><span class="op" id="2958292">,</span>&nbsp;<span class="builtintype" id="2958294">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2958301">for</span>&nbsp;<span class="op" id="2958305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958309">match</span>&nbsp;<span class="op" id="2958315">:=</span>&nbsp;<span class="ident" id="2958318"><a href="/gostd/strings/replace.go.html#2958208">r</a></span><span class="op" id="2958319">.</span><span class="ident" id="2958320"><a href="/gostd/strings/replace.go.html#2957926">finder</a></span><span class="op" id="2958326">.</span><span class="ident" id="2958327"><a href="/gostd/strings/search.go.html#2965199">next</a></span><span class="op" id="2958331">(</span><span class="ident" id="2958332"><a href="/gostd/strings/replace.go.html#2958241">s</a></span><span class="op" id="2958333">[</span><span class="ident" id="2958334"><a href="/gostd/strings/replace.go.html#2958277">i</a></span><span class="op" id="2958335">:</span><span class="op" id="2958336">]</span><span class="op" id="2958337">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2958341">if</span>&nbsp;<span class="ident" id="2958344"><a href="/gostd/strings/replace.go.html#2958309">match</a></span>&nbsp;<span class="op" id="2958350">==</span>&nbsp;<span class="op" id="2958353">-</span><span class="num" id="2958354">1</span>&nbsp;<span class="op" id="2958356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2958361">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2958369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958373"><a href="/gostd/strings/replace.go.html#2958280">matched</a></span>&nbsp;<span class="op" id="2958381">=</span>&nbsp;<span class="builtintype" id="2958383">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958390"><a href="/gostd/strings/replace.go.html#2958265">buf</a></span>&nbsp;<span class="op" id="2958394">=</span>&nbsp;<span class="builtinfunc" id="2958396">append</span><span class="op" id="2958402">(</span><span class="ident" id="2958403"><a href="/gostd/strings/replace.go.html#2958265">buf</a></span><span class="op" id="2958406">,</span>&nbsp;<span class="ident" id="2958408"><a href="/gostd/strings/replace.go.html#2958241">s</a></span><span class="op" id="2958409">[</span><span class="ident" id="2958410"><a href="/gostd/strings/replace.go.html#2958277">i</a></span><span class="op" id="2958411">:</span><span class="ident" id="2958412"><a href="/gostd/strings/replace.go.html#2958277">i</a></span><span class="op" id="2958413">+</span><span class="ident" id="2958414"><a href="/gostd/strings/replace.go.html#2958309">match</a></span><span class="op" id="2958419">]</span><span class="op" id="2958420">...</span><span class="op" id="2958423">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958427"><a href="/gostd/strings/replace.go.html#2958265">buf</a></span>&nbsp;<span class="op" id="2958431">=</span>&nbsp;<span class="builtinfunc" id="2958433">append</span><span class="op" id="2958439">(</span><span class="ident" id="2958440"><a href="/gostd/strings/replace.go.html#2958265">buf</a></span><span class="op" id="2958443">,</span>&nbsp;<span class="ident" id="2958445"><a href="/gostd/strings/replace.go.html#2958208">r</a></span><span class="op" id="2958446">.</span><span class="ident" id="2958447"><a href="/gostd/strings/replace.go.html#2958020">value</a></span><span class="op" id="2958452">...</span><span class="op" id="2958455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958459"><a href="/gostd/strings/replace.go.html#2958277">i</a></span>&nbsp;<span class="op" id="2958461">+=</span>&nbsp;<span class="ident" id="2958464"><a href="/gostd/strings/replace.go.html#2958309">match</a></span>&nbsp;<span class="op" id="2958470">+</span>&nbsp;<span class="builtinfunc" id="2958472">len</span><span class="op" id="2958475">(</span><span class="ident" id="2958476"><a href="/gostd/strings/replace.go.html#2958208">r</a></span><span class="op" id="2958477">.</span><span class="ident" id="2958478"><a href="/gostd/strings/replace.go.html#2957926">finder</a></span><span class="op" id="2958484">.</span><span class="ident" id="2958485"><a href="/gostd/strings/search.go.html#2961895">pattern</a></span><span class="op" id="2958492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2958495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2958498">if</span>&nbsp;<span class="op" id="2958501">!</span><span class="ident" id="2958502"><a href="/gostd/strings/replace.go.html#2958280">matched</a></span>&nbsp;<span class="op" id="2958510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2958514">return</span>&nbsp;<span class="ident" id="2958521"><a href="/gostd/strings/replace.go.html#2958241">s</a></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2958524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958527"><a href="/gostd/strings/replace.go.html#2958265">buf</a></span>&nbsp;<span class="op" id="2958531">=</span>&nbsp;<span class="builtinfunc" id="2958533">append</span><span class="op" id="2958539">(</span><span class="ident" id="2958540"><a href="/gostd/strings/replace.go.html#2958265">buf</a></span><span class="op" id="2958543">,</span>&nbsp;<span class="ident" id="2958545"><a href="/gostd/strings/replace.go.html#2958241">s</a></span><span class="op" id="2958546">[</span><span class="ident" id="2958547"><a href="/gostd/strings/replace.go.html#2958277">i</a></span><span class="op" id="2958548">:</span><span class="op" id="2958549">]</span><span class="op" id="2958550">...</span><span class="op" id="2958553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2958556">return</span>&nbsp;<span class="builtintype" id="2958563">string</span><span class="op" id="2958569">(</span><span class="ident" id="2958570"><a href="/gostd/strings/replace.go.html#2958265">buf</a></span><span class="op" id="2958573">)</span><br>
<span class="lineno"></span><span class="op" id="2958575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="2958578">func</span>&nbsp;<span class="op" id="2958583">(</span><span class="ident" id="2958584">r</span>&nbsp;<span class="op" id="2958586">*</span><span class="ident" id="2958587"><a href="/gostd/strings/replace.go.html#2957895">singleStringReplacer</a></span><span class="op" id="2958607">)</span>&nbsp;<span class="ident" id="2958609">WriteString</span><span class="op" id="2958620">(</span><span class="ident" id="2958621">w</span>&nbsp;<span class="ident" id="2958623"><a href="/gostd/strings/replace.go.html#2948559">io</a></span><span class="op" id="2958625">.</span><span class="ident" id="2958626"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="2958632">,</span>&nbsp;<span class="ident" id="2958634">s</span>&nbsp;<span class="builtintype" id="2958636">string</span><span class="op" id="2958642">)</span>&nbsp;<span class="op" id="2958644">(</span><span class="ident" id="2958645">n</span>&nbsp;<span class="builtintype" id="2958647">int</span><span class="op" id="2958650">,</span>&nbsp;<span class="ident" id="2958652">err</span>&nbsp;<span class="builtintype" id="2958656">error</span><span class="op" id="2958661">)</span>&nbsp;<span class="op" id="2958663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958666">sw</span>&nbsp;<span class="op" id="2958669">:=</span>&nbsp;<span class="ident" id="2958672"><a href="/gostd/strings/replace.go.html#2956593">getStringWriter</a></span><span class="op" id="2958687">(</span><span class="ident" id="2958688"><a href="/gostd/strings/replace.go.html#2958621">w</a></span><span class="op" id="2958689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2958692">var</span>&nbsp;<span class="ident" id="2958696">i</span><span class="op" id="2958697">,</span>&nbsp;<span class="ident" id="2958699">wn</span>&nbsp;<span class="builtintype" id="2958702">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2958707">for</span>&nbsp;<span class="op" id="2958711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958715">match</span>&nbsp;<span class="op" id="2958721">:=</span>&nbsp;<span class="ident" id="2958724"><a href="/gostd/strings/replace.go.html#2958584">r</a></span><span class="op" id="2958725">.</span><span class="ident" id="2958726"><a href="/gostd/strings/replace.go.html#2957926">finder</a></span><span class="op" id="2958732">.</span><span class="ident" id="2958733"><a href="/gostd/strings/search.go.html#2965199">next</a></span><span class="op" id="2958737">(</span><span class="ident" id="2958738"><a href="/gostd/strings/replace.go.html#2958634">s</a></span><span class="op" id="2958739">[</span><span class="ident" id="2958740"><a href="/gostd/strings/replace.go.html#2958696">i</a></span><span class="op" id="2958741">:</span><span class="op" id="2958742">]</span><span class="op" id="2958743">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2958747">if</span>&nbsp;<span class="ident" id="2958750"><a href="/gostd/strings/replace.go.html#2958715">match</a></span>&nbsp;<span class="op" id="2958756">==</span>&nbsp;<span class="op" id="2958759">-</span><span class="num" id="2958760">1</span>&nbsp;<span class="op" id="2958762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2958767">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2958775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958779"><a href="/gostd/strings/replace.go.html#2958699">wn</a></span><span class="op" id="2958781">,</span>&nbsp;<span class="ident" id="2958783"><a href="/gostd/strings/replace.go.html#2958652">err</a></span>&nbsp;<span class="op" id="2958787">=</span>&nbsp;<span class="ident" id="2958789"><a href="/gostd/strings/replace.go.html#2958666">sw</a></span><span class="op" id="2958791">.</span><span class="ident" id="2958792"><a href="/gostd/strings/replace.go.html#2956418">WriteString</a></span><span class="op" id="2958803">(</span><span class="ident" id="2958804"><a href="/gostd/strings/replace.go.html#2958634">s</a></span><span class="op" id="2958805">[</span><span class="ident" id="2958806"><a href="/gostd/strings/replace.go.html#2958696">i</a></span>&nbsp;<span class="op" id="2958808">:</span>&nbsp;<span class="ident" id="2958810"><a href="/gostd/strings/replace.go.html#2958696">i</a></span><span class="op" id="2958811">+</span><span class="ident" id="2958812"><a href="/gostd/strings/replace.go.html#2958715">match</a></span><span class="op" id="2958817">]</span><span class="op" id="2958818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958822"><a href="/gostd/strings/replace.go.html#2958645">n</a></span>&nbsp;<span class="op" id="2958824">+=</span>&nbsp;<span class="ident" id="2958827"><a href="/gostd/strings/replace.go.html#2958699">wn</a></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2958832">if</span>&nbsp;<span class="ident" id="2958835"><a href="/gostd/strings/replace.go.html#2958652">err</a></span>&nbsp;<span class="op" id="2958839">!=</span>&nbsp;<span class="builtintype" id="2958842">nil</span>&nbsp;<span class="op" id="2958846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2958851">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2958860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958864"><a href="/gostd/strings/replace.go.html#2958699">wn</a></span><span class="op" id="2958866">,</span>&nbsp;<span class="ident" id="2958868"><a href="/gostd/strings/replace.go.html#2958652">err</a></span>&nbsp;<span class="op" id="2958872">=</span>&nbsp;<span class="ident" id="2958874"><a href="/gostd/strings/replace.go.html#2958666">sw</a></span><span class="op" id="2958876">.</span><span class="ident" id="2958877"><a href="/gostd/strings/replace.go.html#2956418">WriteString</a></span><span class="op" id="2958888">(</span><span class="ident" id="2958889"><a href="/gostd/strings/replace.go.html#2958584">r</a></span><span class="op" id="2958890">.</span><span class="ident" id="2958891"><a href="/gostd/strings/replace.go.html#2958020">value</a></span><span class="op" id="2958896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958900"><a href="/gostd/strings/replace.go.html#2958645">n</a></span>&nbsp;<span class="op" id="2958902">+=</span>&nbsp;<span class="ident" id="2958905"><a href="/gostd/strings/replace.go.html#2958699">wn</a></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2958910">if</span>&nbsp;<span class="ident" id="2958913"><a href="/gostd/strings/replace.go.html#2958652">err</a></span>&nbsp;<span class="op" id="2958917">!=</span>&nbsp;<span class="builtintype" id="2958920">nil</span>&nbsp;<span class="op" id="2958924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2958929">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2958938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958942"><a href="/gostd/strings/replace.go.html#2958696">i</a></span>&nbsp;<span class="op" id="2958944">+=</span>&nbsp;<span class="ident" id="2958947"><a href="/gostd/strings/replace.go.html#2958715">match</a></span>&nbsp;<span class="op" id="2958953">+</span>&nbsp;<span class="builtinfunc" id="2958955">len</span><span class="op" id="2958958">(</span><span class="ident" id="2958959"><a href="/gostd/strings/replace.go.html#2958584">r</a></span><span class="op" id="2958960">.</span><span class="ident" id="2958961"><a href="/gostd/strings/replace.go.html#2957926">finder</a></span><span class="op" id="2958967">.</span><span class="ident" id="2958968"><a href="/gostd/strings/search.go.html#2961895">pattern</a></span><span class="op" id="2958975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2958978">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958981"><a href="/gostd/strings/replace.go.html#2958699">wn</a></span><span class="op" id="2958983">,</span>&nbsp;<span class="ident" id="2958985"><a href="/gostd/strings/replace.go.html#2958652">err</a></span>&nbsp;<span class="op" id="2958989">=</span>&nbsp;<span class="ident" id="2958991"><a href="/gostd/strings/replace.go.html#2958666">sw</a></span><span class="op" id="2958993">.</span><span class="ident" id="2958994"><a href="/gostd/strings/replace.go.html#2956418">WriteString</a></span><span class="op" id="2959005">(</span><span class="ident" id="2959006"><a href="/gostd/strings/replace.go.html#2958634">s</a></span><span class="op" id="2959007">[</span><span class="ident" id="2959008"><a href="/gostd/strings/replace.go.html#2958696">i</a></span><span class="op" id="2959009">:</span><span class="op" id="2959010">]</span><span class="op" id="2959011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959014"><a href="/gostd/strings/replace.go.html#2958645">n</a></span>&nbsp;<span class="op" id="2959016">+=</span>&nbsp;<span class="ident" id="2959019"><a href="/gostd/strings/replace.go.html#2958699">wn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2959023">return</span><br>
<span class="lineno"></span><span class="op" id="2959030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="2959033">//&nbsp;byteReplacer&nbsp;is&nbsp;the&nbsp;implementation&nbsp;that&#39;s&nbsp;used&nbsp;when&nbsp;all&nbsp;the&nbsp;&#34;old&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2959102">//&nbsp;and&nbsp;&#34;new&#34;&nbsp;values&nbsp;are&nbsp;single&nbsp;ASCII&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="2959146">//&nbsp;The&nbsp;array&nbsp;contains&nbsp;replacement&nbsp;bytes&nbsp;indexed&nbsp;by&nbsp;old&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="2959207">type</span>&nbsp;<span class="ident" id="2959212">byteReplacer</span>&nbsp;<span class="op" id="2959225">[</span><span class="num" id="2959226">256</span><span class="op" id="2959229">]</span><span class="builtintype" id="2959230">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="2959236">func</span>&nbsp;<span class="op" id="2959241">(</span><span class="ident" id="2959242">r</span>&nbsp;<span class="op" id="2959244">*</span><span class="ident" id="2959245"><a href="/gostd/strings/replace.go.html#2959212">byteReplacer</a></span><span class="op" id="2959257">)</span>&nbsp;<span class="ident" id="2959259">Replace</span><span class="op" id="2959266">(</span><span class="ident" id="2959267">s</span>&nbsp;<span class="builtintype" id="2959269">string</span><span class="op" id="2959275">)</span>&nbsp;<span class="builtintype" id="2959277">string</span>&nbsp;<span class="op" id="2959284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2959287">var</span>&nbsp;<span class="ident" id="2959291">buf</span>&nbsp;<span class="op" id="2959295">[</span><span class="op" id="2959296">]</span><span class="builtintype" id="2959297">byte</span>&nbsp;<span class="comment" id="2959302">//&nbsp;lazily&nbsp;allocated</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2959323">for</span>&nbsp;<span class="ident" id="2959327">i</span>&nbsp;<span class="op" id="2959329">:=</span>&nbsp;<span class="num" id="2959332">0</span><span class="op" id="2959333">;</span>&nbsp;<span class="ident" id="2959335"><a href="/gostd/strings/replace.go.html#2959327">i</a></span>&nbsp;<span class="op" id="2959337">&lt;</span>&nbsp;<span class="builtinfunc" id="2959339">len</span><span class="op" id="2959342">(</span><span class="ident" id="2959343"><a href="/gostd/strings/replace.go.html#2959267">s</a></span><span class="op" id="2959344">)</span><span class="op" id="2959345">;</span>&nbsp;<span class="ident" id="2959347"><a href="/gostd/strings/replace.go.html#2959327">i</a></span><span class="op" id="2959348">++</span>&nbsp;<span class="op" id="2959351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959355">b</span>&nbsp;<span class="op" id="2959357">:=</span>&nbsp;<span class="ident" id="2959360"><a href="/gostd/strings/replace.go.html#2959267">s</a></span><span class="op" id="2959361">[</span><span class="ident" id="2959362"><a href="/gostd/strings/replace.go.html#2959327">i</a></span><span class="op" id="2959363">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2959367">if</span>&nbsp;<span class="ident" id="2959370"><a href="/gostd/strings/replace.go.html#2959242">r</a></span><span class="op" id="2959371">[</span><span class="ident" id="2959372"><a href="/gostd/strings/replace.go.html#2959355">b</a></span><span class="op" id="2959373">]</span>&nbsp;<span class="op" id="2959375">!=</span>&nbsp;<span class="ident" id="2959378"><a href="/gostd/strings/replace.go.html#2959355">b</a></span>&nbsp;<span class="op" id="2959380">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2959385">if</span>&nbsp;<span class="ident" id="2959388"><a href="/gostd/strings/replace.go.html#2959291">buf</a></span>&nbsp;<span class="op" id="2959392">==</span>&nbsp;<span class="builtintype" id="2959395">nil</span>&nbsp;<span class="op" id="2959399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959405"><a href="/gostd/strings/replace.go.html#2959291">buf</a></span>&nbsp;<span class="op" id="2959409">=</span>&nbsp;<span class="op" id="2959411">[</span><span class="op" id="2959412">]</span><span class="builtintype" id="2959413">byte</span><span class="op" id="2959417">(</span><span class="ident" id="2959418"><a href="/gostd/strings/replace.go.html#2959267">s</a></span><span class="op" id="2959419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2959424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959429"><a href="/gostd/strings/replace.go.html#2959291">buf</a></span><span class="op" id="2959432">[</span><span class="ident" id="2959433"><a href="/gostd/strings/replace.go.html#2959327">i</a></span><span class="op" id="2959434">]</span>&nbsp;<span class="op" id="2959436">=</span>&nbsp;<span class="ident" id="2959438"><a href="/gostd/strings/replace.go.html#2959242">r</a></span><span class="op" id="2959439">[</span><span class="ident" id="2959440"><a href="/gostd/strings/replace.go.html#2959355">b</a></span><span class="op" id="2959441">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2959445">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2959448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2959451">if</span>&nbsp;<span class="ident" id="2959454"><a href="/gostd/strings/replace.go.html#2959291">buf</a></span>&nbsp;<span class="op" id="2959458">==</span>&nbsp;<span class="builtintype" id="2959461">nil</span>&nbsp;<span class="op" id="2959465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2959469">return</span>&nbsp;<span class="ident" id="2959476"><a href="/gostd/strings/replace.go.html#2959267">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2959479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2959482">return</span>&nbsp;<span class="builtintype" id="2959489">string</span><span class="op" id="2959495">(</span><span class="ident" id="2959496"><a href="/gostd/strings/replace.go.html#2959291">buf</a></span><span class="op" id="2959499">)</span><br>
<span class="lineno">430</span><span class="op" id="2959501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2959504">func</span>&nbsp;<span class="op" id="2959509">(</span><span class="ident" id="2959510">r</span>&nbsp;<span class="op" id="2959512">*</span><span class="ident" id="2959513"><a href="/gostd/strings/replace.go.html#2959212">byteReplacer</a></span><span class="op" id="2959525">)</span>&nbsp;<span class="ident" id="2959527">WriteString</span><span class="op" id="2959538">(</span><span class="ident" id="2959539">w</span>&nbsp;<span class="ident" id="2959541"><a href="/gostd/strings/replace.go.html#2948559">io</a></span><span class="op" id="2959543">.</span><span class="ident" id="2959544"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="2959550">,</span>&nbsp;<span class="ident" id="2959552">s</span>&nbsp;<span class="builtintype" id="2959554">string</span><span class="op" id="2959560">)</span>&nbsp;<span class="op" id="2959562">(</span><span class="ident" id="2959563">n</span>&nbsp;<span class="builtintype" id="2959565">int</span><span class="op" id="2959568">,</span>&nbsp;<span class="ident" id="2959570">err</span>&nbsp;<span class="builtintype" id="2959574">error</span><span class="op" id="2959579">)</span>&nbsp;<span class="op" id="2959581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2959584">//&nbsp;TODO(bradfitz):&nbsp;use&nbsp;io.WriteString&nbsp;with&nbsp;slices&nbsp;of&nbsp;s,&nbsp;avoiding&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959662">bufsize</span>&nbsp;<span class="op" id="2959670">:=</span>&nbsp;<span class="num" id="2959673">32</span>&nbsp;<span class="op" id="2959676">&lt;&lt;</span>&nbsp;<span class="num" id="2959679">10</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2959683">if</span>&nbsp;<span class="builtinfunc" id="2959686">len</span><span class="op" id="2959689">(</span><span class="ident" id="2959690"><a href="/gostd/strings/replace.go.html#2959552">s</a></span><span class="op" id="2959691">)</span>&nbsp;<span class="op" id="2959693">&lt;</span>&nbsp;<span class="ident" id="2959695"><a href="/gostd/strings/replace.go.html#2959662">bufsize</a></span>&nbsp;<span class="op" id="2959703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959707"><a href="/gostd/strings/replace.go.html#2959662">bufsize</a></span>&nbsp;<span class="op" id="2959715">=</span>&nbsp;<span class="builtinfunc" id="2959717">len</span><span class="op" id="2959720">(</span><span class="ident" id="2959721"><a href="/gostd/strings/replace.go.html#2959552">s</a></span><span class="op" id="2959722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2959725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959728">buf</span>&nbsp;<span class="op" id="2959732">:=</span>&nbsp;<span class="builtinfunc" id="2959735">make</span><span class="op" id="2959739">(</span><span class="op" id="2959740">[</span><span class="op" id="2959741">]</span><span class="builtintype" id="2959742">byte</span><span class="op" id="2959746">,</span>&nbsp;<span class="ident" id="2959748"><a href="/gostd/strings/replace.go.html#2959662">bufsize</a></span><span class="op" id="2959755">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2959759">for</span>&nbsp;<span class="builtinfunc" id="2959763">len</span><span class="op" id="2959766">(</span><span class="ident" id="2959767"><a href="/gostd/strings/replace.go.html#2959552">s</a></span><span class="op" id="2959768">)</span>&nbsp;<span class="op" id="2959770">&gt;</span>&nbsp;<span class="num" id="2959772">0</span>&nbsp;<span class="op" id="2959774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959778">ncopy</span>&nbsp;<span class="op" id="2959784">:=</span>&nbsp;<span class="builtinfunc" id="2959787">copy</span><span class="op" id="2959791">(</span><span class="ident" id="2959792"><a href="/gostd/strings/replace.go.html#2959728">buf</a></span><span class="op" id="2959795">,</span>&nbsp;<span class="ident" id="2959797"><a href="/gostd/strings/replace.go.html#2959552">s</a></span><span class="op" id="2959798">[</span><span class="op" id="2959799">:</span><span class="op" id="2959800">]</span><span class="op" id="2959801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959805"><a href="/gostd/strings/replace.go.html#2959552">s</a></span>&nbsp;<span class="op" id="2959807">=</span>&nbsp;<span class="ident" id="2959809"><a href="/gostd/strings/replace.go.html#2959552">s</a></span><span class="op" id="2959810">[</span><span class="ident" id="2959811"><a href="/gostd/strings/replace.go.html#2959778">ncopy</a></span><span class="op" id="2959816">:</span><span class="op" id="2959817">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2959821">for</span>&nbsp;<span class="ident" id="2959825">i</span><span class="op" id="2959826">,</span>&nbsp;<span class="ident" id="2959828">b</span>&nbsp;<span class="op" id="2959830">:=</span>&nbsp;<span class="keyword" id="2959833">range</span>&nbsp;<span class="ident" id="2959839"><a href="/gostd/strings/replace.go.html#2959728">buf</a></span><span class="op" id="2959842">[</span><span class="op" id="2959843">:</span><span class="ident" id="2959844"><a href="/gostd/strings/replace.go.html#2959778">ncopy</a></span><span class="op" id="2959849">]</span>&nbsp;<span class="op" id="2959851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959856"><a href="/gostd/strings/replace.go.html#2959728">buf</a></span><span class="op" id="2959859">[</span><span class="ident" id="2959860"><a href="/gostd/strings/replace.go.html#2959825">i</a></span><span class="op" id="2959861">]</span>&nbsp;<span class="op" id="2959863">=</span>&nbsp;<span class="ident" id="2959865"><a href="/gostd/strings/replace.go.html#2959510">r</a></span><span class="op" id="2959866">[</span><span class="ident" id="2959867"><a href="/gostd/strings/replace.go.html#2959828">b</a></span><span class="op" id="2959868">]</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2959872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959876">wn</span><span class="op" id="2959878">,</span>&nbsp;<span class="ident" id="2959880">err</span>&nbsp;<span class="op" id="2959884">:=</span>&nbsp;<span class="ident" id="2959887"><a href="/gostd/strings/replace.go.html#2959539">w</a></span><span class="op" id="2959888">.</span><span class="ident" id="2959889"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="2959894">(</span><span class="ident" id="2959895"><a href="/gostd/strings/replace.go.html#2959728">buf</a></span><span class="op" id="2959898">[</span><span class="op" id="2959899">:</span><span class="ident" id="2959900"><a href="/gostd/strings/replace.go.html#2959778">ncopy</a></span><span class="op" id="2959905">]</span><span class="op" id="2959906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959910"><a href="/gostd/strings/replace.go.html#2959563">n</a></span>&nbsp;<span class="op" id="2959912">+=</span>&nbsp;<span class="ident" id="2959915"><a href="/gostd/strings/replace.go.html#2959876">wn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2959920">if</span>&nbsp;<span class="ident" id="2959923"><a href="/gostd/strings/replace.go.html#2959880">err</a></span>&nbsp;<span class="op" id="2959927">!=</span>&nbsp;<span class="builtintype" id="2959930">nil</span>&nbsp;<span class="op" id="2959934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2959939">return</span>&nbsp;<span class="ident" id="2959946"><a href="/gostd/strings/replace.go.html#2959563">n</a></span><span class="op" id="2959947">,</span>&nbsp;<span class="ident" id="2959949"><a href="/gostd/strings/replace.go.html#2959880">err</a></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2959955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2959958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2959961">return</span>&nbsp;<span class="ident" id="2959968"><a href="/gostd/strings/replace.go.html#2959563">n</a></span><span class="op" id="2959969">,</span>&nbsp;<span class="builtintype" id="2959971">nil</span><br>
<span class="lineno"></span><span class="op" id="2959975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="2959978">//&nbsp;byteStringReplacer&nbsp;is&nbsp;the&nbsp;implementation&nbsp;that&#39;s&nbsp;used&nbsp;when&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2960047">//&nbsp;&#34;old&#34;&nbsp;values&nbsp;are&nbsp;single&nbsp;ASCII&nbsp;bytes&nbsp;but&nbsp;the&nbsp;&#34;new&#34;&nbsp;values&nbsp;vary&nbsp;in&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="2960121">//&nbsp;The&nbsp;array&nbsp;contains&nbsp;replacement&nbsp;byte&nbsp;slices&nbsp;indexed&nbsp;by&nbsp;old&nbsp;byte.</span><br>
<span class="lineno"></span><span class="comment" id="2960188">//&nbsp;A&nbsp;nil&nbsp;[]byte&nbsp;means&nbsp;that&nbsp;the&nbsp;old&nbsp;byte&nbsp;should&nbsp;not&nbsp;be&nbsp;replaced.</span><br>
<span class="lineno"></span><span class="keyword" id="2960252">type</span>&nbsp;<span class="ident" id="2960257">byteStringReplacer</span>&nbsp;<span class="op" id="2960276">[</span><span class="num" id="2960277">256</span><span class="op" id="2960280">]</span><span class="op" id="2960281">[</span><span class="op" id="2960282">]</span><span class="builtintype" id="2960283">byte</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="keyword" id="2960289">func</span>&nbsp;<span class="op" id="2960294">(</span><span class="ident" id="2960295">r</span>&nbsp;<span class="op" id="2960297">*</span><span class="ident" id="2960298"><a href="/gostd/strings/replace.go.html#2960257">byteStringReplacer</a></span><span class="op" id="2960316">)</span>&nbsp;<span class="ident" id="2960318">Replace</span><span class="op" id="2960325">(</span><span class="ident" id="2960326">s</span>&nbsp;<span class="builtintype" id="2960328">string</span><span class="op" id="2960334">)</span>&nbsp;<span class="builtintype" id="2960336">string</span>&nbsp;<span class="op" id="2960343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960346">newSize</span>&nbsp;<span class="op" id="2960354">:=</span>&nbsp;<span class="builtinfunc" id="2960357">len</span><span class="op" id="2960360">(</span><span class="ident" id="2960361"><a href="/gostd/strings/replace.go.html#2960326">s</a></span><span class="op" id="2960362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960365">anyChanges</span>&nbsp;<span class="op" id="2960376">:=</span>&nbsp;<span class="builtintype" id="2960379">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2960386">for</span>&nbsp;<span class="ident" id="2960390">i</span>&nbsp;<span class="op" id="2960392">:=</span>&nbsp;<span class="num" id="2960395">0</span><span class="op" id="2960396">;</span>&nbsp;<span class="ident" id="2960398"><a href="/gostd/strings/replace.go.html#2960390">i</a></span>&nbsp;<span class="op" id="2960400">&lt;</span>&nbsp;<span class="builtinfunc" id="2960402">len</span><span class="op" id="2960405">(</span><span class="ident" id="2960406"><a href="/gostd/strings/replace.go.html#2960326">s</a></span><span class="op" id="2960407">)</span><span class="op" id="2960408">;</span>&nbsp;<span class="ident" id="2960410"><a href="/gostd/strings/replace.go.html#2960390">i</a></span><span class="op" id="2960411">++</span>&nbsp;<span class="op" id="2960414">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960418">b</span>&nbsp;<span class="op" id="2960420">:=</span>&nbsp;<span class="ident" id="2960423"><a href="/gostd/strings/replace.go.html#2960326">s</a></span><span class="op" id="2960424">[</span><span class="ident" id="2960425"><a href="/gostd/strings/replace.go.html#2960390">i</a></span><span class="op" id="2960426">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2960430">if</span>&nbsp;<span class="ident" id="2960433"><a href="/gostd/strings/replace.go.html#2960295">r</a></span><span class="op" id="2960434">[</span><span class="ident" id="2960435"><a href="/gostd/strings/replace.go.html#2960418">b</a></span><span class="op" id="2960436">]</span>&nbsp;<span class="op" id="2960438">!=</span>&nbsp;<span class="builtintype" id="2960441">nil</span>&nbsp;<span class="op" id="2960445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960450"><a href="/gostd/strings/replace.go.html#2960365">anyChanges</a></span>&nbsp;<span class="op" id="2960461">=</span>&nbsp;<span class="builtintype" id="2960463">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2960471">//&nbsp;The&nbsp;-1&nbsp;is&nbsp;because&nbsp;we&nbsp;are&nbsp;replacing&nbsp;1&nbsp;byte&nbsp;with&nbsp;len(r[b])&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960541"><a href="/gostd/strings/replace.go.html#2960346">newSize</a></span>&nbsp;<span class="op" id="2960549">+=</span>&nbsp;<span class="builtinfunc" id="2960552">len</span><span class="op" id="2960555">(</span><span class="ident" id="2960556"><a href="/gostd/strings/replace.go.html#2960295">r</a></span><span class="op" id="2960557">[</span><span class="ident" id="2960558"><a href="/gostd/strings/replace.go.html#2960418">b</a></span><span class="op" id="2960559">]</span><span class="op" id="2960560">)</span>&nbsp;<span class="op" id="2960562">-</span>&nbsp;<span class="num" id="2960564">1</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2960568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2960571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2960574">if</span>&nbsp;<span class="op" id="2960577">!</span><span class="ident" id="2960578"><a href="/gostd/strings/replace.go.html#2960365">anyChanges</a></span>&nbsp;<span class="op" id="2960589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2960593">return</span>&nbsp;<span class="ident" id="2960600"><a href="/gostd/strings/replace.go.html#2960326">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2960603">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960606">buf</span>&nbsp;<span class="op" id="2960610">:=</span>&nbsp;<span class="builtinfunc" id="2960613">make</span><span class="op" id="2960617">(</span><span class="op" id="2960618">[</span><span class="op" id="2960619">]</span><span class="builtintype" id="2960620">byte</span><span class="op" id="2960624">,</span>&nbsp;<span class="ident" id="2960626"><a href="/gostd/strings/replace.go.html#2960346">newSize</a></span><span class="op" id="2960633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960636">bi</span>&nbsp;<span class="op" id="2960639">:=</span>&nbsp;<span class="ident" id="2960642"><a href="/gostd/strings/replace.go.html#2960606">buf</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2960647">for</span>&nbsp;<span class="ident" id="2960651">i</span>&nbsp;<span class="op" id="2960653">:=</span>&nbsp;<span class="num" id="2960656">0</span><span class="op" id="2960657">;</span>&nbsp;<span class="ident" id="2960659"><a href="/gostd/strings/replace.go.html#2960651">i</a></span>&nbsp;<span class="op" id="2960661">&lt;</span>&nbsp;<span class="builtinfunc" id="2960663">len</span><span class="op" id="2960666">(</span><span class="ident" id="2960667"><a href="/gostd/strings/replace.go.html#2960326">s</a></span><span class="op" id="2960668">)</span><span class="op" id="2960669">;</span>&nbsp;<span class="ident" id="2960671"><a href="/gostd/strings/replace.go.html#2960651">i</a></span><span class="op" id="2960672">++</span>&nbsp;<span class="op" id="2960675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960679">b</span>&nbsp;<span class="op" id="2960681">:=</span>&nbsp;<span class="ident" id="2960684"><a href="/gostd/strings/replace.go.html#2960326">s</a></span><span class="op" id="2960685">[</span><span class="ident" id="2960686"><a href="/gostd/strings/replace.go.html#2960651">i</a></span><span class="op" id="2960687">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2960691">if</span>&nbsp;<span class="ident" id="2960694"><a href="/gostd/strings/replace.go.html#2960295">r</a></span><span class="op" id="2960695">[</span><span class="ident" id="2960696"><a href="/gostd/strings/replace.go.html#2960679">b</a></span><span class="op" id="2960697">]</span>&nbsp;<span class="op" id="2960699">!=</span>&nbsp;<span class="builtintype" id="2960702">nil</span>&nbsp;<span class="op" id="2960706">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960711">n</span>&nbsp;<span class="op" id="2960713">:=</span>&nbsp;<span class="builtinfunc" id="2960716">copy</span><span class="op" id="2960720">(</span><span class="ident" id="2960721"><a href="/gostd/strings/replace.go.html#2960636">bi</a></span><span class="op" id="2960723">,</span>&nbsp;<span class="ident" id="2960725"><a href="/gostd/strings/replace.go.html#2960295">r</a></span><span class="op" id="2960726">[</span><span class="ident" id="2960727"><a href="/gostd/strings/replace.go.html#2960679">b</a></span><span class="op" id="2960728">]</span><span class="op" id="2960729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960734"><a href="/gostd/strings/replace.go.html#2960636">bi</a></span>&nbsp;<span class="op" id="2960737">=</span>&nbsp;<span class="ident" id="2960739"><a href="/gostd/strings/replace.go.html#2960636">bi</a></span><span class="op" id="2960741">[</span><span class="ident" id="2960742"><a href="/gostd/strings/replace.go.html#2960711">n</a></span><span class="op" id="2960743">:</span><span class="op" id="2960744">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2960748">}</span>&nbsp;<span class="keyword" id="2960750">else</span>&nbsp;<span class="op" id="2960755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960760"><a href="/gostd/strings/replace.go.html#2960636">bi</a></span><span class="op" id="2960762">[</span><span class="num" id="2960763">0</span><span class="op" id="2960764">]</span>&nbsp;<span class="op" id="2960766">=</span>&nbsp;<span class="ident" id="2960768"><a href="/gostd/strings/replace.go.html#2960679">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960773"><a href="/gostd/strings/replace.go.html#2960636">bi</a></span>&nbsp;<span class="op" id="2960776">=</span>&nbsp;<span class="ident" id="2960778"><a href="/gostd/strings/replace.go.html#2960636">bi</a></span><span class="op" id="2960780">[</span><span class="num" id="2960781">1</span><span class="op" id="2960782">:</span><span class="op" id="2960783">]</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2960787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2960790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2960793">return</span>&nbsp;<span class="builtintype" id="2960800">string</span><span class="op" id="2960806">(</span><span class="ident" id="2960807"><a href="/gostd/strings/replace.go.html#2960606">buf</a></span><span class="op" id="2960810">)</span><br>
<span class="lineno"></span><span class="op" id="2960812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span><span class="keyword" id="2960815">func</span>&nbsp;<span class="op" id="2960820">(</span><span class="ident" id="2960821">r</span>&nbsp;<span class="op" id="2960823">*</span><span class="ident" id="2960824"><a href="/gostd/strings/replace.go.html#2960257">byteStringReplacer</a></span><span class="op" id="2960842">)</span>&nbsp;<span class="ident" id="2960844">WriteString</span><span class="op" id="2960855">(</span><span class="ident" id="2960856">w</span>&nbsp;<span class="ident" id="2960858"><a href="/gostd/strings/replace.go.html#2948559">io</a></span><span class="op" id="2960860">.</span><span class="ident" id="2960861"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="2960867">,</span>&nbsp;<span class="ident" id="2960869">s</span>&nbsp;<span class="builtintype" id="2960871">string</span><span class="op" id="2960877">)</span>&nbsp;<span class="op" id="2960879">(</span><span class="ident" id="2960880">n</span>&nbsp;<span class="builtintype" id="2960882">int</span><span class="op" id="2960885">,</span>&nbsp;<span class="ident" id="2960887">err</span>&nbsp;<span class="builtintype" id="2960891">error</span><span class="op" id="2960896">)</span>&nbsp;<span class="op" id="2960898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960901">sw</span>&nbsp;<span class="op" id="2960904">:=</span>&nbsp;<span class="ident" id="2960907"><a href="/gostd/strings/replace.go.html#2956593">getStringWriter</a></span><span class="op" id="2960922">(</span><span class="ident" id="2960923"><a href="/gostd/strings/replace.go.html#2960856">w</a></span><span class="op" id="2960924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960927">last</span>&nbsp;<span class="op" id="2960932">:=</span>&nbsp;<span class="num" id="2960935">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2960938">for</span>&nbsp;<span class="ident" id="2960942">i</span>&nbsp;<span class="op" id="2960944">:=</span>&nbsp;<span class="num" id="2960947">0</span><span class="op" id="2960948">;</span>&nbsp;<span class="ident" id="2960950"><a href="/gostd/strings/replace.go.html#2960942">i</a></span>&nbsp;<span class="op" id="2960952">&lt;</span>&nbsp;<span class="builtinfunc" id="2960954">len</span><span class="op" id="2960957">(</span><span class="ident" id="2960958"><a href="/gostd/strings/replace.go.html#2960869">s</a></span><span class="op" id="2960959">)</span><span class="op" id="2960960">;</span>&nbsp;<span class="ident" id="2960962"><a href="/gostd/strings/replace.go.html#2960942">i</a></span><span class="op" id="2960963">++</span>&nbsp;<span class="op" id="2960966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960970">b</span>&nbsp;<span class="op" id="2960972">:=</span>&nbsp;<span class="ident" id="2960975"><a href="/gostd/strings/replace.go.html#2960869">s</a></span><span class="op" id="2960976">[</span><span class="ident" id="2960977"><a href="/gostd/strings/replace.go.html#2960942">i</a></span><span class="op" id="2960978">]</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2960982">if</span>&nbsp;<span class="ident" id="2960985"><a href="/gostd/strings/replace.go.html#2960821">r</a></span><span class="op" id="2960986">[</span><span class="ident" id="2960987"><a href="/gostd/strings/replace.go.html#2960970">b</a></span><span class="op" id="2960988">]</span>&nbsp;<span class="op" id="2960990">==</span>&nbsp;<span class="builtintype" id="2960993">nil</span>&nbsp;<span class="op" id="2960997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2961002">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2961013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2961017">if</span>&nbsp;<span class="ident" id="2961020"><a href="/gostd/strings/replace.go.html#2960927">last</a></span>&nbsp;<span class="op" id="2961025">!=</span>&nbsp;<span class="ident" id="2961028"><a href="/gostd/strings/replace.go.html#2960942">i</a></span>&nbsp;<span class="op" id="2961030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2961035">nw</span><span class="op" id="2961037">,</span>&nbsp;<span class="ident" id="2961039">err</span>&nbsp;<span class="op" id="2961043">:=</span>&nbsp;<span class="ident" id="2961046"><a href="/gostd/strings/replace.go.html#2960901">sw</a></span><span class="op" id="2961048">.</span><span class="ident" id="2961049"><a href="/gostd/strings/replace.go.html#2956418">WriteString</a></span><span class="op" id="2961060">(</span><span class="ident" id="2961061"><a href="/gostd/strings/replace.go.html#2960869">s</a></span><span class="op" id="2961062">[</span><span class="ident" id="2961063"><a href="/gostd/strings/replace.go.html#2960927">last</a></span><span class="op" id="2961067">:</span><span class="ident" id="2961068"><a href="/gostd/strings/replace.go.html#2960942">i</a></span><span class="op" id="2961069">]</span><span class="op" id="2961070">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2961075"><a href="/gostd/strings/replace.go.html#2960880">n</a></span>&nbsp;<span class="op" id="2961077">+=</span>&nbsp;<span class="ident" id="2961080"><a href="/gostd/strings/replace.go.html#2961035">nw</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2961086">if</span>&nbsp;<span class="ident" id="2961089"><a href="/gostd/strings/replace.go.html#2961039">err</a></span>&nbsp;<span class="op" id="2961093">!=</span>&nbsp;<span class="builtintype" id="2961096">nil</span>&nbsp;<span class="op" id="2961100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2961106">return</span>&nbsp;<span class="ident" id="2961113"><a href="/gostd/strings/replace.go.html#2960880">n</a></span><span class="op" id="2961114">,</span>&nbsp;<span class="ident" id="2961116"><a href="/gostd/strings/replace.go.html#2961039">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2961123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2961127">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2961131"><a href="/gostd/strings/replace.go.html#2960927">last</a></span>&nbsp;<span class="op" id="2961136">=</span>&nbsp;<span class="ident" id="2961138"><a href="/gostd/strings/replace.go.html#2960942">i</a></span>&nbsp;<span class="op" id="2961140">+</span>&nbsp;<span class="num" id="2961142">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2961146">nw</span><span class="op" id="2961148">,</span>&nbsp;<span class="ident" id="2961150">err</span>&nbsp;<span class="op" id="2961154">:=</span>&nbsp;<span class="ident" id="2961157"><a href="/gostd/strings/replace.go.html#2960856">w</a></span><span class="op" id="2961158">.</span><span class="ident" id="2961159"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="2961164">(</span><span class="ident" id="2961165"><a href="/gostd/strings/replace.go.html#2960821">r</a></span><span class="op" id="2961166">[</span><span class="ident" id="2961167"><a href="/gostd/strings/replace.go.html#2960970">b</a></span><span class="op" id="2961168">]</span><span class="op" id="2961169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2961173"><a href="/gostd/strings/replace.go.html#2960880">n</a></span>&nbsp;<span class="op" id="2961175">+=</span>&nbsp;<span class="ident" id="2961178"><a href="/gostd/strings/replace.go.html#2961146">nw</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2961183">if</span>&nbsp;<span class="ident" id="2961186"><a href="/gostd/strings/replace.go.html#2961150">err</a></span>&nbsp;<span class="op" id="2961190">!=</span>&nbsp;<span class="builtintype" id="2961193">nil</span>&nbsp;<span class="op" id="2961197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2961202">return</span>&nbsp;<span class="ident" id="2961209"><a href="/gostd/strings/replace.go.html#2960880">n</a></span><span class="op" id="2961210">,</span>&nbsp;<span class="ident" id="2961212"><a href="/gostd/strings/replace.go.html#2961150">err</a></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2961218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2961221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2961224">if</span>&nbsp;<span class="ident" id="2961227"><a href="/gostd/strings/replace.go.html#2960927">last</a></span>&nbsp;<span class="op" id="2961232">!=</span>&nbsp;<span class="builtinfunc" id="2961235">len</span><span class="op" id="2961238">(</span><span class="ident" id="2961239"><a href="/gostd/strings/replace.go.html#2960869">s</a></span><span class="op" id="2961240">)</span>&nbsp;<span class="op" id="2961242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2961246">var</span>&nbsp;<span class="ident" id="2961250">nw</span>&nbsp;<span class="builtintype" id="2961253">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2961259"><a href="/gostd/strings/replace.go.html#2961250">nw</a></span><span class="op" id="2961261">,</span>&nbsp;<span class="ident" id="2961263"><a href="/gostd/strings/replace.go.html#2960887">err</a></span>&nbsp;<span class="op" id="2961267">=</span>&nbsp;<span class="ident" id="2961269"><a href="/gostd/strings/replace.go.html#2960901">sw</a></span><span class="op" id="2961271">.</span><span class="ident" id="2961272"><a href="/gostd/strings/replace.go.html#2956418">WriteString</a></span><span class="op" id="2961283">(</span><span class="ident" id="2961284"><a href="/gostd/strings/replace.go.html#2960869">s</a></span><span class="op" id="2961285">[</span><span class="ident" id="2961286"><a href="/gostd/strings/replace.go.html#2960927">last</a></span><span class="op" id="2961290">:</span><span class="op" id="2961291">]</span><span class="op" id="2961292">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2961296"><a href="/gostd/strings/replace.go.html#2960880">n</a></span>&nbsp;<span class="op" id="2961298">+=</span>&nbsp;<span class="ident" id="2961301"><a href="/gostd/strings/replace.go.html#2961250">nw</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2961305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2961308">return</span><br>
<span class="lineno"></span><span class="op" id="2961315">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
