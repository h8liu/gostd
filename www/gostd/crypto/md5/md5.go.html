<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/md5</h2>
<ul>
<li><a href="/gostd/crypto/md5/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/md5/md5.go.html">md5.go</a></li>
<li><a href="/gostd/crypto/md5/md5_test.go.html">md5_test.go</a></li>
<li><a href="/gostd/crypto/md5/md5block.go.html">md5block.go</a></li>
<li><a href="/gostd/crypto/md5/md5block_decl.go.html">md5block_decl.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3193003">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3193058">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3193112">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3193163">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-full&nbsp;-output&nbsp;md5block.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3193218">//&nbsp;Package&nbsp;md5&nbsp;implements&nbsp;the&nbsp;MD5&nbsp;hash&nbsp;algorithm&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;1321.</span><br>
<span class="lineno"></span><span class="keyword" id="3193291">package</span>&nbsp;<span class="ident" id="3193299">md5</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3193304">import</span>&nbsp;<span class="op" id="3193311">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3193314">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3193324">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="3193331">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="3193334">func</span>&nbsp;<span class="ident" id="3193339">init</span><span class="op" id="3193343">(</span><span class="op" id="3193344">)</span>&nbsp;<span class="op" id="3193346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193349">crypto</span><span class="op" id="3193355">.</span><span class="ident" id="3193356">RegisterHash</span><span class="op" id="3193368">(</span><span class="ident" id="3193369">crypto</span><span class="op" id="3193375">.</span><span class="ident" id="3193376">MD5</span><span class="op" id="3193379">,</span>&nbsp;<span class="ident" id="3193381">New</span><span class="op" id="3193384">)</span><br>
<span class="lineno"></span><span class="op" id="3193386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3193389">//&nbsp;The&nbsp;size&nbsp;of&nbsp;an&nbsp;MD5&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno">20</span><span class="keyword" id="3193430">const</span>&nbsp;<span class="ident" id="3193436">Size</span>&nbsp;<span class="op" id="3193441">=</span>&nbsp;<span class="num" id="3193443">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3193447">//&nbsp;The&nbsp;blocksize&nbsp;of&nbsp;MD5&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3193481">const</span>&nbsp;<span class="ident" id="3193487">BlockSize</span>&nbsp;<span class="op" id="3193497">=</span>&nbsp;<span class="num" id="3193499">64</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="3193503">const</span>&nbsp;<span class="op" id="3193509">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193512">chunk</span>&nbsp;<span class="op" id="3193518">=</span>&nbsp;<span class="num" id="3193520">64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193524">init0</span>&nbsp;<span class="op" id="3193530">=</span>&nbsp;<span class="num" id="3193532">0x67452301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193544">init1</span>&nbsp;<span class="op" id="3193550">=</span>&nbsp;<span class="num" id="3193552">0xEFCDAB89</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193564">init2</span>&nbsp;<span class="op" id="3193570">=</span>&nbsp;<span class="num" id="3193572">0x98BADCFE</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193584">init3</span>&nbsp;<span class="op" id="3193590">=</span>&nbsp;<span class="num" id="3193592">0x10325476</span><br>
<span class="lineno"></span><span class="op" id="3193603">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3193606">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="3193665">type</span>&nbsp;<span class="ident" id="3193670">digest</span>&nbsp;<span class="keyword" id="3193677">struct</span>&nbsp;<span class="op" id="3193684">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193687">s</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3193691">[</span><span class="num" id="3193692">4</span><span class="op" id="3193693">]</span><span class="builtintype" id="3193694">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193702">x</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3193706">[</span><span class="ident" id="3193707">chunk</span><span class="op" id="3193712">]</span><span class="builtintype" id="3193713">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193719">nx</span>&nbsp;&nbsp;<span class="builtintype" id="3193723">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3193728">len</span>&nbsp;<span class="ident" id="3193732">uint64</span><br>
<span class="lineno"></span><span class="op" id="3193739">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="3193742">func</span>&nbsp;<span class="op" id="3193747">(</span><span class="ident" id="3193748">d</span>&nbsp;<span class="op" id="3193750">*</span><span class="ident" id="3193751">digest</span><span class="op" id="3193757">)</span>&nbsp;<span class="ident" id="3193759">Reset</span><span class="op" id="3193764">(</span><span class="op" id="3193765">)</span>&nbsp;<span class="op" id="3193767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193770">d</span><span class="op" id="3193771">.</span><span class="ident" id="3193772">s</span><span class="op" id="3193773">[</span><span class="num" id="3193774">0</span><span class="op" id="3193775">]</span>&nbsp;<span class="op" id="3193777">=</span>&nbsp;<span class="ident" id="3193779">init0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193786">d</span><span class="op" id="3193787">.</span><span class="ident" id="3193788">s</span><span class="op" id="3193789">[</span><span class="num" id="3193790">1</span><span class="op" id="3193791">]</span>&nbsp;<span class="op" id="3193793">=</span>&nbsp;<span class="ident" id="3193795">init1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193802">d</span><span class="op" id="3193803">.</span><span class="ident" id="3193804">s</span><span class="op" id="3193805">[</span><span class="num" id="3193806">2</span><span class="op" id="3193807">]</span>&nbsp;<span class="op" id="3193809">=</span>&nbsp;<span class="ident" id="3193811">init2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193818">d</span><span class="op" id="3193819">.</span><span class="ident" id="3193820">s</span><span class="op" id="3193821">[</span><span class="num" id="3193822">3</span><span class="op" id="3193823">]</span>&nbsp;<span class="op" id="3193825">=</span>&nbsp;<span class="ident" id="3193827">init3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193834">d</span><span class="op" id="3193835">.</span><span class="ident" id="3193836">nx</span>&nbsp;<span class="op" id="3193839">=</span>&nbsp;<span class="num" id="3193841">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193844">d</span><span class="op" id="3193845">.</span><span class="builtinfunc" id="3193846">len</span>&nbsp;<span class="op" id="3193850">=</span>&nbsp;<span class="num" id="3193852">0</span><br>
<span class="lineno"></span><span class="op" id="3193854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="3193857">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;hash.Hash&nbsp;computing&nbsp;the&nbsp;MD5&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="3193916">func</span>&nbsp;<span class="ident" id="3193921">New</span><span class="op" id="3193924">(</span><span class="op" id="3193925">)</span>&nbsp;<span class="ident" id="3193927">hash</span><span class="op" id="3193931">.</span><span class="ident" id="3193932">Hash</span>&nbsp;<span class="op" id="3193937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193940">d</span>&nbsp;<span class="op" id="3193942">:=</span>&nbsp;<span class="builtinfunc" id="3193945">new</span><span class="op" id="3193948">(</span><span class="ident" id="3193949">digest</span><span class="op" id="3193955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3193958">d</span><span class="op" id="3193959">.</span><span class="ident" id="3193960">Reset</span><span class="op" id="3193965">(</span><span class="op" id="3193966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3193969">return</span>&nbsp;<span class="ident" id="3193976">d</span><br>
<span class="lineno">55</span><span class="op" id="3193978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3193981">func</span>&nbsp;<span class="op" id="3193986">(</span><span class="ident" id="3193987">d</span>&nbsp;<span class="op" id="3193989">*</span><span class="ident" id="3193990">digest</span><span class="op" id="3193996">)</span>&nbsp;<span class="ident" id="3193998">Size</span><span class="op" id="3194002">(</span><span class="op" id="3194003">)</span>&nbsp;<span class="builtintype" id="3194005">int</span>&nbsp;<span class="op" id="3194009">{</span>&nbsp;<span class="keyword" id="3194011">return</span>&nbsp;<span class="ident" id="3194018">Size</span>&nbsp;<span class="op" id="3194023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3194026">func</span>&nbsp;<span class="op" id="3194031">(</span><span class="ident" id="3194032">d</span>&nbsp;<span class="op" id="3194034">*</span><span class="ident" id="3194035">digest</span><span class="op" id="3194041">)</span>&nbsp;<span class="ident" id="3194043">BlockSize</span><span class="op" id="3194052">(</span><span class="op" id="3194053">)</span>&nbsp;<span class="builtintype" id="3194055">int</span>&nbsp;<span class="op" id="3194059">{</span>&nbsp;<span class="keyword" id="3194061">return</span>&nbsp;<span class="ident" id="3194068">BlockSize</span>&nbsp;<span class="op" id="3194078">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3194081">func</span>&nbsp;<span class="op" id="3194086">(</span><span class="ident" id="3194087">d</span>&nbsp;<span class="op" id="3194089">*</span><span class="ident" id="3194090">digest</span><span class="op" id="3194096">)</span>&nbsp;<span class="ident" id="3194098">Write</span><span class="op" id="3194103">(</span><span class="ident" id="3194104">p</span>&nbsp;<span class="op" id="3194106">[</span><span class="op" id="3194107">]</span><span class="builtintype" id="3194108">byte</span><span class="op" id="3194112">)</span>&nbsp;<span class="op" id="3194114">(</span><span class="ident" id="3194115">nn</span>&nbsp;<span class="builtintype" id="3194118">int</span><span class="op" id="3194121">,</span>&nbsp;<span class="ident" id="3194123">err</span>&nbsp;<span class="builtintype" id="3194127">error</span><span class="op" id="3194132">)</span>&nbsp;<span class="op" id="3194134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194137">nn</span>&nbsp;<span class="op" id="3194140">=</span>&nbsp;<span class="builtinfunc" id="3194142">len</span><span class="op" id="3194145">(</span><span class="ident" id="3194146">p</span><span class="op" id="3194147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194150">d</span><span class="op" id="3194151">.</span><span class="builtinfunc" id="3194152">len</span>&nbsp;<span class="op" id="3194156">+=</span>&nbsp;<span class="ident" id="3194159">uint64</span><span class="op" id="3194165">(</span><span class="ident" id="3194166">nn</span><span class="op" id="3194168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194171">if</span>&nbsp;<span class="ident" id="3194174">d</span><span class="op" id="3194175">.</span><span class="ident" id="3194176">nx</span>&nbsp;<span class="op" id="3194179">&gt;</span>&nbsp;<span class="num" id="3194181">0</span>&nbsp;<span class="op" id="3194183">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194187">n</span>&nbsp;<span class="op" id="3194189">:=</span>&nbsp;<span class="builtinfunc" id="3194192">len</span><span class="op" id="3194195">(</span><span class="ident" id="3194196">p</span><span class="op" id="3194197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194201">if</span>&nbsp;<span class="ident" id="3194204">n</span>&nbsp;<span class="op" id="3194206">&gt;</span>&nbsp;<span class="ident" id="3194208">chunk</span><span class="op" id="3194213">-</span><span class="ident" id="3194214">d</span><span class="op" id="3194215">.</span><span class="ident" id="3194216">nx</span>&nbsp;<span class="op" id="3194219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194224">n</span>&nbsp;<span class="op" id="3194226">=</span>&nbsp;<span class="ident" id="3194228">chunk</span>&nbsp;<span class="op" id="3194234">-</span>&nbsp;<span class="ident" id="3194236">d</span><span class="op" id="3194237">.</span><span class="ident" id="3194238">nx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194247">for</span>&nbsp;<span class="ident" id="3194251">i</span>&nbsp;<span class="op" id="3194253">:=</span>&nbsp;<span class="num" id="3194256">0</span><span class="op" id="3194257">;</span>&nbsp;<span class="ident" id="3194259">i</span>&nbsp;<span class="op" id="3194261">&lt;</span>&nbsp;<span class="ident" id="3194263">n</span><span class="op" id="3194264">;</span>&nbsp;<span class="ident" id="3194266">i</span><span class="op" id="3194267">++</span>&nbsp;<span class="op" id="3194270">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194275">d</span><span class="op" id="3194276">.</span><span class="ident" id="3194277">x</span><span class="op" id="3194278">[</span><span class="ident" id="3194279">d</span><span class="op" id="3194280">.</span><span class="ident" id="3194281">nx</span><span class="op" id="3194283">+</span><span class="ident" id="3194284">i</span><span class="op" id="3194285">]</span>&nbsp;<span class="op" id="3194287">=</span>&nbsp;<span class="ident" id="3194289">p</span><span class="op" id="3194290">[</span><span class="ident" id="3194291">i</span><span class="op" id="3194292">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194300">d</span><span class="op" id="3194301">.</span><span class="ident" id="3194302">nx</span>&nbsp;<span class="op" id="3194305">+=</span>&nbsp;<span class="ident" id="3194308">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194312">if</span>&nbsp;<span class="ident" id="3194315">d</span><span class="op" id="3194316">.</span><span class="ident" id="3194317">nx</span>&nbsp;<span class="op" id="3194320">==</span>&nbsp;<span class="ident" id="3194323">chunk</span>&nbsp;<span class="op" id="3194329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194334">block</span><span class="op" id="3194339">(</span><span class="ident" id="3194340">d</span><span class="op" id="3194341">,</span>&nbsp;<span class="ident" id="3194343">d</span><span class="op" id="3194344">.</span><span class="ident" id="3194345">x</span><span class="op" id="3194346">[</span><span class="num" id="3194347">0</span><span class="op" id="3194348">:</span><span class="ident" id="3194349">chunk</span><span class="op" id="3194354">]</span><span class="op" id="3194355">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194360">d</span><span class="op" id="3194361">.</span><span class="ident" id="3194362">nx</span>&nbsp;<span class="op" id="3194365">=</span>&nbsp;<span class="num" id="3194367">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194375">p</span>&nbsp;<span class="op" id="3194377">=</span>&nbsp;<span class="ident" id="3194379">p</span><span class="op" id="3194380">[</span><span class="ident" id="3194381">n</span><span class="op" id="3194382">:</span><span class="op" id="3194383">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194389">if</span>&nbsp;<span class="builtinfunc" id="3194392">len</span><span class="op" id="3194395">(</span><span class="ident" id="3194396">p</span><span class="op" id="3194397">)</span>&nbsp;<span class="op" id="3194399">&gt;=</span>&nbsp;<span class="ident" id="3194402">chunk</span>&nbsp;<span class="op" id="3194408">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194412">n</span>&nbsp;<span class="op" id="3194414">:=</span>&nbsp;<span class="builtinfunc" id="3194417">len</span><span class="op" id="3194420">(</span><span class="ident" id="3194421">p</span><span class="op" id="3194422">)</span>&nbsp;<span class="op" id="3194424">&amp;^</span>&nbsp;<span class="op" id="3194427">(</span><span class="ident" id="3194428">chunk</span>&nbsp;<span class="op" id="3194434">-</span>&nbsp;<span class="num" id="3194436">1</span><span class="op" id="3194437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194441">block</span><span class="op" id="3194446">(</span><span class="ident" id="3194447">d</span><span class="op" id="3194448">,</span>&nbsp;<span class="ident" id="3194450">p</span><span class="op" id="3194451">[</span><span class="op" id="3194452">:</span><span class="ident" id="3194453">n</span><span class="op" id="3194454">]</span><span class="op" id="3194455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194459">p</span>&nbsp;<span class="op" id="3194461">=</span>&nbsp;<span class="ident" id="3194463">p</span><span class="op" id="3194464">[</span><span class="ident" id="3194465">n</span><span class="op" id="3194466">:</span><span class="op" id="3194467">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194473">if</span>&nbsp;<span class="builtinfunc" id="3194476">len</span><span class="op" id="3194479">(</span><span class="ident" id="3194480">p</span><span class="op" id="3194481">)</span>&nbsp;<span class="op" id="3194483">&gt;</span>&nbsp;<span class="num" id="3194485">0</span>&nbsp;<span class="op" id="3194487">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194491">d</span><span class="op" id="3194492">.</span><span class="ident" id="3194493">nx</span>&nbsp;<span class="op" id="3194496">=</span>&nbsp;<span class="builtinfunc" id="3194498">copy</span><span class="op" id="3194502">(</span><span class="ident" id="3194503">d</span><span class="op" id="3194504">.</span><span class="ident" id="3194505">x</span><span class="op" id="3194506">[</span><span class="op" id="3194507">:</span><span class="op" id="3194508">]</span><span class="op" id="3194509">,</span>&nbsp;<span class="ident" id="3194511">p</span><span class="op" id="3194512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194518">return</span><br>
<span class="lineno"></span><span class="op" id="3194525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="3194528">func</span>&nbsp;<span class="op" id="3194533">(</span><span class="ident" id="3194534">d0</span>&nbsp;<span class="op" id="3194537">*</span><span class="ident" id="3194538">digest</span><span class="op" id="3194544">)</span>&nbsp;<span class="ident" id="3194546">Sum</span><span class="op" id="3194549">(</span><span class="ident" id="3194550">in</span>&nbsp;<span class="op" id="3194553">[</span><span class="op" id="3194554">]</span><span class="builtintype" id="3194555">byte</span><span class="op" id="3194559">)</span>&nbsp;<span class="op" id="3194561">[</span><span class="op" id="3194562">]</span><span class="builtintype" id="3194563">byte</span>&nbsp;<span class="op" id="3194568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3194571">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;d0&nbsp;so&nbsp;that&nbsp;caller&nbsp;can&nbsp;keep&nbsp;writing&nbsp;and&nbsp;summing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194638">d</span>&nbsp;<span class="op" id="3194640">:=</span>&nbsp;<span class="op" id="3194643">*</span><span class="ident" id="3194644">d0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194648">hash</span>&nbsp;<span class="op" id="3194653">:=</span>&nbsp;<span class="ident" id="3194656">d</span><span class="op" id="3194657">.</span><span class="ident" id="3194658">checkSum</span><span class="op" id="3194666">(</span><span class="op" id="3194667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194670">return</span>&nbsp;<span class="builtinfunc" id="3194677">append</span><span class="op" id="3194683">(</span><span class="ident" id="3194684">in</span><span class="op" id="3194686">,</span>&nbsp;<span class="ident" id="3194688">hash</span><span class="op" id="3194692">[</span><span class="op" id="3194693">:</span><span class="op" id="3194694">]</span><span class="op" id="3194695">...</span><span class="op" id="3194698">)</span><br>
<span class="lineno">95</span><span class="op" id="3194700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3194703">func</span>&nbsp;<span class="op" id="3194708">(</span><span class="ident" id="3194709">d</span>&nbsp;<span class="op" id="3194711">*</span><span class="ident" id="3194712">digest</span><span class="op" id="3194718">)</span>&nbsp;<span class="ident" id="3194720">checkSum</span><span class="op" id="3194728">(</span><span class="op" id="3194729">)</span>&nbsp;<span class="op" id="3194731">[</span><span class="ident" id="3194732">Size</span><span class="op" id="3194736">]</span><span class="builtintype" id="3194737">byte</span>&nbsp;<span class="op" id="3194742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3194745">//&nbsp;Padding.&nbsp;&nbsp;Add&nbsp;a&nbsp;1&nbsp;bit&nbsp;and&nbsp;0&nbsp;bits&nbsp;until&nbsp;56&nbsp;bytes&nbsp;mod&nbsp;64.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3194805">len</span>&nbsp;<span class="op" id="3194809">:=</span>&nbsp;<span class="ident" id="3194812">d</span><span class="op" id="3194813">.</span><span class="builtinfunc" id="3194814">len</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194819">var</span>&nbsp;<span class="ident" id="3194823">tmp</span>&nbsp;<span class="op" id="3194827">[</span><span class="num" id="3194828">64</span><span class="op" id="3194830">]</span><span class="builtintype" id="3194831">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194837">tmp</span><span class="op" id="3194840">[</span><span class="num" id="3194841">0</span><span class="op" id="3194842">]</span>&nbsp;<span class="op" id="3194844">=</span>&nbsp;<span class="num" id="3194846">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194852">if</span>&nbsp;<span class="builtinfunc" id="3194855">len</span><span class="op" id="3194858">%</span><span class="num" id="3194859">64</span>&nbsp;<span class="op" id="3194862">&lt;</span>&nbsp;<span class="num" id="3194864">56</span>&nbsp;<span class="op" id="3194867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194871">d</span><span class="op" id="3194872">.</span><span class="ident" id="3194873">Write</span><span class="op" id="3194878">(</span><span class="ident" id="3194879">tmp</span><span class="op" id="3194882">[</span><span class="num" id="3194883">0</span>&nbsp;<span class="op" id="3194885">:</span>&nbsp;<span class="num" id="3194887">56</span><span class="op" id="3194889">-</span><span class="builtinfunc" id="3194890">len</span><span class="op" id="3194893">%</span><span class="num" id="3194894">64</span><span class="op" id="3194896">]</span><span class="op" id="3194897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194900">}</span>&nbsp;<span class="keyword" id="3194902">else</span>&nbsp;<span class="op" id="3194907">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3194911">d</span><span class="op" id="3194912">.</span><span class="ident" id="3194913">Write</span><span class="op" id="3194918">(</span><span class="ident" id="3194919">tmp</span><span class="op" id="3194922">[</span><span class="num" id="3194923">0</span>&nbsp;<span class="op" id="3194925">:</span>&nbsp;<span class="num" id="3194927">64</span><span class="op" id="3194929">+</span><span class="num" id="3194930">56</span><span class="op" id="3194932">-</span><span class="builtinfunc" id="3194933">len</span><span class="op" id="3194936">%</span><span class="num" id="3194937">64</span><span class="op" id="3194939">]</span><span class="op" id="3194940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3194943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3194947">//&nbsp;Length&nbsp;in&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3194967">len</span>&nbsp;<span class="op" id="3194971">&lt;&lt;=</span>&nbsp;<span class="num" id="3194975">3</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3194978">for</span>&nbsp;<span class="ident" id="3194982">i</span>&nbsp;<span class="op" id="3194984">:=</span>&nbsp;<span class="builtintype" id="3194987">uint</span><span class="op" id="3194991">(</span><span class="num" id="3194992">0</span><span class="op" id="3194993">)</span><span class="op" id="3194994">;</span>&nbsp;<span class="ident" id="3194996">i</span>&nbsp;<span class="op" id="3194998">&lt;</span>&nbsp;<span class="num" id="3195000">8</span><span class="op" id="3195001">;</span>&nbsp;<span class="ident" id="3195003">i</span><span class="op" id="3195004">++</span>&nbsp;<span class="op" id="3195007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3195011">tmp</span><span class="op" id="3195014">[</span><span class="ident" id="3195015">i</span><span class="op" id="3195016">]</span>&nbsp;<span class="op" id="3195018">=</span>&nbsp;<span class="builtintype" id="3195020">byte</span><span class="op" id="3195024">(</span><span class="builtinfunc" id="3195025">len</span>&nbsp;<span class="op" id="3195029">&gt;&gt;</span>&nbsp;<span class="op" id="3195032">(</span><span class="num" id="3195033">8</span>&nbsp;<span class="op" id="3195035">*</span>&nbsp;<span class="ident" id="3195037">i</span><span class="op" id="3195038">)</span><span class="op" id="3195039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3195042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3195045">d</span><span class="op" id="3195046">.</span><span class="ident" id="3195047">Write</span><span class="op" id="3195052">(</span><span class="ident" id="3195053">tmp</span><span class="op" id="3195056">[</span><span class="num" id="3195057">0</span><span class="op" id="3195058">:</span><span class="num" id="3195059">8</span><span class="op" id="3195060">]</span><span class="op" id="3195061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195065">if</span>&nbsp;<span class="ident" id="3195068">d</span><span class="op" id="3195069">.</span><span class="ident" id="3195070">nx</span>&nbsp;<span class="op" id="3195073">!=</span>&nbsp;<span class="num" id="3195076">0</span>&nbsp;<span class="op" id="3195078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3195082">panic</span><span class="op" id="3195087">(</span><span class="string" id="3195088">&#34;d.nx&nbsp;!=&nbsp;0&#34;</span><span class="op" id="3195099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3195102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195106">var</span>&nbsp;<span class="ident" id="3195110">digest</span>&nbsp;<span class="op" id="3195117">[</span><span class="ident" id="3195118">Size</span><span class="op" id="3195122">]</span><span class="builtintype" id="3195123">byte</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195129">for</span>&nbsp;<span class="ident" id="3195133">i</span><span class="op" id="3195134">,</span>&nbsp;<span class="ident" id="3195136">s</span>&nbsp;<span class="op" id="3195138">:=</span>&nbsp;<span class="keyword" id="3195141">range</span>&nbsp;<span class="ident" id="3195147">d</span><span class="op" id="3195148">.</span><span class="ident" id="3195149">s</span>&nbsp;<span class="op" id="3195151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3195155">digest</span><span class="op" id="3195161">[</span><span class="ident" id="3195162">i</span><span class="op" id="3195163">*</span><span class="num" id="3195164">4</span><span class="op" id="3195165">]</span>&nbsp;<span class="op" id="3195167">=</span>&nbsp;<span class="builtintype" id="3195169">byte</span><span class="op" id="3195173">(</span><span class="ident" id="3195174">s</span><span class="op" id="3195175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3195179">digest</span><span class="op" id="3195185">[</span><span class="ident" id="3195186">i</span><span class="op" id="3195187">*</span><span class="num" id="3195188">4</span><span class="op" id="3195189">+</span><span class="num" id="3195190">1</span><span class="op" id="3195191">]</span>&nbsp;<span class="op" id="3195193">=</span>&nbsp;<span class="builtintype" id="3195195">byte</span><span class="op" id="3195199">(</span><span class="ident" id="3195200">s</span>&nbsp;<span class="op" id="3195202">&gt;&gt;</span>&nbsp;<span class="num" id="3195205">8</span><span class="op" id="3195206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3195210">digest</span><span class="op" id="3195216">[</span><span class="ident" id="3195217">i</span><span class="op" id="3195218">*</span><span class="num" id="3195219">4</span><span class="op" id="3195220">+</span><span class="num" id="3195221">2</span><span class="op" id="3195222">]</span>&nbsp;<span class="op" id="3195224">=</span>&nbsp;<span class="builtintype" id="3195226">byte</span><span class="op" id="3195230">(</span><span class="ident" id="3195231">s</span>&nbsp;<span class="op" id="3195233">&gt;&gt;</span>&nbsp;<span class="num" id="3195236">16</span><span class="op" id="3195238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3195242">digest</span><span class="op" id="3195248">[</span><span class="ident" id="3195249">i</span><span class="op" id="3195250">*</span><span class="num" id="3195251">4</span><span class="op" id="3195252">+</span><span class="num" id="3195253">3</span><span class="op" id="3195254">]</span>&nbsp;<span class="op" id="3195256">=</span>&nbsp;<span class="builtintype" id="3195258">byte</span><span class="op" id="3195262">(</span><span class="ident" id="3195263">s</span>&nbsp;<span class="op" id="3195265">&gt;&gt;</span>&nbsp;<span class="num" id="3195268">24</span><span class="op" id="3195270">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3195273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195277">return</span>&nbsp;<span class="ident" id="3195284">digest</span><br>
<span class="lineno"></span><span class="op" id="3195291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3195294">//&nbsp;Sum&nbsp;returns&nbsp;the&nbsp;MD5&nbsp;checksum&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3195339">func</span>&nbsp;<span class="ident" id="3195344">Sum</span><span class="op" id="3195347">(</span><span class="ident" id="3195348">data</span>&nbsp;<span class="op" id="3195353">[</span><span class="op" id="3195354">]</span><span class="builtintype" id="3195355">byte</span><span class="op" id="3195359">)</span>&nbsp;<span class="op" id="3195361">[</span><span class="ident" id="3195362">Size</span><span class="op" id="3195366">]</span><span class="builtintype" id="3195367">byte</span>&nbsp;<span class="op" id="3195372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195375">var</span>&nbsp;<span class="ident" id="3195379">d</span>&nbsp;<span class="ident" id="3195381">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3195389">d</span><span class="op" id="3195390">.</span><span class="ident" id="3195391">Reset</span><span class="op" id="3195396">(</span><span class="op" id="3195397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3195400">d</span><span class="op" id="3195401">.</span><span class="ident" id="3195402">Write</span><span class="op" id="3195407">(</span><span class="ident" id="3195408">data</span><span class="op" id="3195412">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3195415">return</span>&nbsp;<span class="ident" id="3195422">d</span><span class="op" id="3195423">.</span><span class="ident" id="3195424">checkSum</span><span class="op" id="3195432">(</span><span class="op" id="3195433">)</span><br>
<span class="lineno"></span><span class="op" id="3195435">}</span>
</div>
</body>
</html>
