<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3395348">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3395403">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3395457">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3395508">//&nbsp;Package&nbsp;parse&nbsp;builds&nbsp;parse&nbsp;trees&nbsp;for&nbsp;templates&nbsp;as&nbsp;defined&nbsp;by&nbsp;text/template</span><br>
<span class="lineno"></span><span class="comment" id="3395586">//&nbsp;and&nbsp;html/template.&nbsp;Clients&nbsp;should&nbsp;use&nbsp;those&nbsp;packages&nbsp;to&nbsp;construct&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="3395665">//&nbsp;rather&nbsp;than&nbsp;this&nbsp;one,&nbsp;which&nbsp;provides&nbsp;shared&nbsp;internal&nbsp;data&nbsp;structures&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3395741">//&nbsp;intended&nbsp;for&nbsp;general&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="3395770">package</span>&nbsp;<span class="ident" id="3395778">parse</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="3395785">import</span>&nbsp;<span class="op" id="3395792">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3395795">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3395804">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3395811">&#34;runtime&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3395822">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3395833">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3395843">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3395846">//&nbsp;Tree&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;single&nbsp;parsed&nbsp;template.</span><br>
<span class="lineno">20</span><span class="keyword" id="3395905">type</span>&nbsp;<span class="ident" id="3395910">Tree</span>&nbsp;<span class="keyword" id="3395915">struct</span>&nbsp;<span class="op" id="3395922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395925">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3395935">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3395945">//&nbsp;name&nbsp;of&nbsp;the&nbsp;template&nbsp;represented&nbsp;by&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395995">ParseName</span>&nbsp;<span class="builtintype" id="3396005">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3396015">//&nbsp;name&nbsp;of&nbsp;the&nbsp;top-level&nbsp;template&nbsp;during&nbsp;parsing,&nbsp;for&nbsp;error&nbsp;messages.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396086">Root</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3396096">*</span><span class="ident" id="3396097"><a href="/text/template/parse/node.go.html#3377404">ListNode</a></span>&nbsp;<span class="comment" id="3396106">//&nbsp;top-level&nbsp;root&nbsp;of&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396138">text</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3396148">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3396158">//&nbsp;text&nbsp;parsed&nbsp;to&nbsp;create&nbsp;the&nbsp;template&nbsp;(or&nbsp;its&nbsp;parent)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3396213">//&nbsp;Parsing&nbsp;only;&nbsp;cleared&nbsp;after&nbsp;parse.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396252">funcs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3396262">[</span><span class="op" id="3396263">]</span><span class="keyword" id="3396264">map</span><span class="op" id="3396267">[</span><span class="builtintype" id="3396268">string</span><span class="op" id="3396274">]</span><span class="keyword" id="3396275">interface</span><span class="op" id="3396284">{</span><span class="op" id="3396285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396288">lex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3396298">*</span><span class="ident" id="3396299"><a href="/text/template/parse/lex.go.html#3363729">lexer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396306">token</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3396316">[</span><span class="num" id="3396317">3</span><span class="op" id="3396318">]</span><span class="ident" id="3396319"><a href="/text/template/parse/lex.go.html#3361242">item</a></span>&nbsp;<span class="comment" id="3396324">//&nbsp;three-token&nbsp;lookahead&nbsp;for&nbsp;parser.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396362">peekCount</span>&nbsp;<span class="builtintype" id="3396372">int</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396377">vars</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3396387">[</span><span class="op" id="3396388">]</span><span class="builtintype" id="3396389">string</span>&nbsp;<span class="comment" id="3396396">//&nbsp;variables&nbsp;defined&nbsp;at&nbsp;the&nbsp;moment.</span><br>
<span class="lineno"></span><span class="op" id="3396432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3396435">//&nbsp;Copy&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;Tree.&nbsp;Any&nbsp;parsing&nbsp;state&nbsp;is&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="3396503">func</span>&nbsp;<span class="op" id="3396508">(</span><span class="ident" id="3396509">t</span>&nbsp;<span class="op" id="3396511">*</span><span class="ident" id="3396512"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3396516">)</span>&nbsp;<span class="ident" id="3396518">Copy</span><span class="op" id="3396522">(</span><span class="op" id="3396523">)</span>&nbsp;<span class="op" id="3396525">*</span><span class="ident" id="3396526"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span>&nbsp;<span class="op" id="3396531">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396534">if</span>&nbsp;<span class="ident" id="3396537"><a href="/text/template/parse/parse.go.html#3396509">t</a></span>&nbsp;<span class="op" id="3396539">==</span>&nbsp;<span class="ident" id="3396542">nil</span>&nbsp;<span class="op" id="3396546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396550">return</span>&nbsp;<span class="ident" id="3396557">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3396562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396565">return</span>&nbsp;<span class="op" id="3396572">&amp;</span><span class="ident" id="3396573"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3396577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396581">Name</span><span class="op" id="3396585">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396592"><a href="/text/template/parse/parse.go.html#3396509">t</a></span><span class="op" id="3396593">.</span><span class="ident" id="3396594">Name</span><span class="op" id="3396598">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396602">ParseName</span><span class="op" id="3396611">:</span>&nbsp;<span class="ident" id="3396613"><a href="/text/template/parse/parse.go.html#3396509">t</a></span><span class="op" id="3396614">.</span><span class="ident" id="3396615">ParseName</span><span class="op" id="3396624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396628">Root</span><span class="op" id="3396632">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396639"><a href="/text/template/parse/parse.go.html#3396509">t</a></span><span class="op" id="3396640">.</span><span class="ident" id="3396641">Root</span><span class="op" id="3396645">.</span><span class="ident" id="3396646">CopyList</span><span class="op" id="3396654">(</span><span class="op" id="3396655">)</span><span class="op" id="3396656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396660">text</span><span class="op" id="3396664">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396671"><a href="/text/template/parse/parse.go.html#3396509">t</a></span><span class="op" id="3396672">.</span><span class="ident" id="3396673">text</span><span class="op" id="3396677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3396680">}</span><br>
<span class="lineno"></span><span class="op" id="3396682">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3396685">//&nbsp;Parse&nbsp;returns&nbsp;a&nbsp;map&nbsp;from&nbsp;template&nbsp;name&nbsp;to&nbsp;parse.Tree,&nbsp;created&nbsp;by&nbsp;parsing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3396765">//&nbsp;templates&nbsp;described&nbsp;in&nbsp;the&nbsp;argument&nbsp;string.&nbsp;The&nbsp;top-level&nbsp;template&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3396843">//&nbsp;given&nbsp;the&nbsp;specified&nbsp;name.&nbsp;If&nbsp;an&nbsp;error&nbsp;is&nbsp;encountered,&nbsp;parsing&nbsp;stops&nbsp;and&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3396921">//&nbsp;empty&nbsp;map&nbsp;is&nbsp;returned&nbsp;with&nbsp;the&nbsp;error.</span><br>
<span class="lineno">50</span><span class="keyword" id="3396962">func</span>&nbsp;<span class="ident" id="3396967">Parse</span><span class="op" id="3396972">(</span><span class="ident" id="3396973">name</span><span class="op" id="3396977">,</span>&nbsp;<span class="ident" id="3396979">text</span><span class="op" id="3396983">,</span>&nbsp;<span class="ident" id="3396985">leftDelim</span><span class="op" id="3396994">,</span>&nbsp;<span class="ident" id="3396996">rightDelim</span>&nbsp;<span class="builtintype" id="3397007">string</span><span class="op" id="3397013">,</span>&nbsp;<span class="ident" id="3397015">funcs</span>&nbsp;<span class="op" id="3397021">...</span><span class="keyword" id="3397024">map</span><span class="op" id="3397027">[</span><span class="builtintype" id="3397028">string</span><span class="op" id="3397034">]</span><span class="keyword" id="3397035">interface</span><span class="op" id="3397044">{</span><span class="op" id="3397045">}</span><span class="op" id="3397046">)</span>&nbsp;<span class="op" id="3397048">(</span><span class="ident" id="3397049">treeSet</span>&nbsp;<span class="keyword" id="3397057">map</span><span class="op" id="3397060">[</span><span class="builtintype" id="3397061">string</span><span class="op" id="3397067">]</span><span class="op" id="3397068">*</span><span class="ident" id="3397069"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3397073">,</span>&nbsp;<span class="ident" id="3397075">err</span>&nbsp;<span class="builtintype" id="3397079">error</span><span class="op" id="3397084">)</span>&nbsp;<span class="op" id="3397086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397089"><a href="/text/template/parse/parse.go.html#3397049">treeSet</a></span>&nbsp;<span class="op" id="3397097">=</span>&nbsp;<span class="builtinfunc" id="3397099">make</span><span class="op" id="3397103">(</span><span class="keyword" id="3397104">map</span><span class="op" id="3397107">[</span><span class="builtintype" id="3397108">string</span><span class="op" id="3397114">]</span><span class="op" id="3397115">*</span><span class="ident" id="3397116"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3397120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397123">t</span>&nbsp;<span class="op" id="3397125">:=</span>&nbsp;<span class="ident" id="3397128"><a href="/text/template/parse/parse.go.html#3398556">New</a></span><span class="op" id="3397131">(</span><span class="ident" id="3397132"><a href="/text/template/parse/parse.go.html#3396973">name</a></span><span class="op" id="3397136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397139"><a href="/text/template/parse/parse.go.html#3397123">t</a></span><span class="op" id="3397140">.</span><span class="ident" id="3397141">text</span>&nbsp;<span class="op" id="3397146">=</span>&nbsp;<span class="ident" id="3397148"><a href="/text/template/parse/parse.go.html#3396979">text</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397154">_</span><span class="op" id="3397155">,</span>&nbsp;<span class="ident" id="3397157"><a href="/text/template/parse/parse.go.html#3397075">err</a></span>&nbsp;<span class="op" id="3397161">=</span>&nbsp;<span class="ident" id="3397163"><a href="/text/template/parse/parse.go.html#3397123">t</a></span><span class="op" id="3397164">.</span><span class="ident" id="3397165">Parse</span><span class="op" id="3397170">(</span><span class="ident" id="3397171"><a href="/text/template/parse/parse.go.html#3396979">text</a></span><span class="op" id="3397175">,</span>&nbsp;<span class="ident" id="3397177"><a href="/text/template/parse/parse.go.html#3396985">leftDelim</a></span><span class="op" id="3397186">,</span>&nbsp;<span class="ident" id="3397188"><a href="/text/template/parse/parse.go.html#3396996">rightDelim</a></span><span class="op" id="3397198">,</span>&nbsp;<span class="ident" id="3397200"><a href="/text/template/parse/parse.go.html#3397049">treeSet</a></span><span class="op" id="3397207">,</span>&nbsp;<span class="ident" id="3397209"><a href="/text/template/parse/parse.go.html#3397015">funcs</a></span><span class="op" id="3397214">...</span><span class="op" id="3397217">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397220">return</span><br>
<span class="lineno"></span><span class="op" id="3397227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3397230">//&nbsp;next&nbsp;returns&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="3397262">func</span>&nbsp;<span class="op" id="3397267">(</span><span class="ident" id="3397268">t</span>&nbsp;<span class="op" id="3397270">*</span><span class="ident" id="3397271"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3397275">)</span>&nbsp;<span class="ident" id="3397277">next</span><span class="op" id="3397281">(</span><span class="op" id="3397282">)</span>&nbsp;<span class="ident" id="3397284"><a href="/text/template/parse/lex.go.html#3361242">item</a></span>&nbsp;<span class="op" id="3397289">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397292">if</span>&nbsp;<span class="ident" id="3397295"><a href="/text/template/parse/parse.go.html#3397268">t</a></span><span class="op" id="3397296">.</span><span class="ident" id="3397297">peekCount</span>&nbsp;<span class="op" id="3397307">&gt;</span>&nbsp;<span class="num" id="3397309">0</span>&nbsp;<span class="op" id="3397311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397315"><a href="/text/template/parse/parse.go.html#3397268">t</a></span><span class="op" id="3397316">.</span><span class="ident" id="3397317">peekCount</span><span class="op" id="3397326">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3397330">}</span>&nbsp;<span class="keyword" id="3397332">else</span>&nbsp;<span class="op" id="3397337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397341"><a href="/text/template/parse/parse.go.html#3397268">t</a></span><span class="op" id="3397342">.</span><span class="ident" id="3397343">token</span><span class="op" id="3397348">[</span><span class="num" id="3397349">0</span><span class="op" id="3397350">]</span>&nbsp;<span class="op" id="3397352">=</span>&nbsp;<span class="ident" id="3397354"><a href="/text/template/parse/parse.go.html#3397268">t</a></span><span class="op" id="3397355">.</span><span class="ident" id="3397356">lex</span><span class="op" id="3397359">.</span><span class="ident" id="3397360">nextItem</span><span class="op" id="3397368">(</span><span class="op" id="3397369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3397372">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397375">return</span>&nbsp;<span class="ident" id="3397382"><a href="/text/template/parse/parse.go.html#3397268">t</a></span><span class="op" id="3397383">.</span><span class="ident" id="3397384">token</span><span class="op" id="3397389">[</span><span class="ident" id="3397390"><a href="/text/template/parse/parse.go.html#3397268">t</a></span><span class="op" id="3397391">.</span><span class="ident" id="3397392">peekCount</span><span class="op" id="3397401">]</span><br>
<span class="lineno"></span><span class="op" id="3397403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3397406">//&nbsp;backup&nbsp;backs&nbsp;the&nbsp;input&nbsp;stream&nbsp;up&nbsp;one&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="3397453">func</span>&nbsp;<span class="op" id="3397458">(</span><span class="ident" id="3397459">t</span>&nbsp;<span class="op" id="3397461">*</span><span class="ident" id="3397462"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3397466">)</span>&nbsp;<span class="ident" id="3397468">backup</span><span class="op" id="3397474">(</span><span class="op" id="3397475">)</span>&nbsp;<span class="op" id="3397477">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397480"><a href="/text/template/parse/parse.go.html#3397459">t</a></span><span class="op" id="3397481">.</span><span class="ident" id="3397482">peekCount</span><span class="op" id="3397491">++</span><br>
<span class="lineno"></span><span class="op" id="3397494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3397497">//&nbsp;backup2&nbsp;backs&nbsp;the&nbsp;input&nbsp;stream&nbsp;up&nbsp;two&nbsp;tokens.</span><br>
<span class="lineno"></span><span class="comment" id="3397546">//&nbsp;The&nbsp;zeroth&nbsp;token&nbsp;is&nbsp;already&nbsp;there.</span><br>
<span class="lineno">75</span><span class="keyword" id="3397584">func</span>&nbsp;<span class="op" id="3397589">(</span><span class="ident" id="3397590">t</span>&nbsp;<span class="op" id="3397592">*</span><span class="ident" id="3397593"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3397597">)</span>&nbsp;<span class="ident" id="3397599">backup2</span><span class="op" id="3397606">(</span><span class="ident" id="3397607">t1</span>&nbsp;<span class="ident" id="3397610"><a href="/text/template/parse/lex.go.html#3361242">item</a></span><span class="op" id="3397614">)</span>&nbsp;<span class="op" id="3397616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397619"><a href="/text/template/parse/parse.go.html#3397590">t</a></span><span class="op" id="3397620">.</span><span class="ident" id="3397621">token</span><span class="op" id="3397626">[</span><span class="num" id="3397627">1</span><span class="op" id="3397628">]</span>&nbsp;<span class="op" id="3397630">=</span>&nbsp;<span class="ident" id="3397632"><a href="/text/template/parse/parse.go.html#3397607">t1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397636"><a href="/text/template/parse/parse.go.html#3397590">t</a></span><span class="op" id="3397637">.</span><span class="ident" id="3397638">peekCount</span>&nbsp;<span class="op" id="3397648">=</span>&nbsp;<span class="num" id="3397650">2</span><br>
<span class="lineno"></span><span class="op" id="3397652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="3397655">//&nbsp;backup3&nbsp;backs&nbsp;the&nbsp;input&nbsp;stream&nbsp;up&nbsp;three&nbsp;tokens</span><br>
<span class="lineno"></span><span class="comment" id="3397705">//&nbsp;The&nbsp;zeroth&nbsp;token&nbsp;is&nbsp;already&nbsp;there.</span><br>
<span class="lineno"></span><span class="keyword" id="3397743">func</span>&nbsp;<span class="op" id="3397748">(</span><span class="ident" id="3397749">t</span>&nbsp;<span class="op" id="3397751">*</span><span class="ident" id="3397752"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3397756">)</span>&nbsp;<span class="ident" id="3397758">backup3</span><span class="op" id="3397765">(</span><span class="ident" id="3397766">t2</span><span class="op" id="3397768">,</span>&nbsp;<span class="ident" id="3397770">t1</span>&nbsp;<span class="ident" id="3397773"><a href="/text/template/parse/lex.go.html#3361242">item</a></span><span class="op" id="3397777">)</span>&nbsp;<span class="op" id="3397779">{</span>&nbsp;<span class="comment" id="3397781">//&nbsp;Reverse&nbsp;order:&nbsp;we&#39;re&nbsp;pushing&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397820"><a href="/text/template/parse/parse.go.html#3397749">t</a></span><span class="op" id="3397821">.</span><span class="ident" id="3397822">token</span><span class="op" id="3397827">[</span><span class="num" id="3397828">1</span><span class="op" id="3397829">]</span>&nbsp;<span class="op" id="3397831">=</span>&nbsp;<span class="ident" id="3397833"><a href="/text/template/parse/parse.go.html#3397770">t1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397837"><a href="/text/template/parse/parse.go.html#3397749">t</a></span><span class="op" id="3397838">.</span><span class="ident" id="3397839">token</span><span class="op" id="3397844">[</span><span class="num" id="3397845">2</span><span class="op" id="3397846">]</span>&nbsp;<span class="op" id="3397848">=</span>&nbsp;<span class="ident" id="3397850"><a href="/text/template/parse/parse.go.html#3397766">t2</a></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397854"><a href="/text/template/parse/parse.go.html#3397749">t</a></span><span class="op" id="3397855">.</span><span class="ident" id="3397856">peekCount</span>&nbsp;<span class="op" id="3397866">=</span>&nbsp;<span class="num" id="3397868">3</span><br>
<span class="lineno"></span><span class="op" id="3397870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3397873">//&nbsp;peek&nbsp;returns&nbsp;but&nbsp;does&nbsp;not&nbsp;consume&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="3397926">func</span>&nbsp;<span class="op" id="3397931">(</span><span class="ident" id="3397932">t</span>&nbsp;<span class="op" id="3397934">*</span><span class="ident" id="3397935"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3397939">)</span>&nbsp;<span class="ident" id="3397941">peek</span><span class="op" id="3397945">(</span><span class="op" id="3397946">)</span>&nbsp;<span class="ident" id="3397948"><a href="/text/template/parse/lex.go.html#3361242">item</a></span>&nbsp;<span class="op" id="3397953">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397956">if</span>&nbsp;<span class="ident" id="3397959"><a href="/text/template/parse/parse.go.html#3397932">t</a></span><span class="op" id="3397960">.</span><span class="ident" id="3397961">peekCount</span>&nbsp;<span class="op" id="3397971">&gt;</span>&nbsp;<span class="num" id="3397973">0</span>&nbsp;<span class="op" id="3397975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397979">return</span>&nbsp;<span class="ident" id="3397986"><a href="/text/template/parse/parse.go.html#3397932">t</a></span><span class="op" id="3397987">.</span><span class="ident" id="3397988">token</span><span class="op" id="3397993">[</span><span class="ident" id="3397994"><a href="/text/template/parse/parse.go.html#3397932">t</a></span><span class="op" id="3397995">.</span><span class="ident" id="3397996">peekCount</span><span class="op" id="3398005">-</span><span class="num" id="3398006">1</span><span class="op" id="3398007">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398013"><a href="/text/template/parse/parse.go.html#3397932">t</a></span><span class="op" id="3398014">.</span><span class="ident" id="3398015">peekCount</span>&nbsp;<span class="op" id="3398025">=</span>&nbsp;<span class="num" id="3398027">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398030"><a href="/text/template/parse/parse.go.html#3397932">t</a></span><span class="op" id="3398031">.</span><span class="ident" id="3398032">token</span><span class="op" id="3398037">[</span><span class="num" id="3398038">0</span><span class="op" id="3398039">]</span>&nbsp;<span class="op" id="3398041">=</span>&nbsp;<span class="ident" id="3398043"><a href="/text/template/parse/parse.go.html#3397932">t</a></span><span class="op" id="3398044">.</span><span class="ident" id="3398045">lex</span><span class="op" id="3398048">.</span><span class="ident" id="3398049">nextItem</span><span class="op" id="3398057">(</span><span class="op" id="3398058">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398061">return</span>&nbsp;<span class="ident" id="3398068"><a href="/text/template/parse/parse.go.html#3397932">t</a></span><span class="op" id="3398069">.</span><span class="ident" id="3398070">token</span><span class="op" id="3398075">[</span><span class="num" id="3398076">0</span><span class="op" id="3398077">]</span><br>
<span class="lineno"></span><span class="op" id="3398079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3398082">//&nbsp;nextNonSpace&nbsp;returns&nbsp;the&nbsp;next&nbsp;non-space&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="3398132">func</span>&nbsp;<span class="op" id="3398137">(</span><span class="ident" id="3398138">t</span>&nbsp;<span class="op" id="3398140">*</span><span class="ident" id="3398141"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3398145">)</span>&nbsp;<span class="ident" id="3398147">nextNonSpace</span><span class="op" id="3398159">(</span><span class="op" id="3398160">)</span>&nbsp;<span class="op" id="3398162">(</span><span class="ident" id="3398163">token</span>&nbsp;<span class="ident" id="3398169"><a href="/text/template/parse/lex.go.html#3361242">item</a></span><span class="op" id="3398173">)</span>&nbsp;<span class="op" id="3398175">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398178">for</span>&nbsp;<span class="op" id="3398182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398186"><a href="/text/template/parse/parse.go.html#3398163">token</a></span>&nbsp;<span class="op" id="3398192">=</span>&nbsp;<span class="ident" id="3398194"><a href="/text/template/parse/parse.go.html#3398138">t</a></span><span class="op" id="3398195">.</span><span class="ident" id="3398196">next</span><span class="op" id="3398200">(</span><span class="op" id="3398201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398205">if</span>&nbsp;<span class="ident" id="3398208"><a href="/text/template/parse/parse.go.html#3398163">token</a></span><span class="op" id="3398213">.</span><span class="ident" id="3398214">typ</span>&nbsp;<span class="op" id="3398218">!=</span>&nbsp;<span class="ident" id="3398221"><a href="/text/template/parse/lex.go.html#3362663">itemSpace</a></span>&nbsp;<span class="op" id="3398231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398236">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398244">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398250">return</span>&nbsp;<span class="ident" id="3398257"><a href="/text/template/parse/parse.go.html#3398163">token</a></span><br>
<span class="lineno"></span><span class="op" id="3398263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3398266">//&nbsp;peekNonSpace&nbsp;returns&nbsp;but&nbsp;does&nbsp;not&nbsp;consume&nbsp;the&nbsp;next&nbsp;non-space&nbsp;token.</span><br>
<span class="lineno">110</span><span class="keyword" id="3398337">func</span>&nbsp;<span class="op" id="3398342">(</span><span class="ident" id="3398343">t</span>&nbsp;<span class="op" id="3398345">*</span><span class="ident" id="3398346"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3398350">)</span>&nbsp;<span class="ident" id="3398352">peekNonSpace</span><span class="op" id="3398364">(</span><span class="op" id="3398365">)</span>&nbsp;<span class="op" id="3398367">(</span><span class="ident" id="3398368">token</span>&nbsp;<span class="ident" id="3398374"><a href="/text/template/parse/lex.go.html#3361242">item</a></span><span class="op" id="3398378">)</span>&nbsp;<span class="op" id="3398380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398383">for</span>&nbsp;<span class="op" id="3398387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398391"><a href="/text/template/parse/parse.go.html#3398368">token</a></span>&nbsp;<span class="op" id="3398397">=</span>&nbsp;<span class="ident" id="3398399"><a href="/text/template/parse/parse.go.html#3398343">t</a></span><span class="op" id="3398400">.</span><span class="ident" id="3398401">next</span><span class="op" id="3398405">(</span><span class="op" id="3398406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398410">if</span>&nbsp;<span class="ident" id="3398413"><a href="/text/template/parse/parse.go.html#3398368">token</a></span><span class="op" id="3398418">.</span><span class="ident" id="3398419">typ</span>&nbsp;<span class="op" id="3398423">!=</span>&nbsp;<span class="ident" id="3398426"><a href="/text/template/parse/lex.go.html#3362663">itemSpace</a></span>&nbsp;<span class="op" id="3398436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398441">break</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398455"><a href="/text/template/parse/parse.go.html#3398343">t</a></span><span class="op" id="3398456">.</span><span class="ident" id="3398457">backup</span><span class="op" id="3398463">(</span><span class="op" id="3398464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398467">return</span>&nbsp;<span class="ident" id="3398474"><a href="/text/template/parse/parse.go.html#3398368">token</a></span><br>
<span class="lineno"></span><span class="op" id="3398480">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="3398483">//&nbsp;Parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3398496">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;parse&nbsp;tree&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3398551">func</span>&nbsp;<span class="ident" id="3398556">New</span><span class="op" id="3398559">(</span><span class="ident" id="3398560">name</span>&nbsp;<span class="builtintype" id="3398565">string</span><span class="op" id="3398571">,</span>&nbsp;<span class="ident" id="3398573">funcs</span>&nbsp;<span class="op" id="3398579">...</span><span class="keyword" id="3398582">map</span><span class="op" id="3398585">[</span><span class="builtintype" id="3398586">string</span><span class="op" id="3398592">]</span><span class="keyword" id="3398593">interface</span><span class="op" id="3398602">{</span><span class="op" id="3398603">}</span><span class="op" id="3398604">)</span>&nbsp;<span class="op" id="3398606">*</span><span class="ident" id="3398607"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span>&nbsp;<span class="op" id="3398612">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398615">return</span>&nbsp;<span class="op" id="3398622">&amp;</span><span class="ident" id="3398623"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3398627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398631">Name</span><span class="op" id="3398635">:</span>&nbsp;&nbsp;<span class="ident" id="3398638"><a href="/text/template/parse/parse.go.html#3398560">name</a></span><span class="op" id="3398642">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398646">funcs</span><span class="op" id="3398651">:</span>&nbsp;<span class="ident" id="3398653"><a href="/text/template/parse/parse.go.html#3398573">funcs</a></span><span class="op" id="3398658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398661">}</span><br>
<span class="lineno"></span><span class="op" id="3398663">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="3398666">//&nbsp;ErrorContext&nbsp;returns&nbsp;a&nbsp;textual&nbsp;representation&nbsp;of&nbsp;the&nbsp;location&nbsp;of&nbsp;the&nbsp;node&nbsp;in&nbsp;the&nbsp;input&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="3398762">//&nbsp;The&nbsp;receiver&nbsp;is&nbsp;only&nbsp;used&nbsp;when&nbsp;the&nbsp;node&nbsp;does&nbsp;not&nbsp;have&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;tree&nbsp;inside,</span><br>
<span class="lineno"></span><span class="comment" id="3398849">//&nbsp;which&nbsp;can&nbsp;occur&nbsp;in&nbsp;old&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="3398881">func</span>&nbsp;<span class="op" id="3398886">(</span><span class="ident" id="3398887">t</span>&nbsp;<span class="op" id="3398889">*</span><span class="ident" id="3398890"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3398894">)</span>&nbsp;<span class="ident" id="3398896">ErrorContext</span><span class="op" id="3398908">(</span><span class="ident" id="3398909">n</span>&nbsp;<span class="ident" id="3398911"><a href="/text/template/parse/node.go.html#3375303">Node</a></span><span class="op" id="3398915">)</span>&nbsp;<span class="op" id="3398917">(</span><span class="ident" id="3398918">location</span><span class="op" id="3398926">,</span>&nbsp;<span class="ident" id="3398928">context</span>&nbsp;<span class="builtintype" id="3398936">string</span><span class="op" id="3398942">)</span>&nbsp;<span class="op" id="3398944">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398947">pos</span>&nbsp;<span class="op" id="3398951">:=</span>&nbsp;<span class="builtintype" id="3398954">int</span><span class="op" id="3398957">(</span><span class="ident" id="3398958"><a href="/text/template/parse/parse.go.html#3398909">n</a></span><span class="op" id="3398959">.</span><span class="ident" id="3398960">Position</span><span class="op" id="3398968">(</span><span class="op" id="3398969">)</span><span class="op" id="3398970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398973">tree</span>&nbsp;<span class="op" id="3398978">:=</span>&nbsp;<span class="ident" id="3398981"><a href="/text/template/parse/parse.go.html#3398909">n</a></span><span class="op" id="3398982">.</span><span class="ident" id="3398983">tree</span><span class="op" id="3398987">(</span><span class="op" id="3398988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398991">if</span>&nbsp;<span class="ident" id="3398994"><a href="/text/template/parse/parse.go.html#3398973">tree</a></span>&nbsp;<span class="op" id="3398999">==</span>&nbsp;<span class="ident" id="3399002">nil</span>&nbsp;<span class="op" id="3399006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399010"><a href="/text/template/parse/parse.go.html#3398973">tree</a></span>&nbsp;<span class="op" id="3399015">=</span>&nbsp;<span class="ident" id="3399017"><a href="/text/template/parse/parse.go.html#3398887">t</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3399020">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399023">text</span>&nbsp;<span class="op" id="3399028">:=</span>&nbsp;<span class="ident" id="3399031"><a href="/text/template/parse/parse.go.html#3398973">tree</a></span><span class="op" id="3399035">.</span><span class="ident" id="3399036">text</span><span class="op" id="3399040">[</span><span class="op" id="3399041">:</span><span class="ident" id="3399042"><a href="/text/template/parse/parse.go.html#3398947">pos</a></span><span class="op" id="3399045">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399048">byteNum</span>&nbsp;<span class="op" id="3399056">:=</span>&nbsp;<span class="ident" id="3399059"><a href="/text/template/parse/parse.go.html#3395833">strings</a></span><span class="op" id="3399066">.</span><span class="ident" id="3399067">LastIndex</span><span class="op" id="3399076">(</span><span class="ident" id="3399077"><a href="/text/template/parse/parse.go.html#3399023">text</a></span><span class="op" id="3399081">,</span>&nbsp;<span class="string" id="3399083">&#34;\n&#34;</span><span class="op" id="3399087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399090">if</span>&nbsp;<span class="ident" id="3399093"><a href="/text/template/parse/parse.go.html#3399048">byteNum</a></span>&nbsp;<span class="op" id="3399101">==</span>&nbsp;<span class="op" id="3399104">-</span><span class="num" id="3399105">1</span>&nbsp;<span class="op" id="3399107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399111"><a href="/text/template/parse/parse.go.html#3399048">byteNum</a></span>&nbsp;<span class="op" id="3399119">=</span>&nbsp;<span class="ident" id="3399121"><a href="/text/template/parse/parse.go.html#3398947">pos</a></span>&nbsp;<span class="comment" id="3399125">//&nbsp;On&nbsp;first&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3399144">}</span>&nbsp;<span class="keyword" id="3399146">else</span>&nbsp;<span class="op" id="3399151">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399155"><a href="/text/template/parse/parse.go.html#3399048">byteNum</a></span><span class="op" id="3399162">++</span>&nbsp;<span class="comment" id="3399165">//&nbsp;After&nbsp;the&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399189"><a href="/text/template/parse/parse.go.html#3399048">byteNum</a></span>&nbsp;<span class="op" id="3399197">=</span>&nbsp;<span class="ident" id="3399199"><a href="/text/template/parse/parse.go.html#3398947">pos</a></span>&nbsp;<span class="op" id="3399203">-</span>&nbsp;<span class="ident" id="3399205"><a href="/text/template/parse/parse.go.html#3399048">byteNum</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3399214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399217">lineNum</span>&nbsp;<span class="op" id="3399225">:=</span>&nbsp;<span class="num" id="3399228">1</span>&nbsp;<span class="op" id="3399230">+</span>&nbsp;<span class="ident" id="3399232"><a href="/text/template/parse/parse.go.html#3395833">strings</a></span><span class="op" id="3399239">.</span><span class="ident" id="3399240">Count</span><span class="op" id="3399245">(</span><span class="ident" id="3399246"><a href="/text/template/parse/parse.go.html#3399023">text</a></span><span class="op" id="3399250">,</span>&nbsp;<span class="string" id="3399252">&#34;\n&#34;</span><span class="op" id="3399256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399259"><a href="/text/template/parse/parse.go.html#3398928">context</a></span>&nbsp;<span class="op" id="3399267">=</span>&nbsp;<span class="ident" id="3399269"><a href="/text/template/parse/parse.go.html#3398909">n</a></span><span class="op" id="3399270">.</span><span class="ident" id="3399271">String</span><span class="op" id="3399277">(</span><span class="op" id="3399278">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399281">if</span>&nbsp;<span class="builtinfunc" id="3399284">len</span><span class="op" id="3399287">(</span><span class="ident" id="3399288"><a href="/text/template/parse/parse.go.html#3398928">context</a></span><span class="op" id="3399295">)</span>&nbsp;<span class="op" id="3399297">&gt;</span>&nbsp;<span class="num" id="3399299">20</span>&nbsp;<span class="op" id="3399302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399306"><a href="/text/template/parse/parse.go.html#3398928">context</a></span>&nbsp;<span class="op" id="3399314">=</span>&nbsp;<span class="ident" id="3399316"><a href="/text/template/parse/parse.go.html#3395804">fmt</a></span><span class="op" id="3399319">.</span><span class="ident" id="3399320">Sprintf</span><span class="op" id="3399327">(</span><span class="string" id="3399328">&#34;%.20s...&#34;</span><span class="op" id="3399338">,</span>&nbsp;<span class="ident" id="3399340"><a href="/text/template/parse/parse.go.html#3398928">context</a></span><span class="op" id="3399347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3399350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399353">return</span>&nbsp;<span class="ident" id="3399360"><a href="/text/template/parse/parse.go.html#3395804">fmt</a></span><span class="op" id="3399363">.</span><span class="ident" id="3399364">Sprintf</span><span class="op" id="3399371">(</span><span class="string" id="3399372">&#34;%s:%d:%d&#34;</span><span class="op" id="3399382">,</span>&nbsp;<span class="ident" id="3399384"><a href="/text/template/parse/parse.go.html#3398973">tree</a></span><span class="op" id="3399388">.</span><span class="ident" id="3399389">ParseName</span><span class="op" id="3399398">,</span>&nbsp;<span class="ident" id="3399400"><a href="/text/template/parse/parse.go.html#3399217">lineNum</a></span><span class="op" id="3399407">,</span>&nbsp;<span class="ident" id="3399409"><a href="/text/template/parse/parse.go.html#3399048">byteNum</a></span><span class="op" id="3399416">)</span><span class="op" id="3399417">,</span>&nbsp;<span class="ident" id="3399419"><a href="/text/template/parse/parse.go.html#3398928">context</a></span><br>
<span class="lineno"></span><span class="op" id="3399427">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="3399430">//&nbsp;errorf&nbsp;formats&nbsp;the&nbsp;error&nbsp;and&nbsp;terminates&nbsp;processing.</span><br>
<span class="lineno"></span><span class="keyword" id="3399485">func</span>&nbsp;<span class="op" id="3399490">(</span><span class="ident" id="3399491">t</span>&nbsp;<span class="op" id="3399493">*</span><span class="ident" id="3399494"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3399498">)</span>&nbsp;<span class="ident" id="3399500">errorf</span><span class="op" id="3399506">(</span><span class="ident" id="3399507">format</span>&nbsp;<span class="builtintype" id="3399514">string</span><span class="op" id="3399520">,</span>&nbsp;<span class="ident" id="3399522">args</span>&nbsp;<span class="op" id="3399527">...</span><span class="keyword" id="3399530">interface</span><span class="op" id="3399539">{</span><span class="op" id="3399540">}</span><span class="op" id="3399541">)</span>&nbsp;<span class="op" id="3399543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399546"><a href="/text/template/parse/parse.go.html#3399491">t</a></span><span class="op" id="3399547">.</span><span class="ident" id="3399548">Root</span>&nbsp;<span class="op" id="3399553">=</span>&nbsp;<span class="ident" id="3399555">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399560"><a href="/text/template/parse/parse.go.html#3399507">format</a></span>&nbsp;<span class="op" id="3399567">=</span>&nbsp;<span class="ident" id="3399569"><a href="/text/template/parse/parse.go.html#3395804">fmt</a></span><span class="op" id="3399572">.</span><span class="ident" id="3399573">Sprintf</span><span class="op" id="3399580">(</span><span class="string" id="3399581">&#34;template:&nbsp;%s:%d:&nbsp;%s&#34;</span><span class="op" id="3399602">,</span>&nbsp;<span class="ident" id="3399604"><a href="/text/template/parse/parse.go.html#3399491">t</a></span><span class="op" id="3399605">.</span><span class="ident" id="3399606">ParseName</span><span class="op" id="3399615">,</span>&nbsp;<span class="ident" id="3399617"><a href="/text/template/parse/parse.go.html#3399491">t</a></span><span class="op" id="3399618">.</span><span class="ident" id="3399619">lex</span><span class="op" id="3399622">.</span><span class="ident" id="3399623">lineNumber</span><span class="op" id="3399633">(</span><span class="op" id="3399634">)</span><span class="op" id="3399635">,</span>&nbsp;<span class="ident" id="3399637"><a href="/text/template/parse/parse.go.html#3399507">format</a></span><span class="op" id="3399643">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3399646">panic</span><span class="op" id="3399651">(</span><span class="ident" id="3399652"><a href="/text/template/parse/parse.go.html#3395804">fmt</a></span><span class="op" id="3399655">.</span><span class="ident" id="3399656">Errorf</span><span class="op" id="3399662">(</span><span class="ident" id="3399663"><a href="/text/template/parse/parse.go.html#3399507">format</a></span><span class="op" id="3399669">,</span>&nbsp;<span class="ident" id="3399671"><a href="/text/template/parse/parse.go.html#3399522">args</a></span><span class="op" id="3399675">...</span><span class="op" id="3399678">)</span><span class="op" id="3399679">)</span><br>
<span class="lineno"></span><span class="op" id="3399681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3399684">//&nbsp;error&nbsp;terminates&nbsp;processing.</span><br>
<span class="lineno"></span><span class="keyword" id="3399716">func</span>&nbsp;<span class="op" id="3399721">(</span><span class="ident" id="3399722">t</span>&nbsp;<span class="op" id="3399724">*</span><span class="ident" id="3399725"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3399729">)</span>&nbsp;<span class="builtintype" id="3399731">error</span><span class="op" id="3399736">(</span><span class="ident" id="3399737">err</span>&nbsp;<span class="builtintype" id="3399741">error</span><span class="op" id="3399746">)</span>&nbsp;<span class="op" id="3399748">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399751"><a href="/text/template/parse/parse.go.html#3399722">t</a></span><span class="op" id="3399752">.</span><span class="ident" id="3399753">errorf</span><span class="op" id="3399759">(</span><span class="string" id="3399760">&#34;%s&#34;</span><span class="op" id="3399764">,</span>&nbsp;<span class="ident" id="3399766"><a href="/text/template/parse/parse.go.html#3399737">err</a></span><span class="op" id="3399769">)</span><br>
<span class="lineno"></span><span class="op" id="3399771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3399774">//&nbsp;expect&nbsp;consumes&nbsp;the&nbsp;next&nbsp;token&nbsp;and&nbsp;guarantees&nbsp;it&nbsp;has&nbsp;the&nbsp;required&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="3399849">func</span>&nbsp;<span class="op" id="3399854">(</span><span class="ident" id="3399855">t</span>&nbsp;<span class="op" id="3399857">*</span><span class="ident" id="3399858"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3399862">)</span>&nbsp;<span class="ident" id="3399864">expect</span><span class="op" id="3399870">(</span><span class="ident" id="3399871">expected</span>&nbsp;<span class="ident" id="3399880"><a href="/text/template/parse/lex.go.html#3361762">itemType</a></span><span class="op" id="3399888">,</span>&nbsp;<span class="ident" id="3399890">context</span>&nbsp;<span class="builtintype" id="3399898">string</span><span class="op" id="3399904">)</span>&nbsp;<span class="ident" id="3399906"><a href="/text/template/parse/lex.go.html#3361242">item</a></span>&nbsp;<span class="op" id="3399911">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399914">token</span>&nbsp;<span class="op" id="3399920">:=</span>&nbsp;<span class="ident" id="3399923"><a href="/text/template/parse/parse.go.html#3399855">t</a></span><span class="op" id="3399924">.</span><span class="ident" id="3399925">nextNonSpace</span><span class="op" id="3399937">(</span><span class="op" id="3399938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399941">if</span>&nbsp;<span class="ident" id="3399944"><a href="/text/template/parse/parse.go.html#3399914">token</a></span><span class="op" id="3399949">.</span><span class="ident" id="3399950">typ</span>&nbsp;<span class="op" id="3399954">!=</span>&nbsp;<span class="ident" id="3399957"><a href="/text/template/parse/parse.go.html#3399871">expected</a></span>&nbsp;<span class="op" id="3399966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399970"><a href="/text/template/parse/parse.go.html#3399855">t</a></span><span class="op" id="3399971">.</span><span class="ident" id="3399972">unexpected</span><span class="op" id="3399982">(</span><span class="ident" id="3399983"><a href="/text/template/parse/parse.go.html#3399914">token</a></span><span class="op" id="3399988">,</span>&nbsp;<span class="ident" id="3399990"><a href="/text/template/parse/parse.go.html#3399890">context</a></span><span class="op" id="3399997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3400000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400003">return</span>&nbsp;<span class="ident" id="3400010"><a href="/text/template/parse/parse.go.html#3399914">token</a></span><br>
<span class="lineno">175</span><span class="op" id="3400016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3400019">//&nbsp;expectOneOf&nbsp;consumes&nbsp;the&nbsp;next&nbsp;token&nbsp;and&nbsp;guarantees&nbsp;it&nbsp;has&nbsp;one&nbsp;of&nbsp;the&nbsp;required&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3400107">func</span>&nbsp;<span class="op" id="3400112">(</span><span class="ident" id="3400113">t</span>&nbsp;<span class="op" id="3400115">*</span><span class="ident" id="3400116"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3400120">)</span>&nbsp;<span class="ident" id="3400122">expectOneOf</span><span class="op" id="3400133">(</span><span class="ident" id="3400134">expected1</span><span class="op" id="3400143">,</span>&nbsp;<span class="ident" id="3400145">expected2</span>&nbsp;<span class="ident" id="3400155"><a href="/text/template/parse/lex.go.html#3361762">itemType</a></span><span class="op" id="3400163">,</span>&nbsp;<span class="ident" id="3400165">context</span>&nbsp;<span class="builtintype" id="3400173">string</span><span class="op" id="3400179">)</span>&nbsp;<span class="ident" id="3400181"><a href="/text/template/parse/lex.go.html#3361242">item</a></span>&nbsp;<span class="op" id="3400186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400189">token</span>&nbsp;<span class="op" id="3400195">:=</span>&nbsp;<span class="ident" id="3400198"><a href="/text/template/parse/parse.go.html#3400113">t</a></span><span class="op" id="3400199">.</span><span class="ident" id="3400200">nextNonSpace</span><span class="op" id="3400212">(</span><span class="op" id="3400213">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400216">if</span>&nbsp;<span class="ident" id="3400219"><a href="/text/template/parse/parse.go.html#3400189">token</a></span><span class="op" id="3400224">.</span><span class="ident" id="3400225">typ</span>&nbsp;<span class="op" id="3400229">!=</span>&nbsp;<span class="ident" id="3400232"><a href="/text/template/parse/parse.go.html#3400134">expected1</a></span>&nbsp;<span class="op" id="3400242">&amp;&amp;</span>&nbsp;<span class="ident" id="3400245"><a href="/text/template/parse/parse.go.html#3400189">token</a></span><span class="op" id="3400250">.</span><span class="ident" id="3400251">typ</span>&nbsp;<span class="op" id="3400255">!=</span>&nbsp;<span class="ident" id="3400258"><a href="/text/template/parse/parse.go.html#3400145">expected2</a></span>&nbsp;<span class="op" id="3400268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400272"><a href="/text/template/parse/parse.go.html#3400113">t</a></span><span class="op" id="3400273">.</span><span class="ident" id="3400274">unexpected</span><span class="op" id="3400284">(</span><span class="ident" id="3400285"><a href="/text/template/parse/parse.go.html#3400189">token</a></span><span class="op" id="3400290">,</span>&nbsp;<span class="ident" id="3400292"><a href="/text/template/parse/parse.go.html#3400165">context</a></span><span class="op" id="3400299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3400302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400305">return</span>&nbsp;<span class="ident" id="3400312"><a href="/text/template/parse/parse.go.html#3400189">token</a></span><br>
<span class="lineno"></span><span class="op" id="3400318">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="3400321">//&nbsp;unexpected&nbsp;complains&nbsp;about&nbsp;the&nbsp;token&nbsp;and&nbsp;terminates&nbsp;processing.</span><br>
<span class="lineno"></span><span class="keyword" id="3400388">func</span>&nbsp;<span class="op" id="3400393">(</span><span class="ident" id="3400394">t</span>&nbsp;<span class="op" id="3400396">*</span><span class="ident" id="3400397"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3400401">)</span>&nbsp;<span class="ident" id="3400403">unexpected</span><span class="op" id="3400413">(</span><span class="ident" id="3400414">token</span>&nbsp;<span class="ident" id="3400420"><a href="/text/template/parse/lex.go.html#3361242">item</a></span><span class="op" id="3400424">,</span>&nbsp;<span class="ident" id="3400426">context</span>&nbsp;<span class="builtintype" id="3400434">string</span><span class="op" id="3400440">)</span>&nbsp;<span class="op" id="3400442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400445"><a href="/text/template/parse/parse.go.html#3400394">t</a></span><span class="op" id="3400446">.</span><span class="ident" id="3400447">errorf</span><span class="op" id="3400453">(</span><span class="string" id="3400454">&#34;unexpected&nbsp;%s&nbsp;in&nbsp;%s&#34;</span><span class="op" id="3400475">,</span>&nbsp;<span class="ident" id="3400477"><a href="/text/template/parse/parse.go.html#3400414">token</a></span><span class="op" id="3400482">,</span>&nbsp;<span class="ident" id="3400484"><a href="/text/template/parse/parse.go.html#3400426">context</a></span><span class="op" id="3400491">)</span><br>
<span class="lineno"></span><span class="op" id="3400493">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="3400496">//&nbsp;recover&nbsp;is&nbsp;the&nbsp;handler&nbsp;that&nbsp;turns&nbsp;panics&nbsp;into&nbsp;returns&nbsp;from&nbsp;the&nbsp;top&nbsp;level&nbsp;of&nbsp;Parse.</span><br>
<span class="lineno"></span><span class="keyword" id="3400582">func</span>&nbsp;<span class="op" id="3400587">(</span><span class="ident" id="3400588">t</span>&nbsp;<span class="op" id="3400590">*</span><span class="ident" id="3400591"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3400595">)</span>&nbsp;<span class="builtinfunc" id="3400597">recover</span><span class="op" id="3400604">(</span><span class="ident" id="3400605">errp</span>&nbsp;<span class="op" id="3400610">*</span><span class="builtintype" id="3400611">error</span><span class="op" id="3400616">)</span>&nbsp;<span class="op" id="3400618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400621">e</span>&nbsp;<span class="op" id="3400623">:=</span>&nbsp;<span class="builtinfunc" id="3400626">recover</span><span class="op" id="3400633">(</span><span class="op" id="3400634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400637">if</span>&nbsp;<span class="ident" id="3400640"><a href="/text/template/parse/parse.go.html#3400621">e</a></span>&nbsp;<span class="op" id="3400642">!=</span>&nbsp;<span class="ident" id="3400645">nil</span>&nbsp;<span class="op" id="3400649">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400653">if</span>&nbsp;<span class="ident" id="3400656">_</span><span class="op" id="3400657">,</span>&nbsp;<span class="ident" id="3400659">ok</span>&nbsp;<span class="op" id="3400662">:=</span>&nbsp;<span class="ident" id="3400665"><a href="/text/template/parse/parse.go.html#3400621">e</a></span><span class="op" id="3400666">.</span><span class="op" id="3400667">(</span><span class="ident" id="3400668"><a href="/text/template/parse/parse.go.html#3395811">runtime</a></span><span class="op" id="3400675">.</span><span class="ident" id="3400676">Error</span><span class="op" id="3400681">)</span><span class="op" id="3400682">;</span>&nbsp;<span class="ident" id="3400684"><a href="/text/template/parse/parse.go.html#3400659">ok</a></span>&nbsp;<span class="op" id="3400687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3400692">panic</span><span class="op" id="3400697">(</span><span class="ident" id="3400698"><a href="/text/template/parse/parse.go.html#3400621">e</a></span><span class="op" id="3400699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3400703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400707">if</span>&nbsp;<span class="ident" id="3400710"><a href="/text/template/parse/parse.go.html#3400588">t</a></span>&nbsp;<span class="op" id="3400712">!=</span>&nbsp;<span class="ident" id="3400715">nil</span>&nbsp;<span class="op" id="3400719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400724"><a href="/text/template/parse/parse.go.html#3400588">t</a></span><span class="op" id="3400725">.</span><span class="ident" id="3400726">stopParse</span><span class="op" id="3400735">(</span><span class="op" id="3400736">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3400740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3400744">*</span><span class="ident" id="3400745"><a href="/text/template/parse/parse.go.html#3400605">errp</a></span>&nbsp;<span class="op" id="3400750">=</span>&nbsp;<span class="ident" id="3400752"><a href="/text/template/parse/parse.go.html#3400621">e</a></span><span class="op" id="3400753">.</span><span class="op" id="3400754">(</span><span class="builtintype" id="3400755">error</span><span class="op" id="3400760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3400763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400766">return</span><br>
<span class="lineno"></span><span class="op" id="3400773">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="3400776">//&nbsp;startParse&nbsp;initializes&nbsp;the&nbsp;parser,&nbsp;using&nbsp;the&nbsp;lexer.</span><br>
<span class="lineno"></span><span class="keyword" id="3400831">func</span>&nbsp;<span class="op" id="3400836">(</span><span class="ident" id="3400837">t</span>&nbsp;<span class="op" id="3400839">*</span><span class="ident" id="3400840"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3400844">)</span>&nbsp;<span class="ident" id="3400846">startParse</span><span class="op" id="3400856">(</span><span class="ident" id="3400857">funcs</span>&nbsp;<span class="op" id="3400863">[</span><span class="op" id="3400864">]</span><span class="keyword" id="3400865">map</span><span class="op" id="3400868">[</span><span class="builtintype" id="3400869">string</span><span class="op" id="3400875">]</span><span class="keyword" id="3400876">interface</span><span class="op" id="3400885">{</span><span class="op" id="3400886">}</span><span class="op" id="3400887">,</span>&nbsp;<span class="ident" id="3400889">lex</span>&nbsp;<span class="op" id="3400893">*</span><span class="ident" id="3400894"><a href="/text/template/parse/lex.go.html#3363729">lexer</a></span><span class="op" id="3400899">)</span>&nbsp;<span class="op" id="3400901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400904"><a href="/text/template/parse/parse.go.html#3400837">t</a></span><span class="op" id="3400905">.</span><span class="ident" id="3400906">Root</span>&nbsp;<span class="op" id="3400911">=</span>&nbsp;<span class="ident" id="3400913">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400918"><a href="/text/template/parse/parse.go.html#3400837">t</a></span><span class="op" id="3400919">.</span><span class="ident" id="3400920">lex</span>&nbsp;<span class="op" id="3400924">=</span>&nbsp;<span class="ident" id="3400926"><a href="/text/template/parse/parse.go.html#3400889">lex</a></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400931"><a href="/text/template/parse/parse.go.html#3400837">t</a></span><span class="op" id="3400932">.</span><span class="ident" id="3400933">vars</span>&nbsp;<span class="op" id="3400938">=</span>&nbsp;<span class="op" id="3400940">[</span><span class="op" id="3400941">]</span><span class="builtintype" id="3400942">string</span><span class="op" id="3400948">{</span><span class="string" id="3400949">&#34;$&#34;</span><span class="op" id="3400952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400955"><a href="/text/template/parse/parse.go.html#3400837">t</a></span><span class="op" id="3400956">.</span><span class="ident" id="3400957">funcs</span>&nbsp;<span class="op" id="3400963">=</span>&nbsp;<span class="ident" id="3400965"><a href="/text/template/parse/parse.go.html#3400857">funcs</a></span><br>
<span class="lineno"></span><span class="op" id="3400971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3400974">//&nbsp;stopParse&nbsp;terminates&nbsp;parsing.</span><br>
<span class="lineno">215</span><span class="keyword" id="3401007">func</span>&nbsp;<span class="op" id="3401012">(</span><span class="ident" id="3401013">t</span>&nbsp;<span class="op" id="3401015">*</span><span class="ident" id="3401016"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3401020">)</span>&nbsp;<span class="ident" id="3401022">stopParse</span><span class="op" id="3401031">(</span><span class="op" id="3401032">)</span>&nbsp;<span class="op" id="3401034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401037"><a href="/text/template/parse/parse.go.html#3401013">t</a></span><span class="op" id="3401038">.</span><span class="ident" id="3401039">lex</span>&nbsp;<span class="op" id="3401043">=</span>&nbsp;<span class="ident" id="3401045">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401050"><a href="/text/template/parse/parse.go.html#3401013">t</a></span><span class="op" id="3401051">.</span><span class="ident" id="3401052">vars</span>&nbsp;<span class="op" id="3401057">=</span>&nbsp;<span class="ident" id="3401059">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401064"><a href="/text/template/parse/parse.go.html#3401013">t</a></span><span class="op" id="3401065">.</span><span class="ident" id="3401066">funcs</span>&nbsp;<span class="op" id="3401072">=</span>&nbsp;<span class="ident" id="3401074">nil</span><br>
<span class="lineno"></span><span class="op" id="3401078">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3401081">//&nbsp;Parse&nbsp;parses&nbsp;the&nbsp;template&nbsp;definition&nbsp;string&nbsp;to&nbsp;construct&nbsp;a&nbsp;representation&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3401161">//&nbsp;the&nbsp;template&nbsp;for&nbsp;execution.&nbsp;If&nbsp;either&nbsp;action&nbsp;delimiter&nbsp;string&nbsp;is&nbsp;empty,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3401240">//&nbsp;default&nbsp;(&#34;{{&#34;&nbsp;or&nbsp;&#34;}}&#34;)&nbsp;is&nbsp;used.&nbsp;Embedded&nbsp;template&nbsp;definitions&nbsp;are&nbsp;added&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3401318">//&nbsp;the&nbsp;treeSet&nbsp;map.</span><br>
<span class="lineno">225</span><span class="keyword" id="3401338">func</span>&nbsp;<span class="op" id="3401343">(</span><span class="ident" id="3401344">t</span>&nbsp;<span class="op" id="3401346">*</span><span class="ident" id="3401347"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3401351">)</span>&nbsp;<span class="ident" id="3401353">Parse</span><span class="op" id="3401358">(</span><span class="ident" id="3401359">text</span><span class="op" id="3401363">,</span>&nbsp;<span class="ident" id="3401365">leftDelim</span><span class="op" id="3401374">,</span>&nbsp;<span class="ident" id="3401376">rightDelim</span>&nbsp;<span class="builtintype" id="3401387">string</span><span class="op" id="3401393">,</span>&nbsp;<span class="ident" id="3401395">treeSet</span>&nbsp;<span class="keyword" id="3401403">map</span><span class="op" id="3401406">[</span><span class="builtintype" id="3401407">string</span><span class="op" id="3401413">]</span><span class="op" id="3401414">*</span><span class="ident" id="3401415"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3401419">,</span>&nbsp;<span class="ident" id="3401421">funcs</span>&nbsp;<span class="op" id="3401427">...</span><span class="keyword" id="3401430">map</span><span class="op" id="3401433">[</span><span class="builtintype" id="3401434">string</span><span class="op" id="3401440">]</span><span class="keyword" id="3401441">interface</span><span class="op" id="3401450">{</span><span class="op" id="3401451">}</span><span class="op" id="3401452">)</span>&nbsp;<span class="op" id="3401454">(</span><span class="ident" id="3401455">tree</span>&nbsp;<span class="op" id="3401460">*</span><span class="ident" id="3401461"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3401465">,</span>&nbsp;<span class="ident" id="3401467">err</span>&nbsp;<span class="builtintype" id="3401471">error</span><span class="op" id="3401476">)</span>&nbsp;<span class="op" id="3401478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401481">defer</span>&nbsp;<span class="ident" id="3401487"><a href="/text/template/parse/parse.go.html#3401344">t</a></span><span class="op" id="3401488">.</span><span class="builtinfunc" id="3401489">recover</span><span class="op" id="3401496">(</span><span class="op" id="3401497">&amp;</span><span class="ident" id="3401498"><a href="/text/template/parse/parse.go.html#3401467">err</a></span><span class="op" id="3401501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401504"><a href="/text/template/parse/parse.go.html#3401344">t</a></span><span class="op" id="3401505">.</span><span class="ident" id="3401506">ParseName</span>&nbsp;<span class="op" id="3401516">=</span>&nbsp;<span class="ident" id="3401518"><a href="/text/template/parse/parse.go.html#3401344">t</a></span><span class="op" id="3401519">.</span><span class="ident" id="3401520">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401526"><a href="/text/template/parse/parse.go.html#3401344">t</a></span><span class="op" id="3401527">.</span><span class="ident" id="3401528">startParse</span><span class="op" id="3401538">(</span><span class="ident" id="3401539"><a href="/text/template/parse/parse.go.html#3401421">funcs</a></span><span class="op" id="3401544">,</span>&nbsp;<span class="ident" id="3401546"><a href="/text/template/parse/lex.go.html#3366237">lex</a></span><span class="op" id="3401549">(</span><span class="ident" id="3401550"><a href="/text/template/parse/parse.go.html#3401344">t</a></span><span class="op" id="3401551">.</span><span class="ident" id="3401552">Name</span><span class="op" id="3401556">,</span>&nbsp;<span class="ident" id="3401558"><a href="/text/template/parse/parse.go.html#3401359">text</a></span><span class="op" id="3401562">,</span>&nbsp;<span class="ident" id="3401564"><a href="/text/template/parse/parse.go.html#3401365">leftDelim</a></span><span class="op" id="3401573">,</span>&nbsp;<span class="ident" id="3401575"><a href="/text/template/parse/parse.go.html#3401376">rightDelim</a></span><span class="op" id="3401585">)</span><span class="op" id="3401586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401589"><a href="/text/template/parse/parse.go.html#3401344">t</a></span><span class="op" id="3401590">.</span><span class="ident" id="3401591">text</span>&nbsp;<span class="op" id="3401596">=</span>&nbsp;<span class="ident" id="3401598"><a href="/text/template/parse/parse.go.html#3401359">text</a></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401604"><a href="/text/template/parse/parse.go.html#3401344">t</a></span><span class="op" id="3401605">.</span><span class="ident" id="3401606">parse</span><span class="op" id="3401611">(</span><span class="ident" id="3401612"><a href="/text/template/parse/parse.go.html#3401395">treeSet</a></span><span class="op" id="3401619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401622"><a href="/text/template/parse/parse.go.html#3401344">t</a></span><span class="op" id="3401623">.</span><span class="ident" id="3401624">add</span><span class="op" id="3401627">(</span><span class="ident" id="3401628"><a href="/text/template/parse/parse.go.html#3401395">treeSet</a></span><span class="op" id="3401635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401638"><a href="/text/template/parse/parse.go.html#3401344">t</a></span><span class="op" id="3401639">.</span><span class="ident" id="3401640">stopParse</span><span class="op" id="3401649">(</span><span class="op" id="3401650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401653">return</span>&nbsp;<span class="ident" id="3401660"><a href="/text/template/parse/parse.go.html#3401344">t</a></span><span class="op" id="3401661">,</span>&nbsp;<span class="ident" id="3401663">nil</span><br>
<span class="lineno"></span><span class="op" id="3401667">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="3401670">//&nbsp;add&nbsp;adds&nbsp;tree&nbsp;to&nbsp;the&nbsp;treeSet.</span><br>
<span class="lineno"></span><span class="keyword" id="3401703">func</span>&nbsp;<span class="op" id="3401708">(</span><span class="ident" id="3401709">t</span>&nbsp;<span class="op" id="3401711">*</span><span class="ident" id="3401712"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3401716">)</span>&nbsp;<span class="ident" id="3401718">add</span><span class="op" id="3401721">(</span><span class="ident" id="3401722">treeSet</span>&nbsp;<span class="keyword" id="3401730">map</span><span class="op" id="3401733">[</span><span class="builtintype" id="3401734">string</span><span class="op" id="3401740">]</span><span class="op" id="3401741">*</span><span class="ident" id="3401742"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3401746">)</span>&nbsp;<span class="op" id="3401748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401751">tree</span>&nbsp;<span class="op" id="3401756">:=</span>&nbsp;<span class="ident" id="3401759"><a href="/text/template/parse/parse.go.html#3401722">treeSet</a></span><span class="op" id="3401766">[</span><span class="ident" id="3401767"><a href="/text/template/parse/parse.go.html#3401709">t</a></span><span class="op" id="3401768">.</span><span class="ident" id="3401769">Name</span><span class="op" id="3401773">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401776">if</span>&nbsp;<span class="ident" id="3401779"><a href="/text/template/parse/parse.go.html#3401751">tree</a></span>&nbsp;<span class="op" id="3401784">==</span>&nbsp;<span class="ident" id="3401787">nil</span>&nbsp;<span class="op" id="3401791">||</span>&nbsp;<span class="ident" id="3401794"><a href="/text/template/parse/parse.go.html#3402040">IsEmptyTree</a></span><span class="op" id="3401805">(</span><span class="ident" id="3401806"><a href="/text/template/parse/parse.go.html#3401751">tree</a></span><span class="op" id="3401810">.</span><span class="ident" id="3401811">Root</span><span class="op" id="3401815">)</span>&nbsp;<span class="op" id="3401817">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401821"><a href="/text/template/parse/parse.go.html#3401722">treeSet</a></span><span class="op" id="3401828">[</span><span class="ident" id="3401829"><a href="/text/template/parse/parse.go.html#3401709">t</a></span><span class="op" id="3401830">.</span><span class="ident" id="3401831">Name</span><span class="op" id="3401835">]</span>&nbsp;<span class="op" id="3401837">=</span>&nbsp;<span class="ident" id="3401839"><a href="/text/template/parse/parse.go.html#3401709">t</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401843">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3401851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401854">if</span>&nbsp;<span class="op" id="3401857">!</span><span class="ident" id="3401858"><a href="/text/template/parse/parse.go.html#3402040">IsEmptyTree</a></span><span class="op" id="3401869">(</span><span class="ident" id="3401870"><a href="/text/template/parse/parse.go.html#3401709">t</a></span><span class="op" id="3401871">.</span><span class="ident" id="3401872">Root</span><span class="op" id="3401876">)</span>&nbsp;<span class="op" id="3401878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401882"><a href="/text/template/parse/parse.go.html#3401709">t</a></span><span class="op" id="3401883">.</span><span class="ident" id="3401884">errorf</span><span class="op" id="3401890">(</span><span class="string" id="3401891">&#34;template:&nbsp;multiple&nbsp;definition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="3401937">,</span>&nbsp;<span class="ident" id="3401939"><a href="/text/template/parse/parse.go.html#3401709">t</a></span><span class="op" id="3401940">.</span><span class="ident" id="3401941">Name</span><span class="op" id="3401945">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3401948">}</span><br>
<span class="lineno"></span><span class="op" id="3401950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3401953">//&nbsp;IsEmptyTree&nbsp;reports&nbsp;whether&nbsp;this&nbsp;tree&nbsp;(node)&nbsp;is&nbsp;empty&nbsp;of&nbsp;everything&nbsp;but&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="3402035">func</span>&nbsp;<span class="ident" id="3402040">IsEmptyTree</span><span class="op" id="3402051">(</span><span class="ident" id="3402052">n</span>&nbsp;<span class="ident" id="3402054"><a href="/text/template/parse/node.go.html#3375303">Node</a></span><span class="op" id="3402058">)</span>&nbsp;<span class="builtintype" id="3402060">bool</span>&nbsp;<span class="op" id="3402065">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402068">switch</span>&nbsp;<span class="ident" id="3402075">n</span>&nbsp;<span class="op" id="3402077">:=</span>&nbsp;<span class="ident" id="3402080"><a href="/text/template/parse/parse.go.html#3402052">n</a></span><span class="op" id="3402081">.</span><span class="op" id="3402082">(</span><span class="keyword" id="3402083">type</span><span class="op" id="3402087">)</span>&nbsp;<span class="op" id="3402089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402092">case</span>&nbsp;<span class="ident" id="3402097">nil</span><span class="op" id="3402100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402104">return</span>&nbsp;<span class="ident" id="3402111">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402117">case</span>&nbsp;<span class="op" id="3402122">*</span><span class="ident" id="3402123"><a href="/text/template/parse/node.go.html#3380053">ActionNode</a></span><span class="op" id="3402133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402136">case</span>&nbsp;<span class="op" id="3402141">*</span><span class="ident" id="3402142"><a href="/text/template/parse/node.go.html#3393218">IfNode</a></span><span class="op" id="3402148">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402151">case</span>&nbsp;<span class="op" id="3402156">*</span><span class="ident" id="3402157"><a href="/text/template/parse/node.go.html#3377404">ListNode</a></span><span class="op" id="3402165">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402169">for</span>&nbsp;<span class="ident" id="3402173">_</span><span class="op" id="3402174">,</span>&nbsp;<span class="ident" id="3402176">node</span>&nbsp;<span class="op" id="3402181">:=</span>&nbsp;<span class="keyword" id="3402184">range</span>&nbsp;<span class="ident" id="3402190"><a href="/text/template/parse/parse.go.html#3402075">n</a></span><span class="op" id="3402191">.</span><span class="ident" id="3402192">Nodes</span>&nbsp;<span class="op" id="3402198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402203">if</span>&nbsp;<span class="op" id="3402206">!</span><span class="ident" id="3402207"><a href="/text/template/parse/parse.go.html#3402040">IsEmptyTree</a></span><span class="op" id="3402218">(</span><span class="ident" id="3402219"><a href="/text/template/parse/parse.go.html#3402176">node</a></span><span class="op" id="3402223">)</span>&nbsp;<span class="op" id="3402225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402231">return</span>&nbsp;<span class="ident" id="3402238">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3402247">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3402251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402255">return</span>&nbsp;<span class="ident" id="3402262">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402268">case</span>&nbsp;<span class="op" id="3402273">*</span><span class="ident" id="3402274"><a href="/text/template/parse/node.go.html#3393658">RangeNode</a></span><span class="op" id="3402283">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402286">case</span>&nbsp;<span class="op" id="3402291">*</span><span class="ident" id="3402292"><a href="/text/template/parse/node.go.html#3394560">TemplateNode</a></span><span class="op" id="3402304">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402307">case</span>&nbsp;<span class="op" id="3402312">*</span><span class="ident" id="3402313"><a href="/text/template/parse/node.go.html#3378122">TextNode</a></span><span class="op" id="3402321">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402325">return</span>&nbsp;<span class="builtinfunc" id="3402332">len</span><span class="op" id="3402335">(</span><span class="ident" id="3402336"><a href="/text/template/parse/parse.go.html#3395795">bytes</a></span><span class="op" id="3402341">.</span><span class="ident" id="3402342">TrimSpace</span><span class="op" id="3402351">(</span><span class="ident" id="3402352"><a href="/text/template/parse/parse.go.html#3402075">n</a></span><span class="op" id="3402353">.</span><span class="ident" id="3402354">Text</span><span class="op" id="3402358">)</span><span class="op" id="3402359">)</span>&nbsp;<span class="op" id="3402361">==</span>&nbsp;<span class="num" id="3402364">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402367">case</span>&nbsp;<span class="op" id="3402372">*</span><span class="ident" id="3402373"><a href="/text/template/parse/node.go.html#3394117">WithNode</a></span><span class="op" id="3402381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402384">default</span><span class="op" id="3402391">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3402395">panic</span><span class="op" id="3402400">(</span><span class="string" id="3402401">&#34;unknown&nbsp;node:&nbsp;&#34;</span>&nbsp;<span class="op" id="3402418">+</span>&nbsp;<span class="ident" id="3402420"><a href="/text/template/parse/parse.go.html#3402075">n</a></span><span class="op" id="3402421">.</span><span class="ident" id="3402422">String</span><span class="op" id="3402428">(</span><span class="op" id="3402429">)</span><span class="op" id="3402430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3402433">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402436">return</span>&nbsp;<span class="ident" id="3402443">false</span><br>
<span class="lineno"></span><span class="op" id="3402449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3402452">//&nbsp;parse&nbsp;is&nbsp;the&nbsp;top-level&nbsp;parser&nbsp;for&nbsp;a&nbsp;template,&nbsp;essentially&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3402522">//&nbsp;as&nbsp;itemList&nbsp;except&nbsp;it&nbsp;also&nbsp;parses&nbsp;{{define}}&nbsp;actions.</span><br>
<span class="lineno">275</span><span class="comment" id="3402579">//&nbsp;It&nbsp;runs&nbsp;to&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="3402598">func</span>&nbsp;<span class="op" id="3402603">(</span><span class="ident" id="3402604">t</span>&nbsp;<span class="op" id="3402606">*</span><span class="ident" id="3402607"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3402611">)</span>&nbsp;<span class="ident" id="3402613">parse</span><span class="op" id="3402618">(</span><span class="ident" id="3402619">treeSet</span>&nbsp;<span class="keyword" id="3402627">map</span><span class="op" id="3402630">[</span><span class="builtintype" id="3402631">string</span><span class="op" id="3402637">]</span><span class="op" id="3402638">*</span><span class="ident" id="3402639"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3402643">)</span>&nbsp;<span class="op" id="3402645">(</span><span class="ident" id="3402646">next</span>&nbsp;<span class="ident" id="3402651"><a href="/text/template/parse/node.go.html#3375303">Node</a></span><span class="op" id="3402655">)</span>&nbsp;<span class="op" id="3402657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402660"><a href="/text/template/parse/parse.go.html#3402604">t</a></span><span class="op" id="3402661">.</span><span class="ident" id="3402662">Root</span>&nbsp;<span class="op" id="3402667">=</span>&nbsp;<span class="ident" id="3402669"><a href="/text/template/parse/parse.go.html#3402604">t</a></span><span class="op" id="3402670">.</span><span class="ident" id="3402671">newList</span><span class="op" id="3402678">(</span><span class="ident" id="3402679"><a href="/text/template/parse/parse.go.html#3402604">t</a></span><span class="op" id="3402680">.</span><span class="ident" id="3402681">peek</span><span class="op" id="3402685">(</span><span class="op" id="3402686">)</span><span class="op" id="3402687">.</span><span class="ident" id="3402688">pos</span><span class="op" id="3402691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402694">for</span>&nbsp;<span class="ident" id="3402698"><a href="/text/template/parse/parse.go.html#3402604">t</a></span><span class="op" id="3402699">.</span><span class="ident" id="3402700">peek</span><span class="op" id="3402704">(</span><span class="op" id="3402705">)</span><span class="op" id="3402706">.</span><span class="ident" id="3402707">typ</span>&nbsp;<span class="op" id="3402711">!=</span>&nbsp;<span class="ident" id="3402714"><a href="/text/template/parse/lex.go.html#3362231">itemEOF</a></span>&nbsp;<span class="op" id="3402722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402726">if</span>&nbsp;<span class="ident" id="3402729"><a href="/text/template/parse/parse.go.html#3402604">t</a></span><span class="op" id="3402730">.</span><span class="ident" id="3402731">peek</span><span class="op" id="3402735">(</span><span class="op" id="3402736">)</span><span class="op" id="3402737">.</span><span class="ident" id="3402738">typ</span>&nbsp;<span class="op" id="3402742">==</span>&nbsp;<span class="ident" id="3402745"><a href="/text/template/parse/lex.go.html#3362366">itemLeftDelim</a></span>&nbsp;<span class="op" id="3402759">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402764">delim</span>&nbsp;<span class="op" id="3402770">:=</span>&nbsp;<span class="ident" id="3402773"><a href="/text/template/parse/parse.go.html#3402604">t</a></span><span class="op" id="3402774">.</span><span class="ident" id="3402775">next</span><span class="op" id="3402779">(</span><span class="op" id="3402780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402785">if</span>&nbsp;<span class="ident" id="3402788"><a href="/text/template/parse/parse.go.html#3402604">t</a></span><span class="op" id="3402789">.</span><span class="ident" id="3402790">nextNonSpace</span><span class="op" id="3402802">(</span><span class="op" id="3402803">)</span><span class="op" id="3402804">.</span><span class="ident" id="3402805">typ</span>&nbsp;<span class="op" id="3402809">==</span>&nbsp;<span class="ident" id="3402812"><a href="/text/template/parse/lex.go.html#3363010">itemDefine</a></span>&nbsp;<span class="op" id="3402823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402829">newT</span>&nbsp;<span class="op" id="3402834">:=</span>&nbsp;<span class="ident" id="3402837"><a href="/text/template/parse/parse.go.html#3398556">New</a></span><span class="op" id="3402840">(</span><span class="string" id="3402841">&#34;definition&#34;</span><span class="op" id="3402853">)</span>&nbsp;<span class="comment" id="3402855">//&nbsp;name&nbsp;will&nbsp;be&nbsp;updated&nbsp;once&nbsp;we&nbsp;know&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402900"><a href="/text/template/parse/parse.go.html#3402829">newT</a></span><span class="op" id="3402904">.</span><span class="ident" id="3402905">text</span>&nbsp;<span class="op" id="3402910">=</span>&nbsp;<span class="ident" id="3402912"><a href="/text/template/parse/parse.go.html#3402604">t</a></span><span class="op" id="3402913">.</span><span class="ident" id="3402914">text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402923"><a href="/text/template/parse/parse.go.html#3402829">newT</a></span><span class="op" id="3402927">.</span><span class="ident" id="3402928">ParseName</span>&nbsp;<span class="op" id="3402938">=</span>&nbsp;<span class="ident" id="3402940"><a href="/text/template/parse/parse.go.html#3402604">t</a></span><span class="op" id="3402941">.</span><span class="ident" id="3402942">ParseName</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402956"><a href="/text/template/parse/parse.go.html#3402829">newT</a></span><span class="op" id="3402960">.</span><span class="ident" id="3402961">startParse</span><span class="op" id="3402971">(</span><span class="ident" id="3402972"><a href="/text/template/parse/parse.go.html#3402604">t</a></span><span class="op" id="3402973">.</span><span class="ident" id="3402974">funcs</span><span class="op" id="3402979">,</span>&nbsp;<span class="ident" id="3402981"><a href="/text/template/parse/parse.go.html#3402604">t</a></span><span class="op" id="3402982">.</span><span class="ident" id="3402983">lex</span><span class="op" id="3402986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402992"><a href="/text/template/parse/parse.go.html#3402829">newT</a></span><span class="op" id="3402996">.</span><span class="ident" id="3402997">parseDefinition</span><span class="op" id="3403012">(</span><span class="ident" id="3403013"><a href="/text/template/parse/parse.go.html#3402619">treeSet</a></span><span class="op" id="3403020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403026">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403043"><a href="/text/template/parse/parse.go.html#3402604">t</a></span><span class="op" id="3403044">.</span><span class="ident" id="3403045">backup2</span><span class="op" id="3403052">(</span><span class="ident" id="3403053"><a href="/text/template/parse/parse.go.html#3402764">delim</a></span><span class="op" id="3403058">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403066">n</span>&nbsp;<span class="op" id="3403068">:=</span>&nbsp;<span class="ident" id="3403071"><a href="/text/template/parse/parse.go.html#3402604">t</a></span><span class="op" id="3403072">.</span><span class="ident" id="3403073">textOrAction</span><span class="op" id="3403085">(</span><span class="op" id="3403086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403090">if</span>&nbsp;<span class="ident" id="3403093"><a href="/text/template/parse/parse.go.html#3403066">n</a></span><span class="op" id="3403094">.</span><span class="ident" id="3403095">Type</span><span class="op" id="3403099">(</span><span class="op" id="3403100">)</span>&nbsp;<span class="op" id="3403102">==</span>&nbsp;<span class="ident" id="3403105"><a href="/text/template/parse/node.go.html#3376599">nodeEnd</a></span>&nbsp;<span class="op" id="3403113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403118"><a href="/text/template/parse/parse.go.html#3402604">t</a></span><span class="op" id="3403119">.</span><span class="ident" id="3403120">errorf</span><span class="op" id="3403126">(</span><span class="string" id="3403127">&#34;unexpected&nbsp;%s&#34;</span><span class="op" id="3403142">,</span>&nbsp;<span class="ident" id="3403144"><a href="/text/template/parse/parse.go.html#3403066">n</a></span><span class="op" id="3403145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403149">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403153"><a href="/text/template/parse/parse.go.html#3402604">t</a></span><span class="op" id="3403154">.</span><span class="ident" id="3403155">Root</span><span class="op" id="3403159">.</span><span class="builtinfunc" id="3403160">append</span><span class="op" id="3403166">(</span><span class="ident" id="3403167"><a href="/text/template/parse/parse.go.html#3403066">n</a></span><span class="op" id="3403168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403174">return</span>&nbsp;<span class="ident" id="3403181">nil</span><br>
<span class="lineno"></span><span class="op" id="3403185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="3403188">//&nbsp;parseDefinition&nbsp;parses&nbsp;a&nbsp;{{define}}&nbsp;...&nbsp;&nbsp;{{end}}&nbsp;template&nbsp;definition&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3403264">//&nbsp;installs&nbsp;the&nbsp;definition&nbsp;in&nbsp;the&nbsp;treeSet&nbsp;map.&nbsp;&nbsp;The&nbsp;&#34;define&#34;&nbsp;keyword&nbsp;has&nbsp;already</span><br>
<span class="lineno"></span><span class="comment" id="3403345">//&nbsp;been&nbsp;scanned.</span><br>
<span class="lineno"></span><span class="keyword" id="3403362">func</span>&nbsp;<span class="op" id="3403367">(</span><span class="ident" id="3403368">t</span>&nbsp;<span class="op" id="3403370">*</span><span class="ident" id="3403371"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3403375">)</span>&nbsp;<span class="ident" id="3403377">parseDefinition</span><span class="op" id="3403392">(</span><span class="ident" id="3403393">treeSet</span>&nbsp;<span class="keyword" id="3403401">map</span><span class="op" id="3403404">[</span><span class="builtintype" id="3403405">string</span><span class="op" id="3403411">]</span><span class="op" id="3403412">*</span><span class="ident" id="3403413"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3403417">)</span>&nbsp;<span class="op" id="3403419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403422">const</span>&nbsp;<span class="ident" id="3403428">context</span>&nbsp;<span class="op" id="3403436">=</span>&nbsp;<span class="string" id="3403438">&#34;define&nbsp;clause&#34;</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403455">name</span>&nbsp;<span class="op" id="3403460">:=</span>&nbsp;<span class="ident" id="3403463"><a href="/text/template/parse/parse.go.html#3403368">t</a></span><span class="op" id="3403464">.</span><span class="ident" id="3403465">expectOneOf</span><span class="op" id="3403476">(</span><span class="ident" id="3403477"><a href="/text/template/parse/lex.go.html#3362717">itemString</a></span><span class="op" id="3403487">,</span>&nbsp;<span class="ident" id="3403489"><a href="/text/template/parse/lex.go.html#3362529">itemRawString</a></span><span class="op" id="3403502">,</span>&nbsp;<span class="ident" id="3403504"><a href="/text/template/parse/parse.go.html#3403428">context</a></span><span class="op" id="3403511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403514">var</span>&nbsp;<span class="ident" id="3403518">err</span>&nbsp;<span class="builtintype" id="3403522">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403529"><a href="/text/template/parse/parse.go.html#3403368">t</a></span><span class="op" id="3403530">.</span><span class="ident" id="3403531">Name</span><span class="op" id="3403535">,</span>&nbsp;<span class="ident" id="3403537"><a href="/text/template/parse/parse.go.html#3403518">err</a></span>&nbsp;<span class="op" id="3403541">=</span>&nbsp;<span class="ident" id="3403543"><a href="/text/template/parse/parse.go.html#3395822">strconv</a></span><span class="op" id="3403550">.</span><span class="ident" id="3403551">Unquote</span><span class="op" id="3403558">(</span><span class="ident" id="3403559"><a href="/text/template/parse/parse.go.html#3403455">name</a></span><span class="op" id="3403563">.</span><span class="ident" id="3403564">val</span><span class="op" id="3403567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403570">if</span>&nbsp;<span class="ident" id="3403573"><a href="/text/template/parse/parse.go.html#3403518">err</a></span>&nbsp;<span class="op" id="3403577">!=</span>&nbsp;<span class="ident" id="3403580">nil</span>&nbsp;<span class="op" id="3403584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403588"><a href="/text/template/parse/parse.go.html#3403368">t</a></span><span class="op" id="3403589">.</span><span class="builtintype" id="3403590">error</span><span class="op" id="3403595">(</span><span class="ident" id="3403596"><a href="/text/template/parse/parse.go.html#3403518">err</a></span><span class="op" id="3403599">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403605"><a href="/text/template/parse/parse.go.html#3403368">t</a></span><span class="op" id="3403606">.</span><span class="ident" id="3403607">expect</span><span class="op" id="3403613">(</span><span class="ident" id="3403614"><a href="/text/template/parse/lex.go.html#3362584">itemRightDelim</a></span><span class="op" id="3403628">,</span>&nbsp;<span class="ident" id="3403630"><a href="/text/template/parse/parse.go.html#3403428">context</a></span><span class="op" id="3403637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403640">var</span>&nbsp;<span class="ident" id="3403644">end</span>&nbsp;<span class="ident" id="3403648"><a href="/text/template/parse/node.go.html#3375303">Node</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403654"><a href="/text/template/parse/parse.go.html#3403368">t</a></span><span class="op" id="3403655">.</span><span class="ident" id="3403656">Root</span><span class="op" id="3403660">,</span>&nbsp;<span class="ident" id="3403662"><a href="/text/template/parse/parse.go.html#3403644">end</a></span>&nbsp;<span class="op" id="3403666">=</span>&nbsp;<span class="ident" id="3403668"><a href="/text/template/parse/parse.go.html#3403368">t</a></span><span class="op" id="3403669">.</span><span class="ident" id="3403670">itemList</span><span class="op" id="3403678">(</span><span class="op" id="3403679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403682">if</span>&nbsp;<span class="ident" id="3403685"><a href="/text/template/parse/parse.go.html#3403644">end</a></span><span class="op" id="3403688">.</span><span class="ident" id="3403689">Type</span><span class="op" id="3403693">(</span><span class="op" id="3403694">)</span>&nbsp;<span class="op" id="3403696">!=</span>&nbsp;<span class="ident" id="3403699"><a href="/text/template/parse/node.go.html#3376599">nodeEnd</a></span>&nbsp;<span class="op" id="3403707">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403711"><a href="/text/template/parse/parse.go.html#3403368">t</a></span><span class="op" id="3403712">.</span><span class="ident" id="3403713">errorf</span><span class="op" id="3403719">(</span><span class="string" id="3403720">&#34;unexpected&nbsp;%s&nbsp;in&nbsp;%s&#34;</span><span class="op" id="3403741">,</span>&nbsp;<span class="ident" id="3403743"><a href="/text/template/parse/parse.go.html#3403644">end</a></span><span class="op" id="3403746">,</span>&nbsp;<span class="ident" id="3403748"><a href="/text/template/parse/parse.go.html#3403428">context</a></span><span class="op" id="3403755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403761"><a href="/text/template/parse/parse.go.html#3403368">t</a></span><span class="op" id="3403762">.</span><span class="ident" id="3403763">add</span><span class="op" id="3403766">(</span><span class="ident" id="3403767"><a href="/text/template/parse/parse.go.html#3403393">treeSet</a></span><span class="op" id="3403774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403777"><a href="/text/template/parse/parse.go.html#3403368">t</a></span><span class="op" id="3403778">.</span><span class="ident" id="3403779">stopParse</span><span class="op" id="3403788">(</span><span class="op" id="3403789">)</span><br>
<span class="lineno"></span><span class="op" id="3403791">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="3403794">//&nbsp;itemList:</span><br>
<span class="lineno"></span><span class="comment" id="3403807">//&nbsp;&nbsp;&nbsp;&nbsptextOrAction*</span><br>
<span class="lineno"></span><span class="comment" id="3403824">//&nbsp;Terminates&nbsp;at&nbsp;{{end}}&nbsp;or&nbsp;{{else}},&nbsp;returned&nbsp;separately.</span><br>
<span class="lineno"></span><span class="keyword" id="3403883">func</span>&nbsp;<span class="op" id="3403888">(</span><span class="ident" id="3403889">t</span>&nbsp;<span class="op" id="3403891">*</span><span class="ident" id="3403892"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3403896">)</span>&nbsp;<span class="ident" id="3403898">itemList</span><span class="op" id="3403906">(</span><span class="op" id="3403907">)</span>&nbsp;<span class="op" id="3403909">(</span><span class="ident" id="3403910">list</span>&nbsp;<span class="op" id="3403915">*</span><span class="ident" id="3403916"><a href="/text/template/parse/node.go.html#3377404">ListNode</a></span><span class="op" id="3403924">,</span>&nbsp;<span class="ident" id="3403926">next</span>&nbsp;<span class="ident" id="3403931"><a href="/text/template/parse/node.go.html#3375303">Node</a></span><span class="op" id="3403935">)</span>&nbsp;<span class="op" id="3403937">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403940"><a href="/text/template/parse/parse.go.html#3403910">list</a></span>&nbsp;<span class="op" id="3403945">=</span>&nbsp;<span class="ident" id="3403947"><a href="/text/template/parse/parse.go.html#3403889">t</a></span><span class="op" id="3403948">.</span><span class="ident" id="3403949">newList</span><span class="op" id="3403956">(</span><span class="ident" id="3403957"><a href="/text/template/parse/parse.go.html#3403889">t</a></span><span class="op" id="3403958">.</span><span class="ident" id="3403959">peekNonSpace</span><span class="op" id="3403971">(</span><span class="op" id="3403972">)</span><span class="op" id="3403973">.</span><span class="ident" id="3403974">pos</span><span class="op" id="3403977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403980">for</span>&nbsp;<span class="ident" id="3403984"><a href="/text/template/parse/parse.go.html#3403889">t</a></span><span class="op" id="3403985">.</span><span class="ident" id="3403986">peekNonSpace</span><span class="op" id="3403998">(</span><span class="op" id="3403999">)</span><span class="op" id="3404000">.</span><span class="ident" id="3404001">typ</span>&nbsp;<span class="op" id="3404005">!=</span>&nbsp;<span class="ident" id="3404008"><a href="/text/template/parse/lex.go.html#3362231">itemEOF</a></span>&nbsp;<span class="op" id="3404016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404020">n</span>&nbsp;<span class="op" id="3404022">:=</span>&nbsp;<span class="ident" id="3404025"><a href="/text/template/parse/parse.go.html#3403889">t</a></span><span class="op" id="3404026">.</span><span class="ident" id="3404027">textOrAction</span><span class="op" id="3404039">(</span><span class="op" id="3404040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404044">switch</span>&nbsp;<span class="ident" id="3404051"><a href="/text/template/parse/parse.go.html#3404020">n</a></span><span class="op" id="3404052">.</span><span class="ident" id="3404053">Type</span><span class="op" id="3404057">(</span><span class="op" id="3404058">)</span>&nbsp;<span class="op" id="3404060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404064">case</span>&nbsp;<span class="ident" id="3404069"><a href="/text/template/parse/node.go.html#3376599">nodeEnd</a></span><span class="op" id="3404076">,</span>&nbsp;<span class="ident" id="3404078"><a href="/text/template/parse/node.go.html#3376529">nodeElse</a></span><span class="op" id="3404086">:</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404091">return</span>&nbsp;<span class="ident" id="3404098"><a href="/text/template/parse/parse.go.html#3403910">list</a></span><span class="op" id="3404102">,</span>&nbsp;<span class="ident" id="3404104"><a href="/text/template/parse/parse.go.html#3404020">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3404108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404112"><a href="/text/template/parse/parse.go.html#3403910">list</a></span><span class="op" id="3404116">.</span><span class="builtinfunc" id="3404117">append</span><span class="op" id="3404123">(</span><span class="ident" id="3404124"><a href="/text/template/parse/parse.go.html#3404020">n</a></span><span class="op" id="3404125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3404128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404131"><a href="/text/template/parse/parse.go.html#3403889">t</a></span><span class="op" id="3404132">.</span><span class="ident" id="3404133">errorf</span><span class="op" id="3404139">(</span><span class="string" id="3404140">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="3404156">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404159">return</span><br>
<span class="lineno"></span><span class="op" id="3404166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3404169">//&nbsp;textOrAction:</span><br>
<span class="lineno"></span><span class="comment" id="3404186">//&nbsp;&nbsp;&nbsp;&nbsptext&nbsp;|&nbsp;action</span><br>
<span class="lineno">340</span><span class="keyword" id="3404203">func</span>&nbsp;<span class="op" id="3404208">(</span><span class="ident" id="3404209">t</span>&nbsp;<span class="op" id="3404211">*</span><span class="ident" id="3404212"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3404216">)</span>&nbsp;<span class="ident" id="3404218">textOrAction</span><span class="op" id="3404230">(</span><span class="op" id="3404231">)</span>&nbsp;<span class="ident" id="3404233"><a href="/text/template/parse/node.go.html#3375303">Node</a></span>&nbsp;<span class="op" id="3404238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404241">switch</span>&nbsp;<span class="ident" id="3404248">token</span>&nbsp;<span class="op" id="3404254">:=</span>&nbsp;<span class="ident" id="3404257"><a href="/text/template/parse/parse.go.html#3404209">t</a></span><span class="op" id="3404258">.</span><span class="ident" id="3404259">nextNonSpace</span><span class="op" id="3404271">(</span><span class="op" id="3404272">)</span><span class="op" id="3404273">;</span>&nbsp;<span class="ident" id="3404275"><a href="/text/template/parse/parse.go.html#3404248">token</a></span><span class="op" id="3404280">.</span><span class="ident" id="3404281">typ</span>&nbsp;<span class="op" id="3404285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404288">case</span>&nbsp;<span class="ident" id="3404293"><a href="/text/template/parse/lex.go.html#3362768">itemText</a></span><span class="op" id="3404301">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404305">return</span>&nbsp;<span class="ident" id="3404312"><a href="/text/template/parse/parse.go.html#3404209">t</a></span><span class="op" id="3404313">.</span><span class="ident" id="3404314">newText</span><span class="op" id="3404321">(</span><span class="ident" id="3404322"><a href="/text/template/parse/parse.go.html#3404248">token</a></span><span class="op" id="3404327">.</span><span class="ident" id="3404328">pos</span><span class="op" id="3404331">,</span>&nbsp;<span class="ident" id="3404333"><a href="/text/template/parse/parse.go.html#3404248">token</a></span><span class="op" id="3404338">.</span><span class="ident" id="3404339">val</span><span class="op" id="3404342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404345">case</span>&nbsp;<span class="ident" id="3404350"><a href="/text/template/parse/lex.go.html#3362366">itemLeftDelim</a></span><span class="op" id="3404363">:</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404367">return</span>&nbsp;<span class="ident" id="3404374"><a href="/text/template/parse/parse.go.html#3404209">t</a></span><span class="op" id="3404375">.</span><span class="ident" id="3404376">action</span><span class="op" id="3404382">(</span><span class="op" id="3404383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404386">default</span><span class="op" id="3404393">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404397"><a href="/text/template/parse/parse.go.html#3404209">t</a></span><span class="op" id="3404398">.</span><span class="ident" id="3404399">unexpected</span><span class="op" id="3404409">(</span><span class="ident" id="3404410"><a href="/text/template/parse/parse.go.html#3404248">token</a></span><span class="op" id="3404415">,</span>&nbsp;<span class="string" id="3404417">&#34;input&#34;</span><span class="op" id="3404424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3404427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404430">return</span>&nbsp;<span class="ident" id="3404437">nil</span><br>
<span class="lineno">350</span><span class="op" id="3404441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3404444">//&nbsp;Action:</span><br>
<span class="lineno"></span><span class="comment" id="3404455">//&nbsp;&nbsp;&nbsp;&nbspcontrol</span><br>
<span class="lineno"></span><span class="comment" id="3404466">//&nbsp;&nbsp;&nbsp;&nbspcommand&nbsp;(&#34;|&#34;&nbsp;command)*</span><br>
<span class="lineno">355</span><span class="comment" id="3404492">//&nbsp;Left&nbsp;delim&nbsp;is&nbsp;past.&nbsp;Now&nbsp;get&nbsp;actions.</span><br>
<span class="lineno"></span><span class="comment" id="3404532">//&nbsp;First&nbsp;word&nbsp;could&nbsp;be&nbsp;a&nbsp;keyword&nbsp;such&nbsp;as&nbsp;range.</span><br>
<span class="lineno"></span><span class="keyword" id="3404580">func</span>&nbsp;<span class="op" id="3404585">(</span><span class="ident" id="3404586">t</span>&nbsp;<span class="op" id="3404588">*</span><span class="ident" id="3404589"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3404593">)</span>&nbsp;<span class="ident" id="3404595">action</span><span class="op" id="3404601">(</span><span class="op" id="3404602">)</span>&nbsp;<span class="op" id="3404604">(</span><span class="ident" id="3404605">n</span>&nbsp;<span class="ident" id="3404607"><a href="/text/template/parse/node.go.html#3375303">Node</a></span><span class="op" id="3404611">)</span>&nbsp;<span class="op" id="3404613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404616">switch</span>&nbsp;<span class="ident" id="3404623">token</span>&nbsp;<span class="op" id="3404629">:=</span>&nbsp;<span class="ident" id="3404632"><a href="/text/template/parse/parse.go.html#3404586">t</a></span><span class="op" id="3404633">.</span><span class="ident" id="3404634">nextNonSpace</span><span class="op" id="3404646">(</span><span class="op" id="3404647">)</span><span class="op" id="3404648">;</span>&nbsp;<span class="ident" id="3404650"><a href="/text/template/parse/parse.go.html#3404623">token</a></span><span class="op" id="3404655">.</span><span class="ident" id="3404656">typ</span>&nbsp;<span class="op" id="3404660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404663">case</span>&nbsp;<span class="ident" id="3404668"><a href="/text/template/parse/lex.go.html#3363042">itemElse</a></span><span class="op" id="3404676">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404680">return</span>&nbsp;<span class="ident" id="3404687"><a href="/text/template/parse/parse.go.html#3404586">t</a></span><span class="op" id="3404688">.</span><span class="ident" id="3404689">elseControl</span><span class="op" id="3404700">(</span><span class="op" id="3404701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404704">case</span>&nbsp;<span class="ident" id="3404709"><a href="/text/template/parse/lex.go.html#3363072">itemEnd</a></span><span class="op" id="3404716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404720">return</span>&nbsp;<span class="ident" id="3404727"><a href="/text/template/parse/parse.go.html#3404586">t</a></span><span class="op" id="3404728">.</span><span class="ident" id="3404729">endControl</span><span class="op" id="3404739">(</span><span class="op" id="3404740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404743">case</span>&nbsp;<span class="ident" id="3404748"><a href="/text/template/parse/lex.go.html#3363101">itemIf</a></span><span class="op" id="3404754">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404758">return</span>&nbsp;<span class="ident" id="3404765"><a href="/text/template/parse/parse.go.html#3404586">t</a></span><span class="op" id="3404766">.</span><span class="ident" id="3404767">ifControl</span><span class="op" id="3404776">(</span><span class="op" id="3404777">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404780">case</span>&nbsp;<span class="ident" id="3404785"><a href="/text/template/parse/lex.go.html#3363202">itemRange</a></span><span class="op" id="3404794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404798">return</span>&nbsp;<span class="ident" id="3404805"><a href="/text/template/parse/parse.go.html#3404586">t</a></span><span class="op" id="3404806">.</span><span class="ident" id="3404807">rangeControl</span><span class="op" id="3404819">(</span><span class="op" id="3404820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404823">case</span>&nbsp;<span class="ident" id="3404828"><a href="/text/template/parse/lex.go.html#3363233">itemTemplate</a></span><span class="op" id="3404840">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404844">return</span>&nbsp;<span class="ident" id="3404851"><a href="/text/template/parse/parse.go.html#3404586">t</a></span><span class="op" id="3404852">.</span><span class="ident" id="3404853">templateControl</span><span class="op" id="3404868">(</span><span class="op" id="3404869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404872">case</span>&nbsp;<span class="ident" id="3404877"><a href="/text/template/parse/lex.go.html#3363267">itemWith</a></span><span class="op" id="3404885">:</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404889">return</span>&nbsp;<span class="ident" id="3404896"><a href="/text/template/parse/parse.go.html#3404586">t</a></span><span class="op" id="3404897">.</span><span class="ident" id="3404898">withControl</span><span class="op" id="3404909">(</span><span class="op" id="3404910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3404913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404916"><a href="/text/template/parse/parse.go.html#3404586">t</a></span><span class="op" id="3404917">.</span><span class="ident" id="3404918">backup</span><span class="op" id="3404924">(</span><span class="op" id="3404925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404928">//&nbsp;Do&nbsp;not&nbsp;pop&nbsp;variables;&nbsp;they&nbsp;persist&nbsp;until&nbsp;&#34;end&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404980">return</span>&nbsp;<span class="ident" id="3404987"><a href="/text/template/parse/parse.go.html#3404586">t</a></span><span class="op" id="3404988">.</span><span class="ident" id="3404989">newAction</span><span class="op" id="3404998">(</span><span class="ident" id="3404999"><a href="/text/template/parse/parse.go.html#3404586">t</a></span><span class="op" id="3405000">.</span><span class="ident" id="3405001">peek</span><span class="op" id="3405005">(</span><span class="op" id="3405006">)</span><span class="op" id="3405007">.</span><span class="ident" id="3405008">pos</span><span class="op" id="3405011">,</span>&nbsp;<span class="ident" id="3405013"><a href="/text/template/parse/parse.go.html#3404586">t</a></span><span class="op" id="3405014">.</span><span class="ident" id="3405015">lex</span><span class="op" id="3405018">.</span><span class="ident" id="3405019">lineNumber</span><span class="op" id="3405029">(</span><span class="op" id="3405030">)</span><span class="op" id="3405031">,</span>&nbsp;<span class="ident" id="3405033"><a href="/text/template/parse/parse.go.html#3404586">t</a></span><span class="op" id="3405034">.</span><span class="ident" id="3405035">pipeline</span><span class="op" id="3405043">(</span><span class="string" id="3405044">&#34;command&#34;</span><span class="op" id="3405053">)</span><span class="op" id="3405054">)</span><br>
<span class="lineno">375</span><span class="op" id="3405056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3405059">//&nbsp;Pipeline:</span><br>
<span class="lineno"></span><span class="comment" id="3405072">//&nbsp;&nbsp;&nbsp;&nbspdeclarations?&nbsp;command&nbsp;(&#39;|&#39;&nbsp;command)*</span><br>
<span class="lineno"></span><span class="keyword" id="3405112">func</span>&nbsp;<span class="op" id="3405117">(</span><span class="ident" id="3405118">t</span>&nbsp;<span class="op" id="3405120">*</span><span class="ident" id="3405121"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3405125">)</span>&nbsp;<span class="ident" id="3405127">pipeline</span><span class="op" id="3405135">(</span><span class="ident" id="3405136">context</span>&nbsp;<span class="builtintype" id="3405144">string</span><span class="op" id="3405150">)</span>&nbsp;<span class="op" id="3405152">(</span><span class="ident" id="3405153">pipe</span>&nbsp;<span class="op" id="3405158">*</span><span class="ident" id="3405159"><a href="/text/template/parse/node.go.html#3378671">PipeNode</a></span><span class="op" id="3405167">)</span>&nbsp;<span class="op" id="3405169">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405172">var</span>&nbsp;<span class="ident" id="3405176">decl</span>&nbsp;<span class="op" id="3405181">[</span><span class="op" id="3405182">]</span><span class="op" id="3405183">*</span><span class="ident" id="3405184"><a href="/text/template/parse/node.go.html#3382630">VariableNode</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405198">pos</span>&nbsp;<span class="op" id="3405202">:=</span>&nbsp;<span class="ident" id="3405205"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3405206">.</span><span class="ident" id="3405207">peekNonSpace</span><span class="op" id="3405219">(</span><span class="op" id="3405220">)</span><span class="op" id="3405221">.</span><span class="ident" id="3405222">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405227">//&nbsp;Are&nbsp;there&nbsp;declarations?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405255">for</span>&nbsp;<span class="op" id="3405259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405263">if</span>&nbsp;<span class="ident" id="3405266">v</span>&nbsp;<span class="op" id="3405268">:=</span>&nbsp;<span class="ident" id="3405271"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3405272">.</span><span class="ident" id="3405273">peekNonSpace</span><span class="op" id="3405285">(</span><span class="op" id="3405286">)</span><span class="op" id="3405287">;</span>&nbsp;<span class="ident" id="3405289"><a href="/text/template/parse/parse.go.html#3405266">v</a></span><span class="op" id="3405290">.</span><span class="ident" id="3405291">typ</span>&nbsp;<span class="op" id="3405295">==</span>&nbsp;<span class="ident" id="3405298"><a href="/text/template/parse/lex.go.html#3362798">itemVariable</a></span>&nbsp;<span class="op" id="3405311">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405316"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3405317">.</span><span class="ident" id="3405318">next</span><span class="op" id="3405322">(</span><span class="op" id="3405323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405328">//&nbsp;Since&nbsp;space&nbsp;is&nbsp;a&nbsp;token,&nbsp;we&nbsp;need&nbsp;3-token&nbsp;look-ahead&nbsp;here&nbsp;in&nbsp;the&nbsp;worst&nbsp;case:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405409">//&nbsp;in&nbsp;&#34;$x&nbsp;foo&#34;&nbsp;we&nbsp;need&nbsp;to&nbsp;read&nbsp;&#34;foo&#34;&nbsp;(as&nbsp;opposed&nbsp;to&nbsp;&#34;:=&#34;)&nbsp;to&nbsp;know&nbsp;that&nbsp;$x&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405492">//&nbsp;argument&nbsp;variable&nbsp;rather&nbsp;than&nbsp;a&nbsp;declaration.&nbsp;So&nbsp;remember&nbsp;the&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405565">//&nbsp;adjacent&nbsp;to&nbsp;the&nbsp;variable&nbsp;so&nbsp;we&nbsp;can&nbsp;push&nbsp;it&nbsp;back&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405633">tokenAfterVariable</span>&nbsp;<span class="op" id="3405652">:=</span>&nbsp;<span class="ident" id="3405655"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3405656">.</span><span class="ident" id="3405657">peek</span><span class="op" id="3405661">(</span><span class="op" id="3405662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405667">if</span>&nbsp;<span class="ident" id="3405670">next</span>&nbsp;<span class="op" id="3405675">:=</span>&nbsp;<span class="ident" id="3405678"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3405679">.</span><span class="ident" id="3405680">peekNonSpace</span><span class="op" id="3405692">(</span><span class="op" id="3405693">)</span><span class="op" id="3405694">;</span>&nbsp;<span class="ident" id="3405696"><a href="/text/template/parse/parse.go.html#3405670">next</a></span><span class="op" id="3405700">.</span><span class="ident" id="3405701">typ</span>&nbsp;<span class="op" id="3405705">==</span>&nbsp;<span class="ident" id="3405708"><a href="/text/template/parse/lex.go.html#3362148">itemColonEquals</a></span>&nbsp;<span class="op" id="3405724">||</span>&nbsp;<span class="op" id="3405727">(</span><span class="ident" id="3405728"><a href="/text/template/parse/parse.go.html#3405670">next</a></span><span class="op" id="3405732">.</span><span class="ident" id="3405733">typ</span>&nbsp;<span class="op" id="3405737">==</span>&nbsp;<span class="ident" id="3405740"><a href="/text/template/parse/lex.go.html#3361915">itemChar</a></span>&nbsp;<span class="op" id="3405749">&amp;&amp;</span>&nbsp;<span class="ident" id="3405752"><a href="/text/template/parse/parse.go.html#3405670">next</a></span><span class="op" id="3405756">.</span><span class="ident" id="3405757">val</span>&nbsp;<span class="op" id="3405761">==</span>&nbsp;<span class="string" id="3405764">&#34;,&#34;</span><span class="op" id="3405767">)</span>&nbsp;<span class="op" id="3405769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405775"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3405776">.</span><span class="ident" id="3405777">nextNonSpace</span><span class="op" id="3405789">(</span><span class="op" id="3405790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405796">variable</span>&nbsp;<span class="op" id="3405805">:=</span>&nbsp;<span class="ident" id="3405808"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3405809">.</span><span class="ident" id="3405810">newVariable</span><span class="op" id="3405821">(</span><span class="ident" id="3405822"><a href="/text/template/parse/parse.go.html#3405266">v</a></span><span class="op" id="3405823">.</span><span class="ident" id="3405824">pos</span><span class="op" id="3405827">,</span>&nbsp;<span class="ident" id="3405829"><a href="/text/template/parse/parse.go.html#3405266">v</a></span><span class="op" id="3405830">.</span><span class="ident" id="3405831">val</span><span class="op" id="3405834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405840"><a href="/text/template/parse/parse.go.html#3405176">decl</a></span>&nbsp;<span class="op" id="3405845">=</span>&nbsp;<span class="builtinfunc" id="3405847">append</span><span class="op" id="3405853">(</span><span class="ident" id="3405854"><a href="/text/template/parse/parse.go.html#3405176">decl</a></span><span class="op" id="3405858">,</span>&nbsp;<span class="ident" id="3405860"><a href="/text/template/parse/parse.go.html#3405796">variable</a></span><span class="op" id="3405868">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405874"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3405875">.</span><span class="ident" id="3405876">vars</span>&nbsp;<span class="op" id="3405881">=</span>&nbsp;<span class="builtinfunc" id="3405883">append</span><span class="op" id="3405889">(</span><span class="ident" id="3405890"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3405891">.</span><span class="ident" id="3405892">vars</span><span class="op" id="3405896">,</span>&nbsp;<span class="ident" id="3405898"><a href="/text/template/parse/parse.go.html#3405266">v</a></span><span class="op" id="3405899">.</span><span class="ident" id="3405900">val</span><span class="op" id="3405903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405909">if</span>&nbsp;<span class="ident" id="3405912"><a href="/text/template/parse/parse.go.html#3405670">next</a></span><span class="op" id="3405916">.</span><span class="ident" id="3405917">typ</span>&nbsp;<span class="op" id="3405921">==</span>&nbsp;<span class="ident" id="3405924"><a href="/text/template/parse/lex.go.html#3361915">itemChar</a></span>&nbsp;<span class="op" id="3405933">&amp;&amp;</span>&nbsp;<span class="ident" id="3405936"><a href="/text/template/parse/parse.go.html#3405670">next</a></span><span class="op" id="3405940">.</span><span class="ident" id="3405941">val</span>&nbsp;<span class="op" id="3405945">==</span>&nbsp;<span class="string" id="3405948">&#34;,&#34;</span>&nbsp;<span class="op" id="3405952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405959">if</span>&nbsp;<span class="ident" id="3405962"><a href="/text/template/parse/parse.go.html#3405136">context</a></span>&nbsp;<span class="op" id="3405970">==</span>&nbsp;<span class="string" id="3405973">&#34;range&#34;</span>&nbsp;<span class="op" id="3405981">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3405984">len</span><span class="op" id="3405987">(</span><span class="ident" id="3405988"><a href="/text/template/parse/parse.go.html#3405176">decl</a></span><span class="op" id="3405992">)</span>&nbsp;<span class="op" id="3405994">&lt;</span>&nbsp;<span class="num" id="3405996">2</span>&nbsp;<span class="op" id="3405998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406006">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406020">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406027"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3406028">.</span><span class="ident" id="3406029">errorf</span><span class="op" id="3406035">(</span><span class="string" id="3406036">&#34;too&nbsp;many&nbsp;declarations&nbsp;in&nbsp;%s&#34;</span><span class="op" id="3406065">,</span>&nbsp;<span class="ident" id="3406067"><a href="/text/template/parse/parse.go.html#3405136">context</a></span><span class="op" id="3406074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406085">}</span>&nbsp;<span class="keyword" id="3406087">else</span>&nbsp;<span class="keyword" id="3406092">if</span>&nbsp;<span class="ident" id="3406095"><a href="/text/template/parse/parse.go.html#3405633">tokenAfterVariable</a></span><span class="op" id="3406113">.</span><span class="ident" id="3406114">typ</span>&nbsp;<span class="op" id="3406118">==</span>&nbsp;<span class="ident" id="3406121"><a href="/text/template/parse/lex.go.html#3362663">itemSpace</a></span>&nbsp;<span class="op" id="3406131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406137"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3406138">.</span><span class="ident" id="3406139">backup3</span><span class="op" id="3406146">(</span><span class="ident" id="3406147"><a href="/text/template/parse/parse.go.html#3405266">v</a></span><span class="op" id="3406148">,</span>&nbsp;<span class="ident" id="3406150"><a href="/text/template/parse/parse.go.html#3405633">tokenAfterVariable</a></span><span class="op" id="3406168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406173">}</span>&nbsp;<span class="keyword" id="3406175">else</span>&nbsp;<span class="op" id="3406180">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406186"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3406187">.</span><span class="ident" id="3406188">backup2</span><span class="op" id="3406195">(</span><span class="ident" id="3406196"><a href="/text/template/parse/parse.go.html#3405266">v</a></span><span class="op" id="3406197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406210">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406217">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406220"><a href="/text/template/parse/parse.go.html#3405153">pipe</a></span>&nbsp;<span class="op" id="3406225">=</span>&nbsp;<span class="ident" id="3406227"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3406228">.</span><span class="ident" id="3406229">newPipeline</span><span class="op" id="3406240">(</span><span class="ident" id="3406241"><a href="/text/template/parse/parse.go.html#3405198">pos</a></span><span class="op" id="3406244">,</span>&nbsp;<span class="ident" id="3406246"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3406247">.</span><span class="ident" id="3406248">lex</span><span class="op" id="3406251">.</span><span class="ident" id="3406252">lineNumber</span><span class="op" id="3406262">(</span><span class="op" id="3406263">)</span><span class="op" id="3406264">,</span>&nbsp;<span class="ident" id="3406266"><a href="/text/template/parse/parse.go.html#3405176">decl</a></span><span class="op" id="3406270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406273">for</span>&nbsp;<span class="op" id="3406277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406281">switch</span>&nbsp;<span class="ident" id="3406288">token</span>&nbsp;<span class="op" id="3406294">:=</span>&nbsp;<span class="ident" id="3406297"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3406298">.</span><span class="ident" id="3406299">nextNonSpace</span><span class="op" id="3406311">(</span><span class="op" id="3406312">)</span><span class="op" id="3406313">;</span>&nbsp;<span class="ident" id="3406315"><a href="/text/template/parse/parse.go.html#3406288">token</a></span><span class="op" id="3406320">.</span><span class="ident" id="3406321">typ</span>&nbsp;<span class="op" id="3406325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406329">case</span>&nbsp;<span class="ident" id="3406334"><a href="/text/template/parse/lex.go.html#3362584">itemRightDelim</a></span><span class="op" id="3406348">,</span>&nbsp;<span class="ident" id="3406350"><a href="/text/template/parse/lex.go.html#3362626">itemRightParen</a></span><span class="op" id="3406364">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406369">if</span>&nbsp;<span class="builtinfunc" id="3406372">len</span><span class="op" id="3406375">(</span><span class="ident" id="3406376"><a href="/text/template/parse/parse.go.html#3405153">pipe</a></span><span class="op" id="3406380">.</span><span class="ident" id="3406381">Cmds</span><span class="op" id="3406385">)</span>&nbsp;<span class="op" id="3406387">==</span>&nbsp;<span class="num" id="3406390">0</span>&nbsp;<span class="op" id="3406392">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406398"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3406399">.</span><span class="ident" id="3406400">errorf</span><span class="op" id="3406406">(</span><span class="string" id="3406407">&#34;missing&nbsp;value&nbsp;for&nbsp;%s&#34;</span><span class="op" id="3406429">,</span>&nbsp;<span class="ident" id="3406431"><a href="/text/template/parse/parse.go.html#3405136">context</a></span><span class="op" id="3406438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406448">if</span>&nbsp;<span class="ident" id="3406451"><a href="/text/template/parse/parse.go.html#3406288">token</a></span><span class="op" id="3406456">.</span><span class="ident" id="3406457">typ</span>&nbsp;<span class="op" id="3406461">==</span>&nbsp;<span class="ident" id="3406464"><a href="/text/template/parse/lex.go.html#3362626">itemRightParen</a></span>&nbsp;<span class="op" id="3406479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406485"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3406486">.</span><span class="ident" id="3406487">backup</span><span class="op" id="3406493">(</span><span class="op" id="3406494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406499">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406504">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406513">case</span>&nbsp;<span class="ident" id="3406518"><a href="/text/template/parse/lex.go.html#3361861">itemBool</a></span><span class="op" id="3406526">,</span>&nbsp;<span class="ident" id="3406528"><a href="/text/template/parse/lex.go.html#3362003">itemCharConstant</a></span><span class="op" id="3406544">,</span>&nbsp;<span class="ident" id="3406546"><a href="/text/template/parse/lex.go.html#3362059">itemComplex</a></span><span class="op" id="3406557">,</span>&nbsp;<span class="ident" id="3406559"><a href="/text/template/parse/lex.go.html#3362969">itemDot</a></span><span class="op" id="3406566">,</span>&nbsp;<span class="ident" id="3406568"><a href="/text/template/parse/lex.go.html#3362240">itemField</a></span><span class="op" id="3406577">,</span>&nbsp;<span class="ident" id="3406579"><a href="/text/template/parse/lex.go.html#3362301">itemIdentifier</a></span><span class="op" id="3406593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406598"><a href="/text/template/parse/lex.go.html#3362444">itemNumber</a></span><span class="op" id="3406608">,</span>&nbsp;<span class="ident" id="3406610"><a href="/text/template/parse/lex.go.html#3363129">itemNil</a></span><span class="op" id="3406617">,</span>&nbsp;<span class="ident" id="3406619"><a href="/text/template/parse/lex.go.html#3362529">itemRawString</a></span><span class="op" id="3406632">,</span>&nbsp;<span class="ident" id="3406634"><a href="/text/template/parse/lex.go.html#3362717">itemString</a></span><span class="op" id="3406644">,</span>&nbsp;<span class="ident" id="3406646"><a href="/text/template/parse/lex.go.html#3362798">itemVariable</a></span><span class="op" id="3406658">,</span>&nbsp;<span class="ident" id="3406660"><a href="/text/template/parse/lex.go.html#3362407">itemLeftParen</a></span><span class="op" id="3406673">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406678"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3406679">.</span><span class="ident" id="3406680">backup</span><span class="op" id="3406686">(</span><span class="op" id="3406687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406692"><a href="/text/template/parse/parse.go.html#3405153">pipe</a></span><span class="op" id="3406696">.</span><span class="builtinfunc" id="3406697">append</span><span class="op" id="3406703">(</span><span class="ident" id="3406704"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3406705">.</span><span class="ident" id="3406706">command</span><span class="op" id="3406713">(</span><span class="op" id="3406714">)</span><span class="op" id="3406715">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406719">default</span><span class="op" id="3406726">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406731"><a href="/text/template/parse/parse.go.html#3405118">t</a></span><span class="op" id="3406732">.</span><span class="ident" id="3406733">unexpected</span><span class="op" id="3406743">(</span><span class="ident" id="3406744"><a href="/text/template/parse/parse.go.html#3406288">token</a></span><span class="op" id="3406749">,</span>&nbsp;<span class="ident" id="3406751"><a href="/text/template/parse/parse.go.html#3405136">context</a></span><span class="op" id="3406758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406765">}</span><br>
<span class="lineno"></span><span class="op" id="3406767">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span><span class="keyword" id="3406770">func</span>&nbsp;<span class="op" id="3406775">(</span><span class="ident" id="3406776">t</span>&nbsp;<span class="op" id="3406778">*</span><span class="ident" id="3406779"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3406783">)</span>&nbsp;<span class="ident" id="3406785">parseControl</span><span class="op" id="3406797">(</span><span class="ident" id="3406798">allowElseIf</span>&nbsp;<span class="builtintype" id="3406810">bool</span><span class="op" id="3406814">,</span>&nbsp;<span class="ident" id="3406816">context</span>&nbsp;<span class="builtintype" id="3406824">string</span><span class="op" id="3406830">)</span>&nbsp;<span class="op" id="3406832">(</span><span class="ident" id="3406833">pos</span>&nbsp;<span class="ident" id="3406837"><a href="/text/template/parse/node.go.html#3375925">Pos</a></span><span class="op" id="3406840">,</span>&nbsp;<span class="ident" id="3406842">line</span>&nbsp;<span class="builtintype" id="3406847">int</span><span class="op" id="3406850">,</span>&nbsp;<span class="ident" id="3406852">pipe</span>&nbsp;<span class="op" id="3406857">*</span><span class="ident" id="3406858"><a href="/text/template/parse/node.go.html#3378671">PipeNode</a></span><span class="op" id="3406866">,</span>&nbsp;<span class="ident" id="3406868">list</span><span class="op" id="3406872">,</span>&nbsp;<span class="ident" id="3406874">elseList</span>&nbsp;<span class="op" id="3406883">*</span><span class="ident" id="3406884"><a href="/text/template/parse/node.go.html#3377404">ListNode</a></span><span class="op" id="3406892">)</span>&nbsp;<span class="op" id="3406894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406897">defer</span>&nbsp;<span class="ident" id="3406903"><a href="/text/template/parse/parse.go.html#3406776">t</a></span><span class="op" id="3406904">.</span><span class="ident" id="3406905">popVars</span><span class="op" id="3406912">(</span><span class="builtinfunc" id="3406913">len</span><span class="op" id="3406916">(</span><span class="ident" id="3406917"><a href="/text/template/parse/parse.go.html#3406776">t</a></span><span class="op" id="3406918">.</span><span class="ident" id="3406919">vars</span><span class="op" id="3406923">)</span><span class="op" id="3406924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406927"><a href="/text/template/parse/parse.go.html#3406842">line</a></span>&nbsp;<span class="op" id="3406932">=</span>&nbsp;<span class="ident" id="3406934"><a href="/text/template/parse/parse.go.html#3406776">t</a></span><span class="op" id="3406935">.</span><span class="ident" id="3406936">lex</span><span class="op" id="3406939">.</span><span class="ident" id="3406940">lineNumber</span><span class="op" id="3406950">(</span><span class="op" id="3406951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406954"><a href="/text/template/parse/parse.go.html#3406852">pipe</a></span>&nbsp;<span class="op" id="3406959">=</span>&nbsp;<span class="ident" id="3406961"><a href="/text/template/parse/parse.go.html#3406776">t</a></span><span class="op" id="3406962">.</span><span class="ident" id="3406963">pipeline</span><span class="op" id="3406971">(</span><span class="ident" id="3406972"><a href="/text/template/parse/parse.go.html#3406816">context</a></span><span class="op" id="3406979">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406982">var</span>&nbsp;<span class="ident" id="3406986">next</span>&nbsp;<span class="ident" id="3406991"><a href="/text/template/parse/node.go.html#3375303">Node</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406997"><a href="/text/template/parse/parse.go.html#3406868">list</a></span><span class="op" id="3407001">,</span>&nbsp;<span class="ident" id="3407003"><a href="/text/template/parse/parse.go.html#3406986">next</a></span>&nbsp;<span class="op" id="3407008">=</span>&nbsp;<span class="ident" id="3407010"><a href="/text/template/parse/parse.go.html#3406776">t</a></span><span class="op" id="3407011">.</span><span class="ident" id="3407012">itemList</span><span class="op" id="3407020">(</span><span class="op" id="3407021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407024">switch</span>&nbsp;<span class="ident" id="3407031"><a href="/text/template/parse/parse.go.html#3406986">next</a></span><span class="op" id="3407035">.</span><span class="ident" id="3407036">Type</span><span class="op" id="3407040">(</span><span class="op" id="3407041">)</span>&nbsp;<span class="op" id="3407043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407046">case</span>&nbsp;<span class="ident" id="3407051"><a href="/text/template/parse/node.go.html#3376599">nodeEnd</a></span><span class="op" id="3407058">:</span>&nbsp;<span class="comment" id="3407060">//done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407068">case</span>&nbsp;<span class="ident" id="3407073"><a href="/text/template/parse/node.go.html#3376529">nodeElse</a></span><span class="op" id="3407081">:</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407085">if</span>&nbsp;<span class="ident" id="3407088"><a href="/text/template/parse/parse.go.html#3406798">allowElseIf</a></span>&nbsp;<span class="op" id="3407100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3407105">//&nbsp;Special&nbsp;case&nbsp;for&nbsp;&#34;else&nbsp;if&#34;.&nbsp;If&nbsp;the&nbsp;&#34;else&#34;&nbsp;is&nbsp;followed&nbsp;immediately&nbsp;by&nbsp;an&nbsp;&#34;if&#34;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3407189">//&nbsp;the&nbsp;elseControl&nbsp;will&nbsp;have&nbsp;left&nbsp;the&nbsp;&#34;if&#34;&nbsp;token&nbsp;pending.&nbsp;Treat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3407256">//&nbsp;&nbsp;&nbsp;&nbsp{{if&nbsp;a}}_{{else&nbsp;if&nbsp;b}}_{{end}}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3407293">//&nbsp;as</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3407302">//&nbsp;&nbsp;&nbsp;&nbsp{{if&nbsp;a}}_{{else}}{{if&nbsp;b}}_{{end}}{{end}}.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3407350">//&nbsp;To&nbsp;do&nbsp;this,&nbsp;parse&nbsp;the&nbsp;if&nbsp;as&nbsp;usual&nbsp;and&nbsp;stop&nbsp;at&nbsp;it&nbsp;{{end}};&nbsp;the&nbsp;subsequent{{end}}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3407436">//&nbsp;is&nbsp;assumed.&nbsp;This&nbsp;technique&nbsp;works&nbsp;even&nbsp;for&nbsp;long&nbsp;if-else-if&nbsp;chains.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3407508">//&nbsp;TODO:&nbsp;Should&nbsp;we&nbsp;allow&nbsp;else-if&nbsp;in&nbsp;with&nbsp;and&nbsp;range?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407563">if</span>&nbsp;<span class="ident" id="3407566"><a href="/text/template/parse/parse.go.html#3406776">t</a></span><span class="op" id="3407567">.</span><span class="ident" id="3407568">peek</span><span class="op" id="3407572">(</span><span class="op" id="3407573">)</span><span class="op" id="3407574">.</span><span class="ident" id="3407575">typ</span>&nbsp;<span class="op" id="3407579">==</span>&nbsp;<span class="ident" id="3407582"><a href="/text/template/parse/lex.go.html#3363101">itemIf</a></span>&nbsp;<span class="op" id="3407589">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407595"><a href="/text/template/parse/parse.go.html#3406776">t</a></span><span class="op" id="3407596">.</span><span class="ident" id="3407597">next</span><span class="op" id="3407601">(</span><span class="op" id="3407602">)</span>&nbsp;<span class="comment" id="3407604">//&nbsp;Consume&nbsp;the&nbsp;&#34;if&#34;&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407635"><a href="/text/template/parse/parse.go.html#3406874">elseList</a></span>&nbsp;<span class="op" id="3407644">=</span>&nbsp;<span class="ident" id="3407646"><a href="/text/template/parse/parse.go.html#3406776">t</a></span><span class="op" id="3407647">.</span><span class="ident" id="3407648">newList</span><span class="op" id="3407655">(</span><span class="ident" id="3407656"><a href="/text/template/parse/parse.go.html#3406986">next</a></span><span class="op" id="3407660">.</span><span class="ident" id="3407661">Position</span><span class="op" id="3407669">(</span><span class="op" id="3407670">)</span><span class="op" id="3407671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407677"><a href="/text/template/parse/parse.go.html#3406874">elseList</a></span><span class="op" id="3407685">.</span><span class="builtinfunc" id="3407686">append</span><span class="op" id="3407692">(</span><span class="ident" id="3407693"><a href="/text/template/parse/parse.go.html#3406776">t</a></span><span class="op" id="3407694">.</span><span class="ident" id="3407695">ifControl</span><span class="op" id="3407704">(</span><span class="op" id="3407705">)</span><span class="op" id="3407706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3407712">//&nbsp;Do&nbsp;not&nbsp;consume&nbsp;the&nbsp;next&nbsp;item&nbsp;-&nbsp;only&nbsp;one&nbsp;{{end}}&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407777">break</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3407786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3407790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407794"><a href="/text/template/parse/parse.go.html#3406874">elseList</a></span><span class="op" id="3407802">,</span>&nbsp;<span class="ident" id="3407804"><a href="/text/template/parse/parse.go.html#3406986">next</a></span>&nbsp;<span class="op" id="3407809">=</span>&nbsp;<span class="ident" id="3407811"><a href="/text/template/parse/parse.go.html#3406776">t</a></span><span class="op" id="3407812">.</span><span class="ident" id="3407813">itemList</span><span class="op" id="3407821">(</span><span class="op" id="3407822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407826">if</span>&nbsp;<span class="ident" id="3407829"><a href="/text/template/parse/parse.go.html#3406986">next</a></span><span class="op" id="3407833">.</span><span class="ident" id="3407834">Type</span><span class="op" id="3407838">(</span><span class="op" id="3407839">)</span>&nbsp;<span class="op" id="3407841">!=</span>&nbsp;<span class="ident" id="3407844"><a href="/text/template/parse/node.go.html#3376599">nodeEnd</a></span>&nbsp;<span class="op" id="3407852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407857"><a href="/text/template/parse/parse.go.html#3406776">t</a></span><span class="op" id="3407858">.</span><span class="ident" id="3407859">errorf</span><span class="op" id="3407865">(</span><span class="string" id="3407866">&#34;expected&nbsp;end;&nbsp;found&nbsp;%s&#34;</span><span class="op" id="3407890">,</span>&nbsp;<span class="ident" id="3407892"><a href="/text/template/parse/parse.go.html#3406986">next</a></span><span class="op" id="3407896">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3407900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3407903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407906">return</span>&nbsp;<span class="ident" id="3407913"><a href="/text/template/parse/parse.go.html#3406852">pipe</a></span><span class="op" id="3407917">.</span><span class="ident" id="3407918">Position</span><span class="op" id="3407926">(</span><span class="op" id="3407927">)</span><span class="op" id="3407928">,</span>&nbsp;<span class="ident" id="3407930"><a href="/text/template/parse/parse.go.html#3406842">line</a></span><span class="op" id="3407934">,</span>&nbsp;<span class="ident" id="3407936"><a href="/text/template/parse/parse.go.html#3406852">pipe</a></span><span class="op" id="3407940">,</span>&nbsp;<span class="ident" id="3407942"><a href="/text/template/parse/parse.go.html#3406868">list</a></span><span class="op" id="3407946">,</span>&nbsp;<span class="ident" id="3407948"><a href="/text/template/parse/parse.go.html#3406874">elseList</a></span><br>
<span class="lineno"></span><span class="op" id="3407957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="comment" id="3407960">//&nbsp;If:</span><br>
<span class="lineno"></span><span class="comment" id="3407967">//&nbsp;&nbsp;&nbsp;&nbsp{{if&nbsp;pipeline}}&nbsp;itemList&nbsp;{{end}}</span><br>
<span class="lineno"></span><span class="comment" id="3408003">//&nbsp;&nbsp;&nbsp;&nbsp{{if&nbsp;pipeline}}&nbsp;itemList&nbsp;{{else}}&nbsp;itemList&nbsp;{{end}}</span><br>
<span class="lineno"></span><span class="comment" id="3408057">//&nbsp;If&nbsp;keyword&nbsp;is&nbsp;past.</span><br>
<span class="lineno"></span><span class="keyword" id="3408080">func</span>&nbsp;<span class="op" id="3408085">(</span><span class="ident" id="3408086">t</span>&nbsp;<span class="op" id="3408088">*</span><span class="ident" id="3408089"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3408093">)</span>&nbsp;<span class="ident" id="3408095">ifControl</span><span class="op" id="3408104">(</span><span class="op" id="3408105">)</span>&nbsp;<span class="ident" id="3408107"><a href="/text/template/parse/node.go.html#3375303">Node</a></span>&nbsp;<span class="op" id="3408112">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408115">return</span>&nbsp;<span class="ident" id="3408122"><a href="/text/template/parse/parse.go.html#3408086">t</a></span><span class="op" id="3408123">.</span><span class="ident" id="3408124">newIf</span><span class="op" id="3408129">(</span><span class="ident" id="3408130"><a href="/text/template/parse/parse.go.html#3408086">t</a></span><span class="op" id="3408131">.</span><span class="ident" id="3408132">parseControl</span><span class="op" id="3408144">(</span><span class="ident" id="3408145">true</span><span class="op" id="3408149">,</span>&nbsp;<span class="string" id="3408151">&#34;if&#34;</span><span class="op" id="3408155">)</span><span class="op" id="3408156">)</span><br>
<span class="lineno"></span><span class="op" id="3408158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3408161">//&nbsp;Range:</span><br>
<span class="lineno"></span><span class="comment" id="3408171">//&nbsp;&nbsp;&nbsp;&nbsp{{range&nbsp;pipeline}}&nbsp;itemList&nbsp;{{end}}</span><br>
<span class="lineno">475</span><span class="comment" id="3408210">//&nbsp;&nbsp;&nbsp;&nbsp{{range&nbsp;pipeline}}&nbsp;itemList&nbsp;{{else}}&nbsp;itemList&nbsp;{{end}}</span><br>
<span class="lineno"></span><span class="comment" id="3408267">//&nbsp;Range&nbsp;keyword&nbsp;is&nbsp;past.</span><br>
<span class="lineno"></span><span class="keyword" id="3408293">func</span>&nbsp;<span class="op" id="3408298">(</span><span class="ident" id="3408299">t</span>&nbsp;<span class="op" id="3408301">*</span><span class="ident" id="3408302"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3408306">)</span>&nbsp;<span class="ident" id="3408308">rangeControl</span><span class="op" id="3408320">(</span><span class="op" id="3408321">)</span>&nbsp;<span class="ident" id="3408323"><a href="/text/template/parse/node.go.html#3375303">Node</a></span>&nbsp;<span class="op" id="3408328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408331">return</span>&nbsp;<span class="ident" id="3408338"><a href="/text/template/parse/parse.go.html#3408299">t</a></span><span class="op" id="3408339">.</span><span class="ident" id="3408340">newRange</span><span class="op" id="3408348">(</span><span class="ident" id="3408349"><a href="/text/template/parse/parse.go.html#3408299">t</a></span><span class="op" id="3408350">.</span><span class="ident" id="3408351">parseControl</span><span class="op" id="3408363">(</span><span class="ident" id="3408364">false</span><span class="op" id="3408369">,</span>&nbsp;<span class="string" id="3408371">&#34;range&#34;</span><span class="op" id="3408378">)</span><span class="op" id="3408379">)</span><br>
<span class="lineno"></span><span class="op" id="3408381">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="3408384">//&nbsp;With:</span><br>
<span class="lineno"></span><span class="comment" id="3408393">//&nbsp;&nbsp;&nbsp;&nbsp{{with&nbsp;pipeline}}&nbsp;itemList&nbsp;{{end}}</span><br>
<span class="lineno"></span><span class="comment" id="3408431">//&nbsp;&nbsp;&nbsp;&nbsp{{with&nbsp;pipeline}}&nbsp;itemList&nbsp;{{else}}&nbsp;itemList&nbsp;{{end}}</span><br>
<span class="lineno"></span><span class="comment" id="3408487">//&nbsp;If&nbsp;keyword&nbsp;is&nbsp;past.</span><br>
<span class="lineno">485</span><span class="keyword" id="3408510">func</span>&nbsp;<span class="op" id="3408515">(</span><span class="ident" id="3408516">t</span>&nbsp;<span class="op" id="3408518">*</span><span class="ident" id="3408519"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3408523">)</span>&nbsp;<span class="ident" id="3408525">withControl</span><span class="op" id="3408536">(</span><span class="op" id="3408537">)</span>&nbsp;<span class="ident" id="3408539"><a href="/text/template/parse/node.go.html#3375303">Node</a></span>&nbsp;<span class="op" id="3408544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408547">return</span>&nbsp;<span class="ident" id="3408554"><a href="/text/template/parse/parse.go.html#3408516">t</a></span><span class="op" id="3408555">.</span><span class="ident" id="3408556">newWith</span><span class="op" id="3408563">(</span><span class="ident" id="3408564"><a href="/text/template/parse/parse.go.html#3408516">t</a></span><span class="op" id="3408565">.</span><span class="ident" id="3408566">parseControl</span><span class="op" id="3408578">(</span><span class="ident" id="3408579">false</span><span class="op" id="3408584">,</span>&nbsp;<span class="string" id="3408586">&#34;with&#34;</span><span class="op" id="3408592">)</span><span class="op" id="3408593">)</span><br>
<span class="lineno"></span><span class="op" id="3408595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3408598">//&nbsp;End:</span><br>
<span class="lineno">490</span><span class="comment" id="3408606">//&nbsp;&nbsp;&nbsp;&nbsp{{end}}</span><br>
<span class="lineno"></span><span class="comment" id="3408617">//&nbsp;End&nbsp;keyword&nbsp;is&nbsp;past.</span><br>
<span class="lineno"></span><span class="keyword" id="3408641">func</span>&nbsp;<span class="op" id="3408646">(</span><span class="ident" id="3408647">t</span>&nbsp;<span class="op" id="3408649">*</span><span class="ident" id="3408650"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3408654">)</span>&nbsp;<span class="ident" id="3408656">endControl</span><span class="op" id="3408666">(</span><span class="op" id="3408667">)</span>&nbsp;<span class="ident" id="3408669"><a href="/text/template/parse/node.go.html#3375303">Node</a></span>&nbsp;<span class="op" id="3408674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408677">return</span>&nbsp;<span class="ident" id="3408684"><a href="/text/template/parse/parse.go.html#3408647">t</a></span><span class="op" id="3408685">.</span><span class="ident" id="3408686">newEnd</span><span class="op" id="3408692">(</span><span class="ident" id="3408693"><a href="/text/template/parse/parse.go.html#3408647">t</a></span><span class="op" id="3408694">.</span><span class="ident" id="3408695">expect</span><span class="op" id="3408701">(</span><span class="ident" id="3408702"><a href="/text/template/parse/lex.go.html#3362584">itemRightDelim</a></span><span class="op" id="3408716">,</span>&nbsp;<span class="string" id="3408718">&#34;end&#34;</span><span class="op" id="3408723">)</span><span class="op" id="3408724">.</span><span class="ident" id="3408725">pos</span><span class="op" id="3408728">)</span><br>
<span class="lineno"></span><span class="op" id="3408730">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="comment" id="3408733">//&nbsp;Else:</span><br>
<span class="lineno"></span><span class="comment" id="3408742">//&nbsp;&nbsp;&nbsp;&nbsp{{else}}</span><br>
<span class="lineno"></span><span class="comment" id="3408754">//&nbsp;Else&nbsp;keyword&nbsp;is&nbsp;past.</span><br>
<span class="lineno"></span><span class="keyword" id="3408779">func</span>&nbsp;<span class="op" id="3408784">(</span><span class="ident" id="3408785">t</span>&nbsp;<span class="op" id="3408787">*</span><span class="ident" id="3408788"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3408792">)</span>&nbsp;<span class="ident" id="3408794">elseControl</span><span class="op" id="3408805">(</span><span class="op" id="3408806">)</span>&nbsp;<span class="ident" id="3408808"><a href="/text/template/parse/node.go.html#3375303">Node</a></span>&nbsp;<span class="op" id="3408813">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3408816">//&nbsp;Special&nbsp;case&nbsp;for&nbsp;&#34;else&nbsp;if&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408848">peek</span>&nbsp;<span class="op" id="3408853">:=</span>&nbsp;<span class="ident" id="3408856"><a href="/text/template/parse/parse.go.html#3408785">t</a></span><span class="op" id="3408857">.</span><span class="ident" id="3408858">peekNonSpace</span><span class="op" id="3408870">(</span><span class="op" id="3408871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408874">if</span>&nbsp;<span class="ident" id="3408877"><a href="/text/template/parse/parse.go.html#3408848">peek</a></span><span class="op" id="3408881">.</span><span class="ident" id="3408882">typ</span>&nbsp;<span class="op" id="3408886">==</span>&nbsp;<span class="ident" id="3408889"><a href="/text/template/parse/lex.go.html#3363101">itemIf</a></span>&nbsp;<span class="op" id="3408896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3408900">//&nbsp;We&nbsp;see&nbsp;&#34;{{else&nbsp;if&nbsp;...&nbsp;&#34;&nbsp;but&nbsp;in&nbsp;effect&nbsp;rewrite&nbsp;it&nbsp;to&nbsp;{{else}}{{if&nbsp;...&nbsp;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408977">return</span>&nbsp;<span class="ident" id="3408984"><a href="/text/template/parse/parse.go.html#3408785">t</a></span><span class="op" id="3408985">.</span><span class="ident" id="3408986">newElse</span><span class="op" id="3408993">(</span><span class="ident" id="3408994"><a href="/text/template/parse/parse.go.html#3408848">peek</a></span><span class="op" id="3408998">.</span><span class="ident" id="3408999">pos</span><span class="op" id="3409002">,</span>&nbsp;<span class="ident" id="3409004"><a href="/text/template/parse/parse.go.html#3408785">t</a></span><span class="op" id="3409005">.</span><span class="ident" id="3409006">lex</span><span class="op" id="3409009">.</span><span class="ident" id="3409010">lineNumber</span><span class="op" id="3409020">(</span><span class="op" id="3409021">)</span><span class="op" id="3409022">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409028">return</span>&nbsp;<span class="ident" id="3409035"><a href="/text/template/parse/parse.go.html#3408785">t</a></span><span class="op" id="3409036">.</span><span class="ident" id="3409037">newElse</span><span class="op" id="3409044">(</span><span class="ident" id="3409045"><a href="/text/template/parse/parse.go.html#3408785">t</a></span><span class="op" id="3409046">.</span><span class="ident" id="3409047">expect</span><span class="op" id="3409053">(</span><span class="ident" id="3409054"><a href="/text/template/parse/lex.go.html#3362584">itemRightDelim</a></span><span class="op" id="3409068">,</span>&nbsp;<span class="string" id="3409070">&#34;else&#34;</span><span class="op" id="3409076">)</span><span class="op" id="3409077">.</span><span class="ident" id="3409078">pos</span><span class="op" id="3409081">,</span>&nbsp;<span class="ident" id="3409083"><a href="/text/template/parse/parse.go.html#3408785">t</a></span><span class="op" id="3409084">.</span><span class="ident" id="3409085">lex</span><span class="op" id="3409088">.</span><span class="ident" id="3409089">lineNumber</span><span class="op" id="3409099">(</span><span class="op" id="3409100">)</span><span class="op" id="3409101">)</span><br>
<span class="lineno"></span><span class="op" id="3409103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3409106">//&nbsp;Template:</span><br>
<span class="lineno">510</span><span class="comment" id="3409119">//&nbsp;&nbsp;&nbsp;&nbsp{{template&nbsp;stringValue&nbsp;pipeline}}</span><br>
<span class="lineno"></span><span class="comment" id="3409156">//&nbsp;Template&nbsp;keyword&nbsp;is&nbsp;past.&nbsp;&nbsp;The&nbsp;name&nbsp;must&nbsp;be&nbsp;something&nbsp;that&nbsp;can&nbsp;evaluate</span><br>
<span class="lineno"></span><span class="comment" id="3409231">//&nbsp;to&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3409247">func</span>&nbsp;<span class="op" id="3409252">(</span><span class="ident" id="3409253">t</span>&nbsp;<span class="op" id="3409255">*</span><span class="ident" id="3409256"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3409260">)</span>&nbsp;<span class="ident" id="3409262">templateControl</span><span class="op" id="3409277">(</span><span class="op" id="3409278">)</span>&nbsp;<span class="ident" id="3409280"><a href="/text/template/parse/node.go.html#3375303">Node</a></span>&nbsp;<span class="op" id="3409285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409288">var</span>&nbsp;<span class="ident" id="3409292">name</span>&nbsp;<span class="builtintype" id="3409297">string</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409305">token</span>&nbsp;<span class="op" id="3409311">:=</span>&nbsp;<span class="ident" id="3409314"><a href="/text/template/parse/parse.go.html#3409253">t</a></span><span class="op" id="3409315">.</span><span class="ident" id="3409316">nextNonSpace</span><span class="op" id="3409328">(</span><span class="op" id="3409329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409332">switch</span>&nbsp;<span class="ident" id="3409339"><a href="/text/template/parse/parse.go.html#3409305">token</a></span><span class="op" id="3409344">.</span><span class="ident" id="3409345">typ</span>&nbsp;<span class="op" id="3409349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409352">case</span>&nbsp;<span class="ident" id="3409357"><a href="/text/template/parse/lex.go.html#3362717">itemString</a></span><span class="op" id="3409367">,</span>&nbsp;<span class="ident" id="3409369"><a href="/text/template/parse/lex.go.html#3362529">itemRawString</a></span><span class="op" id="3409382">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409386">s</span><span class="op" id="3409387">,</span>&nbsp;<span class="ident" id="3409389">err</span>&nbsp;<span class="op" id="3409393">:=</span>&nbsp;<span class="ident" id="3409396"><a href="/text/template/parse/parse.go.html#3395822">strconv</a></span><span class="op" id="3409403">.</span><span class="ident" id="3409404">Unquote</span><span class="op" id="3409411">(</span><span class="ident" id="3409412"><a href="/text/template/parse/parse.go.html#3409305">token</a></span><span class="op" id="3409417">.</span><span class="ident" id="3409418">val</span><span class="op" id="3409421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409425">if</span>&nbsp;<span class="ident" id="3409428"><a href="/text/template/parse/parse.go.html#3409389">err</a></span>&nbsp;<span class="op" id="3409432">!=</span>&nbsp;<span class="ident" id="3409435">nil</span>&nbsp;<span class="op" id="3409439">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409444"><a href="/text/template/parse/parse.go.html#3409253">t</a></span><span class="op" id="3409445">.</span><span class="builtintype" id="3409446">error</span><span class="op" id="3409451">(</span><span class="ident" id="3409452"><a href="/text/template/parse/parse.go.html#3409389">err</a></span><span class="op" id="3409455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409463"><a href="/text/template/parse/parse.go.html#3409292">name</a></span>&nbsp;<span class="op" id="3409468">=</span>&nbsp;<span class="ident" id="3409470"><a href="/text/template/parse/parse.go.html#3409386">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409473">default</span><span class="op" id="3409480">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409484"><a href="/text/template/parse/parse.go.html#3409253">t</a></span><span class="op" id="3409485">.</span><span class="ident" id="3409486">unexpected</span><span class="op" id="3409496">(</span><span class="ident" id="3409497"><a href="/text/template/parse/parse.go.html#3409305">token</a></span><span class="op" id="3409502">,</span>&nbsp;<span class="string" id="3409504">&#34;template&nbsp;invocation&#34;</span><span class="op" id="3409525">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409531">var</span>&nbsp;<span class="ident" id="3409535">pipe</span>&nbsp;<span class="op" id="3409540">*</span><span class="ident" id="3409541"><a href="/text/template/parse/node.go.html#3378671">PipeNode</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409551">if</span>&nbsp;<span class="ident" id="3409554"><a href="/text/template/parse/parse.go.html#3409253">t</a></span><span class="op" id="3409555">.</span><span class="ident" id="3409556">nextNonSpace</span><span class="op" id="3409568">(</span><span class="op" id="3409569">)</span><span class="op" id="3409570">.</span><span class="ident" id="3409571">typ</span>&nbsp;<span class="op" id="3409575">!=</span>&nbsp;<span class="ident" id="3409578"><a href="/text/template/parse/lex.go.html#3362584">itemRightDelim</a></span>&nbsp;<span class="op" id="3409593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409597"><a href="/text/template/parse/parse.go.html#3409253">t</a></span><span class="op" id="3409598">.</span><span class="ident" id="3409599">backup</span><span class="op" id="3409605">(</span><span class="op" id="3409606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3409610">//&nbsp;Do&nbsp;not&nbsp;pop&nbsp;variables;&nbsp;they&nbsp;persist&nbsp;until&nbsp;&#34;end&#34;.</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409663"><a href="/text/template/parse/parse.go.html#3409535">pipe</a></span>&nbsp;<span class="op" id="3409668">=</span>&nbsp;<span class="ident" id="3409670"><a href="/text/template/parse/parse.go.html#3409253">t</a></span><span class="op" id="3409671">.</span><span class="ident" id="3409672">pipeline</span><span class="op" id="3409680">(</span><span class="string" id="3409681">&#34;template&#34;</span><span class="op" id="3409691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409697">return</span>&nbsp;<span class="ident" id="3409704"><a href="/text/template/parse/parse.go.html#3409253">t</a></span><span class="op" id="3409705">.</span><span class="ident" id="3409706">newTemplate</span><span class="op" id="3409717">(</span><span class="ident" id="3409718"><a href="/text/template/parse/parse.go.html#3409305">token</a></span><span class="op" id="3409723">.</span><span class="ident" id="3409724">pos</span><span class="op" id="3409727">,</span>&nbsp;<span class="ident" id="3409729"><a href="/text/template/parse/parse.go.html#3409253">t</a></span><span class="op" id="3409730">.</span><span class="ident" id="3409731">lex</span><span class="op" id="3409734">.</span><span class="ident" id="3409735">lineNumber</span><span class="op" id="3409745">(</span><span class="op" id="3409746">)</span><span class="op" id="3409747">,</span>&nbsp;<span class="ident" id="3409749"><a href="/text/template/parse/parse.go.html#3409292">name</a></span><span class="op" id="3409753">,</span>&nbsp;<span class="ident" id="3409755"><a href="/text/template/parse/parse.go.html#3409535">pipe</a></span><span class="op" id="3409759">)</span><br>
<span class="lineno"></span><span class="op" id="3409761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3409764">//&nbsp;command:</span><br>
<span class="lineno"></span><span class="comment" id="3409776">//&nbsp;&nbsp;&nbsp;&nbspoperand&nbsp;(space&nbsp;operand)*</span><br>
<span class="lineno"></span><span class="comment" id="3409804">//&nbsp;space-separated&nbsp;arguments&nbsp;up&nbsp;to&nbsp;a&nbsp;pipeline&nbsp;character&nbsp;or&nbsp;right&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="3409880">//&nbsp;we&nbsp;consume&nbsp;the&nbsp;pipe&nbsp;character&nbsp;but&nbsp;leave&nbsp;the&nbsp;right&nbsp;delim&nbsp;to&nbsp;terminate&nbsp;the&nbsp;action.</span><br>
<span class="lineno"></span><span class="keyword" id="3409964">func</span>&nbsp;<span class="op" id="3409969">(</span><span class="ident" id="3409970">t</span>&nbsp;<span class="op" id="3409972">*</span><span class="ident" id="3409973"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3409977">)</span>&nbsp;<span class="ident" id="3409979">command</span><span class="op" id="3409986">(</span><span class="op" id="3409987">)</span>&nbsp;<span class="op" id="3409989">*</span><span class="ident" id="3409990"><a href="/text/template/parse/node.go.html#3380702">CommandNode</a></span>&nbsp;<span class="op" id="3410002">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410005">cmd</span>&nbsp;<span class="op" id="3410009">:=</span>&nbsp;<span class="ident" id="3410012"><a href="/text/template/parse/parse.go.html#3409970">t</a></span><span class="op" id="3410013">.</span><span class="ident" id="3410014">newCommand</span><span class="op" id="3410024">(</span><span class="ident" id="3410025"><a href="/text/template/parse/parse.go.html#3409970">t</a></span><span class="op" id="3410026">.</span><span class="ident" id="3410027">peekNonSpace</span><span class="op" id="3410039">(</span><span class="op" id="3410040">)</span><span class="op" id="3410041">.</span><span class="ident" id="3410042">pos</span><span class="op" id="3410045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410048">for</span>&nbsp;<span class="op" id="3410052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410056"><a href="/text/template/parse/parse.go.html#3409970">t</a></span><span class="op" id="3410057">.</span><span class="ident" id="3410058">peekNonSpace</span><span class="op" id="3410070">(</span><span class="op" id="3410071">)</span>&nbsp;<span class="comment" id="3410073">//&nbsp;skip&nbsp;leading&nbsp;spaces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410099">operand</span>&nbsp;<span class="op" id="3410107">:=</span>&nbsp;<span class="ident" id="3410110"><a href="/text/template/parse/parse.go.html#3409970">t</a></span><span class="op" id="3410111">.</span><span class="ident" id="3410112">operand</span><span class="op" id="3410119">(</span><span class="op" id="3410120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410124">if</span>&nbsp;<span class="ident" id="3410127"><a href="/text/template/parse/parse.go.html#3410099">operand</a></span>&nbsp;<span class="op" id="3410135">!=</span>&nbsp;<span class="ident" id="3410138">nil</span>&nbsp;<span class="op" id="3410142">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410147"><a href="/text/template/parse/parse.go.html#3410005">cmd</a></span><span class="op" id="3410150">.</span><span class="builtinfunc" id="3410151">append</span><span class="op" id="3410157">(</span><span class="ident" id="3410158"><a href="/text/template/parse/parse.go.html#3410099">operand</a></span><span class="op" id="3410165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3410169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410173">switch</span>&nbsp;<span class="ident" id="3410180">token</span>&nbsp;<span class="op" id="3410186">:=</span>&nbsp;<span class="ident" id="3410189"><a href="/text/template/parse/parse.go.html#3409970">t</a></span><span class="op" id="3410190">.</span><span class="ident" id="3410191">next</span><span class="op" id="3410195">(</span><span class="op" id="3410196">)</span><span class="op" id="3410197">;</span>&nbsp;<span class="ident" id="3410199"><a href="/text/template/parse/parse.go.html#3410180">token</a></span><span class="op" id="3410204">.</span><span class="ident" id="3410205">typ</span>&nbsp;<span class="op" id="3410209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410213">case</span>&nbsp;<span class="ident" id="3410218"><a href="/text/template/parse/lex.go.html#3362663">itemSpace</a></span><span class="op" id="3410227">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410232">continue</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410243">case</span>&nbsp;<span class="ident" id="3410248"><a href="/text/template/parse/lex.go.html#3361785">itemError</a></span><span class="op" id="3410257">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410262"><a href="/text/template/parse/parse.go.html#3409970">t</a></span><span class="op" id="3410263">.</span><span class="ident" id="3410264">errorf</span><span class="op" id="3410270">(</span><span class="string" id="3410271">&#34;%s&#34;</span><span class="op" id="3410275">,</span>&nbsp;<span class="ident" id="3410277"><a href="/text/template/parse/parse.go.html#3410180">token</a></span><span class="op" id="3410282">.</span><span class="ident" id="3410283">val</span><span class="op" id="3410286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410290">case</span>&nbsp;<span class="ident" id="3410295"><a href="/text/template/parse/lex.go.html#3362584">itemRightDelim</a></span><span class="op" id="3410309">,</span>&nbsp;<span class="ident" id="3410311"><a href="/text/template/parse/lex.go.html#3362626">itemRightParen</a></span><span class="op" id="3410325">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410330"><a href="/text/template/parse/parse.go.html#3409970">t</a></span><span class="op" id="3410331">.</span><span class="ident" id="3410332">backup</span><span class="op" id="3410338">(</span><span class="op" id="3410339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410343">case</span>&nbsp;<span class="ident" id="3410348"><a href="/text/template/parse/lex.go.html#3362498">itemPipe</a></span><span class="op" id="3410356">:</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410360">default</span><span class="op" id="3410367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410372"><a href="/text/template/parse/parse.go.html#3409970">t</a></span><span class="op" id="3410373">.</span><span class="ident" id="3410374">errorf</span><span class="op" id="3410380">(</span><span class="string" id="3410381">&#34;unexpected&nbsp;%s&nbsp;in&nbsp;operand;&nbsp;missing&nbsp;space?&#34;</span><span class="op" id="3410423">,</span>&nbsp;<span class="ident" id="3410425"><a href="/text/template/parse/parse.go.html#3410180">token</a></span><span class="op" id="3410430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3410434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410438">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3410445">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410448">if</span>&nbsp;<span class="builtinfunc" id="3410451">len</span><span class="op" id="3410454">(</span><span class="ident" id="3410455"><a href="/text/template/parse/parse.go.html#3410005">cmd</a></span><span class="op" id="3410458">.</span><span class="ident" id="3410459">Args</span><span class="op" id="3410463">)</span>&nbsp;<span class="op" id="3410465">==</span>&nbsp;<span class="num" id="3410468">0</span>&nbsp;<span class="op" id="3410470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410474"><a href="/text/template/parse/parse.go.html#3409970">t</a></span><span class="op" id="3410475">.</span><span class="ident" id="3410476">errorf</span><span class="op" id="3410482">(</span><span class="string" id="3410483">&#34;empty&nbsp;command&#34;</span><span class="op" id="3410498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3410501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410504">return</span>&nbsp;<span class="ident" id="3410511"><a href="/text/template/parse/parse.go.html#3410005">cmd</a></span><br>
<span class="lineno"></span><span class="op" id="3410515">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="3410518">//&nbsp;operand:</span><br>
<span class="lineno"></span><span class="comment" id="3410530">//&nbsp;&nbsp;&nbsp;&nbspterm&nbsp;.Field*</span><br>
<span class="lineno"></span><span class="comment" id="3410546">//&nbsp;An&nbsp;operand&nbsp;is&nbsp;a&nbsp;space-separated&nbsp;component&nbsp;of&nbsp;a&nbsp;command,</span><br>
<span class="lineno"></span><span class="comment" id="3410605">//&nbsp;a&nbsp;term&nbsp;possibly&nbsp;followed&nbsp;by&nbsp;field&nbsp;accesses.</span><br>
<span class="lineno">570</span><span class="comment" id="3410652">//&nbsp;A&nbsp;nil&nbsp;return&nbsp;means&nbsp;the&nbsp;next&nbsp;item&nbsp;is&nbsp;not&nbsp;an&nbsp;operand.</span><br>
<span class="lineno"></span><span class="keyword" id="3410707">func</span>&nbsp;<span class="op" id="3410712">(</span><span class="ident" id="3410713">t</span>&nbsp;<span class="op" id="3410715">*</span><span class="ident" id="3410716"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3410720">)</span>&nbsp;<span class="ident" id="3410722">operand</span><span class="op" id="3410729">(</span><span class="op" id="3410730">)</span>&nbsp;<span class="ident" id="3410732"><a href="/text/template/parse/node.go.html#3375303">Node</a></span>&nbsp;<span class="op" id="3410737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410740">node</span>&nbsp;<span class="op" id="3410745">:=</span>&nbsp;<span class="ident" id="3410748"><a href="/text/template/parse/parse.go.html#3410713">t</a></span><span class="op" id="3410749">.</span><span class="ident" id="3410750">term</span><span class="op" id="3410754">(</span><span class="op" id="3410755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410758">if</span>&nbsp;<span class="ident" id="3410761"><a href="/text/template/parse/parse.go.html#3410740">node</a></span>&nbsp;<span class="op" id="3410766">==</span>&nbsp;<span class="ident" id="3410769">nil</span>&nbsp;<span class="op" id="3410773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410777">return</span>&nbsp;<span class="ident" id="3410784">nil</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3410789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410792">if</span>&nbsp;<span class="ident" id="3410795"><a href="/text/template/parse/parse.go.html#3410713">t</a></span><span class="op" id="3410796">.</span><span class="ident" id="3410797">peek</span><span class="op" id="3410801">(</span><span class="op" id="3410802">)</span><span class="op" id="3410803">.</span><span class="ident" id="3410804">typ</span>&nbsp;<span class="op" id="3410808">==</span>&nbsp;<span class="ident" id="3410811"><a href="/text/template/parse/lex.go.html#3362240">itemField</a></span>&nbsp;<span class="op" id="3410821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410825">chain</span>&nbsp;<span class="op" id="3410831">:=</span>&nbsp;<span class="ident" id="3410834"><a href="/text/template/parse/parse.go.html#3410713">t</a></span><span class="op" id="3410835">.</span><span class="ident" id="3410836">newChain</span><span class="op" id="3410844">(</span><span class="ident" id="3410845"><a href="/text/template/parse/parse.go.html#3410713">t</a></span><span class="op" id="3410846">.</span><span class="ident" id="3410847">peek</span><span class="op" id="3410851">(</span><span class="op" id="3410852">)</span><span class="op" id="3410853">.</span><span class="ident" id="3410854">pos</span><span class="op" id="3410857">,</span>&nbsp;<span class="ident" id="3410859"><a href="/text/template/parse/parse.go.html#3410740">node</a></span><span class="op" id="3410863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410867">for</span>&nbsp;<span class="ident" id="3410871"><a href="/text/template/parse/parse.go.html#3410713">t</a></span><span class="op" id="3410872">.</span><span class="ident" id="3410873">peek</span><span class="op" id="3410877">(</span><span class="op" id="3410878">)</span><span class="op" id="3410879">.</span><span class="ident" id="3410880">typ</span>&nbsp;<span class="op" id="3410884">==</span>&nbsp;<span class="ident" id="3410887"><a href="/text/template/parse/lex.go.html#3362240">itemField</a></span>&nbsp;<span class="op" id="3410897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410902"><a href="/text/template/parse/parse.go.html#3410825">chain</a></span><span class="op" id="3410907">.</span><span class="ident" id="3410908">Add</span><span class="op" id="3410911">(</span><span class="ident" id="3410912"><a href="/text/template/parse/parse.go.html#3410713">t</a></span><span class="op" id="3410913">.</span><span class="ident" id="3410914">next</span><span class="op" id="3410918">(</span><span class="op" id="3410919">)</span><span class="op" id="3410920">.</span><span class="ident" id="3410921">val</span><span class="op" id="3410924">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3410928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3410932">//&nbsp;Compatibility&nbsp;with&nbsp;original&nbsp;API:&nbsp;If&nbsp;the&nbsp;term&nbsp;is&nbsp;of&nbsp;type&nbsp;NodeField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3411003">//&nbsp;or&nbsp;NodeVariable,&nbsp;just&nbsp;put&nbsp;more&nbsp;fields&nbsp;on&nbsp;the&nbsp;original.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3411063">//&nbsp;Otherwise,&nbsp;keep&nbsp;the&nbsp;Chain&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3411100">//&nbsp;TODO:&nbsp;Switch&nbsp;to&nbsp;Chains&nbsp;always&nbsp;when&nbsp;we&nbsp;can.</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411148">switch</span>&nbsp;<span class="ident" id="3411155"><a href="/text/template/parse/parse.go.html#3410740">node</a></span><span class="op" id="3411159">.</span><span class="ident" id="3411160">Type</span><span class="op" id="3411164">(</span><span class="op" id="3411165">)</span>&nbsp;<span class="op" id="3411167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411171">case</span>&nbsp;<span class="ident" id="3411176"><a href="/text/template/parse/node.go.html#3376668">NodeField</a></span><span class="op" id="3411185">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411190"><a href="/text/template/parse/parse.go.html#3410740">node</a></span>&nbsp;<span class="op" id="3411195">=</span>&nbsp;<span class="ident" id="3411197"><a href="/text/template/parse/parse.go.html#3410713">t</a></span><span class="op" id="3411198">.</span><span class="ident" id="3411199">newField</span><span class="op" id="3411207">(</span><span class="ident" id="3411208"><a href="/text/template/parse/parse.go.html#3410825">chain</a></span><span class="op" id="3411213">.</span><span class="ident" id="3411214">Position</span><span class="op" id="3411222">(</span><span class="op" id="3411223">)</span><span class="op" id="3411224">,</span>&nbsp;<span class="ident" id="3411226"><a href="/text/template/parse/parse.go.html#3410825">chain</a></span><span class="op" id="3411231">.</span><span class="ident" id="3411232">String</span><span class="op" id="3411238">(</span><span class="op" id="3411239">)</span><span class="op" id="3411240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411244">case</span>&nbsp;<span class="ident" id="3411249"><a href="/text/template/parse/node.go.html#3377248">NodeVariable</a></span><span class="op" id="3411261">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411266"><a href="/text/template/parse/parse.go.html#3410740">node</a></span>&nbsp;<span class="op" id="3411271">=</span>&nbsp;<span class="ident" id="3411273"><a href="/text/template/parse/parse.go.html#3410713">t</a></span><span class="op" id="3411274">.</span><span class="ident" id="3411275">newVariable</span><span class="op" id="3411286">(</span><span class="ident" id="3411287"><a href="/text/template/parse/parse.go.html#3410825">chain</a></span><span class="op" id="3411292">.</span><span class="ident" id="3411293">Position</span><span class="op" id="3411301">(</span><span class="op" id="3411302">)</span><span class="op" id="3411303">,</span>&nbsp;<span class="ident" id="3411305"><a href="/text/template/parse/parse.go.html#3410825">chain</a></span><span class="op" id="3411310">.</span><span class="ident" id="3411311">String</span><span class="op" id="3411317">(</span><span class="op" id="3411318">)</span><span class="op" id="3411319">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411323">default</span><span class="op" id="3411330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411335"><a href="/text/template/parse/parse.go.html#3410740">node</a></span>&nbsp;<span class="op" id="3411340">=</span>&nbsp;<span class="ident" id="3411342"><a href="/text/template/parse/parse.go.html#3410825">chain</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411356">return</span>&nbsp;<span class="ident" id="3411363"><a href="/text/template/parse/parse.go.html#3410740">node</a></span><br>
<span class="lineno">595</span><span class="op" id="3411368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3411371">//&nbsp;term:</span><br>
<span class="lineno"></span><span class="comment" id="3411380">//&nbsp;&nbsp;&nbsp;&nbspliteral&nbsp;(number,&nbsp;string,&nbsp;nil,&nbsp;boolean)</span><br>
<span class="lineno"></span><span class="comment" id="3411422">//&nbsp;&nbsp;&nbsp;&nbspfunction&nbsp;(identifier)</span><br>
<span class="lineno">600</span><span class="comment" id="3411447">//&nbsp;&nbsp;&nbsp;&nbsp.</span><br>
<span class="lineno"></span><span class="comment" id="3411452">//&nbsp;&nbsp;&nbsp;&nbsp.Field</span><br>
<span class="lineno"></span><span class="comment" id="3411462">//&nbsp;&nbsp;&nbsp;&nbsp$</span><br>
<span class="lineno"></span><span class="comment" id="3411467">//&nbsp;&nbsp;&nbsp;&nbsp&#39;(&#39;&nbsp;pipeline&nbsp;&#39;)&#39;</span><br>
<span class="lineno"></span><span class="comment" id="3411487">//&nbsp;A&nbsp;term&nbsp;is&nbsp;a&nbsp;simple&nbsp;&#34;expression&#34;.</span><br>
<span class="lineno">605</span><span class="comment" id="3411523">//&nbsp;A&nbsp;nil&nbsp;return&nbsp;means&nbsp;the&nbsp;next&nbsp;item&nbsp;is&nbsp;not&nbsp;a&nbsp;term.</span><br>
<span class="lineno"></span><span class="keyword" id="3411574">func</span>&nbsp;<span class="op" id="3411579">(</span><span class="ident" id="3411580">t</span>&nbsp;<span class="op" id="3411582">*</span><span class="ident" id="3411583"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3411587">)</span>&nbsp;<span class="ident" id="3411589">term</span><span class="op" id="3411593">(</span><span class="op" id="3411594">)</span>&nbsp;<span class="ident" id="3411596"><a href="/text/template/parse/node.go.html#3375303">Node</a></span>&nbsp;<span class="op" id="3411601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411604">switch</span>&nbsp;<span class="ident" id="3411611">token</span>&nbsp;<span class="op" id="3411617">:=</span>&nbsp;<span class="ident" id="3411620"><a href="/text/template/parse/parse.go.html#3411580">t</a></span><span class="op" id="3411621">.</span><span class="ident" id="3411622">nextNonSpace</span><span class="op" id="3411634">(</span><span class="op" id="3411635">)</span><span class="op" id="3411636">;</span>&nbsp;<span class="ident" id="3411638"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3411643">.</span><span class="ident" id="3411644">typ</span>&nbsp;<span class="op" id="3411648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411651">case</span>&nbsp;<span class="ident" id="3411656"><a href="/text/template/parse/lex.go.html#3361785">itemError</a></span><span class="op" id="3411665">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411669"><a href="/text/template/parse/parse.go.html#3411580">t</a></span><span class="op" id="3411670">.</span><span class="ident" id="3411671">errorf</span><span class="op" id="3411677">(</span><span class="string" id="3411678">&#34;%s&#34;</span><span class="op" id="3411682">,</span>&nbsp;<span class="ident" id="3411684"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3411689">.</span><span class="ident" id="3411690">val</span><span class="op" id="3411693">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411696">case</span>&nbsp;<span class="ident" id="3411701"><a href="/text/template/parse/lex.go.html#3362301">itemIdentifier</a></span><span class="op" id="3411715">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411719">if</span>&nbsp;<span class="op" id="3411722">!</span><span class="ident" id="3411723"><a href="/text/template/parse/parse.go.html#3411580">t</a></span><span class="op" id="3411724">.</span><span class="ident" id="3411725">hasFunction</span><span class="op" id="3411736">(</span><span class="ident" id="3411737"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3411742">.</span><span class="ident" id="3411743">val</span><span class="op" id="3411746">)</span>&nbsp;<span class="op" id="3411748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411753"><a href="/text/template/parse/parse.go.html#3411580">t</a></span><span class="op" id="3411754">.</span><span class="ident" id="3411755">errorf</span><span class="op" id="3411761">(</span><span class="string" id="3411762">&#34;function&nbsp;%q&nbsp;not&nbsp;defined&#34;</span><span class="op" id="3411787">,</span>&nbsp;<span class="ident" id="3411789"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3411794">.</span><span class="ident" id="3411795">val</span><span class="op" id="3411798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411806">return</span>&nbsp;<span class="ident" id="3411813"><a href="/text/template/parse/node.go.html#3381682">NewIdentifier</a></span><span class="op" id="3411826">(</span><span class="ident" id="3411827"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3411832">.</span><span class="ident" id="3411833">val</span><span class="op" id="3411836">)</span><span class="op" id="3411837">.</span><span class="ident" id="3411838">SetTree</span><span class="op" id="3411845">(</span><span class="ident" id="3411846"><a href="/text/template/parse/parse.go.html#3411580">t</a></span><span class="op" id="3411847">)</span><span class="op" id="3411848">.</span><span class="ident" id="3411849">SetPos</span><span class="op" id="3411855">(</span><span class="ident" id="3411856"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3411861">.</span><span class="ident" id="3411862">pos</span><span class="op" id="3411865">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411868">case</span>&nbsp;<span class="ident" id="3411873"><a href="/text/template/parse/lex.go.html#3362969">itemDot</a></span><span class="op" id="3411880">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411884">return</span>&nbsp;<span class="ident" id="3411891"><a href="/text/template/parse/parse.go.html#3411580">t</a></span><span class="op" id="3411892">.</span><span class="ident" id="3411893">newDot</span><span class="op" id="3411899">(</span><span class="ident" id="3411900"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3411905">.</span><span class="ident" id="3411906">pos</span><span class="op" id="3411909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411912">case</span>&nbsp;<span class="ident" id="3411917"><a href="/text/template/parse/lex.go.html#3363129">itemNil</a></span><span class="op" id="3411924">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411928">return</span>&nbsp;<span class="ident" id="3411935"><a href="/text/template/parse/parse.go.html#3411580">t</a></span><span class="op" id="3411936">.</span><span class="ident" id="3411937">newNil</span><span class="op" id="3411943">(</span><span class="ident" id="3411944"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3411949">.</span><span class="ident" id="3411950">pos</span><span class="op" id="3411953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411956">case</span>&nbsp;<span class="ident" id="3411961"><a href="/text/template/parse/lex.go.html#3362798">itemVariable</a></span><span class="op" id="3411973">:</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411977">return</span>&nbsp;<span class="ident" id="3411984"><a href="/text/template/parse/parse.go.html#3411580">t</a></span><span class="op" id="3411985">.</span><span class="ident" id="3411986">useVar</span><span class="op" id="3411992">(</span><span class="ident" id="3411993"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3411998">.</span><span class="ident" id="3411999">pos</span><span class="op" id="3412002">,</span>&nbsp;<span class="ident" id="3412004"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3412009">.</span><span class="ident" id="3412010">val</span><span class="op" id="3412013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412016">case</span>&nbsp;<span class="ident" id="3412021"><a href="/text/template/parse/lex.go.html#3362240">itemField</a></span><span class="op" id="3412030">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412034">return</span>&nbsp;<span class="ident" id="3412041"><a href="/text/template/parse/parse.go.html#3411580">t</a></span><span class="op" id="3412042">.</span><span class="ident" id="3412043">newField</span><span class="op" id="3412051">(</span><span class="ident" id="3412052"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3412057">.</span><span class="ident" id="3412058">pos</span><span class="op" id="3412061">,</span>&nbsp;<span class="ident" id="3412063"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3412068">.</span><span class="ident" id="3412069">val</span><span class="op" id="3412072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412075">case</span>&nbsp;<span class="ident" id="3412080"><a href="/text/template/parse/lex.go.html#3361861">itemBool</a></span><span class="op" id="3412088">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412092">return</span>&nbsp;<span class="ident" id="3412099"><a href="/text/template/parse/parse.go.html#3411580">t</a></span><span class="op" id="3412100">.</span><span class="ident" id="3412101">newBool</span><span class="op" id="3412108">(</span><span class="ident" id="3412109"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3412114">.</span><span class="ident" id="3412115">pos</span><span class="op" id="3412118">,</span>&nbsp;<span class="ident" id="3412120"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3412125">.</span><span class="ident" id="3412126">val</span>&nbsp;<span class="op" id="3412130">==</span>&nbsp;<span class="string" id="3412133">&#34;true&#34;</span><span class="op" id="3412139">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412142">case</span>&nbsp;<span class="ident" id="3412147"><a href="/text/template/parse/lex.go.html#3362003">itemCharConstant</a></span><span class="op" id="3412163">,</span>&nbsp;<span class="ident" id="3412165"><a href="/text/template/parse/lex.go.html#3362059">itemComplex</a></span><span class="op" id="3412176">,</span>&nbsp;<span class="ident" id="3412178"><a href="/text/template/parse/lex.go.html#3362444">itemNumber</a></span><span class="op" id="3412188">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412192">number</span><span class="op" id="3412198">,</span>&nbsp;<span class="ident" id="3412200">err</span>&nbsp;<span class="op" id="3412204">:=</span>&nbsp;<span class="ident" id="3412207"><a href="/text/template/parse/parse.go.html#3411580">t</a></span><span class="op" id="3412208">.</span><span class="ident" id="3412209">newNumber</span><span class="op" id="3412218">(</span><span class="ident" id="3412219"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3412224">.</span><span class="ident" id="3412225">pos</span><span class="op" id="3412228">,</span>&nbsp;<span class="ident" id="3412230"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3412235">.</span><span class="ident" id="3412236">val</span><span class="op" id="3412239">,</span>&nbsp;<span class="ident" id="3412241"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3412246">.</span><span class="ident" id="3412247">typ</span><span class="op" id="3412250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412254">if</span>&nbsp;<span class="ident" id="3412257"><a href="/text/template/parse/parse.go.html#3412200">err</a></span>&nbsp;<span class="op" id="3412261">!=</span>&nbsp;<span class="ident" id="3412264">nil</span>&nbsp;<span class="op" id="3412268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412273"><a href="/text/template/parse/parse.go.html#3411580">t</a></span><span class="op" id="3412274">.</span><span class="builtintype" id="3412275">error</span><span class="op" id="3412280">(</span><span class="ident" id="3412281"><a href="/text/template/parse/parse.go.html#3412200">err</a></span><span class="op" id="3412284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412288">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412292">return</span>&nbsp;<span class="ident" id="3412299"><a href="/text/template/parse/parse.go.html#3412192">number</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412307">case</span>&nbsp;<span class="ident" id="3412312"><a href="/text/template/parse/lex.go.html#3362407">itemLeftParen</a></span><span class="op" id="3412325">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412329">pipe</span>&nbsp;<span class="op" id="3412334">:=</span>&nbsp;<span class="ident" id="3412337"><a href="/text/template/parse/parse.go.html#3411580">t</a></span><span class="op" id="3412338">.</span><span class="ident" id="3412339">pipeline</span><span class="op" id="3412347">(</span><span class="string" id="3412348">&#34;parenthesized&nbsp;pipeline&#34;</span><span class="op" id="3412372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412376">if</span>&nbsp;<span class="ident" id="3412379">token</span>&nbsp;<span class="op" id="3412385">:=</span>&nbsp;<span class="ident" id="3412388"><a href="/text/template/parse/parse.go.html#3411580">t</a></span><span class="op" id="3412389">.</span><span class="ident" id="3412390">next</span><span class="op" id="3412394">(</span><span class="op" id="3412395">)</span><span class="op" id="3412396">;</span>&nbsp;<span class="ident" id="3412398"><a href="/text/template/parse/parse.go.html#3412379">token</a></span><span class="op" id="3412403">.</span><span class="ident" id="3412404">typ</span>&nbsp;<span class="op" id="3412408">!=</span>&nbsp;<span class="ident" id="3412411"><a href="/text/template/parse/lex.go.html#3362626">itemRightParen</a></span>&nbsp;<span class="op" id="3412426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412431"><a href="/text/template/parse/parse.go.html#3411580">t</a></span><span class="op" id="3412432">.</span><span class="ident" id="3412433">errorf</span><span class="op" id="3412439">(</span><span class="string" id="3412440">&#34;unclosed&nbsp;right&nbsp;paren:&nbsp;unexpected&nbsp;%s&#34;</span><span class="op" id="3412477">,</span>&nbsp;<span class="ident" id="3412479"><a href="/text/template/parse/parse.go.html#3412379">token</a></span><span class="op" id="3412484">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412492">return</span>&nbsp;<span class="ident" id="3412499"><a href="/text/template/parse/parse.go.html#3412329">pipe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412505">case</span>&nbsp;<span class="ident" id="3412510"><a href="/text/template/parse/lex.go.html#3362717">itemString</a></span><span class="op" id="3412520">,</span>&nbsp;<span class="ident" id="3412522"><a href="/text/template/parse/lex.go.html#3362529">itemRawString</a></span><span class="op" id="3412535">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412539">s</span><span class="op" id="3412540">,</span>&nbsp;<span class="ident" id="3412542">err</span>&nbsp;<span class="op" id="3412546">:=</span>&nbsp;<span class="ident" id="3412549"><a href="/text/template/parse/parse.go.html#3395822">strconv</a></span><span class="op" id="3412556">.</span><span class="ident" id="3412557">Unquote</span><span class="op" id="3412564">(</span><span class="ident" id="3412565"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3412570">.</span><span class="ident" id="3412571">val</span><span class="op" id="3412574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412578">if</span>&nbsp;<span class="ident" id="3412581"><a href="/text/template/parse/parse.go.html#3412542">err</a></span>&nbsp;<span class="op" id="3412585">!=</span>&nbsp;<span class="ident" id="3412588">nil</span>&nbsp;<span class="op" id="3412592">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412597"><a href="/text/template/parse/parse.go.html#3411580">t</a></span><span class="op" id="3412598">.</span><span class="builtintype" id="3412599">error</span><span class="op" id="3412604">(</span><span class="ident" id="3412605"><a href="/text/template/parse/parse.go.html#3412542">err</a></span><span class="op" id="3412608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412616">return</span>&nbsp;<span class="ident" id="3412623"><a href="/text/template/parse/parse.go.html#3411580">t</a></span><span class="op" id="3412624">.</span><span class="ident" id="3412625">newString</span><span class="op" id="3412634">(</span><span class="ident" id="3412635"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3412640">.</span><span class="ident" id="3412641">pos</span><span class="op" id="3412644">,</span>&nbsp;<span class="ident" id="3412646"><a href="/text/template/parse/parse.go.html#3411611">token</a></span><span class="op" id="3412651">.</span><span class="ident" id="3412652">val</span><span class="op" id="3412655">,</span>&nbsp;<span class="ident" id="3412657"><a href="/text/template/parse/parse.go.html#3412539">s</a></span><span class="op" id="3412658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412664"><a href="/text/template/parse/parse.go.html#3411580">t</a></span><span class="op" id="3412665">.</span><span class="ident" id="3412666">backup</span><span class="op" id="3412672">(</span><span class="op" id="3412673">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412676">return</span>&nbsp;<span class="ident" id="3412683">nil</span><br>
<span class="lineno"></span><span class="op" id="3412687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3412690">//&nbsp;hasFunction&nbsp;reports&nbsp;if&nbsp;a&nbsp;function&nbsp;name&nbsp;exists&nbsp;in&nbsp;the&nbsp;Tree&#39;s&nbsp;maps.</span><br>
<span class="lineno"></span><span class="keyword" id="3412759">func</span>&nbsp;<span class="op" id="3412764">(</span><span class="ident" id="3412765">t</span>&nbsp;<span class="op" id="3412767">*</span><span class="ident" id="3412768"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3412772">)</span>&nbsp;<span class="ident" id="3412774">hasFunction</span><span class="op" id="3412785">(</span><span class="ident" id="3412786">name</span>&nbsp;<span class="builtintype" id="3412791">string</span><span class="op" id="3412797">)</span>&nbsp;<span class="builtintype" id="3412799">bool</span>&nbsp;<span class="op" id="3412804">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412807">for</span>&nbsp;<span class="ident" id="3412811">_</span><span class="op" id="3412812">,</span>&nbsp;<span class="ident" id="3412814">funcMap</span>&nbsp;<span class="op" id="3412822">:=</span>&nbsp;<span class="keyword" id="3412825">range</span>&nbsp;<span class="ident" id="3412831"><a href="/text/template/parse/parse.go.html#3412765">t</a></span><span class="op" id="3412832">.</span><span class="ident" id="3412833">funcs</span>&nbsp;<span class="op" id="3412839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412843">if</span>&nbsp;<span class="ident" id="3412846"><a href="/text/template/parse/parse.go.html#3412814">funcMap</a></span>&nbsp;<span class="op" id="3412854">==</span>&nbsp;<span class="ident" id="3412857">nil</span>&nbsp;<span class="op" id="3412861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412866">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412881">if</span>&nbsp;<span class="ident" id="3412884"><a href="/text/template/parse/parse.go.html#3412814">funcMap</a></span><span class="op" id="3412891">[</span><span class="ident" id="3412892"><a href="/text/template/parse/parse.go.html#3412786">name</a></span><span class="op" id="3412896">]</span>&nbsp;<span class="op" id="3412898">!=</span>&nbsp;<span class="ident" id="3412901">nil</span>&nbsp;<span class="op" id="3412905">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412910">return</span>&nbsp;<span class="ident" id="3412917">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412930">return</span>&nbsp;<span class="ident" id="3412937">false</span><br>
<span class="lineno"></span><span class="op" id="3412943">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="3412946">//&nbsp;popVars&nbsp;trims&nbsp;the&nbsp;variable&nbsp;list&nbsp;to&nbsp;the&nbsp;specified&nbsp;length</span><br>
<span class="lineno"></span><span class="keyword" id="3413005">func</span>&nbsp;<span class="op" id="3413010">(</span><span class="ident" id="3413011">t</span>&nbsp;<span class="op" id="3413013">*</span><span class="ident" id="3413014"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3413018">)</span>&nbsp;<span class="ident" id="3413020">popVars</span><span class="op" id="3413027">(</span><span class="ident" id="3413028">n</span>&nbsp;<span class="builtintype" id="3413030">int</span><span class="op" id="3413033">)</span>&nbsp;<span class="op" id="3413035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413038"><a href="/text/template/parse/parse.go.html#3413011">t</a></span><span class="op" id="3413039">.</span><span class="ident" id="3413040">vars</span>&nbsp;<span class="op" id="3413045">=</span>&nbsp;<span class="ident" id="3413047"><a href="/text/template/parse/parse.go.html#3413011">t</a></span><span class="op" id="3413048">.</span><span class="ident" id="3413049">vars</span><span class="op" id="3413053">[</span><span class="op" id="3413054">:</span><span class="ident" id="3413055"><a href="/text/template/parse/parse.go.html#3413028">n</a></span><span class="op" id="3413056">]</span><br>
<span class="lineno"></span><span class="op" id="3413058">}</span><br>
<span class="lineno">665</span><br>
<span class="lineno"></span><span class="comment" id="3413061">//&nbsp;useVar&nbsp;returns&nbsp;a&nbsp;node&nbsp;for&nbsp;a&nbsp;variable&nbsp;reference.&nbsp;It&nbsp;errors&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3413129">//&nbsp;variable&nbsp;is&nbsp;not&nbsp;defined.</span><br>
<span class="lineno"></span><span class="keyword" id="3413157">func</span>&nbsp;<span class="op" id="3413162">(</span><span class="ident" id="3413163">t</span>&nbsp;<span class="op" id="3413165">*</span><span class="ident" id="3413166"><a href="/text/template/parse/parse.go.html#3395910">Tree</a></span><span class="op" id="3413170">)</span>&nbsp;<span class="ident" id="3413172">useVar</span><span class="op" id="3413178">(</span><span class="ident" id="3413179">pos</span>&nbsp;<span class="ident" id="3413183"><a href="/text/template/parse/node.go.html#3375925">Pos</a></span><span class="op" id="3413186">,</span>&nbsp;<span class="ident" id="3413188">name</span>&nbsp;<span class="builtintype" id="3413193">string</span><span class="op" id="3413199">)</span>&nbsp;<span class="ident" id="3413201"><a href="/text/template/parse/node.go.html#3375303">Node</a></span>&nbsp;<span class="op" id="3413206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413209">v</span>&nbsp;<span class="op" id="3413211">:=</span>&nbsp;<span class="ident" id="3413214"><a href="/text/template/parse/parse.go.html#3413163">t</a></span><span class="op" id="3413215">.</span><span class="ident" id="3413216">newVariable</span><span class="op" id="3413227">(</span><span class="ident" id="3413228"><a href="/text/template/parse/parse.go.html#3413179">pos</a></span><span class="op" id="3413231">,</span>&nbsp;<span class="ident" id="3413233"><a href="/text/template/parse/parse.go.html#3413188">name</a></span><span class="op" id="3413237">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413240">for</span>&nbsp;<span class="ident" id="3413244">_</span><span class="op" id="3413245">,</span>&nbsp;<span class="ident" id="3413247">varName</span>&nbsp;<span class="op" id="3413255">:=</span>&nbsp;<span class="keyword" id="3413258">range</span>&nbsp;<span class="ident" id="3413264"><a href="/text/template/parse/parse.go.html#3413163">t</a></span><span class="op" id="3413265">.</span><span class="ident" id="3413266">vars</span>&nbsp;<span class="op" id="3413271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413275">if</span>&nbsp;<span class="ident" id="3413278"><a href="/text/template/parse/parse.go.html#3413247">varName</a></span>&nbsp;<span class="op" id="3413286">==</span>&nbsp;<span class="ident" id="3413289"><a href="/text/template/parse/parse.go.html#3413209">v</a></span><span class="op" id="3413290">.</span><span class="ident" id="3413291">Ident</span><span class="op" id="3413296">[</span><span class="num" id="3413297">0</span><span class="op" id="3413298">]</span>&nbsp;<span class="op" id="3413300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413305">return</span>&nbsp;<span class="ident" id="3413312"><a href="/text/template/parse/parse.go.html#3413209">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413319">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413322"><a href="/text/template/parse/parse.go.html#3413163">t</a></span><span class="op" id="3413323">.</span><span class="ident" id="3413324">errorf</span><span class="op" id="3413330">(</span><span class="string" id="3413331">&#34;undefined&nbsp;variable&nbsp;%q&#34;</span><span class="op" id="3413354">,</span>&nbsp;<span class="ident" id="3413356"><a href="/text/template/parse/parse.go.html#3413209">v</a></span><span class="op" id="3413357">.</span><span class="ident" id="3413358">Ident</span><span class="op" id="3413363">[</span><span class="num" id="3413364">0</span><span class="op" id="3413365">]</span><span class="op" id="3413366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413369">return</span>&nbsp;<span class="ident" id="3413376">nil</span><br>
<span class="lineno"></span><span class="op" id="3413380">}</span>
</div>
</body>
</html>
