<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/signal</h2>
<ul>
<li><a href="/gostd/os/signal/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/signal/signal.go.html" class="current">signal.go</a></li>
<li><a href="/gostd/os/signal/signal_test.go.html">signal_test.go</a></li>
<li><a href="/gostd/os/signal/signal_unix.go.html">signal_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3456380">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3456435">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3456489">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3456540">//&nbsp;Package&nbsp;signal&nbsp;implements&nbsp;access&nbsp;to&nbsp;incoming&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="3456597">package</span>&nbsp;<span class="ident" id="3456605">signal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3456613">//&nbsp;BUG(rsc):&nbsp;This&nbsp;package&nbsp;is&nbsp;not&nbsp;yet&nbsp;implemented&nbsp;on&nbsp;Plan&nbsp;9.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3456674">import</span>&nbsp;<span class="op" id="3456681">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3456684">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3456690">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="3456697">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="3456700">var</span>&nbsp;<span class="ident" id="3456704">handlers</span>&nbsp;<span class="keyword" id="3456713">struct</span>&nbsp;<span class="op" id="3456720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3456723">sync</span><span class="op" id="3456727">.</span><span class="ident" id="3456728">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3456735">m</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456739">map</span><span class="op" id="3456742">[</span><span class="keyword" id="3456743">chan</span><span class="op" id="3456747">&lt;-</span>&nbsp;<span class="ident" id="3456750">os</span><span class="op" id="3456752">.</span><span class="ident" id="3456753">Signal</span><span class="op" id="3456759">]</span><span class="op" id="3456760">*</span><span class="ident" id="3456761">handler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3456770">ref</span>&nbsp;<span class="op" id="3456774">[</span><span class="ident" id="3456775">numSig</span><span class="op" id="3456781">]</span><span class="ident" id="3456782">int64</span><br>
<span class="lineno"></span><span class="op" id="3456788">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3456791">type</span>&nbsp;<span class="ident" id="3456796">handler</span>&nbsp;<span class="keyword" id="3456804">struct</span>&nbsp;<span class="op" id="3456811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3456814">mask</span>&nbsp;<span class="op" id="3456819">[</span><span class="op" id="3456820">(</span><span class="ident" id="3456821">numSig</span>&nbsp;<span class="op" id="3456828">+</span>&nbsp;<span class="num" id="3456830">31</span><span class="op" id="3456832">)</span>&nbsp;<span class="op" id="3456834">/</span>&nbsp;<span class="num" id="3456836">32</span><span class="op" id="3456838">]</span><span class="builtintype" id="3456839">uint32</span><br>
<span class="lineno"></span><span class="op" id="3456846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="3456849">func</span>&nbsp;<span class="op" id="3456854">(</span><span class="ident" id="3456855">h</span>&nbsp;<span class="op" id="3456857">*</span><span class="ident" id="3456858">handler</span><span class="op" id="3456865">)</span>&nbsp;<span class="ident" id="3456867">want</span><span class="op" id="3456871">(</span><span class="ident" id="3456872">sig</span>&nbsp;<span class="builtintype" id="3456876">int</span><span class="op" id="3456879">)</span>&nbsp;<span class="builtintype" id="3456881">bool</span>&nbsp;<span class="op" id="3456886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3456889">return</span>&nbsp;<span class="op" id="3456896">(</span><span class="ident" id="3456897">h</span><span class="op" id="3456898">.</span><span class="ident" id="3456899">mask</span><span class="op" id="3456903">[</span><span class="ident" id="3456904">sig</span><span class="op" id="3456907">/</span><span class="num" id="3456908">32</span><span class="op" id="3456910">]</span><span class="op" id="3456911">&gt;&gt;</span><span class="builtintype" id="3456913">uint</span><span class="op" id="3456917">(</span><span class="ident" id="3456918">sig</span><span class="op" id="3456921">&amp;</span><span class="num" id="3456922">31</span><span class="op" id="3456924">)</span><span class="op" id="3456925">)</span><span class="op" id="3456926">&amp;</span><span class="num" id="3456927">1</span>&nbsp;<span class="op" id="3456929">!=</span>&nbsp;<span class="num" id="3456932">0</span><br>
<span class="lineno"></span><span class="op" id="3456934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3456937">func</span>&nbsp;<span class="op" id="3456942">(</span><span class="ident" id="3456943">h</span>&nbsp;<span class="op" id="3456945">*</span><span class="ident" id="3456946">handler</span><span class="op" id="3456953">)</span>&nbsp;<span class="ident" id="3456955">set</span><span class="op" id="3456958">(</span><span class="ident" id="3456959">sig</span>&nbsp;<span class="builtintype" id="3456963">int</span><span class="op" id="3456966">)</span>&nbsp;<span class="op" id="3456968">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3456971">h</span><span class="op" id="3456972">.</span><span class="ident" id="3456973">mask</span><span class="op" id="3456977">[</span><span class="ident" id="3456978">sig</span><span class="op" id="3456981">/</span><span class="num" id="3456982">32</span><span class="op" id="3456984">]</span>&nbsp;<span class="op" id="3456986">|=</span>&nbsp;<span class="num" id="3456989">1</span>&nbsp;<span class="op" id="3456991">&lt;&lt;</span>&nbsp;<span class="builtintype" id="3456994">uint</span><span class="op" id="3456998">(</span><span class="ident" id="3456999">sig</span><span class="op" id="3457002">&amp;</span><span class="num" id="3457003">31</span><span class="op" id="3457005">)</span><br>
<span class="lineno"></span><span class="op" id="3457007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3457010">//&nbsp;Notify&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;relay&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="3457074">//&nbsp;If&nbsp;no&nbsp;signals&nbsp;are&nbsp;listed,&nbsp;all&nbsp;incoming&nbsp;signals&nbsp;will&nbsp;be&nbsp;relayed&nbsp;to&nbsp;c.</span><br>
<span class="lineno">35</span><span class="comment" id="3457146">//&nbsp;Otherwise,&nbsp;just&nbsp;the&nbsp;listed&nbsp;signals&nbsp;will.</span><br>
<span class="lineno"></span><span class="comment" id="3457190">//</span><br>
<span class="lineno"></span><span class="comment" id="3457193">//&nbsp;Package&nbsp;signal&nbsp;will&nbsp;not&nbsp;block&nbsp;sending&nbsp;to&nbsp;c:&nbsp;the&nbsp;caller&nbsp;must&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="3457263">//&nbsp;that&nbsp;c&nbsp;has&nbsp;sufficient&nbsp;buffer&nbsp;space&nbsp;to&nbsp;keep&nbsp;up&nbsp;with&nbsp;the&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="3457330">//&nbsp;signal&nbsp;rate.&nbsp;&nbsp;For&nbsp;a&nbsp;channel&nbsp;used&nbsp;for&nbsp;notification&nbsp;of&nbsp;just&nbsp;one&nbsp;signal&nbsp;value,</span><br>
<span class="lineno">40</span><span class="comment" id="3457409">//&nbsp;a&nbsp;buffer&nbsp;of&nbsp;size&nbsp;1&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="comment" id="3457446">//</span><br>
<span class="lineno"></span><span class="comment" id="3457449">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;the&nbsp;same&nbsp;channel:</span><br>
<span class="lineno"></span><span class="comment" id="3457519">//&nbsp;each&nbsp;call&nbsp;expands&nbsp;the&nbsp;set&nbsp;of&nbsp;signals&nbsp;sent&nbsp;to&nbsp;that&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="3457581">//&nbsp;The&nbsp;only&nbsp;way&nbsp;to&nbsp;remove&nbsp;signals&nbsp;from&nbsp;the&nbsp;set&nbsp;is&nbsp;to&nbsp;call&nbsp;Stop.</span><br>
<span class="lineno">45</span><span class="comment" id="3457645">//</span><br>
<span class="lineno"></span><span class="comment" id="3457648">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;different&nbsp;channels</span><br>
<span class="lineno"></span><span class="comment" id="3457719">//&nbsp;and&nbsp;the&nbsp;same&nbsp;signals:&nbsp;each&nbsp;channel&nbsp;receives&nbsp;copies&nbsp;of&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="3457785">//&nbsp;signals&nbsp;independently.</span><br>
<span class="lineno"></span><span class="keyword" id="3457811">func</span>&nbsp;<span class="ident" id="3457816">Notify</span><span class="op" id="3457822">(</span><span class="ident" id="3457823">c</span>&nbsp;<span class="keyword" id="3457825">chan</span><span class="op" id="3457829">&lt;-</span>&nbsp;<span class="ident" id="3457832">os</span><span class="op" id="3457834">.</span><span class="ident" id="3457835">Signal</span><span class="op" id="3457841">,</span>&nbsp;<span class="ident" id="3457843">sig</span>&nbsp;<span class="op" id="3457847">...</span><span class="ident" id="3457850">os</span><span class="op" id="3457852">.</span><span class="ident" id="3457853">Signal</span><span class="op" id="3457859">)</span>&nbsp;<span class="op" id="3457861">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3457864">if</span>&nbsp;<span class="ident" id="3457867">c</span>&nbsp;<span class="op" id="3457869">==</span>&nbsp;<span class="ident" id="3457872">nil</span>&nbsp;<span class="op" id="3457876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3457880">panic</span><span class="op" id="3457885">(</span><span class="string" id="3457886">&#34;os/signal:&nbsp;Notify&nbsp;using&nbsp;nil&nbsp;channel&#34;</span><span class="op" id="3457923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3457926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3457930">handlers</span><span class="op" id="3457938">.</span><span class="ident" id="3457939">Lock</span><span class="op" id="3457943">(</span><span class="op" id="3457944">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3457947">defer</span>&nbsp;<span class="ident" id="3457953">handlers</span><span class="op" id="3457961">.</span><span class="ident" id="3457962">Unlock</span><span class="op" id="3457968">(</span><span class="op" id="3457969">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3457973">h</span>&nbsp;<span class="op" id="3457975">:=</span>&nbsp;<span class="ident" id="3457978">handlers</span><span class="op" id="3457986">.</span><span class="ident" id="3457987">m</span><span class="op" id="3457988">[</span><span class="ident" id="3457989">c</span><span class="op" id="3457990">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3457993">if</span>&nbsp;<span class="ident" id="3457996">h</span>&nbsp;<span class="op" id="3457998">==</span>&nbsp;<span class="ident" id="3458001">nil</span>&nbsp;<span class="op" id="3458005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458009">if</span>&nbsp;<span class="ident" id="3458012">handlers</span><span class="op" id="3458020">.</span><span class="ident" id="3458021">m</span>&nbsp;<span class="op" id="3458023">==</span>&nbsp;<span class="ident" id="3458026">nil</span>&nbsp;<span class="op" id="3458030">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458035">handlers</span><span class="op" id="3458043">.</span><span class="ident" id="3458044">m</span>&nbsp;<span class="op" id="3458046">=</span>&nbsp;<span class="builtinfunc" id="3458048">make</span><span class="op" id="3458052">(</span><span class="keyword" id="3458053">map</span><span class="op" id="3458056">[</span><span class="keyword" id="3458057">chan</span><span class="op" id="3458061">&lt;-</span>&nbsp;<span class="ident" id="3458064">os</span><span class="op" id="3458066">.</span><span class="ident" id="3458067">Signal</span><span class="op" id="3458073">]</span><span class="op" id="3458074">*</span><span class="ident" id="3458075">handler</span><span class="op" id="3458082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458090">h</span>&nbsp;<span class="op" id="3458092">=</span>&nbsp;<span class="builtinfunc" id="3458094">new</span><span class="op" id="3458097">(</span><span class="ident" id="3458098">handler</span><span class="op" id="3458105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458109">handlers</span><span class="op" id="3458117">.</span><span class="ident" id="3458118">m</span><span class="op" id="3458119">[</span><span class="ident" id="3458120">c</span><span class="op" id="3458121">]</span>&nbsp;<span class="op" id="3458123">=</span>&nbsp;<span class="ident" id="3458125">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458128">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458132">add</span>&nbsp;<span class="op" id="3458136">:=</span>&nbsp;<span class="keyword" id="3458139">func</span><span class="op" id="3458143">(</span><span class="ident" id="3458144">n</span>&nbsp;<span class="builtintype" id="3458146">int</span><span class="op" id="3458149">)</span>&nbsp;<span class="op" id="3458151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458155">if</span>&nbsp;<span class="ident" id="3458158">n</span>&nbsp;<span class="op" id="3458160">&lt;</span>&nbsp;<span class="num" id="3458162">0</span>&nbsp;<span class="op" id="3458164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458169">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458178">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458182">if</span>&nbsp;<span class="op" id="3458185">!</span><span class="ident" id="3458186">h</span><span class="op" id="3458187">.</span><span class="ident" id="3458188">want</span><span class="op" id="3458192">(</span><span class="ident" id="3458193">n</span><span class="op" id="3458194">)</span>&nbsp;<span class="op" id="3458196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458201">h</span><span class="op" id="3458202">.</span><span class="ident" id="3458203">set</span><span class="op" id="3458206">(</span><span class="ident" id="3458207">n</span><span class="op" id="3458208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458213">if</span>&nbsp;<span class="ident" id="3458216">handlers</span><span class="op" id="3458224">.</span><span class="ident" id="3458225">ref</span><span class="op" id="3458228">[</span><span class="ident" id="3458229">n</span><span class="op" id="3458230">]</span>&nbsp;<span class="op" id="3458232">==</span>&nbsp;<span class="num" id="3458235">0</span>&nbsp;<span class="op" id="3458237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458243">enableSignal</span><span class="op" id="3458255">(</span><span class="ident" id="3458256">n</span><span class="op" id="3458257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458262">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458267">handlers</span><span class="op" id="3458275">.</span><span class="ident" id="3458276">ref</span><span class="op" id="3458279">[</span><span class="ident" id="3458280">n</span><span class="op" id="3458281">]</span><span class="op" id="3458282">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458294">if</span>&nbsp;<span class="builtinfunc" id="3458297">len</span><span class="op" id="3458300">(</span><span class="ident" id="3458301">sig</span><span class="op" id="3458304">)</span>&nbsp;<span class="op" id="3458306">==</span>&nbsp;<span class="num" id="3458309">0</span>&nbsp;<span class="op" id="3458311">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458315">for</span>&nbsp;<span class="ident" id="3458319">n</span>&nbsp;<span class="op" id="3458321">:=</span>&nbsp;<span class="num" id="3458324">0</span><span class="op" id="3458325">;</span>&nbsp;<span class="ident" id="3458327">n</span>&nbsp;<span class="op" id="3458329">&lt;</span>&nbsp;<span class="ident" id="3458331">numSig</span><span class="op" id="3458337">;</span>&nbsp;<span class="ident" id="3458339">n</span><span class="op" id="3458340">++</span>&nbsp;<span class="op" id="3458343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458348">add</span><span class="op" id="3458351">(</span><span class="ident" id="3458352">n</span><span class="op" id="3458353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458360">}</span>&nbsp;<span class="keyword" id="3458362">else</span>&nbsp;<span class="op" id="3458367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458371">for</span>&nbsp;<span class="ident" id="3458375">_</span><span class="op" id="3458376">,</span>&nbsp;<span class="ident" id="3458378">s</span>&nbsp;<span class="op" id="3458380">:=</span>&nbsp;<span class="keyword" id="3458383">range</span>&nbsp;<span class="ident" id="3458389">sig</span>&nbsp;<span class="op" id="3458393">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458398">add</span><span class="op" id="3458401">(</span><span class="ident" id="3458402">signum</span><span class="op" id="3458408">(</span><span class="ident" id="3458409">s</span><span class="op" id="3458410">)</span><span class="op" id="3458411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458418">}</span><br>
<span class="lineno"></span><span class="op" id="3458420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="3458423">//&nbsp;Stop&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;stop&nbsp;relaying&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="3458493">//&nbsp;It&nbsp;undoes&nbsp;the&nbsp;effect&nbsp;of&nbsp;all&nbsp;prior&nbsp;calls&nbsp;to&nbsp;Notify&nbsp;using&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="3458555">//&nbsp;When&nbsp;Stop&nbsp;returns,&nbsp;it&nbsp;is&nbsp;guaranteed&nbsp;that&nbsp;c&nbsp;will&nbsp;receive&nbsp;no&nbsp;more&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="3458631">func</span>&nbsp;<span class="ident" id="3458636">Stop</span><span class="op" id="3458640">(</span><span class="ident" id="3458641">c</span>&nbsp;<span class="keyword" id="3458643">chan</span><span class="op" id="3458647">&lt;-</span>&nbsp;<span class="ident" id="3458650">os</span><span class="op" id="3458652">.</span><span class="ident" id="3458653">Signal</span><span class="op" id="3458659">)</span>&nbsp;<span class="op" id="3458661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458664">handlers</span><span class="op" id="3458672">.</span><span class="ident" id="3458673">Lock</span><span class="op" id="3458677">(</span><span class="op" id="3458678">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458681">defer</span>&nbsp;<span class="ident" id="3458687">handlers</span><span class="op" id="3458695">.</span><span class="ident" id="3458696">Unlock</span><span class="op" id="3458702">(</span><span class="op" id="3458703">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458707">h</span>&nbsp;<span class="op" id="3458709">:=</span>&nbsp;<span class="ident" id="3458712">handlers</span><span class="op" id="3458720">.</span><span class="ident" id="3458721">m</span><span class="op" id="3458722">[</span><span class="ident" id="3458723">c</span><span class="op" id="3458724">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458727">if</span>&nbsp;<span class="ident" id="3458730">h</span>&nbsp;<span class="op" id="3458732">==</span>&nbsp;<span class="ident" id="3458735">nil</span>&nbsp;<span class="op" id="3458739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458743">return</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3458754">delete</span><span class="op" id="3458760">(</span><span class="ident" id="3458761">handlers</span><span class="op" id="3458769">.</span><span class="ident" id="3458770">m</span><span class="op" id="3458771">,</span>&nbsp;<span class="ident" id="3458773">c</span><span class="op" id="3458774">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458778">for</span>&nbsp;<span class="ident" id="3458782">n</span>&nbsp;<span class="op" id="3458784">:=</span>&nbsp;<span class="num" id="3458787">0</span><span class="op" id="3458788">;</span>&nbsp;<span class="ident" id="3458790">n</span>&nbsp;<span class="op" id="3458792">&lt;</span>&nbsp;<span class="ident" id="3458794">numSig</span><span class="op" id="3458800">;</span>&nbsp;<span class="ident" id="3458802">n</span><span class="op" id="3458803">++</span>&nbsp;<span class="op" id="3458806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458810">if</span>&nbsp;<span class="ident" id="3458813">h</span><span class="op" id="3458814">.</span><span class="ident" id="3458815">want</span><span class="op" id="3458819">(</span><span class="ident" id="3458820">n</span><span class="op" id="3458821">)</span>&nbsp;<span class="op" id="3458823">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458828">handlers</span><span class="op" id="3458836">.</span><span class="ident" id="3458837">ref</span><span class="op" id="3458840">[</span><span class="ident" id="3458841">n</span><span class="op" id="3458842">]</span><span class="op" id="3458843">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458849">if</span>&nbsp;<span class="ident" id="3458852">handlers</span><span class="op" id="3458860">.</span><span class="ident" id="3458861">ref</span><span class="op" id="3458864">[</span><span class="ident" id="3458865">n</span><span class="op" id="3458866">]</span>&nbsp;<span class="op" id="3458868">==</span>&nbsp;<span class="num" id="3458871">0</span>&nbsp;<span class="op" id="3458873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458879">disableSignal</span><span class="op" id="3458892">(</span><span class="ident" id="3458893">n</span><span class="op" id="3458894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458903">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458906">}</span><br>
<span class="lineno"></span><span class="op" id="3458908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3458911">func</span>&nbsp;<span class="ident" id="3458916">process</span><span class="op" id="3458923">(</span><span class="ident" id="3458924">sig</span>&nbsp;<span class="ident" id="3458928">os</span><span class="op" id="3458930">.</span><span class="ident" id="3458931">Signal</span><span class="op" id="3458937">)</span>&nbsp;<span class="op" id="3458939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458942">n</span>&nbsp;<span class="op" id="3458944">:=</span>&nbsp;<span class="ident" id="3458947">signum</span><span class="op" id="3458953">(</span><span class="ident" id="3458954">sig</span><span class="op" id="3458957">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458960">if</span>&nbsp;<span class="ident" id="3458963">n</span>&nbsp;<span class="op" id="3458965">&lt;</span>&nbsp;<span class="num" id="3458967">0</span>&nbsp;<span class="op" id="3458969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458973">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458985">handlers</span><span class="op" id="3458993">.</span><span class="ident" id="3458994">Lock</span><span class="op" id="3458998">(</span><span class="op" id="3458999">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3459002">defer</span>&nbsp;<span class="ident" id="3459008">handlers</span><span class="op" id="3459016">.</span><span class="ident" id="3459017">Unlock</span><span class="op" id="3459023">(</span><span class="op" id="3459024">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3459028">for</span>&nbsp;<span class="ident" id="3459032">c</span><span class="op" id="3459033">,</span>&nbsp;<span class="ident" id="3459035">h</span>&nbsp;<span class="op" id="3459037">:=</span>&nbsp;<span class="keyword" id="3459040">range</span>&nbsp;<span class="ident" id="3459046">handlers</span><span class="op" id="3459054">.</span><span class="ident" id="3459055">m</span>&nbsp;<span class="op" id="3459057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3459061">if</span>&nbsp;<span class="ident" id="3459064">h</span><span class="op" id="3459065">.</span><span class="ident" id="3459066">want</span><span class="op" id="3459070">(</span><span class="ident" id="3459071">n</span><span class="op" id="3459072">)</span>&nbsp;<span class="op" id="3459074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3459079">//&nbsp;send&nbsp;but&nbsp;do&nbsp;not&nbsp;block&nbsp;for&nbsp;it</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3459114">select</span>&nbsp;<span class="op" id="3459121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3459126">case</span>&nbsp;<span class="ident" id="3459131">c</span>&nbsp;<span class="op" id="3459133">&lt;-</span>&nbsp;<span class="ident" id="3459136">sig</span><span class="op" id="3459139">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3459144">default</span><span class="op" id="3459151">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3459156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3459160">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3459163">}</span><br>
<span class="lineno"></span><span class="op" id="3459165">}</span>
</div>
</body>
</html>
