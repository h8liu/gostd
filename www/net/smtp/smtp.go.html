<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6340080">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6340135">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6340189">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6340240">//&nbsp;Package&nbsp;smtp&nbsp;implements&nbsp;the&nbsp;Simple&nbsp;Mail&nbsp;Transfer&nbsp;Protocol&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5321.</span><br>
<span class="lineno"></span><span class="comment" id="6340325">//&nbsp;It&nbsp;also&nbsp;implements&nbsp;the&nbsp;following&nbsp;extensions:</span><br>
<span class="lineno"></span><span class="comment" id="6340373">//&nbsp;&nbsp;&nbsp;&nbsp8BITMIME&nbsp;&nbsp;RFC&nbsp;1652</span><br>
<span class="lineno"></span><span class="comment" id="6340395">//&nbsp;&nbsp;&nbsp;&nbspAUTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RFC&nbsp;2554</span><br>
<span class="lineno"></span><span class="comment" id="6340417">//&nbsp;&nbsp;&nbsp;&nbspSTARTTLS&nbsp;&nbsp;RFC&nbsp;3207</span><br>
<span class="lineno">10</span><span class="comment" id="6340439">//&nbsp;Additional&nbsp;extensions&nbsp;may&nbsp;be&nbsp;handled&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="6340491">package</span>&nbsp;<span class="ident" id="6340499">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6340505">import</span>&nbsp;<span class="op" id="6340512">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6340515">&#34;crypto/tls&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6340529">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6340548">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6340558">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6340564">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6340571">&#34;net/textproto&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6340588">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="6340598">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6340601">//&nbsp;A&nbsp;Client&nbsp;represents&nbsp;a&nbsp;client&nbsp;connection&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6340663">type</span>&nbsp;<span class="ident" id="6340668">Client</span>&nbsp;<span class="keyword" id="6340675">struct</span>&nbsp;<span class="op" id="6340682">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6340685">//&nbsp;Text&nbsp;is&nbsp;the&nbsp;textproto.Conn&nbsp;used&nbsp;by&nbsp;the&nbsp;Client.&nbsp;It&nbsp;is&nbsp;exported&nbsp;to&nbsp;allow&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6340764">//&nbsp;clients&nbsp;to&nbsp;add&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340795">Text</span>&nbsp;<span class="op" id="6340800">*</span><span class="ident" id="6340801">textproto</span><span class="op" id="6340810">.</span><span class="ident" id="6340811">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6340817">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;connection&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;a&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6340890">//&nbsp;connection&nbsp;later</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340911">conn</span>&nbsp;<span class="ident" id="6340916">net</span><span class="op" id="6340919">.</span><span class="ident" id="6340920">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6340926">//&nbsp;whether&nbsp;the&nbsp;Client&nbsp;is&nbsp;using&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340962">tls</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6340973">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340979">serverName</span>&nbsp;<span class="builtintype" id="6340990">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6340998">//&nbsp;map&nbsp;of&nbsp;supported&nbsp;extensions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341030">ext</span>&nbsp;<span class="keyword" id="6341034">map</span><span class="op" id="6341037">[</span><span class="builtintype" id="6341038">string</span><span class="op" id="6341044">]</span><span class="builtintype" id="6341045">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6341053">//&nbsp;supported&nbsp;auth&nbsp;mechanisms</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341083">auth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6341094">[</span><span class="op" id="6341095">]</span><span class="builtintype" id="6341096">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341104">localName</span>&nbsp;&nbsp;<span class="builtintype" id="6341115">string</span>&nbsp;<span class="comment" id="6341122">//&nbsp;the&nbsp;name&nbsp;to&nbsp;use&nbsp;in&nbsp;HELO/EHLO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341155">didHello</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6341166">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6341173">//&nbsp;whether&nbsp;we&#39;ve&nbsp;said&nbsp;HELO/EHLO</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341206">helloError</span>&nbsp;<span class="builtintype" id="6341217">error</span>&nbsp;&nbsp;<span class="comment" id="6341224">//&nbsp;the&nbsp;error&nbsp;from&nbsp;the&nbsp;hello</span><br>
<span class="lineno"></span><span class="op" id="6341252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6341255">//&nbsp;Dial&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;connected&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server&nbsp;at&nbsp;addr.</span><br>
<span class="lineno"></span><span class="comment" id="6341321">//&nbsp;The&nbsp;addr&nbsp;must&nbsp;include&nbsp;a&nbsp;port&nbsp;number.</span><br>
<span class="lineno">45</span><span class="keyword" id="6341361">func</span>&nbsp;<span class="ident" id="6341366">Dial</span><span class="op" id="6341370">(</span><span class="ident" id="6341371">addr</span>&nbsp;<span class="builtintype" id="6341376">string</span><span class="op" id="6341382">)</span>&nbsp;<span class="op" id="6341384">(</span><span class="op" id="6341385">*</span><span class="ident" id="6341386">Client</span><span class="op" id="6341392">,</span>&nbsp;<span class="builtintype" id="6341394">error</span><span class="op" id="6341399">)</span>&nbsp;<span class="op" id="6341401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341404">conn</span><span class="op" id="6341408">,</span>&nbsp;<span class="ident" id="6341410">err</span>&nbsp;<span class="op" id="6341414">:=</span>&nbsp;<span class="ident" id="6341417">net</span><span class="op" id="6341420">.</span><span class="ident" id="6341421">Dial</span><span class="op" id="6341425">(</span><span class="string" id="6341426">&#34;tcp&#34;</span><span class="op" id="6341431">,</span>&nbsp;<span class="ident" id="6341433">addr</span><span class="op" id="6341437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341440">if</span>&nbsp;<span class="ident" id="6341443">err</span>&nbsp;<span class="op" id="6341447">!=</span>&nbsp;<span class="ident" id="6341450">nil</span>&nbsp;<span class="op" id="6341454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341458">return</span>&nbsp;<span class="ident" id="6341465">nil</span><span class="op" id="6341468">,</span>&nbsp;<span class="ident" id="6341470">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6341475">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341478">host</span><span class="op" id="6341482">,</span>&nbsp;<span class="ident" id="6341484">_</span><span class="op" id="6341485">,</span>&nbsp;<span class="ident" id="6341487">_</span>&nbsp;<span class="op" id="6341489">:=</span>&nbsp;<span class="ident" id="6341492">net</span><span class="op" id="6341495">.</span><span class="ident" id="6341496">SplitHostPort</span><span class="op" id="6341509">(</span><span class="ident" id="6341510">addr</span><span class="op" id="6341514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341517">return</span>&nbsp;<span class="ident" id="6341524">NewClient</span><span class="op" id="6341533">(</span><span class="ident" id="6341534">conn</span><span class="op" id="6341538">,</span>&nbsp;<span class="ident" id="6341540">host</span><span class="op" id="6341544">)</span><br>
<span class="lineno"></span><span class="op" id="6341546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6341549">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;using&nbsp;an&nbsp;existing&nbsp;connection&nbsp;and&nbsp;host&nbsp;as&nbsp;a</span><br>
<span class="lineno">55</span><span class="comment" id="6341626">//&nbsp;server&nbsp;name&nbsp;to&nbsp;be&nbsp;used&nbsp;when&nbsp;authenticating.</span><br>
<span class="lineno"></span><span class="keyword" id="6341673">func</span>&nbsp;<span class="ident" id="6341678">NewClient</span><span class="op" id="6341687">(</span><span class="ident" id="6341688">conn</span>&nbsp;<span class="ident" id="6341693">net</span><span class="op" id="6341696">.</span><span class="ident" id="6341697">Conn</span><span class="op" id="6341701">,</span>&nbsp;<span class="ident" id="6341703">host</span>&nbsp;<span class="builtintype" id="6341708">string</span><span class="op" id="6341714">)</span>&nbsp;<span class="op" id="6341716">(</span><span class="op" id="6341717">*</span><span class="ident" id="6341718">Client</span><span class="op" id="6341724">,</span>&nbsp;<span class="builtintype" id="6341726">error</span><span class="op" id="6341731">)</span>&nbsp;<span class="op" id="6341733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341736">text</span>&nbsp;<span class="op" id="6341741">:=</span>&nbsp;<span class="ident" id="6341744">textproto</span><span class="op" id="6341753">.</span><span class="ident" id="6341754">NewConn</span><span class="op" id="6341761">(</span><span class="ident" id="6341762">conn</span><span class="op" id="6341766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341769">_</span><span class="op" id="6341770">,</span>&nbsp;<span class="ident" id="6341772">_</span><span class="op" id="6341773">,</span>&nbsp;<span class="ident" id="6341775">err</span>&nbsp;<span class="op" id="6341779">:=</span>&nbsp;<span class="ident" id="6341782">text</span><span class="op" id="6341786">.</span><span class="ident" id="6341787">ReadResponse</span><span class="op" id="6341799">(</span><span class="num" id="6341800">220</span><span class="op" id="6341803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341806">if</span>&nbsp;<span class="ident" id="6341809">err</span>&nbsp;<span class="op" id="6341813">!=</span>&nbsp;<span class="ident" id="6341816">nil</span>&nbsp;<span class="op" id="6341820">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341824">text</span><span class="op" id="6341828">.</span><span class="ident" id="6341829">Close</span><span class="op" id="6341834">(</span><span class="op" id="6341835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341839">return</span>&nbsp;<span class="ident" id="6341846">nil</span><span class="op" id="6341849">,</span>&nbsp;<span class="ident" id="6341851">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6341856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341859">c</span>&nbsp;<span class="op" id="6341861">:=</span>&nbsp;<span class="op" id="6341864">&amp;</span><span class="ident" id="6341865">Client</span><span class="op" id="6341871">{</span><span class="ident" id="6341872">Text</span><span class="op" id="6341876">:</span>&nbsp;<span class="ident" id="6341878">text</span><span class="op" id="6341882">,</span>&nbsp;<span class="ident" id="6341884">conn</span><span class="op" id="6341888">:</span>&nbsp;<span class="ident" id="6341890">conn</span><span class="op" id="6341894">,</span>&nbsp;<span class="ident" id="6341896">serverName</span><span class="op" id="6341906">:</span>&nbsp;<span class="ident" id="6341908">host</span><span class="op" id="6341912">,</span>&nbsp;<span class="ident" id="6341914">localName</span><span class="op" id="6341923">:</span>&nbsp;<span class="string" id="6341925">&#34;localhost&#34;</span><span class="op" id="6341936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341939">return</span>&nbsp;<span class="ident" id="6341946">c</span><span class="op" id="6341947">,</span>&nbsp;<span class="ident" id="6341949">nil</span><br>
<span class="lineno">65</span><span class="op" id="6341953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6341956">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6341988">func</span>&nbsp;<span class="op" id="6341993">(</span><span class="ident" id="6341994">c</span>&nbsp;<span class="op" id="6341996">*</span><span class="ident" id="6341997">Client</span><span class="op" id="6342003">)</span>&nbsp;<span class="ident" id="6342005">Close</span><span class="op" id="6342010">(</span><span class="op" id="6342011">)</span>&nbsp;<span class="builtintype" id="6342013">error</span>&nbsp;<span class="op" id="6342019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6342022">return</span>&nbsp;<span class="ident" id="6342029">c</span><span class="op" id="6342030">.</span><span class="ident" id="6342031">Text</span><span class="op" id="6342035">.</span><span class="ident" id="6342036">Close</span><span class="op" id="6342041">(</span><span class="op" id="6342042">)</span><br>
<span class="lineno">70</span><span class="op" id="6342044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6342047">//&nbsp;hello&nbsp;runs&nbsp;a&nbsp;hello&nbsp;exchange&nbsp;if&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="6342089">func</span>&nbsp;<span class="op" id="6342094">(</span><span class="ident" id="6342095">c</span>&nbsp;<span class="op" id="6342097">*</span><span class="ident" id="6342098">Client</span><span class="op" id="6342104">)</span>&nbsp;<span class="ident" id="6342106">hello</span><span class="op" id="6342111">(</span><span class="op" id="6342112">)</span>&nbsp;<span class="builtintype" id="6342114">error</span>&nbsp;<span class="op" id="6342120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6342123">if</span>&nbsp;<span class="op" id="6342126">!</span><span class="ident" id="6342127">c</span><span class="op" id="6342128">.</span><span class="ident" id="6342129">didHello</span>&nbsp;<span class="op" id="6342138">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6342142">c</span><span class="op" id="6342143">.</span><span class="ident" id="6342144">didHello</span>&nbsp;<span class="op" id="6342153">=</span>&nbsp;<span class="ident" id="6342155">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6342162">err</span>&nbsp;<span class="op" id="6342166">:=</span>&nbsp;<span class="ident" id="6342169">c</span><span class="op" id="6342170">.</span><span class="ident" id="6342171">ehlo</span><span class="op" id="6342175">(</span><span class="op" id="6342176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6342180">if</span>&nbsp;<span class="ident" id="6342183">err</span>&nbsp;<span class="op" id="6342187">!=</span>&nbsp;<span class="ident" id="6342190">nil</span>&nbsp;<span class="op" id="6342194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6342199">c</span><span class="op" id="6342200">.</span><span class="ident" id="6342201">helloError</span>&nbsp;<span class="op" id="6342212">=</span>&nbsp;<span class="ident" id="6342214">c</span><span class="op" id="6342215">.</span><span class="ident" id="6342216">helo</span><span class="op" id="6342220">(</span><span class="op" id="6342221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6342225">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6342228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6342231">return</span>&nbsp;<span class="ident" id="6342238">c</span><span class="op" id="6342239">.</span><span class="ident" id="6342240">helloError</span><br>
<span class="lineno"></span><span class="op" id="6342251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6342254">//&nbsp;Hello&nbsp;sends&nbsp;a&nbsp;HELO&nbsp;or&nbsp;EHLO&nbsp;to&nbsp;the&nbsp;server&nbsp;as&nbsp;the&nbsp;given&nbsp;host&nbsp;name.</span><br>
<span class="lineno">85</span><span class="comment" id="6342322">//&nbsp;Calling&nbsp;this&nbsp;method&nbsp;is&nbsp;only&nbsp;necessary&nbsp;if&nbsp;the&nbsp;client&nbsp;needs&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="6342391">//&nbsp;over&nbsp;the&nbsp;host&nbsp;name&nbsp;used.&nbsp;&nbsp;The&nbsp;client&nbsp;will&nbsp;introduce&nbsp;itself&nbsp;as&nbsp;&#34;localhost&#34;</span><br>
<span class="lineno"></span><span class="comment" id="6342468">//&nbsp;automatically&nbsp;otherwise.&nbsp;&nbsp;If&nbsp;Hello&nbsp;is&nbsp;called,&nbsp;it&nbsp;must&nbsp;be&nbsp;called&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="6342542">//&nbsp;any&nbsp;of&nbsp;the&nbsp;other&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="6342571">func</span>&nbsp;<span class="op" id="6342576">(</span><span class="ident" id="6342577">c</span>&nbsp;<span class="op" id="6342579">*</span><span class="ident" id="6342580">Client</span><span class="op" id="6342586">)</span>&nbsp;<span class="ident" id="6342588">Hello</span><span class="op" id="6342593">(</span><span class="ident" id="6342594">localName</span>&nbsp;<span class="builtintype" id="6342604">string</span><span class="op" id="6342610">)</span>&nbsp;<span class="builtintype" id="6342612">error</span>&nbsp;<span class="op" id="6342618">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6342621">if</span>&nbsp;<span class="ident" id="6342624">c</span><span class="op" id="6342625">.</span><span class="ident" id="6342626">didHello</span>&nbsp;<span class="op" id="6342635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6342639">return</span>&nbsp;<span class="ident" id="6342646">errors</span><span class="op" id="6342652">.</span><span class="ident" id="6342653">New</span><span class="op" id="6342656">(</span><span class="string" id="6342657">&#34;smtp:&nbsp;Hello&nbsp;called&nbsp;after&nbsp;other&nbsp;methods&#34;</span><span class="op" id="6342697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6342700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6342703">c</span><span class="op" id="6342704">.</span><span class="ident" id="6342705">localName</span>&nbsp;<span class="op" id="6342715">=</span>&nbsp;<span class="ident" id="6342717">localName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6342728">return</span>&nbsp;<span class="ident" id="6342735">c</span><span class="op" id="6342736">.</span><span class="ident" id="6342737">hello</span><span class="op" id="6342742">(</span><span class="op" id="6342743">)</span><br>
<span class="lineno">95</span><span class="op" id="6342745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6342748">//&nbsp;cmd&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;that&nbsp;sends&nbsp;a&nbsp;command&nbsp;and&nbsp;returns&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span><span class="keyword" id="6342827">func</span>&nbsp;<span class="op" id="6342832">(</span><span class="ident" id="6342833">c</span>&nbsp;<span class="op" id="6342835">*</span><span class="ident" id="6342836">Client</span><span class="op" id="6342842">)</span>&nbsp;<span class="ident" id="6342844">cmd</span><span class="op" id="6342847">(</span><span class="ident" id="6342848">expectCode</span>&nbsp;<span class="builtintype" id="6342859">int</span><span class="op" id="6342862">,</span>&nbsp;<span class="ident" id="6342864">format</span>&nbsp;<span class="builtintype" id="6342871">string</span><span class="op" id="6342877">,</span>&nbsp;<span class="ident" id="6342879">args</span>&nbsp;<span class="op" id="6342884">...</span><span class="keyword" id="6342887">interface</span><span class="op" id="6342896">{</span><span class="op" id="6342897">}</span><span class="op" id="6342898">)</span>&nbsp;<span class="op" id="6342900">(</span><span class="builtintype" id="6342901">int</span><span class="op" id="6342904">,</span>&nbsp;<span class="builtintype" id="6342906">string</span><span class="op" id="6342912">,</span>&nbsp;<span class="builtintype" id="6342914">error</span><span class="op" id="6342919">)</span>&nbsp;<span class="op" id="6342921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6342924">id</span><span class="op" id="6342926">,</span>&nbsp;<span class="ident" id="6342928">err</span>&nbsp;<span class="op" id="6342932">:=</span>&nbsp;<span class="ident" id="6342935">c</span><span class="op" id="6342936">.</span><span class="ident" id="6342937">Text</span><span class="op" id="6342941">.</span><span class="ident" id="6342942">Cmd</span><span class="op" id="6342945">(</span><span class="ident" id="6342946">format</span><span class="op" id="6342952">,</span>&nbsp;<span class="ident" id="6342954">args</span><span class="op" id="6342958">...</span><span class="op" id="6342961">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6342964">if</span>&nbsp;<span class="ident" id="6342967">err</span>&nbsp;<span class="op" id="6342971">!=</span>&nbsp;<span class="ident" id="6342974">nil</span>&nbsp;<span class="op" id="6342978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6342982">return</span>&nbsp;<span class="num" id="6342989">0</span><span class="op" id="6342990">,</span>&nbsp;<span class="string" id="6342992">&#34;&#34;</span><span class="op" id="6342994">,</span>&nbsp;<span class="ident" id="6342996">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6343001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343004">c</span><span class="op" id="6343005">.</span><span class="ident" id="6343006">Text</span><span class="op" id="6343010">.</span><span class="ident" id="6343011">StartResponse</span><span class="op" id="6343024">(</span><span class="ident" id="6343025">id</span><span class="op" id="6343027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6343030">defer</span>&nbsp;<span class="ident" id="6343036">c</span><span class="op" id="6343037">.</span><span class="ident" id="6343038">Text</span><span class="op" id="6343042">.</span><span class="ident" id="6343043">EndResponse</span><span class="op" id="6343054">(</span><span class="ident" id="6343055">id</span><span class="op" id="6343057">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343060">code</span><span class="op" id="6343064">,</span>&nbsp;<span class="ident" id="6343066">msg</span><span class="op" id="6343069">,</span>&nbsp;<span class="ident" id="6343071">err</span>&nbsp;<span class="op" id="6343075">:=</span>&nbsp;<span class="ident" id="6343078">c</span><span class="op" id="6343079">.</span><span class="ident" id="6343080">Text</span><span class="op" id="6343084">.</span><span class="ident" id="6343085">ReadResponse</span><span class="op" id="6343097">(</span><span class="ident" id="6343098">expectCode</span><span class="op" id="6343108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6343111">return</span>&nbsp;<span class="ident" id="6343118">code</span><span class="op" id="6343122">,</span>&nbsp;<span class="ident" id="6343124">msg</span><span class="op" id="6343127">,</span>&nbsp;<span class="ident" id="6343129">err</span><br>
<span class="lineno"></span><span class="op" id="6343133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6343136">//&nbsp;helo&nbsp;sends&nbsp;the&nbsp;HELO&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;when&nbsp;the</span><br>
<span class="lineno">110</span><span class="comment" id="6343215">//&nbsp;server&nbsp;does&nbsp;not&nbsp;support&nbsp;ehlo.</span><br>
<span class="lineno"></span><span class="keyword" id="6343248">func</span>&nbsp;<span class="op" id="6343253">(</span><span class="ident" id="6343254">c</span>&nbsp;<span class="op" id="6343256">*</span><span class="ident" id="6343257">Client</span><span class="op" id="6343263">)</span>&nbsp;<span class="ident" id="6343265">helo</span><span class="op" id="6343269">(</span><span class="op" id="6343270">)</span>&nbsp;<span class="builtintype" id="6343272">error</span>&nbsp;<span class="op" id="6343278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343281">c</span><span class="op" id="6343282">.</span><span class="ident" id="6343283">ext</span>&nbsp;<span class="op" id="6343287">=</span>&nbsp;<span class="ident" id="6343289">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343294">_</span><span class="op" id="6343295">,</span>&nbsp;<span class="ident" id="6343297">_</span><span class="op" id="6343298">,</span>&nbsp;<span class="ident" id="6343300">err</span>&nbsp;<span class="op" id="6343304">:=</span>&nbsp;<span class="ident" id="6343307">c</span><span class="op" id="6343308">.</span><span class="ident" id="6343309">cmd</span><span class="op" id="6343312">(</span><span class="num" id="6343313">250</span><span class="op" id="6343316">,</span>&nbsp;<span class="string" id="6343318">&#34;HELO&nbsp;%s&#34;</span><span class="op" id="6343327">,</span>&nbsp;<span class="ident" id="6343329">c</span><span class="op" id="6343330">.</span><span class="ident" id="6343331">localName</span><span class="op" id="6343340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6343343">return</span>&nbsp;<span class="ident" id="6343350">err</span><br>
<span class="lineno">115</span><span class="op" id="6343354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6343357">//&nbsp;ehlo&nbsp;sends&nbsp;the&nbsp;EHLO&nbsp;(extended&nbsp;hello)&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="6343424">//&nbsp;should&nbsp;be&nbsp;the&nbsp;preferred&nbsp;greeting&nbsp;for&nbsp;servers&nbsp;that&nbsp;support&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="6343489">func</span>&nbsp;<span class="op" id="6343494">(</span><span class="ident" id="6343495">c</span>&nbsp;<span class="op" id="6343497">*</span><span class="ident" id="6343498">Client</span><span class="op" id="6343504">)</span>&nbsp;<span class="ident" id="6343506">ehlo</span><span class="op" id="6343510">(</span><span class="op" id="6343511">)</span>&nbsp;<span class="builtintype" id="6343513">error</span>&nbsp;<span class="op" id="6343519">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343522">_</span><span class="op" id="6343523">,</span>&nbsp;<span class="ident" id="6343525">msg</span><span class="op" id="6343528">,</span>&nbsp;<span class="ident" id="6343530">err</span>&nbsp;<span class="op" id="6343534">:=</span>&nbsp;<span class="ident" id="6343537">c</span><span class="op" id="6343538">.</span><span class="ident" id="6343539">cmd</span><span class="op" id="6343542">(</span><span class="num" id="6343543">250</span><span class="op" id="6343546">,</span>&nbsp;<span class="string" id="6343548">&#34;EHLO&nbsp;%s&#34;</span><span class="op" id="6343557">,</span>&nbsp;<span class="ident" id="6343559">c</span><span class="op" id="6343560">.</span><span class="ident" id="6343561">localName</span><span class="op" id="6343570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6343573">if</span>&nbsp;<span class="ident" id="6343576">err</span>&nbsp;<span class="op" id="6343580">!=</span>&nbsp;<span class="ident" id="6343583">nil</span>&nbsp;<span class="op" id="6343587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6343591">return</span>&nbsp;<span class="ident" id="6343598">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6343603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343606">ext</span>&nbsp;<span class="op" id="6343610">:=</span>&nbsp;<span class="builtinfunc" id="6343613">make</span><span class="op" id="6343617">(</span><span class="keyword" id="6343618">map</span><span class="op" id="6343621">[</span><span class="builtintype" id="6343622">string</span><span class="op" id="6343628">]</span><span class="builtintype" id="6343629">string</span><span class="op" id="6343635">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343638">extList</span>&nbsp;<span class="op" id="6343646">:=</span>&nbsp;<span class="ident" id="6343649">strings</span><span class="op" id="6343656">.</span><span class="ident" id="6343657">Split</span><span class="op" id="6343662">(</span><span class="ident" id="6343663">msg</span><span class="op" id="6343666">,</span>&nbsp;<span class="string" id="6343668">&#34;\n&#34;</span><span class="op" id="6343672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6343675">if</span>&nbsp;<span class="builtinfunc" id="6343678">len</span><span class="op" id="6343681">(</span><span class="ident" id="6343682">extList</span><span class="op" id="6343689">)</span>&nbsp;<span class="op" id="6343691">&gt;</span>&nbsp;<span class="num" id="6343693">1</span>&nbsp;<span class="op" id="6343695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343699">extList</span>&nbsp;<span class="op" id="6343707">=</span>&nbsp;<span class="ident" id="6343709">extList</span><span class="op" id="6343716">[</span><span class="num" id="6343717">1</span><span class="op" id="6343718">:</span><span class="op" id="6343719">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6343723">for</span>&nbsp;<span class="ident" id="6343727">_</span><span class="op" id="6343728">,</span>&nbsp;<span class="ident" id="6343730">line</span>&nbsp;<span class="op" id="6343735">:=</span>&nbsp;<span class="keyword" id="6343738">range</span>&nbsp;<span class="ident" id="6343744">extList</span>&nbsp;<span class="op" id="6343752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343757">args</span>&nbsp;<span class="op" id="6343762">:=</span>&nbsp;<span class="ident" id="6343765">strings</span><span class="op" id="6343772">.</span><span class="ident" id="6343773">SplitN</span><span class="op" id="6343779">(</span><span class="ident" id="6343780">line</span><span class="op" id="6343784">,</span>&nbsp;<span class="string" id="6343786">&#34;&nbsp;&#34;</span><span class="op" id="6343789">,</span>&nbsp;<span class="num" id="6343791">2</span><span class="op" id="6343792">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6343797">if</span>&nbsp;<span class="builtinfunc" id="6343800">len</span><span class="op" id="6343803">(</span><span class="ident" id="6343804">args</span><span class="op" id="6343808">)</span>&nbsp;<span class="op" id="6343810">&gt;</span>&nbsp;<span class="num" id="6343812">1</span>&nbsp;<span class="op" id="6343814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343820">ext</span><span class="op" id="6343823">[</span><span class="ident" id="6343824">args</span><span class="op" id="6343828">[</span><span class="num" id="6343829">0</span><span class="op" id="6343830">]</span><span class="op" id="6343831">]</span>&nbsp;<span class="op" id="6343833">=</span>&nbsp;<span class="ident" id="6343835">args</span><span class="op" id="6343839">[</span><span class="num" id="6343840">1</span><span class="op" id="6343841">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6343846">}</span>&nbsp;<span class="keyword" id="6343848">else</span>&nbsp;<span class="op" id="6343853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343859">ext</span><span class="op" id="6343862">[</span><span class="ident" id="6343863">args</span><span class="op" id="6343867">[</span><span class="num" id="6343868">0</span><span class="op" id="6343869">]</span><span class="op" id="6343870">]</span>&nbsp;<span class="op" id="6343872">=</span>&nbsp;<span class="string" id="6343874">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6343880">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6343884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6343887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6343890">if</span>&nbsp;<span class="ident" id="6343893">mechs</span><span class="op" id="6343898">,</span>&nbsp;<span class="ident" id="6343900">ok</span>&nbsp;<span class="op" id="6343903">:=</span>&nbsp;<span class="ident" id="6343906">ext</span><span class="op" id="6343909">[</span><span class="string" id="6343910">&#34;AUTH&#34;</span><span class="op" id="6343916">]</span><span class="op" id="6343917">;</span>&nbsp;<span class="ident" id="6343919">ok</span>&nbsp;<span class="op" id="6343922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343926">c</span><span class="op" id="6343927">.</span><span class="ident" id="6343928">auth</span>&nbsp;<span class="op" id="6343933">=</span>&nbsp;<span class="ident" id="6343935">strings</span><span class="op" id="6343942">.</span><span class="ident" id="6343943">Split</span><span class="op" id="6343948">(</span><span class="ident" id="6343949">mechs</span><span class="op" id="6343954">,</span>&nbsp;<span class="string" id="6343956">&#34;&nbsp;&#34;</span><span class="op" id="6343959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6343962">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343965">c</span><span class="op" id="6343966">.</span><span class="ident" id="6343967">ext</span>&nbsp;<span class="op" id="6343971">=</span>&nbsp;<span class="ident" id="6343973">ext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6343978">return</span>&nbsp;<span class="ident" id="6343985">err</span><br>
<span class="lineno"></span><span class="op" id="6343989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6343992">//&nbsp;StartTLS&nbsp;sends&nbsp;the&nbsp;STARTTLS&nbsp;command&nbsp;and&nbsp;encrypts&nbsp;all&nbsp;further&nbsp;communication.</span><br>
<span class="lineno">145</span><span class="comment" id="6344071">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;STARTTLS&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="6344148">func</span>&nbsp;<span class="op" id="6344153">(</span><span class="ident" id="6344154">c</span>&nbsp;<span class="op" id="6344156">*</span><span class="ident" id="6344157">Client</span><span class="op" id="6344163">)</span>&nbsp;<span class="ident" id="6344165">StartTLS</span><span class="op" id="6344173">(</span><span class="ident" id="6344174">config</span>&nbsp;<span class="op" id="6344181">*</span><span class="ident" id="6344182">tls</span><span class="op" id="6344185">.</span><span class="ident" id="6344186">Config</span><span class="op" id="6344192">)</span>&nbsp;<span class="builtintype" id="6344194">error</span>&nbsp;<span class="op" id="6344200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344203">if</span>&nbsp;<span class="ident" id="6344206">err</span>&nbsp;<span class="op" id="6344210">:=</span>&nbsp;<span class="ident" id="6344213">c</span><span class="op" id="6344214">.</span><span class="ident" id="6344215">hello</span><span class="op" id="6344220">(</span><span class="op" id="6344221">)</span><span class="op" id="6344222">;</span>&nbsp;<span class="ident" id="6344224">err</span>&nbsp;<span class="op" id="6344228">!=</span>&nbsp;<span class="ident" id="6344231">nil</span>&nbsp;<span class="op" id="6344235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344239">return</span>&nbsp;<span class="ident" id="6344246">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6344251">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6344254">_</span><span class="op" id="6344255">,</span>&nbsp;<span class="ident" id="6344257">_</span><span class="op" id="6344258">,</span>&nbsp;<span class="ident" id="6344260">err</span>&nbsp;<span class="op" id="6344264">:=</span>&nbsp;<span class="ident" id="6344267">c</span><span class="op" id="6344268">.</span><span class="ident" id="6344269">cmd</span><span class="op" id="6344272">(</span><span class="num" id="6344273">220</span><span class="op" id="6344276">,</span>&nbsp;<span class="string" id="6344278">&#34;STARTTLS&#34;</span><span class="op" id="6344288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344291">if</span>&nbsp;<span class="ident" id="6344294">err</span>&nbsp;<span class="op" id="6344298">!=</span>&nbsp;<span class="ident" id="6344301">nil</span>&nbsp;<span class="op" id="6344305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344309">return</span>&nbsp;<span class="ident" id="6344316">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6344321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6344324">c</span><span class="op" id="6344325">.</span><span class="ident" id="6344326">conn</span>&nbsp;<span class="op" id="6344331">=</span>&nbsp;<span class="ident" id="6344333">tls</span><span class="op" id="6344336">.</span><span class="ident" id="6344337">Client</span><span class="op" id="6344343">(</span><span class="ident" id="6344344">c</span><span class="op" id="6344345">.</span><span class="ident" id="6344346">conn</span><span class="op" id="6344350">,</span>&nbsp;<span class="ident" id="6344352">config</span><span class="op" id="6344358">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6344361">c</span><span class="op" id="6344362">.</span><span class="ident" id="6344363">Text</span>&nbsp;<span class="op" id="6344368">=</span>&nbsp;<span class="ident" id="6344370">textproto</span><span class="op" id="6344379">.</span><span class="ident" id="6344380">NewConn</span><span class="op" id="6344387">(</span><span class="ident" id="6344388">c</span><span class="op" id="6344389">.</span><span class="ident" id="6344390">conn</span><span class="op" id="6344394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6344397">c</span><span class="op" id="6344398">.</span><span class="ident" id="6344399">tls</span>&nbsp;<span class="op" id="6344403">=</span>&nbsp;<span class="ident" id="6344405">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344411">return</span>&nbsp;<span class="ident" id="6344418">c</span><span class="op" id="6344419">.</span><span class="ident" id="6344420">ehlo</span><span class="op" id="6344424">(</span><span class="op" id="6344425">)</span><br>
<span class="lineno"></span><span class="op" id="6344427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6344430">//&nbsp;Verify&nbsp;checks&nbsp;the&nbsp;validity&nbsp;of&nbsp;an&nbsp;email&nbsp;address&nbsp;on&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6344495">//&nbsp;If&nbsp;Verify&nbsp;returns&nbsp;nil,&nbsp;the&nbsp;address&nbsp;is&nbsp;valid.&nbsp;A&nbsp;non-nil&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="6344560">//&nbsp;does&nbsp;not&nbsp;necessarily&nbsp;indicate&nbsp;an&nbsp;invalid&nbsp;address.&nbsp;Many&nbsp;servers</span><br>
<span class="lineno"></span><span class="comment" id="6344626">//&nbsp;will&nbsp;not&nbsp;verify&nbsp;addresses&nbsp;for&nbsp;security&nbsp;reasons.</span><br>
<span class="lineno"></span><span class="keyword" id="6344677">func</span>&nbsp;<span class="op" id="6344682">(</span><span class="ident" id="6344683">c</span>&nbsp;<span class="op" id="6344685">*</span><span class="ident" id="6344686">Client</span><span class="op" id="6344692">)</span>&nbsp;<span class="ident" id="6344694">Verify</span><span class="op" id="6344700">(</span><span class="ident" id="6344701">addr</span>&nbsp;<span class="builtintype" id="6344706">string</span><span class="op" id="6344712">)</span>&nbsp;<span class="builtintype" id="6344714">error</span>&nbsp;<span class="op" id="6344720">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344723">if</span>&nbsp;<span class="ident" id="6344726">err</span>&nbsp;<span class="op" id="6344730">:=</span>&nbsp;<span class="ident" id="6344733">c</span><span class="op" id="6344734">.</span><span class="ident" id="6344735">hello</span><span class="op" id="6344740">(</span><span class="op" id="6344741">)</span><span class="op" id="6344742">;</span>&nbsp;<span class="ident" id="6344744">err</span>&nbsp;<span class="op" id="6344748">!=</span>&nbsp;<span class="ident" id="6344751">nil</span>&nbsp;<span class="op" id="6344755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344759">return</span>&nbsp;<span class="ident" id="6344766">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6344771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6344774">_</span><span class="op" id="6344775">,</span>&nbsp;<span class="ident" id="6344777">_</span><span class="op" id="6344778">,</span>&nbsp;<span class="ident" id="6344780">err</span>&nbsp;<span class="op" id="6344784">:=</span>&nbsp;<span class="ident" id="6344787">c</span><span class="op" id="6344788">.</span><span class="ident" id="6344789">cmd</span><span class="op" id="6344792">(</span><span class="num" id="6344793">250</span><span class="op" id="6344796">,</span>&nbsp;<span class="string" id="6344798">&#34;VRFY&nbsp;%s&#34;</span><span class="op" id="6344807">,</span>&nbsp;<span class="ident" id="6344809">addr</span><span class="op" id="6344813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344816">return</span>&nbsp;<span class="ident" id="6344823">err</span><br>
<span class="lineno">170</span><span class="op" id="6344827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6344830">//&nbsp;Auth&nbsp;authenticates&nbsp;a&nbsp;client&nbsp;using&nbsp;the&nbsp;provided&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="comment" id="6344906">//&nbsp;A&nbsp;failed&nbsp;authentication&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="6344956">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;AUTH&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno">175</span><span class="keyword" id="6345029">func</span>&nbsp;<span class="op" id="6345034">(</span><span class="ident" id="6345035">c</span>&nbsp;<span class="op" id="6345037">*</span><span class="ident" id="6345038">Client</span><span class="op" id="6345044">)</span>&nbsp;<span class="ident" id="6345046">Auth</span><span class="op" id="6345050">(</span><span class="ident" id="6345051">a</span>&nbsp;<span class="ident" id="6345053">Auth</span><span class="op" id="6345057">)</span>&nbsp;<span class="builtintype" id="6345059">error</span>&nbsp;<span class="op" id="6345065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345068">if</span>&nbsp;<span class="ident" id="6345071">err</span>&nbsp;<span class="op" id="6345075">:=</span>&nbsp;<span class="ident" id="6345078">c</span><span class="op" id="6345079">.</span><span class="ident" id="6345080">hello</span><span class="op" id="6345085">(</span><span class="op" id="6345086">)</span><span class="op" id="6345087">;</span>&nbsp;<span class="ident" id="6345089">err</span>&nbsp;<span class="op" id="6345093">!=</span>&nbsp;<span class="ident" id="6345096">nil</span>&nbsp;<span class="op" id="6345100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345104">return</span>&nbsp;<span class="ident" id="6345111">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6345116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345119">encoding</span>&nbsp;<span class="op" id="6345128">:=</span>&nbsp;<span class="ident" id="6345131">base64</span><span class="op" id="6345137">.</span><span class="ident" id="6345138">StdEncoding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345151">mech</span><span class="op" id="6345155">,</span>&nbsp;<span class="ident" id="6345157">resp</span><span class="op" id="6345161">,</span>&nbsp;<span class="ident" id="6345163">err</span>&nbsp;<span class="op" id="6345167">:=</span>&nbsp;<span class="ident" id="6345170">a</span><span class="op" id="6345171">.</span><span class="ident" id="6345172">Start</span><span class="op" id="6345177">(</span><span class="op" id="6345178">&amp;</span><span class="ident" id="6345179">ServerInfo</span><span class="op" id="6345189">{</span><span class="ident" id="6345190">c</span><span class="op" id="6345191">.</span><span class="ident" id="6345192">serverName</span><span class="op" id="6345202">,</span>&nbsp;<span class="ident" id="6345204">c</span><span class="op" id="6345205">.</span><span class="ident" id="6345206">tls</span><span class="op" id="6345209">,</span>&nbsp;<span class="ident" id="6345211">c</span><span class="op" id="6345212">.</span><span class="ident" id="6345213">auth</span><span class="op" id="6345217">}</span><span class="op" id="6345218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345221">if</span>&nbsp;<span class="ident" id="6345224">err</span>&nbsp;<span class="op" id="6345228">!=</span>&nbsp;<span class="ident" id="6345231">nil</span>&nbsp;<span class="op" id="6345235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345239">c</span><span class="op" id="6345240">.</span><span class="ident" id="6345241">Quit</span><span class="op" id="6345245">(</span><span class="op" id="6345246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345250">return</span>&nbsp;<span class="ident" id="6345257">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6345262">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345265">resp64</span>&nbsp;<span class="op" id="6345272">:=</span>&nbsp;<span class="builtinfunc" id="6345275">make</span><span class="op" id="6345279">(</span><span class="op" id="6345280">[</span><span class="op" id="6345281">]</span><span class="builtintype" id="6345282">byte</span><span class="op" id="6345286">,</span>&nbsp;<span class="ident" id="6345288">encoding</span><span class="op" id="6345296">.</span><span class="ident" id="6345297">EncodedLen</span><span class="op" id="6345307">(</span><span class="builtinfunc" id="6345308">len</span><span class="op" id="6345311">(</span><span class="ident" id="6345312">resp</span><span class="op" id="6345316">)</span><span class="op" id="6345317">)</span><span class="op" id="6345318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345321">encoding</span><span class="op" id="6345329">.</span><span class="ident" id="6345330">Encode</span><span class="op" id="6345336">(</span><span class="ident" id="6345337">resp64</span><span class="op" id="6345343">,</span>&nbsp;<span class="ident" id="6345345">resp</span><span class="op" id="6345349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345352">code</span><span class="op" id="6345356">,</span>&nbsp;<span class="ident" id="6345358">msg64</span><span class="op" id="6345363">,</span>&nbsp;<span class="ident" id="6345365">err</span>&nbsp;<span class="op" id="6345369">:=</span>&nbsp;<span class="ident" id="6345372">c</span><span class="op" id="6345373">.</span><span class="ident" id="6345374">cmd</span><span class="op" id="6345377">(</span><span class="num" id="6345378">0</span><span class="op" id="6345379">,</span>&nbsp;<span class="string" id="6345381">&#34;AUTH&nbsp;%s&nbsp;%s&#34;</span><span class="op" id="6345393">,</span>&nbsp;<span class="ident" id="6345395">mech</span><span class="op" id="6345399">,</span>&nbsp;<span class="ident" id="6345401">resp64</span><span class="op" id="6345407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345410">for</span>&nbsp;<span class="ident" id="6345414">err</span>&nbsp;<span class="op" id="6345418">==</span>&nbsp;<span class="ident" id="6345421">nil</span>&nbsp;<span class="op" id="6345425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345429">var</span>&nbsp;<span class="ident" id="6345433">msg</span>&nbsp;<span class="op" id="6345437">[</span><span class="op" id="6345438">]</span><span class="builtintype" id="6345439">byte</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345446">switch</span>&nbsp;<span class="ident" id="6345453">code</span>&nbsp;<span class="op" id="6345458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345462">case</span>&nbsp;<span class="num" id="6345467">334</span><span class="op" id="6345470">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345475">msg</span><span class="op" id="6345478">,</span>&nbsp;<span class="ident" id="6345480">err</span>&nbsp;<span class="op" id="6345484">=</span>&nbsp;<span class="ident" id="6345486">encoding</span><span class="op" id="6345494">.</span><span class="ident" id="6345495">DecodeString</span><span class="op" id="6345507">(</span><span class="ident" id="6345508">msg64</span><span class="op" id="6345513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345517">case</span>&nbsp;<span class="num" id="6345522">235</span><span class="op" id="6345525">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6345530">//&nbsp;the&nbsp;last&nbsp;message&nbsp;isn&#39;t&nbsp;base64&nbsp;because&nbsp;it&nbsp;isn&#39;t&nbsp;a&nbsp;challenge</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345595">msg</span>&nbsp;<span class="op" id="6345599">=</span>&nbsp;<span class="op" id="6345601">[</span><span class="op" id="6345602">]</span><span class="builtintype" id="6345603">byte</span><span class="op" id="6345607">(</span><span class="ident" id="6345608">msg64</span><span class="op" id="6345613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345617">default</span><span class="op" id="6345624">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345629">err</span>&nbsp;<span class="op" id="6345633">=</span>&nbsp;<span class="op" id="6345635">&amp;</span><span class="ident" id="6345636">textproto</span><span class="op" id="6345645">.</span><span class="ident" id="6345646">Error</span><span class="op" id="6345651">{</span><span class="ident" id="6345652">Code</span><span class="op" id="6345656">:</span>&nbsp;<span class="ident" id="6345658">code</span><span class="op" id="6345662">,</span>&nbsp;<span class="ident" id="6345664">Msg</span><span class="op" id="6345667">:</span>&nbsp;<span class="ident" id="6345669">msg64</span><span class="op" id="6345674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6345678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345682">if</span>&nbsp;<span class="ident" id="6345685">err</span>&nbsp;<span class="op" id="6345689">==</span>&nbsp;<span class="ident" id="6345692">nil</span>&nbsp;<span class="op" id="6345696">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345701">resp</span><span class="op" id="6345705">,</span>&nbsp;<span class="ident" id="6345707">err</span>&nbsp;<span class="op" id="6345711">=</span>&nbsp;<span class="ident" id="6345713">a</span><span class="op" id="6345714">.</span><span class="ident" id="6345715">Next</span><span class="op" id="6345719">(</span><span class="ident" id="6345720">msg</span><span class="op" id="6345723">,</span>&nbsp;<span class="ident" id="6345725">code</span>&nbsp;<span class="op" id="6345730">==</span>&nbsp;<span class="num" id="6345733">334</span><span class="op" id="6345736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6345740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345744">if</span>&nbsp;<span class="ident" id="6345747">err</span>&nbsp;<span class="op" id="6345751">!=</span>&nbsp;<span class="ident" id="6345754">nil</span>&nbsp;<span class="op" id="6345758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6345763">//&nbsp;abort&nbsp;the&nbsp;AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345784">c</span><span class="op" id="6345785">.</span><span class="ident" id="6345786">cmd</span><span class="op" id="6345789">(</span><span class="num" id="6345790">501</span><span class="op" id="6345793">,</span>&nbsp;<span class="string" id="6345795">&#34;*&#34;</span><span class="op" id="6345798">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345803">c</span><span class="op" id="6345804">.</span><span class="ident" id="6345805">Quit</span><span class="op" id="6345809">(</span><span class="op" id="6345810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345815">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6345823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345827">if</span>&nbsp;<span class="ident" id="6345830">resp</span>&nbsp;<span class="op" id="6345835">==</span>&nbsp;<span class="ident" id="6345838">nil</span>&nbsp;<span class="op" id="6345842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345847">break</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6345855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345859">resp64</span>&nbsp;<span class="op" id="6345866">=</span>&nbsp;<span class="builtinfunc" id="6345868">make</span><span class="op" id="6345872">(</span><span class="op" id="6345873">[</span><span class="op" id="6345874">]</span><span class="builtintype" id="6345875">byte</span><span class="op" id="6345879">,</span>&nbsp;<span class="ident" id="6345881">encoding</span><span class="op" id="6345889">.</span><span class="ident" id="6345890">EncodedLen</span><span class="op" id="6345900">(</span><span class="builtinfunc" id="6345901">len</span><span class="op" id="6345904">(</span><span class="ident" id="6345905">resp</span><span class="op" id="6345909">)</span><span class="op" id="6345910">)</span><span class="op" id="6345911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345915">encoding</span><span class="op" id="6345923">.</span><span class="ident" id="6345924">Encode</span><span class="op" id="6345930">(</span><span class="ident" id="6345931">resp64</span><span class="op" id="6345937">,</span>&nbsp;<span class="ident" id="6345939">resp</span><span class="op" id="6345943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345947">code</span><span class="op" id="6345951">,</span>&nbsp;<span class="ident" id="6345953">msg64</span><span class="op" id="6345958">,</span>&nbsp;<span class="ident" id="6345960">err</span>&nbsp;<span class="op" id="6345964">=</span>&nbsp;<span class="ident" id="6345966">c</span><span class="op" id="6345967">.</span><span class="ident" id="6345968">cmd</span><span class="op" id="6345971">(</span><span class="num" id="6345972">0</span><span class="op" id="6345973">,</span>&nbsp;<span class="builtintype" id="6345975">string</span><span class="op" id="6345981">(</span><span class="ident" id="6345982">resp64</span><span class="op" id="6345988">)</span><span class="op" id="6345989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6345992">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345995">return</span>&nbsp;<span class="ident" id="6346002">err</span><br>
<span class="lineno"></span><span class="op" id="6346006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6346009">//&nbsp;Mail&nbsp;issues&nbsp;a&nbsp;MAIL&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="6346087">//&nbsp;If&nbsp;the&nbsp;server&nbsp;supports&nbsp;the&nbsp;8BITMIME&nbsp;extension,&nbsp;Mail&nbsp;adds&nbsp;the&nbsp;BODY=8BITMIME</span><br>
<span class="lineno">220</span><span class="comment" id="6346165">//&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="6346179">//&nbsp;This&nbsp;initiates&nbsp;a&nbsp;mail&nbsp;transaction&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;Rcpt&nbsp;calls.</span><br>
<span class="lineno"></span><span class="keyword" id="6346259">func</span>&nbsp;<span class="op" id="6346264">(</span><span class="ident" id="6346265">c</span>&nbsp;<span class="op" id="6346267">*</span><span class="ident" id="6346268">Client</span><span class="op" id="6346274">)</span>&nbsp;<span class="ident" id="6346276">Mail</span><span class="op" id="6346280">(</span><span class="ident" id="6346281">from</span>&nbsp;<span class="builtintype" id="6346286">string</span><span class="op" id="6346292">)</span>&nbsp;<span class="builtintype" id="6346294">error</span>&nbsp;<span class="op" id="6346300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6346303">if</span>&nbsp;<span class="ident" id="6346306">err</span>&nbsp;<span class="op" id="6346310">:=</span>&nbsp;<span class="ident" id="6346313">c</span><span class="op" id="6346314">.</span><span class="ident" id="6346315">hello</span><span class="op" id="6346320">(</span><span class="op" id="6346321">)</span><span class="op" id="6346322">;</span>&nbsp;<span class="ident" id="6346324">err</span>&nbsp;<span class="op" id="6346328">!=</span>&nbsp;<span class="ident" id="6346331">nil</span>&nbsp;<span class="op" id="6346335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6346339">return</span>&nbsp;<span class="ident" id="6346346">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6346351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6346354">cmdStr</span>&nbsp;<span class="op" id="6346361">:=</span>&nbsp;<span class="string" id="6346364">&#34;MAIL&nbsp;FROM:&lt;%s&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6346382">if</span>&nbsp;<span class="ident" id="6346385">c</span><span class="op" id="6346386">.</span><span class="ident" id="6346387">ext</span>&nbsp;<span class="op" id="6346391">!=</span>&nbsp;<span class="ident" id="6346394">nil</span>&nbsp;<span class="op" id="6346398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6346402">if</span>&nbsp;<span class="ident" id="6346405">_</span><span class="op" id="6346406">,</span>&nbsp;<span class="ident" id="6346408">ok</span>&nbsp;<span class="op" id="6346411">:=</span>&nbsp;<span class="ident" id="6346414">c</span><span class="op" id="6346415">.</span><span class="ident" id="6346416">ext</span><span class="op" id="6346419">[</span><span class="string" id="6346420">&#34;8BITMIME&#34;</span><span class="op" id="6346430">]</span><span class="op" id="6346431">;</span>&nbsp;<span class="ident" id="6346433">ok</span>&nbsp;<span class="op" id="6346436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6346441">cmdStr</span>&nbsp;<span class="op" id="6346448">+=</span>&nbsp;<span class="string" id="6346451">&#34;&nbsp;BODY=8BITMIME&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6346470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6346473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6346476">_</span><span class="op" id="6346477">,</span>&nbsp;<span class="ident" id="6346479">_</span><span class="op" id="6346480">,</span>&nbsp;<span class="ident" id="6346482">err</span>&nbsp;<span class="op" id="6346486">:=</span>&nbsp;<span class="ident" id="6346489">c</span><span class="op" id="6346490">.</span><span class="ident" id="6346491">cmd</span><span class="op" id="6346494">(</span><span class="num" id="6346495">250</span><span class="op" id="6346498">,</span>&nbsp;<span class="ident" id="6346500">cmdStr</span><span class="op" id="6346506">,</span>&nbsp;<span class="ident" id="6346508">from</span><span class="op" id="6346512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6346515">return</span>&nbsp;<span class="ident" id="6346522">err</span><br>
<span class="lineno"></span><span class="op" id="6346526">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="6346529">//&nbsp;Rcpt&nbsp;issues&nbsp;a&nbsp;RCPT&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="6346607">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Rcpt&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Mail&nbsp;and&nbsp;may&nbsp;be&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6346683">//&nbsp;a&nbsp;Data&nbsp;call&nbsp;or&nbsp;another&nbsp;Rcpt&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="6346720">func</span>&nbsp;<span class="op" id="6346725">(</span><span class="ident" id="6346726">c</span>&nbsp;<span class="op" id="6346728">*</span><span class="ident" id="6346729">Client</span><span class="op" id="6346735">)</span>&nbsp;<span class="ident" id="6346737">Rcpt</span><span class="op" id="6346741">(</span><span class="ident" id="6346742">to</span>&nbsp;<span class="builtintype" id="6346745">string</span><span class="op" id="6346751">)</span>&nbsp;<span class="builtintype" id="6346753">error</span>&nbsp;<span class="op" id="6346759">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6346762">_</span><span class="op" id="6346763">,</span>&nbsp;<span class="ident" id="6346765">_</span><span class="op" id="6346766">,</span>&nbsp;<span class="ident" id="6346768">err</span>&nbsp;<span class="op" id="6346772">:=</span>&nbsp;<span class="ident" id="6346775">c</span><span class="op" id="6346776">.</span><span class="ident" id="6346777">cmd</span><span class="op" id="6346780">(</span><span class="num" id="6346781">25</span><span class="op" id="6346783">,</span>&nbsp;<span class="string" id="6346785">&#34;RCPT&nbsp;TO:&lt;%s&gt;&#34;</span><span class="op" id="6346799">,</span>&nbsp;<span class="ident" id="6346801">to</span><span class="op" id="6346803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6346806">return</span>&nbsp;<span class="ident" id="6346813">err</span><br>
<span class="lineno"></span><span class="op" id="6346817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6346820">type</span>&nbsp;<span class="ident" id="6346825">dataCloser</span>&nbsp;<span class="keyword" id="6346836">struct</span>&nbsp;<span class="op" id="6346843">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6346846">c</span>&nbsp;<span class="op" id="6346848">*</span><span class="ident" id="6346849">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6346857">io</span><span class="op" id="6346859">.</span><span class="ident" id="6346860">WriteCloser</span><br>
<span class="lineno"></span><span class="op" id="6346872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6346875">func</span>&nbsp;<span class="op" id="6346880">(</span><span class="ident" id="6346881">d</span>&nbsp;<span class="op" id="6346883">*</span><span class="ident" id="6346884">dataCloser</span><span class="op" id="6346894">)</span>&nbsp;<span class="ident" id="6346896">Close</span><span class="op" id="6346901">(</span><span class="op" id="6346902">)</span>&nbsp;<span class="builtintype" id="6346904">error</span>&nbsp;<span class="op" id="6346910">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6346913">d</span><span class="op" id="6346914">.</span><span class="ident" id="6346915">WriteCloser</span><span class="op" id="6346926">.</span><span class="ident" id="6346927">Close</span><span class="op" id="6346932">(</span><span class="op" id="6346933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6346936">_</span><span class="op" id="6346937">,</span>&nbsp;<span class="ident" id="6346939">_</span><span class="op" id="6346940">,</span>&nbsp;<span class="ident" id="6346942">err</span>&nbsp;<span class="op" id="6346946">:=</span>&nbsp;<span class="ident" id="6346949">d</span><span class="op" id="6346950">.</span><span class="ident" id="6346951">c</span><span class="op" id="6346952">.</span><span class="ident" id="6346953">Text</span><span class="op" id="6346957">.</span><span class="ident" id="6346958">ReadResponse</span><span class="op" id="6346970">(</span><span class="num" id="6346971">250</span><span class="op" id="6346974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6346977">return</span>&nbsp;<span class="ident" id="6346984">err</span><br>
<span class="lineno"></span><span class="op" id="6346988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="6346991">//&nbsp;Data&nbsp;issues&nbsp;a&nbsp;DATA&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;and&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="6347061">//&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;the&nbsp;data.&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the&nbsp;writer</span><br>
<span class="lineno"></span><span class="comment" id="6347130">//&nbsp;before&nbsp;calling&nbsp;any&nbsp;more&nbsp;methods&nbsp;on&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6347171">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Data&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;calls&nbsp;to&nbsp;Rcpt.</span><br>
<span class="lineno"></span><span class="keyword" id="6347236">func</span>&nbsp;<span class="op" id="6347241">(</span><span class="ident" id="6347242">c</span>&nbsp;<span class="op" id="6347244">*</span><span class="ident" id="6347245">Client</span><span class="op" id="6347251">)</span>&nbsp;<span class="ident" id="6347253">Data</span><span class="op" id="6347257">(</span><span class="op" id="6347258">)</span>&nbsp;<span class="op" id="6347260">(</span><span class="ident" id="6347261">io</span><span class="op" id="6347263">.</span><span class="ident" id="6347264">WriteCloser</span><span class="op" id="6347275">,</span>&nbsp;<span class="builtintype" id="6347277">error</span><span class="op" id="6347282">)</span>&nbsp;<span class="op" id="6347284">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6347287">_</span><span class="op" id="6347288">,</span>&nbsp;<span class="ident" id="6347290">_</span><span class="op" id="6347291">,</span>&nbsp;<span class="ident" id="6347293">err</span>&nbsp;<span class="op" id="6347297">:=</span>&nbsp;<span class="ident" id="6347300">c</span><span class="op" id="6347301">.</span><span class="ident" id="6347302">cmd</span><span class="op" id="6347305">(</span><span class="num" id="6347306">354</span><span class="op" id="6347309">,</span>&nbsp;<span class="string" id="6347311">&#34;DATA&#34;</span><span class="op" id="6347317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6347320">if</span>&nbsp;<span class="ident" id="6347323">err</span>&nbsp;<span class="op" id="6347327">!=</span>&nbsp;<span class="ident" id="6347330">nil</span>&nbsp;<span class="op" id="6347334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6347338">return</span>&nbsp;<span class="ident" id="6347345">nil</span><span class="op" id="6347348">,</span>&nbsp;<span class="ident" id="6347350">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6347355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6347358">return</span>&nbsp;<span class="op" id="6347365">&amp;</span><span class="ident" id="6347366">dataCloser</span><span class="op" id="6347376">{</span><span class="ident" id="6347377">c</span><span class="op" id="6347378">,</span>&nbsp;<span class="ident" id="6347380">c</span><span class="op" id="6347381">.</span><span class="ident" id="6347382">Text</span><span class="op" id="6347386">.</span><span class="ident" id="6347387">DotWriter</span><span class="op" id="6347396">(</span><span class="op" id="6347397">)</span><span class="op" id="6347398">}</span><span class="op" id="6347399">,</span>&nbsp;<span class="ident" id="6347401">nil</span><br>
<span class="lineno">265</span><span class="op" id="6347405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6347408">var</span>&nbsp;<span class="ident" id="6347412">testHookStartTLS</span>&nbsp;<span class="keyword" id="6347429">func</span><span class="op" id="6347433">(</span><span class="op" id="6347434">*</span><span class="ident" id="6347435">tls</span><span class="op" id="6347438">.</span><span class="ident" id="6347439">Config</span><span class="op" id="6347445">)</span>&nbsp;<span class="comment" id="6347447">//&nbsp;nil,&nbsp;except&nbsp;for&nbsp;tests</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6347473">//&nbsp;SendMail&nbsp;connects&nbsp;to&nbsp;the&nbsp;server&nbsp;at&nbsp;addr,&nbsp;switches&nbsp;to&nbsp;TLS&nbsp;if</span><br>
<span class="lineno">270</span><span class="comment" id="6347536">//&nbsp;possible,&nbsp;authenticates&nbsp;with&nbsp;the&nbsp;optional&nbsp;mechanism&nbsp;a&nbsp;if&nbsp;possible,</span><br>
<span class="lineno"></span><span class="comment" id="6347606">//&nbsp;and&nbsp;then&nbsp;sends&nbsp;an&nbsp;email&nbsp;from&nbsp;address&nbsp;from,&nbsp;to&nbsp;addresses&nbsp;to,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6347674">//&nbsp;message&nbsp;msg.</span><br>
<span class="lineno"></span><span class="keyword" id="6347690">func</span>&nbsp;<span class="ident" id="6347695">SendMail</span><span class="op" id="6347703">(</span><span class="ident" id="6347704">addr</span>&nbsp;<span class="builtintype" id="6347709">string</span><span class="op" id="6347715">,</span>&nbsp;<span class="ident" id="6347717">a</span>&nbsp;<span class="ident" id="6347719">Auth</span><span class="op" id="6347723">,</span>&nbsp;<span class="ident" id="6347725">from</span>&nbsp;<span class="builtintype" id="6347730">string</span><span class="op" id="6347736">,</span>&nbsp;<span class="ident" id="6347738">to</span>&nbsp;<span class="op" id="6347741">[</span><span class="op" id="6347742">]</span><span class="builtintype" id="6347743">string</span><span class="op" id="6347749">,</span>&nbsp;<span class="ident" id="6347751">msg</span>&nbsp;<span class="op" id="6347755">[</span><span class="op" id="6347756">]</span><span class="builtintype" id="6347757">byte</span><span class="op" id="6347761">)</span>&nbsp;<span class="builtintype" id="6347763">error</span>&nbsp;<span class="op" id="6347769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6347772">c</span><span class="op" id="6347773">,</span>&nbsp;<span class="ident" id="6347775">err</span>&nbsp;<span class="op" id="6347779">:=</span>&nbsp;<span class="ident" id="6347782">Dial</span><span class="op" id="6347786">(</span><span class="ident" id="6347787">addr</span><span class="op" id="6347791">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6347794">if</span>&nbsp;<span class="ident" id="6347797">err</span>&nbsp;<span class="op" id="6347801">!=</span>&nbsp;<span class="ident" id="6347804">nil</span>&nbsp;<span class="op" id="6347808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6347812">return</span>&nbsp;<span class="ident" id="6347819">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6347824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6347827">defer</span>&nbsp;<span class="ident" id="6347833">c</span><span class="op" id="6347834">.</span><span class="ident" id="6347835">Close</span><span class="op" id="6347840">(</span><span class="op" id="6347841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6347844">if</span>&nbsp;<span class="ident" id="6347847">err</span>&nbsp;<span class="op" id="6347851">=</span>&nbsp;<span class="ident" id="6347853">c</span><span class="op" id="6347854">.</span><span class="ident" id="6347855">hello</span><span class="op" id="6347860">(</span><span class="op" id="6347861">)</span><span class="op" id="6347862">;</span>&nbsp;<span class="ident" id="6347864">err</span>&nbsp;<span class="op" id="6347868">!=</span>&nbsp;<span class="ident" id="6347871">nil</span>&nbsp;<span class="op" id="6347875">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6347879">return</span>&nbsp;<span class="ident" id="6347886">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6347891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6347894">if</span>&nbsp;<span class="ident" id="6347897">ok</span><span class="op" id="6347899">,</span>&nbsp;<span class="ident" id="6347901">_</span>&nbsp;<span class="op" id="6347903">:=</span>&nbsp;<span class="ident" id="6347906">c</span><span class="op" id="6347907">.</span><span class="ident" id="6347908">Extension</span><span class="op" id="6347917">(</span><span class="string" id="6347918">&#34;STARTTLS&#34;</span><span class="op" id="6347928">)</span><span class="op" id="6347929">;</span>&nbsp;<span class="ident" id="6347931">ok</span>&nbsp;<span class="op" id="6347934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6347938">config</span>&nbsp;<span class="op" id="6347945">:=</span>&nbsp;<span class="op" id="6347948">&amp;</span><span class="ident" id="6347949">tls</span><span class="op" id="6347952">.</span><span class="ident" id="6347953">Config</span><span class="op" id="6347959">{</span><span class="ident" id="6347960">ServerName</span><span class="op" id="6347970">:</span>&nbsp;<span class="ident" id="6347972">c</span><span class="op" id="6347973">.</span><span class="ident" id="6347974">serverName</span><span class="op" id="6347984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6347988">if</span>&nbsp;<span class="ident" id="6347991">testHookStartTLS</span>&nbsp;<span class="op" id="6348008">!=</span>&nbsp;<span class="ident" id="6348011">nil</span>&nbsp;<span class="op" id="6348015">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6348020">testHookStartTLS</span><span class="op" id="6348036">(</span><span class="ident" id="6348037">config</span><span class="op" id="6348043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6348047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348051">if</span>&nbsp;<span class="ident" id="6348054">err</span>&nbsp;<span class="op" id="6348058">=</span>&nbsp;<span class="ident" id="6348060">c</span><span class="op" id="6348061">.</span><span class="ident" id="6348062">StartTLS</span><span class="op" id="6348070">(</span><span class="ident" id="6348071">config</span><span class="op" id="6348077">)</span><span class="op" id="6348078">;</span>&nbsp;<span class="ident" id="6348080">err</span>&nbsp;<span class="op" id="6348084">!=</span>&nbsp;<span class="ident" id="6348087">nil</span>&nbsp;<span class="op" id="6348091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348096">return</span>&nbsp;<span class="ident" id="6348103">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6348109">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6348112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348115">if</span>&nbsp;<span class="ident" id="6348118">a</span>&nbsp;<span class="op" id="6348120">!=</span>&nbsp;<span class="ident" id="6348123">nil</span>&nbsp;<span class="op" id="6348127">&amp;&amp;</span>&nbsp;<span class="ident" id="6348130">c</span><span class="op" id="6348131">.</span><span class="ident" id="6348132">ext</span>&nbsp;<span class="op" id="6348136">!=</span>&nbsp;<span class="ident" id="6348139">nil</span>&nbsp;<span class="op" id="6348143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348147">if</span>&nbsp;<span class="ident" id="6348150">_</span><span class="op" id="6348151">,</span>&nbsp;<span class="ident" id="6348153">ok</span>&nbsp;<span class="op" id="6348156">:=</span>&nbsp;<span class="ident" id="6348159">c</span><span class="op" id="6348160">.</span><span class="ident" id="6348161">ext</span><span class="op" id="6348164">[</span><span class="string" id="6348165">&#34;AUTH&#34;</span><span class="op" id="6348171">]</span><span class="op" id="6348172">;</span>&nbsp;<span class="ident" id="6348174">ok</span>&nbsp;<span class="op" id="6348177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348182">if</span>&nbsp;<span class="ident" id="6348185">err</span>&nbsp;<span class="op" id="6348189">=</span>&nbsp;<span class="ident" id="6348191">c</span><span class="op" id="6348192">.</span><span class="ident" id="6348193">Auth</span><span class="op" id="6348197">(</span><span class="ident" id="6348198">a</span><span class="op" id="6348199">)</span><span class="op" id="6348200">;</span>&nbsp;<span class="ident" id="6348202">err</span>&nbsp;<span class="op" id="6348206">!=</span>&nbsp;<span class="ident" id="6348209">nil</span>&nbsp;<span class="op" id="6348213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348219">return</span>&nbsp;<span class="ident" id="6348226">err</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6348233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6348237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6348240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348243">if</span>&nbsp;<span class="ident" id="6348246">err</span>&nbsp;<span class="op" id="6348250">=</span>&nbsp;<span class="ident" id="6348252">c</span><span class="op" id="6348253">.</span><span class="ident" id="6348254">Mail</span><span class="op" id="6348258">(</span><span class="ident" id="6348259">from</span><span class="op" id="6348263">)</span><span class="op" id="6348264">;</span>&nbsp;<span class="ident" id="6348266">err</span>&nbsp;<span class="op" id="6348270">!=</span>&nbsp;<span class="ident" id="6348273">nil</span>&nbsp;<span class="op" id="6348277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348281">return</span>&nbsp;<span class="ident" id="6348288">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6348293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348296">for</span>&nbsp;<span class="ident" id="6348300">_</span><span class="op" id="6348301">,</span>&nbsp;<span class="ident" id="6348303">addr</span>&nbsp;<span class="op" id="6348308">:=</span>&nbsp;<span class="keyword" id="6348311">range</span>&nbsp;<span class="ident" id="6348317">to</span>&nbsp;<span class="op" id="6348320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348324">if</span>&nbsp;<span class="ident" id="6348327">err</span>&nbsp;<span class="op" id="6348331">=</span>&nbsp;<span class="ident" id="6348333">c</span><span class="op" id="6348334">.</span><span class="ident" id="6348335">Rcpt</span><span class="op" id="6348339">(</span><span class="ident" id="6348340">addr</span><span class="op" id="6348344">)</span><span class="op" id="6348345">;</span>&nbsp;<span class="ident" id="6348347">err</span>&nbsp;<span class="op" id="6348351">!=</span>&nbsp;<span class="ident" id="6348354">nil</span>&nbsp;<span class="op" id="6348358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348363">return</span>&nbsp;<span class="ident" id="6348370">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6348376">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6348379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6348382">w</span><span class="op" id="6348383">,</span>&nbsp;<span class="ident" id="6348385">err</span>&nbsp;<span class="op" id="6348389">:=</span>&nbsp;<span class="ident" id="6348392">c</span><span class="op" id="6348393">.</span><span class="ident" id="6348394">Data</span><span class="op" id="6348398">(</span><span class="op" id="6348399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348402">if</span>&nbsp;<span class="ident" id="6348405">err</span>&nbsp;<span class="op" id="6348409">!=</span>&nbsp;<span class="ident" id="6348412">nil</span>&nbsp;<span class="op" id="6348416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348420">return</span>&nbsp;<span class="ident" id="6348427">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6348432">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6348435">_</span><span class="op" id="6348436">,</span>&nbsp;<span class="ident" id="6348438">err</span>&nbsp;<span class="op" id="6348442">=</span>&nbsp;<span class="ident" id="6348444">w</span><span class="op" id="6348445">.</span><span class="ident" id="6348446">Write</span><span class="op" id="6348451">(</span><span class="ident" id="6348452">msg</span><span class="op" id="6348455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348458">if</span>&nbsp;<span class="ident" id="6348461">err</span>&nbsp;<span class="op" id="6348465">!=</span>&nbsp;<span class="ident" id="6348468">nil</span>&nbsp;<span class="op" id="6348472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348476">return</span>&nbsp;<span class="ident" id="6348483">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6348488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6348491">err</span>&nbsp;<span class="op" id="6348495">=</span>&nbsp;<span class="ident" id="6348497">w</span><span class="op" id="6348498">.</span><span class="ident" id="6348499">Close</span><span class="op" id="6348504">(</span><span class="op" id="6348505">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348508">if</span>&nbsp;<span class="ident" id="6348511">err</span>&nbsp;<span class="op" id="6348515">!=</span>&nbsp;<span class="ident" id="6348518">nil</span>&nbsp;<span class="op" id="6348522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348526">return</span>&nbsp;<span class="ident" id="6348533">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6348538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348541">return</span>&nbsp;<span class="ident" id="6348548">c</span><span class="op" id="6348549">.</span><span class="ident" id="6348550">Quit</span><span class="op" id="6348554">(</span><span class="op" id="6348555">)</span><br>
<span class="lineno"></span><span class="op" id="6348557">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="6348560">//&nbsp;Extension&nbsp;reports&nbsp;whether&nbsp;an&nbsp;extension&nbsp;is&nbsp;support&nbsp;by&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6348628">//&nbsp;The&nbsp;extension&nbsp;name&nbsp;is&nbsp;case-insensitive.&nbsp;If&nbsp;the&nbsp;extension&nbsp;is&nbsp;supported,</span><br>
<span class="lineno"></span><span class="comment" id="6348702">//&nbsp;Extension&nbsp;also&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;contains&nbsp;any&nbsp;parameters&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6348770">//&nbsp;server&nbsp;specifies&nbsp;for&nbsp;the&nbsp;extension.</span><br>
<span class="lineno">325</span><span class="keyword" id="6348809">func</span>&nbsp;<span class="op" id="6348814">(</span><span class="ident" id="6348815">c</span>&nbsp;<span class="op" id="6348817">*</span><span class="ident" id="6348818">Client</span><span class="op" id="6348824">)</span>&nbsp;<span class="ident" id="6348826">Extension</span><span class="op" id="6348835">(</span><span class="ident" id="6348836">ext</span>&nbsp;<span class="builtintype" id="6348840">string</span><span class="op" id="6348846">)</span>&nbsp;<span class="op" id="6348848">(</span><span class="builtintype" id="6348849">bool</span><span class="op" id="6348853">,</span>&nbsp;<span class="builtintype" id="6348855">string</span><span class="op" id="6348861">)</span>&nbsp;<span class="op" id="6348863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348866">if</span>&nbsp;<span class="ident" id="6348869">err</span>&nbsp;<span class="op" id="6348873">:=</span>&nbsp;<span class="ident" id="6348876">c</span><span class="op" id="6348877">.</span><span class="ident" id="6348878">hello</span><span class="op" id="6348883">(</span><span class="op" id="6348884">)</span><span class="op" id="6348885">;</span>&nbsp;<span class="ident" id="6348887">err</span>&nbsp;<span class="op" id="6348891">!=</span>&nbsp;<span class="ident" id="6348894">nil</span>&nbsp;<span class="op" id="6348898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348902">return</span>&nbsp;<span class="ident" id="6348909">false</span><span class="op" id="6348914">,</span>&nbsp;<span class="string" id="6348916">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6348920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348923">if</span>&nbsp;<span class="ident" id="6348926">c</span><span class="op" id="6348927">.</span><span class="ident" id="6348928">ext</span>&nbsp;<span class="op" id="6348932">==</span>&nbsp;<span class="ident" id="6348935">nil</span>&nbsp;<span class="op" id="6348939">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6348943">return</span>&nbsp;<span class="ident" id="6348950">false</span><span class="op" id="6348955">,</span>&nbsp;<span class="string" id="6348957">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6348961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6348964">ext</span>&nbsp;<span class="op" id="6348968">=</span>&nbsp;<span class="ident" id="6348970">strings</span><span class="op" id="6348977">.</span><span class="ident" id="6348978">ToUpper</span><span class="op" id="6348985">(</span><span class="ident" id="6348986">ext</span><span class="op" id="6348989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6348992">param</span><span class="op" id="6348997">,</span>&nbsp;<span class="ident" id="6348999">ok</span>&nbsp;<span class="op" id="6349002">:=</span>&nbsp;<span class="ident" id="6349005">c</span><span class="op" id="6349006">.</span><span class="ident" id="6349007">ext</span><span class="op" id="6349010">[</span><span class="ident" id="6349011">ext</span><span class="op" id="6349014">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6349017">return</span>&nbsp;<span class="ident" id="6349024">ok</span><span class="op" id="6349026">,</span>&nbsp;<span class="ident" id="6349028">param</span><br>
<span class="lineno">335</span><span class="op" id="6349034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6349037">//&nbsp;Reset&nbsp;sends&nbsp;the&nbsp;RSET&nbsp;command&nbsp;to&nbsp;the&nbsp;server,&nbsp;aborting&nbsp;the&nbsp;current&nbsp;mail</span><br>
<span class="lineno"></span><span class="comment" id="6349110">//&nbsp;transaction.</span><br>
<span class="lineno"></span><span class="keyword" id="6349126">func</span>&nbsp;<span class="op" id="6349131">(</span><span class="ident" id="6349132">c</span>&nbsp;<span class="op" id="6349134">*</span><span class="ident" id="6349135">Client</span><span class="op" id="6349141">)</span>&nbsp;<span class="ident" id="6349143">Reset</span><span class="op" id="6349148">(</span><span class="op" id="6349149">)</span>&nbsp;<span class="builtintype" id="6349151">error</span>&nbsp;<span class="op" id="6349157">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6349160">if</span>&nbsp;<span class="ident" id="6349163">err</span>&nbsp;<span class="op" id="6349167">:=</span>&nbsp;<span class="ident" id="6349170">c</span><span class="op" id="6349171">.</span><span class="ident" id="6349172">hello</span><span class="op" id="6349177">(</span><span class="op" id="6349178">)</span><span class="op" id="6349179">;</span>&nbsp;<span class="ident" id="6349181">err</span>&nbsp;<span class="op" id="6349185">!=</span>&nbsp;<span class="ident" id="6349188">nil</span>&nbsp;<span class="op" id="6349192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6349196">return</span>&nbsp;<span class="ident" id="6349203">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6349208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6349211">_</span><span class="op" id="6349212">,</span>&nbsp;<span class="ident" id="6349214">_</span><span class="op" id="6349215">,</span>&nbsp;<span class="ident" id="6349217">err</span>&nbsp;<span class="op" id="6349221">:=</span>&nbsp;<span class="ident" id="6349224">c</span><span class="op" id="6349225">.</span><span class="ident" id="6349226">cmd</span><span class="op" id="6349229">(</span><span class="num" id="6349230">250</span><span class="op" id="6349233">,</span>&nbsp;<span class="string" id="6349235">&#34;RSET&#34;</span><span class="op" id="6349241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6349244">return</span>&nbsp;<span class="ident" id="6349251">err</span><br>
<span class="lineno">345</span><span class="op" id="6349255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6349258">//&nbsp;Quit&nbsp;sends&nbsp;the&nbsp;QUIT&nbsp;command&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6349330">func</span>&nbsp;<span class="op" id="6349335">(</span><span class="ident" id="6349336">c</span>&nbsp;<span class="op" id="6349338">*</span><span class="ident" id="6349339">Client</span><span class="op" id="6349345">)</span>&nbsp;<span class="ident" id="6349347">Quit</span><span class="op" id="6349351">(</span><span class="op" id="6349352">)</span>&nbsp;<span class="builtintype" id="6349354">error</span>&nbsp;<span class="op" id="6349360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6349363">if</span>&nbsp;<span class="ident" id="6349366">err</span>&nbsp;<span class="op" id="6349370">:=</span>&nbsp;<span class="ident" id="6349373">c</span><span class="op" id="6349374">.</span><span class="ident" id="6349375">hello</span><span class="op" id="6349380">(</span><span class="op" id="6349381">)</span><span class="op" id="6349382">;</span>&nbsp;<span class="ident" id="6349384">err</span>&nbsp;<span class="op" id="6349388">!=</span>&nbsp;<span class="ident" id="6349391">nil</span>&nbsp;<span class="op" id="6349395">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6349399">return</span>&nbsp;<span class="ident" id="6349406">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6349411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6349414">_</span><span class="op" id="6349415">,</span>&nbsp;<span class="ident" id="6349417">_</span><span class="op" id="6349418">,</span>&nbsp;<span class="ident" id="6349420">err</span>&nbsp;<span class="op" id="6349424">:=</span>&nbsp;<span class="ident" id="6349427">c</span><span class="op" id="6349428">.</span><span class="ident" id="6349429">cmd</span><span class="op" id="6349432">(</span><span class="num" id="6349433">221</span><span class="op" id="6349436">,</span>&nbsp;<span class="string" id="6349438">&#34;QUIT&#34;</span><span class="op" id="6349444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6349447">if</span>&nbsp;<span class="ident" id="6349450">err</span>&nbsp;<span class="op" id="6349454">!=</span>&nbsp;<span class="ident" id="6349457">nil</span>&nbsp;<span class="op" id="6349461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6349465">return</span>&nbsp;<span class="ident" id="6349472">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6349477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6349480">return</span>&nbsp;<span class="ident" id="6349487">c</span><span class="op" id="6349488">.</span><span class="ident" id="6349489">Text</span><span class="op" id="6349493">.</span><span class="ident" id="6349494">Close</span><span class="op" id="6349499">(</span><span class="op" id="6349500">)</span><br>
<span class="lineno"></span><span class="op" id="6349502">}</span>
</div>
</body>
</html>
