<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8537934">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8537989">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8538043">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8538094">package</span>&nbsp;<span class="ident" id="8538102">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8538107">import</span>&nbsp;<span class="op" id="8538114">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8538117">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8538126">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8538136">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8538151">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8538166">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8538185">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8538201">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8538207">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8538219">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8538230">&#34;testing/quick&#34;</span><br>
<span class="lineno"></span><span class="op" id="8538246">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8538249">func</span>&nbsp;<span class="ident" id="8538254">decodeBase64</span><span class="op" id="8538266">(</span><span class="ident" id="8538267">in</span>&nbsp;<span class="builtintype" id="8538270">string</span><span class="op" id="8538276">)</span>&nbsp;<span class="op" id="8538278">[</span><span class="op" id="8538279">]</span><span class="builtintype" id="8538280">byte</span>&nbsp;<span class="op" id="8538285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8538288">out</span>&nbsp;<span class="op" id="8538292">:=</span>&nbsp;<span class="builtinfunc" id="8538295">make</span><span class="op" id="8538299">(</span><span class="op" id="8538300">[</span><span class="op" id="8538301">]</span><span class="builtintype" id="8538302">byte</span><span class="op" id="8538306">,</span>&nbsp;<span class="ident" id="8538308">base64</span><span class="op" id="8538314">.</span><span class="ident" id="8538315">StdEncoding</span><span class="op" id="8538326">.</span><span class="ident" id="8538327">DecodedLen</span><span class="op" id="8538337">(</span><span class="builtinfunc" id="8538338">len</span><span class="op" id="8538341">(</span><span class="ident" id="8538342">in</span><span class="op" id="8538344">)</span><span class="op" id="8538345">)</span><span class="op" id="8538346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8538349">n</span><span class="op" id="8538350">,</span>&nbsp;<span class="ident" id="8538352">err</span>&nbsp;<span class="op" id="8538356">:=</span>&nbsp;<span class="ident" id="8538359">base64</span><span class="op" id="8538365">.</span><span class="ident" id="8538366">StdEncoding</span><span class="op" id="8538377">.</span><span class="ident" id="8538378">Decode</span><span class="op" id="8538384">(</span><span class="ident" id="8538385">out</span><span class="op" id="8538388">,</span>&nbsp;<span class="op" id="8538390">[</span><span class="op" id="8538391">]</span><span class="builtintype" id="8538392">byte</span><span class="op" id="8538396">(</span><span class="ident" id="8538397">in</span><span class="op" id="8538399">)</span><span class="op" id="8538400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8538403">if</span>&nbsp;<span class="ident" id="8538406">err</span>&nbsp;<span class="op" id="8538410">!=</span>&nbsp;<span class="ident" id="8538413">nil</span>&nbsp;<span class="op" id="8538417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8538421">return</span>&nbsp;<span class="ident" id="8538428">nil</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8538433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8538436">return</span>&nbsp;<span class="ident" id="8538443">out</span><span class="op" id="8538446">[</span><span class="num" id="8538447">0</span><span class="op" id="8538448">:</span><span class="ident" id="8538449">n</span><span class="op" id="8538450">]</span><br>
<span class="lineno"></span><span class="op" id="8538452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8538455">type</span>&nbsp;<span class="ident" id="8538460">DecryptPKCS1v15Test</span>&nbsp;<span class="keyword" id="8538480">struct</span>&nbsp;<span class="op" id="8538487">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8538490">in</span><span class="op" id="8538492">,</span>&nbsp;<span class="ident" id="8538494">out</span>&nbsp;<span class="builtintype" id="8538498">string</span><br>
<span class="lineno"></span><span class="op" id="8538505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8538508">//&nbsp;These&nbsp;test&nbsp;vectors&nbsp;were&nbsp;generated&nbsp;with&nbsp;`openssl&nbsp;rsautl&nbsp;-pkcs&nbsp;-encrypt`</span><br>
<span class="lineno"></span><span class="keyword" id="8538582">var</span>&nbsp;<span class="ident" id="8538586">decryptPKCS1v15Tests</span>&nbsp;<span class="op" id="8538607">=</span>&nbsp;<span class="op" id="8538609">[</span><span class="op" id="8538610">]</span><span class="ident" id="8538611">DecryptPKCS1v15Test</span><span class="op" id="8538630">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8538633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8538637">&#34;gIcUIoVkD6ATMBk/u/nlCZCCWRKdkfjCgFdo35VpRXLduiKXhNz1XupLLzTXAybEq15juc+EgY5o0DHv/nt3yg==&#34;</span><span class="op" id="8538727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8538731">&#34;x&#34;</span><span class="op" id="8538734">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8538737">}</span><span class="op" id="8538738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8538741">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8538745">&#34;Y7TOCSqofGhkRb+jaVRLzK8xw2cSo1IVES19utzv6hwvx+M8kFsoWQm5DzBeJCZTCVDPkTpavUuEbgp8hnUGDw==&#34;</span><span class="op" id="8538835">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8538839">&#34;testing.&#34;</span><span class="op" id="8538849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8538852">}</span><span class="op" id="8538853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8538856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8538860">&#34;arReP9DJtEVyV2Dg3dDp4c/PSk1O6lxkoJ8HcFupoRorBZG+7+1fDAwT1olNddFnQMjmkb8vxwmNMoTAT/BFjQ==&#34;</span><span class="op" id="8538950">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8538954">&#34;testing.\n&#34;</span><span class="op" id="8538966">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8538969">}</span><span class="op" id="8538970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8538973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8538977">&#34;WtaBXIoGC54+vH0NH0CHHE+dRDOsMc/6BrfFu2lEqcKL9+uDuWaf+Xj9mrbQCjjZcpQuX733zyok/jsnqe/Ftw==&#34;</span><span class="op" id="8539067">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8539071">&#34;01234567890123456789012345678901234567890123456789012&#34;</span><span class="op" id="8539126">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8539129">}</span><span class="op" id="8539130">,</span><br>
<span class="lineno"></span><span class="op" id="8539132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8539135">func</span>&nbsp;<span class="ident" id="8539140">TestDecryptPKCS1v15</span><span class="op" id="8539159">(</span><span class="ident" id="8539160">t</span>&nbsp;<span class="op" id="8539162">*</span><span class="ident" id="8539163">testing</span><span class="op" id="8539170">.</span><span class="ident" id="8539171">T</span><span class="op" id="8539172">)</span>&nbsp;<span class="op" id="8539174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539177">for</span>&nbsp;<span class="ident" id="8539181">i</span><span class="op" id="8539182">,</span>&nbsp;<span class="ident" id="8539184">test</span>&nbsp;<span class="op" id="8539189">:=</span>&nbsp;<span class="keyword" id="8539192">range</span>&nbsp;<span class="ident" id="8539198">decryptPKCS1v15Tests</span>&nbsp;<span class="op" id="8539219">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539223">out</span><span class="op" id="8539226">,</span>&nbsp;<span class="ident" id="8539228">err</span>&nbsp;<span class="op" id="8539232">:=</span>&nbsp;<span class="ident" id="8539235">DecryptPKCS1v15</span><span class="op" id="8539250">(</span><span class="ident" id="8539251">nil</span><span class="op" id="8539254">,</span>&nbsp;<span class="ident" id="8539256">rsaPrivateKey</span><span class="op" id="8539269">,</span>&nbsp;<span class="ident" id="8539271">decodeBase64</span><span class="op" id="8539283">(</span><span class="ident" id="8539284">test</span><span class="op" id="8539288">.</span><span class="ident" id="8539289">in</span><span class="op" id="8539291">)</span><span class="op" id="8539292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539296">if</span>&nbsp;<span class="ident" id="8539299">err</span>&nbsp;<span class="op" id="8539303">!=</span>&nbsp;<span class="ident" id="8539306">nil</span>&nbsp;<span class="op" id="8539310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539315">t</span><span class="op" id="8539316">.</span><span class="ident" id="8539317">Errorf</span><span class="op" id="8539323">(</span><span class="string" id="8539324">&#34;#%d&nbsp;error&nbsp;decrypting&#34;</span><span class="op" id="8539346">,</span>&nbsp;<span class="ident" id="8539348">i</span><span class="op" id="8539349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8539353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539357">want</span>&nbsp;<span class="op" id="8539362">:=</span>&nbsp;<span class="op" id="8539365">[</span><span class="op" id="8539366">]</span><span class="builtintype" id="8539367">byte</span><span class="op" id="8539371">(</span><span class="ident" id="8539372">test</span><span class="op" id="8539376">.</span><span class="ident" id="8539377">out</span><span class="op" id="8539380">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539384">if</span>&nbsp;<span class="op" id="8539387">!</span><span class="ident" id="8539388">bytes</span><span class="op" id="8539393">.</span><span class="ident" id="8539394">Equal</span><span class="op" id="8539399">(</span><span class="ident" id="8539400">out</span><span class="op" id="8539403">,</span>&nbsp;<span class="ident" id="8539405">want</span><span class="op" id="8539409">)</span>&nbsp;<span class="op" id="8539411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539416">t</span><span class="op" id="8539417">.</span><span class="ident" id="8539418">Errorf</span><span class="op" id="8539424">(</span><span class="string" id="8539425">&#34;#%d&nbsp;got:%#v&nbsp;want:%#v&#34;</span><span class="op" id="8539447">,</span>&nbsp;<span class="ident" id="8539449">i</span><span class="op" id="8539450">,</span>&nbsp;<span class="ident" id="8539452">out</span><span class="op" id="8539455">,</span>&nbsp;<span class="ident" id="8539457">want</span><span class="op" id="8539461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8539465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8539468">}</span><br>
<span class="lineno"></span><span class="op" id="8539470">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="8539473">func</span>&nbsp;<span class="ident" id="8539478">TestEncryptPKCS1v15</span><span class="op" id="8539497">(</span><span class="ident" id="8539498">t</span>&nbsp;<span class="op" id="8539500">*</span><span class="ident" id="8539501">testing</span><span class="op" id="8539508">.</span><span class="ident" id="8539509">T</span><span class="op" id="8539510">)</span>&nbsp;<span class="op" id="8539512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539515">random</span>&nbsp;<span class="op" id="8539522">:=</span>&nbsp;<span class="ident" id="8539525">rand</span><span class="op" id="8539529">.</span><span class="ident" id="8539530">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539538">k</span>&nbsp;<span class="op" id="8539540">:=</span>&nbsp;<span class="op" id="8539543">(</span><span class="ident" id="8539544">rsaPrivateKey</span><span class="op" id="8539557">.</span><span class="ident" id="8539558">N</span><span class="op" id="8539559">.</span><span class="ident" id="8539560">BitLen</span><span class="op" id="8539566">(</span><span class="op" id="8539567">)</span>&nbsp;<span class="op" id="8539569">+</span>&nbsp;<span class="num" id="8539571">7</span><span class="op" id="8539572">)</span>&nbsp;<span class="op" id="8539574">/</span>&nbsp;<span class="num" id="8539576">8</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539580">tryEncryptDecrypt</span>&nbsp;<span class="op" id="8539598">:=</span>&nbsp;<span class="keyword" id="8539601">func</span><span class="op" id="8539605">(</span><span class="ident" id="8539606">in</span>&nbsp;<span class="op" id="8539609">[</span><span class="op" id="8539610">]</span><span class="builtintype" id="8539611">byte</span><span class="op" id="8539615">,</span>&nbsp;<span class="ident" id="8539617">blind</span>&nbsp;<span class="builtintype" id="8539623">bool</span><span class="op" id="8539627">)</span>&nbsp;<span class="builtintype" id="8539629">bool</span>&nbsp;<span class="op" id="8539634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539638">if</span>&nbsp;<span class="builtinfunc" id="8539641">len</span><span class="op" id="8539644">(</span><span class="ident" id="8539645">in</span><span class="op" id="8539647">)</span>&nbsp;<span class="op" id="8539649">&gt;</span>&nbsp;<span class="ident" id="8539651">k</span><span class="op" id="8539652">-</span><span class="num" id="8539653">11</span>&nbsp;<span class="op" id="8539656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539661">in</span>&nbsp;<span class="op" id="8539664">=</span>&nbsp;<span class="ident" id="8539666">in</span><span class="op" id="8539668">[</span><span class="num" id="8539669">0</span>&nbsp;<span class="op" id="8539671">:</span>&nbsp;<span class="ident" id="8539673">k</span><span class="op" id="8539674">-</span><span class="num" id="8539675">11</span><span class="op" id="8539677">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8539681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539686">ciphertext</span><span class="op" id="8539696">,</span>&nbsp;<span class="ident" id="8539698">err</span>&nbsp;<span class="op" id="8539702">:=</span>&nbsp;<span class="ident" id="8539705">EncryptPKCS1v15</span><span class="op" id="8539720">(</span><span class="ident" id="8539721">random</span><span class="op" id="8539727">,</span>&nbsp;<span class="op" id="8539729">&amp;</span><span class="ident" id="8539730">rsaPrivateKey</span><span class="op" id="8539743">.</span><span class="ident" id="8539744">PublicKey</span><span class="op" id="8539753">,</span>&nbsp;<span class="ident" id="8539755">in</span><span class="op" id="8539757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539761">if</span>&nbsp;<span class="ident" id="8539764">err</span>&nbsp;<span class="op" id="8539768">!=</span>&nbsp;<span class="ident" id="8539771">nil</span>&nbsp;<span class="op" id="8539775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539780">t</span><span class="op" id="8539781">.</span><span class="ident" id="8539782">Errorf</span><span class="op" id="8539788">(</span><span class="string" id="8539789">&#34;error&nbsp;encrypting:&nbsp;%s&#34;</span><span class="op" id="8539811">,</span>&nbsp;<span class="ident" id="8539813">err</span><span class="op" id="8539816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539821">return</span>&nbsp;<span class="builtintype" id="8539828">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8539836">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539841">var</span>&nbsp;<span class="ident" id="8539845">rand</span>&nbsp;<span class="ident" id="8539850">io</span><span class="op" id="8539852">.</span><span class="ident" id="8539853">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539862">if</span>&nbsp;<span class="op" id="8539865">!</span><span class="ident" id="8539866">blind</span>&nbsp;<span class="op" id="8539872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539877">rand</span>&nbsp;<span class="op" id="8539882">=</span>&nbsp;<span class="ident" id="8539884">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8539890">}</span>&nbsp;<span class="keyword" id="8539892">else</span>&nbsp;<span class="op" id="8539897">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539902">rand</span>&nbsp;<span class="op" id="8539907">=</span>&nbsp;<span class="ident" id="8539909">random</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8539918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8539922">plaintext</span><span class="op" id="8539931">,</span>&nbsp;<span class="ident" id="8539933">err</span>&nbsp;<span class="op" id="8539937">:=</span>&nbsp;<span class="ident" id="8539940">DecryptPKCS1v15</span><span class="op" id="8539955">(</span><span class="ident" id="8539956">rand</span><span class="op" id="8539960">,</span>&nbsp;<span class="ident" id="8539962">rsaPrivateKey</span><span class="op" id="8539975">,</span>&nbsp;<span class="ident" id="8539977">ciphertext</span><span class="op" id="8539987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8539991">if</span>&nbsp;<span class="ident" id="8539994">err</span>&nbsp;<span class="op" id="8539998">!=</span>&nbsp;<span class="ident" id="8540001">nil</span>&nbsp;<span class="op" id="8540005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540010">t</span><span class="op" id="8540011">.</span><span class="ident" id="8540012">Errorf</span><span class="op" id="8540018">(</span><span class="string" id="8540019">&#34;error&nbsp;decrypting:&nbsp;%s&#34;</span><span class="op" id="8540041">,</span>&nbsp;<span class="ident" id="8540043">err</span><span class="op" id="8540046">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8540051">return</span>&nbsp;<span class="builtintype" id="8540058">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8540071">if</span>&nbsp;<span class="op" id="8540074">!</span><span class="ident" id="8540075">bytes</span><span class="op" id="8540080">.</span><span class="ident" id="8540081">Equal</span><span class="op" id="8540086">(</span><span class="ident" id="8540087">plaintext</span><span class="op" id="8540096">,</span>&nbsp;<span class="ident" id="8540098">in</span><span class="op" id="8540100">)</span>&nbsp;<span class="op" id="8540102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540107">t</span><span class="op" id="8540108">.</span><span class="ident" id="8540109">Errorf</span><span class="op" id="8540115">(</span><span class="string" id="8540116">&#34;output&nbsp;mismatch:&nbsp;%#v&nbsp;%#v&#34;</span><span class="op" id="8540142">,</span>&nbsp;<span class="ident" id="8540144">plaintext</span><span class="op" id="8540153">,</span>&nbsp;<span class="ident" id="8540155">in</span><span class="op" id="8540157">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8540162">return</span>&nbsp;<span class="builtintype" id="8540169">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8540181">return</span>&nbsp;<span class="builtintype" id="8540188">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540198">config</span>&nbsp;<span class="op" id="8540205">:=</span>&nbsp;<span class="builtinfunc" id="8540208">new</span><span class="op" id="8540211">(</span><span class="ident" id="8540212">quick</span><span class="op" id="8540217">.</span><span class="ident" id="8540218">Config</span><span class="op" id="8540224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8540227">if</span>&nbsp;<span class="ident" id="8540230">testing</span><span class="op" id="8540237">.</span><span class="ident" id="8540238">Short</span><span class="op" id="8540243">(</span><span class="op" id="8540244">)</span>&nbsp;<span class="op" id="8540246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540250">config</span><span class="op" id="8540256">.</span><span class="ident" id="8540257">MaxCount</span>&nbsp;<span class="op" id="8540266">=</span>&nbsp;<span class="num" id="8540268">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8540275">quick</span><span class="op" id="8540280">.</span><span class="ident" id="8540281">Check</span><span class="op" id="8540286">(</span><span class="ident" id="8540287">tryEncryptDecrypt</span><span class="op" id="8540304">,</span>&nbsp;<span class="ident" id="8540306">config</span><span class="op" id="8540312">)</span><br>
<span class="lineno">105</span><span class="op" id="8540314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8540317">//&nbsp;These&nbsp;test&nbsp;vectors&nbsp;were&nbsp;generated&nbsp;with&nbsp;`openssl&nbsp;rsautl&nbsp;-pkcs&nbsp;-encrypt`</span><br>
<span class="lineno"></span><span class="keyword" id="8540391">var</span>&nbsp;<span class="ident" id="8540395">decryptPKCS1v15SessionKeyTests</span>&nbsp;<span class="op" id="8540426">=</span>&nbsp;<span class="op" id="8540428">[</span><span class="op" id="8540429">]</span><span class="ident" id="8540430">DecryptPKCS1v15Test</span><span class="op" id="8540449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540452">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8540456">&#34;e6ukkae6Gykq0fKzYwULpZehX+UPXYzMoB5mHQUDEiclRbOTqas4Y0E6nwns1BBpdvEJcilhl5zsox/6DtGsYg==&#34;</span><span class="op" id="8540546">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8540550">&#34;1234&#34;</span><span class="op" id="8540556">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540559">}</span><span class="op" id="8540560">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8540567">&#34;Dtis4uk/q/LQGGqGk97P59K03hkCIVFMEFZRgVWOAAhxgYpCRG0MX2adptt92l67IqMki6iVQyyt0TtX3IdtEw==&#34;</span><span class="op" id="8540657">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8540661">&#34;FAIL&#34;</span><span class="op" id="8540667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540670">}</span><span class="op" id="8540671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8540678">&#34;LIyFyCYCptPxrvTxpol8F3M7ZivlMsf53zs0vHRAv+rDIh2YsHS69ePMoPMe3TkOMZ3NupiL3takPxIs1sK+dw==&#34;</span><span class="op" id="8540768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8540772">&#34;abcd&#34;</span><span class="op" id="8540778">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540781">}</span><span class="op" id="8540782">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8540789">&#34;bafnobel46bKy76JzqU/RIVOH0uAYvzUtauKmIidKgM0sMlvobYVAVQPeUQ/oTGjbIZ1v/6Gyi5AO4DtHruGdw==&#34;</span><span class="op" id="8540879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8540883">&#34;FAIL&#34;</span><span class="op" id="8540889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8540892">}</span><span class="op" id="8540893">,</span><br>
<span class="lineno">125</span><span class="op" id="8540895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8540898">func</span>&nbsp;<span class="ident" id="8540903">TestEncryptPKCS1v15SessionKey</span><span class="op" id="8540932">(</span><span class="ident" id="8540933">t</span>&nbsp;<span class="op" id="8540935">*</span><span class="ident" id="8540936">testing</span><span class="op" id="8540943">.</span><span class="ident" id="8540944">T</span><span class="op" id="8540945">)</span>&nbsp;<span class="op" id="8540947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8540950">for</span>&nbsp;<span class="ident" id="8540954">i</span><span class="op" id="8540955">,</span>&nbsp;<span class="ident" id="8540957">test</span>&nbsp;<span class="op" id="8540962">:=</span>&nbsp;<span class="keyword" id="8540965">range</span>&nbsp;<span class="ident" id="8540971">decryptPKCS1v15SessionKeyTests</span>&nbsp;<span class="op" id="8541002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541006">key</span>&nbsp;<span class="op" id="8541010">:=</span>&nbsp;<span class="op" id="8541013">[</span><span class="op" id="8541014">]</span><span class="builtintype" id="8541015">byte</span><span class="op" id="8541019">(</span><span class="string" id="8541020">&#34;FAIL&#34;</span><span class="op" id="8541026">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541030">err</span>&nbsp;<span class="op" id="8541034">:=</span>&nbsp;<span class="ident" id="8541037">DecryptPKCS1v15SessionKey</span><span class="op" id="8541062">(</span><span class="ident" id="8541063">nil</span><span class="op" id="8541066">,</span>&nbsp;<span class="ident" id="8541068">rsaPrivateKey</span><span class="op" id="8541081">,</span>&nbsp;<span class="ident" id="8541083">decodeBase64</span><span class="op" id="8541095">(</span><span class="ident" id="8541096">test</span><span class="op" id="8541100">.</span><span class="ident" id="8541101">in</span><span class="op" id="8541103">)</span><span class="op" id="8541104">,</span>&nbsp;<span class="ident" id="8541106">key</span><span class="op" id="8541109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8541113">if</span>&nbsp;<span class="ident" id="8541116">err</span>&nbsp;<span class="op" id="8541120">!=</span>&nbsp;<span class="ident" id="8541123">nil</span>&nbsp;<span class="op" id="8541127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541132">t</span><span class="op" id="8541133">.</span><span class="ident" id="8541134">Errorf</span><span class="op" id="8541140">(</span><span class="string" id="8541141">&#34;#%d&nbsp;error&nbsp;decrypting&#34;</span><span class="op" id="8541163">,</span>&nbsp;<span class="ident" id="8541165">i</span><span class="op" id="8541166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8541170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541174">want</span>&nbsp;<span class="op" id="8541179">:=</span>&nbsp;<span class="op" id="8541182">[</span><span class="op" id="8541183">]</span><span class="builtintype" id="8541184">byte</span><span class="op" id="8541188">(</span><span class="ident" id="8541189">test</span><span class="op" id="8541193">.</span><span class="ident" id="8541194">out</span><span class="op" id="8541197">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8541201">if</span>&nbsp;<span class="op" id="8541204">!</span><span class="ident" id="8541205">bytes</span><span class="op" id="8541210">.</span><span class="ident" id="8541211">Equal</span><span class="op" id="8541216">(</span><span class="ident" id="8541217">key</span><span class="op" id="8541220">,</span>&nbsp;<span class="ident" id="8541222">want</span><span class="op" id="8541226">)</span>&nbsp;<span class="op" id="8541228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541233">t</span><span class="op" id="8541234">.</span><span class="ident" id="8541235">Errorf</span><span class="op" id="8541241">(</span><span class="string" id="8541242">&#34;#%d&nbsp;got:%#v&nbsp;want:%#v&#34;</span><span class="op" id="8541264">,</span>&nbsp;<span class="ident" id="8541266">i</span><span class="op" id="8541267">,</span>&nbsp;<span class="ident" id="8541269">key</span><span class="op" id="8541272">,</span>&nbsp;<span class="ident" id="8541274">want</span><span class="op" id="8541278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8541282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8541285">}</span><br>
<span class="lineno"></span><span class="op" id="8541287">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="8541290">func</span>&nbsp;<span class="ident" id="8541295">TestNonZeroRandomBytes</span><span class="op" id="8541317">(</span><span class="ident" id="8541318">t</span>&nbsp;<span class="op" id="8541320">*</span><span class="ident" id="8541321">testing</span><span class="op" id="8541328">.</span><span class="ident" id="8541329">T</span><span class="op" id="8541330">)</span>&nbsp;<span class="op" id="8541332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541335">random</span>&nbsp;<span class="op" id="8541342">:=</span>&nbsp;<span class="ident" id="8541345">rand</span><span class="op" id="8541349">.</span><span class="ident" id="8541350">Reader</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541359">b</span>&nbsp;<span class="op" id="8541361">:=</span>&nbsp;<span class="builtinfunc" id="8541364">make</span><span class="op" id="8541368">(</span><span class="op" id="8541369">[</span><span class="op" id="8541370">]</span><span class="builtintype" id="8541371">byte</span><span class="op" id="8541375">,</span>&nbsp;<span class="num" id="8541377">512</span><span class="op" id="8541380">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541383">err</span>&nbsp;<span class="op" id="8541387">:=</span>&nbsp;<span class="ident" id="8541390">nonZeroRandomBytes</span><span class="op" id="8541408">(</span><span class="ident" id="8541409">b</span><span class="op" id="8541410">,</span>&nbsp;<span class="ident" id="8541412">random</span><span class="op" id="8541418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8541421">if</span>&nbsp;<span class="ident" id="8541424">err</span>&nbsp;<span class="op" id="8541428">!=</span>&nbsp;<span class="ident" id="8541431">nil</span>&nbsp;<span class="op" id="8541435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541439">t</span><span class="op" id="8541440">.</span><span class="ident" id="8541441">Errorf</span><span class="op" id="8541447">(</span><span class="string" id="8541448">&#34;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8541468">,</span>&nbsp;<span class="ident" id="8541470">err</span><span class="op" id="8541473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8541476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8541479">for</span>&nbsp;<span class="ident" id="8541483">_</span><span class="op" id="8541484">,</span>&nbsp;<span class="ident" id="8541486">b</span>&nbsp;<span class="op" id="8541488">:=</span>&nbsp;<span class="keyword" id="8541491">range</span>&nbsp;<span class="ident" id="8541497">b</span>&nbsp;<span class="op" id="8541499">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8541503">if</span>&nbsp;<span class="ident" id="8541506">b</span>&nbsp;<span class="op" id="8541508">==</span>&nbsp;<span class="num" id="8541511">0</span>&nbsp;<span class="op" id="8541513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541518">t</span><span class="op" id="8541519">.</span><span class="ident" id="8541520">Errorf</span><span class="op" id="8541526">(</span><span class="string" id="8541527">&#34;Zero&nbsp;octet&nbsp;found&#34;</span><span class="op" id="8541545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8541550">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8541559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8541562">}</span><br>
<span class="lineno">155</span><span class="op" id="8541564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8541567">type</span>&nbsp;<span class="ident" id="8541572">signPKCS1v15Test</span>&nbsp;<span class="keyword" id="8541589">struct</span>&nbsp;<span class="op" id="8541596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541599">in</span><span class="op" id="8541601">,</span>&nbsp;<span class="ident" id="8541603">out</span>&nbsp;<span class="builtintype" id="8541607">string</span><br>
<span class="lineno"></span><span class="op" id="8541614">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="8541617">//&nbsp;These&nbsp;vectors&nbsp;have&nbsp;been&nbsp;tested&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="8541656">//&nbsp;&nbsp;&nbsp;`openssl&nbsp;rsautl&nbsp;-verify&nbsp;-inkey&nbsp;pk&nbsp;-in&nbsp;signature&nbsp;|&nbsp;hexdump&nbsp;-C`</span><br>
<span class="lineno"></span><span class="keyword" id="8541723">var</span>&nbsp;<span class="ident" id="8541727">signPKCS1v15Tests</span>&nbsp;<span class="op" id="8541745">=</span>&nbsp;<span class="op" id="8541747">[</span><span class="op" id="8541748">]</span><span class="ident" id="8541749">signPKCS1v15Test</span><span class="op" id="8541765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8541768">{</span><span class="string" id="8541769">&#34;Test.\n&#34;</span><span class="op" id="8541778">,</span>&nbsp;<span class="string" id="8541780">&#34;a4f3fa6ea93bcdd0c57be020c1193ecbfd6f200a3d95c409769b029578fa0e336ad9a347600e40d3ae823b8c7e6bad88cc07c1d54c3a1523cbbb6d58efc362ae&#34;</span><span class="op" id="8541910">}</span><span class="op" id="8541911">,</span><br>
<span class="lineno">165</span><span class="op" id="8541913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8541916">func</span>&nbsp;<span class="ident" id="8541921">TestSignPKCS1v15</span><span class="op" id="8541937">(</span><span class="ident" id="8541938">t</span>&nbsp;<span class="op" id="8541940">*</span><span class="ident" id="8541941">testing</span><span class="op" id="8541948">.</span><span class="ident" id="8541949">T</span><span class="op" id="8541950">)</span>&nbsp;<span class="op" id="8541952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8541955">for</span>&nbsp;<span class="ident" id="8541959">i</span><span class="op" id="8541960">,</span>&nbsp;<span class="ident" id="8541962">test</span>&nbsp;<span class="op" id="8541967">:=</span>&nbsp;<span class="keyword" id="8541970">range</span>&nbsp;<span class="ident" id="8541976">signPKCS1v15Tests</span>&nbsp;<span class="op" id="8541994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8541998">h</span>&nbsp;<span class="op" id="8542000">:=</span>&nbsp;<span class="ident" id="8542003">sha1</span><span class="op" id="8542007">.</span><span class="ident" id="8542008">New</span><span class="op" id="8542011">(</span><span class="op" id="8542012">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542016">h</span><span class="op" id="8542017">.</span><span class="ident" id="8542018">Write</span><span class="op" id="8542023">(</span><span class="op" id="8542024">[</span><span class="op" id="8542025">]</span><span class="builtintype" id="8542026">byte</span><span class="op" id="8542030">(</span><span class="ident" id="8542031">test</span><span class="op" id="8542035">.</span><span class="ident" id="8542036">in</span><span class="op" id="8542038">)</span><span class="op" id="8542039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542043">digest</span>&nbsp;<span class="op" id="8542050">:=</span>&nbsp;<span class="ident" id="8542053">h</span><span class="op" id="8542054">.</span><span class="ident" id="8542055">Sum</span><span class="op" id="8542058">(</span><span class="ident" id="8542059">nil</span><span class="op" id="8542062">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542067">s</span><span class="op" id="8542068">,</span>&nbsp;<span class="ident" id="8542070">err</span>&nbsp;<span class="op" id="8542074">:=</span>&nbsp;<span class="ident" id="8542077">SignPKCS1v15</span><span class="op" id="8542089">(</span><span class="ident" id="8542090">nil</span><span class="op" id="8542093">,</span>&nbsp;<span class="ident" id="8542095">rsaPrivateKey</span><span class="op" id="8542108">,</span>&nbsp;<span class="ident" id="8542110">crypto</span><span class="op" id="8542116">.</span><span class="ident" id="8542117">SHA1</span><span class="op" id="8542121">,</span>&nbsp;<span class="ident" id="8542123">digest</span><span class="op" id="8542129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8542133">if</span>&nbsp;<span class="ident" id="8542136">err</span>&nbsp;<span class="op" id="8542140">!=</span>&nbsp;<span class="ident" id="8542143">nil</span>&nbsp;<span class="op" id="8542147">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542152">t</span><span class="op" id="8542153">.</span><span class="ident" id="8542154">Errorf</span><span class="op" id="8542160">(</span><span class="string" id="8542161">&#34;#%d&nbsp;%s&#34;</span><span class="op" id="8542169">,</span>&nbsp;<span class="ident" id="8542171">i</span><span class="op" id="8542172">,</span>&nbsp;<span class="ident" id="8542174">err</span><span class="op" id="8542177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8542181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542186">expected</span><span class="op" id="8542194">,</span>&nbsp;<span class="ident" id="8542196">_</span>&nbsp;<span class="op" id="8542198">:=</span>&nbsp;<span class="ident" id="8542201">hex</span><span class="op" id="8542204">.</span><span class="ident" id="8542205">DecodeString</span><span class="op" id="8542217">(</span><span class="ident" id="8542218">test</span><span class="op" id="8542222">.</span><span class="ident" id="8542223">out</span><span class="op" id="8542226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8542230">if</span>&nbsp;<span class="op" id="8542233">!</span><span class="ident" id="8542234">bytes</span><span class="op" id="8542239">.</span><span class="ident" id="8542240">Equal</span><span class="op" id="8542245">(</span><span class="ident" id="8542246">s</span><span class="op" id="8542247">,</span>&nbsp;<span class="ident" id="8542249">expected</span><span class="op" id="8542257">)</span>&nbsp;<span class="op" id="8542259">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542264">t</span><span class="op" id="8542265">.</span><span class="ident" id="8542266">Errorf</span><span class="op" id="8542272">(</span><span class="string" id="8542273">&#34;#%d&nbsp;got:&nbsp;%x&nbsp;want:&nbsp;%x&#34;</span><span class="op" id="8542295">,</span>&nbsp;<span class="ident" id="8542297">i</span><span class="op" id="8542298">,</span>&nbsp;<span class="ident" id="8542300">s</span><span class="op" id="8542301">,</span>&nbsp;<span class="ident" id="8542303">expected</span><span class="op" id="8542311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8542315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8542318">}</span><br>
<span class="lineno"></span><span class="op" id="8542320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="8542323">func</span>&nbsp;<span class="ident" id="8542328">TestVerifyPKCS1v15</span><span class="op" id="8542346">(</span><span class="ident" id="8542347">t</span>&nbsp;<span class="op" id="8542349">*</span><span class="ident" id="8542350">testing</span><span class="op" id="8542357">.</span><span class="ident" id="8542358">T</span><span class="op" id="8542359">)</span>&nbsp;<span class="op" id="8542361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8542364">for</span>&nbsp;<span class="ident" id="8542368">i</span><span class="op" id="8542369">,</span>&nbsp;<span class="ident" id="8542371">test</span>&nbsp;<span class="op" id="8542376">:=</span>&nbsp;<span class="keyword" id="8542379">range</span>&nbsp;<span class="ident" id="8542385">signPKCS1v15Tests</span>&nbsp;<span class="op" id="8542403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542407">h</span>&nbsp;<span class="op" id="8542409">:=</span>&nbsp;<span class="ident" id="8542412">sha1</span><span class="op" id="8542416">.</span><span class="ident" id="8542417">New</span><span class="op" id="8542420">(</span><span class="op" id="8542421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542425">h</span><span class="op" id="8542426">.</span><span class="ident" id="8542427">Write</span><span class="op" id="8542432">(</span><span class="op" id="8542433">[</span><span class="op" id="8542434">]</span><span class="builtintype" id="8542435">byte</span><span class="op" id="8542439">(</span><span class="ident" id="8542440">test</span><span class="op" id="8542444">.</span><span class="ident" id="8542445">in</span><span class="op" id="8542447">)</span><span class="op" id="8542448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542452">digest</span>&nbsp;<span class="op" id="8542459">:=</span>&nbsp;<span class="ident" id="8542462">h</span><span class="op" id="8542463">.</span><span class="ident" id="8542464">Sum</span><span class="op" id="8542467">(</span><span class="ident" id="8542468">nil</span><span class="op" id="8542471">)</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542476">sig</span><span class="op" id="8542479">,</span>&nbsp;<span class="ident" id="8542481">_</span>&nbsp;<span class="op" id="8542483">:=</span>&nbsp;<span class="ident" id="8542486">hex</span><span class="op" id="8542489">.</span><span class="ident" id="8542490">DecodeString</span><span class="op" id="8542502">(</span><span class="ident" id="8542503">test</span><span class="op" id="8542507">.</span><span class="ident" id="8542508">out</span><span class="op" id="8542511">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542516">err</span>&nbsp;<span class="op" id="8542520">:=</span>&nbsp;<span class="ident" id="8542523">VerifyPKCS1v15</span><span class="op" id="8542537">(</span><span class="op" id="8542538">&amp;</span><span class="ident" id="8542539">rsaPrivateKey</span><span class="op" id="8542552">.</span><span class="ident" id="8542553">PublicKey</span><span class="op" id="8542562">,</span>&nbsp;<span class="ident" id="8542564">crypto</span><span class="op" id="8542570">.</span><span class="ident" id="8542571">SHA1</span><span class="op" id="8542575">,</span>&nbsp;<span class="ident" id="8542577">digest</span><span class="op" id="8542583">,</span>&nbsp;<span class="ident" id="8542585">sig</span><span class="op" id="8542588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8542592">if</span>&nbsp;<span class="ident" id="8542595">err</span>&nbsp;<span class="op" id="8542599">!=</span>&nbsp;<span class="ident" id="8542602">nil</span>&nbsp;<span class="op" id="8542606">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542611">t</span><span class="op" id="8542612">.</span><span class="ident" id="8542613">Errorf</span><span class="op" id="8542619">(</span><span class="string" id="8542620">&#34;#%d&nbsp;%s&#34;</span><span class="op" id="8542628">,</span>&nbsp;<span class="ident" id="8542630">i</span><span class="op" id="8542631">,</span>&nbsp;<span class="ident" id="8542633">err</span><span class="op" id="8542636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8542640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8542643">}</span><br>
<span class="lineno"></span><span class="op" id="8542645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="keyword" id="8542648">func</span>&nbsp;<span class="ident" id="8542653">TestOverlongMessagePKCS1v15</span><span class="op" id="8542680">(</span><span class="ident" id="8542681">t</span>&nbsp;<span class="op" id="8542683">*</span><span class="ident" id="8542684">testing</span><span class="op" id="8542691">.</span><span class="ident" id="8542692">T</span><span class="op" id="8542693">)</span>&nbsp;<span class="op" id="8542695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542698">ciphertext</span>&nbsp;<span class="op" id="8542709">:=</span>&nbsp;<span class="ident" id="8542712">decodeBase64</span><span class="op" id="8542724">(</span><span class="string" id="8542725">&#34;fjOVdirUzFoLlukv80dBllMLjXythIf22feqPrNo0YoIjzyzyoMFiLjAc/Y4krkeZ11XFThIrEvw\nkRiZcCq5ng==&#34;</span><span class="op" id="8542817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542820">_</span><span class="op" id="8542821">,</span>&nbsp;<span class="ident" id="8542823">err</span>&nbsp;<span class="op" id="8542827">:=</span>&nbsp;<span class="ident" id="8542830">DecryptPKCS1v15</span><span class="op" id="8542845">(</span><span class="ident" id="8542846">nil</span><span class="op" id="8542849">,</span>&nbsp;<span class="ident" id="8542851">rsaPrivateKey</span><span class="op" id="8542864">,</span>&nbsp;<span class="ident" id="8542866">ciphertext</span><span class="op" id="8542876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8542879">if</span>&nbsp;<span class="ident" id="8542882">err</span>&nbsp;<span class="op" id="8542886">==</span>&nbsp;<span class="ident" id="8542889">nil</span>&nbsp;<span class="op" id="8542893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8542897">t</span><span class="op" id="8542898">.</span><span class="ident" id="8542899">Error</span><span class="op" id="8542904">(</span><span class="string" id="8542905">&#34;RSA&nbsp;decrypted&nbsp;a&nbsp;message&nbsp;that&nbsp;was&nbsp;too&nbsp;long.&#34;</span><span class="op" id="8542949">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8542952">}</span><br>
<span class="lineno"></span><span class="op" id="8542954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8542957">func</span>&nbsp;<span class="ident" id="8542962">TestUnpaddedSignature</span><span class="op" id="8542983">(</span><span class="ident" id="8542984">t</span>&nbsp;<span class="op" id="8542986">*</span><span class="ident" id="8542987">testing</span><span class="op" id="8542994">.</span><span class="ident" id="8542995">T</span><span class="op" id="8542996">)</span>&nbsp;<span class="op" id="8542998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543001">msg</span>&nbsp;<span class="op" id="8543005">:=</span>&nbsp;<span class="op" id="8543008">[</span><span class="op" id="8543009">]</span><span class="builtintype" id="8543010">byte</span><span class="op" id="8543014">(</span><span class="string" id="8543015">&#34;Thu&nbsp;Dec&nbsp;19&nbsp;18:06:16&nbsp;EST&nbsp;2013\n&#34;</span><span class="op" id="8543047">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8543050">//&nbsp;This&nbsp;base64&nbsp;value&nbsp;was&nbsp;generated&nbsp;with:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8543092">//&nbsp;%&nbsp;echo&nbsp;Thu&nbsp;Dec&nbsp;19&nbsp;18:06:16&nbsp;EST&nbsp;2013&nbsp;&gt;&nbsp;/tmp/msg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8543143">//&nbsp;%&nbsp;openssl&nbsp;rsautl&nbsp;-sign&nbsp;-inkey&nbsp;key&nbsp;-out&nbsp;/tmp/sig&nbsp;-in&nbsp;/tmp/msg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8543208">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8543212">//&nbsp;Where&nbsp;&#34;key&#34;&nbsp;contains&nbsp;the&nbsp;RSA&nbsp;private&nbsp;key&nbsp;given&nbsp;at&nbsp;the&nbsp;bottom&nbsp;of&nbsp;this</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8543285">//&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543295">expectedSig</span>&nbsp;<span class="op" id="8543307">:=</span>&nbsp;<span class="ident" id="8543310">decodeBase64</span><span class="op" id="8543322">(</span><span class="string" id="8543323">&#34;pX4DR8azytjdQ1rtUiC040FjkepuQut5q2ZFX1pTjBrOVKNjgsCDyiJDGZTCNoh9qpXYbhl7iEym30BWWwuiZg==&#34;</span><span class="op" id="8543413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543417">sig</span><span class="op" id="8543420">,</span>&nbsp;<span class="ident" id="8543422">err</span>&nbsp;<span class="op" id="8543426">:=</span>&nbsp;<span class="ident" id="8543429">SignPKCS1v15</span><span class="op" id="8543441">(</span><span class="ident" id="8543442">nil</span><span class="op" id="8543445">,</span>&nbsp;<span class="ident" id="8543447">rsaPrivateKey</span><span class="op" id="8543460">,</span>&nbsp;<span class="ident" id="8543462">crypto</span><span class="op" id="8543468">.</span><span class="ident" id="8543469">Hash</span><span class="op" id="8543473">(</span><span class="num" id="8543474">0</span><span class="op" id="8543475">)</span><span class="op" id="8543476">,</span>&nbsp;<span class="ident" id="8543478">msg</span><span class="op" id="8543481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8543484">if</span>&nbsp;<span class="ident" id="8543487">err</span>&nbsp;<span class="op" id="8543491">!=</span>&nbsp;<span class="ident" id="8543494">nil</span>&nbsp;<span class="op" id="8543498">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543502">t</span><span class="op" id="8543503">.</span><span class="ident" id="8543504">Fatalf</span><span class="op" id="8543510">(</span><span class="string" id="8543511">&#34;SignPKCS1v15&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8543536">,</span>&nbsp;<span class="ident" id="8543538">err</span><span class="op" id="8543541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8543544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8543547">if</span>&nbsp;<span class="op" id="8543550">!</span><span class="ident" id="8543551">bytes</span><span class="op" id="8543556">.</span><span class="ident" id="8543557">Equal</span><span class="op" id="8543562">(</span><span class="ident" id="8543563">sig</span><span class="op" id="8543566">,</span>&nbsp;<span class="ident" id="8543568">expectedSig</span><span class="op" id="8543579">)</span>&nbsp;<span class="op" id="8543581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543585">t</span><span class="op" id="8543586">.</span><span class="ident" id="8543587">Fatalf</span><span class="op" id="8543593">(</span><span class="string" id="8543594">&#34;signature&nbsp;is&nbsp;not&nbsp;expected&nbsp;value:&nbsp;got&nbsp;%x,&nbsp;want&nbsp;%x&#34;</span><span class="op" id="8543644">,</span>&nbsp;<span class="ident" id="8543646">sig</span><span class="op" id="8543649">,</span>&nbsp;<span class="ident" id="8543651">expectedSig</span><span class="op" id="8543662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8543665">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8543668">if</span>&nbsp;<span class="ident" id="8543671">err</span>&nbsp;<span class="op" id="8543675">:=</span>&nbsp;<span class="ident" id="8543678">VerifyPKCS1v15</span><span class="op" id="8543692">(</span><span class="op" id="8543693">&amp;</span><span class="ident" id="8543694">rsaPrivateKey</span><span class="op" id="8543707">.</span><span class="ident" id="8543708">PublicKey</span><span class="op" id="8543717">,</span>&nbsp;<span class="ident" id="8543719">crypto</span><span class="op" id="8543725">.</span><span class="ident" id="8543726">Hash</span><span class="op" id="8543730">(</span><span class="num" id="8543731">0</span><span class="op" id="8543732">)</span><span class="op" id="8543733">,</span>&nbsp;<span class="ident" id="8543735">msg</span><span class="op" id="8543738">,</span>&nbsp;<span class="ident" id="8543740">sig</span><span class="op" id="8543743">)</span><span class="op" id="8543744">;</span>&nbsp;<span class="ident" id="8543746">err</span>&nbsp;<span class="op" id="8543750">!=</span>&nbsp;<span class="ident" id="8543753">nil</span>&nbsp;<span class="op" id="8543757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543761">t</span><span class="op" id="8543762">.</span><span class="ident" id="8543763">Fatalf</span><span class="op" id="8543769">(</span><span class="string" id="8543770">&#34;signature&nbsp;failed&nbsp;to&nbsp;verify:&nbsp;%s&#34;</span><span class="op" id="8543802">,</span>&nbsp;<span class="ident" id="8543804">err</span><span class="op" id="8543807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8543810">}</span><br>
<span class="lineno"></span><span class="op" id="8543812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="8543815">func</span>&nbsp;<span class="ident" id="8543820">TestShortSessionKey</span><span class="op" id="8543839">(</span><span class="ident" id="8543840">t</span>&nbsp;<span class="op" id="8543842">*</span><span class="ident" id="8543843">testing</span><span class="op" id="8543850">.</span><span class="ident" id="8543851">T</span><span class="op" id="8543852">)</span>&nbsp;<span class="op" id="8543854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8543857">//&nbsp;This&nbsp;tests&nbsp;that&nbsp;attempting&nbsp;to&nbsp;decrypt&nbsp;a&nbsp;session&nbsp;key&nbsp;where&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8543923">//&nbsp;ciphertext&nbsp;is&nbsp;too&nbsp;small&nbsp;doesn&#39;t&nbsp;run&nbsp;outside&nbsp;the&nbsp;array&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8543989">ciphertext</span><span class="op" id="8543999">,</span>&nbsp;<span class="ident" id="8544001">err</span>&nbsp;<span class="op" id="8544005">:=</span>&nbsp;<span class="ident" id="8544008">EncryptPKCS1v15</span><span class="op" id="8544023">(</span><span class="ident" id="8544024">rand</span><span class="op" id="8544028">.</span><span class="ident" id="8544029">Reader</span><span class="op" id="8544035">,</span>&nbsp;<span class="op" id="8544037">&amp;</span><span class="ident" id="8544038">rsaPrivateKey</span><span class="op" id="8544051">.</span><span class="ident" id="8544052">PublicKey</span><span class="op" id="8544061">,</span>&nbsp;<span class="op" id="8544063">[</span><span class="op" id="8544064">]</span><span class="builtintype" id="8544065">byte</span><span class="op" id="8544069">{</span><span class="num" id="8544070">1</span><span class="op" id="8544071">}</span><span class="op" id="8544072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8544075">if</span>&nbsp;<span class="ident" id="8544078">err</span>&nbsp;<span class="op" id="8544082">!=</span>&nbsp;<span class="ident" id="8544085">nil</span>&nbsp;<span class="op" id="8544089">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8544093">t</span><span class="op" id="8544094">.</span><span class="ident" id="8544095">Fatalf</span><span class="op" id="8544101">(</span><span class="string" id="8544102">&#34;Failed&nbsp;to&nbsp;encrypt&nbsp;short&nbsp;message:&nbsp;%s&#34;</span><span class="op" id="8544139">,</span>&nbsp;<span class="ident" id="8544141">err</span><span class="op" id="8544144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8544151">var</span>&nbsp;<span class="ident" id="8544155">key</span>&nbsp;<span class="op" id="8544159">[</span><span class="num" id="8544160">32</span><span class="op" id="8544162">]</span><span class="builtintype" id="8544163">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8544169">if</span>&nbsp;<span class="ident" id="8544172">err</span>&nbsp;<span class="op" id="8544176">:=</span>&nbsp;<span class="ident" id="8544179">DecryptPKCS1v15SessionKey</span><span class="op" id="8544204">(</span><span class="ident" id="8544205">nil</span><span class="op" id="8544208">,</span>&nbsp;<span class="ident" id="8544210">rsaPrivateKey</span><span class="op" id="8544223">,</span>&nbsp;<span class="ident" id="8544225">ciphertext</span><span class="op" id="8544235">,</span>&nbsp;<span class="ident" id="8544237">key</span><span class="op" id="8544240">[</span><span class="op" id="8544241">:</span><span class="op" id="8544242">]</span><span class="op" id="8544243">)</span><span class="op" id="8544244">;</span>&nbsp;<span class="ident" id="8544246">err</span>&nbsp;<span class="op" id="8544250">!=</span>&nbsp;<span class="ident" id="8544253">nil</span>&nbsp;<span class="op" id="8544257">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8544261">t</span><span class="op" id="8544262">.</span><span class="ident" id="8544263">Fatalf</span><span class="op" id="8544269">(</span><span class="string" id="8544270">&#34;Failed&nbsp;to&nbsp;decrypt&nbsp;short&nbsp;message:&nbsp;%s&#34;</span><span class="op" id="8544307">,</span>&nbsp;<span class="ident" id="8544309">err</span><span class="op" id="8544312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8544319">for</span>&nbsp;<span class="ident" id="8544323">_</span><span class="op" id="8544324">,</span>&nbsp;<span class="ident" id="8544326">v</span>&nbsp;<span class="op" id="8544328">:=</span>&nbsp;<span class="keyword" id="8544331">range</span>&nbsp;<span class="ident" id="8544337">key</span>&nbsp;<span class="op" id="8544341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8544345">if</span>&nbsp;<span class="ident" id="8544348">v</span>&nbsp;<span class="op" id="8544350">!=</span>&nbsp;<span class="num" id="8544353">0</span>&nbsp;<span class="op" id="8544355">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8544360">t</span><span class="op" id="8544361">.</span><span class="ident" id="8544362">Fatal</span><span class="op" id="8544367">(</span><span class="string" id="8544368">&#34;key&nbsp;was&nbsp;modified&nbsp;when&nbsp;ciphertext&nbsp;was&nbsp;invalid&#34;</span><span class="op" id="8544414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8544421">}</span><br>
<span class="lineno"></span><span class="op" id="8544423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="8544426">//&nbsp;In&nbsp;order&nbsp;to&nbsp;generate&nbsp;new&nbsp;test&nbsp;vectors&nbsp;you&#39;ll&nbsp;need&nbsp;the&nbsp;PEM&nbsp;form&nbsp;of&nbsp;this&nbsp;key:</span><br>
<span class="lineno"></span><span class="comment" id="8544505">//&nbsp;-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----</span><br>
<span class="lineno"></span><span class="comment" id="8544540">//&nbsp;MIIBOgIBAAJBALKZD0nEffqM1ACuak0bijtqE2QrI/KLADv7l3kK3ppMyCuLKoF0</span><br>
<span class="lineno"></span><span class="comment" id="8544608">//&nbsp;fd7Ai2KW5ToIwzFofvJcS/STa6HA5gQenRUCAwEAAQJBAIq9amn00aS0h/CrjXqu</span><br>
<span class="lineno"></span><span class="comment" id="8544676">//&nbsp;/ThglAXJmZhOMPVn4eiu7/ROixi9sex436MaVeMqSNf7Ex9a8fRNfWss7Sqd9eWu</span><br>
<span class="lineno">255</span><span class="comment" id="8544744">//&nbsp;RTUCIQDasvGASLqmjeffBNLTXV2A5g4t+kLVCpsEIZAycV5GswIhANEPLmax0ME/</span><br>
<span class="lineno"></span><span class="comment" id="8544812">//&nbsp;EO+ZJ79TJKN5yiGBRsv5yvx5UiHxajEXAiAhAol5N4EUyq6I9w1rYdhPMGpLfk7A</span><br>
<span class="lineno"></span><span class="comment" id="8544880">//&nbsp;IU2snfRJ6Nq2CQIgFrPsWRCkV+gOYcajD17rEqmuLrdIRexpg8N1DOSXoJ8CIGlS</span><br>
<span class="lineno"></span><span class="comment" id="8544948">//&nbsp;tAboUGBxTDq3ZroNism3DaMIbKPyYrAqhKov1h5V</span><br>
<span class="lineno"></span><span class="comment" id="8544992">//&nbsp;-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="8545026">var</span>&nbsp;<span class="ident" id="8545030">rsaPrivateKey</span>&nbsp;<span class="op" id="8545044">=</span>&nbsp;<span class="op" id="8545046">&amp;</span><span class="ident" id="8545047">PrivateKey</span><span class="op" id="8545057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8545060">PublicKey</span><span class="op" id="8545069">:</span>&nbsp;<span class="ident" id="8545071">PublicKey</span><span class="op" id="8545080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8545084">N</span><span class="op" id="8545085">:</span>&nbsp;<span class="ident" id="8545087">fromBase10</span><span class="op" id="8545097">(</span><span class="string" id="8545098">&#34;9353930466774385905609975137998169297361893554149986716853295022578535724979677252958524466350471210367835187480748268864277464700638583474144061408845077&#34;</span><span class="op" id="8545254">)</span><span class="op" id="8545255">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8545259">E</span><span class="op" id="8545260">:</span>&nbsp;<span class="num" id="8545262">65537</span><span class="op" id="8545267">,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545270">}</span><span class="op" id="8545271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8545274">D</span><span class="op" id="8545275">:</span>&nbsp;<span class="ident" id="8545277">fromBase10</span><span class="op" id="8545287">(</span><span class="string" id="8545288">&#34;7266398431328116344057699379749222532279343923819063639497049039389899328538543087657733766554155839834519529439851673014800261285757759040931985506583861&#34;</span><span class="op" id="8545444">)</span><span class="op" id="8545445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8545448">Primes</span><span class="op" id="8545454">:</span>&nbsp;<span class="op" id="8545456">[</span><span class="op" id="8545457">]</span><span class="op" id="8545458">*</span><span class="ident" id="8545459">big</span><span class="op" id="8545462">.</span><span class="ident" id="8545463">Int</span><span class="op" id="8545466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8545470">fromBase10</span><span class="op" id="8545480">(</span><span class="string" id="8545481">&#34;98920366548084643601728869055592650835572950932266967461790948584315647051443&#34;</span><span class="op" id="8545560">)</span><span class="op" id="8545561">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8545565">fromBase10</span><span class="op" id="8545575">(</span><span class="string" id="8545576">&#34;94560208308847015747498523884063394671606671904944666360068158221458669711639&#34;</span><span class="op" id="8545655">)</span><span class="op" id="8545656">,</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8545659">}</span><span class="op" id="8545660">,</span><br>
<span class="lineno"></span><span class="op" id="8545662">}</span>
</div>
</body>
</html>
