<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html" class="current">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3769643">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3769699">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3769753">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3769804">package</span>&nbsp;<span class="ident" id="3769812">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3769818">import</span>&nbsp;<span class="op" id="3769825">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3769828">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3769837">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3769847">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3769852">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3769855">//&nbsp;A&nbsp;Decoder&nbsp;reads&nbsp;and&nbsp;decodes&nbsp;JSON&nbsp;objects&nbsp;from&nbsp;an&nbsp;input&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="3769921">type</span>&nbsp;<span class="ident" id="3769926">Decoder</span>&nbsp;<span class="keyword" id="3769934">struct</span>&nbsp;<span class="op" id="3769941">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769944">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3769949">io</span><span class="op" id="3769951">.</span><span class="ident" id="3769952">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769960">buf</span>&nbsp;&nbsp;<span class="op" id="3769965">[</span><span class="op" id="3769966">]</span><span class="builtintype" id="3769967">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769973">d</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3769978">decodeState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769991">scan</span>&nbsp;<span class="ident" id="3769996">scanner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770005">err</span>&nbsp;&nbsp;<span class="builtintype" id="3770010">error</span><br>
<span class="lineno">20</span><span class="op" id="3770016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3770019">//&nbsp;NewDecoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;decoder&nbsp;that&nbsp;reads&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3770074">//</span><br>
<span class="lineno"></span><span class="comment" id="3770077">//&nbsp;The&nbsp;decoder&nbsp;introduces&nbsp;its&nbsp;own&nbsp;buffering&nbsp;and&nbsp;may</span><br>
<span class="lineno">25</span><span class="comment" id="3770129">//&nbsp;read&nbsp;data&nbsp;from&nbsp;r&nbsp;beyond&nbsp;the&nbsp;JSON&nbsp;values&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="3770183">func</span>&nbsp;<span class="ident" id="3770188">NewDecoder</span><span class="op" id="3770198">(</span><span class="ident" id="3770199">r</span>&nbsp;<span class="ident" id="3770201">io</span><span class="op" id="3770203">.</span><span class="ident" id="3770204">Reader</span><span class="op" id="3770210">)</span>&nbsp;<span class="op" id="3770212">*</span><span class="ident" id="3770213">Decoder</span>&nbsp;<span class="op" id="3770221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770224">return</span>&nbsp;<span class="op" id="3770231">&amp;</span><span class="ident" id="3770232">Decoder</span><span class="op" id="3770239">{</span><span class="ident" id="3770240">r</span><span class="op" id="3770241">:</span>&nbsp;<span class="ident" id="3770243">r</span><span class="op" id="3770244">}</span><br>
<span class="lineno"></span><span class="op" id="3770246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3770249">//&nbsp;UseNumber&nbsp;causes&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;unmarshal&nbsp;a&nbsp;number&nbsp;into&nbsp;an&nbsp;interface{}&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3770328">//&nbsp;Number&nbsp;instead&nbsp;of&nbsp;as&nbsp;a&nbsp;float64.</span><br>
<span class="lineno"></span><span class="keyword" id="3770363">func</span>&nbsp;<span class="op" id="3770368">(</span><span class="ident" id="3770369">dec</span>&nbsp;<span class="op" id="3770373">*</span><span class="ident" id="3770374">Decoder</span><span class="op" id="3770381">)</span>&nbsp;<span class="ident" id="3770383">UseNumber</span><span class="op" id="3770392">(</span><span class="op" id="3770393">)</span>&nbsp;<span class="op" id="3770395">{</span>&nbsp;<span class="ident" id="3770397">dec</span><span class="op" id="3770400">.</span><span class="ident" id="3770401">d</span><span class="op" id="3770402">.</span><span class="ident" id="3770403">useNumber</span>&nbsp;<span class="op" id="3770413">=</span>&nbsp;<span class="builtintype" id="3770415">true</span>&nbsp;<span class="op" id="3770420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3770423">//&nbsp;Decode&nbsp;reads&nbsp;the&nbsp;next&nbsp;JSON-encoded&nbsp;value&nbsp;from&nbsp;its</span><br>
<span class="lineno">35</span><span class="comment" id="3770476">//&nbsp;input&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to&nbsp;by&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="3770529">//</span><br>
<span class="lineno"></span><span class="comment" id="3770532">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Unmarshal&nbsp;for&nbsp;details&nbsp;about</span><br>
<span class="lineno"></span><span class="comment" id="3770589">//&nbsp;the&nbsp;conversion&nbsp;of&nbsp;JSON&nbsp;into&nbsp;a&nbsp;Go&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3770632">func</span>&nbsp;<span class="op" id="3770637">(</span><span class="ident" id="3770638">dec</span>&nbsp;<span class="op" id="3770642">*</span><span class="ident" id="3770643">Decoder</span><span class="op" id="3770650">)</span>&nbsp;<span class="ident" id="3770652">Decode</span><span class="op" id="3770658">(</span><span class="ident" id="3770659">v</span>&nbsp;<span class="keyword" id="3770661">interface</span><span class="op" id="3770670">{</span><span class="op" id="3770671">}</span><span class="op" id="3770672">)</span>&nbsp;<span class="builtintype" id="3770674">error</span>&nbsp;<span class="op" id="3770680">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770683">if</span>&nbsp;<span class="ident" id="3770686">dec</span><span class="op" id="3770689">.</span><span class="ident" id="3770690">err</span>&nbsp;<span class="op" id="3770694">!=</span>&nbsp;<span class="ident" id="3770697">nil</span>&nbsp;<span class="op" id="3770701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770705">return</span>&nbsp;<span class="ident" id="3770712">dec</span><span class="op" id="3770715">.</span><span class="ident" id="3770716">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770725">n</span><span class="op" id="3770726">,</span>&nbsp;<span class="ident" id="3770728">err</span>&nbsp;<span class="op" id="3770732">:=</span>&nbsp;<span class="ident" id="3770735">dec</span><span class="op" id="3770738">.</span><span class="ident" id="3770739">readValue</span><span class="op" id="3770748">(</span><span class="op" id="3770749">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770752">if</span>&nbsp;<span class="ident" id="3770755">err</span>&nbsp;<span class="op" id="3770759">!=</span>&nbsp;<span class="ident" id="3770762">nil</span>&nbsp;<span class="op" id="3770766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770770">return</span>&nbsp;<span class="ident" id="3770777">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770786">//&nbsp;Don&#39;t&nbsp;save&nbsp;err&nbsp;from&nbsp;unmarshal&nbsp;into&nbsp;dec.err:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770834">//&nbsp;the&nbsp;connection&nbsp;is&nbsp;still&nbsp;usable&nbsp;since&nbsp;we&nbsp;read&nbsp;a&nbsp;complete&nbsp;JSON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770899">//&nbsp;object&nbsp;from&nbsp;it&nbsp;before&nbsp;the&nbsp;error&nbsp;happened.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770945">dec</span><span class="op" id="3770948">.</span><span class="ident" id="3770949">d</span><span class="op" id="3770950">.</span><span class="ident" id="3770951">init</span><span class="op" id="3770955">(</span><span class="ident" id="3770956">dec</span><span class="op" id="3770959">.</span><span class="ident" id="3770960">buf</span><span class="op" id="3770963">[</span><span class="num" id="3770964">0</span><span class="op" id="3770965">:</span><span class="ident" id="3770966">n</span><span class="op" id="3770967">]</span><span class="op" id="3770968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770971">err</span>&nbsp;<span class="op" id="3770975">=</span>&nbsp;<span class="ident" id="3770977">dec</span><span class="op" id="3770980">.</span><span class="ident" id="3770981">d</span><span class="op" id="3770982">.</span><span class="ident" id="3770983">unmarshal</span><span class="op" id="3770992">(</span><span class="ident" id="3770993">v</span><span class="op" id="3770994">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770998">//&nbsp;Slide&nbsp;rest&nbsp;of&nbsp;data&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771027">rest</span>&nbsp;<span class="op" id="3771032">:=</span>&nbsp;<span class="builtinfunc" id="3771035">copy</span><span class="op" id="3771039">(</span><span class="ident" id="3771040">dec</span><span class="op" id="3771043">.</span><span class="ident" id="3771044">buf</span><span class="op" id="3771047">,</span>&nbsp;<span class="ident" id="3771049">dec</span><span class="op" id="3771052">.</span><span class="ident" id="3771053">buf</span><span class="op" id="3771056">[</span><span class="ident" id="3771057">n</span><span class="op" id="3771058">:</span><span class="op" id="3771059">]</span><span class="op" id="3771060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771063">dec</span><span class="op" id="3771066">.</span><span class="ident" id="3771067">buf</span>&nbsp;<span class="op" id="3771071">=</span>&nbsp;<span class="ident" id="3771073">dec</span><span class="op" id="3771076">.</span><span class="ident" id="3771077">buf</span><span class="op" id="3771080">[</span><span class="num" id="3771081">0</span><span class="op" id="3771082">:</span><span class="ident" id="3771083">rest</span><span class="op" id="3771087">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771091">return</span>&nbsp;<span class="ident" id="3771098">err</span><br>
<span class="lineno">60</span><span class="op" id="3771102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3771105">//&nbsp;Buffered&nbsp;returns&nbsp;a&nbsp;reader&nbsp;of&nbsp;the&nbsp;data&nbsp;remaining&nbsp;in&nbsp;the&nbsp;Decoder&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3771173">//&nbsp;buffer.&nbsp;The&nbsp;reader&nbsp;is&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="keyword" id="3771235">func</span>&nbsp;<span class="op" id="3771240">(</span><span class="ident" id="3771241">dec</span>&nbsp;<span class="op" id="3771245">*</span><span class="ident" id="3771246">Decoder</span><span class="op" id="3771253">)</span>&nbsp;<span class="ident" id="3771255">Buffered</span><span class="op" id="3771263">(</span><span class="op" id="3771264">)</span>&nbsp;<span class="ident" id="3771266">io</span><span class="op" id="3771268">.</span><span class="ident" id="3771269">Reader</span>&nbsp;<span class="op" id="3771276">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771279">return</span>&nbsp;<span class="ident" id="3771286">bytes</span><span class="op" id="3771291">.</span><span class="ident" id="3771292">NewReader</span><span class="op" id="3771301">(</span><span class="ident" id="3771302">dec</span><span class="op" id="3771305">.</span><span class="ident" id="3771306">buf</span><span class="op" id="3771309">)</span><br>
<span class="lineno"></span><span class="op" id="3771311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3771314">//&nbsp;readValue&nbsp;reads&nbsp;a&nbsp;JSON&nbsp;value&nbsp;into&nbsp;dec.buf.</span><br>
<span class="lineno"></span><span class="comment" id="3771360">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno">70</span><span class="keyword" id="3771402">func</span>&nbsp;<span class="op" id="3771407">(</span><span class="ident" id="3771408">dec</span>&nbsp;<span class="op" id="3771412">*</span><span class="ident" id="3771413">Decoder</span><span class="op" id="3771420">)</span>&nbsp;<span class="ident" id="3771422">readValue</span><span class="op" id="3771431">(</span><span class="op" id="3771432">)</span>&nbsp;<span class="op" id="3771434">(</span><span class="builtintype" id="3771435">int</span><span class="op" id="3771438">,</span>&nbsp;<span class="builtintype" id="3771440">error</span><span class="op" id="3771445">)</span>&nbsp;<span class="op" id="3771447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771450">dec</span><span class="op" id="3771453">.</span><span class="ident" id="3771454">scan</span><span class="op" id="3771458">.</span><span class="ident" id="3771459">reset</span><span class="op" id="3771464">(</span><span class="op" id="3771465">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771469">scanp</span>&nbsp;<span class="op" id="3771475">:=</span>&nbsp;<span class="num" id="3771478">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771481">var</span>&nbsp;<span class="ident" id="3771485">err</span>&nbsp;<span class="builtintype" id="3771489">error</span><br>
<span class="lineno">75</span><span class="ident" id="3771495">Input</span><span class="op" id="3771500">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771503">for</span>&nbsp;<span class="op" id="3771507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771511">//&nbsp;Look&nbsp;in&nbsp;the&nbsp;buffer&nbsp;for&nbsp;a&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771552">for</span>&nbsp;<span class="ident" id="3771556">i</span><span class="op" id="3771557">,</span>&nbsp;<span class="ident" id="3771559">c</span>&nbsp;<span class="op" id="3771561">:=</span>&nbsp;<span class="keyword" id="3771564">range</span>&nbsp;<span class="ident" id="3771570">dec</span><span class="op" id="3771573">.</span><span class="ident" id="3771574">buf</span><span class="op" id="3771577">[</span><span class="ident" id="3771578">scanp</span><span class="op" id="3771583">:</span><span class="op" id="3771584">]</span>&nbsp;<span class="op" id="3771586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771591">dec</span><span class="op" id="3771594">.</span><span class="ident" id="3771595">scan</span><span class="op" id="3771599">.</span><span class="ident" id="3771600">bytes</span><span class="op" id="3771605">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771611">v</span>&nbsp;<span class="op" id="3771613">:=</span>&nbsp;<span class="ident" id="3771616">dec</span><span class="op" id="3771619">.</span><span class="ident" id="3771620">scan</span><span class="op" id="3771624">.</span><span class="ident" id="3771625">step</span><span class="op" id="3771629">(</span><span class="op" id="3771630">&amp;</span><span class="ident" id="3771631">dec</span><span class="op" id="3771634">.</span><span class="ident" id="3771635">scan</span><span class="op" id="3771639">,</span>&nbsp;<span class="builtintype" id="3771641">int</span><span class="op" id="3771644">(</span><span class="ident" id="3771645">c</span><span class="op" id="3771646">)</span><span class="op" id="3771647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771652">if</span>&nbsp;<span class="ident" id="3771655">v</span>&nbsp;<span class="op" id="3771657">==</span>&nbsp;<span class="ident" id="3771660">scanEnd</span>&nbsp;<span class="op" id="3771668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771674">scanp</span>&nbsp;<span class="op" id="3771680">+=</span>&nbsp;<span class="ident" id="3771683">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771689">break</span>&nbsp;<span class="ident" id="3771695">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3771704">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771709">//&nbsp;scanEnd&nbsp;is&nbsp;delayed&nbsp;one&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771744">//&nbsp;We&nbsp;might&nbsp;block&nbsp;trying&nbsp;to&nbsp;get&nbsp;that&nbsp;byte&nbsp;from&nbsp;src,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771799">//&nbsp;so&nbsp;instead&nbsp;invent&nbsp;a&nbsp;space&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771837">if</span>&nbsp;<span class="op" id="3771840">(</span><span class="ident" id="3771841">v</span>&nbsp;<span class="op" id="3771843">==</span>&nbsp;<span class="ident" id="3771846">scanEndObject</span>&nbsp;<span class="op" id="3771860">||</span>&nbsp;<span class="ident" id="3771863">v</span>&nbsp;<span class="op" id="3771865">==</span>&nbsp;<span class="ident" id="3771868">scanEndArray</span><span class="op" id="3771880">)</span>&nbsp;<span class="op" id="3771882">&amp;&amp;</span>&nbsp;<span class="ident" id="3771885">dec</span><span class="op" id="3771888">.</span><span class="ident" id="3771889">scan</span><span class="op" id="3771893">.</span><span class="ident" id="3771894">step</span><span class="op" id="3771898">(</span><span class="op" id="3771899">&amp;</span><span class="ident" id="3771900">dec</span><span class="op" id="3771903">.</span><span class="ident" id="3771904">scan</span><span class="op" id="3771908">,</span>&nbsp;<span class="string" id="3771910">&#39;&nbsp;&#39;</span><span class="op" id="3771913">)</span>&nbsp;<span class="op" id="3771915">==</span>&nbsp;<span class="ident" id="3771918">scanEnd</span>&nbsp;<span class="op" id="3771926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771932">scanp</span>&nbsp;<span class="op" id="3771938">+=</span>&nbsp;<span class="ident" id="3771941">i</span>&nbsp;<span class="op" id="3771943">+</span>&nbsp;<span class="num" id="3771945">1</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771951">break</span>&nbsp;<span class="ident" id="3771957">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3771966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771971">if</span>&nbsp;<span class="ident" id="3771974">v</span>&nbsp;<span class="op" id="3771976">==</span>&nbsp;<span class="ident" id="3771979">scanError</span>&nbsp;<span class="op" id="3771989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771995">dec</span><span class="op" id="3771998">.</span><span class="ident" id="3771999">err</span>&nbsp;<span class="op" id="3772003">=</span>&nbsp;<span class="ident" id="3772005">dec</span><span class="op" id="3772008">.</span><span class="ident" id="3772009">scan</span><span class="op" id="3772013">.</span><span class="ident" id="3772014">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772022">return</span>&nbsp;<span class="num" id="3772029">0</span><span class="op" id="3772030">,</span>&nbsp;<span class="ident" id="3772032">dec</span><span class="op" id="3772035">.</span><span class="ident" id="3772036">scan</span><span class="op" id="3772040">.</span><span class="ident" id="3772041">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772056">scanp</span>&nbsp;<span class="op" id="3772062">=</span>&nbsp;<span class="builtinfunc" id="3772064">len</span><span class="op" id="3772067">(</span><span class="ident" id="3772068">dec</span><span class="op" id="3772071">.</span><span class="ident" id="3772072">buf</span><span class="op" id="3772075">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772080">//&nbsp;Did&nbsp;the&nbsp;last&nbsp;read&nbsp;have&nbsp;an&nbsp;error?</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772118">//&nbsp;Delayed&nbsp;until&nbsp;now&nbsp;to&nbsp;allow&nbsp;buffer&nbsp;scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772163">if</span>&nbsp;<span class="ident" id="3772166">err</span>&nbsp;<span class="op" id="3772170">!=</span>&nbsp;<span class="ident" id="3772173">nil</span>&nbsp;<span class="op" id="3772177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772182">if</span>&nbsp;<span class="ident" id="3772185">err</span>&nbsp;<span class="op" id="3772189">==</span>&nbsp;<span class="ident" id="3772192">io</span><span class="op" id="3772194">.</span><span class="ident" id="3772195">EOF</span>&nbsp;<span class="op" id="3772199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772205">if</span>&nbsp;<span class="ident" id="3772208">dec</span><span class="op" id="3772211">.</span><span class="ident" id="3772212">scan</span><span class="op" id="3772216">.</span><span class="ident" id="3772217">step</span><span class="op" id="3772221">(</span><span class="op" id="3772222">&amp;</span><span class="ident" id="3772223">dec</span><span class="op" id="3772226">.</span><span class="ident" id="3772227">scan</span><span class="op" id="3772231">,</span>&nbsp;<span class="string" id="3772233">&#39;&nbsp;&#39;</span><span class="op" id="3772236">)</span>&nbsp;<span class="op" id="3772238">==</span>&nbsp;<span class="ident" id="3772241">scanEnd</span>&nbsp;<span class="op" id="3772249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772256">break</span>&nbsp;<span class="ident" id="3772262">Input</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772278">if</span>&nbsp;<span class="ident" id="3772281">nonSpace</span><span class="op" id="3772289">(</span><span class="ident" id="3772290">dec</span><span class="op" id="3772293">.</span><span class="ident" id="3772294">buf</span><span class="op" id="3772297">)</span>&nbsp;<span class="op" id="3772299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772306">err</span>&nbsp;<span class="op" id="3772310">=</span>&nbsp;<span class="ident" id="3772312">io</span><span class="op" id="3772314">.</span><span class="ident" id="3772315">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772341">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772346">dec</span><span class="op" id="3772349">.</span><span class="ident" id="3772350">err</span>&nbsp;<span class="op" id="3772354">=</span>&nbsp;<span class="ident" id="3772356">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772363">return</span>&nbsp;<span class="num" id="3772370">0</span><span class="op" id="3772371">,</span>&nbsp;<span class="ident" id="3772373">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772384">//&nbsp;Make&nbsp;room&nbsp;to&nbsp;read&nbsp;more&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772429">const</span>&nbsp;<span class="ident" id="3772435">minRead</span>&nbsp;<span class="op" id="3772443">=</span>&nbsp;<span class="num" id="3772445">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772451">if</span>&nbsp;<span class="builtinfunc" id="3772454">cap</span><span class="op" id="3772457">(</span><span class="ident" id="3772458">dec</span><span class="op" id="3772461">.</span><span class="ident" id="3772462">buf</span><span class="op" id="3772465">)</span><span class="op" id="3772466">-</span><span class="builtinfunc" id="3772467">len</span><span class="op" id="3772470">(</span><span class="ident" id="3772471">dec</span><span class="op" id="3772474">.</span><span class="ident" id="3772475">buf</span><span class="op" id="3772478">)</span>&nbsp;<span class="op" id="3772480">&lt;</span>&nbsp;<span class="ident" id="3772482">minRead</span>&nbsp;<span class="op" id="3772490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772495">newBuf</span>&nbsp;<span class="op" id="3772502">:=</span>&nbsp;<span class="builtinfunc" id="3772505">make</span><span class="op" id="3772509">(</span><span class="op" id="3772510">[</span><span class="op" id="3772511">]</span><span class="builtintype" id="3772512">byte</span><span class="op" id="3772516">,</span>&nbsp;<span class="builtinfunc" id="3772518">len</span><span class="op" id="3772521">(</span><span class="ident" id="3772522">dec</span><span class="op" id="3772525">.</span><span class="ident" id="3772526">buf</span><span class="op" id="3772529">)</span><span class="op" id="3772530">,</span>&nbsp;<span class="num" id="3772532">2</span><span class="op" id="3772533">*</span><span class="builtinfunc" id="3772534">cap</span><span class="op" id="3772537">(</span><span class="ident" id="3772538">dec</span><span class="op" id="3772541">.</span><span class="ident" id="3772542">buf</span><span class="op" id="3772545">)</span><span class="op" id="3772546">+</span><span class="ident" id="3772547">minRead</span><span class="op" id="3772554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3772559">copy</span><span class="op" id="3772563">(</span><span class="ident" id="3772564">newBuf</span><span class="op" id="3772570">,</span>&nbsp;<span class="ident" id="3772572">dec</span><span class="op" id="3772575">.</span><span class="ident" id="3772576">buf</span><span class="op" id="3772579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772584">dec</span><span class="op" id="3772587">.</span><span class="ident" id="3772588">buf</span>&nbsp;<span class="op" id="3772592">=</span>&nbsp;<span class="ident" id="3772594">newBuf</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772608">//&nbsp;Read.&nbsp;&nbsp;Delay&nbsp;error&nbsp;for&nbsp;next&nbsp;iteration&nbsp;(after&nbsp;scan).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772665">var</span>&nbsp;<span class="ident" id="3772669">n</span>&nbsp;<span class="builtintype" id="3772671">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772677">n</span><span class="op" id="3772678">,</span>&nbsp;<span class="ident" id="3772680">err</span>&nbsp;<span class="op" id="3772684">=</span>&nbsp;<span class="ident" id="3772686">dec</span><span class="op" id="3772689">.</span><span class="ident" id="3772690">r</span><span class="op" id="3772691">.</span><span class="ident" id="3772692">Read</span><span class="op" id="3772696">(</span><span class="ident" id="3772697">dec</span><span class="op" id="3772700">.</span><span class="ident" id="3772701">buf</span><span class="op" id="3772704">[</span><span class="builtinfunc" id="3772705">len</span><span class="op" id="3772708">(</span><span class="ident" id="3772709">dec</span><span class="op" id="3772712">.</span><span class="ident" id="3772713">buf</span><span class="op" id="3772716">)</span><span class="op" id="3772717">:</span><span class="builtinfunc" id="3772718">cap</span><span class="op" id="3772721">(</span><span class="ident" id="3772722">dec</span><span class="op" id="3772725">.</span><span class="ident" id="3772726">buf</span><span class="op" id="3772729">)</span><span class="op" id="3772730">]</span><span class="op" id="3772731">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772735">dec</span><span class="op" id="3772738">.</span><span class="ident" id="3772739">buf</span>&nbsp;<span class="op" id="3772743">=</span>&nbsp;<span class="ident" id="3772745">dec</span><span class="op" id="3772748">.</span><span class="ident" id="3772749">buf</span><span class="op" id="3772752">[</span><span class="num" id="3772753">0</span>&nbsp;<span class="op" id="3772755">:</span>&nbsp;<span class="builtinfunc" id="3772757">len</span><span class="op" id="3772760">(</span><span class="ident" id="3772761">dec</span><span class="op" id="3772764">.</span><span class="ident" id="3772765">buf</span><span class="op" id="3772768">)</span><span class="op" id="3772769">+</span><span class="ident" id="3772770">n</span><span class="op" id="3772771">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772777">return</span>&nbsp;<span class="ident" id="3772784">scanp</span><span class="op" id="3772789">,</span>&nbsp;<span class="ident" id="3772791">nil</span><br>
<span class="lineno"></span><span class="op" id="3772795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="3772798">func</span>&nbsp;<span class="ident" id="3772803">nonSpace</span><span class="op" id="3772811">(</span><span class="ident" id="3772812">b</span>&nbsp;<span class="op" id="3772814">[</span><span class="op" id="3772815">]</span><span class="builtintype" id="3772816">byte</span><span class="op" id="3772820">)</span>&nbsp;<span class="builtintype" id="3772822">bool</span>&nbsp;<span class="op" id="3772827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772830">for</span>&nbsp;<span class="ident" id="3772834">_</span><span class="op" id="3772835">,</span>&nbsp;<span class="ident" id="3772837">c</span>&nbsp;<span class="op" id="3772839">:=</span>&nbsp;<span class="keyword" id="3772842">range</span>&nbsp;<span class="ident" id="3772848">b</span>&nbsp;<span class="op" id="3772850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772854">if</span>&nbsp;<span class="op" id="3772857">!</span><span class="ident" id="3772858">isSpace</span><span class="op" id="3772865">(</span><span class="builtintype" id="3772866">rune</span><span class="op" id="3772870">(</span><span class="ident" id="3772871">c</span><span class="op" id="3772872">)</span><span class="op" id="3772873">)</span>&nbsp;<span class="op" id="3772875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772880">return</span>&nbsp;<span class="builtintype" id="3772887">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772894">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772900">return</span>&nbsp;<span class="builtintype" id="3772907">false</span><br>
<span class="lineno"></span><span class="op" id="3772913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3772916">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;JSON&nbsp;objects&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">140</span><span class="keyword" id="3772971">type</span>&nbsp;<span class="ident" id="3772976">Encoder</span>&nbsp;<span class="keyword" id="3772984">struct</span>&nbsp;<span class="op" id="3772991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772994">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3772998">io</span><span class="op" id="3773000">.</span><span class="ident" id="3773001">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773009">err</span>&nbsp;<span class="builtintype" id="3773013">error</span><br>
<span class="lineno"></span><span class="op" id="3773019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="3773022">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3773076">func</span>&nbsp;<span class="ident" id="3773081">NewEncoder</span><span class="op" id="3773091">(</span><span class="ident" id="3773092">w</span>&nbsp;<span class="ident" id="3773094">io</span><span class="op" id="3773096">.</span><span class="ident" id="3773097">Writer</span><span class="op" id="3773103">)</span>&nbsp;<span class="op" id="3773105">*</span><span class="ident" id="3773106">Encoder</span>&nbsp;<span class="op" id="3773114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773117">return</span>&nbsp;<span class="op" id="3773124">&amp;</span><span class="ident" id="3773125">Encoder</span><span class="op" id="3773132">{</span><span class="ident" id="3773133">w</span><span class="op" id="3773134">:</span>&nbsp;<span class="ident" id="3773136">w</span><span class="op" id="3773137">}</span><br>
<span class="lineno"></span><span class="op" id="3773139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="3773142">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="3773197">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="3773233">//</span><br>
<span class="lineno"></span><span class="comment" id="3773236">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3773295">//&nbsp;conversion&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;JSON.</span><br>
<span class="lineno">155</span><span class="keyword" id="3773331">func</span>&nbsp;<span class="op" id="3773336">(</span><span class="ident" id="3773337">enc</span>&nbsp;<span class="op" id="3773341">*</span><span class="ident" id="3773342">Encoder</span><span class="op" id="3773349">)</span>&nbsp;<span class="ident" id="3773351">Encode</span><span class="op" id="3773357">(</span><span class="ident" id="3773358">v</span>&nbsp;<span class="keyword" id="3773360">interface</span><span class="op" id="3773369">{</span><span class="op" id="3773370">}</span><span class="op" id="3773371">)</span>&nbsp;<span class="builtintype" id="3773373">error</span>&nbsp;<span class="op" id="3773379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773382">if</span>&nbsp;<span class="ident" id="3773385">enc</span><span class="op" id="3773388">.</span><span class="ident" id="3773389">err</span>&nbsp;<span class="op" id="3773393">!=</span>&nbsp;<span class="ident" id="3773396">nil</span>&nbsp;<span class="op" id="3773400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773404">return</span>&nbsp;<span class="ident" id="3773411">enc</span><span class="op" id="3773414">.</span><span class="ident" id="3773415">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773423">e</span>&nbsp;<span class="op" id="3773425">:=</span>&nbsp;<span class="ident" id="3773428">newEncodeState</span><span class="op" id="3773442">(</span><span class="op" id="3773443">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773446">err</span>&nbsp;<span class="op" id="3773450">:=</span>&nbsp;<span class="ident" id="3773453">e</span><span class="op" id="3773454">.</span><span class="ident" id="3773455">marshal</span><span class="op" id="3773462">(</span><span class="ident" id="3773463">v</span><span class="op" id="3773464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773467">if</span>&nbsp;<span class="ident" id="3773470">err</span>&nbsp;<span class="op" id="3773474">!=</span>&nbsp;<span class="ident" id="3773477">nil</span>&nbsp;<span class="op" id="3773481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773485">return</span>&nbsp;<span class="ident" id="3773492">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773501">//&nbsp;Terminate&nbsp;each&nbsp;value&nbsp;with&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773542">//&nbsp;This&nbsp;makes&nbsp;the&nbsp;output&nbsp;look&nbsp;a&nbsp;little&nbsp;nicer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773588">//&nbsp;when&nbsp;debugging,&nbsp;and&nbsp;some&nbsp;kind&nbsp;of&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773631">//&nbsp;is&nbsp;required&nbsp;if&nbsp;the&nbsp;encoded&nbsp;value&nbsp;was&nbsp;a&nbsp;number,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773682">//&nbsp;so&nbsp;that&nbsp;the&nbsp;reader&nbsp;knows&nbsp;there&nbsp;aren&#39;t&nbsp;more</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773729">//&nbsp;digits&nbsp;coming.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773748">e</span><span class="op" id="3773749">.</span><span class="ident" id="3773750">WriteByte</span><span class="op" id="3773759">(</span><span class="string" id="3773760">&#39;\n&#39;</span><span class="op" id="3773764">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773768">if</span>&nbsp;<span class="ident" id="3773771">_</span><span class="op" id="3773772">,</span>&nbsp;<span class="ident" id="3773774">err</span>&nbsp;<span class="op" id="3773778">=</span>&nbsp;<span class="ident" id="3773780">enc</span><span class="op" id="3773783">.</span><span class="ident" id="3773784">w</span><span class="op" id="3773785">.</span><span class="ident" id="3773786">Write</span><span class="op" id="3773791">(</span><span class="ident" id="3773792">e</span><span class="op" id="3773793">.</span><span class="ident" id="3773794">Bytes</span><span class="op" id="3773799">(</span><span class="op" id="3773800">)</span><span class="op" id="3773801">)</span><span class="op" id="3773802">;</span>&nbsp;<span class="ident" id="3773804">err</span>&nbsp;<span class="op" id="3773808">!=</span>&nbsp;<span class="ident" id="3773811">nil</span>&nbsp;<span class="op" id="3773815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773819">enc</span><span class="op" id="3773822">.</span><span class="ident" id="3773823">err</span>&nbsp;<span class="op" id="3773827">=</span>&nbsp;<span class="ident" id="3773829">err</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773837">encodeStatePool</span><span class="op" id="3773852">.</span><span class="ident" id="3773853">Put</span><span class="op" id="3773856">(</span><span class="ident" id="3773857">e</span><span class="op" id="3773858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773861">return</span>&nbsp;<span class="ident" id="3773868">err</span><br>
<span class="lineno"></span><span class="op" id="3773872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="3773875">//&nbsp;RawMessage&nbsp;is&nbsp;a&nbsp;raw&nbsp;encoded&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="3773919">//&nbsp;It&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;and&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="3773970">//&nbsp;be&nbsp;used&nbsp;to&nbsp;delay&nbsp;JSON&nbsp;decoding&nbsp;or&nbsp;precompute&nbsp;a&nbsp;JSON&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3774035">type</span>&nbsp;<span class="ident" id="3774040">RawMessage</span>&nbsp;<span class="op" id="3774051">[</span><span class="op" id="3774052">]</span><span class="builtintype" id="3774053">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="3774059">//&nbsp;MarshalJSON&nbsp;returns&nbsp;*m&nbsp;as&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;m.</span><br>
<span class="lineno"></span><span class="keyword" id="3774112">func</span>&nbsp;<span class="op" id="3774117">(</span><span class="ident" id="3774118">m</span>&nbsp;<span class="op" id="3774120">*</span><span class="ident" id="3774121">RawMessage</span><span class="op" id="3774131">)</span>&nbsp;<span class="ident" id="3774133">MarshalJSON</span><span class="op" id="3774144">(</span><span class="op" id="3774145">)</span>&nbsp;<span class="op" id="3774147">(</span><span class="op" id="3774148">[</span><span class="op" id="3774149">]</span><span class="builtintype" id="3774150">byte</span><span class="op" id="3774154">,</span>&nbsp;<span class="builtintype" id="3774156">error</span><span class="op" id="3774161">)</span>&nbsp;<span class="op" id="3774163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774166">return</span>&nbsp;<span class="op" id="3774173">*</span><span class="ident" id="3774174">m</span><span class="op" id="3774175">,</span>&nbsp;<span class="ident" id="3774177">nil</span><br>
<span class="lineno"></span><span class="op" id="3774181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="3774184">//&nbsp;UnmarshalJSON&nbsp;sets&nbsp;*m&nbsp;to&nbsp;a&nbsp;copy&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3774228">func</span>&nbsp;<span class="op" id="3774233">(</span><span class="ident" id="3774234">m</span>&nbsp;<span class="op" id="3774236">*</span><span class="ident" id="3774237">RawMessage</span><span class="op" id="3774247">)</span>&nbsp;<span class="ident" id="3774249">UnmarshalJSON</span><span class="op" id="3774262">(</span><span class="ident" id="3774263">data</span>&nbsp;<span class="op" id="3774268">[</span><span class="op" id="3774269">]</span><span class="builtintype" id="3774270">byte</span><span class="op" id="3774274">)</span>&nbsp;<span class="builtintype" id="3774276">error</span>&nbsp;<span class="op" id="3774282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774285">if</span>&nbsp;<span class="ident" id="3774288">m</span>&nbsp;<span class="op" id="3774290">==</span>&nbsp;<span class="ident" id="3774293">nil</span>&nbsp;<span class="op" id="3774297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774301">return</span>&nbsp;<span class="ident" id="3774308">errors</span><span class="op" id="3774314">.</span><span class="ident" id="3774315">New</span><span class="op" id="3774318">(</span><span class="string" id="3774319">&#34;json.RawMessage:&nbsp;UnmarshalJSON&nbsp;on&nbsp;nil&nbsp;pointer&#34;</span><span class="op" id="3774366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3774369">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3774372">*</span><span class="ident" id="3774373">m</span>&nbsp;<span class="op" id="3774375">=</span>&nbsp;<span class="builtinfunc" id="3774377">append</span><span class="op" id="3774383">(</span><span class="op" id="3774384">(</span><span class="op" id="3774385">*</span><span class="ident" id="3774386">m</span><span class="op" id="3774387">)</span><span class="op" id="3774388">[</span><span class="num" id="3774389">0</span><span class="op" id="3774390">:</span><span class="num" id="3774391">0</span><span class="op" id="3774392">]</span><span class="op" id="3774393">,</span>&nbsp;<span class="ident" id="3774395">data</span><span class="op" id="3774399">...</span><span class="op" id="3774402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774405">return</span>&nbsp;<span class="ident" id="3774412">nil</span><br>
<span class="lineno"></span><span class="op" id="3774416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3774419">var</span>&nbsp;<span class="ident" id="3774423">_</span>&nbsp;<span class="ident" id="3774425">Marshaler</span>&nbsp;<span class="op" id="3774435">=</span>&nbsp;<span class="op" id="3774437">(</span><span class="op" id="3774438">*</span><span class="ident" id="3774439">RawMessage</span><span class="op" id="3774449">)</span><span class="op" id="3774450">(</span><span class="ident" id="3774451">nil</span><span class="op" id="3774454">)</span><br>
<span class="lineno">200</span><span class="keyword" id="3774456">var</span>&nbsp;<span class="ident" id="3774460">_</span>&nbsp;<span class="ident" id="3774462">Unmarshaler</span>&nbsp;<span class="op" id="3774474">=</span>&nbsp;<span class="op" id="3774476">(</span><span class="op" id="3774477">*</span><span class="ident" id="3774478">RawMessage</span><span class="op" id="3774488">)</span><span class="op" id="3774489">(</span><span class="ident" id="3774490">nil</span><span class="op" id="3774493">)</span>
</div>
</body>
</html>
