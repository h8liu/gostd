<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6251593">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6251648">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6251702">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6251753">package</span>&nbsp;<span class="ident" id="6251761">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6251768">//&nbsp;moveToFrontDecoder&nbsp;implements&nbsp;a&nbsp;move-to-front&nbsp;list.&nbsp;Such&nbsp;a&nbsp;list&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6251841">//&nbsp;efficient&nbsp;way&nbsp;to&nbsp;transform&nbsp;a&nbsp;string&nbsp;with&nbsp;repeating&nbsp;elements&nbsp;into&nbsp;one&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6251918">//&nbsp;many&nbsp;small&nbsp;valued&nbsp;numbers,&nbsp;which&nbsp;is&nbsp;suitable&nbsp;for&nbsp;entropy&nbsp;encoding.&nbsp;It&nbsp;works</span><br>
<span class="lineno">10</span><span class="comment" id="6251997">//&nbsp;by&nbsp;starting&nbsp;with&nbsp;an&nbsp;initial&nbsp;list&nbsp;of&nbsp;symbols&nbsp;and&nbsp;references&nbsp;symbols&nbsp;by&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="6252076">//&nbsp;index&nbsp;into&nbsp;that&nbsp;list.&nbsp;When&nbsp;a&nbsp;symbol&nbsp;is&nbsp;referenced,&nbsp;it&#39;s&nbsp;moved&nbsp;to&nbsp;the&nbsp;front</span><br>
<span class="lineno"></span><span class="comment" id="6252154">//&nbsp;of&nbsp;the&nbsp;list.&nbsp;Thus,&nbsp;a&nbsp;repeated&nbsp;symbol&nbsp;ends&nbsp;up&nbsp;being&nbsp;encoded&nbsp;with&nbsp;many&nbsp;zeros,</span><br>
<span class="lineno"></span><span class="comment" id="6252233">//&nbsp;as&nbsp;the&nbsp;symbol&nbsp;will&nbsp;be&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list&nbsp;after&nbsp;the&nbsp;first&nbsp;access.</span><br>
<span class="lineno"></span><span class="keyword" id="6252307">type</span>&nbsp;<span class="ident" id="6252312">moveToFrontDecoder</span>&nbsp;<span class="op" id="6252331">[</span><span class="op" id="6252332">]</span><span class="builtintype" id="6252333">byte</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="6252339">//&nbsp;newMTFDecoder&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;explicit&nbsp;initial&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="6252418">//&nbsp;of&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="6252433">func</span>&nbsp;<span class="ident" id="6252438">newMTFDecoder</span><span class="op" id="6252451">(</span><span class="ident" id="6252452">symbols</span>&nbsp;<span class="op" id="6252460">[</span><span class="op" id="6252461">]</span><span class="builtintype" id="6252462">byte</span><span class="op" id="6252466">)</span>&nbsp;<span class="ident" id="6252468"><a href="/compress/bzip2/move_to_front.go.html#6252312">moveToFrontDecoder</a></span>&nbsp;<span class="op" id="6252487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252490">if</span>&nbsp;<span class="builtinfunc" id="6252493">len</span><span class="op" id="6252496">(</span><span class="ident" id="6252497"><a href="/compress/bzip2/move_to_front.go.html#6252452">symbols</a></span><span class="op" id="6252504">)</span>&nbsp;<span class="op" id="6252506">&gt;</span>&nbsp;<span class="num" id="6252508">256</span>&nbsp;<span class="op" id="6252512">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6252516">panic</span><span class="op" id="6252521">(</span><span class="string" id="6252522">&#34;too&nbsp;many&nbsp;symbols&#34;</span><span class="op" id="6252540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6252543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252546">return</span>&nbsp;<span class="ident" id="6252553"><a href="/compress/bzip2/move_to_front.go.html#6252312">moveToFrontDecoder</a></span><span class="op" id="6252571">(</span><span class="ident" id="6252572"><a href="/compress/bzip2/move_to_front.go.html#6252452">symbols</a></span><span class="op" id="6252579">)</span><br>
<span class="lineno"></span><span class="op" id="6252581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="6252584">//&nbsp;newMTFDecoderWithRange&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="6252658">//&nbsp;symbol&nbsp;list&nbsp;of&nbsp;0...n-1.</span><br>
<span class="lineno"></span><span class="keyword" id="6252685">func</span>&nbsp;<span class="ident" id="6252690">newMTFDecoderWithRange</span><span class="op" id="6252712">(</span><span class="ident" id="6252713">n</span>&nbsp;<span class="builtintype" id="6252715">int</span><span class="op" id="6252718">)</span>&nbsp;<span class="ident" id="6252720"><a href="/compress/bzip2/move_to_front.go.html#6252312">moveToFrontDecoder</a></span>&nbsp;<span class="op" id="6252739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252742">if</span>&nbsp;<span class="ident" id="6252745"><a href="/compress/bzip2/move_to_front.go.html#6252713">n</a></span>&nbsp;<span class="op" id="6252747">&gt;</span>&nbsp;<span class="num" id="6252749">256</span>&nbsp;<span class="op" id="6252753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6252757">panic</span><span class="op" id="6252762">(</span><span class="string" id="6252763">&#34;newMTFDecoderWithRange:&nbsp;cannot&nbsp;have&nbsp;&gt;&nbsp;256&nbsp;symbols&#34;</span><span class="op" id="6252814">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6252817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6252821">m</span>&nbsp;<span class="op" id="6252823">:=</span>&nbsp;<span class="builtinfunc" id="6252826">make</span><span class="op" id="6252830">(</span><span class="op" id="6252831">[</span><span class="op" id="6252832">]</span><span class="builtintype" id="6252833">byte</span><span class="op" id="6252837">,</span>&nbsp;<span class="ident" id="6252839"><a href="/compress/bzip2/move_to_front.go.html#6252713">n</a></span><span class="op" id="6252840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252843">for</span>&nbsp;<span class="ident" id="6252847">i</span>&nbsp;<span class="op" id="6252849">:=</span>&nbsp;<span class="num" id="6252852">0</span><span class="op" id="6252853">;</span>&nbsp;<span class="ident" id="6252855"><a href="/compress/bzip2/move_to_front.go.html#6252847">i</a></span>&nbsp;<span class="op" id="6252857">&lt;</span>&nbsp;<span class="ident" id="6252859"><a href="/compress/bzip2/move_to_front.go.html#6252713">n</a></span><span class="op" id="6252860">;</span>&nbsp;<span class="ident" id="6252862"><a href="/compress/bzip2/move_to_front.go.html#6252847">i</a></span><span class="op" id="6252863">++</span>&nbsp;<span class="op" id="6252866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6252870"><a href="/compress/bzip2/move_to_front.go.html#6252821">m</a></span><span class="op" id="6252871">[</span><span class="ident" id="6252872"><a href="/compress/bzip2/move_to_front.go.html#6252847">i</a></span><span class="op" id="6252873">]</span>&nbsp;<span class="op" id="6252875">=</span>&nbsp;<span class="builtintype" id="6252877">byte</span><span class="op" id="6252881">(</span><span class="ident" id="6252882"><a href="/compress/bzip2/move_to_front.go.html#6252847">i</a></span><span class="op" id="6252883">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6252886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252889">return</span>&nbsp;<span class="ident" id="6252896"><a href="/compress/bzip2/move_to_front.go.html#6252312">moveToFrontDecoder</a></span><span class="op" id="6252914">(</span><span class="ident" id="6252915"><a href="/compress/bzip2/move_to_front.go.html#6252821">m</a></span><span class="op" id="6252916">)</span><br>
<span class="lineno"></span><span class="op" id="6252918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6252921">func</span>&nbsp;<span class="op" id="6252926">(</span><span class="ident" id="6252927">m</span>&nbsp;<span class="ident" id="6252929"><a href="/compress/bzip2/move_to_front.go.html#6252312">moveToFrontDecoder</a></span><span class="op" id="6252947">)</span>&nbsp;<span class="ident" id="6252949">Decode</span><span class="op" id="6252955">(</span><span class="ident" id="6252956">n</span>&nbsp;<span class="builtintype" id="6252958">int</span><span class="op" id="6252961">)</span>&nbsp;<span class="op" id="6252963">(</span><span class="ident" id="6252964">b</span>&nbsp;<span class="builtintype" id="6252966">byte</span><span class="op" id="6252970">)</span>&nbsp;<span class="op" id="6252972">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6252975">//&nbsp;Implement&nbsp;move-to-front&nbsp;with&nbsp;a&nbsp;simple&nbsp;copy.&nbsp;This&nbsp;approach</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6253037">//&nbsp;beats&nbsp;more&nbsp;sophisticated&nbsp;approaches&nbsp;in&nbsp;benchmarking,&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6253103">//&nbsp;because&nbsp;it&nbsp;has&nbsp;high&nbsp;locality&nbsp;of&nbsp;reference&nbsp;inside&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6253161">//&nbsp;single&nbsp;cache&nbsp;line&nbsp;(most&nbsp;move-to-front&nbsp;operations&nbsp;have&nbsp;n&nbsp;&lt;&nbsp;64).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253228"><a href="/compress/bzip2/move_to_front.go.html#6252964">b</a></span>&nbsp;<span class="op" id="6253230">=</span>&nbsp;<span class="ident" id="6253232"><a href="/compress/bzip2/move_to_front.go.html#6252927">m</a></span><span class="op" id="6253233">[</span><span class="ident" id="6253234"><a href="/compress/bzip2/move_to_front.go.html#6252956">n</a></span><span class="op" id="6253235">]</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6253238">copy</span><span class="op" id="6253242">(</span><span class="ident" id="6253243"><a href="/compress/bzip2/move_to_front.go.html#6252927">m</a></span><span class="op" id="6253244">[</span><span class="num" id="6253245">1</span><span class="op" id="6253246">:</span><span class="op" id="6253247">]</span><span class="op" id="6253248">,</span>&nbsp;<span class="ident" id="6253250"><a href="/compress/bzip2/move_to_front.go.html#6252927">m</a></span><span class="op" id="6253251">[</span><span class="op" id="6253252">:</span><span class="ident" id="6253253"><a href="/compress/bzip2/move_to_front.go.html#6252956">n</a></span><span class="op" id="6253254">]</span><span class="op" id="6253255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253258"><a href="/compress/bzip2/move_to_front.go.html#6252927">m</a></span><span class="op" id="6253259">[</span><span class="num" id="6253260">0</span><span class="op" id="6253261">]</span>&nbsp;<span class="op" id="6253263">=</span>&nbsp;<span class="ident" id="6253265"><a href="/compress/bzip2/move_to_front.go.html#6252964">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253268">return</span><br>
<span class="lineno"></span><span class="op" id="6253275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="6253278">//&nbsp;First&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="6253332">func</span>&nbsp;<span class="op" id="6253337">(</span><span class="ident" id="6253338">m</span>&nbsp;<span class="ident" id="6253340"><a href="/compress/bzip2/move_to_front.go.html#6252312">moveToFrontDecoder</a></span><span class="op" id="6253358">)</span>&nbsp;<span class="ident" id="6253360">First</span><span class="op" id="6253365">(</span><span class="op" id="6253366">)</span>&nbsp;<span class="builtintype" id="6253368">byte</span>&nbsp;<span class="op" id="6253373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253376">return</span>&nbsp;<span class="ident" id="6253383"><a href="/compress/bzip2/move_to_front.go.html#6253338">m</a></span><span class="op" id="6253384">[</span><span class="num" id="6253385">0</span><span class="op" id="6253386">]</span><br>
<span class="lineno"></span><span class="op" id="6253388">}</span>
</div>
</body>
</html>
