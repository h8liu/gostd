<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html" class="current">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4102615">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4102670">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4102724">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4102775">package</span>&nbsp;<span class="ident" id="4102783">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4102789">import</span>&nbsp;<span class="op" id="4102796">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4102799">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4102817">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4102827">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4102834">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4102842">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4102856">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4102861">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4102864">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="4102944">//&nbsp;&#34;compress/gzip&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4103010">const</span>&nbsp;<span class="op" id="4103016">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103019">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4103038">=</span>&nbsp;<span class="ident" id="4103040">flate</span><span class="op" id="4103045">.</span><span class="ident" id="4103046">NoCompression</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103061">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4103080">=</span>&nbsp;<span class="ident" id="4103082">flate</span><span class="op" id="4103087">.</span><span class="ident" id="4103088">BestSpeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103099">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4103118">=</span>&nbsp;<span class="ident" id="4103120">flate</span><span class="op" id="4103125">.</span><span class="ident" id="4103126">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103143">DefaultCompression</span>&nbsp;<span class="op" id="4103162">=</span>&nbsp;<span class="ident" id="4103164">flate</span><span class="op" id="4103169">.</span><span class="ident" id="4103170">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="4103189">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4103192">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;an&nbsp;io.WriteCloser.</span><br>
<span class="lineno"></span><span class="comment" id="4103226">//&nbsp;Writes&nbsp;to&nbsp;a&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4103281">type</span>&nbsp;<span class="ident" id="4103286">Writer</span>&nbsp;<span class="keyword" id="4103293">struct</span>&nbsp;<span class="op" id="4103300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103303">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103311">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4103323">io</span><span class="op" id="4103325">.</span><span class="ident" id="4103326">Writer</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103334">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4103346">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103351">wroteHeader</span>&nbsp;<span class="builtintype" id="4103363">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103369">compressor</span>&nbsp;&nbsp;<span class="op" id="4103381">*</span><span class="ident" id="4103382">flate</span><span class="op" id="4103387">.</span><span class="ident" id="4103388">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103396">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4103408">hash</span><span class="op" id="4103412">.</span><span class="ident" id="4103413">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103421">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4103433">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103441">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4103453">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103459">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4103471">[</span><span class="num" id="4103472">10</span><span class="op" id="4103474">]</span><span class="builtintype" id="4103475">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103481">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4103493">error</span><br>
<span class="lineno"></span><span class="op" id="4103499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="4103502">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4103537">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4103603">//</span><br>
<span class="lineno"></span><span class="comment" id="4103606">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="4103687">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno">45</span><span class="comment" id="4103742">//</span><br>
<span class="lineno"></span><span class="comment" id="4103745">//&nbsp;Callers&nbsp;that&nbsp;wish&nbsp;to&nbsp;set&nbsp;the&nbsp;fields&nbsp;in&nbsp;Writer.Header&nbsp;must&nbsp;do&nbsp;so&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="4103819">//&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;Close.&nbsp;The&nbsp;Comment&nbsp;and&nbsp;Name&nbsp;header&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4103895">//&nbsp;UTF-8&nbsp;strings&nbsp;in&nbsp;Go,&nbsp;but&nbsp;the&nbsp;underlying&nbsp;format&nbsp;requires&nbsp;NUL-terminated&nbsp;ISO</span><br>
<span class="lineno"></span><span class="comment" id="4103973">//&nbsp;8859-1&nbsp;(Latin-1).&nbsp;NUL&nbsp;or&nbsp;non-Latin-1&nbsp;runes&nbsp;in&nbsp;those&nbsp;strings&nbsp;will&nbsp;lead&nbsp;to&nbsp;an</span><br>
<span class="lineno">50</span><span class="comment" id="4104052">//&nbsp;error&nbsp;on&nbsp;Write.</span><br>
<span class="lineno"></span><span class="keyword" id="4104071">func</span>&nbsp;<span class="ident" id="4104076">NewWriter</span><span class="op" id="4104085">(</span><span class="ident" id="4104086">w</span>&nbsp;<span class="ident" id="4104088">io</span><span class="op" id="4104090">.</span><span class="ident" id="4104091">Writer</span><span class="op" id="4104097">)</span>&nbsp;<span class="op" id="4104099">*</span><span class="ident" id="4104100">Writer</span>&nbsp;<span class="op" id="4104107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104110">z</span><span class="op" id="4104111">,</span>&nbsp;<span class="ident" id="4104113">_</span>&nbsp;<span class="op" id="4104115">:=</span>&nbsp;<span class="ident" id="4104118">NewWriterLevel</span><span class="op" id="4104132">(</span><span class="ident" id="4104133">w</span><span class="op" id="4104134">,</span>&nbsp;<span class="ident" id="4104136">DefaultCompression</span><span class="op" id="4104154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4104157">return</span>&nbsp;<span class="ident" id="4104164">z</span><br>
<span class="lineno"></span><span class="op" id="4104166">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4104169">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4104249">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="4104284">//</span><br>
<span class="lineno"></span><span class="comment" id="4104287">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno">60</span><span class="comment" id="4104361">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4104437">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4104484">func</span>&nbsp;<span class="ident" id="4104489">NewWriterLevel</span><span class="op" id="4104503">(</span><span class="ident" id="4104504">w</span>&nbsp;<span class="ident" id="4104506">io</span><span class="op" id="4104508">.</span><span class="ident" id="4104509">Writer</span><span class="op" id="4104515">,</span>&nbsp;<span class="ident" id="4104517">level</span>&nbsp;<span class="builtintype" id="4104523">int</span><span class="op" id="4104526">)</span>&nbsp;<span class="op" id="4104528">(</span><span class="op" id="4104529">*</span><span class="ident" id="4104530">Writer</span><span class="op" id="4104536">,</span>&nbsp;<span class="builtintype" id="4104538">error</span><span class="op" id="4104543">)</span>&nbsp;<span class="op" id="4104545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4104548">if</span>&nbsp;<span class="ident" id="4104551">level</span>&nbsp;<span class="op" id="4104557">&lt;</span>&nbsp;<span class="ident" id="4104559">DefaultCompression</span>&nbsp;<span class="op" id="4104578">||</span>&nbsp;<span class="ident" id="4104581">level</span>&nbsp;<span class="op" id="4104587">&gt;</span>&nbsp;<span class="ident" id="4104589">BestCompression</span>&nbsp;<span class="op" id="4104605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4104609">return</span>&nbsp;<span class="ident" id="4104616">nil</span><span class="op" id="4104619">,</span>&nbsp;<span class="ident" id="4104621">fmt</span><span class="op" id="4104624">.</span><span class="ident" id="4104625">Errorf</span><span class="op" id="4104631">(</span><span class="string" id="4104632">&#34;gzip:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="4104669">,</span>&nbsp;<span class="ident" id="4104671">level</span><span class="op" id="4104676">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4104679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104682">z</span>&nbsp;<span class="op" id="4104684">:=</span>&nbsp;<span class="builtinfunc" id="4104687">new</span><span class="op" id="4104690">(</span><span class="ident" id="4104691">Writer</span><span class="op" id="4104697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104700">z</span><span class="op" id="4104701">.</span><span class="ident" id="4104702">init</span><span class="op" id="4104706">(</span><span class="ident" id="4104707">w</span><span class="op" id="4104708">,</span>&nbsp;<span class="ident" id="4104710">level</span><span class="op" id="4104715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4104718">return</span>&nbsp;<span class="ident" id="4104725">z</span><span class="op" id="4104726">,</span>&nbsp;<span class="ident" id="4104728">nil</span><br>
<span class="lineno"></span><span class="op" id="4104732">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4104735">func</span>&nbsp;<span class="op" id="4104740">(</span><span class="ident" id="4104741">z</span>&nbsp;<span class="op" id="4104743">*</span><span class="ident" id="4104744">Writer</span><span class="op" id="4104750">)</span>&nbsp;<span class="ident" id="4104752">init</span><span class="op" id="4104756">(</span><span class="ident" id="4104757">w</span>&nbsp;<span class="ident" id="4104759">io</span><span class="op" id="4104761">.</span><span class="ident" id="4104762">Writer</span><span class="op" id="4104768">,</span>&nbsp;<span class="ident" id="4104770">level</span>&nbsp;<span class="builtintype" id="4104776">int</span><span class="op" id="4104779">)</span>&nbsp;<span class="op" id="4104781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104784">digest</span>&nbsp;<span class="op" id="4104791">:=</span>&nbsp;<span class="ident" id="4104794">z</span><span class="op" id="4104795">.</span><span class="ident" id="4104796">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4104804">if</span>&nbsp;<span class="ident" id="4104807">digest</span>&nbsp;<span class="op" id="4104814">!=</span>&nbsp;<span class="ident" id="4104817">nil</span>&nbsp;<span class="op" id="4104821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104825">digest</span><span class="op" id="4104831">.</span><span class="ident" id="4104832">Reset</span><span class="op" id="4104837">(</span><span class="op" id="4104838">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4104841">}</span>&nbsp;<span class="keyword" id="4104843">else</span>&nbsp;<span class="op" id="4104848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104852">digest</span>&nbsp;<span class="op" id="4104859">=</span>&nbsp;<span class="ident" id="4104861">crc32</span><span class="op" id="4104866">.</span><span class="ident" id="4104867">NewIEEE</span><span class="op" id="4104874">(</span><span class="op" id="4104875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4104878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104881">compressor</span>&nbsp;<span class="op" id="4104892">:=</span>&nbsp;<span class="ident" id="4104895">z</span><span class="op" id="4104896">.</span><span class="ident" id="4104897">compressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4104909">if</span>&nbsp;<span class="ident" id="4104912">compressor</span>&nbsp;<span class="op" id="4104923">!=</span>&nbsp;<span class="ident" id="4104926">nil</span>&nbsp;<span class="op" id="4104930">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104934">compressor</span><span class="op" id="4104944">.</span><span class="ident" id="4104945">Reset</span><span class="op" id="4104950">(</span><span class="ident" id="4104951">w</span><span class="op" id="4104952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4104955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4104958">*</span><span class="ident" id="4104959">z</span>&nbsp;<span class="op" id="4104961">=</span>&nbsp;<span class="ident" id="4104963">Writer</span><span class="op" id="4104969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104973">Header</span><span class="op" id="4104979">:</span>&nbsp;<span class="ident" id="4104981">Header</span><span class="op" id="4104987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4104992">OS</span><span class="op" id="4104994">:</span>&nbsp;<span class="num" id="4104996">255</span><span class="op" id="4104999">,</span>&nbsp;<span class="comment" id="4105001">//&nbsp;unknown</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4105014">}</span><span class="op" id="4105015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105019">w</span><span class="op" id="4105020">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105031">w</span><span class="op" id="4105032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105036">level</span><span class="op" id="4105041">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105048">level</span><span class="op" id="4105053">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105057">digest</span><span class="op" id="4105063">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105069">digest</span><span class="op" id="4105075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105079">compressor</span><span class="op" id="4105089">:</span>&nbsp;<span class="ident" id="4105091">compressor</span><span class="op" id="4105101">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4105104">}</span><br>
<span class="lineno"></span><span class="op" id="4105106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4105109">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Writer&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4105179">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewWriter&nbsp;or&nbsp;NewWriterLevel,&nbsp;but</span><br>
<span class="lineno">95</span><span class="comment" id="4105249">//&nbsp;writing&nbsp;to&nbsp;w&nbsp;instead.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Writer&nbsp;rather&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="4105316">//&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4105341">func</span>&nbsp;<span class="op" id="4105346">(</span><span class="ident" id="4105347">z</span>&nbsp;<span class="op" id="4105349">*</span><span class="ident" id="4105350">Writer</span><span class="op" id="4105356">)</span>&nbsp;<span class="ident" id="4105358">Reset</span><span class="op" id="4105363">(</span><span class="ident" id="4105364">w</span>&nbsp;<span class="ident" id="4105366">io</span><span class="op" id="4105368">.</span><span class="ident" id="4105369">Writer</span><span class="op" id="4105375">)</span>&nbsp;<span class="op" id="4105377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105380">z</span><span class="op" id="4105381">.</span><span class="ident" id="4105382">init</span><span class="op" id="4105386">(</span><span class="ident" id="4105387">w</span><span class="op" id="4105388">,</span>&nbsp;<span class="ident" id="4105390">z</span><span class="op" id="4105391">.</span><span class="ident" id="4105392">level</span><span class="op" id="4105397">)</span><br>
<span class="lineno"></span><span class="op" id="4105399">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="4105402">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4105463">func</span>&nbsp;<span class="ident" id="4105468">put2</span><span class="op" id="4105472">(</span><span class="ident" id="4105473">p</span>&nbsp;<span class="op" id="4105475">[</span><span class="op" id="4105476">]</span><span class="builtintype" id="4105477">byte</span><span class="op" id="4105481">,</span>&nbsp;<span class="ident" id="4105483">v</span>&nbsp;<span class="builtintype" id="4105485">uint16</span><span class="op" id="4105491">)</span>&nbsp;<span class="op" id="4105493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105496">p</span><span class="op" id="4105497">[</span><span class="num" id="4105498">0</span><span class="op" id="4105499">]</span>&nbsp;<span class="op" id="4105501">=</span>&nbsp;<span class="builtintype" id="4105503">uint8</span><span class="op" id="4105508">(</span><span class="ident" id="4105509">v</span>&nbsp;<span class="op" id="4105511">&gt;&gt;</span>&nbsp;<span class="num" id="4105514">0</span><span class="op" id="4105515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105518">p</span><span class="op" id="4105519">[</span><span class="num" id="4105520">1</span><span class="op" id="4105521">]</span>&nbsp;<span class="op" id="4105523">=</span>&nbsp;<span class="builtintype" id="4105525">uint8</span><span class="op" id="4105530">(</span><span class="ident" id="4105531">v</span>&nbsp;<span class="op" id="4105533">&gt;&gt;</span>&nbsp;<span class="num" id="4105536">8</span><span class="op" id="4105537">)</span><br>
<span class="lineno">105</span><span class="op" id="4105539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4105542">func</span>&nbsp;<span class="ident" id="4105547">put4</span><span class="op" id="4105551">(</span><span class="ident" id="4105552">p</span>&nbsp;<span class="op" id="4105554">[</span><span class="op" id="4105555">]</span><span class="builtintype" id="4105556">byte</span><span class="op" id="4105560">,</span>&nbsp;<span class="ident" id="4105562">v</span>&nbsp;<span class="builtintype" id="4105564">uint32</span><span class="op" id="4105570">)</span>&nbsp;<span class="op" id="4105572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105575">p</span><span class="op" id="4105576">[</span><span class="num" id="4105577">0</span><span class="op" id="4105578">]</span>&nbsp;<span class="op" id="4105580">=</span>&nbsp;<span class="builtintype" id="4105582">uint8</span><span class="op" id="4105587">(</span><span class="ident" id="4105588">v</span>&nbsp;<span class="op" id="4105590">&gt;&gt;</span>&nbsp;<span class="num" id="4105593">0</span><span class="op" id="4105594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105597">p</span><span class="op" id="4105598">[</span><span class="num" id="4105599">1</span><span class="op" id="4105600">]</span>&nbsp;<span class="op" id="4105602">=</span>&nbsp;<span class="builtintype" id="4105604">uint8</span><span class="op" id="4105609">(</span><span class="ident" id="4105610">v</span>&nbsp;<span class="op" id="4105612">&gt;&gt;</span>&nbsp;<span class="num" id="4105615">8</span><span class="op" id="4105616">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105619">p</span><span class="op" id="4105620">[</span><span class="num" id="4105621">2</span><span class="op" id="4105622">]</span>&nbsp;<span class="op" id="4105624">=</span>&nbsp;<span class="builtintype" id="4105626">uint8</span><span class="op" id="4105631">(</span><span class="ident" id="4105632">v</span>&nbsp;<span class="op" id="4105634">&gt;&gt;</span>&nbsp;<span class="num" id="4105637">16</span><span class="op" id="4105639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105642">p</span><span class="op" id="4105643">[</span><span class="num" id="4105644">3</span><span class="op" id="4105645">]</span>&nbsp;<span class="op" id="4105647">=</span>&nbsp;<span class="builtintype" id="4105649">uint8</span><span class="op" id="4105654">(</span><span class="ident" id="4105655">v</span>&nbsp;<span class="op" id="4105657">&gt;&gt;</span>&nbsp;<span class="num" id="4105660">24</span><span class="op" id="4105662">)</span><br>
<span class="lineno"></span><span class="op" id="4105664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4105667">//&nbsp;writeBytes&nbsp;writes&nbsp;a&nbsp;length-prefixed&nbsp;byte&nbsp;slice&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno">115</span><span class="keyword" id="4105725">func</span>&nbsp;<span class="op" id="4105730">(</span><span class="ident" id="4105731">z</span>&nbsp;<span class="op" id="4105733">*</span><span class="ident" id="4105734">Writer</span><span class="op" id="4105740">)</span>&nbsp;<span class="ident" id="4105742">writeBytes</span><span class="op" id="4105752">(</span><span class="ident" id="4105753">b</span>&nbsp;<span class="op" id="4105755">[</span><span class="op" id="4105756">]</span><span class="builtintype" id="4105757">byte</span><span class="op" id="4105761">)</span>&nbsp;<span class="builtintype" id="4105763">error</span>&nbsp;<span class="op" id="4105769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105772">if</span>&nbsp;<span class="builtinfunc" id="4105775">len</span><span class="op" id="4105778">(</span><span class="ident" id="4105779">b</span><span class="op" id="4105780">)</span>&nbsp;<span class="op" id="4105782">&gt;</span>&nbsp;<span class="num" id="4105784">0xffff</span>&nbsp;<span class="op" id="4105791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105795">return</span>&nbsp;<span class="ident" id="4105802">errors</span><span class="op" id="4105808">.</span><span class="ident" id="4105809">New</span><span class="op" id="4105812">(</span><span class="string" id="4105813">&#34;gzip.Write:&nbsp;Extra&nbsp;data&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="4105850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4105853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105856">put2</span><span class="op" id="4105860">(</span><span class="ident" id="4105861">z</span><span class="op" id="4105862">.</span><span class="ident" id="4105863">buf</span><span class="op" id="4105866">[</span><span class="num" id="4105867">0</span><span class="op" id="4105868">:</span><span class="num" id="4105869">2</span><span class="op" id="4105870">]</span><span class="op" id="4105871">,</span>&nbsp;<span class="builtintype" id="4105873">uint16</span><span class="op" id="4105879">(</span><span class="builtinfunc" id="4105880">len</span><span class="op" id="4105883">(</span><span class="ident" id="4105884">b</span><span class="op" id="4105885">)</span><span class="op" id="4105886">)</span><span class="op" id="4105887">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105890">_</span><span class="op" id="4105891">,</span>&nbsp;<span class="ident" id="4105893">err</span>&nbsp;<span class="op" id="4105897">:=</span>&nbsp;<span class="ident" id="4105900">z</span><span class="op" id="4105901">.</span><span class="ident" id="4105902">w</span><span class="op" id="4105903">.</span><span class="ident" id="4105904">Write</span><span class="op" id="4105909">(</span><span class="ident" id="4105910">z</span><span class="op" id="4105911">.</span><span class="ident" id="4105912">buf</span><span class="op" id="4105915">[</span><span class="num" id="4105916">0</span><span class="op" id="4105917">:</span><span class="num" id="4105918">2</span><span class="op" id="4105919">]</span><span class="op" id="4105920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105923">if</span>&nbsp;<span class="ident" id="4105926">err</span>&nbsp;<span class="op" id="4105930">!=</span>&nbsp;<span class="ident" id="4105933">nil</span>&nbsp;<span class="op" id="4105937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105941">return</span>&nbsp;<span class="ident" id="4105948">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4105953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4105956">_</span><span class="op" id="4105957">,</span>&nbsp;<span class="ident" id="4105959">err</span>&nbsp;<span class="op" id="4105963">=</span>&nbsp;<span class="ident" id="4105965">z</span><span class="op" id="4105966">.</span><span class="ident" id="4105967">w</span><span class="op" id="4105968">.</span><span class="ident" id="4105969">Write</span><span class="op" id="4105974">(</span><span class="ident" id="4105975">b</span><span class="op" id="4105976">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4105979">return</span>&nbsp;<span class="ident" id="4105986">err</span><br>
<span class="lineno"></span><span class="op" id="4105990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4105993">//&nbsp;writeString&nbsp;writes&nbsp;a&nbsp;UTF-8&nbsp;string&nbsp;s&nbsp;in&nbsp;GZIP&#39;s&nbsp;format&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno"></span><span class="comment" id="4106057">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno">130</span><span class="keyword" id="4106140">func</span>&nbsp;<span class="op" id="4106145">(</span><span class="ident" id="4106146">z</span>&nbsp;<span class="op" id="4106148">*</span><span class="ident" id="4106149">Writer</span><span class="op" id="4106155">)</span>&nbsp;<span class="ident" id="4106157">writeString</span><span class="op" id="4106168">(</span><span class="ident" id="4106169">s</span>&nbsp;<span class="builtintype" id="4106171">string</span><span class="op" id="4106177">)</span>&nbsp;<span class="op" id="4106179">(</span><span class="ident" id="4106180">err</span>&nbsp;<span class="builtintype" id="4106184">error</span><span class="op" id="4106189">)</span>&nbsp;<span class="op" id="4106191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4106194">//&nbsp;GZIP&nbsp;stores&nbsp;Latin-1&nbsp;strings;&nbsp;error&nbsp;if&nbsp;non-Latin-1;&nbsp;convert&nbsp;if&nbsp;non-ASCII.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106271">needconv</span>&nbsp;<span class="op" id="4106280">:=</span>&nbsp;<span class="builtintype" id="4106283">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106290">for</span>&nbsp;<span class="ident" id="4106294">_</span><span class="op" id="4106295">,</span>&nbsp;<span class="ident" id="4106297">v</span>&nbsp;<span class="op" id="4106299">:=</span>&nbsp;<span class="keyword" id="4106302">range</span>&nbsp;<span class="ident" id="4106308">s</span>&nbsp;<span class="op" id="4106310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106314">if</span>&nbsp;<span class="ident" id="4106317">v</span>&nbsp;<span class="op" id="4106319">==</span>&nbsp;<span class="num" id="4106322">0</span>&nbsp;<span class="op" id="4106324">||</span>&nbsp;<span class="ident" id="4106327">v</span>&nbsp;<span class="op" id="4106329">&gt;</span>&nbsp;<span class="num" id="4106331">0xff</span>&nbsp;<span class="op" id="4106336">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106341">return</span>&nbsp;<span class="ident" id="4106348">errors</span><span class="op" id="4106354">.</span><span class="ident" id="4106355">New</span><span class="op" id="4106358">(</span><span class="string" id="4106359">&#34;gzip.Write:&nbsp;non-Latin-1&nbsp;header&nbsp;string&#34;</span><span class="op" id="4106398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4106402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106406">if</span>&nbsp;<span class="ident" id="4106409">v</span>&nbsp;<span class="op" id="4106411">&gt;</span>&nbsp;<span class="num" id="4106413">0x7f</span>&nbsp;<span class="op" id="4106418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106423">needconv</span>&nbsp;<span class="op" id="4106432">=</span>&nbsp;<span class="builtintype" id="4106434">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4106441">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4106444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106447">if</span>&nbsp;<span class="ident" id="4106450">needconv</span>&nbsp;<span class="op" id="4106459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106463">b</span>&nbsp;<span class="op" id="4106465">:=</span>&nbsp;<span class="builtinfunc" id="4106468">make</span><span class="op" id="4106472">(</span><span class="op" id="4106473">[</span><span class="op" id="4106474">]</span><span class="builtintype" id="4106475">byte</span><span class="op" id="4106479">,</span>&nbsp;<span class="num" id="4106481">0</span><span class="op" id="4106482">,</span>&nbsp;<span class="builtinfunc" id="4106484">len</span><span class="op" id="4106487">(</span><span class="ident" id="4106488">s</span><span class="op" id="4106489">)</span><span class="op" id="4106490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106494">for</span>&nbsp;<span class="ident" id="4106498">_</span><span class="op" id="4106499">,</span>&nbsp;<span class="ident" id="4106501">v</span>&nbsp;<span class="op" id="4106503">:=</span>&nbsp;<span class="keyword" id="4106506">range</span>&nbsp;<span class="ident" id="4106512">s</span>&nbsp;<span class="op" id="4106514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106519">b</span>&nbsp;<span class="op" id="4106521">=</span>&nbsp;<span class="builtinfunc" id="4106523">append</span><span class="op" id="4106529">(</span><span class="ident" id="4106530">b</span><span class="op" id="4106531">,</span>&nbsp;<span class="builtintype" id="4106533">byte</span><span class="op" id="4106537">(</span><span class="ident" id="4106538">v</span><span class="op" id="4106539">)</span><span class="op" id="4106540">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4106544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106548">_</span><span class="op" id="4106549">,</span>&nbsp;<span class="ident" id="4106551">err</span>&nbsp;<span class="op" id="4106555">=</span>&nbsp;<span class="ident" id="4106557">z</span><span class="op" id="4106558">.</span><span class="ident" id="4106559">w</span><span class="op" id="4106560">.</span><span class="ident" id="4106561">Write</span><span class="op" id="4106566">(</span><span class="ident" id="4106567">b</span><span class="op" id="4106568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4106571">}</span>&nbsp;<span class="keyword" id="4106573">else</span>&nbsp;<span class="op" id="4106578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106582">_</span><span class="op" id="4106583">,</span>&nbsp;<span class="ident" id="4106585">err</span>&nbsp;<span class="op" id="4106589">=</span>&nbsp;<span class="ident" id="4106591">io</span><span class="op" id="4106593">.</span><span class="ident" id="4106594">WriteString</span><span class="op" id="4106605">(</span><span class="ident" id="4106606">z</span><span class="op" id="4106607">.</span><span class="ident" id="4106608">w</span><span class="op" id="4106609">,</span>&nbsp;<span class="ident" id="4106611">s</span><span class="op" id="4106612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4106615">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106618">if</span>&nbsp;<span class="ident" id="4106621">err</span>&nbsp;<span class="op" id="4106625">!=</span>&nbsp;<span class="ident" id="4106628">nil</span>&nbsp;<span class="op" id="4106632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106636">return</span>&nbsp;<span class="ident" id="4106643">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4106648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4106651">//&nbsp;GZIP&nbsp;strings&nbsp;are&nbsp;NUL-terminated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106688">z</span><span class="op" id="4106689">.</span><span class="ident" id="4106690">buf</span><span class="op" id="4106693">[</span><span class="num" id="4106694">0</span><span class="op" id="4106695">]</span>&nbsp;<span class="op" id="4106697">=</span>&nbsp;<span class="num" id="4106699">0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4106702">_</span><span class="op" id="4106703">,</span>&nbsp;<span class="ident" id="4106705">err</span>&nbsp;<span class="op" id="4106709">=</span>&nbsp;<span class="ident" id="4106711">z</span><span class="op" id="4106712">.</span><span class="ident" id="4106713">w</span><span class="op" id="4106714">.</span><span class="ident" id="4106715">Write</span><span class="op" id="4106720">(</span><span class="ident" id="4106721">z</span><span class="op" id="4106722">.</span><span class="ident" id="4106723">buf</span><span class="op" id="4106726">[</span><span class="num" id="4106727">0</span><span class="op" id="4106728">:</span><span class="num" id="4106729">1</span><span class="op" id="4106730">]</span><span class="op" id="4106731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106734">return</span>&nbsp;<span class="ident" id="4106741">err</span><br>
<span class="lineno"></span><span class="op" id="4106745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4106748">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno">160</span><span class="comment" id="4106820">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="4106896">func</span>&nbsp;<span class="op" id="4106901">(</span><span class="ident" id="4106902">z</span>&nbsp;<span class="op" id="4106904">*</span><span class="ident" id="4106905">Writer</span><span class="op" id="4106911">)</span>&nbsp;<span class="ident" id="4106913">Write</span><span class="op" id="4106918">(</span><span class="ident" id="4106919">p</span>&nbsp;<span class="op" id="4106921">[</span><span class="op" id="4106922">]</span><span class="builtintype" id="4106923">byte</span><span class="op" id="4106927">)</span>&nbsp;<span class="op" id="4106929">(</span><span class="builtintype" id="4106930">int</span><span class="op" id="4106933">,</span>&nbsp;<span class="builtintype" id="4106935">error</span><span class="op" id="4106940">)</span>&nbsp;<span class="op" id="4106942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106945">if</span>&nbsp;<span class="ident" id="4106948">z</span><span class="op" id="4106949">.</span><span class="ident" id="4106950">err</span>&nbsp;<span class="op" id="4106954">!=</span>&nbsp;<span class="ident" id="4106957">nil</span>&nbsp;<span class="op" id="4106961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106965">return</span>&nbsp;<span class="num" id="4106972">0</span><span class="op" id="4106973">,</span>&nbsp;<span class="ident" id="4106975">z</span><span class="op" id="4106976">.</span><span class="ident" id="4106977">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4106982">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4106985">var</span>&nbsp;<span class="ident" id="4106989">n</span>&nbsp;<span class="builtintype" id="4106991">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4106996">//&nbsp;Write&nbsp;the&nbsp;GZIP&nbsp;header&nbsp;lazily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107030">if</span>&nbsp;<span class="op" id="4107033">!</span><span class="ident" id="4107034">z</span><span class="op" id="4107035">.</span><span class="ident" id="4107036">wroteHeader</span>&nbsp;<span class="op" id="4107048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107052">z</span><span class="op" id="4107053">.</span><span class="ident" id="4107054">wroteHeader</span>&nbsp;<span class="op" id="4107066">=</span>&nbsp;<span class="builtintype" id="4107068">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107075">z</span><span class="op" id="4107076">.</span><span class="ident" id="4107077">buf</span><span class="op" id="4107080">[</span><span class="num" id="4107081">0</span><span class="op" id="4107082">]</span>&nbsp;<span class="op" id="4107084">=</span>&nbsp;<span class="ident" id="4107086">gzipID1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107096">z</span><span class="op" id="4107097">.</span><span class="ident" id="4107098">buf</span><span class="op" id="4107101">[</span><span class="num" id="4107102">1</span><span class="op" id="4107103">]</span>&nbsp;<span class="op" id="4107105">=</span>&nbsp;<span class="ident" id="4107107">gzipID2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107117">z</span><span class="op" id="4107118">.</span><span class="ident" id="4107119">buf</span><span class="op" id="4107122">[</span><span class="num" id="4107123">2</span><span class="op" id="4107124">]</span>&nbsp;<span class="op" id="4107126">=</span>&nbsp;<span class="ident" id="4107128">gzipDeflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107142">z</span><span class="op" id="4107143">.</span><span class="ident" id="4107144">buf</span><span class="op" id="4107147">[</span><span class="num" id="4107148">3</span><span class="op" id="4107149">]</span>&nbsp;<span class="op" id="4107151">=</span>&nbsp;<span class="num" id="4107153">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107157">if</span>&nbsp;<span class="ident" id="4107160">z</span><span class="op" id="4107161">.</span><span class="ident" id="4107162">Extra</span>&nbsp;<span class="op" id="4107168">!=</span>&nbsp;<span class="ident" id="4107171">nil</span>&nbsp;<span class="op" id="4107175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107180">z</span><span class="op" id="4107181">.</span><span class="ident" id="4107182">buf</span><span class="op" id="4107185">[</span><span class="num" id="4107186">3</span><span class="op" id="4107187">]</span>&nbsp;<span class="op" id="4107189">|=</span>&nbsp;<span class="num" id="4107192">0x04</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107203">if</span>&nbsp;<span class="ident" id="4107206">z</span><span class="op" id="4107207">.</span><span class="ident" id="4107208">Name</span>&nbsp;<span class="op" id="4107213">!=</span>&nbsp;<span class="string" id="4107216">&#34;&#34;</span>&nbsp;<span class="op" id="4107219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107224">z</span><span class="op" id="4107225">.</span><span class="ident" id="4107226">buf</span><span class="op" id="4107229">[</span><span class="num" id="4107230">3</span><span class="op" id="4107231">]</span>&nbsp;<span class="op" id="4107233">|=</span>&nbsp;<span class="num" id="4107236">0x08</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107247">if</span>&nbsp;<span class="ident" id="4107250">z</span><span class="op" id="4107251">.</span><span class="ident" id="4107252">Comment</span>&nbsp;<span class="op" id="4107260">!=</span>&nbsp;<span class="string" id="4107263">&#34;&#34;</span>&nbsp;<span class="op" id="4107266">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107271">z</span><span class="op" id="4107272">.</span><span class="ident" id="4107273">buf</span><span class="op" id="4107276">[</span><span class="num" id="4107277">3</span><span class="op" id="4107278">]</span>&nbsp;<span class="op" id="4107280">|=</span>&nbsp;<span class="num" id="4107283">0x10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107294">put4</span><span class="op" id="4107298">(</span><span class="ident" id="4107299">z</span><span class="op" id="4107300">.</span><span class="ident" id="4107301">buf</span><span class="op" id="4107304">[</span><span class="num" id="4107305">4</span><span class="op" id="4107306">:</span><span class="num" id="4107307">8</span><span class="op" id="4107308">]</span><span class="op" id="4107309">,</span>&nbsp;<span class="builtintype" id="4107311">uint32</span><span class="op" id="4107317">(</span><span class="ident" id="4107318">z</span><span class="op" id="4107319">.</span><span class="ident" id="4107320">ModTime</span><span class="op" id="4107327">.</span><span class="ident" id="4107328">Unix</span><span class="op" id="4107332">(</span><span class="op" id="4107333">)</span><span class="op" id="4107334">)</span><span class="op" id="4107335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107339">if</span>&nbsp;<span class="ident" id="4107342">z</span><span class="op" id="4107343">.</span><span class="ident" id="4107344">level</span>&nbsp;<span class="op" id="4107350">==</span>&nbsp;<span class="ident" id="4107353">BestCompression</span>&nbsp;<span class="op" id="4107369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107374">z</span><span class="op" id="4107375">.</span><span class="ident" id="4107376">buf</span><span class="op" id="4107379">[</span><span class="num" id="4107380">8</span><span class="op" id="4107381">]</span>&nbsp;<span class="op" id="4107383">=</span>&nbsp;<span class="num" id="4107385">2</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107389">}</span>&nbsp;<span class="keyword" id="4107391">else</span>&nbsp;<span class="keyword" id="4107396">if</span>&nbsp;<span class="ident" id="4107399">z</span><span class="op" id="4107400">.</span><span class="ident" id="4107401">level</span>&nbsp;<span class="op" id="4107407">==</span>&nbsp;<span class="ident" id="4107410">BestSpeed</span>&nbsp;<span class="op" id="4107420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107425">z</span><span class="op" id="4107426">.</span><span class="ident" id="4107427">buf</span><span class="op" id="4107430">[</span><span class="num" id="4107431">8</span><span class="op" id="4107432">]</span>&nbsp;<span class="op" id="4107434">=</span>&nbsp;<span class="num" id="4107436">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107440">}</span>&nbsp;<span class="keyword" id="4107442">else</span>&nbsp;<span class="op" id="4107447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107452">z</span><span class="op" id="4107453">.</span><span class="ident" id="4107454">buf</span><span class="op" id="4107457">[</span><span class="num" id="4107458">8</span><span class="op" id="4107459">]</span>&nbsp;<span class="op" id="4107461">=</span>&nbsp;<span class="num" id="4107463">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107467">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107471">z</span><span class="op" id="4107472">.</span><span class="ident" id="4107473">buf</span><span class="op" id="4107476">[</span><span class="num" id="4107477">9</span><span class="op" id="4107478">]</span>&nbsp;<span class="op" id="4107480">=</span>&nbsp;<span class="ident" id="4107482">z</span><span class="op" id="4107483">.</span><span class="ident" id="4107484">OS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107489">n</span><span class="op" id="4107490">,</span>&nbsp;<span class="ident" id="4107492">z</span><span class="op" id="4107493">.</span><span class="ident" id="4107494">err</span>&nbsp;<span class="op" id="4107498">=</span>&nbsp;<span class="ident" id="4107500">z</span><span class="op" id="4107501">.</span><span class="ident" id="4107502">w</span><span class="op" id="4107503">.</span><span class="ident" id="4107504">Write</span><span class="op" id="4107509">(</span><span class="ident" id="4107510">z</span><span class="op" id="4107511">.</span><span class="ident" id="4107512">buf</span><span class="op" id="4107515">[</span><span class="num" id="4107516">0</span><span class="op" id="4107517">:</span><span class="num" id="4107518">10</span><span class="op" id="4107520">]</span><span class="op" id="4107521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107525">if</span>&nbsp;<span class="ident" id="4107528">z</span><span class="op" id="4107529">.</span><span class="ident" id="4107530">err</span>&nbsp;<span class="op" id="4107534">!=</span>&nbsp;<span class="ident" id="4107537">nil</span>&nbsp;<span class="op" id="4107541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107546">return</span>&nbsp;<span class="ident" id="4107553">n</span><span class="op" id="4107554">,</span>&nbsp;<span class="ident" id="4107556">z</span><span class="op" id="4107557">.</span><span class="ident" id="4107558">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107564">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107568">if</span>&nbsp;<span class="ident" id="4107571">z</span><span class="op" id="4107572">.</span><span class="ident" id="4107573">Extra</span>&nbsp;<span class="op" id="4107579">!=</span>&nbsp;<span class="ident" id="4107582">nil</span>&nbsp;<span class="op" id="4107586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107591">z</span><span class="op" id="4107592">.</span><span class="ident" id="4107593">err</span>&nbsp;<span class="op" id="4107597">=</span>&nbsp;<span class="ident" id="4107599">z</span><span class="op" id="4107600">.</span><span class="ident" id="4107601">writeBytes</span><span class="op" id="4107611">(</span><span class="ident" id="4107612">z</span><span class="op" id="4107613">.</span><span class="ident" id="4107614">Extra</span><span class="op" id="4107619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107624">if</span>&nbsp;<span class="ident" id="4107627">z</span><span class="op" id="4107628">.</span><span class="ident" id="4107629">err</span>&nbsp;<span class="op" id="4107633">!=</span>&nbsp;<span class="ident" id="4107636">nil</span>&nbsp;<span class="op" id="4107640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107646">return</span>&nbsp;<span class="ident" id="4107653">n</span><span class="op" id="4107654">,</span>&nbsp;<span class="ident" id="4107656">z</span><span class="op" id="4107657">.</span><span class="ident" id="4107658">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107665">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107673">if</span>&nbsp;<span class="ident" id="4107676">z</span><span class="op" id="4107677">.</span><span class="ident" id="4107678">Name</span>&nbsp;<span class="op" id="4107683">!=</span>&nbsp;<span class="string" id="4107686">&#34;&#34;</span>&nbsp;<span class="op" id="4107689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107694">z</span><span class="op" id="4107695">.</span><span class="ident" id="4107696">err</span>&nbsp;<span class="op" id="4107700">=</span>&nbsp;<span class="ident" id="4107702">z</span><span class="op" id="4107703">.</span><span class="ident" id="4107704">writeString</span><span class="op" id="4107715">(</span><span class="ident" id="4107716">z</span><span class="op" id="4107717">.</span><span class="ident" id="4107718">Name</span><span class="op" id="4107722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107727">if</span>&nbsp;<span class="ident" id="4107730">z</span><span class="op" id="4107731">.</span><span class="ident" id="4107732">err</span>&nbsp;<span class="op" id="4107736">!=</span>&nbsp;<span class="ident" id="4107739">nil</span>&nbsp;<span class="op" id="4107743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107749">return</span>&nbsp;<span class="ident" id="4107756">n</span><span class="op" id="4107757">,</span>&nbsp;<span class="ident" id="4107759">z</span><span class="op" id="4107760">.</span><span class="ident" id="4107761">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107776">if</span>&nbsp;<span class="ident" id="4107779">z</span><span class="op" id="4107780">.</span><span class="ident" id="4107781">Comment</span>&nbsp;<span class="op" id="4107789">!=</span>&nbsp;<span class="string" id="4107792">&#34;&#34;</span>&nbsp;<span class="op" id="4107795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107800">z</span><span class="op" id="4107801">.</span><span class="ident" id="4107802">err</span>&nbsp;<span class="op" id="4107806">=</span>&nbsp;<span class="ident" id="4107808">z</span><span class="op" id="4107809">.</span><span class="ident" id="4107810">writeString</span><span class="op" id="4107821">(</span><span class="ident" id="4107822">z</span><span class="op" id="4107823">.</span><span class="ident" id="4107824">Comment</span><span class="op" id="4107831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107836">if</span>&nbsp;<span class="ident" id="4107839">z</span><span class="op" id="4107840">.</span><span class="ident" id="4107841">err</span>&nbsp;<span class="op" id="4107845">!=</span>&nbsp;<span class="ident" id="4107848">nil</span>&nbsp;<span class="op" id="4107852">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107858">return</span>&nbsp;<span class="ident" id="4107865">n</span><span class="op" id="4107866">,</span>&nbsp;<span class="ident" id="4107868">z</span><span class="op" id="4107869">.</span><span class="ident" id="4107870">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4107885">if</span>&nbsp;<span class="ident" id="4107888">z</span><span class="op" id="4107889">.</span><span class="ident" id="4107890">compressor</span>&nbsp;<span class="op" id="4107901">==</span>&nbsp;<span class="ident" id="4107904">nil</span>&nbsp;<span class="op" id="4107908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107913">z</span><span class="op" id="4107914">.</span><span class="ident" id="4107915">compressor</span><span class="op" id="4107925">,</span>&nbsp;<span class="ident" id="4107927">_</span>&nbsp;<span class="op" id="4107929">=</span>&nbsp;<span class="ident" id="4107931">flate</span><span class="op" id="4107936">.</span><span class="ident" id="4107937">NewWriter</span><span class="op" id="4107946">(</span><span class="ident" id="4107947">z</span><span class="op" id="4107948">.</span><span class="ident" id="4107949">w</span><span class="op" id="4107950">,</span>&nbsp;<span class="ident" id="4107952">z</span><span class="op" id="4107953">.</span><span class="ident" id="4107954">level</span><span class="op" id="4107959">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4107966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107969">z</span><span class="op" id="4107970">.</span><span class="ident" id="4107971">size</span>&nbsp;<span class="op" id="4107976">+=</span>&nbsp;<span class="builtintype" id="4107979">uint32</span><span class="op" id="4107985">(</span><span class="builtinfunc" id="4107986">len</span><span class="op" id="4107989">(</span><span class="ident" id="4107990">p</span><span class="op" id="4107991">)</span><span class="op" id="4107992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4107995">z</span><span class="op" id="4107996">.</span><span class="ident" id="4107997">digest</span><span class="op" id="4108003">.</span><span class="ident" id="4108004">Write</span><span class="op" id="4108009">(</span><span class="ident" id="4108010">p</span><span class="op" id="4108011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108014">n</span><span class="op" id="4108015">,</span>&nbsp;<span class="ident" id="4108017">z</span><span class="op" id="4108018">.</span><span class="ident" id="4108019">err</span>&nbsp;<span class="op" id="4108023">=</span>&nbsp;<span class="ident" id="4108025">z</span><span class="op" id="4108026">.</span><span class="ident" id="4108027">compressor</span><span class="op" id="4108037">.</span><span class="ident" id="4108038">Write</span><span class="op" id="4108043">(</span><span class="ident" id="4108044">p</span><span class="op" id="4108045">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108048">return</span>&nbsp;<span class="ident" id="4108055">n</span><span class="op" id="4108056">,</span>&nbsp;<span class="ident" id="4108058">z</span><span class="op" id="4108059">.</span><span class="ident" id="4108060">err</span><br>
<span class="lineno"></span><span class="op" id="4108064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4108067">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;compressed&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="4108138">//</span><br>
<span class="lineno">225</span><span class="comment" id="4108141">//&nbsp;It&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;in&nbsp;compressed&nbsp;network&nbsp;protocols,&nbsp;to&nbsp;ensure&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4108212">//&nbsp;a&nbsp;remote&nbsp;reader&nbsp;has&nbsp;enough&nbsp;data&nbsp;to&nbsp;reconstruct&nbsp;a&nbsp;packet.&nbsp;Flush&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="4108283">//&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;data&nbsp;has&nbsp;been&nbsp;written.&nbsp;If&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4108348">//&nbsp;writer&nbsp;returns&nbsp;an&nbsp;error,&nbsp;Flush&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4108402">//</span><br>
<span class="lineno">230</span><span class="comment" id="4108405">//&nbsp;In&nbsp;the&nbsp;terminology&nbsp;of&nbsp;the&nbsp;zlib&nbsp;library,&nbsp;Flush&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Z_SYNC_FLUSH.</span><br>
<span class="lineno"></span><span class="keyword" id="4108485">func</span>&nbsp;<span class="op" id="4108490">(</span><span class="ident" id="4108491">z</span>&nbsp;<span class="op" id="4108493">*</span><span class="ident" id="4108494">Writer</span><span class="op" id="4108500">)</span>&nbsp;<span class="ident" id="4108502">Flush</span><span class="op" id="4108507">(</span><span class="op" id="4108508">)</span>&nbsp;<span class="builtintype" id="4108510">error</span>&nbsp;<span class="op" id="4108516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108519">if</span>&nbsp;<span class="ident" id="4108522">z</span><span class="op" id="4108523">.</span><span class="ident" id="4108524">err</span>&nbsp;<span class="op" id="4108528">!=</span>&nbsp;<span class="ident" id="4108531">nil</span>&nbsp;<span class="op" id="4108535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108539">return</span>&nbsp;<span class="ident" id="4108546">z</span><span class="op" id="4108547">.</span><span class="ident" id="4108548">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4108553">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108556">if</span>&nbsp;<span class="ident" id="4108559">z</span><span class="op" id="4108560">.</span><span class="ident" id="4108561">closed</span>&nbsp;<span class="op" id="4108568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108572">return</span>&nbsp;<span class="ident" id="4108579">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4108584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108587">if</span>&nbsp;<span class="op" id="4108590">!</span><span class="ident" id="4108591">z</span><span class="op" id="4108592">.</span><span class="ident" id="4108593">wroteHeader</span>&nbsp;<span class="op" id="4108605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108609">z</span><span class="op" id="4108610">.</span><span class="ident" id="4108611">Write</span><span class="op" id="4108616">(</span><span class="ident" id="4108617">nil</span><span class="op" id="4108620">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108624">if</span>&nbsp;<span class="ident" id="4108627">z</span><span class="op" id="4108628">.</span><span class="ident" id="4108629">err</span>&nbsp;<span class="op" id="4108633">!=</span>&nbsp;<span class="ident" id="4108636">nil</span>&nbsp;<span class="op" id="4108640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108645">return</span>&nbsp;<span class="ident" id="4108652">z</span><span class="op" id="4108653">.</span><span class="ident" id="4108654">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4108660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4108663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108666">z</span><span class="op" id="4108667">.</span><span class="ident" id="4108668">err</span>&nbsp;<span class="op" id="4108672">=</span>&nbsp;<span class="ident" id="4108674">z</span><span class="op" id="4108675">.</span><span class="ident" id="4108676">compressor</span><span class="op" id="4108686">.</span><span class="ident" id="4108687">Flush</span><span class="op" id="4108692">(</span><span class="op" id="4108693">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108696">return</span>&nbsp;<span class="ident" id="4108703">z</span><span class="op" id="4108704">.</span><span class="ident" id="4108705">err</span><br>
<span class="lineno"></span><span class="op" id="4108709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4108712">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4108786">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">250</span><span class="keyword" id="4108845">func</span>&nbsp;<span class="op" id="4108850">(</span><span class="ident" id="4108851">z</span>&nbsp;<span class="op" id="4108853">*</span><span class="ident" id="4108854">Writer</span><span class="op" id="4108860">)</span>&nbsp;<span class="ident" id="4108862">Close</span><span class="op" id="4108867">(</span><span class="op" id="4108868">)</span>&nbsp;<span class="builtintype" id="4108870">error</span>&nbsp;<span class="op" id="4108876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108879">if</span>&nbsp;<span class="ident" id="4108882">z</span><span class="op" id="4108883">.</span><span class="ident" id="4108884">err</span>&nbsp;<span class="op" id="4108888">!=</span>&nbsp;<span class="ident" id="4108891">nil</span>&nbsp;<span class="op" id="4108895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108899">return</span>&nbsp;<span class="ident" id="4108906">z</span><span class="op" id="4108907">.</span><span class="ident" id="4108908">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4108913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108916">if</span>&nbsp;<span class="ident" id="4108919">z</span><span class="op" id="4108920">.</span><span class="ident" id="4108921">closed</span>&nbsp;<span class="op" id="4108928">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108932">return</span>&nbsp;<span class="ident" id="4108939">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4108944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108947">z</span><span class="op" id="4108948">.</span><span class="ident" id="4108949">closed</span>&nbsp;<span class="op" id="4108956">=</span>&nbsp;<span class="builtintype" id="4108958">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4108964">if</span>&nbsp;<span class="op" id="4108967">!</span><span class="ident" id="4108968">z</span><span class="op" id="4108969">.</span><span class="ident" id="4108970">wroteHeader</span>&nbsp;<span class="op" id="4108982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4108986">z</span><span class="op" id="4108987">.</span><span class="ident" id="4108988">Write</span><span class="op" id="4108993">(</span><span class="ident" id="4108994">nil</span><span class="op" id="4108997">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109001">if</span>&nbsp;<span class="ident" id="4109004">z</span><span class="op" id="4109005">.</span><span class="ident" id="4109006">err</span>&nbsp;<span class="op" id="4109010">!=</span>&nbsp;<span class="ident" id="4109013">nil</span>&nbsp;<span class="op" id="4109017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109022">return</span>&nbsp;<span class="ident" id="4109029">z</span><span class="op" id="4109030">.</span><span class="ident" id="4109031">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4109037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4109040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109043">z</span><span class="op" id="4109044">.</span><span class="ident" id="4109045">err</span>&nbsp;<span class="op" id="4109049">=</span>&nbsp;<span class="ident" id="4109051">z</span><span class="op" id="4109052">.</span><span class="ident" id="4109053">compressor</span><span class="op" id="4109063">.</span><span class="ident" id="4109064">Close</span><span class="op" id="4109069">(</span><span class="op" id="4109070">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109073">if</span>&nbsp;<span class="ident" id="4109076">z</span><span class="op" id="4109077">.</span><span class="ident" id="4109078">err</span>&nbsp;<span class="op" id="4109082">!=</span>&nbsp;<span class="ident" id="4109085">nil</span>&nbsp;<span class="op" id="4109089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109093">return</span>&nbsp;<span class="ident" id="4109100">z</span><span class="op" id="4109101">.</span><span class="ident" id="4109102">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4109107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109110">put4</span><span class="op" id="4109114">(</span><span class="ident" id="4109115">z</span><span class="op" id="4109116">.</span><span class="ident" id="4109117">buf</span><span class="op" id="4109120">[</span><span class="num" id="4109121">0</span><span class="op" id="4109122">:</span><span class="num" id="4109123">4</span><span class="op" id="4109124">]</span><span class="op" id="4109125">,</span>&nbsp;<span class="ident" id="4109127">z</span><span class="op" id="4109128">.</span><span class="ident" id="4109129">digest</span><span class="op" id="4109135">.</span><span class="ident" id="4109136">Sum32</span><span class="op" id="4109141">(</span><span class="op" id="4109142">)</span><span class="op" id="4109143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109146">put4</span><span class="op" id="4109150">(</span><span class="ident" id="4109151">z</span><span class="op" id="4109152">.</span><span class="ident" id="4109153">buf</span><span class="op" id="4109156">[</span><span class="num" id="4109157">4</span><span class="op" id="4109158">:</span><span class="num" id="4109159">8</span><span class="op" id="4109160">]</span><span class="op" id="4109161">,</span>&nbsp;<span class="ident" id="4109163">z</span><span class="op" id="4109164">.</span><span class="ident" id="4109165">size</span><span class="op" id="4109169">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4109172">_</span><span class="op" id="4109173">,</span>&nbsp;<span class="ident" id="4109175">z</span><span class="op" id="4109176">.</span><span class="ident" id="4109177">err</span>&nbsp;<span class="op" id="4109181">=</span>&nbsp;<span class="ident" id="4109183">z</span><span class="op" id="4109184">.</span><span class="ident" id="4109185">w</span><span class="op" id="4109186">.</span><span class="ident" id="4109187">Write</span><span class="op" id="4109192">(</span><span class="ident" id="4109193">z</span><span class="op" id="4109194">.</span><span class="ident" id="4109195">buf</span><span class="op" id="4109198">[</span><span class="num" id="4109199">0</span><span class="op" id="4109200">:</span><span class="num" id="4109201">8</span><span class="op" id="4109202">]</span><span class="op" id="4109203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4109206">return</span>&nbsp;<span class="ident" id="4109213">z</span><span class="op" id="4109214">.</span><span class="ident" id="4109215">err</span><br>
<span class="lineno"></span><span class="op" id="4109219">}</span>
</div>
</body>
</html>
