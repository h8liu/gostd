<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html" class="current">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6932830">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6932885">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6932939">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6932990">//&nbsp;Tests&nbsp;for&nbsp;CGI&nbsp;(the&nbsp;child&nbsp;process&nbsp;perspective)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6933040">package</span>&nbsp;<span class="ident" id="6933048">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6933053">import</span>&nbsp;<span class="op" id="6933060">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6933063">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6933073">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6933076">func</span>&nbsp;<span class="ident" id="6933081">TestRequest</span><span class="op" id="6933092">(</span><span class="ident" id="6933093">t</span>&nbsp;<span class="op" id="6933095">*</span><span class="ident" id="6933096">testing</span><span class="op" id="6933103">.</span><span class="ident" id="6933104">T</span><span class="op" id="6933105">)</span>&nbsp;<span class="op" id="6933107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933110">env</span>&nbsp;<span class="op" id="6933114">:=</span>&nbsp;<span class="keyword" id="6933117">map</span><span class="op" id="6933120">[</span><span class="builtintype" id="6933121">string</span><span class="op" id="6933127">]</span><span class="builtintype" id="6933128">string</span><span class="op" id="6933134">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6933138">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6933155">:</span>&nbsp;<span class="string" id="6933157">&#34;HTTP/1.1&#34;</span><span class="op" id="6933167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6933171">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6933187">:</span>&nbsp;&nbsp;<span class="string" id="6933190">&#34;GET&#34;</span><span class="op" id="6933195">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6933199">&#34;HTTP_HOST&#34;</span><span class="op" id="6933210">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6933218">&#34;example.com&#34;</span><span class="op" id="6933231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6933235">&#34;HTTP_REFERER&#34;</span><span class="op" id="6933249">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6933254">&#34;elsewhere&#34;</span><span class="op" id="6933265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6933269">&#34;HTTP_USER_AGENT&#34;</span><span class="op" id="6933286">:</span>&nbsp;<span class="string" id="6933288">&#34;goclient&#34;</span><span class="op" id="6933298">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6933302">&#34;HTTP_FOO_BAR&#34;</span><span class="op" id="6933316">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6933321">&#34;baz&#34;</span><span class="op" id="6933326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6933330">&#34;REQUEST_URI&#34;</span><span class="op" id="6933343">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6933349">&#34;/path?a=b&#34;</span><span class="op" id="6933360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6933364">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="6933380">:</span>&nbsp;&nbsp;<span class="string" id="6933383">&#34;123&#34;</span><span class="op" id="6933388">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6933392">&#34;CONTENT_TYPE&#34;</span><span class="op" id="6933406">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6933411">&#34;text/xml&#34;</span><span class="op" id="6933421">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6933425">&#34;REMOTE_ADDR&#34;</span><span class="op" id="6933438">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6933444">&#34;5.6.7.8&#34;</span><span class="op" id="6933453">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933459">req</span><span class="op" id="6933462">,</span>&nbsp;<span class="ident" id="6933464">err</span>&nbsp;<span class="op" id="6933468">:=</span>&nbsp;<span class="ident" id="6933471">RequestFromMap</span><span class="op" id="6933485">(</span><span class="ident" id="6933486">env</span><span class="op" id="6933489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933492">if</span>&nbsp;<span class="ident" id="6933495">err</span>&nbsp;<span class="op" id="6933499">!=</span>&nbsp;<span class="ident" id="6933502">nil</span>&nbsp;<span class="op" id="6933506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933510">t</span><span class="op" id="6933511">.</span><span class="ident" id="6933512">Fatalf</span><span class="op" id="6933518">(</span><span class="string" id="6933519">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6933539">,</span>&nbsp;<span class="ident" id="6933541">err</span><span class="op" id="6933544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933547">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933550">if</span>&nbsp;<span class="ident" id="6933553">g</span><span class="op" id="6933554">,</span>&nbsp;<span class="ident" id="6933556">e</span>&nbsp;<span class="op" id="6933558">:=</span>&nbsp;<span class="ident" id="6933561">req</span><span class="op" id="6933564">.</span><span class="ident" id="6933565">UserAgent</span><span class="op" id="6933574">(</span><span class="op" id="6933575">)</span><span class="op" id="6933576">,</span>&nbsp;<span class="string" id="6933578">&#34;goclient&#34;</span><span class="op" id="6933588">;</span>&nbsp;<span class="ident" id="6933590">e</span>&nbsp;<span class="op" id="6933592">!=</span>&nbsp;<span class="ident" id="6933595">g</span>&nbsp;<span class="op" id="6933597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933601">t</span><span class="op" id="6933602">.</span><span class="ident" id="6933603">Errorf</span><span class="op" id="6933609">(</span><span class="string" id="6933610">&#34;expected&nbsp;UserAgent&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6933641">,</span>&nbsp;<span class="ident" id="6933643">e</span><span class="op" id="6933644">,</span>&nbsp;<span class="ident" id="6933646">g</span><span class="op" id="6933647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933653">if</span>&nbsp;<span class="ident" id="6933656">g</span><span class="op" id="6933657">,</span>&nbsp;<span class="ident" id="6933659">e</span>&nbsp;<span class="op" id="6933661">:=</span>&nbsp;<span class="ident" id="6933664">req</span><span class="op" id="6933667">.</span><span class="ident" id="6933668">Method</span><span class="op" id="6933674">,</span>&nbsp;<span class="string" id="6933676">&#34;GET&#34;</span><span class="op" id="6933681">;</span>&nbsp;<span class="ident" id="6933683">e</span>&nbsp;<span class="op" id="6933685">!=</span>&nbsp;<span class="ident" id="6933688">g</span>&nbsp;<span class="op" id="6933690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933694">t</span><span class="op" id="6933695">.</span><span class="ident" id="6933696">Errorf</span><span class="op" id="6933702">(</span><span class="string" id="6933703">&#34;expected&nbsp;Method&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6933731">,</span>&nbsp;<span class="ident" id="6933733">e</span><span class="op" id="6933734">,</span>&nbsp;<span class="ident" id="6933736">g</span><span class="op" id="6933737">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933743">if</span>&nbsp;<span class="ident" id="6933746">g</span><span class="op" id="6933747">,</span>&nbsp;<span class="ident" id="6933749">e</span>&nbsp;<span class="op" id="6933751">:=</span>&nbsp;<span class="ident" id="6933754">req</span><span class="op" id="6933757">.</span><span class="ident" id="6933758">Header</span><span class="op" id="6933764">.</span><span class="ident" id="6933765">Get</span><span class="op" id="6933768">(</span><span class="string" id="6933769">&#34;Content-Type&#34;</span><span class="op" id="6933783">)</span><span class="op" id="6933784">,</span>&nbsp;<span class="string" id="6933786">&#34;text/xml&#34;</span><span class="op" id="6933796">;</span>&nbsp;<span class="ident" id="6933798">e</span>&nbsp;<span class="op" id="6933800">!=</span>&nbsp;<span class="ident" id="6933803">g</span>&nbsp;<span class="op" id="6933805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933809">t</span><span class="op" id="6933810">.</span><span class="ident" id="6933811">Errorf</span><span class="op" id="6933817">(</span><span class="string" id="6933818">&#34;expected&nbsp;Content-Type&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6933852">,</span>&nbsp;<span class="ident" id="6933854">e</span><span class="op" id="6933855">,</span>&nbsp;<span class="ident" id="6933857">g</span><span class="op" id="6933858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933864">if</span>&nbsp;<span class="ident" id="6933867">g</span><span class="op" id="6933868">,</span>&nbsp;<span class="ident" id="6933870">e</span>&nbsp;<span class="op" id="6933872">:=</span>&nbsp;<span class="ident" id="6933875">req</span><span class="op" id="6933878">.</span><span class="ident" id="6933879">ContentLength</span><span class="op" id="6933892">,</span>&nbsp;<span class="ident" id="6933894">int64</span><span class="op" id="6933899">(</span><span class="num" id="6933900">123</span><span class="op" id="6933903">)</span><span class="op" id="6933904">;</span>&nbsp;<span class="ident" id="6933906">e</span>&nbsp;<span class="op" id="6933908">!=</span>&nbsp;<span class="ident" id="6933911">g</span>&nbsp;<span class="op" id="6933913">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933917">t</span><span class="op" id="6933918">.</span><span class="ident" id="6933919">Errorf</span><span class="op" id="6933925">(</span><span class="string" id="6933926">&#34;expected&nbsp;ContentLength&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6933961">,</span>&nbsp;<span class="ident" id="6933963">e</span><span class="op" id="6933964">,</span>&nbsp;<span class="ident" id="6933966">g</span><span class="op" id="6933967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933973">if</span>&nbsp;<span class="ident" id="6933976">g</span><span class="op" id="6933977">,</span>&nbsp;<span class="ident" id="6933979">e</span>&nbsp;<span class="op" id="6933981">:=</span>&nbsp;<span class="ident" id="6933984">req</span><span class="op" id="6933987">.</span><span class="ident" id="6933988">Referer</span><span class="op" id="6933995">(</span><span class="op" id="6933996">)</span><span class="op" id="6933997">,</span>&nbsp;<span class="string" id="6933999">&#34;elsewhere&#34;</span><span class="op" id="6934010">;</span>&nbsp;<span class="ident" id="6934012">e</span>&nbsp;<span class="op" id="6934014">!=</span>&nbsp;<span class="ident" id="6934017">g</span>&nbsp;<span class="op" id="6934019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934023">t</span><span class="op" id="6934024">.</span><span class="ident" id="6934025">Errorf</span><span class="op" id="6934031">(</span><span class="string" id="6934032">&#34;expected&nbsp;Referer&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6934061">,</span>&nbsp;<span class="ident" id="6934063">e</span><span class="op" id="6934064">,</span>&nbsp;<span class="ident" id="6934066">g</span><span class="op" id="6934067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934070">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6934073">if</span>&nbsp;<span class="ident" id="6934076">req</span><span class="op" id="6934079">.</span><span class="ident" id="6934080">Header</span>&nbsp;<span class="op" id="6934087">==</span>&nbsp;<span class="ident" id="6934090">nil</span>&nbsp;<span class="op" id="6934094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934098">t</span><span class="op" id="6934099">.</span><span class="ident" id="6934100">Fatalf</span><span class="op" id="6934106">(</span><span class="string" id="6934107">&#34;unexpected&nbsp;nil&nbsp;Header&#34;</span><span class="op" id="6934130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6934136">if</span>&nbsp;<span class="ident" id="6934139">g</span><span class="op" id="6934140">,</span>&nbsp;<span class="ident" id="6934142">e</span>&nbsp;<span class="op" id="6934144">:=</span>&nbsp;<span class="ident" id="6934147">req</span><span class="op" id="6934150">.</span><span class="ident" id="6934151">Header</span><span class="op" id="6934157">.</span><span class="ident" id="6934158">Get</span><span class="op" id="6934161">(</span><span class="string" id="6934162">&#34;Foo-Bar&#34;</span><span class="op" id="6934171">)</span><span class="op" id="6934172">,</span>&nbsp;<span class="string" id="6934174">&#34;baz&#34;</span><span class="op" id="6934179">;</span>&nbsp;<span class="ident" id="6934181">e</span>&nbsp;<span class="op" id="6934183">!=</span>&nbsp;<span class="ident" id="6934186">g</span>&nbsp;<span class="op" id="6934188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934192">t</span><span class="op" id="6934193">.</span><span class="ident" id="6934194">Errorf</span><span class="op" id="6934200">(</span><span class="string" id="6934201">&#34;expected&nbsp;Foo-Bar&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6934230">,</span>&nbsp;<span class="ident" id="6934232">e</span><span class="op" id="6934233">,</span>&nbsp;<span class="ident" id="6934235">g</span><span class="op" id="6934236">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6934242">if</span>&nbsp;<span class="ident" id="6934245">g</span><span class="op" id="6934246">,</span>&nbsp;<span class="ident" id="6934248">e</span>&nbsp;<span class="op" id="6934250">:=</span>&nbsp;<span class="ident" id="6934253">req</span><span class="op" id="6934256">.</span><span class="ident" id="6934257">URL</span><span class="op" id="6934260">.</span><span class="ident" id="6934261">String</span><span class="op" id="6934267">(</span><span class="op" id="6934268">)</span><span class="op" id="6934269">,</span>&nbsp;<span class="string" id="6934271">&#34;http://example.com/path?a=b&#34;</span><span class="op" id="6934300">;</span>&nbsp;<span class="ident" id="6934302">e</span>&nbsp;<span class="op" id="6934304">!=</span>&nbsp;<span class="ident" id="6934307">g</span>&nbsp;<span class="op" id="6934309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934313">t</span><span class="op" id="6934314">.</span><span class="ident" id="6934315">Errorf</span><span class="op" id="6934321">(</span><span class="string" id="6934322">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6934347">,</span>&nbsp;<span class="ident" id="6934349">e</span><span class="op" id="6934350">,</span>&nbsp;<span class="ident" id="6934352">g</span><span class="op" id="6934353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6934359">if</span>&nbsp;<span class="ident" id="6934362">g</span><span class="op" id="6934363">,</span>&nbsp;<span class="ident" id="6934365">e</span>&nbsp;<span class="op" id="6934367">:=</span>&nbsp;<span class="ident" id="6934370">req</span><span class="op" id="6934373">.</span><span class="ident" id="6934374">FormValue</span><span class="op" id="6934383">(</span><span class="string" id="6934384">&#34;a&#34;</span><span class="op" id="6934387">)</span><span class="op" id="6934388">,</span>&nbsp;<span class="string" id="6934390">&#34;b&#34;</span><span class="op" id="6934393">;</span>&nbsp;<span class="ident" id="6934395">e</span>&nbsp;<span class="op" id="6934397">!=</span>&nbsp;<span class="ident" id="6934400">g</span>&nbsp;<span class="op" id="6934402">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934406">t</span><span class="op" id="6934407">.</span><span class="ident" id="6934408">Errorf</span><span class="op" id="6934414">(</span><span class="string" id="6934415">&#34;expected&nbsp;FormValue(a)&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6934449">,</span>&nbsp;<span class="ident" id="6934451">e</span><span class="op" id="6934452">,</span>&nbsp;<span class="ident" id="6934454">g</span><span class="op" id="6934455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6934461">if</span>&nbsp;<span class="ident" id="6934464">req</span><span class="op" id="6934467">.</span><span class="ident" id="6934468">Trailer</span>&nbsp;<span class="op" id="6934476">==</span>&nbsp;<span class="ident" id="6934479">nil</span>&nbsp;<span class="op" id="6934483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934487">t</span><span class="op" id="6934488">.</span><span class="ident" id="6934489">Errorf</span><span class="op" id="6934495">(</span><span class="string" id="6934496">&#34;unexpected&nbsp;nil&nbsp;Trailer&#34;</span><span class="op" id="6934520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934523">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6934526">if</span>&nbsp;<span class="ident" id="6934529">req</span><span class="op" id="6934532">.</span><span class="ident" id="6934533">TLS</span>&nbsp;<span class="op" id="6934537">!=</span>&nbsp;<span class="ident" id="6934540">nil</span>&nbsp;<span class="op" id="6934544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934548">t</span><span class="op" id="6934549">.</span><span class="ident" id="6934550">Errorf</span><span class="op" id="6934556">(</span><span class="string" id="6934557">&#34;expected&nbsp;nil&nbsp;TLS&#34;</span><span class="op" id="6934575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6934581">if</span>&nbsp;<span class="ident" id="6934584">e</span><span class="op" id="6934585">,</span>&nbsp;<span class="ident" id="6934587">g</span>&nbsp;<span class="op" id="6934589">:=</span>&nbsp;<span class="string" id="6934592">&#34;5.6.7.8:0&#34;</span><span class="op" id="6934603">,</span>&nbsp;<span class="ident" id="6934605">req</span><span class="op" id="6934608">.</span><span class="ident" id="6934609">RemoteAddr</span><span class="op" id="6934619">;</span>&nbsp;<span class="ident" id="6934621">e</span>&nbsp;<span class="op" id="6934623">!=</span>&nbsp;<span class="ident" id="6934626">g</span>&nbsp;<span class="op" id="6934628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934632">t</span><span class="op" id="6934633">.</span><span class="ident" id="6934634">Errorf</span><span class="op" id="6934640">(</span><span class="string" id="6934641">&#34;RemoteAddr:&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6934670">,</span>&nbsp;<span class="ident" id="6934672">g</span><span class="op" id="6934673">,</span>&nbsp;<span class="ident" id="6934675">e</span><span class="op" id="6934676">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934679">}</span><br>
<span class="lineno"></span><span class="op" id="6934681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6934684">func</span>&nbsp;<span class="ident" id="6934689">TestRequestWithTLS</span><span class="op" id="6934707">(</span><span class="ident" id="6934708">t</span>&nbsp;<span class="op" id="6934710">*</span><span class="ident" id="6934711">testing</span><span class="op" id="6934718">.</span><span class="ident" id="6934719">T</span><span class="op" id="6934720">)</span>&nbsp;<span class="op" id="6934722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934725">env</span>&nbsp;<span class="op" id="6934729">:=</span>&nbsp;<span class="keyword" id="6934732">map</span><span class="op" id="6934735">[</span><span class="builtintype" id="6934736">string</span><span class="op" id="6934742">]</span><span class="builtintype" id="6934743">string</span><span class="op" id="6934749">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6934753">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6934770">:</span>&nbsp;<span class="string" id="6934772">&#34;HTTP/1.1&#34;</span><span class="op" id="6934782">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6934786">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6934802">:</span>&nbsp;&nbsp;<span class="string" id="6934805">&#34;GET&#34;</span><span class="op" id="6934810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6934814">&#34;HTTP_HOST&#34;</span><span class="op" id="6934825">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6934833">&#34;example.com&#34;</span><span class="op" id="6934846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6934850">&#34;HTTP_REFERER&#34;</span><span class="op" id="6934864">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6934869">&#34;elsewhere&#34;</span><span class="op" id="6934880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6934884">&#34;REQUEST_URI&#34;</span><span class="op" id="6934897">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6934903">&#34;/path?a=b&#34;</span><span class="op" id="6934914">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6934918">&#34;CONTENT_TYPE&#34;</span><span class="op" id="6934932">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6934937">&#34;text/xml&#34;</span><span class="op" id="6934947">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6934951">&#34;HTTPS&#34;</span><span class="op" id="6934958">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6934970">&#34;1&#34;</span><span class="op" id="6934973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6934977">&#34;REMOTE_ADDR&#34;</span><span class="op" id="6934990">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6934996">&#34;5.6.7.8&#34;</span><span class="op" id="6935005">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935011">req</span><span class="op" id="6935014">,</span>&nbsp;<span class="ident" id="6935016">err</span>&nbsp;<span class="op" id="6935020">:=</span>&nbsp;<span class="ident" id="6935023">RequestFromMap</span><span class="op" id="6935037">(</span><span class="ident" id="6935038">env</span><span class="op" id="6935041">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935044">if</span>&nbsp;<span class="ident" id="6935047">err</span>&nbsp;<span class="op" id="6935051">!=</span>&nbsp;<span class="ident" id="6935054">nil</span>&nbsp;<span class="op" id="6935058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935062">t</span><span class="op" id="6935063">.</span><span class="ident" id="6935064">Fatalf</span><span class="op" id="6935070">(</span><span class="string" id="6935071">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6935091">,</span>&nbsp;<span class="ident" id="6935093">err</span><span class="op" id="6935096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935102">if</span>&nbsp;<span class="ident" id="6935105">g</span><span class="op" id="6935106">,</span>&nbsp;<span class="ident" id="6935108">e</span>&nbsp;<span class="op" id="6935110">:=</span>&nbsp;<span class="ident" id="6935113">req</span><span class="op" id="6935116">.</span><span class="ident" id="6935117">URL</span><span class="op" id="6935120">.</span><span class="ident" id="6935121">String</span><span class="op" id="6935127">(</span><span class="op" id="6935128">)</span><span class="op" id="6935129">,</span>&nbsp;<span class="string" id="6935131">&#34;https://example.com/path?a=b&#34;</span><span class="op" id="6935161">;</span>&nbsp;<span class="ident" id="6935163">e</span>&nbsp;<span class="op" id="6935165">!=</span>&nbsp;<span class="ident" id="6935168">g</span>&nbsp;<span class="op" id="6935170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935174">t</span><span class="op" id="6935175">.</span><span class="ident" id="6935176">Errorf</span><span class="op" id="6935182">(</span><span class="string" id="6935183">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6935208">,</span>&nbsp;<span class="ident" id="6935210">e</span><span class="op" id="6935211">,</span>&nbsp;<span class="ident" id="6935213">g</span><span class="op" id="6935214">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935220">if</span>&nbsp;<span class="ident" id="6935223">req</span><span class="op" id="6935226">.</span><span class="ident" id="6935227">TLS</span>&nbsp;<span class="op" id="6935231">==</span>&nbsp;<span class="ident" id="6935234">nil</span>&nbsp;<span class="op" id="6935238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935242">t</span><span class="op" id="6935243">.</span><span class="ident" id="6935244">Errorf</span><span class="op" id="6935250">(</span><span class="string" id="6935251">&#34;expected&nbsp;non-nil&nbsp;TLS&#34;</span><span class="op" id="6935273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935276">}</span><br>
<span class="lineno"></span><span class="op" id="6935278">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="6935281">func</span>&nbsp;<span class="ident" id="6935286">TestRequestWithoutHost</span><span class="op" id="6935308">(</span><span class="ident" id="6935309">t</span>&nbsp;<span class="op" id="6935311">*</span><span class="ident" id="6935312">testing</span><span class="op" id="6935319">.</span><span class="ident" id="6935320">T</span><span class="op" id="6935321">)</span>&nbsp;<span class="op" id="6935323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935326">env</span>&nbsp;<span class="op" id="6935330">:=</span>&nbsp;<span class="keyword" id="6935333">map</span><span class="op" id="6935336">[</span><span class="builtintype" id="6935337">string</span><span class="op" id="6935343">]</span><span class="builtintype" id="6935344">string</span><span class="op" id="6935350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6935354">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6935371">:</span>&nbsp;<span class="string" id="6935373">&#34;HTTP/1.1&#34;</span><span class="op" id="6935383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6935387">&#34;HTTP_HOST&#34;</span><span class="op" id="6935398">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6935406">&#34;&#34;</span><span class="op" id="6935408">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6935412">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6935428">:</span>&nbsp;&nbsp;<span class="string" id="6935431">&#34;GET&#34;</span><span class="op" id="6935436">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6935440">&#34;REQUEST_URI&#34;</span><span class="op" id="6935453">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6935459">&#34;/path?a=b&#34;</span><span class="op" id="6935470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6935474">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="6935490">:</span>&nbsp;&nbsp;<span class="string" id="6935493">&#34;123&#34;</span><span class="op" id="6935498">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935504">req</span><span class="op" id="6935507">,</span>&nbsp;<span class="ident" id="6935509">err</span>&nbsp;<span class="op" id="6935513">:=</span>&nbsp;<span class="ident" id="6935516">RequestFromMap</span><span class="op" id="6935530">(</span><span class="ident" id="6935531">env</span><span class="op" id="6935534">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935537">if</span>&nbsp;<span class="ident" id="6935540">err</span>&nbsp;<span class="op" id="6935544">!=</span>&nbsp;<span class="ident" id="6935547">nil</span>&nbsp;<span class="op" id="6935551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935555">t</span><span class="op" id="6935556">.</span><span class="ident" id="6935557">Fatalf</span><span class="op" id="6935563">(</span><span class="string" id="6935564">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6935584">,</span>&nbsp;<span class="ident" id="6935586">err</span><span class="op" id="6935589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935595">if</span>&nbsp;<span class="ident" id="6935598">req</span><span class="op" id="6935601">.</span><span class="ident" id="6935602">URL</span>&nbsp;<span class="op" id="6935606">==</span>&nbsp;<span class="ident" id="6935609">nil</span>&nbsp;<span class="op" id="6935613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935617">t</span><span class="op" id="6935618">.</span><span class="ident" id="6935619">Fatalf</span><span class="op" id="6935625">(</span><span class="string" id="6935626">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="6935646">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935652">if</span>&nbsp;<span class="ident" id="6935655">g</span><span class="op" id="6935656">,</span>&nbsp;<span class="ident" id="6935658">e</span>&nbsp;<span class="op" id="6935660">:=</span>&nbsp;<span class="ident" id="6935663">req</span><span class="op" id="6935666">.</span><span class="ident" id="6935667">URL</span><span class="op" id="6935670">.</span><span class="ident" id="6935671">String</span><span class="op" id="6935677">(</span><span class="op" id="6935678">)</span><span class="op" id="6935679">,</span>&nbsp;<span class="string" id="6935681">&#34;/path?a=b&#34;</span><span class="op" id="6935692">;</span>&nbsp;<span class="ident" id="6935694">e</span>&nbsp;<span class="op" id="6935696">!=</span>&nbsp;<span class="ident" id="6935699">g</span>&nbsp;<span class="op" id="6935701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935705">t</span><span class="op" id="6935706">.</span><span class="ident" id="6935707">Errorf</span><span class="op" id="6935713">(</span><span class="string" id="6935714">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6935733">,</span>&nbsp;<span class="ident" id="6935735">g</span><span class="op" id="6935736">,</span>&nbsp;<span class="ident" id="6935738">e</span><span class="op" id="6935739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935742">}</span><br>
<span class="lineno"></span><span class="op" id="6935744">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="6935747">func</span>&nbsp;<span class="ident" id="6935752">TestRequestWithoutRequestURI</span><span class="op" id="6935780">(</span><span class="ident" id="6935781">t</span>&nbsp;<span class="op" id="6935783">*</span><span class="ident" id="6935784">testing</span><span class="op" id="6935791">.</span><span class="ident" id="6935792">T</span><span class="op" id="6935793">)</span>&nbsp;<span class="op" id="6935795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935798">env</span>&nbsp;<span class="op" id="6935802">:=</span>&nbsp;<span class="keyword" id="6935805">map</span><span class="op" id="6935808">[</span><span class="builtintype" id="6935809">string</span><span class="op" id="6935815">]</span><span class="builtintype" id="6935816">string</span><span class="op" id="6935822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6935826">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6935843">:</span>&nbsp;<span class="string" id="6935845">&#34;HTTP/1.1&#34;</span><span class="op" id="6935855">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6935859">&#34;HTTP_HOST&#34;</span><span class="op" id="6935870">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6935878">&#34;example.com&#34;</span><span class="op" id="6935891">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6935895">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6935911">:</span>&nbsp;&nbsp;<span class="string" id="6935914">&#34;GET&#34;</span><span class="op" id="6935919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6935923">&#34;SCRIPT_NAME&#34;</span><span class="op" id="6935936">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6935942">&#34;/dir/scriptname&#34;</span><span class="op" id="6935959">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6935963">&#34;PATH_INFO&#34;</span><span class="op" id="6935974">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6935982">&#34;/p1/p2&#34;</span><span class="op" id="6935990">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6935994">&#34;QUERY_STRING&#34;</span><span class="op" id="6936008">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6936013">&#34;a=1&amp;b=2&#34;</span><span class="op" id="6936022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6936026">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="6936042">:</span>&nbsp;&nbsp;<span class="string" id="6936045">&#34;123&#34;</span><span class="op" id="6936050">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936056">req</span><span class="op" id="6936059">,</span>&nbsp;<span class="ident" id="6936061">err</span>&nbsp;<span class="op" id="6936065">:=</span>&nbsp;<span class="ident" id="6936068">RequestFromMap</span><span class="op" id="6936082">(</span><span class="ident" id="6936083">env</span><span class="op" id="6936086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936089">if</span>&nbsp;<span class="ident" id="6936092">err</span>&nbsp;<span class="op" id="6936096">!=</span>&nbsp;<span class="ident" id="6936099">nil</span>&nbsp;<span class="op" id="6936103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936107">t</span><span class="op" id="6936108">.</span><span class="ident" id="6936109">Fatalf</span><span class="op" id="6936115">(</span><span class="string" id="6936116">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6936136">,</span>&nbsp;<span class="ident" id="6936138">err</span><span class="op" id="6936141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936144">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936147">if</span>&nbsp;<span class="ident" id="6936150">req</span><span class="op" id="6936153">.</span><span class="ident" id="6936154">URL</span>&nbsp;<span class="op" id="6936158">==</span>&nbsp;<span class="ident" id="6936161">nil</span>&nbsp;<span class="op" id="6936165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936169">t</span><span class="op" id="6936170">.</span><span class="ident" id="6936171">Fatalf</span><span class="op" id="6936177">(</span><span class="string" id="6936178">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="6936198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936204">if</span>&nbsp;<span class="ident" id="6936207">g</span><span class="op" id="6936208">,</span>&nbsp;<span class="ident" id="6936210">e</span>&nbsp;<span class="op" id="6936212">:=</span>&nbsp;<span class="ident" id="6936215">req</span><span class="op" id="6936218">.</span><span class="ident" id="6936219">URL</span><span class="op" id="6936222">.</span><span class="ident" id="6936223">String</span><span class="op" id="6936229">(</span><span class="op" id="6936230">)</span><span class="op" id="6936231">,</span>&nbsp;<span class="string" id="6936233">&#34;http://example.com/dir/scriptname/p1/p2?a=1&amp;b=2&#34;</span><span class="op" id="6936282">;</span>&nbsp;<span class="ident" id="6936284">e</span>&nbsp;<span class="op" id="6936286">!=</span>&nbsp;<span class="ident" id="6936289">g</span>&nbsp;<span class="op" id="6936291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936295">t</span><span class="op" id="6936296">.</span><span class="ident" id="6936297">Errorf</span><span class="op" id="6936303">(</span><span class="string" id="6936304">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6936323">,</span>&nbsp;<span class="ident" id="6936325">g</span><span class="op" id="6936326">,</span>&nbsp;<span class="ident" id="6936328">e</span><span class="op" id="6936329">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936332">}</span><br>
<span class="lineno"></span><span class="op" id="6936334">}</span>
</div>
</body>
</html>
