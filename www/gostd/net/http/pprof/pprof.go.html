<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/pprof</h2>
<ul>
<li><a href="/gostd/net/http/pprof/pprof.go.html" class="current">pprof.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2956293">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2956349">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2956403">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2956454">//&nbsp;Package&nbsp;pprof&nbsp;serves&nbsp;via&nbsp;its&nbsp;HTTP&nbsp;server&nbsp;runtime&nbsp;profiling&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="2956521">//&nbsp;in&nbsp;the&nbsp;format&nbsp;expected&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="2956580">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="2956621">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="comment" id="2956668">//</span><br>
<span class="lineno">10</span><span class="comment" id="2956671">//&nbsp;The&nbsp;package&nbsp;is&nbsp;typically&nbsp;only&nbsp;imported&nbsp;for&nbsp;the&nbsp;side&nbsp;effect&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2956736">//&nbsp;registering&nbsp;its&nbsp;HTTP&nbsp;handlers.</span><br>
<span class="lineno"></span><span class="comment" id="2956770">//&nbsp;The&nbsp;handled&nbsp;paths&nbsp;all&nbsp;begin&nbsp;with&nbsp;/debug/pprof/.</span><br>
<span class="lineno"></span><span class="comment" id="2956821">//</span><br>
<span class="lineno"></span><span class="comment" id="2956824">//&nbsp;To&nbsp;use&nbsp;pprof,&nbsp;link&nbsp;this&nbsp;package&nbsp;into&nbsp;your&nbsp;program:</span><br>
<span class="lineno">15</span><span class="comment" id="2956878">//&nbsp;&nbsp;&nbsp;&nbsp;import&nbsp;_&nbsp;&#34;net/http/pprof&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2956907">//</span><br>
<span class="lineno"></span><span class="comment" id="2956910">//&nbsp;If&nbsp;your&nbsp;application&nbsp;is&nbsp;not&nbsp;already&nbsp;running&nbsp;an&nbsp;http&nbsp;server,&nbsp;you</span><br>
<span class="lineno"></span><span class="comment" id="2956976">//&nbsp;need&nbsp;to&nbsp;start&nbsp;one.&nbsp;&nbsp;Add&nbsp;&#34;net/http&#34;&nbsp;and&nbsp;&#34;log&#34;&nbsp;to&nbsp;your&nbsp;imports&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2957044">//&nbsp;the&nbsp;following&nbsp;code&nbsp;to&nbsp;your&nbsp;main&nbsp;function:</span><br>
<span class="lineno">20</span><span class="comment" id="2957089">//</span><br>
<span class="lineno"></span><span class="comment" id="2957092">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;func()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="2957108">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.Println(http.ListenAndServe(&#34;localhost:6060&#34;,&nbsp;nil))</span><br>
<span class="lineno"></span><span class="comment" id="2957169">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}()</span><br>
<span class="lineno"></span><span class="comment" id="2957177">//</span><br>
<span class="lineno">25</span><span class="comment" id="2957180">//&nbsp;Then&nbsp;use&nbsp;the&nbsp;pprof&nbsp;tool&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;heap&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="2957236">//</span><br>
<span class="lineno"></span><span class="comment" id="2957239">//&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/heap</span><br>
<span class="lineno"></span><span class="comment" id="2957295">//</span><br>
<span class="lineno"></span><span class="comment" id="2957298">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;a&nbsp;30-second&nbsp;CPU&nbsp;profile:</span><br>
<span class="lineno">30</span><span class="comment" id="2957340">//</span><br>
<span class="lineno"></span><span class="comment" id="2957343">//&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/profile</span><br>
<span class="lineno"></span><span class="comment" id="2957402">//</span><br>
<span class="lineno"></span><span class="comment" id="2957405">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;goroutine&nbsp;blocking&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="2957454">//</span><br>
<span class="lineno">35</span><span class="comment" id="2957457">//&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/block</span><br>
<span class="lineno"></span><span class="comment" id="2957514">//</span><br>
<span class="lineno"></span><span class="comment" id="2957517">//&nbsp;To&nbsp;view&nbsp;all&nbsp;available&nbsp;profiles,&nbsp;open&nbsp;http://localhost:6060/debug/pprof/</span><br>
<span class="lineno"></span><span class="comment" id="2957592">//&nbsp;in&nbsp;your&nbsp;browser.</span><br>
<span class="lineno"></span><span class="comment" id="2957612">//</span><br>
<span class="lineno">40</span><span class="comment" id="2957615">//&nbsp;For&nbsp;a&nbsp;study&nbsp;of&nbsp;the&nbsp;facility&nbsp;in&nbsp;action,&nbsp;visit</span><br>
<span class="lineno"></span><span class="comment" id="2957663">//</span><br>
<span class="lineno"></span><span class="comment" id="2957666">//&nbsp;&nbsp;&nbsp;&nbsp;http://blog.golang.org/2011/06/profiling-go-programs.html</span><br>
<span class="lineno"></span><span class="comment" id="2957727">//</span><br>
<span class="lineno"></span><span class="keyword" id="2957730">package</span>&nbsp;<span class="ident" id="2957738">pprof</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="2957745">import</span>&nbsp;<span class="op" id="2957752">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2957755">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2957764">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2957773">&#34;fmt&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2957780">&#34;html/template&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2957797">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2957803">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2957810">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2957822">&#34;os&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2957828">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2957839">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2957856">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2957867">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2957878">&#34;time&#34;</span><br>
<span class="lineno">60</span><span class="op" id="2957885">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2957888">func</span>&nbsp;<span class="ident" id="2957893">init</span><span class="op" id="2957897">(</span><span class="op" id="2957898">)</span>&nbsp;<span class="op" id="2957900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2957903">http</span><span class="op" id="2957907">.</span><span class="ident" id="2957908">Handle</span><span class="op" id="2957914">(</span><span class="string" id="2957915">&#34;/debug/pprof/&#34;</span><span class="op" id="2957930">,</span>&nbsp;<span class="ident" id="2957932">http</span><span class="op" id="2957936">.</span><span class="ident" id="2957937">HandlerFunc</span><span class="op" id="2957948">(</span><span class="ident" id="2957949">Index</span><span class="op" id="2957954">)</span><span class="op" id="2957955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2957958">http</span><span class="op" id="2957962">.</span><span class="ident" id="2957963">Handle</span><span class="op" id="2957969">(</span><span class="string" id="2957970">&#34;/debug/pprof/cmdline&#34;</span><span class="op" id="2957992">,</span>&nbsp;<span class="ident" id="2957994">http</span><span class="op" id="2957998">.</span><span class="ident" id="2957999">HandlerFunc</span><span class="op" id="2958010">(</span><span class="ident" id="2958011">Cmdline</span><span class="op" id="2958018">)</span><span class="op" id="2958019">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958022">http</span><span class="op" id="2958026">.</span><span class="ident" id="2958027">Handle</span><span class="op" id="2958033">(</span><span class="string" id="2958034">&#34;/debug/pprof/profile&#34;</span><span class="op" id="2958056">,</span>&nbsp;<span class="ident" id="2958058">http</span><span class="op" id="2958062">.</span><span class="ident" id="2958063">HandlerFunc</span><span class="op" id="2958074">(</span><span class="ident" id="2958075">Profile</span><span class="op" id="2958082">)</span><span class="op" id="2958083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958086">http</span><span class="op" id="2958090">.</span><span class="ident" id="2958091">Handle</span><span class="op" id="2958097">(</span><span class="string" id="2958098">&#34;/debug/pprof/symbol&#34;</span><span class="op" id="2958119">,</span>&nbsp;<span class="ident" id="2958121">http</span><span class="op" id="2958125">.</span><span class="ident" id="2958126">HandlerFunc</span><span class="op" id="2958137">(</span><span class="ident" id="2958138">Symbol</span><span class="op" id="2958144">)</span><span class="op" id="2958145">)</span><br>
<span class="lineno"></span><span class="op" id="2958147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2958150">//&nbsp;Cmdline&nbsp;responds&nbsp;with&nbsp;the&nbsp;running&nbsp;program&#39;s</span><br>
<span class="lineno">70</span><span class="comment" id="2958197">//&nbsp;command&nbsp;line,&nbsp;with&nbsp;arguments&nbsp;separated&nbsp;by&nbsp;NUL&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="2958253">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/cmdline.</span><br>
<span class="lineno"></span><span class="keyword" id="2958321">func</span>&nbsp;<span class="ident" id="2958326">Cmdline</span><span class="op" id="2958333">(</span><span class="ident" id="2958334">w</span>&nbsp;<span class="ident" id="2958336">http</span><span class="op" id="2958340">.</span><span class="ident" id="2958341">ResponseWriter</span><span class="op" id="2958355">,</span>&nbsp;<span class="ident" id="2958357">r</span>&nbsp;<span class="op" id="2958359">*</span><span class="ident" id="2958360">http</span><span class="op" id="2958364">.</span><span class="ident" id="2958365">Request</span><span class="op" id="2958372">)</span>&nbsp;<span class="op" id="2958374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958377">w</span><span class="op" id="2958378">.</span><span class="ident" id="2958379">Header</span><span class="op" id="2958385">(</span><span class="op" id="2958386">)</span><span class="op" id="2958387">.</span><span class="ident" id="2958388">Set</span><span class="op" id="2958391">(</span><span class="string" id="2958392">&#34;Content-Type&#34;</span><span class="op" id="2958406">,</span>&nbsp;<span class="string" id="2958408">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="2958435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958438">fmt</span><span class="op" id="2958441">.</span><span class="ident" id="2958442">Fprintf</span><span class="op" id="2958449">(</span><span class="ident" id="2958450">w</span><span class="op" id="2958451">,</span>&nbsp;<span class="ident" id="2958453">strings</span><span class="op" id="2958460">.</span><span class="ident" id="2958461">Join</span><span class="op" id="2958465">(</span><span class="ident" id="2958466">os</span><span class="op" id="2958468">.</span><span class="ident" id="2958469">Args</span><span class="op" id="2958473">,</span>&nbsp;<span class="string" id="2958475">&#34;\x00&#34;</span><span class="op" id="2958481">)</span><span class="op" id="2958482">)</span><br>
<span class="lineno">75</span><span class="op" id="2958484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2958487">//&nbsp;Profile&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;cpu&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="2958545">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/profile.</span><br>
<span class="lineno"></span><span class="keyword" id="2958613">func</span>&nbsp;<span class="ident" id="2958618">Profile</span><span class="op" id="2958625">(</span><span class="ident" id="2958626">w</span>&nbsp;<span class="ident" id="2958628">http</span><span class="op" id="2958632">.</span><span class="ident" id="2958633">ResponseWriter</span><span class="op" id="2958647">,</span>&nbsp;<span class="ident" id="2958649">r</span>&nbsp;<span class="op" id="2958651">*</span><span class="ident" id="2958652">http</span><span class="op" id="2958656">.</span><span class="ident" id="2958657">Request</span><span class="op" id="2958664">)</span>&nbsp;<span class="op" id="2958666">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958669">sec</span><span class="op" id="2958672">,</span>&nbsp;<span class="ident" id="2958674">_</span>&nbsp;<span class="op" id="2958676">:=</span>&nbsp;<span class="ident" id="2958679">strconv</span><span class="op" id="2958686">.</span><span class="ident" id="2958687">ParseInt</span><span class="op" id="2958695">(</span><span class="ident" id="2958696">r</span><span class="op" id="2958697">.</span><span class="ident" id="2958698">FormValue</span><span class="op" id="2958707">(</span><span class="string" id="2958708">&#34;seconds&#34;</span><span class="op" id="2958717">)</span><span class="op" id="2958718">,</span>&nbsp;<span class="num" id="2958720">10</span><span class="op" id="2958722">,</span>&nbsp;<span class="num" id="2958724">64</span><span class="op" id="2958726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2958729">if</span>&nbsp;<span class="ident" id="2958732">sec</span>&nbsp;<span class="op" id="2958736">==</span>&nbsp;<span class="num" id="2958739">0</span>&nbsp;<span class="op" id="2958741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958745">sec</span>&nbsp;<span class="op" id="2958749">=</span>&nbsp;<span class="num" id="2958751">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2958755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2958759">//&nbsp;Set&nbsp;Content&nbsp;Type&nbsp;assuming&nbsp;StartCPUProfile&nbsp;will&nbsp;work,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2958816">//&nbsp;because&nbsp;if&nbsp;it&nbsp;does&nbsp;it&nbsp;starts&nbsp;writing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2958858">w</span><span class="op" id="2958859">.</span><span class="ident" id="2958860">Header</span><span class="op" id="2958866">(</span><span class="op" id="2958867">)</span><span class="op" id="2958868">.</span><span class="ident" id="2958869">Set</span><span class="op" id="2958872">(</span><span class="string" id="2958873">&#34;Content-Type&#34;</span><span class="op" id="2958887">,</span>&nbsp;<span class="string" id="2958889">&#34;application/octet-stream&#34;</span><span class="op" id="2958915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2958918">if</span>&nbsp;<span class="ident" id="2958921">err</span>&nbsp;<span class="op" id="2958925">:=</span>&nbsp;<span class="ident" id="2958928">pprof</span><span class="op" id="2958933">.</span><span class="ident" id="2958934">StartCPUProfile</span><span class="op" id="2958949">(</span><span class="ident" id="2958950">w</span><span class="op" id="2958951">)</span><span class="op" id="2958952">;</span>&nbsp;<span class="ident" id="2958954">err</span>&nbsp;<span class="op" id="2958958">!=</span>&nbsp;<span class="builtintype" id="2958961">nil</span>&nbsp;<span class="op" id="2958965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2958969">//&nbsp;StartCPUProfile&nbsp;failed,&nbsp;so&nbsp;no&nbsp;writes&nbsp;yet.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2959016">//&nbsp;Can&nbsp;change&nbsp;header&nbsp;back&nbsp;to&nbsp;text&nbsp;content</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2959060">//&nbsp;and&nbsp;send&nbsp;error&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959086">w</span><span class="op" id="2959087">.</span><span class="ident" id="2959088">Header</span><span class="op" id="2959094">(</span><span class="op" id="2959095">)</span><span class="op" id="2959096">.</span><span class="ident" id="2959097">Set</span><span class="op" id="2959100">(</span><span class="string" id="2959101">&#34;Content-Type&#34;</span><span class="op" id="2959115">,</span>&nbsp;<span class="string" id="2959117">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="2959144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959148">w</span><span class="op" id="2959149">.</span><span class="ident" id="2959150">WriteHeader</span><span class="op" id="2959161">(</span><span class="ident" id="2959162">http</span><span class="op" id="2959166">.</span><span class="ident" id="2959167">StatusInternalServerError</span><span class="op" id="2959192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959196">fmt</span><span class="op" id="2959199">.</span><span class="ident" id="2959200">Fprintf</span><span class="op" id="2959207">(</span><span class="ident" id="2959208">w</span><span class="op" id="2959209">,</span>&nbsp;<span class="string" id="2959211">&#34;Could&nbsp;not&nbsp;enable&nbsp;CPU&nbsp;profiling:&nbsp;%s\n&#34;</span><span class="op" id="2959249">,</span>&nbsp;<span class="ident" id="2959251">err</span><span class="op" id="2959254">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2959258">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2959266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959269">time</span><span class="op" id="2959273">.</span><span class="ident" id="2959274">Sleep</span><span class="op" id="2959279">(</span><span class="ident" id="2959280">time</span><span class="op" id="2959284">.</span><span class="ident" id="2959285">Duration</span><span class="op" id="2959293">(</span><span class="ident" id="2959294">sec</span><span class="op" id="2959297">)</span>&nbsp;<span class="op" id="2959299">*</span>&nbsp;<span class="ident" id="2959301">time</span><span class="op" id="2959305">.</span><span class="ident" id="2959306">Second</span><span class="op" id="2959312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959315">pprof</span><span class="op" id="2959320">.</span><span class="ident" id="2959321">StopCPUProfile</span><span class="op" id="2959335">(</span><span class="op" id="2959336">)</span><br>
<span class="lineno"></span><span class="op" id="2959338">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="2959341">//&nbsp;Symbol&nbsp;looks&nbsp;up&nbsp;the&nbsp;program&nbsp;counters&nbsp;listed&nbsp;in&nbsp;the&nbsp;request,</span><br>
<span class="lineno"></span><span class="comment" id="2959404">//&nbsp;responding&nbsp;with&nbsp;a&nbsp;table&nbsp;mapping&nbsp;program&nbsp;counters&nbsp;to&nbsp;function&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="2959475">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="2959542">func</span>&nbsp;<span class="ident" id="2959547">Symbol</span><span class="op" id="2959553">(</span><span class="ident" id="2959554">w</span>&nbsp;<span class="ident" id="2959556">http</span><span class="op" id="2959560">.</span><span class="ident" id="2959561">ResponseWriter</span><span class="op" id="2959575">,</span>&nbsp;<span class="ident" id="2959577">r</span>&nbsp;<span class="op" id="2959579">*</span><span class="ident" id="2959580">http</span><span class="op" id="2959584">.</span><span class="ident" id="2959585">Request</span><span class="op" id="2959592">)</span>&nbsp;<span class="op" id="2959594">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959597">w</span><span class="op" id="2959598">.</span><span class="ident" id="2959599">Header</span><span class="op" id="2959605">(</span><span class="op" id="2959606">)</span><span class="op" id="2959607">.</span><span class="ident" id="2959608">Set</span><span class="op" id="2959611">(</span><span class="string" id="2959612">&#34;Content-Type&#34;</span><span class="op" id="2959626">,</span>&nbsp;<span class="string" id="2959628">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="2959655">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2959659">//&nbsp;We&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;whole&nbsp;POST&nbsp;body&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2959706">//&nbsp;writing&nbsp;any&nbsp;output.&nbsp;&nbsp;Buffer&nbsp;the&nbsp;output&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2959755">var</span>&nbsp;<span class="ident" id="2959759">buf</span>&nbsp;<span class="ident" id="2959763">bytes</span><span class="op" id="2959768">.</span><span class="ident" id="2959769">Buffer</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2959778">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;many&nbsp;symbols&nbsp;we&nbsp;have,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2959829">//&nbsp;do&nbsp;have&nbsp;symbol&nbsp;information.&nbsp;&nbsp;Pprof&nbsp;only&nbsp;cares&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2959887">//&nbsp;this&nbsp;number&nbsp;is&nbsp;0&nbsp;(no&nbsp;symbols&nbsp;available)&nbsp;or&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2959939">fmt</span><span class="op" id="2959942">.</span><span class="ident" id="2959943">Fprintf</span><span class="op" id="2959950">(</span><span class="op" id="2959951">&amp;</span><span class="ident" id="2959952">buf</span><span class="op" id="2959955">,</span>&nbsp;<span class="string" id="2959957">&#34;num_symbols:&nbsp;1\n&#34;</span><span class="op" id="2959975">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2959979">var</span>&nbsp;<span class="ident" id="2959983">b</span>&nbsp;<span class="op" id="2959985">*</span><span class="ident" id="2959986">bufio</span><span class="op" id="2959991">.</span><span class="ident" id="2959992">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2960000">if</span>&nbsp;<span class="ident" id="2960003">r</span><span class="op" id="2960004">.</span><span class="ident" id="2960005">Method</span>&nbsp;<span class="op" id="2960012">==</span>&nbsp;<span class="string" id="2960015">&#34;POST&#34;</span>&nbsp;<span class="op" id="2960022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960026">b</span>&nbsp;<span class="op" id="2960028">=</span>&nbsp;<span class="ident" id="2960030">bufio</span><span class="op" id="2960035">.</span><span class="ident" id="2960036">NewReader</span><span class="op" id="2960045">(</span><span class="ident" id="2960046">r</span><span class="op" id="2960047">.</span><span class="ident" id="2960048">Body</span><span class="op" id="2960052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2960055">}</span>&nbsp;<span class="keyword" id="2960057">else</span>&nbsp;<span class="op" id="2960062">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960066">b</span>&nbsp;<span class="op" id="2960068">=</span>&nbsp;<span class="ident" id="2960070">bufio</span><span class="op" id="2960075">.</span><span class="ident" id="2960076">NewReader</span><span class="op" id="2960085">(</span><span class="ident" id="2960086">strings</span><span class="op" id="2960093">.</span><span class="ident" id="2960094">NewReader</span><span class="op" id="2960103">(</span><span class="ident" id="2960104">r</span><span class="op" id="2960105">.</span><span class="ident" id="2960106">URL</span><span class="op" id="2960109">.</span><span class="ident" id="2960110">RawQuery</span><span class="op" id="2960118">)</span><span class="op" id="2960119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2960122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2960126">for</span>&nbsp;<span class="op" id="2960130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960134">word</span><span class="op" id="2960138">,</span>&nbsp;<span class="ident" id="2960140">err</span>&nbsp;<span class="op" id="2960144">:=</span>&nbsp;<span class="ident" id="2960147">b</span><span class="op" id="2960148">.</span><span class="ident" id="2960149">ReadSlice</span><span class="op" id="2960158">(</span><span class="string" id="2960159">&#39;+&#39;</span><span class="op" id="2960162">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2960166">if</span>&nbsp;<span class="ident" id="2960169">err</span>&nbsp;<span class="op" id="2960173">==</span>&nbsp;<span class="builtintype" id="2960176">nil</span>&nbsp;<span class="op" id="2960180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960185">word</span>&nbsp;<span class="op" id="2960190">=</span>&nbsp;<span class="ident" id="2960192">word</span><span class="op" id="2960196">[</span><span class="num" id="2960197">0</span>&nbsp;<span class="op" id="2960199">:</span>&nbsp;<span class="builtinfunc" id="2960201">len</span><span class="op" id="2960204">(</span><span class="ident" id="2960205">word</span><span class="op" id="2960209">)</span><span class="op" id="2960210">-</span><span class="num" id="2960211">1</span><span class="op" id="2960212">]</span>&nbsp;<span class="comment" id="2960214">//&nbsp;trim&nbsp;+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2960226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960230">pc</span><span class="op" id="2960232">,</span>&nbsp;<span class="ident" id="2960234">_</span>&nbsp;<span class="op" id="2960236">:=</span>&nbsp;<span class="ident" id="2960239">strconv</span><span class="op" id="2960246">.</span><span class="ident" id="2960247">ParseUint</span><span class="op" id="2960256">(</span><span class="builtintype" id="2960257">string</span><span class="op" id="2960263">(</span><span class="ident" id="2960264">word</span><span class="op" id="2960268">)</span><span class="op" id="2960269">,</span>&nbsp;<span class="num" id="2960271">0</span><span class="op" id="2960272">,</span>&nbsp;<span class="num" id="2960274">64</span><span class="op" id="2960276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2960280">if</span>&nbsp;<span class="ident" id="2960283">pc</span>&nbsp;<span class="op" id="2960286">!=</span>&nbsp;<span class="num" id="2960289">0</span>&nbsp;<span class="op" id="2960291">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960296">f</span>&nbsp;<span class="op" id="2960298">:=</span>&nbsp;<span class="ident" id="2960301">runtime</span><span class="op" id="2960308">.</span><span class="ident" id="2960309">FuncForPC</span><span class="op" id="2960318">(</span><span class="builtintype" id="2960319">uintptr</span><span class="op" id="2960326">(</span><span class="ident" id="2960327">pc</span><span class="op" id="2960329">)</span><span class="op" id="2960330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2960335">if</span>&nbsp;<span class="ident" id="2960338">f</span>&nbsp;<span class="op" id="2960340">!=</span>&nbsp;<span class="builtintype" id="2960343">nil</span>&nbsp;<span class="op" id="2960347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960353">fmt</span><span class="op" id="2960356">.</span><span class="ident" id="2960357">Fprintf</span><span class="op" id="2960364">(</span><span class="op" id="2960365">&amp;</span><span class="ident" id="2960366">buf</span><span class="op" id="2960369">,</span>&nbsp;<span class="string" id="2960371">&#34;%#x&nbsp;%s\n&#34;</span><span class="op" id="2960381">,</span>&nbsp;<span class="ident" id="2960383">pc</span><span class="op" id="2960385">,</span>&nbsp;<span class="ident" id="2960387">f</span><span class="op" id="2960388">.</span><span class="ident" id="2960389">Name</span><span class="op" id="2960393">(</span><span class="op" id="2960394">)</span><span class="op" id="2960395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2960400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2960404">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2960409">//&nbsp;Wait&nbsp;until&nbsp;here&nbsp;to&nbsp;check&nbsp;for&nbsp;err;&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2960457">//&nbsp;symbol&nbsp;will&nbsp;have&nbsp;an&nbsp;err&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;end&nbsp;in&nbsp;+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2960515">if</span>&nbsp;<span class="ident" id="2960518">err</span>&nbsp;<span class="op" id="2960522">!=</span>&nbsp;<span class="builtintype" id="2960525">nil</span>&nbsp;<span class="op" id="2960529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2960534">if</span>&nbsp;<span class="ident" id="2960537">err</span>&nbsp;<span class="op" id="2960541">!=</span>&nbsp;<span class="ident" id="2960544">io</span><span class="op" id="2960546">.</span><span class="ident" id="2960547">EOF</span>&nbsp;<span class="op" id="2960551">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960557">fmt</span><span class="op" id="2960560">.</span><span class="ident" id="2960561">Fprintf</span><span class="op" id="2960568">(</span><span class="op" id="2960569">&amp;</span><span class="ident" id="2960570">buf</span><span class="op" id="2960573">,</span>&nbsp;<span class="string" id="2960575">&#34;reading&nbsp;request:&nbsp;%v\n&#34;</span><span class="op" id="2960598">,</span>&nbsp;<span class="ident" id="2960600">err</span><span class="op" id="2960603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2960608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2960613">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2960621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2960624">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960628">w</span><span class="op" id="2960629">.</span><span class="ident" id="2960630">Write</span><span class="op" id="2960635">(</span><span class="ident" id="2960636">buf</span><span class="op" id="2960639">.</span><span class="ident" id="2960640">Bytes</span><span class="op" id="2960645">(</span><span class="op" id="2960646">)</span><span class="op" id="2960647">)</span><br>
<span class="lineno"></span><span class="op" id="2960649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2960652">//&nbsp;Handler&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;that&nbsp;serves&nbsp;the&nbsp;named&nbsp;profile.</span><br>
<span class="lineno">150</span><span class="keyword" id="2960718">func</span>&nbsp;<span class="ident" id="2960723">Handler</span><span class="op" id="2960730">(</span><span class="ident" id="2960731">name</span>&nbsp;<span class="builtintype" id="2960736">string</span><span class="op" id="2960742">)</span>&nbsp;<span class="ident" id="2960744">http</span><span class="op" id="2960748">.</span><span class="ident" id="2960749">Handler</span>&nbsp;<span class="op" id="2960757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2960760">return</span>&nbsp;<span class="ident" id="2960767">handler</span><span class="op" id="2960774">(</span><span class="ident" id="2960775">name</span><span class="op" id="2960779">)</span><br>
<span class="lineno"></span><span class="op" id="2960781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2960784">type</span>&nbsp;<span class="ident" id="2960789">handler</span>&nbsp;<span class="builtintype" id="2960797">string</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="2960805">func</span>&nbsp;<span class="op" id="2960810">(</span><span class="ident" id="2960811">name</span>&nbsp;<span class="ident" id="2960816">handler</span><span class="op" id="2960823">)</span>&nbsp;<span class="ident" id="2960825">ServeHTTP</span><span class="op" id="2960834">(</span><span class="ident" id="2960835">w</span>&nbsp;<span class="ident" id="2960837">http</span><span class="op" id="2960841">.</span><span class="ident" id="2960842">ResponseWriter</span><span class="op" id="2960856">,</span>&nbsp;<span class="ident" id="2960858">r</span>&nbsp;<span class="op" id="2960860">*</span><span class="ident" id="2960861">http</span><span class="op" id="2960865">.</span><span class="ident" id="2960866">Request</span><span class="op" id="2960873">)</span>&nbsp;<span class="op" id="2960875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960878">w</span><span class="op" id="2960879">.</span><span class="ident" id="2960880">Header</span><span class="op" id="2960886">(</span><span class="op" id="2960887">)</span><span class="op" id="2960888">.</span><span class="ident" id="2960889">Set</span><span class="op" id="2960892">(</span><span class="string" id="2960893">&#34;Content-Type&#34;</span><span class="op" id="2960907">,</span>&nbsp;<span class="string" id="2960909">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="2960936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960939">debug</span><span class="op" id="2960944">,</span>&nbsp;<span class="ident" id="2960946">_</span>&nbsp;<span class="op" id="2960948">:=</span>&nbsp;<span class="ident" id="2960951">strconv</span><span class="op" id="2960958">.</span><span class="ident" id="2960959">Atoi</span><span class="op" id="2960963">(</span><span class="ident" id="2960964">r</span><span class="op" id="2960965">.</span><span class="ident" id="2960966">FormValue</span><span class="op" id="2960975">(</span><span class="string" id="2960976">&#34;debug&#34;</span><span class="op" id="2960983">)</span><span class="op" id="2960984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2960987">p</span>&nbsp;<span class="op" id="2960989">:=</span>&nbsp;<span class="ident" id="2960992">pprof</span><span class="op" id="2960997">.</span><span class="ident" id="2960998">Lookup</span><span class="op" id="2961004">(</span><span class="builtintype" id="2961005">string</span><span class="op" id="2961011">(</span><span class="ident" id="2961012">name</span><span class="op" id="2961016">)</span><span class="op" id="2961017">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2961020">if</span>&nbsp;<span class="ident" id="2961023">p</span>&nbsp;<span class="op" id="2961025">==</span>&nbsp;<span class="builtintype" id="2961028">nil</span>&nbsp;<span class="op" id="2961032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2961036">w</span><span class="op" id="2961037">.</span><span class="ident" id="2961038">WriteHeader</span><span class="op" id="2961049">(</span><span class="num" id="2961050">404</span><span class="op" id="2961053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2961057">fmt</span><span class="op" id="2961060">.</span><span class="ident" id="2961061">Fprintf</span><span class="op" id="2961068">(</span><span class="ident" id="2961069">w</span><span class="op" id="2961070">,</span>&nbsp;<span class="string" id="2961072">&#34;Unknown&nbsp;profile:&nbsp;%s\n&#34;</span><span class="op" id="2961095">,</span>&nbsp;<span class="ident" id="2961097">name</span><span class="op" id="2961101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2961105">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2961113">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2961116">gc</span><span class="op" id="2961118">,</span>&nbsp;<span class="ident" id="2961120">_</span>&nbsp;<span class="op" id="2961122">:=</span>&nbsp;<span class="ident" id="2961125">strconv</span><span class="op" id="2961132">.</span><span class="ident" id="2961133">Atoi</span><span class="op" id="2961137">(</span><span class="ident" id="2961138">r</span><span class="op" id="2961139">.</span><span class="ident" id="2961140">FormValue</span><span class="op" id="2961149">(</span><span class="string" id="2961150">&#34;gc&#34;</span><span class="op" id="2961154">)</span><span class="op" id="2961155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2961158">if</span>&nbsp;<span class="ident" id="2961161">name</span>&nbsp;<span class="op" id="2961166">==</span>&nbsp;<span class="string" id="2961169">&#34;heap&#34;</span>&nbsp;<span class="op" id="2961176">&amp;&amp;</span>&nbsp;<span class="ident" id="2961179">gc</span>&nbsp;<span class="op" id="2961182">&gt;</span>&nbsp;<span class="num" id="2961184">0</span>&nbsp;<span class="op" id="2961186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2961190">runtime</span><span class="op" id="2961197">.</span><span class="ident" id="2961198">GC</span><span class="op" id="2961200">(</span><span class="op" id="2961201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2961204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2961207">p</span><span class="op" id="2961208">.</span><span class="ident" id="2961209">WriteTo</span><span class="op" id="2961216">(</span><span class="ident" id="2961217">w</span><span class="op" id="2961218">,</span>&nbsp;<span class="ident" id="2961220">debug</span><span class="op" id="2961225">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2961228">return</span><br>
<span class="lineno"></span><span class="op" id="2961235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2961238">//&nbsp;Index&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;profile&nbsp;named&nbsp;by&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="2961311">//&nbsp;For&nbsp;example,&nbsp;&#34;/debug/pprof/heap&#34;&nbsp;serves&nbsp;the&nbsp;&#34;heap&#34;&nbsp;profile.</span><br>
<span class="lineno">175</span><span class="comment" id="2961374">//&nbsp;Index&nbsp;responds&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;&#34;/debug/pprof/&#34;&nbsp;with&nbsp;an&nbsp;HTML&nbsp;page</span><br>
<span class="lineno"></span><span class="comment" id="2961443">//&nbsp;listing&nbsp;the&nbsp;available&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="2961478">func</span>&nbsp;<span class="ident" id="2961483">Index</span><span class="op" id="2961488">(</span><span class="ident" id="2961489">w</span>&nbsp;<span class="ident" id="2961491">http</span><span class="op" id="2961495">.</span><span class="ident" id="2961496">ResponseWriter</span><span class="op" id="2961510">,</span>&nbsp;<span class="ident" id="2961512">r</span>&nbsp;<span class="op" id="2961514">*</span><span class="ident" id="2961515">http</span><span class="op" id="2961519">.</span><span class="ident" id="2961520">Request</span><span class="op" id="2961527">)</span>&nbsp;<span class="op" id="2961529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2961532">if</span>&nbsp;<span class="ident" id="2961535">strings</span><span class="op" id="2961542">.</span><span class="ident" id="2961543">HasPrefix</span><span class="op" id="2961552">(</span><span class="ident" id="2961553">r</span><span class="op" id="2961554">.</span><span class="ident" id="2961555">URL</span><span class="op" id="2961558">.</span><span class="ident" id="2961559">Path</span><span class="op" id="2961563">,</span>&nbsp;<span class="string" id="2961565">&#34;/debug/pprof/&#34;</span><span class="op" id="2961580">)</span>&nbsp;<span class="op" id="2961582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2961586">name</span>&nbsp;<span class="op" id="2961591">:=</span>&nbsp;<span class="ident" id="2961594">strings</span><span class="op" id="2961601">.</span><span class="ident" id="2961602">TrimPrefix</span><span class="op" id="2961612">(</span><span class="ident" id="2961613">r</span><span class="op" id="2961614">.</span><span class="ident" id="2961615">URL</span><span class="op" id="2961618">.</span><span class="ident" id="2961619">Path</span><span class="op" id="2961623">,</span>&nbsp;<span class="string" id="2961625">&#34;/debug/pprof/&#34;</span><span class="op" id="2961640">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2961644">if</span>&nbsp;<span class="ident" id="2961647">name</span>&nbsp;<span class="op" id="2961652">!=</span>&nbsp;<span class="string" id="2961655">&#34;&#34;</span>&nbsp;<span class="op" id="2961658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2961663">handler</span><span class="op" id="2961670">(</span><span class="ident" id="2961671">name</span><span class="op" id="2961675">)</span><span class="op" id="2961676">.</span><span class="ident" id="2961677">ServeHTTP</span><span class="op" id="2961686">(</span><span class="ident" id="2961687">w</span><span class="op" id="2961688">,</span>&nbsp;<span class="ident" id="2961690">r</span><span class="op" id="2961691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2961696">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2961705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2961708">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2961712">profiles</span>&nbsp;<span class="op" id="2961721">:=</span>&nbsp;<span class="ident" id="2961724">pprof</span><span class="op" id="2961729">.</span><span class="ident" id="2961730">Profiles</span><span class="op" id="2961738">(</span><span class="op" id="2961739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2961742">if</span>&nbsp;<span class="ident" id="2961745">err</span>&nbsp;<span class="op" id="2961749">:=</span>&nbsp;<span class="ident" id="2961752">indexTmpl</span><span class="op" id="2961761">.</span><span class="ident" id="2961762">Execute</span><span class="op" id="2961769">(</span><span class="ident" id="2961770">w</span><span class="op" id="2961771">,</span>&nbsp;<span class="ident" id="2961773">profiles</span><span class="op" id="2961781">)</span><span class="op" id="2961782">;</span>&nbsp;<span class="ident" id="2961784">err</span>&nbsp;<span class="op" id="2961788">!=</span>&nbsp;<span class="builtintype" id="2961791">nil</span>&nbsp;<span class="op" id="2961795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2961799">log</span><span class="op" id="2961802">.</span><span class="ident" id="2961803">Print</span><span class="op" id="2961808">(</span><span class="ident" id="2961809">err</span><span class="op" id="2961812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2961815">}</span><br>
<span class="lineno">190</span><span class="op" id="2961817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2961820">var</span>&nbsp;<span class="ident" id="2961824">indexTmpl</span>&nbsp;<span class="op" id="2961834">=</span>&nbsp;<span class="ident" id="2961836">template</span><span class="op" id="2961844">.</span><span class="ident" id="2961845">Must</span><span class="op" id="2961849">(</span><span class="ident" id="2961850">template</span><span class="op" id="2961858">.</span><span class="ident" id="2961859">New</span><span class="op" id="2961862">(</span><span class="string" id="2961863">&#34;index&#34;</span><span class="op" id="2961870">)</span><span class="op" id="2961871">.</span><span class="ident" id="2961872">Parse</span><span class="op" id="2961877">(</span><span class="string" id="2961878">`&lt;html&gt;<br>
<span class="lineno"></span>&lt;head&gt;<br>
<span class="lineno"></span>&lt;title&gt;/debug/pprof/&lt;/title&gt;<br>
<span class="lineno">195</span>&lt;/head&gt;<br>
<span class="lineno"></span>/debug/pprof/&lt;br&gt;<br>
<span class="lineno"></span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;body&gt;<br>
<span class="lineno"></span>profiles:&lt;br&gt;<br>
<span class="lineno">200</span>&lt;table&gt;<br>
<span class="lineno"></span>{{range&nbsp;.}}<br>
<span class="lineno"></span>&lt;tr&gt;&lt;td&nbsp;align=right&gt;{{.Count}}&lt;td&gt;&lt;a&nbsp;href=&#34;/debug/pprof/{{.Name}}?debug=1&#34;&gt;{{.Name}}&lt;/a&gt;<br>
<span class="lineno"></span>{{end}}<br>
<span class="lineno"></span>&lt;/table&gt;<br>
<span class="lineno">205</span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;a&nbsp;href=&#34;/debug/pprof/goroutine?debug=2&#34;&gt;full&nbsp;goroutine&nbsp;stack&nbsp;dump&lt;/a&gt;&lt;br&gt;<br>
<span class="lineno"></span>&lt;/body&gt;<br>
<span class="lineno"></span>&lt;/html&gt;<br>
<span class="lineno"></span>`</span><span class="op" id="2962197">)</span><span class="op" id="2962198">)</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
