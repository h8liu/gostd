<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html" class="current">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5429533">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5429588">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5429642">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5429693">package</span>&nbsp;<span class="ident" id="5429701">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5429706">import</span>&nbsp;<span class="op" id="5429713">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5429716">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5429734">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5429744">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5429750">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5429763">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5429770">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5429773">//&nbsp;A&nbsp;Compressor&nbsp;returns&nbsp;a&nbsp;compressing&nbsp;writer,&nbsp;writing&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5429834">//&nbsp;provided&nbsp;writer.&nbsp;On&nbsp;Close,&nbsp;any&nbsp;pending&nbsp;data&nbsp;should&nbsp;be&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5429900">type</span>&nbsp;<span class="ident" id="5429905">Compressor</span>&nbsp;<span class="keyword" id="5429916">func</span><span class="op" id="5429920">(</span><span class="ident" id="5429921">io</span><span class="op" id="5429923">.</span><span class="ident" id="5429924">Writer</span><span class="op" id="5429930">)</span>&nbsp;<span class="op" id="5429932">(</span><span class="ident" id="5429933">io</span><span class="op" id="5429935">.</span><span class="ident" id="5429936">WriteCloser</span><span class="op" id="5429947">,</span>&nbsp;<span class="builtintype" id="5429949">error</span><span class="op" id="5429954">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5429957">//&nbsp;Decompressor&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;wraps&nbsp;a&nbsp;Reader&nbsp;with&nbsp;a&nbsp;decompressing&nbsp;Reader.</span><br>
<span class="lineno">20</span><span class="comment" id="5430036">//&nbsp;The&nbsp;decompressed&nbsp;ReadCloser&nbsp;is&nbsp;returned&nbsp;to&nbsp;callers&nbsp;who&nbsp;open&nbsp;files&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5430110">//&nbsp;within&nbsp;the&nbsp;archive.&nbsp;&nbsp;These&nbsp;callers&nbsp;are&nbsp;responsible&nbsp;for&nbsp;closing&nbsp;this&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="5430188">//&nbsp;when&nbsp;they&#39;re&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="keyword" id="5430222">type</span>&nbsp;<span class="ident" id="5430227">Decompressor</span>&nbsp;<span class="keyword" id="5430240">func</span><span class="op" id="5430244">(</span><span class="ident" id="5430245">io</span><span class="op" id="5430247">.</span><span class="ident" id="5430248">Reader</span><span class="op" id="5430254">)</span>&nbsp;<span class="ident" id="5430256">io</span><span class="op" id="5430258">.</span><span class="ident" id="5430259">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5430271">var</span>&nbsp;<span class="ident" id="5430275">flateWriterPool</span>&nbsp;<span class="ident" id="5430291">sync</span><span class="op" id="5430295">.</span><span class="ident" id="5430296">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5430302">func</span>&nbsp;<span class="ident" id="5430307">newFlateWriter</span><span class="op" id="5430321">(</span><span class="ident" id="5430322">w</span>&nbsp;<span class="ident" id="5430324">io</span><span class="op" id="5430326">.</span><span class="ident" id="5430327">Writer</span><span class="op" id="5430333">)</span>&nbsp;<span class="ident" id="5430335">io</span><span class="op" id="5430337">.</span><span class="ident" id="5430338">WriteCloser</span>&nbsp;<span class="op" id="5430350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430353">fw</span><span class="op" id="5430355">,</span>&nbsp;<span class="ident" id="5430357">ok</span>&nbsp;<span class="op" id="5430360">:=</span>&nbsp;<span class="ident" id="5430363">flateWriterPool</span><span class="op" id="5430378">.</span><span class="ident" id="5430379">Get</span><span class="op" id="5430382">(</span><span class="op" id="5430383">)</span><span class="op" id="5430384">.</span><span class="op" id="5430385">(</span><span class="op" id="5430386">*</span><span class="ident" id="5430387">flate</span><span class="op" id="5430392">.</span><span class="ident" id="5430393">Writer</span><span class="op" id="5430399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430402">if</span>&nbsp;<span class="ident" id="5430405">ok</span>&nbsp;<span class="op" id="5430408">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430412">fw</span><span class="op" id="5430414">.</span><span class="ident" id="5430415">Reset</span><span class="op" id="5430420">(</span><span class="ident" id="5430421">w</span><span class="op" id="5430422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5430425">}</span>&nbsp;<span class="keyword" id="5430427">else</span>&nbsp;<span class="op" id="5430432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430436">fw</span><span class="op" id="5430438">,</span>&nbsp;<span class="ident" id="5430440">_</span>&nbsp;<span class="op" id="5430442">=</span>&nbsp;<span class="ident" id="5430444">flate</span><span class="op" id="5430449">.</span><span class="ident" id="5430450">NewWriter</span><span class="op" id="5430459">(</span><span class="ident" id="5430460">w</span><span class="op" id="5430461">,</span>&nbsp;<span class="num" id="5430463">5</span><span class="op" id="5430464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5430467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430470">return</span>&nbsp;<span class="op" id="5430477">&amp;</span><span class="ident" id="5430478">pooledFlateWriter</span><span class="op" id="5430495">{</span><span class="ident" id="5430496">fw</span><span class="op" id="5430498">:</span>&nbsp;<span class="ident" id="5430500">fw</span><span class="op" id="5430502">}</span><br>
<span class="lineno">35</span><span class="op" id="5430504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5430507">type</span>&nbsp;<span class="ident" id="5430512">pooledFlateWriter</span>&nbsp;<span class="keyword" id="5430530">struct</span>&nbsp;<span class="op" id="5430537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430540">mu</span>&nbsp;<span class="ident" id="5430543">sync</span><span class="op" id="5430547">.</span><span class="ident" id="5430548">Mutex</span>&nbsp;<span class="comment" id="5430554">//&nbsp;guards&nbsp;Close&nbsp;and&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430581">fw</span>&nbsp;<span class="op" id="5430584">*</span><span class="ident" id="5430585">flate</span><span class="op" id="5430590">.</span><span class="ident" id="5430591">Writer</span><br>
<span class="lineno">40</span><span class="op" id="5430598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5430601">func</span>&nbsp;<span class="op" id="5430606">(</span><span class="ident" id="5430607">w</span>&nbsp;<span class="op" id="5430609">*</span><span class="ident" id="5430610">pooledFlateWriter</span><span class="op" id="5430627">)</span>&nbsp;<span class="ident" id="5430629">Write</span><span class="op" id="5430634">(</span><span class="ident" id="5430635">p</span>&nbsp;<span class="op" id="5430637">[</span><span class="op" id="5430638">]</span><span class="builtintype" id="5430639">byte</span><span class="op" id="5430643">)</span>&nbsp;<span class="op" id="5430645">(</span><span class="ident" id="5430646">n</span>&nbsp;<span class="builtintype" id="5430648">int</span><span class="op" id="5430651">,</span>&nbsp;<span class="ident" id="5430653">err</span>&nbsp;<span class="builtintype" id="5430657">error</span><span class="op" id="5430662">)</span>&nbsp;<span class="op" id="5430664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430667">w</span><span class="op" id="5430668">.</span><span class="ident" id="5430669">mu</span><span class="op" id="5430671">.</span><span class="ident" id="5430672">Lock</span><span class="op" id="5430676">(</span><span class="op" id="5430677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430680">defer</span>&nbsp;<span class="ident" id="5430686">w</span><span class="op" id="5430687">.</span><span class="ident" id="5430688">mu</span><span class="op" id="5430690">.</span><span class="ident" id="5430691">Unlock</span><span class="op" id="5430697">(</span><span class="op" id="5430698">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430701">if</span>&nbsp;<span class="ident" id="5430704">w</span><span class="op" id="5430705">.</span><span class="ident" id="5430706">fw</span>&nbsp;<span class="op" id="5430709">==</span>&nbsp;<span class="builtintype" id="5430712">nil</span>&nbsp;<span class="op" id="5430716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430720">return</span>&nbsp;<span class="num" id="5430727">0</span><span class="op" id="5430728">,</span>&nbsp;<span class="ident" id="5430730">errors</span><span class="op" id="5430736">.</span><span class="ident" id="5430737">New</span><span class="op" id="5430740">(</span><span class="string" id="5430741">&#34;Write&nbsp;after&nbsp;Close&#34;</span><span class="op" id="5430760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5430763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430766">return</span>&nbsp;<span class="ident" id="5430773">w</span><span class="op" id="5430774">.</span><span class="ident" id="5430775">fw</span><span class="op" id="5430777">.</span><span class="ident" id="5430778">Write</span><span class="op" id="5430783">(</span><span class="ident" id="5430784">p</span><span class="op" id="5430785">)</span><br>
<span class="lineno"></span><span class="op" id="5430787">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5430790">func</span>&nbsp;<span class="op" id="5430795">(</span><span class="ident" id="5430796">w</span>&nbsp;<span class="op" id="5430798">*</span><span class="ident" id="5430799">pooledFlateWriter</span><span class="op" id="5430816">)</span>&nbsp;<span class="ident" id="5430818">Close</span><span class="op" id="5430823">(</span><span class="op" id="5430824">)</span>&nbsp;<span class="builtintype" id="5430826">error</span>&nbsp;<span class="op" id="5430832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430835">w</span><span class="op" id="5430836">.</span><span class="ident" id="5430837">mu</span><span class="op" id="5430839">.</span><span class="ident" id="5430840">Lock</span><span class="op" id="5430844">(</span><span class="op" id="5430845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430848">defer</span>&nbsp;<span class="ident" id="5430854">w</span><span class="op" id="5430855">.</span><span class="ident" id="5430856">mu</span><span class="op" id="5430858">.</span><span class="ident" id="5430859">Unlock</span><span class="op" id="5430865">(</span><span class="op" id="5430866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430869">var</span>&nbsp;<span class="ident" id="5430873">err</span>&nbsp;<span class="builtintype" id="5430877">error</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430884">if</span>&nbsp;<span class="ident" id="5430887">w</span><span class="op" id="5430888">.</span><span class="ident" id="5430889">fw</span>&nbsp;<span class="op" id="5430892">!=</span>&nbsp;<span class="builtintype" id="5430895">nil</span>&nbsp;<span class="op" id="5430899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430903">err</span>&nbsp;<span class="op" id="5430907">=</span>&nbsp;<span class="ident" id="5430909">w</span><span class="op" id="5430910">.</span><span class="ident" id="5430911">fw</span><span class="op" id="5430913">.</span><span class="ident" id="5430914">Close</span><span class="op" id="5430919">(</span><span class="op" id="5430920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430924">flateWriterPool</span><span class="op" id="5430939">.</span><span class="ident" id="5430940">Put</span><span class="op" id="5430943">(</span><span class="ident" id="5430944">w</span><span class="op" id="5430945">.</span><span class="ident" id="5430946">fw</span><span class="op" id="5430948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430952">w</span><span class="op" id="5430953">.</span><span class="ident" id="5430954">fw</span>&nbsp;<span class="op" id="5430957">=</span>&nbsp;<span class="builtintype" id="5430959">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5430964">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430967">return</span>&nbsp;<span class="ident" id="5430974">err</span><br>
<span class="lineno"></span><span class="op" id="5430978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5430981">var</span>&nbsp;<span class="op" id="5430985">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430988">mu</span>&nbsp;<span class="ident" id="5430991">sync</span><span class="op" id="5430995">.</span><span class="ident" id="5430996">RWMutex</span>&nbsp;<span class="comment" id="5431004">//&nbsp;guards&nbsp;compressor&nbsp;and&nbsp;decompressor&nbsp;maps</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431049">compressors</span>&nbsp;<span class="op" id="5431061">=</span>&nbsp;<span class="keyword" id="5431063">map</span><span class="op" id="5431066">[</span><span class="builtintype" id="5431067">uint16</span><span class="op" id="5431073">]</span><span class="ident" id="5431074">Compressor</span><span class="op" id="5431084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431088">Store</span><span class="op" id="5431093">:</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431097">func</span><span class="op" id="5431101">(</span><span class="ident" id="5431102">w</span>&nbsp;<span class="ident" id="5431104">io</span><span class="op" id="5431106">.</span><span class="ident" id="5431107">Writer</span><span class="op" id="5431113">)</span>&nbsp;<span class="op" id="5431115">(</span><span class="ident" id="5431116">io</span><span class="op" id="5431118">.</span><span class="ident" id="5431119">WriteCloser</span><span class="op" id="5431130">,</span>&nbsp;<span class="builtintype" id="5431132">error</span><span class="op" id="5431137">)</span>&nbsp;<span class="op" id="5431139">{</span>&nbsp;<span class="keyword" id="5431141">return</span>&nbsp;<span class="op" id="5431148">&amp;</span><span class="ident" id="5431149">nopCloser</span><span class="op" id="5431158">{</span><span class="ident" id="5431159">w</span><span class="op" id="5431160">}</span><span class="op" id="5431161">,</span>&nbsp;<span class="builtintype" id="5431163">nil</span>&nbsp;<span class="op" id="5431167">}</span><span class="op" id="5431168">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431172">Deflate</span><span class="op" id="5431179">:</span>&nbsp;<span class="keyword" id="5431181">func</span><span class="op" id="5431185">(</span><span class="ident" id="5431186">w</span>&nbsp;<span class="ident" id="5431188">io</span><span class="op" id="5431190">.</span><span class="ident" id="5431191">Writer</span><span class="op" id="5431197">)</span>&nbsp;<span class="op" id="5431199">(</span><span class="ident" id="5431200">io</span><span class="op" id="5431202">.</span><span class="ident" id="5431203">WriteCloser</span><span class="op" id="5431214">,</span>&nbsp;<span class="builtintype" id="5431216">error</span><span class="op" id="5431221">)</span>&nbsp;<span class="op" id="5431223">{</span>&nbsp;<span class="keyword" id="5431225">return</span>&nbsp;<span class="ident" id="5431232">newFlateWriter</span><span class="op" id="5431246">(</span><span class="ident" id="5431247">w</span><span class="op" id="5431248">)</span><span class="op" id="5431249">,</span>&nbsp;<span class="builtintype" id="5431251">nil</span>&nbsp;<span class="op" id="5431255">}</span><span class="op" id="5431256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431259">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431263">decompressors</span>&nbsp;<span class="op" id="5431277">=</span>&nbsp;<span class="keyword" id="5431279">map</span><span class="op" id="5431282">[</span><span class="builtintype" id="5431283">uint16</span><span class="op" id="5431289">]</span><span class="ident" id="5431290">Decompressor</span><span class="op" id="5431302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431306">Store</span><span class="op" id="5431311">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5431315">ioutil</span><span class="op" id="5431321">.</span><span class="ident" id="5431322">NopCloser</span><span class="op" id="5431331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431335">Deflate</span><span class="op" id="5431342">:</span>&nbsp;<span class="ident" id="5431344">flate</span><span class="op" id="5431349">.</span><span class="ident" id="5431350">NewReader</span><span class="op" id="5431359">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431362">}</span><br>
<span class="lineno">75</span><span class="op" id="5431364">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5431367">//&nbsp;RegisterDecompressor&nbsp;allows&nbsp;custom&nbsp;decompressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="keyword" id="5431446">func</span>&nbsp;<span class="ident" id="5431451">RegisterDecompressor</span><span class="op" id="5431471">(</span><span class="ident" id="5431472">method</span>&nbsp;<span class="builtintype" id="5431479">uint16</span><span class="op" id="5431485">,</span>&nbsp;<span class="ident" id="5431487">d</span>&nbsp;<span class="ident" id="5431489">Decompressor</span><span class="op" id="5431501">)</span>&nbsp;<span class="op" id="5431503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431506">mu</span><span class="op" id="5431508">.</span><span class="ident" id="5431509">Lock</span><span class="op" id="5431513">(</span><span class="op" id="5431514">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431517">defer</span>&nbsp;<span class="ident" id="5431523">mu</span><span class="op" id="5431525">.</span><span class="ident" id="5431526">Unlock</span><span class="op" id="5431532">(</span><span class="op" id="5431533">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431537">if</span>&nbsp;<span class="ident" id="5431540">_</span><span class="op" id="5431541">,</span>&nbsp;<span class="ident" id="5431543">ok</span>&nbsp;<span class="op" id="5431546">:=</span>&nbsp;<span class="ident" id="5431549">decompressors</span><span class="op" id="5431562">[</span><span class="ident" id="5431563">method</span><span class="op" id="5431569">]</span><span class="op" id="5431570">;</span>&nbsp;<span class="ident" id="5431572">ok</span>&nbsp;<span class="op" id="5431575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5431579">panic</span><span class="op" id="5431584">(</span><span class="string" id="5431585">&#34;decompressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="5431618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431621">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431624">decompressors</span><span class="op" id="5431637">[</span><span class="ident" id="5431638">method</span><span class="op" id="5431644">]</span>&nbsp;<span class="op" id="5431646">=</span>&nbsp;<span class="ident" id="5431648">d</span><br>
<span class="lineno"></span><span class="op" id="5431650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5431653">//&nbsp;RegisterCompressor&nbsp;registers&nbsp;custom&nbsp;compressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="comment" id="5431731">//&nbsp;The&nbsp;common&nbsp;methods&nbsp;Store&nbsp;and&nbsp;Deflate&nbsp;are&nbsp;built&nbsp;in.</span><br>
<span class="lineno">90</span><span class="keyword" id="5431785">func</span>&nbsp;<span class="ident" id="5431790">RegisterCompressor</span><span class="op" id="5431808">(</span><span class="ident" id="5431809">method</span>&nbsp;<span class="builtintype" id="5431816">uint16</span><span class="op" id="5431822">,</span>&nbsp;<span class="ident" id="5431824">comp</span>&nbsp;<span class="ident" id="5431829">Compressor</span><span class="op" id="5431839">)</span>&nbsp;<span class="op" id="5431841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431844">mu</span><span class="op" id="5431846">.</span><span class="ident" id="5431847">Lock</span><span class="op" id="5431851">(</span><span class="op" id="5431852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431855">defer</span>&nbsp;<span class="ident" id="5431861">mu</span><span class="op" id="5431863">.</span><span class="ident" id="5431864">Unlock</span><span class="op" id="5431870">(</span><span class="op" id="5431871">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431875">if</span>&nbsp;<span class="ident" id="5431878">_</span><span class="op" id="5431879">,</span>&nbsp;<span class="ident" id="5431881">ok</span>&nbsp;<span class="op" id="5431884">:=</span>&nbsp;<span class="ident" id="5431887">compressors</span><span class="op" id="5431898">[</span><span class="ident" id="5431899">method</span><span class="op" id="5431905">]</span><span class="op" id="5431906">;</span>&nbsp;<span class="ident" id="5431908">ok</span>&nbsp;<span class="op" id="5431911">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5431915">panic</span><span class="op" id="5431920">(</span><span class="string" id="5431921">&#34;compressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="5431952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431958">compressors</span><span class="op" id="5431969">[</span><span class="ident" id="5431970">method</span><span class="op" id="5431976">]</span>&nbsp;<span class="op" id="5431978">=</span>&nbsp;<span class="ident" id="5431980">comp</span><br>
<span class="lineno"></span><span class="op" id="5431985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="5431988">func</span>&nbsp;<span class="ident" id="5431993">compressor</span><span class="op" id="5432003">(</span><span class="ident" id="5432004">method</span>&nbsp;<span class="builtintype" id="5432011">uint16</span><span class="op" id="5432017">)</span>&nbsp;<span class="ident" id="5432019">Compressor</span>&nbsp;<span class="op" id="5432030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432033">mu</span><span class="op" id="5432035">.</span><span class="ident" id="5432036">RLock</span><span class="op" id="5432041">(</span><span class="op" id="5432042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432045">defer</span>&nbsp;<span class="ident" id="5432051">mu</span><span class="op" id="5432053">.</span><span class="ident" id="5432054">RUnlock</span><span class="op" id="5432061">(</span><span class="op" id="5432062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432065">return</span>&nbsp;<span class="ident" id="5432072">compressors</span><span class="op" id="5432083">[</span><span class="ident" id="5432084">method</span><span class="op" id="5432090">]</span><br>
<span class="lineno"></span><span class="op" id="5432092">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="5432095">func</span>&nbsp;<span class="ident" id="5432100">decompressor</span><span class="op" id="5432112">(</span><span class="ident" id="5432113">method</span>&nbsp;<span class="builtintype" id="5432120">uint16</span><span class="op" id="5432126">)</span>&nbsp;<span class="ident" id="5432128">Decompressor</span>&nbsp;<span class="op" id="5432141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432144">mu</span><span class="op" id="5432146">.</span><span class="ident" id="5432147">RLock</span><span class="op" id="5432152">(</span><span class="op" id="5432153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432156">defer</span>&nbsp;<span class="ident" id="5432162">mu</span><span class="op" id="5432164">.</span><span class="ident" id="5432165">RUnlock</span><span class="op" id="5432172">(</span><span class="op" id="5432173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432176">return</span>&nbsp;<span class="ident" id="5432183">decompressors</span><span class="op" id="5432196">[</span><span class="ident" id="5432197">method</span><span class="op" id="5432203">]</span><br>
<span class="lineno">110</span><span class="op" id="5432205">}</span>
</div>
</body>
</html>
