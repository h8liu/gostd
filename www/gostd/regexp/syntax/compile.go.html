<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html" class="current">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5202317">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5202372">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5202426">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5202477">package</span>&nbsp;<span class="ident" id="5202485">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5202493">import</span>&nbsp;<span class="string" id="5202500">&#34;unicode&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5202511">//&nbsp;A&nbsp;patchList&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;instruction&nbsp;pointers&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;filled&nbsp;in&nbsp;(patched).</span><br>
<span class="lineno">10</span><span class="comment" id="5202597">//&nbsp;Because&nbsp;the&nbsp;pointers&nbsp;haven&#39;t&nbsp;been&nbsp;filled&nbsp;in&nbsp;yet,&nbsp;we&nbsp;can&nbsp;reuse&nbsp;their&nbsp;storage</span><br>
<span class="lineno"></span><span class="comment" id="5202676">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;list.&nbsp;&nbsp;It&#39;s&nbsp;kind&nbsp;of&nbsp;sleazy,&nbsp;but&nbsp;works&nbsp;well&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span><span class="comment" id="5202747">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp1.html&nbsp;for&nbsp;inspiration.</span><br>
<span class="lineno"></span><span class="comment" id="5202813">//</span><br>
<span class="lineno"></span><span class="comment" id="5202816">//&nbsp;These&nbsp;aren&#39;t&nbsp;really&nbsp;pointers:&nbsp;they&#39;re&nbsp;integers,&nbsp;so&nbsp;we&nbsp;can&nbsp;reinterpret&nbsp;them</span><br>
<span class="lineno">15</span><span class="comment" id="5202894">//&nbsp;this&nbsp;way&nbsp;without&nbsp;using&nbsp;package&nbsp;unsafe.&nbsp;&nbsp;A&nbsp;value&nbsp;l&nbsp;denotes</span><br>
<span class="lineno"></span><span class="comment" id="5202955">//&nbsp;p.inst[l&gt;&gt;1].Out&nbsp;(l&amp;1==0)&nbsp;or&nbsp;.Arg&nbsp;(l&amp;1==1).</span><br>
<span class="lineno"></span><span class="comment" id="5203002">//&nbsp;l&nbsp;==&nbsp;0&nbsp;denotes&nbsp;the&nbsp;empty&nbsp;list,&nbsp;okay&nbsp;because&nbsp;we&nbsp;start&nbsp;every&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="5203072">//&nbsp;with&nbsp;a&nbsp;fail&nbsp;instruction,&nbsp;so&nbsp;we&#39;ll&nbsp;never&nbsp;want&nbsp;to&nbsp;point&nbsp;at&nbsp;its&nbsp;output&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="5203149">type</span>&nbsp;<span class="ident" id="5203154">patchList</span>&nbsp;<span class="builtintype" id="5203164">uint32</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5203172">func</span>&nbsp;<span class="op" id="5203177">(</span><span class="ident" id="5203178">l</span>&nbsp;<span class="ident" id="5203180">patchList</span><span class="op" id="5203189">)</span>&nbsp;<span class="ident" id="5203191">next</span><span class="op" id="5203195">(</span><span class="ident" id="5203196">p</span>&nbsp;<span class="op" id="5203198">*</span><span class="ident" id="5203199">Prog</span><span class="op" id="5203203">)</span>&nbsp;<span class="ident" id="5203205">patchList</span>&nbsp;<span class="op" id="5203215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203218">i</span>&nbsp;<span class="op" id="5203220">:=</span>&nbsp;<span class="op" id="5203223">&amp;</span><span class="ident" id="5203224">p</span><span class="op" id="5203225">.</span><span class="ident" id="5203226">Inst</span><span class="op" id="5203230">[</span><span class="ident" id="5203231">l</span><span class="op" id="5203232">&gt;&gt;</span><span class="num" id="5203234">1</span><span class="op" id="5203235">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203238">if</span>&nbsp;<span class="ident" id="5203241">l</span><span class="op" id="5203242">&amp;</span><span class="num" id="5203243">1</span>&nbsp;<span class="op" id="5203245">==</span>&nbsp;<span class="num" id="5203248">0</span>&nbsp;<span class="op" id="5203250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203254">return</span>&nbsp;<span class="ident" id="5203261">patchList</span><span class="op" id="5203270">(</span><span class="ident" id="5203271">i</span><span class="op" id="5203272">.</span><span class="ident" id="5203273">Out</span><span class="op" id="5203276">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203282">return</span>&nbsp;<span class="ident" id="5203289">patchList</span><span class="op" id="5203298">(</span><span class="ident" id="5203299">i</span><span class="op" id="5203300">.</span><span class="ident" id="5203301">Arg</span><span class="op" id="5203304">)</span><br>
<span class="lineno"></span><span class="op" id="5203306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5203309">func</span>&nbsp;<span class="op" id="5203314">(</span><span class="ident" id="5203315">l</span>&nbsp;<span class="ident" id="5203317">patchList</span><span class="op" id="5203326">)</span>&nbsp;<span class="ident" id="5203328">patch</span><span class="op" id="5203333">(</span><span class="ident" id="5203334">p</span>&nbsp;<span class="op" id="5203336">*</span><span class="ident" id="5203337">Prog</span><span class="op" id="5203341">,</span>&nbsp;<span class="ident" id="5203343">val</span>&nbsp;<span class="builtintype" id="5203347">uint32</span><span class="op" id="5203353">)</span>&nbsp;<span class="op" id="5203355">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203358">for</span>&nbsp;<span class="ident" id="5203362">l</span>&nbsp;<span class="op" id="5203364">!=</span>&nbsp;<span class="num" id="5203367">0</span>&nbsp;<span class="op" id="5203369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203373">i</span>&nbsp;<span class="op" id="5203375">:=</span>&nbsp;<span class="op" id="5203378">&amp;</span><span class="ident" id="5203379">p</span><span class="op" id="5203380">.</span><span class="ident" id="5203381">Inst</span><span class="op" id="5203385">[</span><span class="ident" id="5203386">l</span><span class="op" id="5203387">&gt;&gt;</span><span class="num" id="5203389">1</span><span class="op" id="5203390">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203394">if</span>&nbsp;<span class="ident" id="5203397">l</span><span class="op" id="5203398">&amp;</span><span class="num" id="5203399">1</span>&nbsp;<span class="op" id="5203401">==</span>&nbsp;<span class="num" id="5203404">0</span>&nbsp;<span class="op" id="5203406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203411">l</span>&nbsp;<span class="op" id="5203413">=</span>&nbsp;<span class="ident" id="5203415">patchList</span><span class="op" id="5203424">(</span><span class="ident" id="5203425">i</span><span class="op" id="5203426">.</span><span class="ident" id="5203427">Out</span><span class="op" id="5203430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203435">i</span><span class="op" id="5203436">.</span><span class="ident" id="5203437">Out</span>&nbsp;<span class="op" id="5203441">=</span>&nbsp;<span class="ident" id="5203443">val</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203449">}</span>&nbsp;<span class="keyword" id="5203451">else</span>&nbsp;<span class="op" id="5203456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203461">l</span>&nbsp;<span class="op" id="5203463">=</span>&nbsp;<span class="ident" id="5203465">patchList</span><span class="op" id="5203474">(</span><span class="ident" id="5203475">i</span><span class="op" id="5203476">.</span><span class="ident" id="5203477">Arg</span><span class="op" id="5203480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203485">i</span><span class="op" id="5203486">.</span><span class="ident" id="5203487">Arg</span>&nbsp;<span class="op" id="5203491">=</span>&nbsp;<span class="ident" id="5203493">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203502">}</span><br>
<span class="lineno">40</span><span class="op" id="5203504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5203507">func</span>&nbsp;<span class="op" id="5203512">(</span><span class="ident" id="5203513">l1</span>&nbsp;<span class="ident" id="5203516">patchList</span><span class="op" id="5203525">)</span>&nbsp;<span class="builtinfunc" id="5203527">append</span><span class="op" id="5203533">(</span><span class="ident" id="5203534">p</span>&nbsp;<span class="op" id="5203536">*</span><span class="ident" id="5203537">Prog</span><span class="op" id="5203541">,</span>&nbsp;<span class="ident" id="5203543">l2</span>&nbsp;<span class="ident" id="5203546">patchList</span><span class="op" id="5203555">)</span>&nbsp;<span class="ident" id="5203557">patchList</span>&nbsp;<span class="op" id="5203567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203570">if</span>&nbsp;<span class="ident" id="5203573">l1</span>&nbsp;<span class="op" id="5203576">==</span>&nbsp;<span class="num" id="5203579">0</span>&nbsp;<span class="op" id="5203581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203585">return</span>&nbsp;<span class="ident" id="5203592">l2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203599">if</span>&nbsp;<span class="ident" id="5203602">l2</span>&nbsp;<span class="op" id="5203605">==</span>&nbsp;<span class="num" id="5203608">0</span>&nbsp;<span class="op" id="5203610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203614">return</span>&nbsp;<span class="ident" id="5203621">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203629">last</span>&nbsp;<span class="op" id="5203634">:=</span>&nbsp;<span class="ident" id="5203637">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203641">for</span>&nbsp;<span class="op" id="5203645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203649">next</span>&nbsp;<span class="op" id="5203654">:=</span>&nbsp;<span class="ident" id="5203657">last</span><span class="op" id="5203661">.</span><span class="ident" id="5203662">next</span><span class="op" id="5203666">(</span><span class="ident" id="5203667">p</span><span class="op" id="5203668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203672">if</span>&nbsp;<span class="ident" id="5203675">next</span>&nbsp;<span class="op" id="5203680">==</span>&nbsp;<span class="num" id="5203683">0</span>&nbsp;<span class="op" id="5203685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203690">break</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203702">last</span>&nbsp;<span class="op" id="5203707">=</span>&nbsp;<span class="ident" id="5203709">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203719">i</span>&nbsp;<span class="op" id="5203721">:=</span>&nbsp;<span class="op" id="5203724">&amp;</span><span class="ident" id="5203725">p</span><span class="op" id="5203726">.</span><span class="ident" id="5203727">Inst</span><span class="op" id="5203731">[</span><span class="ident" id="5203732">last</span><span class="op" id="5203736">&gt;&gt;</span><span class="num" id="5203738">1</span><span class="op" id="5203739">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203742">if</span>&nbsp;<span class="ident" id="5203745">last</span><span class="op" id="5203749">&amp;</span><span class="num" id="5203750">1</span>&nbsp;<span class="op" id="5203752">==</span>&nbsp;<span class="num" id="5203755">0</span>&nbsp;<span class="op" id="5203757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203761">i</span><span class="op" id="5203762">.</span><span class="ident" id="5203763">Out</span>&nbsp;<span class="op" id="5203767">=</span>&nbsp;<span class="builtintype" id="5203769">uint32</span><span class="op" id="5203775">(</span><span class="ident" id="5203776">l2</span><span class="op" id="5203778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203781">}</span>&nbsp;<span class="keyword" id="5203783">else</span>&nbsp;<span class="op" id="5203788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203792">i</span><span class="op" id="5203793">.</span><span class="ident" id="5203794">Arg</span>&nbsp;<span class="op" id="5203798">=</span>&nbsp;<span class="builtintype" id="5203800">uint32</span><span class="op" id="5203806">(</span><span class="ident" id="5203807">l2</span><span class="op" id="5203809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203812">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203815">return</span>&nbsp;<span class="ident" id="5203822">l1</span><br>
<span class="lineno"></span><span class="op" id="5203825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5203828">//&nbsp;A&nbsp;frag&nbsp;represents&nbsp;a&nbsp;compiled&nbsp;program&nbsp;fragment.</span><br>
<span class="lineno"></span><span class="keyword" id="5203878">type</span>&nbsp;<span class="ident" id="5203883">frag</span>&nbsp;<span class="keyword" id="5203888">struct</span>&nbsp;<span class="op" id="5203895">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203898">i</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5203902">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5203912">//&nbsp;index&nbsp;of&nbsp;first&nbsp;instruction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203943">out</span>&nbsp;<span class="ident" id="5203947">patchList</span>&nbsp;<span class="comment" id="5203957">//&nbsp;where&nbsp;to&nbsp;record&nbsp;end&nbsp;instruction</span><br>
<span class="lineno"></span><span class="op" id="5203992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5203995">type</span>&nbsp;<span class="ident" id="5204000">compiler</span>&nbsp;<span class="keyword" id="5204009">struct</span>&nbsp;<span class="op" id="5204016">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204019">p</span>&nbsp;<span class="op" id="5204021">*</span><span class="ident" id="5204022">Prog</span><br>
<span class="lineno"></span><span class="op" id="5204027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5204030">//&nbsp;Compile&nbsp;compiles&nbsp;the&nbsp;regexp&nbsp;into&nbsp;a&nbsp;program&nbsp;to&nbsp;be&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="5204092">//&nbsp;The&nbsp;regexp&nbsp;should&nbsp;have&nbsp;been&nbsp;simplified&nbsp;already&nbsp;(returned&nbsp;from&nbsp;re.Simplify).</span><br>
<span class="lineno">80</span><span class="keyword" id="5204171">func</span>&nbsp;<span class="ident" id="5204176">Compile</span><span class="op" id="5204183">(</span><span class="ident" id="5204184">re</span>&nbsp;<span class="op" id="5204187">*</span><span class="ident" id="5204188">Regexp</span><span class="op" id="5204194">)</span>&nbsp;<span class="op" id="5204196">(</span><span class="op" id="5204197">*</span><span class="ident" id="5204198">Prog</span><span class="op" id="5204202">,</span>&nbsp;<span class="builtintype" id="5204204">error</span><span class="op" id="5204209">)</span>&nbsp;<span class="op" id="5204211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204214">var</span>&nbsp;<span class="ident" id="5204218">c</span>&nbsp;<span class="ident" id="5204220">compiler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204230">c</span><span class="op" id="5204231">.</span><span class="ident" id="5204232">init</span><span class="op" id="5204236">(</span><span class="op" id="5204237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204240">f</span>&nbsp;<span class="op" id="5204242">:=</span>&nbsp;<span class="ident" id="5204245">c</span><span class="op" id="5204246">.</span><span class="ident" id="5204247">compile</span><span class="op" id="5204254">(</span><span class="ident" id="5204255">re</span><span class="op" id="5204257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204260">f</span><span class="op" id="5204261">.</span><span class="ident" id="5204262">out</span><span class="op" id="5204265">.</span><span class="ident" id="5204266">patch</span><span class="op" id="5204271">(</span><span class="ident" id="5204272">c</span><span class="op" id="5204273">.</span><span class="ident" id="5204274">p</span><span class="op" id="5204275">,</span>&nbsp;<span class="ident" id="5204277">c</span><span class="op" id="5204278">.</span><span class="ident" id="5204279">inst</span><span class="op" id="5204283">(</span><span class="ident" id="5204284">InstMatch</span><span class="op" id="5204293">)</span><span class="op" id="5204294">.</span><span class="ident" id="5204295">i</span><span class="op" id="5204296">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204299">c</span><span class="op" id="5204300">.</span><span class="ident" id="5204301">p</span><span class="op" id="5204302">.</span><span class="ident" id="5204303">Start</span>&nbsp;<span class="op" id="5204309">=</span>&nbsp;<span class="builtintype" id="5204311">int</span><span class="op" id="5204314">(</span><span class="ident" id="5204315">f</span><span class="op" id="5204316">.</span><span class="ident" id="5204317">i</span><span class="op" id="5204318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204321">return</span>&nbsp;<span class="ident" id="5204328">c</span><span class="op" id="5204329">.</span><span class="ident" id="5204330">p</span><span class="op" id="5204331">,</span>&nbsp;<span class="builtintype" id="5204333">nil</span><br>
<span class="lineno"></span><span class="op" id="5204337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5204340">func</span>&nbsp;<span class="op" id="5204345">(</span><span class="ident" id="5204346">c</span>&nbsp;<span class="op" id="5204348">*</span><span class="ident" id="5204349">compiler</span><span class="op" id="5204357">)</span>&nbsp;<span class="ident" id="5204359">init</span><span class="op" id="5204363">(</span><span class="op" id="5204364">)</span>&nbsp;<span class="op" id="5204366">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204369">c</span><span class="op" id="5204370">.</span><span class="ident" id="5204371">p</span>&nbsp;<span class="op" id="5204373">=</span>&nbsp;<span class="builtinfunc" id="5204375">new</span><span class="op" id="5204378">(</span><span class="ident" id="5204379">Prog</span><span class="op" id="5204383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204386">c</span><span class="op" id="5204387">.</span><span class="ident" id="5204388">p</span><span class="op" id="5204389">.</span><span class="ident" id="5204390">NumCap</span>&nbsp;<span class="op" id="5204397">=</span>&nbsp;<span class="num" id="5204399">2</span>&nbsp;<span class="comment" id="5204401">//&nbsp;implicit&nbsp;(&nbsp;and&nbsp;)&nbsp;for&nbsp;whole&nbsp;match&nbsp;$0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204441">c</span><span class="op" id="5204442">.</span><span class="ident" id="5204443">inst</span><span class="op" id="5204447">(</span><span class="ident" id="5204448">InstFail</span><span class="op" id="5204456">)</span><br>
<span class="lineno"></span><span class="op" id="5204458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5204461">var</span>&nbsp;<span class="ident" id="5204465">anyRuneNotNL</span>&nbsp;<span class="op" id="5204478">=</span>&nbsp;<span class="op" id="5204480">[</span><span class="op" id="5204481">]</span><span class="builtintype" id="5204482">rune</span><span class="op" id="5204486">{</span><span class="num" id="5204487">0</span><span class="op" id="5204488">,</span>&nbsp;<span class="string" id="5204490">&#39;\n&#39;</span>&nbsp;<span class="op" id="5204495">-</span>&nbsp;<span class="num" id="5204497">1</span><span class="op" id="5204498">,</span>&nbsp;<span class="string" id="5204500">&#39;\n&#39;</span>&nbsp;<span class="op" id="5204505">+</span>&nbsp;<span class="num" id="5204507">1</span><span class="op" id="5204508">,</span>&nbsp;<span class="ident" id="5204510">unicode</span><span class="op" id="5204517">.</span><span class="ident" id="5204518">MaxRune</span><span class="op" id="5204525">}</span><br>
<span class="lineno"></span><span class="keyword" id="5204527">var</span>&nbsp;<span class="ident" id="5204531">anyRune</span>&nbsp;<span class="op" id="5204539">=</span>&nbsp;<span class="op" id="5204541">[</span><span class="op" id="5204542">]</span><span class="builtintype" id="5204543">rune</span><span class="op" id="5204547">{</span><span class="num" id="5204548">0</span><span class="op" id="5204549">,</span>&nbsp;<span class="ident" id="5204551">unicode</span><span class="op" id="5204558">.</span><span class="ident" id="5204559">MaxRune</span><span class="op" id="5204566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5204569">func</span>&nbsp;<span class="op" id="5204574">(</span><span class="ident" id="5204575">c</span>&nbsp;<span class="op" id="5204577">*</span><span class="ident" id="5204578">compiler</span><span class="op" id="5204586">)</span>&nbsp;<span class="ident" id="5204588">compile</span><span class="op" id="5204595">(</span><span class="ident" id="5204596">re</span>&nbsp;<span class="op" id="5204599">*</span><span class="ident" id="5204600">Regexp</span><span class="op" id="5204606">)</span>&nbsp;<span class="ident" id="5204608">frag</span>&nbsp;<span class="op" id="5204613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204616">switch</span>&nbsp;<span class="ident" id="5204623">re</span><span class="op" id="5204625">.</span><span class="ident" id="5204626">Op</span>&nbsp;<span class="op" id="5204629">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204632">case</span>&nbsp;<span class="ident" id="5204637">OpNoMatch</span><span class="op" id="5204646">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204650">return</span>&nbsp;<span class="ident" id="5204657">c</span><span class="op" id="5204658">.</span><span class="ident" id="5204659">fail</span><span class="op" id="5204663">(</span><span class="op" id="5204664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204667">case</span>&nbsp;<span class="ident" id="5204672">OpEmptyMatch</span><span class="op" id="5204684">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204688">return</span>&nbsp;<span class="ident" id="5204695">c</span><span class="op" id="5204696">.</span><span class="ident" id="5204697">nop</span><span class="op" id="5204700">(</span><span class="op" id="5204701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204704">case</span>&nbsp;<span class="ident" id="5204709">OpLiteral</span><span class="op" id="5204718">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204722">if</span>&nbsp;<span class="builtinfunc" id="5204725">len</span><span class="op" id="5204728">(</span><span class="ident" id="5204729">re</span><span class="op" id="5204731">.</span><span class="ident" id="5204732">Rune</span><span class="op" id="5204736">)</span>&nbsp;<span class="op" id="5204738">==</span>&nbsp;<span class="num" id="5204741">0</span>&nbsp;<span class="op" id="5204743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204748">return</span>&nbsp;<span class="ident" id="5204755">c</span><span class="op" id="5204756">.</span><span class="ident" id="5204757">nop</span><span class="op" id="5204760">(</span><span class="op" id="5204761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204769">var</span>&nbsp;<span class="ident" id="5204773">f</span>&nbsp;<span class="ident" id="5204775">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204782">for</span>&nbsp;<span class="ident" id="5204786">j</span>&nbsp;<span class="op" id="5204788">:=</span>&nbsp;<span class="keyword" id="5204791">range</span>&nbsp;<span class="ident" id="5204797">re</span><span class="op" id="5204799">.</span><span class="ident" id="5204800">Rune</span>&nbsp;<span class="op" id="5204805">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204810">f1</span>&nbsp;<span class="op" id="5204813">:=</span>&nbsp;<span class="ident" id="5204816">c</span><span class="op" id="5204817">.</span><span class="builtintype" id="5204818">rune</span><span class="op" id="5204822">(</span><span class="ident" id="5204823">re</span><span class="op" id="5204825">.</span><span class="ident" id="5204826">Rune</span><span class="op" id="5204830">[</span><span class="ident" id="5204831">j</span><span class="op" id="5204832">:</span><span class="ident" id="5204833">j</span><span class="op" id="5204834">+</span><span class="num" id="5204835">1</span><span class="op" id="5204836">]</span><span class="op" id="5204837">,</span>&nbsp;<span class="ident" id="5204839">re</span><span class="op" id="5204841">.</span><span class="ident" id="5204842">Flags</span><span class="op" id="5204847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204852">if</span>&nbsp;<span class="ident" id="5204855">j</span>&nbsp;<span class="op" id="5204857">==</span>&nbsp;<span class="num" id="5204860">0</span>&nbsp;<span class="op" id="5204862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204868">f</span>&nbsp;<span class="op" id="5204870">=</span>&nbsp;<span class="ident" id="5204872">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204878">}</span>&nbsp;<span class="keyword" id="5204880">else</span>&nbsp;<span class="op" id="5204885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204891">f</span>&nbsp;<span class="op" id="5204893">=</span>&nbsp;<span class="ident" id="5204895">c</span><span class="op" id="5204896">.</span><span class="ident" id="5204897">cat</span><span class="op" id="5204900">(</span><span class="ident" id="5204901">f</span><span class="op" id="5204902">,</span>&nbsp;<span class="ident" id="5204904">f1</span><span class="op" id="5204906">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204919">return</span>&nbsp;<span class="ident" id="5204926">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204929">case</span>&nbsp;<span class="ident" id="5204934">OpCharClass</span><span class="op" id="5204945">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204949">return</span>&nbsp;<span class="ident" id="5204956">c</span><span class="op" id="5204957">.</span><span class="builtintype" id="5204958">rune</span><span class="op" id="5204962">(</span><span class="ident" id="5204963">re</span><span class="op" id="5204965">.</span><span class="ident" id="5204966">Rune</span><span class="op" id="5204970">,</span>&nbsp;<span class="ident" id="5204972">re</span><span class="op" id="5204974">.</span><span class="ident" id="5204975">Flags</span><span class="op" id="5204980">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204983">case</span>&nbsp;<span class="ident" id="5204988">OpAnyCharNotNL</span><span class="op" id="5205002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205006">return</span>&nbsp;<span class="ident" id="5205013">c</span><span class="op" id="5205014">.</span><span class="builtintype" id="5205015">rune</span><span class="op" id="5205019">(</span><span class="ident" id="5205020">anyRuneNotNL</span><span class="op" id="5205032">,</span>&nbsp;<span class="num" id="5205034">0</span><span class="op" id="5205035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205038">case</span>&nbsp;<span class="ident" id="5205043">OpAnyChar</span><span class="op" id="5205052">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205056">return</span>&nbsp;<span class="ident" id="5205063">c</span><span class="op" id="5205064">.</span><span class="builtintype" id="5205065">rune</span><span class="op" id="5205069">(</span><span class="ident" id="5205070">anyRune</span><span class="op" id="5205077">,</span>&nbsp;<span class="num" id="5205079">0</span><span class="op" id="5205080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205083">case</span>&nbsp;<span class="ident" id="5205088">OpBeginLine</span><span class="op" id="5205099">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205103">return</span>&nbsp;<span class="ident" id="5205110">c</span><span class="op" id="5205111">.</span><span class="ident" id="5205112">empty</span><span class="op" id="5205117">(</span><span class="ident" id="5205118">EmptyBeginLine</span><span class="op" id="5205132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205135">case</span>&nbsp;<span class="ident" id="5205140">OpEndLine</span><span class="op" id="5205149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205153">return</span>&nbsp;<span class="ident" id="5205160">c</span><span class="op" id="5205161">.</span><span class="ident" id="5205162">empty</span><span class="op" id="5205167">(</span><span class="ident" id="5205168">EmptyEndLine</span><span class="op" id="5205180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205183">case</span>&nbsp;<span class="ident" id="5205188">OpBeginText</span><span class="op" id="5205199">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205203">return</span>&nbsp;<span class="ident" id="5205210">c</span><span class="op" id="5205211">.</span><span class="ident" id="5205212">empty</span><span class="op" id="5205217">(</span><span class="ident" id="5205218">EmptyBeginText</span><span class="op" id="5205232">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205235">case</span>&nbsp;<span class="ident" id="5205240">OpEndText</span><span class="op" id="5205249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205253">return</span>&nbsp;<span class="ident" id="5205260">c</span><span class="op" id="5205261">.</span><span class="ident" id="5205262">empty</span><span class="op" id="5205267">(</span><span class="ident" id="5205268">EmptyEndText</span><span class="op" id="5205280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205283">case</span>&nbsp;<span class="ident" id="5205288">OpWordBoundary</span><span class="op" id="5205302">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205306">return</span>&nbsp;<span class="ident" id="5205313">c</span><span class="op" id="5205314">.</span><span class="ident" id="5205315">empty</span><span class="op" id="5205320">(</span><span class="ident" id="5205321">EmptyWordBoundary</span><span class="op" id="5205338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205341">case</span>&nbsp;<span class="ident" id="5205346">OpNoWordBoundary</span><span class="op" id="5205362">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205366">return</span>&nbsp;<span class="ident" id="5205373">c</span><span class="op" id="5205374">.</span><span class="ident" id="5205375">empty</span><span class="op" id="5205380">(</span><span class="ident" id="5205381">EmptyNoWordBoundary</span><span class="op" id="5205400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205403">case</span>&nbsp;<span class="ident" id="5205408">OpCapture</span><span class="op" id="5205417">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205421">bra</span>&nbsp;<span class="op" id="5205425">:=</span>&nbsp;<span class="ident" id="5205428">c</span><span class="op" id="5205429">.</span><span class="builtinfunc" id="5205430">cap</span><span class="op" id="5205433">(</span><span class="builtintype" id="5205434">uint32</span><span class="op" id="5205440">(</span><span class="ident" id="5205441">re</span><span class="op" id="5205443">.</span><span class="ident" id="5205444">Cap</span>&nbsp;<span class="op" id="5205448">&lt;&lt;</span>&nbsp;<span class="num" id="5205451">1</span><span class="op" id="5205452">)</span><span class="op" id="5205453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205457">sub</span>&nbsp;<span class="op" id="5205461">:=</span>&nbsp;<span class="ident" id="5205464">c</span><span class="op" id="5205465">.</span><span class="ident" id="5205466">compile</span><span class="op" id="5205473">(</span><span class="ident" id="5205474">re</span><span class="op" id="5205476">.</span><span class="ident" id="5205477">Sub</span><span class="op" id="5205480">[</span><span class="num" id="5205481">0</span><span class="op" id="5205482">]</span><span class="op" id="5205483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205487">ket</span>&nbsp;<span class="op" id="5205491">:=</span>&nbsp;<span class="ident" id="5205494">c</span><span class="op" id="5205495">.</span><span class="builtinfunc" id="5205496">cap</span><span class="op" id="5205499">(</span><span class="builtintype" id="5205500">uint32</span><span class="op" id="5205506">(</span><span class="ident" id="5205507">re</span><span class="op" id="5205509">.</span><span class="ident" id="5205510">Cap</span><span class="op" id="5205513">&lt;&lt;</span><span class="num" id="5205515">1</span>&nbsp;<span class="op" id="5205517">|</span>&nbsp;<span class="num" id="5205519">1</span><span class="op" id="5205520">)</span><span class="op" id="5205521">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205525">return</span>&nbsp;<span class="ident" id="5205532">c</span><span class="op" id="5205533">.</span><span class="ident" id="5205534">cat</span><span class="op" id="5205537">(</span><span class="ident" id="5205538">c</span><span class="op" id="5205539">.</span><span class="ident" id="5205540">cat</span><span class="op" id="5205543">(</span><span class="ident" id="5205544">bra</span><span class="op" id="5205547">,</span>&nbsp;<span class="ident" id="5205549">sub</span><span class="op" id="5205552">)</span><span class="op" id="5205553">,</span>&nbsp;<span class="ident" id="5205555">ket</span><span class="op" id="5205558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205561">case</span>&nbsp;<span class="ident" id="5205566">OpStar</span><span class="op" id="5205572">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205576">return</span>&nbsp;<span class="ident" id="5205583">c</span><span class="op" id="5205584">.</span><span class="ident" id="5205585">star</span><span class="op" id="5205589">(</span><span class="ident" id="5205590">c</span><span class="op" id="5205591">.</span><span class="ident" id="5205592">compile</span><span class="op" id="5205599">(</span><span class="ident" id="5205600">re</span><span class="op" id="5205602">.</span><span class="ident" id="5205603">Sub</span><span class="op" id="5205606">[</span><span class="num" id="5205607">0</span><span class="op" id="5205608">]</span><span class="op" id="5205609">)</span><span class="op" id="5205610">,</span>&nbsp;<span class="ident" id="5205612">re</span><span class="op" id="5205614">.</span><span class="ident" id="5205615">Flags</span><span class="op" id="5205620">&amp;</span><span class="ident" id="5205621">NonGreedy</span>&nbsp;<span class="op" id="5205631">!=</span>&nbsp;<span class="num" id="5205634">0</span><span class="op" id="5205635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205638">case</span>&nbsp;<span class="ident" id="5205643">OpPlus</span><span class="op" id="5205649">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205653">return</span>&nbsp;<span class="ident" id="5205660">c</span><span class="op" id="5205661">.</span><span class="ident" id="5205662">plus</span><span class="op" id="5205666">(</span><span class="ident" id="5205667">c</span><span class="op" id="5205668">.</span><span class="ident" id="5205669">compile</span><span class="op" id="5205676">(</span><span class="ident" id="5205677">re</span><span class="op" id="5205679">.</span><span class="ident" id="5205680">Sub</span><span class="op" id="5205683">[</span><span class="num" id="5205684">0</span><span class="op" id="5205685">]</span><span class="op" id="5205686">)</span><span class="op" id="5205687">,</span>&nbsp;<span class="ident" id="5205689">re</span><span class="op" id="5205691">.</span><span class="ident" id="5205692">Flags</span><span class="op" id="5205697">&amp;</span><span class="ident" id="5205698">NonGreedy</span>&nbsp;<span class="op" id="5205708">!=</span>&nbsp;<span class="num" id="5205711">0</span><span class="op" id="5205712">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205715">case</span>&nbsp;<span class="ident" id="5205720">OpQuest</span><span class="op" id="5205727">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205731">return</span>&nbsp;<span class="ident" id="5205738">c</span><span class="op" id="5205739">.</span><span class="ident" id="5205740">quest</span><span class="op" id="5205745">(</span><span class="ident" id="5205746">c</span><span class="op" id="5205747">.</span><span class="ident" id="5205748">compile</span><span class="op" id="5205755">(</span><span class="ident" id="5205756">re</span><span class="op" id="5205758">.</span><span class="ident" id="5205759">Sub</span><span class="op" id="5205762">[</span><span class="num" id="5205763">0</span><span class="op" id="5205764">]</span><span class="op" id="5205765">)</span><span class="op" id="5205766">,</span>&nbsp;<span class="ident" id="5205768">re</span><span class="op" id="5205770">.</span><span class="ident" id="5205771">Flags</span><span class="op" id="5205776">&amp;</span><span class="ident" id="5205777">NonGreedy</span>&nbsp;<span class="op" id="5205787">!=</span>&nbsp;<span class="num" id="5205790">0</span><span class="op" id="5205791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205794">case</span>&nbsp;<span class="ident" id="5205799">OpConcat</span><span class="op" id="5205807">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205811">if</span>&nbsp;<span class="builtinfunc" id="5205814">len</span><span class="op" id="5205817">(</span><span class="ident" id="5205818">re</span><span class="op" id="5205820">.</span><span class="ident" id="5205821">Sub</span><span class="op" id="5205824">)</span>&nbsp;<span class="op" id="5205826">==</span>&nbsp;<span class="num" id="5205829">0</span>&nbsp;<span class="op" id="5205831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205836">return</span>&nbsp;<span class="ident" id="5205843">c</span><span class="op" id="5205844">.</span><span class="ident" id="5205845">nop</span><span class="op" id="5205848">(</span><span class="op" id="5205849">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5205853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205857">var</span>&nbsp;<span class="ident" id="5205861">f</span>&nbsp;<span class="ident" id="5205863">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205870">for</span>&nbsp;<span class="ident" id="5205874">i</span><span class="op" id="5205875">,</span>&nbsp;<span class="ident" id="5205877">sub</span>&nbsp;<span class="op" id="5205881">:=</span>&nbsp;<span class="keyword" id="5205884">range</span>&nbsp;<span class="ident" id="5205890">re</span><span class="op" id="5205892">.</span><span class="ident" id="5205893">Sub</span>&nbsp;<span class="op" id="5205897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205902">if</span>&nbsp;<span class="ident" id="5205905">i</span>&nbsp;<span class="op" id="5205907">==</span>&nbsp;<span class="num" id="5205910">0</span>&nbsp;<span class="op" id="5205912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205918">f</span>&nbsp;<span class="op" id="5205920">=</span>&nbsp;<span class="ident" id="5205922">c</span><span class="op" id="5205923">.</span><span class="ident" id="5205924">compile</span><span class="op" id="5205931">(</span><span class="ident" id="5205932">sub</span><span class="op" id="5205935">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5205940">}</span>&nbsp;<span class="keyword" id="5205942">else</span>&nbsp;<span class="op" id="5205947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205953">f</span>&nbsp;<span class="op" id="5205955">=</span>&nbsp;<span class="ident" id="5205957">c</span><span class="op" id="5205958">.</span><span class="ident" id="5205959">cat</span><span class="op" id="5205962">(</span><span class="ident" id="5205963">f</span><span class="op" id="5205964">,</span>&nbsp;<span class="ident" id="5205966">c</span><span class="op" id="5205967">.</span><span class="ident" id="5205968">compile</span><span class="op" id="5205975">(</span><span class="ident" id="5205976">sub</span><span class="op" id="5205979">)</span><span class="op" id="5205980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5205985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5205989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205993">return</span>&nbsp;<span class="ident" id="5206000">f</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206003">case</span>&nbsp;<span class="ident" id="5206008">OpAlternate</span><span class="op" id="5206019">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206023">var</span>&nbsp;<span class="ident" id="5206027">f</span>&nbsp;<span class="ident" id="5206029">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206036">for</span>&nbsp;<span class="ident" id="5206040">_</span><span class="op" id="5206041">,</span>&nbsp;<span class="ident" id="5206043">sub</span>&nbsp;<span class="op" id="5206047">:=</span>&nbsp;<span class="keyword" id="5206050">range</span>&nbsp;<span class="ident" id="5206056">re</span><span class="op" id="5206058">.</span><span class="ident" id="5206059">Sub</span>&nbsp;<span class="op" id="5206063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5206068">f</span>&nbsp;<span class="op" id="5206070">=</span>&nbsp;<span class="ident" id="5206072">c</span><span class="op" id="5206073">.</span><span class="ident" id="5206074">alt</span><span class="op" id="5206077">(</span><span class="ident" id="5206078">f</span><span class="op" id="5206079">,</span>&nbsp;<span class="ident" id="5206081">c</span><span class="op" id="5206082">.</span><span class="ident" id="5206083">compile</span><span class="op" id="5206090">(</span><span class="ident" id="5206091">sub</span><span class="op" id="5206094">)</span><span class="op" id="5206095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5206099">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206103">return</span>&nbsp;<span class="ident" id="5206110">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5206113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5206116">panic</span><span class="op" id="5206121">(</span><span class="string" id="5206122">&#34;regexp:&nbsp;unhandled&nbsp;case&nbsp;in&nbsp;compile&#34;</span><span class="op" id="5206157">)</span><br>
<span class="lineno"></span><span class="op" id="5206159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="5206162">func</span>&nbsp;<span class="op" id="5206167">(</span><span class="ident" id="5206168">c</span>&nbsp;<span class="op" id="5206170">*</span><span class="ident" id="5206171">compiler</span><span class="op" id="5206179">)</span>&nbsp;<span class="ident" id="5206181">inst</span><span class="op" id="5206185">(</span><span class="ident" id="5206186">op</span>&nbsp;<span class="ident" id="5206189">InstOp</span><span class="op" id="5206195">)</span>&nbsp;<span class="ident" id="5206197">frag</span>&nbsp;<span class="op" id="5206202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5206205">//&nbsp;TODO:&nbsp;impose&nbsp;length&nbsp;limit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5206235">f</span>&nbsp;<span class="op" id="5206237">:=</span>&nbsp;<span class="ident" id="5206240">frag</span><span class="op" id="5206244">{</span><span class="ident" id="5206245">i</span><span class="op" id="5206246">:</span>&nbsp;<span class="builtintype" id="5206248">uint32</span><span class="op" id="5206254">(</span><span class="builtinfunc" id="5206255">len</span><span class="op" id="5206258">(</span><span class="ident" id="5206259">c</span><span class="op" id="5206260">.</span><span class="ident" id="5206261">p</span><span class="op" id="5206262">.</span><span class="ident" id="5206263">Inst</span><span class="op" id="5206267">)</span><span class="op" id="5206268">)</span><span class="op" id="5206269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5206272">c</span><span class="op" id="5206273">.</span><span class="ident" id="5206274">p</span><span class="op" id="5206275">.</span><span class="ident" id="5206276">Inst</span>&nbsp;<span class="op" id="5206281">=</span>&nbsp;<span class="builtinfunc" id="5206283">append</span><span class="op" id="5206289">(</span><span class="ident" id="5206290">c</span><span class="op" id="5206291">.</span><span class="ident" id="5206292">p</span><span class="op" id="5206293">.</span><span class="ident" id="5206294">Inst</span><span class="op" id="5206298">,</span>&nbsp;<span class="ident" id="5206300">Inst</span><span class="op" id="5206304">{</span><span class="ident" id="5206305">Op</span><span class="op" id="5206307">:</span>&nbsp;<span class="ident" id="5206309">op</span><span class="op" id="5206311">}</span><span class="op" id="5206312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206315">return</span>&nbsp;<span class="ident" id="5206322">f</span><br>
<span class="lineno">175</span><span class="op" id="5206324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5206327">func</span>&nbsp;<span class="op" id="5206332">(</span><span class="ident" id="5206333">c</span>&nbsp;<span class="op" id="5206335">*</span><span class="ident" id="5206336">compiler</span><span class="op" id="5206344">)</span>&nbsp;<span class="ident" id="5206346">nop</span><span class="op" id="5206349">(</span><span class="op" id="5206350">)</span>&nbsp;<span class="ident" id="5206352">frag</span>&nbsp;<span class="op" id="5206357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5206360">f</span>&nbsp;<span class="op" id="5206362">:=</span>&nbsp;<span class="ident" id="5206365">c</span><span class="op" id="5206366">.</span><span class="ident" id="5206367">inst</span><span class="op" id="5206371">(</span><span class="ident" id="5206372">InstNop</span><span class="op" id="5206379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5206382">f</span><span class="op" id="5206383">.</span><span class="ident" id="5206384">out</span>&nbsp;<span class="op" id="5206388">=</span>&nbsp;<span class="ident" id="5206390">patchList</span><span class="op" id="5206399">(</span><span class="ident" id="5206400">f</span><span class="op" id="5206401">.</span><span class="ident" id="5206402">i</span>&nbsp;<span class="op" id="5206404">&lt;&lt;</span>&nbsp;<span class="num" id="5206407">1</span><span class="op" id="5206408">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206411">return</span>&nbsp;<span class="ident" id="5206418">f</span><br>
<span class="lineno"></span><span class="op" id="5206420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5206423">func</span>&nbsp;<span class="op" id="5206428">(</span><span class="ident" id="5206429">c</span>&nbsp;<span class="op" id="5206431">*</span><span class="ident" id="5206432">compiler</span><span class="op" id="5206440">)</span>&nbsp;<span class="ident" id="5206442">fail</span><span class="op" id="5206446">(</span><span class="op" id="5206447">)</span>&nbsp;<span class="ident" id="5206449">frag</span>&nbsp;<span class="op" id="5206454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206457">return</span>&nbsp;<span class="ident" id="5206464">frag</span><span class="op" id="5206468">{</span><span class="op" id="5206469">}</span><br>
<span class="lineno">185</span><span class="op" id="5206471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5206474">func</span>&nbsp;<span class="op" id="5206479">(</span><span class="ident" id="5206480">c</span>&nbsp;<span class="op" id="5206482">*</span><span class="ident" id="5206483">compiler</span><span class="op" id="5206491">)</span>&nbsp;<span class="builtinfunc" id="5206493">cap</span><span class="op" id="5206496">(</span><span class="ident" id="5206497">arg</span>&nbsp;<span class="builtintype" id="5206501">uint32</span><span class="op" id="5206507">)</span>&nbsp;<span class="ident" id="5206509">frag</span>&nbsp;<span class="op" id="5206514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5206517">f</span>&nbsp;<span class="op" id="5206519">:=</span>&nbsp;<span class="ident" id="5206522">c</span><span class="op" id="5206523">.</span><span class="ident" id="5206524">inst</span><span class="op" id="5206528">(</span><span class="ident" id="5206529">InstCapture</span><span class="op" id="5206540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5206543">f</span><span class="op" id="5206544">.</span><span class="ident" id="5206545">out</span>&nbsp;<span class="op" id="5206549">=</span>&nbsp;<span class="ident" id="5206551">patchList</span><span class="op" id="5206560">(</span><span class="ident" id="5206561">f</span><span class="op" id="5206562">.</span><span class="ident" id="5206563">i</span>&nbsp;<span class="op" id="5206565">&lt;&lt;</span>&nbsp;<span class="num" id="5206568">1</span><span class="op" id="5206569">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5206572">c</span><span class="op" id="5206573">.</span><span class="ident" id="5206574">p</span><span class="op" id="5206575">.</span><span class="ident" id="5206576">Inst</span><span class="op" id="5206580">[</span><span class="ident" id="5206581">f</span><span class="op" id="5206582">.</span><span class="ident" id="5206583">i</span><span class="op" id="5206584">]</span><span class="op" id="5206585">.</span><span class="ident" id="5206586">Arg</span>&nbsp;<span class="op" id="5206590">=</span>&nbsp;<span class="ident" id="5206592">arg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206598">if</span>&nbsp;<span class="ident" id="5206601">c</span><span class="op" id="5206602">.</span><span class="ident" id="5206603">p</span><span class="op" id="5206604">.</span><span class="ident" id="5206605">NumCap</span>&nbsp;<span class="op" id="5206612">&lt;</span>&nbsp;<span class="builtintype" id="5206614">int</span><span class="op" id="5206617">(</span><span class="ident" id="5206618">arg</span><span class="op" id="5206621">)</span><span class="op" id="5206622">+</span><span class="num" id="5206623">1</span>&nbsp;<span class="op" id="5206625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5206629">c</span><span class="op" id="5206630">.</span><span class="ident" id="5206631">p</span><span class="op" id="5206632">.</span><span class="ident" id="5206633">NumCap</span>&nbsp;<span class="op" id="5206640">=</span>&nbsp;<span class="builtintype" id="5206642">int</span><span class="op" id="5206645">(</span><span class="ident" id="5206646">arg</span><span class="op" id="5206649">)</span>&nbsp;<span class="op" id="5206651">+</span>&nbsp;<span class="num" id="5206653">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5206656">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206659">return</span>&nbsp;<span class="ident" id="5206666">f</span><br>
<span class="lineno"></span><span class="op" id="5206668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5206671">func</span>&nbsp;<span class="op" id="5206676">(</span><span class="ident" id="5206677">c</span>&nbsp;<span class="op" id="5206679">*</span><span class="ident" id="5206680">compiler</span><span class="op" id="5206688">)</span>&nbsp;<span class="ident" id="5206690">cat</span><span class="op" id="5206693">(</span><span class="ident" id="5206694">f1</span><span class="op" id="5206696">,</span>&nbsp;<span class="ident" id="5206698">f2</span>&nbsp;<span class="ident" id="5206701">frag</span><span class="op" id="5206705">)</span>&nbsp;<span class="ident" id="5206707">frag</span>&nbsp;<span class="op" id="5206712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5206715">//&nbsp;concat&nbsp;of&nbsp;failure&nbsp;is&nbsp;failure</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206748">if</span>&nbsp;<span class="ident" id="5206751">f1</span><span class="op" id="5206753">.</span><span class="ident" id="5206754">i</span>&nbsp;<span class="op" id="5206756">==</span>&nbsp;<span class="num" id="5206759">0</span>&nbsp;<span class="op" id="5206761">||</span>&nbsp;<span class="ident" id="5206764">f2</span><span class="op" id="5206766">.</span><span class="ident" id="5206767">i</span>&nbsp;<span class="op" id="5206769">==</span>&nbsp;<span class="num" id="5206772">0</span>&nbsp;<span class="op" id="5206774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206778">return</span>&nbsp;<span class="ident" id="5206785">frag</span><span class="op" id="5206789">{</span><span class="op" id="5206790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5206793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5206797">//&nbsp;TODO:&nbsp;elide&nbsp;nop</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5206818">f1</span><span class="op" id="5206820">.</span><span class="ident" id="5206821">out</span><span class="op" id="5206824">.</span><span class="ident" id="5206825">patch</span><span class="op" id="5206830">(</span><span class="ident" id="5206831">c</span><span class="op" id="5206832">.</span><span class="ident" id="5206833">p</span><span class="op" id="5206834">,</span>&nbsp;<span class="ident" id="5206836">f2</span><span class="op" id="5206838">.</span><span class="ident" id="5206839">i</span><span class="op" id="5206840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206843">return</span>&nbsp;<span class="ident" id="5206850">frag</span><span class="op" id="5206854">{</span><span class="ident" id="5206855">f1</span><span class="op" id="5206857">.</span><span class="ident" id="5206858">i</span><span class="op" id="5206859">,</span>&nbsp;<span class="ident" id="5206861">f2</span><span class="op" id="5206863">.</span><span class="ident" id="5206864">out</span><span class="op" id="5206867">}</span><br>
<span class="lineno"></span><span class="op" id="5206869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="5206872">func</span>&nbsp;<span class="op" id="5206877">(</span><span class="ident" id="5206878">c</span>&nbsp;<span class="op" id="5206880">*</span><span class="ident" id="5206881">compiler</span><span class="op" id="5206889">)</span>&nbsp;<span class="ident" id="5206891">alt</span><span class="op" id="5206894">(</span><span class="ident" id="5206895">f1</span><span class="op" id="5206897">,</span>&nbsp;<span class="ident" id="5206899">f2</span>&nbsp;<span class="ident" id="5206902">frag</span><span class="op" id="5206906">)</span>&nbsp;<span class="ident" id="5206908">frag</span>&nbsp;<span class="op" id="5206913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5206916">//&nbsp;alt&nbsp;of&nbsp;failure&nbsp;is&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206944">if</span>&nbsp;<span class="ident" id="5206947">f1</span><span class="op" id="5206949">.</span><span class="ident" id="5206950">i</span>&nbsp;<span class="op" id="5206952">==</span>&nbsp;<span class="num" id="5206955">0</span>&nbsp;<span class="op" id="5206957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206961">return</span>&nbsp;<span class="ident" id="5206968">f2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5206972">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206975">if</span>&nbsp;<span class="ident" id="5206978">f2</span><span class="op" id="5206980">.</span><span class="ident" id="5206981">i</span>&nbsp;<span class="op" id="5206983">==</span>&nbsp;<span class="num" id="5206986">0</span>&nbsp;<span class="op" id="5206988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206992">return</span>&nbsp;<span class="ident" id="5206999">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5207003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207007">f</span>&nbsp;<span class="op" id="5207009">:=</span>&nbsp;<span class="ident" id="5207012">c</span><span class="op" id="5207013">.</span><span class="ident" id="5207014">inst</span><span class="op" id="5207018">(</span><span class="ident" id="5207019">InstAlt</span><span class="op" id="5207026">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207029">i</span>&nbsp;<span class="op" id="5207031">:=</span>&nbsp;<span class="op" id="5207034">&amp;</span><span class="ident" id="5207035">c</span><span class="op" id="5207036">.</span><span class="ident" id="5207037">p</span><span class="op" id="5207038">.</span><span class="ident" id="5207039">Inst</span><span class="op" id="5207043">[</span><span class="ident" id="5207044">f</span><span class="op" id="5207045">.</span><span class="ident" id="5207046">i</span><span class="op" id="5207047">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207050">i</span><span class="op" id="5207051">.</span><span class="ident" id="5207052">Out</span>&nbsp;<span class="op" id="5207056">=</span>&nbsp;<span class="ident" id="5207058">f1</span><span class="op" id="5207060">.</span><span class="ident" id="5207061">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207064">i</span><span class="op" id="5207065">.</span><span class="ident" id="5207066">Arg</span>&nbsp;<span class="op" id="5207070">=</span>&nbsp;<span class="ident" id="5207072">f2</span><span class="op" id="5207074">.</span><span class="ident" id="5207075">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207078">f</span><span class="op" id="5207079">.</span><span class="ident" id="5207080">out</span>&nbsp;<span class="op" id="5207084">=</span>&nbsp;<span class="ident" id="5207086">f1</span><span class="op" id="5207088">.</span><span class="ident" id="5207089">out</span><span class="op" id="5207092">.</span><span class="builtinfunc" id="5207093">append</span><span class="op" id="5207099">(</span><span class="ident" id="5207100">c</span><span class="op" id="5207101">.</span><span class="ident" id="5207102">p</span><span class="op" id="5207103">,</span>&nbsp;<span class="ident" id="5207105">f2</span><span class="op" id="5207107">.</span><span class="ident" id="5207108">out</span><span class="op" id="5207111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207114">return</span>&nbsp;<span class="ident" id="5207121">f</span><br>
<span class="lineno">225</span><span class="op" id="5207123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5207126">func</span>&nbsp;<span class="op" id="5207131">(</span><span class="ident" id="5207132">c</span>&nbsp;<span class="op" id="5207134">*</span><span class="ident" id="5207135">compiler</span><span class="op" id="5207143">)</span>&nbsp;<span class="ident" id="5207145">quest</span><span class="op" id="5207150">(</span><span class="ident" id="5207151">f1</span>&nbsp;<span class="ident" id="5207154">frag</span><span class="op" id="5207158">,</span>&nbsp;<span class="ident" id="5207160">nongreedy</span>&nbsp;<span class="builtintype" id="5207170">bool</span><span class="op" id="5207174">)</span>&nbsp;<span class="ident" id="5207176">frag</span>&nbsp;<span class="op" id="5207181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207184">f</span>&nbsp;<span class="op" id="5207186">:=</span>&nbsp;<span class="ident" id="5207189">c</span><span class="op" id="5207190">.</span><span class="ident" id="5207191">inst</span><span class="op" id="5207195">(</span><span class="ident" id="5207196">InstAlt</span><span class="op" id="5207203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207206">i</span>&nbsp;<span class="op" id="5207208">:=</span>&nbsp;<span class="op" id="5207211">&amp;</span><span class="ident" id="5207212">c</span><span class="op" id="5207213">.</span><span class="ident" id="5207214">p</span><span class="op" id="5207215">.</span><span class="ident" id="5207216">Inst</span><span class="op" id="5207220">[</span><span class="ident" id="5207221">f</span><span class="op" id="5207222">.</span><span class="ident" id="5207223">i</span><span class="op" id="5207224">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207227">if</span>&nbsp;<span class="ident" id="5207230">nongreedy</span>&nbsp;<span class="op" id="5207240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207244">i</span><span class="op" id="5207245">.</span><span class="ident" id="5207246">Arg</span>&nbsp;<span class="op" id="5207250">=</span>&nbsp;<span class="ident" id="5207252">f1</span><span class="op" id="5207254">.</span><span class="ident" id="5207255">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207259">f</span><span class="op" id="5207260">.</span><span class="ident" id="5207261">out</span>&nbsp;<span class="op" id="5207265">=</span>&nbsp;<span class="ident" id="5207267">patchList</span><span class="op" id="5207276">(</span><span class="ident" id="5207277">f</span><span class="op" id="5207278">.</span><span class="ident" id="5207279">i</span>&nbsp;<span class="op" id="5207281">&lt;&lt;</span>&nbsp;<span class="num" id="5207284">1</span><span class="op" id="5207285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5207288">}</span>&nbsp;<span class="keyword" id="5207290">else</span>&nbsp;<span class="op" id="5207295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207299">i</span><span class="op" id="5207300">.</span><span class="ident" id="5207301">Out</span>&nbsp;<span class="op" id="5207305">=</span>&nbsp;<span class="ident" id="5207307">f1</span><span class="op" id="5207309">.</span><span class="ident" id="5207310">i</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207314">f</span><span class="op" id="5207315">.</span><span class="ident" id="5207316">out</span>&nbsp;<span class="op" id="5207320">=</span>&nbsp;<span class="ident" id="5207322">patchList</span><span class="op" id="5207331">(</span><span class="ident" id="5207332">f</span><span class="op" id="5207333">.</span><span class="ident" id="5207334">i</span><span class="op" id="5207335">&lt;&lt;</span><span class="num" id="5207337">1</span>&nbsp;<span class="op" id="5207339">|</span>&nbsp;<span class="num" id="5207341">1</span><span class="op" id="5207342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5207345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207348">f</span><span class="op" id="5207349">.</span><span class="ident" id="5207350">out</span>&nbsp;<span class="op" id="5207354">=</span>&nbsp;<span class="ident" id="5207356">f</span><span class="op" id="5207357">.</span><span class="ident" id="5207358">out</span><span class="op" id="5207361">.</span><span class="builtinfunc" id="5207362">append</span><span class="op" id="5207368">(</span><span class="ident" id="5207369">c</span><span class="op" id="5207370">.</span><span class="ident" id="5207371">p</span><span class="op" id="5207372">,</span>&nbsp;<span class="ident" id="5207374">f1</span><span class="op" id="5207376">.</span><span class="ident" id="5207377">out</span><span class="op" id="5207380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207383">return</span>&nbsp;<span class="ident" id="5207390">f</span><br>
<span class="lineno"></span><span class="op" id="5207392">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="5207395">func</span>&nbsp;<span class="op" id="5207400">(</span><span class="ident" id="5207401">c</span>&nbsp;<span class="op" id="5207403">*</span><span class="ident" id="5207404">compiler</span><span class="op" id="5207412">)</span>&nbsp;<span class="ident" id="5207414">star</span><span class="op" id="5207418">(</span><span class="ident" id="5207419">f1</span>&nbsp;<span class="ident" id="5207422">frag</span><span class="op" id="5207426">,</span>&nbsp;<span class="ident" id="5207428">nongreedy</span>&nbsp;<span class="builtintype" id="5207438">bool</span><span class="op" id="5207442">)</span>&nbsp;<span class="ident" id="5207444">frag</span>&nbsp;<span class="op" id="5207449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207452">f</span>&nbsp;<span class="op" id="5207454">:=</span>&nbsp;<span class="ident" id="5207457">c</span><span class="op" id="5207458">.</span><span class="ident" id="5207459">inst</span><span class="op" id="5207463">(</span><span class="ident" id="5207464">InstAlt</span><span class="op" id="5207471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207474">i</span>&nbsp;<span class="op" id="5207476">:=</span>&nbsp;<span class="op" id="5207479">&amp;</span><span class="ident" id="5207480">c</span><span class="op" id="5207481">.</span><span class="ident" id="5207482">p</span><span class="op" id="5207483">.</span><span class="ident" id="5207484">Inst</span><span class="op" id="5207488">[</span><span class="ident" id="5207489">f</span><span class="op" id="5207490">.</span><span class="ident" id="5207491">i</span><span class="op" id="5207492">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207495">if</span>&nbsp;<span class="ident" id="5207498">nongreedy</span>&nbsp;<span class="op" id="5207508">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207512">i</span><span class="op" id="5207513">.</span><span class="ident" id="5207514">Arg</span>&nbsp;<span class="op" id="5207518">=</span>&nbsp;<span class="ident" id="5207520">f1</span><span class="op" id="5207522">.</span><span class="ident" id="5207523">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207527">f</span><span class="op" id="5207528">.</span><span class="ident" id="5207529">out</span>&nbsp;<span class="op" id="5207533">=</span>&nbsp;<span class="ident" id="5207535">patchList</span><span class="op" id="5207544">(</span><span class="ident" id="5207545">f</span><span class="op" id="5207546">.</span><span class="ident" id="5207547">i</span>&nbsp;<span class="op" id="5207549">&lt;&lt;</span>&nbsp;<span class="num" id="5207552">1</span><span class="op" id="5207553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5207556">}</span>&nbsp;<span class="keyword" id="5207558">else</span>&nbsp;<span class="op" id="5207563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207567">i</span><span class="op" id="5207568">.</span><span class="ident" id="5207569">Out</span>&nbsp;<span class="op" id="5207573">=</span>&nbsp;<span class="ident" id="5207575">f1</span><span class="op" id="5207577">.</span><span class="ident" id="5207578">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207582">f</span><span class="op" id="5207583">.</span><span class="ident" id="5207584">out</span>&nbsp;<span class="op" id="5207588">=</span>&nbsp;<span class="ident" id="5207590">patchList</span><span class="op" id="5207599">(</span><span class="ident" id="5207600">f</span><span class="op" id="5207601">.</span><span class="ident" id="5207602">i</span><span class="op" id="5207603">&lt;&lt;</span><span class="num" id="5207605">1</span>&nbsp;<span class="op" id="5207607">|</span>&nbsp;<span class="num" id="5207609">1</span><span class="op" id="5207610">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5207613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207616">f1</span><span class="op" id="5207618">.</span><span class="ident" id="5207619">out</span><span class="op" id="5207622">.</span><span class="ident" id="5207623">patch</span><span class="op" id="5207628">(</span><span class="ident" id="5207629">c</span><span class="op" id="5207630">.</span><span class="ident" id="5207631">p</span><span class="op" id="5207632">,</span>&nbsp;<span class="ident" id="5207634">f</span><span class="op" id="5207635">.</span><span class="ident" id="5207636">i</span><span class="op" id="5207637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207640">return</span>&nbsp;<span class="ident" id="5207647">f</span><br>
<span class="lineno"></span><span class="op" id="5207649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="5207652">func</span>&nbsp;<span class="op" id="5207657">(</span><span class="ident" id="5207658">c</span>&nbsp;<span class="op" id="5207660">*</span><span class="ident" id="5207661">compiler</span><span class="op" id="5207669">)</span>&nbsp;<span class="ident" id="5207671">plus</span><span class="op" id="5207675">(</span><span class="ident" id="5207676">f1</span>&nbsp;<span class="ident" id="5207679">frag</span><span class="op" id="5207683">,</span>&nbsp;<span class="ident" id="5207685">nongreedy</span>&nbsp;<span class="builtintype" id="5207695">bool</span><span class="op" id="5207699">)</span>&nbsp;<span class="ident" id="5207701">frag</span>&nbsp;<span class="op" id="5207706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207709">return</span>&nbsp;<span class="ident" id="5207716">frag</span><span class="op" id="5207720">{</span><span class="ident" id="5207721">f1</span><span class="op" id="5207723">.</span><span class="ident" id="5207724">i</span><span class="op" id="5207725">,</span>&nbsp;<span class="ident" id="5207727">c</span><span class="op" id="5207728">.</span><span class="ident" id="5207729">star</span><span class="op" id="5207733">(</span><span class="ident" id="5207734">f1</span><span class="op" id="5207736">,</span>&nbsp;<span class="ident" id="5207738">nongreedy</span><span class="op" id="5207747">)</span><span class="op" id="5207748">.</span><span class="ident" id="5207749">out</span><span class="op" id="5207752">}</span><br>
<span class="lineno"></span><span class="op" id="5207754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5207757">func</span>&nbsp;<span class="op" id="5207762">(</span><span class="ident" id="5207763">c</span>&nbsp;<span class="op" id="5207765">*</span><span class="ident" id="5207766">compiler</span><span class="op" id="5207774">)</span>&nbsp;<span class="ident" id="5207776">empty</span><span class="op" id="5207781">(</span><span class="ident" id="5207782">op</span>&nbsp;<span class="ident" id="5207785">EmptyOp</span><span class="op" id="5207792">)</span>&nbsp;<span class="ident" id="5207794">frag</span>&nbsp;<span class="op" id="5207799">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207802">f</span>&nbsp;<span class="op" id="5207804">:=</span>&nbsp;<span class="ident" id="5207807">c</span><span class="op" id="5207808">.</span><span class="ident" id="5207809">inst</span><span class="op" id="5207813">(</span><span class="ident" id="5207814">InstEmptyWidth</span><span class="op" id="5207828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207831">c</span><span class="op" id="5207832">.</span><span class="ident" id="5207833">p</span><span class="op" id="5207834">.</span><span class="ident" id="5207835">Inst</span><span class="op" id="5207839">[</span><span class="ident" id="5207840">f</span><span class="op" id="5207841">.</span><span class="ident" id="5207842">i</span><span class="op" id="5207843">]</span><span class="op" id="5207844">.</span><span class="ident" id="5207845">Arg</span>&nbsp;<span class="op" id="5207849">=</span>&nbsp;<span class="builtintype" id="5207851">uint32</span><span class="op" id="5207857">(</span><span class="ident" id="5207858">op</span><span class="op" id="5207860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207863">f</span><span class="op" id="5207864">.</span><span class="ident" id="5207865">out</span>&nbsp;<span class="op" id="5207869">=</span>&nbsp;<span class="ident" id="5207871">patchList</span><span class="op" id="5207880">(</span><span class="ident" id="5207881">f</span><span class="op" id="5207882">.</span><span class="ident" id="5207883">i</span>&nbsp;<span class="op" id="5207885">&lt;&lt;</span>&nbsp;<span class="num" id="5207888">1</span><span class="op" id="5207889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207892">return</span>&nbsp;<span class="ident" id="5207899">f</span><br>
<span class="lineno"></span><span class="op" id="5207901">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="5207904">func</span>&nbsp;<span class="op" id="5207909">(</span><span class="ident" id="5207910">c</span>&nbsp;<span class="op" id="5207912">*</span><span class="ident" id="5207913">compiler</span><span class="op" id="5207921">)</span>&nbsp;<span class="builtintype" id="5207923">rune</span><span class="op" id="5207927">(</span><span class="ident" id="5207928">r</span>&nbsp;<span class="op" id="5207930">[</span><span class="op" id="5207931">]</span><span class="builtintype" id="5207932">rune</span><span class="op" id="5207936">,</span>&nbsp;<span class="ident" id="5207938">flags</span>&nbsp;<span class="ident" id="5207944">Flags</span><span class="op" id="5207949">)</span>&nbsp;<span class="ident" id="5207951">frag</span>&nbsp;<span class="op" id="5207956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207959">f</span>&nbsp;<span class="op" id="5207961">:=</span>&nbsp;<span class="ident" id="5207964">c</span><span class="op" id="5207965">.</span><span class="ident" id="5207966">inst</span><span class="op" id="5207970">(</span><span class="ident" id="5207971">InstRune</span><span class="op" id="5207979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207982">i</span>&nbsp;<span class="op" id="5207984">:=</span>&nbsp;<span class="op" id="5207987">&amp;</span><span class="ident" id="5207988">c</span><span class="op" id="5207989">.</span><span class="ident" id="5207990">p</span><span class="op" id="5207991">.</span><span class="ident" id="5207992">Inst</span><span class="op" id="5207996">[</span><span class="ident" id="5207997">f</span><span class="op" id="5207998">.</span><span class="ident" id="5207999">i</span><span class="op" id="5208000">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208003">i</span><span class="op" id="5208004">.</span><span class="ident" id="5208005">Rune</span>&nbsp;<span class="op" id="5208010">=</span>&nbsp;<span class="ident" id="5208012">r</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208015">flags</span>&nbsp;<span class="op" id="5208021">&amp;=</span>&nbsp;<span class="ident" id="5208024">FoldCase</span>&nbsp;<span class="comment" id="5208033">//&nbsp;only&nbsp;relevant&nbsp;flag&nbsp;is&nbsp;FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208068">if</span>&nbsp;<span class="builtinfunc" id="5208071">len</span><span class="op" id="5208074">(</span><span class="ident" id="5208075">r</span><span class="op" id="5208076">)</span>&nbsp;<span class="op" id="5208078">!=</span>&nbsp;<span class="num" id="5208081">1</span>&nbsp;<span class="op" id="5208083">||</span>&nbsp;<span class="ident" id="5208086">unicode</span><span class="op" id="5208093">.</span><span class="ident" id="5208094">SimpleFold</span><span class="op" id="5208104">(</span><span class="ident" id="5208105">r</span><span class="op" id="5208106">[</span><span class="num" id="5208107">0</span><span class="op" id="5208108">]</span><span class="op" id="5208109">)</span>&nbsp;<span class="op" id="5208111">==</span>&nbsp;<span class="ident" id="5208114">r</span><span class="op" id="5208115">[</span><span class="num" id="5208116">0</span><span class="op" id="5208117">]</span>&nbsp;<span class="op" id="5208119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5208123">//&nbsp;and&nbsp;sometimes&nbsp;not&nbsp;even&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208156">flags</span>&nbsp;<span class="op" id="5208162">&amp;^=</span>&nbsp;<span class="ident" id="5208166">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5208176">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208179">i</span><span class="op" id="5208180">.</span><span class="ident" id="5208181">Arg</span>&nbsp;<span class="op" id="5208185">=</span>&nbsp;<span class="builtintype" id="5208187">uint32</span><span class="op" id="5208193">(</span><span class="ident" id="5208194">flags</span><span class="op" id="5208199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208202">f</span><span class="op" id="5208203">.</span><span class="ident" id="5208204">out</span>&nbsp;<span class="op" id="5208208">=</span>&nbsp;<span class="ident" id="5208210">patchList</span><span class="op" id="5208219">(</span><span class="ident" id="5208220">f</span><span class="op" id="5208221">.</span><span class="ident" id="5208222">i</span>&nbsp;<span class="op" id="5208224">&lt;&lt;</span>&nbsp;<span class="num" id="5208227">1</span><span class="op" id="5208228">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5208232">//&nbsp;Special&nbsp;cases&nbsp;for&nbsp;exec&nbsp;machine.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208268">switch</span>&nbsp;<span class="op" id="5208275">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208278">case</span>&nbsp;<span class="ident" id="5208283">flags</span><span class="op" id="5208288">&amp;</span><span class="ident" id="5208289">FoldCase</span>&nbsp;<span class="op" id="5208298">==</span>&nbsp;<span class="num" id="5208301">0</span>&nbsp;<span class="op" id="5208303">&amp;&amp;</span>&nbsp;<span class="op" id="5208306">(</span><span class="builtinfunc" id="5208307">len</span><span class="op" id="5208310">(</span><span class="ident" id="5208311">r</span><span class="op" id="5208312">)</span>&nbsp;<span class="op" id="5208314">==</span>&nbsp;<span class="num" id="5208317">1</span>&nbsp;<span class="op" id="5208319">||</span>&nbsp;<span class="builtinfunc" id="5208322">len</span><span class="op" id="5208325">(</span><span class="ident" id="5208326">r</span><span class="op" id="5208327">)</span>&nbsp;<span class="op" id="5208329">==</span>&nbsp;<span class="num" id="5208332">2</span>&nbsp;<span class="op" id="5208334">&amp;&amp;</span>&nbsp;<span class="ident" id="5208337">r</span><span class="op" id="5208338">[</span><span class="num" id="5208339">0</span><span class="op" id="5208340">]</span>&nbsp;<span class="op" id="5208342">==</span>&nbsp;<span class="ident" id="5208345">r</span><span class="op" id="5208346">[</span><span class="num" id="5208347">1</span><span class="op" id="5208348">]</span><span class="op" id="5208349">)</span><span class="op" id="5208350">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208354">i</span><span class="op" id="5208355">.</span><span class="ident" id="5208356">Op</span>&nbsp;<span class="op" id="5208359">=</span>&nbsp;<span class="ident" id="5208361">InstRune1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208372">case</span>&nbsp;<span class="builtinfunc" id="5208377">len</span><span class="op" id="5208380">(</span><span class="ident" id="5208381">r</span><span class="op" id="5208382">)</span>&nbsp;<span class="op" id="5208384">==</span>&nbsp;<span class="num" id="5208387">2</span>&nbsp;<span class="op" id="5208389">&amp;&amp;</span>&nbsp;<span class="ident" id="5208392">r</span><span class="op" id="5208393">[</span><span class="num" id="5208394">0</span><span class="op" id="5208395">]</span>&nbsp;<span class="op" id="5208397">==</span>&nbsp;<span class="num" id="5208400">0</span>&nbsp;<span class="op" id="5208402">&amp;&amp;</span>&nbsp;<span class="ident" id="5208405">r</span><span class="op" id="5208406">[</span><span class="num" id="5208407">1</span><span class="op" id="5208408">]</span>&nbsp;<span class="op" id="5208410">==</span>&nbsp;<span class="ident" id="5208413">unicode</span><span class="op" id="5208420">.</span><span class="ident" id="5208421">MaxRune</span><span class="op" id="5208428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208432">i</span><span class="op" id="5208433">.</span><span class="ident" id="5208434">Op</span>&nbsp;<span class="op" id="5208437">=</span>&nbsp;<span class="ident" id="5208439">InstRuneAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208452">case</span>&nbsp;<span class="builtinfunc" id="5208457">len</span><span class="op" id="5208460">(</span><span class="ident" id="5208461">r</span><span class="op" id="5208462">)</span>&nbsp;<span class="op" id="5208464">==</span>&nbsp;<span class="num" id="5208467">4</span>&nbsp;<span class="op" id="5208469">&amp;&amp;</span>&nbsp;<span class="ident" id="5208472">r</span><span class="op" id="5208473">[</span><span class="num" id="5208474">0</span><span class="op" id="5208475">]</span>&nbsp;<span class="op" id="5208477">==</span>&nbsp;<span class="num" id="5208480">0</span>&nbsp;<span class="op" id="5208482">&amp;&amp;</span>&nbsp;<span class="ident" id="5208485">r</span><span class="op" id="5208486">[</span><span class="num" id="5208487">1</span><span class="op" id="5208488">]</span>&nbsp;<span class="op" id="5208490">==</span>&nbsp;<span class="string" id="5208493">&#39;\n&#39;</span><span class="op" id="5208497">-</span><span class="num" id="5208498">1</span>&nbsp;<span class="op" id="5208500">&amp;&amp;</span>&nbsp;<span class="ident" id="5208503">r</span><span class="op" id="5208504">[</span><span class="num" id="5208505">2</span><span class="op" id="5208506">]</span>&nbsp;<span class="op" id="5208508">==</span>&nbsp;<span class="string" id="5208511">&#39;\n&#39;</span><span class="op" id="5208515">+</span><span class="num" id="5208516">1</span>&nbsp;<span class="op" id="5208518">&amp;&amp;</span>&nbsp;<span class="ident" id="5208521">r</span><span class="op" id="5208522">[</span><span class="num" id="5208523">3</span><span class="op" id="5208524">]</span>&nbsp;<span class="op" id="5208526">==</span>&nbsp;<span class="ident" id="5208529">unicode</span><span class="op" id="5208536">.</span><span class="ident" id="5208537">MaxRune</span><span class="op" id="5208544">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208548">i</span><span class="op" id="5208549">.</span><span class="ident" id="5208550">Op</span>&nbsp;<span class="op" id="5208553">=</span>&nbsp;<span class="ident" id="5208555">InstRuneAnyNotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5208573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208577">return</span>&nbsp;<span class="ident" id="5208584">f</span><br>
<span class="lineno"></span><span class="op" id="5208586">}</span>
</div>
</body>
</html>
