<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5442146">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5442201">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5442255">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5442306">//&nbsp;Package&nbsp;httptest&nbsp;provides&nbsp;utilities&nbsp;for&nbsp;HTTP&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="5442363">package</span>&nbsp;<span class="ident" id="5442371">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5442381">import</span>&nbsp;<span class="op" id="5442388">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5442391">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5442400">&#34;net/http&#34;</span><br>
<span class="lineno"></span><span class="op" id="5442411">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5442414">//&nbsp;ResponseRecorder&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;http.ResponseWriter&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5442483">//&nbsp;records&nbsp;its&nbsp;mutations&nbsp;for&nbsp;later&nbsp;inspection&nbsp;in&nbsp;tests.</span><br>
<span class="lineno">15</span><span class="keyword" id="5442539">type</span>&nbsp;<span class="ident" id="5442544">ResponseRecorder</span>&nbsp;<span class="keyword" id="5442561">struct</span>&nbsp;<span class="op" id="5442568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442571">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5442581">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5442595">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;code&nbsp;from&nbsp;WriteHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442639">HeaderMap</span>&nbsp;<span class="ident" id="5442649">http</span><span class="op" id="5442653">.</span><span class="ident" id="5442654">Header</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5442663">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442693">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5442703">*</span><span class="ident" id="5442704">bytes</span><span class="op" id="5442709">.</span><span class="ident" id="5442710">Buffer</span>&nbsp;<span class="comment" id="5442717">//&nbsp;if&nbsp;non-nil,&nbsp;the&nbsp;bytes.Buffer&nbsp;to&nbsp;append&nbsp;written&nbsp;data&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442776">Flushed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5442786">bool</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442793">wroteHeader</span>&nbsp;<span class="builtintype" id="5442805">bool</span><br>
<span class="lineno"></span><span class="op" id="5442810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5442813">//&nbsp;NewRecorder&nbsp;returns&nbsp;an&nbsp;initialized&nbsp;ResponseRecorder.</span><br>
<span class="lineno">25</span><span class="keyword" id="5442869">func</span>&nbsp;<span class="ident" id="5442874">NewRecorder</span><span class="op" id="5442885">(</span><span class="op" id="5442886">)</span>&nbsp;<span class="op" id="5442888">*</span><span class="ident" id="5442889">ResponseRecorder</span>&nbsp;<span class="op" id="5442906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442909">return</span>&nbsp;<span class="op" id="5442916">&amp;</span><span class="ident" id="5442917">ResponseRecorder</span><span class="op" id="5442933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442937">HeaderMap</span><span class="op" id="5442946">:</span>&nbsp;<span class="builtinfunc" id="5442948">make</span><span class="op" id="5442952">(</span><span class="ident" id="5442953">http</span><span class="op" id="5442957">.</span><span class="ident" id="5442958">Header</span><span class="op" id="5442964">)</span><span class="op" id="5442965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442969">Body</span><span class="op" id="5442973">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5442980">new</span><span class="op" id="5442983">(</span><span class="ident" id="5442984">bytes</span><span class="op" id="5442989">.</span><span class="ident" id="5442990">Buffer</span><span class="op" id="5442996">)</span><span class="op" id="5442997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443001">Code</span><span class="op" id="5443005">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5443012">200</span><span class="op" id="5443015">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443018">}</span><br>
<span class="lineno"></span><span class="op" id="5443020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5443023">//&nbsp;DefaultRemoteAddr&nbsp;is&nbsp;the&nbsp;default&nbsp;remote&nbsp;address&nbsp;to&nbsp;return&nbsp;in&nbsp;RemoteAddr&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5443101">//&nbsp;an&nbsp;explicit&nbsp;DefaultRemoteAddr&nbsp;isn&#39;t&nbsp;set&nbsp;on&nbsp;ResponseRecorder.</span><br>
<span class="lineno">35</span><span class="keyword" id="5443165">const</span>&nbsp;<span class="ident" id="5443171">DefaultRemoteAddr</span>&nbsp;<span class="op" id="5443189">=</span>&nbsp;<span class="string" id="5443191">&#34;1.2.3.4&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5443202">//&nbsp;Header&nbsp;returns&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="5443242">func</span>&nbsp;<span class="op" id="5443247">(</span><span class="ident" id="5443248">rw</span>&nbsp;<span class="op" id="5443251">*</span><span class="ident" id="5443252">ResponseRecorder</span><span class="op" id="5443268">)</span>&nbsp;<span class="ident" id="5443270">Header</span><span class="op" id="5443276">(</span><span class="op" id="5443277">)</span>&nbsp;<span class="ident" id="5443279">http</span><span class="op" id="5443283">.</span><span class="ident" id="5443284">Header</span>&nbsp;<span class="op" id="5443291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443294">m</span>&nbsp;<span class="op" id="5443296">:=</span>&nbsp;<span class="ident" id="5443299">rw</span><span class="op" id="5443301">.</span><span class="ident" id="5443302">HeaderMap</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443313">if</span>&nbsp;<span class="ident" id="5443316">m</span>&nbsp;<span class="op" id="5443318">==</span>&nbsp;<span class="ident" id="5443321">nil</span>&nbsp;<span class="op" id="5443325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443329">m</span>&nbsp;<span class="op" id="5443331">=</span>&nbsp;<span class="builtinfunc" id="5443333">make</span><span class="op" id="5443337">(</span><span class="ident" id="5443338">http</span><span class="op" id="5443342">.</span><span class="ident" id="5443343">Header</span><span class="op" id="5443349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443353">rw</span><span class="op" id="5443355">.</span><span class="ident" id="5443356">HeaderMap</span>&nbsp;<span class="op" id="5443366">=</span>&nbsp;<span class="ident" id="5443368">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443374">return</span>&nbsp;<span class="ident" id="5443381">m</span><br>
<span class="lineno">45</span><span class="op" id="5443383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5443386">//&nbsp;Write&nbsp;always&nbsp;succeeds&nbsp;and&nbsp;writes&nbsp;to&nbsp;rw.Body,&nbsp;if&nbsp;not&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5443446">func</span>&nbsp;<span class="op" id="5443451">(</span><span class="ident" id="5443452">rw</span>&nbsp;<span class="op" id="5443455">*</span><span class="ident" id="5443456">ResponseRecorder</span><span class="op" id="5443472">)</span>&nbsp;<span class="ident" id="5443474">Write</span><span class="op" id="5443479">(</span><span class="ident" id="5443480">buf</span>&nbsp;<span class="op" id="5443484">[</span><span class="op" id="5443485">]</span><span class="builtintype" id="5443486">byte</span><span class="op" id="5443490">)</span>&nbsp;<span class="op" id="5443492">(</span><span class="builtintype" id="5443493">int</span><span class="op" id="5443496">,</span>&nbsp;<span class="builtintype" id="5443498">error</span><span class="op" id="5443503">)</span>&nbsp;<span class="op" id="5443505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443508">if</span>&nbsp;<span class="op" id="5443511">!</span><span class="ident" id="5443512">rw</span><span class="op" id="5443514">.</span><span class="ident" id="5443515">wroteHeader</span>&nbsp;<span class="op" id="5443527">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443531">rw</span><span class="op" id="5443533">.</span><span class="ident" id="5443534">WriteHeader</span><span class="op" id="5443545">(</span><span class="num" id="5443546">200</span><span class="op" id="5443549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443555">if</span>&nbsp;<span class="ident" id="5443558">rw</span><span class="op" id="5443560">.</span><span class="ident" id="5443561">Body</span>&nbsp;<span class="op" id="5443566">!=</span>&nbsp;<span class="ident" id="5443569">nil</span>&nbsp;<span class="op" id="5443573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443577">rw</span><span class="op" id="5443579">.</span><span class="ident" id="5443580">Body</span><span class="op" id="5443584">.</span><span class="ident" id="5443585">Write</span><span class="op" id="5443590">(</span><span class="ident" id="5443591">buf</span><span class="op" id="5443594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443597">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443600">return</span>&nbsp;<span class="builtinfunc" id="5443607">len</span><span class="op" id="5443610">(</span><span class="ident" id="5443611">buf</span><span class="op" id="5443614">)</span><span class="op" id="5443615">,</span>&nbsp;<span class="ident" id="5443617">nil</span><br>
<span class="lineno"></span><span class="op" id="5443621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5443624">//&nbsp;WriteHeader&nbsp;sets&nbsp;rw.Code.</span><br>
<span class="lineno"></span><span class="keyword" id="5443653">func</span>&nbsp;<span class="op" id="5443658">(</span><span class="ident" id="5443659">rw</span>&nbsp;<span class="op" id="5443662">*</span><span class="ident" id="5443663">ResponseRecorder</span><span class="op" id="5443679">)</span>&nbsp;<span class="ident" id="5443681">WriteHeader</span><span class="op" id="5443692">(</span><span class="ident" id="5443693">code</span>&nbsp;<span class="builtintype" id="5443698">int</span><span class="op" id="5443701">)</span>&nbsp;<span class="op" id="5443703">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443706">if</span>&nbsp;<span class="op" id="5443709">!</span><span class="ident" id="5443710">rw</span><span class="op" id="5443712">.</span><span class="ident" id="5443713">wroteHeader</span>&nbsp;<span class="op" id="5443725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443729">rw</span><span class="op" id="5443731">.</span><span class="ident" id="5443732">Code</span>&nbsp;<span class="op" id="5443737">=</span>&nbsp;<span class="ident" id="5443739">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443748">rw</span><span class="op" id="5443750">.</span><span class="ident" id="5443751">wroteHeader</span>&nbsp;<span class="op" id="5443763">=</span>&nbsp;<span class="ident" id="5443765">true</span><br>
<span class="lineno"></span><span class="op" id="5443770">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="5443773">//&nbsp;Flush&nbsp;sets&nbsp;rw.Flushed&nbsp;to&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5443807">func</span>&nbsp;<span class="op" id="5443812">(</span><span class="ident" id="5443813">rw</span>&nbsp;<span class="op" id="5443816">*</span><span class="ident" id="5443817">ResponseRecorder</span><span class="op" id="5443833">)</span>&nbsp;<span class="ident" id="5443835">Flush</span><span class="op" id="5443840">(</span><span class="op" id="5443841">)</span>&nbsp;<span class="op" id="5443843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443846">if</span>&nbsp;<span class="op" id="5443849">!</span><span class="ident" id="5443850">rw</span><span class="op" id="5443852">.</span><span class="ident" id="5443853">wroteHeader</span>&nbsp;<span class="op" id="5443865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443869">rw</span><span class="op" id="5443871">.</span><span class="ident" id="5443872">WriteHeader</span><span class="op" id="5443883">(</span><span class="num" id="5443884">200</span><span class="op" id="5443887">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443893">rw</span><span class="op" id="5443895">.</span><span class="ident" id="5443896">Flushed</span>&nbsp;<span class="op" id="5443904">=</span>&nbsp;<span class="ident" id="5443906">true</span><br>
<span class="lineno"></span><span class="op" id="5443911">}</span>
</div>
</body>
</html>
