<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html" class="current">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7795663">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7795718">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7795772">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7795823">package</span>&nbsp;<span class="ident" id="7795831">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7795836">import</span>&nbsp;<span class="op" id="7795843">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7795846">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7795855">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7795871">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7795890">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7795904">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7795920">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7795936">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7795946">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7795953">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7795959">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7795971">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7795978">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7795984">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7795995">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7796012">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7796023">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7796034">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="7796041">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7796044">//&nbsp;zeroSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;returns&nbsp;an&nbsp;unlimited&nbsp;number&nbsp;of&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="7796122">type</span>&nbsp;<span class="ident" id="7796127">zeroSource</span>&nbsp;<span class="keyword" id="7796138">struct</span><span class="op" id="7796144">{</span><span class="op" id="7796145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7796148">func</span>&nbsp;<span class="op" id="7796153">(</span><span class="ident" id="7796154">zeroSource</span><span class="op" id="7796164">)</span>&nbsp;<span class="ident" id="7796166">Read</span><span class="op" id="7796170">(</span><span class="ident" id="7796171">b</span>&nbsp;<span class="op" id="7796173">[</span><span class="op" id="7796174">]</span><span class="builtintype" id="7796175">byte</span><span class="op" id="7796179">)</span>&nbsp;<span class="op" id="7796181">(</span><span class="ident" id="7796182">n</span>&nbsp;<span class="builtintype" id="7796184">int</span><span class="op" id="7796187">,</span>&nbsp;<span class="ident" id="7796189">err</span>&nbsp;<span class="builtintype" id="7796193">error</span><span class="op" id="7796198">)</span>&nbsp;<span class="op" id="7796200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7796203">for</span>&nbsp;<span class="ident" id="7796207">i</span>&nbsp;<span class="op" id="7796209">:=</span>&nbsp;<span class="keyword" id="7796212">range</span>&nbsp;<span class="ident" id="7796218">b</span>&nbsp;<span class="op" id="7796220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7796224">b</span><span class="op" id="7796225">[</span><span class="ident" id="7796226">i</span><span class="op" id="7796227">]</span>&nbsp;<span class="op" id="7796229">=</span>&nbsp;<span class="num" id="7796231">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7796234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7796238">return</span>&nbsp;<span class="builtinfunc" id="7796245">len</span><span class="op" id="7796248">(</span><span class="ident" id="7796249">b</span><span class="op" id="7796250">)</span><span class="op" id="7796251">,</span>&nbsp;<span class="builtintype" id="7796253">nil</span><br>
<span class="lineno"></span><span class="op" id="7796257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7796260">var</span>&nbsp;<span class="ident" id="7796264">testConfig</span>&nbsp;<span class="op" id="7796275">*</span><span class="ident" id="7796276">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="7796284">func</span>&nbsp;<span class="ident" id="7796289">init</span><span class="op" id="7796293">(</span><span class="op" id="7796294">)</span>&nbsp;<span class="op" id="7796296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7796299">testConfig</span>&nbsp;<span class="op" id="7796310">=</span>&nbsp;<span class="op" id="7796312">&amp;</span><span class="ident" id="7796313">Config</span><span class="op" id="7796319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7796323">Time</span><span class="op" id="7796327">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7796343">func</span><span class="op" id="7796347">(</span><span class="op" id="7796348">)</span>&nbsp;<span class="ident" id="7796350">time</span><span class="op" id="7796354">.</span><span class="ident" id="7796355">Time</span>&nbsp;<span class="op" id="7796360">{</span>&nbsp;<span class="keyword" id="7796362">return</span>&nbsp;<span class="ident" id="7796369">time</span><span class="op" id="7796373">.</span><span class="ident" id="7796374">Unix</span><span class="op" id="7796378">(</span><span class="num" id="7796379">0</span><span class="op" id="7796380">,</span>&nbsp;<span class="num" id="7796382">0</span><span class="op" id="7796383">)</span>&nbsp;<span class="op" id="7796385">}</span><span class="op" id="7796386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7796390">Rand</span><span class="op" id="7796394">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7796410">zeroSource</span><span class="op" id="7796420">{</span><span class="op" id="7796421">}</span><span class="op" id="7796422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7796426">Certificates</span><span class="op" id="7796438">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7796446">make</span><span class="op" id="7796450">(</span><span class="op" id="7796451">[</span><span class="op" id="7796452">]</span><span class="ident" id="7796453">Certificate</span><span class="op" id="7796464">,</span>&nbsp;<span class="num" id="7796466">2</span><span class="op" id="7796467">)</span><span class="op" id="7796468">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7796472">InsecureSkipVerify</span><span class="op" id="7796490">:</span>&nbsp;<span class="builtintype" id="7796492">true</span><span class="op" id="7796496">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7796500">MinVersion</span><span class="op" id="7796510">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7796520">VersionSSL30</span><span class="op" id="7796532">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7796536">MaxVersion</span><span class="op" id="7796546">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7796556">VersionTLS12</span><span class="op" id="7796568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7796571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7796574">testConfig</span><span class="op" id="7796584">.</span><span class="ident" id="7796585">Certificates</span><span class="op" id="7796597">[</span><span class="num" id="7796598">0</span><span class="op" id="7796599">]</span><span class="op" id="7796600">.</span><span class="ident" id="7796601">Certificate</span>&nbsp;<span class="op" id="7796613">=</span>&nbsp;<span class="op" id="7796615">[</span><span class="op" id="7796616">]</span><span class="op" id="7796617">[</span><span class="op" id="7796618">]</span><span class="builtintype" id="7796619">byte</span><span class="op" id="7796623">{</span><span class="ident" id="7796624">testRSACertificate</span><span class="op" id="7796642">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7796645">testConfig</span><span class="op" id="7796655">.</span><span class="ident" id="7796656">Certificates</span><span class="op" id="7796668">[</span><span class="num" id="7796669">0</span><span class="op" id="7796670">]</span><span class="op" id="7796671">.</span><span class="ident" id="7796672">PrivateKey</span>&nbsp;<span class="op" id="7796683">=</span>&nbsp;<span class="ident" id="7796685">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7796704">testConfig</span><span class="op" id="7796714">.</span><span class="ident" id="7796715">Certificates</span><span class="op" id="7796727">[</span><span class="num" id="7796728">1</span><span class="op" id="7796729">]</span><span class="op" id="7796730">.</span><span class="ident" id="7796731">Certificate</span>&nbsp;<span class="op" id="7796743">=</span>&nbsp;<span class="op" id="7796745">[</span><span class="op" id="7796746">]</span><span class="op" id="7796747">[</span><span class="op" id="7796748">]</span><span class="builtintype" id="7796749">byte</span><span class="op" id="7796753">{</span><span class="ident" id="7796754">testSNICertificate</span><span class="op" id="7796772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7796775">testConfig</span><span class="op" id="7796785">.</span><span class="ident" id="7796786">Certificates</span><span class="op" id="7796798">[</span><span class="num" id="7796799">1</span><span class="op" id="7796800">]</span><span class="op" id="7796801">.</span><span class="ident" id="7796802">PrivateKey</span>&nbsp;<span class="op" id="7796813">=</span>&nbsp;<span class="ident" id="7796815">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7796834">testConfig</span><span class="op" id="7796844">.</span><span class="ident" id="7796845">BuildNameToCertificate</span><span class="op" id="7796867">(</span><span class="op" id="7796868">)</span><br>
<span class="lineno"></span><span class="op" id="7796870">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="7796873">func</span>&nbsp;<span class="ident" id="7796878">testClientHelloFailure</span><span class="op" id="7796900">(</span><span class="ident" id="7796901">t</span>&nbsp;<span class="op" id="7796903">*</span><span class="ident" id="7796904">testing</span><span class="op" id="7796911">.</span><span class="ident" id="7796912">T</span><span class="op" id="7796913">,</span>&nbsp;<span class="ident" id="7796915">m</span>&nbsp;<span class="ident" id="7796917">handshakeMessage</span><span class="op" id="7796933">,</span>&nbsp;<span class="ident" id="7796935">expectedSubStr</span>&nbsp;<span class="builtintype" id="7796950">string</span><span class="op" id="7796956">)</span>&nbsp;<span class="op" id="7796958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7796961">//&nbsp;Create&nbsp;in-memory&nbsp;network&nbsp;connection,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7797002">//&nbsp;send&nbsp;message&nbsp;to&nbsp;server.&nbsp;&nbsp;Should&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7797045">//&nbsp;expected&nbsp;error.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7797065">c</span><span class="op" id="7797066">,</span>&nbsp;<span class="ident" id="7797068">s</span>&nbsp;<span class="op" id="7797070">:=</span>&nbsp;<span class="ident" id="7797073">net</span><span class="op" id="7797076">.</span><span class="ident" id="7797077">Pipe</span><span class="op" id="7797081">(</span><span class="op" id="7797082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7797085">go</span>&nbsp;<span class="keyword" id="7797088">func</span><span class="op" id="7797092">(</span><span class="op" id="7797093">)</span>&nbsp;<span class="op" id="7797095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7797099">cli</span>&nbsp;<span class="op" id="7797103">:=</span>&nbsp;<span class="ident" id="7797106">Client</span><span class="op" id="7797112">(</span><span class="ident" id="7797113">c</span><span class="op" id="7797114">,</span>&nbsp;<span class="ident" id="7797116">testConfig</span><span class="op" id="7797126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7797130">if</span>&nbsp;<span class="ident" id="7797133">ch</span><span class="op" id="7797135">,</span>&nbsp;<span class="ident" id="7797137">ok</span>&nbsp;<span class="op" id="7797140">:=</span>&nbsp;<span class="ident" id="7797143">m</span><span class="op" id="7797144">.</span><span class="op" id="7797145">(</span><span class="op" id="7797146">*</span><span class="ident" id="7797147">clientHelloMsg</span><span class="op" id="7797161">)</span><span class="op" id="7797162">;</span>&nbsp;<span class="ident" id="7797164">ok</span>&nbsp;<span class="op" id="7797167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7797172">cli</span><span class="op" id="7797175">.</span><span class="ident" id="7797176">vers</span>&nbsp;<span class="op" id="7797181">=</span>&nbsp;<span class="ident" id="7797183">ch</span><span class="op" id="7797185">.</span><span class="ident" id="7797186">vers</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7797193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7797197">cli</span><span class="op" id="7797200">.</span><span class="ident" id="7797201">writeRecord</span><span class="op" id="7797212">(</span><span class="ident" id="7797213">recordTypeHandshake</span><span class="op" id="7797232">,</span>&nbsp;<span class="ident" id="7797234">m</span><span class="op" id="7797235">.</span><span class="ident" id="7797236">marshal</span><span class="op" id="7797243">(</span><span class="op" id="7797244">)</span><span class="op" id="7797245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7797249">c</span><span class="op" id="7797250">.</span><span class="ident" id="7797251">Close</span><span class="op" id="7797256">(</span><span class="op" id="7797257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7797260">}</span><span class="op" id="7797261">(</span><span class="op" id="7797262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7797265">err</span>&nbsp;<span class="op" id="7797269">:=</span>&nbsp;<span class="ident" id="7797272">Server</span><span class="op" id="7797278">(</span><span class="ident" id="7797279">s</span><span class="op" id="7797280">,</span>&nbsp;<span class="ident" id="7797282">testConfig</span><span class="op" id="7797292">)</span><span class="op" id="7797293">.</span><span class="ident" id="7797294">Handshake</span><span class="op" id="7797303">(</span><span class="op" id="7797304">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7797307">s</span><span class="op" id="7797308">.</span><span class="ident" id="7797309">Close</span><span class="op" id="7797314">(</span><span class="op" id="7797315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7797318">if</span>&nbsp;<span class="ident" id="7797321">err</span>&nbsp;<span class="op" id="7797325">==</span>&nbsp;<span class="builtintype" id="7797328">nil</span>&nbsp;<span class="op" id="7797332">||</span>&nbsp;<span class="op" id="7797335">!</span><span class="ident" id="7797336">strings</span><span class="op" id="7797343">.</span><span class="ident" id="7797344">Contains</span><span class="op" id="7797352">(</span><span class="ident" id="7797353">err</span><span class="op" id="7797356">.</span><span class="ident" id="7797357">Error</span><span class="op" id="7797362">(</span><span class="op" id="7797363">)</span><span class="op" id="7797364">,</span>&nbsp;<span class="ident" id="7797366">expectedSubStr</span><span class="op" id="7797380">)</span>&nbsp;<span class="op" id="7797382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7797386">t</span><span class="op" id="7797387">.</span><span class="ident" id="7797388">Errorf</span><span class="op" id="7797394">(</span><span class="string" id="7797395">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected&nbsp;to&nbsp;match&nbsp;substring&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="7797444">,</span>&nbsp;<span class="ident" id="7797446">err</span><span class="op" id="7797449">,</span>&nbsp;<span class="ident" id="7797451">expectedSubStr</span><span class="op" id="7797465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7797468">}</span><br>
<span class="lineno"></span><span class="op" id="7797470">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7797473">func</span>&nbsp;<span class="ident" id="7797478">TestSimpleError</span><span class="op" id="7797493">(</span><span class="ident" id="7797494">t</span>&nbsp;<span class="op" id="7797496">*</span><span class="ident" id="7797497">testing</span><span class="op" id="7797504">.</span><span class="ident" id="7797505">T</span><span class="op" id="7797506">)</span>&nbsp;<span class="op" id="7797508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7797511">testClientHelloFailure</span><span class="op" id="7797533">(</span><span class="ident" id="7797534">t</span><span class="op" id="7797535">,</span>&nbsp;<span class="op" id="7797537">&amp;</span><span class="ident" id="7797538">serverHelloDoneMsg</span><span class="op" id="7797556">{</span><span class="op" id="7797557">}</span><span class="op" id="7797558">,</span>&nbsp;<span class="string" id="7797560">&#34;unexpected&nbsp;handshake&nbsp;message&#34;</span><span class="op" id="7797590">)</span><br>
<span class="lineno"></span><span class="op" id="7797592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7797595">var</span>&nbsp;<span class="ident" id="7797599">badProtocolVersions</span>&nbsp;<span class="op" id="7797619">=</span>&nbsp;<span class="op" id="7797621">[</span><span class="op" id="7797622">]</span><span class="builtintype" id="7797623">uint16</span><span class="op" id="7797629">{</span><span class="num" id="7797630">0x0000</span><span class="op" id="7797636">,</span>&nbsp;<span class="num" id="7797638">0x0005</span><span class="op" id="7797644">,</span>&nbsp;<span class="num" id="7797646">0x0100</span><span class="op" id="7797652">,</span>&nbsp;<span class="num" id="7797654">0x0105</span><span class="op" id="7797660">,</span>&nbsp;<span class="num" id="7797662">0x0200</span><span class="op" id="7797668">,</span>&nbsp;<span class="num" id="7797670">0x0205</span><span class="op" id="7797676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7797679">func</span>&nbsp;<span class="ident" id="7797684">TestRejectBadProtocolVersion</span><span class="op" id="7797712">(</span><span class="ident" id="7797713">t</span>&nbsp;<span class="op" id="7797715">*</span><span class="ident" id="7797716">testing</span><span class="op" id="7797723">.</span><span class="ident" id="7797724">T</span><span class="op" id="7797725">)</span>&nbsp;<span class="op" id="7797727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7797730">for</span>&nbsp;<span class="ident" id="7797734">_</span><span class="op" id="7797735">,</span>&nbsp;<span class="ident" id="7797737">v</span>&nbsp;<span class="op" id="7797739">:=</span>&nbsp;<span class="keyword" id="7797742">range</span>&nbsp;<span class="ident" id="7797748">badProtocolVersions</span>&nbsp;<span class="op" id="7797768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7797772">testClientHelloFailure</span><span class="op" id="7797794">(</span><span class="ident" id="7797795">t</span><span class="op" id="7797796">,</span>&nbsp;<span class="op" id="7797798">&amp;</span><span class="ident" id="7797799">clientHelloMsg</span><span class="op" id="7797813">{</span><span class="ident" id="7797814">vers</span><span class="op" id="7797818">:</span>&nbsp;<span class="ident" id="7797820">v</span><span class="op" id="7797821">}</span><span class="op" id="7797822">,</span>&nbsp;<span class="string" id="7797824">&#34;unsupported,&nbsp;maximum&nbsp;protocol&nbsp;version&#34;</span><span class="op" id="7797863">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7797866">}</span><br>
<span class="lineno"></span><span class="op" id="7797868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7797871">func</span>&nbsp;<span class="ident" id="7797876">TestNoSuiteOverlap</span><span class="op" id="7797894">(</span><span class="ident" id="7797895">t</span>&nbsp;<span class="op" id="7797897">*</span><span class="ident" id="7797898">testing</span><span class="op" id="7797905">.</span><span class="ident" id="7797906">T</span><span class="op" id="7797907">)</span>&nbsp;<span class="op" id="7797909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7797912">clientHello</span>&nbsp;<span class="op" id="7797924">:=</span>&nbsp;<span class="op" id="7797927">&amp;</span><span class="ident" id="7797928">clientHelloMsg</span><span class="op" id="7797942">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7797946">vers</span><span class="op" id="7797950">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7797966">0x0301</span><span class="op" id="7797972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7797976">cipherSuites</span><span class="op" id="7797988">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7797996">[</span><span class="op" id="7797997">]</span><span class="builtintype" id="7797998">uint16</span><span class="op" id="7798004">{</span><span class="num" id="7798005">0xff00</span><span class="op" id="7798011">}</span><span class="op" id="7798012">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7798016">compressionMethods</span><span class="op" id="7798034">:</span>&nbsp;<span class="op" id="7798036">[</span><span class="op" id="7798037">]</span><span class="builtintype" id="7798038">uint8</span><span class="op" id="7798043">{</span><span class="num" id="7798044">0</span><span class="op" id="7798045">}</span><span class="op" id="7798046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7798049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7798052">testClientHelloFailure</span><span class="op" id="7798074">(</span><span class="ident" id="7798075">t</span><span class="op" id="7798076">,</span>&nbsp;<span class="ident" id="7798078">clientHello</span><span class="op" id="7798089">,</span>&nbsp;<span class="string" id="7798091">&#34;no&nbsp;cipher&nbsp;suite&nbsp;supported&nbsp;by&nbsp;both&nbsp;client&nbsp;and&nbsp;server&#34;</span><span class="op" id="7798144">)</span><br>
<span class="lineno">95</span><span class="op" id="7798146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7798149">func</span>&nbsp;<span class="ident" id="7798154">TestNoCompressionOverlap</span><span class="op" id="7798178">(</span><span class="ident" id="7798179">t</span>&nbsp;<span class="op" id="7798181">*</span><span class="ident" id="7798182">testing</span><span class="op" id="7798189">.</span><span class="ident" id="7798190">T</span><span class="op" id="7798191">)</span>&nbsp;<span class="op" id="7798193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7798196">clientHello</span>&nbsp;<span class="op" id="7798208">:=</span>&nbsp;<span class="op" id="7798211">&amp;</span><span class="ident" id="7798212">clientHelloMsg</span><span class="op" id="7798226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7798230">vers</span><span class="op" id="7798234">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7798250">0x0301</span><span class="op" id="7798256">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7798260">cipherSuites</span><span class="op" id="7798272">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7798280">[</span><span class="op" id="7798281">]</span><span class="builtintype" id="7798282">uint16</span><span class="op" id="7798288">{</span><span class="ident" id="7798289">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7798313">}</span><span class="op" id="7798314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7798318">compressionMethods</span><span class="op" id="7798336">:</span>&nbsp;<span class="op" id="7798338">[</span><span class="op" id="7798339">]</span><span class="builtintype" id="7798340">uint8</span><span class="op" id="7798345">{</span><span class="num" id="7798346">0xff</span><span class="op" id="7798350">}</span><span class="op" id="7798351">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7798354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7798357">testClientHelloFailure</span><span class="op" id="7798379">(</span><span class="ident" id="7798380">t</span><span class="op" id="7798381">,</span>&nbsp;<span class="ident" id="7798383">clientHello</span><span class="op" id="7798394">,</span>&nbsp;<span class="string" id="7798396">&#34;client&nbsp;does&nbsp;not&nbsp;support&nbsp;uncompressed&nbsp;connections&#34;</span><span class="op" id="7798446">)</span><br>
<span class="lineno"></span><span class="op" id="7798448">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7798451">func</span>&nbsp;<span class="ident" id="7798456">TestTLS12OnlyCipherSuites</span><span class="op" id="7798481">(</span><span class="ident" id="7798482">t</span>&nbsp;<span class="op" id="7798484">*</span><span class="ident" id="7798485">testing</span><span class="op" id="7798492">.</span><span class="ident" id="7798493">T</span><span class="op" id="7798494">)</span>&nbsp;<span class="op" id="7798496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7798499">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;Server&nbsp;doesn&#39;t&nbsp;select&nbsp;a&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suite&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7798570">//&nbsp;the&nbsp;client&nbsp;negotiates&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7798605">var</span>&nbsp;<span class="ident" id="7798609">zeros</span>&nbsp;<span class="op" id="7798615">[</span><span class="num" id="7798616">32</span><span class="op" id="7798618">]</span><span class="builtintype" id="7798619">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7798626">clientHello</span>&nbsp;<span class="op" id="7798638">:=</span>&nbsp;<span class="op" id="7798641">&amp;</span><span class="ident" id="7798642">clientHelloMsg</span><span class="op" id="7798656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7798660">vers</span><span class="op" id="7798664">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7798668">VersionTLS11</span><span class="op" id="7798680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7798684">random</span><span class="op" id="7798690">:</span>&nbsp;<span class="ident" id="7798692">zeros</span><span class="op" id="7798697">[</span><span class="op" id="7798698">:</span><span class="op" id="7798699">]</span><span class="op" id="7798700">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7798704">cipherSuites</span><span class="op" id="7798716">:</span>&nbsp;<span class="op" id="7798718">[</span><span class="op" id="7798719">]</span><span class="builtintype" id="7798720">uint16</span><span class="op" id="7798726">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7798731">//&nbsp;The&nbsp;Server,&nbsp;by&nbsp;default,&nbsp;will&nbsp;use&nbsp;the&nbsp;client&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7798783">//&nbsp;preference&nbsp;order.&nbsp;So&nbsp;the&nbsp;GCM&nbsp;cipher&nbsp;suite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7798831">//&nbsp;will&nbsp;be&nbsp;selected&nbsp;unless&nbsp;it&#39;s&nbsp;excluded&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7798883">//&nbsp;of&nbsp;the&nbsp;version&nbsp;in&nbsp;this&nbsp;ClientHello.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7798925">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><span class="op" id="7798962">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7798967">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7798991">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7798995">}</span><span class="op" id="7798996">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799000">compressionMethods</span><span class="op" id="7799018">:</span>&nbsp;<span class="op" id="7799020">[</span><span class="op" id="7799021">]</span><span class="builtintype" id="7799022">uint8</span><span class="op" id="7799027">{</span><span class="ident" id="7799028">compressionNone</span><span class="op" id="7799043">}</span><span class="op" id="7799044">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799048">supportedCurves</span><span class="op" id="7799063">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7799068">[</span><span class="op" id="7799069">]</span><span class="ident" id="7799070">CurveID</span><span class="op" id="7799077">{</span><span class="ident" id="7799078">CurveP256</span><span class="op" id="7799087">,</span>&nbsp;<span class="ident" id="7799089">CurveP384</span><span class="op" id="7799098">,</span>&nbsp;<span class="ident" id="7799100">CurveP521</span><span class="op" id="7799109">}</span><span class="op" id="7799110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799114">supportedPoints</span><span class="op" id="7799129">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7799134">[</span><span class="op" id="7799135">]</span><span class="builtintype" id="7799136">uint8</span><span class="op" id="7799141">{</span><span class="ident" id="7799142">pointFormatUncompressed</span><span class="op" id="7799165">}</span><span class="op" id="7799166">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7799169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799173">c</span><span class="op" id="7799174">,</span>&nbsp;<span class="ident" id="7799176">s</span>&nbsp;<span class="op" id="7799178">:=</span>&nbsp;<span class="ident" id="7799181">net</span><span class="op" id="7799184">.</span><span class="ident" id="7799185">Pipe</span><span class="op" id="7799189">(</span><span class="op" id="7799190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7799193">var</span>&nbsp;<span class="ident" id="7799197">reply</span>&nbsp;<span class="keyword" id="7799203">interface</span><span class="op" id="7799212">{</span><span class="op" id="7799213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7799216">var</span>&nbsp;<span class="ident" id="7799220">clientErr</span>&nbsp;<span class="builtintype" id="7799230">error</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7799237">go</span>&nbsp;<span class="keyword" id="7799240">func</span><span class="op" id="7799244">(</span><span class="op" id="7799245">)</span>&nbsp;<span class="op" id="7799247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799251">cli</span>&nbsp;<span class="op" id="7799255">:=</span>&nbsp;<span class="ident" id="7799258">Client</span><span class="op" id="7799264">(</span><span class="ident" id="7799265">c</span><span class="op" id="7799266">,</span>&nbsp;<span class="ident" id="7799268">testConfig</span><span class="op" id="7799278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799282">cli</span><span class="op" id="7799285">.</span><span class="ident" id="7799286">vers</span>&nbsp;<span class="op" id="7799291">=</span>&nbsp;<span class="ident" id="7799293">clientHello</span><span class="op" id="7799304">.</span><span class="ident" id="7799305">vers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799312">cli</span><span class="op" id="7799315">.</span><span class="ident" id="7799316">writeRecord</span><span class="op" id="7799327">(</span><span class="ident" id="7799328">recordTypeHandshake</span><span class="op" id="7799347">,</span>&nbsp;<span class="ident" id="7799349">clientHello</span><span class="op" id="7799360">.</span><span class="ident" id="7799361">marshal</span><span class="op" id="7799368">(</span><span class="op" id="7799369">)</span><span class="op" id="7799370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799374">reply</span><span class="op" id="7799379">,</span>&nbsp;<span class="ident" id="7799381">clientErr</span>&nbsp;<span class="op" id="7799391">=</span>&nbsp;<span class="ident" id="7799393">cli</span><span class="op" id="7799396">.</span><span class="ident" id="7799397">readHandshake</span><span class="op" id="7799410">(</span><span class="op" id="7799411">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799415">c</span><span class="op" id="7799416">.</span><span class="ident" id="7799417">Close</span><span class="op" id="7799422">(</span><span class="op" id="7799423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7799426">}</span><span class="op" id="7799427">(</span><span class="op" id="7799428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799431">config</span>&nbsp;<span class="op" id="7799438">:=</span>&nbsp;<span class="op" id="7799441">*</span><span class="ident" id="7799442">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799454">config</span><span class="op" id="7799460">.</span><span class="ident" id="7799461">CipherSuites</span>&nbsp;<span class="op" id="7799474">=</span>&nbsp;<span class="ident" id="7799476">clientHello</span><span class="op" id="7799487">.</span><span class="ident" id="7799488">cipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799502">Server</span><span class="op" id="7799508">(</span><span class="ident" id="7799509">s</span><span class="op" id="7799510">,</span>&nbsp;<span class="op" id="7799512">&amp;</span><span class="ident" id="7799513">config</span><span class="op" id="7799519">)</span><span class="op" id="7799520">.</span><span class="ident" id="7799521">Handshake</span><span class="op" id="7799530">(</span><span class="op" id="7799531">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799534">s</span><span class="op" id="7799535">.</span><span class="ident" id="7799536">Close</span><span class="op" id="7799541">(</span><span class="op" id="7799542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7799545">if</span>&nbsp;<span class="ident" id="7799548">clientErr</span>&nbsp;<span class="op" id="7799558">!=</span>&nbsp;<span class="builtintype" id="7799561">nil</span>&nbsp;<span class="op" id="7799565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799569">t</span><span class="op" id="7799570">.</span><span class="ident" id="7799571">Fatal</span><span class="op" id="7799576">(</span><span class="ident" id="7799577">clientErr</span><span class="op" id="7799586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7799589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799592">serverHello</span><span class="op" id="7799603">,</span>&nbsp;<span class="ident" id="7799605">ok</span>&nbsp;<span class="op" id="7799608">:=</span>&nbsp;<span class="ident" id="7799611">reply</span><span class="op" id="7799616">.</span><span class="op" id="7799617">(</span><span class="op" id="7799618">*</span><span class="ident" id="7799619">serverHelloMsg</span><span class="op" id="7799633">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7799636">if</span>&nbsp;<span class="op" id="7799639">!</span><span class="ident" id="7799640">ok</span>&nbsp;<span class="op" id="7799643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799647">t</span><span class="op" id="7799648">.</span><span class="ident" id="7799649">Fatalf</span><span class="op" id="7799655">(</span><span class="string" id="7799656">&#34;didn&#39;t&nbsp;get&nbsp;ServerHello&nbsp;message&nbsp;in&nbsp;reply.&nbsp;Got&nbsp;%v\n&#34;</span><span class="op" id="7799707">,</span>&nbsp;<span class="ident" id="7799709">reply</span><span class="op" id="7799714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7799717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7799720">if</span>&nbsp;<span class="ident" id="7799723">s</span>&nbsp;<span class="op" id="7799725">:=</span>&nbsp;<span class="ident" id="7799728">serverHello</span><span class="op" id="7799739">.</span><span class="ident" id="7799740">cipherSuite</span><span class="op" id="7799751">;</span>&nbsp;<span class="ident" id="7799753">s</span>&nbsp;<span class="op" id="7799755">!=</span>&nbsp;<span class="ident" id="7799758">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="7799783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799787">t</span><span class="op" id="7799788">.</span><span class="ident" id="7799789">Fatalf</span><span class="op" id="7799795">(</span><span class="string" id="7799796">&#34;bad&nbsp;cipher&nbsp;suite&nbsp;from&nbsp;server:&nbsp;%x&#34;</span><span class="op" id="7799830">,</span>&nbsp;<span class="ident" id="7799832">s</span><span class="op" id="7799833">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7799836">}</span><br>
<span class="lineno"></span><span class="op" id="7799838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7799841">func</span>&nbsp;<span class="ident" id="7799846">TestAlertForwarding</span><span class="op" id="7799865">(</span><span class="ident" id="7799866">t</span>&nbsp;<span class="op" id="7799868">*</span><span class="ident" id="7799869">testing</span><span class="op" id="7799876">.</span><span class="ident" id="7799877">T</span><span class="op" id="7799878">)</span>&nbsp;<span class="op" id="7799880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799883">c</span><span class="op" id="7799884">,</span>&nbsp;<span class="ident" id="7799886">s</span>&nbsp;<span class="op" id="7799888">:=</span>&nbsp;<span class="ident" id="7799891">net</span><span class="op" id="7799894">.</span><span class="ident" id="7799895">Pipe</span><span class="op" id="7799899">(</span><span class="op" id="7799900">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7799903">go</span>&nbsp;<span class="keyword" id="7799906">func</span><span class="op" id="7799910">(</span><span class="op" id="7799911">)</span>&nbsp;<span class="op" id="7799913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799917">Client</span><span class="op" id="7799923">(</span><span class="ident" id="7799924">c</span><span class="op" id="7799925">,</span>&nbsp;<span class="ident" id="7799927">testConfig</span><span class="op" id="7799937">)</span><span class="op" id="7799938">.</span><span class="ident" id="7799939">sendAlert</span><span class="op" id="7799948">(</span><span class="ident" id="7799949">alertUnknownCA</span><span class="op" id="7799963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799967">c</span><span class="op" id="7799968">.</span><span class="ident" id="7799969">Close</span><span class="op" id="7799974">(</span><span class="op" id="7799975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7799978">}</span><span class="op" id="7799979">(</span><span class="op" id="7799980">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7799984">err</span>&nbsp;<span class="op" id="7799988">:=</span>&nbsp;<span class="ident" id="7799991">Server</span><span class="op" id="7799997">(</span><span class="ident" id="7799998">s</span><span class="op" id="7799999">,</span>&nbsp;<span class="ident" id="7800001">testConfig</span><span class="op" id="7800011">)</span><span class="op" id="7800012">.</span><span class="ident" id="7800013">Handshake</span><span class="op" id="7800022">(</span><span class="op" id="7800023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800026">s</span><span class="op" id="7800027">.</span><span class="ident" id="7800028">Close</span><span class="op" id="7800033">(</span><span class="op" id="7800034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7800037">if</span>&nbsp;<span class="ident" id="7800040">e</span><span class="op" id="7800041">,</span>&nbsp;<span class="ident" id="7800043">ok</span>&nbsp;<span class="op" id="7800046">:=</span>&nbsp;<span class="ident" id="7800049">err</span><span class="op" id="7800052">.</span><span class="op" id="7800053">(</span><span class="op" id="7800054">*</span><span class="ident" id="7800055">net</span><span class="op" id="7800058">.</span><span class="ident" id="7800059">OpError</span><span class="op" id="7800066">)</span><span class="op" id="7800067">;</span>&nbsp;<span class="op" id="7800069">!</span><span class="ident" id="7800070">ok</span>&nbsp;<span class="op" id="7800073">||</span>&nbsp;<span class="ident" id="7800076">e</span><span class="op" id="7800077">.</span><span class="ident" id="7800078">Err</span>&nbsp;<span class="op" id="7800082">!=</span>&nbsp;<span class="builtintype" id="7800085">error</span><span class="op" id="7800090">(</span><span class="ident" id="7800091">alertUnknownCA</span><span class="op" id="7800105">)</span>&nbsp;<span class="op" id="7800107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800111">t</span><span class="op" id="7800112">.</span><span class="ident" id="7800113">Errorf</span><span class="op" id="7800119">(</span><span class="string" id="7800120">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="7800149">,</span>&nbsp;<span class="ident" id="7800151">err</span><span class="op" id="7800154">,</span>&nbsp;<span class="builtintype" id="7800156">error</span><span class="op" id="7800161">(</span><span class="ident" id="7800162">alertUnknownCA</span><span class="op" id="7800176">)</span><span class="op" id="7800177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7800180">}</span><br>
<span class="lineno">165</span><span class="op" id="7800182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7800185">func</span>&nbsp;<span class="ident" id="7800190">TestClose</span><span class="op" id="7800199">(</span><span class="ident" id="7800200">t</span>&nbsp;<span class="op" id="7800202">*</span><span class="ident" id="7800203">testing</span><span class="op" id="7800210">.</span><span class="ident" id="7800211">T</span><span class="op" id="7800212">)</span>&nbsp;<span class="op" id="7800214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800217">c</span><span class="op" id="7800218">,</span>&nbsp;<span class="ident" id="7800220">s</span>&nbsp;<span class="op" id="7800222">:=</span>&nbsp;<span class="ident" id="7800225">net</span><span class="op" id="7800228">.</span><span class="ident" id="7800229">Pipe</span><span class="op" id="7800233">(</span><span class="op" id="7800234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7800237">go</span>&nbsp;<span class="ident" id="7800240">c</span><span class="op" id="7800241">.</span><span class="ident" id="7800242">Close</span><span class="op" id="7800247">(</span><span class="op" id="7800248">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800252">err</span>&nbsp;<span class="op" id="7800256">:=</span>&nbsp;<span class="ident" id="7800259">Server</span><span class="op" id="7800265">(</span><span class="ident" id="7800266">s</span><span class="op" id="7800267">,</span>&nbsp;<span class="ident" id="7800269">testConfig</span><span class="op" id="7800279">)</span><span class="op" id="7800280">.</span><span class="ident" id="7800281">Handshake</span><span class="op" id="7800290">(</span><span class="op" id="7800291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800294">s</span><span class="op" id="7800295">.</span><span class="ident" id="7800296">Close</span><span class="op" id="7800301">(</span><span class="op" id="7800302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7800305">if</span>&nbsp;<span class="ident" id="7800308">err</span>&nbsp;<span class="op" id="7800312">!=</span>&nbsp;<span class="ident" id="7800315">io</span><span class="op" id="7800317">.</span><span class="ident" id="7800318">EOF</span>&nbsp;<span class="op" id="7800322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800326">t</span><span class="op" id="7800327">.</span><span class="ident" id="7800328">Errorf</span><span class="op" id="7800334">(</span><span class="string" id="7800335">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="7800364">,</span>&nbsp;<span class="ident" id="7800366">err</span><span class="op" id="7800369">,</span>&nbsp;<span class="ident" id="7800371">io</span><span class="op" id="7800373">.</span><span class="ident" id="7800374">EOF</span><span class="op" id="7800377">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7800380">}</span><br>
<span class="lineno"></span><span class="op" id="7800382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7800385">func</span>&nbsp;<span class="ident" id="7800390">testHandshake</span><span class="op" id="7800403">(</span><span class="ident" id="7800404">clientConfig</span><span class="op" id="7800416">,</span>&nbsp;<span class="ident" id="7800418">serverConfig</span>&nbsp;<span class="op" id="7800431">*</span><span class="ident" id="7800432">Config</span><span class="op" id="7800438">)</span>&nbsp;<span class="op" id="7800440">(</span><span class="ident" id="7800441">state</span>&nbsp;<span class="ident" id="7800447">ConnectionState</span><span class="op" id="7800462">,</span>&nbsp;<span class="ident" id="7800464">err</span>&nbsp;<span class="builtintype" id="7800468">error</span><span class="op" id="7800473">)</span>&nbsp;<span class="op" id="7800475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800478">c</span><span class="op" id="7800479">,</span>&nbsp;<span class="ident" id="7800481">s</span>&nbsp;<span class="op" id="7800483">:=</span>&nbsp;<span class="ident" id="7800486">net</span><span class="op" id="7800489">.</span><span class="ident" id="7800490">Pipe</span><span class="op" id="7800494">(</span><span class="op" id="7800495">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800498">done</span>&nbsp;<span class="op" id="7800503">:=</span>&nbsp;<span class="builtinfunc" id="7800506">make</span><span class="op" id="7800510">(</span><span class="keyword" id="7800511">chan</span>&nbsp;<span class="builtintype" id="7800516">bool</span><span class="op" id="7800520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7800523">go</span>&nbsp;<span class="keyword" id="7800526">func</span><span class="op" id="7800530">(</span><span class="op" id="7800531">)</span>&nbsp;<span class="op" id="7800533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800537">cli</span>&nbsp;<span class="op" id="7800541">:=</span>&nbsp;<span class="ident" id="7800544">Client</span><span class="op" id="7800550">(</span><span class="ident" id="7800551">c</span><span class="op" id="7800552">,</span>&nbsp;<span class="ident" id="7800554">clientConfig</span><span class="op" id="7800566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800570">cli</span><span class="op" id="7800573">.</span><span class="ident" id="7800574">Handshake</span><span class="op" id="7800583">(</span><span class="op" id="7800584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800588">c</span><span class="op" id="7800589">.</span><span class="ident" id="7800590">Close</span><span class="op" id="7800595">(</span><span class="op" id="7800596">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800600">done</span>&nbsp;<span class="op" id="7800605">&lt;-</span>&nbsp;<span class="builtintype" id="7800608">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7800614">}</span><span class="op" id="7800615">(</span><span class="op" id="7800616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800619">server</span>&nbsp;<span class="op" id="7800626">:=</span>&nbsp;<span class="ident" id="7800629">Server</span><span class="op" id="7800635">(</span><span class="ident" id="7800636">s</span><span class="op" id="7800637">,</span>&nbsp;<span class="ident" id="7800639">serverConfig</span><span class="op" id="7800651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800654">err</span>&nbsp;<span class="op" id="7800658">=</span>&nbsp;<span class="ident" id="7800660">server</span><span class="op" id="7800666">.</span><span class="ident" id="7800667">Handshake</span><span class="op" id="7800676">(</span><span class="op" id="7800677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7800680">if</span>&nbsp;<span class="ident" id="7800683">err</span>&nbsp;<span class="op" id="7800687">==</span>&nbsp;<span class="builtintype" id="7800690">nil</span>&nbsp;<span class="op" id="7800694">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800698">state</span>&nbsp;<span class="op" id="7800704">=</span>&nbsp;<span class="ident" id="7800706">server</span><span class="op" id="7800712">.</span><span class="ident" id="7800713">ConnectionState</span><span class="op" id="7800728">(</span><span class="op" id="7800729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7800732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800735">s</span><span class="op" id="7800736">.</span><span class="ident" id="7800737">Close</span><span class="op" id="7800742">(</span><span class="op" id="7800743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7800746">&lt;-</span><span class="ident" id="7800748">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7800754">return</span><br>
<span class="lineno">195</span><span class="op" id="7800761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7800764">func</span>&nbsp;<span class="ident" id="7800769">TestVersion</span><span class="op" id="7800780">(</span><span class="ident" id="7800781">t</span>&nbsp;<span class="op" id="7800783">*</span><span class="ident" id="7800784">testing</span><span class="op" id="7800791">.</span><span class="ident" id="7800792">T</span><span class="op" id="7800793">)</span>&nbsp;<span class="op" id="7800795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800798">serverConfig</span>&nbsp;<span class="op" id="7800811">:=</span>&nbsp;<span class="op" id="7800814">&amp;</span><span class="ident" id="7800815">Config</span><span class="op" id="7800821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800825">Certificates</span><span class="op" id="7800837">:</span>&nbsp;<span class="ident" id="7800839">testConfig</span><span class="op" id="7800849">.</span><span class="ident" id="7800850">Certificates</span><span class="op" id="7800862">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800866">MaxVersion</span><span class="op" id="7800876">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7800880">VersionTLS11</span><span class="op" id="7800892">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7800895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800898">clientConfig</span>&nbsp;<span class="op" id="7800911">:=</span>&nbsp;<span class="op" id="7800914">&amp;</span><span class="ident" id="7800915">Config</span><span class="op" id="7800921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800925">InsecureSkipVerify</span><span class="op" id="7800943">:</span>&nbsp;<span class="builtintype" id="7800945">true</span><span class="op" id="7800949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7800952">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7800955">state</span><span class="op" id="7800960">,</span>&nbsp;<span class="ident" id="7800962">err</span>&nbsp;<span class="op" id="7800966">:=</span>&nbsp;<span class="ident" id="7800969">testHandshake</span><span class="op" id="7800982">(</span><span class="ident" id="7800983">clientConfig</span><span class="op" id="7800995">,</span>&nbsp;<span class="ident" id="7800997">serverConfig</span><span class="op" id="7801009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7801012">if</span>&nbsp;<span class="ident" id="7801015">err</span>&nbsp;<span class="op" id="7801019">!=</span>&nbsp;<span class="builtintype" id="7801022">nil</span>&nbsp;<span class="op" id="7801026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7801030">t</span><span class="op" id="7801031">.</span><span class="ident" id="7801032">Fatalf</span><span class="op" id="7801038">(</span><span class="string" id="7801039">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7801061">,</span>&nbsp;<span class="ident" id="7801063">err</span><span class="op" id="7801066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7801069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7801072">if</span>&nbsp;<span class="ident" id="7801075">state</span><span class="op" id="7801080">.</span><span class="ident" id="7801081">Version</span>&nbsp;<span class="op" id="7801089">!=</span>&nbsp;<span class="ident" id="7801092">VersionTLS11</span>&nbsp;<span class="op" id="7801105">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7801109">t</span><span class="op" id="7801110">.</span><span class="ident" id="7801111">Fatalf</span><span class="op" id="7801117">(</span><span class="string" id="7801118">&#34;Incorrect&nbsp;version&nbsp;%x,&nbsp;should&nbsp;be&nbsp;%x&#34;</span><span class="op" id="7801154">,</span>&nbsp;<span class="ident" id="7801156">state</span><span class="op" id="7801161">.</span><span class="ident" id="7801162">Version</span><span class="op" id="7801169">,</span>&nbsp;<span class="ident" id="7801171">VersionTLS11</span><span class="op" id="7801183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7801186">}</span><br>
<span class="lineno"></span><span class="op" id="7801188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7801191">func</span>&nbsp;<span class="ident" id="7801196">TestCipherSuitePreference</span><span class="op" id="7801221">(</span><span class="ident" id="7801222">t</span>&nbsp;<span class="op" id="7801224">*</span><span class="ident" id="7801225">testing</span><span class="op" id="7801232">.</span><span class="ident" id="7801233">T</span><span class="op" id="7801234">)</span>&nbsp;<span class="op" id="7801236">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7801239">serverConfig</span>&nbsp;<span class="op" id="7801252">:=</span>&nbsp;<span class="op" id="7801255">&amp;</span><span class="ident" id="7801256">Config</span><span class="op" id="7801262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7801266">CipherSuites</span><span class="op" id="7801278">:</span>&nbsp;<span class="op" id="7801280">[</span><span class="op" id="7801281">]</span><span class="builtintype" id="7801282">uint16</span><span class="op" id="7801288">{</span><span class="ident" id="7801289">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7801313">,</span>&nbsp;<span class="ident" id="7801315">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="7801343">,</span>&nbsp;<span class="ident" id="7801345">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="7801375">}</span><span class="op" id="7801376">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7801380">Certificates</span><span class="op" id="7801392">:</span>&nbsp;<span class="ident" id="7801394">testConfig</span><span class="op" id="7801404">.</span><span class="ident" id="7801405">Certificates</span><span class="op" id="7801417">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7801421">MaxVersion</span><span class="op" id="7801431">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7801435">VersionTLS11</span><span class="op" id="7801447">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7801450">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7801453">clientConfig</span>&nbsp;<span class="op" id="7801466">:=</span>&nbsp;<span class="op" id="7801469">&amp;</span><span class="ident" id="7801470">Config</span><span class="op" id="7801476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7801480">CipherSuites</span><span class="op" id="7801492">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7801500">[</span><span class="op" id="7801501">]</span><span class="builtintype" id="7801502">uint16</span><span class="op" id="7801508">{</span><span class="ident" id="7801509">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="7801537">,</span>&nbsp;<span class="ident" id="7801539">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7801563">}</span><span class="op" id="7801564">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7801568">InsecureSkipVerify</span><span class="op" id="7801586">:</span>&nbsp;<span class="builtintype" id="7801588">true</span><span class="op" id="7801592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7801595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7801598">state</span><span class="op" id="7801603">,</span>&nbsp;<span class="ident" id="7801605">err</span>&nbsp;<span class="op" id="7801609">:=</span>&nbsp;<span class="ident" id="7801612">testHandshake</span><span class="op" id="7801625">(</span><span class="ident" id="7801626">clientConfig</span><span class="op" id="7801638">,</span>&nbsp;<span class="ident" id="7801640">serverConfig</span><span class="op" id="7801652">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7801655">if</span>&nbsp;<span class="ident" id="7801658">err</span>&nbsp;<span class="op" id="7801662">!=</span>&nbsp;<span class="builtintype" id="7801665">nil</span>&nbsp;<span class="op" id="7801669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7801673">t</span><span class="op" id="7801674">.</span><span class="ident" id="7801675">Fatalf</span><span class="op" id="7801681">(</span><span class="string" id="7801682">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7801704">,</span>&nbsp;<span class="ident" id="7801706">err</span><span class="op" id="7801709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7801712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7801715">if</span>&nbsp;<span class="ident" id="7801718">state</span><span class="op" id="7801723">.</span><span class="ident" id="7801724">CipherSuite</span>&nbsp;<span class="op" id="7801736">!=</span>&nbsp;<span class="ident" id="7801739">TLS_RSA_WITH_AES_128_CBC_SHA</span>&nbsp;<span class="op" id="7801768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7801772">//&nbsp;By&nbsp;default&nbsp;the&nbsp;server&nbsp;should&nbsp;use&nbsp;the&nbsp;client&#39;s&nbsp;preference.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7801835">t</span><span class="op" id="7801836">.</span><span class="ident" id="7801837">Fatalf</span><span class="op" id="7801843">(</span><span class="string" id="7801844">&#34;Client&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="7801886">,</span>&nbsp;<span class="ident" id="7801888">state</span><span class="op" id="7801893">.</span><span class="ident" id="7801894">CipherSuite</span><span class="op" id="7801905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7801908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7801912">serverConfig</span><span class="op" id="7801924">.</span><span class="ident" id="7801925">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7801950">=</span>&nbsp;<span class="builtintype" id="7801952">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7801958">state</span><span class="op" id="7801963">,</span>&nbsp;<span class="ident" id="7801965">err</span>&nbsp;<span class="op" id="7801969">=</span>&nbsp;<span class="ident" id="7801971">testHandshake</span><span class="op" id="7801984">(</span><span class="ident" id="7801985">clientConfig</span><span class="op" id="7801997">,</span>&nbsp;<span class="ident" id="7801999">serverConfig</span><span class="op" id="7802011">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7802014">if</span>&nbsp;<span class="ident" id="7802017">err</span>&nbsp;<span class="op" id="7802021">!=</span>&nbsp;<span class="builtintype" id="7802024">nil</span>&nbsp;<span class="op" id="7802028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7802032">t</span><span class="op" id="7802033">.</span><span class="ident" id="7802034">Fatalf</span><span class="op" id="7802040">(</span><span class="string" id="7802041">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7802063">,</span>&nbsp;<span class="ident" id="7802065">err</span><span class="op" id="7802068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7802071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7802074">if</span>&nbsp;<span class="ident" id="7802077">state</span><span class="op" id="7802082">.</span><span class="ident" id="7802083">CipherSuite</span>&nbsp;<span class="op" id="7802095">!=</span>&nbsp;<span class="ident" id="7802098">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="7802123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7802127">t</span><span class="op" id="7802128">.</span><span class="ident" id="7802129">Fatalf</span><span class="op" id="7802135">(</span><span class="string" id="7802136">&#34;Server&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="7802178">,</span>&nbsp;<span class="ident" id="7802180">state</span><span class="op" id="7802185">.</span><span class="ident" id="7802186">CipherSuite</span><span class="op" id="7802197">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7802200">}</span><br>
<span class="lineno"></span><span class="op" id="7802202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7802205">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7802280">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="7802296">//&nbsp;serverTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;server&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7802376">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="7802395">type</span>&nbsp;<span class="ident" id="7802400">serverTest</span>&nbsp;<span class="keyword" id="7802411">struct</span>&nbsp;<span class="op" id="7802418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7802421">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7802494">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7802535">name</span>&nbsp;<span class="builtintype" id="7802540">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7802548">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7802614">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7802659">command</span>&nbsp;<span class="op" id="7802667">[</span><span class="op" id="7802668">]</span><span class="builtintype" id="7802669">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7802677">//&nbsp;expectedPeerCerts&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;PEM&nbsp;blocks&nbsp;of&nbsp;expected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7802741">//&nbsp;certificates&nbsp;from&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7802775">expectedPeerCerts</span>&nbsp;<span class="op" id="7802793">[</span><span class="op" id="7802794">]</span><span class="builtintype" id="7802795">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7802803">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7802874">config</span>&nbsp;<span class="op" id="7802881">*</span><span class="ident" id="7802882">Config</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7802890">//&nbsp;expectAlert,&nbsp;if&nbsp;true,&nbsp;indicates&nbsp;that&nbsp;a&nbsp;fatal&nbsp;alert&nbsp;should&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7802964">//&nbsp;when&nbsp;handshaking&nbsp;with&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7803002">expectAlert</span>&nbsp;<span class="builtintype" id="7803014">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7803020">//&nbsp;expectHandshakeErrorIncluding,&nbsp;when&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7803089">//&nbsp;that&nbsp;must&nbsp;be&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;error&nbsp;resulting&nbsp;from&nbsp;the&nbsp;handshake.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7803161">expectHandshakeErrorIncluding</span>&nbsp;<span class="builtintype" id="7803191">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7803199">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7803268">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;false&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7803341">//&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7803378">validate</span>&nbsp;<span class="keyword" id="7803387">func</span><span class="op" id="7803391">(</span><span class="ident" id="7803392">ConnectionState</span><span class="op" id="7803407">)</span>&nbsp;<span class="builtintype" id="7803409">error</span><br>
<span class="lineno">270</span><span class="op" id="7803415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7803418">var</span>&nbsp;<span class="ident" id="7803422">defaultClientCommand</span>&nbsp;<span class="op" id="7803443">=</span>&nbsp;<span class="op" id="7803445">[</span><span class="op" id="7803446">]</span><span class="builtintype" id="7803447">string</span><span class="op" id="7803453">{</span><span class="string" id="7803454">&#34;openssl&#34;</span><span class="op" id="7803463">,</span>&nbsp;<span class="string" id="7803465">&#34;s_client&#34;</span><span class="op" id="7803475">,</span>&nbsp;<span class="string" id="7803477">&#34;-no_ticket&#34;</span><span class="op" id="7803489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7803492">//&nbsp;connFromCommand&nbsp;starts&nbsp;opens&nbsp;a&nbsp;listening&nbsp;socket&nbsp;and&nbsp;starts&nbsp;the&nbsp;reference</span><br>
<span class="lineno">275</span><span class="comment" id="7803568">//&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;it.&nbsp;It&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;that&nbsp;wraps&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="7803648">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="7803663">func</span>&nbsp;<span class="op" id="7803668">(</span><span class="ident" id="7803669">test</span>&nbsp;<span class="op" id="7803674">*</span><span class="ident" id="7803675">serverTest</span><span class="op" id="7803685">)</span>&nbsp;<span class="ident" id="7803687">connFromCommand</span><span class="op" id="7803702">(</span><span class="op" id="7803703">)</span>&nbsp;<span class="op" id="7803705">(</span><span class="ident" id="7803706">conn</span>&nbsp;<span class="op" id="7803711">*</span><span class="ident" id="7803712">recordingConn</span><span class="op" id="7803725">,</span>&nbsp;<span class="ident" id="7803727">child</span>&nbsp;<span class="op" id="7803733">*</span><span class="ident" id="7803734">exec</span><span class="op" id="7803738">.</span><span class="ident" id="7803739">Cmd</span><span class="op" id="7803742">,</span>&nbsp;<span class="ident" id="7803744">err</span>&nbsp;<span class="builtintype" id="7803748">error</span><span class="op" id="7803753">)</span>&nbsp;<span class="op" id="7803755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7803758">l</span><span class="op" id="7803759">,</span>&nbsp;<span class="ident" id="7803761">err</span>&nbsp;<span class="op" id="7803765">:=</span>&nbsp;<span class="ident" id="7803768">net</span><span class="op" id="7803771">.</span><span class="ident" id="7803772">ListenTCP</span><span class="op" id="7803781">(</span><span class="string" id="7803782">&#34;tcp&#34;</span><span class="op" id="7803787">,</span>&nbsp;<span class="op" id="7803789">&amp;</span><span class="ident" id="7803790">net</span><span class="op" id="7803793">.</span><span class="ident" id="7803794">TCPAddr</span><span class="op" id="7803801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7803805">IP</span><span class="op" id="7803807">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7803811">net</span><span class="op" id="7803814">.</span><span class="ident" id="7803815">IPv4</span><span class="op" id="7803819">(</span><span class="num" id="7803820">127</span><span class="op" id="7803823">,</span>&nbsp;<span class="num" id="7803825">0</span><span class="op" id="7803826">,</span>&nbsp;<span class="num" id="7803828">0</span><span class="op" id="7803829">,</span>&nbsp;<span class="num" id="7803831">1</span><span class="op" id="7803832">)</span><span class="op" id="7803833">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7803837">Port</span><span class="op" id="7803841">:</span>&nbsp;<span class="num" id="7803843">0</span><span class="op" id="7803844">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7803847">}</span><span class="op" id="7803848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7803851">if</span>&nbsp;<span class="ident" id="7803854">err</span>&nbsp;<span class="op" id="7803858">!=</span>&nbsp;<span class="builtintype" id="7803861">nil</span>&nbsp;<span class="op" id="7803865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7803869">return</span>&nbsp;<span class="builtintype" id="7803876">nil</span><span class="op" id="7803879">,</span>&nbsp;<span class="builtintype" id="7803881">nil</span><span class="op" id="7803884">,</span>&nbsp;<span class="ident" id="7803886">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7803891">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7803894">defer</span>&nbsp;<span class="ident" id="7803900">l</span><span class="op" id="7803901">.</span><span class="ident" id="7803902">Close</span><span class="op" id="7803907">(</span><span class="op" id="7803908">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7803912">port</span>&nbsp;<span class="op" id="7803917">:=</span>&nbsp;<span class="ident" id="7803920">l</span><span class="op" id="7803921">.</span><span class="ident" id="7803922">Addr</span><span class="op" id="7803926">(</span><span class="op" id="7803927">)</span><span class="op" id="7803928">.</span><span class="op" id="7803929">(</span><span class="op" id="7803930">*</span><span class="ident" id="7803931">net</span><span class="op" id="7803934">.</span><span class="ident" id="7803935">TCPAddr</span><span class="op" id="7803942">)</span><span class="op" id="7803943">.</span><span class="ident" id="7803944">Port</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7803951">var</span>&nbsp;<span class="ident" id="7803955">command</span>&nbsp;<span class="op" id="7803963">[</span><span class="op" id="7803964">]</span><span class="builtintype" id="7803965">string</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7803973">command</span>&nbsp;<span class="op" id="7803981">=</span>&nbsp;<span class="builtinfunc" id="7803983">append</span><span class="op" id="7803989">(</span><span class="ident" id="7803990">command</span><span class="op" id="7803997">,</span>&nbsp;<span class="ident" id="7803999">test</span><span class="op" id="7804003">.</span><span class="ident" id="7804004">command</span><span class="op" id="7804011">...</span><span class="op" id="7804014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7804017">if</span>&nbsp;<span class="builtinfunc" id="7804020">len</span><span class="op" id="7804023">(</span><span class="ident" id="7804024">command</span><span class="op" id="7804031">)</span>&nbsp;<span class="op" id="7804033">==</span>&nbsp;<span class="num" id="7804036">0</span>&nbsp;<span class="op" id="7804038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7804042">command</span>&nbsp;<span class="op" id="7804050">=</span>&nbsp;<span class="ident" id="7804052">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7804074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7804077">command</span>&nbsp;<span class="op" id="7804085">=</span>&nbsp;<span class="builtinfunc" id="7804087">append</span><span class="op" id="7804093">(</span><span class="ident" id="7804094">command</span><span class="op" id="7804101">,</span>&nbsp;<span class="string" id="7804103">&#34;-connect&#34;</span><span class="op" id="7804113">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7804116">command</span>&nbsp;<span class="op" id="7804124">=</span>&nbsp;<span class="builtinfunc" id="7804126">append</span><span class="op" id="7804132">(</span><span class="ident" id="7804133">command</span><span class="op" id="7804140">,</span>&nbsp;<span class="ident" id="7804142">fmt</span><span class="op" id="7804145">.</span><span class="ident" id="7804146">Sprintf</span><span class="op" id="7804153">(</span><span class="string" id="7804154">&#34;127.0.0.1:%d&#34;</span><span class="op" id="7804168">,</span>&nbsp;<span class="ident" id="7804170">port</span><span class="op" id="7804174">)</span><span class="op" id="7804175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7804178">cmd</span>&nbsp;<span class="op" id="7804182">:=</span>&nbsp;<span class="ident" id="7804185">exec</span><span class="op" id="7804189">.</span><span class="ident" id="7804190">Command</span><span class="op" id="7804197">(</span><span class="ident" id="7804198">command</span><span class="op" id="7804205">[</span><span class="num" id="7804206">0</span><span class="op" id="7804207">]</span><span class="op" id="7804208">,</span>&nbsp;<span class="ident" id="7804210">command</span><span class="op" id="7804217">[</span><span class="num" id="7804218">1</span><span class="op" id="7804219">:</span><span class="op" id="7804220">]</span><span class="op" id="7804221">...</span><span class="op" id="7804224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7804227">cmd</span><span class="op" id="7804230">.</span><span class="ident" id="7804231">Stdin</span>&nbsp;<span class="op" id="7804237">=</span>&nbsp;<span class="builtintype" id="7804239">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7804244">var</span>&nbsp;<span class="ident" id="7804248">output</span>&nbsp;<span class="ident" id="7804255">bytes</span><span class="op" id="7804260">.</span><span class="ident" id="7804261">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7804269">cmd</span><span class="op" id="7804272">.</span><span class="ident" id="7804273">Stdout</span>&nbsp;<span class="op" id="7804280">=</span>&nbsp;<span class="op" id="7804282">&amp;</span><span class="ident" id="7804283">output</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7804291">cmd</span><span class="op" id="7804294">.</span><span class="ident" id="7804295">Stderr</span>&nbsp;<span class="op" id="7804302">=</span>&nbsp;<span class="op" id="7804304">&amp;</span><span class="ident" id="7804305">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7804313">if</span>&nbsp;<span class="ident" id="7804316">err</span>&nbsp;<span class="op" id="7804320">:=</span>&nbsp;<span class="ident" id="7804323">cmd</span><span class="op" id="7804326">.</span><span class="ident" id="7804327">Start</span><span class="op" id="7804332">(</span><span class="op" id="7804333">)</span><span class="op" id="7804334">;</span>&nbsp;<span class="ident" id="7804336">err</span>&nbsp;<span class="op" id="7804340">!=</span>&nbsp;<span class="builtintype" id="7804343">nil</span>&nbsp;<span class="op" id="7804347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7804351">return</span>&nbsp;<span class="builtintype" id="7804358">nil</span><span class="op" id="7804361">,</span>&nbsp;<span class="builtintype" id="7804363">nil</span><span class="op" id="7804366">,</span>&nbsp;<span class="ident" id="7804368">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7804373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7804377">connChan</span>&nbsp;<span class="op" id="7804386">:=</span>&nbsp;<span class="builtinfunc" id="7804389">make</span><span class="op" id="7804393">(</span><span class="keyword" id="7804394">chan</span>&nbsp;<span class="keyword" id="7804399">interface</span><span class="op" id="7804408">{</span><span class="op" id="7804409">}</span><span class="op" id="7804410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7804413">go</span>&nbsp;<span class="keyword" id="7804416">func</span><span class="op" id="7804420">(</span><span class="op" id="7804421">)</span>&nbsp;<span class="op" id="7804423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7804427">tcpConn</span><span class="op" id="7804434">,</span>&nbsp;<span class="ident" id="7804436">err</span>&nbsp;<span class="op" id="7804440">:=</span>&nbsp;<span class="ident" id="7804443">l</span><span class="op" id="7804444">.</span><span class="ident" id="7804445">Accept</span><span class="op" id="7804451">(</span><span class="op" id="7804452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7804456">if</span>&nbsp;<span class="ident" id="7804459">err</span>&nbsp;<span class="op" id="7804463">!=</span>&nbsp;<span class="builtintype" id="7804466">nil</span>&nbsp;<span class="op" id="7804470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7804475">connChan</span>&nbsp;<span class="op" id="7804484">&lt;-</span>&nbsp;<span class="ident" id="7804487">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7804493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7804497">connChan</span>&nbsp;<span class="op" id="7804506">&lt;-</span>&nbsp;<span class="ident" id="7804509">tcpConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7804518">}</span><span class="op" id="7804519">(</span><span class="op" id="7804520">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7804524">var</span>&nbsp;<span class="ident" id="7804528">tcpConn</span>&nbsp;<span class="ident" id="7804536">net</span><span class="op" id="7804539">.</span><span class="ident" id="7804540">Conn</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7804546">select</span>&nbsp;<span class="op" id="7804553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7804556">case</span>&nbsp;<span class="ident" id="7804561">connOrError</span>&nbsp;<span class="op" id="7804573">:=</span>&nbsp;<span class="op" id="7804576">&lt;-</span><span class="ident" id="7804578">connChan</span><span class="op" id="7804586">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7804590">if</span>&nbsp;<span class="ident" id="7804593">err</span><span class="op" id="7804596">,</span>&nbsp;<span class="ident" id="7804598">ok</span>&nbsp;<span class="op" id="7804601">:=</span>&nbsp;<span class="ident" id="7804604">connOrError</span><span class="op" id="7804615">.</span><span class="op" id="7804616">(</span><span class="builtintype" id="7804617">error</span><span class="op" id="7804622">)</span><span class="op" id="7804623">;</span>&nbsp;<span class="ident" id="7804625">ok</span>&nbsp;<span class="op" id="7804628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7804633">return</span>&nbsp;<span class="builtintype" id="7804640">nil</span><span class="op" id="7804643">,</span>&nbsp;<span class="builtintype" id="7804645">nil</span><span class="op" id="7804648">,</span>&nbsp;<span class="ident" id="7804650">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7804656">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7804660">tcpConn</span>&nbsp;<span class="op" id="7804668">=</span>&nbsp;<span class="ident" id="7804670">connOrError</span><span class="op" id="7804681">.</span><span class="op" id="7804682">(</span><span class="ident" id="7804683">net</span><span class="op" id="7804686">.</span><span class="ident" id="7804687">Conn</span><span class="op" id="7804691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7804694">case</span>&nbsp;<span class="op" id="7804699">&lt;-</span><span class="ident" id="7804701">time</span><span class="op" id="7804705">.</span><span class="ident" id="7804706">After</span><span class="op" id="7804711">(</span><span class="num" id="7804712">2</span>&nbsp;<span class="op" id="7804714">*</span>&nbsp;<span class="ident" id="7804716">time</span><span class="op" id="7804720">.</span><span class="ident" id="7804721">Second</span><span class="op" id="7804727">)</span><span class="op" id="7804728">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7804732">output</span><span class="op" id="7804738">.</span><span class="ident" id="7804739">WriteTo</span><span class="op" id="7804746">(</span><span class="ident" id="7804747">os</span><span class="op" id="7804749">.</span><span class="ident" id="7804750">Stdout</span><span class="op" id="7804756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7804760">return</span>&nbsp;<span class="builtintype" id="7804767">nil</span><span class="op" id="7804770">,</span>&nbsp;<span class="builtintype" id="7804772">nil</span><span class="op" id="7804775">,</span>&nbsp;<span class="ident" id="7804777">errors</span><span class="op" id="7804783">.</span><span class="ident" id="7804784">New</span><span class="op" id="7804787">(</span><span class="string" id="7804788">&#34;timed&nbsp;out&nbsp;waiting&nbsp;for&nbsp;connection&nbsp;from&nbsp;child&nbsp;process&#34;</span><span class="op" id="7804841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7804844">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7804848">record</span>&nbsp;<span class="op" id="7804855">:=</span>&nbsp;<span class="op" id="7804858">&amp;</span><span class="ident" id="7804859">recordingConn</span><span class="op" id="7804872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7804876">Conn</span><span class="op" id="7804880">:</span>&nbsp;<span class="ident" id="7804882">tcpConn</span><span class="op" id="7804889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7804892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7804896">return</span>&nbsp;<span class="ident" id="7804903">record</span><span class="op" id="7804909">,</span>&nbsp;<span class="ident" id="7804911">cmd</span><span class="op" id="7804914">,</span>&nbsp;<span class="builtintype" id="7804916">nil</span><br>
<span class="lineno"></span><span class="op" id="7804920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7804923">func</span>&nbsp;<span class="op" id="7804928">(</span><span class="ident" id="7804929">test</span>&nbsp;<span class="op" id="7804934">*</span><span class="ident" id="7804935">serverTest</span><span class="op" id="7804945">)</span>&nbsp;<span class="ident" id="7804947">dataPath</span><span class="op" id="7804955">(</span><span class="op" id="7804956">)</span>&nbsp;<span class="builtintype" id="7804958">string</span>&nbsp;<span class="op" id="7804965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7804968">return</span>&nbsp;<span class="ident" id="7804975">filepath</span><span class="op" id="7804983">.</span><span class="ident" id="7804984">Join</span><span class="op" id="7804988">(</span><span class="string" id="7804989">&#34;testdata&#34;</span><span class="op" id="7804999">,</span>&nbsp;<span class="string" id="7805001">&#34;Server-&#34;</span><span class="op" id="7805010">+</span><span class="ident" id="7805011">test</span><span class="op" id="7805015">.</span><span class="ident" id="7805016">name</span><span class="op" id="7805020">)</span><br>
<span class="lineno">335</span><span class="op" id="7805022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7805025">func</span>&nbsp;<span class="op" id="7805030">(</span><span class="ident" id="7805031">test</span>&nbsp;<span class="op" id="7805036">*</span><span class="ident" id="7805037">serverTest</span><span class="op" id="7805047">)</span>&nbsp;<span class="ident" id="7805049">loadData</span><span class="op" id="7805057">(</span><span class="op" id="7805058">)</span>&nbsp;<span class="op" id="7805060">(</span><span class="ident" id="7805061">flows</span>&nbsp;<span class="op" id="7805067">[</span><span class="op" id="7805068">]</span><span class="op" id="7805069">[</span><span class="op" id="7805070">]</span><span class="builtintype" id="7805071">byte</span><span class="op" id="7805075">,</span>&nbsp;<span class="ident" id="7805077">err</span>&nbsp;<span class="builtintype" id="7805081">error</span><span class="op" id="7805086">)</span>&nbsp;<span class="op" id="7805088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7805091">in</span><span class="op" id="7805093">,</span>&nbsp;<span class="ident" id="7805095">err</span>&nbsp;<span class="op" id="7805099">:=</span>&nbsp;<span class="ident" id="7805102">os</span><span class="op" id="7805104">.</span><span class="ident" id="7805105">Open</span><span class="op" id="7805109">(</span><span class="ident" id="7805110">test</span><span class="op" id="7805114">.</span><span class="ident" id="7805115">dataPath</span><span class="op" id="7805123">(</span><span class="op" id="7805124">)</span><span class="op" id="7805125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7805128">if</span>&nbsp;<span class="ident" id="7805131">err</span>&nbsp;<span class="op" id="7805135">!=</span>&nbsp;<span class="builtintype" id="7805138">nil</span>&nbsp;<span class="op" id="7805142">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7805146">return</span>&nbsp;<span class="builtintype" id="7805153">nil</span><span class="op" id="7805156">,</span>&nbsp;<span class="ident" id="7805158">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7805163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7805166">defer</span>&nbsp;<span class="ident" id="7805172">in</span><span class="op" id="7805174">.</span><span class="ident" id="7805175">Close</span><span class="op" id="7805180">(</span><span class="op" id="7805181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7805184">return</span>&nbsp;<span class="ident" id="7805191">parseTestData</span><span class="op" id="7805204">(</span><span class="ident" id="7805205">in</span><span class="op" id="7805207">)</span><br>
<span class="lineno"></span><span class="op" id="7805209">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="7805212">func</span>&nbsp;<span class="op" id="7805217">(</span><span class="ident" id="7805218">test</span>&nbsp;<span class="op" id="7805223">*</span><span class="ident" id="7805224">serverTest</span><span class="op" id="7805234">)</span>&nbsp;<span class="ident" id="7805236">run</span><span class="op" id="7805239">(</span><span class="ident" id="7805240">t</span>&nbsp;<span class="op" id="7805242">*</span><span class="ident" id="7805243">testing</span><span class="op" id="7805250">.</span><span class="ident" id="7805251">T</span><span class="op" id="7805252">,</span>&nbsp;<span class="ident" id="7805254">write</span>&nbsp;<span class="builtintype" id="7805260">bool</span><span class="op" id="7805264">)</span>&nbsp;<span class="op" id="7805266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7805269">var</span>&nbsp;<span class="ident" id="7805273">clientConn</span><span class="op" id="7805283">,</span>&nbsp;<span class="ident" id="7805285">serverConn</span>&nbsp;<span class="ident" id="7805296">net</span><span class="op" id="7805299">.</span><span class="ident" id="7805300">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7805306">var</span>&nbsp;<span class="ident" id="7805310">recordingConn</span>&nbsp;<span class="op" id="7805324">*</span><span class="ident" id="7805325">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7805340">var</span>&nbsp;<span class="ident" id="7805344">childProcess</span>&nbsp;<span class="op" id="7805357">*</span><span class="ident" id="7805358">exec</span><span class="op" id="7805362">.</span><span class="ident" id="7805363">Cmd</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7805369">if</span>&nbsp;<span class="ident" id="7805372">write</span>&nbsp;<span class="op" id="7805378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7805382">var</span>&nbsp;<span class="ident" id="7805386">err</span>&nbsp;<span class="builtintype" id="7805390">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7805398">recordingConn</span><span class="op" id="7805411">,</span>&nbsp;<span class="ident" id="7805413">childProcess</span><span class="op" id="7805425">,</span>&nbsp;<span class="ident" id="7805427">err</span>&nbsp;<span class="op" id="7805431">=</span>&nbsp;<span class="ident" id="7805433">test</span><span class="op" id="7805437">.</span><span class="ident" id="7805438">connFromCommand</span><span class="op" id="7805453">(</span><span class="op" id="7805454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7805458">if</span>&nbsp;<span class="ident" id="7805461">err</span>&nbsp;<span class="op" id="7805465">!=</span>&nbsp;<span class="builtintype" id="7805468">nil</span>&nbsp;<span class="op" id="7805472">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7805477">t</span><span class="op" id="7805478">.</span><span class="ident" id="7805479">Fatalf</span><span class="op" id="7805485">(</span><span class="string" id="7805486">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="7805518">,</span>&nbsp;<span class="ident" id="7805520">err</span><span class="op" id="7805523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7805527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7805531">serverConn</span>&nbsp;<span class="op" id="7805542">=</span>&nbsp;<span class="ident" id="7805544">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7805559">}</span>&nbsp;<span class="keyword" id="7805561">else</span>&nbsp;<span class="op" id="7805566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7805570">clientConn</span><span class="op" id="7805580">,</span>&nbsp;<span class="ident" id="7805582">serverConn</span>&nbsp;<span class="op" id="7805593">=</span>&nbsp;<span class="ident" id="7805595">net</span><span class="op" id="7805598">.</span><span class="ident" id="7805599">Pipe</span><span class="op" id="7805603">(</span><span class="op" id="7805604">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7805607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7805610">config</span>&nbsp;<span class="op" id="7805617">:=</span>&nbsp;<span class="ident" id="7805620">test</span><span class="op" id="7805624">.</span><span class="ident" id="7805625">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7805633">if</span>&nbsp;<span class="ident" id="7805636">config</span>&nbsp;<span class="op" id="7805643">==</span>&nbsp;<span class="builtintype" id="7805646">nil</span>&nbsp;<span class="op" id="7805650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7805654">config</span>&nbsp;<span class="op" id="7805661">=</span>&nbsp;<span class="ident" id="7805663">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7805675">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7805678">server</span>&nbsp;<span class="op" id="7805685">:=</span>&nbsp;<span class="ident" id="7805688">Server</span><span class="op" id="7805694">(</span><span class="ident" id="7805695">serverConn</span><span class="op" id="7805705">,</span>&nbsp;<span class="ident" id="7805707">config</span><span class="op" id="7805713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7805716">connStateChan</span>&nbsp;<span class="op" id="7805730">:=</span>&nbsp;<span class="builtinfunc" id="7805733">make</span><span class="op" id="7805737">(</span><span class="keyword" id="7805738">chan</span>&nbsp;<span class="ident" id="7805743">ConnectionState</span><span class="op" id="7805758">,</span>&nbsp;<span class="num" id="7805760">1</span><span class="op" id="7805761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7805764">go</span>&nbsp;<span class="keyword" id="7805767">func</span><span class="op" id="7805771">(</span><span class="op" id="7805772">)</span>&nbsp;<span class="op" id="7805774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7805778">var</span>&nbsp;<span class="ident" id="7805782">err</span>&nbsp;<span class="builtintype" id="7805786">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7805794">if</span>&nbsp;<span class="ident" id="7805797">_</span><span class="op" id="7805798">,</span>&nbsp;<span class="ident" id="7805800">err</span>&nbsp;<span class="op" id="7805804">=</span>&nbsp;<span class="ident" id="7805806">server</span><span class="op" id="7805812">.</span><span class="ident" id="7805813">Write</span><span class="op" id="7805818">(</span><span class="op" id="7805819">[</span><span class="op" id="7805820">]</span><span class="builtintype" id="7805821">byte</span><span class="op" id="7805825">(</span><span class="string" id="7805826">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="7805842">)</span><span class="op" id="7805843">)</span><span class="op" id="7805844">;</span>&nbsp;<span class="ident" id="7805846">err</span>&nbsp;<span class="op" id="7805850">!=</span>&nbsp;<span class="builtintype" id="7805853">nil</span>&nbsp;<span class="op" id="7805857">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7805862">t</span><span class="op" id="7805863">.</span><span class="ident" id="7805864">Logf</span><span class="op" id="7805868">(</span><span class="string" id="7805869">&#34;Error&nbsp;from&nbsp;Server.Write:&nbsp;%s&#34;</span><span class="op" id="7805898">,</span>&nbsp;<span class="ident" id="7805900">err</span><span class="op" id="7805903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7805907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7805911">if</span>&nbsp;<span class="builtinfunc" id="7805914">len</span><span class="op" id="7805917">(</span><span class="ident" id="7805918">test</span><span class="op" id="7805922">.</span><span class="ident" id="7805923">expectHandshakeErrorIncluding</span><span class="op" id="7805952">)</span>&nbsp;<span class="op" id="7805954">&gt;</span>&nbsp;<span class="num" id="7805956">0</span>&nbsp;<span class="op" id="7805958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7805963">if</span>&nbsp;<span class="ident" id="7805966">err</span>&nbsp;<span class="op" id="7805970">==</span>&nbsp;<span class="builtintype" id="7805973">nil</span>&nbsp;<span class="op" id="7805977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7805983">t</span><span class="op" id="7805984">.</span><span class="ident" id="7805985">Errorf</span><span class="op" id="7805991">(</span><span class="string" id="7805992">&#34;Error&nbsp;expected,&nbsp;but&nbsp;no&nbsp;error&nbsp;returned&#34;</span><span class="op" id="7806031">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7806036">}</span>&nbsp;<span class="keyword" id="7806038">else</span>&nbsp;<span class="keyword" id="7806043">if</span>&nbsp;<span class="ident" id="7806046">s</span>&nbsp;<span class="op" id="7806048">:=</span>&nbsp;<span class="ident" id="7806051">err</span><span class="op" id="7806054">.</span><span class="ident" id="7806055">Error</span><span class="op" id="7806060">(</span><span class="op" id="7806061">)</span><span class="op" id="7806062">;</span>&nbsp;<span class="op" id="7806064">!</span><span class="ident" id="7806065">strings</span><span class="op" id="7806072">.</span><span class="ident" id="7806073">Contains</span><span class="op" id="7806081">(</span><span class="ident" id="7806082">s</span><span class="op" id="7806083">,</span>&nbsp;<span class="ident" id="7806085">test</span><span class="op" id="7806089">.</span><span class="ident" id="7806090">expectHandshakeErrorIncluding</span><span class="op" id="7806119">)</span>&nbsp;<span class="op" id="7806121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7806127">t</span><span class="op" id="7806128">.</span><span class="ident" id="7806129">Errorf</span><span class="op" id="7806135">(</span><span class="string" id="7806136">&#34;Error&nbsp;expected&nbsp;containing&nbsp;&#39;%s&#39;&nbsp;but&nbsp;got&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="7806181">,</span>&nbsp;<span class="ident" id="7806183">test</span><span class="op" id="7806187">.</span><span class="ident" id="7806188">expectHandshakeErrorIncluding</span><span class="op" id="7806217">,</span>&nbsp;<span class="ident" id="7806219">s</span><span class="op" id="7806220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7806225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7806229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7806233">server</span><span class="op" id="7806239">.</span><span class="ident" id="7806240">Close</span><span class="op" id="7806245">(</span><span class="op" id="7806246">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7806250">serverConn</span><span class="op" id="7806260">.</span><span class="ident" id="7806261">Close</span><span class="op" id="7806266">(</span><span class="op" id="7806267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7806271">connStateChan</span>&nbsp;<span class="op" id="7806285">&lt;-</span>&nbsp;<span class="ident" id="7806288">server</span><span class="op" id="7806294">.</span><span class="ident" id="7806295">ConnectionState</span><span class="op" id="7806310">(</span><span class="op" id="7806311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7806314">}</span><span class="op" id="7806315">(</span><span class="op" id="7806316">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7806320">if</span>&nbsp;<span class="op" id="7806323">!</span><span class="ident" id="7806324">write</span>&nbsp;<span class="op" id="7806330">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7806334">flows</span><span class="op" id="7806339">,</span>&nbsp;<span class="ident" id="7806341">err</span>&nbsp;<span class="op" id="7806345">:=</span>&nbsp;<span class="ident" id="7806348">test</span><span class="op" id="7806352">.</span><span class="ident" id="7806353">loadData</span><span class="op" id="7806361">(</span><span class="op" id="7806362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7806366">if</span>&nbsp;<span class="ident" id="7806369">err</span>&nbsp;<span class="op" id="7806373">!=</span>&nbsp;<span class="builtintype" id="7806376">nil</span>&nbsp;<span class="op" id="7806380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7806385">if</span>&nbsp;<span class="op" id="7806388">!</span><span class="ident" id="7806389">test</span><span class="op" id="7806393">.</span><span class="ident" id="7806394">expectAlert</span>&nbsp;<span class="op" id="7806406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7806412">t</span><span class="op" id="7806413">.</span><span class="ident" id="7806414">Fatalf</span><span class="op" id="7806420">(</span><span class="string" id="7806421">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s&#34;</span><span class="op" id="7806454">,</span>&nbsp;<span class="ident" id="7806456">test</span><span class="op" id="7806460">.</span><span class="ident" id="7806461">name</span><span class="op" id="7806465">,</span>&nbsp;<span class="ident" id="7806467">test</span><span class="op" id="7806471">.</span><span class="ident" id="7806472">dataPath</span><span class="op" id="7806480">(</span><span class="op" id="7806481">)</span><span class="op" id="7806482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7806487">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7806491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7806495">for</span>&nbsp;<span class="ident" id="7806499">i</span><span class="op" id="7806500">,</span>&nbsp;<span class="ident" id="7806502">b</span>&nbsp;<span class="op" id="7806504">:=</span>&nbsp;<span class="keyword" id="7806507">range</span>&nbsp;<span class="ident" id="7806513">flows</span>&nbsp;<span class="op" id="7806519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7806524">if</span>&nbsp;<span class="ident" id="7806527">i</span><span class="op" id="7806528">%</span><span class="num" id="7806529">2</span>&nbsp;<span class="op" id="7806531">==</span>&nbsp;<span class="num" id="7806534">0</span>&nbsp;<span class="op" id="7806536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7806542">clientConn</span><span class="op" id="7806552">.</span><span class="ident" id="7806553">Write</span><span class="op" id="7806558">(</span><span class="ident" id="7806559">b</span><span class="op" id="7806560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7806566">continue</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7806578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7806583">bb</span>&nbsp;<span class="op" id="7806586">:=</span>&nbsp;<span class="builtinfunc" id="7806589">make</span><span class="op" id="7806593">(</span><span class="op" id="7806594">[</span><span class="op" id="7806595">]</span><span class="builtintype" id="7806596">byte</span><span class="op" id="7806600">,</span>&nbsp;<span class="builtinfunc" id="7806602">len</span><span class="op" id="7806605">(</span><span class="ident" id="7806606">b</span><span class="op" id="7806607">)</span><span class="op" id="7806608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7806613">n</span><span class="op" id="7806614">,</span>&nbsp;<span class="ident" id="7806616">err</span>&nbsp;<span class="op" id="7806620">:=</span>&nbsp;<span class="ident" id="7806623">io</span><span class="op" id="7806625">.</span><span class="ident" id="7806626">ReadFull</span><span class="op" id="7806634">(</span><span class="ident" id="7806635">clientConn</span><span class="op" id="7806645">,</span>&nbsp;<span class="ident" id="7806647">bb</span><span class="op" id="7806649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7806654">if</span>&nbsp;<span class="ident" id="7806657">test</span><span class="op" id="7806661">.</span><span class="ident" id="7806662">expectAlert</span>&nbsp;<span class="op" id="7806674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7806680">if</span>&nbsp;<span class="ident" id="7806683">err</span>&nbsp;<span class="op" id="7806687">==</span>&nbsp;<span class="builtintype" id="7806690">nil</span>&nbsp;<span class="op" id="7806694">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7806701">t</span><span class="op" id="7806702">.</span><span class="ident" id="7806703">Fatal</span><span class="op" id="7806708">(</span><span class="string" id="7806709">&#34;Expected&nbsp;read&nbsp;failure&nbsp;but&nbsp;read&nbsp;succeeded&#34;</span><span class="op" id="7806751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7806757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7806762">}</span>&nbsp;<span class="keyword" id="7806764">else</span>&nbsp;<span class="op" id="7806769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7806775">if</span>&nbsp;<span class="ident" id="7806778">err</span>&nbsp;<span class="op" id="7806782">!=</span>&nbsp;<span class="builtintype" id="7806785">nil</span>&nbsp;<span class="op" id="7806789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7806796">t</span><span class="op" id="7806797">.</span><span class="ident" id="7806798">Fatalf</span><span class="op" id="7806804">(</span><span class="string" id="7806805">&#34;%s&nbsp;#%d:&nbsp;%s\nRead&nbsp;%d,&nbsp;wanted&nbsp;%d,&nbsp;got&nbsp;%x,&nbsp;wanted&nbsp;%x\n&#34;</span><span class="op" id="7806858">,</span>&nbsp;<span class="ident" id="7806860">test</span><span class="op" id="7806864">.</span><span class="ident" id="7806865">name</span><span class="op" id="7806869">,</span>&nbsp;<span class="ident" id="7806871">i</span><span class="op" id="7806872">+</span><span class="num" id="7806873">1</span><span class="op" id="7806874">,</span>&nbsp;<span class="ident" id="7806876">err</span><span class="op" id="7806879">,</span>&nbsp;<span class="ident" id="7806881">n</span><span class="op" id="7806882">,</span>&nbsp;<span class="builtinfunc" id="7806884">len</span><span class="op" id="7806887">(</span><span class="ident" id="7806888">bb</span><span class="op" id="7806890">)</span><span class="op" id="7806891">,</span>&nbsp;<span class="ident" id="7806893">bb</span><span class="op" id="7806895">[</span><span class="op" id="7806896">:</span><span class="ident" id="7806897">n</span><span class="op" id="7806898">]</span><span class="op" id="7806899">,</span>&nbsp;<span class="ident" id="7806901">b</span><span class="op" id="7806902">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7806908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7806914">if</span>&nbsp;<span class="op" id="7806917">!</span><span class="ident" id="7806918">bytes</span><span class="op" id="7806923">.</span><span class="ident" id="7806924">Equal</span><span class="op" id="7806929">(</span><span class="ident" id="7806930">b</span><span class="op" id="7806931">,</span>&nbsp;<span class="ident" id="7806933">bb</span><span class="op" id="7806935">)</span>&nbsp;<span class="op" id="7806937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7806944">t</span><span class="op" id="7806945">.</span><span class="ident" id="7806946">Fatalf</span><span class="op" id="7806952">(</span><span class="string" id="7806953">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="7806995">,</span>&nbsp;<span class="ident" id="7806997">test</span><span class="op" id="7807001">.</span><span class="ident" id="7807002">name</span><span class="op" id="7807006">,</span>&nbsp;<span class="ident" id="7807008">i</span><span class="op" id="7807009">+</span><span class="num" id="7807010">1</span><span class="op" id="7807011">,</span>&nbsp;<span class="ident" id="7807013">bb</span><span class="op" id="7807015">,</span>&nbsp;<span class="ident" id="7807017">b</span><span class="op" id="7807018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7807024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7807029">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7807033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7807037">clientConn</span><span class="op" id="7807047">.</span><span class="ident" id="7807048">Close</span><span class="op" id="7807053">(</span><span class="op" id="7807054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7807057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7807061">connState</span>&nbsp;<span class="op" id="7807071">:=</span>&nbsp;<span class="op" id="7807074">&lt;-</span><span class="ident" id="7807076">connStateChan</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7807091">peerCerts</span>&nbsp;<span class="op" id="7807101">:=</span>&nbsp;<span class="ident" id="7807104">connState</span><span class="op" id="7807113">.</span><span class="ident" id="7807114">PeerCertificates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7807132">if</span>&nbsp;<span class="builtinfunc" id="7807135">len</span><span class="op" id="7807138">(</span><span class="ident" id="7807139">peerCerts</span><span class="op" id="7807148">)</span>&nbsp;<span class="op" id="7807150">==</span>&nbsp;<span class="builtinfunc" id="7807153">len</span><span class="op" id="7807156">(</span><span class="ident" id="7807157">test</span><span class="op" id="7807161">.</span><span class="ident" id="7807162">expectedPeerCerts</span><span class="op" id="7807179">)</span>&nbsp;<span class="op" id="7807181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7807185">for</span>&nbsp;<span class="ident" id="7807189">i</span><span class="op" id="7807190">,</span>&nbsp;<span class="ident" id="7807192">peerCert</span>&nbsp;<span class="op" id="7807201">:=</span>&nbsp;<span class="keyword" id="7807204">range</span>&nbsp;<span class="ident" id="7807210">peerCerts</span>&nbsp;<span class="op" id="7807220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7807225">block</span><span class="op" id="7807230">,</span>&nbsp;<span class="ident" id="7807232">_</span>&nbsp;<span class="op" id="7807234">:=</span>&nbsp;<span class="ident" id="7807237">pem</span><span class="op" id="7807240">.</span><span class="ident" id="7807241">Decode</span><span class="op" id="7807247">(</span><span class="op" id="7807248">[</span><span class="op" id="7807249">]</span><span class="builtintype" id="7807250">byte</span><span class="op" id="7807254">(</span><span class="ident" id="7807255">test</span><span class="op" id="7807259">.</span><span class="ident" id="7807260">expectedPeerCerts</span><span class="op" id="7807277">[</span><span class="ident" id="7807278">i</span><span class="op" id="7807279">]</span><span class="op" id="7807280">)</span><span class="op" id="7807281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7807286">if</span>&nbsp;<span class="op" id="7807289">!</span><span class="ident" id="7807290">bytes</span><span class="op" id="7807295">.</span><span class="ident" id="7807296">Equal</span><span class="op" id="7807301">(</span><span class="ident" id="7807302">block</span><span class="op" id="7807307">.</span><span class="ident" id="7807308">Bytes</span><span class="op" id="7807313">,</span>&nbsp;<span class="ident" id="7807315">peerCert</span><span class="op" id="7807323">.</span><span class="ident" id="7807324">Raw</span><span class="op" id="7807327">)</span>&nbsp;<span class="op" id="7807329">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7807335">t</span><span class="op" id="7807336">.</span><span class="ident" id="7807337">Fatalf</span><span class="op" id="7807343">(</span><span class="string" id="7807344">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;cert&nbsp;%d&#34;</span><span class="op" id="7807374">,</span>&nbsp;<span class="ident" id="7807376">test</span><span class="op" id="7807380">.</span><span class="ident" id="7807381">name</span><span class="op" id="7807385">,</span>&nbsp;<span class="ident" id="7807387">i</span><span class="op" id="7807388">+</span><span class="num" id="7807389">1</span><span class="op" id="7807390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7807395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7807399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7807402">}</span>&nbsp;<span class="keyword" id="7807404">else</span>&nbsp;<span class="op" id="7807409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7807413">t</span><span class="op" id="7807414">.</span><span class="ident" id="7807415">Fatalf</span><span class="op" id="7807421">(</span><span class="string" id="7807422">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;list&nbsp;length:&nbsp;%d&nbsp;(wanted)&nbsp;!=&nbsp;%d&nbsp;(got)&#34;</span><span class="op" id="7807481">,</span>&nbsp;<span class="ident" id="7807483">test</span><span class="op" id="7807487">.</span><span class="ident" id="7807488">name</span><span class="op" id="7807492">,</span>&nbsp;<span class="builtinfunc" id="7807494">len</span><span class="op" id="7807497">(</span><span class="ident" id="7807498">test</span><span class="op" id="7807502">.</span><span class="ident" id="7807503">expectedPeerCerts</span><span class="op" id="7807520">)</span><span class="op" id="7807521">,</span>&nbsp;<span class="builtinfunc" id="7807523">len</span><span class="op" id="7807526">(</span><span class="ident" id="7807527">peerCerts</span><span class="op" id="7807536">)</span><span class="op" id="7807537">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7807540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7807544">if</span>&nbsp;<span class="ident" id="7807547">test</span><span class="op" id="7807551">.</span><span class="ident" id="7807552">validate</span>&nbsp;<span class="op" id="7807561">!=</span>&nbsp;<span class="builtintype" id="7807564">nil</span>&nbsp;<span class="op" id="7807568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7807572">if</span>&nbsp;<span class="ident" id="7807575">err</span>&nbsp;<span class="op" id="7807579">:=</span>&nbsp;<span class="ident" id="7807582">test</span><span class="op" id="7807586">.</span><span class="ident" id="7807587">validate</span><span class="op" id="7807595">(</span><span class="ident" id="7807596">connState</span><span class="op" id="7807605">)</span><span class="op" id="7807606">;</span>&nbsp;<span class="ident" id="7807608">err</span>&nbsp;<span class="op" id="7807612">!=</span>&nbsp;<span class="builtintype" id="7807615">nil</span>&nbsp;<span class="op" id="7807619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7807624">t</span><span class="op" id="7807625">.</span><span class="ident" id="7807626">Fatalf</span><span class="op" id="7807632">(</span><span class="string" id="7807633">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7807671">,</span>&nbsp;<span class="ident" id="7807673">err</span><span class="op" id="7807676">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7807680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7807683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7807687">if</span>&nbsp;<span class="ident" id="7807690">write</span>&nbsp;<span class="op" id="7807696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7807700">path</span>&nbsp;<span class="op" id="7807705">:=</span>&nbsp;<span class="ident" id="7807708">test</span><span class="op" id="7807712">.</span><span class="ident" id="7807713">dataPath</span><span class="op" id="7807721">(</span><span class="op" id="7807722">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7807726">out</span><span class="op" id="7807729">,</span>&nbsp;<span class="ident" id="7807731">err</span>&nbsp;<span class="op" id="7807735">:=</span>&nbsp;<span class="ident" id="7807738">os</span><span class="op" id="7807740">.</span><span class="ident" id="7807741">OpenFile</span><span class="op" id="7807749">(</span><span class="ident" id="7807750">path</span><span class="op" id="7807754">,</span>&nbsp;<span class="ident" id="7807756">os</span><span class="op" id="7807758">.</span><span class="ident" id="7807759">O_WRONLY</span><span class="op" id="7807767">|</span><span class="ident" id="7807768">os</span><span class="op" id="7807770">.</span><span class="ident" id="7807771">O_CREATE</span><span class="op" id="7807779">|</span><span class="ident" id="7807780">os</span><span class="op" id="7807782">.</span><span class="ident" id="7807783">O_TRUNC</span><span class="op" id="7807790">,</span>&nbsp;<span class="num" id="7807792">0644</span><span class="op" id="7807796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7807800">if</span>&nbsp;<span class="ident" id="7807803">err</span>&nbsp;<span class="op" id="7807807">!=</span>&nbsp;<span class="builtintype" id="7807810">nil</span>&nbsp;<span class="op" id="7807814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7807819">t</span><span class="op" id="7807820">.</span><span class="ident" id="7807821">Fatalf</span><span class="op" id="7807827">(</span><span class="string" id="7807828">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="7807862">,</span>&nbsp;<span class="ident" id="7807864">err</span><span class="op" id="7807867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7807871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7807875">defer</span>&nbsp;<span class="ident" id="7807881">out</span><span class="op" id="7807884">.</span><span class="ident" id="7807885">Close</span><span class="op" id="7807890">(</span><span class="op" id="7807891">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7807895">recordingConn</span><span class="op" id="7807908">.</span><span class="ident" id="7807909">Close</span><span class="op" id="7807914">(</span><span class="op" id="7807915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7807919">if</span>&nbsp;<span class="builtinfunc" id="7807922">len</span><span class="op" id="7807925">(</span><span class="ident" id="7807926">recordingConn</span><span class="op" id="7807939">.</span><span class="ident" id="7807940">flows</span><span class="op" id="7807945">)</span>&nbsp;<span class="op" id="7807947">&lt;</span>&nbsp;<span class="num" id="7807949">3</span>&nbsp;<span class="op" id="7807951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7807956">childProcess</span><span class="op" id="7807968">.</span><span class="ident" id="7807969">Stdout</span><span class="op" id="7807975">.</span><span class="op" id="7807976">(</span><span class="op" id="7807977">*</span><span class="ident" id="7807978">bytes</span><span class="op" id="7807983">.</span><span class="ident" id="7807984">Buffer</span><span class="op" id="7807990">)</span><span class="op" id="7807991">.</span><span class="ident" id="7807992">WriteTo</span><span class="op" id="7807999">(</span><span class="ident" id="7808000">os</span><span class="op" id="7808002">.</span><span class="ident" id="7808003">Stdout</span><span class="op" id="7808009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7808014">if</span>&nbsp;<span class="builtinfunc" id="7808017">len</span><span class="op" id="7808020">(</span><span class="ident" id="7808021">test</span><span class="op" id="7808025">.</span><span class="ident" id="7808026">expectHandshakeErrorIncluding</span><span class="op" id="7808055">)</span>&nbsp;<span class="op" id="7808057">==</span>&nbsp;<span class="num" id="7808060">0</span>&nbsp;<span class="op" id="7808062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7808068">t</span><span class="op" id="7808069">.</span><span class="ident" id="7808070">Fatalf</span><span class="op" id="7808076">(</span><span class="string" id="7808077">&#34;Handshake&nbsp;failed&#34;</span><span class="op" id="7808095">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7808100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7808104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7808108">recordingConn</span><span class="op" id="7808121">.</span><span class="ident" id="7808122">WriteTo</span><span class="op" id="7808129">(</span><span class="ident" id="7808130">out</span><span class="op" id="7808133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7808137">fmt</span><span class="op" id="7808140">.</span><span class="ident" id="7808141">Printf</span><span class="op" id="7808147">(</span><span class="string" id="7808148">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="7808160">,</span>&nbsp;<span class="ident" id="7808162">path</span><span class="op" id="7808166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7808170">childProcess</span><span class="op" id="7808182">.</span><span class="ident" id="7808183">Wait</span><span class="op" id="7808187">(</span><span class="op" id="7808188">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7808191">}</span><br>
<span class="lineno"></span><span class="op" id="7808193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7808196">func</span>&nbsp;<span class="ident" id="7808201">runServerTestForVersion</span><span class="op" id="7808224">(</span><span class="ident" id="7808225">t</span>&nbsp;<span class="op" id="7808227">*</span><span class="ident" id="7808228">testing</span><span class="op" id="7808235">.</span><span class="ident" id="7808236">T</span><span class="op" id="7808237">,</span>&nbsp;<span class="ident" id="7808239">template</span>&nbsp;<span class="op" id="7808248">*</span><span class="ident" id="7808249">serverTest</span><span class="op" id="7808259">,</span>&nbsp;<span class="ident" id="7808261">prefix</span><span class="op" id="7808267">,</span>&nbsp;<span class="ident" id="7808269">option</span>&nbsp;<span class="builtintype" id="7808276">string</span><span class="op" id="7808282">)</span>&nbsp;<span class="op" id="7808284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7808287">test</span>&nbsp;<span class="op" id="7808292">:=</span>&nbsp;<span class="op" id="7808295">*</span><span class="ident" id="7808296">template</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7808306">test</span><span class="op" id="7808310">.</span><span class="ident" id="7808311">name</span>&nbsp;<span class="op" id="7808316">=</span>&nbsp;<span class="ident" id="7808318">prefix</span>&nbsp;<span class="op" id="7808325">+</span>&nbsp;<span class="ident" id="7808327">test</span><span class="op" id="7808331">.</span><span class="ident" id="7808332">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7808338">if</span>&nbsp;<span class="builtinfunc" id="7808341">len</span><span class="op" id="7808344">(</span><span class="ident" id="7808345">test</span><span class="op" id="7808349">.</span><span class="ident" id="7808350">command</span><span class="op" id="7808357">)</span>&nbsp;<span class="op" id="7808359">==</span>&nbsp;<span class="num" id="7808362">0</span>&nbsp;<span class="op" id="7808364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7808368">test</span><span class="op" id="7808372">.</span><span class="ident" id="7808373">command</span>&nbsp;<span class="op" id="7808381">=</span>&nbsp;<span class="ident" id="7808383">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7808405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7808408">test</span><span class="op" id="7808412">.</span><span class="ident" id="7808413">command</span>&nbsp;<span class="op" id="7808421">=</span>&nbsp;<span class="builtinfunc" id="7808423">append</span><span class="op" id="7808429">(</span><span class="op" id="7808430">[</span><span class="op" id="7808431">]</span><span class="builtintype" id="7808432">string</span><span class="op" id="7808438">(</span><span class="builtintype" id="7808439">nil</span><span class="op" id="7808442">)</span><span class="op" id="7808443">,</span>&nbsp;<span class="ident" id="7808445">test</span><span class="op" id="7808449">.</span><span class="ident" id="7808450">command</span><span class="op" id="7808457">...</span><span class="op" id="7808460">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7808463">test</span><span class="op" id="7808467">.</span><span class="ident" id="7808468">command</span>&nbsp;<span class="op" id="7808476">=</span>&nbsp;<span class="builtinfunc" id="7808478">append</span><span class="op" id="7808484">(</span><span class="ident" id="7808485">test</span><span class="op" id="7808489">.</span><span class="ident" id="7808490">command</span><span class="op" id="7808497">,</span>&nbsp;<span class="ident" id="7808499">option</span><span class="op" id="7808505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7808508">test</span><span class="op" id="7808512">.</span><span class="ident" id="7808513">run</span><span class="op" id="7808516">(</span><span class="ident" id="7808517">t</span><span class="op" id="7808518">,</span>&nbsp;<span class="op" id="7808520">*</span><span class="ident" id="7808521">update</span><span class="op" id="7808527">)</span><br>
<span class="lineno"></span><span class="op" id="7808529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7808532">func</span>&nbsp;<span class="ident" id="7808537">runServerTestSSLv3</span><span class="op" id="7808555">(</span><span class="ident" id="7808556">t</span>&nbsp;<span class="op" id="7808558">*</span><span class="ident" id="7808559">testing</span><span class="op" id="7808566">.</span><span class="ident" id="7808567">T</span><span class="op" id="7808568">,</span>&nbsp;<span class="ident" id="7808570">template</span>&nbsp;<span class="op" id="7808579">*</span><span class="ident" id="7808580">serverTest</span><span class="op" id="7808590">)</span>&nbsp;<span class="op" id="7808592">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7808595">runServerTestForVersion</span><span class="op" id="7808618">(</span><span class="ident" id="7808619">t</span><span class="op" id="7808620">,</span>&nbsp;<span class="ident" id="7808622">template</span><span class="op" id="7808630">,</span>&nbsp;<span class="string" id="7808632">&#34;SSLv3-&#34;</span><span class="op" id="7808640">,</span>&nbsp;<span class="string" id="7808642">&#34;-ssl3&#34;</span><span class="op" id="7808649">)</span><br>
<span class="lineno"></span><span class="op" id="7808651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7808654">func</span>&nbsp;<span class="ident" id="7808659">runServerTestTLS10</span><span class="op" id="7808677">(</span><span class="ident" id="7808678">t</span>&nbsp;<span class="op" id="7808680">*</span><span class="ident" id="7808681">testing</span><span class="op" id="7808688">.</span><span class="ident" id="7808689">T</span><span class="op" id="7808690">,</span>&nbsp;<span class="ident" id="7808692">template</span>&nbsp;<span class="op" id="7808701">*</span><span class="ident" id="7808702">serverTest</span><span class="op" id="7808712">)</span>&nbsp;<span class="op" id="7808714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7808717">runServerTestForVersion</span><span class="op" id="7808740">(</span><span class="ident" id="7808741">t</span><span class="op" id="7808742">,</span>&nbsp;<span class="ident" id="7808744">template</span><span class="op" id="7808752">,</span>&nbsp;<span class="string" id="7808754">&#34;TLSv10-&#34;</span><span class="op" id="7808763">,</span>&nbsp;<span class="string" id="7808765">&#34;-tls1&#34;</span><span class="op" id="7808772">)</span><br>
<span class="lineno">470</span><span class="op" id="7808774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7808777">func</span>&nbsp;<span class="ident" id="7808782">runServerTestTLS11</span><span class="op" id="7808800">(</span><span class="ident" id="7808801">t</span>&nbsp;<span class="op" id="7808803">*</span><span class="ident" id="7808804">testing</span><span class="op" id="7808811">.</span><span class="ident" id="7808812">T</span><span class="op" id="7808813">,</span>&nbsp;<span class="ident" id="7808815">template</span>&nbsp;<span class="op" id="7808824">*</span><span class="ident" id="7808825">serverTest</span><span class="op" id="7808835">)</span>&nbsp;<span class="op" id="7808837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7808840">runServerTestForVersion</span><span class="op" id="7808863">(</span><span class="ident" id="7808864">t</span><span class="op" id="7808865">,</span>&nbsp;<span class="ident" id="7808867">template</span><span class="op" id="7808875">,</span>&nbsp;<span class="string" id="7808877">&#34;TLSv11-&#34;</span><span class="op" id="7808886">,</span>&nbsp;<span class="string" id="7808888">&#34;-tls1_1&#34;</span><span class="op" id="7808897">)</span><br>
<span class="lineno"></span><span class="op" id="7808899">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="7808902">func</span>&nbsp;<span class="ident" id="7808907">runServerTestTLS12</span><span class="op" id="7808925">(</span><span class="ident" id="7808926">t</span>&nbsp;<span class="op" id="7808928">*</span><span class="ident" id="7808929">testing</span><span class="op" id="7808936">.</span><span class="ident" id="7808937">T</span><span class="op" id="7808938">,</span>&nbsp;<span class="ident" id="7808940">template</span>&nbsp;<span class="op" id="7808949">*</span><span class="ident" id="7808950">serverTest</span><span class="op" id="7808960">)</span>&nbsp;<span class="op" id="7808962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7808965">runServerTestForVersion</span><span class="op" id="7808988">(</span><span class="ident" id="7808989">t</span><span class="op" id="7808990">,</span>&nbsp;<span class="ident" id="7808992">template</span><span class="op" id="7809000">,</span>&nbsp;<span class="string" id="7809002">&#34;TLSv12-&#34;</span><span class="op" id="7809011">,</span>&nbsp;<span class="string" id="7809013">&#34;-tls1_2&#34;</span><span class="op" id="7809022">)</span><br>
<span class="lineno"></span><span class="op" id="7809024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="7809027">func</span>&nbsp;<span class="ident" id="7809032">TestHandshakeServerRSARC4</span><span class="op" id="7809057">(</span><span class="ident" id="7809058">t</span>&nbsp;<span class="op" id="7809060">*</span><span class="ident" id="7809061">testing</span><span class="op" id="7809068">.</span><span class="ident" id="7809069">T</span><span class="op" id="7809070">)</span>&nbsp;<span class="op" id="7809072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809075">test</span>&nbsp;<span class="op" id="7809080">:=</span>&nbsp;<span class="op" id="7809083">&amp;</span><span class="ident" id="7809084">serverTest</span><span class="op" id="7809094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809098">name</span><span class="op" id="7809102">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7809107">&#34;RSA-RC4&#34;</span><span class="op" id="7809116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809120">command</span><span class="op" id="7809127">:</span>&nbsp;<span class="op" id="7809129">[</span><span class="op" id="7809130">]</span><span class="builtintype" id="7809131">string</span><span class="op" id="7809137">{</span><span class="string" id="7809138">&#34;openssl&#34;</span><span class="op" id="7809147">,</span>&nbsp;<span class="string" id="7809149">&#34;s_client&#34;</span><span class="op" id="7809159">,</span>&nbsp;<span class="string" id="7809161">&#34;-no_ticket&#34;</span><span class="op" id="7809173">,</span>&nbsp;<span class="string" id="7809175">&#34;-cipher&#34;</span><span class="op" id="7809184">,</span>&nbsp;<span class="string" id="7809186">&#34;RC4-SHA&#34;</span><span class="op" id="7809195">}</span><span class="op" id="7809196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7809199">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809202">runServerTestSSLv3</span><span class="op" id="7809220">(</span><span class="ident" id="7809221">t</span><span class="op" id="7809222">,</span>&nbsp;<span class="ident" id="7809224">test</span><span class="op" id="7809228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809231">runServerTestTLS10</span><span class="op" id="7809249">(</span><span class="ident" id="7809250">t</span><span class="op" id="7809251">,</span>&nbsp;<span class="ident" id="7809253">test</span><span class="op" id="7809257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809260">runServerTestTLS11</span><span class="op" id="7809278">(</span><span class="ident" id="7809279">t</span><span class="op" id="7809280">,</span>&nbsp;<span class="ident" id="7809282">test</span><span class="op" id="7809286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809289">runServerTestTLS12</span><span class="op" id="7809307">(</span><span class="ident" id="7809308">t</span><span class="op" id="7809309">,</span>&nbsp;<span class="ident" id="7809311">test</span><span class="op" id="7809315">)</span><br>
<span class="lineno"></span><span class="op" id="7809317">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="keyword" id="7809320">func</span>&nbsp;<span class="ident" id="7809325">TestHandshakeServerRSA3DES</span><span class="op" id="7809351">(</span><span class="ident" id="7809352">t</span>&nbsp;<span class="op" id="7809354">*</span><span class="ident" id="7809355">testing</span><span class="op" id="7809362">.</span><span class="ident" id="7809363">T</span><span class="op" id="7809364">)</span>&nbsp;<span class="op" id="7809366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809369">test</span>&nbsp;<span class="op" id="7809374">:=</span>&nbsp;<span class="op" id="7809377">&amp;</span><span class="ident" id="7809378">serverTest</span><span class="op" id="7809388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809392">name</span><span class="op" id="7809396">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7809401">&#34;RSA-3DES&#34;</span><span class="op" id="7809411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809415">command</span><span class="op" id="7809422">:</span>&nbsp;<span class="op" id="7809424">[</span><span class="op" id="7809425">]</span><span class="builtintype" id="7809426">string</span><span class="op" id="7809432">{</span><span class="string" id="7809433">&#34;openssl&#34;</span><span class="op" id="7809442">,</span>&nbsp;<span class="string" id="7809444">&#34;s_client&#34;</span><span class="op" id="7809454">,</span>&nbsp;<span class="string" id="7809456">&#34;-no_ticket&#34;</span><span class="op" id="7809468">,</span>&nbsp;<span class="string" id="7809470">&#34;-cipher&#34;</span><span class="op" id="7809479">,</span>&nbsp;<span class="string" id="7809481">&#34;DES-CBC3-SHA&#34;</span><span class="op" id="7809495">}</span><span class="op" id="7809496">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7809499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809502">runServerTestSSLv3</span><span class="op" id="7809520">(</span><span class="ident" id="7809521">t</span><span class="op" id="7809522">,</span>&nbsp;<span class="ident" id="7809524">test</span><span class="op" id="7809528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809531">runServerTestTLS10</span><span class="op" id="7809549">(</span><span class="ident" id="7809550">t</span><span class="op" id="7809551">,</span>&nbsp;<span class="ident" id="7809553">test</span><span class="op" id="7809557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809560">runServerTestTLS12</span><span class="op" id="7809578">(</span><span class="ident" id="7809579">t</span><span class="op" id="7809580">,</span>&nbsp;<span class="ident" id="7809582">test</span><span class="op" id="7809586">)</span><br>
<span class="lineno"></span><span class="op" id="7809588">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="7809591">func</span>&nbsp;<span class="ident" id="7809596">TestHandshakeServerRSAAES</span><span class="op" id="7809621">(</span><span class="ident" id="7809622">t</span>&nbsp;<span class="op" id="7809624">*</span><span class="ident" id="7809625">testing</span><span class="op" id="7809632">.</span><span class="ident" id="7809633">T</span><span class="op" id="7809634">)</span>&nbsp;<span class="op" id="7809636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809639">test</span>&nbsp;<span class="op" id="7809644">:=</span>&nbsp;<span class="op" id="7809647">&amp;</span><span class="ident" id="7809648">serverTest</span><span class="op" id="7809658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809662">name</span><span class="op" id="7809666">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7809671">&#34;RSA-AES&#34;</span><span class="op" id="7809680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809684">command</span><span class="op" id="7809691">:</span>&nbsp;<span class="op" id="7809693">[</span><span class="op" id="7809694">]</span><span class="builtintype" id="7809695">string</span><span class="op" id="7809701">{</span><span class="string" id="7809702">&#34;openssl&#34;</span><span class="op" id="7809711">,</span>&nbsp;<span class="string" id="7809713">&#34;s_client&#34;</span><span class="op" id="7809723">,</span>&nbsp;<span class="string" id="7809725">&#34;-no_ticket&#34;</span><span class="op" id="7809737">,</span>&nbsp;<span class="string" id="7809739">&#34;-cipher&#34;</span><span class="op" id="7809748">,</span>&nbsp;<span class="string" id="7809750">&#34;AES128-SHA&#34;</span><span class="op" id="7809762">}</span><span class="op" id="7809763">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7809766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809769">runServerTestSSLv3</span><span class="op" id="7809787">(</span><span class="ident" id="7809788">t</span><span class="op" id="7809789">,</span>&nbsp;<span class="ident" id="7809791">test</span><span class="op" id="7809795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809798">runServerTestTLS10</span><span class="op" id="7809816">(</span><span class="ident" id="7809817">t</span><span class="op" id="7809818">,</span>&nbsp;<span class="ident" id="7809820">test</span><span class="op" id="7809824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809827">runServerTestTLS12</span><span class="op" id="7809845">(</span><span class="ident" id="7809846">t</span><span class="op" id="7809847">,</span>&nbsp;<span class="ident" id="7809849">test</span><span class="op" id="7809853">)</span><br>
<span class="lineno"></span><span class="op" id="7809855">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="keyword" id="7809858">func</span>&nbsp;<span class="ident" id="7809863">TestHandshakeServerAESGCM</span><span class="op" id="7809888">(</span><span class="ident" id="7809889">t</span>&nbsp;<span class="op" id="7809891">*</span><span class="ident" id="7809892">testing</span><span class="op" id="7809899">.</span><span class="ident" id="7809900">T</span><span class="op" id="7809901">)</span>&nbsp;<span class="op" id="7809903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809906">test</span>&nbsp;<span class="op" id="7809911">:=</span>&nbsp;<span class="op" id="7809914">&amp;</span><span class="ident" id="7809915">serverTest</span><span class="op" id="7809925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809929">name</span><span class="op" id="7809933">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7809938">&#34;RSA-AES-GCM&#34;</span><span class="op" id="7809951">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7809955">command</span><span class="op" id="7809962">:</span>&nbsp;<span class="op" id="7809964">[</span><span class="op" id="7809965">]</span><span class="builtintype" id="7809966">string</span><span class="op" id="7809972">{</span><span class="string" id="7809973">&#34;openssl&#34;</span><span class="op" id="7809982">,</span>&nbsp;<span class="string" id="7809984">&#34;s_client&#34;</span><span class="op" id="7809994">,</span>&nbsp;<span class="string" id="7809996">&#34;-no_ticket&#34;</span><span class="op" id="7810008">,</span>&nbsp;<span class="string" id="7810010">&#34;-cipher&#34;</span><span class="op" id="7810019">,</span>&nbsp;<span class="string" id="7810021">&#34;ECDHE-RSA-AES128-GCM-SHA256&#34;</span><span class="op" id="7810050">}</span><span class="op" id="7810051">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7810054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810057">runServerTestTLS12</span><span class="op" id="7810075">(</span><span class="ident" id="7810076">t</span><span class="op" id="7810077">,</span>&nbsp;<span class="ident" id="7810079">test</span><span class="op" id="7810083">)</span><br>
<span class="lineno"></span><span class="op" id="7810085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7810088">func</span>&nbsp;<span class="ident" id="7810093">TestHandshakeServerECDHEECDSAAES</span><span class="op" id="7810125">(</span><span class="ident" id="7810126">t</span>&nbsp;<span class="op" id="7810128">*</span><span class="ident" id="7810129">testing</span><span class="op" id="7810136">.</span><span class="ident" id="7810137">T</span><span class="op" id="7810138">)</span>&nbsp;<span class="op" id="7810140">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810143">config</span>&nbsp;<span class="op" id="7810150">:=</span>&nbsp;<span class="op" id="7810153">*</span><span class="ident" id="7810154">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810166">config</span><span class="op" id="7810172">.</span><span class="ident" id="7810173">Certificates</span>&nbsp;<span class="op" id="7810186">=</span>&nbsp;<span class="builtinfunc" id="7810188">make</span><span class="op" id="7810192">(</span><span class="op" id="7810193">[</span><span class="op" id="7810194">]</span><span class="ident" id="7810195">Certificate</span><span class="op" id="7810206">,</span>&nbsp;<span class="num" id="7810208">1</span><span class="op" id="7810209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810212">config</span><span class="op" id="7810218">.</span><span class="ident" id="7810219">Certificates</span><span class="op" id="7810231">[</span><span class="num" id="7810232">0</span><span class="op" id="7810233">]</span><span class="op" id="7810234">.</span><span class="ident" id="7810235">Certificate</span>&nbsp;<span class="op" id="7810247">=</span>&nbsp;<span class="op" id="7810249">[</span><span class="op" id="7810250">]</span><span class="op" id="7810251">[</span><span class="op" id="7810252">]</span><span class="builtintype" id="7810253">byte</span><span class="op" id="7810257">{</span><span class="ident" id="7810258">testECDSACertificate</span><span class="op" id="7810278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810281">config</span><span class="op" id="7810287">.</span><span class="ident" id="7810288">Certificates</span><span class="op" id="7810300">[</span><span class="num" id="7810301">0</span><span class="op" id="7810302">]</span><span class="op" id="7810303">.</span><span class="ident" id="7810304">PrivateKey</span>&nbsp;<span class="op" id="7810315">=</span>&nbsp;<span class="ident" id="7810317">testECDSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810338">config</span><span class="op" id="7810344">.</span><span class="ident" id="7810345">BuildNameToCertificate</span><span class="op" id="7810367">(</span><span class="op" id="7810368">)</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810372">test</span>&nbsp;<span class="op" id="7810377">:=</span>&nbsp;<span class="op" id="7810380">&amp;</span><span class="ident" id="7810381">serverTest</span><span class="op" id="7810391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810395">name</span><span class="op" id="7810399">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7810404">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="7810421">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810425">command</span><span class="op" id="7810432">:</span>&nbsp;<span class="op" id="7810434">[</span><span class="op" id="7810435">]</span><span class="builtintype" id="7810436">string</span><span class="op" id="7810442">{</span><span class="string" id="7810443">&#34;openssl&#34;</span><span class="op" id="7810452">,</span>&nbsp;<span class="string" id="7810454">&#34;s_client&#34;</span><span class="op" id="7810464">,</span>&nbsp;<span class="string" id="7810466">&#34;-no_ticket&#34;</span><span class="op" id="7810478">,</span>&nbsp;<span class="string" id="7810480">&#34;-cipher&#34;</span><span class="op" id="7810489">,</span>&nbsp;<span class="string" id="7810491">&#34;ECDHE-ECDSA-AES256-SHA&#34;</span><span class="op" id="7810515">}</span><span class="op" id="7810516">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810520">config</span><span class="op" id="7810526">:</span>&nbsp;&nbsp;<span class="op" id="7810529">&amp;</span><span class="ident" id="7810530">config</span><span class="op" id="7810536">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7810539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810542">runServerTestTLS10</span><span class="op" id="7810560">(</span><span class="ident" id="7810561">t</span><span class="op" id="7810562">,</span>&nbsp;<span class="ident" id="7810564">test</span><span class="op" id="7810568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810571">runServerTestTLS12</span><span class="op" id="7810589">(</span><span class="ident" id="7810590">t</span><span class="op" id="7810591">,</span>&nbsp;<span class="ident" id="7810593">test</span><span class="op" id="7810597">)</span><br>
<span class="lineno"></span><span class="op" id="7810599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="7810602">func</span>&nbsp;<span class="ident" id="7810607">TestHandshakeServerALPN</span><span class="op" id="7810630">(</span><span class="ident" id="7810631">t</span>&nbsp;<span class="op" id="7810633">*</span><span class="ident" id="7810634">testing</span><span class="op" id="7810641">.</span><span class="ident" id="7810642">T</span><span class="op" id="7810643">)</span>&nbsp;<span class="op" id="7810645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810648">config</span>&nbsp;<span class="op" id="7810655">:=</span>&nbsp;<span class="op" id="7810658">*</span><span class="ident" id="7810659">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810671">config</span><span class="op" id="7810677">.</span><span class="ident" id="7810678">NextProtos</span>&nbsp;<span class="op" id="7810689">=</span>&nbsp;<span class="op" id="7810691">[</span><span class="op" id="7810692">]</span><span class="builtintype" id="7810693">string</span><span class="op" id="7810699">{</span><span class="string" id="7810700">&#34;proto1&#34;</span><span class="op" id="7810708">,</span>&nbsp;<span class="string" id="7810710">&#34;proto2&#34;</span><span class="op" id="7810718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810722">test</span>&nbsp;<span class="op" id="7810727">:=</span>&nbsp;<span class="op" id="7810730">&amp;</span><span class="ident" id="7810731">serverTest</span><span class="op" id="7810741">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810745">name</span><span class="op" id="7810749">:</span>&nbsp;<span class="string" id="7810751">&#34;ALPN&#34;</span><span class="op" id="7810757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7810761">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7810827">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810870">command</span><span class="op" id="7810877">:</span>&nbsp;<span class="op" id="7810879">[</span><span class="op" id="7810880">]</span><span class="builtintype" id="7810881">string</span><span class="op" id="7810887">{</span><span class="string" id="7810888">&#34;openssl&#34;</span><span class="op" id="7810897">,</span>&nbsp;<span class="string" id="7810899">&#34;s_client&#34;</span><span class="op" id="7810909">,</span>&nbsp;<span class="string" id="7810911">&#34;-alpn&#34;</span><span class="op" id="7810918">,</span>&nbsp;<span class="string" id="7810920">&#34;proto2,proto1&#34;</span><span class="op" id="7810935">}</span><span class="op" id="7810936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810940">config</span><span class="op" id="7810946">:</span>&nbsp;&nbsp;<span class="op" id="7810949">&amp;</span><span class="ident" id="7810950">config</span><span class="op" id="7810956">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7810960">validate</span><span class="op" id="7810968">:</span>&nbsp;<span class="keyword" id="7810970">func</span><span class="op" id="7810974">(</span><span class="ident" id="7810975">state</span>&nbsp;<span class="ident" id="7810981">ConnectionState</span><span class="op" id="7810996">)</span>&nbsp;<span class="builtintype" id="7810998">error</span>&nbsp;<span class="op" id="7811004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7811009">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7811068">if</span>&nbsp;<span class="ident" id="7811071">state</span><span class="op" id="7811076">.</span><span class="ident" id="7811077">NegotiatedProtocol</span>&nbsp;<span class="op" id="7811096">!=</span>&nbsp;<span class="string" id="7811099">&#34;proto1&#34;</span>&nbsp;<span class="op" id="7811108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7811114">return</span>&nbsp;<span class="ident" id="7811121">fmt</span><span class="op" id="7811124">.</span><span class="ident" id="7811125">Errorf</span><span class="op" id="7811131">(</span><span class="string" id="7811132">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="7811164">,</span>&nbsp;<span class="ident" id="7811166">state</span><span class="op" id="7811171">.</span><span class="ident" id="7811172">NegotiatedProtocol</span><span class="op" id="7811190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7811195">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7811200">return</span>&nbsp;<span class="builtintype" id="7811207">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7811213">}</span><span class="op" id="7811214">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7811217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7811220">runServerTestTLS12</span><span class="op" id="7811238">(</span><span class="ident" id="7811239">t</span><span class="op" id="7811240">,</span>&nbsp;<span class="ident" id="7811242">test</span><span class="op" id="7811246">)</span><br>
<span class="lineno"></span><span class="op" id="7811248">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="7811251">func</span>&nbsp;<span class="ident" id="7811256">TestHandshakeServerALPNNoMatch</span><span class="op" id="7811286">(</span><span class="ident" id="7811287">t</span>&nbsp;<span class="op" id="7811289">*</span><span class="ident" id="7811290">testing</span><span class="op" id="7811297">.</span><span class="ident" id="7811298">T</span><span class="op" id="7811299">)</span>&nbsp;<span class="op" id="7811301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7811304">config</span>&nbsp;<span class="op" id="7811311">:=</span>&nbsp;<span class="op" id="7811314">*</span><span class="ident" id="7811315">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7811327">config</span><span class="op" id="7811333">.</span><span class="ident" id="7811334">NextProtos</span>&nbsp;<span class="op" id="7811345">=</span>&nbsp;<span class="op" id="7811347">[</span><span class="op" id="7811348">]</span><span class="builtintype" id="7811349">string</span><span class="op" id="7811355">{</span><span class="string" id="7811356">&#34;proto3&#34;</span><span class="op" id="7811364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7811368">test</span>&nbsp;<span class="op" id="7811373">:=</span>&nbsp;<span class="op" id="7811376">&amp;</span><span class="ident" id="7811377">serverTest</span><span class="op" id="7811387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7811391">name</span><span class="op" id="7811395">:</span>&nbsp;<span class="string" id="7811397">&#34;ALPN-NoMatch&#34;</span><span class="op" id="7811411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7811415">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7811481">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7811524">command</span><span class="op" id="7811531">:</span>&nbsp;<span class="op" id="7811533">[</span><span class="op" id="7811534">]</span><span class="builtintype" id="7811535">string</span><span class="op" id="7811541">{</span><span class="string" id="7811542">&#34;openssl&#34;</span><span class="op" id="7811551">,</span>&nbsp;<span class="string" id="7811553">&#34;s_client&#34;</span><span class="op" id="7811563">,</span>&nbsp;<span class="string" id="7811565">&#34;-alpn&#34;</span><span class="op" id="7811572">,</span>&nbsp;<span class="string" id="7811574">&#34;proto2,proto1&#34;</span><span class="op" id="7811589">}</span><span class="op" id="7811590">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7811594">config</span><span class="op" id="7811600">:</span>&nbsp;&nbsp;<span class="op" id="7811603">&amp;</span><span class="ident" id="7811604">config</span><span class="op" id="7811610">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7811614">validate</span><span class="op" id="7811622">:</span>&nbsp;<span class="keyword" id="7811624">func</span><span class="op" id="7811628">(</span><span class="ident" id="7811629">state</span>&nbsp;<span class="ident" id="7811635">ConnectionState</span><span class="op" id="7811650">)</span>&nbsp;<span class="builtintype" id="7811652">error</span>&nbsp;<span class="op" id="7811658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7811663">//&nbsp;Rather&nbsp;than&nbsp;reject&nbsp;the&nbsp;connection,&nbsp;Go&nbsp;doesn&#39;t&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7811722">//&nbsp;a&nbsp;protocol&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;overlap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7811765">if</span>&nbsp;<span class="ident" id="7811768">state</span><span class="op" id="7811773">.</span><span class="ident" id="7811774">NegotiatedProtocol</span>&nbsp;<span class="op" id="7811793">!=</span>&nbsp;<span class="string" id="7811796">&#34;&#34;</span>&nbsp;<span class="op" id="7811799">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7811805">return</span>&nbsp;<span class="ident" id="7811812">fmt</span><span class="op" id="7811815">.</span><span class="ident" id="7811816">Errorf</span><span class="op" id="7811822">(</span><span class="string" id="7811823">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="7811851">,</span>&nbsp;<span class="ident" id="7811853">state</span><span class="op" id="7811858">.</span><span class="ident" id="7811859">NegotiatedProtocol</span><span class="op" id="7811877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7811882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7811887">return</span>&nbsp;<span class="builtintype" id="7811894">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7811900">}</span><span class="op" id="7811901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7811904">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7811907">runServerTestTLS12</span><span class="op" id="7811925">(</span><span class="ident" id="7811926">t</span><span class="op" id="7811927">,</span>&nbsp;<span class="ident" id="7811929">test</span><span class="op" id="7811933">)</span><br>
<span class="lineno"></span><span class="op" id="7811935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7811938">//&nbsp;TestHandshakeServerSNI&nbsp;involves&nbsp;a&nbsp;client&nbsp;sending&nbsp;an&nbsp;SNI&nbsp;extension&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="7812010">//&nbsp;&#34;snitest.com&#34;,&nbsp;which&nbsp;happens&nbsp;to&nbsp;match&nbsp;the&nbsp;CN&nbsp;of&nbsp;testSNICertificate.&nbsp;The&nbsp;test</span><br>
<span class="lineno">580</span><span class="comment" id="7812090">//&nbsp;verifies&nbsp;that&nbsp;the&nbsp;server&nbsp;correctly&nbsp;selects&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="7812154">func</span>&nbsp;<span class="ident" id="7812159">TestHandshakeServerSNI</span><span class="op" id="7812181">(</span><span class="ident" id="7812182">t</span>&nbsp;<span class="op" id="7812184">*</span><span class="ident" id="7812185">testing</span><span class="op" id="7812192">.</span><span class="ident" id="7812193">T</span><span class="op" id="7812194">)</span>&nbsp;<span class="op" id="7812196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7812199">test</span>&nbsp;<span class="op" id="7812204">:=</span>&nbsp;<span class="op" id="7812207">&amp;</span><span class="ident" id="7812208">serverTest</span><span class="op" id="7812218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7812222">name</span><span class="op" id="7812226">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7812231">&#34;SNI&#34;</span><span class="op" id="7812236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7812240">command</span><span class="op" id="7812247">:</span>&nbsp;<span class="op" id="7812249">[</span><span class="op" id="7812250">]</span><span class="builtintype" id="7812251">string</span><span class="op" id="7812257">{</span><span class="string" id="7812258">&#34;openssl&#34;</span><span class="op" id="7812267">,</span>&nbsp;<span class="string" id="7812269">&#34;s_client&#34;</span><span class="op" id="7812279">,</span>&nbsp;<span class="string" id="7812281">&#34;-no_ticket&#34;</span><span class="op" id="7812293">,</span>&nbsp;<span class="string" id="7812295">&#34;-cipher&#34;</span><span class="op" id="7812304">,</span>&nbsp;<span class="string" id="7812306">&#34;AES128-SHA&#34;</span><span class="op" id="7812318">,</span>&nbsp;<span class="string" id="7812320">&#34;-servername&#34;</span><span class="op" id="7812333">,</span>&nbsp;<span class="string" id="7812335">&#34;snitest.com&#34;</span><span class="op" id="7812348">}</span><span class="op" id="7812349">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7812352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7812355">runServerTestTLS12</span><span class="op" id="7812373">(</span><span class="ident" id="7812374">t</span><span class="op" id="7812375">,</span>&nbsp;<span class="ident" id="7812377">test</span><span class="op" id="7812381">)</span><br>
<span class="lineno"></span><span class="op" id="7812383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7812386">//&nbsp;TestHandshakeServerSNICertForName&nbsp;is&nbsp;similar&nbsp;to&nbsp;TestHandshakeServerSNI,&nbsp;but</span><br>
<span class="lineno">590</span><span class="comment" id="7812465">//&nbsp;tests&nbsp;the&nbsp;dynamic&nbsp;GetCertificate&nbsp;method</span><br>
<span class="lineno"></span><span class="keyword" id="7812508">func</span>&nbsp;<span class="ident" id="7812513">TestHandshakeServerSNIGetCertificate</span><span class="op" id="7812549">(</span><span class="ident" id="7812550">t</span>&nbsp;<span class="op" id="7812552">*</span><span class="ident" id="7812553">testing</span><span class="op" id="7812560">.</span><span class="ident" id="7812561">T</span><span class="op" id="7812562">)</span>&nbsp;<span class="op" id="7812564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7812567">config</span>&nbsp;<span class="op" id="7812574">:=</span>&nbsp;<span class="op" id="7812577">*</span><span class="ident" id="7812578">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7812591">//&nbsp;Replace&nbsp;the&nbsp;NameToCertificate&nbsp;map&nbsp;with&nbsp;a&nbsp;GetCertificate&nbsp;function</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7812660">nameToCert</span>&nbsp;<span class="op" id="7812671">:=</span>&nbsp;<span class="ident" id="7812674">config</span><span class="op" id="7812680">.</span><span class="ident" id="7812681">NameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7812700">config</span><span class="op" id="7812706">.</span><span class="ident" id="7812707">NameToCertificate</span>&nbsp;<span class="op" id="7812725">=</span>&nbsp;<span class="builtintype" id="7812727">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7812732">config</span><span class="op" id="7812738">.</span><span class="ident" id="7812739">GetCertificate</span>&nbsp;<span class="op" id="7812754">=</span>&nbsp;<span class="keyword" id="7812756">func</span><span class="op" id="7812760">(</span><span class="ident" id="7812761">clientHello</span>&nbsp;<span class="op" id="7812773">*</span><span class="ident" id="7812774">ClientHelloInfo</span><span class="op" id="7812789">)</span>&nbsp;<span class="op" id="7812791">(</span><span class="op" id="7812792">*</span><span class="ident" id="7812793">Certificate</span><span class="op" id="7812804">,</span>&nbsp;<span class="builtintype" id="7812806">error</span><span class="op" id="7812811">)</span>&nbsp;<span class="op" id="7812813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7812817">cert</span><span class="op" id="7812821">,</span>&nbsp;<span class="ident" id="7812823">_</span>&nbsp;<span class="op" id="7812825">:=</span>&nbsp;<span class="ident" id="7812828">nameToCert</span><span class="op" id="7812838">[</span><span class="ident" id="7812839">clientHello</span><span class="op" id="7812850">.</span><span class="ident" id="7812851">ServerName</span><span class="op" id="7812861">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7812865">return</span>&nbsp;<span class="ident" id="7812872">cert</span><span class="op" id="7812876">,</span>&nbsp;<span class="builtintype" id="7812878">nil</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7812883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7812886">test</span>&nbsp;<span class="op" id="7812891">:=</span>&nbsp;<span class="op" id="7812894">&amp;</span><span class="ident" id="7812895">serverTest</span><span class="op" id="7812905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7812909">name</span><span class="op" id="7812913">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7812918">&#34;SNI&#34;</span><span class="op" id="7812923">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7812927">command</span><span class="op" id="7812934">:</span>&nbsp;<span class="op" id="7812936">[</span><span class="op" id="7812937">]</span><span class="builtintype" id="7812938">string</span><span class="op" id="7812944">{</span><span class="string" id="7812945">&#34;openssl&#34;</span><span class="op" id="7812954">,</span>&nbsp;<span class="string" id="7812956">&#34;s_client&#34;</span><span class="op" id="7812966">,</span>&nbsp;<span class="string" id="7812968">&#34;-no_ticket&#34;</span><span class="op" id="7812980">,</span>&nbsp;<span class="string" id="7812982">&#34;-cipher&#34;</span><span class="op" id="7812991">,</span>&nbsp;<span class="string" id="7812993">&#34;AES128-SHA&#34;</span><span class="op" id="7813005">,</span>&nbsp;<span class="string" id="7813007">&#34;-servername&#34;</span><span class="op" id="7813020">,</span>&nbsp;<span class="string" id="7813022">&#34;snitest.com&#34;</span><span class="op" id="7813035">}</span><span class="op" id="7813036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7813040">config</span><span class="op" id="7813046">:</span>&nbsp;&nbsp;<span class="op" id="7813049">&amp;</span><span class="ident" id="7813050">config</span><span class="op" id="7813056">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7813059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7813062">runServerTestTLS12</span><span class="op" id="7813080">(</span><span class="ident" id="7813081">t</span><span class="op" id="7813082">,</span>&nbsp;<span class="ident" id="7813084">test</span><span class="op" id="7813088">)</span><br>
<span class="lineno"></span><span class="op" id="7813090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7813093">//&nbsp;TestHandshakeServerSNICertForNameNotFound&nbsp;is&nbsp;similar&nbsp;to</span><br>
<span class="lineno">610</span><span class="comment" id="7813152">//&nbsp;TestHandshakeServerSNICertForName,&nbsp;but&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7813227">//&nbsp;GetCertificate&nbsp;method&nbsp;doesn&#39;t&nbsp;return&nbsp;a&nbsp;cert,&nbsp;we&nbsp;fall&nbsp;back&nbsp;to&nbsp;what&#39;s&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7813301">//&nbsp;the&nbsp;NameToCertificate&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="7813331">func</span>&nbsp;<span class="ident" id="7813336">TestHandshakeServerSNIGetCertificateNotFound</span><span class="op" id="7813380">(</span><span class="ident" id="7813381">t</span>&nbsp;<span class="op" id="7813383">*</span><span class="ident" id="7813384">testing</span><span class="op" id="7813391">.</span><span class="ident" id="7813392">T</span><span class="op" id="7813393">)</span>&nbsp;<span class="op" id="7813395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7813398">config</span>&nbsp;<span class="op" id="7813405">:=</span>&nbsp;<span class="op" id="7813408">*</span><span class="ident" id="7813409">testConfig</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7813422">config</span><span class="op" id="7813428">.</span><span class="ident" id="7813429">GetCertificate</span>&nbsp;<span class="op" id="7813444">=</span>&nbsp;<span class="keyword" id="7813446">func</span><span class="op" id="7813450">(</span><span class="ident" id="7813451">clientHello</span>&nbsp;<span class="op" id="7813463">*</span><span class="ident" id="7813464">ClientHelloInfo</span><span class="op" id="7813479">)</span>&nbsp;<span class="op" id="7813481">(</span><span class="op" id="7813482">*</span><span class="ident" id="7813483">Certificate</span><span class="op" id="7813494">,</span>&nbsp;<span class="builtintype" id="7813496">error</span><span class="op" id="7813501">)</span>&nbsp;<span class="op" id="7813503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7813507">return</span>&nbsp;<span class="builtintype" id="7813514">nil</span><span class="op" id="7813517">,</span>&nbsp;<span class="builtintype" id="7813519">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7813524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7813527">test</span>&nbsp;<span class="op" id="7813532">:=</span>&nbsp;<span class="op" id="7813535">&amp;</span><span class="ident" id="7813536">serverTest</span><span class="op" id="7813546">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7813550">name</span><span class="op" id="7813554">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7813559">&#34;SNI&#34;</span><span class="op" id="7813564">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7813568">command</span><span class="op" id="7813575">:</span>&nbsp;<span class="op" id="7813577">[</span><span class="op" id="7813578">]</span><span class="builtintype" id="7813579">string</span><span class="op" id="7813585">{</span><span class="string" id="7813586">&#34;openssl&#34;</span><span class="op" id="7813595">,</span>&nbsp;<span class="string" id="7813597">&#34;s_client&#34;</span><span class="op" id="7813607">,</span>&nbsp;<span class="string" id="7813609">&#34;-no_ticket&#34;</span><span class="op" id="7813621">,</span>&nbsp;<span class="string" id="7813623">&#34;-cipher&#34;</span><span class="op" id="7813632">,</span>&nbsp;<span class="string" id="7813634">&#34;AES128-SHA&#34;</span><span class="op" id="7813646">,</span>&nbsp;<span class="string" id="7813648">&#34;-servername&#34;</span><span class="op" id="7813661">,</span>&nbsp;<span class="string" id="7813663">&#34;snitest.com&#34;</span><span class="op" id="7813676">}</span><span class="op" id="7813677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7813681">config</span><span class="op" id="7813687">:</span>&nbsp;&nbsp;<span class="op" id="7813690">&amp;</span><span class="ident" id="7813691">config</span><span class="op" id="7813697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7813700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7813703">runServerTestTLS12</span><span class="op" id="7813721">(</span><span class="ident" id="7813722">t</span><span class="op" id="7813723">,</span>&nbsp;<span class="ident" id="7813725">test</span><span class="op" id="7813729">)</span><br>
<span class="lineno">625</span><span class="op" id="7813731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7813734">//&nbsp;TestHandshakeServerSNICertForNameError&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;errors&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7813810">//&nbsp;GetCertificate&nbsp;result&nbsp;in&nbsp;a&nbsp;tls&nbsp;alert.</span><br>
<span class="lineno"></span><span class="keyword" id="7813851">func</span>&nbsp;<span class="ident" id="7813856">TestHandshakeServerSNIGetCertificateError</span><span class="op" id="7813897">(</span><span class="ident" id="7813898">t</span>&nbsp;<span class="op" id="7813900">*</span><span class="ident" id="7813901">testing</span><span class="op" id="7813908">.</span><span class="ident" id="7813909">T</span><span class="op" id="7813910">)</span>&nbsp;<span class="op" id="7813912">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7813915">config</span>&nbsp;<span class="op" id="7813922">:=</span>&nbsp;<span class="op" id="7813925">*</span><span class="ident" id="7813926">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7813939">config</span><span class="op" id="7813945">.</span><span class="ident" id="7813946">GetCertificate</span>&nbsp;<span class="op" id="7813961">=</span>&nbsp;<span class="keyword" id="7813963">func</span><span class="op" id="7813967">(</span><span class="ident" id="7813968">clientHello</span>&nbsp;<span class="op" id="7813980">*</span><span class="ident" id="7813981">ClientHelloInfo</span><span class="op" id="7813996">)</span>&nbsp;<span class="op" id="7813998">(</span><span class="op" id="7813999">*</span><span class="ident" id="7814000">Certificate</span><span class="op" id="7814011">,</span>&nbsp;<span class="builtintype" id="7814013">error</span><span class="op" id="7814018">)</span>&nbsp;<span class="op" id="7814020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7814024">return</span>&nbsp;<span class="builtintype" id="7814031">nil</span><span class="op" id="7814034">,</span>&nbsp;<span class="ident" id="7814036">fmt</span><span class="op" id="7814039">.</span><span class="ident" id="7814040">Errorf</span><span class="op" id="7814046">(</span><span class="string" id="7814047">&#34;Test&nbsp;error&nbsp;in&nbsp;GetCertificate&#34;</span><span class="op" id="7814077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7814080">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7814083">test</span>&nbsp;<span class="op" id="7814088">:=</span>&nbsp;<span class="op" id="7814091">&amp;</span><span class="ident" id="7814092">serverTest</span><span class="op" id="7814102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7814106">name</span><span class="op" id="7814110">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7814119">&#34;SNI&#34;</span><span class="op" id="7814124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7814128">command</span><span class="op" id="7814135">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7814141">[</span><span class="op" id="7814142">]</span><span class="builtintype" id="7814143">string</span><span class="op" id="7814149">{</span><span class="string" id="7814150">&#34;openssl&#34;</span><span class="op" id="7814159">,</span>&nbsp;<span class="string" id="7814161">&#34;s_client&#34;</span><span class="op" id="7814171">,</span>&nbsp;<span class="string" id="7814173">&#34;-no_ticket&#34;</span><span class="op" id="7814185">,</span>&nbsp;<span class="string" id="7814187">&#34;-cipher&#34;</span><span class="op" id="7814196">,</span>&nbsp;<span class="string" id="7814198">&#34;AES128-SHA&#34;</span><span class="op" id="7814210">,</span>&nbsp;<span class="string" id="7814212">&#34;-servername&#34;</span><span class="op" id="7814225">,</span>&nbsp;<span class="string" id="7814227">&#34;snitest.com&#34;</span><span class="op" id="7814240">}</span><span class="op" id="7814241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7814245">config</span><span class="op" id="7814251">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7814258">&amp;</span><span class="ident" id="7814259">config</span><span class="op" id="7814265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7814269">expectAlert</span><span class="op" id="7814280">:</span>&nbsp;<span class="builtintype" id="7814282">true</span><span class="op" id="7814286">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7814289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7814292">runServerTestTLS12</span><span class="op" id="7814310">(</span><span class="ident" id="7814311">t</span><span class="op" id="7814312">,</span>&nbsp;<span class="ident" id="7814314">test</span><span class="op" id="7814318">)</span><br>
<span class="lineno"></span><span class="op" id="7814320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7814323">//&nbsp;TestCipherSuiteCertPreferance&nbsp;ensures&nbsp;that&nbsp;we&nbsp;select&nbsp;an&nbsp;RSA&nbsp;ciphersuite&nbsp;with</span><br>
<span class="lineno">645</span><span class="comment" id="7814403">//&nbsp;an&nbsp;RSA&nbsp;certificate&nbsp;and&nbsp;an&nbsp;ECDSA&nbsp;ciphersuite&nbsp;with&nbsp;an&nbsp;ECDSA&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="7814477">func</span>&nbsp;<span class="ident" id="7814482">TestCipherSuiteCertPreferenceECDSA</span><span class="op" id="7814516">(</span><span class="ident" id="7814517">t</span>&nbsp;<span class="op" id="7814519">*</span><span class="ident" id="7814520">testing</span><span class="op" id="7814527">.</span><span class="ident" id="7814528">T</span><span class="op" id="7814529">)</span>&nbsp;<span class="op" id="7814531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7814534">config</span>&nbsp;<span class="op" id="7814541">:=</span>&nbsp;<span class="op" id="7814544">*</span><span class="ident" id="7814545">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7814557">config</span><span class="op" id="7814563">.</span><span class="ident" id="7814564">CipherSuites</span>&nbsp;<span class="op" id="7814577">=</span>&nbsp;<span class="op" id="7814579">[</span><span class="op" id="7814580">]</span><span class="builtintype" id="7814581">uint16</span><span class="op" id="7814587">{</span><span class="ident" id="7814588">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7814624">,</span>&nbsp;<span class="ident" id="7814626">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7814660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7814663">config</span><span class="op" id="7814669">.</span><span class="ident" id="7814670">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7814695">=</span>&nbsp;<span class="builtintype" id="7814697">true</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7814704">test</span>&nbsp;<span class="op" id="7814709">:=</span>&nbsp;<span class="op" id="7814712">&amp;</span><span class="ident" id="7814713">serverTest</span><span class="op" id="7814723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7814727">name</span><span class="op" id="7814731">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7814735">&#34;CipherSuiteCertPreferenceRSA&#34;</span><span class="op" id="7814765">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7814769">config</span><span class="op" id="7814775">:</span>&nbsp;<span class="op" id="7814777">&amp;</span><span class="ident" id="7814778">config</span><span class="op" id="7814784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7814787">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7814790">runServerTestTLS12</span><span class="op" id="7814808">(</span><span class="ident" id="7814809">t</span><span class="op" id="7814810">,</span>&nbsp;<span class="ident" id="7814812">test</span><span class="op" id="7814816">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7814820">config</span>&nbsp;<span class="op" id="7814827">=</span>&nbsp;<span class="op" id="7814829">*</span><span class="ident" id="7814830">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7814842">config</span><span class="op" id="7814848">.</span><span class="ident" id="7814849">CipherSuites</span>&nbsp;<span class="op" id="7814862">=</span>&nbsp;<span class="op" id="7814864">[</span><span class="op" id="7814865">]</span><span class="builtintype" id="7814866">uint16</span><span class="op" id="7814872">{</span><span class="ident" id="7814873">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7814907">,</span>&nbsp;<span class="ident" id="7814909">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7814945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7814948">config</span><span class="op" id="7814954">.</span><span class="ident" id="7814955">Certificates</span>&nbsp;<span class="op" id="7814968">=</span>&nbsp;<span class="op" id="7814970">[</span><span class="op" id="7814971">]</span><span class="ident" id="7814972">Certificate</span><span class="op" id="7814983">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7814987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7814992">Certificate</span><span class="op" id="7815003">:</span>&nbsp;<span class="op" id="7815005">[</span><span class="op" id="7815006">]</span><span class="op" id="7815007">[</span><span class="op" id="7815008">]</span><span class="builtintype" id="7815009">byte</span><span class="op" id="7815013">{</span><span class="ident" id="7815014">testECDSACertificate</span><span class="op" id="7815034">}</span><span class="op" id="7815035">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815040">PrivateKey</span><span class="op" id="7815050">:</span>&nbsp;&nbsp;<span class="ident" id="7815053">testECDSAPrivateKey</span><span class="op" id="7815072">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7815076">}</span><span class="op" id="7815077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7815080">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815083">config</span><span class="op" id="7815089">.</span><span class="ident" id="7815090">BuildNameToCertificate</span><span class="op" id="7815112">(</span><span class="op" id="7815113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815116">config</span><span class="op" id="7815122">.</span><span class="ident" id="7815123">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7815148">=</span>&nbsp;<span class="builtintype" id="7815150">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815157">test</span>&nbsp;<span class="op" id="7815162">=</span>&nbsp;<span class="op" id="7815164">&amp;</span><span class="ident" id="7815165">serverTest</span><span class="op" id="7815175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815179">name</span><span class="op" id="7815183">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7815187">&#34;CipherSuiteCertPreferenceECDSA&#34;</span><span class="op" id="7815219">,</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815223">config</span><span class="op" id="7815229">:</span>&nbsp;<span class="op" id="7815231">&amp;</span><span class="ident" id="7815232">config</span><span class="op" id="7815238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7815241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815244">runServerTestTLS12</span><span class="op" id="7815262">(</span><span class="ident" id="7815263">t</span><span class="op" id="7815264">,</span>&nbsp;<span class="ident" id="7815266">test</span><span class="op" id="7815270">)</span><br>
<span class="lineno"></span><span class="op" id="7815272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="7815275">func</span>&nbsp;<span class="ident" id="7815280">TestResumption</span><span class="op" id="7815294">(</span><span class="ident" id="7815295">t</span>&nbsp;<span class="op" id="7815297">*</span><span class="ident" id="7815298">testing</span><span class="op" id="7815305">.</span><span class="ident" id="7815306">T</span><span class="op" id="7815307">)</span>&nbsp;<span class="op" id="7815309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815312">sessionFilePath</span>&nbsp;<span class="op" id="7815328">:=</span>&nbsp;<span class="ident" id="7815331">tempFile</span><span class="op" id="7815339">(</span><span class="string" id="7815340">&#34;&#34;</span><span class="op" id="7815342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7815345">defer</span>&nbsp;<span class="ident" id="7815351">os</span><span class="op" id="7815353">.</span><span class="ident" id="7815354">Remove</span><span class="op" id="7815360">(</span><span class="ident" id="7815361">sessionFilePath</span><span class="op" id="7815376">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815380">test</span>&nbsp;<span class="op" id="7815385">:=</span>&nbsp;<span class="op" id="7815388">&amp;</span><span class="ident" id="7815389">serverTest</span><span class="op" id="7815399">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815403">name</span><span class="op" id="7815407">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7815412">&#34;IssueTicket&#34;</span><span class="op" id="7815425">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815429">command</span><span class="op" id="7815436">:</span>&nbsp;<span class="op" id="7815438">[</span><span class="op" id="7815439">]</span><span class="builtintype" id="7815440">string</span><span class="op" id="7815446">{</span><span class="string" id="7815447">&#34;openssl&#34;</span><span class="op" id="7815456">,</span>&nbsp;<span class="string" id="7815458">&#34;s_client&#34;</span><span class="op" id="7815468">,</span>&nbsp;<span class="string" id="7815470">&#34;-cipher&#34;</span><span class="op" id="7815479">,</span>&nbsp;<span class="string" id="7815481">&#34;RC4-SHA&#34;</span><span class="op" id="7815490">,</span>&nbsp;<span class="string" id="7815492">&#34;-sess_out&#34;</span><span class="op" id="7815503">,</span>&nbsp;<span class="ident" id="7815505">sessionFilePath</span><span class="op" id="7815520">}</span><span class="op" id="7815521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7815524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815527">runServerTestTLS12</span><span class="op" id="7815545">(</span><span class="ident" id="7815546">t</span><span class="op" id="7815547">,</span>&nbsp;<span class="ident" id="7815549">test</span><span class="op" id="7815553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815557">test</span>&nbsp;<span class="op" id="7815562">=</span>&nbsp;<span class="op" id="7815564">&amp;</span><span class="ident" id="7815565">serverTest</span><span class="op" id="7815575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815579">name</span><span class="op" id="7815583">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7815588">&#34;Resume&#34;</span><span class="op" id="7815596">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815600">command</span><span class="op" id="7815607">:</span>&nbsp;<span class="op" id="7815609">[</span><span class="op" id="7815610">]</span><span class="builtintype" id="7815611">string</span><span class="op" id="7815617">{</span><span class="string" id="7815618">&#34;openssl&#34;</span><span class="op" id="7815627">,</span>&nbsp;<span class="string" id="7815629">&#34;s_client&#34;</span><span class="op" id="7815639">,</span>&nbsp;<span class="string" id="7815641">&#34;-cipher&#34;</span><span class="op" id="7815650">,</span>&nbsp;<span class="string" id="7815652">&#34;RC4-SHA&#34;</span><span class="op" id="7815661">,</span>&nbsp;<span class="string" id="7815663">&#34;-sess_in&#34;</span><span class="op" id="7815673">,</span>&nbsp;<span class="ident" id="7815675">sessionFilePath</span><span class="op" id="7815690">}</span><span class="op" id="7815691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7815694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815697">runServerTestTLS12</span><span class="op" id="7815715">(</span><span class="ident" id="7815716">t</span><span class="op" id="7815717">,</span>&nbsp;<span class="ident" id="7815719">test</span><span class="op" id="7815723">)</span><br>
<span class="lineno">690</span><span class="op" id="7815725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7815728">func</span>&nbsp;<span class="ident" id="7815733">TestResumptionDisabled</span><span class="op" id="7815755">(</span><span class="ident" id="7815756">t</span>&nbsp;<span class="op" id="7815758">*</span><span class="ident" id="7815759">testing</span><span class="op" id="7815766">.</span><span class="ident" id="7815767">T</span><span class="op" id="7815768">)</span>&nbsp;<span class="op" id="7815770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815773">sessionFilePath</span>&nbsp;<span class="op" id="7815789">:=</span>&nbsp;<span class="ident" id="7815792">tempFile</span><span class="op" id="7815800">(</span><span class="string" id="7815801">&#34;&#34;</span><span class="op" id="7815803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7815806">defer</span>&nbsp;<span class="ident" id="7815812">os</span><span class="op" id="7815814">.</span><span class="ident" id="7815815">Remove</span><span class="op" id="7815821">(</span><span class="ident" id="7815822">sessionFilePath</span><span class="op" id="7815837">)</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815841">config</span>&nbsp;<span class="op" id="7815848">:=</span>&nbsp;<span class="op" id="7815851">*</span><span class="ident" id="7815852">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815865">test</span>&nbsp;<span class="op" id="7815870">:=</span>&nbsp;<span class="op" id="7815873">&amp;</span><span class="ident" id="7815874">serverTest</span><span class="op" id="7815884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815888">name</span><span class="op" id="7815892">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7815897">&#34;IssueTicketPreDisable&#34;</span><span class="op" id="7815920">,</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7815924">command</span><span class="op" id="7815931">:</span>&nbsp;<span class="op" id="7815933">[</span><span class="op" id="7815934">]</span><span class="builtintype" id="7815935">string</span><span class="op" id="7815941">{</span><span class="string" id="7815942">&#34;openssl&#34;</span><span class="op" id="7815951">,</span>&nbsp;<span class="string" id="7815953">&#34;s_client&#34;</span><span class="op" id="7815963">,</span>&nbsp;<span class="string" id="7815965">&#34;-cipher&#34;</span><span class="op" id="7815974">,</span>&nbsp;<span class="string" id="7815976">&#34;RC4-SHA&#34;</span><span class="op" id="7815985">,</span>&nbsp;<span class="string" id="7815987">&#34;-sess_out&#34;</span><span class="op" id="7815998">,</span>&nbsp;<span class="ident" id="7816000">sessionFilePath</span><span class="op" id="7816015">}</span><span class="op" id="7816016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7816020">config</span><span class="op" id="7816026">:</span>&nbsp;&nbsp;<span class="op" id="7816029">&amp;</span><span class="ident" id="7816030">config</span><span class="op" id="7816036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7816039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7816042">runServerTestTLS12</span><span class="op" id="7816060">(</span><span class="ident" id="7816061">t</span><span class="op" id="7816062">,</span>&nbsp;<span class="ident" id="7816064">test</span><span class="op" id="7816068">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7816072">config</span><span class="op" id="7816078">.</span><span class="ident" id="7816079">SessionTicketsDisabled</span>&nbsp;<span class="op" id="7816102">=</span>&nbsp;<span class="builtintype" id="7816104">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7816111">test</span>&nbsp;<span class="op" id="7816116">=</span>&nbsp;<span class="op" id="7816118">&amp;</span><span class="ident" id="7816119">serverTest</span><span class="op" id="7816129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7816133">name</span><span class="op" id="7816137">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7816142">&#34;ResumeDisabled&#34;</span><span class="op" id="7816158">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7816162">command</span><span class="op" id="7816169">:</span>&nbsp;<span class="op" id="7816171">[</span><span class="op" id="7816172">]</span><span class="builtintype" id="7816173">string</span><span class="op" id="7816179">{</span><span class="string" id="7816180">&#34;openssl&#34;</span><span class="op" id="7816189">,</span>&nbsp;<span class="string" id="7816191">&#34;s_client&#34;</span><span class="op" id="7816201">,</span>&nbsp;<span class="string" id="7816203">&#34;-cipher&#34;</span><span class="op" id="7816212">,</span>&nbsp;<span class="string" id="7816214">&#34;RC4-SHA&#34;</span><span class="op" id="7816223">,</span>&nbsp;<span class="string" id="7816225">&#34;-sess_in&#34;</span><span class="op" id="7816235">,</span>&nbsp;<span class="ident" id="7816237">sessionFilePath</span><span class="op" id="7816252">}</span><span class="op" id="7816253">,</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7816257">config</span><span class="op" id="7816263">:</span>&nbsp;&nbsp;<span class="op" id="7816266">&amp;</span><span class="ident" id="7816267">config</span><span class="op" id="7816273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7816276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7816279">runServerTestTLS12</span><span class="op" id="7816297">(</span><span class="ident" id="7816298">t</span><span class="op" id="7816299">,</span>&nbsp;<span class="ident" id="7816301">test</span><span class="op" id="7816305">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7816309">//&nbsp;One&nbsp;needs&nbsp;to&nbsp;manually&nbsp;confirm&nbsp;that&nbsp;the&nbsp;handshake&nbsp;in&nbsp;the&nbsp;golden&nbsp;data</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7816381">//&nbsp;file&nbsp;for&nbsp;ResumeDisabled&nbsp;does&nbsp;not&nbsp;include&nbsp;a&nbsp;resumption&nbsp;handshake.</span><br>
<span class="lineno"></span><span class="op" id="7816449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7816452">func</span>&nbsp;<span class="ident" id="7816457">TestFallbackSCSV</span><span class="op" id="7816473">(</span><span class="ident" id="7816474">t</span>&nbsp;<span class="op" id="7816476">*</span><span class="ident" id="7816477">testing</span><span class="op" id="7816484">.</span><span class="ident" id="7816485">T</span><span class="op" id="7816486">)</span>&nbsp;<span class="op" id="7816488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7816491">test</span>&nbsp;<span class="op" id="7816496">:=</span>&nbsp;<span class="op" id="7816499">&amp;</span><span class="ident" id="7816500">serverTest</span><span class="op" id="7816510">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7816514">name</span><span class="op" id="7816518">:</span>&nbsp;<span class="string" id="7816520">&#34;FallbackSCSV&#34;</span><span class="op" id="7816534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7816538">//&nbsp;OpenSSL&nbsp;1.0.1j&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;-fallback_scsv&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7816599">command</span><span class="op" id="7816606">:</span>&nbsp;<span class="op" id="7816608">[</span><span class="op" id="7816609">]</span><span class="builtintype" id="7816610">string</span><span class="op" id="7816616">{</span><span class="string" id="7816617">&#34;openssl&#34;</span><span class="op" id="7816626">,</span>&nbsp;<span class="string" id="7816628">&#34;s_client&#34;</span><span class="op" id="7816638">,</span>&nbsp;<span class="string" id="7816640">&#34;-fallback_scsv&#34;</span><span class="op" id="7816656">}</span><span class="op" id="7816657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7816661">expectHandshakeErrorIncluding</span><span class="op" id="7816690">:</span>&nbsp;<span class="string" id="7816692">&#34;inppropriate&nbsp;protocol&nbsp;fallback&#34;</span><span class="op" id="7816724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7816727">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7816730">runServerTestTLS11</span><span class="op" id="7816748">(</span><span class="ident" id="7816749">t</span><span class="op" id="7816750">,</span>&nbsp;<span class="ident" id="7816752">test</span><span class="op" id="7816756">)</span><br>
<span class="lineno"></span><span class="op" id="7816758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7816761">//&nbsp;cert.pem&nbsp;and&nbsp;key.pem&nbsp;were&nbsp;generated&nbsp;with&nbsp;generate_cert.go</span><br>
<span class="lineno"></span><span class="comment" id="7816822">//&nbsp;Thus,&nbsp;they&nbsp;have&nbsp;no&nbsp;ExtKeyUsage&nbsp;fields&nbsp;and&nbsp;trigger&nbsp;an&nbsp;error</span><br>
<span class="lineno">730</span><span class="comment" id="7816884">//&nbsp;when&nbsp;verification&nbsp;is&nbsp;turned&nbsp;on.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7816920">const</span>&nbsp;<span class="ident" id="7816926">clientCertificatePEM</span>&nbsp;<span class="op" id="7816947">=</span>&nbsp;<span class="string" id="7816949">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB7TCCAVigAwIBAgIBADALBgkqhkiG9w0BAQUwJjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno">735</span>bzESMBAGA1UEAxMJMTI3LjAuMC4xMB4XDTExMTIwODA3NTUxMloXDTEyMTIwNzA4<br>
<span class="lineno"></span>MDAxMlowJjEQMA4GA1UEChMHQWNtZSBDbzESMBAGA1UEAxMJMTI3LjAuMC4xMIGc<br>
<span class="lineno"></span>MAsGCSqGSIb3DQEBAQOBjAAwgYgCgYBO0Hsx44Jk2VnAwoekXh6LczPHY1PfZpIG<br>
<span class="lineno"></span>hPZk1Y/kNqcdK+izIDZFI7Xjla7t4PUgnI2V339aEu+H5Fto5OkOdOwEin/ekyfE<br>
<span class="lineno"></span>ARl6vfLcPRSr0FTKIQzQTW6HLlzF0rtNS0/Otiz3fojsfNcCkXSmHgwa2uNKWi7e<br>
<span class="lineno">740</span>E5xMQIhZkwIDAQABozIwMDAOBgNVHQ8BAf8EBAMCAKAwDQYDVR0OBAYEBAECAwQw<br>
<span class="lineno"></span>DwYDVR0jBAgwBoAEAQIDBDALBgkqhkiG9w0BAQUDgYEANh+zegx1yW43RmEr1b3A<br>
<span class="lineno"></span>p0vMRpqBWHyFeSnIyMZn3TJWRSt1tukkqVCavh9a+hoV2cxVlXIWg7nCto/9iIw4<br>
<span class="lineno"></span>hB2rXZIxE0/9gzvGnfERYraL7KtnvshksBFQRlgXa5kc0x38BvEO5ZaoDPl4ILdE<br>
<span class="lineno"></span>GFGNEH5PlGffo05wc46QkYU=<br>
<span class="lineno">745</span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7817682">const</span>&nbsp;<span class="ident" id="7817688">clientKeyPEM</span>&nbsp;<span class="op" id="7817701">=</span>&nbsp;<span class="string" id="7817703">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIICWgIBAAKBgE7QezHjgmTZWcDCh6ReHotzM8djU99mkgaE9mTVj+Q2px0r6LMg<br>
<span class="lineno">750</span>NkUjteOVru3g9SCcjZXff1oS74fkW2jk6Q507ASKf96TJ8QBGXq98tw9FKvQVMoh<br>
<span class="lineno"></span>DNBNbocuXMXSu01LT862LPd+iOx81wKRdKYeDBra40paLt4TnExAiFmTAgMBAAEC<br>
<span class="lineno"></span>gYBxvXd8yNteFTns8A/2yomEMC4yeosJJSpp1CsN3BJ7g8/qTnrVPxBy+RU+qr63<br>
<span class="lineno"></span>t2WquaOu/cr5P8iEsa6lk20tf8pjKLNXeX0b1RTzK8rJLbS7nGzP3tvOhL096VtQ<br>
<span class="lineno"></span>dAo4ROEaro0TzYpHmpciSvxVIeEIAAdFDObDJPKqcJAxyQJBAJizfYgK8Gzx9fsx<br>
<span class="lineno">755</span>hxp+VteCbVPg2euASH5Yv3K5LukRdKoSzHE2grUVQgN/LafC0eZibRanxHegYSr7<br>
<span class="lineno"></span>7qaswKUCQQCEIWor/X4XTMdVj3Oj+vpiw75y/S9gh682+myZL+d/02IEkwnB098P<br>
<span class="lineno"></span>RkKVpenBHyrGg0oeN5La7URILWKj7CPXAkBKo6F+d+phNjwIFoN1Xb/RA32w/D1I<br>
<span class="lineno"></span>saG9sF+UEhRt9AxUfW/U/tIQ9V0ZHHcSg1XaCM5Nvp934brdKdvTOKnJAkBD5h/3<br>
<span class="lineno"></span>Rybatlvg/fzBEaJFyq09zhngkxlZOUtBVTqzl17RVvY2orgH02U4HbCHy4phxOn7<br>
<span class="lineno">760</span>qTdQRYlHRftgnWK1AkANibn9PRYJ7mJyJ9Dyj2QeNcSkSTzrt0tPvUMf4+meJymN<br>
<span class="lineno"></span>1Ntu5+S1DLLzfxlaljWG6ylW6DNxujCyuXIV2rvA<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7818590">const</span>&nbsp;<span class="ident" id="7818596">clientECDSACertificatePEM</span>&nbsp;<span class="op" id="7818622">=</span>&nbsp;<span class="string" id="7818624">`<br>
<span class="lineno">765</span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/DCCAV4CCQCaMIRsJjXZFzAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTMyNTUzWhcNMjIxMTEyMTMyNTUzWjBBMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTEMMAoGA1UECBMDTlNXMRAwDgYDVQQHEwdQeXJtb250MRIwEAYDVQQDEwlK<br>
<span class="lineno">770</span>b2VsIFNpbmcwgZswEAYHKoZIzj0CAQYFK4EEACMDgYYABACVjJF1FMBexFe01MNv<br>
<span class="lineno"></span>ja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd3kfDdq0Z9kUs<br>
<span class="lineno"></span>jLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx+U56jb0JuK7q<br>
<span class="lineno"></span>ixgnTy5w/hOWusPTQBbNZU6sER7m8TAJBgcqhkjOPQQBA4GMADCBiAJCAOAUxGBg<br>
<span class="lineno"></span>C3JosDJdYUoCdFzCgbkWqD8pyDbHgf9stlvZcPE4O1BIKJTLCRpS8V3ujfK58PDa<br>
<span class="lineno">775</span>2RU6+b0DeoeiIzXsAkIBo9SKeDUcSpoj0gq+KxAxnZxfvuiRs9oa9V2jI/Umi0Vw<br>
<span class="lineno"></span>jWVim34BmT0Y9hCaOGGbLlfk+syxis7iI6CH8OFnUes=<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7819377">const</span>&nbsp;<span class="ident" id="7819383">clientECDSAKeyPEM</span>&nbsp;<span class="op" id="7819401">=</span>&nbsp;<span class="string" id="7819403">`<br>
<span class="lineno">780</span>-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBkJN9X4IqZIguiEVKMqeBUP5xtRsEv4HJEtOpOGLELwO53SD78Ew8<br>
<span class="lineno">785</span>k+wLWoqizS3NpQyMtrU8JFdWfj+C57UNkOugBwYFK4EEACOhgYkDgYYABACVjJF1<br>
<span class="lineno"></span>FMBexFe01MNvja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd<br>
<span class="lineno"></span>3kfDdq0Z9kUsjLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx<br>
<span class="lineno"></span>+U56jb0JuK7qixgnTy5w/hOWusPTQBbNZU6sER7m8Q==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno">790</span><br>
<span class="lineno"></span><span class="keyword" id="7819843">func</span>&nbsp;<span class="ident" id="7819848">TestClientAuth</span><span class="op" id="7819862">(</span><span class="ident" id="7819863">t</span>&nbsp;<span class="op" id="7819865">*</span><span class="ident" id="7819866">testing</span><span class="op" id="7819873">.</span><span class="ident" id="7819874">T</span><span class="op" id="7819875">)</span>&nbsp;<span class="op" id="7819877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7819880">var</span>&nbsp;<span class="ident" id="7819884">certPath</span><span class="op" id="7819892">,</span>&nbsp;<span class="ident" id="7819894">keyPath</span><span class="op" id="7819901">,</span>&nbsp;<span class="ident" id="7819903">ecdsaCertPath</span><span class="op" id="7819916">,</span>&nbsp;<span class="ident" id="7819918">ecdsaKeyPath</span>&nbsp;<span class="builtintype" id="7819931">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7819940">if</span>&nbsp;<span class="op" id="7819943">*</span><span class="ident" id="7819944">update</span>&nbsp;<span class="op" id="7819951">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7819955">certPath</span>&nbsp;<span class="op" id="7819964">=</span>&nbsp;<span class="ident" id="7819966">tempFile</span><span class="op" id="7819974">(</span><span class="ident" id="7819975">clientCertificatePEM</span><span class="op" id="7819995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7819999">defer</span>&nbsp;<span class="ident" id="7820005">os</span><span class="op" id="7820007">.</span><span class="ident" id="7820008">Remove</span><span class="op" id="7820014">(</span><span class="ident" id="7820015">certPath</span><span class="op" id="7820023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820027">keyPath</span>&nbsp;<span class="op" id="7820035">=</span>&nbsp;<span class="ident" id="7820037">tempFile</span><span class="op" id="7820045">(</span><span class="ident" id="7820046">clientKeyPEM</span><span class="op" id="7820058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7820062">defer</span>&nbsp;<span class="ident" id="7820068">os</span><span class="op" id="7820070">.</span><span class="ident" id="7820071">Remove</span><span class="op" id="7820077">(</span><span class="ident" id="7820078">keyPath</span><span class="op" id="7820085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820089">ecdsaCertPath</span>&nbsp;<span class="op" id="7820103">=</span>&nbsp;<span class="ident" id="7820105">tempFile</span><span class="op" id="7820113">(</span><span class="ident" id="7820114">clientECDSACertificatePEM</span><span class="op" id="7820139">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7820143">defer</span>&nbsp;<span class="ident" id="7820149">os</span><span class="op" id="7820151">.</span><span class="ident" id="7820152">Remove</span><span class="op" id="7820158">(</span><span class="ident" id="7820159">ecdsaCertPath</span><span class="op" id="7820172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820176">ecdsaKeyPath</span>&nbsp;<span class="op" id="7820189">=</span>&nbsp;<span class="ident" id="7820191">tempFile</span><span class="op" id="7820199">(</span><span class="ident" id="7820200">clientECDSAKeyPEM</span><span class="op" id="7820217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7820221">defer</span>&nbsp;<span class="ident" id="7820227">os</span><span class="op" id="7820229">.</span><span class="ident" id="7820230">Remove</span><span class="op" id="7820236">(</span><span class="ident" id="7820237">ecdsaKeyPath</span><span class="op" id="7820249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7820252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820256">config</span>&nbsp;<span class="op" id="7820263">:=</span>&nbsp;<span class="op" id="7820266">*</span><span class="ident" id="7820267">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820279">config</span><span class="op" id="7820285">.</span><span class="ident" id="7820286">ClientAuth</span>&nbsp;<span class="op" id="7820297">=</span>&nbsp;<span class="ident" id="7820299">RequestClientCert</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820319">test</span>&nbsp;<span class="op" id="7820324">:=</span>&nbsp;<span class="op" id="7820327">&amp;</span><span class="ident" id="7820328">serverTest</span><span class="op" id="7820338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820342">name</span><span class="op" id="7820346">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7820351">&#34;ClientAuthRequestedNotGiven&#34;</span><span class="op" id="7820380">,</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820384">command</span><span class="op" id="7820391">:</span>&nbsp;<span class="op" id="7820393">[</span><span class="op" id="7820394">]</span><span class="builtintype" id="7820395">string</span><span class="op" id="7820401">{</span><span class="string" id="7820402">&#34;openssl&#34;</span><span class="op" id="7820411">,</span>&nbsp;<span class="string" id="7820413">&#34;s_client&#34;</span><span class="op" id="7820423">,</span>&nbsp;<span class="string" id="7820425">&#34;-no_ticket&#34;</span><span class="op" id="7820437">,</span>&nbsp;<span class="string" id="7820439">&#34;-cipher&#34;</span><span class="op" id="7820448">,</span>&nbsp;<span class="string" id="7820450">&#34;RC4-SHA&#34;</span><span class="op" id="7820459">}</span><span class="op" id="7820460">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820464">config</span><span class="op" id="7820470">:</span>&nbsp;&nbsp;<span class="op" id="7820473">&amp;</span><span class="ident" id="7820474">config</span><span class="op" id="7820480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7820483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820486">runServerTestTLS12</span><span class="op" id="7820504">(</span><span class="ident" id="7820505">t</span><span class="op" id="7820506">,</span>&nbsp;<span class="ident" id="7820508">test</span><span class="op" id="7820512">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820516">test</span>&nbsp;<span class="op" id="7820521">=</span>&nbsp;<span class="op" id="7820523">&amp;</span><span class="ident" id="7820524">serverTest</span><span class="op" id="7820534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820538">name</span><span class="op" id="7820542">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7820557">&#34;ClientAuthRequestedAndGiven&#34;</span><span class="op" id="7820586">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820590">command</span><span class="op" id="7820597">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7820609">[</span><span class="op" id="7820610">]</span><span class="builtintype" id="7820611">string</span><span class="op" id="7820617">{</span><span class="string" id="7820618">&#34;openssl&#34;</span><span class="op" id="7820627">,</span>&nbsp;<span class="string" id="7820629">&#34;s_client&#34;</span><span class="op" id="7820639">,</span>&nbsp;<span class="string" id="7820641">&#34;-no_ticket&#34;</span><span class="op" id="7820653">,</span>&nbsp;<span class="string" id="7820655">&#34;-cipher&#34;</span><span class="op" id="7820664">,</span>&nbsp;<span class="string" id="7820666">&#34;RC4-SHA&#34;</span><span class="op" id="7820675">,</span>&nbsp;<span class="string" id="7820677">&#34;-cert&#34;</span><span class="op" id="7820684">,</span>&nbsp;<span class="ident" id="7820686">certPath</span><span class="op" id="7820694">,</span>&nbsp;<span class="string" id="7820696">&#34;-key&#34;</span><span class="op" id="7820702">,</span>&nbsp;<span class="ident" id="7820704">keyPath</span><span class="op" id="7820711">}</span><span class="op" id="7820712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820716">config</span><span class="op" id="7820722">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7820735">&amp;</span><span class="ident" id="7820736">config</span><span class="op" id="7820742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820746">expectedPeerCerts</span><span class="op" id="7820763">:</span>&nbsp;<span class="op" id="7820765">[</span><span class="op" id="7820766">]</span><span class="builtintype" id="7820767">string</span><span class="op" id="7820773">{</span><span class="ident" id="7820774">clientCertificatePEM</span><span class="op" id="7820794">}</span><span class="op" id="7820795">,</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7820798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820801">runServerTestTLS12</span><span class="op" id="7820819">(</span><span class="ident" id="7820820">t</span><span class="op" id="7820821">,</span>&nbsp;<span class="ident" id="7820823">test</span><span class="op" id="7820827">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820831">test</span>&nbsp;<span class="op" id="7820836">=</span>&nbsp;<span class="op" id="7820838">&amp;</span><span class="ident" id="7820839">serverTest</span><span class="op" id="7820849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820853">name</span><span class="op" id="7820857">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7820872">&#34;ClientAuthRequestedAndECDSAGiven&#34;</span><span class="op" id="7820906">,</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7820910">command</span><span class="op" id="7820917">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7820929">[</span><span class="op" id="7820930">]</span><span class="builtintype" id="7820931">string</span><span class="op" id="7820937">{</span><span class="string" id="7820938">&#34;openssl&#34;</span><span class="op" id="7820947">,</span>&nbsp;<span class="string" id="7820949">&#34;s_client&#34;</span><span class="op" id="7820959">,</span>&nbsp;<span class="string" id="7820961">&#34;-no_ticket&#34;</span><span class="op" id="7820973">,</span>&nbsp;<span class="string" id="7820975">&#34;-cipher&#34;</span><span class="op" id="7820984">,</span>&nbsp;<span class="string" id="7820986">&#34;RC4-SHA&#34;</span><span class="op" id="7820995">,</span>&nbsp;<span class="string" id="7820997">&#34;-cert&#34;</span><span class="op" id="7821004">,</span>&nbsp;<span class="ident" id="7821006">ecdsaCertPath</span><span class="op" id="7821019">,</span>&nbsp;<span class="string" id="7821021">&#34;-key&#34;</span><span class="op" id="7821027">,</span>&nbsp;<span class="ident" id="7821029">ecdsaKeyPath</span><span class="op" id="7821041">}</span><span class="op" id="7821042">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7821046">config</span><span class="op" id="7821052">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7821065">&amp;</span><span class="ident" id="7821066">config</span><span class="op" id="7821072">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7821076">expectedPeerCerts</span><span class="op" id="7821093">:</span>&nbsp;<span class="op" id="7821095">[</span><span class="op" id="7821096">]</span><span class="builtintype" id="7821097">string</span><span class="op" id="7821103">{</span><span class="ident" id="7821104">clientECDSACertificatePEM</span><span class="op" id="7821129">}</span><span class="op" id="7821130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7821133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7821136">runServerTestTLS12</span><span class="op" id="7821154">(</span><span class="ident" id="7821155">t</span><span class="op" id="7821156">,</span>&nbsp;<span class="ident" id="7821158">test</span><span class="op" id="7821162">)</span><br>
<span class="lineno">830</span><span class="op" id="7821164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7821167">func</span>&nbsp;<span class="ident" id="7821172">bigFromString</span><span class="op" id="7821185">(</span><span class="ident" id="7821186">s</span>&nbsp;<span class="builtintype" id="7821188">string</span><span class="op" id="7821194">)</span>&nbsp;<span class="op" id="7821196">*</span><span class="ident" id="7821197">big</span><span class="op" id="7821200">.</span><span class="ident" id="7821201">Int</span>&nbsp;<span class="op" id="7821205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7821208">ret</span>&nbsp;<span class="op" id="7821212">:=</span>&nbsp;<span class="builtinfunc" id="7821215">new</span><span class="op" id="7821218">(</span><span class="ident" id="7821219">big</span><span class="op" id="7821222">.</span><span class="ident" id="7821223">Int</span><span class="op" id="7821226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7821229">ret</span><span class="op" id="7821232">.</span><span class="ident" id="7821233">SetString</span><span class="op" id="7821242">(</span><span class="ident" id="7821243">s</span><span class="op" id="7821244">,</span>&nbsp;<span class="num" id="7821246">10</span><span class="op" id="7821248">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7821251">return</span>&nbsp;<span class="ident" id="7821258">ret</span><br>
<span class="lineno"></span><span class="op" id="7821262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7821265">func</span>&nbsp;<span class="ident" id="7821270">fromHex</span><span class="op" id="7821277">(</span><span class="ident" id="7821278">s</span>&nbsp;<span class="builtintype" id="7821280">string</span><span class="op" id="7821286">)</span>&nbsp;<span class="op" id="7821288">[</span><span class="op" id="7821289">]</span><span class="builtintype" id="7821290">byte</span>&nbsp;<span class="op" id="7821295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7821298">b</span><span class="op" id="7821299">,</span>&nbsp;<span class="ident" id="7821301">_</span>&nbsp;<span class="op" id="7821303">:=</span>&nbsp;<span class="ident" id="7821306">hex</span><span class="op" id="7821309">.</span><span class="ident" id="7821310">DecodeString</span><span class="op" id="7821322">(</span><span class="ident" id="7821323">s</span><span class="op" id="7821324">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7821327">return</span>&nbsp;<span class="ident" id="7821334">b</span><br>
<span class="lineno"></span><span class="op" id="7821336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7821339">var</span>&nbsp;<span class="ident" id="7821343">testRSACertificate</span>&nbsp;<span class="op" id="7821362">=</span>&nbsp;<span class="ident" id="7821364">fromHex</span><span class="op" id="7821371">(</span><span class="string" id="7821372">&#34;308202b030820219a00302010202090085b0bba48a7fb8ca300d06092a864886f70d01010505003045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3130303432343039303933385a170d3131303432343039303933385a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819f300d06092a864886f70d010101050003818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a381a73081a4301d0603551d0e04160414b1ade2855acfcb28db69ce2369ded3268e18883930750603551d23046e306c8014b1ade2855acfcb28db69ce2369ded3268e188839a149a4473045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746482090085b0bba48a7fb8ca300c0603551d13040530030101ff300d06092a864886f70d010105050003818100086c4524c76bb159ab0c52ccf2b014d7879d7a6475b55a9566e4c52b8eae12661feb4f38b36e60d392fdf74108b52513b1187a24fb301dbaed98b917ece7d73159db95d31d78ea50565cd5825a2d5a5f33c4b6d8c97590968c0f5298b5cd981f89205ff2a01ca31b9694dda9fd57e970e8266d71999b266e3850296c90a7bdd9&#34;</span><span class="op" id="7822758">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span><span class="keyword" id="7822761">var</span>&nbsp;<span class="ident" id="7822765">testECDSACertificate</span>&nbsp;<span class="op" id="7822786">=</span>&nbsp;<span class="ident" id="7822788">fromHex</span><span class="op" id="7822795">(</span><span class="string" id="7822796">&#34;3082020030820162020900b8bf2d47a0d2ebf4300906072a8648ce3d04013045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3132313132323135303633325a170d3232313132303135303633325a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819b301006072a8648ce3d020106052b81040023038186000400c4a1edbe98f90b4873367ec316561122f23d53c33b4d213dcd6b75e6f6b0dc9adf26c1bcb287f072327cb3642f1c90bcea6823107efee325c0483a69e0286dd33700ef0462dd0da09c706283d881d36431aa9e9731bd96b068c09b23de76643f1a5c7fe9120e5858b65f70dd9bd8ead5d7f5d5ccb9b69f30665b669a20e227e5bffe3b300906072a8648ce3d040103818c0030818802420188a24febe245c5487d1bacf5ed989dae4770c05e1bb62fbdf1b64db76140d311a2ceee0b7e927eff769dc33b7ea53fcefa10e259ec472d7cacda4e970e15a06fd00242014dfcbe67139c2d050ebd3fa38c25c13313830d9406bbd4377af6ec7ac9862eddd711697f857c56defb31782be4c7780daecbbe9e4e3624317b6a0f399512078f2a&#34;</span><span class="op" id="7823830">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7823833">var</span>&nbsp;<span class="ident" id="7823837">testSNICertificate</span>&nbsp;<span class="op" id="7823856">=</span>&nbsp;<span class="ident" id="7823858">fromHex</span><span class="op" id="7823865">(</span><span class="string" id="7823866">&#34;308201f23082015da003020102020100300b06092a864886f70d01010530283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d301e170d3132303431313137343033355a170d3133303431313137343533355a30283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d30819d300b06092a864886f70d01010103818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a3323030300e0603551d0f0101ff0404030200a0300d0603551d0e0406040401020304300f0603551d2304083006800401020304300b06092a864886f70d0101050381810089c6455f1c1f5ef8eb1ab174ee2439059f5c4259bb1a8d86cdb1d056f56a717da40e95ab90f59e8deaf627c157995094db0802266eb34fc6842dea8a4b68d9c1389103ab84fb9e1f85d9b5d23ff2312c8670fbb540148245a4ebafe264d90c8a4cf4f85b0fac12ac2fc4a3154bad52462868af96c62c6525d652b6e31845bdcc&#34;</span><span class="op" id="7824872">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7824875">var</span>&nbsp;<span class="ident" id="7824879">testRSAPrivateKey</span>&nbsp;<span class="op" id="7824897">=</span>&nbsp;<span class="op" id="7824899">&amp;</span><span class="ident" id="7824900">rsa</span><span class="op" id="7824903">.</span><span class="ident" id="7824904">PrivateKey</span><span class="op" id="7824914">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7824917">PublicKey</span><span class="op" id="7824926">:</span>&nbsp;<span class="ident" id="7824928">rsa</span><span class="op" id="7824931">.</span><span class="ident" id="7824932">PublicKey</span><span class="op" id="7824941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7824945">N</span><span class="op" id="7824946">:</span>&nbsp;<span class="ident" id="7824948">bigFromString</span><span class="op" id="7824961">(</span><span class="string" id="7824962">&#34;131650079503776001033793877885499001334664249354723305978524647182322416328664556247316495448366990052837680518067798333412266673813370895702118944398081598789828837447552603077848001020611640547221687072142537202428102790818451901395596882588063427854225330436740647715202971973145151161964464812406232198521&#34;</span><span class="op" id="7825273">)</span><span class="op" id="7825274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7825278">E</span><span class="op" id="7825279">:</span>&nbsp;<span class="num" id="7825281">65537</span><span class="op" id="7825286">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7825289">}</span><span class="op" id="7825290">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7825293">D</span><span class="op" id="7825294">:</span>&nbsp;<span class="ident" id="7825296">bigFromString</span><span class="op" id="7825309">(</span><span class="string" id="7825310">&#34;29354450337804273969007277378287027274721892607543397931919078829901848876371746653677097639302788129485893852488285045793268732234230875671682624082413996177431586734171663258657462237320300610850244186316880055243099640544518318093544057213190320837094958164973959123058337475052510833916491060913053867729&#34;</span><span class="op" id="7825620">)</span><span class="op" id="7825621">,</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7825624">Primes</span><span class="op" id="7825630">:</span>&nbsp;<span class="op" id="7825632">[</span><span class="op" id="7825633">]</span><span class="op" id="7825634">*</span><span class="ident" id="7825635">big</span><span class="op" id="7825638">.</span><span class="ident" id="7825639">Int</span><span class="op" id="7825642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7825646">bigFromString</span><span class="op" id="7825659">(</span><span class="string" id="7825660">&#34;11969277782311800166562047708379380720136961987713178380670422671426759650127150688426177829077494755200794297055316163155755835813760102405344560929062149&#34;</span><span class="op" id="7825817">)</span><span class="op" id="7825818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7825822">bigFromString</span><span class="op" id="7825835">(</span><span class="string" id="7825836">&#34;10998999429884441391899182616418192492905073053684657075974935218461686523870125521822756579792315215543092255516093840728890783887287417039645833477273829&#34;</span><span class="op" id="7825993">)</span><span class="op" id="7825994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7825997">}</span><span class="op" id="7825998">,</span><br>
<span class="lineno"></span><span class="op" id="7826000">}</span><br>
<span class="lineno">860</span><br>
<span class="lineno"></span><span class="keyword" id="7826003">var</span>&nbsp;<span class="ident" id="7826007">testECDSAPrivateKey</span>&nbsp;<span class="op" id="7826027">=</span>&nbsp;<span class="op" id="7826029">&amp;</span><span class="ident" id="7826030">ecdsa</span><span class="op" id="7826035">.</span><span class="ident" id="7826036">PrivateKey</span><span class="op" id="7826046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7826049">PublicKey</span><span class="op" id="7826058">:</span>&nbsp;<span class="ident" id="7826060">ecdsa</span><span class="op" id="7826065">.</span><span class="ident" id="7826066">PublicKey</span><span class="op" id="7826075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7826079">Curve</span><span class="op" id="7826084">:</span>&nbsp;<span class="ident" id="7826086">elliptic</span><span class="op" id="7826094">.</span><span class="ident" id="7826095">P521</span><span class="op" id="7826099">(</span><span class="op" id="7826100">)</span><span class="op" id="7826101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7826105">X</span><span class="op" id="7826106">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7826112">bigFromString</span><span class="op" id="7826125">(</span><span class="string" id="7826126">&#34;2636411247892461147287360222306590634450676461695221912739908880441342231985950069527906976759812296359387337367668045707086543273113073382714101597903639351&#34;</span><span class="op" id="7826285">)</span><span class="op" id="7826286">,</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7826290">Y</span><span class="op" id="7826291">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7826297">bigFromString</span><span class="op" id="7826310">(</span><span class="string" id="7826311">&#34;3204695818431246682253994090650952614555094516658732116404513121125038617915183037601737180082382202488628239201196033284060130040574800684774115478859677243&#34;</span><span class="op" id="7826470">)</span><span class="op" id="7826471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7826474">}</span><span class="op" id="7826475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7826478">D</span><span class="op" id="7826479">:</span>&nbsp;<span class="ident" id="7826481">bigFromString</span><span class="op" id="7826494">(</span><span class="string" id="7826495">&#34;5477294338614160138026852784385529180817726002953041720191098180813046231640184669647735805135001309477695746518160084669446643325196003346204701381388769751&#34;</span><span class="op" id="7826654">)</span><span class="op" id="7826655">,</span><br>
<span class="lineno"></span><span class="op" id="7826657">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
