<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/link8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/link8/func.go.html">func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/layout.go.html">layout.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/link.go.html">link.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/linker.go.html">linker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/package.go.html">package.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/pkg_sym.go.html">pkg_sym.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/symbol.go.html">symbol.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/trace_used.go.html">trace_used.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/var.go.html">var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="4813951">package</span>&nbsp;<span class="ident" id="4813959">link8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4813966">import</span>&nbsp;<span class="op" id="4813973">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4813976">&#34;fmt&#34;</span><br>
<span class="lineno">5</span><span class="op" id="4813982">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4813985">//&nbsp;LinkMain&nbsp;produces&nbsp;a&nbsp;image&nbsp;for&nbsp;a&nbsp;main()&nbsp;in&nbsp;a&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="4814041">func</span>&nbsp;<span class="ident" id="4814046">LinkMain</span><span class="op" id="4814054">(</span><span class="ident" id="4814055">main</span>&nbsp;<span class="op" id="4814060">*</span><span class="ident" id="4814061">Package</span><span class="op" id="4814068">)</span>&nbsp;<span class="op" id="4814070">(</span><span class="op" id="4814071">[</span><span class="op" id="4814072">]</span><span class="builtintype" id="4814073">byte</span><span class="op" id="4814077">,</span>&nbsp;<span class="builtintype" id="4814079">error</span><span class="op" id="4814084">)</span>&nbsp;<span class="op" id="4814086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814089">lnk</span>&nbsp;<span class="op" id="4814093">:=</span>&nbsp;<span class="ident" id="4814096">NewLinker</span><span class="op" id="4814105">(</span><span class="op" id="4814106">)</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814109">lnk</span><span class="op" id="4814112">.</span><span class="ident" id="4814113">AddPkgs</span><span class="op" id="4814120">(</span><span class="ident" id="4814121">main</span><span class="op" id="4814125">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814129">funcMain</span><span class="op" id="4814137">,</span>&nbsp;<span class="ident" id="4814139">index</span>&nbsp;<span class="op" id="4814145">:=</span>&nbsp;<span class="ident" id="4814148">main</span><span class="op" id="4814152">.</span><span class="ident" id="4814153">Query</span><span class="op" id="4814158">(</span><span class="string" id="4814159">&#34;main&#34;</span><span class="op" id="4814165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814168">if</span>&nbsp;<span class="ident" id="4814171">funcMain</span>&nbsp;<span class="op" id="4814180">==</span>&nbsp;<span class="ident" id="4814183">nil</span>&nbsp;<span class="op" id="4814187">||</span>&nbsp;<span class="ident" id="4814190">funcMain</span><span class="op" id="4814198">.</span><span class="ident" id="4814199">Type</span>&nbsp;<span class="op" id="4814204">!=</span>&nbsp;<span class="ident" id="4814207">SymFunc</span>&nbsp;<span class="op" id="4814215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814219">return</span>&nbsp;<span class="ident" id="4814226">nil</span><span class="op" id="4814229">,</span>&nbsp;<span class="ident" id="4814231">fmt</span><span class="op" id="4814234">.</span><span class="ident" id="4814235">Errorf</span><span class="op" id="4814241">(</span><span class="string" id="4814242">&#34;main&nbsp;function&nbsp;missing&#34;</span><span class="op" id="4814265">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4814268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814272">used</span>&nbsp;<span class="op" id="4814277">:=</span>&nbsp;<span class="ident" id="4814280">traceUsed</span><span class="op" id="4814289">(</span><span class="ident" id="4814290">lnk</span><span class="op" id="4814293">,</span>&nbsp;<span class="ident" id="4814295">main</span><span class="op" id="4814299">,</span>&nbsp;<span class="ident" id="4814301">index</span><span class="op" id="4814306">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814310">funcs</span><span class="op" id="4814315">,</span>&nbsp;<span class="ident" id="4814317">vars</span><span class="op" id="4814321">,</span>&nbsp;<span class="ident" id="4814323">e</span>&nbsp;<span class="op" id="4814325">:=</span>&nbsp;<span class="ident" id="4814328">layout</span><span class="op" id="4814334">(</span><span class="ident" id="4814335">used</span><span class="op" id="4814339">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814342">if</span>&nbsp;<span class="ident" id="4814345">e</span>&nbsp;<span class="op" id="4814347">!=</span>&nbsp;<span class="ident" id="4814350">nil</span>&nbsp;<span class="op" id="4814354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814358">return</span>&nbsp;<span class="ident" id="4814365">nil</span><span class="op" id="4814368">,</span>&nbsp;<span class="ident" id="4814370">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4814373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814377">w</span>&nbsp;<span class="op" id="4814379">:=</span>&nbsp;<span class="ident" id="4814382">newWriter</span><span class="op" id="4814391">(</span><span class="op" id="4814392">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814395">for</span>&nbsp;<span class="ident" id="4814399">_</span><span class="op" id="4814400">,</span>&nbsp;<span class="ident" id="4814402">f</span>&nbsp;<span class="op" id="4814404">:=</span>&nbsp;<span class="keyword" id="4814407">range</span>&nbsp;<span class="ident" id="4814413">funcs</span>&nbsp;<span class="op" id="4814419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814423">writeFunc</span><span class="op" id="4814432">(</span><span class="ident" id="4814433">w</span><span class="op" id="4814434">,</span>&nbsp;<span class="ident" id="4814436">f</span><span class="op" id="4814437">.</span><span class="ident" id="4814438">pkg</span><span class="op" id="4814441">,</span>&nbsp;<span class="ident" id="4814443">f</span><span class="op" id="4814444">.</span><span class="ident" id="4814445">Func</span><span class="op" id="4814449">(</span><span class="op" id="4814450">)</span><span class="op" id="4814451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4814454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814458">for</span>&nbsp;<span class="ident" id="4814462">_</span><span class="op" id="4814463">,</span>&nbsp;<span class="ident" id="4814465">v</span>&nbsp;<span class="op" id="4814467">:=</span>&nbsp;<span class="keyword" id="4814470">range</span>&nbsp;<span class="ident" id="4814476">vars</span>&nbsp;<span class="op" id="4814481">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814485">writeVar</span><span class="op" id="4814493">(</span><span class="ident" id="4814494">w</span><span class="op" id="4814495">,</span>&nbsp;<span class="ident" id="4814497">v</span><span class="op" id="4814498">.</span><span class="ident" id="4814499">Var</span><span class="op" id="4814502">(</span><span class="op" id="4814503">)</span><span class="op" id="4814504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4814507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814511">return</span>&nbsp;<span class="ident" id="4814518">w</span><span class="op" id="4814519">.</span><span class="ident" id="4814520">bytes</span><span class="op" id="4814525">(</span><span class="op" id="4814526">)</span><span class="op" id="4814527">,</span>&nbsp;<span class="ident" id="4814529">nil</span><br>
<span class="lineno"></span><span class="op" id="4814533">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="4814536">//&nbsp;LinkBareFunc&nbsp;produces&nbsp;a&nbsp;image&nbsp;of&nbsp;a&nbsp;single&nbsp;function&nbsp;that&nbsp;has&nbsp;no&nbsp;links.</span><br>
<span class="lineno"></span><span class="keyword" id="4814609">func</span>&nbsp;<span class="ident" id="4814614">LinkBareFunc</span><span class="op" id="4814626">(</span><span class="ident" id="4814627">f</span>&nbsp;<span class="op" id="4814629">*</span><span class="ident" id="4814630">Func</span><span class="op" id="4814634">)</span>&nbsp;<span class="op" id="4814636">(</span><span class="op" id="4814637">[</span><span class="op" id="4814638">]</span><span class="builtintype" id="4814639">byte</span><span class="op" id="4814643">,</span>&nbsp;<span class="builtintype" id="4814645">error</span><span class="op" id="4814650">)</span>&nbsp;<span class="op" id="4814652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814655">if</span>&nbsp;<span class="ident" id="4814658">f</span><span class="op" id="4814659">.</span><span class="ident" id="4814660">TooLarge</span><span class="op" id="4814668">(</span><span class="op" id="4814669">)</span>&nbsp;<span class="op" id="4814671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814675">return</span>&nbsp;<span class="ident" id="4814682">nil</span><span class="op" id="4814685">,</span>&nbsp;<span class="ident" id="4814687">fmt</span><span class="op" id="4814690">.</span><span class="ident" id="4814691">Errorf</span><span class="op" id="4814697">(</span><span class="string" id="4814698">&#34;code&nbsp;section&nbsp;too&nbsp;large&#34;</span><span class="op" id="4814722">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4814725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814729">w</span>&nbsp;<span class="op" id="4814731">:=</span>&nbsp;<span class="ident" id="4814734">newWriter</span><span class="op" id="4814743">(</span><span class="op" id="4814744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814747">w</span><span class="op" id="4814748">.</span><span class="ident" id="4814749">writeBareFunc</span><span class="op" id="4814762">(</span><span class="ident" id="4814763">f</span><span class="op" id="4814764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814767">return</span>&nbsp;<span class="ident" id="4814774">w</span><span class="op" id="4814775">.</span><span class="ident" id="4814776">bytes</span><span class="op" id="4814781">(</span><span class="op" id="4814782">)</span><span class="op" id="4814783">,</span>&nbsp;<span class="ident" id="4814785">nil</span><br>
<span class="lineno">45</span><span class="op" id="4814789">}</span>
</div>
</body>
</html>
