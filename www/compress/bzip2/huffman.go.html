<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5532567">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5532622">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5532676">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5532727">package</span>&nbsp;<span class="ident" id="5532735">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5532742">import</span>&nbsp;<span class="string" id="5532749">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5532757">//&nbsp;A&nbsp;huffmanTree&nbsp;is&nbsp;a&nbsp;binary&nbsp;tree&nbsp;which&nbsp;is&nbsp;navigated,&nbsp;bit-by-bit&nbsp;to&nbsp;reach&nbsp;a</span><br>
<span class="lineno">10</span><span class="comment" id="5532833">//&nbsp;symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="5532844">type</span>&nbsp;<span class="ident" id="5532849">huffmanTree</span>&nbsp;<span class="keyword" id="5532861">struct</span>&nbsp;<span class="op" id="5532868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5532871">//&nbsp;nodes&nbsp;contains&nbsp;all&nbsp;the&nbsp;non-leaf&nbsp;nodes&nbsp;in&nbsp;the&nbsp;tree.&nbsp;nodes[0]&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5532942">//&nbsp;root&nbsp;of&nbsp;the&nbsp;tree&nbsp;and&nbsp;nextNode&nbsp;contains&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5533015">//&nbsp;of&nbsp;nodes&nbsp;to&nbsp;use&nbsp;when&nbsp;the&nbsp;tree&nbsp;is&nbsp;being&nbsp;constructed.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533071">nodes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5533080">[</span><span class="op" id="5533081">]</span><span class="ident" id="5533082"><a href="/compress/bzip2/huffman.go.html#5533544">huffmanNode</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533095">nextNode</span>&nbsp;<span class="builtintype" id="5533104">int</span><br>
<span class="lineno"></span><span class="op" id="5533108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5533111">//&nbsp;A&nbsp;huffmanNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.&nbsp;left&nbsp;and&nbsp;right&nbsp;contain&nbsp;indexes&nbsp;into&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="5533191">//&nbsp;nodes&nbsp;slice&nbsp;of&nbsp;the&nbsp;tree.&nbsp;If&nbsp;left&nbsp;or&nbsp;right&nbsp;is&nbsp;invalidNodeValue&nbsp;then&nbsp;the&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="5533271">//&nbsp;is&nbsp;a&nbsp;left&nbsp;node&nbsp;and&nbsp;its&nbsp;value&nbsp;is&nbsp;in&nbsp;leftValue/rightValue.</span><br>
<span class="lineno"></span><span class="comment" id="5533331">//</span><br>
<span class="lineno"></span><span class="comment" id="5533334">//&nbsp;The&nbsp;symbols&nbsp;are&nbsp;uint16s&nbsp;because&nbsp;bzip2&nbsp;encodes&nbsp;not&nbsp;only&nbsp;MTF&nbsp;indexes&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5533411">//&nbsp;tree,&nbsp;but&nbsp;also&nbsp;two&nbsp;magic&nbsp;values&nbsp;for&nbsp;run-length&nbsp;encoding&nbsp;and&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno">25</span><span class="comment" id="5533489">//&nbsp;Thus&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;256&nbsp;possible&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="5533539">type</span>&nbsp;<span class="ident" id="5533544">huffmanNode</span>&nbsp;<span class="keyword" id="5533556">struct</span>&nbsp;<span class="op" id="5533563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533566">left</span><span class="op" id="5533570">,</span>&nbsp;<span class="ident" id="5533572">right</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5533588">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533596">leftValue</span><span class="op" id="5533605">,</span>&nbsp;<span class="ident" id="5533607">rightValue</span>&nbsp;<span class="builtintype" id="5533618">uint16</span><br>
<span class="lineno"></span><span class="op" id="5533625">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5533628">//&nbsp;invalidNodeValue&nbsp;is&nbsp;an&nbsp;invalid&nbsp;index&nbsp;which&nbsp;marks&nbsp;a&nbsp;leaf&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><span class="keyword" id="5533705">const</span>&nbsp;<span class="ident" id="5533711">invalidNodeValue</span>&nbsp;<span class="op" id="5533728">=</span>&nbsp;<span class="num" id="5533730">0xffff</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5533738">//&nbsp;Decode&nbsp;reads&nbsp;bits&nbsp;from&nbsp;the&nbsp;given&nbsp;bitReader&nbsp;and&nbsp;navigates&nbsp;the&nbsp;tree&nbsp;until&nbsp;a</span><br>
<span class="lineno">35</span><span class="comment" id="5533815">//&nbsp;symbol&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="5533835">func</span>&nbsp;<span class="op" id="5533840">(</span><span class="ident" id="5533841">t</span>&nbsp;<span class="op" id="5533843">*</span><span class="ident" id="5533844"><a href="/compress/bzip2/huffman.go.html#5532849">huffmanTree</a></span><span class="op" id="5533855">)</span>&nbsp;<span class="ident" id="5533857">Decode</span><span class="op" id="5533863">(</span><span class="ident" id="5533864">br</span>&nbsp;<span class="op" id="5533867">*</span><span class="ident" id="5533868"><a href="/compress/bzip2/bit_reader.go.html#5517461">bitReader</a></span><span class="op" id="5533877">)</span>&nbsp;<span class="op" id="5533879">(</span><span class="ident" id="5533880">v</span>&nbsp;<span class="builtintype" id="5533882">uint16</span><span class="op" id="5533888">)</span>&nbsp;<span class="op" id="5533890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533893">nodeIndex</span>&nbsp;<span class="op" id="5533903">:=</span>&nbsp;<span class="builtintype" id="5533906">uint16</span><span class="op" id="5533912">(</span><span class="num" id="5533913">0</span><span class="op" id="5533914">)</span>&nbsp;<span class="comment" id="5533916">//&nbsp;node&nbsp;0&nbsp;is&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533953">for</span>&nbsp;<span class="op" id="5533957">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533961">node</span>&nbsp;<span class="op" id="5533966">:=</span>&nbsp;<span class="op" id="5533969">&amp;</span><span class="ident" id="5533970"><a href="/compress/bzip2/huffman.go.html#5533841">t</a></span><span class="op" id="5533971">.</span><span class="ident" id="5533972">nodes</span><span class="op" id="5533977">[</span><span class="ident" id="5533978"><a href="/compress/bzip2/huffman.go.html#5533893">nodeIndex</a></span><span class="op" id="5533987">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533991">bit</span><span class="op" id="5533994">,</span>&nbsp;<span class="ident" id="5533996">ok</span>&nbsp;<span class="op" id="5533999">:=</span>&nbsp;<span class="ident" id="5534002"><a href="/compress/bzip2/huffman.go.html#5533864">br</a></span><span class="op" id="5534004">.</span><span class="ident" id="5534005">TryReadBit</span><span class="op" id="5534015">(</span><span class="op" id="5534016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534020">if</span>&nbsp;<span class="op" id="5534023">!</span><span class="ident" id="5534024"><a href="/compress/bzip2/huffman.go.html#5533996">ok</a></span>&nbsp;<span class="op" id="5534027">&amp;&amp;</span>&nbsp;<span class="ident" id="5534030"><a href="/compress/bzip2/huffman.go.html#5533864">br</a></span><span class="op" id="5534032">.</span><span class="ident" id="5534033">ReadBit</span><span class="op" id="5534040">(</span><span class="op" id="5534041">)</span>&nbsp;<span class="op" id="5534043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534048"><a href="/compress/bzip2/huffman.go.html#5533991">bit</a></span>&nbsp;<span class="op" id="5534052">=</span>&nbsp;<span class="num" id="5534054">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534058">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534062">//&nbsp;bzip2&nbsp;encodes&nbsp;left&nbsp;as&nbsp;a&nbsp;true&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534101">if</span>&nbsp;<span class="ident" id="5534104"><a href="/compress/bzip2/huffman.go.html#5533991">bit</a></span>&nbsp;<span class="op" id="5534108">!=</span>&nbsp;<span class="num" id="5534111">0</span>&nbsp;<span class="op" id="5534113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534118">//&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534129">if</span>&nbsp;<span class="ident" id="5534132"><a href="/compress/bzip2/huffman.go.html#5533961">node</a></span><span class="op" id="5534136">.</span><span class="ident" id="5534137">left</span>&nbsp;<span class="op" id="5534142">==</span>&nbsp;<span class="ident" id="5534145"><a href="/compress/bzip2/huffman.go.html#5533711">invalidNodeValue</a></span>&nbsp;<span class="op" id="5534162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534168">return</span>&nbsp;<span class="ident" id="5534175"><a href="/compress/bzip2/huffman.go.html#5533961">node</a></span><span class="op" id="5534179">.</span><span class="ident" id="5534180">leftValue</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534198"><a href="/compress/bzip2/huffman.go.html#5533893">nodeIndex</a></span>&nbsp;<span class="op" id="5534208">=</span>&nbsp;<span class="ident" id="5534210"><a href="/compress/bzip2/huffman.go.html#5533961">node</a></span><span class="op" id="5534214">.</span><span class="ident" id="5534215">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534222">}</span>&nbsp;<span class="keyword" id="5534224">else</span>&nbsp;<span class="op" id="5534229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534234">//&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534246">if</span>&nbsp;<span class="ident" id="5534249"><a href="/compress/bzip2/huffman.go.html#5533961">node</a></span><span class="op" id="5534253">.</span><span class="ident" id="5534254">right</span>&nbsp;<span class="op" id="5534260">==</span>&nbsp;<span class="ident" id="5534263"><a href="/compress/bzip2/huffman.go.html#5533711">invalidNodeValue</a></span>&nbsp;<span class="op" id="5534280">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534286">return</span>&nbsp;<span class="ident" id="5534293"><a href="/compress/bzip2/huffman.go.html#5533961">node</a></span><span class="op" id="5534297">.</span><span class="ident" id="5534298">rightValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534317"><a href="/compress/bzip2/huffman.go.html#5533893">nodeIndex</a></span>&nbsp;<span class="op" id="5534327">=</span>&nbsp;<span class="ident" id="5534329"><a href="/compress/bzip2/huffman.go.html#5533961">node</a></span><span class="op" id="5534333">.</span><span class="ident" id="5534334">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534345">}</span><br>
<span class="lineno">60</span><span class="op" id="5534347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5534350">//&nbsp;newHuffmanTree&nbsp;builds&nbsp;a&nbsp;Huffman&nbsp;tree&nbsp;from&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="5534423">//&nbsp;lengths&nbsp;of&nbsp;each&nbsp;symbol.&nbsp;The&nbsp;maximum&nbsp;code&nbsp;length&nbsp;is&nbsp;32&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="5534486">func</span>&nbsp;<span class="ident" id="5534491">newHuffmanTree</span><span class="op" id="5534505">(</span><span class="ident" id="5534506">lengths</span>&nbsp;<span class="op" id="5534514">[</span><span class="op" id="5534515">]</span><span class="builtintype" id="5534516">uint8</span><span class="op" id="5534521">)</span>&nbsp;<span class="op" id="5534523">(</span><span class="ident" id="5534524"><a href="/compress/bzip2/huffman.go.html#5532849">huffmanTree</a></span><span class="op" id="5534535">,</span>&nbsp;<span class="builtintype" id="5534537">error</span><span class="op" id="5534542">)</span>&nbsp;<span class="op" id="5534544">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534547">//&nbsp;There&nbsp;are&nbsp;many&nbsp;possible&nbsp;trees&nbsp;that&nbsp;assign&nbsp;the&nbsp;same&nbsp;code&nbsp;length&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534617">//&nbsp;each&nbsp;symbol&nbsp;(consider&nbsp;reflecting&nbsp;a&nbsp;tree&nbsp;down&nbsp;the&nbsp;middle,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534682">//&nbsp;example).&nbsp;Since&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;determine&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534744">//&nbsp;efficiency&nbsp;of&nbsp;the&nbsp;tree,&nbsp;each&nbsp;of&nbsp;these&nbsp;trees&nbsp;is&nbsp;equally&nbsp;good.&nbsp;In</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534812">//&nbsp;order&nbsp;to&nbsp;minimize&nbsp;the&nbsp;amount&nbsp;of&nbsp;information&nbsp;needed&nbsp;to&nbsp;build&nbsp;a&nbsp;tree</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534883">//&nbsp;bzip2&nbsp;uses&nbsp;a&nbsp;canonical&nbsp;tree&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;reconstructed&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534953">//&nbsp;only&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534992">if</span>&nbsp;<span class="builtinfunc" id="5534995">len</span><span class="op" id="5534998">(</span><span class="ident" id="5534999"><a href="/compress/bzip2/huffman.go.html#5534506">lengths</a></span><span class="op" id="5535006">)</span>&nbsp;<span class="op" id="5535008">&lt;</span>&nbsp;<span class="num" id="5535010">2</span>&nbsp;<span class="op" id="5535012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5535016">panic</span><span class="op" id="5535021">(</span><span class="string" id="5535022">&#34;newHuffmanTree:&nbsp;too&nbsp;few&nbsp;symbols&#34;</span><span class="op" id="5535055">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535062">var</span>&nbsp;<span class="ident" id="5535066">t</span>&nbsp;<span class="ident" id="5535068"><a href="/compress/bzip2/huffman.go.html#5532849">huffmanTree</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5535082">//&nbsp;First&nbsp;we&nbsp;sort&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;by&nbsp;ascending&nbsp;code&nbsp;length,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5535154">//&nbsp;using&nbsp;the&nbsp;symbol&nbsp;value&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535196">pairs</span>&nbsp;<span class="op" id="5535202">:=</span>&nbsp;<span class="ident" id="5535205"><a href="/compress/bzip2/huffman.go.html#5536665">huffmanSymbolLengthPairs</a></span><span class="op" id="5535229">(</span><span class="builtinfunc" id="5535230">make</span><span class="op" id="5535234">(</span><span class="op" id="5535235">[</span><span class="op" id="5535236">]</span><span class="ident" id="5535237"><a href="/compress/bzip2/huffman.go.html#5536523">huffmanSymbolLengthPair</a></span><span class="op" id="5535260">,</span>&nbsp;<span class="builtinfunc" id="5535262">len</span><span class="op" id="5535265">(</span><span class="ident" id="5535266"><a href="/compress/bzip2/huffman.go.html#5534506">lengths</a></span><span class="op" id="5535273">)</span><span class="op" id="5535274">)</span><span class="op" id="5535275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535278">for</span>&nbsp;<span class="ident" id="5535282">i</span><span class="op" id="5535283">,</span>&nbsp;<span class="ident" id="5535285">length</span>&nbsp;<span class="op" id="5535292">:=</span>&nbsp;<span class="keyword" id="5535295">range</span>&nbsp;<span class="ident" id="5535301"><a href="/compress/bzip2/huffman.go.html#5534506">lengths</a></span>&nbsp;<span class="op" id="5535309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535313"><a href="/compress/bzip2/huffman.go.html#5535196">pairs</a></span><span class="op" id="5535318">[</span><span class="ident" id="5535319"><a href="/compress/bzip2/huffman.go.html#5535282">i</a></span><span class="op" id="5535320">]</span><span class="op" id="5535321">.</span><span class="ident" id="5535322">value</span>&nbsp;<span class="op" id="5535328">=</span>&nbsp;<span class="builtintype" id="5535330">uint16</span><span class="op" id="5535336">(</span><span class="ident" id="5535337"><a href="/compress/bzip2/huffman.go.html#5535282">i</a></span><span class="op" id="5535338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535342"><a href="/compress/bzip2/huffman.go.html#5535196">pairs</a></span><span class="op" id="5535347">[</span><span class="ident" id="5535348"><a href="/compress/bzip2/huffman.go.html#5535282">i</a></span><span class="op" id="5535349">]</span><span class="op" id="5535350">.</span><span class="ident" id="5535351">length</span>&nbsp;<span class="op" id="5535358">=</span>&nbsp;<span class="ident" id="5535360"><a href="/compress/bzip2/huffman.go.html#5535285">length</a></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535372"><a href="/compress/bzip2/huffman.go.html#5532749">sort</a></span><span class="op" id="5535376">.</span><span class="ident" id="5535377">Sort</span><span class="op" id="5535381">(</span><span class="ident" id="5535382"><a href="/compress/bzip2/huffman.go.html#5535196">pairs</a></span><span class="op" id="5535387">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5535391">//&nbsp;Now&nbsp;we&nbsp;assign&nbsp;codes&nbsp;to&nbsp;the&nbsp;symbols,&nbsp;starting&nbsp;with&nbsp;the&nbsp;longest&nbsp;code.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5535463">//&nbsp;We&nbsp;keep&nbsp;the&nbsp;codes&nbsp;packed&nbsp;into&nbsp;a&nbsp;uint32,&nbsp;at&nbsp;the&nbsp;most-significant&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5535536">//&nbsp;So&nbsp;branches&nbsp;are&nbsp;taken&nbsp;from&nbsp;the&nbsp;MSB&nbsp;downwards.&nbsp;This&nbsp;makes&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5535608">//&nbsp;sort&nbsp;them&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535629">code</span>&nbsp;<span class="op" id="5535634">:=</span>&nbsp;<span class="builtintype" id="5535637">uint32</span><span class="op" id="5535643">(</span><span class="num" id="5535644">0</span><span class="op" id="5535645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535648">length</span>&nbsp;<span class="op" id="5535655">:=</span>&nbsp;<span class="builtintype" id="5535658">uint8</span><span class="op" id="5535663">(</span><span class="num" id="5535664">32</span><span class="op" id="5535666">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535670">codes</span>&nbsp;<span class="op" id="5535676">:=</span>&nbsp;<span class="ident" id="5535679"><a href="/compress/bzip2/huffman.go.html#5537281">huffmanCodes</a></span><span class="op" id="5535691">(</span><span class="builtinfunc" id="5535692">make</span><span class="op" id="5535696">(</span><span class="op" id="5535697">[</span><span class="op" id="5535698">]</span><span class="ident" id="5535699"><a href="/compress/bzip2/huffman.go.html#5537144">huffmanCode</a></span><span class="op" id="5535710">,</span>&nbsp;<span class="builtinfunc" id="5535712">len</span><span class="op" id="5535715">(</span><span class="ident" id="5535716"><a href="/compress/bzip2/huffman.go.html#5534506">lengths</a></span><span class="op" id="5535723">)</span><span class="op" id="5535724">)</span><span class="op" id="5535725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535728">for</span>&nbsp;<span class="ident" id="5535732">i</span>&nbsp;<span class="op" id="5535734">:=</span>&nbsp;<span class="builtinfunc" id="5535737">len</span><span class="op" id="5535740">(</span><span class="ident" id="5535741"><a href="/compress/bzip2/huffman.go.html#5535196">pairs</a></span><span class="op" id="5535746">)</span>&nbsp;<span class="op" id="5535748">-</span>&nbsp;<span class="num" id="5535750">1</span><span class="op" id="5535751">;</span>&nbsp;<span class="ident" id="5535753"><a href="/compress/bzip2/huffman.go.html#5535732">i</a></span>&nbsp;<span class="op" id="5535755">&gt;=</span>&nbsp;<span class="num" id="5535758">0</span><span class="op" id="5535759">;</span>&nbsp;<span class="ident" id="5535761"><a href="/compress/bzip2/huffman.go.html#5535732">i</a></span><span class="op" id="5535762">--</span>&nbsp;<span class="op" id="5535765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535769">if</span>&nbsp;<span class="ident" id="5535772"><a href="/compress/bzip2/huffman.go.html#5535648">length</a></span>&nbsp;<span class="op" id="5535779">&gt;</span>&nbsp;<span class="ident" id="5535781"><a href="/compress/bzip2/huffman.go.html#5535196">pairs</a></span><span class="op" id="5535786">[</span><span class="ident" id="5535787"><a href="/compress/bzip2/huffman.go.html#5535732">i</a></span><span class="op" id="5535788">]</span><span class="op" id="5535789">.</span><span class="ident" id="5535790">length</span>&nbsp;<span class="op" id="5535797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5535802">//&nbsp;If&nbsp;the&nbsp;code&nbsp;length&nbsp;decreases&nbsp;we&nbsp;shift&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5535858">//&nbsp;zero&nbsp;any&nbsp;bits&nbsp;beyond&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535906"><a href="/compress/bzip2/huffman.go.html#5535648">length</a></span>&nbsp;<span class="op" id="5535913">&gt;&gt;=</span>&nbsp;<span class="num" id="5535917">32</span>&nbsp;<span class="op" id="5535920">-</span>&nbsp;<span class="ident" id="5535922"><a href="/compress/bzip2/huffman.go.html#5535196">pairs</a></span><span class="op" id="5535927">[</span><span class="ident" id="5535928"><a href="/compress/bzip2/huffman.go.html#5535732">i</a></span><span class="op" id="5535929">]</span><span class="op" id="5535930">.</span><span class="ident" id="5535931">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535941"><a href="/compress/bzip2/huffman.go.html#5535648">length</a></span>&nbsp;<span class="op" id="5535948">&lt;&lt;=</span>&nbsp;<span class="num" id="5535952">32</span>&nbsp;<span class="op" id="5535955">-</span>&nbsp;<span class="ident" id="5535957"><a href="/compress/bzip2/huffman.go.html#5535196">pairs</a></span><span class="op" id="5535962">[</span><span class="ident" id="5535963"><a href="/compress/bzip2/huffman.go.html#5535732">i</a></span><span class="op" id="5535964">]</span><span class="op" id="5535965">.</span><span class="ident" id="5535966">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535976"><a href="/compress/bzip2/huffman.go.html#5535648">length</a></span>&nbsp;<span class="op" id="5535983">=</span>&nbsp;<span class="ident" id="5535985"><a href="/compress/bzip2/huffman.go.html#5535196">pairs</a></span><span class="op" id="5535990">[</span><span class="ident" id="5535991"><a href="/compress/bzip2/huffman.go.html#5535732">i</a></span><span class="op" id="5535992">]</span><span class="op" id="5535993">.</span><span class="ident" id="5535994">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536003">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536007"><a href="/compress/bzip2/huffman.go.html#5535670">codes</a></span><span class="op" id="5536012">[</span><span class="ident" id="5536013"><a href="/compress/bzip2/huffman.go.html#5535732">i</a></span><span class="op" id="5536014">]</span><span class="op" id="5536015">.</span><span class="ident" id="5536016">code</span>&nbsp;<span class="op" id="5536021">=</span>&nbsp;<span class="ident" id="5536023"><a href="/compress/bzip2/huffman.go.html#5535629">code</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536030"><a href="/compress/bzip2/huffman.go.html#5535670">codes</a></span><span class="op" id="5536035">[</span><span class="ident" id="5536036"><a href="/compress/bzip2/huffman.go.html#5535732">i</a></span><span class="op" id="5536037">]</span><span class="op" id="5536038">.</span><span class="ident" id="5536039">codeLen</span>&nbsp;<span class="op" id="5536047">=</span>&nbsp;<span class="ident" id="5536049"><a href="/compress/bzip2/huffman.go.html#5535648">length</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536058"><a href="/compress/bzip2/huffman.go.html#5535670">codes</a></span><span class="op" id="5536063">[</span><span class="ident" id="5536064"><a href="/compress/bzip2/huffman.go.html#5535732">i</a></span><span class="op" id="5536065">]</span><span class="op" id="5536066">.</span><span class="ident" id="5536067">value</span>&nbsp;<span class="op" id="5536073">=</span>&nbsp;<span class="ident" id="5536075"><a href="/compress/bzip2/huffman.go.html#5535196">pairs</a></span><span class="op" id="5536080">[</span><span class="ident" id="5536081"><a href="/compress/bzip2/huffman.go.html#5535732">i</a></span><span class="op" id="5536082">]</span><span class="op" id="5536083">.</span><span class="ident" id="5536084">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5536092">//&nbsp;We&nbsp;need&nbsp;to&nbsp;&#39;increment&#39;&nbsp;the&nbsp;code,&nbsp;which&nbsp;means&nbsp;treating&nbsp;|code|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5536158">//&nbsp;like&nbsp;a&nbsp;|length|&nbsp;bit&nbsp;number.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536191"><a href="/compress/bzip2/huffman.go.html#5535629">code</a></span>&nbsp;<span class="op" id="5536196">+=</span>&nbsp;<span class="num" id="5536199">1</span>&nbsp;<span class="op" id="5536201">&lt;&lt;</span>&nbsp;<span class="op" id="5536204">(</span><span class="num" id="5536205">32</span>&nbsp;<span class="op" id="5536208">-</span>&nbsp;<span class="ident" id="5536210"><a href="/compress/bzip2/huffman.go.html#5535648">length</a></span><span class="op" id="5536216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5536223">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;sort&nbsp;by&nbsp;the&nbsp;code&nbsp;so&nbsp;that&nbsp;the&nbsp;left&nbsp;half&nbsp;of&nbsp;each&nbsp;branch&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5536296">//&nbsp;grouped&nbsp;together,&nbsp;recursively.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536331"><a href="/compress/bzip2/huffman.go.html#5532749">sort</a></span><span class="op" id="5536335">.</span><span class="ident" id="5536336">Sort</span><span class="op" id="5536340">(</span><span class="ident" id="5536341"><a href="/compress/bzip2/huffman.go.html#5535670">codes</a></span><span class="op" id="5536346">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536350"><a href="/compress/bzip2/huffman.go.html#5535066">t</a></span><span class="op" id="5536351">.</span><span class="ident" id="5536352">nodes</span>&nbsp;<span class="op" id="5536358">=</span>&nbsp;<span class="builtinfunc" id="5536360">make</span><span class="op" id="5536364">(</span><span class="op" id="5536365">[</span><span class="op" id="5536366">]</span><span class="ident" id="5536367"><a href="/compress/bzip2/huffman.go.html#5533544">huffmanNode</a></span><span class="op" id="5536378">,</span>&nbsp;<span class="builtinfunc" id="5536380">len</span><span class="op" id="5536383">(</span><span class="ident" id="5536384"><a href="/compress/bzip2/huffman.go.html#5535670">codes</a></span><span class="op" id="5536389">)</span><span class="op" id="5536390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536393">_</span><span class="op" id="5536394">,</span>&nbsp;<span class="ident" id="5536396">err</span>&nbsp;<span class="op" id="5536400">:=</span>&nbsp;<span class="ident" id="5536403"><a href="/compress/bzip2/huffman.go.html#5537683">buildHuffmanNode</a></span><span class="op" id="5536419">(</span><span class="op" id="5536420">&amp;</span><span class="ident" id="5536421"><a href="/compress/bzip2/huffman.go.html#5535066">t</a></span><span class="op" id="5536422">,</span>&nbsp;<span class="ident" id="5536424"><a href="/compress/bzip2/huffman.go.html#5535670">codes</a></span><span class="op" id="5536429">,</span>&nbsp;<span class="num" id="5536431">0</span><span class="op" id="5536432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536435">return</span>&nbsp;<span class="ident" id="5536442"><a href="/compress/bzip2/huffman.go.html#5535066">t</a></span><span class="op" id="5536443">,</span>&nbsp;<span class="ident" id="5536445"><a href="/compress/bzip2/huffman.go.html#5536396">err</a></span><br>
<span class="lineno">120</span><span class="op" id="5536449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5536452">//&nbsp;huffmanSymbolLengthPair&nbsp;contains&nbsp;a&nbsp;symbol&nbsp;and&nbsp;its&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5536518">type</span>&nbsp;<span class="ident" id="5536523">huffmanSymbolLengthPair</span>&nbsp;<span class="keyword" id="5536547">struct</span>&nbsp;<span class="op" id="5536554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536557">value</span>&nbsp;&nbsp;<span class="builtintype" id="5536564">uint16</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536572">length</span>&nbsp;<span class="builtintype" id="5536579">uint8</span><br>
<span class="lineno"></span><span class="op" id="5536585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5536588">//&nbsp;huffmanSymbolLengthPair&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno"></span><span class="keyword" id="5536660">type</span>&nbsp;<span class="ident" id="5536665">huffmanSymbolLengthPairs</span>&nbsp;<span class="op" id="5536690">[</span><span class="op" id="5536691">]</span><span class="ident" id="5536692"><a href="/compress/bzip2/huffman.go.html#5536523">huffmanSymbolLengthPair</a></span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="5536717">func</span>&nbsp;<span class="op" id="5536722">(</span><span class="ident" id="5536723">h</span>&nbsp;<span class="ident" id="5536725"><a href="/compress/bzip2/huffman.go.html#5536665">huffmanSymbolLengthPairs</a></span><span class="op" id="5536749">)</span>&nbsp;<span class="ident" id="5536751">Len</span><span class="op" id="5536754">(</span><span class="op" id="5536755">)</span>&nbsp;<span class="builtintype" id="5536757">int</span>&nbsp;<span class="op" id="5536761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536764">return</span>&nbsp;<span class="builtinfunc" id="5536771">len</span><span class="op" id="5536774">(</span><span class="ident" id="5536775"><a href="/compress/bzip2/huffman.go.html#5536723">h</a></span><span class="op" id="5536776">)</span><br>
<span class="lineno"></span><span class="op" id="5536778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="5536781">func</span>&nbsp;<span class="op" id="5536786">(</span><span class="ident" id="5536787">h</span>&nbsp;<span class="ident" id="5536789"><a href="/compress/bzip2/huffman.go.html#5536665">huffmanSymbolLengthPairs</a></span><span class="op" id="5536813">)</span>&nbsp;<span class="ident" id="5536815">Less</span><span class="op" id="5536819">(</span><span class="ident" id="5536820">i</span><span class="op" id="5536821">,</span>&nbsp;<span class="ident" id="5536823">j</span>&nbsp;<span class="builtintype" id="5536825">int</span><span class="op" id="5536828">)</span>&nbsp;<span class="builtintype" id="5536830">bool</span>&nbsp;<span class="op" id="5536835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536838">if</span>&nbsp;<span class="ident" id="5536841"><a href="/compress/bzip2/huffman.go.html#5536787">h</a></span><span class="op" id="5536842">[</span><span class="ident" id="5536843"><a href="/compress/bzip2/huffman.go.html#5536820">i</a></span><span class="op" id="5536844">]</span><span class="op" id="5536845">.</span><span class="ident" id="5536846">length</span>&nbsp;<span class="op" id="5536853">&lt;</span>&nbsp;<span class="ident" id="5536855"><a href="/compress/bzip2/huffman.go.html#5536787">h</a></span><span class="op" id="5536856">[</span><span class="ident" id="5536857"><a href="/compress/bzip2/huffman.go.html#5536823">j</a></span><span class="op" id="5536858">]</span><span class="op" id="5536859">.</span><span class="ident" id="5536860">length</span>&nbsp;<span class="op" id="5536867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536871">return</span>&nbsp;<span class="ident" id="5536878">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536887">if</span>&nbsp;<span class="ident" id="5536890"><a href="/compress/bzip2/huffman.go.html#5536787">h</a></span><span class="op" id="5536891">[</span><span class="ident" id="5536892"><a href="/compress/bzip2/huffman.go.html#5536820">i</a></span><span class="op" id="5536893">]</span><span class="op" id="5536894">.</span><span class="ident" id="5536895">length</span>&nbsp;<span class="op" id="5536902">&gt;</span>&nbsp;<span class="ident" id="5536904"><a href="/compress/bzip2/huffman.go.html#5536787">h</a></span><span class="op" id="5536905">[</span><span class="ident" id="5536906"><a href="/compress/bzip2/huffman.go.html#5536823">j</a></span><span class="op" id="5536907">]</span><span class="op" id="5536908">.</span><span class="ident" id="5536909">length</span>&nbsp;<span class="op" id="5536916">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536920">return</span>&nbsp;<span class="ident" id="5536927">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536937">if</span>&nbsp;<span class="ident" id="5536940"><a href="/compress/bzip2/huffman.go.html#5536787">h</a></span><span class="op" id="5536941">[</span><span class="ident" id="5536942"><a href="/compress/bzip2/huffman.go.html#5536820">i</a></span><span class="op" id="5536943">]</span><span class="op" id="5536944">.</span><span class="ident" id="5536945">value</span>&nbsp;<span class="op" id="5536951">&lt;</span>&nbsp;<span class="ident" id="5536953"><a href="/compress/bzip2/huffman.go.html#5536787">h</a></span><span class="op" id="5536954">[</span><span class="ident" id="5536955"><a href="/compress/bzip2/huffman.go.html#5536823">j</a></span><span class="op" id="5536956">]</span><span class="op" id="5536957">.</span><span class="ident" id="5536958">value</span>&nbsp;<span class="op" id="5536964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536968">return</span>&nbsp;<span class="ident" id="5536975">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536981">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536984">return</span>&nbsp;<span class="ident" id="5536991">false</span><br>
<span class="lineno"></span><span class="op" id="5536997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5537000">func</span>&nbsp;<span class="op" id="5537005">(</span><span class="ident" id="5537006">h</span>&nbsp;<span class="ident" id="5537008"><a href="/compress/bzip2/huffman.go.html#5536665">huffmanSymbolLengthPairs</a></span><span class="op" id="5537032">)</span>&nbsp;<span class="ident" id="5537034">Swap</span><span class="op" id="5537038">(</span><span class="ident" id="5537039">i</span><span class="op" id="5537040">,</span>&nbsp;<span class="ident" id="5537042">j</span>&nbsp;<span class="builtintype" id="5537044">int</span><span class="op" id="5537047">)</span>&nbsp;<span class="op" id="5537049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537052"><a href="/compress/bzip2/huffman.go.html#5537006">h</a></span><span class="op" id="5537053">[</span><span class="ident" id="5537054"><a href="/compress/bzip2/huffman.go.html#5537039">i</a></span><span class="op" id="5537055">]</span><span class="op" id="5537056">,</span>&nbsp;<span class="ident" id="5537058"><a href="/compress/bzip2/huffman.go.html#5537006">h</a></span><span class="op" id="5537059">[</span><span class="ident" id="5537060"><a href="/compress/bzip2/huffman.go.html#5537042">j</a></span><span class="op" id="5537061">]</span>&nbsp;<span class="op" id="5537063">=</span>&nbsp;<span class="ident" id="5537065"><a href="/compress/bzip2/huffman.go.html#5537006">h</a></span><span class="op" id="5537066">[</span><span class="ident" id="5537067"><a href="/compress/bzip2/huffman.go.html#5537042">j</a></span><span class="op" id="5537068">]</span><span class="op" id="5537069">,</span>&nbsp;<span class="ident" id="5537071"><a href="/compress/bzip2/huffman.go.html#5537006">h</a></span><span class="op" id="5537072">[</span><span class="ident" id="5537073"><a href="/compress/bzip2/huffman.go.html#5537039">i</a></span><span class="op" id="5537074">]</span><br>
<span class="lineno">150</span><span class="op" id="5537076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5537079">//&nbsp;huffmanCode&nbsp;contains&nbsp;a&nbsp;symbol,&nbsp;its&nbsp;code&nbsp;and&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5537139">type</span>&nbsp;<span class="ident" id="5537144">huffmanCode</span>&nbsp;<span class="keyword" id="5537156">struct</span>&nbsp;<span class="op" id="5537163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537166">code</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5537174">uint32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537182">codeLen</span>&nbsp;<span class="builtintype" id="5537190">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537197">value</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5537205">uint16</span><br>
<span class="lineno"></span><span class="op" id="5537212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5537215">//&nbsp;huffmanCodes&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno">160</span><span class="keyword" id="5537276">type</span>&nbsp;<span class="ident" id="5537281">huffmanCodes</span>&nbsp;<span class="op" id="5537294">[</span><span class="op" id="5537295">]</span><span class="ident" id="5537296"><a href="/compress/bzip2/huffman.go.html#5537144">huffmanCode</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5537309">func</span>&nbsp;<span class="op" id="5537314">(</span><span class="ident" id="5537315">n</span>&nbsp;<span class="ident" id="5537317"><a href="/compress/bzip2/huffman.go.html#5537281">huffmanCodes</a></span><span class="op" id="5537329">)</span>&nbsp;<span class="ident" id="5537331">Len</span><span class="op" id="5537334">(</span><span class="op" id="5537335">)</span>&nbsp;<span class="builtintype" id="5537337">int</span>&nbsp;<span class="op" id="5537341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537344">return</span>&nbsp;<span class="builtinfunc" id="5537351">len</span><span class="op" id="5537354">(</span><span class="ident" id="5537355"><a href="/compress/bzip2/huffman.go.html#5537315">n</a></span><span class="op" id="5537356">)</span><br>
<span class="lineno"></span><span class="op" id="5537358">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="5537361">func</span>&nbsp;<span class="op" id="5537366">(</span><span class="ident" id="5537367">n</span>&nbsp;<span class="ident" id="5537369"><a href="/compress/bzip2/huffman.go.html#5537281">huffmanCodes</a></span><span class="op" id="5537381">)</span>&nbsp;<span class="ident" id="5537383">Less</span><span class="op" id="5537387">(</span><span class="ident" id="5537388">i</span><span class="op" id="5537389">,</span>&nbsp;<span class="ident" id="5537391">j</span>&nbsp;<span class="builtintype" id="5537393">int</span><span class="op" id="5537396">)</span>&nbsp;<span class="builtintype" id="5537398">bool</span>&nbsp;<span class="op" id="5537403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537406">return</span>&nbsp;<span class="ident" id="5537413"><a href="/compress/bzip2/huffman.go.html#5537367">n</a></span><span class="op" id="5537414">[</span><span class="ident" id="5537415"><a href="/compress/bzip2/huffman.go.html#5537388">i</a></span><span class="op" id="5537416">]</span><span class="op" id="5537417">.</span><span class="ident" id="5537418">code</span>&nbsp;<span class="op" id="5537423">&lt;</span>&nbsp;<span class="ident" id="5537425"><a href="/compress/bzip2/huffman.go.html#5537367">n</a></span><span class="op" id="5537426">[</span><span class="ident" id="5537427"><a href="/compress/bzip2/huffman.go.html#5537391">j</a></span><span class="op" id="5537428">]</span><span class="op" id="5537429">.</span><span class="ident" id="5537430">code</span><br>
<span class="lineno"></span><span class="op" id="5537435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="5537438">func</span>&nbsp;<span class="op" id="5537443">(</span><span class="ident" id="5537444">n</span>&nbsp;<span class="ident" id="5537446"><a href="/compress/bzip2/huffman.go.html#5537281">huffmanCodes</a></span><span class="op" id="5537458">)</span>&nbsp;<span class="ident" id="5537460">Swap</span><span class="op" id="5537464">(</span><span class="ident" id="5537465">i</span><span class="op" id="5537466">,</span>&nbsp;<span class="ident" id="5537468">j</span>&nbsp;<span class="builtintype" id="5537470">int</span><span class="op" id="5537473">)</span>&nbsp;<span class="op" id="5537475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537478"><a href="/compress/bzip2/huffman.go.html#5537444">n</a></span><span class="op" id="5537479">[</span><span class="ident" id="5537480"><a href="/compress/bzip2/huffman.go.html#5537465">i</a></span><span class="op" id="5537481">]</span><span class="op" id="5537482">,</span>&nbsp;<span class="ident" id="5537484"><a href="/compress/bzip2/huffman.go.html#5537444">n</a></span><span class="op" id="5537485">[</span><span class="ident" id="5537486"><a href="/compress/bzip2/huffman.go.html#5537468">j</a></span><span class="op" id="5537487">]</span>&nbsp;<span class="op" id="5537489">=</span>&nbsp;<span class="ident" id="5537491"><a href="/compress/bzip2/huffman.go.html#5537444">n</a></span><span class="op" id="5537492">[</span><span class="ident" id="5537493"><a href="/compress/bzip2/huffman.go.html#5537468">j</a></span><span class="op" id="5537494">]</span><span class="op" id="5537495">,</span>&nbsp;<span class="ident" id="5537497"><a href="/compress/bzip2/huffman.go.html#5537444">n</a></span><span class="op" id="5537498">[</span><span class="ident" id="5537499"><a href="/compress/bzip2/huffman.go.html#5537465">i</a></span><span class="op" id="5537500">]</span><br>
<span class="lineno"></span><span class="op" id="5537502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5537505">//&nbsp;buildHuffmanNode&nbsp;takes&nbsp;a&nbsp;slice&nbsp;of&nbsp;sorted&nbsp;huffmanCodes&nbsp;and&nbsp;builds&nbsp;a&nbsp;node&nbsp;in</span><br>
<span class="lineno">175</span><span class="comment" id="5537583">//&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;at&nbsp;the&nbsp;given&nbsp;level.&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;newly</span><br>
<span class="lineno"></span><span class="comment" id="5537657">//&nbsp;constructed&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="5537678">func</span>&nbsp;<span class="ident" id="5537683">buildHuffmanNode</span><span class="op" id="5537699">(</span><span class="ident" id="5537700">t</span>&nbsp;<span class="op" id="5537702">*</span><span class="ident" id="5537703"><a href="/compress/bzip2/huffman.go.html#5532849">huffmanTree</a></span><span class="op" id="5537714">,</span>&nbsp;<span class="ident" id="5537716">codes</span>&nbsp;<span class="op" id="5537722">[</span><span class="op" id="5537723">]</span><span class="ident" id="5537724"><a href="/compress/bzip2/huffman.go.html#5537144">huffmanCode</a></span><span class="op" id="5537735">,</span>&nbsp;<span class="ident" id="5537737">level</span>&nbsp;<span class="builtintype" id="5537743">uint32</span><span class="op" id="5537749">)</span>&nbsp;<span class="op" id="5537751">(</span><span class="ident" id="5537752">nodeIndex</span>&nbsp;<span class="builtintype" id="5537762">uint16</span><span class="op" id="5537768">,</span>&nbsp;<span class="ident" id="5537770">err</span>&nbsp;<span class="builtintype" id="5537774">error</span><span class="op" id="5537779">)</span>&nbsp;<span class="op" id="5537781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537784">test</span>&nbsp;<span class="op" id="5537789">:=</span>&nbsp;<span class="builtintype" id="5537792">uint32</span><span class="op" id="5537798">(</span><span class="num" id="5537799">1</span><span class="op" id="5537800">)</span>&nbsp;<span class="op" id="5537802">&lt;&lt;</span>&nbsp;<span class="op" id="5537805">(</span><span class="num" id="5537806">31</span>&nbsp;<span class="op" id="5537809">-</span>&nbsp;<span class="ident" id="5537811"><a href="/compress/bzip2/huffman.go.html#5537737">level</a></span><span class="op" id="5537816">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5537820">//&nbsp;We&nbsp;have&nbsp;to&nbsp;search&nbsp;the&nbsp;list&nbsp;of&nbsp;codes&nbsp;to&nbsp;find&nbsp;the&nbsp;divide&nbsp;between&nbsp;the&nbsp;left&nbsp;and&nbsp;right&nbsp;sides.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537913">firstRightIndex</span>&nbsp;<span class="op" id="5537929">:=</span>&nbsp;<span class="builtinfunc" id="5537932">len</span><span class="op" id="5537935">(</span><span class="ident" id="5537936"><a href="/compress/bzip2/huffman.go.html#5537716">codes</a></span><span class="op" id="5537941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537944">for</span>&nbsp;<span class="ident" id="5537948">i</span><span class="op" id="5537949">,</span>&nbsp;<span class="ident" id="5537951">code</span>&nbsp;<span class="op" id="5537956">:=</span>&nbsp;<span class="keyword" id="5537959">range</span>&nbsp;<span class="ident" id="5537965"><a href="/compress/bzip2/huffman.go.html#5537716">codes</a></span>&nbsp;<span class="op" id="5537971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537975">if</span>&nbsp;<span class="ident" id="5537978"><a href="/compress/bzip2/huffman.go.html#5537951">code</a></span><span class="op" id="5537982">.</span><span class="ident" id="5537983">code</span><span class="op" id="5537987">&amp;</span><span class="ident" id="5537988"><a href="/compress/bzip2/huffman.go.html#5537784">test</a></span>&nbsp;<span class="op" id="5537993">!=</span>&nbsp;<span class="num" id="5537996">0</span>&nbsp;<span class="op" id="5537998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538003"><a href="/compress/bzip2/huffman.go.html#5537913">firstRightIndex</a></span>&nbsp;<span class="op" id="5538019">=</span>&nbsp;<span class="ident" id="5538021"><a href="/compress/bzip2/huffman.go.html#5537948">i</a></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538026">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5538034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5538037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538041">left</span>&nbsp;<span class="op" id="5538046">:=</span>&nbsp;<span class="ident" id="5538049"><a href="/compress/bzip2/huffman.go.html#5537716">codes</a></span><span class="op" id="5538054">[</span><span class="op" id="5538055">:</span><span class="ident" id="5538056"><a href="/compress/bzip2/huffman.go.html#5537913">firstRightIndex</a></span><span class="op" id="5538071">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538074">right</span>&nbsp;<span class="op" id="5538080">:=</span>&nbsp;<span class="ident" id="5538083"><a href="/compress/bzip2/huffman.go.html#5537716">codes</a></span><span class="op" id="5538088">[</span><span class="ident" id="5538089"><a href="/compress/bzip2/huffman.go.html#5537913">firstRightIndex</a></span><span class="op" id="5538104">:</span><span class="op" id="5538105">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538109">if</span>&nbsp;<span class="builtinfunc" id="5538112">len</span><span class="op" id="5538115">(</span><span class="ident" id="5538116"><a href="/compress/bzip2/huffman.go.html#5538041">left</a></span><span class="op" id="5538120">)</span>&nbsp;<span class="op" id="5538122">==</span>&nbsp;<span class="num" id="5538125">0</span>&nbsp;<span class="op" id="5538127">||</span>&nbsp;<span class="builtinfunc" id="5538130">len</span><span class="op" id="5538133">(</span><span class="ident" id="5538134"><a href="/compress/bzip2/huffman.go.html#5538074">right</a></span><span class="op" id="5538139">)</span>&nbsp;<span class="op" id="5538141">==</span>&nbsp;<span class="num" id="5538144">0</span>&nbsp;<span class="op" id="5538146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538150">//&nbsp;There&nbsp;is&nbsp;a&nbsp;superfluous&nbsp;level&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;indicating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538215">//&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;encoder.&nbsp;However,&nbsp;this&nbsp;bug&nbsp;has&nbsp;been&nbsp;observed&nbsp;in</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538281">//&nbsp;the&nbsp;wild&nbsp;so&nbsp;we&nbsp;handle&nbsp;it.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538313">//&nbsp;If&nbsp;this&nbsp;function&nbsp;was&nbsp;called&nbsp;recursively&nbsp;then&nbsp;we&nbsp;know&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538376">//&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;because,&nbsp;otherwise,&nbsp;we&nbsp;would&nbsp;have&nbsp;hit&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538439">//&nbsp;&#34;leaf&nbsp;node&#34;&nbsp;case,&nbsp;below,&nbsp;and&nbsp;not&nbsp;recursed.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538487">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538492">//&nbsp;However,&nbsp;for&nbsp;the&nbsp;initial&nbsp;call&nbsp;it&#39;s&nbsp;possible&nbsp;that&nbsp;len(codes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538557">//&nbsp;is&nbsp;zero&nbsp;or&nbsp;one.&nbsp;Both&nbsp;cases&nbsp;are&nbsp;invalid&nbsp;because&nbsp;a&nbsp;zero&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538623">//&nbsp;tree&nbsp;cannot&nbsp;encode&nbsp;anything&nbsp;and&nbsp;a&nbsp;length-1&nbsp;tree&nbsp;can&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538685">//&nbsp;encode&nbsp;EOF&nbsp;and&nbsp;so&nbsp;is&nbsp;superfluous.&nbsp;We&nbsp;reject&nbsp;both.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538740">if</span>&nbsp;<span class="builtinfunc" id="5538743">len</span><span class="op" id="5538746">(</span><span class="ident" id="5538747"><a href="/compress/bzip2/huffman.go.html#5537716">codes</a></span><span class="op" id="5538752">)</span>&nbsp;<span class="op" id="5538754">&lt;</span>&nbsp;<span class="num" id="5538756">2</span>&nbsp;<span class="op" id="5538758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538763">return</span>&nbsp;<span class="num" id="5538770">0</span><span class="op" id="5538771">,</span>&nbsp;<span class="ident" id="5538773"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5538788">(</span><span class="string" id="5538789">&#34;empty&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="5538809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5538813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538818">//&nbsp;In&nbsp;this&nbsp;case&nbsp;the&nbsp;recursion&nbsp;doesn&#39;t&nbsp;always&nbsp;reduce&nbsp;the&nbsp;length</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538883">//&nbsp;of&nbsp;codes&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;ensure&nbsp;termination&nbsp;via&nbsp;another</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538942">//&nbsp;mechanism.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538958">if</span>&nbsp;<span class="ident" id="5538961"><a href="/compress/bzip2/huffman.go.html#5537737">level</a></span>&nbsp;<span class="op" id="5538967">==</span>&nbsp;<span class="num" id="5538970">31</span>&nbsp;<span class="op" id="5538973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5538978">//&nbsp;Since&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;the&nbsp;only&nbsp;way&nbsp;that&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5539035">//&nbsp;can&nbsp;match&nbsp;at&nbsp;all&nbsp;32&nbsp;bits&nbsp;is&nbsp;if&nbsp;they&nbsp;are&nbsp;equal,&nbsp;which</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5539094">//&nbsp;is&nbsp;invalid.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;we&nbsp;never&nbsp;enter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5539145">//&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539171">return</span>&nbsp;<span class="num" id="5539178">0</span><span class="op" id="5539179">,</span>&nbsp;<span class="ident" id="5539181"><a href="/compress/bzip2/bzip2.go.html#5519747">StructuralError</a></span><span class="op" id="5539196">(</span><span class="string" id="5539197">&#34;equal&nbsp;symbols&nbsp;in&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="5539228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539237">if</span>&nbsp;<span class="builtinfunc" id="5539240">len</span><span class="op" id="5539243">(</span><span class="ident" id="5539244"><a href="/compress/bzip2/huffman.go.html#5538041">left</a></span><span class="op" id="5539248">)</span>&nbsp;<span class="op" id="5539250">==</span>&nbsp;<span class="num" id="5539253">0</span>&nbsp;<span class="op" id="5539255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539260">return</span>&nbsp;<span class="ident" id="5539267"><a href="/compress/bzip2/huffman.go.html#5537683">buildHuffmanNode</a></span><span class="op" id="5539283">(</span><span class="ident" id="5539284"><a href="/compress/bzip2/huffman.go.html#5537700">t</a></span><span class="op" id="5539285">,</span>&nbsp;<span class="ident" id="5539287"><a href="/compress/bzip2/huffman.go.html#5538074">right</a></span><span class="op" id="5539292">,</span>&nbsp;<span class="ident" id="5539294"><a href="/compress/bzip2/huffman.go.html#5537737">level</a></span><span class="op" id="5539299">+</span><span class="num" id="5539300">1</span><span class="op" id="5539301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539309">return</span>&nbsp;<span class="ident" id="5539316"><a href="/compress/bzip2/huffman.go.html#5537683">buildHuffmanNode</a></span><span class="op" id="5539332">(</span><span class="ident" id="5539333"><a href="/compress/bzip2/huffman.go.html#5537700">t</a></span><span class="op" id="5539334">,</span>&nbsp;<span class="ident" id="5539336"><a href="/compress/bzip2/huffman.go.html#5538041">left</a></span><span class="op" id="5539340">,</span>&nbsp;<span class="ident" id="5539342"><a href="/compress/bzip2/huffman.go.html#5537737">level</a></span><span class="op" id="5539347">+</span><span class="num" id="5539348">1</span><span class="op" id="5539349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539352">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539356"><a href="/compress/bzip2/huffman.go.html#5537752">nodeIndex</a></span>&nbsp;<span class="op" id="5539366">=</span>&nbsp;<span class="builtintype" id="5539368">uint16</span><span class="op" id="5539374">(</span><span class="ident" id="5539375"><a href="/compress/bzip2/huffman.go.html#5537700">t</a></span><span class="op" id="5539376">.</span><span class="ident" id="5539377">nextNode</span><span class="op" id="5539385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539388">node</span>&nbsp;<span class="op" id="5539393">:=</span>&nbsp;<span class="op" id="5539396">&amp;</span><span class="ident" id="5539397"><a href="/compress/bzip2/huffman.go.html#5537700">t</a></span><span class="op" id="5539398">.</span><span class="ident" id="5539399">nodes</span><span class="op" id="5539404">[</span><span class="ident" id="5539405"><a href="/compress/bzip2/huffman.go.html#5537700">t</a></span><span class="op" id="5539406">.</span><span class="ident" id="5539407">nextNode</span><span class="op" id="5539415">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539418"><a href="/compress/bzip2/huffman.go.html#5537700">t</a></span><span class="op" id="5539419">.</span><span class="ident" id="5539420">nextNode</span><span class="op" id="5539428">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539433">if</span>&nbsp;<span class="builtinfunc" id="5539436">len</span><span class="op" id="5539439">(</span><span class="ident" id="5539440"><a href="/compress/bzip2/huffman.go.html#5538041">left</a></span><span class="op" id="5539444">)</span>&nbsp;<span class="op" id="5539446">==</span>&nbsp;<span class="num" id="5539449">1</span>&nbsp;<span class="op" id="5539451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5539455">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539470"><a href="/compress/bzip2/huffman.go.html#5539388">node</a></span><span class="op" id="5539474">.</span><span class="ident" id="5539475">left</span>&nbsp;<span class="op" id="5539480">=</span>&nbsp;<span class="ident" id="5539482"><a href="/compress/bzip2/huffman.go.html#5533711">invalidNodeValue</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539501"><a href="/compress/bzip2/huffman.go.html#5539388">node</a></span><span class="op" id="5539505">.</span><span class="ident" id="5539506">leftValue</span>&nbsp;<span class="op" id="5539516">=</span>&nbsp;<span class="ident" id="5539518"><a href="/compress/bzip2/huffman.go.html#5538041">left</a></span><span class="op" id="5539522">[</span><span class="num" id="5539523">0</span><span class="op" id="5539524">]</span><span class="op" id="5539525">.</span><span class="ident" id="5539526">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539533">}</span>&nbsp;<span class="keyword" id="5539535">else</span>&nbsp;<span class="op" id="5539540">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539544"><a href="/compress/bzip2/huffman.go.html#5539388">node</a></span><span class="op" id="5539548">.</span><span class="ident" id="5539549">left</span><span class="op" id="5539553">,</span>&nbsp;<span class="ident" id="5539555"><a href="/compress/bzip2/huffman.go.html#5537770">err</a></span>&nbsp;<span class="op" id="5539559">=</span>&nbsp;<span class="ident" id="5539561"><a href="/compress/bzip2/huffman.go.html#5537683">buildHuffmanNode</a></span><span class="op" id="5539577">(</span><span class="ident" id="5539578"><a href="/compress/bzip2/huffman.go.html#5537700">t</a></span><span class="op" id="5539579">,</span>&nbsp;<span class="ident" id="5539581"><a href="/compress/bzip2/huffman.go.html#5538041">left</a></span><span class="op" id="5539585">,</span>&nbsp;<span class="ident" id="5539587"><a href="/compress/bzip2/huffman.go.html#5537737">level</a></span><span class="op" id="5539592">+</span><span class="num" id="5539593">1</span><span class="op" id="5539594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539601">if</span>&nbsp;<span class="ident" id="5539604"><a href="/compress/bzip2/huffman.go.html#5537770">err</a></span>&nbsp;<span class="op" id="5539608">!=</span>&nbsp;<span class="ident" id="5539611">nil</span>&nbsp;<span class="op" id="5539615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539619">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539631">if</span>&nbsp;<span class="builtinfunc" id="5539634">len</span><span class="op" id="5539637">(</span><span class="ident" id="5539638"><a href="/compress/bzip2/huffman.go.html#5538074">right</a></span><span class="op" id="5539643">)</span>&nbsp;<span class="op" id="5539645">==</span>&nbsp;<span class="num" id="5539648">1</span>&nbsp;<span class="op" id="5539650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5539654">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539669"><a href="/compress/bzip2/huffman.go.html#5539388">node</a></span><span class="op" id="5539673">.</span><span class="ident" id="5539674">right</span>&nbsp;<span class="op" id="5539680">=</span>&nbsp;<span class="ident" id="5539682"><a href="/compress/bzip2/huffman.go.html#5533711">invalidNodeValue</a></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539701"><a href="/compress/bzip2/huffman.go.html#5539388">node</a></span><span class="op" id="5539705">.</span><span class="ident" id="5539706">rightValue</span>&nbsp;<span class="op" id="5539717">=</span>&nbsp;<span class="ident" id="5539719"><a href="/compress/bzip2/huffman.go.html#5538074">right</a></span><span class="op" id="5539724">[</span><span class="num" id="5539725">0</span><span class="op" id="5539726">]</span><span class="op" id="5539727">.</span><span class="ident" id="5539728">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539735">}</span>&nbsp;<span class="keyword" id="5539737">else</span>&nbsp;<span class="op" id="5539742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539746"><a href="/compress/bzip2/huffman.go.html#5539388">node</a></span><span class="op" id="5539750">.</span><span class="ident" id="5539751">right</span><span class="op" id="5539756">,</span>&nbsp;<span class="ident" id="5539758"><a href="/compress/bzip2/huffman.go.html#5537770">err</a></span>&nbsp;<span class="op" id="5539762">=</span>&nbsp;<span class="ident" id="5539764"><a href="/compress/bzip2/huffman.go.html#5537683">buildHuffmanNode</a></span><span class="op" id="5539780">(</span><span class="ident" id="5539781"><a href="/compress/bzip2/huffman.go.html#5537700">t</a></span><span class="op" id="5539782">,</span>&nbsp;<span class="ident" id="5539784"><a href="/compress/bzip2/huffman.go.html#5538074">right</a></span><span class="op" id="5539789">,</span>&nbsp;<span class="ident" id="5539791"><a href="/compress/bzip2/huffman.go.html#5537737">level</a></span><span class="op" id="5539796">+</span><span class="num" id="5539797">1</span><span class="op" id="5539798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539805">return</span><br>
<span class="lineno"></span><span class="op" id="5539812">}</span>
</div>
</body>
</html>
