<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2334917">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2334972">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2335026">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2335077">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2335147">package</span>&nbsp;<span class="ident" id="2335155">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2335159">import</span>&nbsp;<span class="op" id="2335166">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2335169">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2335180">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2335195">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2335205">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2335208">//&nbsp;File&nbsp;represents&nbsp;an&nbsp;open&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2335252">type</span>&nbsp;<span class="ident" id="2335257">File</span>&nbsp;<span class="keyword" id="2335262">struct</span>&nbsp;<span class="op" id="2335269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2335272">*</span><span class="ident" id="2335273">file</span><br>
<span class="lineno"></span><span class="op" id="2335278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2335281">//&nbsp;file&nbsp;is&nbsp;the&nbsp;real&nbsp;representation&nbsp;of&nbsp;*File.</span><br>
<span class="lineno"></span><span class="comment" id="2335326">//&nbsp;The&nbsp;extra&nbsp;level&nbsp;of&nbsp;indirection&nbsp;ensures&nbsp;that&nbsp;no&nbsp;clients&nbsp;of&nbsp;os</span><br>
<span class="lineno"></span><span class="comment" id="2335390">//&nbsp;can&nbsp;overwrite&nbsp;this&nbsp;data,&nbsp;which&nbsp;could&nbsp;cause&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="2335450">//&nbsp;to&nbsp;close&nbsp;the&nbsp;wrong&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2335489">type</span>&nbsp;<span class="ident" id="2335494">file</span>&nbsp;<span class="keyword" id="2335499">struct</span>&nbsp;<span class="op" id="2335506">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2335509">fd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2335517">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2335522">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2335530">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2335538">dirinfo</span>&nbsp;<span class="op" id="2335546">*</span><span class="ident" id="2335547">dirInfo</span>&nbsp;<span class="comment" id="2335555">//&nbsp;nil&nbsp;unless&nbsp;directory&nbsp;being&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2335591">nepipe</span>&nbsp;&nbsp;<span class="builtintype" id="2335599">int32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2335608">//&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;EPIPE&nbsp;in&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="2335648">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2335651">//&nbsp;Fd&nbsp;returns&nbsp;the&nbsp;integer&nbsp;Unix&nbsp;file&nbsp;descriptor&nbsp;referencing&nbsp;the&nbsp;open&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2335725">//&nbsp;The&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;valid&nbsp;only&nbsp;until&nbsp;f.Close&nbsp;is&nbsp;called&nbsp;or&nbsp;f&nbsp;is&nbsp;garbage&nbsp;collected.</span><br>
<span class="lineno"></span><span class="keyword" id="2335813">func</span>&nbsp;<span class="op" id="2335818">(</span><span class="ident" id="2335819">f</span>&nbsp;<span class="op" id="2335821">*</span><span class="ident" id="2335822">File</span><span class="op" id="2335826">)</span>&nbsp;<span class="ident" id="2335828">Fd</span><span class="op" id="2335830">(</span><span class="op" id="2335831">)</span>&nbsp;<span class="builtintype" id="2335833">uintptr</span>&nbsp;<span class="op" id="2335841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2335844">if</span>&nbsp;<span class="ident" id="2335847">f</span>&nbsp;<span class="op" id="2335849">==</span>&nbsp;<span class="ident" id="2335852">nil</span>&nbsp;<span class="op" id="2335856">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2335860">return</span>&nbsp;<span class="op" id="2335867">^</span><span class="op" id="2335868">(</span><span class="builtintype" id="2335869">uintptr</span><span class="op" id="2335876">(</span><span class="num" id="2335877">0</span><span class="op" id="2335878">)</span><span class="op" id="2335879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2335882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2335885">return</span>&nbsp;<span class="builtintype" id="2335892">uintptr</span><span class="op" id="2335899">(</span><span class="ident" id="2335900">f</span><span class="op" id="2335901">.</span><span class="ident" id="2335902">fd</span><span class="op" id="2335904">)</span><br>
<span class="lineno"></span><span class="op" id="2335906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2335909">//&nbsp;NewFile&nbsp;returns&nbsp;a&nbsp;new&nbsp;File&nbsp;with&nbsp;the&nbsp;given&nbsp;file&nbsp;descriptor&nbsp;and&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="2335980">func</span>&nbsp;<span class="ident" id="2335985">NewFile</span><span class="op" id="2335992">(</span><span class="ident" id="2335993">fd</span>&nbsp;<span class="builtintype" id="2335996">uintptr</span><span class="op" id="2336003">,</span>&nbsp;<span class="ident" id="2336005">name</span>&nbsp;<span class="builtintype" id="2336010">string</span><span class="op" id="2336016">)</span>&nbsp;<span class="op" id="2336018">*</span><span class="ident" id="2336019">File</span>&nbsp;<span class="op" id="2336024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2336027">fdi</span>&nbsp;<span class="op" id="2336031">:=</span>&nbsp;<span class="builtintype" id="2336034">int</span><span class="op" id="2336037">(</span><span class="ident" id="2336038">fd</span><span class="op" id="2336040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2336043">if</span>&nbsp;<span class="ident" id="2336046">fdi</span>&nbsp;<span class="op" id="2336050">&lt;</span>&nbsp;<span class="num" id="2336052">0</span>&nbsp;<span class="op" id="2336054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2336058">return</span>&nbsp;<span class="ident" id="2336065">nil</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2336070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2336073">f</span>&nbsp;<span class="op" id="2336075">:=</span>&nbsp;<span class="op" id="2336078">&amp;</span><span class="ident" id="2336079">File</span><span class="op" id="2336083">{</span><span class="op" id="2336084">&amp;</span><span class="ident" id="2336085">file</span><span class="op" id="2336089">{</span><span class="ident" id="2336090">fd</span><span class="op" id="2336092">:</span>&nbsp;<span class="ident" id="2336094">fdi</span><span class="op" id="2336097">,</span>&nbsp;<span class="ident" id="2336099">name</span><span class="op" id="2336103">:</span>&nbsp;<span class="ident" id="2336105">name</span><span class="op" id="2336109">}</span><span class="op" id="2336110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2336113">runtime</span><span class="op" id="2336120">.</span><span class="ident" id="2336121">SetFinalizer</span><span class="op" id="2336133">(</span><span class="ident" id="2336134">f</span><span class="op" id="2336135">.</span><span class="ident" id="2336136">file</span><span class="op" id="2336140">,</span>&nbsp;<span class="op" id="2336142">(</span><span class="op" id="2336143">*</span><span class="ident" id="2336144">file</span><span class="op" id="2336148">)</span><span class="op" id="2336149">.</span><span class="builtinfunc" id="2336150">close</span><span class="op" id="2336155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2336158">return</span>&nbsp;<span class="ident" id="2336165">f</span><br>
<span class="lineno"></span><span class="op" id="2336167">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="2336170">//&nbsp;Auxiliary&nbsp;information&nbsp;if&nbsp;the&nbsp;File&nbsp;describes&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="keyword" id="2336229">type</span>&nbsp;<span class="ident" id="2336234">dirInfo</span>&nbsp;<span class="keyword" id="2336242">struct</span>&nbsp;<span class="op" id="2336249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2336252">buf</span>&nbsp;&nbsp;<span class="op" id="2336257">[</span><span class="op" id="2336258">]</span><span class="builtintype" id="2336259">byte</span>&nbsp;<span class="comment" id="2336264">//&nbsp;buffer&nbsp;for&nbsp;directory&nbsp;I/O</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2336293">nbuf</span>&nbsp;<span class="builtintype" id="2336298">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2336305">//&nbsp;length&nbsp;of&nbsp;buf;&nbsp;return&nbsp;value&nbsp;from&nbsp;Getdirentries</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2336356">bufp</span>&nbsp;<span class="builtintype" id="2336361">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2336368">//&nbsp;location&nbsp;of&nbsp;next&nbsp;record&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span><span class="op" id="2336403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2336406">func</span>&nbsp;<span class="ident" id="2336411">epipecheck</span><span class="op" id="2336421">(</span><span class="ident" id="2336422">file</span>&nbsp;<span class="op" id="2336427">*</span><span class="ident" id="2336428">File</span><span class="op" id="2336432">,</span>&nbsp;<span class="ident" id="2336434">e</span>&nbsp;<span class="builtintype" id="2336436">error</span><span class="op" id="2336441">)</span>&nbsp;<span class="op" id="2336443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2336446">if</span>&nbsp;<span class="ident" id="2336449">e</span>&nbsp;<span class="op" id="2336451">==</span>&nbsp;<span class="ident" id="2336454">syscall</span><span class="op" id="2336461">.</span><span class="ident" id="2336462">EPIPE</span>&nbsp;<span class="op" id="2336468">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2336472">if</span>&nbsp;<span class="ident" id="2336475">atomic</span><span class="op" id="2336481">.</span><span class="ident" id="2336482">AddInt32</span><span class="op" id="2336490">(</span><span class="op" id="2336491">&amp;</span><span class="ident" id="2336492">file</span><span class="op" id="2336496">.</span><span class="ident" id="2336497">nepipe</span><span class="op" id="2336503">,</span>&nbsp;<span class="num" id="2336505">1</span><span class="op" id="2336506">)</span>&nbsp;<span class="op" id="2336508">&gt;=</span>&nbsp;<span class="num" id="2336511">10</span>&nbsp;<span class="op" id="2336514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2336519">sigpipe</span><span class="op" id="2336526">(</span><span class="op" id="2336527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2336531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2336534">}</span>&nbsp;<span class="keyword" id="2336536">else</span>&nbsp;<span class="op" id="2336541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2336545">atomic</span><span class="op" id="2336551">.</span><span class="ident" id="2336552">StoreInt32</span><span class="op" id="2336562">(</span><span class="op" id="2336563">&amp;</span><span class="ident" id="2336564">file</span><span class="op" id="2336568">.</span><span class="ident" id="2336569">nepipe</span><span class="op" id="2336575">,</span>&nbsp;<span class="num" id="2336577">0</span><span class="op" id="2336578">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2336581">}</span><br>
<span class="lineno"></span><span class="op" id="2336583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2336586">//&nbsp;DevNull&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;operating&nbsp;system&#39;s&nbsp;``null&nbsp;device.&#39;&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2336652">//&nbsp;On&nbsp;Unix-like&nbsp;systems,&nbsp;it&nbsp;is&nbsp;&#34;/dev/null&#34;;&nbsp;on&nbsp;Windows,&nbsp;&#34;NUL&#34;.</span><br>
<span class="lineno">70</span><span class="keyword" id="2336715">const</span>&nbsp;<span class="ident" id="2336721">DevNull</span>&nbsp;<span class="op" id="2336729">=</span>&nbsp;<span class="string" id="2336731">&#34;/dev/null&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2336744">//&nbsp;OpenFile&nbsp;is&nbsp;the&nbsp;generalized&nbsp;open&nbsp;call;&nbsp;most&nbsp;users&nbsp;will&nbsp;use&nbsp;Open</span><br>
<span class="lineno"></span><span class="comment" id="2336811">//&nbsp;or&nbsp;Create&nbsp;instead.&nbsp;&nbsp;It&nbsp;opens&nbsp;the&nbsp;named&nbsp;file&nbsp;with&nbsp;specified&nbsp;flag</span><br>
<span class="lineno"></span><span class="comment" id="2336878">//&nbsp;(O_RDONLY&nbsp;etc.)&nbsp;and&nbsp;perm,&nbsp;(0666&nbsp;etc.)&nbsp;if&nbsp;applicable.&nbsp;&nbsp;If&nbsp;successful,</span><br>
<span class="lineno">75</span><span class="comment" id="2336950">//&nbsp;methods&nbsp;on&nbsp;the&nbsp;returned&nbsp;File&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2337003">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2337059">func</span>&nbsp;<span class="ident" id="2337064">OpenFile</span><span class="op" id="2337072">(</span><span class="ident" id="2337073">name</span>&nbsp;<span class="builtintype" id="2337078">string</span><span class="op" id="2337084">,</span>&nbsp;<span class="ident" id="2337086">flag</span>&nbsp;<span class="builtintype" id="2337091">int</span><span class="op" id="2337094">,</span>&nbsp;<span class="ident" id="2337096">perm</span>&nbsp;<span class="ident" id="2337101">FileMode</span><span class="op" id="2337109">)</span>&nbsp;<span class="op" id="2337111">(</span><span class="ident" id="2337112">file</span>&nbsp;<span class="op" id="2337117">*</span><span class="ident" id="2337118">File</span><span class="op" id="2337122">,</span>&nbsp;<span class="ident" id="2337124">err</span>&nbsp;<span class="builtintype" id="2337128">error</span><span class="op" id="2337133">)</span>&nbsp;<span class="op" id="2337135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2337138">r</span><span class="op" id="2337139">,</span>&nbsp;<span class="ident" id="2337141">e</span>&nbsp;<span class="op" id="2337143">:=</span>&nbsp;<span class="ident" id="2337146">syscall</span><span class="op" id="2337153">.</span><span class="ident" id="2337154">Open</span><span class="op" id="2337158">(</span><span class="ident" id="2337159">name</span><span class="op" id="2337163">,</span>&nbsp;<span class="ident" id="2337165">flag</span><span class="op" id="2337169">|</span><span class="ident" id="2337170">syscall</span><span class="op" id="2337177">.</span><span class="ident" id="2337178">O_CLOEXEC</span><span class="op" id="2337187">,</span>&nbsp;<span class="ident" id="2337189">syscallMode</span><span class="op" id="2337200">(</span><span class="ident" id="2337201">perm</span><span class="op" id="2337205">)</span><span class="op" id="2337206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2337209">if</span>&nbsp;<span class="ident" id="2337212">e</span>&nbsp;<span class="op" id="2337214">!=</span>&nbsp;<span class="ident" id="2337217">nil</span>&nbsp;<span class="op" id="2337221">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2337225">return</span>&nbsp;<span class="ident" id="2337232">nil</span><span class="op" id="2337235">,</span>&nbsp;<span class="op" id="2337237">&amp;</span><span class="ident" id="2337238">PathError</span><span class="op" id="2337247">{</span><span class="string" id="2337248">&#34;open&#34;</span><span class="op" id="2337254">,</span>&nbsp;<span class="ident" id="2337256">name</span><span class="op" id="2337260">,</span>&nbsp;<span class="ident" id="2337262">e</span><span class="op" id="2337263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2337266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2337270">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here&nbsp;with&nbsp;fork/exec,&nbsp;which&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2337323">//&nbsp;content&nbsp;to&nbsp;live&nbsp;with.&nbsp;&nbsp;See&nbsp;../syscall/exec_unix.go.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2337379">if</span>&nbsp;<span class="op" id="2337382">!</span><span class="ident" id="2337383">supportsCloseOnExec</span>&nbsp;<span class="op" id="2337403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2337407">syscall</span><span class="op" id="2337414">.</span><span class="ident" id="2337415">CloseOnExec</span><span class="op" id="2337426">(</span><span class="ident" id="2337427">r</span><span class="op" id="2337428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2337431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2337435">return</span>&nbsp;<span class="ident" id="2337442">NewFile</span><span class="op" id="2337449">(</span><span class="builtintype" id="2337450">uintptr</span><span class="op" id="2337457">(</span><span class="ident" id="2337458">r</span><span class="op" id="2337459">)</span><span class="op" id="2337460">,</span>&nbsp;<span class="ident" id="2337462">name</span><span class="op" id="2337466">)</span><span class="op" id="2337467">,</span>&nbsp;<span class="ident" id="2337469">nil</span><br>
<span class="lineno">90</span><span class="op" id="2337473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2337476">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;File,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2337533">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2337565">func</span>&nbsp;<span class="op" id="2337570">(</span><span class="ident" id="2337571">f</span>&nbsp;<span class="op" id="2337573">*</span><span class="ident" id="2337574">File</span><span class="op" id="2337578">)</span>&nbsp;<span class="ident" id="2337580">Close</span><span class="op" id="2337585">(</span><span class="op" id="2337586">)</span>&nbsp;<span class="builtintype" id="2337588">error</span>&nbsp;<span class="op" id="2337594">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2337597">if</span>&nbsp;<span class="ident" id="2337600">f</span>&nbsp;<span class="op" id="2337602">==</span>&nbsp;<span class="ident" id="2337605">nil</span>&nbsp;<span class="op" id="2337609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2337613">return</span>&nbsp;<span class="ident" id="2337620">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2337632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2337635">return</span>&nbsp;<span class="ident" id="2337642">f</span><span class="op" id="2337643">.</span><span class="ident" id="2337644">file</span><span class="op" id="2337648">.</span><span class="builtinfunc" id="2337649">close</span><span class="op" id="2337654">(</span><span class="op" id="2337655">)</span><br>
<span class="lineno"></span><span class="op" id="2337657">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2337660">func</span>&nbsp;<span class="op" id="2337665">(</span><span class="ident" id="2337666">file</span>&nbsp;<span class="op" id="2337671">*</span><span class="ident" id="2337672">file</span><span class="op" id="2337676">)</span>&nbsp;<span class="builtinfunc" id="2337678">close</span><span class="op" id="2337683">(</span><span class="op" id="2337684">)</span>&nbsp;<span class="builtintype" id="2337686">error</span>&nbsp;<span class="op" id="2337692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2337695">if</span>&nbsp;<span class="ident" id="2337698">file</span>&nbsp;<span class="op" id="2337703">==</span>&nbsp;<span class="ident" id="2337706">nil</span>&nbsp;<span class="op" id="2337710">||</span>&nbsp;<span class="ident" id="2337713">file</span><span class="op" id="2337717">.</span><span class="ident" id="2337718">fd</span>&nbsp;<span class="op" id="2337721">&lt;</span>&nbsp;<span class="num" id="2337723">0</span>&nbsp;<span class="op" id="2337725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2337729">return</span>&nbsp;<span class="ident" id="2337736">syscall</span><span class="op" id="2337743">.</span><span class="ident" id="2337744">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2337752">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2337755">var</span>&nbsp;<span class="ident" id="2337759">err</span>&nbsp;<span class="builtintype" id="2337763">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2337770">if</span>&nbsp;<span class="ident" id="2337773">e</span>&nbsp;<span class="op" id="2337775">:=</span>&nbsp;<span class="ident" id="2337778">syscall</span><span class="op" id="2337785">.</span><span class="ident" id="2337786">Close</span><span class="op" id="2337791">(</span><span class="ident" id="2337792">file</span><span class="op" id="2337796">.</span><span class="ident" id="2337797">fd</span><span class="op" id="2337799">)</span><span class="op" id="2337800">;</span>&nbsp;<span class="ident" id="2337802">e</span>&nbsp;<span class="op" id="2337804">!=</span>&nbsp;<span class="ident" id="2337807">nil</span>&nbsp;<span class="op" id="2337811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2337815">err</span>&nbsp;<span class="op" id="2337819">=</span>&nbsp;<span class="op" id="2337821">&amp;</span><span class="ident" id="2337822">PathError</span><span class="op" id="2337831">{</span><span class="string" id="2337832">&#34;close&#34;</span><span class="op" id="2337839">,</span>&nbsp;<span class="ident" id="2337841">file</span><span class="op" id="2337845">.</span><span class="ident" id="2337846">name</span><span class="op" id="2337850">,</span>&nbsp;<span class="ident" id="2337852">e</span><span class="op" id="2337853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2337856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2337859">file</span><span class="op" id="2337863">.</span><span class="ident" id="2337864">fd</span>&nbsp;<span class="op" id="2337867">=</span>&nbsp;<span class="op" id="2337869">-</span><span class="num" id="2337870">1</span>&nbsp;<span class="comment" id="2337872">//&nbsp;so&nbsp;it&nbsp;can&#39;t&nbsp;be&nbsp;closed&nbsp;again</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2337905">//&nbsp;no&nbsp;need&nbsp;for&nbsp;a&nbsp;finalizer&nbsp;anymore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2337941">runtime</span><span class="op" id="2337948">.</span><span class="ident" id="2337949">SetFinalizer</span><span class="op" id="2337961">(</span><span class="ident" id="2337962">file</span><span class="op" id="2337966">,</span>&nbsp;<span class="ident" id="2337968">nil</span><span class="op" id="2337971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2337974">return</span>&nbsp;<span class="ident" id="2337981">err</span><br>
<span class="lineno"></span><span class="op" id="2337985">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2337988">//&nbsp;Stat&nbsp;returns&nbsp;the&nbsp;FileInfo&nbsp;structure&nbsp;describing&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2338044">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2338100">func</span>&nbsp;<span class="op" id="2338105">(</span><span class="ident" id="2338106">f</span>&nbsp;<span class="op" id="2338108">*</span><span class="ident" id="2338109">File</span><span class="op" id="2338113">)</span>&nbsp;<span class="ident" id="2338115">Stat</span><span class="op" id="2338119">(</span><span class="op" id="2338120">)</span>&nbsp;<span class="op" id="2338122">(</span><span class="ident" id="2338123">fi</span>&nbsp;<span class="ident" id="2338126">FileInfo</span><span class="op" id="2338134">,</span>&nbsp;<span class="ident" id="2338136">err</span>&nbsp;<span class="builtintype" id="2338140">error</span><span class="op" id="2338145">)</span>&nbsp;<span class="op" id="2338147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2338150">if</span>&nbsp;<span class="ident" id="2338153">f</span>&nbsp;<span class="op" id="2338155">==</span>&nbsp;<span class="ident" id="2338158">nil</span>&nbsp;<span class="op" id="2338162">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2338166">return</span>&nbsp;<span class="ident" id="2338173">nil</span><span class="op" id="2338176">,</span>&nbsp;<span class="ident" id="2338178">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2338190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2338193">var</span>&nbsp;<span class="ident" id="2338197">stat</span>&nbsp;<span class="ident" id="2338202">syscall</span><span class="op" id="2338209">.</span><span class="ident" id="2338210">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2338218">err</span>&nbsp;<span class="op" id="2338222">=</span>&nbsp;<span class="ident" id="2338224">syscall</span><span class="op" id="2338231">.</span><span class="ident" id="2338232">Fstat</span><span class="op" id="2338237">(</span><span class="ident" id="2338238">f</span><span class="op" id="2338239">.</span><span class="ident" id="2338240">fd</span><span class="op" id="2338242">,</span>&nbsp;<span class="op" id="2338244">&amp;</span><span class="ident" id="2338245">stat</span><span class="op" id="2338249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2338252">if</span>&nbsp;<span class="ident" id="2338255">err</span>&nbsp;<span class="op" id="2338259">!=</span>&nbsp;<span class="ident" id="2338262">nil</span>&nbsp;<span class="op" id="2338266">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2338270">return</span>&nbsp;<span class="ident" id="2338277">nil</span><span class="op" id="2338280">,</span>&nbsp;<span class="op" id="2338282">&amp;</span><span class="ident" id="2338283">PathError</span><span class="op" id="2338292">{</span><span class="string" id="2338293">&#34;stat&#34;</span><span class="op" id="2338299">,</span>&nbsp;<span class="ident" id="2338301">f</span><span class="op" id="2338302">.</span><span class="ident" id="2338303">name</span><span class="op" id="2338307">,</span>&nbsp;<span class="ident" id="2338309">err</span><span class="op" id="2338312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2338315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2338318">return</span>&nbsp;<span class="ident" id="2338325">fileInfoFromStat</span><span class="op" id="2338341">(</span><span class="op" id="2338342">&amp;</span><span class="ident" id="2338343">stat</span><span class="op" id="2338347">,</span>&nbsp;<span class="ident" id="2338349">f</span><span class="op" id="2338350">.</span><span class="ident" id="2338351">name</span><span class="op" id="2338355">)</span><span class="op" id="2338356">,</span>&nbsp;<span class="ident" id="2338358">nil</span><br>
<span class="lineno"></span><span class="op" id="2338362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="2338365">//&nbsp;Stat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2338419">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2338475">func</span>&nbsp;<span class="ident" id="2338480">Stat</span><span class="op" id="2338484">(</span><span class="ident" id="2338485">name</span>&nbsp;<span class="builtintype" id="2338490">string</span><span class="op" id="2338496">)</span>&nbsp;<span class="op" id="2338498">(</span><span class="ident" id="2338499">fi</span>&nbsp;<span class="ident" id="2338502">FileInfo</span><span class="op" id="2338510">,</span>&nbsp;<span class="ident" id="2338512">err</span>&nbsp;<span class="builtintype" id="2338516">error</span><span class="op" id="2338521">)</span>&nbsp;<span class="op" id="2338523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2338526">var</span>&nbsp;<span class="ident" id="2338530">stat</span>&nbsp;<span class="ident" id="2338535">syscall</span><span class="op" id="2338542">.</span><span class="ident" id="2338543">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2338551">err</span>&nbsp;<span class="op" id="2338555">=</span>&nbsp;<span class="ident" id="2338557">syscall</span><span class="op" id="2338564">.</span><span class="ident" id="2338565">Stat</span><span class="op" id="2338569">(</span><span class="ident" id="2338570">name</span><span class="op" id="2338574">,</span>&nbsp;<span class="op" id="2338576">&amp;</span><span class="ident" id="2338577">stat</span><span class="op" id="2338581">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2338584">if</span>&nbsp;<span class="ident" id="2338587">err</span>&nbsp;<span class="op" id="2338591">!=</span>&nbsp;<span class="ident" id="2338594">nil</span>&nbsp;<span class="op" id="2338598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2338602">return</span>&nbsp;<span class="ident" id="2338609">nil</span><span class="op" id="2338612">,</span>&nbsp;<span class="op" id="2338614">&amp;</span><span class="ident" id="2338615">PathError</span><span class="op" id="2338624">{</span><span class="string" id="2338625">&#34;stat&#34;</span><span class="op" id="2338631">,</span>&nbsp;<span class="ident" id="2338633">name</span><span class="op" id="2338637">,</span>&nbsp;<span class="ident" id="2338639">err</span><span class="op" id="2338642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2338645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2338648">return</span>&nbsp;<span class="ident" id="2338655">fileInfoFromStat</span><span class="op" id="2338671">(</span><span class="op" id="2338672">&amp;</span><span class="ident" id="2338673">stat</span><span class="op" id="2338677">,</span>&nbsp;<span class="ident" id="2338679">name</span><span class="op" id="2338683">)</span><span class="op" id="2338684">,</span>&nbsp;<span class="ident" id="2338686">nil</span><br>
<span class="lineno"></span><span class="op" id="2338690">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="2338693">//&nbsp;Lstat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2338748">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;the&nbsp;returned&nbsp;FileInfo</span><br>
<span class="lineno"></span><span class="comment" id="2338805">//&nbsp;describes&nbsp;the&nbsp;symbolic&nbsp;link.&nbsp;&nbsp;Lstat&nbsp;makes&nbsp;no&nbsp;attempt&nbsp;to&nbsp;follow&nbsp;the&nbsp;link.</span><br>
<span class="lineno"></span><span class="comment" id="2338881">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno">145</span><span class="keyword" id="2338937">func</span>&nbsp;<span class="ident" id="2338942">Lstat</span><span class="op" id="2338947">(</span><span class="ident" id="2338948">name</span>&nbsp;<span class="builtintype" id="2338953">string</span><span class="op" id="2338959">)</span>&nbsp;<span class="op" id="2338961">(</span><span class="ident" id="2338962">fi</span>&nbsp;<span class="ident" id="2338965">FileInfo</span><span class="op" id="2338973">,</span>&nbsp;<span class="ident" id="2338975">err</span>&nbsp;<span class="builtintype" id="2338979">error</span><span class="op" id="2338984">)</span>&nbsp;<span class="op" id="2338986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2338989">var</span>&nbsp;<span class="ident" id="2338993">stat</span>&nbsp;<span class="ident" id="2338998">syscall</span><span class="op" id="2339005">.</span><span class="ident" id="2339006">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2339014">err</span>&nbsp;<span class="op" id="2339018">=</span>&nbsp;<span class="ident" id="2339020">syscall</span><span class="op" id="2339027">.</span><span class="ident" id="2339028">Lstat</span><span class="op" id="2339033">(</span><span class="ident" id="2339034">name</span><span class="op" id="2339038">,</span>&nbsp;<span class="op" id="2339040">&amp;</span><span class="ident" id="2339041">stat</span><span class="op" id="2339045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339048">if</span>&nbsp;<span class="ident" id="2339051">err</span>&nbsp;<span class="op" id="2339055">!=</span>&nbsp;<span class="ident" id="2339058">nil</span>&nbsp;<span class="op" id="2339062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339066">return</span>&nbsp;<span class="ident" id="2339073">nil</span><span class="op" id="2339076">,</span>&nbsp;<span class="op" id="2339078">&amp;</span><span class="ident" id="2339079">PathError</span><span class="op" id="2339088">{</span><span class="string" id="2339089">&#34;lstat&#34;</span><span class="op" id="2339096">,</span>&nbsp;<span class="ident" id="2339098">name</span><span class="op" id="2339102">,</span>&nbsp;<span class="ident" id="2339104">err</span><span class="op" id="2339107">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2339110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339113">return</span>&nbsp;<span class="ident" id="2339120">fileInfoFromStat</span><span class="op" id="2339136">(</span><span class="op" id="2339137">&amp;</span><span class="ident" id="2339138">stat</span><span class="op" id="2339142">,</span>&nbsp;<span class="ident" id="2339144">name</span><span class="op" id="2339148">)</span><span class="op" id="2339149">,</span>&nbsp;<span class="ident" id="2339151">nil</span><br>
<span class="lineno"></span><span class="op" id="2339155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2339158">func</span>&nbsp;<span class="op" id="2339163">(</span><span class="ident" id="2339164">f</span>&nbsp;<span class="op" id="2339166">*</span><span class="ident" id="2339167">File</span><span class="op" id="2339171">)</span>&nbsp;<span class="ident" id="2339173">readdir</span><span class="op" id="2339180">(</span><span class="ident" id="2339181">n</span>&nbsp;<span class="builtintype" id="2339183">int</span><span class="op" id="2339186">)</span>&nbsp;<span class="op" id="2339188">(</span><span class="ident" id="2339189">fi</span>&nbsp;<span class="op" id="2339192">[</span><span class="op" id="2339193">]</span><span class="ident" id="2339194">FileInfo</span><span class="op" id="2339202">,</span>&nbsp;<span class="ident" id="2339204">err</span>&nbsp;<span class="builtintype" id="2339208">error</span><span class="op" id="2339213">)</span>&nbsp;<span class="op" id="2339215">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2339218">dirname</span>&nbsp;<span class="op" id="2339226">:=</span>&nbsp;<span class="ident" id="2339229">f</span><span class="op" id="2339230">.</span><span class="ident" id="2339231">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339237">if</span>&nbsp;<span class="ident" id="2339240">dirname</span>&nbsp;<span class="op" id="2339248">==</span>&nbsp;<span class="string" id="2339251">&#34;&#34;</span>&nbsp;<span class="op" id="2339254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2339258">dirname</span>&nbsp;<span class="op" id="2339266">=</span>&nbsp;<span class="string" id="2339268">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2339273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2339276">names</span><span class="op" id="2339281">,</span>&nbsp;<span class="ident" id="2339283">err</span>&nbsp;<span class="op" id="2339287">:=</span>&nbsp;<span class="ident" id="2339290">f</span><span class="op" id="2339291">.</span><span class="ident" id="2339292">Readdirnames</span><span class="op" id="2339304">(</span><span class="ident" id="2339305">n</span><span class="op" id="2339306">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2339309">fi</span>&nbsp;<span class="op" id="2339312">=</span>&nbsp;<span class="builtinfunc" id="2339314">make</span><span class="op" id="2339318">(</span><span class="op" id="2339319">[</span><span class="op" id="2339320">]</span><span class="ident" id="2339321">FileInfo</span><span class="op" id="2339329">,</span>&nbsp;<span class="num" id="2339331">0</span><span class="op" id="2339332">,</span>&nbsp;<span class="builtinfunc" id="2339334">len</span><span class="op" id="2339337">(</span><span class="ident" id="2339338">names</span><span class="op" id="2339343">)</span><span class="op" id="2339344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339347">for</span>&nbsp;<span class="ident" id="2339351">_</span><span class="op" id="2339352">,</span>&nbsp;<span class="ident" id="2339354">filename</span>&nbsp;<span class="op" id="2339363">:=</span>&nbsp;<span class="keyword" id="2339366">range</span>&nbsp;<span class="ident" id="2339372">names</span>&nbsp;<span class="op" id="2339378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2339382">fip</span><span class="op" id="2339385">,</span>&nbsp;<span class="ident" id="2339387">lerr</span>&nbsp;<span class="op" id="2339392">:=</span>&nbsp;<span class="ident" id="2339395">lstat</span><span class="op" id="2339400">(</span><span class="ident" id="2339401">dirname</span>&nbsp;<span class="op" id="2339409">+</span>&nbsp;<span class="string" id="2339411">&#34;/&#34;</span>&nbsp;<span class="op" id="2339415">+</span>&nbsp;<span class="ident" id="2339417">filename</span><span class="op" id="2339425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339429">if</span>&nbsp;<span class="ident" id="2339432">IsNotExist</span><span class="op" id="2339442">(</span><span class="ident" id="2339443">lerr</span><span class="op" id="2339447">)</span>&nbsp;<span class="op" id="2339449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2339454">//&nbsp;File&nbsp;disappeared&nbsp;between&nbsp;readdir&nbsp;+&nbsp;stat.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2339501">//&nbsp;Just&nbsp;treat&nbsp;it&nbsp;as&nbsp;if&nbsp;it&nbsp;didn&#39;t&nbsp;exist.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339544">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2339555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339559">if</span>&nbsp;<span class="ident" id="2339562">lerr</span>&nbsp;<span class="op" id="2339567">!=</span>&nbsp;<span class="ident" id="2339570">nil</span>&nbsp;<span class="op" id="2339574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339579">return</span>&nbsp;<span class="ident" id="2339586">fi</span><span class="op" id="2339588">,</span>&nbsp;<span class="ident" id="2339590">lerr</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2339597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2339601">fi</span>&nbsp;<span class="op" id="2339604">=</span>&nbsp;<span class="builtinfunc" id="2339606">append</span><span class="op" id="2339612">(</span><span class="ident" id="2339613">fi</span><span class="op" id="2339615">,</span>&nbsp;<span class="ident" id="2339617">fip</span><span class="op" id="2339620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2339623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2339626">return</span>&nbsp;<span class="ident" id="2339633">fi</span><span class="op" id="2339635">,</span>&nbsp;<span class="ident" id="2339637">err</span><br>
<span class="lineno"></span><span class="op" id="2339641">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="2339644">//&nbsp;Darwin&nbsp;and&nbsp;FreeBSD&nbsp;can&#39;t&nbsp;read&nbsp;or&nbsp;write&nbsp;2GB+&nbsp;at&nbsp;a&nbsp;time,</span><br>
<span class="lineno"></span><span class="comment" id="2339702">//&nbsp;even&nbsp;on&nbsp;64-bit&nbsp;systems.&nbsp;See&nbsp;golang.org/issue/7812.</span><br>
<span class="lineno"></span><span class="comment" id="2339756">//&nbsp;Use&nbsp;1GB&nbsp;instead&nbsp;of,&nbsp;say,&nbsp;2GB-1,&nbsp;to&nbsp;keep&nbsp;subsequent</span><br>
<span class="lineno"></span><span class="comment" id="2339810">//&nbsp;reads&nbsp;aligned.</span><br>
<span class="lineno">180</span><span class="keyword" id="2339828">const</span>&nbsp;<span class="op" id="2339834">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2339837">needsMaxRW</span>&nbsp;<span class="op" id="2339848">=</span>&nbsp;<span class="ident" id="2339850">runtime</span><span class="op" id="2339857">.</span><span class="ident" id="2339858">GOOS</span>&nbsp;<span class="op" id="2339863">==</span>&nbsp;<span class="string" id="2339866">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2339875">||</span>&nbsp;<span class="ident" id="2339878">runtime</span><span class="op" id="2339885">.</span><span class="ident" id="2339886">GOOS</span>&nbsp;<span class="op" id="2339891">==</span>&nbsp;<span class="string" id="2339894">&#34;freebsd&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2339905">maxRW</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2339916">=</span>&nbsp;<span class="num" id="2339918">1</span>&nbsp;<span class="op" id="2339920">&lt;&lt;</span>&nbsp;<span class="num" id="2339923">30</span><br>
<span class="lineno"></span><span class="op" id="2339926">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="2339929">//&nbsp;read&nbsp;reads&nbsp;up&nbsp;to&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File.</span><br>
<span class="lineno"></span><span class="comment" id="2339977">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2340038">func</span>&nbsp;<span class="op" id="2340043">(</span><span class="ident" id="2340044">f</span>&nbsp;<span class="op" id="2340046">*</span><span class="ident" id="2340047">File</span><span class="op" id="2340051">)</span>&nbsp;<span class="ident" id="2340053">read</span><span class="op" id="2340057">(</span><span class="ident" id="2340058">b</span>&nbsp;<span class="op" id="2340060">[</span><span class="op" id="2340061">]</span><span class="builtintype" id="2340062">byte</span><span class="op" id="2340066">)</span>&nbsp;<span class="op" id="2340068">(</span><span class="ident" id="2340069">n</span>&nbsp;<span class="builtintype" id="2340071">int</span><span class="op" id="2340074">,</span>&nbsp;<span class="ident" id="2340076">err</span>&nbsp;<span class="builtintype" id="2340080">error</span><span class="op" id="2340085">)</span>&nbsp;<span class="op" id="2340087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2340090">if</span>&nbsp;<span class="ident" id="2340093">needsMaxRW</span>&nbsp;<span class="op" id="2340104">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2340107">len</span><span class="op" id="2340110">(</span><span class="ident" id="2340111">b</span><span class="op" id="2340112">)</span>&nbsp;<span class="op" id="2340114">&gt;</span>&nbsp;<span class="ident" id="2340116">maxRW</span>&nbsp;<span class="op" id="2340122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2340126">b</span>&nbsp;<span class="op" id="2340128">=</span>&nbsp;<span class="ident" id="2340130">b</span><span class="op" id="2340131">[</span><span class="op" id="2340132">:</span><span class="ident" id="2340133">maxRW</span><span class="op" id="2340138">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2340141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2340144">return</span>&nbsp;<span class="ident" id="2340151">fixCount</span><span class="op" id="2340159">(</span><span class="ident" id="2340160">syscall</span><span class="op" id="2340167">.</span><span class="ident" id="2340168">Read</span><span class="op" id="2340172">(</span><span class="ident" id="2340173">f</span><span class="op" id="2340174">.</span><span class="ident" id="2340175">fd</span><span class="op" id="2340177">,</span>&nbsp;<span class="ident" id="2340179">b</span><span class="op" id="2340180">)</span><span class="op" id="2340181">)</span><br>
<span class="lineno"></span><span class="op" id="2340183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2340186">//&nbsp;pread&nbsp;reads&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno">195</span><span class="comment" id="2340257">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;the&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="2340319">//&nbsp;EOF&nbsp;is&nbsp;signaled&nbsp;by&nbsp;a&nbsp;zero&nbsp;count&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2340375">func</span>&nbsp;<span class="op" id="2340380">(</span><span class="ident" id="2340381">f</span>&nbsp;<span class="op" id="2340383">*</span><span class="ident" id="2340384">File</span><span class="op" id="2340388">)</span>&nbsp;<span class="ident" id="2340390">pread</span><span class="op" id="2340395">(</span><span class="ident" id="2340396">b</span>&nbsp;<span class="op" id="2340398">[</span><span class="op" id="2340399">]</span><span class="builtintype" id="2340400">byte</span><span class="op" id="2340404">,</span>&nbsp;<span class="ident" id="2340406">off</span>&nbsp;<span class="ident" id="2340410">int64</span><span class="op" id="2340415">)</span>&nbsp;<span class="op" id="2340417">(</span><span class="ident" id="2340418">n</span>&nbsp;<span class="builtintype" id="2340420">int</span><span class="op" id="2340423">,</span>&nbsp;<span class="ident" id="2340425">err</span>&nbsp;<span class="builtintype" id="2340429">error</span><span class="op" id="2340434">)</span>&nbsp;<span class="op" id="2340436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2340439">if</span>&nbsp;<span class="ident" id="2340442">needsMaxRW</span>&nbsp;<span class="op" id="2340453">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2340456">len</span><span class="op" id="2340459">(</span><span class="ident" id="2340460">b</span><span class="op" id="2340461">)</span>&nbsp;<span class="op" id="2340463">&gt;</span>&nbsp;<span class="ident" id="2340465">maxRW</span>&nbsp;<span class="op" id="2340471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2340475">b</span>&nbsp;<span class="op" id="2340477">=</span>&nbsp;<span class="ident" id="2340479">b</span><span class="op" id="2340480">[</span><span class="op" id="2340481">:</span><span class="ident" id="2340482">maxRW</span><span class="op" id="2340487">]</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2340490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2340493">return</span>&nbsp;<span class="ident" id="2340500">fixCount</span><span class="op" id="2340508">(</span><span class="ident" id="2340509">syscall</span><span class="op" id="2340516">.</span><span class="ident" id="2340517">Pread</span><span class="op" id="2340522">(</span><span class="ident" id="2340523">f</span><span class="op" id="2340524">.</span><span class="ident" id="2340525">fd</span><span class="op" id="2340527">,</span>&nbsp;<span class="ident" id="2340529">b</span><span class="op" id="2340530">,</span>&nbsp;<span class="ident" id="2340532">off</span><span class="op" id="2340535">)</span><span class="op" id="2340536">)</span><br>
<span class="lineno"></span><span class="op" id="2340538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2340541">//&nbsp;write&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File.</span><br>
<span class="lineno">205</span><span class="comment" id="2340583">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2340647">func</span>&nbsp;<span class="op" id="2340652">(</span><span class="ident" id="2340653">f</span>&nbsp;<span class="op" id="2340655">*</span><span class="ident" id="2340656">File</span><span class="op" id="2340660">)</span>&nbsp;<span class="ident" id="2340662">write</span><span class="op" id="2340667">(</span><span class="ident" id="2340668">b</span>&nbsp;<span class="op" id="2340670">[</span><span class="op" id="2340671">]</span><span class="builtintype" id="2340672">byte</span><span class="op" id="2340676">)</span>&nbsp;<span class="op" id="2340678">(</span><span class="ident" id="2340679">n</span>&nbsp;<span class="builtintype" id="2340681">int</span><span class="op" id="2340684">,</span>&nbsp;<span class="ident" id="2340686">err</span>&nbsp;<span class="builtintype" id="2340690">error</span><span class="op" id="2340695">)</span>&nbsp;<span class="op" id="2340697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2340700">for</span>&nbsp;<span class="op" id="2340704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2340708">bcap</span>&nbsp;<span class="op" id="2340713">:=</span>&nbsp;<span class="ident" id="2340716">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2340720">if</span>&nbsp;<span class="ident" id="2340723">needsMaxRW</span>&nbsp;<span class="op" id="2340734">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2340737">len</span><span class="op" id="2340740">(</span><span class="ident" id="2340741">bcap</span><span class="op" id="2340745">)</span>&nbsp;<span class="op" id="2340747">&gt;</span>&nbsp;<span class="ident" id="2340749">maxRW</span>&nbsp;<span class="op" id="2340755">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2340760">bcap</span>&nbsp;<span class="op" id="2340765">=</span>&nbsp;<span class="ident" id="2340767">bcap</span><span class="op" id="2340771">[</span><span class="op" id="2340772">:</span><span class="ident" id="2340773">maxRW</span><span class="op" id="2340778">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2340782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2340786">m</span><span class="op" id="2340787">,</span>&nbsp;<span class="ident" id="2340789">err</span>&nbsp;<span class="op" id="2340793">:=</span>&nbsp;<span class="ident" id="2340796">fixCount</span><span class="op" id="2340804">(</span><span class="ident" id="2340805">syscall</span><span class="op" id="2340812">.</span><span class="ident" id="2340813">Write</span><span class="op" id="2340818">(</span><span class="ident" id="2340819">f</span><span class="op" id="2340820">.</span><span class="ident" id="2340821">fd</span><span class="op" id="2340823">,</span>&nbsp;<span class="ident" id="2340825">bcap</span><span class="op" id="2340829">)</span><span class="op" id="2340830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2340834">n</span>&nbsp;<span class="op" id="2340836">+=</span>&nbsp;<span class="ident" id="2340839">m</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2340844">//&nbsp;If&nbsp;the&nbsp;syscall&nbsp;wrote&nbsp;some&nbsp;data&nbsp;but&nbsp;not&nbsp;all&nbsp;(short&nbsp;write)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2340906">//&nbsp;or&nbsp;it&nbsp;returned&nbsp;EINTR,&nbsp;then&nbsp;assume&nbsp;it&nbsp;stopped&nbsp;early&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2340966">//&nbsp;reasons&nbsp;that&nbsp;are&nbsp;uninteresting&nbsp;to&nbsp;the&nbsp;caller,&nbsp;and&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2341032">if</span>&nbsp;<span class="num" id="2341035">0</span>&nbsp;<span class="op" id="2341037">&lt;</span>&nbsp;<span class="ident" id="2341039">m</span>&nbsp;<span class="op" id="2341041">&amp;&amp;</span>&nbsp;<span class="ident" id="2341044">m</span>&nbsp;<span class="op" id="2341046">&lt;</span>&nbsp;<span class="builtinfunc" id="2341048">len</span><span class="op" id="2341051">(</span><span class="ident" id="2341052">bcap</span><span class="op" id="2341056">)</span>&nbsp;<span class="op" id="2341058">||</span>&nbsp;<span class="ident" id="2341061">err</span>&nbsp;<span class="op" id="2341065">==</span>&nbsp;<span class="ident" id="2341068">syscall</span><span class="op" id="2341075">.</span><span class="ident" id="2341076">EINTR</span>&nbsp;<span class="op" id="2341082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2341087">b</span>&nbsp;<span class="op" id="2341089">=</span>&nbsp;<span class="ident" id="2341091">b</span><span class="op" id="2341092">[</span><span class="ident" id="2341093">m</span><span class="op" id="2341094">:</span><span class="op" id="2341095">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2341100">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2341111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2341116">if</span>&nbsp;<span class="ident" id="2341119">needsMaxRW</span>&nbsp;<span class="op" id="2341130">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2341133">len</span><span class="op" id="2341136">(</span><span class="ident" id="2341137">bcap</span><span class="op" id="2341141">)</span>&nbsp;<span class="op" id="2341143">!=</span>&nbsp;<span class="builtinfunc" id="2341146">len</span><span class="op" id="2341149">(</span><span class="ident" id="2341150">b</span><span class="op" id="2341151">)</span>&nbsp;<span class="op" id="2341153">&amp;&amp;</span>&nbsp;<span class="ident" id="2341156">err</span>&nbsp;<span class="op" id="2341160">==</span>&nbsp;<span class="ident" id="2341163">nil</span>&nbsp;<span class="op" id="2341167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2341172">b</span>&nbsp;<span class="op" id="2341174">=</span>&nbsp;<span class="ident" id="2341176">b</span><span class="op" id="2341177">[</span><span class="ident" id="2341178">m</span><span class="op" id="2341179">:</span><span class="op" id="2341180">]</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2341185">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2341196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2341201">return</span>&nbsp;<span class="ident" id="2341208">n</span><span class="op" id="2341209">,</span>&nbsp;<span class="ident" id="2341211">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2341216">}</span><br>
<span class="lineno">230</span><span class="op" id="2341218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2341221">//&nbsp;pwrite&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno"></span><span class="comment" id="2341292">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2341356">func</span>&nbsp;<span class="op" id="2341361">(</span><span class="ident" id="2341362">f</span>&nbsp;<span class="op" id="2341364">*</span><span class="ident" id="2341365">File</span><span class="op" id="2341369">)</span>&nbsp;<span class="ident" id="2341371">pwrite</span><span class="op" id="2341377">(</span><span class="ident" id="2341378">b</span>&nbsp;<span class="op" id="2341380">[</span><span class="op" id="2341381">]</span><span class="builtintype" id="2341382">byte</span><span class="op" id="2341386">,</span>&nbsp;<span class="ident" id="2341388">off</span>&nbsp;<span class="ident" id="2341392">int64</span><span class="op" id="2341397">)</span>&nbsp;<span class="op" id="2341399">(</span><span class="ident" id="2341400">n</span>&nbsp;<span class="builtintype" id="2341402">int</span><span class="op" id="2341405">,</span>&nbsp;<span class="ident" id="2341407">err</span>&nbsp;<span class="builtintype" id="2341411">error</span><span class="op" id="2341416">)</span>&nbsp;<span class="op" id="2341418">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2341421">if</span>&nbsp;<span class="ident" id="2341424">needsMaxRW</span>&nbsp;<span class="op" id="2341435">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2341438">len</span><span class="op" id="2341441">(</span><span class="ident" id="2341442">b</span><span class="op" id="2341443">)</span>&nbsp;<span class="op" id="2341445">&gt;</span>&nbsp;<span class="ident" id="2341447">maxRW</span>&nbsp;<span class="op" id="2341453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2341457">b</span>&nbsp;<span class="op" id="2341459">=</span>&nbsp;<span class="ident" id="2341461">b</span><span class="op" id="2341462">[</span><span class="op" id="2341463">:</span><span class="ident" id="2341464">maxRW</span><span class="op" id="2341469">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2341472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2341475">return</span>&nbsp;<span class="ident" id="2341482">fixCount</span><span class="op" id="2341490">(</span><span class="ident" id="2341491">syscall</span><span class="op" id="2341498">.</span><span class="ident" id="2341499">Pwrite</span><span class="op" id="2341505">(</span><span class="ident" id="2341506">f</span><span class="op" id="2341507">.</span><span class="ident" id="2341508">fd</span><span class="op" id="2341510">,</span>&nbsp;<span class="ident" id="2341512">b</span><span class="op" id="2341513">,</span>&nbsp;<span class="ident" id="2341515">off</span><span class="op" id="2341518">)</span><span class="op" id="2341519">)</span><br>
<span class="lineno"></span><span class="op" id="2341521">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="2341524">//&nbsp;seek&nbsp;sets&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;Read&nbsp;or&nbsp;Write&nbsp;on&nbsp;file&nbsp;to&nbsp;offset,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="2341606">//&nbsp;according&nbsp;to&nbsp;whence:&nbsp;0&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;origin&nbsp;of&nbsp;the&nbsp;file,&nbsp;1&nbsp;means</span><br>
<span class="lineno"></span><span class="comment" id="2341682">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;offset,&nbsp;and&nbsp;2&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span><span class="comment" id="2341750">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;new&nbsp;offset&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">245</span><span class="keyword" id="2341801">func</span>&nbsp;<span class="op" id="2341806">(</span><span class="ident" id="2341807">f</span>&nbsp;<span class="op" id="2341809">*</span><span class="ident" id="2341810">File</span><span class="op" id="2341814">)</span>&nbsp;<span class="ident" id="2341816">seek</span><span class="op" id="2341820">(</span><span class="ident" id="2341821">offset</span>&nbsp;<span class="ident" id="2341828">int64</span><span class="op" id="2341833">,</span>&nbsp;<span class="ident" id="2341835">whence</span>&nbsp;<span class="builtintype" id="2341842">int</span><span class="op" id="2341845">)</span>&nbsp;<span class="op" id="2341847">(</span><span class="ident" id="2341848">ret</span>&nbsp;<span class="ident" id="2341852">int64</span><span class="op" id="2341857">,</span>&nbsp;<span class="ident" id="2341859">err</span>&nbsp;<span class="builtintype" id="2341863">error</span><span class="op" id="2341868">)</span>&nbsp;<span class="op" id="2341870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2341873">return</span>&nbsp;<span class="ident" id="2341880">syscall</span><span class="op" id="2341887">.</span><span class="ident" id="2341888">Seek</span><span class="op" id="2341892">(</span><span class="ident" id="2341893">f</span><span class="op" id="2341894">.</span><span class="ident" id="2341895">fd</span><span class="op" id="2341897">,</span>&nbsp;<span class="ident" id="2341899">offset</span><span class="op" id="2341905">,</span>&nbsp;<span class="ident" id="2341907">whence</span><span class="op" id="2341913">)</span><br>
<span class="lineno"></span><span class="op" id="2341915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2341918">//&nbsp;Truncate&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno">250</span><span class="comment" id="2341966">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;it&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;link&#39;s&nbsp;target.</span><br>
<span class="lineno"></span><span class="comment" id="2342043">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2342099">func</span>&nbsp;<span class="ident" id="2342104">Truncate</span><span class="op" id="2342112">(</span><span class="ident" id="2342113">name</span>&nbsp;<span class="builtintype" id="2342118">string</span><span class="op" id="2342124">,</span>&nbsp;<span class="ident" id="2342126">size</span>&nbsp;<span class="ident" id="2342131">int64</span><span class="op" id="2342136">)</span>&nbsp;<span class="builtintype" id="2342138">error</span>&nbsp;<span class="op" id="2342144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342147">if</span>&nbsp;<span class="ident" id="2342150">e</span>&nbsp;<span class="op" id="2342152">:=</span>&nbsp;<span class="ident" id="2342155">syscall</span><span class="op" id="2342162">.</span><span class="ident" id="2342163">Truncate</span><span class="op" id="2342171">(</span><span class="ident" id="2342172">name</span><span class="op" id="2342176">,</span>&nbsp;<span class="ident" id="2342178">size</span><span class="op" id="2342182">)</span><span class="op" id="2342183">;</span>&nbsp;<span class="ident" id="2342185">e</span>&nbsp;<span class="op" id="2342187">!=</span>&nbsp;<span class="ident" id="2342190">nil</span>&nbsp;<span class="op" id="2342194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342198">return</span>&nbsp;<span class="op" id="2342205">&amp;</span><span class="ident" id="2342206">PathError</span><span class="op" id="2342215">{</span><span class="string" id="2342216">&#34;truncate&#34;</span><span class="op" id="2342226">,</span>&nbsp;<span class="ident" id="2342228">name</span><span class="op" id="2342232">,</span>&nbsp;<span class="ident" id="2342234">e</span><span class="op" id="2342235">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2342238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342241">return</span>&nbsp;<span class="ident" id="2342248">nil</span><br>
<span class="lineno"></span><span class="op" id="2342252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2342255">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;named&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno">260</span><span class="comment" id="2342302">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2342358">func</span>&nbsp;<span class="ident" id="2342363">Remove</span><span class="op" id="2342369">(</span><span class="ident" id="2342370">name</span>&nbsp;<span class="builtintype" id="2342375">string</span><span class="op" id="2342381">)</span>&nbsp;<span class="builtintype" id="2342383">error</span>&nbsp;<span class="op" id="2342389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2342392">//&nbsp;System&nbsp;call&nbsp;interface&nbsp;forces&nbsp;us&nbsp;to&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2342436">//&nbsp;whether&nbsp;name&nbsp;is&nbsp;a&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2342477">//&nbsp;Try&nbsp;both:&nbsp;it&nbsp;is&nbsp;cheaper&nbsp;on&nbsp;average&nbsp;than</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2342521">//&nbsp;doing&nbsp;a&nbsp;Stat&nbsp;plus&nbsp;the&nbsp;right&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2342558">e</span>&nbsp;<span class="op" id="2342560">:=</span>&nbsp;<span class="ident" id="2342563">syscall</span><span class="op" id="2342570">.</span><span class="ident" id="2342571">Unlink</span><span class="op" id="2342577">(</span><span class="ident" id="2342578">name</span><span class="op" id="2342582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342585">if</span>&nbsp;<span class="ident" id="2342588">e</span>&nbsp;<span class="op" id="2342590">==</span>&nbsp;<span class="ident" id="2342593">nil</span>&nbsp;<span class="op" id="2342597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342601">return</span>&nbsp;<span class="ident" id="2342608">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2342613">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2342616">e1</span>&nbsp;<span class="op" id="2342619">:=</span>&nbsp;<span class="ident" id="2342622">syscall</span><span class="op" id="2342629">.</span><span class="ident" id="2342630">Rmdir</span><span class="op" id="2342635">(</span><span class="ident" id="2342636">name</span><span class="op" id="2342640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342643">if</span>&nbsp;<span class="ident" id="2342646">e1</span>&nbsp;<span class="op" id="2342649">==</span>&nbsp;<span class="ident" id="2342652">nil</span>&nbsp;<span class="op" id="2342656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2342660">return</span>&nbsp;<span class="ident" id="2342667">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2342672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2342676">//&nbsp;Both&nbsp;failed:&nbsp;figure&nbsp;out&nbsp;which&nbsp;error&nbsp;to&nbsp;return.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2342727">//&nbsp;OS&nbsp;X&nbsp;and&nbsp;Linux&nbsp;differ&nbsp;on&nbsp;whether&nbsp;unlink(dir)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2342776">//&nbsp;returns&nbsp;EISDIR,&nbsp;so&nbsp;can&#39;t&nbsp;use&nbsp;that.&nbsp;&nbsp;However,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2342825">//&nbsp;both&nbsp;agree&nbsp;that&nbsp;rmdir(file)&nbsp;returns&nbsp;ENOTDIR,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2342874">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;that&nbsp;to&nbsp;decide&nbsp;which&nbsp;error&nbsp;is&nbsp;real.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2342928">//&nbsp;Rmdir&nbsp;might&nbsp;also&nbsp;return&nbsp;ENOTDIR&nbsp;if&nbsp;given&nbsp;a&nbsp;bad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2342979">//&nbsp;file&nbsp;path,&nbsp;like&nbsp;/etc/passwd/foo,&nbsp;but&nbsp;in&nbsp;that&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2343034">//&nbsp;both&nbsp;errors&nbsp;will&nbsp;be&nbsp;ENOTDIR,&nbsp;so&nbsp;it&#39;s&nbsp;okay&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2343083">//&nbsp;use&nbsp;the&nbsp;error&nbsp;from&nbsp;unlink.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343114">if</span>&nbsp;<span class="ident" id="2343117">e1</span>&nbsp;<span class="op" id="2343120">!=</span>&nbsp;<span class="ident" id="2343123">syscall</span><span class="op" id="2343130">.</span><span class="ident" id="2343131">ENOTDIR</span>&nbsp;<span class="op" id="2343139">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2343143">e</span>&nbsp;<span class="op" id="2343145">=</span>&nbsp;<span class="ident" id="2343147">e1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2343151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343154">return</span>&nbsp;<span class="op" id="2343161">&amp;</span><span class="ident" id="2343162">PathError</span><span class="op" id="2343171">{</span><span class="string" id="2343172">&#34;remove&#34;</span><span class="op" id="2343180">,</span>&nbsp;<span class="ident" id="2343182">name</span><span class="op" id="2343186">,</span>&nbsp;<span class="ident" id="2343188">e</span><span class="op" id="2343189">}</span><br>
<span class="lineno"></span><span class="op" id="2343191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="2343194">//&nbsp;basename&nbsp;removes&nbsp;trailing&nbsp;slashes&nbsp;and&nbsp;the&nbsp;leading&nbsp;directory&nbsp;name&nbsp;from&nbsp;path&nbsp;name</span><br>
<span class="lineno"></span><span class="keyword" id="2343277">func</span>&nbsp;<span class="ident" id="2343282">basename</span><span class="op" id="2343290">(</span><span class="ident" id="2343291">name</span>&nbsp;<span class="builtintype" id="2343296">string</span><span class="op" id="2343302">)</span>&nbsp;<span class="builtintype" id="2343304">string</span>&nbsp;<span class="op" id="2343311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2343314">i</span>&nbsp;<span class="op" id="2343316">:=</span>&nbsp;<span class="builtinfunc" id="2343319">len</span><span class="op" id="2343322">(</span><span class="ident" id="2343323">name</span><span class="op" id="2343327">)</span>&nbsp;<span class="op" id="2343329">-</span>&nbsp;<span class="num" id="2343331">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2343334">//&nbsp;Remove&nbsp;trailing&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343362">for</span>&nbsp;<span class="op" id="2343366">;</span>&nbsp;<span class="ident" id="2343368">i</span>&nbsp;<span class="op" id="2343370">&gt;</span>&nbsp;<span class="num" id="2343372">0</span>&nbsp;<span class="op" id="2343374">&amp;&amp;</span>&nbsp;<span class="ident" id="2343377">name</span><span class="op" id="2343381">[</span><span class="ident" id="2343382">i</span><span class="op" id="2343383">]</span>&nbsp;<span class="op" id="2343385">==</span>&nbsp;<span class="string" id="2343388">&#39;/&#39;</span><span class="op" id="2343391">;</span>&nbsp;<span class="ident" id="2343393">i</span><span class="op" id="2343394">--</span>&nbsp;<span class="op" id="2343397">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2343401">name</span>&nbsp;<span class="op" id="2343406">=</span>&nbsp;<span class="ident" id="2343408">name</span><span class="op" id="2343412">[</span><span class="op" id="2343413">:</span><span class="ident" id="2343414">i</span><span class="op" id="2343415">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2343418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2343421">//&nbsp;Remove&nbsp;leading&nbsp;directory&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343455">for</span>&nbsp;<span class="ident" id="2343459">i</span><span class="op" id="2343460">--</span><span class="op" id="2343462">;</span>&nbsp;<span class="ident" id="2343464">i</span>&nbsp;<span class="op" id="2343466">&gt;=</span>&nbsp;<span class="num" id="2343469">0</span><span class="op" id="2343470">;</span>&nbsp;<span class="ident" id="2343472">i</span><span class="op" id="2343473">--</span>&nbsp;<span class="op" id="2343476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343480">if</span>&nbsp;<span class="ident" id="2343483">name</span><span class="op" id="2343487">[</span><span class="ident" id="2343488">i</span><span class="op" id="2343489">]</span>&nbsp;<span class="op" id="2343491">==</span>&nbsp;<span class="string" id="2343494">&#39;/&#39;</span>&nbsp;<span class="op" id="2343498">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2343503">name</span>&nbsp;<span class="op" id="2343508">=</span>&nbsp;<span class="ident" id="2343510">name</span><span class="op" id="2343514">[</span><span class="ident" id="2343515">i</span><span class="op" id="2343516">+</span><span class="num" id="2343517">1</span><span class="op" id="2343518">:</span><span class="op" id="2343519">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343524">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2343532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2343535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343539">return</span>&nbsp;<span class="ident" id="2343546">name</span><br>
<span class="lineno"></span><span class="op" id="2343551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2343554">//&nbsp;TempDir&nbsp;returns&nbsp;the&nbsp;default&nbsp;directory&nbsp;to&nbsp;use&nbsp;for&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="keyword" id="2343623">func</span>&nbsp;<span class="ident" id="2343628">TempDir</span><span class="op" id="2343635">(</span><span class="op" id="2343636">)</span>&nbsp;<span class="builtintype" id="2343638">string</span>&nbsp;<span class="op" id="2343645">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2343648">dir</span>&nbsp;<span class="op" id="2343652">:=</span>&nbsp;<span class="ident" id="2343655">Getenv</span><span class="op" id="2343661">(</span><span class="string" id="2343662">&#34;TMPDIR&#34;</span><span class="op" id="2343670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343673">if</span>&nbsp;<span class="ident" id="2343676">dir</span>&nbsp;<span class="op" id="2343680">==</span>&nbsp;<span class="string" id="2343683">&#34;&#34;</span>&nbsp;<span class="op" id="2343686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343690">if</span>&nbsp;<span class="ident" id="2343693">runtime</span><span class="op" id="2343700">.</span><span class="ident" id="2343701">GOOS</span>&nbsp;<span class="op" id="2343706">==</span>&nbsp;<span class="string" id="2343709">&#34;android&#34;</span>&nbsp;<span class="op" id="2343719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2343724">dir</span>&nbsp;<span class="op" id="2343728">=</span>&nbsp;<span class="string" id="2343730">&#34;/data/local/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2343750">}</span>&nbsp;<span class="keyword" id="2343752">else</span>&nbsp;<span class="op" id="2343757">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2343762">dir</span>&nbsp;<span class="op" id="2343766">=</span>&nbsp;<span class="string" id="2343768">&#34;/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2343777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2343780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343783">return</span>&nbsp;<span class="ident" id="2343790">dir</span><br>
<span class="lineno"></span><span class="op" id="2343794">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2343797">//&nbsp;Link&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;hard&nbsp;link&nbsp;to&nbsp;the&nbsp;oldname&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2343857">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2343913">func</span>&nbsp;<span class="ident" id="2343918">Link</span><span class="op" id="2343922">(</span><span class="ident" id="2343923">oldname</span><span class="op" id="2343930">,</span>&nbsp;<span class="ident" id="2343932">newname</span>&nbsp;<span class="builtintype" id="2343940">string</span><span class="op" id="2343946">)</span>&nbsp;<span class="builtintype" id="2343948">error</span>&nbsp;<span class="op" id="2343954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2343957">e</span>&nbsp;<span class="op" id="2343959">:=</span>&nbsp;<span class="ident" id="2343962">syscall</span><span class="op" id="2343969">.</span><span class="ident" id="2343970">Link</span><span class="op" id="2343974">(</span><span class="ident" id="2343975">oldname</span><span class="op" id="2343982">,</span>&nbsp;<span class="ident" id="2343984">newname</span><span class="op" id="2343991">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2343994">if</span>&nbsp;<span class="ident" id="2343997">e</span>&nbsp;<span class="op" id="2343999">!=</span>&nbsp;<span class="ident" id="2344002">nil</span>&nbsp;<span class="op" id="2344006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344010">return</span>&nbsp;<span class="op" id="2344017">&amp;</span><span class="ident" id="2344018">LinkError</span><span class="op" id="2344027">{</span><span class="string" id="2344028">&#34;link&#34;</span><span class="op" id="2344034">,</span>&nbsp;<span class="ident" id="2344036">oldname</span><span class="op" id="2344043">,</span>&nbsp;<span class="ident" id="2344045">newname</span><span class="op" id="2344052">,</span>&nbsp;<span class="ident" id="2344054">e</span><span class="op" id="2344055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2344058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344061">return</span>&nbsp;<span class="ident" id="2344068">nil</span><br>
<span class="lineno"></span><span class="op" id="2344072">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="2344075">//&nbsp;Symlink&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;symbolic&nbsp;link&nbsp;to&nbsp;oldname.</span><br>
<span class="lineno"></span><span class="comment" id="2344133">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2344189">func</span>&nbsp;<span class="ident" id="2344194">Symlink</span><span class="op" id="2344201">(</span><span class="ident" id="2344202">oldname</span><span class="op" id="2344209">,</span>&nbsp;<span class="ident" id="2344211">newname</span>&nbsp;<span class="builtintype" id="2344219">string</span><span class="op" id="2344225">)</span>&nbsp;<span class="builtintype" id="2344227">error</span>&nbsp;<span class="op" id="2344233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2344236">e</span>&nbsp;<span class="op" id="2344238">:=</span>&nbsp;<span class="ident" id="2344241">syscall</span><span class="op" id="2344248">.</span><span class="ident" id="2344249">Symlink</span><span class="op" id="2344256">(</span><span class="ident" id="2344257">oldname</span><span class="op" id="2344264">,</span>&nbsp;<span class="ident" id="2344266">newname</span><span class="op" id="2344273">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344276">if</span>&nbsp;<span class="ident" id="2344279">e</span>&nbsp;<span class="op" id="2344281">!=</span>&nbsp;<span class="ident" id="2344284">nil</span>&nbsp;<span class="op" id="2344288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344292">return</span>&nbsp;<span class="op" id="2344299">&amp;</span><span class="ident" id="2344300">LinkError</span><span class="op" id="2344309">{</span><span class="string" id="2344310">&#34;symlink&#34;</span><span class="op" id="2344319">,</span>&nbsp;<span class="ident" id="2344321">oldname</span><span class="op" id="2344328">,</span>&nbsp;<span class="ident" id="2344330">newname</span><span class="op" id="2344337">,</span>&nbsp;<span class="ident" id="2344339">e</span><span class="op" id="2344340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2344343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2344346">return</span>&nbsp;<span class="ident" id="2344353">nil</span><br>
<span class="lineno"></span><span class="op" id="2344357">}</span>
</div>
</body>
</html>
