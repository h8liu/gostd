<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword">package</span>&nbsp;<span class="ident">des</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">import</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span><span class="op">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">cryptBlock</span><span class="op">(</span><span class="ident">subkeys</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">dst</span><span class="op">,</span>&nbsp;<span class="ident">src</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">decrypt</span>&nbsp;<span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">binary</span><span class="op">.</span><span class="ident">BigEndian</span><span class="op">.</span><span class="ident">Uint64</span><span class="op">(</span><span class="ident">src</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">permuteInitialBlock</span><span class="op">(</span><span class="ident">b</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">left</span><span class="op">,</span>&nbsp;<span class="ident">right</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">b</span><span class="op">&gt;&gt;</span><span class="num">32</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">b</span><span class="op">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">subkey</span>&nbsp;<span class="ident">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">16</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">decrypt</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">subkey</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">subkeys</span><span class="op">[</span><span class="num">15</span><span class="op">-</span><span class="ident">i</span><span class="op">]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">subkey</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">subkeys</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">left</span><span class="op">,</span>&nbsp;<span class="ident">right</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">right</span><span class="op">,</span>&nbsp;<span class="ident">left</span><span class="op">^</span><span class="ident">feistel</span><span class="op">(</span><span class="ident">right</span><span class="op">,</span>&nbsp;<span class="ident">subkey</span><span class="op">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;switch&nbsp;left&nbsp;&amp;&nbsp;right&nbsp;and&nbsp;perform&nbsp;final&nbsp;permutation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">preOutput</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="ident">uint64</span><span class="op">(</span><span class="ident">right</span><span class="op">)</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">32</span><span class="op">)</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">left</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">binary</span><span class="op">.</span><span class="ident">BigEndian</span><span class="op">.</span><span class="ident">PutUint64</span><span class="op">(</span><span class="ident">dst</span><span class="op">,</span>&nbsp;<span class="ident">permuteFinalBlock</span><span class="op">(</span><span class="ident">preOutput</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Encrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;subkeys.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">encryptBlock</span><span class="op">(</span><span class="ident">subkeys</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">dst</span><span class="op">,</span>&nbsp;<span class="ident">src</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">cryptBlock</span><span class="op">(</span><span class="ident">subkeys</span><span class="op">,</span>&nbsp;<span class="ident">dst</span><span class="op">,</span>&nbsp;<span class="ident">src</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Decrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;subkeys.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">decryptBlock</span><span class="op">(</span><span class="ident">subkeys</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">dst</span><span class="op">,</span>&nbsp;<span class="ident">src</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">cryptBlock</span><span class="op">(</span><span class="ident">subkeys</span><span class="op">,</span>&nbsp;<span class="ident">dst</span><span class="op">,</span>&nbsp;<span class="ident">src</span><span class="op">,</span>&nbsp;<span class="ident">true</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;DES&nbsp;Feistel&nbsp;function</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">feistel</span><span class="op">(</span><span class="ident">right</span>&nbsp;<span class="builtintype">uint32</span><span class="op">,</span>&nbsp;<span class="ident">key</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">result</span>&nbsp;<span class="builtintype">uint32</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sBoxLocations</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">key</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">expandBlock</span><span class="op">(</span><span class="ident">right</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">sBoxResult</span>&nbsp;<span class="builtintype">uint32</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">uint8</span><span class="op">(</span><span class="num">0</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sBoxLocation</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">uint8</span><span class="op">(</span><span class="ident">sBoxLocations</span><span class="op">&gt;&gt;</span><span class="num">42</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0x3f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sBoxLocations</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;row&nbsp;determined&nbsp;by&nbsp;1st&nbsp;and&nbsp;6th&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;column&nbsp;is&nbsp;middle&nbsp;four&nbsp;bits</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">row</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="ident">sBoxLocation</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0x1</span><span class="op">)</span>&nbsp;<span class="op">|</span>&nbsp;<span class="op">(</span><span class="op">(</span><span class="ident">sBoxLocation</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0x20</span><span class="op">)</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">4</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">column</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="ident">sBoxLocation</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">1</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0xf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sBoxResult</span>&nbsp;<span class="op">^=</span>&nbsp;<span class="ident">feistelBox</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">[</span><span class="num">16</span><span class="op">*</span><span class="ident">row</span><span class="op">+</span><span class="ident">column</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">sBoxResult</span><br>
<span class="lineno">55</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;feistelBox[s][16*i+j]&nbsp;contains&nbsp;the&nbsp;output&nbsp;of&nbsp;permutationFunction</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;for&nbsp;sBoxes[s][i][j]&nbsp;&lt;&lt;&nbsp;4*(7-s)</span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">feistelBox</span>&nbsp;<span class="op">[</span><span class="num">8</span><span class="op">]</span><span class="op">[</span><span class="num">64</span><span class="op">]</span><span class="builtintype">uint32</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;general&nbsp;purpose&nbsp;function&nbsp;to&nbsp;perform&nbsp;DES&nbsp;block&nbsp;permutations</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">permuteBlock</span><span class="op">(</span><span class="ident">src</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">permutation</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">uint8</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">block</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">position</span><span class="op">,</span>&nbsp;<span class="ident">n</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="keyword">range</span>&nbsp;<span class="ident">permutation</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">bit</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="ident">src</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="ident">n</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">block</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">bit</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="builtintype">uint</span><span class="op">(</span><span class="op">(</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">permutation</span><span class="op">)</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="op">-</span><span class="ident">position</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword">func</span>&nbsp;<span class="ident">init</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">s</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="keyword">range</span>&nbsp;<span class="ident">sBoxes</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">4</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">j</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">j</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">16</span><span class="op">;</span>&nbsp;<span class="ident">j</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">sBoxes</span><span class="op">[</span><span class="ident">s</span><span class="op">]</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">[</span><span class="ident">j</span><span class="op">]</span><span class="op">)</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="op">(</span><span class="num">4</span>&nbsp;<span class="op">*</span>&nbsp;<span class="op">(</span><span class="num">7</span>&nbsp;<span class="op">-</span>&nbsp;<span class="builtintype">uint</span><span class="op">(</span><span class="ident">s</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">permuteBlock</span><span class="op">(</span><span class="ident">uint64</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">permutationFunction</span><span class="op">[</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">feistelBox</span><span class="op">[</span><span class="ident">s</span><span class="op">]</span><span class="op">[</span><span class="num">16</span><span class="op">*</span><span class="ident">i</span><span class="op">+</span><span class="ident">j</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">80</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;expandBlock&nbsp;expands&nbsp;an&nbsp;input&nbsp;block&nbsp;of&nbsp;32&nbsp;bits,</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;producing&nbsp;an&nbsp;output&nbsp;block&nbsp;of&nbsp;48&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">expandBlock</span><span class="op">(</span><span class="ident">src</span>&nbsp;<span class="builtintype">uint32</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">block</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;rotate&nbsp;the&nbsp;5&nbsp;highest&nbsp;bits&nbsp;to&nbsp;the&nbsp;right.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">src</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">(</span><span class="ident">src</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">5</span><span class="op">)</span>&nbsp;<span class="op">|</span>&nbsp;<span class="op">(</span><span class="ident">src</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">27</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">block</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;take&nbsp;the&nbsp;6&nbsp;bits&nbsp;on&nbsp;the&nbsp;right</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">block</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">src</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">6</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;advance&nbsp;by&nbsp;4&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">src</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">(</span><span class="ident">src</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">4</span><span class="op">)</span>&nbsp;<span class="op">|</span>&nbsp;<span class="op">(</span><span class="ident">src</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">28</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno">95</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;permuteInitialBlock&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;permutation&nbsp;defined</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;by&nbsp;initialPermutation.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">permuteInitialBlock</span><span class="op">(</span><span class="ident">block</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="ident">uint64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;block&nbsp;=&nbsp;b7&nbsp;b6&nbsp;b5&nbsp;b4&nbsp;b3&nbsp;b2&nbsp;b1&nbsp;b0&nbsp;(8&nbsp;bytes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">block</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b2</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">block</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">block</span>&nbsp;<span class="op">^=</span>&nbsp;<span class="ident">b1</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b2</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b1</span><span class="op">&lt;&lt;</span><span class="num">48</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b2</span><span class="op">&gt;&gt;</span><span class="num">48</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;block&nbsp;=&nbsp;b1&nbsp;b0&nbsp;b5&nbsp;b4&nbsp;b3&nbsp;b2&nbsp;b7&nbsp;b6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b1</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">block</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">32</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0xff00ff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b2</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">(</span><span class="ident">block</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0xff00ff00</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">block</span>&nbsp;<span class="op">^=</span>&nbsp;<span class="ident">b1</span><span class="op">&lt;&lt;</span><span class="num">32</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b2</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b1</span><span class="op">&lt;&lt;</span><span class="num">8</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b2</span><span class="op">&lt;&lt;</span><span class="num">24</span>&nbsp;<span class="comment">//&nbsp;exchange&nbsp;b0&nbsp;b4&nbsp;with&nbsp;b3&nbsp;b7</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;block&nbsp;is&nbsp;now&nbsp;b1&nbsp;b3&nbsp;b5&nbsp;b7&nbsp;b0&nbsp;b2&nbsp;b4&nbsp;b7,&nbsp;the&nbsp;permutation:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;56</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;7&nbsp;&nbsp;6&nbsp;&nbsp;5&nbsp;&nbsp;4&nbsp;&nbsp;3&nbsp;&nbsp;2&nbsp;&nbsp;1&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;23&nbsp;22&nbsp;21&nbsp;20&nbsp;19&nbsp;18&nbsp;17&nbsp;16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;48</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;exchange&nbsp;4,5,6,7&nbsp;with&nbsp;32,33,34,35&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b1</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">block</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0x0f0f00000f0f0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b2</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">block</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0x0000f0f00000f0f0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">block</span>&nbsp;<span class="op">^=</span>&nbsp;<span class="ident">b1</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b2</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b1</span><span class="op">&gt;&gt;</span><span class="num">12</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b2</span><span class="op">&lt;&lt;</span><span class="num">12</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;block&nbsp;is&nbsp;the&nbsp;permutation:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;[+8]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[+40]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;7&nbsp;&nbsp;6&nbsp;&nbsp;5&nbsp;&nbsp;4</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;23&nbsp;22&nbsp;21&nbsp;20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;3&nbsp;&nbsp;2&nbsp;&nbsp;1&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;19&nbsp;18&nbsp;17&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;[+32]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;exchange&nbsp;0,1,4,5&nbsp;with&nbsp;18,19,22,23</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b1</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">block</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0x3300330033003300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b2</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">block</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0x00cc00cc00cc00cc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">block</span>&nbsp;<span class="op">^=</span>&nbsp;<span class="ident">b1</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b2</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b1</span><span class="op">&gt;&gt;</span><span class="num">6</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b2</span><span class="op">&lt;&lt;</span><span class="num">6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;block&nbsp;is&nbsp;the&nbsp;permutation:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;15&nbsp;14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;13&nbsp;12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;11&nbsp;10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;9&nbsp;&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;7&nbsp;&nbsp;6</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;5&nbsp;&nbsp;4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;3&nbsp;&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;[+16]&nbsp;[+32]&nbsp;[+64]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;exchange&nbsp;0,2,4,6&nbsp;with&nbsp;9,11,13,15:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b1</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">block</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0xaaaaaaaa55555555</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">block</span>&nbsp;<span class="op">^=</span>&nbsp;<span class="ident">b1</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b1</span><span class="op">&gt;&gt;</span><span class="num">33</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b1</span><span class="op">&lt;&lt;</span><span class="num">33</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;block&nbsp;is&nbsp;the&nbsp;permutation:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;6&nbsp;14&nbsp;22&nbsp;30&nbsp;38&nbsp;46&nbsp;54&nbsp;62</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;4&nbsp;12&nbsp;20&nbsp;28&nbsp;36&nbsp;44&nbsp;52&nbsp;60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;2&nbsp;10&nbsp;18&nbsp;26&nbsp;34&nbsp;42&nbsp;50&nbsp;58</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;0&nbsp;&nbsp;8&nbsp;16&nbsp;24&nbsp;32&nbsp;40&nbsp;48&nbsp;56</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;7&nbsp;15&nbsp;23&nbsp;31&nbsp;39&nbsp;47&nbsp;55&nbsp;63</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;5&nbsp;13&nbsp;21&nbsp;29&nbsp;37&nbsp;45&nbsp;53&nbsp;61</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;3&nbsp;11&nbsp;19&nbsp;27&nbsp;35&nbsp;43&nbsp;51&nbsp;59</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;1&nbsp;&nbsp;9&nbsp;17&nbsp;25&nbsp;33&nbsp;41&nbsp;49&nbsp;57</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">block</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment">//&nbsp;permuteInitialBlock&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;permutation&nbsp;defined</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;by&nbsp;finalPermutation.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">permuteFinalBlock</span><span class="op">(</span><span class="ident">block</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="ident">uint64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Perform&nbsp;the&nbsp;same&nbsp;bit&nbsp;exchanges&nbsp;as&nbsp;permuteInitialBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;but&nbsp;in&nbsp;reverse&nbsp;order.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">block</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0xaaaaaaaa55555555</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">block</span>&nbsp;<span class="op">^=</span>&nbsp;<span class="ident">b1</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b1</span><span class="op">&gt;&gt;</span><span class="num">33</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b1</span><span class="op">&lt;&lt;</span><span class="num">33</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b1</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">block</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0x3300330033003300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b2</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">block</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0x00cc00cc00cc00cc</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">block</span>&nbsp;<span class="op">^=</span>&nbsp;<span class="ident">b1</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b2</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b1</span><span class="op">&gt;&gt;</span><span class="num">6</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b2</span><span class="op">&lt;&lt;</span><span class="num">6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b1</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">block</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0x0f0f00000f0f0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b2</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">block</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0x0000f0f00000f0f0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">block</span>&nbsp;<span class="op">^=</span>&nbsp;<span class="ident">b1</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b2</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b1</span><span class="op">&gt;&gt;</span><span class="num">12</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b2</span><span class="op">&lt;&lt;</span><span class="num">12</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b1</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">block</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">32</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0xff00ff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b2</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">(</span><span class="ident">block</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0xff00ff00</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">block</span>&nbsp;<span class="op">^=</span>&nbsp;<span class="ident">b1</span><span class="op">&lt;&lt;</span><span class="num">32</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b2</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b1</span><span class="op">&lt;&lt;</span><span class="num">8</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b2</span><span class="op">&lt;&lt;</span><span class="num">24</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b1</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">block</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b2</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">block</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">block</span>&nbsp;<span class="op">^=</span>&nbsp;<span class="ident">b1</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b2</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b1</span><span class="op">&lt;&lt;</span><span class="num">48</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">b2</span><span class="op">&gt;&gt;</span><span class="num">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">block</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;creates&nbsp;16&nbsp;28-bit&nbsp;blocks&nbsp;rotated&nbsp;according</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;to&nbsp;the&nbsp;rotation&nbsp;schedule</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">ksRotate</span><span class="op">(</span><span class="ident">in</span>&nbsp;<span class="builtintype">uint32</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">out</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">uint32</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">uint32</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">last</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">16</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;28-bit&nbsp;circular&nbsp;left&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">left</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="ident">last</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="op">(</span><span class="num">4</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">ksRotations</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">right</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="ident">last</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">4</span><span class="op">)</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="op">(</span><span class="num">32</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">ksRotations</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">left</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">last</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;creates&nbsp;16&nbsp;56-bit&nbsp;subkeys&nbsp;from&nbsp;the&nbsp;original&nbsp;key</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">c</span>&nbsp;<span class="op">*</span><span class="ident">desCipher</span><span class="op">)</span>&nbsp;<span class="ident">generateSubkeys</span><span class="op">(</span><span class="ident">keyBytes</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;apply&nbsp;PC1&nbsp;permutation&nbsp;to&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">key</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">binary</span><span class="op">.</span><span class="ident">BigEndian</span><span class="op">.</span><span class="ident">Uint64</span><span class="op">(</span><span class="ident">keyBytes</span><span class="op">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">permutedKey</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">permuteBlock</span><span class="op">(</span><span class="ident">key</span><span class="op">,</span>&nbsp;<span class="ident">permutedChoice1</span><span class="op">[</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;rotate&nbsp;halves&nbsp;of&nbsp;permuted&nbsp;key&nbsp;according&nbsp;to&nbsp;the&nbsp;rotation&nbsp;schedule</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">leftRotations</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">ksRotate</span><span class="op">(</span><span class="builtintype">uint32</span><span class="op">(</span><span class="ident">permutedKey</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">28</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">rightRotations</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">ksRotate</span><span class="op">(</span><span class="builtintype">uint32</span><span class="op">(</span><span class="ident">permutedKey</span><span class="op">&lt;&lt;</span><span class="num">4</span><span class="op">)</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">4</span><span class="op">)</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;generate&nbsp;subkeys</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">16</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;combine&nbsp;halves&nbsp;to&nbsp;form&nbsp;56-bit&nbsp;input&nbsp;to&nbsp;PC2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pc2Input</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">leftRotations</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="num">28</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">rightRotations</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;apply&nbsp;PC2&nbsp;permutation&nbsp;to&nbsp;7&nbsp;byte&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">c</span><span class="op">.</span><span class="ident">subkeys</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">permuteBlock</span><span class="op">(</span><span class="ident">pc2Input</span><span class="op">,</span>&nbsp;<span class="ident">permutedChoice2</span><span class="op">[</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span>
</div>
</body>
</html>
