<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8220035">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8220090">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8220144">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8220195">package</span>&nbsp;<span class="ident" id="8220203">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8220208">import</span>&nbsp;<span class="op" id="8220215">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8220218">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8220227">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8220234">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8220240">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8220247">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8220258">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8220269">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="8220276">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8220279">var</span>&nbsp;<span class="ident" id="8220283">rsaCertPEM</span>&nbsp;<span class="op" id="8220294">=</span>&nbsp;<span class="string" id="8220296">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB0zCCAX2gAwIBAgIJAI/M7BYjwB+uMA0GCSqGSIb3DQEBBQUAMEUxCzAJBgNV<br>
<span class="lineno"></span>BAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRlcm5ldCBX<br>
<span class="lineno">20</span>aWRnaXRzIFB0eSBMdGQwHhcNMTIwOTEyMjE1MjAyWhcNMTUwOTEyMjE1MjAyWjBF<br>
<span class="lineno"></span>MQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UECgwYSW50<br>
<span class="lineno"></span>ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBANLJ<br>
<span class="lineno"></span>hPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wok/4xIA+ui35/MmNa<br>
<span class="lineno"></span>rtNuC+BdZ1tMuVCPFZcCAwEAAaNQME4wHQYDVR0OBBYEFJvKs8RfJaXTH08W+SGv<br>
<span class="lineno">25</span>zQyKn0H8MB8GA1UdIwQYMBaAFJvKs8RfJaXTH08W+SGvzQyKn0H8MAwGA1UdEwQF<br>
<span class="lineno"></span>MAMBAf8wDQYJKoZIhvcNAQEFBQADQQBJlffJHybjDGxRMqaRmDhX0+6v02TUKZsW<br>
<span class="lineno"></span>r5QuVbpQhH6u+0UgcW0jp9QwpxoPTLTWGXEWBBBurxFwiCBhkQ+V<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="8220992">var</span>&nbsp;<span class="ident" id="8220996">rsaKeyPEM</span>&nbsp;<span class="op" id="8221006">=</span>&nbsp;<span class="string" id="8221008">`-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno">35</span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno"></span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">40</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8221509">//&nbsp;keyPEM&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;rsaKeyPEM,&nbsp;but&nbsp;declares&nbsp;itself&nbsp;as&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="8221573">//&nbsp;&#34;PRIVATE&nbsp;KEY&#34;,&nbsp;not&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;.&nbsp;&nbsp;http://golang.org/issue/4477</span><br>
<span class="lineno"></span><span class="keyword" id="8221644">var</span>&nbsp;<span class="ident" id="8221648">keyPEM</span>&nbsp;<span class="op" id="8221655">=</span>&nbsp;<span class="string" id="8221657">`-----BEGIN&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">45</span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno"></span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno">50</span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="8222150">var</span>&nbsp;<span class="ident" id="8222154">ecdsaCertPEM</span>&nbsp;<span class="op" id="8222167">=</span>&nbsp;<span class="string" id="8222169">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/jCCAWICCQDscdUxw16XFDAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTI0MDQ4WhcNMTUxMTE0MTI0MDQ4WjBFMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTETMBEGA1UECBMKU29tZS1TdGF0ZTEhMB8GA1UEChMYSW50ZXJuZXQgV2lk<br>
<span class="lineno">60</span>Z2l0cyBQdHkgTHRkMIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQBY9+my9OoeSUR<br>
<span class="lineno"></span>lDQdV/x8LsOuLilthhiS1Tz4aGDHIPwC1mlvnf7fg5lecYpMCrLLhauAc1UJXcgl<br>
<span class="lineno"></span>01xoLuzgtAEAgv2P/jgytzRSpUYvgLBt1UA0leLYBy6mQQbrNEuqT3INapKIcUv8<br>
<span class="lineno"></span>XxYP0xMEUksLPq6Ca+CRSqTtrd/23uTnapkwCQYHKoZIzj0EAQOBigAwgYYCQXJo<br>
<span class="lineno"></span>A7Sl2nLVf+4Iu/tAX/IF4MavARKC4PPHK3zfuGfPR3oCCcsAoz3kAzOeijvd0iXb<br>
<span class="lineno">65</span>H5jBImIxPL4WxQNiBTexAkF8D1EtpYuWdlVQ80/h/f4pBcGiXPqX5h2PQSQY7hP1<br>
<span class="lineno"></span>+jwM1FGS4fREIOvlBYr/SzzQRtwrvrzGYxDEDbsC0ZGRnA==<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="8222926">var</span>&nbsp;<span class="ident" id="8222930">ecdsaKeyPEM</span>&nbsp;<span class="op" id="8222942">=</span>&nbsp;<span class="string" id="8222944">`-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBrsoKp0oqcv6/JovJJDoDVSGWdirrkgCWxrprGlzB9o0X8fV675X0<br>
<span class="lineno">75</span>NwuBenXFfeZvVcwluO7/Q9wkYoPd/t3jGImgBwYFK4EEACOhgYkDgYYABAFj36bL<br>
<span class="lineno"></span>06h5JRGUNB1X/Hwuw64uKW2GGJLVPPhoYMcg/ALWaW+d/t+DmV5xikwKssuFq4Bz<br>
<span class="lineno"></span>VQldyCXTXGgu7OC0AQCC/Y/+ODK3NFKlRi+AsG3VQDSV4tgHLqZBBus0S6pPcg1q<br>
<span class="lineno"></span>kohxS/xfFg/TEwRSSws+roJr4JFKpO2t3/be5OdqmQ==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">80</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8223384">var</span>&nbsp;<span class="ident" id="8223388">keyPairTests</span>&nbsp;<span class="op" id="8223401">=</span>&nbsp;<span class="op" id="8223403">[</span><span class="op" id="8223404">]</span><span class="keyword" id="8223405">struct</span>&nbsp;<span class="op" id="8223412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223415">algo</span>&nbsp;<span class="builtintype" id="8223420">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223428">cert</span>&nbsp;<span class="builtintype" id="8223433">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223441">key</span>&nbsp;&nbsp;<span class="builtintype" id="8223446">string</span><br>
<span class="lineno"></span><span class="op" id="8223453">}</span><span class="op" id="8223454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8223457">{</span><span class="string" id="8223458">&#34;ECDSA&#34;</span><span class="op" id="8223465">,</span>&nbsp;<span class="ident" id="8223467">ecdsaCertPEM</span><span class="op" id="8223479">,</span>&nbsp;<span class="ident" id="8223481">ecdsaKeyPEM</span><span class="op" id="8223492">}</span><span class="op" id="8223493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8223496">{</span><span class="string" id="8223497">&#34;RSA&#34;</span><span class="op" id="8223502">,</span>&nbsp;<span class="ident" id="8223504">rsaCertPEM</span><span class="op" id="8223514">,</span>&nbsp;<span class="ident" id="8223516">rsaKeyPEM</span><span class="op" id="8223525">}</span><span class="op" id="8223526">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8223529">{</span><span class="string" id="8223530">&#34;RSA-untyped&#34;</span><span class="op" id="8223543">,</span>&nbsp;<span class="ident" id="8223545">rsaCertPEM</span><span class="op" id="8223555">,</span>&nbsp;<span class="ident" id="8223557">keyPEM</span><span class="op" id="8223563">}</span><span class="op" id="8223564">,</span>&nbsp;<span class="comment" id="8223566">//&nbsp;golang.org/issue/4477</span><br>
<span class="lineno">90</span><span class="op" id="8223591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8223594">func</span>&nbsp;<span class="ident" id="8223599">TestX509KeyPair</span><span class="op" id="8223614">(</span><span class="ident" id="8223615">t</span>&nbsp;<span class="op" id="8223617">*</span><span class="ident" id="8223618">testing</span><span class="op" id="8223625">.</span><span class="ident" id="8223626">T</span><span class="op" id="8223627">)</span>&nbsp;<span class="op" id="8223629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223632">var</span>&nbsp;<span class="ident" id="8223636">pem</span>&nbsp;<span class="op" id="8223640">[</span><span class="op" id="8223641">]</span><span class="builtintype" id="8223642">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223648">for</span>&nbsp;<span class="ident" id="8223652">_</span><span class="op" id="8223653">,</span>&nbsp;<span class="ident" id="8223655">test</span>&nbsp;<span class="op" id="8223660">:=</span>&nbsp;<span class="keyword" id="8223663">range</span>&nbsp;<span class="ident" id="8223669">keyPairTests</span>&nbsp;<span class="op" id="8223682">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223686">pem</span>&nbsp;<span class="op" id="8223690">=</span>&nbsp;<span class="op" id="8223692">[</span><span class="op" id="8223693">]</span><span class="builtintype" id="8223694">byte</span><span class="op" id="8223698">(</span><span class="ident" id="8223699">test</span><span class="op" id="8223703">.</span><span class="ident" id="8223704">cert</span>&nbsp;<span class="op" id="8223709">+</span>&nbsp;<span class="ident" id="8223711">test</span><span class="op" id="8223715">.</span><span class="ident" id="8223716">key</span><span class="op" id="8223719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223723">if</span>&nbsp;<span class="ident" id="8223726">_</span><span class="op" id="8223727">,</span>&nbsp;<span class="ident" id="8223729">err</span>&nbsp;<span class="op" id="8223733">:=</span>&nbsp;<span class="ident" id="8223736">X509KeyPair</span><span class="op" id="8223747">(</span><span class="ident" id="8223748">pem</span><span class="op" id="8223751">,</span>&nbsp;<span class="ident" id="8223753">pem</span><span class="op" id="8223756">)</span><span class="op" id="8223757">;</span>&nbsp;<span class="ident" id="8223759">err</span>&nbsp;<span class="op" id="8223763">!=</span>&nbsp;<span class="ident" id="8223766">nil</span>&nbsp;<span class="op" id="8223770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223775">t</span><span class="op" id="8223776">.</span><span class="ident" id="8223777">Errorf</span><span class="op" id="8223783">(</span><span class="string" id="8223784">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;cert&nbsp;followed&nbsp;by&nbsp;%s&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="8223831">,</span>&nbsp;<span class="ident" id="8223833">test</span><span class="op" id="8223837">.</span><span class="ident" id="8223838">algo</span><span class="op" id="8223842">,</span>&nbsp;<span class="ident" id="8223844">test</span><span class="op" id="8223848">.</span><span class="ident" id="8223849">algo</span><span class="op" id="8223853">,</span>&nbsp;<span class="ident" id="8223855">err</span><span class="op" id="8223858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8223862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223866">pem</span>&nbsp;<span class="op" id="8223870">=</span>&nbsp;<span class="op" id="8223872">[</span><span class="op" id="8223873">]</span><span class="builtintype" id="8223874">byte</span><span class="op" id="8223878">(</span><span class="ident" id="8223879">test</span><span class="op" id="8223883">.</span><span class="ident" id="8223884">key</span>&nbsp;<span class="op" id="8223888">+</span>&nbsp;<span class="ident" id="8223890">test</span><span class="op" id="8223894">.</span><span class="ident" id="8223895">cert</span><span class="op" id="8223899">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8223903">if</span>&nbsp;<span class="ident" id="8223906">_</span><span class="op" id="8223907">,</span>&nbsp;<span class="ident" id="8223909">err</span>&nbsp;<span class="op" id="8223913">:=</span>&nbsp;<span class="ident" id="8223916">X509KeyPair</span><span class="op" id="8223927">(</span><span class="ident" id="8223928">pem</span><span class="op" id="8223931">,</span>&nbsp;<span class="ident" id="8223933">pem</span><span class="op" id="8223936">)</span><span class="op" id="8223937">;</span>&nbsp;<span class="ident" id="8223939">err</span>&nbsp;<span class="op" id="8223943">!=</span>&nbsp;<span class="ident" id="8223946">nil</span>&nbsp;<span class="op" id="8223950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8223955">t</span><span class="op" id="8223956">.</span><span class="ident" id="8223957">Errorf</span><span class="op" id="8223963">(</span><span class="string" id="8223964">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;key&nbsp;followed&nbsp;by&nbsp;%s&nbsp;cert:&nbsp;%s&#34;</span><span class="op" id="8224011">,</span>&nbsp;<span class="ident" id="8224013">test</span><span class="op" id="8224017">.</span><span class="ident" id="8224018">algo</span><span class="op" id="8224022">,</span>&nbsp;<span class="ident" id="8224024">test</span><span class="op" id="8224028">.</span><span class="ident" id="8224029">algo</span><span class="op" id="8224033">,</span>&nbsp;<span class="ident" id="8224035">err</span><span class="op" id="8224038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224045">}</span><br>
<span class="lineno"></span><span class="op" id="8224047">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="8224050">func</span>&nbsp;<span class="ident" id="8224055">TestX509MixedKeyPair</span><span class="op" id="8224075">(</span><span class="ident" id="8224076">t</span>&nbsp;<span class="op" id="8224078">*</span><span class="ident" id="8224079">testing</span><span class="op" id="8224086">.</span><span class="ident" id="8224087">T</span><span class="op" id="8224088">)</span>&nbsp;<span class="op" id="8224090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224093">if</span>&nbsp;<span class="ident" id="8224096">_</span><span class="op" id="8224097">,</span>&nbsp;<span class="ident" id="8224099">err</span>&nbsp;<span class="op" id="8224103">:=</span>&nbsp;<span class="ident" id="8224106">X509KeyPair</span><span class="op" id="8224117">(</span><span class="op" id="8224118">[</span><span class="op" id="8224119">]</span><span class="builtintype" id="8224120">byte</span><span class="op" id="8224124">(</span><span class="ident" id="8224125">rsaCertPEM</span><span class="op" id="8224135">)</span><span class="op" id="8224136">,</span>&nbsp;<span class="op" id="8224138">[</span><span class="op" id="8224139">]</span><span class="builtintype" id="8224140">byte</span><span class="op" id="8224144">(</span><span class="ident" id="8224145">ecdsaKeyPEM</span><span class="op" id="8224156">)</span><span class="op" id="8224157">)</span><span class="op" id="8224158">;</span>&nbsp;<span class="ident" id="8224160">err</span>&nbsp;<span class="op" id="8224164">==</span>&nbsp;<span class="ident" id="8224167">nil</span>&nbsp;<span class="op" id="8224171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224175">t</span><span class="op" id="8224176">.</span><span class="ident" id="8224177">Error</span><span class="op" id="8224182">(</span><span class="string" id="8224183">&#34;Load&nbsp;of&nbsp;RSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;ECDSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="8224241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224244">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224247">if</span>&nbsp;<span class="ident" id="8224250">_</span><span class="op" id="8224251">,</span>&nbsp;<span class="ident" id="8224253">err</span>&nbsp;<span class="op" id="8224257">:=</span>&nbsp;<span class="ident" id="8224260">X509KeyPair</span><span class="op" id="8224271">(</span><span class="op" id="8224272">[</span><span class="op" id="8224273">]</span><span class="builtintype" id="8224274">byte</span><span class="op" id="8224278">(</span><span class="ident" id="8224279">ecdsaCertPEM</span><span class="op" id="8224291">)</span><span class="op" id="8224292">,</span>&nbsp;<span class="op" id="8224294">[</span><span class="op" id="8224295">]</span><span class="builtintype" id="8224296">byte</span><span class="op" id="8224300">(</span><span class="ident" id="8224301">rsaKeyPEM</span><span class="op" id="8224310">)</span><span class="op" id="8224311">)</span><span class="op" id="8224312">;</span>&nbsp;<span class="ident" id="8224314">err</span>&nbsp;<span class="op" id="8224318">==</span>&nbsp;<span class="ident" id="8224321">nil</span>&nbsp;<span class="op" id="8224325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224329">t</span><span class="op" id="8224330">.</span><span class="ident" id="8224331">Error</span><span class="op" id="8224336">(</span><span class="string" id="8224337">&#34;Load&nbsp;of&nbsp;ECDSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;RSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="8224395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224398">}</span><br>
<span class="lineno"></span><span class="op" id="8224400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="8224403">func</span>&nbsp;<span class="ident" id="8224408">newLocalListener</span><span class="op" id="8224424">(</span><span class="ident" id="8224425">t</span>&nbsp;<span class="op" id="8224427">*</span><span class="ident" id="8224428">testing</span><span class="op" id="8224435">.</span><span class="ident" id="8224436">T</span><span class="op" id="8224437">)</span>&nbsp;<span class="ident" id="8224439">net</span><span class="op" id="8224442">.</span><span class="ident" id="8224443">Listener</span>&nbsp;<span class="op" id="8224452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224455">ln</span><span class="op" id="8224457">,</span>&nbsp;<span class="ident" id="8224459">err</span>&nbsp;<span class="op" id="8224463">:=</span>&nbsp;<span class="ident" id="8224466">net</span><span class="op" id="8224469">.</span><span class="ident" id="8224470">Listen</span><span class="op" id="8224476">(</span><span class="string" id="8224477">&#34;tcp&#34;</span><span class="op" id="8224482">,</span>&nbsp;<span class="string" id="8224484">&#34;127.0.0.1:0&#34;</span><span class="op" id="8224497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224500">if</span>&nbsp;<span class="ident" id="8224503">err</span>&nbsp;<span class="op" id="8224507">!=</span>&nbsp;<span class="ident" id="8224510">nil</span>&nbsp;<span class="op" id="8224514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224518">ln</span><span class="op" id="8224520">,</span>&nbsp;<span class="ident" id="8224522">err</span>&nbsp;<span class="op" id="8224526">=</span>&nbsp;<span class="ident" id="8224528">net</span><span class="op" id="8224531">.</span><span class="ident" id="8224532">Listen</span><span class="op" id="8224538">(</span><span class="string" id="8224539">&#34;tcp6&#34;</span><span class="op" id="8224545">,</span>&nbsp;<span class="string" id="8224547">&#34;[::1]:0&#34;</span><span class="op" id="8224556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224559">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224562">if</span>&nbsp;<span class="ident" id="8224565">err</span>&nbsp;<span class="op" id="8224569">!=</span>&nbsp;<span class="ident" id="8224572">nil</span>&nbsp;<span class="op" id="8224576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224580">t</span><span class="op" id="8224581">.</span><span class="ident" id="8224582">Fatal</span><span class="op" id="8224587">(</span><span class="ident" id="8224588">err</span><span class="op" id="8224591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224597">return</span>&nbsp;<span class="ident" id="8224604">ln</span><br>
<span class="lineno"></span><span class="op" id="8224607">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="8224610">func</span>&nbsp;<span class="ident" id="8224615">TestDialTimeout</span><span class="op" id="8224630">(</span><span class="ident" id="8224631">t</span>&nbsp;<span class="op" id="8224633">*</span><span class="ident" id="8224634">testing</span><span class="op" id="8224641">.</span><span class="ident" id="8224642">T</span><span class="op" id="8224643">)</span>&nbsp;<span class="op" id="8224645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224648">if</span>&nbsp;<span class="ident" id="8224651">testing</span><span class="op" id="8224658">.</span><span class="ident" id="8224659">Short</span><span class="op" id="8224664">(</span><span class="op" id="8224665">)</span>&nbsp;<span class="op" id="8224667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224671">t</span><span class="op" id="8224672">.</span><span class="ident" id="8224673">Skip</span><span class="op" id="8224677">(</span><span class="string" id="8224678">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="8224702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224705">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224708">listener</span>&nbsp;<span class="op" id="8224717">:=</span>&nbsp;<span class="ident" id="8224720">newLocalListener</span><span class="op" id="8224736">(</span><span class="ident" id="8224737">t</span><span class="op" id="8224738">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224742">addr</span>&nbsp;<span class="op" id="8224747">:=</span>&nbsp;<span class="ident" id="8224750">listener</span><span class="op" id="8224758">.</span><span class="ident" id="8224759">Addr</span><span class="op" id="8224763">(</span><span class="op" id="8224764">)</span><span class="op" id="8224765">.</span><span class="ident" id="8224766">String</span><span class="op" id="8224772">(</span><span class="op" id="8224773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224776">defer</span>&nbsp;<span class="ident" id="8224782">listener</span><span class="op" id="8224790">.</span><span class="ident" id="8224791">Close</span><span class="op" id="8224796">(</span><span class="op" id="8224797">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224801">complete</span>&nbsp;<span class="op" id="8224810">:=</span>&nbsp;<span class="builtinfunc" id="8224813">make</span><span class="op" id="8224817">(</span><span class="keyword" id="8224818">chan</span>&nbsp;<span class="builtintype" id="8224823">bool</span><span class="op" id="8224827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224830">defer</span>&nbsp;<span class="builtinfunc" id="8224836">close</span><span class="op" id="8224841">(</span><span class="ident" id="8224842">complete</span><span class="op" id="8224850">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224854">go</span>&nbsp;<span class="keyword" id="8224857">func</span><span class="op" id="8224861">(</span><span class="op" id="8224862">)</span>&nbsp;<span class="op" id="8224864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224868">conn</span><span class="op" id="8224872">,</span>&nbsp;<span class="ident" id="8224874">err</span>&nbsp;<span class="op" id="8224878">:=</span>&nbsp;<span class="ident" id="8224881">listener</span><span class="op" id="8224889">.</span><span class="ident" id="8224890">Accept</span><span class="op" id="8224896">(</span><span class="op" id="8224897">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224901">if</span>&nbsp;<span class="ident" id="8224904">err</span>&nbsp;<span class="op" id="8224908">!=</span>&nbsp;<span class="ident" id="8224911">nil</span>&nbsp;<span class="op" id="8224915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224920">t</span><span class="op" id="8224921">.</span><span class="ident" id="8224922">Error</span><span class="op" id="8224927">(</span><span class="ident" id="8224928">err</span><span class="op" id="8224931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8224936">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224949">&lt;-</span><span class="ident" id="8224951">complete</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224962">conn</span><span class="op" id="8224966">.</span><span class="ident" id="8224967">Close</span><span class="op" id="8224972">(</span><span class="op" id="8224973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8224976">}</span><span class="op" id="8224977">(</span><span class="op" id="8224978">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8224982">dialer</span>&nbsp;<span class="op" id="8224989">:=</span>&nbsp;<span class="op" id="8224992">&amp;</span><span class="ident" id="8224993">net</span><span class="op" id="8224996">.</span><span class="ident" id="8224997">Dialer</span><span class="op" id="8225003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8225007">Timeout</span><span class="op" id="8225014">:</span>&nbsp;<span class="num" id="8225016">10</span>&nbsp;<span class="op" id="8225019">*</span>&nbsp;<span class="ident" id="8225021">time</span><span class="op" id="8225025">.</span><span class="ident" id="8225026">Millisecond</span><span class="op" id="8225037">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8225040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8225044">var</span>&nbsp;<span class="ident" id="8225048">err</span>&nbsp;<span class="builtintype" id="8225052">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8225059">if</span>&nbsp;<span class="ident" id="8225062">_</span><span class="op" id="8225063">,</span>&nbsp;<span class="ident" id="8225065">err</span>&nbsp;<span class="op" id="8225069">=</span>&nbsp;<span class="ident" id="8225071">DialWithDialer</span><span class="op" id="8225085">(</span><span class="ident" id="8225086">dialer</span><span class="op" id="8225092">,</span>&nbsp;<span class="string" id="8225094">&#34;tcp&#34;</span><span class="op" id="8225099">,</span>&nbsp;<span class="ident" id="8225101">addr</span><span class="op" id="8225105">,</span>&nbsp;<span class="ident" id="8225107">nil</span><span class="op" id="8225110">)</span><span class="op" id="8225111">;</span>&nbsp;<span class="ident" id="8225113">err</span>&nbsp;<span class="op" id="8225117">==</span>&nbsp;<span class="ident" id="8225120">nil</span>&nbsp;<span class="op" id="8225124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8225128">t</span><span class="op" id="8225129">.</span><span class="ident" id="8225130">Fatal</span><span class="op" id="8225135">(</span><span class="string" id="8225136">&#34;DialWithTimeout&nbsp;completed&nbsp;successfully&#34;</span><span class="op" id="8225176">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8225179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8225183">if</span>&nbsp;<span class="op" id="8225186">!</span><span class="ident" id="8225187">strings</span><span class="op" id="8225194">.</span><span class="ident" id="8225195">Contains</span><span class="op" id="8225203">(</span><span class="ident" id="8225204">err</span><span class="op" id="8225207">.</span><span class="ident" id="8225208">Error</span><span class="op" id="8225213">(</span><span class="op" id="8225214">)</span><span class="op" id="8225215">,</span>&nbsp;<span class="string" id="8225217">&#34;timed&nbsp;out&#34;</span><span class="op" id="8225228">)</span>&nbsp;<span class="op" id="8225230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8225234">t</span><span class="op" id="8225235">.</span><span class="ident" id="8225236">Errorf</span><span class="op" id="8225242">(</span><span class="string" id="8225243">&#34;resulting&nbsp;error&nbsp;not&nbsp;a&nbsp;timeout:&nbsp;%s&#34;</span><span class="op" id="8225278">,</span>&nbsp;<span class="ident" id="8225280">err</span><span class="op" id="8225283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8225286">}</span><br>
<span class="lineno">160</span><span class="op" id="8225288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8225291">//&nbsp;tests&nbsp;that&nbsp;Conn.Read&nbsp;returns&nbsp;(non-zero,&nbsp;io.EOF)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="8225353">//&nbsp;(non-zero,&nbsp;nil)&nbsp;when&nbsp;a&nbsp;Close&nbsp;(alertCloseNotify)&nbsp;is&nbsp;sitting&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="8225421">//&nbsp;behind&nbsp;the&nbsp;application&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">165</span><span class="keyword" id="8225467">func</span>&nbsp;<span class="ident" id="8225472">TestConnReadNonzeroAndEOF</span><span class="op" id="8225497">(</span><span class="ident" id="8225498">t</span>&nbsp;<span class="op" id="8225500">*</span><span class="ident" id="8225501">testing</span><span class="op" id="8225508">.</span><span class="ident" id="8225509">T</span><span class="op" id="8225510">)</span>&nbsp;<span class="op" id="8225512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8225515">//&nbsp;This&nbsp;test&nbsp;is&nbsp;racy:&nbsp;it&nbsp;assumes&nbsp;that&nbsp;after&nbsp;a&nbsp;write&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8225573">//&nbsp;localhost&nbsp;TCP&nbsp;connection,&nbsp;the&nbsp;peer&nbsp;TCP&nbsp;connection&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8225631">//&nbsp;immediately&nbsp;read&nbsp;it.&nbsp;&nbsp;Because&nbsp;it&#39;s&nbsp;racy,&nbsp;we&nbsp;skip&nbsp;this&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8225694">//&nbsp;in&nbsp;short&nbsp;mode,&nbsp;and&nbsp;then&nbsp;retry&nbsp;it&nbsp;several&nbsp;times&nbsp;with&nbsp;an</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8225753">//&nbsp;increasing&nbsp;sleep&nbsp;in&nbsp;between&nbsp;our&nbsp;final&nbsp;write&nbsp;(via&nbsp;srv.Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8225816">//&nbsp;below)&nbsp;and&nbsp;the&nbsp;following&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8225851">if</span>&nbsp;<span class="ident" id="8225854">testing</span><span class="op" id="8225861">.</span><span class="ident" id="8225862">Short</span><span class="op" id="8225867">(</span><span class="op" id="8225868">)</span>&nbsp;<span class="op" id="8225870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8225874">t</span><span class="op" id="8225875">.</span><span class="ident" id="8225876">Skip</span><span class="op" id="8225880">(</span><span class="string" id="8225881">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="8225905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8225908">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8225911">var</span>&nbsp;<span class="ident" id="8225915">err</span>&nbsp;<span class="builtintype" id="8225919">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8225926">for</span>&nbsp;<span class="ident" id="8225930">delay</span>&nbsp;<span class="op" id="8225936">:=</span>&nbsp;<span class="ident" id="8225939">time</span><span class="op" id="8225943">.</span><span class="ident" id="8225944">Millisecond</span><span class="op" id="8225955">;</span>&nbsp;<span class="ident" id="8225957">delay</span>&nbsp;<span class="op" id="8225963">&lt;=</span>&nbsp;<span class="num" id="8225966">64</span><span class="op" id="8225968">*</span><span class="ident" id="8225969">time</span><span class="op" id="8225973">.</span><span class="ident" id="8225974">Millisecond</span><span class="op" id="8225985">;</span>&nbsp;<span class="ident" id="8225987">delay</span>&nbsp;<span class="op" id="8225993">*=</span>&nbsp;<span class="num" id="8225996">2</span>&nbsp;<span class="op" id="8225998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8226002">if</span>&nbsp;<span class="ident" id="8226005">err</span>&nbsp;<span class="op" id="8226009">=</span>&nbsp;<span class="ident" id="8226011">testConnReadNonzeroAndEOF</span><span class="op" id="8226036">(</span><span class="ident" id="8226037">t</span><span class="op" id="8226038">,</span>&nbsp;<span class="ident" id="8226040">delay</span><span class="op" id="8226045">)</span><span class="op" id="8226046">;</span>&nbsp;<span class="ident" id="8226048">err</span>&nbsp;<span class="op" id="8226052">==</span>&nbsp;<span class="ident" id="8226055">nil</span>&nbsp;<span class="op" id="8226059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8226064">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8226073">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8226076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226079">t</span><span class="op" id="8226080">.</span><span class="ident" id="8226081">Error</span><span class="op" id="8226086">(</span><span class="ident" id="8226087">err</span><span class="op" id="8226090">)</span><br>
<span class="lineno"></span><span class="op" id="8226092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8226095">func</span>&nbsp;<span class="ident" id="8226100">testConnReadNonzeroAndEOF</span><span class="op" id="8226125">(</span><span class="ident" id="8226126">t</span>&nbsp;<span class="op" id="8226128">*</span><span class="ident" id="8226129">testing</span><span class="op" id="8226136">.</span><span class="ident" id="8226137">T</span><span class="op" id="8226138">,</span>&nbsp;<span class="ident" id="8226140">delay</span>&nbsp;<span class="ident" id="8226146">time</span><span class="op" id="8226150">.</span><span class="ident" id="8226151">Duration</span><span class="op" id="8226159">)</span>&nbsp;<span class="builtintype" id="8226161">error</span>&nbsp;<span class="op" id="8226167">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226170">ln</span>&nbsp;<span class="op" id="8226173">:=</span>&nbsp;<span class="ident" id="8226176">newLocalListener</span><span class="op" id="8226192">(</span><span class="ident" id="8226193">t</span><span class="op" id="8226194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8226197">defer</span>&nbsp;<span class="ident" id="8226203">ln</span><span class="op" id="8226205">.</span><span class="ident" id="8226206">Close</span><span class="op" id="8226211">(</span><span class="op" id="8226212">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226216">srvCh</span>&nbsp;<span class="op" id="8226222">:=</span>&nbsp;<span class="builtinfunc" id="8226225">make</span><span class="op" id="8226229">(</span><span class="keyword" id="8226230">chan</span>&nbsp;<span class="op" id="8226235">*</span><span class="ident" id="8226236">Conn</span><span class="op" id="8226240">,</span>&nbsp;<span class="num" id="8226242">1</span><span class="op" id="8226243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8226246">var</span>&nbsp;<span class="ident" id="8226250">serr</span>&nbsp;<span class="builtintype" id="8226255">error</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8226262">go</span>&nbsp;<span class="keyword" id="8226265">func</span><span class="op" id="8226269">(</span><span class="op" id="8226270">)</span>&nbsp;<span class="op" id="8226272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226276">sconn</span><span class="op" id="8226281">,</span>&nbsp;<span class="ident" id="8226283">err</span>&nbsp;<span class="op" id="8226287">:=</span>&nbsp;<span class="ident" id="8226290">ln</span><span class="op" id="8226292">.</span><span class="ident" id="8226293">Accept</span><span class="op" id="8226299">(</span><span class="op" id="8226300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8226304">if</span>&nbsp;<span class="ident" id="8226307">err</span>&nbsp;<span class="op" id="8226311">!=</span>&nbsp;<span class="ident" id="8226314">nil</span>&nbsp;<span class="op" id="8226318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226323">serr</span>&nbsp;<span class="op" id="8226328">=</span>&nbsp;<span class="ident" id="8226330">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226337">srvCh</span>&nbsp;<span class="op" id="8226343">&lt;-</span>&nbsp;<span class="ident" id="8226346">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8226353">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8226362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226366">serverConfig</span>&nbsp;<span class="op" id="8226379">:=</span>&nbsp;<span class="op" id="8226382">*</span><span class="ident" id="8226383">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226396">srv</span>&nbsp;<span class="op" id="8226400">:=</span>&nbsp;<span class="ident" id="8226403">Server</span><span class="op" id="8226409">(</span><span class="ident" id="8226410">sconn</span><span class="op" id="8226415">,</span>&nbsp;<span class="op" id="8226417">&amp;</span><span class="ident" id="8226418">serverConfig</span><span class="op" id="8226430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8226434">if</span>&nbsp;<span class="ident" id="8226437">err</span>&nbsp;<span class="op" id="8226441">:=</span>&nbsp;<span class="ident" id="8226444">srv</span><span class="op" id="8226447">.</span><span class="ident" id="8226448">Handshake</span><span class="op" id="8226457">(</span><span class="op" id="8226458">)</span><span class="op" id="8226459">;</span>&nbsp;<span class="ident" id="8226461">err</span>&nbsp;<span class="op" id="8226465">!=</span>&nbsp;<span class="ident" id="8226468">nil</span>&nbsp;<span class="op" id="8226472">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226477">serr</span>&nbsp;<span class="op" id="8226482">=</span>&nbsp;<span class="ident" id="8226484">fmt</span><span class="op" id="8226487">.</span><span class="ident" id="8226488">Errorf</span><span class="op" id="8226494">(</span><span class="string" id="8226495">&#34;handshake:&nbsp;%v&#34;</span><span class="op" id="8226510">,</span>&nbsp;<span class="ident" id="8226512">err</span><span class="op" id="8226515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226520">srvCh</span>&nbsp;<span class="op" id="8226526">&lt;-</span>&nbsp;<span class="ident" id="8226529">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8226536">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8226545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226549">srvCh</span>&nbsp;<span class="op" id="8226555">&lt;-</span>&nbsp;<span class="ident" id="8226558">srv</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8226563">}</span><span class="op" id="8226564">(</span><span class="op" id="8226565">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226569">clientConfig</span>&nbsp;<span class="op" id="8226582">:=</span>&nbsp;<span class="op" id="8226585">*</span><span class="ident" id="8226586">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226598">conn</span><span class="op" id="8226602">,</span>&nbsp;<span class="ident" id="8226604">err</span>&nbsp;<span class="op" id="8226608">:=</span>&nbsp;<span class="ident" id="8226611">Dial</span><span class="op" id="8226615">(</span><span class="string" id="8226616">&#34;tcp&#34;</span><span class="op" id="8226621">,</span>&nbsp;<span class="ident" id="8226623">ln</span><span class="op" id="8226625">.</span><span class="ident" id="8226626">Addr</span><span class="op" id="8226630">(</span><span class="op" id="8226631">)</span><span class="op" id="8226632">.</span><span class="ident" id="8226633">String</span><span class="op" id="8226639">(</span><span class="op" id="8226640">)</span><span class="op" id="8226641">,</span>&nbsp;<span class="op" id="8226643">&amp;</span><span class="ident" id="8226644">clientConfig</span><span class="op" id="8226656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8226659">if</span>&nbsp;<span class="ident" id="8226662">err</span>&nbsp;<span class="op" id="8226666">!=</span>&nbsp;<span class="ident" id="8226669">nil</span>&nbsp;<span class="op" id="8226673">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226677">t</span><span class="op" id="8226678">.</span><span class="ident" id="8226679">Fatal</span><span class="op" id="8226684">(</span><span class="ident" id="8226685">err</span><span class="op" id="8226688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8226691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8226694">defer</span>&nbsp;<span class="ident" id="8226700">conn</span><span class="op" id="8226704">.</span><span class="ident" id="8226705">Close</span><span class="op" id="8226710">(</span><span class="op" id="8226711">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226715">srv</span>&nbsp;<span class="op" id="8226719">:=</span>&nbsp;<span class="op" id="8226722">&lt;-</span><span class="ident" id="8226724">srvCh</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8226731">if</span>&nbsp;<span class="ident" id="8226734">srv</span>&nbsp;<span class="op" id="8226738">==</span>&nbsp;<span class="ident" id="8226741">nil</span>&nbsp;<span class="op" id="8226745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8226749">return</span>&nbsp;<span class="ident" id="8226756">serr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8226762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226766">buf</span>&nbsp;<span class="op" id="8226770">:=</span>&nbsp;<span class="builtinfunc" id="8226773">make</span><span class="op" id="8226777">(</span><span class="op" id="8226778">[</span><span class="op" id="8226779">]</span><span class="builtintype" id="8226780">byte</span><span class="op" id="8226784">,</span>&nbsp;<span class="num" id="8226786">6</span><span class="op" id="8226787">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226791">srv</span><span class="op" id="8226794">.</span><span class="ident" id="8226795">Write</span><span class="op" id="8226800">(</span><span class="op" id="8226801">[</span><span class="op" id="8226802">]</span><span class="builtintype" id="8226803">byte</span><span class="op" id="8226807">(</span><span class="string" id="8226808">&#34;foobar&#34;</span><span class="op" id="8226816">)</span><span class="op" id="8226817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226820">n</span><span class="op" id="8226821">,</span>&nbsp;<span class="ident" id="8226823">err</span>&nbsp;<span class="op" id="8226827">:=</span>&nbsp;<span class="ident" id="8226830">conn</span><span class="op" id="8226834">.</span><span class="ident" id="8226835">Read</span><span class="op" id="8226839">(</span><span class="ident" id="8226840">buf</span><span class="op" id="8226843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8226846">if</span>&nbsp;<span class="ident" id="8226849">n</span>&nbsp;<span class="op" id="8226851">!=</span>&nbsp;<span class="num" id="8226854">6</span>&nbsp;<span class="op" id="8226856">||</span>&nbsp;<span class="ident" id="8226859">err</span>&nbsp;<span class="op" id="8226863">!=</span>&nbsp;<span class="ident" id="8226866">nil</span>&nbsp;<span class="op" id="8226870">||</span>&nbsp;<span class="builtintype" id="8226873">string</span><span class="op" id="8226879">(</span><span class="ident" id="8226880">buf</span><span class="op" id="8226883">)</span>&nbsp;<span class="op" id="8226885">!=</span>&nbsp;<span class="string" id="8226888">&#34;foobar&#34;</span>&nbsp;<span class="op" id="8226897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8226901">return</span>&nbsp;<span class="ident" id="8226908">fmt</span><span class="op" id="8226911">.</span><span class="ident" id="8226912">Errorf</span><span class="op" id="8226918">(</span><span class="string" id="8226919">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;data&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;nil,&nbsp;foobar&#34;</span><span class="op" id="8226964">,</span>&nbsp;<span class="ident" id="8226966">n</span><span class="op" id="8226967">,</span>&nbsp;<span class="ident" id="8226969">err</span><span class="op" id="8226972">,</span>&nbsp;<span class="ident" id="8226974">buf</span><span class="op" id="8226977">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8226980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8226984">srv</span><span class="op" id="8226987">.</span><span class="ident" id="8226988">Write</span><span class="op" id="8226993">(</span><span class="op" id="8226994">[</span><span class="op" id="8226995">]</span><span class="builtintype" id="8226996">byte</span><span class="op" id="8227000">(</span><span class="string" id="8227001">&#34;abcdef&#34;</span><span class="op" id="8227009">)</span><span class="op" id="8227010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227013">srv</span><span class="op" id="8227016">.</span><span class="ident" id="8227017">Close</span><span class="op" id="8227022">(</span><span class="op" id="8227023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227026">time</span><span class="op" id="8227030">.</span><span class="ident" id="8227031">Sleep</span><span class="op" id="8227036">(</span><span class="ident" id="8227037">delay</span><span class="op" id="8227042">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227045">n</span><span class="op" id="8227046">,</span>&nbsp;<span class="ident" id="8227048">err</span>&nbsp;<span class="op" id="8227052">=</span>&nbsp;<span class="ident" id="8227054">conn</span><span class="op" id="8227058">.</span><span class="ident" id="8227059">Read</span><span class="op" id="8227063">(</span><span class="ident" id="8227064">buf</span><span class="op" id="8227067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227070">if</span>&nbsp;<span class="ident" id="8227073">n</span>&nbsp;<span class="op" id="8227075">!=</span>&nbsp;<span class="num" id="8227078">6</span>&nbsp;<span class="op" id="8227080">||</span>&nbsp;<span class="builtintype" id="8227083">string</span><span class="op" id="8227089">(</span><span class="ident" id="8227090">buf</span><span class="op" id="8227093">)</span>&nbsp;<span class="op" id="8227095">!=</span>&nbsp;<span class="string" id="8227098">&#34;abcdef&#34;</span>&nbsp;<span class="op" id="8227107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227111">return</span>&nbsp;<span class="ident" id="8227118">fmt</span><span class="op" id="8227121">.</span><span class="ident" id="8227122">Errorf</span><span class="op" id="8227128">(</span><span class="string" id="8227129">&#34;Read&nbsp;=&nbsp;%d,&nbsp;buf=&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;abcdef&#34;</span><span class="op" id="8227165">,</span>&nbsp;<span class="ident" id="8227167">n</span><span class="op" id="8227168">,</span>&nbsp;<span class="ident" id="8227170">buf</span><span class="op" id="8227173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8227176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227179">if</span>&nbsp;<span class="ident" id="8227182">err</span>&nbsp;<span class="op" id="8227186">!=</span>&nbsp;<span class="ident" id="8227189">io</span><span class="op" id="8227191">.</span><span class="ident" id="8227192">EOF</span>&nbsp;<span class="op" id="8227196">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227200">return</span>&nbsp;<span class="ident" id="8227207">fmt</span><span class="op" id="8227210">.</span><span class="ident" id="8227211">Errorf</span><span class="op" id="8227217">(</span><span class="string" id="8227218">&#34;Second&nbsp;Read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="8227255">,</span>&nbsp;<span class="ident" id="8227257">err</span><span class="op" id="8227260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8227263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227266">return</span>&nbsp;<span class="ident" id="8227273">nil</span><br>
<span class="lineno"></span><span class="op" id="8227277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="8227280">func</span>&nbsp;<span class="ident" id="8227285">TestTLSUniqueMatches</span><span class="op" id="8227305">(</span><span class="ident" id="8227306">t</span>&nbsp;<span class="op" id="8227308">*</span><span class="ident" id="8227309">testing</span><span class="op" id="8227316">.</span><span class="ident" id="8227317">T</span><span class="op" id="8227318">)</span>&nbsp;<span class="op" id="8227320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227323">ln</span>&nbsp;<span class="op" id="8227326">:=</span>&nbsp;<span class="ident" id="8227329">newLocalListener</span><span class="op" id="8227345">(</span><span class="ident" id="8227346">t</span><span class="op" id="8227347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227350">defer</span>&nbsp;<span class="ident" id="8227356">ln</span><span class="op" id="8227358">.</span><span class="ident" id="8227359">Close</span><span class="op" id="8227364">(</span><span class="op" id="8227365">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227369">serverTLSUniques</span>&nbsp;<span class="op" id="8227386">:=</span>&nbsp;<span class="builtinfunc" id="8227389">make</span><span class="op" id="8227393">(</span><span class="keyword" id="8227394">chan</span>&nbsp;<span class="op" id="8227399">[</span><span class="op" id="8227400">]</span><span class="builtintype" id="8227401">byte</span><span class="op" id="8227405">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227408">go</span>&nbsp;<span class="keyword" id="8227411">func</span><span class="op" id="8227415">(</span><span class="op" id="8227416">)</span>&nbsp;<span class="op" id="8227418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227422">for</span>&nbsp;<span class="ident" id="8227426">i</span>&nbsp;<span class="op" id="8227428">:=</span>&nbsp;<span class="num" id="8227431">0</span><span class="op" id="8227432">;</span>&nbsp;<span class="ident" id="8227434">i</span>&nbsp;<span class="op" id="8227436">&lt;</span>&nbsp;<span class="num" id="8227438">2</span><span class="op" id="8227439">;</span>&nbsp;<span class="ident" id="8227441">i</span><span class="op" id="8227442">++</span>&nbsp;<span class="op" id="8227445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227450">sconn</span><span class="op" id="8227455">,</span>&nbsp;<span class="ident" id="8227457">err</span>&nbsp;<span class="op" id="8227461">:=</span>&nbsp;<span class="ident" id="8227464">ln</span><span class="op" id="8227466">.</span><span class="ident" id="8227467">Accept</span><span class="op" id="8227473">(</span><span class="op" id="8227474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227479">if</span>&nbsp;<span class="ident" id="8227482">err</span>&nbsp;<span class="op" id="8227486">!=</span>&nbsp;<span class="ident" id="8227489">nil</span>&nbsp;<span class="op" id="8227493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227499">t</span><span class="op" id="8227500">.</span><span class="ident" id="8227501">Fatal</span><span class="op" id="8227506">(</span><span class="ident" id="8227507">err</span><span class="op" id="8227510">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8227515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227520">serverConfig</span>&nbsp;<span class="op" id="8227533">:=</span>&nbsp;<span class="op" id="8227536">*</span><span class="ident" id="8227537">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227551">srv</span>&nbsp;<span class="op" id="8227555">:=</span>&nbsp;<span class="ident" id="8227558">Server</span><span class="op" id="8227564">(</span><span class="ident" id="8227565">sconn</span><span class="op" id="8227570">,</span>&nbsp;<span class="op" id="8227572">&amp;</span><span class="ident" id="8227573">serverConfig</span><span class="op" id="8227585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227590">if</span>&nbsp;<span class="ident" id="8227593">err</span>&nbsp;<span class="op" id="8227597">:=</span>&nbsp;<span class="ident" id="8227600">srv</span><span class="op" id="8227603">.</span><span class="ident" id="8227604">Handshake</span><span class="op" id="8227613">(</span><span class="op" id="8227614">)</span><span class="op" id="8227615">;</span>&nbsp;<span class="ident" id="8227617">err</span>&nbsp;<span class="op" id="8227621">!=</span>&nbsp;<span class="ident" id="8227624">nil</span>&nbsp;<span class="op" id="8227628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227634">t</span><span class="op" id="8227635">.</span><span class="ident" id="8227636">Fatal</span><span class="op" id="8227641">(</span><span class="ident" id="8227642">err</span><span class="op" id="8227645">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8227650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227655">serverTLSUniques</span>&nbsp;<span class="op" id="8227672">&lt;-</span>&nbsp;<span class="ident" id="8227675">srv</span><span class="op" id="8227678">.</span><span class="ident" id="8227679">ConnectionState</span><span class="op" id="8227694">(</span><span class="op" id="8227695">)</span><span class="op" id="8227696">.</span><span class="ident" id="8227697">TLSUnique</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8227709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8227712">}</span><span class="op" id="8227713">(</span><span class="op" id="8227714">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227718">clientConfig</span>&nbsp;<span class="op" id="8227731">:=</span>&nbsp;<span class="op" id="8227734">*</span><span class="ident" id="8227735">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227747">clientConfig</span><span class="op" id="8227759">.</span><span class="ident" id="8227760">ClientSessionCache</span>&nbsp;<span class="op" id="8227779">=</span>&nbsp;<span class="ident" id="8227781">NewLRUClientSessionCache</span><span class="op" id="8227805">(</span><span class="num" id="8227806">1</span><span class="op" id="8227807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227810">conn</span><span class="op" id="8227814">,</span>&nbsp;<span class="ident" id="8227816">err</span>&nbsp;<span class="op" id="8227820">:=</span>&nbsp;<span class="ident" id="8227823">Dial</span><span class="op" id="8227827">(</span><span class="string" id="8227828">&#34;tcp&#34;</span><span class="op" id="8227833">,</span>&nbsp;<span class="ident" id="8227835">ln</span><span class="op" id="8227837">.</span><span class="ident" id="8227838">Addr</span><span class="op" id="8227842">(</span><span class="op" id="8227843">)</span><span class="op" id="8227844">.</span><span class="ident" id="8227845">String</span><span class="op" id="8227851">(</span><span class="op" id="8227852">)</span><span class="op" id="8227853">,</span>&nbsp;<span class="op" id="8227855">&amp;</span><span class="ident" id="8227856">clientConfig</span><span class="op" id="8227868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227871">if</span>&nbsp;<span class="ident" id="8227874">err</span>&nbsp;<span class="op" id="8227878">!=</span>&nbsp;<span class="ident" id="8227881">nil</span>&nbsp;<span class="op" id="8227885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227889">t</span><span class="op" id="8227890">.</span><span class="ident" id="8227891">Fatal</span><span class="op" id="8227896">(</span><span class="ident" id="8227897">err</span><span class="op" id="8227900">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8227903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8227906">if</span>&nbsp;<span class="op" id="8227909">!</span><span class="ident" id="8227910">bytes</span><span class="op" id="8227915">.</span><span class="ident" id="8227916">Equal</span><span class="op" id="8227921">(</span><span class="ident" id="8227922">conn</span><span class="op" id="8227926">.</span><span class="ident" id="8227927">ConnectionState</span><span class="op" id="8227942">(</span><span class="op" id="8227943">)</span><span class="op" id="8227944">.</span><span class="ident" id="8227945">TLSUnique</span><span class="op" id="8227954">,</span>&nbsp;<span class="op" id="8227956">&lt;-</span><span class="ident" id="8227958">serverTLSUniques</span><span class="op" id="8227974">)</span>&nbsp;<span class="op" id="8227976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8227980">t</span><span class="op" id="8227981">.</span><span class="ident" id="8227982">Error</span><span class="op" id="8227987">(</span><span class="string" id="8227988">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&#34;</span><span class="op" id="8228031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8228037">conn</span><span class="op" id="8228041">.</span><span class="ident" id="8228042">Close</span><span class="op" id="8228047">(</span><span class="op" id="8228048">)</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8228052">conn</span><span class="op" id="8228056">,</span>&nbsp;<span class="ident" id="8228058">err</span>&nbsp;<span class="op" id="8228062">=</span>&nbsp;<span class="ident" id="8228064">Dial</span><span class="op" id="8228068">(</span><span class="string" id="8228069">&#34;tcp&#34;</span><span class="op" id="8228074">,</span>&nbsp;<span class="ident" id="8228076">ln</span><span class="op" id="8228078">.</span><span class="ident" id="8228079">Addr</span><span class="op" id="8228083">(</span><span class="op" id="8228084">)</span><span class="op" id="8228085">.</span><span class="ident" id="8228086">String</span><span class="op" id="8228092">(</span><span class="op" id="8228093">)</span><span class="op" id="8228094">,</span>&nbsp;<span class="op" id="8228096">&amp;</span><span class="ident" id="8228097">clientConfig</span><span class="op" id="8228109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8228112">if</span>&nbsp;<span class="ident" id="8228115">err</span>&nbsp;<span class="op" id="8228119">!=</span>&nbsp;<span class="ident" id="8228122">nil</span>&nbsp;<span class="op" id="8228126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8228130">t</span><span class="op" id="8228131">.</span><span class="ident" id="8228132">Fatal</span><span class="op" id="8228137">(</span><span class="ident" id="8228138">err</span><span class="op" id="8228141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228144">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8228147">defer</span>&nbsp;<span class="ident" id="8228153">conn</span><span class="op" id="8228157">.</span><span class="ident" id="8228158">Close</span><span class="op" id="8228163">(</span><span class="op" id="8228164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8228167">if</span>&nbsp;<span class="op" id="8228170">!</span><span class="ident" id="8228171">conn</span><span class="op" id="8228175">.</span><span class="ident" id="8228176">ConnectionState</span><span class="op" id="8228191">(</span><span class="op" id="8228192">)</span><span class="op" id="8228193">.</span><span class="ident" id="8228194">DidResume</span>&nbsp;<span class="op" id="8228204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8228208">t</span><span class="op" id="8228209">.</span><span class="ident" id="8228210">Error</span><span class="op" id="8228215">(</span><span class="string" id="8228216">&#34;second&nbsp;session&nbsp;did&nbsp;not&nbsp;use&nbsp;resumption&#34;</span><span class="op" id="8228255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8228261">if</span>&nbsp;<span class="op" id="8228264">!</span><span class="ident" id="8228265">bytes</span><span class="op" id="8228270">.</span><span class="ident" id="8228271">Equal</span><span class="op" id="8228276">(</span><span class="ident" id="8228277">conn</span><span class="op" id="8228281">.</span><span class="ident" id="8228282">ConnectionState</span><span class="op" id="8228297">(</span><span class="op" id="8228298">)</span><span class="op" id="8228299">.</span><span class="ident" id="8228300">TLSUnique</span><span class="op" id="8228309">,</span>&nbsp;<span class="op" id="8228311">&lt;-</span><span class="ident" id="8228313">serverTLSUniques</span><span class="op" id="8228329">)</span>&nbsp;<span class="op" id="8228331">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8228335">t</span><span class="op" id="8228336">.</span><span class="ident" id="8228337">Error</span><span class="op" id="8228342">(</span><span class="string" id="8228343">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&nbsp;when&nbsp;session&nbsp;resumption&nbsp;is&nbsp;used&#34;</span><span class="op" id="8228418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8228421">}</span><br>
<span class="lineno"></span><span class="op" id="8228423">}</span>
</div>
</body>
</html>
