<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html" class="current">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7790995">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7791050">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7791104">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7791155">package</span>&nbsp;<span class="ident" id="7791163">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7791172">import</span>&nbsp;<span class="op" id="7791179">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7791182">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7791191">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7791197">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7791210">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7791221">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7791231">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7791234">type</span>&nbsp;<span class="ident" id="7791239">testpair</span>&nbsp;<span class="keyword" id="7791248">struct</span>&nbsp;<span class="op" id="7791255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7791258">decoded</span><span class="op" id="7791265">,</span>&nbsp;<span class="ident" id="7791267">encoded</span>&nbsp;<span class="builtintype" id="7791275">string</span><br>
<span class="lineno"></span><span class="op" id="7791282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7791285">var</span>&nbsp;<span class="ident" id="7791289">pairs</span>&nbsp;<span class="op" id="7791295">=</span>&nbsp;<span class="op" id="7791297">[</span><span class="op" id="7791298">]</span><span class="ident" id="7791299">testpair</span><span class="op" id="7791307">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7791310">//&nbsp;Encode&nbsp;returns&nbsp;0&nbsp;when&nbsp;len(src)&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7791350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7791354">&#34;&#34;</span><span class="op" id="7791356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7791360">&#34;&#34;</span><span class="op" id="7791362">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7791365">}</span><span class="op" id="7791366">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7791369">//&nbsp;Wikipedia&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7791391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7791395">&#34;Man&nbsp;is&nbsp;distinguished,&nbsp;not&nbsp;only&nbsp;by&nbsp;his&nbsp;reason,&nbsp;but&nbsp;by&nbsp;this&nbsp;singular&nbsp;passion&nbsp;from&nbsp;&#34;</span>&nbsp;<span class="op" id="7791478">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7791483">&#34;other&nbsp;animals,&nbsp;which&nbsp;is&nbsp;a&nbsp;lust&nbsp;of&nbsp;the&nbsp;mind,&nbsp;that&nbsp;by&nbsp;a&nbsp;perseverance&nbsp;of&nbsp;delight&nbsp;in&nbsp;&#34;</span>&nbsp;<span class="op" id="7791567">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7791572">&#34;the&nbsp;continued&nbsp;and&nbsp;indefatigable&nbsp;generation&nbsp;of&nbsp;knowledge,&nbsp;exceeds&nbsp;the&nbsp;short&nbsp;&#34;</span>&nbsp;<span class="op" id="7791650">+</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7791655">&#34;vehemence&nbsp;of&nbsp;any&nbsp;carnal&nbsp;pleasure.&#34;</span><span class="op" id="7791690">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7791694">&#34;9jqo^BlbD-BleB1DJ+*+F(f,q/0JhKF&lt;GL&gt;Cj@.4Gp$d7F!,L7@&lt;6@)/0JDEF&lt;G%&lt;+EV:2F!,\n&#34;</span>&nbsp;<span class="op" id="7791772">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7791777">&#34;O&lt;DJ+*.@&lt;*K0@&lt;6L(Df-\\0Ec5e;DffZ(EZee.Bl.9pF\&#34;AGXBPCsi+DGm&gt;@3BB/F*&amp;OCAfu2/AKY\n&#34;</span>&nbsp;<span class="op" id="7791859">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7791864">&#34;i(DIb:@FD,*)+C]U=@3BN#EcYf8ATD3s@q?d$AftVqCh[NqF&lt;G:8+EV:.+Cf&gt;-FD5W8ARlolDIa\n&#34;</span>&nbsp;<span class="op" id="7791944">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7791949">&#34;l(DId&lt;j@&lt;?3r@:F%a+D58&#39;ATD4$Bl@l3De:,-DJs`8ARoFb/0JMK@qB4^F!,R&lt;AKZ&amp;-DfTqBG%G\n&#34;</span>&nbsp;<span class="op" id="7792029">+</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7792034">&#34;&gt;uD.RTpAKYo&#39;+CT/5+Cei#DII?(E,9)oF*2M7/c\n&#34;</span><span class="op" id="7792077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7792080">}</span><span class="op" id="7792081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7792084">//&nbsp;Special&nbsp;case&nbsp;when&nbsp;shortening&nbsp;!!!!!&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7792129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7792133">&#34;\000\000\000\000&#34;</span><span class="op" id="7792151">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7792155">&#34;z&#34;</span><span class="op" id="7792158">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7792161">}</span><span class="op" id="7792162">,</span><br>
<span class="lineno"></span><span class="op" id="7792164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7792167">var</span>&nbsp;<span class="ident" id="7792171">bigtest</span>&nbsp;<span class="op" id="7792179">=</span>&nbsp;<span class="ident" id="7792181">pairs</span><span class="op" id="7792186">[</span><span class="builtinfunc" id="7792187">len</span><span class="op" id="7792190">(</span><span class="ident" id="7792191">pairs</span><span class="op" id="7792196">)</span><span class="op" id="7792197">-</span><span class="num" id="7792198">1</span><span class="op" id="7792199">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7792202">func</span>&nbsp;<span class="ident" id="7792207">testEqual</span><span class="op" id="7792216">(</span><span class="ident" id="7792217">t</span>&nbsp;<span class="op" id="7792219">*</span><span class="ident" id="7792220">testing</span><span class="op" id="7792227">.</span><span class="ident" id="7792228">T</span><span class="op" id="7792229">,</span>&nbsp;<span class="ident" id="7792231">msg</span>&nbsp;<span class="builtintype" id="7792235">string</span><span class="op" id="7792241">,</span>&nbsp;<span class="ident" id="7792243">args</span>&nbsp;<span class="op" id="7792248">...</span><span class="keyword" id="7792251">interface</span><span class="op" id="7792260">{</span><span class="op" id="7792261">}</span><span class="op" id="7792262">)</span>&nbsp;<span class="builtintype" id="7792264">bool</span>&nbsp;<span class="op" id="7792269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7792272">if</span>&nbsp;<span class="ident" id="7792275">args</span><span class="op" id="7792279">[</span><span class="builtinfunc" id="7792280">len</span><span class="op" id="7792283">(</span><span class="ident" id="7792284">args</span><span class="op" id="7792288">)</span><span class="op" id="7792289">-</span><span class="num" id="7792290">2</span><span class="op" id="7792291">]</span>&nbsp;<span class="op" id="7792293">!=</span>&nbsp;<span class="ident" id="7792296">args</span><span class="op" id="7792300">[</span><span class="builtinfunc" id="7792301">len</span><span class="op" id="7792304">(</span><span class="ident" id="7792305">args</span><span class="op" id="7792309">)</span><span class="op" id="7792310">-</span><span class="num" id="7792311">1</span><span class="op" id="7792312">]</span>&nbsp;<span class="op" id="7792314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7792318">t</span><span class="op" id="7792319">.</span><span class="ident" id="7792320">Errorf</span><span class="op" id="7792326">(</span><span class="ident" id="7792327">msg</span><span class="op" id="7792330">,</span>&nbsp;<span class="ident" id="7792332">args</span><span class="op" id="7792336">...</span><span class="op" id="7792339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7792343">return</span>&nbsp;<span class="builtintype" id="7792350">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7792357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7792360">return</span>&nbsp;<span class="builtintype" id="7792367">true</span><br>
<span class="lineno"></span><span class="op" id="7792372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7792375">func</span>&nbsp;<span class="ident" id="7792380">strip85</span><span class="op" id="7792387">(</span><span class="ident" id="7792388">s</span>&nbsp;<span class="builtintype" id="7792390">string</span><span class="op" id="7792396">)</span>&nbsp;<span class="builtintype" id="7792398">string</span>&nbsp;<span class="op" id="7792405">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7792408">t</span>&nbsp;<span class="op" id="7792410">:=</span>&nbsp;<span class="builtinfunc" id="7792413">make</span><span class="op" id="7792417">(</span><span class="op" id="7792418">[</span><span class="op" id="7792419">]</span><span class="builtintype" id="7792420">byte</span><span class="op" id="7792424">,</span>&nbsp;<span class="builtinfunc" id="7792426">len</span><span class="op" id="7792429">(</span><span class="ident" id="7792430">s</span><span class="op" id="7792431">)</span><span class="op" id="7792432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7792435">w</span>&nbsp;<span class="op" id="7792437">:=</span>&nbsp;<span class="num" id="7792440">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7792443">for</span>&nbsp;<span class="ident" id="7792447">r</span>&nbsp;<span class="op" id="7792449">:=</span>&nbsp;<span class="num" id="7792452">0</span><span class="op" id="7792453">;</span>&nbsp;<span class="ident" id="7792455">r</span>&nbsp;<span class="op" id="7792457">&lt;</span>&nbsp;<span class="builtinfunc" id="7792459">len</span><span class="op" id="7792462">(</span><span class="ident" id="7792463">s</span><span class="op" id="7792464">)</span><span class="op" id="7792465">;</span>&nbsp;<span class="ident" id="7792467">r</span><span class="op" id="7792468">++</span>&nbsp;<span class="op" id="7792471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7792475">c</span>&nbsp;<span class="op" id="7792477">:=</span>&nbsp;<span class="ident" id="7792480">s</span><span class="op" id="7792481">[</span><span class="ident" id="7792482">r</span><span class="op" id="7792483">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7792487">if</span>&nbsp;<span class="ident" id="7792490">c</span>&nbsp;<span class="op" id="7792492">&gt;</span>&nbsp;<span class="string" id="7792494">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="7792498">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7792503">t</span><span class="op" id="7792504">[</span><span class="ident" id="7792505">w</span><span class="op" id="7792506">]</span>&nbsp;<span class="op" id="7792508">=</span>&nbsp;<span class="ident" id="7792510">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7792515">w</span><span class="op" id="7792516">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7792521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7792524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7792527">return</span>&nbsp;<span class="builtintype" id="7792534">string</span><span class="op" id="7792540">(</span><span class="ident" id="7792541">t</span><span class="op" id="7792542">[</span><span class="num" id="7792543">0</span><span class="op" id="7792544">:</span><span class="ident" id="7792545">w</span><span class="op" id="7792546">]</span><span class="op" id="7792547">)</span><br>
<span class="lineno">65</span><span class="op" id="7792549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7792552">func</span>&nbsp;<span class="ident" id="7792557">TestEncode</span><span class="op" id="7792567">(</span><span class="ident" id="7792568">t</span>&nbsp;<span class="op" id="7792570">*</span><span class="ident" id="7792571">testing</span><span class="op" id="7792578">.</span><span class="ident" id="7792579">T</span><span class="op" id="7792580">)</span>&nbsp;<span class="op" id="7792582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7792585">for</span>&nbsp;<span class="ident" id="7792589">_</span><span class="op" id="7792590">,</span>&nbsp;<span class="ident" id="7792592">p</span>&nbsp;<span class="op" id="7792594">:=</span>&nbsp;<span class="keyword" id="7792597">range</span>&nbsp;<span class="ident" id="7792603">pairs</span>&nbsp;<span class="op" id="7792609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7792613">buf</span>&nbsp;<span class="op" id="7792617">:=</span>&nbsp;<span class="builtinfunc" id="7792620">make</span><span class="op" id="7792624">(</span><span class="op" id="7792625">[</span><span class="op" id="7792626">]</span><span class="builtintype" id="7792627">byte</span><span class="op" id="7792631">,</span>&nbsp;<span class="ident" id="7792633">MaxEncodedLen</span><span class="op" id="7792646">(</span><span class="builtinfunc" id="7792647">len</span><span class="op" id="7792650">(</span><span class="ident" id="7792651">p</span><span class="op" id="7792652">.</span><span class="ident" id="7792653">decoded</span><span class="op" id="7792660">)</span><span class="op" id="7792661">)</span><span class="op" id="7792662">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7792666">n</span>&nbsp;<span class="op" id="7792668">:=</span>&nbsp;<span class="ident" id="7792671">Encode</span><span class="op" id="7792677">(</span><span class="ident" id="7792678">buf</span><span class="op" id="7792681">,</span>&nbsp;<span class="op" id="7792683">[</span><span class="op" id="7792684">]</span><span class="builtintype" id="7792685">byte</span><span class="op" id="7792689">(</span><span class="ident" id="7792690">p</span><span class="op" id="7792691">.</span><span class="ident" id="7792692">decoded</span><span class="op" id="7792699">)</span><span class="op" id="7792700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7792704">buf</span>&nbsp;<span class="op" id="7792708">=</span>&nbsp;<span class="ident" id="7792710">buf</span><span class="op" id="7792713">[</span><span class="num" id="7792714">0</span><span class="op" id="7792715">:</span><span class="ident" id="7792716">n</span><span class="op" id="7792717">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7792721">testEqual</span><span class="op" id="7792730">(</span><span class="ident" id="7792731">t</span><span class="op" id="7792732">,</span>&nbsp;<span class="string" id="7792734">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7792760">,</span>&nbsp;<span class="ident" id="7792762">p</span><span class="op" id="7792763">.</span><span class="ident" id="7792764">decoded</span><span class="op" id="7792771">,</span>&nbsp;<span class="ident" id="7792773">strip85</span><span class="op" id="7792780">(</span><span class="builtintype" id="7792781">string</span><span class="op" id="7792787">(</span><span class="ident" id="7792788">buf</span><span class="op" id="7792791">)</span><span class="op" id="7792792">)</span><span class="op" id="7792793">,</span>&nbsp;<span class="ident" id="7792795">strip85</span><span class="op" id="7792802">(</span><span class="ident" id="7792803">p</span><span class="op" id="7792804">.</span><span class="ident" id="7792805">encoded</span><span class="op" id="7792812">)</span><span class="op" id="7792813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7792816">}</span><br>
<span class="lineno"></span><span class="op" id="7792818">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7792821">func</span>&nbsp;<span class="ident" id="7792826">TestEncoder</span><span class="op" id="7792837">(</span><span class="ident" id="7792838">t</span>&nbsp;<span class="op" id="7792840">*</span><span class="ident" id="7792841">testing</span><span class="op" id="7792848">.</span><span class="ident" id="7792849">T</span><span class="op" id="7792850">)</span>&nbsp;<span class="op" id="7792852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7792855">for</span>&nbsp;<span class="ident" id="7792859">_</span><span class="op" id="7792860">,</span>&nbsp;<span class="ident" id="7792862">p</span>&nbsp;<span class="op" id="7792864">:=</span>&nbsp;<span class="keyword" id="7792867">range</span>&nbsp;<span class="ident" id="7792873">pairs</span>&nbsp;<span class="op" id="7792879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7792883">bb</span>&nbsp;<span class="op" id="7792886">:=</span>&nbsp;<span class="op" id="7792889">&amp;</span><span class="ident" id="7792890">bytes</span><span class="op" id="7792895">.</span><span class="ident" id="7792896">Buffer</span><span class="op" id="7792902">{</span><span class="op" id="7792903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7792907">encoder</span>&nbsp;<span class="op" id="7792915">:=</span>&nbsp;<span class="ident" id="7792918">NewEncoder</span><span class="op" id="7792928">(</span><span class="ident" id="7792929">bb</span><span class="op" id="7792931">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7792935">encoder</span><span class="op" id="7792942">.</span><span class="ident" id="7792943">Write</span><span class="op" id="7792948">(</span><span class="op" id="7792949">[</span><span class="op" id="7792950">]</span><span class="builtintype" id="7792951">byte</span><span class="op" id="7792955">(</span><span class="ident" id="7792956">p</span><span class="op" id="7792957">.</span><span class="ident" id="7792958">decoded</span><span class="op" id="7792965">)</span><span class="op" id="7792966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7792970">encoder</span><span class="op" id="7792977">.</span><span class="ident" id="7792978">Close</span><span class="op" id="7792983">(</span><span class="op" id="7792984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7792988">testEqual</span><span class="op" id="7792997">(</span><span class="ident" id="7792998">t</span><span class="op" id="7792999">,</span>&nbsp;<span class="string" id="7793001">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7793027">,</span>&nbsp;<span class="ident" id="7793029">p</span><span class="op" id="7793030">.</span><span class="ident" id="7793031">decoded</span><span class="op" id="7793038">,</span>&nbsp;<span class="ident" id="7793040">strip85</span><span class="op" id="7793047">(</span><span class="ident" id="7793048">bb</span><span class="op" id="7793050">.</span><span class="ident" id="7793051">String</span><span class="op" id="7793057">(</span><span class="op" id="7793058">)</span><span class="op" id="7793059">)</span><span class="op" id="7793060">,</span>&nbsp;<span class="ident" id="7793062">strip85</span><span class="op" id="7793069">(</span><span class="ident" id="7793070">p</span><span class="op" id="7793071">.</span><span class="ident" id="7793072">encoded</span><span class="op" id="7793079">)</span><span class="op" id="7793080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7793083">}</span><br>
<span class="lineno"></span><span class="op" id="7793085">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="7793088">func</span>&nbsp;<span class="ident" id="7793093">TestEncoderBuffering</span><span class="op" id="7793113">(</span><span class="ident" id="7793114">t</span>&nbsp;<span class="op" id="7793116">*</span><span class="ident" id="7793117">testing</span><span class="op" id="7793124">.</span><span class="ident" id="7793125">T</span><span class="op" id="7793126">)</span>&nbsp;<span class="op" id="7793128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7793131">input</span>&nbsp;<span class="op" id="7793137">:=</span>&nbsp;<span class="op" id="7793140">[</span><span class="op" id="7793141">]</span><span class="builtintype" id="7793142">byte</span><span class="op" id="7793146">(</span><span class="ident" id="7793147">bigtest</span><span class="op" id="7793154">.</span><span class="ident" id="7793155">decoded</span><span class="op" id="7793162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7793165">for</span>&nbsp;<span class="ident" id="7793169">bs</span>&nbsp;<span class="op" id="7793172">:=</span>&nbsp;<span class="num" id="7793175">1</span><span class="op" id="7793176">;</span>&nbsp;<span class="ident" id="7793178">bs</span>&nbsp;<span class="op" id="7793181">&lt;=</span>&nbsp;<span class="num" id="7793184">12</span><span class="op" id="7793186">;</span>&nbsp;<span class="ident" id="7793188">bs</span><span class="op" id="7793190">++</span>&nbsp;<span class="op" id="7793193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7793197">bb</span>&nbsp;<span class="op" id="7793200">:=</span>&nbsp;<span class="op" id="7793203">&amp;</span><span class="ident" id="7793204">bytes</span><span class="op" id="7793209">.</span><span class="ident" id="7793210">Buffer</span><span class="op" id="7793216">{</span><span class="op" id="7793217">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7793221">encoder</span>&nbsp;<span class="op" id="7793229">:=</span>&nbsp;<span class="ident" id="7793232">NewEncoder</span><span class="op" id="7793242">(</span><span class="ident" id="7793243">bb</span><span class="op" id="7793245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7793249">for</span>&nbsp;<span class="ident" id="7793253">pos</span>&nbsp;<span class="op" id="7793257">:=</span>&nbsp;<span class="num" id="7793260">0</span><span class="op" id="7793261">;</span>&nbsp;<span class="ident" id="7793263">pos</span>&nbsp;<span class="op" id="7793267">&lt;</span>&nbsp;<span class="builtinfunc" id="7793269">len</span><span class="op" id="7793272">(</span><span class="ident" id="7793273">input</span><span class="op" id="7793278">)</span><span class="op" id="7793279">;</span>&nbsp;<span class="ident" id="7793281">pos</span>&nbsp;<span class="op" id="7793285">+=</span>&nbsp;<span class="ident" id="7793288">bs</span>&nbsp;<span class="op" id="7793291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7793296">end</span>&nbsp;<span class="op" id="7793300">:=</span>&nbsp;<span class="ident" id="7793303">pos</span>&nbsp;<span class="op" id="7793307">+</span>&nbsp;<span class="ident" id="7793309">bs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7793315">if</span>&nbsp;<span class="ident" id="7793318">end</span>&nbsp;<span class="op" id="7793322">&gt;</span>&nbsp;<span class="builtinfunc" id="7793324">len</span><span class="op" id="7793327">(</span><span class="ident" id="7793328">input</span><span class="op" id="7793333">)</span>&nbsp;<span class="op" id="7793335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7793341">end</span>&nbsp;<span class="op" id="7793345">=</span>&nbsp;<span class="builtinfunc" id="7793347">len</span><span class="op" id="7793350">(</span><span class="ident" id="7793351">input</span><span class="op" id="7793356">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7793361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7793366">n</span><span class="op" id="7793367">,</span>&nbsp;<span class="ident" id="7793369">err</span>&nbsp;<span class="op" id="7793373">:=</span>&nbsp;<span class="ident" id="7793376">encoder</span><span class="op" id="7793383">.</span><span class="ident" id="7793384">Write</span><span class="op" id="7793389">(</span><span class="ident" id="7793390">input</span><span class="op" id="7793395">[</span><span class="ident" id="7793396">pos</span><span class="op" id="7793399">:</span><span class="ident" id="7793400">end</span><span class="op" id="7793403">]</span><span class="op" id="7793404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7793409">testEqual</span><span class="op" id="7793418">(</span><span class="ident" id="7793419">t</span><span class="op" id="7793420">,</span>&nbsp;<span class="string" id="7793422">&#34;Write(%q)&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7793456">,</span>&nbsp;<span class="ident" id="7793458">input</span><span class="op" id="7793463">[</span><span class="ident" id="7793464">pos</span><span class="op" id="7793467">:</span><span class="ident" id="7793468">end</span><span class="op" id="7793471">]</span><span class="op" id="7793472">,</span>&nbsp;<span class="ident" id="7793474">err</span><span class="op" id="7793477">,</span>&nbsp;<span class="builtintype" id="7793479">error</span><span class="op" id="7793484">(</span><span class="ident" id="7793485">nil</span><span class="op" id="7793488">)</span><span class="op" id="7793489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7793494">testEqual</span><span class="op" id="7793503">(</span><span class="ident" id="7793504">t</span><span class="op" id="7793505">,</span>&nbsp;<span class="string" id="7793507">&#34;Write(%q)&nbsp;gave&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7793542">,</span>&nbsp;<span class="ident" id="7793544">input</span><span class="op" id="7793549">[</span><span class="ident" id="7793550">pos</span><span class="op" id="7793553">:</span><span class="ident" id="7793554">end</span><span class="op" id="7793557">]</span><span class="op" id="7793558">,</span>&nbsp;<span class="ident" id="7793560">n</span><span class="op" id="7793561">,</span>&nbsp;<span class="ident" id="7793563">end</span><span class="op" id="7793566">-</span><span class="ident" id="7793567">pos</span><span class="op" id="7793570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7793574">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7793578">err</span>&nbsp;<span class="op" id="7793582">:=</span>&nbsp;<span class="ident" id="7793585">encoder</span><span class="op" id="7793592">.</span><span class="ident" id="7793593">Close</span><span class="op" id="7793598">(</span><span class="op" id="7793599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7793603">testEqual</span><span class="op" id="7793612">(</span><span class="ident" id="7793613">t</span><span class="op" id="7793614">,</span>&nbsp;<span class="string" id="7793616">&#34;Close&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7793646">,</span>&nbsp;<span class="ident" id="7793648">err</span><span class="op" id="7793651">,</span>&nbsp;<span class="builtintype" id="7793653">error</span><span class="op" id="7793658">(</span><span class="ident" id="7793659">nil</span><span class="op" id="7793662">)</span><span class="op" id="7793663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7793667">testEqual</span><span class="op" id="7793676">(</span><span class="ident" id="7793677">t</span><span class="op" id="7793678">,</span>&nbsp;<span class="string" id="7793680">&#34;Encoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7793713">,</span>&nbsp;<span class="ident" id="7793715">bs</span><span class="op" id="7793717">,</span>&nbsp;<span class="ident" id="7793719">bigtest</span><span class="op" id="7793726">.</span><span class="ident" id="7793727">decoded</span><span class="op" id="7793734">,</span>&nbsp;<span class="ident" id="7793736">strip85</span><span class="op" id="7793743">(</span><span class="ident" id="7793744">bb</span><span class="op" id="7793746">.</span><span class="ident" id="7793747">String</span><span class="op" id="7793753">(</span><span class="op" id="7793754">)</span><span class="op" id="7793755">)</span><span class="op" id="7793756">,</span>&nbsp;<span class="ident" id="7793758">strip85</span><span class="op" id="7793765">(</span><span class="ident" id="7793766">bigtest</span><span class="op" id="7793773">.</span><span class="ident" id="7793774">encoded</span><span class="op" id="7793781">)</span><span class="op" id="7793782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7793785">}</span><br>
<span class="lineno"></span><span class="op" id="7793787">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7793790">func</span>&nbsp;<span class="ident" id="7793795">TestDecode</span><span class="op" id="7793805">(</span><span class="ident" id="7793806">t</span>&nbsp;<span class="op" id="7793808">*</span><span class="ident" id="7793809">testing</span><span class="op" id="7793816">.</span><span class="ident" id="7793817">T</span><span class="op" id="7793818">)</span>&nbsp;<span class="op" id="7793820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7793823">for</span>&nbsp;<span class="ident" id="7793827">_</span><span class="op" id="7793828">,</span>&nbsp;<span class="ident" id="7793830">p</span>&nbsp;<span class="op" id="7793832">:=</span>&nbsp;<span class="keyword" id="7793835">range</span>&nbsp;<span class="ident" id="7793841">pairs</span>&nbsp;<span class="op" id="7793847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7793851">dbuf</span>&nbsp;<span class="op" id="7793856">:=</span>&nbsp;<span class="builtinfunc" id="7793859">make</span><span class="op" id="7793863">(</span><span class="op" id="7793864">[</span><span class="op" id="7793865">]</span><span class="builtintype" id="7793866">byte</span><span class="op" id="7793870">,</span>&nbsp;<span class="num" id="7793872">4</span><span class="op" id="7793873">*</span><span class="builtinfunc" id="7793874">len</span><span class="op" id="7793877">(</span><span class="ident" id="7793878">p</span><span class="op" id="7793879">.</span><span class="ident" id="7793880">encoded</span><span class="op" id="7793887">)</span><span class="op" id="7793888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7793892">ndst</span><span class="op" id="7793896">,</span>&nbsp;<span class="ident" id="7793898">nsrc</span><span class="op" id="7793902">,</span>&nbsp;<span class="ident" id="7793904">err</span>&nbsp;<span class="op" id="7793908">:=</span>&nbsp;<span class="ident" id="7793911">Decode</span><span class="op" id="7793917">(</span><span class="ident" id="7793918">dbuf</span><span class="op" id="7793922">,</span>&nbsp;<span class="op" id="7793924">[</span><span class="op" id="7793925">]</span><span class="builtintype" id="7793926">byte</span><span class="op" id="7793930">(</span><span class="ident" id="7793931">p</span><span class="op" id="7793932">.</span><span class="ident" id="7793933">encoded</span><span class="op" id="7793940">)</span><span class="op" id="7793941">,</span>&nbsp;<span class="builtintype" id="7793943">true</span><span class="op" id="7793947">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7793951">testEqual</span><span class="op" id="7793960">(</span><span class="ident" id="7793961">t</span><span class="op" id="7793962">,</span>&nbsp;<span class="string" id="7793964">&#34;Decode(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7793996">,</span>&nbsp;<span class="ident" id="7793998">p</span><span class="op" id="7793999">.</span><span class="ident" id="7794000">encoded</span><span class="op" id="7794007">,</span>&nbsp;<span class="ident" id="7794009">err</span><span class="op" id="7794012">,</span>&nbsp;<span class="builtintype" id="7794014">error</span><span class="op" id="7794019">(</span><span class="ident" id="7794020">nil</span><span class="op" id="7794023">)</span><span class="op" id="7794024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7794028">testEqual</span><span class="op" id="7794037">(</span><span class="ident" id="7794038">t</span><span class="op" id="7794039">,</span>&nbsp;<span class="string" id="7794041">&#34;Decode(%q)&nbsp;=&nbsp;nsrc&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7794072">,</span>&nbsp;<span class="ident" id="7794074">p</span><span class="op" id="7794075">.</span><span class="ident" id="7794076">encoded</span><span class="op" id="7794083">,</span>&nbsp;<span class="ident" id="7794085">nsrc</span><span class="op" id="7794089">,</span>&nbsp;<span class="builtinfunc" id="7794091">len</span><span class="op" id="7794094">(</span><span class="ident" id="7794095">p</span><span class="op" id="7794096">.</span><span class="ident" id="7794097">encoded</span><span class="op" id="7794104">)</span><span class="op" id="7794105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7794109">testEqual</span><span class="op" id="7794118">(</span><span class="ident" id="7794119">t</span><span class="op" id="7794120">,</span>&nbsp;<span class="string" id="7794122">&#34;Decode(%q)&nbsp;=&nbsp;ndst&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7794153">,</span>&nbsp;<span class="ident" id="7794155">p</span><span class="op" id="7794156">.</span><span class="ident" id="7794157">encoded</span><span class="op" id="7794164">,</span>&nbsp;<span class="ident" id="7794166">ndst</span><span class="op" id="7794170">,</span>&nbsp;<span class="builtinfunc" id="7794172">len</span><span class="op" id="7794175">(</span><span class="ident" id="7794176">p</span><span class="op" id="7794177">.</span><span class="ident" id="7794178">decoded</span><span class="op" id="7794185">)</span><span class="op" id="7794186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7794190">testEqual</span><span class="op" id="7794199">(</span><span class="ident" id="7794200">t</span><span class="op" id="7794201">,</span>&nbsp;<span class="string" id="7794203">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7794229">,</span>&nbsp;<span class="ident" id="7794231">p</span><span class="op" id="7794232">.</span><span class="ident" id="7794233">encoded</span><span class="op" id="7794240">,</span>&nbsp;<span class="builtintype" id="7794242">string</span><span class="op" id="7794248">(</span><span class="ident" id="7794249">dbuf</span><span class="op" id="7794253">[</span><span class="num" id="7794254">0</span><span class="op" id="7794255">:</span><span class="ident" id="7794256">ndst</span><span class="op" id="7794260">]</span><span class="op" id="7794261">)</span><span class="op" id="7794262">,</span>&nbsp;<span class="ident" id="7794264">p</span><span class="op" id="7794265">.</span><span class="ident" id="7794266">decoded</span><span class="op" id="7794273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7794276">}</span><br>
<span class="lineno">115</span><span class="op" id="7794278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7794281">func</span>&nbsp;<span class="ident" id="7794286">TestDecoder</span><span class="op" id="7794297">(</span><span class="ident" id="7794298">t</span>&nbsp;<span class="op" id="7794300">*</span><span class="ident" id="7794301">testing</span><span class="op" id="7794308">.</span><span class="ident" id="7794309">T</span><span class="op" id="7794310">)</span>&nbsp;<span class="op" id="7794312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7794315">for</span>&nbsp;<span class="ident" id="7794319">_</span><span class="op" id="7794320">,</span>&nbsp;<span class="ident" id="7794322">p</span>&nbsp;<span class="op" id="7794324">:=</span>&nbsp;<span class="keyword" id="7794327">range</span>&nbsp;<span class="ident" id="7794333">pairs</span>&nbsp;<span class="op" id="7794339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7794343">decoder</span>&nbsp;<span class="op" id="7794351">:=</span>&nbsp;<span class="ident" id="7794354">NewDecoder</span><span class="op" id="7794364">(</span><span class="ident" id="7794365">strings</span><span class="op" id="7794372">.</span><span class="ident" id="7794373">NewReader</span><span class="op" id="7794382">(</span><span class="ident" id="7794383">p</span><span class="op" id="7794384">.</span><span class="ident" id="7794385">encoded</span><span class="op" id="7794392">)</span><span class="op" id="7794393">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7794397">dbuf</span><span class="op" id="7794401">,</span>&nbsp;<span class="ident" id="7794403">err</span>&nbsp;<span class="op" id="7794407">:=</span>&nbsp;<span class="ident" id="7794410">ioutil</span><span class="op" id="7794416">.</span><span class="ident" id="7794417">ReadAll</span><span class="op" id="7794424">(</span><span class="ident" id="7794425">decoder</span><span class="op" id="7794432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7794436">if</span>&nbsp;<span class="ident" id="7794439">err</span>&nbsp;<span class="op" id="7794443">!=</span>&nbsp;<span class="ident" id="7794446">nil</span>&nbsp;<span class="op" id="7794450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7794455">t</span><span class="op" id="7794456">.</span><span class="ident" id="7794457">Fatal</span><span class="op" id="7794462">(</span><span class="string" id="7794463">&#34;Read&nbsp;failed&#34;</span><span class="op" id="7794476">,</span>&nbsp;<span class="ident" id="7794478">err</span><span class="op" id="7794481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7794485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7794489">testEqual</span><span class="op" id="7794498">(</span><span class="ident" id="7794499">t</span><span class="op" id="7794500">,</span>&nbsp;<span class="string" id="7794502">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7794537">,</span>&nbsp;<span class="ident" id="7794539">p</span><span class="op" id="7794540">.</span><span class="ident" id="7794541">encoded</span><span class="op" id="7794548">,</span>&nbsp;<span class="builtinfunc" id="7794550">len</span><span class="op" id="7794553">(</span><span class="ident" id="7794554">dbuf</span><span class="op" id="7794558">)</span><span class="op" id="7794559">,</span>&nbsp;<span class="builtinfunc" id="7794561">len</span><span class="op" id="7794564">(</span><span class="ident" id="7794565">p</span><span class="op" id="7794566">.</span><span class="ident" id="7794567">decoded</span><span class="op" id="7794574">)</span><span class="op" id="7794575">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7794579">testEqual</span><span class="op" id="7794588">(</span><span class="ident" id="7794589">t</span><span class="op" id="7794590">,</span>&nbsp;<span class="string" id="7794592">&#34;Decoding&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7794622">,</span>&nbsp;<span class="ident" id="7794624">p</span><span class="op" id="7794625">.</span><span class="ident" id="7794626">encoded</span><span class="op" id="7794633">,</span>&nbsp;<span class="builtintype" id="7794635">string</span><span class="op" id="7794641">(</span><span class="ident" id="7794642">dbuf</span><span class="op" id="7794646">)</span><span class="op" id="7794647">,</span>&nbsp;<span class="ident" id="7794649">p</span><span class="op" id="7794650">.</span><span class="ident" id="7794651">decoded</span><span class="op" id="7794658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7794662">if</span>&nbsp;<span class="ident" id="7794665">err</span>&nbsp;<span class="op" id="7794669">!=</span>&nbsp;<span class="ident" id="7794672">nil</span>&nbsp;<span class="op" id="7794676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7794681">testEqual</span><span class="op" id="7794690">(</span><span class="ident" id="7794691">t</span><span class="op" id="7794692">,</span>&nbsp;<span class="string" id="7794694">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7794722">,</span>&nbsp;<span class="ident" id="7794724">p</span><span class="op" id="7794725">.</span><span class="ident" id="7794726">encoded</span><span class="op" id="7794733">,</span>&nbsp;<span class="ident" id="7794735">err</span><span class="op" id="7794738">,</span>&nbsp;<span class="ident" id="7794740">io</span><span class="op" id="7794742">.</span><span class="ident" id="7794743">EOF</span><span class="op" id="7794746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7794750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7794753">}</span><br>
<span class="lineno">130</span><span class="op" id="7794755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7794758">func</span>&nbsp;<span class="ident" id="7794763">TestDecoderBuffering</span><span class="op" id="7794783">(</span><span class="ident" id="7794784">t</span>&nbsp;<span class="op" id="7794786">*</span><span class="ident" id="7794787">testing</span><span class="op" id="7794794">.</span><span class="ident" id="7794795">T</span><span class="op" id="7794796">)</span>&nbsp;<span class="op" id="7794798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7794801">for</span>&nbsp;<span class="ident" id="7794805">bs</span>&nbsp;<span class="op" id="7794808">:=</span>&nbsp;<span class="num" id="7794811">1</span><span class="op" id="7794812">;</span>&nbsp;<span class="ident" id="7794814">bs</span>&nbsp;<span class="op" id="7794817">&lt;=</span>&nbsp;<span class="num" id="7794820">12</span><span class="op" id="7794822">;</span>&nbsp;<span class="ident" id="7794824">bs</span><span class="op" id="7794826">++</span>&nbsp;<span class="op" id="7794829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7794833">decoder</span>&nbsp;<span class="op" id="7794841">:=</span>&nbsp;<span class="ident" id="7794844">NewDecoder</span><span class="op" id="7794854">(</span><span class="ident" id="7794855">strings</span><span class="op" id="7794862">.</span><span class="ident" id="7794863">NewReader</span><span class="op" id="7794872">(</span><span class="ident" id="7794873">bigtest</span><span class="op" id="7794880">.</span><span class="ident" id="7794881">encoded</span><span class="op" id="7794888">)</span><span class="op" id="7794889">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7794893">buf</span>&nbsp;<span class="op" id="7794897">:=</span>&nbsp;<span class="builtinfunc" id="7794900">make</span><span class="op" id="7794904">(</span><span class="op" id="7794905">[</span><span class="op" id="7794906">]</span><span class="builtintype" id="7794907">byte</span><span class="op" id="7794911">,</span>&nbsp;<span class="builtinfunc" id="7794913">len</span><span class="op" id="7794916">(</span><span class="ident" id="7794917">bigtest</span><span class="op" id="7794924">.</span><span class="ident" id="7794925">decoded</span><span class="op" id="7794932">)</span><span class="op" id="7794933">+</span><span class="num" id="7794934">12</span><span class="op" id="7794936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7794940">var</span>&nbsp;<span class="ident" id="7794944">total</span>&nbsp;<span class="builtintype" id="7794950">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7794956">for</span>&nbsp;<span class="ident" id="7794960">total</span>&nbsp;<span class="op" id="7794966">=</span>&nbsp;<span class="num" id="7794968">0</span><span class="op" id="7794969">;</span>&nbsp;<span class="ident" id="7794971">total</span>&nbsp;<span class="op" id="7794977">&lt;</span>&nbsp;<span class="builtinfunc" id="7794979">len</span><span class="op" id="7794982">(</span><span class="ident" id="7794983">bigtest</span><span class="op" id="7794990">.</span><span class="ident" id="7794991">decoded</span><span class="op" id="7794998">)</span><span class="op" id="7794999">;</span>&nbsp;<span class="op" id="7795001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7795006">n</span><span class="op" id="7795007">,</span>&nbsp;<span class="ident" id="7795009">err</span>&nbsp;<span class="op" id="7795013">:=</span>&nbsp;<span class="ident" id="7795016">decoder</span><span class="op" id="7795023">.</span><span class="ident" id="7795024">Read</span><span class="op" id="7795028">(</span><span class="ident" id="7795029">buf</span><span class="op" id="7795032">[</span><span class="ident" id="7795033">total</span>&nbsp;<span class="op" id="7795039">:</span>&nbsp;<span class="ident" id="7795041">total</span><span class="op" id="7795046">+</span><span class="ident" id="7795047">bs</span><span class="op" id="7795049">]</span><span class="op" id="7795050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7795055">testEqual</span><span class="op" id="7795064">(</span><span class="ident" id="7795065">t</span><span class="op" id="7795066">,</span>&nbsp;<span class="string" id="7795068">&#34;Read&nbsp;from&nbsp;%q&nbsp;at&nbsp;pos&nbsp;%d&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="7795113">,</span>&nbsp;<span class="ident" id="7795115">bigtest</span><span class="op" id="7795122">.</span><span class="ident" id="7795123">encoded</span><span class="op" id="7795130">,</span>&nbsp;<span class="ident" id="7795132">total</span><span class="op" id="7795137">,</span>&nbsp;<span class="ident" id="7795139">n</span><span class="op" id="7795140">,</span>&nbsp;<span class="ident" id="7795142">err</span><span class="op" id="7795145">,</span>&nbsp;<span class="builtintype" id="7795147">error</span><span class="op" id="7795152">(</span><span class="ident" id="7795153">nil</span><span class="op" id="7795156">)</span><span class="op" id="7795157">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7795162">total</span>&nbsp;<span class="op" id="7795168">+=</span>&nbsp;<span class="ident" id="7795171">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7795175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7795179">testEqual</span><span class="op" id="7795188">(</span><span class="ident" id="7795189">t</span><span class="op" id="7795190">,</span>&nbsp;<span class="string" id="7795192">&#34;Decoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7795225">,</span>&nbsp;<span class="ident" id="7795227">bs</span><span class="op" id="7795229">,</span>&nbsp;<span class="ident" id="7795231">bigtest</span><span class="op" id="7795238">.</span><span class="ident" id="7795239">encoded</span><span class="op" id="7795246">,</span>&nbsp;<span class="builtintype" id="7795248">string</span><span class="op" id="7795254">(</span><span class="ident" id="7795255">buf</span><span class="op" id="7795258">[</span><span class="num" id="7795259">0</span><span class="op" id="7795260">:</span><span class="ident" id="7795261">total</span><span class="op" id="7795266">]</span><span class="op" id="7795267">)</span><span class="op" id="7795268">,</span>&nbsp;<span class="ident" id="7795270">bigtest</span><span class="op" id="7795277">.</span><span class="ident" id="7795278">decoded</span><span class="op" id="7795285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7795288">}</span><br>
<span class="lineno"></span><span class="op" id="7795290">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="7795293">func</span>&nbsp;<span class="ident" id="7795298">TestDecodeCorrupt</span><span class="op" id="7795315">(</span><span class="ident" id="7795316">t</span>&nbsp;<span class="op" id="7795318">*</span><span class="ident" id="7795319">testing</span><span class="op" id="7795326">.</span><span class="ident" id="7795327">T</span><span class="op" id="7795328">)</span>&nbsp;<span class="op" id="7795330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7795333">type</span>&nbsp;<span class="ident" id="7795338">corrupt</span>&nbsp;<span class="keyword" id="7795346">struct</span>&nbsp;<span class="op" id="7795353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7795357">e</span>&nbsp;<span class="builtintype" id="7795359">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7795368">p</span>&nbsp;<span class="builtintype" id="7795370">int</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7795375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7795378">examples</span>&nbsp;<span class="op" id="7795387">:=</span>&nbsp;<span class="op" id="7795390">[</span><span class="op" id="7795391">]</span><span class="ident" id="7795392">corrupt</span><span class="op" id="7795399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7795403">{</span><span class="string" id="7795404">&#34;v&#34;</span><span class="op" id="7795407">,</span>&nbsp;<span class="num" id="7795409">0</span><span class="op" id="7795410">}</span><span class="op" id="7795411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7795415">{</span><span class="string" id="7795416">&#34;!z!!!!!!!!!&#34;</span><span class="op" id="7795429">,</span>&nbsp;<span class="num" id="7795431">1</span><span class="op" id="7795432">}</span><span class="op" id="7795433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7795436">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7795440">for</span>&nbsp;<span class="ident" id="7795444">_</span><span class="op" id="7795445">,</span>&nbsp;<span class="ident" id="7795447">e</span>&nbsp;<span class="op" id="7795449">:=</span>&nbsp;<span class="keyword" id="7795452">range</span>&nbsp;<span class="ident" id="7795458">examples</span>&nbsp;<span class="op" id="7795467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7795471">dbuf</span>&nbsp;<span class="op" id="7795476">:=</span>&nbsp;<span class="builtinfunc" id="7795479">make</span><span class="op" id="7795483">(</span><span class="op" id="7795484">[</span><span class="op" id="7795485">]</span><span class="builtintype" id="7795486">byte</span><span class="op" id="7795490">,</span>&nbsp;<span class="num" id="7795492">4</span><span class="op" id="7795493">*</span><span class="builtinfunc" id="7795494">len</span><span class="op" id="7795497">(</span><span class="ident" id="7795498">e</span><span class="op" id="7795499">.</span><span class="ident" id="7795500">e</span><span class="op" id="7795501">)</span><span class="op" id="7795502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7795506">_</span><span class="op" id="7795507">,</span>&nbsp;<span class="ident" id="7795509">_</span><span class="op" id="7795510">,</span>&nbsp;<span class="ident" id="7795512">err</span>&nbsp;<span class="op" id="7795516">:=</span>&nbsp;<span class="ident" id="7795519">Decode</span><span class="op" id="7795525">(</span><span class="ident" id="7795526">dbuf</span><span class="op" id="7795530">,</span>&nbsp;<span class="op" id="7795532">[</span><span class="op" id="7795533">]</span><span class="builtintype" id="7795534">byte</span><span class="op" id="7795538">(</span><span class="ident" id="7795539">e</span><span class="op" id="7795540">.</span><span class="ident" id="7795541">e</span><span class="op" id="7795542">)</span><span class="op" id="7795543">,</span>&nbsp;<span class="builtintype" id="7795545">true</span><span class="op" id="7795549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7795553">switch</span>&nbsp;<span class="ident" id="7795560">err</span>&nbsp;<span class="op" id="7795564">:=</span>&nbsp;<span class="ident" id="7795567">err</span><span class="op" id="7795570">.</span><span class="op" id="7795571">(</span><span class="keyword" id="7795572">type</span><span class="op" id="7795576">)</span>&nbsp;<span class="op" id="7795578">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7795582">case</span>&nbsp;<span class="ident" id="7795587">CorruptInputError</span><span class="op" id="7795604">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7795609">testEqual</span><span class="op" id="7795618">(</span><span class="ident" id="7795619">t</span><span class="op" id="7795620">,</span>&nbsp;<span class="string" id="7795622">&#34;Corruption&nbsp;in&nbsp;%q&nbsp;at&nbsp;offset&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7795662">,</span>&nbsp;<span class="ident" id="7795664">e</span><span class="op" id="7795665">.</span><span class="ident" id="7795666">e</span><span class="op" id="7795667">,</span>&nbsp;<span class="builtintype" id="7795669">int</span><span class="op" id="7795672">(</span><span class="ident" id="7795673">err</span><span class="op" id="7795676">)</span><span class="op" id="7795677">,</span>&nbsp;<span class="ident" id="7795679">e</span><span class="op" id="7795680">.</span><span class="ident" id="7795681">p</span><span class="op" id="7795682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7795686">default</span><span class="op" id="7795693">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7795698">t</span><span class="op" id="7795699">.</span><span class="ident" id="7795700">Error</span><span class="op" id="7795705">(</span><span class="string" id="7795706">&#34;Decoder&nbsp;failed&nbsp;to&nbsp;detect&nbsp;corruption&nbsp;in&#34;</span><span class="op" id="7795746">,</span>&nbsp;<span class="ident" id="7795748">e</span><span class="op" id="7795749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7795753">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7795756">}</span><br>
<span class="lineno"></span><span class="op" id="7795758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7795761">func</span>&nbsp;<span class="ident" id="7795766">TestBig</span><span class="op" id="7795773">(</span><span class="ident" id="7795774">t</span>&nbsp;<span class="op" id="7795776">*</span><span class="ident" id="7795777">testing</span><span class="op" id="7795784">.</span><span class="ident" id="7795785">T</span><span class="op" id="7795786">)</span>&nbsp;<span class="op" id="7795788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7795791">n</span>&nbsp;<span class="op" id="7795793">:=</span>&nbsp;<span class="num" id="7795796">3</span><span class="op" id="7795797">*</span><span class="num" id="7795798">1000</span>&nbsp;<span class="op" id="7795803">+</span>&nbsp;<span class="num" id="7795805">1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7795808">raw</span>&nbsp;<span class="op" id="7795812">:=</span>&nbsp;<span class="builtinfunc" id="7795815">make</span><span class="op" id="7795819">(</span><span class="op" id="7795820">[</span><span class="op" id="7795821">]</span><span class="builtintype" id="7795822">byte</span><span class="op" id="7795826">,</span>&nbsp;<span class="ident" id="7795828">n</span><span class="op" id="7795829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7795832">const</span>&nbsp;<span class="ident" id="7795838">alpha</span>&nbsp;<span class="op" id="7795844">=</span>&nbsp;<span class="string" id="7795846">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7795912">for</span>&nbsp;<span class="ident" id="7795916">i</span>&nbsp;<span class="op" id="7795918">:=</span>&nbsp;<span class="num" id="7795921">0</span><span class="op" id="7795922">;</span>&nbsp;<span class="ident" id="7795924">i</span>&nbsp;<span class="op" id="7795926">&lt;</span>&nbsp;<span class="ident" id="7795928">n</span><span class="op" id="7795929">;</span>&nbsp;<span class="ident" id="7795931">i</span><span class="op" id="7795932">++</span>&nbsp;<span class="op" id="7795935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7795939">raw</span><span class="op" id="7795942">[</span><span class="ident" id="7795943">i</span><span class="op" id="7795944">]</span>&nbsp;<span class="op" id="7795946">=</span>&nbsp;<span class="ident" id="7795948">alpha</span><span class="op" id="7795953">[</span><span class="ident" id="7795954">i</span><span class="op" id="7795955">%</span><span class="builtinfunc" id="7795956">len</span><span class="op" id="7795959">(</span><span class="ident" id="7795960">alpha</span><span class="op" id="7795965">)</span><span class="op" id="7795966">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7795969">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7795972">encoded</span>&nbsp;<span class="op" id="7795980">:=</span>&nbsp;<span class="builtinfunc" id="7795983">new</span><span class="op" id="7795986">(</span><span class="ident" id="7795987">bytes</span><span class="op" id="7795992">.</span><span class="ident" id="7795993">Buffer</span><span class="op" id="7795999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7796002">w</span>&nbsp;<span class="op" id="7796004">:=</span>&nbsp;<span class="ident" id="7796007">NewEncoder</span><span class="op" id="7796017">(</span><span class="ident" id="7796018">encoded</span><span class="op" id="7796025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7796028">nn</span><span class="op" id="7796030">,</span>&nbsp;<span class="ident" id="7796032">err</span>&nbsp;<span class="op" id="7796036">:=</span>&nbsp;<span class="ident" id="7796039">w</span><span class="op" id="7796040">.</span><span class="ident" id="7796041">Write</span><span class="op" id="7796046">(</span><span class="ident" id="7796047">raw</span><span class="op" id="7796050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7796053">if</span>&nbsp;<span class="ident" id="7796056">nn</span>&nbsp;<span class="op" id="7796059">!=</span>&nbsp;<span class="ident" id="7796062">n</span>&nbsp;<span class="op" id="7796064">||</span>&nbsp;<span class="ident" id="7796067">err</span>&nbsp;<span class="op" id="7796071">!=</span>&nbsp;<span class="ident" id="7796074">nil</span>&nbsp;<span class="op" id="7796078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7796082">t</span><span class="op" id="7796083">.</span><span class="ident" id="7796084">Fatalf</span><span class="op" id="7796090">(</span><span class="string" id="7796091">&#34;Encoder.Write(raw)&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7796133">,</span>&nbsp;<span class="ident" id="7796135">nn</span><span class="op" id="7796137">,</span>&nbsp;<span class="ident" id="7796139">err</span><span class="op" id="7796142">,</span>&nbsp;<span class="ident" id="7796144">n</span><span class="op" id="7796145">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7796148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7796151">err</span>&nbsp;<span class="op" id="7796155">=</span>&nbsp;<span class="ident" id="7796157">w</span><span class="op" id="7796158">.</span><span class="ident" id="7796159">Close</span><span class="op" id="7796164">(</span><span class="op" id="7796165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7796168">if</span>&nbsp;<span class="ident" id="7796171">err</span>&nbsp;<span class="op" id="7796175">!=</span>&nbsp;<span class="ident" id="7796178">nil</span>&nbsp;<span class="op" id="7796182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7796186">t</span><span class="op" id="7796187">.</span><span class="ident" id="7796188">Fatalf</span><span class="op" id="7796194">(</span><span class="string" id="7796195">&#34;Encoder.Close()&nbsp;=&nbsp;%v&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7796226">,</span>&nbsp;<span class="ident" id="7796228">err</span><span class="op" id="7796231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7796234">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7796237">decoded</span><span class="op" id="7796244">,</span>&nbsp;<span class="ident" id="7796246">err</span>&nbsp;<span class="op" id="7796250">:=</span>&nbsp;<span class="ident" id="7796253">ioutil</span><span class="op" id="7796259">.</span><span class="ident" id="7796260">ReadAll</span><span class="op" id="7796267">(</span><span class="ident" id="7796268">NewDecoder</span><span class="op" id="7796278">(</span><span class="ident" id="7796279">encoded</span><span class="op" id="7796286">)</span><span class="op" id="7796287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7796290">if</span>&nbsp;<span class="ident" id="7796293">err</span>&nbsp;<span class="op" id="7796297">!=</span>&nbsp;<span class="ident" id="7796300">nil</span>&nbsp;<span class="op" id="7796304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7796308">t</span><span class="op" id="7796309">.</span><span class="ident" id="7796310">Fatalf</span><span class="op" id="7796316">(</span><span class="string" id="7796317">&#34;io.ReadAll(NewDecoder(...)):&nbsp;%v&#34;</span><span class="op" id="7796350">,</span>&nbsp;<span class="ident" id="7796352">err</span><span class="op" id="7796355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7796358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7796362">if</span>&nbsp;<span class="op" id="7796365">!</span><span class="ident" id="7796366">bytes</span><span class="op" id="7796371">.</span><span class="ident" id="7796372">Equal</span><span class="op" id="7796377">(</span><span class="ident" id="7796378">raw</span><span class="op" id="7796381">,</span>&nbsp;<span class="ident" id="7796383">decoded</span><span class="op" id="7796390">)</span>&nbsp;<span class="op" id="7796392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7796396">var</span>&nbsp;<span class="ident" id="7796400">i</span>&nbsp;<span class="builtintype" id="7796402">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7796408">for</span>&nbsp;<span class="ident" id="7796412">i</span>&nbsp;<span class="op" id="7796414">=</span>&nbsp;<span class="num" id="7796416">0</span><span class="op" id="7796417">;</span>&nbsp;<span class="ident" id="7796419">i</span>&nbsp;<span class="op" id="7796421">&lt;</span>&nbsp;<span class="builtinfunc" id="7796423">len</span><span class="op" id="7796426">(</span><span class="ident" id="7796427">decoded</span><span class="op" id="7796434">)</span>&nbsp;<span class="op" id="7796436">&amp;&amp;</span>&nbsp;<span class="ident" id="7796439">i</span>&nbsp;<span class="op" id="7796441">&lt;</span>&nbsp;<span class="builtinfunc" id="7796443">len</span><span class="op" id="7796446">(</span><span class="ident" id="7796447">raw</span><span class="op" id="7796450">)</span><span class="op" id="7796451">;</span>&nbsp;<span class="ident" id="7796453">i</span><span class="op" id="7796454">++</span>&nbsp;<span class="op" id="7796457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7796462">if</span>&nbsp;<span class="ident" id="7796465">decoded</span><span class="op" id="7796472">[</span><span class="ident" id="7796473">i</span><span class="op" id="7796474">]</span>&nbsp;<span class="op" id="7796476">!=</span>&nbsp;<span class="ident" id="7796479">raw</span><span class="op" id="7796482">[</span><span class="ident" id="7796483">i</span><span class="op" id="7796484">]</span>&nbsp;<span class="op" id="7796486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7796492">break</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7796501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7796505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7796509">t</span><span class="op" id="7796510">.</span><span class="ident" id="7796511">Errorf</span><span class="op" id="7796517">(</span><span class="string" id="7796518">&#34;Decode(Encode(%d-byte&nbsp;string))&nbsp;failed&nbsp;at&nbsp;offset&nbsp;%d&#34;</span><span class="op" id="7796570">,</span>&nbsp;<span class="ident" id="7796572">n</span><span class="op" id="7796573">,</span>&nbsp;<span class="ident" id="7796575">i</span><span class="op" id="7796576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7796579">}</span><br>
<span class="lineno"></span><span class="op" id="7796581">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="7796584">func</span>&nbsp;<span class="ident" id="7796589">TestDecoderInternalWhitespace</span><span class="op" id="7796618">(</span><span class="ident" id="7796619">t</span>&nbsp;<span class="op" id="7796621">*</span><span class="ident" id="7796622">testing</span><span class="op" id="7796629">.</span><span class="ident" id="7796630">T</span><span class="op" id="7796631">)</span>&nbsp;<span class="op" id="7796633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7796636">s</span>&nbsp;<span class="op" id="7796638">:=</span>&nbsp;<span class="ident" id="7796641">strings</span><span class="op" id="7796648">.</span><span class="ident" id="7796649">Repeat</span><span class="op" id="7796655">(</span><span class="string" id="7796656">&#34;&nbsp;&#34;</span><span class="op" id="7796659">,</span>&nbsp;<span class="num" id="7796661">2048</span><span class="op" id="7796665">)</span>&nbsp;<span class="op" id="7796667">+</span>&nbsp;<span class="string" id="7796669">&#34;z&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7796674">decoded</span><span class="op" id="7796681">,</span>&nbsp;<span class="ident" id="7796683">err</span>&nbsp;<span class="op" id="7796687">:=</span>&nbsp;<span class="ident" id="7796690">ioutil</span><span class="op" id="7796696">.</span><span class="ident" id="7796697">ReadAll</span><span class="op" id="7796704">(</span><span class="ident" id="7796705">NewDecoder</span><span class="op" id="7796715">(</span><span class="ident" id="7796716">strings</span><span class="op" id="7796723">.</span><span class="ident" id="7796724">NewReader</span><span class="op" id="7796733">(</span><span class="ident" id="7796734">s</span><span class="op" id="7796735">)</span><span class="op" id="7796736">)</span><span class="op" id="7796737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7796740">if</span>&nbsp;<span class="ident" id="7796743">err</span>&nbsp;<span class="op" id="7796747">!=</span>&nbsp;<span class="ident" id="7796750">nil</span>&nbsp;<span class="op" id="7796754">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7796758">t</span><span class="op" id="7796759">.</span><span class="ident" id="7796760">Errorf</span><span class="op" id="7796766">(</span><span class="string" id="7796767">&#34;Decode&nbsp;gave&nbsp;error&nbsp;%v&#34;</span><span class="op" id="7796789">,</span>&nbsp;<span class="ident" id="7796791">err</span><span class="op" id="7796794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7796797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7796800">if</span>&nbsp;<span class="ident" id="7796803">want</span>&nbsp;<span class="op" id="7796808">:=</span>&nbsp;<span class="op" id="7796811">[</span><span class="op" id="7796812">]</span><span class="builtintype" id="7796813">byte</span><span class="op" id="7796817">(</span><span class="string" id="7796818">&#34;\000\000\000\000&#34;</span><span class="op" id="7796836">)</span><span class="op" id="7796837">;</span>&nbsp;<span class="op" id="7796839">!</span><span class="ident" id="7796840">bytes</span><span class="op" id="7796845">.</span><span class="ident" id="7796846">Equal</span><span class="op" id="7796851">(</span><span class="ident" id="7796852">want</span><span class="op" id="7796856">,</span>&nbsp;<span class="ident" id="7796858">decoded</span><span class="op" id="7796865">)</span>&nbsp;<span class="op" id="7796867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7796871">t</span><span class="op" id="7796872">.</span><span class="ident" id="7796873">Errorf</span><span class="op" id="7796879">(</span><span class="string" id="7796880">&#34;Decode&nbsp;failed:&nbsp;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7796912">,</span>&nbsp;<span class="ident" id="7796914">decoded</span><span class="op" id="7796921">,</span>&nbsp;<span class="ident" id="7796923">want</span><span class="op" id="7796927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7796930">}</span><br>
<span class="lineno">210</span><span class="op" id="7796932">}</span>
</div>
</body>
</html>
