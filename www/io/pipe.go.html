<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2415817">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2415872">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2415926">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2415977">//&nbsp;Pipe&nbsp;adapter&nbsp;to&nbsp;connect&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Reader</span><br>
<span class="lineno"></span><span class="comment" id="2416032">//&nbsp;with&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2416070">package</span>&nbsp;<span class="ident" id="2416078">io</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="2416082">import</span>&nbsp;<span class="op" id="2416089">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2416092">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2416102">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="2416109">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2416112">//&nbsp;ErrClosedPipe&nbsp;is&nbsp;the&nbsp;error&nbsp;used&nbsp;for&nbsp;read&nbsp;or&nbsp;write&nbsp;operations&nbsp;on&nbsp;a&nbsp;closed&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="2416194">var</span>&nbsp;<span class="ident" id="2416198">ErrClosedPipe</span>&nbsp;<span class="op" id="2416212">=</span>&nbsp;<span class="ident" id="2416214"><a href="/io/pipe.go.html#2416092">errors</a></span><span class="op" id="2416220">.</span><span class="ident" id="2416221">New</span><span class="op" id="2416224">(</span><span class="string" id="2416225">&#34;io:&nbsp;read/write&nbsp;on&nbsp;closed&nbsp;pipe&#34;</span><span class="op" id="2416256">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2416259">type</span>&nbsp;<span class="ident" id="2416264">pipeResult</span>&nbsp;<span class="keyword" id="2416275">struct</span>&nbsp;<span class="op" id="2416282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2416285">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2416289">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2416294">err</span>&nbsp;<span class="builtintype" id="2416298">error</span><br>
<span class="lineno"></span><span class="op" id="2416304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2416307">//&nbsp;A&nbsp;pipe&nbsp;is&nbsp;the&nbsp;shared&nbsp;pipe&nbsp;structure&nbsp;underlying&nbsp;PipeReader&nbsp;and&nbsp;PipeWriter.</span><br>
<span class="lineno"></span><span class="keyword" id="2416384">type</span>&nbsp;<span class="ident" id="2416389">pipe</span>&nbsp;<span class="keyword" id="2416394">struct</span>&nbsp;<span class="op" id="2416401">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2416404">rl</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2416410"><a href="/io/pipe.go.html#2416102">sync</a></span><span class="op" id="2416414">.</span><span class="ident" id="2416415">Mutex</span>&nbsp;<span class="comment" id="2416421">//&nbsp;gates&nbsp;readers&nbsp;one&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2416453">wl</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2416459"><a href="/io/pipe.go.html#2416102">sync</a></span><span class="op" id="2416463">.</span><span class="ident" id="2416464">Mutex</span>&nbsp;<span class="comment" id="2416470">//&nbsp;gates&nbsp;writers&nbsp;one&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2416502">l</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2416508"><a href="/io/pipe.go.html#2416102">sync</a></span><span class="op" id="2416512">.</span><span class="ident" id="2416513">Mutex</span>&nbsp;<span class="comment" id="2416519">//&nbsp;protects&nbsp;remaining&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2416549">data</span>&nbsp;&nbsp;<span class="op" id="2416555">[</span><span class="op" id="2416556">]</span><span class="builtintype" id="2416557">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2416566">//&nbsp;data&nbsp;remaining&nbsp;in&nbsp;pending&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2416602">rwait</span>&nbsp;<span class="ident" id="2416608"><a href="/io/pipe.go.html#2416102">sync</a></span><span class="op" id="2416612">.</span><span class="ident" id="2416613">Cond</span>&nbsp;&nbsp;<span class="comment" id="2416619">//&nbsp;waiting&nbsp;reader</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2416638">wwait</span>&nbsp;<span class="ident" id="2416644"><a href="/io/pipe.go.html#2416102">sync</a></span><span class="op" id="2416648">.</span><span class="ident" id="2416649">Cond</span>&nbsp;&nbsp;<span class="comment" id="2416655">//&nbsp;waiting&nbsp;writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2416674">rerr</span>&nbsp;&nbsp;<span class="builtintype" id="2416680">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2416691">//&nbsp;if&nbsp;reader&nbsp;closed,&nbsp;error&nbsp;to&nbsp;give&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2416734">werr</span>&nbsp;&nbsp;<span class="builtintype" id="2416740">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2416751">//&nbsp;if&nbsp;writer&nbsp;closed,&nbsp;error&nbsp;to&nbsp;give&nbsp;reads</span><br>
<span class="lineno"></span><span class="op" id="2416792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="2416795">func</span>&nbsp;<span class="op" id="2416800">(</span><span class="ident" id="2416801">p</span>&nbsp;<span class="op" id="2416803">*</span><span class="ident" id="2416804"><a href="/io/pipe.go.html#2416389">pipe</a></span><span class="op" id="2416808">)</span>&nbsp;<span class="ident" id="2416810">read</span><span class="op" id="2416814">(</span><span class="ident" id="2416815">b</span>&nbsp;<span class="op" id="2416817">[</span><span class="op" id="2416818">]</span><span class="builtintype" id="2416819">byte</span><span class="op" id="2416823">)</span>&nbsp;<span class="op" id="2416825">(</span><span class="ident" id="2416826">n</span>&nbsp;<span class="builtintype" id="2416828">int</span><span class="op" id="2416831">,</span>&nbsp;<span class="ident" id="2416833">err</span>&nbsp;<span class="builtintype" id="2416837">error</span><span class="op" id="2416842">)</span>&nbsp;<span class="op" id="2416844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2416847">//&nbsp;One&nbsp;reader&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2416873"><a href="/io/pipe.go.html#2416801">p</a></span><span class="op" id="2416874">.</span><span class="ident" id="2416875">rl</span><span class="op" id="2416877">.</span><span class="ident" id="2416878">Lock</span><span class="op" id="2416882">(</span><span class="op" id="2416883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2416886">defer</span>&nbsp;<span class="ident" id="2416892"><a href="/io/pipe.go.html#2416801">p</a></span><span class="op" id="2416893">.</span><span class="ident" id="2416894">rl</span><span class="op" id="2416896">.</span><span class="ident" id="2416897">Unlock</span><span class="op" id="2416903">(</span><span class="op" id="2416904">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2416908"><a href="/io/pipe.go.html#2416801">p</a></span><span class="op" id="2416909">.</span><span class="ident" id="2416910">l</span><span class="op" id="2416911">.</span><span class="ident" id="2416912">Lock</span><span class="op" id="2416916">(</span><span class="op" id="2416917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2416920">defer</span>&nbsp;<span class="ident" id="2416926"><a href="/io/pipe.go.html#2416801">p</a></span><span class="op" id="2416927">.</span><span class="ident" id="2416928">l</span><span class="op" id="2416929">.</span><span class="ident" id="2416930">Unlock</span><span class="op" id="2416936">(</span><span class="op" id="2416937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2416940">for</span>&nbsp;<span class="op" id="2416944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2416948">if</span>&nbsp;<span class="ident" id="2416951"><a href="/io/pipe.go.html#2416801">p</a></span><span class="op" id="2416952">.</span><span class="ident" id="2416953">rerr</span>&nbsp;<span class="op" id="2416958">!=</span>&nbsp;<span class="ident" id="2416961">nil</span>&nbsp;<span class="op" id="2416965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2416970">return</span>&nbsp;<span class="num" id="2416977">0</span><span class="op" id="2416978">,</span>&nbsp;<span class="ident" id="2416980"><a href="/io/pipe.go.html#2416198">ErrClosedPipe</a></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2416996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417000">if</span>&nbsp;<span class="ident" id="2417003"><a href="/io/pipe.go.html#2416801">p</a></span><span class="op" id="2417004">.</span><span class="ident" id="2417005">data</span>&nbsp;<span class="op" id="2417010">!=</span>&nbsp;<span class="ident" id="2417013">nil</span>&nbsp;<span class="op" id="2417017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417022">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2417030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417034">if</span>&nbsp;<span class="ident" id="2417037"><a href="/io/pipe.go.html#2416801">p</a></span><span class="op" id="2417038">.</span><span class="ident" id="2417039">werr</span>&nbsp;<span class="op" id="2417044">!=</span>&nbsp;<span class="ident" id="2417047">nil</span>&nbsp;<span class="op" id="2417051">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417056">return</span>&nbsp;<span class="num" id="2417063">0</span><span class="op" id="2417064">,</span>&nbsp;<span class="ident" id="2417066"><a href="/io/pipe.go.html#2416801">p</a></span><span class="op" id="2417067">.</span><span class="ident" id="2417068">werr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2417075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417079"><a href="/io/pipe.go.html#2416801">p</a></span><span class="op" id="2417080">.</span><span class="ident" id="2417081">rwait</span><span class="op" id="2417086">.</span><span class="ident" id="2417087">Wait</span><span class="op" id="2417091">(</span><span class="op" id="2417092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2417095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417098"><a href="/io/pipe.go.html#2416826">n</a></span>&nbsp;<span class="op" id="2417100">=</span>&nbsp;<span class="builtinfunc" id="2417102">copy</span><span class="op" id="2417106">(</span><span class="ident" id="2417107"><a href="/io/pipe.go.html#2416815">b</a></span><span class="op" id="2417108">,</span>&nbsp;<span class="ident" id="2417110"><a href="/io/pipe.go.html#2416801">p</a></span><span class="op" id="2417111">.</span><span class="ident" id="2417112">data</span><span class="op" id="2417116">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417119"><a href="/io/pipe.go.html#2416801">p</a></span><span class="op" id="2417120">.</span><span class="ident" id="2417121">data</span>&nbsp;<span class="op" id="2417126">=</span>&nbsp;<span class="ident" id="2417128"><a href="/io/pipe.go.html#2416801">p</a></span><span class="op" id="2417129">.</span><span class="ident" id="2417130">data</span><span class="op" id="2417134">[</span><span class="ident" id="2417135"><a href="/io/pipe.go.html#2416826">n</a></span><span class="op" id="2417136">:</span><span class="op" id="2417137">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417140">if</span>&nbsp;<span class="builtinfunc" id="2417143">len</span><span class="op" id="2417146">(</span><span class="ident" id="2417147"><a href="/io/pipe.go.html#2416801">p</a></span><span class="op" id="2417148">.</span><span class="ident" id="2417149">data</span><span class="op" id="2417153">)</span>&nbsp;<span class="op" id="2417155">==</span>&nbsp;<span class="num" id="2417158">0</span>&nbsp;<span class="op" id="2417160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417164"><a href="/io/pipe.go.html#2416801">p</a></span><span class="op" id="2417165">.</span><span class="ident" id="2417166">data</span>&nbsp;<span class="op" id="2417171">=</span>&nbsp;<span class="ident" id="2417173">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417179"><a href="/io/pipe.go.html#2416801">p</a></span><span class="op" id="2417180">.</span><span class="ident" id="2417181">wwait</span><span class="op" id="2417186">.</span><span class="ident" id="2417187">Signal</span><span class="op" id="2417193">(</span><span class="op" id="2417194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2417197">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417200">return</span><br>
<span class="lineno"></span><span class="op" id="2417207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2417210">var</span>&nbsp;<span class="ident" id="2417214">zero</span>&nbsp;<span class="op" id="2417219">[</span><span class="num" id="2417220">0</span><span class="op" id="2417221">]</span><span class="builtintype" id="2417222">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="2417228">func</span>&nbsp;<span class="op" id="2417233">(</span><span class="ident" id="2417234">p</span>&nbsp;<span class="op" id="2417236">*</span><span class="ident" id="2417237"><a href="/io/pipe.go.html#2416389">pipe</a></span><span class="op" id="2417241">)</span>&nbsp;<span class="ident" id="2417243">write</span><span class="op" id="2417248">(</span><span class="ident" id="2417249">b</span>&nbsp;<span class="op" id="2417251">[</span><span class="op" id="2417252">]</span><span class="builtintype" id="2417253">byte</span><span class="op" id="2417257">)</span>&nbsp;<span class="op" id="2417259">(</span><span class="ident" id="2417260">n</span>&nbsp;<span class="builtintype" id="2417262">int</span><span class="op" id="2417265">,</span>&nbsp;<span class="ident" id="2417267">err</span>&nbsp;<span class="builtintype" id="2417271">error</span><span class="op" id="2417276">)</span>&nbsp;<span class="op" id="2417278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2417281">//&nbsp;pipe&nbsp;uses&nbsp;nil&nbsp;to&nbsp;mean&nbsp;not&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417321">if</span>&nbsp;<span class="ident" id="2417324"><a href="/io/pipe.go.html#2417249">b</a></span>&nbsp;<span class="op" id="2417326">==</span>&nbsp;<span class="ident" id="2417329">nil</span>&nbsp;<span class="op" id="2417333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417337"><a href="/io/pipe.go.html#2417249">b</a></span>&nbsp;<span class="op" id="2417339">=</span>&nbsp;<span class="ident" id="2417341"><a href="/io/pipe.go.html#2417214">zero</a></span><span class="op" id="2417345">[</span><span class="op" id="2417346">:</span><span class="op" id="2417347">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2417350">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2417354">//&nbsp;One&nbsp;writer&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417380"><a href="/io/pipe.go.html#2417234">p</a></span><span class="op" id="2417381">.</span><span class="ident" id="2417382">wl</span><span class="op" id="2417384">.</span><span class="ident" id="2417385">Lock</span><span class="op" id="2417389">(</span><span class="op" id="2417390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417393">defer</span>&nbsp;<span class="ident" id="2417399"><a href="/io/pipe.go.html#2417234">p</a></span><span class="op" id="2417400">.</span><span class="ident" id="2417401">wl</span><span class="op" id="2417403">.</span><span class="ident" id="2417404">Unlock</span><span class="op" id="2417410">(</span><span class="op" id="2417411">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417415"><a href="/io/pipe.go.html#2417234">p</a></span><span class="op" id="2417416">.</span><span class="ident" id="2417417">l</span><span class="op" id="2417418">.</span><span class="ident" id="2417419">Lock</span><span class="op" id="2417423">(</span><span class="op" id="2417424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417427">defer</span>&nbsp;<span class="ident" id="2417433"><a href="/io/pipe.go.html#2417234">p</a></span><span class="op" id="2417434">.</span><span class="ident" id="2417435">l</span><span class="op" id="2417436">.</span><span class="ident" id="2417437">Unlock</span><span class="op" id="2417443">(</span><span class="op" id="2417444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417447">if</span>&nbsp;<span class="ident" id="2417450"><a href="/io/pipe.go.html#2417234">p</a></span><span class="op" id="2417451">.</span><span class="ident" id="2417452">werr</span>&nbsp;<span class="op" id="2417457">!=</span>&nbsp;<span class="ident" id="2417460">nil</span>&nbsp;<span class="op" id="2417464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417468"><a href="/io/pipe.go.html#2417267">err</a></span>&nbsp;<span class="op" id="2417472">=</span>&nbsp;<span class="ident" id="2417474"><a href="/io/pipe.go.html#2416198">ErrClosedPipe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417490">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2417498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417501"><a href="/io/pipe.go.html#2417234">p</a></span><span class="op" id="2417502">.</span><span class="ident" id="2417503">data</span>&nbsp;<span class="op" id="2417508">=</span>&nbsp;<span class="ident" id="2417510"><a href="/io/pipe.go.html#2417249">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417513"><a href="/io/pipe.go.html#2417234">p</a></span><span class="op" id="2417514">.</span><span class="ident" id="2417515">rwait</span><span class="op" id="2417520">.</span><span class="ident" id="2417521">Signal</span><span class="op" id="2417527">(</span><span class="op" id="2417528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417531">for</span>&nbsp;<span class="op" id="2417535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417539">if</span>&nbsp;<span class="ident" id="2417542"><a href="/io/pipe.go.html#2417234">p</a></span><span class="op" id="2417543">.</span><span class="ident" id="2417544">data</span>&nbsp;<span class="op" id="2417549">==</span>&nbsp;<span class="ident" id="2417552">nil</span>&nbsp;<span class="op" id="2417556">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417561">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2417569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417573">if</span>&nbsp;<span class="ident" id="2417576"><a href="/io/pipe.go.html#2417234">p</a></span><span class="op" id="2417577">.</span><span class="ident" id="2417578">rerr</span>&nbsp;<span class="op" id="2417583">!=</span>&nbsp;<span class="ident" id="2417586">nil</span>&nbsp;<span class="op" id="2417590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417595"><a href="/io/pipe.go.html#2417267">err</a></span>&nbsp;<span class="op" id="2417599">=</span>&nbsp;<span class="ident" id="2417601"><a href="/io/pipe.go.html#2417234">p</a></span><span class="op" id="2417602">.</span><span class="ident" id="2417603">rerr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417611">break</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2417619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417623">if</span>&nbsp;<span class="ident" id="2417626"><a href="/io/pipe.go.html#2417234">p</a></span><span class="op" id="2417627">.</span><span class="ident" id="2417628">werr</span>&nbsp;<span class="op" id="2417633">!=</span>&nbsp;<span class="ident" id="2417636">nil</span>&nbsp;<span class="op" id="2417640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417645"><a href="/io/pipe.go.html#2417267">err</a></span>&nbsp;<span class="op" id="2417649">=</span>&nbsp;<span class="ident" id="2417651"><a href="/io/pipe.go.html#2416198">ErrClosedPipe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2417667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417671"><a href="/io/pipe.go.html#2417234">p</a></span><span class="op" id="2417672">.</span><span class="ident" id="2417673">wwait</span><span class="op" id="2417678">.</span><span class="ident" id="2417679">Wait</span><span class="op" id="2417683">(</span><span class="op" id="2417684">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2417687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417690"><a href="/io/pipe.go.html#2417260">n</a></span>&nbsp;<span class="op" id="2417692">=</span>&nbsp;<span class="builtinfunc" id="2417694">len</span><span class="op" id="2417697">(</span><span class="ident" id="2417698"><a href="/io/pipe.go.html#2417249">b</a></span><span class="op" id="2417699">)</span>&nbsp;<span class="op" id="2417701">-</span>&nbsp;<span class="builtinfunc" id="2417703">len</span><span class="op" id="2417706">(</span><span class="ident" id="2417707"><a href="/io/pipe.go.html#2417234">p</a></span><span class="op" id="2417708">.</span><span class="ident" id="2417709">data</span><span class="op" id="2417713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417716"><a href="/io/pipe.go.html#2417234">p</a></span><span class="op" id="2417717">.</span><span class="ident" id="2417718">data</span>&nbsp;<span class="op" id="2417723">=</span>&nbsp;<span class="ident" id="2417725">nil</span>&nbsp;<span class="comment" id="2417729">//&nbsp;in&nbsp;case&nbsp;of&nbsp;rerr&nbsp;or&nbsp;werr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417757">return</span><br>
<span class="lineno"></span><span class="op" id="2417764">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2417767">func</span>&nbsp;<span class="op" id="2417772">(</span><span class="ident" id="2417773">p</span>&nbsp;<span class="op" id="2417775">*</span><span class="ident" id="2417776"><a href="/io/pipe.go.html#2416389">pipe</a></span><span class="op" id="2417780">)</span>&nbsp;<span class="ident" id="2417782">rclose</span><span class="op" id="2417788">(</span><span class="ident" id="2417789">err</span>&nbsp;<span class="builtintype" id="2417793">error</span><span class="op" id="2417798">)</span>&nbsp;<span class="op" id="2417800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417803">if</span>&nbsp;<span class="ident" id="2417806"><a href="/io/pipe.go.html#2417789">err</a></span>&nbsp;<span class="op" id="2417810">==</span>&nbsp;<span class="ident" id="2417813">nil</span>&nbsp;<span class="op" id="2417817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417821"><a href="/io/pipe.go.html#2417789">err</a></span>&nbsp;<span class="op" id="2417825">=</span>&nbsp;<span class="ident" id="2417827"><a href="/io/pipe.go.html#2416198">ErrClosedPipe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2417842">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417845"><a href="/io/pipe.go.html#2417773">p</a></span><span class="op" id="2417846">.</span><span class="ident" id="2417847">l</span><span class="op" id="2417848">.</span><span class="ident" id="2417849">Lock</span><span class="op" id="2417853">(</span><span class="op" id="2417854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417857">defer</span>&nbsp;<span class="ident" id="2417863"><a href="/io/pipe.go.html#2417773">p</a></span><span class="op" id="2417864">.</span><span class="ident" id="2417865">l</span><span class="op" id="2417866">.</span><span class="ident" id="2417867">Unlock</span><span class="op" id="2417873">(</span><span class="op" id="2417874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417877"><a href="/io/pipe.go.html#2417773">p</a></span><span class="op" id="2417878">.</span><span class="ident" id="2417879">rerr</span>&nbsp;<span class="op" id="2417884">=</span>&nbsp;<span class="ident" id="2417886"><a href="/io/pipe.go.html#2417789">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417891"><a href="/io/pipe.go.html#2417773">p</a></span><span class="op" id="2417892">.</span><span class="ident" id="2417893">rwait</span><span class="op" id="2417898">.</span><span class="ident" id="2417899">Signal</span><span class="op" id="2417905">(</span><span class="op" id="2417906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417909"><a href="/io/pipe.go.html#2417773">p</a></span><span class="op" id="2417910">.</span><span class="ident" id="2417911">wwait</span><span class="op" id="2417916">.</span><span class="ident" id="2417917">Signal</span><span class="op" id="2417923">(</span><span class="op" id="2417924">)</span><br>
<span class="lineno">110</span><span class="op" id="2417926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2417929">func</span>&nbsp;<span class="op" id="2417934">(</span><span class="ident" id="2417935">p</span>&nbsp;<span class="op" id="2417937">*</span><span class="ident" id="2417938"><a href="/io/pipe.go.html#2416389">pipe</a></span><span class="op" id="2417942">)</span>&nbsp;<span class="ident" id="2417944">wclose</span><span class="op" id="2417950">(</span><span class="ident" id="2417951">err</span>&nbsp;<span class="builtintype" id="2417955">error</span><span class="op" id="2417960">)</span>&nbsp;<span class="op" id="2417962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2417965">if</span>&nbsp;<span class="ident" id="2417968"><a href="/io/pipe.go.html#2417951">err</a></span>&nbsp;<span class="op" id="2417972">==</span>&nbsp;<span class="ident" id="2417975">nil</span>&nbsp;<span class="op" id="2417979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417983"><a href="/io/pipe.go.html#2417951">err</a></span>&nbsp;<span class="op" id="2417987">=</span>&nbsp;<span class="ident" id="2417989"><a href="/io/io.go.html#2399859">EOF</a></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2417994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2417997"><a href="/io/pipe.go.html#2417935">p</a></span><span class="op" id="2417998">.</span><span class="ident" id="2417999">l</span><span class="op" id="2418000">.</span><span class="ident" id="2418001">Lock</span><span class="op" id="2418005">(</span><span class="op" id="2418006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2418009">defer</span>&nbsp;<span class="ident" id="2418015"><a href="/io/pipe.go.html#2417935">p</a></span><span class="op" id="2418016">.</span><span class="ident" id="2418017">l</span><span class="op" id="2418018">.</span><span class="ident" id="2418019">Unlock</span><span class="op" id="2418025">(</span><span class="op" id="2418026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2418029"><a href="/io/pipe.go.html#2417935">p</a></span><span class="op" id="2418030">.</span><span class="ident" id="2418031">werr</span>&nbsp;<span class="op" id="2418036">=</span>&nbsp;<span class="ident" id="2418038"><a href="/io/pipe.go.html#2417951">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2418043"><a href="/io/pipe.go.html#2417935">p</a></span><span class="op" id="2418044">.</span><span class="ident" id="2418045">rwait</span><span class="op" id="2418050">.</span><span class="ident" id="2418051">Signal</span><span class="op" id="2418057">(</span><span class="op" id="2418058">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2418061"><a href="/io/pipe.go.html#2417935">p</a></span><span class="op" id="2418062">.</span><span class="ident" id="2418063">wwait</span><span class="op" id="2418068">.</span><span class="ident" id="2418069">Signal</span><span class="op" id="2418075">(</span><span class="op" id="2418076">)</span><br>
<span class="lineno"></span><span class="op" id="2418078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2418081">//&nbsp;A&nbsp;PipeReader&nbsp;is&nbsp;the&nbsp;read&nbsp;half&nbsp;of&nbsp;a&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="2418125">type</span>&nbsp;<span class="ident" id="2418130">PipeReader</span>&nbsp;<span class="keyword" id="2418141">struct</span>&nbsp;<span class="op" id="2418148">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2418151">p</span>&nbsp;<span class="op" id="2418153">*</span><span class="ident" id="2418154"><a href="/io/pipe.go.html#2416389">pipe</a></span><br>
<span class="lineno"></span><span class="op" id="2418159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2418162">//&nbsp;Read&nbsp;implements&nbsp;the&nbsp;standard&nbsp;Read&nbsp;interface:</span><br>
<span class="lineno"></span><span class="comment" id="2418210">//&nbsp;it&nbsp;reads&nbsp;data&nbsp;from&nbsp;the&nbsp;pipe,&nbsp;blocking&nbsp;until&nbsp;a&nbsp;writer</span><br>
<span class="lineno">130</span><span class="comment" id="2418266">//&nbsp;arrives&nbsp;or&nbsp;the&nbsp;write&nbsp;end&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="2418305">//&nbsp;If&nbsp;the&nbsp;write&nbsp;end&nbsp;is&nbsp;closed&nbsp;with&nbsp;an&nbsp;error,&nbsp;that&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2418364">//&nbsp;returned&nbsp;as&nbsp;err;&nbsp;otherwise&nbsp;err&nbsp;is&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="2418406">func</span>&nbsp;<span class="op" id="2418411">(</span><span class="ident" id="2418412">r</span>&nbsp;<span class="op" id="2418414">*</span><span class="ident" id="2418415"><a href="/io/pipe.go.html#2418130">PipeReader</a></span><span class="op" id="2418425">)</span>&nbsp;<span class="ident" id="2418427">Read</span><span class="op" id="2418431">(</span><span class="ident" id="2418432">data</span>&nbsp;<span class="op" id="2418437">[</span><span class="op" id="2418438">]</span><span class="builtintype" id="2418439">byte</span><span class="op" id="2418443">)</span>&nbsp;<span class="op" id="2418445">(</span><span class="ident" id="2418446">n</span>&nbsp;<span class="builtintype" id="2418448">int</span><span class="op" id="2418451">,</span>&nbsp;<span class="ident" id="2418453">err</span>&nbsp;<span class="builtintype" id="2418457">error</span><span class="op" id="2418462">)</span>&nbsp;<span class="op" id="2418464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2418467">return</span>&nbsp;<span class="ident" id="2418474"><a href="/io/pipe.go.html#2418412">r</a></span><span class="op" id="2418475">.</span><span class="ident" id="2418476">p</span><span class="op" id="2418477">.</span><span class="ident" id="2418478">read</span><span class="op" id="2418482">(</span><span class="ident" id="2418483"><a href="/io/pipe.go.html#2418432">data</a></span><span class="op" id="2418487">)</span><br>
<span class="lineno">135</span><span class="op" id="2418489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2418492">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;reader;&nbsp;subsequent&nbsp;writes&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2418545">//&nbsp;write&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;the&nbsp;error&nbsp;ErrClosedPipe.</span><br>
<span class="lineno"></span><span class="keyword" id="2418608">func</span>&nbsp;<span class="op" id="2418613">(</span><span class="ident" id="2418614">r</span>&nbsp;<span class="op" id="2418616">*</span><span class="ident" id="2418617"><a href="/io/pipe.go.html#2418130">PipeReader</a></span><span class="op" id="2418627">)</span>&nbsp;<span class="ident" id="2418629">Close</span><span class="op" id="2418634">(</span><span class="op" id="2418635">)</span>&nbsp;<span class="builtintype" id="2418637">error</span>&nbsp;<span class="op" id="2418643">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2418646">return</span>&nbsp;<span class="ident" id="2418653"><a href="/io/pipe.go.html#2418614">r</a></span><span class="op" id="2418654">.</span><span class="ident" id="2418655">CloseWithError</span><span class="op" id="2418669">(</span><span class="ident" id="2418670">nil</span><span class="op" id="2418673">)</span><br>
<span class="lineno"></span><span class="op" id="2418675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2418678">//&nbsp;CloseWithError&nbsp;closes&nbsp;the&nbsp;reader;&nbsp;subsequent&nbsp;writes</span><br>
<span class="lineno"></span><span class="comment" id="2418733">//&nbsp;to&nbsp;the&nbsp;write&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;the&nbsp;error&nbsp;err.</span><br>
<span class="lineno">145</span><span class="keyword" id="2418793">func</span>&nbsp;<span class="op" id="2418798">(</span><span class="ident" id="2418799">r</span>&nbsp;<span class="op" id="2418801">*</span><span class="ident" id="2418802"><a href="/io/pipe.go.html#2418130">PipeReader</a></span><span class="op" id="2418812">)</span>&nbsp;<span class="ident" id="2418814">CloseWithError</span><span class="op" id="2418828">(</span><span class="ident" id="2418829">err</span>&nbsp;<span class="builtintype" id="2418833">error</span><span class="op" id="2418838">)</span>&nbsp;<span class="builtintype" id="2418840">error</span>&nbsp;<span class="op" id="2418846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2418849"><a href="/io/pipe.go.html#2418799">r</a></span><span class="op" id="2418850">.</span><span class="ident" id="2418851">p</span><span class="op" id="2418852">.</span><span class="ident" id="2418853">rclose</span><span class="op" id="2418859">(</span><span class="ident" id="2418860"><a href="/io/pipe.go.html#2418829">err</a></span><span class="op" id="2418863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2418866">return</span>&nbsp;<span class="ident" id="2418873">nil</span><br>
<span class="lineno"></span><span class="op" id="2418877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="2418880">//&nbsp;A&nbsp;PipeWriter&nbsp;is&nbsp;the&nbsp;write&nbsp;half&nbsp;of&nbsp;a&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="2418925">type</span>&nbsp;<span class="ident" id="2418930">PipeWriter</span>&nbsp;<span class="keyword" id="2418941">struct</span>&nbsp;<span class="op" id="2418948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2418951">p</span>&nbsp;<span class="op" id="2418953">*</span><span class="ident" id="2418954"><a href="/io/pipe.go.html#2416389">pipe</a></span><br>
<span class="lineno"></span><span class="op" id="2418959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="2418962">//&nbsp;Write&nbsp;implements&nbsp;the&nbsp;standard&nbsp;Write&nbsp;interface:</span><br>
<span class="lineno"></span><span class="comment" id="2419012">//&nbsp;it&nbsp;writes&nbsp;data&nbsp;to&nbsp;the&nbsp;pipe,&nbsp;blocking&nbsp;until&nbsp;readers</span><br>
<span class="lineno"></span><span class="comment" id="2419066">//&nbsp;have&nbsp;consumed&nbsp;all&nbsp;the&nbsp;data&nbsp;or&nbsp;the&nbsp;read&nbsp;end&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="2419123">//&nbsp;If&nbsp;the&nbsp;read&nbsp;end&nbsp;is&nbsp;closed&nbsp;with&nbsp;an&nbsp;error,&nbsp;that&nbsp;err&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2419179">//&nbsp;returned&nbsp;as&nbsp;err;&nbsp;otherwise&nbsp;err&nbsp;is&nbsp;ErrClosedPipe.</span><br>
<span class="lineno">160</span><span class="keyword" id="2419231">func</span>&nbsp;<span class="op" id="2419236">(</span><span class="ident" id="2419237">w</span>&nbsp;<span class="op" id="2419239">*</span><span class="ident" id="2419240"><a href="/io/pipe.go.html#2418930">PipeWriter</a></span><span class="op" id="2419250">)</span>&nbsp;<span class="ident" id="2419252">Write</span><span class="op" id="2419257">(</span><span class="ident" id="2419258">data</span>&nbsp;<span class="op" id="2419263">[</span><span class="op" id="2419264">]</span><span class="builtintype" id="2419265">byte</span><span class="op" id="2419269">)</span>&nbsp;<span class="op" id="2419271">(</span><span class="ident" id="2419272">n</span>&nbsp;<span class="builtintype" id="2419274">int</span><span class="op" id="2419277">,</span>&nbsp;<span class="ident" id="2419279">err</span>&nbsp;<span class="builtintype" id="2419283">error</span><span class="op" id="2419288">)</span>&nbsp;<span class="op" id="2419290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2419293">return</span>&nbsp;<span class="ident" id="2419300"><a href="/io/pipe.go.html#2419237">w</a></span><span class="op" id="2419301">.</span><span class="ident" id="2419302">p</span><span class="op" id="2419303">.</span><span class="ident" id="2419304">write</span><span class="op" id="2419309">(</span><span class="ident" id="2419310"><a href="/io/pipe.go.html#2419258">data</a></span><span class="op" id="2419314">)</span><br>
<span class="lineno"></span><span class="op" id="2419316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2419319">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;writer;&nbsp;subsequent&nbsp;reads&nbsp;from&nbsp;the</span><br>
<span class="lineno">165</span><span class="comment" id="2419373">//&nbsp;read&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;no&nbsp;bytes&nbsp;and&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="2419428">func</span>&nbsp;<span class="op" id="2419433">(</span><span class="ident" id="2419434">w</span>&nbsp;<span class="op" id="2419436">*</span><span class="ident" id="2419437"><a href="/io/pipe.go.html#2418930">PipeWriter</a></span><span class="op" id="2419447">)</span>&nbsp;<span class="ident" id="2419449">Close</span><span class="op" id="2419454">(</span><span class="op" id="2419455">)</span>&nbsp;<span class="builtintype" id="2419457">error</span>&nbsp;<span class="op" id="2419463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2419466">return</span>&nbsp;<span class="ident" id="2419473"><a href="/io/pipe.go.html#2419434">w</a></span><span class="op" id="2419474">.</span><span class="ident" id="2419475">CloseWithError</span><span class="op" id="2419489">(</span><span class="ident" id="2419490">nil</span><span class="op" id="2419493">)</span><br>
<span class="lineno"></span><span class="op" id="2419495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="2419498">//&nbsp;CloseWithError&nbsp;closes&nbsp;the&nbsp;writer;&nbsp;subsequent&nbsp;reads&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2419561">//&nbsp;read&nbsp;half&nbsp;of&nbsp;the&nbsp;pipe&nbsp;will&nbsp;return&nbsp;no&nbsp;bytes&nbsp;and&nbsp;the&nbsp;error&nbsp;err.</span><br>
<span class="lineno"></span><span class="keyword" id="2419626">func</span>&nbsp;<span class="op" id="2419631">(</span><span class="ident" id="2419632">w</span>&nbsp;<span class="op" id="2419634">*</span><span class="ident" id="2419635"><a href="/io/pipe.go.html#2418930">PipeWriter</a></span><span class="op" id="2419645">)</span>&nbsp;<span class="ident" id="2419647">CloseWithError</span><span class="op" id="2419661">(</span><span class="ident" id="2419662">err</span>&nbsp;<span class="builtintype" id="2419666">error</span><span class="op" id="2419671">)</span>&nbsp;<span class="builtintype" id="2419673">error</span>&nbsp;<span class="op" id="2419679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2419682"><a href="/io/pipe.go.html#2419632">w</a></span><span class="op" id="2419683">.</span><span class="ident" id="2419684">p</span><span class="op" id="2419685">.</span><span class="ident" id="2419686">wclose</span><span class="op" id="2419692">(</span><span class="ident" id="2419693"><a href="/io/pipe.go.html#2419662">err</a></span><span class="op" id="2419696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2419699">return</span>&nbsp;<span class="ident" id="2419706">nil</span><br>
<span class="lineno">175</span><span class="op" id="2419710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2419713">//&nbsp;Pipe&nbsp;creates&nbsp;a&nbsp;synchronous&nbsp;in-memory&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="comment" id="2419759">//&nbsp;It&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;connect&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Reader</span><br>
<span class="lineno"></span><span class="comment" id="2419816">//&nbsp;with&nbsp;code&nbsp;expecting&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno">180</span><span class="comment" id="2419853">//&nbsp;Reads&nbsp;on&nbsp;one&nbsp;end&nbsp;are&nbsp;matched&nbsp;with&nbsp;writes&nbsp;on&nbsp;the&nbsp;other,</span><br>
<span class="lineno"></span><span class="comment" id="2419911">//&nbsp;copying&nbsp;data&nbsp;directly&nbsp;between&nbsp;the&nbsp;two;&nbsp;there&nbsp;is&nbsp;no&nbsp;internal&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="comment" id="2419985">//&nbsp;It&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;Read&nbsp;and&nbsp;Write&nbsp;in&nbsp;parallel&nbsp;with&nbsp;each&nbsp;other&nbsp;or&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="2420058">//&nbsp;Close.&nbsp;Close&nbsp;will&nbsp;complete&nbsp;once&nbsp;pending&nbsp;I/O&nbsp;is&nbsp;done.&nbsp;Parallel&nbsp;calls&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2420132">//&nbsp;Read,&nbsp;and&nbsp;parallel&nbsp;calls&nbsp;to&nbsp;Write,&nbsp;are&nbsp;also&nbsp;safe:</span><br>
<span class="lineno">185</span><span class="comment" id="2420185">//&nbsp;the&nbsp;individual&nbsp;calls&nbsp;will&nbsp;be&nbsp;gated&nbsp;sequentially.</span><br>
<span class="lineno"></span><span class="keyword" id="2420237">func</span>&nbsp;<span class="ident" id="2420242">Pipe</span><span class="op" id="2420246">(</span><span class="op" id="2420247">)</span>&nbsp;<span class="op" id="2420249">(</span><span class="op" id="2420250">*</span><span class="ident" id="2420251"><a href="/io/pipe.go.html#2418130">PipeReader</a></span><span class="op" id="2420261">,</span>&nbsp;<span class="op" id="2420263">*</span><span class="ident" id="2420264"><a href="/io/pipe.go.html#2418930">PipeWriter</a></span><span class="op" id="2420274">)</span>&nbsp;<span class="op" id="2420276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420279">p</span>&nbsp;<span class="op" id="2420281">:=</span>&nbsp;<span class="builtinfunc" id="2420284">new</span><span class="op" id="2420287">(</span><span class="ident" id="2420288"><a href="/io/pipe.go.html#2416389">pipe</a></span><span class="op" id="2420292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420295"><a href="/io/pipe.go.html#2420279">p</a></span><span class="op" id="2420296">.</span><span class="ident" id="2420297">rwait</span><span class="op" id="2420302">.</span><span class="ident" id="2420303">L</span>&nbsp;<span class="op" id="2420305">=</span>&nbsp;<span class="op" id="2420307">&amp;</span><span class="ident" id="2420308"><a href="/io/pipe.go.html#2420279">p</a></span><span class="op" id="2420309">.</span><span class="ident" id="2420310">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420313"><a href="/io/pipe.go.html#2420279">p</a></span><span class="op" id="2420314">.</span><span class="ident" id="2420315">wwait</span><span class="op" id="2420320">.</span><span class="ident" id="2420321">L</span>&nbsp;<span class="op" id="2420323">=</span>&nbsp;<span class="op" id="2420325">&amp;</span><span class="ident" id="2420326"><a href="/io/pipe.go.html#2420279">p</a></span><span class="op" id="2420327">.</span><span class="ident" id="2420328">l</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420331">r</span>&nbsp;<span class="op" id="2420333">:=</span>&nbsp;<span class="op" id="2420336">&amp;</span><span class="ident" id="2420337"><a href="/io/pipe.go.html#2418130">PipeReader</a></span><span class="op" id="2420347">{</span><span class="ident" id="2420348"><a href="/io/pipe.go.html#2420279">p</a></span><span class="op" id="2420349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2420352">w</span>&nbsp;<span class="op" id="2420354">:=</span>&nbsp;<span class="op" id="2420357">&amp;</span><span class="ident" id="2420358"><a href="/io/pipe.go.html#2418930">PipeWriter</a></span><span class="op" id="2420368">{</span><span class="ident" id="2420369"><a href="/io/pipe.go.html#2420279">p</a></span><span class="op" id="2420370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2420373">return</span>&nbsp;<span class="ident" id="2420380"><a href="/io/pipe.go.html#2420331">r</a></span><span class="op" id="2420381">,</span>&nbsp;<span class="ident" id="2420383"><a href="/io/pipe.go.html#2420352">w</a></span><br>
<span class="lineno"></span><span class="op" id="2420385">}</span>
</div>
</body>
</html>
