<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html" class="current">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5178947">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5179002">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5179056">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5179107">package</span>&nbsp;<span class="ident" id="5179115">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5179125">import</span>&nbsp;<span class="op" id="5179132">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5179135">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5179144">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5179161">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5179168">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5179179">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5179190">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5179205">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5179208">//&nbsp;nextJSCtx&nbsp;returns&nbsp;the&nbsp;context&nbsp;that&nbsp;determines&nbsp;whether&nbsp;a&nbsp;slash&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5179283">//&nbsp;given&nbsp;run&nbsp;of&nbsp;tokens&nbsp;starts&nbsp;a&nbsp;regular&nbsp;expression&nbsp;instead&nbsp;of&nbsp;a&nbsp;division</span><br>
<span class="lineno"></span><span class="comment" id="5179356">//&nbsp;operator:&nbsp;/&nbsp;or&nbsp;/=.</span><br>
<span class="lineno"></span><span class="comment" id="5179378">//</span><br>
<span class="lineno">20</span><span class="comment" id="5179381">//&nbsp;This&nbsp;assumes&nbsp;that&nbsp;the&nbsp;token&nbsp;run&nbsp;does&nbsp;not&nbsp;include&nbsp;any&nbsp;string&nbsp;tokens,&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="5179460">//&nbsp;tokens,&nbsp;regular&nbsp;expression&nbsp;literal&nbsp;tokens,&nbsp;or&nbsp;division&nbsp;operators.</span><br>
<span class="lineno"></span><span class="comment" id="5179529">//</span><br>
<span class="lineno"></span><span class="comment" id="5179532">//&nbsp;This&nbsp;fails&nbsp;on&nbsp;some&nbsp;valid&nbsp;but&nbsp;nonsensical&nbsp;JavaScript&nbsp;programs&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="5179601">//&nbsp;&#34;x&nbsp;=&nbsp;++/foo/i&#34;&nbsp;which&nbsp;is&nbsp;quite&nbsp;different&nbsp;than&nbsp;&#34;x++/foo/i&#34;,&nbsp;but&nbsp;is&nbsp;not&nbsp;known&nbsp;to</span><br>
<span class="lineno">25</span><span class="comment" id="5179682">//&nbsp;fail&nbsp;on&nbsp;any&nbsp;known&nbsp;useful&nbsp;programs.&nbsp;It&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;draft</span><br>
<span class="lineno"></span><span class="comment" id="5179745">//&nbsp;JavaScript&nbsp;2.0&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;requires&nbsp;one&nbsp;token&nbsp;of&nbsp;lookbehind:</span><br>
<span class="lineno"></span><span class="comment" id="5179817">//&nbsp;http://www.mozilla.org/js/language/js20-2000-07/rationale/syntax.html</span><br>
<span class="lineno"></span><span class="keyword" id="5179890">func</span>&nbsp;<span class="ident" id="5179895">nextJSCtx</span><span class="op" id="5179904">(</span><span class="ident" id="5179905">s</span>&nbsp;<span class="op" id="5179907">[</span><span class="op" id="5179908">]</span><span class="builtintype" id="5179909">byte</span><span class="op" id="5179913">,</span>&nbsp;<span class="ident" id="5179915">preceding</span>&nbsp;<span class="ident" id="5179925">jsCtx</span><span class="op" id="5179930">)</span>&nbsp;<span class="ident" id="5179932">jsCtx</span>&nbsp;<span class="op" id="5179938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5179941">s</span>&nbsp;<span class="op" id="5179943">=</span>&nbsp;<span class="ident" id="5179945">bytes</span><span class="op" id="5179950">.</span><span class="ident" id="5179951">TrimRight</span><span class="op" id="5179960">(</span><span class="ident" id="5179961">s</span><span class="op" id="5179962">,</span>&nbsp;<span class="string" id="5179964">&#34;\t\n\f\r&nbsp;\u2028\u2029&#34;</span><span class="op" id="5179987">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5179990">if</span>&nbsp;<span class="builtinfunc" id="5179993">len</span><span class="op" id="5179996">(</span><span class="ident" id="5179997">s</span><span class="op" id="5179998">)</span>&nbsp;<span class="op" id="5180000">==</span>&nbsp;<span class="num" id="5180003">0</span>&nbsp;<span class="op" id="5180005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5180009">return</span>&nbsp;<span class="ident" id="5180016">preceding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5180027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5180031">//&nbsp;All&nbsp;cases&nbsp;below&nbsp;are&nbsp;in&nbsp;the&nbsp;single-byte&nbsp;UTF-8&nbsp;group.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5180087">switch</span>&nbsp;<span class="ident" id="5180094">c</span><span class="op" id="5180095">,</span>&nbsp;<span class="ident" id="5180097">n</span>&nbsp;<span class="op" id="5180099">:=</span>&nbsp;<span class="ident" id="5180102">s</span><span class="op" id="5180103">[</span><span class="builtinfunc" id="5180104">len</span><span class="op" id="5180107">(</span><span class="ident" id="5180108">s</span><span class="op" id="5180109">)</span><span class="op" id="5180110">-</span><span class="num" id="5180111">1</span><span class="op" id="5180112">]</span><span class="op" id="5180113">,</span>&nbsp;<span class="builtinfunc" id="5180115">len</span><span class="op" id="5180118">(</span><span class="ident" id="5180119">s</span><span class="op" id="5180120">)</span><span class="op" id="5180121">;</span>&nbsp;<span class="ident" id="5180123">c</span>&nbsp;<span class="op" id="5180125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5180128">case</span>&nbsp;<span class="string" id="5180133">&#39;+&#39;</span><span class="op" id="5180136">,</span>&nbsp;<span class="string" id="5180138">&#39;-&#39;</span><span class="op" id="5180141">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5180145">//&nbsp;++&nbsp;and&nbsp;--&nbsp;are&nbsp;not&nbsp;regexp&nbsp;preceders,&nbsp;but&nbsp;+&nbsp;and&nbsp;-&nbsp;are&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5180210">//&nbsp;they&nbsp;are&nbsp;used&nbsp;as&nbsp;infix&nbsp;or&nbsp;prefix&nbsp;operators.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5180259">start</span>&nbsp;<span class="op" id="5180265">:=</span>&nbsp;<span class="ident" id="5180268">n</span>&nbsp;<span class="op" id="5180270">-</span>&nbsp;<span class="num" id="5180272">1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5180276">//&nbsp;Count&nbsp;the&nbsp;number&nbsp;of&nbsp;adjacent&nbsp;dashes&nbsp;or&nbsp;pluses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5180328">for</span>&nbsp;<span class="ident" id="5180332">start</span>&nbsp;<span class="op" id="5180338">&gt;</span>&nbsp;<span class="num" id="5180340">0</span>&nbsp;<span class="op" id="5180342">&amp;&amp;</span>&nbsp;<span class="ident" id="5180345">s</span><span class="op" id="5180346">[</span><span class="ident" id="5180347">start</span><span class="op" id="5180352">-</span><span class="num" id="5180353">1</span><span class="op" id="5180354">]</span>&nbsp;<span class="op" id="5180356">==</span>&nbsp;<span class="ident" id="5180359">c</span>&nbsp;<span class="op" id="5180361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5180366">start</span><span class="op" id="5180371">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5180376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5180380">if</span>&nbsp;<span class="op" id="5180383">(</span><span class="ident" id="5180384">n</span><span class="op" id="5180385">-</span><span class="ident" id="5180386">start</span><span class="op" id="5180391">)</span><span class="op" id="5180392">&amp;</span><span class="num" id="5180393">1</span>&nbsp;<span class="op" id="5180395">==</span>&nbsp;<span class="num" id="5180398">1</span>&nbsp;<span class="op" id="5180400">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5180405">//&nbsp;Reached&nbsp;for&nbsp;trailing&nbsp;minus&nbsp;signs&nbsp;since&nbsp;&#34;---&#34;&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5180463">//&nbsp;same&nbsp;as&nbsp;&#34;--&nbsp;-&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5180485">return</span>&nbsp;<span class="ident" id="5180492">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5180506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5180510">return</span>&nbsp;<span class="ident" id="5180517">jsCtxDivOp</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5180529">case</span>&nbsp;<span class="string" id="5180534">&#39;.&#39;</span><span class="op" id="5180537">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5180541">//&nbsp;Handle&nbsp;&#34;42.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5180559">if</span>&nbsp;<span class="ident" id="5180562">n</span>&nbsp;<span class="op" id="5180564">!=</span>&nbsp;<span class="num" id="5180567">1</span>&nbsp;<span class="op" id="5180569">&amp;&amp;</span>&nbsp;<span class="string" id="5180572">&#39;0&#39;</span>&nbsp;<span class="op" id="5180576">&lt;=</span>&nbsp;<span class="ident" id="5180579">s</span><span class="op" id="5180580">[</span><span class="ident" id="5180581">n</span><span class="op" id="5180582">-</span><span class="num" id="5180583">2</span><span class="op" id="5180584">]</span>&nbsp;<span class="op" id="5180586">&amp;&amp;</span>&nbsp;<span class="ident" id="5180589">s</span><span class="op" id="5180590">[</span><span class="ident" id="5180591">n</span><span class="op" id="5180592">-</span><span class="num" id="5180593">2</span><span class="op" id="5180594">]</span>&nbsp;<span class="op" id="5180596">&lt;=</span>&nbsp;<span class="string" id="5180599">&#39;9&#39;</span>&nbsp;<span class="op" id="5180603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5180608">return</span>&nbsp;<span class="ident" id="5180615">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5180628">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5180632">return</span>&nbsp;<span class="ident" id="5180639">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5180652">//&nbsp;Suffixes&nbsp;for&nbsp;all&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5180723">//&nbsp;that&nbsp;only&nbsp;end&nbsp;binary&nbsp;operators&nbsp;not&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5180777">case</span>&nbsp;<span class="string" id="5180782">&#39;,&#39;</span><span class="op" id="5180785">,</span>&nbsp;<span class="string" id="5180787">&#39;&lt;&#39;</span><span class="op" id="5180790">,</span>&nbsp;<span class="string" id="5180792">&#39;&gt;&#39;</span><span class="op" id="5180795">,</span>&nbsp;<span class="string" id="5180797">&#39;=&#39;</span><span class="op" id="5180800">,</span>&nbsp;<span class="string" id="5180802">&#39;*&#39;</span><span class="op" id="5180805">,</span>&nbsp;<span class="string" id="5180807">&#39;%&#39;</span><span class="op" id="5180810">,</span>&nbsp;<span class="string" id="5180812">&#39;&amp;&#39;</span><span class="op" id="5180815">,</span>&nbsp;<span class="string" id="5180817">&#39;|&#39;</span><span class="op" id="5180820">,</span>&nbsp;<span class="string" id="5180822">&#39;^&#39;</span><span class="op" id="5180825">,</span>&nbsp;<span class="string" id="5180827">&#39;?&#39;</span><span class="op" id="5180830">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5180834">return</span>&nbsp;<span class="ident" id="5180841">jsCtxRegexp</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5180854">//&nbsp;Suffixes&nbsp;for&nbsp;all&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5180925">//&nbsp;that&nbsp;are&nbsp;prefix&nbsp;operators&nbsp;not&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5180974">case</span>&nbsp;<span class="string" id="5180979">&#39;!&#39;</span><span class="op" id="5180982">,</span>&nbsp;<span class="string" id="5180984">&#39;~&#39;</span><span class="op" id="5180987">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5180991">return</span>&nbsp;<span class="ident" id="5180998">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181011">//&nbsp;Matches&nbsp;all&nbsp;the&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181081">//&nbsp;that&nbsp;are&nbsp;open&nbsp;brackets&nbsp;not&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5181127">case</span>&nbsp;<span class="string" id="5181132">&#39;(&#39;</span><span class="op" id="5181135">,</span>&nbsp;<span class="string" id="5181137">&#39;[&#39;</span><span class="op" id="5181140">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5181144">return</span>&nbsp;<span class="ident" id="5181151">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181164">//&nbsp;Matches&nbsp;all&nbsp;the&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181234">//&nbsp;that&nbsp;precede&nbsp;expression&nbsp;starts.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5181270">case</span>&nbsp;<span class="string" id="5181275">&#39;:&#39;</span><span class="op" id="5181278">,</span>&nbsp;<span class="string" id="5181280">&#39;;&#39;</span><span class="op" id="5181283">,</span>&nbsp;<span class="string" id="5181285">&#39;{&#39;</span><span class="op" id="5181288">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5181292">return</span>&nbsp;<span class="ident" id="5181299">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181312">//&nbsp;CAVEAT:&nbsp;the&nbsp;close&nbsp;punctuators&nbsp;(&#39;}&#39;,&nbsp;&#39;]&#39;,&nbsp;&#39;)&#39;)&nbsp;precede&nbsp;div&nbsp;ops&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181382">//&nbsp;are&nbsp;handled&nbsp;in&nbsp;the&nbsp;default&nbsp;except&nbsp;for&nbsp;&#39;}&#39;&nbsp;which&nbsp;can&nbsp;precede&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181448">//&nbsp;division&nbsp;op&nbsp;as&nbsp;in</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181470">//&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;valueOf:&nbsp;function&nbsp;()&nbsp;{&nbsp;return&nbsp;42&nbsp;}&nbsp;}&nbsp;/&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181521">//&nbsp;which&nbsp;is&nbsp;valid,&nbsp;but,&nbsp;in&nbsp;practice,&nbsp;developers&nbsp;don&#39;t&nbsp;divide&nbsp;object</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181590">//&nbsp;literals,&nbsp;so&nbsp;our&nbsp;heuristic&nbsp;works&nbsp;well&nbsp;for&nbsp;code&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181646">//&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;()&nbsp;{&nbsp;...&nbsp;}&nbsp;&nbsp;/foo/.test(x)&nbsp;&amp;&amp;&nbsp;sideEffect();</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181705">//&nbsp;The&nbsp;&#39;)&#39;&nbsp;punctuator&nbsp;can&nbsp;precede&nbsp;a&nbsp;regular&nbsp;expression&nbsp;as&nbsp;in</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181767">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(b)&nbsp;/foo/.test(x)&nbsp;&amp;&amp;&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181803">//&nbsp;but&nbsp;this&nbsp;is&nbsp;much&nbsp;less&nbsp;likely&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181841">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(a&nbsp;+&nbsp;b)&nbsp;/&nbsp;c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5181861">case</span>&nbsp;<span class="string" id="5181866">&#39;}&#39;</span><span class="op" id="5181869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5181873">return</span>&nbsp;<span class="ident" id="5181880">jsCtxRegexp</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5181893">default</span><span class="op" id="5181900">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181904">//&nbsp;Look&nbsp;for&nbsp;an&nbsp;IdentifierName&nbsp;and&nbsp;see&nbsp;if&nbsp;it&nbsp;is&nbsp;a&nbsp;keyword&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5181968">//&nbsp;can&nbsp;precede&nbsp;a&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5182007">j</span>&nbsp;<span class="op" id="5182009">:=</span>&nbsp;<span class="ident" id="5182012">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5182016">for</span>&nbsp;<span class="ident" id="5182020">j</span>&nbsp;<span class="op" id="5182022">&gt;</span>&nbsp;<span class="num" id="5182024">0</span>&nbsp;<span class="op" id="5182026">&amp;&amp;</span>&nbsp;<span class="ident" id="5182029">isJSIdentPart</span><span class="op" id="5182042">(</span><span class="builtintype" id="5182043">rune</span><span class="op" id="5182047">(</span><span class="ident" id="5182048">s</span><span class="op" id="5182049">[</span><span class="ident" id="5182050">j</span><span class="op" id="5182051">-</span><span class="num" id="5182052">1</span><span class="op" id="5182053">]</span><span class="op" id="5182054">)</span><span class="op" id="5182055">)</span>&nbsp;<span class="op" id="5182057">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5182062">j</span><span class="op" id="5182063">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5182068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5182072">if</span>&nbsp;<span class="ident" id="5182075">regexpPrecederKeywords</span><span class="op" id="5182097">[</span><span class="builtintype" id="5182098">string</span><span class="op" id="5182104">(</span><span class="ident" id="5182105">s</span><span class="op" id="5182106">[</span><span class="ident" id="5182107">j</span><span class="op" id="5182108">:</span><span class="op" id="5182109">]</span><span class="op" id="5182110">)</span><span class="op" id="5182111">]</span>&nbsp;<span class="op" id="5182113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5182118">return</span>&nbsp;<span class="ident" id="5182125">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5182139">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5182142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5182145">//&nbsp;Otherwise&nbsp;is&nbsp;a&nbsp;punctuator&nbsp;not&nbsp;listed&nbsp;above,&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5182196">//&nbsp;a&nbsp;string&nbsp;which&nbsp;precedes&nbsp;a&nbsp;div&nbsp;op,&nbsp;or&nbsp;an&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5182251">//&nbsp;which&nbsp;precedes&nbsp;a&nbsp;div&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5182280">return</span>&nbsp;<span class="ident" id="5182287">jsCtxDivOp</span><br>
<span class="lineno">100</span><span class="op" id="5182298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5182301">//&nbsp;regexpPrecederKeywords&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;reserved&nbsp;JS&nbsp;keywords&nbsp;that&nbsp;can&nbsp;precede&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5182379">//&nbsp;regular&nbsp;expression&nbsp;in&nbsp;JS&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="5182415">var</span>&nbsp;<span class="ident" id="5182419">regexpPrecederKeywords</span>&nbsp;<span class="op" id="5182442">=</span>&nbsp;<span class="keyword" id="5182444">map</span><span class="op" id="5182447">[</span><span class="builtintype" id="5182448">string</span><span class="op" id="5182454">]</span><span class="builtintype" id="5182455">bool</span><span class="op" id="5182459">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5182462">&#34;break&#34;</span><span class="op" id="5182469">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5182476">true</span><span class="op" id="5182480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5182483">&#34;case&#34;</span><span class="op" id="5182489">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5182497">true</span><span class="op" id="5182501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5182504">&#34;continue&#34;</span><span class="op" id="5182514">:</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5182518">true</span><span class="op" id="5182522">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5182525">&#34;delete&#34;</span><span class="op" id="5182533">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5182539">true</span><span class="op" id="5182543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5182546">&#34;do&#34;</span><span class="op" id="5182550">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5182560">true</span><span class="op" id="5182564">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5182567">&#34;else&#34;</span><span class="op" id="5182573">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5182581">true</span><span class="op" id="5182585">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5182588">&#34;finally&#34;</span><span class="op" id="5182597">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5182602">true</span><span class="op" id="5182606">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5182609">&#34;in&#34;</span><span class="op" id="5182613">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5182623">true</span><span class="op" id="5182627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5182630">&#34;instanceof&#34;</span><span class="op" id="5182642">:</span>&nbsp;<span class="builtintype" id="5182644">true</span><span class="op" id="5182648">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5182651">&#34;return&#34;</span><span class="op" id="5182659">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5182665">true</span><span class="op" id="5182669">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5182672">&#34;throw&#34;</span><span class="op" id="5182679">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5182686">true</span><span class="op" id="5182690">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5182693">&#34;try&#34;</span><span class="op" id="5182698">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5182707">true</span><span class="op" id="5182711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5182714">&#34;typeof&#34;</span><span class="op" id="5182722">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5182728">true</span><span class="op" id="5182732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5182735">&#34;void&#34;</span><span class="op" id="5182741">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5182749">true</span><span class="op" id="5182753">,</span><br>
<span class="lineno"></span><span class="op" id="5182755">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="5182758">var</span>&nbsp;<span class="ident" id="5182762">jsonMarshalType</span>&nbsp;<span class="op" id="5182778">=</span>&nbsp;<span class="ident" id="5182780">reflect</span><span class="op" id="5182787">.</span><span class="ident" id="5182788">TypeOf</span><span class="op" id="5182794">(</span><span class="op" id="5182795">(</span><span class="op" id="5182796">*</span><span class="ident" id="5182797">json</span><span class="op" id="5182801">.</span><span class="ident" id="5182802">Marshaler</span><span class="op" id="5182811">)</span><span class="op" id="5182812">(</span><span class="builtintype" id="5182813">nil</span><span class="op" id="5182816">)</span><span class="op" id="5182817">)</span><span class="op" id="5182818">.</span><span class="ident" id="5182819">Elem</span><span class="op" id="5182823">(</span><span class="op" id="5182824">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5182827">//&nbsp;indirectToJSONMarshaler&nbsp;returns&nbsp;the&nbsp;value,&nbsp;after&nbsp;dereferencing&nbsp;as&nbsp;many&nbsp;times</span><br>
<span class="lineno"></span><span class="comment" id="5182907">//&nbsp;as&nbsp;necessary&nbsp;to&nbsp;reach&nbsp;the&nbsp;base&nbsp;type&nbsp;(or&nbsp;nil)&nbsp;or&nbsp;an&nbsp;implementation&nbsp;of&nbsp;json.Marshal.</span><br>
<span class="lineno">125</span><span class="keyword" id="5182993">func</span>&nbsp;<span class="ident" id="5182998">indirectToJSONMarshaler</span><span class="op" id="5183021">(</span><span class="ident" id="5183022">a</span>&nbsp;<span class="keyword" id="5183024">interface</span><span class="op" id="5183033">{</span><span class="op" id="5183034">}</span><span class="op" id="5183035">)</span>&nbsp;<span class="keyword" id="5183037">interface</span><span class="op" id="5183046">{</span><span class="op" id="5183047">}</span>&nbsp;<span class="op" id="5183049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5183052">v</span>&nbsp;<span class="op" id="5183054">:=</span>&nbsp;<span class="ident" id="5183057">reflect</span><span class="op" id="5183064">.</span><span class="ident" id="5183065">ValueOf</span><span class="op" id="5183072">(</span><span class="ident" id="5183073">a</span><span class="op" id="5183074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5183077">for</span>&nbsp;<span class="op" id="5183081">!</span><span class="ident" id="5183082">v</span><span class="op" id="5183083">.</span><span class="ident" id="5183084">Type</span><span class="op" id="5183088">(</span><span class="op" id="5183089">)</span><span class="op" id="5183090">.</span><span class="ident" id="5183091">Implements</span><span class="op" id="5183101">(</span><span class="ident" id="5183102">jsonMarshalType</span><span class="op" id="5183117">)</span>&nbsp;<span class="op" id="5183119">&amp;&amp;</span>&nbsp;<span class="ident" id="5183122">v</span><span class="op" id="5183123">.</span><span class="ident" id="5183124">Kind</span><span class="op" id="5183128">(</span><span class="op" id="5183129">)</span>&nbsp;<span class="op" id="5183131">==</span>&nbsp;<span class="ident" id="5183134">reflect</span><span class="op" id="5183141">.</span><span class="ident" id="5183142">Ptr</span>&nbsp;<span class="op" id="5183146">&amp;&amp;</span>&nbsp;<span class="op" id="5183149">!</span><span class="ident" id="5183150">v</span><span class="op" id="5183151">.</span><span class="ident" id="5183152">IsNil</span><span class="op" id="5183157">(</span><span class="op" id="5183158">)</span>&nbsp;<span class="op" id="5183160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5183164">v</span>&nbsp;<span class="op" id="5183166">=</span>&nbsp;<span class="ident" id="5183168">v</span><span class="op" id="5183169">.</span><span class="ident" id="5183170">Elem</span><span class="op" id="5183174">(</span><span class="op" id="5183175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5183178">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5183181">return</span>&nbsp;<span class="ident" id="5183188">v</span><span class="op" id="5183189">.</span><span class="ident" id="5183190">Interface</span><span class="op" id="5183199">(</span><span class="op" id="5183200">)</span><br>
<span class="lineno"></span><span class="op" id="5183202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5183205">//&nbsp;jsValEscaper&nbsp;escapes&nbsp;its&nbsp;inputs&nbsp;to&nbsp;a&nbsp;JS&nbsp;Expression&nbsp;(section&nbsp;11.14)&nbsp;that&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="5183284">//&nbsp;neither&nbsp;side-effects&nbsp;nor&nbsp;free&nbsp;variables&nbsp;outside&nbsp;(NaN,&nbsp;Infinity).</span><br>
<span class="lineno">135</span><span class="keyword" id="5183352">func</span>&nbsp;<span class="ident" id="5183357">jsValEscaper</span><span class="op" id="5183369">(</span><span class="ident" id="5183370">args</span>&nbsp;<span class="op" id="5183375">...</span><span class="keyword" id="5183378">interface</span><span class="op" id="5183387">{</span><span class="op" id="5183388">}</span><span class="op" id="5183389">)</span>&nbsp;<span class="builtintype" id="5183391">string</span>&nbsp;<span class="op" id="5183398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5183401">var</span>&nbsp;<span class="ident" id="5183405">a</span>&nbsp;<span class="keyword" id="5183407">interface</span><span class="op" id="5183416">{</span><span class="op" id="5183417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5183420">if</span>&nbsp;<span class="builtinfunc" id="5183423">len</span><span class="op" id="5183426">(</span><span class="ident" id="5183427">args</span><span class="op" id="5183431">)</span>&nbsp;<span class="op" id="5183433">==</span>&nbsp;<span class="num" id="5183436">1</span>&nbsp;<span class="op" id="5183438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5183442">a</span>&nbsp;<span class="op" id="5183444">=</span>&nbsp;<span class="ident" id="5183446">indirectToJSONMarshaler</span><span class="op" id="5183469">(</span><span class="ident" id="5183470">args</span><span class="op" id="5183474">[</span><span class="num" id="5183475">0</span><span class="op" id="5183476">]</span><span class="op" id="5183477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5183481">switch</span>&nbsp;<span class="ident" id="5183488">t</span>&nbsp;<span class="op" id="5183490">:=</span>&nbsp;<span class="ident" id="5183493">a</span><span class="op" id="5183494">.</span><span class="op" id="5183495">(</span><span class="keyword" id="5183496">type</span><span class="op" id="5183500">)</span>&nbsp;<span class="op" id="5183502">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5183506">case</span>&nbsp;<span class="ident" id="5183511">JS</span><span class="op" id="5183513">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5183518">return</span>&nbsp;<span class="builtintype" id="5183525">string</span><span class="op" id="5183531">(</span><span class="ident" id="5183532">t</span><span class="op" id="5183533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5183537">case</span>&nbsp;<span class="ident" id="5183542">JSStr</span><span class="op" id="5183547">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5183552">//&nbsp;TODO:&nbsp;normalize&nbsp;quotes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5183582">return</span>&nbsp;<span class="string" id="5183589">`&#34;`</span>&nbsp;<span class="op" id="5183593">+</span>&nbsp;<span class="builtintype" id="5183595">string</span><span class="op" id="5183601">(</span><span class="ident" id="5183602">t</span><span class="op" id="5183603">)</span>&nbsp;<span class="op" id="5183605">+</span>&nbsp;<span class="string" id="5183607">`&#34;`</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5183613">case</span>&nbsp;<span class="ident" id="5183618">json</span><span class="op" id="5183622">.</span><span class="ident" id="5183623">Marshaler</span><span class="op" id="5183632">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5183637">//&nbsp;Do&nbsp;not&nbsp;treat&nbsp;as&nbsp;a&nbsp;Stringer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5183670">case</span>&nbsp;<span class="ident" id="5183675">fmt</span><span class="op" id="5183678">.</span><span class="ident" id="5183679">Stringer</span><span class="op" id="5183687">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5183692">a</span>&nbsp;<span class="op" id="5183694">=</span>&nbsp;<span class="ident" id="5183696">t</span><span class="op" id="5183697">.</span><span class="ident" id="5183698">String</span><span class="op" id="5183704">(</span><span class="op" id="5183705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5183709">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5183712">}</span>&nbsp;<span class="keyword" id="5183714">else</span>&nbsp;<span class="op" id="5183719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5183723">for</span>&nbsp;<span class="ident" id="5183727">i</span><span class="op" id="5183728">,</span>&nbsp;<span class="ident" id="5183730">arg</span>&nbsp;<span class="op" id="5183734">:=</span>&nbsp;<span class="keyword" id="5183737">range</span>&nbsp;<span class="ident" id="5183743">args</span>&nbsp;<span class="op" id="5183748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5183753">args</span><span class="op" id="5183757">[</span><span class="ident" id="5183758">i</span><span class="op" id="5183759">]</span>&nbsp;<span class="op" id="5183761">=</span>&nbsp;<span class="ident" id="5183763">indirectToJSONMarshaler</span><span class="op" id="5183786">(</span><span class="ident" id="5183787">arg</span><span class="op" id="5183790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5183794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5183798">a</span>&nbsp;<span class="op" id="5183800">=</span>&nbsp;<span class="ident" id="5183802">fmt</span><span class="op" id="5183805">.</span><span class="ident" id="5183806">Sprint</span><span class="op" id="5183812">(</span><span class="ident" id="5183813">args</span><span class="op" id="5183817">...</span><span class="op" id="5183820">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5183823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5183826">//&nbsp;TODO:&nbsp;detect&nbsp;cycles&nbsp;before&nbsp;calling&nbsp;Marshal&nbsp;which&nbsp;loops&nbsp;infinitely&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5183899">//&nbsp;cyclic&nbsp;data.&nbsp;This&nbsp;may&nbsp;be&nbsp;an&nbsp;unacceptable&nbsp;DoS&nbsp;risk.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5183955">b</span><span class="op" id="5183956">,</span>&nbsp;<span class="ident" id="5183958">err</span>&nbsp;<span class="op" id="5183962">:=</span>&nbsp;<span class="ident" id="5183965">json</span><span class="op" id="5183969">.</span><span class="ident" id="5183970">Marshal</span><span class="op" id="5183977">(</span><span class="ident" id="5183978">a</span><span class="op" id="5183979">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5183982">if</span>&nbsp;<span class="ident" id="5183985">err</span>&nbsp;<span class="op" id="5183989">!=</span>&nbsp;<span class="builtintype" id="5183992">nil</span>&nbsp;<span class="op" id="5183996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5184000">//&nbsp;Put&nbsp;a&nbsp;space&nbsp;before&nbsp;comment&nbsp;so&nbsp;that&nbsp;if&nbsp;it&nbsp;is&nbsp;flush&nbsp;against</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5184063">//&nbsp;a&nbsp;division&nbsp;operator&nbsp;it&nbsp;is&nbsp;not&nbsp;turned&nbsp;into&nbsp;a&nbsp;line&nbsp;comment:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5184126">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x/{{y}}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5184143">//&nbsp;turning&nbsp;into</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5184161">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x//*&nbsp;error&nbsp;marshalling&nbsp;y:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5184196">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;second&nbsp;line&nbsp;of&nbsp;error&nbsp;message&nbsp;*/null</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5184246">return</span>&nbsp;<span class="ident" id="5184253">fmt</span><span class="op" id="5184256">.</span><span class="ident" id="5184257">Sprintf</span><span class="op" id="5184264">(</span><span class="string" id="5184265">&#34;&nbsp;/*&nbsp;%s&nbsp;*/null&nbsp;&#34;</span><span class="op" id="5184281">,</span>&nbsp;<span class="ident" id="5184283">strings</span><span class="op" id="5184290">.</span><span class="ident" id="5184291">Replace</span><span class="op" id="5184298">(</span><span class="ident" id="5184299">err</span><span class="op" id="5184302">.</span><span class="ident" id="5184303">Error</span><span class="op" id="5184308">(</span><span class="op" id="5184309">)</span><span class="op" id="5184310">,</span>&nbsp;<span class="string" id="5184312">&#34;*/&#34;</span><span class="op" id="5184316">,</span>&nbsp;<span class="string" id="5184318">&#34;*&nbsp;/&#34;</span><span class="op" id="5184323">,</span>&nbsp;<span class="op" id="5184325">-</span><span class="num" id="5184326">1</span><span class="op" id="5184327">)</span><span class="op" id="5184328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5184331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5184335">//&nbsp;TODO:&nbsp;maybe&nbsp;post-process&nbsp;output&nbsp;to&nbsp;prevent&nbsp;it&nbsp;from&nbsp;containing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5184401">//&nbsp;&#34;&lt;!--&#34;,&nbsp;&#34;--&gt;&#34;,&nbsp;&#34;&lt;![CDATA[&#34;,&nbsp;&#34;]]&gt;&#34;,&nbsp;or&nbsp;&#34;&lt;/script&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5184454">//&nbsp;in&nbsp;case&nbsp;custom&nbsp;marshallers&nbsp;produce&nbsp;output&nbsp;containing&nbsp;those.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5184519">//&nbsp;TODO:&nbsp;Maybe&nbsp;abbreviate&nbsp;\u00ab&nbsp;to&nbsp;\xab&nbsp;to&nbsp;produce&nbsp;more&nbsp;compact&nbsp;output.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5184593">if</span>&nbsp;<span class="builtinfunc" id="5184596">len</span><span class="op" id="5184599">(</span><span class="ident" id="5184600">b</span><span class="op" id="5184601">)</span>&nbsp;<span class="op" id="5184603">==</span>&nbsp;<span class="num" id="5184606">0</span>&nbsp;<span class="op" id="5184608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5184612">//&nbsp;In,&nbsp;`x=y/{{.}}*z`&nbsp;a&nbsp;json.Marshaler&nbsp;that&nbsp;produces&nbsp;&#34;&#34;&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5184676">//&nbsp;not&nbsp;cause&nbsp;the&nbsp;output&nbsp;`x=y/*z`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5184712">return</span>&nbsp;<span class="string" id="5184719">&#34;&nbsp;null&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5184729">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5184732">first</span><span class="op" id="5184737">,</span>&nbsp;<span class="ident" id="5184739">_</span>&nbsp;<span class="op" id="5184741">:=</span>&nbsp;<span class="ident" id="5184744">utf8</span><span class="op" id="5184748">.</span><span class="ident" id="5184749">DecodeRune</span><span class="op" id="5184759">(</span><span class="ident" id="5184760">b</span><span class="op" id="5184761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5184764">last</span><span class="op" id="5184768">,</span>&nbsp;<span class="ident" id="5184770">_</span>&nbsp;<span class="op" id="5184772">:=</span>&nbsp;<span class="ident" id="5184775">utf8</span><span class="op" id="5184779">.</span><span class="ident" id="5184780">DecodeLastRune</span><span class="op" id="5184794">(</span><span class="ident" id="5184795">b</span><span class="op" id="5184796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5184799">var</span>&nbsp;<span class="ident" id="5184803">buf</span>&nbsp;<span class="ident" id="5184807">bytes</span><span class="op" id="5184812">.</span><span class="ident" id="5184813">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5184821">//&nbsp;Prevent&nbsp;IdentifierNames&nbsp;and&nbsp;NumericLiterals&nbsp;from&nbsp;running&nbsp;into</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5184887">//&nbsp;keywords:&nbsp;in,&nbsp;instanceof,&nbsp;typeof,&nbsp;void</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5184930">pad</span>&nbsp;<span class="op" id="5184934">:=</span>&nbsp;<span class="ident" id="5184937">isJSIdentPart</span><span class="op" id="5184950">(</span><span class="ident" id="5184951">first</span><span class="op" id="5184956">)</span>&nbsp;<span class="op" id="5184958">||</span>&nbsp;<span class="ident" id="5184961">isJSIdentPart</span><span class="op" id="5184974">(</span><span class="ident" id="5184975">last</span><span class="op" id="5184979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5184982">if</span>&nbsp;<span class="ident" id="5184985">pad</span>&nbsp;<span class="op" id="5184989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5184993">buf</span><span class="op" id="5184996">.</span><span class="ident" id="5184997">WriteByte</span><span class="op" id="5185006">(</span><span class="string" id="5185007">&#39;&nbsp;&#39;</span><span class="op" id="5185010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5185013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5185016">written</span>&nbsp;<span class="op" id="5185024">:=</span>&nbsp;<span class="num" id="5185027">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5185030">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;json.Marshal&nbsp;escapes&nbsp;codepoints&nbsp;U+2028&nbsp;&amp;&nbsp;U+2029</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5185097">//&nbsp;so&nbsp;it&nbsp;falls&nbsp;within&nbsp;the&nbsp;subset&nbsp;of&nbsp;JSON&nbsp;which&nbsp;is&nbsp;valid&nbsp;JS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5185158">for</span>&nbsp;<span class="ident" id="5185162">i</span>&nbsp;<span class="op" id="5185164">:=</span>&nbsp;<span class="num" id="5185167">0</span><span class="op" id="5185168">;</span>&nbsp;<span class="ident" id="5185170">i</span>&nbsp;<span class="op" id="5185172">&lt;</span>&nbsp;<span class="builtinfunc" id="5185174">len</span><span class="op" id="5185177">(</span><span class="ident" id="5185178">b</span><span class="op" id="5185179">)</span><span class="op" id="5185180">;</span>&nbsp;<span class="op" id="5185182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5185186">rune</span><span class="op" id="5185190">,</span>&nbsp;<span class="ident" id="5185192">n</span>&nbsp;<span class="op" id="5185194">:=</span>&nbsp;<span class="ident" id="5185197">utf8</span><span class="op" id="5185201">.</span><span class="ident" id="5185202">DecodeRune</span><span class="op" id="5185212">(</span><span class="ident" id="5185213">b</span><span class="op" id="5185214">[</span><span class="ident" id="5185215">i</span><span class="op" id="5185216">:</span><span class="op" id="5185217">]</span><span class="op" id="5185218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5185222">repl</span>&nbsp;<span class="op" id="5185227">:=</span>&nbsp;<span class="string" id="5185230">&#34;&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5185235">if</span>&nbsp;<span class="builtintype" id="5185238">rune</span>&nbsp;<span class="op" id="5185243">==</span>&nbsp;<span class="num" id="5185246">0x2028</span>&nbsp;<span class="op" id="5185253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5185258">repl</span>&nbsp;<span class="op" id="5185263">=</span>&nbsp;<span class="string" id="5185265">`\u2028`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5185276">}</span>&nbsp;<span class="keyword" id="5185278">else</span>&nbsp;<span class="keyword" id="5185283">if</span>&nbsp;<span class="builtintype" id="5185286">rune</span>&nbsp;<span class="op" id="5185291">==</span>&nbsp;<span class="num" id="5185294">0x2029</span>&nbsp;<span class="op" id="5185301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5185306">repl</span>&nbsp;<span class="op" id="5185311">=</span>&nbsp;<span class="string" id="5185313">`\u2029`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5185324">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5185328">if</span>&nbsp;<span class="ident" id="5185331">repl</span>&nbsp;<span class="op" id="5185336">!=</span>&nbsp;<span class="string" id="5185339">&#34;&#34;</span>&nbsp;<span class="op" id="5185342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5185347">buf</span><span class="op" id="5185350">.</span><span class="ident" id="5185351">Write</span><span class="op" id="5185356">(</span><span class="ident" id="5185357">b</span><span class="op" id="5185358">[</span><span class="ident" id="5185359">written</span><span class="op" id="5185366">:</span><span class="ident" id="5185367">i</span><span class="op" id="5185368">]</span><span class="op" id="5185369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5185374">buf</span><span class="op" id="5185377">.</span><span class="ident" id="5185378">WriteString</span><span class="op" id="5185389">(</span><span class="ident" id="5185390">repl</span><span class="op" id="5185394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5185399">written</span>&nbsp;<span class="op" id="5185407">=</span>&nbsp;<span class="ident" id="5185409">i</span>&nbsp;<span class="op" id="5185411">+</span>&nbsp;<span class="ident" id="5185413">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5185417">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5185421">i</span>&nbsp;<span class="op" id="5185423">+=</span>&nbsp;<span class="ident" id="5185426">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5185429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5185432">if</span>&nbsp;<span class="ident" id="5185435">buf</span><span class="op" id="5185438">.</span><span class="ident" id="5185439">Len</span><span class="op" id="5185442">(</span><span class="op" id="5185443">)</span>&nbsp;<span class="op" id="5185445">!=</span>&nbsp;<span class="num" id="5185448">0</span>&nbsp;<span class="op" id="5185450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5185454">buf</span><span class="op" id="5185457">.</span><span class="ident" id="5185458">Write</span><span class="op" id="5185463">(</span><span class="ident" id="5185464">b</span><span class="op" id="5185465">[</span><span class="ident" id="5185466">written</span><span class="op" id="5185473">:</span><span class="op" id="5185474">]</span><span class="op" id="5185475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5185479">if</span>&nbsp;<span class="ident" id="5185482">pad</span>&nbsp;<span class="op" id="5185486">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5185491">buf</span><span class="op" id="5185494">.</span><span class="ident" id="5185495">WriteByte</span><span class="op" id="5185504">(</span><span class="string" id="5185505">&#39;&nbsp;&#39;</span><span class="op" id="5185508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5185512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5185516">b</span>&nbsp;<span class="op" id="5185518">=</span>&nbsp;<span class="ident" id="5185520">buf</span><span class="op" id="5185523">.</span><span class="ident" id="5185524">Bytes</span><span class="op" id="5185529">(</span><span class="op" id="5185530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5185533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5185536">return</span>&nbsp;<span class="builtintype" id="5185543">string</span><span class="op" id="5185549">(</span><span class="ident" id="5185550">b</span><span class="op" id="5185551">)</span><br>
<span class="lineno">215</span><span class="op" id="5185553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5185556">//&nbsp;jsStrEscaper&nbsp;produces&nbsp;a&nbsp;string&nbsp;that&nbsp;can&nbsp;be&nbsp;included&nbsp;between&nbsp;quotes&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5185629">//&nbsp;JavaScript&nbsp;source,&nbsp;in&nbsp;JavaScript&nbsp;embedded&nbsp;in&nbsp;an&nbsp;HTML5&nbsp;&lt;script&gt;&nbsp;element,</span><br>
<span class="lineno"></span><span class="comment" id="5185704">//&nbsp;or&nbsp;in&nbsp;an&nbsp;HTML5&nbsp;event&nbsp;handler&nbsp;attribute&nbsp;such&nbsp;as&nbsp;onclick.</span><br>
<span class="lineno">220</span><span class="keyword" id="5185763">func</span>&nbsp;<span class="ident" id="5185768">jsStrEscaper</span><span class="op" id="5185780">(</span><span class="ident" id="5185781">args</span>&nbsp;<span class="op" id="5185786">...</span><span class="keyword" id="5185789">interface</span><span class="op" id="5185798">{</span><span class="op" id="5185799">}</span><span class="op" id="5185800">)</span>&nbsp;<span class="builtintype" id="5185802">string</span>&nbsp;<span class="op" id="5185809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5185812">s</span><span class="op" id="5185813">,</span>&nbsp;<span class="ident" id="5185815">t</span>&nbsp;<span class="op" id="5185817">:=</span>&nbsp;<span class="ident" id="5185820">stringify</span><span class="op" id="5185829">(</span><span class="ident" id="5185830">args</span><span class="op" id="5185834">...</span><span class="op" id="5185837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5185840">if</span>&nbsp;<span class="ident" id="5185843">t</span>&nbsp;<span class="op" id="5185845">==</span>&nbsp;<span class="ident" id="5185848">contentTypeJSStr</span>&nbsp;<span class="op" id="5185865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5185869">return</span>&nbsp;<span class="ident" id="5185876">replace</span><span class="op" id="5185883">(</span><span class="ident" id="5185884">s</span><span class="op" id="5185885">,</span>&nbsp;<span class="ident" id="5185887">jsStrNormReplacementTable</span><span class="op" id="5185912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5185915">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5185918">return</span>&nbsp;<span class="ident" id="5185925">replace</span><span class="op" id="5185932">(</span><span class="ident" id="5185933">s</span><span class="op" id="5185934">,</span>&nbsp;<span class="ident" id="5185936">jsStrReplacementTable</span><span class="op" id="5185957">)</span><br>
<span class="lineno"></span><span class="op" id="5185959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5185962">//&nbsp;jsRegexpEscaper&nbsp;behaves&nbsp;like&nbsp;jsStrEscaper&nbsp;but&nbsp;escapes&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="5186038">//&nbsp;specials&nbsp;so&nbsp;the&nbsp;result&nbsp;is&nbsp;treated&nbsp;literally&nbsp;when&nbsp;included&nbsp;in&nbsp;a&nbsp;regular</span><br>
<span class="lineno">230</span><span class="comment" id="5186112">//&nbsp;expression&nbsp;literal.&nbsp;/foo{{.X}}bar/&nbsp;matches&nbsp;the&nbsp;string&nbsp;&#34;foo&#34;&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5186187">//&nbsp;the&nbsp;literal&nbsp;text&nbsp;of&nbsp;{{.X}}&nbsp;followed&nbsp;by&nbsp;the&nbsp;string&nbsp;&#34;bar&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5186247">func</span>&nbsp;<span class="ident" id="5186252">jsRegexpEscaper</span><span class="op" id="5186267">(</span><span class="ident" id="5186268">args</span>&nbsp;<span class="op" id="5186273">...</span><span class="keyword" id="5186276">interface</span><span class="op" id="5186285">{</span><span class="op" id="5186286">}</span><span class="op" id="5186287">)</span>&nbsp;<span class="builtintype" id="5186289">string</span>&nbsp;<span class="op" id="5186296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5186299">s</span><span class="op" id="5186300">,</span>&nbsp;<span class="ident" id="5186302">_</span>&nbsp;<span class="op" id="5186304">:=</span>&nbsp;<span class="ident" id="5186307">stringify</span><span class="op" id="5186316">(</span><span class="ident" id="5186317">args</span><span class="op" id="5186321">...</span><span class="op" id="5186324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5186327">s</span>&nbsp;<span class="op" id="5186329">=</span>&nbsp;<span class="ident" id="5186331">replace</span><span class="op" id="5186338">(</span><span class="ident" id="5186339">s</span><span class="op" id="5186340">,</span>&nbsp;<span class="ident" id="5186342">jsRegexpReplacementTable</span><span class="op" id="5186366">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5186369">if</span>&nbsp;<span class="ident" id="5186372">s</span>&nbsp;<span class="op" id="5186374">==</span>&nbsp;<span class="string" id="5186377">&#34;&#34;</span>&nbsp;<span class="op" id="5186380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5186384">//&nbsp;/{{.X}}/&nbsp;should&nbsp;not&nbsp;produce&nbsp;a&nbsp;line&nbsp;comment&nbsp;when&nbsp;.X&nbsp;==&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5186447">return</span>&nbsp;<span class="string" id="5186454">&#34;(?:)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5186462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5186465">return</span>&nbsp;<span class="ident" id="5186472">s</span><br>
<span class="lineno">240</span><span class="op" id="5186474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5186477">//&nbsp;replace&nbsp;replaces&nbsp;each&nbsp;rune&nbsp;r&nbsp;of&nbsp;s&nbsp;with&nbsp;replacementTable[r],&nbsp;provided&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5186554">//&nbsp;r&nbsp;&lt;&nbsp;len(replacementTable).&nbsp;If&nbsp;replacementTable[r]&nbsp;is&nbsp;the&nbsp;empty&nbsp;string&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5186632">//&nbsp;no&nbsp;replacement&nbsp;is&nbsp;made.</span><br>
<span class="lineno">245</span><span class="comment" id="5186659">//&nbsp;It&nbsp;also&nbsp;replaces&nbsp;runes&nbsp;U+2028&nbsp;and&nbsp;U+2029&nbsp;with&nbsp;the&nbsp;raw&nbsp;strings&nbsp;`\u2028`&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5186737">//&nbsp;`\u2029`.</span><br>
<span class="lineno"></span><span class="keyword" id="5186750">func</span>&nbsp;<span class="ident" id="5186755">replace</span><span class="op" id="5186762">(</span><span class="ident" id="5186763">s</span>&nbsp;<span class="builtintype" id="5186765">string</span><span class="op" id="5186771">,</span>&nbsp;<span class="ident" id="5186773">replacementTable</span>&nbsp;<span class="op" id="5186790">[</span><span class="op" id="5186791">]</span><span class="builtintype" id="5186792">string</span><span class="op" id="5186798">)</span>&nbsp;<span class="builtintype" id="5186800">string</span>&nbsp;<span class="op" id="5186807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5186810">var</span>&nbsp;<span class="ident" id="5186814">b</span>&nbsp;<span class="ident" id="5186816">bytes</span><span class="op" id="5186821">.</span><span class="ident" id="5186822">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5186830">written</span>&nbsp;<span class="op" id="5186838">:=</span>&nbsp;<span class="num" id="5186841">0</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5186844">for</span>&nbsp;<span class="ident" id="5186848">i</span><span class="op" id="5186849">,</span>&nbsp;<span class="ident" id="5186851">r</span>&nbsp;<span class="op" id="5186853">:=</span>&nbsp;<span class="keyword" id="5186856">range</span>&nbsp;<span class="ident" id="5186862">s</span>&nbsp;<span class="op" id="5186864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5186868">var</span>&nbsp;<span class="ident" id="5186872">repl</span>&nbsp;<span class="builtintype" id="5186877">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5186886">switch</span>&nbsp;<span class="op" id="5186893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5186897">case</span>&nbsp;<span class="builtintype" id="5186902">int</span><span class="op" id="5186905">(</span><span class="ident" id="5186906">r</span><span class="op" id="5186907">)</span>&nbsp;<span class="op" id="5186909">&lt;</span>&nbsp;<span class="builtinfunc" id="5186911">len</span><span class="op" id="5186914">(</span><span class="ident" id="5186915">replacementTable</span><span class="op" id="5186931">)</span>&nbsp;<span class="op" id="5186933">&amp;&amp;</span>&nbsp;<span class="ident" id="5186936">replacementTable</span><span class="op" id="5186952">[</span><span class="ident" id="5186953">r</span><span class="op" id="5186954">]</span>&nbsp;<span class="op" id="5186956">!=</span>&nbsp;<span class="string" id="5186959">&#34;&#34;</span><span class="op" id="5186961">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5186966">repl</span>&nbsp;<span class="op" id="5186971">=</span>&nbsp;<span class="ident" id="5186973">replacementTable</span><span class="op" id="5186989">[</span><span class="ident" id="5186990">r</span><span class="op" id="5186991">]</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5186995">case</span>&nbsp;<span class="ident" id="5187000">r</span>&nbsp;<span class="op" id="5187002">==</span>&nbsp;<span class="string" id="5187005">&#39;\u2028&#39;</span><span class="op" id="5187013">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5187018">repl</span>&nbsp;<span class="op" id="5187023">=</span>&nbsp;<span class="string" id="5187025">`\u2028`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5187036">case</span>&nbsp;<span class="ident" id="5187041">r</span>&nbsp;<span class="op" id="5187043">==</span>&nbsp;<span class="string" id="5187046">&#39;\u2029&#39;</span><span class="op" id="5187054">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5187059">repl</span>&nbsp;<span class="op" id="5187064">=</span>&nbsp;<span class="string" id="5187066">`\u2029`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5187077">default</span><span class="op" id="5187084">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5187089">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5187100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5187104">b</span><span class="op" id="5187105">.</span><span class="ident" id="5187106">WriteString</span><span class="op" id="5187117">(</span><span class="ident" id="5187118">s</span><span class="op" id="5187119">[</span><span class="ident" id="5187120">written</span><span class="op" id="5187127">:</span><span class="ident" id="5187128">i</span><span class="op" id="5187129">]</span><span class="op" id="5187130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5187134">b</span><span class="op" id="5187135">.</span><span class="ident" id="5187136">WriteString</span><span class="op" id="5187147">(</span><span class="ident" id="5187148">repl</span><span class="op" id="5187152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5187156">written</span>&nbsp;<span class="op" id="5187164">=</span>&nbsp;<span class="ident" id="5187166">i</span>&nbsp;<span class="op" id="5187168">+</span>&nbsp;<span class="ident" id="5187170">utf8</span><span class="op" id="5187174">.</span><span class="ident" id="5187175">RuneLen</span><span class="op" id="5187182">(</span><span class="ident" id="5187183">r</span><span class="op" id="5187184">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5187187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5187190">if</span>&nbsp;<span class="ident" id="5187193">written</span>&nbsp;<span class="op" id="5187201">==</span>&nbsp;<span class="num" id="5187204">0</span>&nbsp;<span class="op" id="5187206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5187210">return</span>&nbsp;<span class="ident" id="5187217">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5187220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5187223">b</span><span class="op" id="5187224">.</span><span class="ident" id="5187225">WriteString</span><span class="op" id="5187236">(</span><span class="ident" id="5187237">s</span><span class="op" id="5187238">[</span><span class="ident" id="5187239">written</span><span class="op" id="5187246">:</span><span class="op" id="5187247">]</span><span class="op" id="5187248">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5187251">return</span>&nbsp;<span class="ident" id="5187258">b</span><span class="op" id="5187259">.</span><span class="ident" id="5187260">String</span><span class="op" id="5187266">(</span><span class="op" id="5187267">)</span><br>
<span class="lineno"></span><span class="op" id="5187269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5187272">var</span>&nbsp;<span class="ident" id="5187276">jsStrReplacementTable</span>&nbsp;<span class="op" id="5187298">=</span>&nbsp;<span class="op" id="5187300">[</span><span class="op" id="5187301">]</span><span class="builtintype" id="5187302">string</span><span class="op" id="5187308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5187311">0</span><span class="op" id="5187312">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187317">`\0`</span><span class="op" id="5187321">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187324">&#39;\t&#39;</span><span class="op" id="5187328">:</span>&nbsp;<span class="string" id="5187330">`\t`</span><span class="op" id="5187334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187337">&#39;\n&#39;</span><span class="op" id="5187341">:</span>&nbsp;<span class="string" id="5187343">`\n`</span><span class="op" id="5187347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187350">&#39;\v&#39;</span><span class="op" id="5187354">:</span>&nbsp;<span class="string" id="5187356">`\x0b`</span><span class="op" id="5187362">,</span>&nbsp;<span class="comment" id="5187364">//&nbsp;&#34;\v&#34;&nbsp;==&nbsp;&#34;v&#34;&nbsp;on&nbsp;IE&nbsp;6.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187389">&#39;\f&#39;</span><span class="op" id="5187393">:</span>&nbsp;<span class="string" id="5187395">`\f`</span><span class="op" id="5187399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187402">&#39;\r&#39;</span><span class="op" id="5187406">:</span>&nbsp;<span class="string" id="5187408">`\r`</span><span class="op" id="5187412">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5187415">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5187477">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187526">&#39;&#34;&#39;</span><span class="op" id="5187529">:</span>&nbsp;&nbsp;<span class="string" id="5187532">`\x22`</span><span class="op" id="5187538">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187541">&#39;&amp;&#39;</span><span class="op" id="5187544">:</span>&nbsp;&nbsp;<span class="string" id="5187547">`\x26`</span><span class="op" id="5187553">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187556">&#39;\&#39;&#39;</span><span class="op" id="5187560">:</span>&nbsp;<span class="string" id="5187562">`\x27`</span><span class="op" id="5187568">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187571">&#39;+&#39;</span><span class="op" id="5187574">:</span>&nbsp;&nbsp;<span class="string" id="5187577">`\x2b`</span><span class="op" id="5187583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187586">&#39;/&#39;</span><span class="op" id="5187589">:</span>&nbsp;&nbsp;<span class="string" id="5187592">`\/`</span><span class="op" id="5187596">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187599">&#39;&lt;&#39;</span><span class="op" id="5187602">:</span>&nbsp;&nbsp;<span class="string" id="5187605">`\x3c`</span><span class="op" id="5187611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187614">&#39;&gt;&#39;</span><span class="op" id="5187617">:</span>&nbsp;&nbsp;<span class="string" id="5187620">`\x3e`</span><span class="op" id="5187626">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187629">&#39;\\&#39;</span><span class="op" id="5187633">:</span>&nbsp;<span class="string" id="5187635">`\\`</span><span class="op" id="5187639">,</span><br>
<span class="lineno">290</span><span class="op" id="5187641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5187644">//&nbsp;jsStrNormReplacementTable&nbsp;is&nbsp;like&nbsp;jsStrReplacementTable&nbsp;but&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="5187716">//&nbsp;overencode&nbsp;existing&nbsp;escapes&nbsp;since&nbsp;this&nbsp;table&nbsp;has&nbsp;no&nbsp;entry&nbsp;for&nbsp;`\`.</span><br>
<span class="lineno"></span><span class="keyword" id="5187786">var</span>&nbsp;<span class="ident" id="5187790">jsStrNormReplacementTable</span>&nbsp;<span class="op" id="5187816">=</span>&nbsp;<span class="op" id="5187818">[</span><span class="op" id="5187819">]</span><span class="builtintype" id="5187820">string</span><span class="op" id="5187826">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5187829">0</span><span class="op" id="5187830">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187835">`\0`</span><span class="op" id="5187839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187842">&#39;\t&#39;</span><span class="op" id="5187846">:</span>&nbsp;<span class="string" id="5187848">`\t`</span><span class="op" id="5187852">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187855">&#39;\n&#39;</span><span class="op" id="5187859">:</span>&nbsp;<span class="string" id="5187861">`\n`</span><span class="op" id="5187865">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187868">&#39;\v&#39;</span><span class="op" id="5187872">:</span>&nbsp;<span class="string" id="5187874">`\x0b`</span><span class="op" id="5187880">,</span>&nbsp;<span class="comment" id="5187882">//&nbsp;&#34;\v&#34;&nbsp;==&nbsp;&#34;v&#34;&nbsp;on&nbsp;IE&nbsp;6.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187907">&#39;\f&#39;</span><span class="op" id="5187911">:</span>&nbsp;<span class="string" id="5187913">`\f`</span><span class="op" id="5187917">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5187920">&#39;\r&#39;</span><span class="op" id="5187924">:</span>&nbsp;<span class="string" id="5187926">`\r`</span><span class="op" id="5187930">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5187933">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5187995">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188044">&#39;&#34;&#39;</span><span class="op" id="5188047">:</span>&nbsp;&nbsp;<span class="string" id="5188050">`\x22`</span><span class="op" id="5188056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188059">&#39;&amp;&#39;</span><span class="op" id="5188062">:</span>&nbsp;&nbsp;<span class="string" id="5188065">`\x26`</span><span class="op" id="5188071">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188074">&#39;\&#39;&#39;</span><span class="op" id="5188078">:</span>&nbsp;<span class="string" id="5188080">`\x27`</span><span class="op" id="5188086">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188089">&#39;+&#39;</span><span class="op" id="5188092">:</span>&nbsp;&nbsp;<span class="string" id="5188095">`\x2b`</span><span class="op" id="5188101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188104">&#39;/&#39;</span><span class="op" id="5188107">:</span>&nbsp;&nbsp;<span class="string" id="5188110">`\/`</span><span class="op" id="5188114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188117">&#39;&lt;&#39;</span><span class="op" id="5188120">:</span>&nbsp;&nbsp;<span class="string" id="5188123">`\x3c`</span><span class="op" id="5188129">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188132">&#39;&gt;&#39;</span><span class="op" id="5188135">:</span>&nbsp;&nbsp;<span class="string" id="5188138">`\x3e`</span><span class="op" id="5188144">,</span><br>
<span class="lineno">310</span><span class="op" id="5188146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5188149">var</span>&nbsp;<span class="ident" id="5188153">jsRegexpReplacementTable</span>&nbsp;<span class="op" id="5188178">=</span>&nbsp;<span class="op" id="5188180">[</span><span class="op" id="5188181">]</span><span class="builtintype" id="5188182">string</span><span class="op" id="5188188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5188191">0</span><span class="op" id="5188192">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188197">`\0`</span><span class="op" id="5188201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188204">&#39;\t&#39;</span><span class="op" id="5188208">:</span>&nbsp;<span class="string" id="5188210">`\t`</span><span class="op" id="5188214">,</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188217">&#39;\n&#39;</span><span class="op" id="5188221">:</span>&nbsp;<span class="string" id="5188223">`\n`</span><span class="op" id="5188227">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188230">&#39;\v&#39;</span><span class="op" id="5188234">:</span>&nbsp;<span class="string" id="5188236">`\x0b`</span><span class="op" id="5188242">,</span>&nbsp;<span class="comment" id="5188244">//&nbsp;&#34;\v&#34;&nbsp;==&nbsp;&#34;v&#34;&nbsp;on&nbsp;IE&nbsp;6.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188269">&#39;\f&#39;</span><span class="op" id="5188273">:</span>&nbsp;<span class="string" id="5188275">`\f`</span><span class="op" id="5188279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188282">&#39;\r&#39;</span><span class="op" id="5188286">:</span>&nbsp;<span class="string" id="5188288">`\r`</span><span class="op" id="5188292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5188295">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5188357">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188406">&#39;&#34;&#39;</span><span class="op" id="5188409">:</span>&nbsp;&nbsp;<span class="string" id="5188412">`\x22`</span><span class="op" id="5188418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188421">&#39;$&#39;</span><span class="op" id="5188424">:</span>&nbsp;&nbsp;<span class="string" id="5188427">`\$`</span><span class="op" id="5188431">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188434">&#39;&amp;&#39;</span><span class="op" id="5188437">:</span>&nbsp;&nbsp;<span class="string" id="5188440">`\x26`</span><span class="op" id="5188446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188449">&#39;\&#39;&#39;</span><span class="op" id="5188453">:</span>&nbsp;<span class="string" id="5188455">`\x27`</span><span class="op" id="5188461">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188464">&#39;(&#39;</span><span class="op" id="5188467">:</span>&nbsp;&nbsp;<span class="string" id="5188470">`\(`</span><span class="op" id="5188474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188477">&#39;)&#39;</span><span class="op" id="5188480">:</span>&nbsp;&nbsp;<span class="string" id="5188483">`\)`</span><span class="op" id="5188487">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188490">&#39;*&#39;</span><span class="op" id="5188493">:</span>&nbsp;&nbsp;<span class="string" id="5188496">`\*`</span><span class="op" id="5188500">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188503">&#39;+&#39;</span><span class="op" id="5188506">:</span>&nbsp;&nbsp;<span class="string" id="5188509">`\x2b`</span><span class="op" id="5188515">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188518">&#39;-&#39;</span><span class="op" id="5188521">:</span>&nbsp;&nbsp;<span class="string" id="5188524">`\-`</span><span class="op" id="5188528">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188531">&#39;.&#39;</span><span class="op" id="5188534">:</span>&nbsp;&nbsp;<span class="string" id="5188537">`\.`</span><span class="op" id="5188541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188544">&#39;/&#39;</span><span class="op" id="5188547">:</span>&nbsp;&nbsp;<span class="string" id="5188550">`\/`</span><span class="op" id="5188554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188557">&#39;&lt;&#39;</span><span class="op" id="5188560">:</span>&nbsp;&nbsp;<span class="string" id="5188563">`\x3c`</span><span class="op" id="5188569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188572">&#39;&gt;&#39;</span><span class="op" id="5188575">:</span>&nbsp;&nbsp;<span class="string" id="5188578">`\x3e`</span><span class="op" id="5188584">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188587">&#39;?&#39;</span><span class="op" id="5188590">:</span>&nbsp;&nbsp;<span class="string" id="5188593">`\?`</span><span class="op" id="5188597">,</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188600">&#39;[&#39;</span><span class="op" id="5188603">:</span>&nbsp;&nbsp;<span class="string" id="5188606">`\[`</span><span class="op" id="5188610">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188613">&#39;\\&#39;</span><span class="op" id="5188617">:</span>&nbsp;<span class="string" id="5188619">`\\`</span><span class="op" id="5188623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188626">&#39;]&#39;</span><span class="op" id="5188629">:</span>&nbsp;&nbsp;<span class="string" id="5188632">`\]`</span><span class="op" id="5188636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188639">&#39;^&#39;</span><span class="op" id="5188642">:</span>&nbsp;&nbsp;<span class="string" id="5188645">`\^`</span><span class="op" id="5188649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188652">&#39;{&#39;</span><span class="op" id="5188655">:</span>&nbsp;&nbsp;<span class="string" id="5188658">`\{`</span><span class="op" id="5188662">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188665">&#39;|&#39;</span><span class="op" id="5188668">:</span>&nbsp;&nbsp;<span class="string" id="5188671">`\|`</span><span class="op" id="5188675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5188678">&#39;}&#39;</span><span class="op" id="5188681">:</span>&nbsp;&nbsp;<span class="string" id="5188684">`\}`</span><span class="op" id="5188688">,</span><br>
<span class="lineno"></span><span class="op" id="5188690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5188693">//&nbsp;isJSIdentPart&nbsp;reports&nbsp;whether&nbsp;the&nbsp;given&nbsp;rune&nbsp;is&nbsp;a&nbsp;JS&nbsp;identifier&nbsp;part.</span><br>
<span class="lineno">345</span><span class="comment" id="5188766">//&nbsp;It&nbsp;does&nbsp;not&nbsp;handle&nbsp;all&nbsp;the&nbsp;non-Latin&nbsp;letters,&nbsp;joiners,&nbsp;and&nbsp;combining&nbsp;marks,</span><br>
<span class="lineno"></span><span class="comment" id="5188845">//&nbsp;but&nbsp;it&nbsp;does&nbsp;handle&nbsp;every&nbsp;codepoint&nbsp;that&nbsp;can&nbsp;occur&nbsp;in&nbsp;a&nbsp;numeric&nbsp;literal&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5188922">//&nbsp;a&nbsp;keyword.</span><br>
<span class="lineno"></span><span class="keyword" id="5188936">func</span>&nbsp;<span class="ident" id="5188941">isJSIdentPart</span><span class="op" id="5188954">(</span><span class="ident" id="5188955">r</span>&nbsp;<span class="builtintype" id="5188957">rune</span><span class="op" id="5188961">)</span>&nbsp;<span class="builtintype" id="5188963">bool</span>&nbsp;<span class="op" id="5188968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5188971">switch</span>&nbsp;<span class="op" id="5188978">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5188981">case</span>&nbsp;<span class="ident" id="5188986">r</span>&nbsp;<span class="op" id="5188988">==</span>&nbsp;<span class="string" id="5188991">&#39;$&#39;</span><span class="op" id="5188994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5188998">return</span>&nbsp;<span class="builtintype" id="5189005">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5189011">case</span>&nbsp;<span class="string" id="5189016">&#39;0&#39;</span>&nbsp;<span class="op" id="5189020">&lt;=</span>&nbsp;<span class="ident" id="5189023">r</span>&nbsp;<span class="op" id="5189025">&amp;&amp;</span>&nbsp;<span class="ident" id="5189028">r</span>&nbsp;<span class="op" id="5189030">&lt;=</span>&nbsp;<span class="string" id="5189033">&#39;9&#39;</span><span class="op" id="5189036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5189040">return</span>&nbsp;<span class="builtintype" id="5189047">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5189053">case</span>&nbsp;<span class="string" id="5189058">&#39;A&#39;</span>&nbsp;<span class="op" id="5189062">&lt;=</span>&nbsp;<span class="ident" id="5189065">r</span>&nbsp;<span class="op" id="5189067">&amp;&amp;</span>&nbsp;<span class="ident" id="5189070">r</span>&nbsp;<span class="op" id="5189072">&lt;=</span>&nbsp;<span class="string" id="5189075">&#39;Z&#39;</span><span class="op" id="5189078">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5189082">return</span>&nbsp;<span class="builtintype" id="5189089">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5189095">case</span>&nbsp;<span class="ident" id="5189100">r</span>&nbsp;<span class="op" id="5189102">==</span>&nbsp;<span class="string" id="5189105">&#39;_&#39;</span><span class="op" id="5189108">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5189112">return</span>&nbsp;<span class="builtintype" id="5189119">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5189125">case</span>&nbsp;<span class="string" id="5189130">&#39;a&#39;</span>&nbsp;<span class="op" id="5189134">&lt;=</span>&nbsp;<span class="ident" id="5189137">r</span>&nbsp;<span class="op" id="5189139">&amp;&amp;</span>&nbsp;<span class="ident" id="5189142">r</span>&nbsp;<span class="op" id="5189144">&lt;=</span>&nbsp;<span class="string" id="5189147">&#39;z&#39;</span><span class="op" id="5189150">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5189154">return</span>&nbsp;<span class="builtintype" id="5189161">true</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5189167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5189170">return</span>&nbsp;<span class="builtintype" id="5189177">false</span><br>
<span class="lineno"></span><span class="op" id="5189183">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
