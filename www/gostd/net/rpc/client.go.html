<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html" class="current">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4974558">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4974613">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4974667">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4974718">package</span>&nbsp;<span class="ident" id="4974726">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4974731">import</span>&nbsp;<span class="op" id="4974738">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4974741">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4974750">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4974766">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4974776">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4974782">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4974789">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4974796">&#34;net/http&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4974808">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="4974815">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4974818">//&nbsp;ServerError&nbsp;represents&nbsp;an&nbsp;error&nbsp;that&nbsp;has&nbsp;been&nbsp;returned&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4974881">//&nbsp;the&nbsp;remote&nbsp;side&nbsp;of&nbsp;the&nbsp;RPC&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="4974923">type</span>&nbsp;<span class="ident" id="4974928">ServerError</span>&nbsp;<span class="builtintype" id="4974940">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4974948">func</span>&nbsp;<span class="op" id="4974953">(</span><span class="ident" id="4974954">e</span>&nbsp;<span class="ident" id="4974956">ServerError</span><span class="op" id="4974967">)</span>&nbsp;<span class="ident" id="4974969">Error</span><span class="op" id="4974974">(</span><span class="op" id="4974975">)</span>&nbsp;<span class="builtintype" id="4974977">string</span>&nbsp;<span class="op" id="4974984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4974987">return</span>&nbsp;<span class="builtintype" id="4974994">string</span><span class="op" id="4975000">(</span><span class="ident" id="4975001">e</span><span class="op" id="4975002">)</span><br>
<span class="lineno"></span><span class="op" id="4975004">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="4975007">var</span>&nbsp;<span class="ident" id="4975011">ErrShutdown</span>&nbsp;<span class="op" id="4975023">=</span>&nbsp;<span class="ident" id="4975025">errors</span><span class="op" id="4975031">.</span><span class="ident" id="4975032">New</span><span class="op" id="4975035">(</span><span class="string" id="4975036">&#34;connection&nbsp;is&nbsp;shut&nbsp;down&#34;</span><span class="op" id="4975061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4975064">//&nbsp;Call&nbsp;represents&nbsp;an&nbsp;active&nbsp;RPC.</span><br>
<span class="lineno"></span><span class="keyword" id="4975098">type</span>&nbsp;<span class="ident" id="4975103">Call</span>&nbsp;<span class="keyword" id="4975108">struct</span>&nbsp;<span class="op" id="4975115">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975118">ServiceMethod</span>&nbsp;<span class="builtintype" id="4975132">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4975144">//&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;service&nbsp;and&nbsp;method&nbsp;to&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975192">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4975206">interface</span><span class="op" id="4975215">{</span><span class="op" id="4975216">}</span>&nbsp;<span class="comment" id="4975218">//&nbsp;The&nbsp;argument&nbsp;to&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975262">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4975276">interface</span><span class="op" id="4975285">{</span><span class="op" id="4975286">}</span>&nbsp;<span class="comment" id="4975288">//&nbsp;The&nbsp;reply&nbsp;from&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975331">Error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4975345">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4975357">//&nbsp;After&nbsp;completion,&nbsp;the&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975397">Done</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4975411">chan</span>&nbsp;<span class="op" id="4975416">*</span><span class="ident" id="4975417">Call</span>&nbsp;&nbsp;<span class="comment" id="4975423">//&nbsp;Strobes&nbsp;when&nbsp;call&nbsp;is&nbsp;complete.</span><br>
<span class="lineno">35</span><span class="op" id="4975457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4975460">//&nbsp;Client&nbsp;represents&nbsp;an&nbsp;RPC&nbsp;Client.</span><br>
<span class="lineno"></span><span class="comment" id="4975496">//&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;outstanding&nbsp;Calls&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="4975550">//&nbsp;with&nbsp;a&nbsp;single&nbsp;Client,&nbsp;and&nbsp;a&nbsp;Client&nbsp;may&nbsp;be&nbsp;used&nbsp;by</span><br>
<span class="lineno">40</span><span class="comment" id="4975603">//&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="keyword" id="4975642">type</span>&nbsp;<span class="ident" id="4975647">Client</span>&nbsp;<span class="keyword" id="4975654">struct</span>&nbsp;<span class="op" id="4975661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975664">codec</span>&nbsp;<span class="ident" id="4975670">ClientCodec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975684">reqMutex</span>&nbsp;<span class="ident" id="4975693">sync</span><span class="op" id="4975697">.</span><span class="ident" id="4975698">Mutex</span>&nbsp;<span class="comment" id="4975704">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975727">request</span>&nbsp;&nbsp;<span class="ident" id="4975736">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975746">mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4975755">sync</span><span class="op" id="4975759">.</span><span class="ident" id="4975760">Mutex</span>&nbsp;<span class="comment" id="4975766">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975789">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4975798">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975806">pending</span>&nbsp;&nbsp;<span class="keyword" id="4975815">map</span><span class="op" id="4975818">[</span><span class="ident" id="4975819">uint64</span><span class="op" id="4975825">]</span><span class="op" id="4975826">*</span><span class="ident" id="4975827">Call</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975833">closing</span>&nbsp;&nbsp;<span class="builtintype" id="4975842">bool</span>&nbsp;<span class="comment" id="4975847">//&nbsp;user&nbsp;has&nbsp;called&nbsp;Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4975873">shutdown</span>&nbsp;<span class="builtintype" id="4975882">bool</span>&nbsp;<span class="comment" id="4975887">//&nbsp;server&nbsp;has&nbsp;told&nbsp;us&nbsp;to&nbsp;stop</span><br>
<span class="lineno"></span><span class="op" id="4975917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4975920">//&nbsp;A&nbsp;ClientCodec&nbsp;implements&nbsp;writing&nbsp;of&nbsp;RPC&nbsp;requests&nbsp;and</span><br>
<span class="lineno">55</span><span class="comment" id="4975976">//&nbsp;reading&nbsp;of&nbsp;RPC&nbsp;responses&nbsp;for&nbsp;the&nbsp;client&nbsp;side&nbsp;of&nbsp;an&nbsp;RPC&nbsp;session.</span><br>
<span class="lineno"></span><span class="comment" id="4976043">//&nbsp;The&nbsp;client&nbsp;calls&nbsp;WriteRequest&nbsp;to&nbsp;write&nbsp;a&nbsp;request&nbsp;to&nbsp;the&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="4976113">//&nbsp;and&nbsp;calls&nbsp;ReadResponseHeader&nbsp;and&nbsp;ReadResponseBody&nbsp;in&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="4976175">//&nbsp;to&nbsp;read&nbsp;responses.&nbsp;&nbsp;The&nbsp;client&nbsp;calls&nbsp;Close&nbsp;when&nbsp;finished&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4976244">//&nbsp;connection.&nbsp;ReadResponseBody&nbsp;may&nbsp;be&nbsp;called&nbsp;with&nbsp;a&nbsp;nil</span><br>
<span class="lineno">60</span><span class="comment" id="4976301">//&nbsp;argument&nbsp;to&nbsp;force&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;response&nbsp;to&nbsp;be&nbsp;read&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="4976367">//&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="4976381">type</span>&nbsp;<span class="ident" id="4976386">ClientCodec</span>&nbsp;<span class="keyword" id="4976398">interface</span>&nbsp;<span class="op" id="4976408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4976411">//&nbsp;WriteRequest&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976484">WriteRequest</span><span class="op" id="4976496">(</span><span class="op" id="4976497">*</span><span class="ident" id="4976498">Request</span><span class="op" id="4976505">,</span>&nbsp;<span class="keyword" id="4976507">interface</span><span class="op" id="4976516">{</span><span class="op" id="4976517">}</span><span class="op" id="4976518">)</span>&nbsp;<span class="builtintype" id="4976520">error</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976527">ReadResponseHeader</span><span class="op" id="4976545">(</span><span class="op" id="4976546">*</span><span class="ident" id="4976547">Response</span><span class="op" id="4976555">)</span>&nbsp;<span class="builtintype" id="4976557">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976564">ReadResponseBody</span><span class="op" id="4976580">(</span><span class="keyword" id="4976581">interface</span><span class="op" id="4976590">{</span><span class="op" id="4976591">}</span><span class="op" id="4976592">)</span>&nbsp;<span class="builtintype" id="4976594">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976602">Close</span><span class="op" id="4976607">(</span><span class="op" id="4976608">)</span>&nbsp;<span class="builtintype" id="4976610">error</span><br>
<span class="lineno"></span><span class="op" id="4976616">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4976619">func</span>&nbsp;<span class="op" id="4976624">(</span><span class="ident" id="4976625">client</span>&nbsp;<span class="op" id="4976632">*</span><span class="ident" id="4976633">Client</span><span class="op" id="4976639">)</span>&nbsp;<span class="ident" id="4976641">send</span><span class="op" id="4976645">(</span><span class="ident" id="4976646">call</span>&nbsp;<span class="op" id="4976651">*</span><span class="ident" id="4976652">Call</span><span class="op" id="4976656">)</span>&nbsp;<span class="op" id="4976658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976661">client</span><span class="op" id="4976667">.</span><span class="ident" id="4976668">reqMutex</span><span class="op" id="4976676">.</span><span class="ident" id="4976677">Lock</span><span class="op" id="4976681">(</span><span class="op" id="4976682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976685">defer</span>&nbsp;<span class="ident" id="4976691">client</span><span class="op" id="4976697">.</span><span class="ident" id="4976698">reqMutex</span><span class="op" id="4976706">.</span><span class="ident" id="4976707">Unlock</span><span class="op" id="4976713">(</span><span class="op" id="4976714">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4976718">//&nbsp;Register&nbsp;this&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976742">client</span><span class="op" id="4976748">.</span><span class="ident" id="4976749">mutex</span><span class="op" id="4976754">.</span><span class="ident" id="4976755">Lock</span><span class="op" id="4976759">(</span><span class="op" id="4976760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976763">if</span>&nbsp;<span class="ident" id="4976766">client</span><span class="op" id="4976772">.</span><span class="ident" id="4976773">shutdown</span>&nbsp;<span class="op" id="4976782">||</span>&nbsp;<span class="ident" id="4976785">client</span><span class="op" id="4976791">.</span><span class="ident" id="4976792">closing</span>&nbsp;<span class="op" id="4976800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976804">call</span><span class="op" id="4976808">.</span><span class="ident" id="4976809">Error</span>&nbsp;<span class="op" id="4976815">=</span>&nbsp;<span class="ident" id="4976817">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976831">client</span><span class="op" id="4976837">.</span><span class="ident" id="4976838">mutex</span><span class="op" id="4976843">.</span><span class="ident" id="4976844">Unlock</span><span class="op" id="4976850">(</span><span class="op" id="4976851">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976855">call</span><span class="op" id="4976859">.</span><span class="ident" id="4976860">done</span><span class="op" id="4976864">(</span><span class="op" id="4976865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976869">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976880">seq</span>&nbsp;<span class="op" id="4976884">:=</span>&nbsp;<span class="ident" id="4976887">client</span><span class="op" id="4976893">.</span><span class="ident" id="4976894">seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976899">client</span><span class="op" id="4976905">.</span><span class="ident" id="4976906">seq</span><span class="op" id="4976909">++</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976913">client</span><span class="op" id="4976919">.</span><span class="ident" id="4976920">pending</span><span class="op" id="4976927">[</span><span class="ident" id="4976928">seq</span><span class="op" id="4976931">]</span>&nbsp;<span class="op" id="4976933">=</span>&nbsp;<span class="ident" id="4976935">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976941">client</span><span class="op" id="4976947">.</span><span class="ident" id="4976948">mutex</span><span class="op" id="4976953">.</span><span class="ident" id="4976954">Unlock</span><span class="op" id="4976960">(</span><span class="op" id="4976961">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4976965">//&nbsp;Encode&nbsp;and&nbsp;send&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976998">client</span><span class="op" id="4977004">.</span><span class="ident" id="4977005">request</span><span class="op" id="4977012">.</span><span class="ident" id="4977013">Seq</span>&nbsp;<span class="op" id="4977017">=</span>&nbsp;<span class="ident" id="4977019">seq</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977024">client</span><span class="op" id="4977030">.</span><span class="ident" id="4977031">request</span><span class="op" id="4977038">.</span><span class="ident" id="4977039">ServiceMethod</span>&nbsp;<span class="op" id="4977053">=</span>&nbsp;<span class="ident" id="4977055">call</span><span class="op" id="4977059">.</span><span class="ident" id="4977060">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977075">err</span>&nbsp;<span class="op" id="4977079">:=</span>&nbsp;<span class="ident" id="4977082">client</span><span class="op" id="4977088">.</span><span class="ident" id="4977089">codec</span><span class="op" id="4977094">.</span><span class="ident" id="4977095">WriteRequest</span><span class="op" id="4977107">(</span><span class="op" id="4977108">&amp;</span><span class="ident" id="4977109">client</span><span class="op" id="4977115">.</span><span class="ident" id="4977116">request</span><span class="op" id="4977123">,</span>&nbsp;<span class="ident" id="4977125">call</span><span class="op" id="4977129">.</span><span class="ident" id="4977130">Args</span><span class="op" id="4977134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977137">if</span>&nbsp;<span class="ident" id="4977140">err</span>&nbsp;<span class="op" id="4977144">!=</span>&nbsp;<span class="ident" id="4977147">nil</span>&nbsp;<span class="op" id="4977151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977155">client</span><span class="op" id="4977161">.</span><span class="ident" id="4977162">mutex</span><span class="op" id="4977167">.</span><span class="ident" id="4977168">Lock</span><span class="op" id="4977172">(</span><span class="op" id="4977173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977177">call</span>&nbsp;<span class="op" id="4977182">=</span>&nbsp;<span class="ident" id="4977184">client</span><span class="op" id="4977190">.</span><span class="ident" id="4977191">pending</span><span class="op" id="4977198">[</span><span class="ident" id="4977199">seq</span><span class="op" id="4977202">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4977206">delete</span><span class="op" id="4977212">(</span><span class="ident" id="4977213">client</span><span class="op" id="4977219">.</span><span class="ident" id="4977220">pending</span><span class="op" id="4977227">,</span>&nbsp;<span class="ident" id="4977229">seq</span><span class="op" id="4977232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977236">client</span><span class="op" id="4977242">.</span><span class="ident" id="4977243">mutex</span><span class="op" id="4977248">.</span><span class="ident" id="4977249">Unlock</span><span class="op" id="4977255">(</span><span class="op" id="4977256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977260">if</span>&nbsp;<span class="ident" id="4977263">call</span>&nbsp;<span class="op" id="4977268">!=</span>&nbsp;<span class="ident" id="4977271">nil</span>&nbsp;<span class="op" id="4977275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977280">call</span><span class="op" id="4977284">.</span><span class="ident" id="4977285">Error</span>&nbsp;<span class="op" id="4977291">=</span>&nbsp;<span class="ident" id="4977293">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977300">call</span><span class="op" id="4977304">.</span><span class="ident" id="4977305">done</span><span class="op" id="4977309">(</span><span class="op" id="4977310">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4977314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4977317">}</span><br>
<span class="lineno"></span><span class="op" id="4977319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4977322">func</span>&nbsp;<span class="op" id="4977327">(</span><span class="ident" id="4977328">client</span>&nbsp;<span class="op" id="4977335">*</span><span class="ident" id="4977336">Client</span><span class="op" id="4977342">)</span>&nbsp;<span class="ident" id="4977344">input</span><span class="op" id="4977349">(</span><span class="op" id="4977350">)</span>&nbsp;<span class="op" id="4977352">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977355">var</span>&nbsp;<span class="ident" id="4977359">err</span>&nbsp;<span class="builtintype" id="4977363">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977370">var</span>&nbsp;<span class="ident" id="4977374">response</span>&nbsp;<span class="ident" id="4977383">Response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977393">for</span>&nbsp;<span class="ident" id="4977397">err</span>&nbsp;<span class="op" id="4977401">==</span>&nbsp;<span class="ident" id="4977404">nil</span>&nbsp;<span class="op" id="4977408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977412">response</span>&nbsp;<span class="op" id="4977421">=</span>&nbsp;<span class="ident" id="4977423">Response</span><span class="op" id="4977431">{</span><span class="op" id="4977432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977436">err</span>&nbsp;<span class="op" id="4977440">=</span>&nbsp;<span class="ident" id="4977442">client</span><span class="op" id="4977448">.</span><span class="ident" id="4977449">codec</span><span class="op" id="4977454">.</span><span class="ident" id="4977455">ReadResponseHeader</span><span class="op" id="4977473">(</span><span class="op" id="4977474">&amp;</span><span class="ident" id="4977475">response</span><span class="op" id="4977483">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977487">if</span>&nbsp;<span class="ident" id="4977490">err</span>&nbsp;<span class="op" id="4977494">!=</span>&nbsp;<span class="ident" id="4977497">nil</span>&nbsp;<span class="op" id="4977501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977506">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4977514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977518">seq</span>&nbsp;<span class="op" id="4977522">:=</span>&nbsp;<span class="ident" id="4977525">response</span><span class="op" id="4977533">.</span><span class="ident" id="4977534">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977540">client</span><span class="op" id="4977546">.</span><span class="ident" id="4977547">mutex</span><span class="op" id="4977552">.</span><span class="ident" id="4977553">Lock</span><span class="op" id="4977557">(</span><span class="op" id="4977558">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977562">call</span>&nbsp;<span class="op" id="4977567">:=</span>&nbsp;<span class="ident" id="4977570">client</span><span class="op" id="4977576">.</span><span class="ident" id="4977577">pending</span><span class="op" id="4977584">[</span><span class="ident" id="4977585">seq</span><span class="op" id="4977588">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4977592">delete</span><span class="op" id="4977598">(</span><span class="ident" id="4977599">client</span><span class="op" id="4977605">.</span><span class="ident" id="4977606">pending</span><span class="op" id="4977613">,</span>&nbsp;<span class="ident" id="4977615">seq</span><span class="op" id="4977618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977622">client</span><span class="op" id="4977628">.</span><span class="ident" id="4977629">mutex</span><span class="op" id="4977634">.</span><span class="ident" id="4977635">Unlock</span><span class="op" id="4977641">(</span><span class="op" id="4977642">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977647">switch</span>&nbsp;<span class="op" id="4977654">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4977658">case</span>&nbsp;<span class="ident" id="4977663">call</span>&nbsp;<span class="op" id="4977668">==</span>&nbsp;<span class="ident" id="4977671">nil</span><span class="op" id="4977674">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4977679">//&nbsp;We&#39;ve&nbsp;got&nbsp;no&nbsp;pending&nbsp;call.&nbsp;That&nbsp;usually&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4977736">//&nbsp;WriteRequest&nbsp;partially&nbsp;failed,&nbsp;and&nbsp;call&nbsp;was&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4977794">//&nbsp;removed;&nbsp;response&nbsp;is&nbsp;a&nbsp;server&nbsp;telling&nbsp;us&nbsp;about&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4977850">//&nbsp;error&nbsp;reading&nbsp;request&nbsp;body.&nbsp;We&nbsp;should&nbsp;still&nbsp;attempt</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4977908">//&nbsp;to&nbsp;read&nbsp;error&nbsp;body,&nbsp;but&nbsp;there&#39;s&nbsp;no&nbsp;one&nbsp;to&nbsp;give&nbsp;it&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977968">err</span>&nbsp;<span class="op" id="4977972">=</span>&nbsp;<span class="ident" id="4977974">client</span><span class="op" id="4977980">.</span><span class="ident" id="4977981">codec</span><span class="op" id="4977986">.</span><span class="ident" id="4977987">ReadResponseBody</span><span class="op" id="4978003">(</span><span class="ident" id="4978004">nil</span><span class="op" id="4978007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978012">if</span>&nbsp;<span class="ident" id="4978015">err</span>&nbsp;<span class="op" id="4978019">!=</span>&nbsp;<span class="ident" id="4978022">nil</span>&nbsp;<span class="op" id="4978026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978032">err</span>&nbsp;<span class="op" id="4978036">=</span>&nbsp;<span class="ident" id="4978038">errors</span><span class="op" id="4978044">.</span><span class="ident" id="4978045">New</span><span class="op" id="4978048">(</span><span class="string" id="4978049">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="4978072">+</span>&nbsp;<span class="ident" id="4978074">err</span><span class="op" id="4978077">.</span><span class="ident" id="4978078">Error</span><span class="op" id="4978083">(</span><span class="op" id="4978084">)</span><span class="op" id="4978085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978090">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978094">case</span>&nbsp;<span class="ident" id="4978099">response</span><span class="op" id="4978107">.</span><span class="ident" id="4978108">Error</span>&nbsp;<span class="op" id="4978114">!=</span>&nbsp;<span class="string" id="4978117">&#34;&#34;</span><span class="op" id="4978119">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4978124">//&nbsp;We&#39;ve&nbsp;got&nbsp;an&nbsp;error&nbsp;response.&nbsp;Give&nbsp;this&nbsp;to&nbsp;the&nbsp;request;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4978185">//&nbsp;any&nbsp;subsequent&nbsp;requests&nbsp;will&nbsp;get&nbsp;the&nbsp;ReadResponseBody</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4978245">//&nbsp;error&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978274">call</span><span class="op" id="4978278">.</span><span class="ident" id="4978279">Error</span>&nbsp;<span class="op" id="4978285">=</span>&nbsp;<span class="ident" id="4978287">ServerError</span><span class="op" id="4978298">(</span><span class="ident" id="4978299">response</span><span class="op" id="4978307">.</span><span class="ident" id="4978308">Error</span><span class="op" id="4978313">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978318">err</span>&nbsp;<span class="op" id="4978322">=</span>&nbsp;<span class="ident" id="4978324">client</span><span class="op" id="4978330">.</span><span class="ident" id="4978331">codec</span><span class="op" id="4978336">.</span><span class="ident" id="4978337">ReadResponseBody</span><span class="op" id="4978353">(</span><span class="ident" id="4978354">nil</span><span class="op" id="4978357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978362">if</span>&nbsp;<span class="ident" id="4978365">err</span>&nbsp;<span class="op" id="4978369">!=</span>&nbsp;<span class="ident" id="4978372">nil</span>&nbsp;<span class="op" id="4978376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978382">err</span>&nbsp;<span class="op" id="4978386">=</span>&nbsp;<span class="ident" id="4978388">errors</span><span class="op" id="4978394">.</span><span class="ident" id="4978395">New</span><span class="op" id="4978398">(</span><span class="string" id="4978399">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="4978422">+</span>&nbsp;<span class="ident" id="4978424">err</span><span class="op" id="4978427">.</span><span class="ident" id="4978428">Error</span><span class="op" id="4978433">(</span><span class="op" id="4978434">)</span><span class="op" id="4978435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978445">call</span><span class="op" id="4978449">.</span><span class="ident" id="4978450">done</span><span class="op" id="4978454">(</span><span class="op" id="4978455">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978459">default</span><span class="op" id="4978466">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978471">err</span>&nbsp;<span class="op" id="4978475">=</span>&nbsp;<span class="ident" id="4978477">client</span><span class="op" id="4978483">.</span><span class="ident" id="4978484">codec</span><span class="op" id="4978489">.</span><span class="ident" id="4978490">ReadResponseBody</span><span class="op" id="4978506">(</span><span class="ident" id="4978507">call</span><span class="op" id="4978511">.</span><span class="ident" id="4978512">Reply</span><span class="op" id="4978517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978522">if</span>&nbsp;<span class="ident" id="4978525">err</span>&nbsp;<span class="op" id="4978529">!=</span>&nbsp;<span class="ident" id="4978532">nil</span>&nbsp;<span class="op" id="4978536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978542">call</span><span class="op" id="4978546">.</span><span class="ident" id="4978547">Error</span>&nbsp;<span class="op" id="4978553">=</span>&nbsp;<span class="ident" id="4978555">errors</span><span class="op" id="4978561">.</span><span class="ident" id="4978562">New</span><span class="op" id="4978565">(</span><span class="string" id="4978566">&#34;reading&nbsp;body&nbsp;&#34;</span>&nbsp;<span class="op" id="4978582">+</span>&nbsp;<span class="ident" id="4978584">err</span><span class="op" id="4978587">.</span><span class="ident" id="4978588">Error</span><span class="op" id="4978593">(</span><span class="op" id="4978594">)</span><span class="op" id="4978595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978600">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978605">call</span><span class="op" id="4978609">.</span><span class="ident" id="4978610">done</span><span class="op" id="4978614">(</span><span class="op" id="4978615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4978625">//&nbsp;Terminate&nbsp;pending&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978654">client</span><span class="op" id="4978660">.</span><span class="ident" id="4978661">reqMutex</span><span class="op" id="4978669">.</span><span class="ident" id="4978670">Lock</span><span class="op" id="4978674">(</span><span class="op" id="4978675">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978678">client</span><span class="op" id="4978684">.</span><span class="ident" id="4978685">mutex</span><span class="op" id="4978690">.</span><span class="ident" id="4978691">Lock</span><span class="op" id="4978695">(</span><span class="op" id="4978696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978699">client</span><span class="op" id="4978705">.</span><span class="ident" id="4978706">shutdown</span>&nbsp;<span class="op" id="4978715">=</span>&nbsp;<span class="builtintype" id="4978717">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978723">closing</span>&nbsp;<span class="op" id="4978731">:=</span>&nbsp;<span class="ident" id="4978734">client</span><span class="op" id="4978740">.</span><span class="ident" id="4978741">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978750">if</span>&nbsp;<span class="ident" id="4978753">err</span>&nbsp;<span class="op" id="4978757">==</span>&nbsp;<span class="ident" id="4978760">io</span><span class="op" id="4978762">.</span><span class="ident" id="4978763">EOF</span>&nbsp;<span class="op" id="4978767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978771">if</span>&nbsp;<span class="ident" id="4978774">closing</span>&nbsp;<span class="op" id="4978782">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978787">err</span>&nbsp;<span class="op" id="4978791">=</span>&nbsp;<span class="ident" id="4978793">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978807">}</span>&nbsp;<span class="keyword" id="4978809">else</span>&nbsp;<span class="op" id="4978814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978819">err</span>&nbsp;<span class="op" id="4978823">=</span>&nbsp;<span class="ident" id="4978825">io</span><span class="op" id="4978827">.</span><span class="ident" id="4978828">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978850">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978853">for</span>&nbsp;<span class="ident" id="4978857">_</span><span class="op" id="4978858">,</span>&nbsp;<span class="ident" id="4978860">call</span>&nbsp;<span class="op" id="4978865">:=</span>&nbsp;<span class="keyword" id="4978868">range</span>&nbsp;<span class="ident" id="4978874">client</span><span class="op" id="4978880">.</span><span class="ident" id="4978881">pending</span>&nbsp;<span class="op" id="4978889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978893">call</span><span class="op" id="4978897">.</span><span class="ident" id="4978898">Error</span>&nbsp;<span class="op" id="4978904">=</span>&nbsp;<span class="ident" id="4978906">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978912">call</span><span class="op" id="4978916">.</span><span class="ident" id="4978917">done</span><span class="op" id="4978921">(</span><span class="op" id="4978922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978928">client</span><span class="op" id="4978934">.</span><span class="ident" id="4978935">mutex</span><span class="op" id="4978940">.</span><span class="ident" id="4978941">Unlock</span><span class="op" id="4978947">(</span><span class="op" id="4978948">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978951">client</span><span class="op" id="4978957">.</span><span class="ident" id="4978958">reqMutex</span><span class="op" id="4978966">.</span><span class="ident" id="4978967">Unlock</span><span class="op" id="4978973">(</span><span class="op" id="4978974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978977">if</span>&nbsp;<span class="ident" id="4978980">debugLog</span>&nbsp;<span class="op" id="4978989">&amp;&amp;</span>&nbsp;<span class="ident" id="4978992">err</span>&nbsp;<span class="op" id="4978996">!=</span>&nbsp;<span class="ident" id="4978999">io</span><span class="op" id="4979001">.</span><span class="ident" id="4979002">EOF</span>&nbsp;<span class="op" id="4979006">&amp;&amp;</span>&nbsp;<span class="op" id="4979009">!</span><span class="ident" id="4979010">closing</span>&nbsp;<span class="op" id="4979018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979022">log</span><span class="op" id="4979025">.</span><span class="ident" id="4979026">Println</span><span class="op" id="4979033">(</span><span class="string" id="4979034">&#34;rpc:&nbsp;client&nbsp;protocol&nbsp;error:&#34;</span><span class="op" id="4979063">,</span>&nbsp;<span class="ident" id="4979065">err</span><span class="op" id="4979068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979071">}</span><br>
<span class="lineno"></span><span class="op" id="4979073">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="4979076">func</span>&nbsp;<span class="op" id="4979081">(</span><span class="ident" id="4979082">call</span>&nbsp;<span class="op" id="4979087">*</span><span class="ident" id="4979088">Call</span><span class="op" id="4979092">)</span>&nbsp;<span class="ident" id="4979094">done</span><span class="op" id="4979098">(</span><span class="op" id="4979099">)</span>&nbsp;<span class="op" id="4979101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979104">select</span>&nbsp;<span class="op" id="4979111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979114">case</span>&nbsp;<span class="ident" id="4979119">call</span><span class="op" id="4979123">.</span><span class="ident" id="4979124">Done</span>&nbsp;<span class="op" id="4979129">&lt;-</span>&nbsp;<span class="ident" id="4979132">call</span><span class="op" id="4979136">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4979140">//&nbsp;ok</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979147">default</span><span class="op" id="4979154">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4979158">//&nbsp;We&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;block&nbsp;here.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4979235">//&nbsp;sure&nbsp;the&nbsp;channel&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;space.&nbsp;See&nbsp;comment&nbsp;in&nbsp;Go().</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979303">if</span>&nbsp;<span class="ident" id="4979306">debugLog</span>&nbsp;<span class="op" id="4979315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979320">log</span><span class="op" id="4979323">.</span><span class="ident" id="4979324">Println</span><span class="op" id="4979331">(</span><span class="string" id="4979332">&#34;rpc:&nbsp;discarding&nbsp;Call&nbsp;reply&nbsp;due&nbsp;to&nbsp;insufficient&nbsp;Done&nbsp;chan&nbsp;capacity&#34;</span><span class="op" id="4979399">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979406">}</span><br>
<span class="lineno"></span><span class="op" id="4979408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4979411">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno">185</span><span class="comment" id="4979471">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4979526">//&nbsp;It&nbsp;adds&nbsp;a&nbsp;buffer&nbsp;to&nbsp;the&nbsp;write&nbsp;side&nbsp;of&nbsp;the&nbsp;connection&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="4979585">//&nbsp;the&nbsp;header&nbsp;and&nbsp;payload&nbsp;are&nbsp;sent&nbsp;as&nbsp;a&nbsp;unit.</span><br>
<span class="lineno"></span><span class="keyword" id="4979631">func</span>&nbsp;<span class="ident" id="4979636">NewClient</span><span class="op" id="4979645">(</span><span class="ident" id="4979646">conn</span>&nbsp;<span class="ident" id="4979651">io</span><span class="op" id="4979653">.</span><span class="ident" id="4979654">ReadWriteCloser</span><span class="op" id="4979669">)</span>&nbsp;<span class="op" id="4979671">*</span><span class="ident" id="4979672">Client</span>&nbsp;<span class="op" id="4979679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979682">encBuf</span>&nbsp;<span class="op" id="4979689">:=</span>&nbsp;<span class="ident" id="4979692">bufio</span><span class="op" id="4979697">.</span><span class="ident" id="4979698">NewWriter</span><span class="op" id="4979707">(</span><span class="ident" id="4979708">conn</span><span class="op" id="4979712">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979715">client</span>&nbsp;<span class="op" id="4979722">:=</span>&nbsp;<span class="op" id="4979725">&amp;</span><span class="ident" id="4979726">gobClientCodec</span><span class="op" id="4979740">{</span><span class="ident" id="4979741">conn</span><span class="op" id="4979745">,</span>&nbsp;<span class="ident" id="4979747">gob</span><span class="op" id="4979750">.</span><span class="ident" id="4979751">NewDecoder</span><span class="op" id="4979761">(</span><span class="ident" id="4979762">conn</span><span class="op" id="4979766">)</span><span class="op" id="4979767">,</span>&nbsp;<span class="ident" id="4979769">gob</span><span class="op" id="4979772">.</span><span class="ident" id="4979773">NewEncoder</span><span class="op" id="4979783">(</span><span class="ident" id="4979784">encBuf</span><span class="op" id="4979790">)</span><span class="op" id="4979791">,</span>&nbsp;<span class="ident" id="4979793">encBuf</span><span class="op" id="4979799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979802">return</span>&nbsp;<span class="ident" id="4979809">NewClientWithCodec</span><span class="op" id="4979827">(</span><span class="ident" id="4979828">client</span><span class="op" id="4979834">)</span><br>
<span class="lineno"></span><span class="op" id="4979836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4979839">//&nbsp;NewClientWithCodec&nbsp;is&nbsp;like&nbsp;NewClient&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified</span><br>
<span class="lineno">195</span><span class="comment" id="4979902">//&nbsp;codec&nbsp;to&nbsp;encode&nbsp;requests&nbsp;and&nbsp;decode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="4979952">func</span>&nbsp;<span class="ident" id="4979957">NewClientWithCodec</span><span class="op" id="4979975">(</span><span class="ident" id="4979976">codec</span>&nbsp;<span class="ident" id="4979982">ClientCodec</span><span class="op" id="4979993">)</span>&nbsp;<span class="op" id="4979995">*</span><span class="ident" id="4979996">Client</span>&nbsp;<span class="op" id="4980003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980006">client</span>&nbsp;<span class="op" id="4980013">:=</span>&nbsp;<span class="op" id="4980016">&amp;</span><span class="ident" id="4980017">Client</span><span class="op" id="4980023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980027">codec</span><span class="op" id="4980032">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4980036">codec</span><span class="op" id="4980041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980045">pending</span><span class="op" id="4980052">:</span>&nbsp;<span class="builtinfunc" id="4980054">make</span><span class="op" id="4980058">(</span><span class="keyword" id="4980059">map</span><span class="op" id="4980062">[</span><span class="ident" id="4980063">uint64</span><span class="op" id="4980069">]</span><span class="op" id="4980070">*</span><span class="ident" id="4980071">Call</span><span class="op" id="4980075">)</span><span class="op" id="4980076">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980082">go</span>&nbsp;<span class="ident" id="4980085">client</span><span class="op" id="4980091">.</span><span class="ident" id="4980092">input</span><span class="op" id="4980097">(</span><span class="op" id="4980098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980101">return</span>&nbsp;<span class="ident" id="4980108">client</span><br>
<span class="lineno"></span><span class="op" id="4980115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="4980118">type</span>&nbsp;<span class="ident" id="4980123">gobClientCodec</span>&nbsp;<span class="keyword" id="4980138">struct</span>&nbsp;<span class="op" id="4980145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980148">rwc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4980155">io</span><span class="op" id="4980157">.</span><span class="ident" id="4980158">ReadWriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980175">dec</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4980182">*</span><span class="ident" id="4980183">gob</span><span class="op" id="4980186">.</span><span class="ident" id="4980187">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980196">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4980203">*</span><span class="ident" id="4980204">gob</span><span class="op" id="4980207">.</span><span class="ident" id="4980208">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980217">encBuf</span>&nbsp;<span class="op" id="4980224">*</span><span class="ident" id="4980225">bufio</span><span class="op" id="4980230">.</span><span class="ident" id="4980231">Writer</span><br>
<span class="lineno">210</span><span class="op" id="4980238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4980241">func</span>&nbsp;<span class="op" id="4980246">(</span><span class="ident" id="4980247">c</span>&nbsp;<span class="op" id="4980249">*</span><span class="ident" id="4980250">gobClientCodec</span><span class="op" id="4980264">)</span>&nbsp;<span class="ident" id="4980266">WriteRequest</span><span class="op" id="4980278">(</span><span class="ident" id="4980279">r</span>&nbsp;<span class="op" id="4980281">*</span><span class="ident" id="4980282">Request</span><span class="op" id="4980289">,</span>&nbsp;<span class="ident" id="4980291">body</span>&nbsp;<span class="keyword" id="4980296">interface</span><span class="op" id="4980305">{</span><span class="op" id="4980306">}</span><span class="op" id="4980307">)</span>&nbsp;<span class="op" id="4980309">(</span><span class="ident" id="4980310">err</span>&nbsp;<span class="builtintype" id="4980314">error</span><span class="op" id="4980319">)</span>&nbsp;<span class="op" id="4980321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980324">if</span>&nbsp;<span class="ident" id="4980327">err</span>&nbsp;<span class="op" id="4980331">=</span>&nbsp;<span class="ident" id="4980333">c</span><span class="op" id="4980334">.</span><span class="ident" id="4980335">enc</span><span class="op" id="4980338">.</span><span class="ident" id="4980339">Encode</span><span class="op" id="4980345">(</span><span class="ident" id="4980346">r</span><span class="op" id="4980347">)</span><span class="op" id="4980348">;</span>&nbsp;<span class="ident" id="4980350">err</span>&nbsp;<span class="op" id="4980354">!=</span>&nbsp;<span class="ident" id="4980357">nil</span>&nbsp;<span class="op" id="4980361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980365">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980376">if</span>&nbsp;<span class="ident" id="4980379">err</span>&nbsp;<span class="op" id="4980383">=</span>&nbsp;<span class="ident" id="4980385">c</span><span class="op" id="4980386">.</span><span class="ident" id="4980387">enc</span><span class="op" id="4980390">.</span><span class="ident" id="4980391">Encode</span><span class="op" id="4980397">(</span><span class="ident" id="4980398">body</span><span class="op" id="4980402">)</span><span class="op" id="4980403">;</span>&nbsp;<span class="ident" id="4980405">err</span>&nbsp;<span class="op" id="4980409">!=</span>&nbsp;<span class="ident" id="4980412">nil</span>&nbsp;<span class="op" id="4980416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980420">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980431">return</span>&nbsp;<span class="ident" id="4980438">c</span><span class="op" id="4980439">.</span><span class="ident" id="4980440">encBuf</span><span class="op" id="4980446">.</span><span class="ident" id="4980447">Flush</span><span class="op" id="4980452">(</span><span class="op" id="4980453">)</span><br>
<span class="lineno">220</span><span class="op" id="4980455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4980458">func</span>&nbsp;<span class="op" id="4980463">(</span><span class="ident" id="4980464">c</span>&nbsp;<span class="op" id="4980466">*</span><span class="ident" id="4980467">gobClientCodec</span><span class="op" id="4980481">)</span>&nbsp;<span class="ident" id="4980483">ReadResponseHeader</span><span class="op" id="4980501">(</span><span class="ident" id="4980502">r</span>&nbsp;<span class="op" id="4980504">*</span><span class="ident" id="4980505">Response</span><span class="op" id="4980513">)</span>&nbsp;<span class="builtintype" id="4980515">error</span>&nbsp;<span class="op" id="4980521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980524">return</span>&nbsp;<span class="ident" id="4980531">c</span><span class="op" id="4980532">.</span><span class="ident" id="4980533">dec</span><span class="op" id="4980536">.</span><span class="ident" id="4980537">Decode</span><span class="op" id="4980543">(</span><span class="ident" id="4980544">r</span><span class="op" id="4980545">)</span><br>
<span class="lineno"></span><span class="op" id="4980547">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="4980550">func</span>&nbsp;<span class="op" id="4980555">(</span><span class="ident" id="4980556">c</span>&nbsp;<span class="op" id="4980558">*</span><span class="ident" id="4980559">gobClientCodec</span><span class="op" id="4980573">)</span>&nbsp;<span class="ident" id="4980575">ReadResponseBody</span><span class="op" id="4980591">(</span><span class="ident" id="4980592">body</span>&nbsp;<span class="keyword" id="4980597">interface</span><span class="op" id="4980606">{</span><span class="op" id="4980607">}</span><span class="op" id="4980608">)</span>&nbsp;<span class="builtintype" id="4980610">error</span>&nbsp;<span class="op" id="4980616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980619">return</span>&nbsp;<span class="ident" id="4980626">c</span><span class="op" id="4980627">.</span><span class="ident" id="4980628">dec</span><span class="op" id="4980631">.</span><span class="ident" id="4980632">Decode</span><span class="op" id="4980638">(</span><span class="ident" id="4980639">body</span><span class="op" id="4980643">)</span><br>
<span class="lineno"></span><span class="op" id="4980645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="4980648">func</span>&nbsp;<span class="op" id="4980653">(</span><span class="ident" id="4980654">c</span>&nbsp;<span class="op" id="4980656">*</span><span class="ident" id="4980657">gobClientCodec</span><span class="op" id="4980671">)</span>&nbsp;<span class="ident" id="4980673">Close</span><span class="op" id="4980678">(</span><span class="op" id="4980679">)</span>&nbsp;<span class="builtintype" id="4980681">error</span>&nbsp;<span class="op" id="4980687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980690">return</span>&nbsp;<span class="ident" id="4980697">c</span><span class="op" id="4980698">.</span><span class="ident" id="4980699">rwc</span><span class="op" id="4980702">.</span><span class="ident" id="4980703">Close</span><span class="op" id="4980708">(</span><span class="op" id="4980709">)</span><br>
<span class="lineno"></span><span class="op" id="4980711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4980714">//&nbsp;DialHTTP&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address</span><br>
<span class="lineno">235</span><span class="comment" id="4980790">//&nbsp;listening&nbsp;on&nbsp;the&nbsp;default&nbsp;HTTP&nbsp;RPC&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="4980833">func</span>&nbsp;<span class="ident" id="4980838">DialHTTP</span><span class="op" id="4980846">(</span><span class="ident" id="4980847">network</span><span class="op" id="4980854">,</span>&nbsp;<span class="ident" id="4980856">address</span>&nbsp;<span class="builtintype" id="4980864">string</span><span class="op" id="4980870">)</span>&nbsp;<span class="op" id="4980872">(</span><span class="op" id="4980873">*</span><span class="ident" id="4980874">Client</span><span class="op" id="4980880">,</span>&nbsp;<span class="builtintype" id="4980882">error</span><span class="op" id="4980887">)</span>&nbsp;<span class="op" id="4980889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980892">return</span>&nbsp;<span class="ident" id="4980899">DialHTTPPath</span><span class="op" id="4980911">(</span><span class="ident" id="4980912">network</span><span class="op" id="4980919">,</span>&nbsp;<span class="ident" id="4980921">address</span><span class="op" id="4980928">,</span>&nbsp;<span class="ident" id="4980930">DefaultRPCPath</span><span class="op" id="4980944">)</span><br>
<span class="lineno"></span><span class="op" id="4980946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="4980949">//&nbsp;DialHTTPPath&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="4980996">//&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address&nbsp;and&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="4981042">func</span>&nbsp;<span class="ident" id="4981047">DialHTTPPath</span><span class="op" id="4981059">(</span><span class="ident" id="4981060">network</span><span class="op" id="4981067">,</span>&nbsp;<span class="ident" id="4981069">address</span><span class="op" id="4981076">,</span>&nbsp;<span class="ident" id="4981078">path</span>&nbsp;<span class="builtintype" id="4981083">string</span><span class="op" id="4981089">)</span>&nbsp;<span class="op" id="4981091">(</span><span class="op" id="4981092">*</span><span class="ident" id="4981093">Client</span><span class="op" id="4981099">,</span>&nbsp;<span class="builtintype" id="4981101">error</span><span class="op" id="4981106">)</span>&nbsp;<span class="op" id="4981108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981111">var</span>&nbsp;<span class="ident" id="4981115">err</span>&nbsp;<span class="builtintype" id="4981119">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981126">conn</span><span class="op" id="4981130">,</span>&nbsp;<span class="ident" id="4981132">err</span>&nbsp;<span class="op" id="4981136">:=</span>&nbsp;<span class="ident" id="4981139">net</span><span class="op" id="4981142">.</span><span class="ident" id="4981143">Dial</span><span class="op" id="4981147">(</span><span class="ident" id="4981148">network</span><span class="op" id="4981155">,</span>&nbsp;<span class="ident" id="4981157">address</span><span class="op" id="4981164">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981167">if</span>&nbsp;<span class="ident" id="4981170">err</span>&nbsp;<span class="op" id="4981174">!=</span>&nbsp;<span class="ident" id="4981177">nil</span>&nbsp;<span class="op" id="4981181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981185">return</span>&nbsp;<span class="ident" id="4981192">nil</span><span class="op" id="4981195">,</span>&nbsp;<span class="ident" id="4981197">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981205">io</span><span class="op" id="4981207">.</span><span class="ident" id="4981208">WriteString</span><span class="op" id="4981219">(</span><span class="ident" id="4981220">conn</span><span class="op" id="4981224">,</span>&nbsp;<span class="string" id="4981226">&#34;CONNECT&nbsp;&#34;</span><span class="op" id="4981236">+</span><span class="ident" id="4981237">path</span><span class="op" id="4981241">+</span><span class="string" id="4981242">&#34;&nbsp;HTTP/1.0\n\n&#34;</span><span class="op" id="4981257">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981261">//&nbsp;Require&nbsp;successful&nbsp;HTTP&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981298">//&nbsp;before&nbsp;switching&nbsp;to&nbsp;RPC&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981336">resp</span><span class="op" id="4981340">,</span>&nbsp;<span class="ident" id="4981342">err</span>&nbsp;<span class="op" id="4981346">:=</span>&nbsp;<span class="ident" id="4981349">http</span><span class="op" id="4981353">.</span><span class="ident" id="4981354">ReadResponse</span><span class="op" id="4981366">(</span><span class="ident" id="4981367">bufio</span><span class="op" id="4981372">.</span><span class="ident" id="4981373">NewReader</span><span class="op" id="4981382">(</span><span class="ident" id="4981383">conn</span><span class="op" id="4981387">)</span><span class="op" id="4981388">,</span>&nbsp;<span class="op" id="4981390">&amp;</span><span class="ident" id="4981391">http</span><span class="op" id="4981395">.</span><span class="ident" id="4981396">Request</span><span class="op" id="4981403">{</span><span class="ident" id="4981404">Method</span><span class="op" id="4981410">:</span>&nbsp;<span class="string" id="4981412">&#34;CONNECT&#34;</span><span class="op" id="4981421">}</span><span class="op" id="4981422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981425">if</span>&nbsp;<span class="ident" id="4981428">err</span>&nbsp;<span class="op" id="4981432">==</span>&nbsp;<span class="ident" id="4981435">nil</span>&nbsp;<span class="op" id="4981439">&amp;&amp;</span>&nbsp;<span class="ident" id="4981442">resp</span><span class="op" id="4981446">.</span><span class="ident" id="4981447">Status</span>&nbsp;<span class="op" id="4981454">==</span>&nbsp;<span class="ident" id="4981457">connected</span>&nbsp;<span class="op" id="4981467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981471">return</span>&nbsp;<span class="ident" id="4981478">NewClient</span><span class="op" id="4981487">(</span><span class="ident" id="4981488">conn</span><span class="op" id="4981492">)</span><span class="op" id="4981493">,</span>&nbsp;<span class="ident" id="4981495">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981503">if</span>&nbsp;<span class="ident" id="4981506">err</span>&nbsp;<span class="op" id="4981510">==</span>&nbsp;<span class="ident" id="4981513">nil</span>&nbsp;<span class="op" id="4981517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981521">err</span>&nbsp;<span class="op" id="4981525">=</span>&nbsp;<span class="ident" id="4981527">errors</span><span class="op" id="4981533">.</span><span class="ident" id="4981534">New</span><span class="op" id="4981537">(</span><span class="string" id="4981538">&#34;unexpected&nbsp;HTTP&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="4981567">+</span>&nbsp;<span class="ident" id="4981569">resp</span><span class="op" id="4981573">.</span><span class="ident" id="4981574">Status</span><span class="op" id="4981580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981586">conn</span><span class="op" id="4981590">.</span><span class="ident" id="4981591">Close</span><span class="op" id="4981596">(</span><span class="op" id="4981597">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981600">return</span>&nbsp;<span class="ident" id="4981607">nil</span><span class="op" id="4981610">,</span>&nbsp;<span class="op" id="4981612">&amp;</span><span class="ident" id="4981613">net</span><span class="op" id="4981616">.</span><span class="ident" id="4981617">OpError</span><span class="op" id="4981624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981628">Op</span><span class="op" id="4981630">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="4981634">&#34;dial-http&#34;</span><span class="op" id="4981645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981649">Net</span><span class="op" id="4981652">:</span>&nbsp;&nbsp;<span class="ident" id="4981655">network</span>&nbsp;<span class="op" id="4981663">+</span>&nbsp;<span class="string" id="4981665">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="4981669">+</span>&nbsp;<span class="ident" id="4981671">address</span><span class="op" id="4981678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981682">Addr</span><span class="op" id="4981686">:</span>&nbsp;<span class="ident" id="4981688">nil</span><span class="op" id="4981691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981695">Err</span><span class="op" id="4981698">:</span>&nbsp;&nbsp;<span class="ident" id="4981701">err</span><span class="op" id="4981704">,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981707">}</span><br>
<span class="lineno"></span><span class="op" id="4981709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4981712">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;an&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="4981780">func</span>&nbsp;<span class="ident" id="4981785">Dial</span><span class="op" id="4981789">(</span><span class="ident" id="4981790">network</span><span class="op" id="4981797">,</span>&nbsp;<span class="ident" id="4981799">address</span>&nbsp;<span class="builtintype" id="4981807">string</span><span class="op" id="4981813">)</span>&nbsp;<span class="op" id="4981815">(</span><span class="op" id="4981816">*</span><span class="ident" id="4981817">Client</span><span class="op" id="4981823">,</span>&nbsp;<span class="builtintype" id="4981825">error</span><span class="op" id="4981830">)</span>&nbsp;<span class="op" id="4981832">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981835">conn</span><span class="op" id="4981839">,</span>&nbsp;<span class="ident" id="4981841">err</span>&nbsp;<span class="op" id="4981845">:=</span>&nbsp;<span class="ident" id="4981848">net</span><span class="op" id="4981851">.</span><span class="ident" id="4981852">Dial</span><span class="op" id="4981856">(</span><span class="ident" id="4981857">network</span><span class="op" id="4981864">,</span>&nbsp;<span class="ident" id="4981866">address</span><span class="op" id="4981873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981876">if</span>&nbsp;<span class="ident" id="4981879">err</span>&nbsp;<span class="op" id="4981883">!=</span>&nbsp;<span class="ident" id="4981886">nil</span>&nbsp;<span class="op" id="4981890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981894">return</span>&nbsp;<span class="ident" id="4981901">nil</span><span class="op" id="4981904">,</span>&nbsp;<span class="ident" id="4981906">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981914">return</span>&nbsp;<span class="ident" id="4981921">NewClient</span><span class="op" id="4981930">(</span><span class="ident" id="4981931">conn</span><span class="op" id="4981935">)</span><span class="op" id="4981936">,</span>&nbsp;<span class="ident" id="4981938">nil</span><br>
<span class="lineno">275</span><span class="op" id="4981942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4981945">func</span>&nbsp;<span class="op" id="4981950">(</span><span class="ident" id="4981951">client</span>&nbsp;<span class="op" id="4981958">*</span><span class="ident" id="4981959">Client</span><span class="op" id="4981965">)</span>&nbsp;<span class="ident" id="4981967">Close</span><span class="op" id="4981972">(</span><span class="op" id="4981973">)</span>&nbsp;<span class="builtintype" id="4981975">error</span>&nbsp;<span class="op" id="4981981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981984">client</span><span class="op" id="4981990">.</span><span class="ident" id="4981991">mutex</span><span class="op" id="4981996">.</span><span class="ident" id="4981997">Lock</span><span class="op" id="4982001">(</span><span class="op" id="4982002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982005">if</span>&nbsp;<span class="ident" id="4982008">client</span><span class="op" id="4982014">.</span><span class="ident" id="4982015">closing</span>&nbsp;<span class="op" id="4982023">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982027">client</span><span class="op" id="4982033">.</span><span class="ident" id="4982034">mutex</span><span class="op" id="4982039">.</span><span class="ident" id="4982040">Unlock</span><span class="op" id="4982046">(</span><span class="op" id="4982047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982051">return</span>&nbsp;<span class="ident" id="4982058">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982074">client</span><span class="op" id="4982080">.</span><span class="ident" id="4982081">closing</span>&nbsp;<span class="op" id="4982089">=</span>&nbsp;<span class="builtintype" id="4982091">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982097">client</span><span class="op" id="4982103">.</span><span class="ident" id="4982104">mutex</span><span class="op" id="4982109">.</span><span class="ident" id="4982110">Unlock</span><span class="op" id="4982116">(</span><span class="op" id="4982117">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982120">return</span>&nbsp;<span class="ident" id="4982127">client</span><span class="op" id="4982133">.</span><span class="ident" id="4982134">codec</span><span class="op" id="4982139">.</span><span class="ident" id="4982140">Close</span><span class="op" id="4982145">(</span><span class="op" id="4982146">)</span><br>
<span class="lineno"></span><span class="op" id="4982148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4982151">//&nbsp;Go&nbsp;invokes&nbsp;the&nbsp;function&nbsp;asynchronously.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;Call&nbsp;structure&nbsp;representing</span><br>
<span class="lineno"></span><span class="comment" id="4982238">//&nbsp;the&nbsp;invocation.&nbsp;&nbsp;The&nbsp;done&nbsp;channel&nbsp;will&nbsp;signal&nbsp;when&nbsp;the&nbsp;call&nbsp;is&nbsp;complete&nbsp;by&nbsp;returning</span><br>
<span class="lineno">290</span><span class="comment" id="4982326">//&nbsp;the&nbsp;same&nbsp;Call&nbsp;object.&nbsp;&nbsp;If&nbsp;done&nbsp;is&nbsp;nil,&nbsp;Go&nbsp;will&nbsp;allocate&nbsp;a&nbsp;new&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="4982400">//&nbsp;If&nbsp;non-nil,&nbsp;done&nbsp;must&nbsp;be&nbsp;buffered&nbsp;or&nbsp;Go&nbsp;will&nbsp;deliberately&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="4982468">func</span>&nbsp;<span class="op" id="4982473">(</span><span class="ident" id="4982474">client</span>&nbsp;<span class="op" id="4982481">*</span><span class="ident" id="4982482">Client</span><span class="op" id="4982488">)</span>&nbsp;<span class="ident" id="4982490">Go</span><span class="op" id="4982492">(</span><span class="ident" id="4982493">serviceMethod</span>&nbsp;<span class="builtintype" id="4982507">string</span><span class="op" id="4982513">,</span>&nbsp;<span class="ident" id="4982515">args</span>&nbsp;<span class="keyword" id="4982520">interface</span><span class="op" id="4982529">{</span><span class="op" id="4982530">}</span><span class="op" id="4982531">,</span>&nbsp;<span class="ident" id="4982533">reply</span>&nbsp;<span class="keyword" id="4982539">interface</span><span class="op" id="4982548">{</span><span class="op" id="4982549">}</span><span class="op" id="4982550">,</span>&nbsp;<span class="ident" id="4982552">done</span>&nbsp;<span class="keyword" id="4982557">chan</span>&nbsp;<span class="op" id="4982562">*</span><span class="ident" id="4982563">Call</span><span class="op" id="4982567">)</span>&nbsp;<span class="op" id="4982569">*</span><span class="ident" id="4982570">Call</span>&nbsp;<span class="op" id="4982575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982578">call</span>&nbsp;<span class="op" id="4982583">:=</span>&nbsp;<span class="builtinfunc" id="4982586">new</span><span class="op" id="4982589">(</span><span class="ident" id="4982590">Call</span><span class="op" id="4982594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982597">call</span><span class="op" id="4982601">.</span><span class="ident" id="4982602">ServiceMethod</span>&nbsp;<span class="op" id="4982616">=</span>&nbsp;<span class="ident" id="4982618">serviceMethod</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982633">call</span><span class="op" id="4982637">.</span><span class="ident" id="4982638">Args</span>&nbsp;<span class="op" id="4982643">=</span>&nbsp;<span class="ident" id="4982645">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982651">call</span><span class="op" id="4982655">.</span><span class="ident" id="4982656">Reply</span>&nbsp;<span class="op" id="4982662">=</span>&nbsp;<span class="ident" id="4982664">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982671">if</span>&nbsp;<span class="ident" id="4982674">done</span>&nbsp;<span class="op" id="4982679">==</span>&nbsp;<span class="ident" id="4982682">nil</span>&nbsp;<span class="op" id="4982686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982690">done</span>&nbsp;<span class="op" id="4982695">=</span>&nbsp;<span class="builtinfunc" id="4982697">make</span><span class="op" id="4982701">(</span><span class="keyword" id="4982702">chan</span>&nbsp;<span class="op" id="4982707">*</span><span class="ident" id="4982708">Call</span><span class="op" id="4982712">,</span>&nbsp;<span class="num" id="4982714">10</span><span class="op" id="4982716">)</span>&nbsp;<span class="comment" id="4982718">//&nbsp;buffered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982732">}</span>&nbsp;<span class="keyword" id="4982734">else</span>&nbsp;<span class="op" id="4982739">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4982743">//&nbsp;If&nbsp;caller&nbsp;passes&nbsp;done&nbsp;!=&nbsp;nil,&nbsp;it&nbsp;must&nbsp;arrange&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4982799">//&nbsp;done&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;for&nbsp;the&nbsp;number&nbsp;of&nbsp;simultaneous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4982858">//&nbsp;RPCs&nbsp;that&nbsp;will&nbsp;be&nbsp;using&nbsp;that&nbsp;channel.&nbsp;&nbsp;If&nbsp;the&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4982917">//&nbsp;is&nbsp;totally&nbsp;unbuffered,&nbsp;it&#39;s&nbsp;best&nbsp;not&nbsp;to&nbsp;run&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982974">if</span>&nbsp;<span class="builtinfunc" id="4982977">cap</span><span class="op" id="4982980">(</span><span class="ident" id="4982981">done</span><span class="op" id="4982985">)</span>&nbsp;<span class="op" id="4982987">==</span>&nbsp;<span class="num" id="4982990">0</span>&nbsp;<span class="op" id="4982992">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982997">log</span><span class="op" id="4983000">.</span><span class="ident" id="4983001">Panic</span><span class="op" id="4983006">(</span><span class="string" id="4983007">&#34;rpc:&nbsp;done&nbsp;channel&nbsp;is&nbsp;unbuffered&#34;</span><span class="op" id="4983040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983050">call</span><span class="op" id="4983054">.</span><span class="ident" id="4983055">Done</span>&nbsp;<span class="op" id="4983060">=</span>&nbsp;<span class="ident" id="4983062">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983068">client</span><span class="op" id="4983074">.</span><span class="ident" id="4983075">send</span><span class="op" id="4983079">(</span><span class="ident" id="4983080">call</span><span class="op" id="4983084">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983087">return</span>&nbsp;<span class="ident" id="4983094">call</span><br>
<span class="lineno"></span><span class="op" id="4983099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4983102">//&nbsp;Call&nbsp;invokes&nbsp;the&nbsp;named&nbsp;function,&nbsp;waits&nbsp;for&nbsp;it&nbsp;to&nbsp;complete,&nbsp;and&nbsp;returns&nbsp;its&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span><span class="keyword" id="4983194">func</span>&nbsp;<span class="op" id="4983199">(</span><span class="ident" id="4983200">client</span>&nbsp;<span class="op" id="4983207">*</span><span class="ident" id="4983208">Client</span><span class="op" id="4983214">)</span>&nbsp;<span class="ident" id="4983216">Call</span><span class="op" id="4983220">(</span><span class="ident" id="4983221">serviceMethod</span>&nbsp;<span class="builtintype" id="4983235">string</span><span class="op" id="4983241">,</span>&nbsp;<span class="ident" id="4983243">args</span>&nbsp;<span class="keyword" id="4983248">interface</span><span class="op" id="4983257">{</span><span class="op" id="4983258">}</span><span class="op" id="4983259">,</span>&nbsp;<span class="ident" id="4983261">reply</span>&nbsp;<span class="keyword" id="4983267">interface</span><span class="op" id="4983276">{</span><span class="op" id="4983277">}</span><span class="op" id="4983278">)</span>&nbsp;<span class="builtintype" id="4983280">error</span>&nbsp;<span class="op" id="4983286">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983289">call</span>&nbsp;<span class="op" id="4983294">:=</span>&nbsp;<span class="op" id="4983297">&lt;-</span><span class="ident" id="4983299">client</span><span class="op" id="4983305">.</span><span class="ident" id="4983306">Go</span><span class="op" id="4983308">(</span><span class="ident" id="4983309">serviceMethod</span><span class="op" id="4983322">,</span>&nbsp;<span class="ident" id="4983324">args</span><span class="op" id="4983328">,</span>&nbsp;<span class="ident" id="4983330">reply</span><span class="op" id="4983335">,</span>&nbsp;<span class="builtinfunc" id="4983337">make</span><span class="op" id="4983341">(</span><span class="keyword" id="4983342">chan</span>&nbsp;<span class="op" id="4983347">*</span><span class="ident" id="4983348">Call</span><span class="op" id="4983352">,</span>&nbsp;<span class="num" id="4983354">1</span><span class="op" id="4983355">)</span><span class="op" id="4983356">)</span><span class="op" id="4983357">.</span><span class="ident" id="4983358">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983364">return</span>&nbsp;<span class="ident" id="4983371">call</span><span class="op" id="4983375">.</span><span class="ident" id="4983376">Error</span><br>
<span class="lineno"></span><span class="op" id="4983382">}</span>
</div>
</body>
</html>
