<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html" class="current">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4476710">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4476765">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4476819">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4476870">//&nbsp;Package&nbsp;rsa&nbsp;implements&nbsp;RSA&nbsp;encryption&nbsp;as&nbsp;specified&nbsp;in&nbsp;PKCS#1.</span><br>
<span class="lineno"></span><span class="keyword" id="4476935">package</span>&nbsp;<span class="ident" id="4476943">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4476948">import</span>&nbsp;<span class="op" id="4476955">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4476958">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4476968">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4476983">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4477000">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4477010">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4477018">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4477024">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4477035">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4477038">var</span>&nbsp;<span class="ident" id="4477042">bigZero</span>&nbsp;<span class="op" id="4477050">=</span>&nbsp;<span class="ident" id="4477052">big</span><span class="op" id="4477055">.</span><span class="ident" id="4477056">NewInt</span><span class="op" id="4477062">(</span><span class="num" id="4477063">0</span><span class="op" id="4477064">)</span><br>
<span class="lineno"></span><span class="keyword" id="4477066">var</span>&nbsp;<span class="ident" id="4477070">bigOne</span>&nbsp;<span class="op" id="4477077">=</span>&nbsp;<span class="ident" id="4477079">big</span><span class="op" id="4477082">.</span><span class="ident" id="4477083">NewInt</span><span class="op" id="4477089">(</span><span class="num" id="4477090">1</span><span class="op" id="4477091">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4477094">//&nbsp;A&nbsp;PublicKey&nbsp;represents&nbsp;the&nbsp;public&nbsp;part&nbsp;of&nbsp;an&nbsp;RSA&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4477151">type</span>&nbsp;<span class="ident" id="4477156">PublicKey</span>&nbsp;<span class="keyword" id="4477166">struct</span>&nbsp;<span class="op" id="4477173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4477176">N</span>&nbsp;<span class="op" id="4477178">*</span><span class="ident" id="4477179">big</span><span class="op" id="4477182">.</span><span class="ident" id="4477183">Int</span>&nbsp;<span class="comment" id="4477187">//&nbsp;modulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4477199">E</span>&nbsp;<span class="builtintype" id="4477201">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4477210">//&nbsp;public&nbsp;exponent</span><br>
<span class="lineno">25</span><span class="op" id="4477229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4477232">var</span>&nbsp;<span class="op" id="4477236">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4477239">errPublicModulus</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4477262">=</span>&nbsp;<span class="ident" id="4477264">errors</span><span class="op" id="4477270">.</span><span class="ident" id="4477271">New</span><span class="op" id="4477274">(</span><span class="string" id="4477275">&#34;crypto/rsa:&nbsp;missing&nbsp;public&nbsp;modulus&#34;</span><span class="op" id="4477311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4477314">errPublicExponentSmall</span>&nbsp;<span class="op" id="4477337">=</span>&nbsp;<span class="ident" id="4477339">errors</span><span class="op" id="4477345">.</span><span class="ident" id="4477346">New</span><span class="op" id="4477349">(</span><span class="string" id="4477350">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;small&#34;</span><span class="op" id="4477389">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4477392">errPublicExponentLarge</span>&nbsp;<span class="op" id="4477415">=</span>&nbsp;<span class="ident" id="4477417">errors</span><span class="op" id="4477423">.</span><span class="ident" id="4477424">New</span><span class="op" id="4477427">(</span><span class="string" id="4477428">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;large&#34;</span><span class="op" id="4477467">)</span><br>
<span class="lineno"></span><span class="op" id="4477469">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4477472">//&nbsp;checkPub&nbsp;sanity&nbsp;checks&nbsp;the&nbsp;public&nbsp;key&nbsp;before&nbsp;we&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4477531">//&nbsp;We&nbsp;require&nbsp;pub.E&nbsp;to&nbsp;fit&nbsp;into&nbsp;a&nbsp;32-bit&nbsp;integer&nbsp;so&nbsp;that&nbsp;we</span><br>
<span class="lineno">35</span><span class="comment" id="4477591">//&nbsp;do&nbsp;not&nbsp;have&nbsp;different&nbsp;behavior&nbsp;depending&nbsp;on&nbsp;whether</span><br>
<span class="lineno"></span><span class="comment" id="4477646">//&nbsp;int&nbsp;is&nbsp;32&nbsp;or&nbsp;64&nbsp;bits.&nbsp;See&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="4477680">//&nbsp;http://www.imperialviolet.org/2012/03/16/rsae.html.</span><br>
<span class="lineno"></span><span class="keyword" id="4477735">func</span>&nbsp;<span class="ident" id="4477740">checkPub</span><span class="op" id="4477748">(</span><span class="ident" id="4477749">pub</span>&nbsp;<span class="op" id="4477753">*</span><span class="ident" id="4477754">PublicKey</span><span class="op" id="4477763">)</span>&nbsp;<span class="builtintype" id="4477765">error</span>&nbsp;<span class="op" id="4477771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4477774">if</span>&nbsp;<span class="ident" id="4477777">pub</span><span class="op" id="4477780">.</span><span class="ident" id="4477781">N</span>&nbsp;<span class="op" id="4477783">==</span>&nbsp;<span class="builtintype" id="4477786">nil</span>&nbsp;<span class="op" id="4477790">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4477794">return</span>&nbsp;<span class="ident" id="4477801">errPublicModulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4477819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4477822">if</span>&nbsp;<span class="ident" id="4477825">pub</span><span class="op" id="4477828">.</span><span class="ident" id="4477829">E</span>&nbsp;<span class="op" id="4477831">&lt;</span>&nbsp;<span class="num" id="4477833">2</span>&nbsp;<span class="op" id="4477835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4477839">return</span>&nbsp;<span class="ident" id="4477846">errPublicExponentSmall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4477870">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4477873">if</span>&nbsp;<span class="ident" id="4477876">pub</span><span class="op" id="4477879">.</span><span class="ident" id="4477880">E</span>&nbsp;<span class="op" id="4477882">&gt;</span>&nbsp;<span class="num" id="4477884">1</span><span class="op" id="4477885">&lt;&lt;</span><span class="num" id="4477887">31</span><span class="op" id="4477889">-</span><span class="num" id="4477890">1</span>&nbsp;<span class="op" id="4477892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4477896">return</span>&nbsp;<span class="ident" id="4477903">errPublicExponentLarge</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4477927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4477930">return</span>&nbsp;<span class="builtintype" id="4477937">nil</span><br>
<span class="lineno"></span><span class="op" id="4477941">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4477944">//&nbsp;A&nbsp;PrivateKey&nbsp;represents&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno"></span><span class="keyword" id="4477982">type</span>&nbsp;<span class="ident" id="4477987">PrivateKey</span>&nbsp;<span class="keyword" id="4477998">struct</span>&nbsp;<span class="op" id="4478005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4478008">PublicKey</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4478029">//&nbsp;public&nbsp;part.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4478046">D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4478056">*</span><span class="ident" id="4478057">big</span><span class="op" id="4478060">.</span><span class="ident" id="4478061">Int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4478067">//&nbsp;private&nbsp;exponent</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4478088">Primes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4478098">[</span><span class="op" id="4478099">]</span><span class="op" id="4478100">*</span><span class="ident" id="4478101">big</span><span class="op" id="4478104">.</span><span class="ident" id="4478105">Int</span>&nbsp;<span class="comment" id="4478109">//&nbsp;prime&nbsp;factors&nbsp;of&nbsp;N,&nbsp;has&nbsp;&gt;=&nbsp;2&nbsp;elements.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4478153">//&nbsp;Precomputed&nbsp;contains&nbsp;precomputed&nbsp;values&nbsp;that&nbsp;speed&nbsp;up&nbsp;private</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4478219">//&nbsp;operations,&nbsp;if&nbsp;available.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4478249">Precomputed</span>&nbsp;<span class="ident" id="4478261">PrecomputedValues</span><br>
<span class="lineno">60</span><span class="op" id="4478279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4478282">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno"></span><span class="keyword" id="4478338">func</span>&nbsp;<span class="op" id="4478343">(</span><span class="ident" id="4478344">priv</span>&nbsp;<span class="op" id="4478349">*</span><span class="ident" id="4478350">PrivateKey</span><span class="op" id="4478360">)</span>&nbsp;<span class="ident" id="4478362">Public</span><span class="op" id="4478368">(</span><span class="op" id="4478369">)</span>&nbsp;<span class="ident" id="4478371">crypto</span><span class="op" id="4478377">.</span><span class="ident" id="4478378">PublicKey</span>&nbsp;<span class="op" id="4478388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4478391">return</span>&nbsp;<span class="op" id="4478398">&amp;</span><span class="ident" id="4478399">priv</span><span class="op" id="4478403">.</span><span class="ident" id="4478404">PublicKey</span><br>
<span class="lineno">65</span><span class="op" id="4478414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4478417">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;If&nbsp;opts&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4478489">//&nbsp;*PSSOptions&nbsp;then&nbsp;the&nbsp;PSS&nbsp;algorithm&nbsp;will&nbsp;be&nbsp;used,&nbsp;otherwise&nbsp;PKCS#1&nbsp;v1.5&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="4478568">//&nbsp;be&nbsp;used.&nbsp;This&nbsp;method&nbsp;is&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="4478646">//&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign*</span><br>
<span class="lineno"></span><span class="comment" id="4478723">//&nbsp;functions&nbsp;in&nbsp;this&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="4478753">func</span>&nbsp;<span class="op" id="4478758">(</span><span class="ident" id="4478759">priv</span>&nbsp;<span class="op" id="4478764">*</span><span class="ident" id="4478765">PrivateKey</span><span class="op" id="4478775">)</span>&nbsp;<span class="ident" id="4478777">Sign</span><span class="op" id="4478781">(</span><span class="ident" id="4478782">rand</span>&nbsp;<span class="ident" id="4478787">io</span><span class="op" id="4478789">.</span><span class="ident" id="4478790">Reader</span><span class="op" id="4478796">,</span>&nbsp;<span class="ident" id="4478798">msg</span>&nbsp;<span class="op" id="4478802">[</span><span class="op" id="4478803">]</span><span class="builtintype" id="4478804">byte</span><span class="op" id="4478808">,</span>&nbsp;<span class="ident" id="4478810">opts</span>&nbsp;<span class="ident" id="4478815">crypto</span><span class="op" id="4478821">.</span><span class="ident" id="4478822">SignerOpts</span><span class="op" id="4478832">)</span>&nbsp;<span class="op" id="4478834">(</span><span class="op" id="4478835">[</span><span class="op" id="4478836">]</span><span class="builtintype" id="4478837">byte</span><span class="op" id="4478841">,</span>&nbsp;<span class="builtintype" id="4478843">error</span><span class="op" id="4478848">)</span>&nbsp;<span class="op" id="4478850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4478853">if</span>&nbsp;<span class="ident" id="4478856">pssOpts</span><span class="op" id="4478863">,</span>&nbsp;<span class="ident" id="4478865">ok</span>&nbsp;<span class="op" id="4478868">:=</span>&nbsp;<span class="ident" id="4478871">opts</span><span class="op" id="4478875">.</span><span class="op" id="4478876">(</span><span class="op" id="4478877">*</span><span class="ident" id="4478878">PSSOptions</span><span class="op" id="4478888">)</span><span class="op" id="4478889">;</span>&nbsp;<span class="ident" id="4478891">ok</span>&nbsp;<span class="op" id="4478894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4478898">return</span>&nbsp;<span class="ident" id="4478905">SignPSS</span><span class="op" id="4478912">(</span><span class="ident" id="4478913">rand</span><span class="op" id="4478917">,</span>&nbsp;<span class="ident" id="4478919">priv</span><span class="op" id="4478923">,</span>&nbsp;<span class="ident" id="4478925">pssOpts</span><span class="op" id="4478932">.</span><span class="ident" id="4478933">Hash</span><span class="op" id="4478937">,</span>&nbsp;<span class="ident" id="4478939">msg</span><span class="op" id="4478942">,</span>&nbsp;<span class="ident" id="4478944">pssOpts</span><span class="op" id="4478951">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4478954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4478958">return</span>&nbsp;<span class="ident" id="4478965">SignPKCS1v15</span><span class="op" id="4478977">(</span><span class="ident" id="4478978">rand</span><span class="op" id="4478982">,</span>&nbsp;<span class="ident" id="4478984">priv</span><span class="op" id="4478988">,</span>&nbsp;<span class="ident" id="4478990">opts</span><span class="op" id="4478994">.</span><span class="ident" id="4478995">HashFunc</span><span class="op" id="4479003">(</span><span class="op" id="4479004">)</span><span class="op" id="4479005">,</span>&nbsp;<span class="ident" id="4479007">msg</span><span class="op" id="4479010">)</span><br>
<span class="lineno"></span><span class="op" id="4479012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4479015">type</span>&nbsp;<span class="ident" id="4479020">PrecomputedValues</span>&nbsp;<span class="keyword" id="4479038">struct</span>&nbsp;<span class="op" id="4479045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4479048">Dp</span><span class="op" id="4479050">,</span>&nbsp;<span class="ident" id="4479052">Dq</span>&nbsp;<span class="op" id="4479055">*</span><span class="ident" id="4479056">big</span><span class="op" id="4479059">.</span><span class="ident" id="4479060">Int</span>&nbsp;<span class="comment" id="4479064">//&nbsp;D&nbsp;mod&nbsp;(P-1)&nbsp;(or&nbsp;mod&nbsp;Q-1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4479093">Qinv</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4479100">*</span><span class="ident" id="4479101">big</span><span class="op" id="4479104">.</span><span class="ident" id="4479105">Int</span>&nbsp;<span class="comment" id="4479109">//&nbsp;Q^-1&nbsp;mod&nbsp;P</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4479125">//&nbsp;CRTValues&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;3rd&nbsp;and&nbsp;subsequent&nbsp;primes.&nbsp;Due&nbsp;to&nbsp;a</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4479191">//&nbsp;historical&nbsp;accident,&nbsp;the&nbsp;CRT&nbsp;for&nbsp;the&nbsp;first&nbsp;two&nbsp;primes&nbsp;is&nbsp;handled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4479260">//&nbsp;differently&nbsp;in&nbsp;PKCS#1&nbsp;and&nbsp;interoperability&nbsp;is&nbsp;sufficiently</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4479323">//&nbsp;important&nbsp;that&nbsp;we&nbsp;mirror&nbsp;this.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4479358">CRTValues</span>&nbsp;<span class="op" id="4479368">[</span><span class="op" id="4479369">]</span><span class="ident" id="4479370">CRTValue</span><br>
<span class="lineno"></span><span class="op" id="4479379">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="4479382">//&nbsp;CRTValue&nbsp;contains&nbsp;the&nbsp;precomputed&nbsp;chinese&nbsp;remainder&nbsp;theorem&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4479453">type</span>&nbsp;<span class="ident" id="4479458">CRTValue</span>&nbsp;<span class="keyword" id="4479467">struct</span>&nbsp;<span class="op" id="4479474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4479477">Exp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4479483">*</span><span class="ident" id="4479484">big</span><span class="op" id="4479487">.</span><span class="ident" id="4479488">Int</span>&nbsp;<span class="comment" id="4479492">//&nbsp;D&nbsp;mod&nbsp;(prime-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4479513">Coeff</span>&nbsp;<span class="op" id="4479519">*</span><span class="ident" id="4479520">big</span><span class="op" id="4479523">.</span><span class="ident" id="4479524">Int</span>&nbsp;<span class="comment" id="4479528">//&nbsp;R·Coeff&nbsp;≡&nbsp;1&nbsp;mod&nbsp;Prime.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4479558">R</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4479564">*</span><span class="ident" id="4479565">big</span><span class="op" id="4479568">.</span><span class="ident" id="4479569">Int</span>&nbsp;<span class="comment" id="4479573">//&nbsp;product&nbsp;of&nbsp;primes&nbsp;prior&nbsp;to&nbsp;this&nbsp;(inc&nbsp;p&nbsp;and&nbsp;q).</span><br>
<span class="lineno"></span><span class="op" id="4479623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4479626">//&nbsp;Validate&nbsp;performs&nbsp;basic&nbsp;sanity&nbsp;checks&nbsp;on&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="4479679">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;the&nbsp;key&nbsp;is&nbsp;valid,&nbsp;or&nbsp;else&nbsp;an&nbsp;error&nbsp;describing&nbsp;a&nbsp;problem.</span><br>
<span class="lineno">100</span><span class="keyword" id="4479757">func</span>&nbsp;<span class="op" id="4479762">(</span><span class="ident" id="4479763">priv</span>&nbsp;<span class="op" id="4479768">*</span><span class="ident" id="4479769">PrivateKey</span><span class="op" id="4479779">)</span>&nbsp;<span class="ident" id="4479781">Validate</span><span class="op" id="4479789">(</span><span class="op" id="4479790">)</span>&nbsp;<span class="builtintype" id="4479792">error</span>&nbsp;<span class="op" id="4479798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4479801">if</span>&nbsp;<span class="ident" id="4479804">err</span>&nbsp;<span class="op" id="4479808">:=</span>&nbsp;<span class="ident" id="4479811">checkPub</span><span class="op" id="4479819">(</span><span class="op" id="4479820">&amp;</span><span class="ident" id="4479821">priv</span><span class="op" id="4479825">.</span><span class="ident" id="4479826">PublicKey</span><span class="op" id="4479835">)</span><span class="op" id="4479836">;</span>&nbsp;<span class="ident" id="4479838">err</span>&nbsp;<span class="op" id="4479842">!=</span>&nbsp;<span class="builtintype" id="4479845">nil</span>&nbsp;<span class="op" id="4479849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4479853">return</span>&nbsp;<span class="ident" id="4479860">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4479865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4479869">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;prime&nbsp;factors&nbsp;are&nbsp;actually&nbsp;prime.&nbsp;Note&nbsp;that&nbsp;this&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4479940">//&nbsp;just&nbsp;a&nbsp;sanity&nbsp;check.&nbsp;Since&nbsp;the&nbsp;random&nbsp;witnesses&nbsp;chosen&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4480002">//&nbsp;ProbablyPrime&nbsp;are&nbsp;deterministic,&nbsp;given&nbsp;the&nbsp;candidate&nbsp;number,&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4480072">//&nbsp;easy&nbsp;for&nbsp;an&nbsp;attack&nbsp;to&nbsp;generate&nbsp;composites&nbsp;that&nbsp;pass&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4480139">for</span>&nbsp;<span class="ident" id="4480143">_</span><span class="op" id="4480144">,</span>&nbsp;<span class="ident" id="4480146">prime</span>&nbsp;<span class="op" id="4480152">:=</span>&nbsp;<span class="keyword" id="4480155">range</span>&nbsp;<span class="ident" id="4480161">priv</span><span class="op" id="4480165">.</span><span class="ident" id="4480166">Primes</span>&nbsp;<span class="op" id="4480173">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4480177">if</span>&nbsp;<span class="op" id="4480180">!</span><span class="ident" id="4480181">prime</span><span class="op" id="4480186">.</span><span class="ident" id="4480187">ProbablyPrime</span><span class="op" id="4480200">(</span><span class="num" id="4480201">20</span><span class="op" id="4480203">)</span>&nbsp;<span class="op" id="4480205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4480210">return</span>&nbsp;<span class="ident" id="4480217">errors</span><span class="op" id="4480223">.</span><span class="ident" id="4480224">New</span><span class="op" id="4480227">(</span><span class="string" id="4480228">&#34;crypto/rsa:&nbsp;prime&nbsp;factor&nbsp;is&nbsp;composite&#34;</span><span class="op" id="4480267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4480271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4480274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4480278">//&nbsp;Check&nbsp;that&nbsp;Πprimes&nbsp;==&nbsp;n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4480308">modulus</span>&nbsp;<span class="op" id="4480316">:=</span>&nbsp;<span class="builtinfunc" id="4480319">new</span><span class="op" id="4480322">(</span><span class="ident" id="4480323">big</span><span class="op" id="4480326">.</span><span class="ident" id="4480327">Int</span><span class="op" id="4480330">)</span><span class="op" id="4480331">.</span><span class="ident" id="4480332">Set</span><span class="op" id="4480335">(</span><span class="ident" id="4480336">bigOne</span><span class="op" id="4480342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4480345">for</span>&nbsp;<span class="ident" id="4480349">_</span><span class="op" id="4480350">,</span>&nbsp;<span class="ident" id="4480352">prime</span>&nbsp;<span class="op" id="4480358">:=</span>&nbsp;<span class="keyword" id="4480361">range</span>&nbsp;<span class="ident" id="4480367">priv</span><span class="op" id="4480371">.</span><span class="ident" id="4480372">Primes</span>&nbsp;<span class="op" id="4480379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4480383">modulus</span><span class="op" id="4480390">.</span><span class="ident" id="4480391">Mul</span><span class="op" id="4480394">(</span><span class="ident" id="4480395">modulus</span><span class="op" id="4480402">,</span>&nbsp;<span class="ident" id="4480404">prime</span><span class="op" id="4480409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4480412">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4480415">if</span>&nbsp;<span class="ident" id="4480418">modulus</span><span class="op" id="4480425">.</span><span class="ident" id="4480426">Cmp</span><span class="op" id="4480429">(</span><span class="ident" id="4480430">priv</span><span class="op" id="4480434">.</span><span class="ident" id="4480435">N</span><span class="op" id="4480436">)</span>&nbsp;<span class="op" id="4480438">!=</span>&nbsp;<span class="num" id="4480441">0</span>&nbsp;<span class="op" id="4480443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4480447">return</span>&nbsp;<span class="ident" id="4480454">errors</span><span class="op" id="4480460">.</span><span class="ident" id="4480461">New</span><span class="op" id="4480464">(</span><span class="string" id="4480465">&#34;crypto/rsa:&nbsp;invalid&nbsp;modulus&#34;</span><span class="op" id="4480494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4480497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4480501">//&nbsp;Check&nbsp;that&nbsp;de&nbsp;≡&nbsp;1&nbsp;mod&nbsp;p-1,&nbsp;for&nbsp;each&nbsp;prime.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4480550">//&nbsp;This&nbsp;implies&nbsp;that&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;each&nbsp;p-1&nbsp;as&nbsp;e&nbsp;has&nbsp;a&nbsp;multiplicative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4480623">//&nbsp;inverse.&nbsp;Therefore&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;lcm(p-1,q-1,r-1,...)&nbsp;=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4480685">//&nbsp;exponent(ℤ/nℤ).&nbsp;It&nbsp;also&nbsp;implies&nbsp;that&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;p&nbsp;as&nbsp;a^(p-1)&nbsp;≡&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4480764">//&nbsp;mod&nbsp;p.&nbsp;Thus&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;n&nbsp;for&nbsp;all&nbsp;a&nbsp;coprime&nbsp;to&nbsp;n,&nbsp;as&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4480834">congruence</span>&nbsp;<span class="op" id="4480845">:=</span>&nbsp;<span class="builtinfunc" id="4480848">new</span><span class="op" id="4480851">(</span><span class="ident" id="4480852">big</span><span class="op" id="4480855">.</span><span class="ident" id="4480856">Int</span><span class="op" id="4480859">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4480862">de</span>&nbsp;<span class="op" id="4480865">:=</span>&nbsp;<span class="builtinfunc" id="4480868">new</span><span class="op" id="4480871">(</span><span class="ident" id="4480872">big</span><span class="op" id="4480875">.</span><span class="ident" id="4480876">Int</span><span class="op" id="4480879">)</span><span class="op" id="4480880">.</span><span class="ident" id="4480881">SetInt64</span><span class="op" id="4480889">(</span><span class="builtintype" id="4480890">int64</span><span class="op" id="4480895">(</span><span class="ident" id="4480896">priv</span><span class="op" id="4480900">.</span><span class="ident" id="4480901">E</span><span class="op" id="4480902">)</span><span class="op" id="4480903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4480906">de</span><span class="op" id="4480908">.</span><span class="ident" id="4480909">Mul</span><span class="op" id="4480912">(</span><span class="ident" id="4480913">de</span><span class="op" id="4480915">,</span>&nbsp;<span class="ident" id="4480917">priv</span><span class="op" id="4480921">.</span><span class="ident" id="4480922">D</span><span class="op" id="4480923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4480926">for</span>&nbsp;<span class="ident" id="4480930">_</span><span class="op" id="4480931">,</span>&nbsp;<span class="ident" id="4480933">prime</span>&nbsp;<span class="op" id="4480939">:=</span>&nbsp;<span class="keyword" id="4480942">range</span>&nbsp;<span class="ident" id="4480948">priv</span><span class="op" id="4480952">.</span><span class="ident" id="4480953">Primes</span>&nbsp;<span class="op" id="4480960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4480964">pminus1</span>&nbsp;<span class="op" id="4480972">:=</span>&nbsp;<span class="builtinfunc" id="4480975">new</span><span class="op" id="4480978">(</span><span class="ident" id="4480979">big</span><span class="op" id="4480982">.</span><span class="ident" id="4480983">Int</span><span class="op" id="4480986">)</span><span class="op" id="4480987">.</span><span class="ident" id="4480988">Sub</span><span class="op" id="4480991">(</span><span class="ident" id="4480992">prime</span><span class="op" id="4480997">,</span>&nbsp;<span class="ident" id="4480999">bigOne</span><span class="op" id="4481005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4481009">congruence</span><span class="op" id="4481019">.</span><span class="ident" id="4481020">Mod</span><span class="op" id="4481023">(</span><span class="ident" id="4481024">de</span><span class="op" id="4481026">,</span>&nbsp;<span class="ident" id="4481028">pminus1</span><span class="op" id="4481035">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4481039">if</span>&nbsp;<span class="ident" id="4481042">congruence</span><span class="op" id="4481052">.</span><span class="ident" id="4481053">Cmp</span><span class="op" id="4481056">(</span><span class="ident" id="4481057">bigOne</span><span class="op" id="4481063">)</span>&nbsp;<span class="op" id="4481065">!=</span>&nbsp;<span class="num" id="4481068">0</span>&nbsp;<span class="op" id="4481070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4481075">return</span>&nbsp;<span class="ident" id="4481082">errors</span><span class="op" id="4481088">.</span><span class="ident" id="4481089">New</span><span class="op" id="4481092">(</span><span class="string" id="4481093">&#34;crypto/rsa:&nbsp;invalid&nbsp;exponents&#34;</span><span class="op" id="4481124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4481128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4481131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4481134">return</span>&nbsp;<span class="builtintype" id="4481141">nil</span><br>
<span class="lineno">140</span><span class="op" id="4481145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4481148">//&nbsp;GenerateKey&nbsp;generates&nbsp;an&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit&nbsp;size&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4481220">//&nbsp;random&nbsp;source&nbsp;random&nbsp;(for&nbsp;example,&nbsp;crypto/rand.Reader).</span><br>
<span class="lineno"></span><span class="keyword" id="4481279">func</span>&nbsp;<span class="ident" id="4481284">GenerateKey</span><span class="op" id="4481295">(</span><span class="ident" id="4481296">random</span>&nbsp;<span class="ident" id="4481303">io</span><span class="op" id="4481305">.</span><span class="ident" id="4481306">Reader</span><span class="op" id="4481312">,</span>&nbsp;<span class="ident" id="4481314">bits</span>&nbsp;<span class="builtintype" id="4481319">int</span><span class="op" id="4481322">)</span>&nbsp;<span class="op" id="4481324">(</span><span class="ident" id="4481325">priv</span>&nbsp;<span class="op" id="4481330">*</span><span class="ident" id="4481331">PrivateKey</span><span class="op" id="4481341">,</span>&nbsp;<span class="ident" id="4481343">err</span>&nbsp;<span class="builtintype" id="4481347">error</span><span class="op" id="4481352">)</span>&nbsp;<span class="op" id="4481354">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4481357">return</span>&nbsp;<span class="ident" id="4481364">GenerateMultiPrimeKey</span><span class="op" id="4481385">(</span><span class="ident" id="4481386">random</span><span class="op" id="4481392">,</span>&nbsp;<span class="num" id="4481394">2</span><span class="op" id="4481395">,</span>&nbsp;<span class="ident" id="4481397">bits</span><span class="op" id="4481401">)</span><br>
<span class="lineno"></span><span class="op" id="4481403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4481406">//&nbsp;GenerateMultiPrimeKey&nbsp;generates&nbsp;a&nbsp;multi-prime&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="4481484">//&nbsp;size&nbsp;and&nbsp;the&nbsp;given&nbsp;random&nbsp;source,&nbsp;as&nbsp;suggested&nbsp;in&nbsp;[1].&nbsp;Although&nbsp;the&nbsp;public</span><br>
<span class="lineno">150</span><span class="comment" id="4481562">//&nbsp;keys&nbsp;are&nbsp;compatible&nbsp;(actually,&nbsp;indistinguishable)&nbsp;from&nbsp;the&nbsp;2-prime&nbsp;case,</span><br>
<span class="lineno"></span><span class="comment" id="4481638">//&nbsp;the&nbsp;private&nbsp;keys&nbsp;are&nbsp;not.&nbsp;Thus&nbsp;it&nbsp;may&nbsp;not&nbsp;be&nbsp;possible&nbsp;to&nbsp;export&nbsp;multi-prime</span><br>
<span class="lineno"></span><span class="comment" id="4481717">//&nbsp;private&nbsp;keys&nbsp;in&nbsp;certain&nbsp;formats&nbsp;or&nbsp;to&nbsp;subsequently&nbsp;import&nbsp;them&nbsp;into&nbsp;other</span><br>
<span class="lineno"></span><span class="comment" id="4481794">//&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4481803">//</span><br>
<span class="lineno">155</span><span class="comment" id="4481806">//&nbsp;Table&nbsp;1&nbsp;in&nbsp;[2]&nbsp;suggests&nbsp;maximum&nbsp;numbers&nbsp;of&nbsp;primes&nbsp;for&nbsp;a&nbsp;given&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="4481877">//</span><br>
<span class="lineno"></span><span class="comment" id="4481880">//&nbsp;[1]&nbsp;US&nbsp;patent&nbsp;4405829&nbsp;(1972,&nbsp;expired)</span><br>
<span class="lineno"></span><span class="comment" id="4481921">//&nbsp;[2]&nbsp;http://www.cacr.math.uwaterloo.ca/techreports/2006/cacr2006-16.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="4481995">func</span>&nbsp;<span class="ident" id="4482000">GenerateMultiPrimeKey</span><span class="op" id="4482021">(</span><span class="ident" id="4482022">random</span>&nbsp;<span class="ident" id="4482029">io</span><span class="op" id="4482031">.</span><span class="ident" id="4482032">Reader</span><span class="op" id="4482038">,</span>&nbsp;<span class="ident" id="4482040">nprimes</span>&nbsp;<span class="builtintype" id="4482048">int</span><span class="op" id="4482051">,</span>&nbsp;<span class="ident" id="4482053">bits</span>&nbsp;<span class="builtintype" id="4482058">int</span><span class="op" id="4482061">)</span>&nbsp;<span class="op" id="4482063">(</span><span class="ident" id="4482064">priv</span>&nbsp;<span class="op" id="4482069">*</span><span class="ident" id="4482070">PrivateKey</span><span class="op" id="4482080">,</span>&nbsp;<span class="ident" id="4482082">err</span>&nbsp;<span class="builtintype" id="4482086">error</span><span class="op" id="4482091">)</span>&nbsp;<span class="op" id="4482093">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4482096">priv</span>&nbsp;<span class="op" id="4482101">=</span>&nbsp;<span class="builtinfunc" id="4482103">new</span><span class="op" id="4482106">(</span><span class="ident" id="4482107">PrivateKey</span><span class="op" id="4482117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4482120">priv</span><span class="op" id="4482124">.</span><span class="ident" id="4482125">E</span>&nbsp;<span class="op" id="4482127">=</span>&nbsp;<span class="num" id="4482129">65537</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482137">if</span>&nbsp;<span class="ident" id="4482140">nprimes</span>&nbsp;<span class="op" id="4482148">&lt;</span>&nbsp;<span class="num" id="4482150">2</span>&nbsp;<span class="op" id="4482152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482156">return</span>&nbsp;<span class="builtintype" id="4482163">nil</span><span class="op" id="4482166">,</span>&nbsp;<span class="ident" id="4482168">errors</span><span class="op" id="4482174">.</span><span class="ident" id="4482175">New</span><span class="op" id="4482178">(</span><span class="string" id="4482179">&#34;crypto/rsa:&nbsp;GenerateMultiPrimeKey:&nbsp;nprimes&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&#34;</span><span class="op" id="4482236">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4482239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4482243">primes</span>&nbsp;<span class="op" id="4482250">:=</span>&nbsp;<span class="builtinfunc" id="4482253">make</span><span class="op" id="4482257">(</span><span class="op" id="4482258">[</span><span class="op" id="4482259">]</span><span class="op" id="4482260">*</span><span class="ident" id="4482261">big</span><span class="op" id="4482264">.</span><span class="ident" id="4482265">Int</span><span class="op" id="4482268">,</span>&nbsp;<span class="ident" id="4482270">nprimes</span><span class="op" id="4482277">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4482280">NextSetOfPrimes</span><span class="op" id="4482295">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482298">for</span>&nbsp;<span class="op" id="4482302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4482306">todo</span>&nbsp;<span class="op" id="4482311">:=</span>&nbsp;<span class="ident" id="4482314">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4482321">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4482381">//&nbsp;Thus&nbsp;each&nbsp;prime&nbsp;has&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4482415">//&nbsp;&nbsp;&nbsp;p_i&nbsp;=&nbsp;2^bitlen(p_i)&nbsp;×&nbsp;0.11...&nbsp;(in&nbsp;base&nbsp;2).</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4482466">//&nbsp;And&nbsp;the&nbsp;product&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4482491">//&nbsp;&nbsp;&nbsp;P&nbsp;=&nbsp;2^todo&nbsp;×&nbsp;α</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4482515">//&nbsp;where&nbsp;α&nbsp;is&nbsp;the&nbsp;product&nbsp;of&nbsp;nprimes&nbsp;numbers&nbsp;of&nbsp;the&nbsp;form&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4482583">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4482588">//&nbsp;If&nbsp;α&nbsp;&lt;&nbsp;1/2&nbsp;(which&nbsp;can&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;&gt;&nbsp;2),&nbsp;we&nbsp;need&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4482652">//&nbsp;shift&nbsp;todo&nbsp;to&nbsp;compensate&nbsp;for&nbsp;lost&nbsp;bits:&nbsp;the&nbsp;mean&nbsp;value&nbsp;of&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4482723">//&nbsp;is&nbsp;7/8,&nbsp;so&nbsp;todo&nbsp;+&nbsp;shift&nbsp;-&nbsp;nprimes&nbsp;*&nbsp;log2(7/8)&nbsp;~=&nbsp;bits&nbsp;-&nbsp;1/2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4482788">//&nbsp;will&nbsp;give&nbsp;good&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482817">if</span>&nbsp;<span class="ident" id="4482820">nprimes</span>&nbsp;<span class="op" id="4482828">&gt;=</span>&nbsp;<span class="num" id="4482831">7</span>&nbsp;<span class="op" id="4482833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4482838">todo</span>&nbsp;<span class="op" id="4482843">+=</span>&nbsp;<span class="op" id="4482846">(</span><span class="ident" id="4482847">nprimes</span>&nbsp;<span class="op" id="4482855">-</span>&nbsp;<span class="num" id="4482857">2</span><span class="op" id="4482858">)</span>&nbsp;<span class="op" id="4482860">/</span>&nbsp;<span class="num" id="4482862">5</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4482866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482870">for</span>&nbsp;<span class="ident" id="4482874">i</span>&nbsp;<span class="op" id="4482876">:=</span>&nbsp;<span class="num" id="4482879">0</span><span class="op" id="4482880">;</span>&nbsp;<span class="ident" id="4482882">i</span>&nbsp;<span class="op" id="4482884">&lt;</span>&nbsp;<span class="ident" id="4482886">nprimes</span><span class="op" id="4482893">;</span>&nbsp;<span class="ident" id="4482895">i</span><span class="op" id="4482896">++</span>&nbsp;<span class="op" id="4482899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4482904">primes</span><span class="op" id="4482910">[</span><span class="ident" id="4482911">i</span><span class="op" id="4482912">]</span><span class="op" id="4482913">,</span>&nbsp;<span class="ident" id="4482915">err</span>&nbsp;<span class="op" id="4482919">=</span>&nbsp;<span class="ident" id="4482921">rand</span><span class="op" id="4482925">.</span><span class="ident" id="4482926">Prime</span><span class="op" id="4482931">(</span><span class="ident" id="4482932">random</span><span class="op" id="4482938">,</span>&nbsp;<span class="ident" id="4482940">todo</span><span class="op" id="4482944">/</span><span class="op" id="4482945">(</span><span class="ident" id="4482946">nprimes</span><span class="op" id="4482953">-</span><span class="ident" id="4482954">i</span><span class="op" id="4482955">)</span><span class="op" id="4482956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482961">if</span>&nbsp;<span class="ident" id="4482964">err</span>&nbsp;<span class="op" id="4482968">!=</span>&nbsp;<span class="builtintype" id="4482971">nil</span>&nbsp;<span class="op" id="4482975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4482981">return</span>&nbsp;<span class="builtintype" id="4482988">nil</span><span class="op" id="4482991">,</span>&nbsp;<span class="ident" id="4482993">err</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4483000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483005">todo</span>&nbsp;<span class="op" id="4483010">-=</span>&nbsp;<span class="ident" id="4483013">primes</span><span class="op" id="4483019">[</span><span class="ident" id="4483020">i</span><span class="op" id="4483021">]</span><span class="op" id="4483022">.</span><span class="ident" id="4483023">BitLen</span><span class="op" id="4483029">(</span><span class="op" id="4483030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4483034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4483039">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;primes&nbsp;is&nbsp;pairwise&nbsp;unequal.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483087">for</span>&nbsp;<span class="ident" id="4483091">i</span><span class="op" id="4483092">,</span>&nbsp;<span class="ident" id="4483094">prime</span>&nbsp;<span class="op" id="4483100">:=</span>&nbsp;<span class="keyword" id="4483103">range</span>&nbsp;<span class="ident" id="4483109">primes</span>&nbsp;<span class="op" id="4483116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483121">for</span>&nbsp;<span class="ident" id="4483125">j</span>&nbsp;<span class="op" id="4483127">:=</span>&nbsp;<span class="num" id="4483130">0</span><span class="op" id="4483131">;</span>&nbsp;<span class="ident" id="4483133">j</span>&nbsp;<span class="op" id="4483135">&lt;</span>&nbsp;<span class="ident" id="4483137">i</span><span class="op" id="4483138">;</span>&nbsp;<span class="ident" id="4483140">j</span><span class="op" id="4483141">++</span>&nbsp;<span class="op" id="4483144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483150">if</span>&nbsp;<span class="ident" id="4483153">prime</span><span class="op" id="4483158">.</span><span class="ident" id="4483159">Cmp</span><span class="op" id="4483162">(</span><span class="ident" id="4483163">primes</span><span class="op" id="4483169">[</span><span class="ident" id="4483170">j</span><span class="op" id="4483171">]</span><span class="op" id="4483172">)</span>&nbsp;<span class="op" id="4483174">==</span>&nbsp;<span class="num" id="4483177">0</span>&nbsp;<span class="op" id="4483179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483186">continue</span>&nbsp;<span class="ident" id="4483195">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4483215">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4483220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4483224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483229">n</span>&nbsp;<span class="op" id="4483231">:=</span>&nbsp;<span class="builtinfunc" id="4483234">new</span><span class="op" id="4483237">(</span><span class="ident" id="4483238">big</span><span class="op" id="4483241">.</span><span class="ident" id="4483242">Int</span><span class="op" id="4483245">)</span><span class="op" id="4483246">.</span><span class="ident" id="4483247">Set</span><span class="op" id="4483250">(</span><span class="ident" id="4483251">bigOne</span><span class="op" id="4483257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483261">totient</span>&nbsp;<span class="op" id="4483269">:=</span>&nbsp;<span class="builtinfunc" id="4483272">new</span><span class="op" id="4483275">(</span><span class="ident" id="4483276">big</span><span class="op" id="4483279">.</span><span class="ident" id="4483280">Int</span><span class="op" id="4483283">)</span><span class="op" id="4483284">.</span><span class="ident" id="4483285">Set</span><span class="op" id="4483288">(</span><span class="ident" id="4483289">bigOne</span><span class="op" id="4483295">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483299">pminus1</span>&nbsp;<span class="op" id="4483307">:=</span>&nbsp;<span class="builtinfunc" id="4483310">new</span><span class="op" id="4483313">(</span><span class="ident" id="4483314">big</span><span class="op" id="4483317">.</span><span class="ident" id="4483318">Int</span><span class="op" id="4483321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483325">for</span>&nbsp;<span class="ident" id="4483329">_</span><span class="op" id="4483330">,</span>&nbsp;<span class="ident" id="4483332">prime</span>&nbsp;<span class="op" id="4483338">:=</span>&nbsp;<span class="keyword" id="4483341">range</span>&nbsp;<span class="ident" id="4483347">primes</span>&nbsp;<span class="op" id="4483354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483359">n</span><span class="op" id="4483360">.</span><span class="ident" id="4483361">Mul</span><span class="op" id="4483364">(</span><span class="ident" id="4483365">n</span><span class="op" id="4483366">,</span>&nbsp;<span class="ident" id="4483368">prime</span><span class="op" id="4483373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483378">pminus1</span><span class="op" id="4483385">.</span><span class="ident" id="4483386">Sub</span><span class="op" id="4483389">(</span><span class="ident" id="4483390">prime</span><span class="op" id="4483395">,</span>&nbsp;<span class="ident" id="4483397">bigOne</span><span class="op" id="4483403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483408">totient</span><span class="op" id="4483415">.</span><span class="ident" id="4483416">Mul</span><span class="op" id="4483419">(</span><span class="ident" id="4483420">totient</span><span class="op" id="4483427">,</span>&nbsp;<span class="ident" id="4483429">pminus1</span><span class="op" id="4483436">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4483440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483444">if</span>&nbsp;<span class="ident" id="4483447">n</span><span class="op" id="4483448">.</span><span class="ident" id="4483449">BitLen</span><span class="op" id="4483455">(</span><span class="op" id="4483456">)</span>&nbsp;<span class="op" id="4483458">!=</span>&nbsp;<span class="ident" id="4483461">bits</span>&nbsp;<span class="op" id="4483466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4483471">//&nbsp;This&nbsp;should&nbsp;never&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;==&nbsp;2&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4483527">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4483588">//&nbsp;For&nbsp;nprimes&nbsp;&gt;&nbsp;2&nbsp;we&nbsp;hope&nbsp;it&nbsp;does&nbsp;not&nbsp;happen&nbsp;often.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483644">continue</span>&nbsp;<span class="ident" id="4483653">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4483671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483676">g</span>&nbsp;<span class="op" id="4483678">:=</span>&nbsp;<span class="builtinfunc" id="4483681">new</span><span class="op" id="4483684">(</span><span class="ident" id="4483685">big</span><span class="op" id="4483688">.</span><span class="ident" id="4483689">Int</span><span class="op" id="4483692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483696">priv</span><span class="op" id="4483700">.</span><span class="ident" id="4483701">D</span>&nbsp;<span class="op" id="4483703">=</span>&nbsp;<span class="builtinfunc" id="4483705">new</span><span class="op" id="4483708">(</span><span class="ident" id="4483709">big</span><span class="op" id="4483712">.</span><span class="ident" id="4483713">Int</span><span class="op" id="4483716">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483720">y</span>&nbsp;<span class="op" id="4483722">:=</span>&nbsp;<span class="builtinfunc" id="4483725">new</span><span class="op" id="4483728">(</span><span class="ident" id="4483729">big</span><span class="op" id="4483732">.</span><span class="ident" id="4483733">Int</span><span class="op" id="4483736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483740">e</span>&nbsp;<span class="op" id="4483742">:=</span>&nbsp;<span class="ident" id="4483745">big</span><span class="op" id="4483748">.</span><span class="ident" id="4483749">NewInt</span><span class="op" id="4483755">(</span><span class="builtintype" id="4483756">int64</span><span class="op" id="4483761">(</span><span class="ident" id="4483762">priv</span><span class="op" id="4483766">.</span><span class="ident" id="4483767">E</span><span class="op" id="4483768">)</span><span class="op" id="4483769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483773">g</span><span class="op" id="4483774">.</span><span class="ident" id="4483775">GCD</span><span class="op" id="4483778">(</span><span class="ident" id="4483779">priv</span><span class="op" id="4483783">.</span><span class="ident" id="4483784">D</span><span class="op" id="4483785">,</span>&nbsp;<span class="ident" id="4483787">y</span><span class="op" id="4483788">,</span>&nbsp;<span class="ident" id="4483790">e</span><span class="op" id="4483791">,</span>&nbsp;<span class="ident" id="4483793">totient</span><span class="op" id="4483800">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483805">if</span>&nbsp;<span class="ident" id="4483808">g</span><span class="op" id="4483809">.</span><span class="ident" id="4483810">Cmp</span><span class="op" id="4483813">(</span><span class="ident" id="4483814">bigOne</span><span class="op" id="4483820">)</span>&nbsp;<span class="op" id="4483822">==</span>&nbsp;<span class="num" id="4483825">0</span>&nbsp;<span class="op" id="4483827">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483832">if</span>&nbsp;<span class="ident" id="4483835">priv</span><span class="op" id="4483839">.</span><span class="ident" id="4483840">D</span><span class="op" id="4483841">.</span><span class="ident" id="4483842">Sign</span><span class="op" id="4483846">(</span><span class="op" id="4483847">)</span>&nbsp;<span class="op" id="4483849">&lt;</span>&nbsp;<span class="num" id="4483851">0</span>&nbsp;<span class="op" id="4483853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483859">priv</span><span class="op" id="4483863">.</span><span class="ident" id="4483864">D</span><span class="op" id="4483865">.</span><span class="ident" id="4483866">Add</span><span class="op" id="4483869">(</span><span class="ident" id="4483870">priv</span><span class="op" id="4483874">.</span><span class="ident" id="4483875">D</span><span class="op" id="4483876">,</span>&nbsp;<span class="ident" id="4483878">totient</span><span class="op" id="4483885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4483890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483895">priv</span><span class="op" id="4483899">.</span><span class="ident" id="4483900">Primes</span>&nbsp;<span class="op" id="4483907">=</span>&nbsp;<span class="ident" id="4483909">primes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483919">priv</span><span class="op" id="4483923">.</span><span class="ident" id="4483924">N</span>&nbsp;<span class="op" id="4483926">=</span>&nbsp;<span class="ident" id="4483928">n</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483934">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4483942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4483945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4483949">priv</span><span class="op" id="4483953">.</span><span class="ident" id="4483954">Precompute</span><span class="op" id="4483964">(</span><span class="op" id="4483965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4483968">return</span><br>
<span class="lineno"></span><span class="op" id="4483975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4483978">//&nbsp;incCounter&nbsp;increments&nbsp;a&nbsp;four&nbsp;byte,&nbsp;big-endian&nbsp;counter.</span><br>
<span class="lineno">240</span><span class="keyword" id="4484036">func</span>&nbsp;<span class="ident" id="4484041">incCounter</span><span class="op" id="4484051">(</span><span class="ident" id="4484052">c</span>&nbsp;<span class="op" id="4484054">*</span><span class="op" id="4484055">[</span><span class="num" id="4484056">4</span><span class="op" id="4484057">]</span><span class="builtintype" id="4484058">byte</span><span class="op" id="4484062">)</span>&nbsp;<span class="op" id="4484064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484067">if</span>&nbsp;<span class="ident" id="4484070">c</span><span class="op" id="4484071">[</span><span class="num" id="4484072">3</span><span class="op" id="4484073">]</span><span class="op" id="4484074">++</span><span class="op" id="4484076">;</span>&nbsp;<span class="ident" id="4484078">c</span><span class="op" id="4484079">[</span><span class="num" id="4484080">3</span><span class="op" id="4484081">]</span>&nbsp;<span class="op" id="4484083">!=</span>&nbsp;<span class="num" id="4484086">0</span>&nbsp;<span class="op" id="4484088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484092">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4484100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484103">if</span>&nbsp;<span class="ident" id="4484106">c</span><span class="op" id="4484107">[</span><span class="num" id="4484108">2</span><span class="op" id="4484109">]</span><span class="op" id="4484110">++</span><span class="op" id="4484112">;</span>&nbsp;<span class="ident" id="4484114">c</span><span class="op" id="4484115">[</span><span class="num" id="4484116">2</span><span class="op" id="4484117">]</span>&nbsp;<span class="op" id="4484119">!=</span>&nbsp;<span class="num" id="4484122">0</span>&nbsp;<span class="op" id="4484124">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484128">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4484136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484139">if</span>&nbsp;<span class="ident" id="4484142">c</span><span class="op" id="4484143">[</span><span class="num" id="4484144">1</span><span class="op" id="4484145">]</span><span class="op" id="4484146">++</span><span class="op" id="4484148">;</span>&nbsp;<span class="ident" id="4484150">c</span><span class="op" id="4484151">[</span><span class="num" id="4484152">1</span><span class="op" id="4484153">]</span>&nbsp;<span class="op" id="4484155">!=</span>&nbsp;<span class="num" id="4484158">0</span>&nbsp;<span class="op" id="4484160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484164">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4484172">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484175">c</span><span class="op" id="4484176">[</span><span class="num" id="4484177">0</span><span class="op" id="4484178">]</span><span class="op" id="4484179">++</span><br>
<span class="lineno"></span><span class="op" id="4484182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4484185">//&nbsp;mgf1XOR&nbsp;XORs&nbsp;the&nbsp;bytes&nbsp;in&nbsp;out&nbsp;with&nbsp;a&nbsp;mask&nbsp;generated&nbsp;using&nbsp;the&nbsp;MGF1&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4484264">//&nbsp;specified&nbsp;in&nbsp;PKCS#1&nbsp;v2.1.</span><br>
<span class="lineno">255</span><span class="keyword" id="4484293">func</span>&nbsp;<span class="ident" id="4484298">mgf1XOR</span><span class="op" id="4484305">(</span><span class="ident" id="4484306">out</span>&nbsp;<span class="op" id="4484310">[</span><span class="op" id="4484311">]</span><span class="builtintype" id="4484312">byte</span><span class="op" id="4484316">,</span>&nbsp;<span class="ident" id="4484318">hash</span>&nbsp;<span class="ident" id="4484323">hash</span><span class="op" id="4484327">.</span><span class="ident" id="4484328">Hash</span><span class="op" id="4484332">,</span>&nbsp;<span class="ident" id="4484334">seed</span>&nbsp;<span class="op" id="4484339">[</span><span class="op" id="4484340">]</span><span class="builtintype" id="4484341">byte</span><span class="op" id="4484345">)</span>&nbsp;<span class="op" id="4484347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484350">var</span>&nbsp;<span class="ident" id="4484354">counter</span>&nbsp;<span class="op" id="4484362">[</span><span class="num" id="4484363">4</span><span class="op" id="4484364">]</span><span class="builtintype" id="4484365">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484371">var</span>&nbsp;<span class="ident" id="4484375">digest</span>&nbsp;<span class="op" id="4484382">[</span><span class="op" id="4484383">]</span><span class="builtintype" id="4484384">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484391">done</span>&nbsp;<span class="op" id="4484396">:=</span>&nbsp;<span class="num" id="4484399">0</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484402">for</span>&nbsp;<span class="ident" id="4484406">done</span>&nbsp;<span class="op" id="4484411">&lt;</span>&nbsp;<span class="builtinfunc" id="4484413">len</span><span class="op" id="4484416">(</span><span class="ident" id="4484417">out</span><span class="op" id="4484420">)</span>&nbsp;<span class="op" id="4484422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484426">hash</span><span class="op" id="4484430">.</span><span class="ident" id="4484431">Write</span><span class="op" id="4484436">(</span><span class="ident" id="4484437">seed</span><span class="op" id="4484441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484445">hash</span><span class="op" id="4484449">.</span><span class="ident" id="4484450">Write</span><span class="op" id="4484455">(</span><span class="ident" id="4484456">counter</span><span class="op" id="4484463">[</span><span class="num" id="4484464">0</span><span class="op" id="4484465">:</span><span class="num" id="4484466">4</span><span class="op" id="4484467">]</span><span class="op" id="4484468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484472">digest</span>&nbsp;<span class="op" id="4484479">=</span>&nbsp;<span class="ident" id="4484481">hash</span><span class="op" id="4484485">.</span><span class="ident" id="4484486">Sum</span><span class="op" id="4484489">(</span><span class="ident" id="4484490">digest</span><span class="op" id="4484496">[</span><span class="op" id="4484497">:</span><span class="num" id="4484498">0</span><span class="op" id="4484499">]</span><span class="op" id="4484500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484504">hash</span><span class="op" id="4484508">.</span><span class="ident" id="4484509">Reset</span><span class="op" id="4484514">(</span><span class="op" id="4484515">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484520">for</span>&nbsp;<span class="ident" id="4484524">i</span>&nbsp;<span class="op" id="4484526">:=</span>&nbsp;<span class="num" id="4484529">0</span><span class="op" id="4484530">;</span>&nbsp;<span class="ident" id="4484532">i</span>&nbsp;<span class="op" id="4484534">&lt;</span>&nbsp;<span class="builtinfunc" id="4484536">len</span><span class="op" id="4484539">(</span><span class="ident" id="4484540">digest</span><span class="op" id="4484546">)</span>&nbsp;<span class="op" id="4484548">&amp;&amp;</span>&nbsp;<span class="ident" id="4484551">done</span>&nbsp;<span class="op" id="4484556">&lt;</span>&nbsp;<span class="builtinfunc" id="4484558">len</span><span class="op" id="4484561">(</span><span class="ident" id="4484562">out</span><span class="op" id="4484565">)</span><span class="op" id="4484566">;</span>&nbsp;<span class="ident" id="4484568">i</span><span class="op" id="4484569">++</span>&nbsp;<span class="op" id="4484572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484577">out</span><span class="op" id="4484580">[</span><span class="ident" id="4484581">done</span><span class="op" id="4484585">]</span>&nbsp;<span class="op" id="4484587">^=</span>&nbsp;<span class="ident" id="4484590">digest</span><span class="op" id="4484596">[</span><span class="ident" id="4484597">i</span><span class="op" id="4484598">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484603">done</span><span class="op" id="4484607">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4484612">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484616">incCounter</span><span class="op" id="4484626">(</span><span class="op" id="4484627">&amp;</span><span class="ident" id="4484628">counter</span><span class="op" id="4484635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4484638">}</span><br>
<span class="lineno"></span><span class="op" id="4484640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4484643">//&nbsp;ErrMessageTooLong&nbsp;is&nbsp;returned&nbsp;when&nbsp;attempting&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;message&nbsp;which&nbsp;is</span><br>
<span class="lineno">275</span><span class="comment" id="4484722">//&nbsp;too&nbsp;large&nbsp;for&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4484767">var</span>&nbsp;<span class="ident" id="4484771">ErrMessageTooLong</span>&nbsp;<span class="op" id="4484789">=</span>&nbsp;<span class="ident" id="4484791">errors</span><span class="op" id="4484797">.</span><span class="ident" id="4484798">New</span><span class="op" id="4484801">(</span><span class="string" id="4484802">&#34;crypto/rsa:&nbsp;message&nbsp;too&nbsp;long&nbsp;for&nbsp;RSA&nbsp;public&nbsp;key&nbsp;size&#34;</span><span class="op" id="4484856">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4484859">func</span>&nbsp;<span class="ident" id="4484864">encrypt</span><span class="op" id="4484871">(</span><span class="ident" id="4484872">c</span>&nbsp;<span class="op" id="4484874">*</span><span class="ident" id="4484875">big</span><span class="op" id="4484878">.</span><span class="ident" id="4484879">Int</span><span class="op" id="4484882">,</span>&nbsp;<span class="ident" id="4484884">pub</span>&nbsp;<span class="op" id="4484888">*</span><span class="ident" id="4484889">PublicKey</span><span class="op" id="4484898">,</span>&nbsp;<span class="ident" id="4484900">m</span>&nbsp;<span class="op" id="4484902">*</span><span class="ident" id="4484903">big</span><span class="op" id="4484906">.</span><span class="ident" id="4484907">Int</span><span class="op" id="4484910">)</span>&nbsp;<span class="op" id="4484912">*</span><span class="ident" id="4484913">big</span><span class="op" id="4484916">.</span><span class="ident" id="4484917">Int</span>&nbsp;<span class="op" id="4484921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484924">e</span>&nbsp;<span class="op" id="4484926">:=</span>&nbsp;<span class="ident" id="4484929">big</span><span class="op" id="4484932">.</span><span class="ident" id="4484933">NewInt</span><span class="op" id="4484939">(</span><span class="builtintype" id="4484940">int64</span><span class="op" id="4484945">(</span><span class="ident" id="4484946">pub</span><span class="op" id="4484949">.</span><span class="ident" id="4484950">E</span><span class="op" id="4484951">)</span><span class="op" id="4484952">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4484955">c</span><span class="op" id="4484956">.</span><span class="ident" id="4484957">Exp</span><span class="op" id="4484960">(</span><span class="ident" id="4484961">m</span><span class="op" id="4484962">,</span>&nbsp;<span class="ident" id="4484964">e</span><span class="op" id="4484965">,</span>&nbsp;<span class="ident" id="4484967">pub</span><span class="op" id="4484970">.</span><span class="ident" id="4484971">N</span><span class="op" id="4484972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4484975">return</span>&nbsp;<span class="ident" id="4484982">c</span><br>
<span class="lineno"></span><span class="op" id="4484984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4484987">//&nbsp;EncryptOAEP&nbsp;encrypts&nbsp;the&nbsp;given&nbsp;message&nbsp;with&nbsp;RSA-OAEP.</span><br>
<span class="lineno">285</span><span class="comment" id="4485044">//&nbsp;The&nbsp;message&nbsp;must&nbsp;be&nbsp;no&nbsp;longer&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;public&nbsp;modulus&nbsp;less</span><br>
<span class="lineno"></span><span class="comment" id="4485120">//&nbsp;twice&nbsp;the&nbsp;hash&nbsp;length&nbsp;plus&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="4485153">func</span>&nbsp;<span class="ident" id="4485158">EncryptOAEP</span><span class="op" id="4485169">(</span><span class="ident" id="4485170">hash</span>&nbsp;<span class="ident" id="4485175">hash</span><span class="op" id="4485179">.</span><span class="ident" id="4485180">Hash</span><span class="op" id="4485184">,</span>&nbsp;<span class="ident" id="4485186">random</span>&nbsp;<span class="ident" id="4485193">io</span><span class="op" id="4485195">.</span><span class="ident" id="4485196">Reader</span><span class="op" id="4485202">,</span>&nbsp;<span class="ident" id="4485204">pub</span>&nbsp;<span class="op" id="4485208">*</span><span class="ident" id="4485209">PublicKey</span><span class="op" id="4485218">,</span>&nbsp;<span class="ident" id="4485220">msg</span>&nbsp;<span class="op" id="4485224">[</span><span class="op" id="4485225">]</span><span class="builtintype" id="4485226">byte</span><span class="op" id="4485230">,</span>&nbsp;<span class="ident" id="4485232">label</span>&nbsp;<span class="op" id="4485238">[</span><span class="op" id="4485239">]</span><span class="builtintype" id="4485240">byte</span><span class="op" id="4485244">)</span>&nbsp;<span class="op" id="4485246">(</span><span class="ident" id="4485247">out</span>&nbsp;<span class="op" id="4485251">[</span><span class="op" id="4485252">]</span><span class="builtintype" id="4485253">byte</span><span class="op" id="4485257">,</span>&nbsp;<span class="ident" id="4485259">err</span>&nbsp;<span class="builtintype" id="4485263">error</span><span class="op" id="4485268">)</span>&nbsp;<span class="op" id="4485270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4485273">if</span>&nbsp;<span class="ident" id="4485276">err</span>&nbsp;<span class="op" id="4485280">:=</span>&nbsp;<span class="ident" id="4485283">checkPub</span><span class="op" id="4485291">(</span><span class="ident" id="4485292">pub</span><span class="op" id="4485295">)</span><span class="op" id="4485296">;</span>&nbsp;<span class="ident" id="4485298">err</span>&nbsp;<span class="op" id="4485302">!=</span>&nbsp;<span class="builtintype" id="4485305">nil</span>&nbsp;<span class="op" id="4485309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4485313">return</span>&nbsp;<span class="builtintype" id="4485320">nil</span><span class="op" id="4485323">,</span>&nbsp;<span class="ident" id="4485325">err</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4485330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485333">hash</span><span class="op" id="4485337">.</span><span class="ident" id="4485338">Reset</span><span class="op" id="4485343">(</span><span class="op" id="4485344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485347">k</span>&nbsp;<span class="op" id="4485349">:=</span>&nbsp;<span class="op" id="4485352">(</span><span class="ident" id="4485353">pub</span><span class="op" id="4485356">.</span><span class="ident" id="4485357">N</span><span class="op" id="4485358">.</span><span class="ident" id="4485359">BitLen</span><span class="op" id="4485365">(</span><span class="op" id="4485366">)</span>&nbsp;<span class="op" id="4485368">+</span>&nbsp;<span class="num" id="4485370">7</span><span class="op" id="4485371">)</span>&nbsp;<span class="op" id="4485373">/</span>&nbsp;<span class="num" id="4485375">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4485378">if</span>&nbsp;<span class="builtinfunc" id="4485381">len</span><span class="op" id="4485384">(</span><span class="ident" id="4485385">msg</span><span class="op" id="4485388">)</span>&nbsp;<span class="op" id="4485390">&gt;</span>&nbsp;<span class="ident" id="4485392">k</span><span class="op" id="4485393">-</span><span class="num" id="4485394">2</span><span class="op" id="4485395">*</span><span class="ident" id="4485396">hash</span><span class="op" id="4485400">.</span><span class="ident" id="4485401">Size</span><span class="op" id="4485405">(</span><span class="op" id="4485406">)</span><span class="op" id="4485407">-</span><span class="num" id="4485408">2</span>&nbsp;<span class="op" id="4485410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485414">err</span>&nbsp;<span class="op" id="4485418">=</span>&nbsp;<span class="ident" id="4485420">ErrMessageTooLong</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4485440">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4485448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485452">hash</span><span class="op" id="4485456">.</span><span class="ident" id="4485457">Write</span><span class="op" id="4485462">(</span><span class="ident" id="4485463">label</span><span class="op" id="4485468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485471">lHash</span>&nbsp;<span class="op" id="4485477">:=</span>&nbsp;<span class="ident" id="4485480">hash</span><span class="op" id="4485484">.</span><span class="ident" id="4485485">Sum</span><span class="op" id="4485488">(</span><span class="builtintype" id="4485489">nil</span><span class="op" id="4485492">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485495">hash</span><span class="op" id="4485499">.</span><span class="ident" id="4485500">Reset</span><span class="op" id="4485505">(</span><span class="op" id="4485506">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485510">em</span>&nbsp;<span class="op" id="4485513">:=</span>&nbsp;<span class="builtinfunc" id="4485516">make</span><span class="op" id="4485520">(</span><span class="op" id="4485521">[</span><span class="op" id="4485522">]</span><span class="builtintype" id="4485523">byte</span><span class="op" id="4485527">,</span>&nbsp;<span class="ident" id="4485529">k</span><span class="op" id="4485530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485533">seed</span>&nbsp;<span class="op" id="4485538">:=</span>&nbsp;<span class="ident" id="4485541">em</span><span class="op" id="4485543">[</span><span class="num" id="4485544">1</span>&nbsp;<span class="op" id="4485546">:</span>&nbsp;<span class="num" id="4485548">1</span><span class="op" id="4485549">+</span><span class="ident" id="4485550">hash</span><span class="op" id="4485554">.</span><span class="ident" id="4485555">Size</span><span class="op" id="4485559">(</span><span class="op" id="4485560">)</span><span class="op" id="4485561">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485564">db</span>&nbsp;<span class="op" id="4485567">:=</span>&nbsp;<span class="ident" id="4485570">em</span><span class="op" id="4485572">[</span><span class="num" id="4485573">1</span><span class="op" id="4485574">+</span><span class="ident" id="4485575">hash</span><span class="op" id="4485579">.</span><span class="ident" id="4485580">Size</span><span class="op" id="4485584">(</span><span class="op" id="4485585">)</span><span class="op" id="4485586">:</span><span class="op" id="4485587">]</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4485591">copy</span><span class="op" id="4485595">(</span><span class="ident" id="4485596">db</span><span class="op" id="4485598">[</span><span class="num" id="4485599">0</span><span class="op" id="4485600">:</span><span class="ident" id="4485601">hash</span><span class="op" id="4485605">.</span><span class="ident" id="4485606">Size</span><span class="op" id="4485610">(</span><span class="op" id="4485611">)</span><span class="op" id="4485612">]</span><span class="op" id="4485613">,</span>&nbsp;<span class="ident" id="4485615">lHash</span><span class="op" id="4485620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485623">db</span><span class="op" id="4485625">[</span><span class="builtinfunc" id="4485626">len</span><span class="op" id="4485629">(</span><span class="ident" id="4485630">db</span><span class="op" id="4485632">)</span><span class="op" id="4485633">-</span><span class="builtinfunc" id="4485634">len</span><span class="op" id="4485637">(</span><span class="ident" id="4485638">msg</span><span class="op" id="4485641">)</span><span class="op" id="4485642">-</span><span class="num" id="4485643">1</span><span class="op" id="4485644">]</span>&nbsp;<span class="op" id="4485646">=</span>&nbsp;<span class="num" id="4485648">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4485651">copy</span><span class="op" id="4485655">(</span><span class="ident" id="4485656">db</span><span class="op" id="4485658">[</span><span class="builtinfunc" id="4485659">len</span><span class="op" id="4485662">(</span><span class="ident" id="4485663">db</span><span class="op" id="4485665">)</span><span class="op" id="4485666">-</span><span class="builtinfunc" id="4485667">len</span><span class="op" id="4485670">(</span><span class="ident" id="4485671">msg</span><span class="op" id="4485674">)</span><span class="op" id="4485675">:</span><span class="op" id="4485676">]</span><span class="op" id="4485677">,</span>&nbsp;<span class="ident" id="4485679">msg</span><span class="op" id="4485682">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485686">_</span><span class="op" id="4485687">,</span>&nbsp;<span class="ident" id="4485689">err</span>&nbsp;<span class="op" id="4485693">=</span>&nbsp;<span class="ident" id="4485695">io</span><span class="op" id="4485697">.</span><span class="ident" id="4485698">ReadFull</span><span class="op" id="4485706">(</span><span class="ident" id="4485707">random</span><span class="op" id="4485713">,</span>&nbsp;<span class="ident" id="4485715">seed</span><span class="op" id="4485719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4485722">if</span>&nbsp;<span class="ident" id="4485725">err</span>&nbsp;<span class="op" id="4485729">!=</span>&nbsp;<span class="builtintype" id="4485732">nil</span>&nbsp;<span class="op" id="4485736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4485740">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4485748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485752">mgf1XOR</span><span class="op" id="4485759">(</span><span class="ident" id="4485760">db</span><span class="op" id="4485762">,</span>&nbsp;<span class="ident" id="4485764">hash</span><span class="op" id="4485768">,</span>&nbsp;<span class="ident" id="4485770">seed</span><span class="op" id="4485774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485777">mgf1XOR</span><span class="op" id="4485784">(</span><span class="ident" id="4485785">seed</span><span class="op" id="4485789">,</span>&nbsp;<span class="ident" id="4485791">hash</span><span class="op" id="4485795">,</span>&nbsp;<span class="ident" id="4485797">db</span><span class="op" id="4485799">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485803">m</span>&nbsp;<span class="op" id="4485805">:=</span>&nbsp;<span class="builtinfunc" id="4485808">new</span><span class="op" id="4485811">(</span><span class="ident" id="4485812">big</span><span class="op" id="4485815">.</span><span class="ident" id="4485816">Int</span><span class="op" id="4485819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485822">m</span><span class="op" id="4485823">.</span><span class="ident" id="4485824">SetBytes</span><span class="op" id="4485832">(</span><span class="ident" id="4485833">em</span><span class="op" id="4485835">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485838">c</span>&nbsp;<span class="op" id="4485840">:=</span>&nbsp;<span class="ident" id="4485843">encrypt</span><span class="op" id="4485850">(</span><span class="builtinfunc" id="4485851">new</span><span class="op" id="4485854">(</span><span class="ident" id="4485855">big</span><span class="op" id="4485858">.</span><span class="ident" id="4485859">Int</span><span class="op" id="4485862">)</span><span class="op" id="4485863">,</span>&nbsp;<span class="ident" id="4485865">pub</span><span class="op" id="4485868">,</span>&nbsp;<span class="ident" id="4485870">m</span><span class="op" id="4485871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485874">out</span>&nbsp;<span class="op" id="4485878">=</span>&nbsp;<span class="ident" id="4485880">c</span><span class="op" id="4485881">.</span><span class="ident" id="4485882">Bytes</span><span class="op" id="4485887">(</span><span class="op" id="4485888">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4485892">if</span>&nbsp;<span class="builtinfunc" id="4485895">len</span><span class="op" id="4485898">(</span><span class="ident" id="4485899">out</span><span class="op" id="4485902">)</span>&nbsp;<span class="op" id="4485904">&lt;</span>&nbsp;<span class="ident" id="4485906">k</span>&nbsp;<span class="op" id="4485908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4485912">//&nbsp;If&nbsp;the&nbsp;output&nbsp;is&nbsp;too&nbsp;small,&nbsp;we&nbsp;need&nbsp;to&nbsp;left-pad&nbsp;with&nbsp;zeros.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485977">t</span>&nbsp;<span class="op" id="4485979">:=</span>&nbsp;<span class="builtinfunc" id="4485982">make</span><span class="op" id="4485986">(</span><span class="op" id="4485987">[</span><span class="op" id="4485988">]</span><span class="builtintype" id="4485989">byte</span><span class="op" id="4485993">,</span>&nbsp;<span class="ident" id="4485995">k</span><span class="op" id="4485996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4486000">copy</span><span class="op" id="4486004">(</span><span class="ident" id="4486005">t</span><span class="op" id="4486006">[</span><span class="ident" id="4486007">k</span><span class="op" id="4486008">-</span><span class="builtinfunc" id="4486009">len</span><span class="op" id="4486012">(</span><span class="ident" id="4486013">out</span><span class="op" id="4486016">)</span><span class="op" id="4486017">:</span><span class="op" id="4486018">]</span><span class="op" id="4486019">,</span>&nbsp;<span class="ident" id="4486021">out</span><span class="op" id="4486024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4486028">out</span>&nbsp;<span class="op" id="4486032">=</span>&nbsp;<span class="ident" id="4486034">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4486037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4486041">return</span><br>
<span class="lineno"></span><span class="op" id="4486048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4486051">//&nbsp;ErrDecryption&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;decrypt&nbsp;a&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="4486111">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno">335</span><span class="keyword" id="4486166">var</span>&nbsp;<span class="ident" id="4486170">ErrDecryption</span>&nbsp;<span class="op" id="4486184">=</span>&nbsp;<span class="ident" id="4486186">errors</span><span class="op" id="4486192">.</span><span class="ident" id="4486193">New</span><span class="op" id="4486196">(</span><span class="string" id="4486197">&#34;crypto/rsa:&nbsp;decryption&nbsp;error&#34;</span><span class="op" id="4486227">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4486230">//&nbsp;ErrVerification&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;verify&nbsp;a&nbsp;signature.</span><br>
<span class="lineno"></span><span class="comment" id="4486293">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4486348">var</span>&nbsp;<span class="ident" id="4486352">ErrVerification</span>&nbsp;<span class="op" id="4486368">=</span>&nbsp;<span class="ident" id="4486370">errors</span><span class="op" id="4486376">.</span><span class="ident" id="4486377">New</span><span class="op" id="4486380">(</span><span class="string" id="4486381">&#34;crypto/rsa:&nbsp;verification&nbsp;error&#34;</span><span class="op" id="4486413">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="comment" id="4486416">//&nbsp;modInverse&nbsp;returns&nbsp;ia,&nbsp;the&nbsp;inverse&nbsp;of&nbsp;a&nbsp;in&nbsp;the&nbsp;multiplicative&nbsp;group&nbsp;of&nbsp;prime</span><br>
<span class="lineno"></span><span class="comment" id="4486496">//&nbsp;order&nbsp;n.&nbsp;It&nbsp;requires&nbsp;that&nbsp;a&nbsp;be&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;group&nbsp;(i.e.&nbsp;less&nbsp;than&nbsp;n).</span><br>
<span class="lineno"></span><span class="keyword" id="4486572">func</span>&nbsp;<span class="ident" id="4486577">modInverse</span><span class="op" id="4486587">(</span><span class="ident" id="4486588">a</span><span class="op" id="4486589">,</span>&nbsp;<span class="ident" id="4486591">n</span>&nbsp;<span class="op" id="4486593">*</span><span class="ident" id="4486594">big</span><span class="op" id="4486597">.</span><span class="ident" id="4486598">Int</span><span class="op" id="4486601">)</span>&nbsp;<span class="op" id="4486603">(</span><span class="ident" id="4486604">ia</span>&nbsp;<span class="op" id="4486607">*</span><span class="ident" id="4486608">big</span><span class="op" id="4486611">.</span><span class="ident" id="4486612">Int</span><span class="op" id="4486615">,</span>&nbsp;<span class="ident" id="4486617">ok</span>&nbsp;<span class="builtintype" id="4486620">bool</span><span class="op" id="4486624">)</span>&nbsp;<span class="op" id="4486626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4486629">g</span>&nbsp;<span class="op" id="4486631">:=</span>&nbsp;<span class="builtinfunc" id="4486634">new</span><span class="op" id="4486637">(</span><span class="ident" id="4486638">big</span><span class="op" id="4486641">.</span><span class="ident" id="4486642">Int</span><span class="op" id="4486645">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4486648">x</span>&nbsp;<span class="op" id="4486650">:=</span>&nbsp;<span class="builtinfunc" id="4486653">new</span><span class="op" id="4486656">(</span><span class="ident" id="4486657">big</span><span class="op" id="4486660">.</span><span class="ident" id="4486661">Int</span><span class="op" id="4486664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4486667">y</span>&nbsp;<span class="op" id="4486669">:=</span>&nbsp;<span class="builtinfunc" id="4486672">new</span><span class="op" id="4486675">(</span><span class="ident" id="4486676">big</span><span class="op" id="4486679">.</span><span class="ident" id="4486680">Int</span><span class="op" id="4486683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4486686">g</span><span class="op" id="4486687">.</span><span class="ident" id="4486688">GCD</span><span class="op" id="4486691">(</span><span class="ident" id="4486692">x</span><span class="op" id="4486693">,</span>&nbsp;<span class="ident" id="4486695">y</span><span class="op" id="4486696">,</span>&nbsp;<span class="ident" id="4486698">a</span><span class="op" id="4486699">,</span>&nbsp;<span class="ident" id="4486701">n</span><span class="op" id="4486702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4486705">if</span>&nbsp;<span class="ident" id="4486708">g</span><span class="op" id="4486709">.</span><span class="ident" id="4486710">Cmp</span><span class="op" id="4486713">(</span><span class="ident" id="4486714">bigOne</span><span class="op" id="4486720">)</span>&nbsp;<span class="op" id="4486722">!=</span>&nbsp;<span class="num" id="4486725">0</span>&nbsp;<span class="op" id="4486727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4486731">//&nbsp;In&nbsp;this&nbsp;case,&nbsp;a&nbsp;and&nbsp;n&nbsp;aren&#39;t&nbsp;coprime&nbsp;and&nbsp;we&nbsp;cannot&nbsp;calculate</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4486797">//&nbsp;the&nbsp;inverse.&nbsp;This&nbsp;happens&nbsp;because&nbsp;the&nbsp;values&nbsp;of&nbsp;n&nbsp;are&nbsp;nearly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4486863">//&nbsp;prime&nbsp;(being&nbsp;the&nbsp;product&nbsp;of&nbsp;two&nbsp;primes)&nbsp;rather&nbsp;than&nbsp;truly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4486926">//&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4486938">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4486946">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4486950">if</span>&nbsp;<span class="ident" id="4486953">x</span><span class="op" id="4486954">.</span><span class="ident" id="4486955">Cmp</span><span class="op" id="4486958">(</span><span class="ident" id="4486959">bigOne</span><span class="op" id="4486965">)</span>&nbsp;<span class="op" id="4486967">&lt;</span>&nbsp;<span class="num" id="4486969">0</span>&nbsp;<span class="op" id="4486971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4486975">//&nbsp;0&nbsp;is&nbsp;not&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;any&nbsp;element&nbsp;so,&nbsp;if&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4487040">//&nbsp;&lt;&nbsp;1,&nbsp;then&nbsp;x&nbsp;is&nbsp;negative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487070">x</span><span class="op" id="4487071">.</span><span class="ident" id="4487072">Add</span><span class="op" id="4487075">(</span><span class="ident" id="4487076">x</span><span class="op" id="4487077">,</span>&nbsp;<span class="ident" id="4487079">n</span><span class="op" id="4487080">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4487083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4487087">return</span>&nbsp;<span class="ident" id="4487094">x</span><span class="op" id="4487095">,</span>&nbsp;<span class="builtintype" id="4487097">true</span><br>
<span class="lineno"></span><span class="op" id="4487102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="4487105">//&nbsp;Precompute&nbsp;performs&nbsp;some&nbsp;calculations&nbsp;that&nbsp;speed&nbsp;up&nbsp;private&nbsp;key&nbsp;operations</span><br>
<span class="lineno"></span><span class="comment" id="4487183">//&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="4487201">func</span>&nbsp;<span class="op" id="4487206">(</span><span class="ident" id="4487207">priv</span>&nbsp;<span class="op" id="4487212">*</span><span class="ident" id="4487213">PrivateKey</span><span class="op" id="4487223">)</span>&nbsp;<span class="ident" id="4487225">Precompute</span><span class="op" id="4487235">(</span><span class="op" id="4487236">)</span>&nbsp;<span class="op" id="4487238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4487241">if</span>&nbsp;<span class="ident" id="4487244">priv</span><span class="op" id="4487248">.</span><span class="ident" id="4487249">Precomputed</span><span class="op" id="4487260">.</span><span class="ident" id="4487261">Dp</span>&nbsp;<span class="op" id="4487264">!=</span>&nbsp;<span class="builtintype" id="4487267">nil</span>&nbsp;<span class="op" id="4487271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4487275">return</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4487283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487287">priv</span><span class="op" id="4487291">.</span><span class="ident" id="4487292">Precomputed</span><span class="op" id="4487303">.</span><span class="ident" id="4487304">Dp</span>&nbsp;<span class="op" id="4487307">=</span>&nbsp;<span class="builtinfunc" id="4487309">new</span><span class="op" id="4487312">(</span><span class="ident" id="4487313">big</span><span class="op" id="4487316">.</span><span class="ident" id="4487317">Int</span><span class="op" id="4487320">)</span><span class="op" id="4487321">.</span><span class="ident" id="4487322">Sub</span><span class="op" id="4487325">(</span><span class="ident" id="4487326">priv</span><span class="op" id="4487330">.</span><span class="ident" id="4487331">Primes</span><span class="op" id="4487337">[</span><span class="num" id="4487338">0</span><span class="op" id="4487339">]</span><span class="op" id="4487340">,</span>&nbsp;<span class="ident" id="4487342">bigOne</span><span class="op" id="4487348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487351">priv</span><span class="op" id="4487355">.</span><span class="ident" id="4487356">Precomputed</span><span class="op" id="4487367">.</span><span class="ident" id="4487368">Dp</span><span class="op" id="4487370">.</span><span class="ident" id="4487371">Mod</span><span class="op" id="4487374">(</span><span class="ident" id="4487375">priv</span><span class="op" id="4487379">.</span><span class="ident" id="4487380">D</span><span class="op" id="4487381">,</span>&nbsp;<span class="ident" id="4487383">priv</span><span class="op" id="4487387">.</span><span class="ident" id="4487388">Precomputed</span><span class="op" id="4487399">.</span><span class="ident" id="4487400">Dp</span><span class="op" id="4487402">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487406">priv</span><span class="op" id="4487410">.</span><span class="ident" id="4487411">Precomputed</span><span class="op" id="4487422">.</span><span class="ident" id="4487423">Dq</span>&nbsp;<span class="op" id="4487426">=</span>&nbsp;<span class="builtinfunc" id="4487428">new</span><span class="op" id="4487431">(</span><span class="ident" id="4487432">big</span><span class="op" id="4487435">.</span><span class="ident" id="4487436">Int</span><span class="op" id="4487439">)</span><span class="op" id="4487440">.</span><span class="ident" id="4487441">Sub</span><span class="op" id="4487444">(</span><span class="ident" id="4487445">priv</span><span class="op" id="4487449">.</span><span class="ident" id="4487450">Primes</span><span class="op" id="4487456">[</span><span class="num" id="4487457">1</span><span class="op" id="4487458">]</span><span class="op" id="4487459">,</span>&nbsp;<span class="ident" id="4487461">bigOne</span><span class="op" id="4487467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487470">priv</span><span class="op" id="4487474">.</span><span class="ident" id="4487475">Precomputed</span><span class="op" id="4487486">.</span><span class="ident" id="4487487">Dq</span><span class="op" id="4487489">.</span><span class="ident" id="4487490">Mod</span><span class="op" id="4487493">(</span><span class="ident" id="4487494">priv</span><span class="op" id="4487498">.</span><span class="ident" id="4487499">D</span><span class="op" id="4487500">,</span>&nbsp;<span class="ident" id="4487502">priv</span><span class="op" id="4487506">.</span><span class="ident" id="4487507">Precomputed</span><span class="op" id="4487518">.</span><span class="ident" id="4487519">Dq</span><span class="op" id="4487521">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487525">priv</span><span class="op" id="4487529">.</span><span class="ident" id="4487530">Precomputed</span><span class="op" id="4487541">.</span><span class="ident" id="4487542">Qinv</span>&nbsp;<span class="op" id="4487547">=</span>&nbsp;<span class="builtinfunc" id="4487549">new</span><span class="op" id="4487552">(</span><span class="ident" id="4487553">big</span><span class="op" id="4487556">.</span><span class="ident" id="4487557">Int</span><span class="op" id="4487560">)</span><span class="op" id="4487561">.</span><span class="ident" id="4487562">ModInverse</span><span class="op" id="4487572">(</span><span class="ident" id="4487573">priv</span><span class="op" id="4487577">.</span><span class="ident" id="4487578">Primes</span><span class="op" id="4487584">[</span><span class="num" id="4487585">1</span><span class="op" id="4487586">]</span><span class="op" id="4487587">,</span>&nbsp;<span class="ident" id="4487589">priv</span><span class="op" id="4487593">.</span><span class="ident" id="4487594">Primes</span><span class="op" id="4487600">[</span><span class="num" id="4487601">0</span><span class="op" id="4487602">]</span><span class="op" id="4487603">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487607">r</span>&nbsp;<span class="op" id="4487609">:=</span>&nbsp;<span class="builtinfunc" id="4487612">new</span><span class="op" id="4487615">(</span><span class="ident" id="4487616">big</span><span class="op" id="4487619">.</span><span class="ident" id="4487620">Int</span><span class="op" id="4487623">)</span><span class="op" id="4487624">.</span><span class="ident" id="4487625">Mul</span><span class="op" id="4487628">(</span><span class="ident" id="4487629">priv</span><span class="op" id="4487633">.</span><span class="ident" id="4487634">Primes</span><span class="op" id="4487640">[</span><span class="num" id="4487641">0</span><span class="op" id="4487642">]</span><span class="op" id="4487643">,</span>&nbsp;<span class="ident" id="4487645">priv</span><span class="op" id="4487649">.</span><span class="ident" id="4487650">Primes</span><span class="op" id="4487656">[</span><span class="num" id="4487657">1</span><span class="op" id="4487658">]</span><span class="op" id="4487659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487662">priv</span><span class="op" id="4487666">.</span><span class="ident" id="4487667">Precomputed</span><span class="op" id="4487678">.</span><span class="ident" id="4487679">CRTValues</span>&nbsp;<span class="op" id="4487689">=</span>&nbsp;<span class="builtinfunc" id="4487691">make</span><span class="op" id="4487695">(</span><span class="op" id="4487696">[</span><span class="op" id="4487697">]</span><span class="ident" id="4487698">CRTValue</span><span class="op" id="4487706">,</span>&nbsp;<span class="builtinfunc" id="4487708">len</span><span class="op" id="4487711">(</span><span class="ident" id="4487712">priv</span><span class="op" id="4487716">.</span><span class="ident" id="4487717">Primes</span><span class="op" id="4487723">)</span><span class="op" id="4487724">-</span><span class="num" id="4487725">2</span><span class="op" id="4487726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4487729">for</span>&nbsp;<span class="ident" id="4487733">i</span>&nbsp;<span class="op" id="4487735">:=</span>&nbsp;<span class="num" id="4487738">2</span><span class="op" id="4487739">;</span>&nbsp;<span class="ident" id="4487741">i</span>&nbsp;<span class="op" id="4487743">&lt;</span>&nbsp;<span class="builtinfunc" id="4487745">len</span><span class="op" id="4487748">(</span><span class="ident" id="4487749">priv</span><span class="op" id="4487753">.</span><span class="ident" id="4487754">Primes</span><span class="op" id="4487760">)</span><span class="op" id="4487761">;</span>&nbsp;<span class="ident" id="4487763">i</span><span class="op" id="4487764">++</span>&nbsp;<span class="op" id="4487767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487771">prime</span>&nbsp;<span class="op" id="4487777">:=</span>&nbsp;<span class="ident" id="4487780">priv</span><span class="op" id="4487784">.</span><span class="ident" id="4487785">Primes</span><span class="op" id="4487791">[</span><span class="ident" id="4487792">i</span><span class="op" id="4487793">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487797">values</span>&nbsp;<span class="op" id="4487804">:=</span>&nbsp;<span class="op" id="4487807">&amp;</span><span class="ident" id="4487808">priv</span><span class="op" id="4487812">.</span><span class="ident" id="4487813">Precomputed</span><span class="op" id="4487824">.</span><span class="ident" id="4487825">CRTValues</span><span class="op" id="4487834">[</span><span class="ident" id="4487835">i</span><span class="op" id="4487836">-</span><span class="num" id="4487837">2</span><span class="op" id="4487838">]</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487843">values</span><span class="op" id="4487849">.</span><span class="ident" id="4487850">Exp</span>&nbsp;<span class="op" id="4487854">=</span>&nbsp;<span class="builtinfunc" id="4487856">new</span><span class="op" id="4487859">(</span><span class="ident" id="4487860">big</span><span class="op" id="4487863">.</span><span class="ident" id="4487864">Int</span><span class="op" id="4487867">)</span><span class="op" id="4487868">.</span><span class="ident" id="4487869">Sub</span><span class="op" id="4487872">(</span><span class="ident" id="4487873">prime</span><span class="op" id="4487878">,</span>&nbsp;<span class="ident" id="4487880">bigOne</span><span class="op" id="4487886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487890">values</span><span class="op" id="4487896">.</span><span class="ident" id="4487897">Exp</span><span class="op" id="4487900">.</span><span class="ident" id="4487901">Mod</span><span class="op" id="4487904">(</span><span class="ident" id="4487905">priv</span><span class="op" id="4487909">.</span><span class="ident" id="4487910">D</span><span class="op" id="4487911">,</span>&nbsp;<span class="ident" id="4487913">values</span><span class="op" id="4487919">.</span><span class="ident" id="4487920">Exp</span><span class="op" id="4487923">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487928">values</span><span class="op" id="4487934">.</span><span class="ident" id="4487935">R</span>&nbsp;<span class="op" id="4487937">=</span>&nbsp;<span class="builtinfunc" id="4487939">new</span><span class="op" id="4487942">(</span><span class="ident" id="4487943">big</span><span class="op" id="4487946">.</span><span class="ident" id="4487947">Int</span><span class="op" id="4487950">)</span><span class="op" id="4487951">.</span><span class="ident" id="4487952">Set</span><span class="op" id="4487955">(</span><span class="ident" id="4487956">r</span><span class="op" id="4487957">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4487961">values</span><span class="op" id="4487967">.</span><span class="ident" id="4487968">Coeff</span>&nbsp;<span class="op" id="4487974">=</span>&nbsp;<span class="builtinfunc" id="4487976">new</span><span class="op" id="4487979">(</span><span class="ident" id="4487980">big</span><span class="op" id="4487983">.</span><span class="ident" id="4487984">Int</span><span class="op" id="4487987">)</span><span class="op" id="4487988">.</span><span class="ident" id="4487989">ModInverse</span><span class="op" id="4487999">(</span><span class="ident" id="4488000">r</span><span class="op" id="4488001">,</span>&nbsp;<span class="ident" id="4488003">prime</span><span class="op" id="4488008">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488013">r</span><span class="op" id="4488014">.</span><span class="ident" id="4488015">Mul</span><span class="op" id="4488018">(</span><span class="ident" id="4488019">r</span><span class="op" id="4488020">,</span>&nbsp;<span class="ident" id="4488022">prime</span><span class="op" id="4488027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4488030">}</span><br>
<span class="lineno"></span><span class="op" id="4488032">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="4488035">//&nbsp;decrypt&nbsp;performs&nbsp;an&nbsp;RSA&nbsp;decryption,&nbsp;resulting&nbsp;in&nbsp;a&nbsp;plaintext&nbsp;integer.&nbsp;If&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4488113">//&nbsp;random&nbsp;source&nbsp;is&nbsp;given,&nbsp;RSA&nbsp;blinding&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4488162">func</span>&nbsp;<span class="ident" id="4488167">decrypt</span><span class="op" id="4488174">(</span><span class="ident" id="4488175">random</span>&nbsp;<span class="ident" id="4488182">io</span><span class="op" id="4488184">.</span><span class="ident" id="4488185">Reader</span><span class="op" id="4488191">,</span>&nbsp;<span class="ident" id="4488193">priv</span>&nbsp;<span class="op" id="4488198">*</span><span class="ident" id="4488199">PrivateKey</span><span class="op" id="4488209">,</span>&nbsp;<span class="ident" id="4488211">c</span>&nbsp;<span class="op" id="4488213">*</span><span class="ident" id="4488214">big</span><span class="op" id="4488217">.</span><span class="ident" id="4488218">Int</span><span class="op" id="4488221">)</span>&nbsp;<span class="op" id="4488223">(</span><span class="ident" id="4488224">m</span>&nbsp;<span class="op" id="4488226">*</span><span class="ident" id="4488227">big</span><span class="op" id="4488230">.</span><span class="ident" id="4488231">Int</span><span class="op" id="4488234">,</span>&nbsp;<span class="ident" id="4488236">err</span>&nbsp;<span class="builtintype" id="4488240">error</span><span class="op" id="4488245">)</span>&nbsp;<span class="op" id="4488247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4488250">//&nbsp;TODO(agl):&nbsp;can&nbsp;we&nbsp;get&nbsp;away&nbsp;with&nbsp;reusing&nbsp;blinds?</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488302">if</span>&nbsp;<span class="ident" id="4488305">c</span><span class="op" id="4488306">.</span><span class="ident" id="4488307">Cmp</span><span class="op" id="4488310">(</span><span class="ident" id="4488311">priv</span><span class="op" id="4488315">.</span><span class="ident" id="4488316">N</span><span class="op" id="4488317">)</span>&nbsp;<span class="op" id="4488319">&gt;</span>&nbsp;<span class="num" id="4488321">0</span>&nbsp;<span class="op" id="4488323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488327">err</span>&nbsp;<span class="op" id="4488331">=</span>&nbsp;<span class="ident" id="4488333">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488349">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4488357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488361">var</span>&nbsp;<span class="ident" id="4488365">ir</span>&nbsp;<span class="op" id="4488368">*</span><span class="ident" id="4488369">big</span><span class="op" id="4488372">.</span><span class="ident" id="4488373">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488378">if</span>&nbsp;<span class="ident" id="4488381">random</span>&nbsp;<span class="op" id="4488388">!=</span>&nbsp;<span class="builtintype" id="4488391">nil</span>&nbsp;<span class="op" id="4488395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4488399">//&nbsp;Blinding&nbsp;enabled.&nbsp;Blinding&nbsp;involves&nbsp;multiplying&nbsp;c&nbsp;by&nbsp;r^e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4488462">//&nbsp;Then&nbsp;the&nbsp;decryption&nbsp;operation&nbsp;performs&nbsp;(m^e&nbsp;*&nbsp;r^e)^d&nbsp;mod&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4488526">//&nbsp;which&nbsp;equals&nbsp;mr&nbsp;mod&nbsp;n.&nbsp;The&nbsp;factor&nbsp;of&nbsp;r&nbsp;can&nbsp;then&nbsp;be&nbsp;removed</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4488590">//&nbsp;by&nbsp;multiplying&nbsp;by&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488647">var</span>&nbsp;<span class="ident" id="4488651">r</span>&nbsp;<span class="op" id="4488653">*</span><span class="ident" id="4488654">big</span><span class="op" id="4488657">.</span><span class="ident" id="4488658">Int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488665">for</span>&nbsp;<span class="op" id="4488669">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488674">r</span><span class="op" id="4488675">,</span>&nbsp;<span class="ident" id="4488677">err</span>&nbsp;<span class="op" id="4488681">=</span>&nbsp;<span class="ident" id="4488683">rand</span><span class="op" id="4488687">.</span><span class="ident" id="4488688">Int</span><span class="op" id="4488691">(</span><span class="ident" id="4488692">random</span><span class="op" id="4488698">,</span>&nbsp;<span class="ident" id="4488700">priv</span><span class="op" id="4488704">.</span><span class="ident" id="4488705">N</span><span class="op" id="4488706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488711">if</span>&nbsp;<span class="ident" id="4488714">err</span>&nbsp;<span class="op" id="4488718">!=</span>&nbsp;<span class="builtintype" id="4488721">nil</span>&nbsp;<span class="op" id="4488725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488731">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4488741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488746">if</span>&nbsp;<span class="ident" id="4488749">r</span><span class="op" id="4488750">.</span><span class="ident" id="4488751">Cmp</span><span class="op" id="4488754">(</span><span class="ident" id="4488755">bigZero</span><span class="op" id="4488762">)</span>&nbsp;<span class="op" id="4488764">==</span>&nbsp;<span class="num" id="4488767">0</span>&nbsp;<span class="op" id="4488769">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488775">r</span>&nbsp;<span class="op" id="4488777">=</span>&nbsp;<span class="ident" id="4488779">bigOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4488789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488794">var</span>&nbsp;<span class="ident" id="4488798">ok</span>&nbsp;<span class="builtintype" id="4488801">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488809">ir</span><span class="op" id="4488811">,</span>&nbsp;<span class="ident" id="4488813">ok</span>&nbsp;<span class="op" id="4488816">=</span>&nbsp;<span class="ident" id="4488818">modInverse</span><span class="op" id="4488828">(</span><span class="ident" id="4488829">r</span><span class="op" id="4488830">,</span>&nbsp;<span class="ident" id="4488832">priv</span><span class="op" id="4488836">.</span><span class="ident" id="4488837">N</span><span class="op" id="4488838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488843">if</span>&nbsp;<span class="ident" id="4488846">ok</span>&nbsp;<span class="op" id="4488849">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4488855">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4488864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4488868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488872">bigE</span>&nbsp;<span class="op" id="4488877">:=</span>&nbsp;<span class="ident" id="4488880">big</span><span class="op" id="4488883">.</span><span class="ident" id="4488884">NewInt</span><span class="op" id="4488890">(</span><span class="builtintype" id="4488891">int64</span><span class="op" id="4488896">(</span><span class="ident" id="4488897">priv</span><span class="op" id="4488901">.</span><span class="ident" id="4488902">E</span><span class="op" id="4488903">)</span><span class="op" id="4488904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488908">rpowe</span>&nbsp;<span class="op" id="4488914">:=</span>&nbsp;<span class="builtinfunc" id="4488917">new</span><span class="op" id="4488920">(</span><span class="ident" id="4488921">big</span><span class="op" id="4488924">.</span><span class="ident" id="4488925">Int</span><span class="op" id="4488928">)</span><span class="op" id="4488929">.</span><span class="ident" id="4488930">Exp</span><span class="op" id="4488933">(</span><span class="ident" id="4488934">r</span><span class="op" id="4488935">,</span>&nbsp;<span class="ident" id="4488937">bigE</span><span class="op" id="4488941">,</span>&nbsp;<span class="ident" id="4488943">priv</span><span class="op" id="4488947">.</span><span class="ident" id="4488948">N</span><span class="op" id="4488949">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488953">cCopy</span>&nbsp;<span class="op" id="4488959">:=</span>&nbsp;<span class="builtinfunc" id="4488962">new</span><span class="op" id="4488965">(</span><span class="ident" id="4488966">big</span><span class="op" id="4488969">.</span><span class="ident" id="4488970">Int</span><span class="op" id="4488973">)</span><span class="op" id="4488974">.</span><span class="ident" id="4488975">Set</span><span class="op" id="4488978">(</span><span class="ident" id="4488979">c</span><span class="op" id="4488980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4488984">cCopy</span><span class="op" id="4488989">.</span><span class="ident" id="4488990">Mul</span><span class="op" id="4488993">(</span><span class="ident" id="4488994">cCopy</span><span class="op" id="4488999">,</span>&nbsp;<span class="ident" id="4489001">rpowe</span><span class="op" id="4489006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489010">cCopy</span><span class="op" id="4489015">.</span><span class="ident" id="4489016">Mod</span><span class="op" id="4489019">(</span><span class="ident" id="4489020">cCopy</span><span class="op" id="4489025">,</span>&nbsp;<span class="ident" id="4489027">priv</span><span class="op" id="4489031">.</span><span class="ident" id="4489032">N</span><span class="op" id="4489033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489037">c</span>&nbsp;<span class="op" id="4489039">=</span>&nbsp;<span class="ident" id="4489041">cCopy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4489048">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489052">if</span>&nbsp;<span class="ident" id="4489055">priv</span><span class="op" id="4489059">.</span><span class="ident" id="4489060">Precomputed</span><span class="op" id="4489071">.</span><span class="ident" id="4489072">Dp</span>&nbsp;<span class="op" id="4489075">==</span>&nbsp;<span class="builtintype" id="4489078">nil</span>&nbsp;<span class="op" id="4489082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489086">m</span>&nbsp;<span class="op" id="4489088">=</span>&nbsp;<span class="builtinfunc" id="4489090">new</span><span class="op" id="4489093">(</span><span class="ident" id="4489094">big</span><span class="op" id="4489097">.</span><span class="ident" id="4489098">Int</span><span class="op" id="4489101">)</span><span class="op" id="4489102">.</span><span class="ident" id="4489103">Exp</span><span class="op" id="4489106">(</span><span class="ident" id="4489107">c</span><span class="op" id="4489108">,</span>&nbsp;<span class="ident" id="4489110">priv</span><span class="op" id="4489114">.</span><span class="ident" id="4489115">D</span><span class="op" id="4489116">,</span>&nbsp;<span class="ident" id="4489118">priv</span><span class="op" id="4489122">.</span><span class="ident" id="4489123">N</span><span class="op" id="4489124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4489127">}</span>&nbsp;<span class="keyword" id="4489129">else</span>&nbsp;<span class="op" id="4489134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4489138">//&nbsp;We&nbsp;have&nbsp;the&nbsp;precalculated&nbsp;values&nbsp;needed&nbsp;for&nbsp;the&nbsp;CRT.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489196">m</span>&nbsp;<span class="op" id="4489198">=</span>&nbsp;<span class="builtinfunc" id="4489200">new</span><span class="op" id="4489203">(</span><span class="ident" id="4489204">big</span><span class="op" id="4489207">.</span><span class="ident" id="4489208">Int</span><span class="op" id="4489211">)</span><span class="op" id="4489212">.</span><span class="ident" id="4489213">Exp</span><span class="op" id="4489216">(</span><span class="ident" id="4489217">c</span><span class="op" id="4489218">,</span>&nbsp;<span class="ident" id="4489220">priv</span><span class="op" id="4489224">.</span><span class="ident" id="4489225">Precomputed</span><span class="op" id="4489236">.</span><span class="ident" id="4489237">Dp</span><span class="op" id="4489239">,</span>&nbsp;<span class="ident" id="4489241">priv</span><span class="op" id="4489245">.</span><span class="ident" id="4489246">Primes</span><span class="op" id="4489252">[</span><span class="num" id="4489253">0</span><span class="op" id="4489254">]</span><span class="op" id="4489255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489259">m2</span>&nbsp;<span class="op" id="4489262">:=</span>&nbsp;<span class="builtinfunc" id="4489265">new</span><span class="op" id="4489268">(</span><span class="ident" id="4489269">big</span><span class="op" id="4489272">.</span><span class="ident" id="4489273">Int</span><span class="op" id="4489276">)</span><span class="op" id="4489277">.</span><span class="ident" id="4489278">Exp</span><span class="op" id="4489281">(</span><span class="ident" id="4489282">c</span><span class="op" id="4489283">,</span>&nbsp;<span class="ident" id="4489285">priv</span><span class="op" id="4489289">.</span><span class="ident" id="4489290">Precomputed</span><span class="op" id="4489301">.</span><span class="ident" id="4489302">Dq</span><span class="op" id="4489304">,</span>&nbsp;<span class="ident" id="4489306">priv</span><span class="op" id="4489310">.</span><span class="ident" id="4489311">Primes</span><span class="op" id="4489317">[</span><span class="num" id="4489318">1</span><span class="op" id="4489319">]</span><span class="op" id="4489320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489324">m</span><span class="op" id="4489325">.</span><span class="ident" id="4489326">Sub</span><span class="op" id="4489329">(</span><span class="ident" id="4489330">m</span><span class="op" id="4489331">,</span>&nbsp;<span class="ident" id="4489333">m2</span><span class="op" id="4489335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489339">if</span>&nbsp;<span class="ident" id="4489342">m</span><span class="op" id="4489343">.</span><span class="ident" id="4489344">Sign</span><span class="op" id="4489348">(</span><span class="op" id="4489349">)</span>&nbsp;<span class="op" id="4489351">&lt;</span>&nbsp;<span class="num" id="4489353">0</span>&nbsp;<span class="op" id="4489355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489360">m</span><span class="op" id="4489361">.</span><span class="ident" id="4489362">Add</span><span class="op" id="4489365">(</span><span class="ident" id="4489366">m</span><span class="op" id="4489367">,</span>&nbsp;<span class="ident" id="4489369">priv</span><span class="op" id="4489373">.</span><span class="ident" id="4489374">Primes</span><span class="op" id="4489380">[</span><span class="num" id="4489381">0</span><span class="op" id="4489382">]</span><span class="op" id="4489383">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4489387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489391">m</span><span class="op" id="4489392">.</span><span class="ident" id="4489393">Mul</span><span class="op" id="4489396">(</span><span class="ident" id="4489397">m</span><span class="op" id="4489398">,</span>&nbsp;<span class="ident" id="4489400">priv</span><span class="op" id="4489404">.</span><span class="ident" id="4489405">Precomputed</span><span class="op" id="4489416">.</span><span class="ident" id="4489417">Qinv</span><span class="op" id="4489421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489425">m</span><span class="op" id="4489426">.</span><span class="ident" id="4489427">Mod</span><span class="op" id="4489430">(</span><span class="ident" id="4489431">m</span><span class="op" id="4489432">,</span>&nbsp;<span class="ident" id="4489434">priv</span><span class="op" id="4489438">.</span><span class="ident" id="4489439">Primes</span><span class="op" id="4489445">[</span><span class="num" id="4489446">0</span><span class="op" id="4489447">]</span><span class="op" id="4489448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489452">m</span><span class="op" id="4489453">.</span><span class="ident" id="4489454">Mul</span><span class="op" id="4489457">(</span><span class="ident" id="4489458">m</span><span class="op" id="4489459">,</span>&nbsp;<span class="ident" id="4489461">priv</span><span class="op" id="4489465">.</span><span class="ident" id="4489466">Primes</span><span class="op" id="4489472">[</span><span class="num" id="4489473">1</span><span class="op" id="4489474">]</span><span class="op" id="4489475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489479">m</span><span class="op" id="4489480">.</span><span class="ident" id="4489481">Add</span><span class="op" id="4489484">(</span><span class="ident" id="4489485">m</span><span class="op" id="4489486">,</span>&nbsp;<span class="ident" id="4489488">m2</span><span class="op" id="4489490">)</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489495">for</span>&nbsp;<span class="ident" id="4489499">i</span><span class="op" id="4489500">,</span>&nbsp;<span class="ident" id="4489502">values</span>&nbsp;<span class="op" id="4489509">:=</span>&nbsp;<span class="keyword" id="4489512">range</span>&nbsp;<span class="ident" id="4489518">priv</span><span class="op" id="4489522">.</span><span class="ident" id="4489523">Precomputed</span><span class="op" id="4489534">.</span><span class="ident" id="4489535">CRTValues</span>&nbsp;<span class="op" id="4489545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489550">prime</span>&nbsp;<span class="op" id="4489556">:=</span>&nbsp;<span class="ident" id="4489559">priv</span><span class="op" id="4489563">.</span><span class="ident" id="4489564">Primes</span><span class="op" id="4489570">[</span><span class="num" id="4489571">2</span><span class="op" id="4489572">+</span><span class="ident" id="4489573">i</span><span class="op" id="4489574">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489579">m2</span><span class="op" id="4489581">.</span><span class="ident" id="4489582">Exp</span><span class="op" id="4489585">(</span><span class="ident" id="4489586">c</span><span class="op" id="4489587">,</span>&nbsp;<span class="ident" id="4489589">values</span><span class="op" id="4489595">.</span><span class="ident" id="4489596">Exp</span><span class="op" id="4489599">,</span>&nbsp;<span class="ident" id="4489601">prime</span><span class="op" id="4489606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489611">m2</span><span class="op" id="4489613">.</span><span class="ident" id="4489614">Sub</span><span class="op" id="4489617">(</span><span class="ident" id="4489618">m2</span><span class="op" id="4489620">,</span>&nbsp;<span class="ident" id="4489622">m</span><span class="op" id="4489623">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489628">m2</span><span class="op" id="4489630">.</span><span class="ident" id="4489631">Mul</span><span class="op" id="4489634">(</span><span class="ident" id="4489635">m2</span><span class="op" id="4489637">,</span>&nbsp;<span class="ident" id="4489639">values</span><span class="op" id="4489645">.</span><span class="ident" id="4489646">Coeff</span><span class="op" id="4489651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489656">m2</span><span class="op" id="4489658">.</span><span class="ident" id="4489659">Mod</span><span class="op" id="4489662">(</span><span class="ident" id="4489663">m2</span><span class="op" id="4489665">,</span>&nbsp;<span class="ident" id="4489667">prime</span><span class="op" id="4489672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489677">if</span>&nbsp;<span class="ident" id="4489680">m2</span><span class="op" id="4489682">.</span><span class="ident" id="4489683">Sign</span><span class="op" id="4489687">(</span><span class="op" id="4489688">)</span>&nbsp;<span class="op" id="4489690">&lt;</span>&nbsp;<span class="num" id="4489692">0</span>&nbsp;<span class="op" id="4489694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489700">m2</span><span class="op" id="4489702">.</span><span class="ident" id="4489703">Add</span><span class="op" id="4489706">(</span><span class="ident" id="4489707">m2</span><span class="op" id="4489709">,</span>&nbsp;<span class="ident" id="4489711">prime</span><span class="op" id="4489716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4489721">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489726">m2</span><span class="op" id="4489728">.</span><span class="ident" id="4489729">Mul</span><span class="op" id="4489732">(</span><span class="ident" id="4489733">m2</span><span class="op" id="4489735">,</span>&nbsp;<span class="ident" id="4489737">values</span><span class="op" id="4489743">.</span><span class="ident" id="4489744">R</span><span class="op" id="4489745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489750">m</span><span class="op" id="4489751">.</span><span class="ident" id="4489752">Add</span><span class="op" id="4489755">(</span><span class="ident" id="4489756">m</span><span class="op" id="4489757">,</span>&nbsp;<span class="ident" id="4489759">m2</span><span class="op" id="4489761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4489765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4489768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489772">if</span>&nbsp;<span class="ident" id="4489775">ir</span>&nbsp;<span class="op" id="4489778">!=</span>&nbsp;<span class="builtintype" id="4489781">nil</span>&nbsp;<span class="op" id="4489785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4489789">//&nbsp;Unblind.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489803">m</span><span class="op" id="4489804">.</span><span class="ident" id="4489805">Mul</span><span class="op" id="4489808">(</span><span class="ident" id="4489809">m</span><span class="op" id="4489810">,</span>&nbsp;<span class="ident" id="4489812">ir</span><span class="op" id="4489814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4489818">m</span><span class="op" id="4489819">.</span><span class="ident" id="4489820">Mod</span><span class="op" id="4489823">(</span><span class="ident" id="4489824">m</span><span class="op" id="4489825">,</span>&nbsp;<span class="ident" id="4489827">priv</span><span class="op" id="4489831">.</span><span class="ident" id="4489832">N</span><span class="op" id="4489833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4489836">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4489840">return</span><br>
<span class="lineno"></span><span class="op" id="4489847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4489850">//&nbsp;DecryptOAEP&nbsp;decrypts&nbsp;ciphertext&nbsp;using&nbsp;RSA-OAEP.</span><br>
<span class="lineno">475</span><span class="comment" id="4489901">//&nbsp;If&nbsp;random&nbsp;!=&nbsp;nil,&nbsp;DecryptOAEP&nbsp;uses&nbsp;RSA&nbsp;blinding&nbsp;to&nbsp;avoid&nbsp;timing&nbsp;side-channel&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4489990">func</span>&nbsp;<span class="ident" id="4489995">DecryptOAEP</span><span class="op" id="4490006">(</span><span class="ident" id="4490007">hash</span>&nbsp;<span class="ident" id="4490012">hash</span><span class="op" id="4490016">.</span><span class="ident" id="4490017">Hash</span><span class="op" id="4490021">,</span>&nbsp;<span class="ident" id="4490023">random</span>&nbsp;<span class="ident" id="4490030">io</span><span class="op" id="4490032">.</span><span class="ident" id="4490033">Reader</span><span class="op" id="4490039">,</span>&nbsp;<span class="ident" id="4490041">priv</span>&nbsp;<span class="op" id="4490046">*</span><span class="ident" id="4490047">PrivateKey</span><span class="op" id="4490057">,</span>&nbsp;<span class="ident" id="4490059">ciphertext</span>&nbsp;<span class="op" id="4490070">[</span><span class="op" id="4490071">]</span><span class="builtintype" id="4490072">byte</span><span class="op" id="4490076">,</span>&nbsp;<span class="ident" id="4490078">label</span>&nbsp;<span class="op" id="4490084">[</span><span class="op" id="4490085">]</span><span class="builtintype" id="4490086">byte</span><span class="op" id="4490090">)</span>&nbsp;<span class="op" id="4490092">(</span><span class="ident" id="4490093">msg</span>&nbsp;<span class="op" id="4490097">[</span><span class="op" id="4490098">]</span><span class="builtintype" id="4490099">byte</span><span class="op" id="4490103">,</span>&nbsp;<span class="ident" id="4490105">err</span>&nbsp;<span class="builtintype" id="4490109">error</span><span class="op" id="4490114">)</span>&nbsp;<span class="op" id="4490116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4490119">if</span>&nbsp;<span class="ident" id="4490122">err</span>&nbsp;<span class="op" id="4490126">:=</span>&nbsp;<span class="ident" id="4490129">checkPub</span><span class="op" id="4490137">(</span><span class="op" id="4490138">&amp;</span><span class="ident" id="4490139">priv</span><span class="op" id="4490143">.</span><span class="ident" id="4490144">PublicKey</span><span class="op" id="4490153">)</span><span class="op" id="4490154">;</span>&nbsp;<span class="ident" id="4490156">err</span>&nbsp;<span class="op" id="4490160">!=</span>&nbsp;<span class="builtintype" id="4490163">nil</span>&nbsp;<span class="op" id="4490167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4490171">return</span>&nbsp;<span class="builtintype" id="4490178">nil</span><span class="op" id="4490181">,</span>&nbsp;<span class="ident" id="4490183">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4490188">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490191">k</span>&nbsp;<span class="op" id="4490193">:=</span>&nbsp;<span class="op" id="4490196">(</span><span class="ident" id="4490197">priv</span><span class="op" id="4490201">.</span><span class="ident" id="4490202">N</span><span class="op" id="4490203">.</span><span class="ident" id="4490204">BitLen</span><span class="op" id="4490210">(</span><span class="op" id="4490211">)</span>&nbsp;<span class="op" id="4490213">+</span>&nbsp;<span class="num" id="4490215">7</span><span class="op" id="4490216">)</span>&nbsp;<span class="op" id="4490218">/</span>&nbsp;<span class="num" id="4490220">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4490223">if</span>&nbsp;<span class="builtinfunc" id="4490226">len</span><span class="op" id="4490229">(</span><span class="ident" id="4490230">ciphertext</span><span class="op" id="4490240">)</span>&nbsp;<span class="op" id="4490242">&gt;</span>&nbsp;<span class="ident" id="4490244">k</span>&nbsp;<span class="op" id="4490246">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490251">k</span>&nbsp;<span class="op" id="4490253">&lt;</span>&nbsp;<span class="ident" id="4490255">hash</span><span class="op" id="4490259">.</span><span class="ident" id="4490260">Size</span><span class="op" id="4490264">(</span><span class="op" id="4490265">)</span><span class="op" id="4490266">*</span><span class="num" id="4490267">2</span><span class="op" id="4490268">+</span><span class="num" id="4490269">2</span>&nbsp;<span class="op" id="4490271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490275">err</span>&nbsp;<span class="op" id="4490279">=</span>&nbsp;<span class="ident" id="4490281">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4490297">return</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4490305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490309">c</span>&nbsp;<span class="op" id="4490311">:=</span>&nbsp;<span class="builtinfunc" id="4490314">new</span><span class="op" id="4490317">(</span><span class="ident" id="4490318">big</span><span class="op" id="4490321">.</span><span class="ident" id="4490322">Int</span><span class="op" id="4490325">)</span><span class="op" id="4490326">.</span><span class="ident" id="4490327">SetBytes</span><span class="op" id="4490335">(</span><span class="ident" id="4490336">ciphertext</span><span class="op" id="4490346">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490350">m</span><span class="op" id="4490351">,</span>&nbsp;<span class="ident" id="4490353">err</span>&nbsp;<span class="op" id="4490357">:=</span>&nbsp;<span class="ident" id="4490360">decrypt</span><span class="op" id="4490367">(</span><span class="ident" id="4490368">random</span><span class="op" id="4490374">,</span>&nbsp;<span class="ident" id="4490376">priv</span><span class="op" id="4490380">,</span>&nbsp;<span class="ident" id="4490382">c</span><span class="op" id="4490383">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4490386">if</span>&nbsp;<span class="ident" id="4490389">err</span>&nbsp;<span class="op" id="4490393">!=</span>&nbsp;<span class="builtintype" id="4490396">nil</span>&nbsp;<span class="op" id="4490400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4490404">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4490412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490416">hash</span><span class="op" id="4490420">.</span><span class="ident" id="4490421">Write</span><span class="op" id="4490426">(</span><span class="ident" id="4490427">label</span><span class="op" id="4490432">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490435">lHash</span>&nbsp;<span class="op" id="4490441">:=</span>&nbsp;<span class="ident" id="4490444">hash</span><span class="op" id="4490448">.</span><span class="ident" id="4490449">Sum</span><span class="op" id="4490452">(</span><span class="builtintype" id="4490453">nil</span><span class="op" id="4490456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490459">hash</span><span class="op" id="4490463">.</span><span class="ident" id="4490464">Reset</span><span class="op" id="4490469">(</span><span class="op" id="4490470">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4490474">//&nbsp;Converting&nbsp;the&nbsp;plaintext&nbsp;number&nbsp;to&nbsp;bytes&nbsp;will&nbsp;strip&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4490534">//&nbsp;leading&nbsp;zeros&nbsp;so&nbsp;we&nbsp;may&nbsp;have&nbsp;to&nbsp;left&nbsp;pad.&nbsp;We&nbsp;do&nbsp;this&nbsp;unconditionally</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4490607">//&nbsp;to&nbsp;avoid&nbsp;leaking&nbsp;timing&nbsp;information.&nbsp;(Although&nbsp;we&nbsp;still&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4490676">//&nbsp;leak&nbsp;the&nbsp;number&nbsp;of&nbsp;leading&nbsp;zeros.&nbsp;It&#39;s&nbsp;not&nbsp;clear&nbsp;that&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4490744">//&nbsp;anything&nbsp;about&nbsp;this.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490770">em</span>&nbsp;<span class="op" id="4490773">:=</span>&nbsp;<span class="ident" id="4490776">leftPad</span><span class="op" id="4490783">(</span><span class="ident" id="4490784">m</span><span class="op" id="4490785">.</span><span class="ident" id="4490786">Bytes</span><span class="op" id="4490791">(</span><span class="op" id="4490792">)</span><span class="op" id="4490793">,</span>&nbsp;<span class="ident" id="4490795">k</span><span class="op" id="4490796">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490800">firstByteIsZero</span>&nbsp;<span class="op" id="4490816">:=</span>&nbsp;<span class="ident" id="4490819">subtle</span><span class="op" id="4490825">.</span><span class="ident" id="4490826">ConstantTimeByteEq</span><span class="op" id="4490844">(</span><span class="ident" id="4490845">em</span><span class="op" id="4490847">[</span><span class="num" id="4490848">0</span><span class="op" id="4490849">]</span><span class="op" id="4490850">,</span>&nbsp;<span class="num" id="4490852">0</span><span class="op" id="4490853">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490857">seed</span>&nbsp;<span class="op" id="4490862">:=</span>&nbsp;<span class="ident" id="4490865">em</span><span class="op" id="4490867">[</span><span class="num" id="4490868">1</span>&nbsp;<span class="op" id="4490870">:</span>&nbsp;<span class="ident" id="4490872">hash</span><span class="op" id="4490876">.</span><span class="ident" id="4490877">Size</span><span class="op" id="4490881">(</span><span class="op" id="4490882">)</span><span class="op" id="4490883">+</span><span class="num" id="4490884">1</span><span class="op" id="4490885">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490888">db</span>&nbsp;<span class="op" id="4490891">:=</span>&nbsp;<span class="ident" id="4490894">em</span><span class="op" id="4490896">[</span><span class="ident" id="4490897">hash</span><span class="op" id="4490901">.</span><span class="ident" id="4490902">Size</span><span class="op" id="4490906">(</span><span class="op" id="4490907">)</span><span class="op" id="4490908">+</span><span class="num" id="4490909">1</span><span class="op" id="4490910">:</span><span class="op" id="4490911">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490915">mgf1XOR</span><span class="op" id="4490922">(</span><span class="ident" id="4490923">seed</span><span class="op" id="4490927">,</span>&nbsp;<span class="ident" id="4490929">hash</span><span class="op" id="4490933">,</span>&nbsp;<span class="ident" id="4490935">db</span><span class="op" id="4490937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490940">mgf1XOR</span><span class="op" id="4490947">(</span><span class="ident" id="4490948">db</span><span class="op" id="4490950">,</span>&nbsp;<span class="ident" id="4490952">hash</span><span class="op" id="4490956">,</span>&nbsp;<span class="ident" id="4490958">seed</span><span class="op" id="4490962">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4490966">lHash2</span>&nbsp;<span class="op" id="4490973">:=</span>&nbsp;<span class="ident" id="4490976">db</span><span class="op" id="4490978">[</span><span class="num" id="4490979">0</span><span class="op" id="4490980">:</span><span class="ident" id="4490981">hash</span><span class="op" id="4490985">.</span><span class="ident" id="4490986">Size</span><span class="op" id="4490990">(</span><span class="op" id="4490991">)</span><span class="op" id="4490992">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4490996">//&nbsp;We&nbsp;have&nbsp;to&nbsp;validate&nbsp;the&nbsp;plaintext&nbsp;in&nbsp;constant&nbsp;time&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4491069">//&nbsp;attacks&nbsp;like:&nbsp;J.&nbsp;Manger.&nbsp;A&nbsp;Chosen&nbsp;Ciphertext&nbsp;Attack&nbsp;on&nbsp;RSA&nbsp;Optimal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4491140">//&nbsp;Asymmetric&nbsp;Encryption&nbsp;Padding&nbsp;(OAEP)&nbsp;as&nbsp;Standardized&nbsp;in&nbsp;PKCS&nbsp;#1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4491208">//&nbsp;v2.0.&nbsp;In&nbsp;J.&nbsp;Kilian,&nbsp;editor,&nbsp;Advances&nbsp;in&nbsp;Cryptology.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491264">lHash2Good</span>&nbsp;<span class="op" id="4491275">:=</span>&nbsp;<span class="ident" id="4491278">subtle</span><span class="op" id="4491284">.</span><span class="ident" id="4491285">ConstantTimeCompare</span><span class="op" id="4491304">(</span><span class="ident" id="4491305">lHash</span><span class="op" id="4491310">,</span>&nbsp;<span class="ident" id="4491312">lHash2</span><span class="op" id="4491318">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4491322">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;plaintext&nbsp;must&nbsp;be&nbsp;zero&nbsp;or&nbsp;more&nbsp;0x00,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4491393">//&nbsp;by&nbsp;0x01,&nbsp;followed&nbsp;by&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4491431">//&nbsp;&nbsp;&nbsp;lookingForIndex:&nbsp;1&nbsp;iff&nbsp;we&nbsp;are&nbsp;still&nbsp;looking&nbsp;for&nbsp;the&nbsp;0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4491494">//&nbsp;&nbsp;&nbsp;index:&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;0x01&nbsp;byte</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4491541">//&nbsp;&nbsp;&nbsp;invalid:&nbsp;1&nbsp;iff&nbsp;we&nbsp;saw&nbsp;a&nbsp;non-zero&nbsp;byte&nbsp;before&nbsp;the&nbsp;0x01.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491602">var</span>&nbsp;<span class="ident" id="4491606">lookingForIndex</span><span class="op" id="4491621">,</span>&nbsp;<span class="ident" id="4491623">index</span><span class="op" id="4491628">,</span>&nbsp;<span class="ident" id="4491630">invalid</span>&nbsp;<span class="builtintype" id="4491638">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491643">lookingForIndex</span>&nbsp;<span class="op" id="4491659">=</span>&nbsp;<span class="num" id="4491661">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491664">rest</span>&nbsp;<span class="op" id="4491669">:=</span>&nbsp;<span class="ident" id="4491672">db</span><span class="op" id="4491674">[</span><span class="ident" id="4491675">hash</span><span class="op" id="4491679">.</span><span class="ident" id="4491680">Size</span><span class="op" id="4491684">(</span><span class="op" id="4491685">)</span><span class="op" id="4491686">:</span><span class="op" id="4491687">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4491691">for</span>&nbsp;<span class="ident" id="4491695">i</span>&nbsp;<span class="op" id="4491697">:=</span>&nbsp;<span class="num" id="4491700">0</span><span class="op" id="4491701">;</span>&nbsp;<span class="ident" id="4491703">i</span>&nbsp;<span class="op" id="4491705">&lt;</span>&nbsp;<span class="builtinfunc" id="4491707">len</span><span class="op" id="4491710">(</span><span class="ident" id="4491711">rest</span><span class="op" id="4491715">)</span><span class="op" id="4491716">;</span>&nbsp;<span class="ident" id="4491718">i</span><span class="op" id="4491719">++</span>&nbsp;<span class="op" id="4491722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491726">equals0</span>&nbsp;<span class="op" id="4491734">:=</span>&nbsp;<span class="ident" id="4491737">subtle</span><span class="op" id="4491743">.</span><span class="ident" id="4491744">ConstantTimeByteEq</span><span class="op" id="4491762">(</span><span class="ident" id="4491763">rest</span><span class="op" id="4491767">[</span><span class="ident" id="4491768">i</span><span class="op" id="4491769">]</span><span class="op" id="4491770">,</span>&nbsp;<span class="num" id="4491772">0</span><span class="op" id="4491773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491777">equals1</span>&nbsp;<span class="op" id="4491785">:=</span>&nbsp;<span class="ident" id="4491788">subtle</span><span class="op" id="4491794">.</span><span class="ident" id="4491795">ConstantTimeByteEq</span><span class="op" id="4491813">(</span><span class="ident" id="4491814">rest</span><span class="op" id="4491818">[</span><span class="ident" id="4491819">i</span><span class="op" id="4491820">]</span><span class="op" id="4491821">,</span>&nbsp;<span class="num" id="4491823">1</span><span class="op" id="4491824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491828">index</span>&nbsp;<span class="op" id="4491834">=</span>&nbsp;<span class="ident" id="4491836">subtle</span><span class="op" id="4491842">.</span><span class="ident" id="4491843">ConstantTimeSelect</span><span class="op" id="4491861">(</span><span class="ident" id="4491862">lookingForIndex</span><span class="op" id="4491877">&amp;</span><span class="ident" id="4491878">equals1</span><span class="op" id="4491885">,</span>&nbsp;<span class="ident" id="4491887">i</span><span class="op" id="4491888">,</span>&nbsp;<span class="ident" id="4491890">index</span><span class="op" id="4491895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491899">lookingForIndex</span>&nbsp;<span class="op" id="4491915">=</span>&nbsp;<span class="ident" id="4491917">subtle</span><span class="op" id="4491923">.</span><span class="ident" id="4491924">ConstantTimeSelect</span><span class="op" id="4491942">(</span><span class="ident" id="4491943">equals1</span><span class="op" id="4491950">,</span>&nbsp;<span class="num" id="4491952">0</span><span class="op" id="4491953">,</span>&nbsp;<span class="ident" id="4491955">lookingForIndex</span><span class="op" id="4491970">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4491974">invalid</span>&nbsp;<span class="op" id="4491982">=</span>&nbsp;<span class="ident" id="4491984">subtle</span><span class="op" id="4491990">.</span><span class="ident" id="4491991">ConstantTimeSelect</span><span class="op" id="4492009">(</span><span class="ident" id="4492010">lookingForIndex</span><span class="op" id="4492025">&amp;^</span><span class="ident" id="4492027">equals0</span><span class="op" id="4492034">,</span>&nbsp;<span class="num" id="4492036">1</span><span class="op" id="4492037">,</span>&nbsp;<span class="ident" id="4492039">invalid</span><span class="op" id="4492046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4492049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492053">if</span>&nbsp;<span class="ident" id="4492056">firstByteIsZero</span><span class="op" id="4492071">&amp;</span><span class="ident" id="4492072">lHash2Good</span><span class="op" id="4492082">&amp;^</span><span class="ident" id="4492084">invalid</span><span class="op" id="4492091">&amp;^</span><span class="ident" id="4492093">lookingForIndex</span>&nbsp;<span class="op" id="4492109">!=</span>&nbsp;<span class="num" id="4492112">1</span>&nbsp;<span class="op" id="4492114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492118">err</span>&nbsp;<span class="op" id="4492122">=</span>&nbsp;<span class="ident" id="4492124">ErrDecryption</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492140">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4492148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492152">msg</span>&nbsp;<span class="op" id="4492156">=</span>&nbsp;<span class="ident" id="4492158">rest</span><span class="op" id="4492162">[</span><span class="ident" id="4492163">index</span><span class="op" id="4492168">+</span><span class="num" id="4492169">1</span><span class="op" id="4492170">:</span><span class="op" id="4492171">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492174">return</span><br>
<span class="lineno">545</span><span class="op" id="4492181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4492184">//&nbsp;leftPad&nbsp;returns&nbsp;a&nbsp;new&nbsp;slice&nbsp;of&nbsp;length&nbsp;size.&nbsp;The&nbsp;contents&nbsp;of&nbsp;input&nbsp;are&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="4492263">//&nbsp;aligned&nbsp;in&nbsp;the&nbsp;new&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="4492292">func</span>&nbsp;<span class="ident" id="4492297">leftPad</span><span class="op" id="4492304">(</span><span class="ident" id="4492305">input</span>&nbsp;<span class="op" id="4492311">[</span><span class="op" id="4492312">]</span><span class="builtintype" id="4492313">byte</span><span class="op" id="4492317">,</span>&nbsp;<span class="ident" id="4492319">size</span>&nbsp;<span class="builtintype" id="4492324">int</span><span class="op" id="4492327">)</span>&nbsp;<span class="op" id="4492329">(</span><span class="ident" id="4492330">out</span>&nbsp;<span class="op" id="4492334">[</span><span class="op" id="4492335">]</span><span class="builtintype" id="4492336">byte</span><span class="op" id="4492340">)</span>&nbsp;<span class="op" id="4492342">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492345">n</span>&nbsp;<span class="op" id="4492347">:=</span>&nbsp;<span class="builtinfunc" id="4492350">len</span><span class="op" id="4492353">(</span><span class="ident" id="4492354">input</span><span class="op" id="4492359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492362">if</span>&nbsp;<span class="ident" id="4492365">n</span>&nbsp;<span class="op" id="4492367">&gt;</span>&nbsp;<span class="ident" id="4492369">size</span>&nbsp;<span class="op" id="4492374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492378">n</span>&nbsp;<span class="op" id="4492380">=</span>&nbsp;<span class="ident" id="4492382">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4492388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4492391">out</span>&nbsp;<span class="op" id="4492395">=</span>&nbsp;<span class="builtinfunc" id="4492397">make</span><span class="op" id="4492401">(</span><span class="op" id="4492402">[</span><span class="op" id="4492403">]</span><span class="builtintype" id="4492404">byte</span><span class="op" id="4492408">,</span>&nbsp;<span class="ident" id="4492410">size</span><span class="op" id="4492414">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4492417">copy</span><span class="op" id="4492421">(</span><span class="ident" id="4492422">out</span><span class="op" id="4492425">[</span><span class="builtinfunc" id="4492426">len</span><span class="op" id="4492429">(</span><span class="ident" id="4492430">out</span><span class="op" id="4492433">)</span><span class="op" id="4492434">-</span><span class="ident" id="4492435">n</span><span class="op" id="4492436">:</span><span class="op" id="4492437">]</span><span class="op" id="4492438">,</span>&nbsp;<span class="ident" id="4492440">input</span><span class="op" id="4492445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4492448">return</span><br>
<span class="lineno"></span><span class="op" id="4492455">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
