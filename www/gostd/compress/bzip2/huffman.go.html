<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html" class="current">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5646802">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5646857">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5646911">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5646962">package</span>&nbsp;<span class="ident" id="5646970">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5646977">import</span>&nbsp;<span class="string" id="5646984">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5646992">//&nbsp;A&nbsp;huffmanTree&nbsp;is&nbsp;a&nbsp;binary&nbsp;tree&nbsp;which&nbsp;is&nbsp;navigated,&nbsp;bit-by-bit&nbsp;to&nbsp;reach&nbsp;a</span><br>
<span class="lineno">10</span><span class="comment" id="5647068">//&nbsp;symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="5647079">type</span>&nbsp;<span class="ident" id="5647084">huffmanTree</span>&nbsp;<span class="keyword" id="5647096">struct</span>&nbsp;<span class="op" id="5647103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5647106">//&nbsp;nodes&nbsp;contains&nbsp;all&nbsp;the&nbsp;non-leaf&nbsp;nodes&nbsp;in&nbsp;the&nbsp;tree.&nbsp;nodes[0]&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5647177">//&nbsp;root&nbsp;of&nbsp;the&nbsp;tree&nbsp;and&nbsp;nextNode&nbsp;contains&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5647250">//&nbsp;of&nbsp;nodes&nbsp;to&nbsp;use&nbsp;when&nbsp;the&nbsp;tree&nbsp;is&nbsp;being&nbsp;constructed.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5647306">nodes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5647315">[</span><span class="op" id="5647316">]</span><span class="ident" id="5647317">huffmanNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5647330">nextNode</span>&nbsp;<span class="builtintype" id="5647339">int</span><br>
<span class="lineno"></span><span class="op" id="5647343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5647346">//&nbsp;A&nbsp;huffmanNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.&nbsp;left&nbsp;and&nbsp;right&nbsp;contain&nbsp;indexes&nbsp;into&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="5647426">//&nbsp;nodes&nbsp;slice&nbsp;of&nbsp;the&nbsp;tree.&nbsp;If&nbsp;left&nbsp;or&nbsp;right&nbsp;is&nbsp;invalidNodeValue&nbsp;then&nbsp;the&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="5647506">//&nbsp;is&nbsp;a&nbsp;left&nbsp;node&nbsp;and&nbsp;its&nbsp;value&nbsp;is&nbsp;in&nbsp;leftValue/rightValue.</span><br>
<span class="lineno"></span><span class="comment" id="5647566">//</span><br>
<span class="lineno"></span><span class="comment" id="5647569">//&nbsp;The&nbsp;symbols&nbsp;are&nbsp;uint16s&nbsp;because&nbsp;bzip2&nbsp;encodes&nbsp;not&nbsp;only&nbsp;MTF&nbsp;indexes&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5647646">//&nbsp;tree,&nbsp;but&nbsp;also&nbsp;two&nbsp;magic&nbsp;values&nbsp;for&nbsp;run-length&nbsp;encoding&nbsp;and&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno">25</span><span class="comment" id="5647724">//&nbsp;Thus&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;256&nbsp;possible&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="5647774">type</span>&nbsp;<span class="ident" id="5647779">huffmanNode</span>&nbsp;<span class="keyword" id="5647791">struct</span>&nbsp;<span class="op" id="5647798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5647801">left</span><span class="op" id="5647805">,</span>&nbsp;<span class="ident" id="5647807">right</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5647823">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5647831">leftValue</span><span class="op" id="5647840">,</span>&nbsp;<span class="ident" id="5647842">rightValue</span>&nbsp;<span class="builtintype" id="5647853">uint16</span><br>
<span class="lineno"></span><span class="op" id="5647860">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5647863">//&nbsp;invalidNodeValue&nbsp;is&nbsp;an&nbsp;invalid&nbsp;index&nbsp;which&nbsp;marks&nbsp;a&nbsp;leaf&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><span class="keyword" id="5647940">const</span>&nbsp;<span class="ident" id="5647946">invalidNodeValue</span>&nbsp;<span class="op" id="5647963">=</span>&nbsp;<span class="num" id="5647965">0xffff</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5647973">//&nbsp;Decode&nbsp;reads&nbsp;bits&nbsp;from&nbsp;the&nbsp;given&nbsp;bitReader&nbsp;and&nbsp;navigates&nbsp;the&nbsp;tree&nbsp;until&nbsp;a</span><br>
<span class="lineno">35</span><span class="comment" id="5648050">//&nbsp;symbol&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="5648070">func</span>&nbsp;<span class="op" id="5648075">(</span><span class="ident" id="5648076">t</span>&nbsp;<span class="op" id="5648078">*</span><span class="ident" id="5648079">huffmanTree</span><span class="op" id="5648090">)</span>&nbsp;<span class="ident" id="5648092">Decode</span><span class="op" id="5648098">(</span><span class="ident" id="5648099">br</span>&nbsp;<span class="op" id="5648102">*</span><span class="ident" id="5648103">bitReader</span><span class="op" id="5648112">)</span>&nbsp;<span class="op" id="5648114">(</span><span class="ident" id="5648115">v</span>&nbsp;<span class="builtintype" id="5648117">uint16</span><span class="op" id="5648123">)</span>&nbsp;<span class="op" id="5648125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5648128">nodeIndex</span>&nbsp;<span class="op" id="5648138">:=</span>&nbsp;<span class="builtintype" id="5648141">uint16</span><span class="op" id="5648147">(</span><span class="num" id="5648148">0</span><span class="op" id="5648149">)</span>&nbsp;<span class="comment" id="5648151">//&nbsp;node&nbsp;0&nbsp;is&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5648188">for</span>&nbsp;<span class="op" id="5648192">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5648196">node</span>&nbsp;<span class="op" id="5648201">:=</span>&nbsp;<span class="op" id="5648204">&amp;</span><span class="ident" id="5648205">t</span><span class="op" id="5648206">.</span><span class="ident" id="5648207">nodes</span><span class="op" id="5648212">[</span><span class="ident" id="5648213">nodeIndex</span><span class="op" id="5648222">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5648226">bit</span><span class="op" id="5648229">,</span>&nbsp;<span class="ident" id="5648231">ok</span>&nbsp;<span class="op" id="5648234">:=</span>&nbsp;<span class="ident" id="5648237">br</span><span class="op" id="5648239">.</span><span class="ident" id="5648240">TryReadBit</span><span class="op" id="5648250">(</span><span class="op" id="5648251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5648255">if</span>&nbsp;<span class="op" id="5648258">!</span><span class="ident" id="5648259">ok</span>&nbsp;<span class="op" id="5648262">&amp;&amp;</span>&nbsp;<span class="ident" id="5648265">br</span><span class="op" id="5648267">.</span><span class="ident" id="5648268">ReadBit</span><span class="op" id="5648275">(</span><span class="op" id="5648276">)</span>&nbsp;<span class="op" id="5648278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5648283">bit</span>&nbsp;<span class="op" id="5648287">=</span>&nbsp;<span class="num" id="5648289">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5648293">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5648297">//&nbsp;bzip2&nbsp;encodes&nbsp;left&nbsp;as&nbsp;a&nbsp;true&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5648336">if</span>&nbsp;<span class="ident" id="5648339">bit</span>&nbsp;<span class="op" id="5648343">!=</span>&nbsp;<span class="num" id="5648346">0</span>&nbsp;<span class="op" id="5648348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5648353">//&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5648364">if</span>&nbsp;<span class="ident" id="5648367">node</span><span class="op" id="5648371">.</span><span class="ident" id="5648372">left</span>&nbsp;<span class="op" id="5648377">==</span>&nbsp;<span class="ident" id="5648380">invalidNodeValue</span>&nbsp;<span class="op" id="5648397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5648403">return</span>&nbsp;<span class="ident" id="5648410">node</span><span class="op" id="5648414">.</span><span class="ident" id="5648415">leftValue</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5648428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5648433">nodeIndex</span>&nbsp;<span class="op" id="5648443">=</span>&nbsp;<span class="ident" id="5648445">node</span><span class="op" id="5648449">.</span><span class="ident" id="5648450">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5648457">}</span>&nbsp;<span class="keyword" id="5648459">else</span>&nbsp;<span class="op" id="5648464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5648469">//&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5648481">if</span>&nbsp;<span class="ident" id="5648484">node</span><span class="op" id="5648488">.</span><span class="ident" id="5648489">right</span>&nbsp;<span class="op" id="5648495">==</span>&nbsp;<span class="ident" id="5648498">invalidNodeValue</span>&nbsp;<span class="op" id="5648515">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5648521">return</span>&nbsp;<span class="ident" id="5648528">node</span><span class="op" id="5648532">.</span><span class="ident" id="5648533">rightValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5648547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5648552">nodeIndex</span>&nbsp;<span class="op" id="5648562">=</span>&nbsp;<span class="ident" id="5648564">node</span><span class="op" id="5648568">.</span><span class="ident" id="5648569">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5648577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5648580">}</span><br>
<span class="lineno">60</span><span class="op" id="5648582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5648585">//&nbsp;newHuffmanTree&nbsp;builds&nbsp;a&nbsp;Huffman&nbsp;tree&nbsp;from&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="5648658">//&nbsp;lengths&nbsp;of&nbsp;each&nbsp;symbol.&nbsp;The&nbsp;maximum&nbsp;code&nbsp;length&nbsp;is&nbsp;32&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="5648721">func</span>&nbsp;<span class="ident" id="5648726">newHuffmanTree</span><span class="op" id="5648740">(</span><span class="ident" id="5648741">lengths</span>&nbsp;<span class="op" id="5648749">[</span><span class="op" id="5648750">]</span><span class="builtintype" id="5648751">uint8</span><span class="op" id="5648756">)</span>&nbsp;<span class="op" id="5648758">(</span><span class="ident" id="5648759">huffmanTree</span><span class="op" id="5648770">,</span>&nbsp;<span class="builtintype" id="5648772">error</span><span class="op" id="5648777">)</span>&nbsp;<span class="op" id="5648779">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5648782">//&nbsp;There&nbsp;are&nbsp;many&nbsp;possible&nbsp;trees&nbsp;that&nbsp;assign&nbsp;the&nbsp;same&nbsp;code&nbsp;length&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5648852">//&nbsp;each&nbsp;symbol&nbsp;(consider&nbsp;reflecting&nbsp;a&nbsp;tree&nbsp;down&nbsp;the&nbsp;middle,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5648917">//&nbsp;example).&nbsp;Since&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;determine&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5648979">//&nbsp;efficiency&nbsp;of&nbsp;the&nbsp;tree,&nbsp;each&nbsp;of&nbsp;these&nbsp;trees&nbsp;is&nbsp;equally&nbsp;good.&nbsp;In</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5649047">//&nbsp;order&nbsp;to&nbsp;minimize&nbsp;the&nbsp;amount&nbsp;of&nbsp;information&nbsp;needed&nbsp;to&nbsp;build&nbsp;a&nbsp;tree</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5649118">//&nbsp;bzip2&nbsp;uses&nbsp;a&nbsp;canonical&nbsp;tree&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;reconstructed&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5649188">//&nbsp;only&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5649227">if</span>&nbsp;<span class="builtinfunc" id="5649230">len</span><span class="op" id="5649233">(</span><span class="ident" id="5649234">lengths</span><span class="op" id="5649241">)</span>&nbsp;<span class="op" id="5649243">&lt;</span>&nbsp;<span class="num" id="5649245">2</span>&nbsp;<span class="op" id="5649247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5649251">panic</span><span class="op" id="5649256">(</span><span class="string" id="5649257">&#34;newHuffmanTree:&nbsp;too&nbsp;few&nbsp;symbols&#34;</span><span class="op" id="5649290">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5649293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5649297">var</span>&nbsp;<span class="ident" id="5649301">t</span>&nbsp;<span class="ident" id="5649303">huffmanTree</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5649317">//&nbsp;First&nbsp;we&nbsp;sort&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;by&nbsp;ascending&nbsp;code&nbsp;length,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5649389">//&nbsp;using&nbsp;the&nbsp;symbol&nbsp;value&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5649431">pairs</span>&nbsp;<span class="op" id="5649437">:=</span>&nbsp;<span class="ident" id="5649440">huffmanSymbolLengthPairs</span><span class="op" id="5649464">(</span><span class="builtinfunc" id="5649465">make</span><span class="op" id="5649469">(</span><span class="op" id="5649470">[</span><span class="op" id="5649471">]</span><span class="ident" id="5649472">huffmanSymbolLengthPair</span><span class="op" id="5649495">,</span>&nbsp;<span class="builtinfunc" id="5649497">len</span><span class="op" id="5649500">(</span><span class="ident" id="5649501">lengths</span><span class="op" id="5649508">)</span><span class="op" id="5649509">)</span><span class="op" id="5649510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5649513">for</span>&nbsp;<span class="ident" id="5649517">i</span><span class="op" id="5649518">,</span>&nbsp;<span class="ident" id="5649520">length</span>&nbsp;<span class="op" id="5649527">:=</span>&nbsp;<span class="keyword" id="5649530">range</span>&nbsp;<span class="ident" id="5649536">lengths</span>&nbsp;<span class="op" id="5649544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5649548">pairs</span><span class="op" id="5649553">[</span><span class="ident" id="5649554">i</span><span class="op" id="5649555">]</span><span class="op" id="5649556">.</span><span class="ident" id="5649557">value</span>&nbsp;<span class="op" id="5649563">=</span>&nbsp;<span class="builtintype" id="5649565">uint16</span><span class="op" id="5649571">(</span><span class="ident" id="5649572">i</span><span class="op" id="5649573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5649577">pairs</span><span class="op" id="5649582">[</span><span class="ident" id="5649583">i</span><span class="op" id="5649584">]</span><span class="op" id="5649585">.</span><span class="ident" id="5649586">length</span>&nbsp;<span class="op" id="5649593">=</span>&nbsp;<span class="ident" id="5649595">length</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5649603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5649607">sort</span><span class="op" id="5649611">.</span><span class="ident" id="5649612">Sort</span><span class="op" id="5649616">(</span><span class="ident" id="5649617">pairs</span><span class="op" id="5649622">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5649626">//&nbsp;Now&nbsp;we&nbsp;assign&nbsp;codes&nbsp;to&nbsp;the&nbsp;symbols,&nbsp;starting&nbsp;with&nbsp;the&nbsp;longest&nbsp;code.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5649698">//&nbsp;We&nbsp;keep&nbsp;the&nbsp;codes&nbsp;packed&nbsp;into&nbsp;a&nbsp;uint32,&nbsp;at&nbsp;the&nbsp;most-significant&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5649771">//&nbsp;So&nbsp;branches&nbsp;are&nbsp;taken&nbsp;from&nbsp;the&nbsp;MSB&nbsp;downwards.&nbsp;This&nbsp;makes&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5649843">//&nbsp;sort&nbsp;them&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5649864">code</span>&nbsp;<span class="op" id="5649869">:=</span>&nbsp;<span class="builtintype" id="5649872">uint32</span><span class="op" id="5649878">(</span><span class="num" id="5649879">0</span><span class="op" id="5649880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5649883">length</span>&nbsp;<span class="op" id="5649890">:=</span>&nbsp;<span class="builtintype" id="5649893">uint8</span><span class="op" id="5649898">(</span><span class="num" id="5649899">32</span><span class="op" id="5649901">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5649905">codes</span>&nbsp;<span class="op" id="5649911">:=</span>&nbsp;<span class="ident" id="5649914">huffmanCodes</span><span class="op" id="5649926">(</span><span class="builtinfunc" id="5649927">make</span><span class="op" id="5649931">(</span><span class="op" id="5649932">[</span><span class="op" id="5649933">]</span><span class="ident" id="5649934">huffmanCode</span><span class="op" id="5649945">,</span>&nbsp;<span class="builtinfunc" id="5649947">len</span><span class="op" id="5649950">(</span><span class="ident" id="5649951">lengths</span><span class="op" id="5649958">)</span><span class="op" id="5649959">)</span><span class="op" id="5649960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5649963">for</span>&nbsp;<span class="ident" id="5649967">i</span>&nbsp;<span class="op" id="5649969">:=</span>&nbsp;<span class="builtinfunc" id="5649972">len</span><span class="op" id="5649975">(</span><span class="ident" id="5649976">pairs</span><span class="op" id="5649981">)</span>&nbsp;<span class="op" id="5649983">-</span>&nbsp;<span class="num" id="5649985">1</span><span class="op" id="5649986">;</span>&nbsp;<span class="ident" id="5649988">i</span>&nbsp;<span class="op" id="5649990">&gt;=</span>&nbsp;<span class="num" id="5649993">0</span><span class="op" id="5649994">;</span>&nbsp;<span class="ident" id="5649996">i</span><span class="op" id="5649997">--</span>&nbsp;<span class="op" id="5650000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5650004">if</span>&nbsp;<span class="ident" id="5650007">length</span>&nbsp;<span class="op" id="5650014">&gt;</span>&nbsp;<span class="ident" id="5650016">pairs</span><span class="op" id="5650021">[</span><span class="ident" id="5650022">i</span><span class="op" id="5650023">]</span><span class="op" id="5650024">.</span><span class="ident" id="5650025">length</span>&nbsp;<span class="op" id="5650032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5650037">//&nbsp;If&nbsp;the&nbsp;code&nbsp;length&nbsp;decreases&nbsp;we&nbsp;shift&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5650093">//&nbsp;zero&nbsp;any&nbsp;bits&nbsp;beyond&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650141">length</span>&nbsp;<span class="op" id="5650148">&gt;&gt;=</span>&nbsp;<span class="num" id="5650152">32</span>&nbsp;<span class="op" id="5650155">-</span>&nbsp;<span class="ident" id="5650157">pairs</span><span class="op" id="5650162">[</span><span class="ident" id="5650163">i</span><span class="op" id="5650164">]</span><span class="op" id="5650165">.</span><span class="ident" id="5650166">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650176">length</span>&nbsp;<span class="op" id="5650183">&lt;&lt;=</span>&nbsp;<span class="num" id="5650187">32</span>&nbsp;<span class="op" id="5650190">-</span>&nbsp;<span class="ident" id="5650192">pairs</span><span class="op" id="5650197">[</span><span class="ident" id="5650198">i</span><span class="op" id="5650199">]</span><span class="op" id="5650200">.</span><span class="ident" id="5650201">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650211">length</span>&nbsp;<span class="op" id="5650218">=</span>&nbsp;<span class="ident" id="5650220">pairs</span><span class="op" id="5650225">[</span><span class="ident" id="5650226">i</span><span class="op" id="5650227">]</span><span class="op" id="5650228">.</span><span class="ident" id="5650229">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5650238">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650242">codes</span><span class="op" id="5650247">[</span><span class="ident" id="5650248">i</span><span class="op" id="5650249">]</span><span class="op" id="5650250">.</span><span class="ident" id="5650251">code</span>&nbsp;<span class="op" id="5650256">=</span>&nbsp;<span class="ident" id="5650258">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650265">codes</span><span class="op" id="5650270">[</span><span class="ident" id="5650271">i</span><span class="op" id="5650272">]</span><span class="op" id="5650273">.</span><span class="ident" id="5650274">codeLen</span>&nbsp;<span class="op" id="5650282">=</span>&nbsp;<span class="ident" id="5650284">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650293">codes</span><span class="op" id="5650298">[</span><span class="ident" id="5650299">i</span><span class="op" id="5650300">]</span><span class="op" id="5650301">.</span><span class="ident" id="5650302">value</span>&nbsp;<span class="op" id="5650308">=</span>&nbsp;<span class="ident" id="5650310">pairs</span><span class="op" id="5650315">[</span><span class="ident" id="5650316">i</span><span class="op" id="5650317">]</span><span class="op" id="5650318">.</span><span class="ident" id="5650319">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5650327">//&nbsp;We&nbsp;need&nbsp;to&nbsp;&#39;increment&#39;&nbsp;the&nbsp;code,&nbsp;which&nbsp;means&nbsp;treating&nbsp;|code|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5650393">//&nbsp;like&nbsp;a&nbsp;|length|&nbsp;bit&nbsp;number.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650426">code</span>&nbsp;<span class="op" id="5650431">+=</span>&nbsp;<span class="num" id="5650434">1</span>&nbsp;<span class="op" id="5650436">&lt;&lt;</span>&nbsp;<span class="op" id="5650439">(</span><span class="num" id="5650440">32</span>&nbsp;<span class="op" id="5650443">-</span>&nbsp;<span class="ident" id="5650445">length</span><span class="op" id="5650451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5650454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5650458">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;sort&nbsp;by&nbsp;the&nbsp;code&nbsp;so&nbsp;that&nbsp;the&nbsp;left&nbsp;half&nbsp;of&nbsp;each&nbsp;branch&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5650531">//&nbsp;grouped&nbsp;together,&nbsp;recursively.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650566">sort</span><span class="op" id="5650570">.</span><span class="ident" id="5650571">Sort</span><span class="op" id="5650575">(</span><span class="ident" id="5650576">codes</span><span class="op" id="5650581">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650585">t</span><span class="op" id="5650586">.</span><span class="ident" id="5650587">nodes</span>&nbsp;<span class="op" id="5650593">=</span>&nbsp;<span class="builtinfunc" id="5650595">make</span><span class="op" id="5650599">(</span><span class="op" id="5650600">[</span><span class="op" id="5650601">]</span><span class="ident" id="5650602">huffmanNode</span><span class="op" id="5650613">,</span>&nbsp;<span class="builtinfunc" id="5650615">len</span><span class="op" id="5650618">(</span><span class="ident" id="5650619">codes</span><span class="op" id="5650624">)</span><span class="op" id="5650625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650628">_</span><span class="op" id="5650629">,</span>&nbsp;<span class="ident" id="5650631">err</span>&nbsp;<span class="op" id="5650635">:=</span>&nbsp;<span class="ident" id="5650638">buildHuffmanNode</span><span class="op" id="5650654">(</span><span class="op" id="5650655">&amp;</span><span class="ident" id="5650656">t</span><span class="op" id="5650657">,</span>&nbsp;<span class="ident" id="5650659">codes</span><span class="op" id="5650664">,</span>&nbsp;<span class="num" id="5650666">0</span><span class="op" id="5650667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5650670">return</span>&nbsp;<span class="ident" id="5650677">t</span><span class="op" id="5650678">,</span>&nbsp;<span class="ident" id="5650680">err</span><br>
<span class="lineno">120</span><span class="op" id="5650684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5650687">//&nbsp;huffmanSymbolLengthPair&nbsp;contains&nbsp;a&nbsp;symbol&nbsp;and&nbsp;its&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5650753">type</span>&nbsp;<span class="ident" id="5650758">huffmanSymbolLengthPair</span>&nbsp;<span class="keyword" id="5650782">struct</span>&nbsp;<span class="op" id="5650789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650792">value</span>&nbsp;&nbsp;<span class="builtintype" id="5650799">uint16</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650807">length</span>&nbsp;<span class="builtintype" id="5650814">uint8</span><br>
<span class="lineno"></span><span class="op" id="5650820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5650823">//&nbsp;huffmanSymbolLengthPair&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno"></span><span class="keyword" id="5650895">type</span>&nbsp;<span class="ident" id="5650900">huffmanSymbolLengthPairs</span>&nbsp;<span class="op" id="5650925">[</span><span class="op" id="5650926">]</span><span class="ident" id="5650927">huffmanSymbolLengthPair</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="5650952">func</span>&nbsp;<span class="op" id="5650957">(</span><span class="ident" id="5650958">h</span>&nbsp;<span class="ident" id="5650960">huffmanSymbolLengthPairs</span><span class="op" id="5650984">)</span>&nbsp;<span class="ident" id="5650986">Len</span><span class="op" id="5650989">(</span><span class="op" id="5650990">)</span>&nbsp;<span class="builtintype" id="5650992">int</span>&nbsp;<span class="op" id="5650996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5650999">return</span>&nbsp;<span class="builtinfunc" id="5651006">len</span><span class="op" id="5651009">(</span><span class="ident" id="5651010">h</span><span class="op" id="5651011">)</span><br>
<span class="lineno"></span><span class="op" id="5651013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="5651016">func</span>&nbsp;<span class="op" id="5651021">(</span><span class="ident" id="5651022">h</span>&nbsp;<span class="ident" id="5651024">huffmanSymbolLengthPairs</span><span class="op" id="5651048">)</span>&nbsp;<span class="ident" id="5651050">Less</span><span class="op" id="5651054">(</span><span class="ident" id="5651055">i</span><span class="op" id="5651056">,</span>&nbsp;<span class="ident" id="5651058">j</span>&nbsp;<span class="builtintype" id="5651060">int</span><span class="op" id="5651063">)</span>&nbsp;<span class="builtintype" id="5651065">bool</span>&nbsp;<span class="op" id="5651070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651073">if</span>&nbsp;<span class="ident" id="5651076">h</span><span class="op" id="5651077">[</span><span class="ident" id="5651078">i</span><span class="op" id="5651079">]</span><span class="op" id="5651080">.</span><span class="ident" id="5651081">length</span>&nbsp;<span class="op" id="5651088">&lt;</span>&nbsp;<span class="ident" id="5651090">h</span><span class="op" id="5651091">[</span><span class="ident" id="5651092">j</span><span class="op" id="5651093">]</span><span class="op" id="5651094">.</span><span class="ident" id="5651095">length</span>&nbsp;<span class="op" id="5651102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651106">return</span>&nbsp;<span class="builtintype" id="5651113">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5651119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651122">if</span>&nbsp;<span class="ident" id="5651125">h</span><span class="op" id="5651126">[</span><span class="ident" id="5651127">i</span><span class="op" id="5651128">]</span><span class="op" id="5651129">.</span><span class="ident" id="5651130">length</span>&nbsp;<span class="op" id="5651137">&gt;</span>&nbsp;<span class="ident" id="5651139">h</span><span class="op" id="5651140">[</span><span class="ident" id="5651141">j</span><span class="op" id="5651142">]</span><span class="op" id="5651143">.</span><span class="ident" id="5651144">length</span>&nbsp;<span class="op" id="5651151">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651155">return</span>&nbsp;<span class="builtintype" id="5651162">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5651169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651172">if</span>&nbsp;<span class="ident" id="5651175">h</span><span class="op" id="5651176">[</span><span class="ident" id="5651177">i</span><span class="op" id="5651178">]</span><span class="op" id="5651179">.</span><span class="ident" id="5651180">value</span>&nbsp;<span class="op" id="5651186">&lt;</span>&nbsp;<span class="ident" id="5651188">h</span><span class="op" id="5651189">[</span><span class="ident" id="5651190">j</span><span class="op" id="5651191">]</span><span class="op" id="5651192">.</span><span class="ident" id="5651193">value</span>&nbsp;<span class="op" id="5651199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651203">return</span>&nbsp;<span class="builtintype" id="5651210">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5651216">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651219">return</span>&nbsp;<span class="builtintype" id="5651226">false</span><br>
<span class="lineno"></span><span class="op" id="5651232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5651235">func</span>&nbsp;<span class="op" id="5651240">(</span><span class="ident" id="5651241">h</span>&nbsp;<span class="ident" id="5651243">huffmanSymbolLengthPairs</span><span class="op" id="5651267">)</span>&nbsp;<span class="ident" id="5651269">Swap</span><span class="op" id="5651273">(</span><span class="ident" id="5651274">i</span><span class="op" id="5651275">,</span>&nbsp;<span class="ident" id="5651277">j</span>&nbsp;<span class="builtintype" id="5651279">int</span><span class="op" id="5651282">)</span>&nbsp;<span class="op" id="5651284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5651287">h</span><span class="op" id="5651288">[</span><span class="ident" id="5651289">i</span><span class="op" id="5651290">]</span><span class="op" id="5651291">,</span>&nbsp;<span class="ident" id="5651293">h</span><span class="op" id="5651294">[</span><span class="ident" id="5651295">j</span><span class="op" id="5651296">]</span>&nbsp;<span class="op" id="5651298">=</span>&nbsp;<span class="ident" id="5651300">h</span><span class="op" id="5651301">[</span><span class="ident" id="5651302">j</span><span class="op" id="5651303">]</span><span class="op" id="5651304">,</span>&nbsp;<span class="ident" id="5651306">h</span><span class="op" id="5651307">[</span><span class="ident" id="5651308">i</span><span class="op" id="5651309">]</span><br>
<span class="lineno">150</span><span class="op" id="5651311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5651314">//&nbsp;huffmanCode&nbsp;contains&nbsp;a&nbsp;symbol,&nbsp;its&nbsp;code&nbsp;and&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5651374">type</span>&nbsp;<span class="ident" id="5651379">huffmanCode</span>&nbsp;<span class="keyword" id="5651391">struct</span>&nbsp;<span class="op" id="5651398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5651401">code</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5651409">uint32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5651417">codeLen</span>&nbsp;<span class="builtintype" id="5651425">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5651432">value</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5651440">uint16</span><br>
<span class="lineno"></span><span class="op" id="5651447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5651450">//&nbsp;huffmanCodes&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno">160</span><span class="keyword" id="5651511">type</span>&nbsp;<span class="ident" id="5651516">huffmanCodes</span>&nbsp;<span class="op" id="5651529">[</span><span class="op" id="5651530">]</span><span class="ident" id="5651531">huffmanCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5651544">func</span>&nbsp;<span class="op" id="5651549">(</span><span class="ident" id="5651550">n</span>&nbsp;<span class="ident" id="5651552">huffmanCodes</span><span class="op" id="5651564">)</span>&nbsp;<span class="ident" id="5651566">Len</span><span class="op" id="5651569">(</span><span class="op" id="5651570">)</span>&nbsp;<span class="builtintype" id="5651572">int</span>&nbsp;<span class="op" id="5651576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651579">return</span>&nbsp;<span class="builtinfunc" id="5651586">len</span><span class="op" id="5651589">(</span><span class="ident" id="5651590">n</span><span class="op" id="5651591">)</span><br>
<span class="lineno"></span><span class="op" id="5651593">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="5651596">func</span>&nbsp;<span class="op" id="5651601">(</span><span class="ident" id="5651602">n</span>&nbsp;<span class="ident" id="5651604">huffmanCodes</span><span class="op" id="5651616">)</span>&nbsp;<span class="ident" id="5651618">Less</span><span class="op" id="5651622">(</span><span class="ident" id="5651623">i</span><span class="op" id="5651624">,</span>&nbsp;<span class="ident" id="5651626">j</span>&nbsp;<span class="builtintype" id="5651628">int</span><span class="op" id="5651631">)</span>&nbsp;<span class="builtintype" id="5651633">bool</span>&nbsp;<span class="op" id="5651638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651641">return</span>&nbsp;<span class="ident" id="5651648">n</span><span class="op" id="5651649">[</span><span class="ident" id="5651650">i</span><span class="op" id="5651651">]</span><span class="op" id="5651652">.</span><span class="ident" id="5651653">code</span>&nbsp;<span class="op" id="5651658">&lt;</span>&nbsp;<span class="ident" id="5651660">n</span><span class="op" id="5651661">[</span><span class="ident" id="5651662">j</span><span class="op" id="5651663">]</span><span class="op" id="5651664">.</span><span class="ident" id="5651665">code</span><br>
<span class="lineno"></span><span class="op" id="5651670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="5651673">func</span>&nbsp;<span class="op" id="5651678">(</span><span class="ident" id="5651679">n</span>&nbsp;<span class="ident" id="5651681">huffmanCodes</span><span class="op" id="5651693">)</span>&nbsp;<span class="ident" id="5651695">Swap</span><span class="op" id="5651699">(</span><span class="ident" id="5651700">i</span><span class="op" id="5651701">,</span>&nbsp;<span class="ident" id="5651703">j</span>&nbsp;<span class="builtintype" id="5651705">int</span><span class="op" id="5651708">)</span>&nbsp;<span class="op" id="5651710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5651713">n</span><span class="op" id="5651714">[</span><span class="ident" id="5651715">i</span><span class="op" id="5651716">]</span><span class="op" id="5651717">,</span>&nbsp;<span class="ident" id="5651719">n</span><span class="op" id="5651720">[</span><span class="ident" id="5651721">j</span><span class="op" id="5651722">]</span>&nbsp;<span class="op" id="5651724">=</span>&nbsp;<span class="ident" id="5651726">n</span><span class="op" id="5651727">[</span><span class="ident" id="5651728">j</span><span class="op" id="5651729">]</span><span class="op" id="5651730">,</span>&nbsp;<span class="ident" id="5651732">n</span><span class="op" id="5651733">[</span><span class="ident" id="5651734">i</span><span class="op" id="5651735">]</span><br>
<span class="lineno"></span><span class="op" id="5651737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5651740">//&nbsp;buildHuffmanNode&nbsp;takes&nbsp;a&nbsp;slice&nbsp;of&nbsp;sorted&nbsp;huffmanCodes&nbsp;and&nbsp;builds&nbsp;a&nbsp;node&nbsp;in</span><br>
<span class="lineno">175</span><span class="comment" id="5651818">//&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;at&nbsp;the&nbsp;given&nbsp;level.&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;newly</span><br>
<span class="lineno"></span><span class="comment" id="5651892">//&nbsp;constructed&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="5651913">func</span>&nbsp;<span class="ident" id="5651918">buildHuffmanNode</span><span class="op" id="5651934">(</span><span class="ident" id="5651935">t</span>&nbsp;<span class="op" id="5651937">*</span><span class="ident" id="5651938">huffmanTree</span><span class="op" id="5651949">,</span>&nbsp;<span class="ident" id="5651951">codes</span>&nbsp;<span class="op" id="5651957">[</span><span class="op" id="5651958">]</span><span class="ident" id="5651959">huffmanCode</span><span class="op" id="5651970">,</span>&nbsp;<span class="ident" id="5651972">level</span>&nbsp;<span class="builtintype" id="5651978">uint32</span><span class="op" id="5651984">)</span>&nbsp;<span class="op" id="5651986">(</span><span class="ident" id="5651987">nodeIndex</span>&nbsp;<span class="builtintype" id="5651997">uint16</span><span class="op" id="5652003">,</span>&nbsp;<span class="ident" id="5652005">err</span>&nbsp;<span class="builtintype" id="5652009">error</span><span class="op" id="5652014">)</span>&nbsp;<span class="op" id="5652016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5652019">test</span>&nbsp;<span class="op" id="5652024">:=</span>&nbsp;<span class="builtintype" id="5652027">uint32</span><span class="op" id="5652033">(</span><span class="num" id="5652034">1</span><span class="op" id="5652035">)</span>&nbsp;<span class="op" id="5652037">&lt;&lt;</span>&nbsp;<span class="op" id="5652040">(</span><span class="num" id="5652041">31</span>&nbsp;<span class="op" id="5652044">-</span>&nbsp;<span class="ident" id="5652046">level</span><span class="op" id="5652051">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5652055">//&nbsp;We&nbsp;have&nbsp;to&nbsp;search&nbsp;the&nbsp;list&nbsp;of&nbsp;codes&nbsp;to&nbsp;find&nbsp;the&nbsp;divide&nbsp;between&nbsp;the&nbsp;left&nbsp;and&nbsp;right&nbsp;sides.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5652148">firstRightIndex</span>&nbsp;<span class="op" id="5652164">:=</span>&nbsp;<span class="builtinfunc" id="5652167">len</span><span class="op" id="5652170">(</span><span class="ident" id="5652171">codes</span><span class="op" id="5652176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5652179">for</span>&nbsp;<span class="ident" id="5652183">i</span><span class="op" id="5652184">,</span>&nbsp;<span class="ident" id="5652186">code</span>&nbsp;<span class="op" id="5652191">:=</span>&nbsp;<span class="keyword" id="5652194">range</span>&nbsp;<span class="ident" id="5652200">codes</span>&nbsp;<span class="op" id="5652206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5652210">if</span>&nbsp;<span class="ident" id="5652213">code</span><span class="op" id="5652217">.</span><span class="ident" id="5652218">code</span><span class="op" id="5652222">&amp;</span><span class="ident" id="5652223">test</span>&nbsp;<span class="op" id="5652228">!=</span>&nbsp;<span class="num" id="5652231">0</span>&nbsp;<span class="op" id="5652233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5652238">firstRightIndex</span>&nbsp;<span class="op" id="5652254">=</span>&nbsp;<span class="ident" id="5652256">i</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5652261">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5652269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5652272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5652276">left</span>&nbsp;<span class="op" id="5652281">:=</span>&nbsp;<span class="ident" id="5652284">codes</span><span class="op" id="5652289">[</span><span class="op" id="5652290">:</span><span class="ident" id="5652291">firstRightIndex</span><span class="op" id="5652306">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5652309">right</span>&nbsp;<span class="op" id="5652315">:=</span>&nbsp;<span class="ident" id="5652318">codes</span><span class="op" id="5652323">[</span><span class="ident" id="5652324">firstRightIndex</span><span class="op" id="5652339">:</span><span class="op" id="5652340">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5652344">if</span>&nbsp;<span class="builtinfunc" id="5652347">len</span><span class="op" id="5652350">(</span><span class="ident" id="5652351">left</span><span class="op" id="5652355">)</span>&nbsp;<span class="op" id="5652357">==</span>&nbsp;<span class="num" id="5652360">0</span>&nbsp;<span class="op" id="5652362">||</span>&nbsp;<span class="builtinfunc" id="5652365">len</span><span class="op" id="5652368">(</span><span class="ident" id="5652369">right</span><span class="op" id="5652374">)</span>&nbsp;<span class="op" id="5652376">==</span>&nbsp;<span class="num" id="5652379">0</span>&nbsp;<span class="op" id="5652381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5652385">//&nbsp;There&nbsp;is&nbsp;a&nbsp;superfluous&nbsp;level&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;indicating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5652450">//&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;encoder.&nbsp;However,&nbsp;this&nbsp;bug&nbsp;has&nbsp;been&nbsp;observed&nbsp;in</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5652516">//&nbsp;the&nbsp;wild&nbsp;so&nbsp;we&nbsp;handle&nbsp;it.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5652548">//&nbsp;If&nbsp;this&nbsp;function&nbsp;was&nbsp;called&nbsp;recursively&nbsp;then&nbsp;we&nbsp;know&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5652611">//&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;because,&nbsp;otherwise,&nbsp;we&nbsp;would&nbsp;have&nbsp;hit&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5652674">//&nbsp;&#34;leaf&nbsp;node&#34;&nbsp;case,&nbsp;below,&nbsp;and&nbsp;not&nbsp;recursed.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5652722">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5652727">//&nbsp;However,&nbsp;for&nbsp;the&nbsp;initial&nbsp;call&nbsp;it&#39;s&nbsp;possible&nbsp;that&nbsp;len(codes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5652792">//&nbsp;is&nbsp;zero&nbsp;or&nbsp;one.&nbsp;Both&nbsp;cases&nbsp;are&nbsp;invalid&nbsp;because&nbsp;a&nbsp;zero&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5652858">//&nbsp;tree&nbsp;cannot&nbsp;encode&nbsp;anything&nbsp;and&nbsp;a&nbsp;length-1&nbsp;tree&nbsp;can&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5652920">//&nbsp;encode&nbsp;EOF&nbsp;and&nbsp;so&nbsp;is&nbsp;superfluous.&nbsp;We&nbsp;reject&nbsp;both.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5652975">if</span>&nbsp;<span class="builtinfunc" id="5652978">len</span><span class="op" id="5652981">(</span><span class="ident" id="5652982">codes</span><span class="op" id="5652987">)</span>&nbsp;<span class="op" id="5652989">&lt;</span>&nbsp;<span class="num" id="5652991">2</span>&nbsp;<span class="op" id="5652993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5652998">return</span>&nbsp;<span class="num" id="5653005">0</span><span class="op" id="5653006">,</span>&nbsp;<span class="ident" id="5653008">StructuralError</span><span class="op" id="5653023">(</span><span class="string" id="5653024">&#34;empty&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="5653044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5653048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5653053">//&nbsp;In&nbsp;this&nbsp;case&nbsp;the&nbsp;recursion&nbsp;doesn&#39;t&nbsp;always&nbsp;reduce&nbsp;the&nbsp;length</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5653118">//&nbsp;of&nbsp;codes&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;ensure&nbsp;termination&nbsp;via&nbsp;another</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5653177">//&nbsp;mechanism.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5653193">if</span>&nbsp;<span class="ident" id="5653196">level</span>&nbsp;<span class="op" id="5653202">==</span>&nbsp;<span class="num" id="5653205">31</span>&nbsp;<span class="op" id="5653208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5653213">//&nbsp;Since&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;the&nbsp;only&nbsp;way&nbsp;that&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5653270">//&nbsp;can&nbsp;match&nbsp;at&nbsp;all&nbsp;32&nbsp;bits&nbsp;is&nbsp;if&nbsp;they&nbsp;are&nbsp;equal,&nbsp;which</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5653329">//&nbsp;is&nbsp;invalid.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;we&nbsp;never&nbsp;enter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5653380">//&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5653406">return</span>&nbsp;<span class="num" id="5653413">0</span><span class="op" id="5653414">,</span>&nbsp;<span class="ident" id="5653416">StructuralError</span><span class="op" id="5653431">(</span><span class="string" id="5653432">&#34;equal&nbsp;symbols&nbsp;in&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="5653463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5653467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5653472">if</span>&nbsp;<span class="builtinfunc" id="5653475">len</span><span class="op" id="5653478">(</span><span class="ident" id="5653479">left</span><span class="op" id="5653483">)</span>&nbsp;<span class="op" id="5653485">==</span>&nbsp;<span class="num" id="5653488">0</span>&nbsp;<span class="op" id="5653490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5653495">return</span>&nbsp;<span class="ident" id="5653502">buildHuffmanNode</span><span class="op" id="5653518">(</span><span class="ident" id="5653519">t</span><span class="op" id="5653520">,</span>&nbsp;<span class="ident" id="5653522">right</span><span class="op" id="5653527">,</span>&nbsp;<span class="ident" id="5653529">level</span><span class="op" id="5653534">+</span><span class="num" id="5653535">1</span><span class="op" id="5653536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5653540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5653544">return</span>&nbsp;<span class="ident" id="5653551">buildHuffmanNode</span><span class="op" id="5653567">(</span><span class="ident" id="5653568">t</span><span class="op" id="5653569">,</span>&nbsp;<span class="ident" id="5653571">left</span><span class="op" id="5653575">,</span>&nbsp;<span class="ident" id="5653577">level</span><span class="op" id="5653582">+</span><span class="num" id="5653583">1</span><span class="op" id="5653584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5653587">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653591">nodeIndex</span>&nbsp;<span class="op" id="5653601">=</span>&nbsp;<span class="builtintype" id="5653603">uint16</span><span class="op" id="5653609">(</span><span class="ident" id="5653610">t</span><span class="op" id="5653611">.</span><span class="ident" id="5653612">nextNode</span><span class="op" id="5653620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653623">node</span>&nbsp;<span class="op" id="5653628">:=</span>&nbsp;<span class="op" id="5653631">&amp;</span><span class="ident" id="5653632">t</span><span class="op" id="5653633">.</span><span class="ident" id="5653634">nodes</span><span class="op" id="5653639">[</span><span class="ident" id="5653640">t</span><span class="op" id="5653641">.</span><span class="ident" id="5653642">nextNode</span><span class="op" id="5653650">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653653">t</span><span class="op" id="5653654">.</span><span class="ident" id="5653655">nextNode</span><span class="op" id="5653663">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5653668">if</span>&nbsp;<span class="builtinfunc" id="5653671">len</span><span class="op" id="5653674">(</span><span class="ident" id="5653675">left</span><span class="op" id="5653679">)</span>&nbsp;<span class="op" id="5653681">==</span>&nbsp;<span class="num" id="5653684">1</span>&nbsp;<span class="op" id="5653686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5653690">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653705">node</span><span class="op" id="5653709">.</span><span class="ident" id="5653710">left</span>&nbsp;<span class="op" id="5653715">=</span>&nbsp;<span class="ident" id="5653717">invalidNodeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653736">node</span><span class="op" id="5653740">.</span><span class="ident" id="5653741">leftValue</span>&nbsp;<span class="op" id="5653751">=</span>&nbsp;<span class="ident" id="5653753">left</span><span class="op" id="5653757">[</span><span class="num" id="5653758">0</span><span class="op" id="5653759">]</span><span class="op" id="5653760">.</span><span class="ident" id="5653761">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5653768">}</span>&nbsp;<span class="keyword" id="5653770">else</span>&nbsp;<span class="op" id="5653775">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653779">node</span><span class="op" id="5653783">.</span><span class="ident" id="5653784">left</span><span class="op" id="5653788">,</span>&nbsp;<span class="ident" id="5653790">err</span>&nbsp;<span class="op" id="5653794">=</span>&nbsp;<span class="ident" id="5653796">buildHuffmanNode</span><span class="op" id="5653812">(</span><span class="ident" id="5653813">t</span><span class="op" id="5653814">,</span>&nbsp;<span class="ident" id="5653816">left</span><span class="op" id="5653820">,</span>&nbsp;<span class="ident" id="5653822">level</span><span class="op" id="5653827">+</span><span class="num" id="5653828">1</span><span class="op" id="5653829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5653832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5653836">if</span>&nbsp;<span class="ident" id="5653839">err</span>&nbsp;<span class="op" id="5653843">!=</span>&nbsp;<span class="builtintype" id="5653846">nil</span>&nbsp;<span class="op" id="5653850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5653854">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5653862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5653866">if</span>&nbsp;<span class="builtinfunc" id="5653869">len</span><span class="op" id="5653872">(</span><span class="ident" id="5653873">right</span><span class="op" id="5653878">)</span>&nbsp;<span class="op" id="5653880">==</span>&nbsp;<span class="num" id="5653883">1</span>&nbsp;<span class="op" id="5653885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5653889">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653904">node</span><span class="op" id="5653908">.</span><span class="ident" id="5653909">right</span>&nbsp;<span class="op" id="5653915">=</span>&nbsp;<span class="ident" id="5653917">invalidNodeValue</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653936">node</span><span class="op" id="5653940">.</span><span class="ident" id="5653941">rightValue</span>&nbsp;<span class="op" id="5653952">=</span>&nbsp;<span class="ident" id="5653954">right</span><span class="op" id="5653959">[</span><span class="num" id="5653960">0</span><span class="op" id="5653961">]</span><span class="op" id="5653962">.</span><span class="ident" id="5653963">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5653970">}</span>&nbsp;<span class="keyword" id="5653972">else</span>&nbsp;<span class="op" id="5653977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653981">node</span><span class="op" id="5653985">.</span><span class="ident" id="5653986">right</span><span class="op" id="5653991">,</span>&nbsp;<span class="ident" id="5653993">err</span>&nbsp;<span class="op" id="5653997">=</span>&nbsp;<span class="ident" id="5653999">buildHuffmanNode</span><span class="op" id="5654015">(</span><span class="ident" id="5654016">t</span><span class="op" id="5654017">,</span>&nbsp;<span class="ident" id="5654019">right</span><span class="op" id="5654024">,</span>&nbsp;<span class="ident" id="5654026">level</span><span class="op" id="5654031">+</span><span class="num" id="5654032">1</span><span class="op" id="5654033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5654036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5654040">return</span><br>
<span class="lineno"></span><span class="op" id="5654047">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
