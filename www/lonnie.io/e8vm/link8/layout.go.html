<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5846376">package</span>&nbsp;<span class="ident" id="5846384">link8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5846391">import</span>&nbsp;<span class="op" id="5846398">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5846401">&#34;fmt&#34;</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5846409">&#34;lonnie.io/e8vm/arch8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5846432">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5846435">func</span>&nbsp;<span class="ident" id="5846440">layout</span><span class="op" id="5846446">(</span><span class="ident" id="5846447">used</span>&nbsp;<span class="op" id="5846452">[</span><span class="op" id="5846453">]</span><span class="ident" id="5846454">pkgSym</span><span class="op" id="5846460">)</span>&nbsp;<span class="op" id="5846462">(</span><span class="ident" id="5846463">funcs</span><span class="op" id="5846468">,</span>&nbsp;<span class="ident" id="5846470">vars</span>&nbsp;<span class="op" id="5846475">[</span><span class="op" id="5846476">]</span><span class="ident" id="5846477">pkgSym</span><span class="op" id="5846483">,</span>&nbsp;<span class="ident" id="5846485">e</span>&nbsp;<span class="builtintype" id="5846487">error</span><span class="op" id="5846492">)</span>&nbsp;<span class="op" id="5846494">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5846497">//&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5846506">pt</span>&nbsp;<span class="op" id="5846509">:=</span>&nbsp;<span class="builtintype" id="5846512">uint32</span><span class="op" id="5846518">(</span><span class="ident" id="5846519">arch8</span><span class="op" id="5846524">.</span><span class="ident" id="5846525">InitPC</span><span class="op" id="5846531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5846534">codeMax</span>&nbsp;<span class="op" id="5846542">:=</span>&nbsp;<span class="builtintype" id="5846545">uint32</span><span class="op" id="5846551">(</span><span class="num" id="5846552">0xffffffff</span><span class="op" id="5846562">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5846566">for</span>&nbsp;<span class="ident" id="5846570">_</span><span class="op" id="5846571">,</span>&nbsp;<span class="ident" id="5846573">ps</span>&nbsp;<span class="op" id="5846576">:=</span>&nbsp;<span class="keyword" id="5846579">range</span>&nbsp;<span class="ident" id="5846585">used</span>&nbsp;<span class="op" id="5846590">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5846594">typ</span>&nbsp;<span class="op" id="5846598">:=</span>&nbsp;<span class="ident" id="5846601">ps</span><span class="op" id="5846603">.</span><span class="ident" id="5846604">Type</span><span class="op" id="5846608">(</span><span class="op" id="5846609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5846613">switch</span>&nbsp;<span class="ident" id="5846620">typ</span>&nbsp;<span class="op" id="5846624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5846628">case</span>&nbsp;<span class="ident" id="5846633">SymFunc</span><span class="op" id="5846640">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5846645">funcs</span>&nbsp;<span class="op" id="5846651">=</span>&nbsp;<span class="builtinfunc" id="5846653">append</span><span class="op" id="5846659">(</span><span class="ident" id="5846660">funcs</span><span class="op" id="5846665">,</span>&nbsp;<span class="ident" id="5846667">ps</span><span class="op" id="5846669">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5846675">f</span>&nbsp;<span class="op" id="5846677">:=</span>&nbsp;<span class="ident" id="5846680">ps</span><span class="op" id="5846682">.</span><span class="ident" id="5846683">Func</span><span class="op" id="5846687">(</span><span class="op" id="5846688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5846693">f</span><span class="op" id="5846694">.</span><span class="ident" id="5846695">addr</span>&nbsp;<span class="op" id="5846700">=</span>&nbsp;<span class="ident" id="5846702">pt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5846708">size</span>&nbsp;<span class="op" id="5846713">:=</span>&nbsp;<span class="ident" id="5846716">f</span><span class="op" id="5846717">.</span><span class="ident" id="5846718">Size</span><span class="op" id="5846722">(</span><span class="op" id="5846723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5846728">if</span>&nbsp;<span class="ident" id="5846731">size</span>&nbsp;<span class="op" id="5846736">&gt;</span>&nbsp;<span class="ident" id="5846738">codeMax</span><span class="op" id="5846745">-</span><span class="ident" id="5846746">pt</span>&nbsp;<span class="op" id="5846749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5846755">return</span>&nbsp;<span class="ident" id="5846762">nil</span><span class="op" id="5846765">,</span>&nbsp;<span class="ident" id="5846767">nil</span><span class="op" id="5846770">,</span>&nbsp;<span class="ident" id="5846772">fmt</span><span class="op" id="5846775">.</span><span class="ident" id="5846776">Errorf</span><span class="op" id="5846782">(</span><span class="string" id="5846783">&#34;code&nbsp;section&nbsp;too&nbsp;large&#34;</span><span class="op" id="5846807">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5846812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5846817">pt</span>&nbsp;<span class="op" id="5846820">+=</span>&nbsp;<span class="ident" id="5846823">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5846830">case</span>&nbsp;<span class="ident" id="5846835">SymVar</span><span class="op" id="5846841">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5846846">vars</span>&nbsp;<span class="op" id="5846851">=</span>&nbsp;<span class="builtinfunc" id="5846853">append</span><span class="op" id="5846859">(</span><span class="ident" id="5846860">vars</span><span class="op" id="5846864">,</span>&nbsp;<span class="ident" id="5846866">ps</span><span class="op" id="5846868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5846872">default</span><span class="op" id="5846879">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5846884">panic</span><span class="op" id="5846889">(</span><span class="string" id="5846890">&#34;bug&#34;</span><span class="op" id="5846895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5846899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5846902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5846906">dataMax</span>&nbsp;<span class="op" id="5846914">:=</span>&nbsp;<span class="builtintype" id="5846917">uint32</span><span class="op" id="5846923">(</span><span class="num" id="5846924">0xffffffff</span><span class="op" id="5846934">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5846938">for</span>&nbsp;<span class="ident" id="5846942">_</span><span class="op" id="5846943">,</span>&nbsp;<span class="ident" id="5846945">ps</span>&nbsp;<span class="op" id="5846948">:=</span>&nbsp;<span class="keyword" id="5846951">range</span>&nbsp;<span class="ident" id="5846957">vars</span>&nbsp;<span class="op" id="5846962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5846966">if</span>&nbsp;<span class="ident" id="5846969">ps</span><span class="op" id="5846971">.</span><span class="ident" id="5846972">Type</span><span class="op" id="5846976">(</span><span class="op" id="5846977">)</span>&nbsp;<span class="op" id="5846979">!=</span>&nbsp;<span class="ident" id="5846982">SymVar</span>&nbsp;<span class="op" id="5846989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5846994">panic</span><span class="op" id="5846999">(</span><span class="string" id="5847000">&#34;bug&#34;</span><span class="op" id="5847005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5847009">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847014">v</span>&nbsp;<span class="op" id="5847016">:=</span>&nbsp;<span class="ident" id="5847019">ps</span><span class="op" id="5847021">.</span><span class="ident" id="5847022">Var</span><span class="op" id="5847025">(</span><span class="op" id="5847026">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847031">if</span>&nbsp;<span class="ident" id="5847034">v</span><span class="op" id="5847035">.</span><span class="ident" id="5847036">align</span>&nbsp;<span class="op" id="5847042">&gt;</span>&nbsp;<span class="num" id="5847044">1</span>&nbsp;<span class="op" id="5847046">&amp;&amp;</span>&nbsp;<span class="ident" id="5847049">pt</span><span class="op" id="5847051">%</span><span class="ident" id="5847052">v</span><span class="op" id="5847053">.</span><span class="ident" id="5847054">align</span>&nbsp;<span class="op" id="5847060">!=</span>&nbsp;<span class="num" id="5847063">0</span>&nbsp;<span class="op" id="5847065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847070">v</span><span class="op" id="5847071">.</span><span class="ident" id="5847072">prePad</span>&nbsp;<span class="op" id="5847079">=</span>&nbsp;<span class="ident" id="5847081">v</span><span class="op" id="5847082">.</span><span class="ident" id="5847083">align</span>&nbsp;<span class="op" id="5847089">-</span>&nbsp;<span class="ident" id="5847091">pt</span><span class="op" id="5847093">%</span><span class="ident" id="5847094">v</span><span class="op" id="5847095">.</span><span class="ident" id="5847096">align</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847105">pt</span>&nbsp;<span class="op" id="5847108">+=</span>&nbsp;<span class="ident" id="5847111">v</span><span class="op" id="5847112">.</span><span class="ident" id="5847113">prePad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5847122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847126">if</span>&nbsp;<span class="ident" id="5847129">v</span><span class="op" id="5847130">.</span><span class="ident" id="5847131">align</span>&nbsp;<span class="op" id="5847137">&gt;</span>&nbsp;<span class="num" id="5847139">1</span>&nbsp;<span class="op" id="5847141">&amp;&amp;</span>&nbsp;<span class="ident" id="5847144">pt</span><span class="op" id="5847146">%</span><span class="ident" id="5847147">v</span><span class="op" id="5847148">.</span><span class="ident" id="5847149">align</span>&nbsp;<span class="op" id="5847155">!=</span>&nbsp;<span class="num" id="5847158">0</span>&nbsp;<span class="op" id="5847160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5847165">panic</span><span class="op" id="5847170">(</span><span class="string" id="5847171">&#34;bug&#34;</span><span class="op" id="5847176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5847180">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847185">v</span><span class="op" id="5847186">.</span><span class="ident" id="5847187">addr</span>&nbsp;<span class="op" id="5847192">=</span>&nbsp;<span class="ident" id="5847194">pt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847199">size</span>&nbsp;<span class="op" id="5847204">:=</span>&nbsp;<span class="ident" id="5847207">v</span><span class="op" id="5847208">.</span><span class="ident" id="5847209">Size</span><span class="op" id="5847213">(</span><span class="op" id="5847214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847218">if</span>&nbsp;<span class="ident" id="5847221">size</span>&nbsp;<span class="op" id="5847226">&gt;</span>&nbsp;<span class="ident" id="5847228">dataMax</span><span class="op" id="5847235">-</span><span class="ident" id="5847236">pt</span>&nbsp;<span class="op" id="5847239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847244">return</span>&nbsp;<span class="ident" id="5847251">nil</span><span class="op" id="5847254">,</span>&nbsp;<span class="ident" id="5847256">nil</span><span class="op" id="5847259">,</span>&nbsp;<span class="ident" id="5847261">fmt</span><span class="op" id="5847264">.</span><span class="ident" id="5847265">Errorf</span><span class="op" id="5847271">(</span><span class="string" id="5847272">&#34;binary&nbsp;too&nbsp;large&#34;</span><span class="op" id="5847290">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5847294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847299">pt</span>&nbsp;<span class="op" id="5847302">+=</span>&nbsp;<span class="ident" id="5847305">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5847311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847315">return</span><br>
<span class="lineno"></span><span class="op" id="5847322">}</span>
</div>
</body>
</html>
