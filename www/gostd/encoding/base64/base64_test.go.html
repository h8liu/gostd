<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/base64</h2>
<ul>
<li><a href="/gostd/encoding/base64/base64.go.html">base64.go</a></li>
<li><a href="/gostd/encoding/base64/base64_test.go.html">base64_test.go</a></li>
<li><a href="/gostd/encoding/base64/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6653237">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6653292">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6653346">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6653397">package</span>&nbsp;<span class="ident" id="6653405">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6653413">import</span>&nbsp;<span class="op" id="6653420">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6653423">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6653432">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6653442">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6653448">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6653461">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6653472">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6653483">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6653494">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6653501">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6653504">type</span>&nbsp;<span class="ident" id="6653509">testpair</span>&nbsp;<span class="keyword" id="6653518">struct</span>&nbsp;<span class="op" id="6653525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6653528">decoded</span><span class="op" id="6653535">,</span>&nbsp;<span class="ident" id="6653537">encoded</span>&nbsp;<span class="builtintype" id="6653545">string</span><br>
<span class="lineno">20</span><span class="op" id="6653552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6653555">var</span>&nbsp;<span class="ident" id="6653559">pairs</span>&nbsp;<span class="op" id="6653565">=</span>&nbsp;<span class="op" id="6653567">[</span><span class="op" id="6653568">]</span><span class="ident" id="6653569">testpair</span><span class="op" id="6653577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6653580">//&nbsp;RFC&nbsp;3548&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653602">{</span><span class="string" id="6653603">&#34;\x14\xfb\x9c\x03\xd9\x7e&#34;</span><span class="op" id="6653629">,</span>&nbsp;<span class="string" id="6653631">&#34;FPucA9l+&#34;</span><span class="op" id="6653641">}</span><span class="op" id="6653642">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653645">{</span><span class="string" id="6653646">&#34;\x14\xfb\x9c\x03\xd9&#34;</span><span class="op" id="6653668">,</span>&nbsp;<span class="string" id="6653670">&#34;FPucA9k=&#34;</span><span class="op" id="6653680">}</span><span class="op" id="6653681">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653684">{</span><span class="string" id="6653685">&#34;\x14\xfb\x9c\x03&#34;</span><span class="op" id="6653703">,</span>&nbsp;<span class="string" id="6653705">&#34;FPucAw==&#34;</span><span class="op" id="6653715">}</span><span class="op" id="6653716">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6653720">//&nbsp;RFC&nbsp;4648&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653742">{</span><span class="string" id="6653743">&#34;&#34;</span><span class="op" id="6653745">,</span>&nbsp;<span class="string" id="6653747">&#34;&#34;</span><span class="op" id="6653749">}</span><span class="op" id="6653750">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653753">{</span><span class="string" id="6653754">&#34;f&#34;</span><span class="op" id="6653757">,</span>&nbsp;<span class="string" id="6653759">&#34;Zg==&#34;</span><span class="op" id="6653765">}</span><span class="op" id="6653766">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653769">{</span><span class="string" id="6653770">&#34;fo&#34;</span><span class="op" id="6653774">,</span>&nbsp;<span class="string" id="6653776">&#34;Zm8=&#34;</span><span class="op" id="6653782">}</span><span class="op" id="6653783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653786">{</span><span class="string" id="6653787">&#34;foo&#34;</span><span class="op" id="6653792">,</span>&nbsp;<span class="string" id="6653794">&#34;Zm9v&#34;</span><span class="op" id="6653800">}</span><span class="op" id="6653801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653804">{</span><span class="string" id="6653805">&#34;foob&#34;</span><span class="op" id="6653811">,</span>&nbsp;<span class="string" id="6653813">&#34;Zm9vYg==&#34;</span><span class="op" id="6653823">}</span><span class="op" id="6653824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653827">{</span><span class="string" id="6653828">&#34;fooba&#34;</span><span class="op" id="6653835">,</span>&nbsp;<span class="string" id="6653837">&#34;Zm9vYmE=&#34;</span><span class="op" id="6653847">}</span><span class="op" id="6653848">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653851">{</span><span class="string" id="6653852">&#34;foobar&#34;</span><span class="op" id="6653860">,</span>&nbsp;<span class="string" id="6653862">&#34;Zm9vYmFy&#34;</span><span class="op" id="6653872">}</span><span class="op" id="6653873">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6653877">//&nbsp;Wikipedia&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653900">{</span><span class="string" id="6653901">&#34;sure.&#34;</span><span class="op" id="6653908">,</span>&nbsp;<span class="string" id="6653910">&#34;c3VyZS4=&#34;</span><span class="op" id="6653920">}</span><span class="op" id="6653921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653924">{</span><span class="string" id="6653925">&#34;sure&#34;</span><span class="op" id="6653931">,</span>&nbsp;<span class="string" id="6653933">&#34;c3VyZQ==&#34;</span><span class="op" id="6653943">}</span><span class="op" id="6653944">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653947">{</span><span class="string" id="6653948">&#34;sur&#34;</span><span class="op" id="6653953">,</span>&nbsp;<span class="string" id="6653955">&#34;c3Vy&#34;</span><span class="op" id="6653961">}</span><span class="op" id="6653962">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653965">{</span><span class="string" id="6653966">&#34;su&#34;</span><span class="op" id="6653970">,</span>&nbsp;<span class="string" id="6653972">&#34;c3U=&#34;</span><span class="op" id="6653978">}</span><span class="op" id="6653979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6653982">{</span><span class="string" id="6653983">&#34;leasure.&#34;</span><span class="op" id="6653993">,</span>&nbsp;<span class="string" id="6653995">&#34;bGVhc3VyZS4=&#34;</span><span class="op" id="6654009">}</span><span class="op" id="6654010">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6654013">{</span><span class="string" id="6654014">&#34;easure.&#34;</span><span class="op" id="6654023">,</span>&nbsp;<span class="string" id="6654025">&#34;ZWFzdXJlLg==&#34;</span><span class="op" id="6654039">}</span><span class="op" id="6654040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6654043">{</span><span class="string" id="6654044">&#34;asure.&#34;</span><span class="op" id="6654052">,</span>&nbsp;<span class="string" id="6654054">&#34;YXN1cmUu&#34;</span><span class="op" id="6654064">}</span><span class="op" id="6654065">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6654068">{</span><span class="string" id="6654069">&#34;sure.&#34;</span><span class="op" id="6654076">,</span>&nbsp;<span class="string" id="6654078">&#34;c3VyZS4=&#34;</span><span class="op" id="6654088">}</span><span class="op" id="6654089">,</span><br>
<span class="lineno"></span><span class="op" id="6654091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6654094">var</span>&nbsp;<span class="ident" id="6654098">bigtest</span>&nbsp;<span class="op" id="6654106">=</span>&nbsp;<span class="ident" id="6654108">testpair</span><span class="op" id="6654116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6654119">&#34;Twas&nbsp;brillig,&nbsp;and&nbsp;the&nbsp;slithy&nbsp;toves&#34;</span><span class="op" id="6654155">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6654158">&#34;VHdhcyBicmlsbGlnLCBhbmQgdGhlIHNsaXRoeSB0b3Zlcw==&#34;</span><span class="op" id="6654208">,</span><br>
<span class="lineno"></span><span class="op" id="6654210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6654213">func</span>&nbsp;<span class="ident" id="6654218">testEqual</span><span class="op" id="6654227">(</span><span class="ident" id="6654228">t</span>&nbsp;<span class="op" id="6654230">*</span><span class="ident" id="6654231">testing</span><span class="op" id="6654238">.</span><span class="ident" id="6654239">T</span><span class="op" id="6654240">,</span>&nbsp;<span class="ident" id="6654242">msg</span>&nbsp;<span class="builtintype" id="6654246">string</span><span class="op" id="6654252">,</span>&nbsp;<span class="ident" id="6654254">args</span>&nbsp;<span class="op" id="6654259">...</span><span class="keyword" id="6654262">interface</span><span class="op" id="6654271">{</span><span class="op" id="6654272">}</span><span class="op" id="6654273">)</span>&nbsp;<span class="builtintype" id="6654275">bool</span>&nbsp;<span class="op" id="6654280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6654283">if</span>&nbsp;<span class="ident" id="6654286">args</span><span class="op" id="6654290">[</span><span class="builtinfunc" id="6654291">len</span><span class="op" id="6654294">(</span><span class="ident" id="6654295">args</span><span class="op" id="6654299">)</span><span class="op" id="6654300">-</span><span class="num" id="6654301">2</span><span class="op" id="6654302">]</span>&nbsp;<span class="op" id="6654304">!=</span>&nbsp;<span class="ident" id="6654307">args</span><span class="op" id="6654311">[</span><span class="builtinfunc" id="6654312">len</span><span class="op" id="6654315">(</span><span class="ident" id="6654316">args</span><span class="op" id="6654320">)</span><span class="op" id="6654321">-</span><span class="num" id="6654322">1</span><span class="op" id="6654323">]</span>&nbsp;<span class="op" id="6654325">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654329">t</span><span class="op" id="6654330">.</span><span class="ident" id="6654331">Errorf</span><span class="op" id="6654337">(</span><span class="ident" id="6654338">msg</span><span class="op" id="6654341">,</span>&nbsp;<span class="ident" id="6654343">args</span><span class="op" id="6654347">...</span><span class="op" id="6654350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6654354">return</span>&nbsp;<span class="builtintype" id="6654361">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6654368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6654371">return</span>&nbsp;<span class="builtintype" id="6654378">true</span><br>
<span class="lineno"></span><span class="op" id="6654383">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="6654386">func</span>&nbsp;<span class="ident" id="6654391">TestEncode</span><span class="op" id="6654401">(</span><span class="ident" id="6654402">t</span>&nbsp;<span class="op" id="6654404">*</span><span class="ident" id="6654405">testing</span><span class="op" id="6654412">.</span><span class="ident" id="6654413">T</span><span class="op" id="6654414">)</span>&nbsp;<span class="op" id="6654416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6654419">for</span>&nbsp;<span class="ident" id="6654423">_</span><span class="op" id="6654424">,</span>&nbsp;<span class="ident" id="6654426">p</span>&nbsp;<span class="op" id="6654428">:=</span>&nbsp;<span class="keyword" id="6654431">range</span>&nbsp;<span class="ident" id="6654437">pairs</span>&nbsp;<span class="op" id="6654443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654447">got</span>&nbsp;<span class="op" id="6654451">:=</span>&nbsp;<span class="ident" id="6654454">StdEncoding</span><span class="op" id="6654465">.</span><span class="ident" id="6654466">EncodeToString</span><span class="op" id="6654480">(</span><span class="op" id="6654481">[</span><span class="op" id="6654482">]</span><span class="builtintype" id="6654483">byte</span><span class="op" id="6654487">(</span><span class="ident" id="6654488">p</span><span class="op" id="6654489">.</span><span class="ident" id="6654490">decoded</span><span class="op" id="6654497">)</span><span class="op" id="6654498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654502">testEqual</span><span class="op" id="6654511">(</span><span class="ident" id="6654512">t</span><span class="op" id="6654513">,</span>&nbsp;<span class="string" id="6654515">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6654541">,</span>&nbsp;<span class="ident" id="6654543">p</span><span class="op" id="6654544">.</span><span class="ident" id="6654545">decoded</span><span class="op" id="6654552">,</span>&nbsp;<span class="ident" id="6654554">got</span><span class="op" id="6654557">,</span>&nbsp;<span class="ident" id="6654559">p</span><span class="op" id="6654560">.</span><span class="ident" id="6654561">encoded</span><span class="op" id="6654568">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6654571">}</span><br>
<span class="lineno"></span><span class="op" id="6654573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6654576">func</span>&nbsp;<span class="ident" id="6654581">TestEncoder</span><span class="op" id="6654592">(</span><span class="ident" id="6654593">t</span>&nbsp;<span class="op" id="6654595">*</span><span class="ident" id="6654596">testing</span><span class="op" id="6654603">.</span><span class="ident" id="6654604">T</span><span class="op" id="6654605">)</span>&nbsp;<span class="op" id="6654607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6654610">for</span>&nbsp;<span class="ident" id="6654614">_</span><span class="op" id="6654615">,</span>&nbsp;<span class="ident" id="6654617">p</span>&nbsp;<span class="op" id="6654619">:=</span>&nbsp;<span class="keyword" id="6654622">range</span>&nbsp;<span class="ident" id="6654628">pairs</span>&nbsp;<span class="op" id="6654634">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654638">bb</span>&nbsp;<span class="op" id="6654641">:=</span>&nbsp;<span class="op" id="6654644">&amp;</span><span class="ident" id="6654645">bytes</span><span class="op" id="6654650">.</span><span class="ident" id="6654651">Buffer</span><span class="op" id="6654657">{</span><span class="op" id="6654658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654662">encoder</span>&nbsp;<span class="op" id="6654670">:=</span>&nbsp;<span class="ident" id="6654673">NewEncoder</span><span class="op" id="6654683">(</span><span class="ident" id="6654684">StdEncoding</span><span class="op" id="6654695">,</span>&nbsp;<span class="ident" id="6654697">bb</span><span class="op" id="6654699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654703">encoder</span><span class="op" id="6654710">.</span><span class="ident" id="6654711">Write</span><span class="op" id="6654716">(</span><span class="op" id="6654717">[</span><span class="op" id="6654718">]</span><span class="builtintype" id="6654719">byte</span><span class="op" id="6654723">(</span><span class="ident" id="6654724">p</span><span class="op" id="6654725">.</span><span class="ident" id="6654726">decoded</span><span class="op" id="6654733">)</span><span class="op" id="6654734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654738">encoder</span><span class="op" id="6654745">.</span><span class="ident" id="6654746">Close</span><span class="op" id="6654751">(</span><span class="op" id="6654752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654756">testEqual</span><span class="op" id="6654765">(</span><span class="ident" id="6654766">t</span><span class="op" id="6654767">,</span>&nbsp;<span class="string" id="6654769">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6654795">,</span>&nbsp;<span class="ident" id="6654797">p</span><span class="op" id="6654798">.</span><span class="ident" id="6654799">decoded</span><span class="op" id="6654806">,</span>&nbsp;<span class="ident" id="6654808">bb</span><span class="op" id="6654810">.</span><span class="ident" id="6654811">String</span><span class="op" id="6654817">(</span><span class="op" id="6654818">)</span><span class="op" id="6654819">,</span>&nbsp;<span class="ident" id="6654821">p</span><span class="op" id="6654822">.</span><span class="ident" id="6654823">encoded</span><span class="op" id="6654830">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6654833">}</span><br>
<span class="lineno"></span><span class="op" id="6654835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6654838">func</span>&nbsp;<span class="ident" id="6654843">TestEncoderBuffering</span><span class="op" id="6654863">(</span><span class="ident" id="6654864">t</span>&nbsp;<span class="op" id="6654866">*</span><span class="ident" id="6654867">testing</span><span class="op" id="6654874">.</span><span class="ident" id="6654875">T</span><span class="op" id="6654876">)</span>&nbsp;<span class="op" id="6654878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654881">input</span>&nbsp;<span class="op" id="6654887">:=</span>&nbsp;<span class="op" id="6654890">[</span><span class="op" id="6654891">]</span><span class="builtintype" id="6654892">byte</span><span class="op" id="6654896">(</span><span class="ident" id="6654897">bigtest</span><span class="op" id="6654904">.</span><span class="ident" id="6654905">decoded</span><span class="op" id="6654912">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6654915">for</span>&nbsp;<span class="ident" id="6654919">bs</span>&nbsp;<span class="op" id="6654922">:=</span>&nbsp;<span class="num" id="6654925">1</span><span class="op" id="6654926">;</span>&nbsp;<span class="ident" id="6654928">bs</span>&nbsp;<span class="op" id="6654931">&lt;=</span>&nbsp;<span class="num" id="6654934">12</span><span class="op" id="6654936">;</span>&nbsp;<span class="ident" id="6654938">bs</span><span class="op" id="6654940">++</span>&nbsp;<span class="op" id="6654943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654947">bb</span>&nbsp;<span class="op" id="6654950">:=</span>&nbsp;<span class="op" id="6654953">&amp;</span><span class="ident" id="6654954">bytes</span><span class="op" id="6654959">.</span><span class="ident" id="6654960">Buffer</span><span class="op" id="6654966">{</span><span class="op" id="6654967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6654971">encoder</span>&nbsp;<span class="op" id="6654979">:=</span>&nbsp;<span class="ident" id="6654982">NewEncoder</span><span class="op" id="6654992">(</span><span class="ident" id="6654993">StdEncoding</span><span class="op" id="6655004">,</span>&nbsp;<span class="ident" id="6655006">bb</span><span class="op" id="6655008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6655012">for</span>&nbsp;<span class="ident" id="6655016">pos</span>&nbsp;<span class="op" id="6655020">:=</span>&nbsp;<span class="num" id="6655023">0</span><span class="op" id="6655024">;</span>&nbsp;<span class="ident" id="6655026">pos</span>&nbsp;<span class="op" id="6655030">&lt;</span>&nbsp;<span class="builtinfunc" id="6655032">len</span><span class="op" id="6655035">(</span><span class="ident" id="6655036">input</span><span class="op" id="6655041">)</span><span class="op" id="6655042">;</span>&nbsp;<span class="ident" id="6655044">pos</span>&nbsp;<span class="op" id="6655048">+=</span>&nbsp;<span class="ident" id="6655051">bs</span>&nbsp;<span class="op" id="6655054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655059">end</span>&nbsp;<span class="op" id="6655063">:=</span>&nbsp;<span class="ident" id="6655066">pos</span>&nbsp;<span class="op" id="6655070">+</span>&nbsp;<span class="ident" id="6655072">bs</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6655078">if</span>&nbsp;<span class="ident" id="6655081">end</span>&nbsp;<span class="op" id="6655085">&gt;</span>&nbsp;<span class="builtinfunc" id="6655087">len</span><span class="op" id="6655090">(</span><span class="ident" id="6655091">input</span><span class="op" id="6655096">)</span>&nbsp;<span class="op" id="6655098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655104">end</span>&nbsp;<span class="op" id="6655108">=</span>&nbsp;<span class="builtinfunc" id="6655110">len</span><span class="op" id="6655113">(</span><span class="ident" id="6655114">input</span><span class="op" id="6655119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6655124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655129">n</span><span class="op" id="6655130">,</span>&nbsp;<span class="ident" id="6655132">err</span>&nbsp;<span class="op" id="6655136">:=</span>&nbsp;<span class="ident" id="6655139">encoder</span><span class="op" id="6655146">.</span><span class="ident" id="6655147">Write</span><span class="op" id="6655152">(</span><span class="ident" id="6655153">input</span><span class="op" id="6655158">[</span><span class="ident" id="6655159">pos</span><span class="op" id="6655162">:</span><span class="ident" id="6655163">end</span><span class="op" id="6655166">]</span><span class="op" id="6655167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655172">testEqual</span><span class="op" id="6655181">(</span><span class="ident" id="6655182">t</span><span class="op" id="6655183">,</span>&nbsp;<span class="string" id="6655185">&#34;Write(%q)&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6655219">,</span>&nbsp;<span class="ident" id="6655221">input</span><span class="op" id="6655226">[</span><span class="ident" id="6655227">pos</span><span class="op" id="6655230">:</span><span class="ident" id="6655231">end</span><span class="op" id="6655234">]</span><span class="op" id="6655235">,</span>&nbsp;<span class="ident" id="6655237">err</span><span class="op" id="6655240">,</span>&nbsp;<span class="builtintype" id="6655242">error</span><span class="op" id="6655247">(</span><span class="ident" id="6655248">nil</span><span class="op" id="6655251">)</span><span class="op" id="6655252">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655257">testEqual</span><span class="op" id="6655266">(</span><span class="ident" id="6655267">t</span><span class="op" id="6655268">,</span>&nbsp;<span class="string" id="6655270">&#34;Write(%q)&nbsp;gave&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6655305">,</span>&nbsp;<span class="ident" id="6655307">input</span><span class="op" id="6655312">[</span><span class="ident" id="6655313">pos</span><span class="op" id="6655316">:</span><span class="ident" id="6655317">end</span><span class="op" id="6655320">]</span><span class="op" id="6655321">,</span>&nbsp;<span class="ident" id="6655323">n</span><span class="op" id="6655324">,</span>&nbsp;<span class="ident" id="6655326">end</span><span class="op" id="6655329">-</span><span class="ident" id="6655330">pos</span><span class="op" id="6655333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6655337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655341">err</span>&nbsp;<span class="op" id="6655345">:=</span>&nbsp;<span class="ident" id="6655348">encoder</span><span class="op" id="6655355">.</span><span class="ident" id="6655356">Close</span><span class="op" id="6655361">(</span><span class="op" id="6655362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655366">testEqual</span><span class="op" id="6655375">(</span><span class="ident" id="6655376">t</span><span class="op" id="6655377">,</span>&nbsp;<span class="string" id="6655379">&#34;Close&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6655409">,</span>&nbsp;<span class="ident" id="6655411">err</span><span class="op" id="6655414">,</span>&nbsp;<span class="builtintype" id="6655416">error</span><span class="op" id="6655421">(</span><span class="ident" id="6655422">nil</span><span class="op" id="6655425">)</span><span class="op" id="6655426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655430">testEqual</span><span class="op" id="6655439">(</span><span class="ident" id="6655440">t</span><span class="op" id="6655441">,</span>&nbsp;<span class="string" id="6655443">&#34;Encoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6655476">,</span>&nbsp;<span class="ident" id="6655478">bs</span><span class="op" id="6655480">,</span>&nbsp;<span class="ident" id="6655482">bigtest</span><span class="op" id="6655489">.</span><span class="ident" id="6655490">decoded</span><span class="op" id="6655497">,</span>&nbsp;<span class="ident" id="6655499">bb</span><span class="op" id="6655501">.</span><span class="ident" id="6655502">String</span><span class="op" id="6655508">(</span><span class="op" id="6655509">)</span><span class="op" id="6655510">,</span>&nbsp;<span class="ident" id="6655512">bigtest</span><span class="op" id="6655519">.</span><span class="ident" id="6655520">encoded</span><span class="op" id="6655527">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6655530">}</span><br>
<span class="lineno"></span><span class="op" id="6655532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6655535">func</span>&nbsp;<span class="ident" id="6655540">TestDecode</span><span class="op" id="6655550">(</span><span class="ident" id="6655551">t</span>&nbsp;<span class="op" id="6655553">*</span><span class="ident" id="6655554">testing</span><span class="op" id="6655561">.</span><span class="ident" id="6655562">T</span><span class="op" id="6655563">)</span>&nbsp;<span class="op" id="6655565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6655568">for</span>&nbsp;<span class="ident" id="6655572">_</span><span class="op" id="6655573">,</span>&nbsp;<span class="ident" id="6655575">p</span>&nbsp;<span class="op" id="6655577">:=</span>&nbsp;<span class="keyword" id="6655580">range</span>&nbsp;<span class="ident" id="6655586">pairs</span>&nbsp;<span class="op" id="6655592">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655596">dbuf</span>&nbsp;<span class="op" id="6655601">:=</span>&nbsp;<span class="builtinfunc" id="6655604">make</span><span class="op" id="6655608">(</span><span class="op" id="6655609">[</span><span class="op" id="6655610">]</span><span class="builtintype" id="6655611">byte</span><span class="op" id="6655615">,</span>&nbsp;<span class="ident" id="6655617">StdEncoding</span><span class="op" id="6655628">.</span><span class="ident" id="6655629">DecodedLen</span><span class="op" id="6655639">(</span><span class="builtinfunc" id="6655640">len</span><span class="op" id="6655643">(</span><span class="ident" id="6655644">p</span><span class="op" id="6655645">.</span><span class="ident" id="6655646">encoded</span><span class="op" id="6655653">)</span><span class="op" id="6655654">)</span><span class="op" id="6655655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655659">count</span><span class="op" id="6655664">,</span>&nbsp;<span class="ident" id="6655666">end</span><span class="op" id="6655669">,</span>&nbsp;<span class="ident" id="6655671">err</span>&nbsp;<span class="op" id="6655675">:=</span>&nbsp;<span class="ident" id="6655678">StdEncoding</span><span class="op" id="6655689">.</span><span class="ident" id="6655690">decode</span><span class="op" id="6655696">(</span><span class="ident" id="6655697">dbuf</span><span class="op" id="6655701">,</span>&nbsp;<span class="op" id="6655703">[</span><span class="op" id="6655704">]</span><span class="builtintype" id="6655705">byte</span><span class="op" id="6655709">(</span><span class="ident" id="6655710">p</span><span class="op" id="6655711">.</span><span class="ident" id="6655712">encoded</span><span class="op" id="6655719">)</span><span class="op" id="6655720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655724">testEqual</span><span class="op" id="6655733">(</span><span class="ident" id="6655734">t</span><span class="op" id="6655735">,</span>&nbsp;<span class="string" id="6655737">&#34;Decode(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6655769">,</span>&nbsp;<span class="ident" id="6655771">p</span><span class="op" id="6655772">.</span><span class="ident" id="6655773">encoded</span><span class="op" id="6655780">,</span>&nbsp;<span class="ident" id="6655782">err</span><span class="op" id="6655785">,</span>&nbsp;<span class="builtintype" id="6655787">error</span><span class="op" id="6655792">(</span><span class="ident" id="6655793">nil</span><span class="op" id="6655796">)</span><span class="op" id="6655797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655801">testEqual</span><span class="op" id="6655810">(</span><span class="ident" id="6655811">t</span><span class="op" id="6655812">,</span>&nbsp;<span class="string" id="6655814">&#34;Decode(%q)&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6655847">,</span>&nbsp;<span class="ident" id="6655849">p</span><span class="op" id="6655850">.</span><span class="ident" id="6655851">encoded</span><span class="op" id="6655858">,</span>&nbsp;<span class="ident" id="6655860">count</span><span class="op" id="6655865">,</span>&nbsp;<span class="builtinfunc" id="6655867">len</span><span class="op" id="6655870">(</span><span class="ident" id="6655871">p</span><span class="op" id="6655872">.</span><span class="ident" id="6655873">decoded</span><span class="op" id="6655880">)</span><span class="op" id="6655881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6655885">if</span>&nbsp;<span class="builtinfunc" id="6655888">len</span><span class="op" id="6655891">(</span><span class="ident" id="6655892">p</span><span class="op" id="6655893">.</span><span class="ident" id="6655894">encoded</span><span class="op" id="6655901">)</span>&nbsp;<span class="op" id="6655903">&gt;</span>&nbsp;<span class="num" id="6655905">0</span>&nbsp;<span class="op" id="6655907">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6655912">testEqual</span><span class="op" id="6655921">(</span><span class="ident" id="6655922">t</span><span class="op" id="6655923">,</span>&nbsp;<span class="string" id="6655925">&#34;Decode(%q)&nbsp;=&nbsp;end&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6655955">,</span>&nbsp;<span class="ident" id="6655957">p</span><span class="op" id="6655958">.</span><span class="ident" id="6655959">encoded</span><span class="op" id="6655966">,</span>&nbsp;<span class="ident" id="6655968">end</span><span class="op" id="6655971">,</span>&nbsp;<span class="op" id="6655973">(</span><span class="ident" id="6655974">p</span><span class="op" id="6655975">.</span><span class="ident" id="6655976">encoded</span><span class="op" id="6655983">[</span><span class="builtinfunc" id="6655984">len</span><span class="op" id="6655987">(</span><span class="ident" id="6655988">p</span><span class="op" id="6655989">.</span><span class="ident" id="6655990">encoded</span><span class="op" id="6655997">)</span><span class="op" id="6655998">-</span><span class="num" id="6655999">1</span><span class="op" id="6656000">]</span>&nbsp;<span class="op" id="6656002">==</span>&nbsp;<span class="string" id="6656005">&#39;=&#39;</span><span class="op" id="6656008">)</span><span class="op" id="6656009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6656013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656017">testEqual</span><span class="op" id="6656026">(</span><span class="ident" id="6656027">t</span><span class="op" id="6656028">,</span>&nbsp;<span class="string" id="6656030">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6656056">,</span>&nbsp;<span class="ident" id="6656058">p</span><span class="op" id="6656059">.</span><span class="ident" id="6656060">encoded</span><span class="op" id="6656067">,</span>&nbsp;<span class="builtintype" id="6656069">string</span><span class="op" id="6656075">(</span><span class="ident" id="6656076">dbuf</span><span class="op" id="6656080">[</span><span class="num" id="6656081">0</span><span class="op" id="6656082">:</span><span class="ident" id="6656083">count</span><span class="op" id="6656088">]</span><span class="op" id="6656089">)</span><span class="op" id="6656090">,</span>&nbsp;<span class="ident" id="6656092">p</span><span class="op" id="6656093">.</span><span class="ident" id="6656094">decoded</span><span class="op" id="6656101">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656106">dbuf</span><span class="op" id="6656110">,</span>&nbsp;<span class="ident" id="6656112">err</span>&nbsp;<span class="op" id="6656116">=</span>&nbsp;<span class="ident" id="6656118">StdEncoding</span><span class="op" id="6656129">.</span><span class="ident" id="6656130">DecodeString</span><span class="op" id="6656142">(</span><span class="ident" id="6656143">p</span><span class="op" id="6656144">.</span><span class="ident" id="6656145">encoded</span><span class="op" id="6656152">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656156">testEqual</span><span class="op" id="6656165">(</span><span class="ident" id="6656166">t</span><span class="op" id="6656167">,</span>&nbsp;<span class="string" id="6656169">&#34;DecodeString(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6656207">,</span>&nbsp;<span class="ident" id="6656209">p</span><span class="op" id="6656210">.</span><span class="ident" id="6656211">encoded</span><span class="op" id="6656218">,</span>&nbsp;<span class="ident" id="6656220">err</span><span class="op" id="6656223">,</span>&nbsp;<span class="builtintype" id="6656225">error</span><span class="op" id="6656230">(</span><span class="ident" id="6656231">nil</span><span class="op" id="6656234">)</span><span class="op" id="6656235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656239">testEqual</span><span class="op" id="6656248">(</span><span class="ident" id="6656249">t</span><span class="op" id="6656250">,</span>&nbsp;<span class="string" id="6656252">&#34;DecodeString(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6656284">,</span>&nbsp;<span class="builtintype" id="6656286">string</span><span class="op" id="6656292">(</span><span class="ident" id="6656293">dbuf</span><span class="op" id="6656297">)</span><span class="op" id="6656298">,</span>&nbsp;<span class="ident" id="6656300">p</span><span class="op" id="6656301">.</span><span class="ident" id="6656302">decoded</span><span class="op" id="6656309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6656312">}</span><br>
<span class="lineno"></span><span class="op" id="6656314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="6656317">func</span>&nbsp;<span class="ident" id="6656322">TestDecoder</span><span class="op" id="6656333">(</span><span class="ident" id="6656334">t</span>&nbsp;<span class="op" id="6656336">*</span><span class="ident" id="6656337">testing</span><span class="op" id="6656344">.</span><span class="ident" id="6656345">T</span><span class="op" id="6656346">)</span>&nbsp;<span class="op" id="6656348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6656351">for</span>&nbsp;<span class="ident" id="6656355">_</span><span class="op" id="6656356">,</span>&nbsp;<span class="ident" id="6656358">p</span>&nbsp;<span class="op" id="6656360">:=</span>&nbsp;<span class="keyword" id="6656363">range</span>&nbsp;<span class="ident" id="6656369">pairs</span>&nbsp;<span class="op" id="6656375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656379">decoder</span>&nbsp;<span class="op" id="6656387">:=</span>&nbsp;<span class="ident" id="6656390">NewDecoder</span><span class="op" id="6656400">(</span><span class="ident" id="6656401">StdEncoding</span><span class="op" id="6656412">,</span>&nbsp;<span class="ident" id="6656414">strings</span><span class="op" id="6656421">.</span><span class="ident" id="6656422">NewReader</span><span class="op" id="6656431">(</span><span class="ident" id="6656432">p</span><span class="op" id="6656433">.</span><span class="ident" id="6656434">encoded</span><span class="op" id="6656441">)</span><span class="op" id="6656442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656446">dbuf</span>&nbsp;<span class="op" id="6656451">:=</span>&nbsp;<span class="builtinfunc" id="6656454">make</span><span class="op" id="6656458">(</span><span class="op" id="6656459">[</span><span class="op" id="6656460">]</span><span class="builtintype" id="6656461">byte</span><span class="op" id="6656465">,</span>&nbsp;<span class="ident" id="6656467">StdEncoding</span><span class="op" id="6656478">.</span><span class="ident" id="6656479">DecodedLen</span><span class="op" id="6656489">(</span><span class="builtinfunc" id="6656490">len</span><span class="op" id="6656493">(</span><span class="ident" id="6656494">p</span><span class="op" id="6656495">.</span><span class="ident" id="6656496">encoded</span><span class="op" id="6656503">)</span><span class="op" id="6656504">)</span><span class="op" id="6656505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656509">count</span><span class="op" id="6656514">,</span>&nbsp;<span class="ident" id="6656516">err</span>&nbsp;<span class="op" id="6656520">:=</span>&nbsp;<span class="ident" id="6656523">decoder</span><span class="op" id="6656530">.</span><span class="ident" id="6656531">Read</span><span class="op" id="6656535">(</span><span class="ident" id="6656536">dbuf</span><span class="op" id="6656540">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6656544">if</span>&nbsp;<span class="ident" id="6656547">err</span>&nbsp;<span class="op" id="6656551">!=</span>&nbsp;<span class="ident" id="6656554">nil</span>&nbsp;<span class="op" id="6656558">&amp;&amp;</span>&nbsp;<span class="ident" id="6656561">err</span>&nbsp;<span class="op" id="6656565">!=</span>&nbsp;<span class="ident" id="6656568">io</span><span class="op" id="6656570">.</span><span class="ident" id="6656571">EOF</span>&nbsp;<span class="op" id="6656575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656580">t</span><span class="op" id="6656581">.</span><span class="ident" id="6656582">Fatal</span><span class="op" id="6656587">(</span><span class="string" id="6656588">&#34;Read&nbsp;failed&#34;</span><span class="op" id="6656601">,</span>&nbsp;<span class="ident" id="6656603">err</span><span class="op" id="6656606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6656610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656614">testEqual</span><span class="op" id="6656623">(</span><span class="ident" id="6656624">t</span><span class="op" id="6656625">,</span>&nbsp;<span class="string" id="6656627">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6656662">,</span>&nbsp;<span class="ident" id="6656664">p</span><span class="op" id="6656665">.</span><span class="ident" id="6656666">encoded</span><span class="op" id="6656673">,</span>&nbsp;<span class="ident" id="6656675">count</span><span class="op" id="6656680">,</span>&nbsp;<span class="builtinfunc" id="6656682">len</span><span class="op" id="6656685">(</span><span class="ident" id="6656686">p</span><span class="op" id="6656687">.</span><span class="ident" id="6656688">decoded</span><span class="op" id="6656695">)</span><span class="op" id="6656696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656700">testEqual</span><span class="op" id="6656709">(</span><span class="ident" id="6656710">t</span><span class="op" id="6656711">,</span>&nbsp;<span class="string" id="6656713">&#34;Decoding&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6656743">,</span>&nbsp;<span class="ident" id="6656745">p</span><span class="op" id="6656746">.</span><span class="ident" id="6656747">encoded</span><span class="op" id="6656754">,</span>&nbsp;<span class="builtintype" id="6656756">string</span><span class="op" id="6656762">(</span><span class="ident" id="6656763">dbuf</span><span class="op" id="6656767">[</span><span class="num" id="6656768">0</span><span class="op" id="6656769">:</span><span class="ident" id="6656770">count</span><span class="op" id="6656775">]</span><span class="op" id="6656776">)</span><span class="op" id="6656777">,</span>&nbsp;<span class="ident" id="6656779">p</span><span class="op" id="6656780">.</span><span class="ident" id="6656781">decoded</span><span class="op" id="6656788">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6656792">if</span>&nbsp;<span class="ident" id="6656795">err</span>&nbsp;<span class="op" id="6656799">!=</span>&nbsp;<span class="ident" id="6656802">io</span><span class="op" id="6656804">.</span><span class="ident" id="6656805">EOF</span>&nbsp;<span class="op" id="6656809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656814">count</span><span class="op" id="6656819">,</span>&nbsp;<span class="ident" id="6656821">err</span>&nbsp;<span class="op" id="6656825">=</span>&nbsp;<span class="ident" id="6656827">decoder</span><span class="op" id="6656834">.</span><span class="ident" id="6656835">Read</span><span class="op" id="6656839">(</span><span class="ident" id="6656840">dbuf</span><span class="op" id="6656844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6656848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6656852">testEqual</span><span class="op" id="6656861">(</span><span class="ident" id="6656862">t</span><span class="op" id="6656863">,</span>&nbsp;<span class="string" id="6656865">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6656893">,</span>&nbsp;<span class="ident" id="6656895">p</span><span class="op" id="6656896">.</span><span class="ident" id="6656897">encoded</span><span class="op" id="6656904">,</span>&nbsp;<span class="ident" id="6656906">err</span><span class="op" id="6656909">,</span>&nbsp;<span class="ident" id="6656911">io</span><span class="op" id="6656913">.</span><span class="ident" id="6656914">EOF</span><span class="op" id="6656917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6656920">}</span><br>
<span class="lineno">130</span><span class="op" id="6656922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6656925">func</span>&nbsp;<span class="ident" id="6656930">TestDecoderBuffering</span><span class="op" id="6656950">(</span><span class="ident" id="6656951">t</span>&nbsp;<span class="op" id="6656953">*</span><span class="ident" id="6656954">testing</span><span class="op" id="6656961">.</span><span class="ident" id="6656962">T</span><span class="op" id="6656963">)</span>&nbsp;<span class="op" id="6656965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6656968">for</span>&nbsp;<span class="ident" id="6656972">bs</span>&nbsp;<span class="op" id="6656975">:=</span>&nbsp;<span class="num" id="6656978">1</span><span class="op" id="6656979">;</span>&nbsp;<span class="ident" id="6656981">bs</span>&nbsp;<span class="op" id="6656984">&lt;=</span>&nbsp;<span class="num" id="6656987">12</span><span class="op" id="6656989">;</span>&nbsp;<span class="ident" id="6656991">bs</span><span class="op" id="6656993">++</span>&nbsp;<span class="op" id="6656996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657000">decoder</span>&nbsp;<span class="op" id="6657008">:=</span>&nbsp;<span class="ident" id="6657011">NewDecoder</span><span class="op" id="6657021">(</span><span class="ident" id="6657022">StdEncoding</span><span class="op" id="6657033">,</span>&nbsp;<span class="ident" id="6657035">strings</span><span class="op" id="6657042">.</span><span class="ident" id="6657043">NewReader</span><span class="op" id="6657052">(</span><span class="ident" id="6657053">bigtest</span><span class="op" id="6657060">.</span><span class="ident" id="6657061">encoded</span><span class="op" id="6657068">)</span><span class="op" id="6657069">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657073">buf</span>&nbsp;<span class="op" id="6657077">:=</span>&nbsp;<span class="builtinfunc" id="6657080">make</span><span class="op" id="6657084">(</span><span class="op" id="6657085">[</span><span class="op" id="6657086">]</span><span class="builtintype" id="6657087">byte</span><span class="op" id="6657091">,</span>&nbsp;<span class="builtinfunc" id="6657093">len</span><span class="op" id="6657096">(</span><span class="ident" id="6657097">bigtest</span><span class="op" id="6657104">.</span><span class="ident" id="6657105">decoded</span><span class="op" id="6657112">)</span><span class="op" id="6657113">+</span><span class="num" id="6657114">12</span><span class="op" id="6657116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6657120">var</span>&nbsp;<span class="ident" id="6657124">total</span>&nbsp;<span class="builtintype" id="6657130">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6657136">for</span>&nbsp;<span class="ident" id="6657140">total</span>&nbsp;<span class="op" id="6657146">=</span>&nbsp;<span class="num" id="6657148">0</span><span class="op" id="6657149">;</span>&nbsp;<span class="ident" id="6657151">total</span>&nbsp;<span class="op" id="6657157">&lt;</span>&nbsp;<span class="builtinfunc" id="6657159">len</span><span class="op" id="6657162">(</span><span class="ident" id="6657163">bigtest</span><span class="op" id="6657170">.</span><span class="ident" id="6657171">decoded</span><span class="op" id="6657178">)</span><span class="op" id="6657179">;</span>&nbsp;<span class="op" id="6657181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657186">n</span><span class="op" id="6657187">,</span>&nbsp;<span class="ident" id="6657189">err</span>&nbsp;<span class="op" id="6657193">:=</span>&nbsp;<span class="ident" id="6657196">decoder</span><span class="op" id="6657203">.</span><span class="ident" id="6657204">Read</span><span class="op" id="6657208">(</span><span class="ident" id="6657209">buf</span><span class="op" id="6657212">[</span><span class="ident" id="6657213">total</span>&nbsp;<span class="op" id="6657219">:</span>&nbsp;<span class="ident" id="6657221">total</span><span class="op" id="6657226">+</span><span class="ident" id="6657227">bs</span><span class="op" id="6657229">]</span><span class="op" id="6657230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657235">testEqual</span><span class="op" id="6657244">(</span><span class="ident" id="6657245">t</span><span class="op" id="6657246">,</span>&nbsp;<span class="string" id="6657248">&#34;Read&nbsp;from&nbsp;%q&nbsp;at&nbsp;pos&nbsp;%d&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="6657293">,</span>&nbsp;<span class="ident" id="6657295">bigtest</span><span class="op" id="6657302">.</span><span class="ident" id="6657303">encoded</span><span class="op" id="6657310">,</span>&nbsp;<span class="ident" id="6657312">total</span><span class="op" id="6657317">,</span>&nbsp;<span class="ident" id="6657319">n</span><span class="op" id="6657320">,</span>&nbsp;<span class="ident" id="6657322">err</span><span class="op" id="6657325">,</span>&nbsp;<span class="builtintype" id="6657327">error</span><span class="op" id="6657332">(</span><span class="ident" id="6657333">nil</span><span class="op" id="6657336">)</span><span class="op" id="6657337">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657342">total</span>&nbsp;<span class="op" id="6657348">+=</span>&nbsp;<span class="ident" id="6657351">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657359">testEqual</span><span class="op" id="6657368">(</span><span class="ident" id="6657369">t</span><span class="op" id="6657370">,</span>&nbsp;<span class="string" id="6657372">&#34;Decoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6657405">,</span>&nbsp;<span class="ident" id="6657407">bs</span><span class="op" id="6657409">,</span>&nbsp;<span class="ident" id="6657411">bigtest</span><span class="op" id="6657418">.</span><span class="ident" id="6657419">encoded</span><span class="op" id="6657426">,</span>&nbsp;<span class="builtintype" id="6657428">string</span><span class="op" id="6657434">(</span><span class="ident" id="6657435">buf</span><span class="op" id="6657438">[</span><span class="num" id="6657439">0</span><span class="op" id="6657440">:</span><span class="ident" id="6657441">total</span><span class="op" id="6657446">]</span><span class="op" id="6657447">)</span><span class="op" id="6657448">,</span>&nbsp;<span class="ident" id="6657450">bigtest</span><span class="op" id="6657457">.</span><span class="ident" id="6657458">decoded</span><span class="op" id="6657465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657468">}</span><br>
<span class="lineno"></span><span class="op" id="6657470">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="6657473">func</span>&nbsp;<span class="ident" id="6657478">TestDecodeCorrupt</span><span class="op" id="6657495">(</span><span class="ident" id="6657496">t</span>&nbsp;<span class="op" id="6657498">*</span><span class="ident" id="6657499">testing</span><span class="op" id="6657506">.</span><span class="ident" id="6657507">T</span><span class="op" id="6657508">)</span>&nbsp;<span class="op" id="6657510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657513">testCases</span>&nbsp;<span class="op" id="6657523">:=</span>&nbsp;<span class="op" id="6657526">[</span><span class="op" id="6657527">]</span><span class="keyword" id="6657528">struct</span>&nbsp;<span class="op" id="6657535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657539">input</span>&nbsp;&nbsp;<span class="builtintype" id="6657546">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657555">offset</span>&nbsp;<span class="builtintype" id="6657562">int</span>&nbsp;<span class="comment" id="6657566">//&nbsp;-1&nbsp;means&nbsp;no&nbsp;corruption.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657594">}</span><span class="op" id="6657595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657599">{</span><span class="string" id="6657600">&#34;&#34;</span><span class="op" id="6657602">,</span>&nbsp;<span class="op" id="6657604">-</span><span class="num" id="6657605">1</span><span class="op" id="6657606">}</span><span class="op" id="6657607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657611">{</span><span class="string" id="6657612">&#34;!!!!&#34;</span><span class="op" id="6657618">,</span>&nbsp;<span class="num" id="6657620">0</span><span class="op" id="6657621">}</span><span class="op" id="6657622">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657626">{</span><span class="string" id="6657627">&#34;====&#34;</span><span class="op" id="6657633">,</span>&nbsp;<span class="num" id="6657635">0</span><span class="op" id="6657636">}</span><span class="op" id="6657637">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657641">{</span><span class="string" id="6657642">&#34;x===&#34;</span><span class="op" id="6657648">,</span>&nbsp;<span class="num" id="6657650">1</span><span class="op" id="6657651">}</span><span class="op" id="6657652">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657656">{</span><span class="string" id="6657657">&#34;=AAA&#34;</span><span class="op" id="6657663">,</span>&nbsp;<span class="num" id="6657665">0</span><span class="op" id="6657666">}</span><span class="op" id="6657667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657671">{</span><span class="string" id="6657672">&#34;A=AA&#34;</span><span class="op" id="6657678">,</span>&nbsp;<span class="num" id="6657680">1</span><span class="op" id="6657681">}</span><span class="op" id="6657682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657686">{</span><span class="string" id="6657687">&#34;AA=A&#34;</span><span class="op" id="6657693">,</span>&nbsp;<span class="num" id="6657695">2</span><span class="op" id="6657696">}</span><span class="op" id="6657697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657701">{</span><span class="string" id="6657702">&#34;AA==A&#34;</span><span class="op" id="6657709">,</span>&nbsp;<span class="num" id="6657711">4</span><span class="op" id="6657712">}</span><span class="op" id="6657713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657717">{</span><span class="string" id="6657718">&#34;AAA=AAAA&#34;</span><span class="op" id="6657728">,</span>&nbsp;<span class="num" id="6657730">4</span><span class="op" id="6657731">}</span><span class="op" id="6657732">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657736">{</span><span class="string" id="6657737">&#34;AAAAA&#34;</span><span class="op" id="6657744">,</span>&nbsp;<span class="num" id="6657746">4</span><span class="op" id="6657747">}</span><span class="op" id="6657748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657752">{</span><span class="string" id="6657753">&#34;AAAAAA&#34;</span><span class="op" id="6657761">,</span>&nbsp;<span class="num" id="6657763">4</span><span class="op" id="6657764">}</span><span class="op" id="6657765">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657769">{</span><span class="string" id="6657770">&#34;A=&#34;</span><span class="op" id="6657774">,</span>&nbsp;<span class="num" id="6657776">1</span><span class="op" id="6657777">}</span><span class="op" id="6657778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657782">{</span><span class="string" id="6657783">&#34;A==&#34;</span><span class="op" id="6657788">,</span>&nbsp;<span class="num" id="6657790">1</span><span class="op" id="6657791">}</span><span class="op" id="6657792">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657796">{</span><span class="string" id="6657797">&#34;AA=&#34;</span><span class="op" id="6657802">,</span>&nbsp;<span class="num" id="6657804">3</span><span class="op" id="6657805">}</span><span class="op" id="6657806">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657810">{</span><span class="string" id="6657811">&#34;AA==&#34;</span><span class="op" id="6657817">,</span>&nbsp;<span class="op" id="6657819">-</span><span class="num" id="6657820">1</span><span class="op" id="6657821">}</span><span class="op" id="6657822">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657826">{</span><span class="string" id="6657827">&#34;AAA=&#34;</span><span class="op" id="6657833">,</span>&nbsp;<span class="op" id="6657835">-</span><span class="num" id="6657836">1</span><span class="op" id="6657837">}</span><span class="op" id="6657838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657842">{</span><span class="string" id="6657843">&#34;AAAA&#34;</span><span class="op" id="6657849">,</span>&nbsp;<span class="op" id="6657851">-</span><span class="num" id="6657852">1</span><span class="op" id="6657853">}</span><span class="op" id="6657854">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657858">{</span><span class="string" id="6657859">&#34;AAAAAA=&#34;</span><span class="op" id="6657868">,</span>&nbsp;<span class="num" id="6657870">7</span><span class="op" id="6657871">}</span><span class="op" id="6657872">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657876">{</span><span class="string" id="6657877">&#34;YWJjZA=====&#34;</span><span class="op" id="6657890">,</span>&nbsp;<span class="num" id="6657892">8</span><span class="op" id="6657893">}</span><span class="op" id="6657894">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6657897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6657900">for</span>&nbsp;<span class="ident" id="6657904">_</span><span class="op" id="6657905">,</span>&nbsp;<span class="ident" id="6657907">tc</span>&nbsp;<span class="op" id="6657910">:=</span>&nbsp;<span class="keyword" id="6657913">range</span>&nbsp;<span class="ident" id="6657919">testCases</span>&nbsp;<span class="op" id="6657929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657933">dbuf</span>&nbsp;<span class="op" id="6657938">:=</span>&nbsp;<span class="builtinfunc" id="6657941">make</span><span class="op" id="6657945">(</span><span class="op" id="6657946">[</span><span class="op" id="6657947">]</span><span class="builtintype" id="6657948">byte</span><span class="op" id="6657952">,</span>&nbsp;<span class="ident" id="6657954">StdEncoding</span><span class="op" id="6657965">.</span><span class="ident" id="6657966">DecodedLen</span><span class="op" id="6657976">(</span><span class="builtinfunc" id="6657977">len</span><span class="op" id="6657980">(</span><span class="ident" id="6657981">tc</span><span class="op" id="6657983">.</span><span class="ident" id="6657984">input</span><span class="op" id="6657989">)</span><span class="op" id="6657990">)</span><span class="op" id="6657991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6657995">_</span><span class="op" id="6657996">,</span>&nbsp;<span class="ident" id="6657998">err</span>&nbsp;<span class="op" id="6658002">:=</span>&nbsp;<span class="ident" id="6658005">StdEncoding</span><span class="op" id="6658016">.</span><span class="ident" id="6658017">Decode</span><span class="op" id="6658023">(</span><span class="ident" id="6658024">dbuf</span><span class="op" id="6658028">,</span>&nbsp;<span class="op" id="6658030">[</span><span class="op" id="6658031">]</span><span class="builtintype" id="6658032">byte</span><span class="op" id="6658036">(</span><span class="ident" id="6658037">tc</span><span class="op" id="6658039">.</span><span class="ident" id="6658040">input</span><span class="op" id="6658045">)</span><span class="op" id="6658046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658050">if</span>&nbsp;<span class="ident" id="6658053">tc</span><span class="op" id="6658055">.</span><span class="ident" id="6658056">offset</span>&nbsp;<span class="op" id="6658063">==</span>&nbsp;<span class="op" id="6658066">-</span><span class="num" id="6658067">1</span>&nbsp;<span class="op" id="6658069">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658074">if</span>&nbsp;<span class="ident" id="6658077">err</span>&nbsp;<span class="op" id="6658081">!=</span>&nbsp;<span class="ident" id="6658084">nil</span>&nbsp;<span class="op" id="6658088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658094">t</span><span class="op" id="6658095">.</span><span class="ident" id="6658096">Error</span><span class="op" id="6658101">(</span><span class="string" id="6658102">&#34;Decoder&nbsp;wrongly&nbsp;detected&nbsp;coruption&nbsp;in&#34;</span><span class="op" id="6658141">,</span>&nbsp;<span class="ident" id="6658143">tc</span><span class="op" id="6658145">.</span><span class="ident" id="6658146">input</span><span class="op" id="6658151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6658156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658161">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6658172">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658176">switch</span>&nbsp;<span class="ident" id="6658183">err</span>&nbsp;<span class="op" id="6658187">:=</span>&nbsp;<span class="ident" id="6658190">err</span><span class="op" id="6658193">.</span><span class="op" id="6658194">(</span><span class="keyword" id="6658195">type</span><span class="op" id="6658199">)</span>&nbsp;<span class="op" id="6658201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658205">case</span>&nbsp;<span class="ident" id="6658210">CorruptInputError</span><span class="op" id="6658227">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658232">testEqual</span><span class="op" id="6658241">(</span><span class="ident" id="6658242">t</span><span class="op" id="6658243">,</span>&nbsp;<span class="string" id="6658245">&#34;Corruption&nbsp;in&nbsp;%q&nbsp;at&nbsp;offset&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6658285">,</span>&nbsp;<span class="ident" id="6658287">tc</span><span class="op" id="6658289">.</span><span class="ident" id="6658290">input</span><span class="op" id="6658295">,</span>&nbsp;<span class="builtintype" id="6658297">int</span><span class="op" id="6658300">(</span><span class="ident" id="6658301">err</span><span class="op" id="6658304">)</span><span class="op" id="6658305">,</span>&nbsp;<span class="ident" id="6658307">tc</span><span class="op" id="6658309">.</span><span class="ident" id="6658310">offset</span><span class="op" id="6658316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658320">default</span><span class="op" id="6658327">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658332">t</span><span class="op" id="6658333">.</span><span class="ident" id="6658334">Error</span><span class="op" id="6658339">(</span><span class="string" id="6658340">&#34;Decoder&nbsp;failed&nbsp;to&nbsp;detect&nbsp;corruption&nbsp;in&#34;</span><span class="op" id="6658380">,</span>&nbsp;<span class="ident" id="6658382">tc</span><span class="op" id="6658384">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6658388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6658391">}</span><br>
<span class="lineno"></span><span class="op" id="6658393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6658396">func</span>&nbsp;<span class="ident" id="6658401">TestBig</span><span class="op" id="6658408">(</span><span class="ident" id="6658409">t</span>&nbsp;<span class="op" id="6658411">*</span><span class="ident" id="6658412">testing</span><span class="op" id="6658419">.</span><span class="ident" id="6658420">T</span><span class="op" id="6658421">)</span>&nbsp;<span class="op" id="6658423">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658426">n</span>&nbsp;<span class="op" id="6658428">:=</span>&nbsp;<span class="num" id="6658431">3</span><span class="op" id="6658432">*</span><span class="num" id="6658433">1000</span>&nbsp;<span class="op" id="6658438">+</span>&nbsp;<span class="num" id="6658440">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658443">raw</span>&nbsp;<span class="op" id="6658447">:=</span>&nbsp;<span class="builtinfunc" id="6658450">make</span><span class="op" id="6658454">(</span><span class="op" id="6658455">[</span><span class="op" id="6658456">]</span><span class="builtintype" id="6658457">byte</span><span class="op" id="6658461">,</span>&nbsp;<span class="ident" id="6658463">n</span><span class="op" id="6658464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658467">const</span>&nbsp;<span class="ident" id="6658473">alpha</span>&nbsp;<span class="op" id="6658479">=</span>&nbsp;<span class="string" id="6658481">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658547">for</span>&nbsp;<span class="ident" id="6658551">i</span>&nbsp;<span class="op" id="6658553">:=</span>&nbsp;<span class="num" id="6658556">0</span><span class="op" id="6658557">;</span>&nbsp;<span class="ident" id="6658559">i</span>&nbsp;<span class="op" id="6658561">&lt;</span>&nbsp;<span class="ident" id="6658563">n</span><span class="op" id="6658564">;</span>&nbsp;<span class="ident" id="6658566">i</span><span class="op" id="6658567">++</span>&nbsp;<span class="op" id="6658570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658574">raw</span><span class="op" id="6658577">[</span><span class="ident" id="6658578">i</span><span class="op" id="6658579">]</span>&nbsp;<span class="op" id="6658581">=</span>&nbsp;<span class="ident" id="6658583">alpha</span><span class="op" id="6658588">[</span><span class="ident" id="6658589">i</span><span class="op" id="6658590">%</span><span class="builtinfunc" id="6658591">len</span><span class="op" id="6658594">(</span><span class="ident" id="6658595">alpha</span><span class="op" id="6658600">)</span><span class="op" id="6658601">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6658604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658607">encoded</span>&nbsp;<span class="op" id="6658615">:=</span>&nbsp;<span class="builtinfunc" id="6658618">new</span><span class="op" id="6658621">(</span><span class="ident" id="6658622">bytes</span><span class="op" id="6658627">.</span><span class="ident" id="6658628">Buffer</span><span class="op" id="6658634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658637">w</span>&nbsp;<span class="op" id="6658639">:=</span>&nbsp;<span class="ident" id="6658642">NewEncoder</span><span class="op" id="6658652">(</span><span class="ident" id="6658653">StdEncoding</span><span class="op" id="6658664">,</span>&nbsp;<span class="ident" id="6658666">encoded</span><span class="op" id="6658673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658676">nn</span><span class="op" id="6658678">,</span>&nbsp;<span class="ident" id="6658680">err</span>&nbsp;<span class="op" id="6658684">:=</span>&nbsp;<span class="ident" id="6658687">w</span><span class="op" id="6658688">.</span><span class="ident" id="6658689">Write</span><span class="op" id="6658694">(</span><span class="ident" id="6658695">raw</span><span class="op" id="6658698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658701">if</span>&nbsp;<span class="ident" id="6658704">nn</span>&nbsp;<span class="op" id="6658707">!=</span>&nbsp;<span class="ident" id="6658710">n</span>&nbsp;<span class="op" id="6658712">||</span>&nbsp;<span class="ident" id="6658715">err</span>&nbsp;<span class="op" id="6658719">!=</span>&nbsp;<span class="ident" id="6658722">nil</span>&nbsp;<span class="op" id="6658726">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658730">t</span><span class="op" id="6658731">.</span><span class="ident" id="6658732">Fatalf</span><span class="op" id="6658738">(</span><span class="string" id="6658739">&#34;Encoder.Write(raw)&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="6658781">,</span>&nbsp;<span class="ident" id="6658783">nn</span><span class="op" id="6658785">,</span>&nbsp;<span class="ident" id="6658787">err</span><span class="op" id="6658790">,</span>&nbsp;<span class="ident" id="6658792">n</span><span class="op" id="6658793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6658796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658799">err</span>&nbsp;<span class="op" id="6658803">=</span>&nbsp;<span class="ident" id="6658805">w</span><span class="op" id="6658806">.</span><span class="ident" id="6658807">Close</span><span class="op" id="6658812">(</span><span class="op" id="6658813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658816">if</span>&nbsp;<span class="ident" id="6658819">err</span>&nbsp;<span class="op" id="6658823">!=</span>&nbsp;<span class="ident" id="6658826">nil</span>&nbsp;<span class="op" id="6658830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658834">t</span><span class="op" id="6658835">.</span><span class="ident" id="6658836">Fatalf</span><span class="op" id="6658842">(</span><span class="string" id="6658843">&#34;Encoder.Close()&nbsp;=&nbsp;%v&nbsp;want&nbsp;nil&#34;</span><span class="op" id="6658874">,</span>&nbsp;<span class="ident" id="6658876">err</span><span class="op" id="6658879">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6658882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658885">decoded</span><span class="op" id="6658892">,</span>&nbsp;<span class="ident" id="6658894">err</span>&nbsp;<span class="op" id="6658898">:=</span>&nbsp;<span class="ident" id="6658901">ioutil</span><span class="op" id="6658907">.</span><span class="ident" id="6658908">ReadAll</span><span class="op" id="6658915">(</span><span class="ident" id="6658916">NewDecoder</span><span class="op" id="6658926">(</span><span class="ident" id="6658927">StdEncoding</span><span class="op" id="6658938">,</span>&nbsp;<span class="ident" id="6658940">encoded</span><span class="op" id="6658947">)</span><span class="op" id="6658948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6658951">if</span>&nbsp;<span class="ident" id="6658954">err</span>&nbsp;<span class="op" id="6658958">!=</span>&nbsp;<span class="ident" id="6658961">nil</span>&nbsp;<span class="op" id="6658965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6658969">t</span><span class="op" id="6658970">.</span><span class="ident" id="6658971">Fatalf</span><span class="op" id="6658977">(</span><span class="string" id="6658978">&#34;ioutil.ReadAll(NewDecoder(...)):&nbsp;%v&#34;</span><span class="op" id="6659015">,</span>&nbsp;<span class="ident" id="6659017">err</span><span class="op" id="6659020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6659023">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659027">if</span>&nbsp;<span class="op" id="6659030">!</span><span class="ident" id="6659031">bytes</span><span class="op" id="6659036">.</span><span class="ident" id="6659037">Equal</span><span class="op" id="6659042">(</span><span class="ident" id="6659043">raw</span><span class="op" id="6659046">,</span>&nbsp;<span class="ident" id="6659048">decoded</span><span class="op" id="6659055">)</span>&nbsp;<span class="op" id="6659057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659061">var</span>&nbsp;<span class="ident" id="6659065">i</span>&nbsp;<span class="builtintype" id="6659067">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659073">for</span>&nbsp;<span class="ident" id="6659077">i</span>&nbsp;<span class="op" id="6659079">=</span>&nbsp;<span class="num" id="6659081">0</span><span class="op" id="6659082">;</span>&nbsp;<span class="ident" id="6659084">i</span>&nbsp;<span class="op" id="6659086">&lt;</span>&nbsp;<span class="builtinfunc" id="6659088">len</span><span class="op" id="6659091">(</span><span class="ident" id="6659092">decoded</span><span class="op" id="6659099">)</span>&nbsp;<span class="op" id="6659101">&amp;&amp;</span>&nbsp;<span class="ident" id="6659104">i</span>&nbsp;<span class="op" id="6659106">&lt;</span>&nbsp;<span class="builtinfunc" id="6659108">len</span><span class="op" id="6659111">(</span><span class="ident" id="6659112">raw</span><span class="op" id="6659115">)</span><span class="op" id="6659116">;</span>&nbsp;<span class="ident" id="6659118">i</span><span class="op" id="6659119">++</span>&nbsp;<span class="op" id="6659122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659127">if</span>&nbsp;<span class="ident" id="6659130">decoded</span><span class="op" id="6659137">[</span><span class="ident" id="6659138">i</span><span class="op" id="6659139">]</span>&nbsp;<span class="op" id="6659141">!=</span>&nbsp;<span class="ident" id="6659144">raw</span><span class="op" id="6659147">[</span><span class="ident" id="6659148">i</span><span class="op" id="6659149">]</span>&nbsp;<span class="op" id="6659151">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659157">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6659166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6659170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659174">t</span><span class="op" id="6659175">.</span><span class="ident" id="6659176">Errorf</span><span class="op" id="6659182">(</span><span class="string" id="6659183">&#34;Decode(Encode(%d-byte&nbsp;string))&nbsp;failed&nbsp;at&nbsp;offset&nbsp;%d&#34;</span><span class="op" id="6659235">,</span>&nbsp;<span class="ident" id="6659237">n</span><span class="op" id="6659238">,</span>&nbsp;<span class="ident" id="6659240">i</span><span class="op" id="6659241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6659244">}</span><br>
<span class="lineno">220</span><span class="op" id="6659246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6659249">func</span>&nbsp;<span class="ident" id="6659254">TestNewLineCharacters</span><span class="op" id="6659275">(</span><span class="ident" id="6659276">t</span>&nbsp;<span class="op" id="6659278">*</span><span class="ident" id="6659279">testing</span><span class="op" id="6659286">.</span><span class="ident" id="6659287">T</span><span class="op" id="6659288">)</span>&nbsp;<span class="op" id="6659290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6659293">//&nbsp;Each&nbsp;of&nbsp;these&nbsp;should&nbsp;decode&nbsp;to&nbsp;the&nbsp;string&nbsp;&#34;sure&#34;,&nbsp;without&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659363">const</span>&nbsp;<span class="ident" id="6659369">expected</span>&nbsp;<span class="op" id="6659378">=</span>&nbsp;<span class="string" id="6659380">&#34;sure&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659388">examples</span>&nbsp;<span class="op" id="6659397">:=</span>&nbsp;<span class="op" id="6659400">[</span><span class="op" id="6659401">]</span><span class="builtintype" id="6659402">string</span><span class="op" id="6659408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6659412">&#34;c3VyZQ==&#34;</span><span class="op" id="6659422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6659426">&#34;c3VyZQ==\r&#34;</span><span class="op" id="6659438">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6659442">&#34;c3VyZQ==\n&#34;</span><span class="op" id="6659454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6659458">&#34;c3VyZQ==\r\n&#34;</span><span class="op" id="6659472">,</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6659476">&#34;c3VyZ\r\nQ==&#34;</span><span class="op" id="6659490">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6659494">&#34;c3V\ryZ\nQ==&#34;</span><span class="op" id="6659508">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6659512">&#34;c3V\nyZ\rQ==&#34;</span><span class="op" id="6659526">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6659530">&#34;c3VyZ\nQ==&#34;</span><span class="op" id="6659542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6659546">&#34;c3VyZQ\n==&#34;</span><span class="op" id="6659558">,</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6659562">&#34;c3VyZQ=\n=&#34;</span><span class="op" id="6659574">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6659578">&#34;c3VyZQ=\r\n\r\n=&#34;</span><span class="op" id="6659596">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6659599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659602">for</span>&nbsp;<span class="ident" id="6659606">_</span><span class="op" id="6659607">,</span>&nbsp;<span class="ident" id="6659609">e</span>&nbsp;<span class="op" id="6659611">:=</span>&nbsp;<span class="keyword" id="6659614">range</span>&nbsp;<span class="ident" id="6659620">examples</span>&nbsp;<span class="op" id="6659629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659633">buf</span><span class="op" id="6659636">,</span>&nbsp;<span class="ident" id="6659638">err</span>&nbsp;<span class="op" id="6659642">:=</span>&nbsp;<span class="ident" id="6659645">StdEncoding</span><span class="op" id="6659656">.</span><span class="ident" id="6659657">DecodeString</span><span class="op" id="6659669">(</span><span class="ident" id="6659670">e</span><span class="op" id="6659671">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659675">if</span>&nbsp;<span class="ident" id="6659678">err</span>&nbsp;<span class="op" id="6659682">!=</span>&nbsp;<span class="ident" id="6659685">nil</span>&nbsp;<span class="op" id="6659689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659694">t</span><span class="op" id="6659695">.</span><span class="ident" id="6659696">Errorf</span><span class="op" id="6659702">(</span><span class="string" id="6659703">&#34;Decode(%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6659726">,</span>&nbsp;<span class="ident" id="6659728">e</span><span class="op" id="6659729">,</span>&nbsp;<span class="ident" id="6659731">err</span><span class="op" id="6659734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659739">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6659750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6659754">if</span>&nbsp;<span class="ident" id="6659757">s</span>&nbsp;<span class="op" id="6659759">:=</span>&nbsp;<span class="builtintype" id="6659762">string</span><span class="op" id="6659768">(</span><span class="ident" id="6659769">buf</span><span class="op" id="6659772">)</span><span class="op" id="6659773">;</span>&nbsp;<span class="ident" id="6659775">s</span>&nbsp;<span class="op" id="6659777">!=</span>&nbsp;<span class="ident" id="6659780">expected</span>&nbsp;<span class="op" id="6659789">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659794">t</span><span class="op" id="6659795">.</span><span class="ident" id="6659796">Errorf</span><span class="op" id="6659802">(</span><span class="string" id="6659803">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6659829">,</span>&nbsp;<span class="ident" id="6659831">e</span><span class="op" id="6659832">,</span>&nbsp;<span class="ident" id="6659834">s</span><span class="op" id="6659835">,</span>&nbsp;<span class="ident" id="6659837">expected</span><span class="op" id="6659845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6659849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6659852">}</span><br>
<span class="lineno"></span><span class="op" id="6659854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="6659857">type</span>&nbsp;<span class="ident" id="6659862">nextRead</span>&nbsp;<span class="keyword" id="6659871">struct</span>&nbsp;<span class="op" id="6659878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659881">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6659885">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6659891">//&nbsp;bytes&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6659911">err</span>&nbsp;<span class="builtintype" id="6659915">error</span>&nbsp;<span class="comment" id="6659921">//&nbsp;error&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="op" id="6659940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="6659943">//&nbsp;faultInjectReader&nbsp;returns&nbsp;data&nbsp;from&nbsp;source,&nbsp;rate-limited</span><br>
<span class="lineno"></span><span class="comment" id="6660003">//&nbsp;and&nbsp;with&nbsp;the&nbsp;errors&nbsp;as&nbsp;written&nbsp;to&nbsp;nextc.</span><br>
<span class="lineno"></span><span class="keyword" id="6660047">type</span>&nbsp;<span class="ident" id="6660052">faultInjectReader</span>&nbsp;<span class="keyword" id="6660070">struct</span>&nbsp;<span class="op" id="6660077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660080">source</span>&nbsp;<span class="builtintype" id="6660087">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660095">nextc</span>&nbsp;&nbsp;<span class="op" id="6660102">&lt;-</span><span class="keyword" id="6660104">chan</span>&nbsp;<span class="ident" id="6660109">nextRead</span><br>
<span class="lineno">260</span><span class="op" id="6660118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6660121">func</span>&nbsp;<span class="op" id="6660126">(</span><span class="ident" id="6660127">r</span>&nbsp;<span class="op" id="6660129">*</span><span class="ident" id="6660130">faultInjectReader</span><span class="op" id="6660147">)</span>&nbsp;<span class="ident" id="6660149">Read</span><span class="op" id="6660153">(</span><span class="ident" id="6660154">p</span>&nbsp;<span class="op" id="6660156">[</span><span class="op" id="6660157">]</span><span class="builtintype" id="6660158">byte</span><span class="op" id="6660162">)</span>&nbsp;<span class="op" id="6660164">(</span><span class="builtintype" id="6660165">int</span><span class="op" id="6660168">,</span>&nbsp;<span class="builtintype" id="6660170">error</span><span class="op" id="6660175">)</span>&nbsp;<span class="op" id="6660177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660180">nr</span>&nbsp;<span class="op" id="6660183">:=</span>&nbsp;<span class="op" id="6660186">&lt;-</span><span class="ident" id="6660188">r</span><span class="op" id="6660189">.</span><span class="ident" id="6660190">nextc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6660197">if</span>&nbsp;<span class="builtinfunc" id="6660200">len</span><span class="op" id="6660203">(</span><span class="ident" id="6660204">p</span><span class="op" id="6660205">)</span>&nbsp;<span class="op" id="6660207">&gt;</span>&nbsp;<span class="ident" id="6660209">nr</span><span class="op" id="6660211">.</span><span class="ident" id="6660212">n</span>&nbsp;<span class="op" id="6660214">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660218">p</span>&nbsp;<span class="op" id="6660220">=</span>&nbsp;<span class="ident" id="6660222">p</span><span class="op" id="6660223">[</span><span class="op" id="6660224">:</span><span class="ident" id="6660225">nr</span><span class="op" id="6660227">.</span><span class="ident" id="6660228">n</span><span class="op" id="6660229">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6660232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660235">n</span>&nbsp;<span class="op" id="6660237">:=</span>&nbsp;<span class="builtinfunc" id="6660240">copy</span><span class="op" id="6660244">(</span><span class="ident" id="6660245">p</span><span class="op" id="6660246">,</span>&nbsp;<span class="ident" id="6660248">r</span><span class="op" id="6660249">.</span><span class="ident" id="6660250">source</span><span class="op" id="6660256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660259">r</span><span class="op" id="6660260">.</span><span class="ident" id="6660261">source</span>&nbsp;<span class="op" id="6660268">=</span>&nbsp;<span class="ident" id="6660270">r</span><span class="op" id="6660271">.</span><span class="ident" id="6660272">source</span><span class="op" id="6660278">[</span><span class="ident" id="6660279">n</span><span class="op" id="6660280">:</span><span class="op" id="6660281">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6660284">return</span>&nbsp;<span class="ident" id="6660291">n</span><span class="op" id="6660292">,</span>&nbsp;<span class="ident" id="6660294">nr</span><span class="op" id="6660296">.</span><span class="ident" id="6660297">err</span><br>
<span class="lineno">270</span><span class="op" id="6660301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6660304">//&nbsp;tests&nbsp;that&nbsp;we&nbsp;don&#39;t&nbsp;ignore&nbsp;errors&nbsp;from&nbsp;our&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span><span class="keyword" id="6660368">func</span>&nbsp;<span class="ident" id="6660373">TestDecoderIssue3577</span><span class="op" id="6660393">(</span><span class="ident" id="6660394">t</span>&nbsp;<span class="op" id="6660396">*</span><span class="ident" id="6660397">testing</span><span class="op" id="6660404">.</span><span class="ident" id="6660405">T</span><span class="op" id="6660406">)</span>&nbsp;<span class="op" id="6660408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660411">next</span>&nbsp;<span class="op" id="6660416">:=</span>&nbsp;<span class="builtinfunc" id="6660419">make</span><span class="op" id="6660423">(</span><span class="keyword" id="6660424">chan</span>&nbsp;<span class="ident" id="6660429">nextRead</span><span class="op" id="6660437">,</span>&nbsp;<span class="num" id="6660439">10</span><span class="op" id="6660441">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660444">wantErr</span>&nbsp;<span class="op" id="6660452">:=</span>&nbsp;<span class="ident" id="6660455">errors</span><span class="op" id="6660461">.</span><span class="ident" id="6660462">New</span><span class="op" id="6660465">(</span><span class="string" id="6660466">&#34;my&nbsp;error&#34;</span><span class="op" id="6660476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660479">next</span>&nbsp;<span class="op" id="6660484">&lt;-</span>&nbsp;<span class="ident" id="6660487">nextRead</span><span class="op" id="6660495">{</span><span class="num" id="6660496">5</span><span class="op" id="6660497">,</span>&nbsp;<span class="ident" id="6660499">nil</span><span class="op" id="6660502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660505">next</span>&nbsp;<span class="op" id="6660510">&lt;-</span>&nbsp;<span class="ident" id="6660513">nextRead</span><span class="op" id="6660521">{</span><span class="num" id="6660522">10</span><span class="op" id="6660524">,</span>&nbsp;<span class="ident" id="6660526">wantErr</span><span class="op" id="6660533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660536">next</span>&nbsp;<span class="op" id="6660541">&lt;-</span>&nbsp;<span class="ident" id="6660544">nextRead</span><span class="op" id="6660552">{</span><span class="num" id="6660553">0</span><span class="op" id="6660554">,</span>&nbsp;<span class="ident" id="6660556">wantErr</span><span class="op" id="6660563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660566">d</span>&nbsp;<span class="op" id="6660568">:=</span>&nbsp;<span class="ident" id="6660571">NewDecoder</span><span class="op" id="6660581">(</span><span class="ident" id="6660582">StdEncoding</span><span class="op" id="6660593">,</span>&nbsp;<span class="op" id="6660595">&amp;</span><span class="ident" id="6660596">faultInjectReader</span><span class="op" id="6660613">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660617">source</span><span class="op" id="6660623">:</span>&nbsp;<span class="string" id="6660625">&#34;VHdhcyBicmlsbGlnLCBhbmQgdGhlIHNsaXRoeSB0b3Zlcw==&#34;</span><span class="op" id="6660675">,</span>&nbsp;<span class="comment" id="6660677">//&nbsp;twas&nbsp;brillig...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660698">nextc</span><span class="op" id="6660703">:</span>&nbsp;&nbsp;<span class="ident" id="6660706">next</span><span class="op" id="6660710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6660713">}</span><span class="op" id="6660714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660717">errc</span>&nbsp;<span class="op" id="6660722">:=</span>&nbsp;<span class="builtinfunc" id="6660725">make</span><span class="op" id="6660729">(</span><span class="keyword" id="6660730">chan</span>&nbsp;<span class="builtintype" id="6660735">error</span><span class="op" id="6660740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6660743">go</span>&nbsp;<span class="keyword" id="6660746">func</span><span class="op" id="6660750">(</span><span class="op" id="6660751">)</span>&nbsp;<span class="op" id="6660753">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660757">_</span><span class="op" id="6660758">,</span>&nbsp;<span class="ident" id="6660760">err</span>&nbsp;<span class="op" id="6660764">:=</span>&nbsp;<span class="ident" id="6660767">ioutil</span><span class="op" id="6660773">.</span><span class="ident" id="6660774">ReadAll</span><span class="op" id="6660781">(</span><span class="ident" id="6660782">d</span><span class="op" id="6660783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660787">errc</span>&nbsp;<span class="op" id="6660792">&lt;-</span>&nbsp;<span class="ident" id="6660795">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6660800">}</span><span class="op" id="6660801">(</span><span class="op" id="6660802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6660805">select</span>&nbsp;<span class="op" id="6660812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6660815">case</span>&nbsp;<span class="ident" id="6660820">err</span>&nbsp;<span class="op" id="6660824">:=</span>&nbsp;<span class="op" id="6660827">&lt;-</span><span class="ident" id="6660829">errc</span><span class="op" id="6660833">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6660837">if</span>&nbsp;<span class="ident" id="6660840">err</span>&nbsp;<span class="op" id="6660844">!=</span>&nbsp;<span class="ident" id="6660847">wantErr</span>&nbsp;<span class="op" id="6660855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660860">t</span><span class="op" id="6660861">.</span><span class="ident" id="6660862">Errorf</span><span class="op" id="6660868">(</span><span class="string" id="6660869">&#34;got&nbsp;error&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6660892">,</span>&nbsp;<span class="ident" id="6660894">err</span><span class="op" id="6660897">,</span>&nbsp;<span class="ident" id="6660899">wantErr</span><span class="op" id="6660906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6660910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6660913">case</span>&nbsp;<span class="op" id="6660918">&lt;-</span><span class="ident" id="6660920">time</span><span class="op" id="6660924">.</span><span class="ident" id="6660925">After</span><span class="op" id="6660930">(</span><span class="num" id="6660931">5</span>&nbsp;<span class="op" id="6660933">*</span>&nbsp;<span class="ident" id="6660935">time</span><span class="op" id="6660939">.</span><span class="ident" id="6660940">Second</span><span class="op" id="6660946">)</span><span class="op" id="6660947">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6660951">t</span><span class="op" id="6660952">.</span><span class="ident" id="6660953">Errorf</span><span class="op" id="6660959">(</span><span class="string" id="6660960">&#34;timeout;&nbsp;Decoder&nbsp;blocked&nbsp;without&nbsp;returning&nbsp;an&nbsp;error&#34;</span><span class="op" id="6661013">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6661016">}</span><br>
<span class="lineno"></span><span class="op" id="6661018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6661021">func</span>&nbsp;<span class="ident" id="6661026">TestDecoderIssue4779</span><span class="op" id="6661046">(</span><span class="ident" id="6661047">t</span>&nbsp;<span class="op" id="6661049">*</span><span class="ident" id="6661050">testing</span><span class="op" id="6661057">.</span><span class="ident" id="6661058">T</span><span class="op" id="6661059">)</span>&nbsp;<span class="op" id="6661061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6661064">encoded</span>&nbsp;<span class="op" id="6661072">:=</span>&nbsp;<span class="string" id="6661075">`CP/EAT8AAAEF<br>
<span class="lineno">300</span>AQEBAQEBAAAAAAAAAAMAAQIEBQYHCAkKCwEAAQUBAQEBAQEAAAAAAAAAAQACAwQFBgcICQoLEAAB<br>
<span class="lineno"></span>BAEDAgQCBQcGCAUDDDMBAAIRAwQhEjEFQVFhEyJxgTIGFJGhsUIjJBVSwWIzNHKC0UMHJZJT8OHx<br>
<span class="lineno"></span>Y3M1FqKygyZEk1RkRcKjdDYX0lXiZfKzhMPTdePzRieUpIW0lcTU5PSltcXV5fVWZnaGlqa2xtbm<br>
<span class="lineno"></span>9jdHV2d3h5ent8fX5/cRAAICAQIEBAMEBQYHBwYFNQEAAhEDITESBEFRYXEiEwUygZEUobFCI8FS<br>
<span class="lineno"></span>0fAzJGLhcoKSQ1MVY3M08SUGFqKygwcmNcLSRJNUoxdkRVU2dGXi8rOEw9N14/NGlKSFtJXE1OT0<br>
<span class="lineno">305</span>pbXF1eX1VmZ2hpamtsbW5vYnN0dXZ3eHl6e3x//aAAwDAQACEQMRAD8A9VSSSSUpJJJJSkkkJ+Tj<br>
<span class="lineno"></span>1kiy1jCJJDnAcCTykpKkuQ6p/jN6FgmxlNduXawwAzaGH+V6jn/R/wCt71zdn+N/qL3kVYFNYB4N<br>
<span class="lineno"></span>ji6PDVjWpKp9TSXnvTf8bFNjg3qOEa2n6VlLpj/rT/pf567DpX1i6L1hs9Py67X8mqdtg/rUWbbf<br>
<span class="lineno"></span>+gkp0kkkklKSSSSUpJJJJT//0PVUkkklKVLq3WMDpGI7KzrNjADtYNXvI/Mqr/Pd/q9W3vaxjnvM<br>
<span class="lineno"></span>NaCXE9gNSvGPrf8AWS3qmba5jjsJhoB0DAf0NDf6sevf+/lf8Hj0JJATfWT6/dV6oXU1uOLQeKKn<br>
<span class="lineno">310</span>EQP+Hubtfe/+R7Mf/g7f5xcocp++Z11JMCJPgFBxOg7/AOuqDx8I/ikpkXkmSdU8mJIJA/O8EMAy<br>
<span class="lineno"></span>j+mSARB/17pKVXYWHXjsj7yIex0PadzXMO1zT5KHoNA3HT8ietoGhgjsfA+CSnvvqh/jJtqsrwOv<br>
<span class="lineno"></span>2b6NGNzXfTYexzJ+nU7/ALkf4P8Awv6P9KvTQQ4AgyDqCF85Pho3CTB7eHwXoH+LT65uZbX9X+o2<br>
<span class="lineno"></span>bqbPb06551Y4<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662106">encodedShort</span>&nbsp;<span class="op" id="6662119">:=</span>&nbsp;<span class="ident" id="6662122">strings</span><span class="op" id="6662129">.</span><span class="ident" id="6662130">Replace</span><span class="op" id="6662137">(</span><span class="ident" id="6662138">encoded</span><span class="op" id="6662145">,</span>&nbsp;<span class="string" id="6662147">&#34;\n&#34;</span><span class="op" id="6662151">,</span>&nbsp;<span class="string" id="6662153">&#34;&#34;</span><span class="op" id="6662155">,</span>&nbsp;<span class="op" id="6662157">-</span><span class="num" id="6662158">1</span><span class="op" id="6662159">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662163">dec</span>&nbsp;<span class="op" id="6662167">:=</span>&nbsp;<span class="ident" id="6662170">NewDecoder</span><span class="op" id="6662180">(</span><span class="ident" id="6662181">StdEncoding</span><span class="op" id="6662192">,</span>&nbsp;<span class="ident" id="6662194">strings</span><span class="op" id="6662201">.</span><span class="ident" id="6662202">NewReader</span><span class="op" id="6662211">(</span><span class="ident" id="6662212">encoded</span><span class="op" id="6662219">)</span><span class="op" id="6662220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662223">res1</span><span class="op" id="6662227">,</span>&nbsp;<span class="ident" id="6662229">err</span>&nbsp;<span class="op" id="6662233">:=</span>&nbsp;<span class="ident" id="6662236">ioutil</span><span class="op" id="6662242">.</span><span class="ident" id="6662243">ReadAll</span><span class="op" id="6662250">(</span><span class="ident" id="6662251">dec</span><span class="op" id="6662254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6662257">if</span>&nbsp;<span class="ident" id="6662260">err</span>&nbsp;<span class="op" id="6662264">!=</span>&nbsp;<span class="ident" id="6662267">nil</span>&nbsp;<span class="op" id="6662271">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662275">t</span><span class="op" id="6662276">.</span><span class="ident" id="6662277">Errorf</span><span class="op" id="6662283">(</span><span class="string" id="6662284">&#34;ReadAll&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6662304">,</span>&nbsp;<span class="ident" id="6662306">err</span><span class="op" id="6662309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6662312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662316">dec</span>&nbsp;<span class="op" id="6662320">=</span>&nbsp;<span class="ident" id="6662322">NewDecoder</span><span class="op" id="6662332">(</span><span class="ident" id="6662333">StdEncoding</span><span class="op" id="6662344">,</span>&nbsp;<span class="ident" id="6662346">strings</span><span class="op" id="6662353">.</span><span class="ident" id="6662354">NewReader</span><span class="op" id="6662363">(</span><span class="ident" id="6662364">encodedShort</span><span class="op" id="6662376">)</span><span class="op" id="6662377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6662380">var</span>&nbsp;<span class="ident" id="6662384">res2</span>&nbsp;<span class="op" id="6662389">[</span><span class="op" id="6662390">]</span><span class="builtintype" id="6662391">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662397">res2</span><span class="op" id="6662401">,</span>&nbsp;<span class="ident" id="6662403">err</span>&nbsp;<span class="op" id="6662407">=</span>&nbsp;<span class="ident" id="6662409">ioutil</span><span class="op" id="6662415">.</span><span class="ident" id="6662416">ReadAll</span><span class="op" id="6662423">(</span><span class="ident" id="6662424">dec</span><span class="op" id="6662427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6662430">if</span>&nbsp;<span class="ident" id="6662433">err</span>&nbsp;<span class="op" id="6662437">!=</span>&nbsp;<span class="ident" id="6662440">nil</span>&nbsp;<span class="op" id="6662444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662448">t</span><span class="op" id="6662449">.</span><span class="ident" id="6662450">Errorf</span><span class="op" id="6662456">(</span><span class="string" id="6662457">&#34;ReadAll&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6662477">,</span>&nbsp;<span class="ident" id="6662479">err</span><span class="op" id="6662482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6662485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6662489">if</span>&nbsp;<span class="op" id="6662492">!</span><span class="ident" id="6662493">bytes</span><span class="op" id="6662498">.</span><span class="ident" id="6662499">Equal</span><span class="op" id="6662504">(</span><span class="ident" id="6662505">res1</span><span class="op" id="6662509">,</span>&nbsp;<span class="ident" id="6662511">res2</span><span class="op" id="6662515">)</span>&nbsp;<span class="op" id="6662517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662521">t</span><span class="op" id="6662522">.</span><span class="ident" id="6662523">Error</span><span class="op" id="6662528">(</span><span class="string" id="6662529">&#34;Decoded&nbsp;results&nbsp;not&nbsp;equal&#34;</span><span class="op" id="6662556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6662559">}</span><br>
<span class="lineno"></span><span class="op" id="6662561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="6662564">func</span>&nbsp;<span class="ident" id="6662569">TestDecoderIssue7733</span><span class="op" id="6662589">(</span><span class="ident" id="6662590">t</span>&nbsp;<span class="op" id="6662592">*</span><span class="ident" id="6662593">testing</span><span class="op" id="6662600">.</span><span class="ident" id="6662601">T</span><span class="op" id="6662602">)</span>&nbsp;<span class="op" id="6662604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662607">s</span><span class="op" id="6662608">,</span>&nbsp;<span class="ident" id="6662610">err</span>&nbsp;<span class="op" id="6662614">:=</span>&nbsp;<span class="ident" id="6662617">StdEncoding</span><span class="op" id="6662628">.</span><span class="ident" id="6662629">DecodeString</span><span class="op" id="6662641">(</span><span class="string" id="6662642">&#34;YWJjZA=====&#34;</span><span class="op" id="6662655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662658">want</span>&nbsp;<span class="op" id="6662663">:=</span>&nbsp;<span class="ident" id="6662666">CorruptInputError</span><span class="op" id="6662683">(</span><span class="num" id="6662684">8</span><span class="op" id="6662685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6662688">if</span>&nbsp;<span class="op" id="6662691">!</span><span class="ident" id="6662692">reflect</span><span class="op" id="6662699">.</span><span class="ident" id="6662700">DeepEqual</span><span class="op" id="6662709">(</span><span class="ident" id="6662710">want</span><span class="op" id="6662714">,</span>&nbsp;<span class="ident" id="6662716">err</span><span class="op" id="6662719">)</span>&nbsp;<span class="op" id="6662721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662725">t</span><span class="op" id="6662726">.</span><span class="ident" id="6662727">Errorf</span><span class="op" id="6662733">(</span><span class="string" id="6662734">&#34;Error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;CorruptInputError(8)&#34;</span><span class="op" id="6662773">,</span>&nbsp;<span class="ident" id="6662775">err</span><span class="op" id="6662778">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6662781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6662784">if</span>&nbsp;<span class="builtintype" id="6662787">string</span><span class="op" id="6662793">(</span><span class="ident" id="6662794">s</span><span class="op" id="6662795">)</span>&nbsp;<span class="op" id="6662797">!=</span>&nbsp;<span class="string" id="6662800">&#34;abcd&#34;</span>&nbsp;<span class="op" id="6662807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662811">t</span><span class="op" id="6662812">.</span><span class="ident" id="6662813">Errorf</span><span class="op" id="6662819">(</span><span class="string" id="6662820">&#34;DecodeString&nbsp;=&nbsp;%q;&nbsp;want&nbsp;abcd&#34;</span><span class="op" id="6662850">,</span>&nbsp;<span class="ident" id="6662852">s</span><span class="op" id="6662853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6662856">}</span><br>
<span class="lineno"></span><span class="op" id="6662858">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="6662861">func</span>&nbsp;<span class="ident" id="6662866">BenchmarkEncodeToString</span><span class="op" id="6662889">(</span><span class="ident" id="6662890">b</span>&nbsp;<span class="op" id="6662892">*</span><span class="ident" id="6662893">testing</span><span class="op" id="6662900">.</span><span class="ident" id="6662901">B</span><span class="op" id="6662902">)</span>&nbsp;<span class="op" id="6662904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662907">data</span>&nbsp;<span class="op" id="6662912">:=</span>&nbsp;<span class="builtinfunc" id="6662915">make</span><span class="op" id="6662919">(</span><span class="op" id="6662920">[</span><span class="op" id="6662921">]</span><span class="builtintype" id="6662922">byte</span><span class="op" id="6662926">,</span>&nbsp;<span class="num" id="6662928">8192</span><span class="op" id="6662932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662935">b</span><span class="op" id="6662936">.</span><span class="ident" id="6662937">SetBytes</span><span class="op" id="6662945">(</span><span class="ident" id="6662946">int64</span><span class="op" id="6662951">(</span><span class="builtinfunc" id="6662952">len</span><span class="op" id="6662955">(</span><span class="ident" id="6662956">data</span><span class="op" id="6662960">)</span><span class="op" id="6662961">)</span><span class="op" id="6662962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6662965">for</span>&nbsp;<span class="ident" id="6662969">i</span>&nbsp;<span class="op" id="6662971">:=</span>&nbsp;<span class="num" id="6662974">0</span><span class="op" id="6662975">;</span>&nbsp;<span class="ident" id="6662977">i</span>&nbsp;<span class="op" id="6662979">&lt;</span>&nbsp;<span class="ident" id="6662981">b</span><span class="op" id="6662982">.</span><span class="ident" id="6662983">N</span><span class="op" id="6662984">;</span>&nbsp;<span class="ident" id="6662986">i</span><span class="op" id="6662987">++</span>&nbsp;<span class="op" id="6662990">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6662994">StdEncoding</span><span class="op" id="6663005">.</span><span class="ident" id="6663006">EncodeToString</span><span class="op" id="6663020">(</span><span class="ident" id="6663021">data</span><span class="op" id="6663025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6663028">}</span><br>
<span class="lineno"></span><span class="op" id="6663030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6663033">func</span>&nbsp;<span class="ident" id="6663038">BenchmarkDecodeString</span><span class="op" id="6663059">(</span><span class="ident" id="6663060">b</span>&nbsp;<span class="op" id="6663062">*</span><span class="ident" id="6663063">testing</span><span class="op" id="6663070">.</span><span class="ident" id="6663071">B</span><span class="op" id="6663072">)</span>&nbsp;<span class="op" id="6663074">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663077">data</span>&nbsp;<span class="op" id="6663082">:=</span>&nbsp;<span class="ident" id="6663085">StdEncoding</span><span class="op" id="6663096">.</span><span class="ident" id="6663097">EncodeToString</span><span class="op" id="6663111">(</span><span class="builtinfunc" id="6663112">make</span><span class="op" id="6663116">(</span><span class="op" id="6663117">[</span><span class="op" id="6663118">]</span><span class="builtintype" id="6663119">byte</span><span class="op" id="6663123">,</span>&nbsp;<span class="num" id="6663125">8192</span><span class="op" id="6663129">)</span><span class="op" id="6663130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663133">b</span><span class="op" id="6663134">.</span><span class="ident" id="6663135">SetBytes</span><span class="op" id="6663143">(</span><span class="ident" id="6663144">int64</span><span class="op" id="6663149">(</span><span class="builtinfunc" id="6663150">len</span><span class="op" id="6663153">(</span><span class="ident" id="6663154">data</span><span class="op" id="6663158">)</span><span class="op" id="6663159">)</span><span class="op" id="6663160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6663163">for</span>&nbsp;<span class="ident" id="6663167">i</span>&nbsp;<span class="op" id="6663169">:=</span>&nbsp;<span class="num" id="6663172">0</span><span class="op" id="6663173">;</span>&nbsp;<span class="ident" id="6663175">i</span>&nbsp;<span class="op" id="6663177">&lt;</span>&nbsp;<span class="ident" id="6663179">b</span><span class="op" id="6663180">.</span><span class="ident" id="6663181">N</span><span class="op" id="6663182">;</span>&nbsp;<span class="ident" id="6663184">i</span><span class="op" id="6663185">++</span>&nbsp;<span class="op" id="6663188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6663192">StdEncoding</span><span class="op" id="6663203">.</span><span class="ident" id="6663204">DecodeString</span><span class="op" id="6663216">(</span><span class="ident" id="6663217">data</span><span class="op" id="6663221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6663224">}</span><br>
<span class="lineno">360</span><span class="op" id="6663226">}</span>
</div>
</body>
</html>
