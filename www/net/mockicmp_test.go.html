<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7486789">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7486845">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7486899">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7486950">package</span>&nbsp;<span class="ident" id="7486958">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7486963">import</span>&nbsp;<span class="string" id="7486970">&#34;errors&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7486980">const</span>&nbsp;<span class="op" id="7486986">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7486989">icmpv4EchoRequest</span>&nbsp;<span class="op" id="7487007">=</span>&nbsp;<span class="num" id="7487009">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487012">icmpv4EchoReply</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7487030">=</span>&nbsp;<span class="num" id="7487032">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487035">icmpv6EchoRequest</span>&nbsp;<span class="op" id="7487053">=</span>&nbsp;<span class="num" id="7487055">128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487060">icmpv6EchoReply</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7487078">=</span>&nbsp;<span class="num" id="7487080">129</span><br>
<span class="lineno"></span><span class="op" id="7487084">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7487087">//&nbsp;icmpMessage&nbsp;represents&nbsp;an&nbsp;ICMP&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="7487130">type</span>&nbsp;<span class="ident" id="7487135">icmpMessage</span>&nbsp;<span class="keyword" id="7487147">struct</span>&nbsp;<span class="op" id="7487154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487157">Type</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7487166">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7487182">//&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487191">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7487200">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7487216">//&nbsp;code</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487225">Checksum</span>&nbsp;<span class="builtintype" id="7487234">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7487250">//&nbsp;checksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487263">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7487272">icmpMessageBody</span>&nbsp;<span class="comment" id="7487288">//&nbsp;body</span><br>
<span class="lineno"></span><span class="op" id="7487296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7487299">//&nbsp;icmpMessageBody&nbsp;represents&nbsp;an&nbsp;ICMP&nbsp;message&nbsp;body.</span><br>
<span class="lineno">25</span><span class="keyword" id="7487351">type</span>&nbsp;<span class="ident" id="7487356">icmpMessageBody</span>&nbsp;<span class="keyword" id="7487372">interface</span>&nbsp;<span class="op" id="7487382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487385">Len</span><span class="op" id="7487388">(</span><span class="op" id="7487389">)</span>&nbsp;<span class="builtintype" id="7487391">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487396">Marshal</span><span class="op" id="7487403">(</span><span class="op" id="7487404">)</span>&nbsp;<span class="op" id="7487406">(</span><span class="op" id="7487407">[</span><span class="op" id="7487408">]</span><span class="builtintype" id="7487409">byte</span><span class="op" id="7487413">,</span>&nbsp;<span class="builtintype" id="7487415">error</span><span class="op" id="7487420">)</span><br>
<span class="lineno"></span><span class="op" id="7487422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="7487425">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;binary&nbsp;enconding&nbsp;of&nbsp;the&nbsp;ICMP&nbsp;echo&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="7487493">//&nbsp;reply&nbsp;message&nbsp;m.</span><br>
<span class="lineno"></span><span class="keyword" id="7487513">func</span>&nbsp;<span class="op" id="7487518">(</span><span class="ident" id="7487519">m</span>&nbsp;<span class="op" id="7487521">*</span><span class="ident" id="7487522">icmpMessage</span><span class="op" id="7487533">)</span>&nbsp;<span class="ident" id="7487535">Marshal</span><span class="op" id="7487542">(</span><span class="op" id="7487543">)</span>&nbsp;<span class="op" id="7487545">(</span><span class="op" id="7487546">[</span><span class="op" id="7487547">]</span><span class="builtintype" id="7487548">byte</span><span class="op" id="7487552">,</span>&nbsp;<span class="builtintype" id="7487554">error</span><span class="op" id="7487559">)</span>&nbsp;<span class="op" id="7487561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487564">b</span>&nbsp;<span class="op" id="7487566">:=</span>&nbsp;<span class="op" id="7487569">[</span><span class="op" id="7487570">]</span><span class="builtintype" id="7487571">byte</span><span class="op" id="7487575">{</span><span class="builtintype" id="7487576">byte</span><span class="op" id="7487580">(</span><span class="ident" id="7487581">m</span><span class="op" id="7487582">.</span><span class="ident" id="7487583">Type</span><span class="op" id="7487587">)</span><span class="op" id="7487588">,</span>&nbsp;<span class="builtintype" id="7487590">byte</span><span class="op" id="7487594">(</span><span class="ident" id="7487595">m</span><span class="op" id="7487596">.</span><span class="ident" id="7487597">Code</span><span class="op" id="7487601">)</span><span class="op" id="7487602">,</span>&nbsp;<span class="num" id="7487604">0</span><span class="op" id="7487605">,</span>&nbsp;<span class="num" id="7487607">0</span><span class="op" id="7487608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487611">if</span>&nbsp;<span class="ident" id="7487614">m</span><span class="op" id="7487615">.</span><span class="ident" id="7487616">Body</span>&nbsp;<span class="op" id="7487621">!=</span>&nbsp;<span class="ident" id="7487624">nil</span>&nbsp;<span class="op" id="7487628">&amp;&amp;</span>&nbsp;<span class="ident" id="7487631">m</span><span class="op" id="7487632">.</span><span class="ident" id="7487633">Body</span><span class="op" id="7487637">.</span><span class="ident" id="7487638">Len</span><span class="op" id="7487641">(</span><span class="op" id="7487642">)</span>&nbsp;<span class="op" id="7487644">!=</span>&nbsp;<span class="num" id="7487647">0</span>&nbsp;<span class="op" id="7487649">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487653">mb</span><span class="op" id="7487655">,</span>&nbsp;<span class="ident" id="7487657">err</span>&nbsp;<span class="op" id="7487661">:=</span>&nbsp;<span class="ident" id="7487664">m</span><span class="op" id="7487665">.</span><span class="ident" id="7487666">Body</span><span class="op" id="7487670">.</span><span class="ident" id="7487671">Marshal</span><span class="op" id="7487678">(</span><span class="op" id="7487679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487683">if</span>&nbsp;<span class="ident" id="7487686">err</span>&nbsp;<span class="op" id="7487690">!=</span>&nbsp;<span class="ident" id="7487693">nil</span>&nbsp;<span class="op" id="7487697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487702">return</span>&nbsp;<span class="ident" id="7487709">nil</span><span class="op" id="7487712">,</span>&nbsp;<span class="ident" id="7487714">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487724">b</span>&nbsp;<span class="op" id="7487726">=</span>&nbsp;<span class="builtinfunc" id="7487728">append</span><span class="op" id="7487734">(</span><span class="ident" id="7487735">b</span><span class="op" id="7487736">,</span>&nbsp;<span class="ident" id="7487738">mb</span><span class="op" id="7487740">...</span><span class="op" id="7487743">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487749">switch</span>&nbsp;<span class="ident" id="7487756">m</span><span class="op" id="7487757">.</span><span class="ident" id="7487758">Type</span>&nbsp;<span class="op" id="7487763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487766">case</span>&nbsp;<span class="ident" id="7487771">icmpv6EchoRequest</span><span class="op" id="7487788">,</span>&nbsp;<span class="ident" id="7487790">icmpv6EchoReply</span><span class="op" id="7487805">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487809">return</span>&nbsp;<span class="ident" id="7487816">b</span><span class="op" id="7487817">,</span>&nbsp;<span class="ident" id="7487819">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487824">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487827">csumcv</span>&nbsp;<span class="op" id="7487834">:=</span>&nbsp;<span class="builtinfunc" id="7487837">len</span><span class="op" id="7487840">(</span><span class="ident" id="7487841">b</span><span class="op" id="7487842">)</span>&nbsp;<span class="op" id="7487844">-</span>&nbsp;<span class="num" id="7487846">1</span>&nbsp;<span class="comment" id="7487848">//&nbsp;checksum&nbsp;coverage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487870">s</span>&nbsp;<span class="op" id="7487872">:=</span>&nbsp;<span class="builtintype" id="7487875">uint32</span><span class="op" id="7487881">(</span><span class="num" id="7487882">0</span><span class="op" id="7487883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487886">for</span>&nbsp;<span class="ident" id="7487890">i</span>&nbsp;<span class="op" id="7487892">:=</span>&nbsp;<span class="num" id="7487895">0</span><span class="op" id="7487896">;</span>&nbsp;<span class="ident" id="7487898">i</span>&nbsp;<span class="op" id="7487900">&lt;</span>&nbsp;<span class="ident" id="7487902">csumcv</span><span class="op" id="7487908">;</span>&nbsp;<span class="ident" id="7487910">i</span>&nbsp;<span class="op" id="7487912">+=</span>&nbsp;<span class="num" id="7487915">2</span>&nbsp;<span class="op" id="7487917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487921">s</span>&nbsp;<span class="op" id="7487923">+=</span>&nbsp;<span class="builtintype" id="7487926">uint32</span><span class="op" id="7487932">(</span><span class="ident" id="7487933">b</span><span class="op" id="7487934">[</span><span class="ident" id="7487935">i</span><span class="op" id="7487936">+</span><span class="num" id="7487937">1</span><span class="op" id="7487938">]</span><span class="op" id="7487939">)</span><span class="op" id="7487940">&lt;&lt;</span><span class="num" id="7487942">8</span>&nbsp;<span class="op" id="7487944">|</span>&nbsp;<span class="builtintype" id="7487946">uint32</span><span class="op" id="7487952">(</span><span class="ident" id="7487953">b</span><span class="op" id="7487954">[</span><span class="ident" id="7487955">i</span><span class="op" id="7487956">]</span><span class="op" id="7487957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7487960">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7487963">if</span>&nbsp;<span class="ident" id="7487966">csumcv</span><span class="op" id="7487972">&amp;</span><span class="num" id="7487973">1</span>&nbsp;<span class="op" id="7487975">==</span>&nbsp;<span class="num" id="7487978">0</span>&nbsp;<span class="op" id="7487980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7487984">s</span>&nbsp;<span class="op" id="7487986">+=</span>&nbsp;<span class="builtintype" id="7487989">uint32</span><span class="op" id="7487995">(</span><span class="ident" id="7487996">b</span><span class="op" id="7487997">[</span><span class="ident" id="7487998">csumcv</span><span class="op" id="7488004">]</span><span class="op" id="7488005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488011">s</span>&nbsp;<span class="op" id="7488013">=</span>&nbsp;<span class="ident" id="7488015">s</span><span class="op" id="7488016">&gt;&gt;</span><span class="num" id="7488018">16</span>&nbsp;<span class="op" id="7488021">+</span>&nbsp;<span class="ident" id="7488023">s</span><span class="op" id="7488024">&amp;</span><span class="num" id="7488025">0xffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488033">s</span>&nbsp;<span class="op" id="7488035">=</span>&nbsp;<span class="ident" id="7488037">s</span>&nbsp;<span class="op" id="7488039">+</span>&nbsp;<span class="ident" id="7488041">s</span><span class="op" id="7488042">&gt;&gt;</span><span class="num" id="7488044">16</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7488048">//&nbsp;Place&nbsp;checksum&nbsp;back&nbsp;in&nbsp;header;&nbsp;using&nbsp;^=&nbsp;avoids&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7488103">//&nbsp;assumption&nbsp;the&nbsp;checksum&nbsp;bytes&nbsp;are&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488147">b</span><span class="op" id="7488148">[</span><span class="num" id="7488149">2</span><span class="op" id="7488150">]</span>&nbsp;<span class="op" id="7488152">^=</span>&nbsp;<span class="builtintype" id="7488155">byte</span><span class="op" id="7488159">(</span><span class="op" id="7488160">^</span><span class="ident" id="7488161">s</span><span class="op" id="7488162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488165">b</span><span class="op" id="7488166">[</span><span class="num" id="7488167">3</span><span class="op" id="7488168">]</span>&nbsp;<span class="op" id="7488170">^=</span>&nbsp;<span class="builtintype" id="7488173">byte</span><span class="op" id="7488177">(</span><span class="op" id="7488178">^</span><span class="ident" id="7488179">s</span>&nbsp;<span class="op" id="7488181">&gt;&gt;</span>&nbsp;<span class="num" id="7488184">8</span><span class="op" id="7488185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488188">return</span>&nbsp;<span class="ident" id="7488195">b</span><span class="op" id="7488196">,</span>&nbsp;<span class="ident" id="7488198">nil</span><br>
<span class="lineno">60</span><span class="op" id="7488202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7488205">//&nbsp;parseICMPMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;ICMP&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="7488254">func</span>&nbsp;<span class="ident" id="7488259">parseICMPMessage</span><span class="op" id="7488275">(</span><span class="ident" id="7488276">b</span>&nbsp;<span class="op" id="7488278">[</span><span class="op" id="7488279">]</span><span class="builtintype" id="7488280">byte</span><span class="op" id="7488284">)</span>&nbsp;<span class="op" id="7488286">(</span><span class="op" id="7488287">*</span><span class="ident" id="7488288">icmpMessage</span><span class="op" id="7488299">,</span>&nbsp;<span class="builtintype" id="7488301">error</span><span class="op" id="7488306">)</span>&nbsp;<span class="op" id="7488308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488311">msglen</span>&nbsp;<span class="op" id="7488318">:=</span>&nbsp;<span class="builtinfunc" id="7488321">len</span><span class="op" id="7488324">(</span><span class="ident" id="7488325">b</span><span class="op" id="7488326">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488329">if</span>&nbsp;<span class="ident" id="7488332">msglen</span>&nbsp;<span class="op" id="7488339">&lt;</span>&nbsp;<span class="num" id="7488341">4</span>&nbsp;<span class="op" id="7488343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488347">return</span>&nbsp;<span class="ident" id="7488354">nil</span><span class="op" id="7488357">,</span>&nbsp;<span class="ident" id="7488359">errors</span><span class="op" id="7488365">.</span><span class="ident" id="7488366">New</span><span class="op" id="7488369">(</span><span class="string" id="7488370">&#34;message&nbsp;too&nbsp;short&#34;</span><span class="op" id="7488389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488395">m</span>&nbsp;<span class="op" id="7488397">:=</span>&nbsp;<span class="op" id="7488400">&amp;</span><span class="ident" id="7488401">icmpMessage</span><span class="op" id="7488412">{</span><span class="ident" id="7488413">Type</span><span class="op" id="7488417">:</span>&nbsp;<span class="builtintype" id="7488419">int</span><span class="op" id="7488422">(</span><span class="ident" id="7488423">b</span><span class="op" id="7488424">[</span><span class="num" id="7488425">0</span><span class="op" id="7488426">]</span><span class="op" id="7488427">)</span><span class="op" id="7488428">,</span>&nbsp;<span class="ident" id="7488430">Code</span><span class="op" id="7488434">:</span>&nbsp;<span class="builtintype" id="7488436">int</span><span class="op" id="7488439">(</span><span class="ident" id="7488440">b</span><span class="op" id="7488441">[</span><span class="num" id="7488442">1</span><span class="op" id="7488443">]</span><span class="op" id="7488444">)</span><span class="op" id="7488445">,</span>&nbsp;<span class="ident" id="7488447">Checksum</span><span class="op" id="7488455">:</span>&nbsp;<span class="builtintype" id="7488457">int</span><span class="op" id="7488460">(</span><span class="ident" id="7488461">b</span><span class="op" id="7488462">[</span><span class="num" id="7488463">2</span><span class="op" id="7488464">]</span><span class="op" id="7488465">)</span><span class="op" id="7488466">&lt;&lt;</span><span class="num" id="7488468">8</span>&nbsp;<span class="op" id="7488470">|</span>&nbsp;<span class="builtintype" id="7488472">int</span><span class="op" id="7488475">(</span><span class="ident" id="7488476">b</span><span class="op" id="7488477">[</span><span class="num" id="7488478">3</span><span class="op" id="7488479">]</span><span class="op" id="7488480">)</span><span class="op" id="7488481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488484">if</span>&nbsp;<span class="ident" id="7488487">msglen</span>&nbsp;<span class="op" id="7488494">&gt;</span>&nbsp;<span class="num" id="7488496">4</span>&nbsp;<span class="op" id="7488498">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488502">var</span>&nbsp;<span class="ident" id="7488506">err</span>&nbsp;<span class="builtintype" id="7488510">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488518">switch</span>&nbsp;<span class="ident" id="7488525">m</span><span class="op" id="7488526">.</span><span class="ident" id="7488527">Type</span>&nbsp;<span class="op" id="7488532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488536">case</span>&nbsp;<span class="ident" id="7488541">icmpv4EchoRequest</span><span class="op" id="7488558">,</span>&nbsp;<span class="ident" id="7488560">icmpv4EchoReply</span><span class="op" id="7488575">,</span>&nbsp;<span class="ident" id="7488577">icmpv6EchoRequest</span><span class="op" id="7488594">,</span>&nbsp;<span class="ident" id="7488596">icmpv6EchoReply</span><span class="op" id="7488611">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488616">m</span><span class="op" id="7488617">.</span><span class="ident" id="7488618">Body</span><span class="op" id="7488622">,</span>&nbsp;<span class="ident" id="7488624">err</span>&nbsp;<span class="op" id="7488628">=</span>&nbsp;<span class="ident" id="7488630">parseICMPEcho</span><span class="op" id="7488643">(</span><span class="ident" id="7488644">b</span><span class="op" id="7488645">[</span><span class="num" id="7488646">4</span><span class="op" id="7488647">:</span><span class="op" id="7488648">]</span><span class="op" id="7488649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488654">if</span>&nbsp;<span class="ident" id="7488657">err</span>&nbsp;<span class="op" id="7488661">!=</span>&nbsp;<span class="ident" id="7488664">nil</span>&nbsp;<span class="op" id="7488668">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488674">return</span>&nbsp;<span class="ident" id="7488681">nil</span><span class="op" id="7488684">,</span>&nbsp;<span class="ident" id="7488686">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488703">return</span>&nbsp;<span class="ident" id="7488710">m</span><span class="op" id="7488711">,</span>&nbsp;<span class="ident" id="7488713">nil</span><br>
<span class="lineno">80</span><span class="op" id="7488717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7488720">//&nbsp;imcpEcho&nbsp;represenets&nbsp;an&nbsp;ICMP&nbsp;echo&nbsp;request&nbsp;or&nbsp;reply&nbsp;message&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="7488788">type</span>&nbsp;<span class="ident" id="7488793">icmpEcho</span>&nbsp;<span class="keyword" id="7488802">struct</span>&nbsp;<span class="op" id="7488809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488812">ID</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7488817">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7488824">//&nbsp;identifier</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488839">Seq</span>&nbsp;&nbsp;<span class="builtintype" id="7488844">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7488851">//&nbsp;sequence&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7488871">Data</span>&nbsp;<span class="op" id="7488876">[</span><span class="op" id="7488877">]</span><span class="builtintype" id="7488878">byte</span>&nbsp;<span class="comment" id="7488883">//&nbsp;data</span><br>
<span class="lineno"></span><span class="op" id="7488891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7488894">func</span>&nbsp;<span class="op" id="7488899">(</span><span class="ident" id="7488900">p</span>&nbsp;<span class="op" id="7488902">*</span><span class="ident" id="7488903">icmpEcho</span><span class="op" id="7488911">)</span>&nbsp;<span class="ident" id="7488913">Len</span><span class="op" id="7488916">(</span><span class="op" id="7488917">)</span>&nbsp;<span class="builtintype" id="7488919">int</span>&nbsp;<span class="op" id="7488923">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488926">if</span>&nbsp;<span class="ident" id="7488929">p</span>&nbsp;<span class="op" id="7488931">==</span>&nbsp;<span class="ident" id="7488934">nil</span>&nbsp;<span class="op" id="7488938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488942">return</span>&nbsp;<span class="num" id="7488949">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7488952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7488955">return</span>&nbsp;<span class="num" id="7488962">4</span>&nbsp;<span class="op" id="7488964">+</span>&nbsp;<span class="builtinfunc" id="7488966">len</span><span class="op" id="7488969">(</span><span class="ident" id="7488970">p</span><span class="op" id="7488971">.</span><span class="ident" id="7488972">Data</span><span class="op" id="7488976">)</span><br>
<span class="lineno"></span><span class="op" id="7488978">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="7488981">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;binary&nbsp;enconding&nbsp;of&nbsp;the&nbsp;ICMP&nbsp;echo&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="7489049">//&nbsp;reply&nbsp;message&nbsp;body&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="7489074">func</span>&nbsp;<span class="op" id="7489079">(</span><span class="ident" id="7489080">p</span>&nbsp;<span class="op" id="7489082">*</span><span class="ident" id="7489083">icmpEcho</span><span class="op" id="7489091">)</span>&nbsp;<span class="ident" id="7489093">Marshal</span><span class="op" id="7489100">(</span><span class="op" id="7489101">)</span>&nbsp;<span class="op" id="7489103">(</span><span class="op" id="7489104">[</span><span class="op" id="7489105">]</span><span class="builtintype" id="7489106">byte</span><span class="op" id="7489110">,</span>&nbsp;<span class="builtintype" id="7489112">error</span><span class="op" id="7489117">)</span>&nbsp;<span class="op" id="7489119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489122">b</span>&nbsp;<span class="op" id="7489124">:=</span>&nbsp;<span class="builtinfunc" id="7489127">make</span><span class="op" id="7489131">(</span><span class="op" id="7489132">[</span><span class="op" id="7489133">]</span><span class="builtintype" id="7489134">byte</span><span class="op" id="7489138">,</span>&nbsp;<span class="num" id="7489140">4</span><span class="op" id="7489141">+</span><span class="builtinfunc" id="7489142">len</span><span class="op" id="7489145">(</span><span class="ident" id="7489146">p</span><span class="op" id="7489147">.</span><span class="ident" id="7489148">Data</span><span class="op" id="7489152">)</span><span class="op" id="7489153">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489156">b</span><span class="op" id="7489157">[</span><span class="num" id="7489158">0</span><span class="op" id="7489159">]</span><span class="op" id="7489160">,</span>&nbsp;<span class="ident" id="7489162">b</span><span class="op" id="7489163">[</span><span class="num" id="7489164">1</span><span class="op" id="7489165">]</span>&nbsp;<span class="op" id="7489167">=</span>&nbsp;<span class="builtintype" id="7489169">byte</span><span class="op" id="7489173">(</span><span class="ident" id="7489174">p</span><span class="op" id="7489175">.</span><span class="ident" id="7489176">ID</span><span class="op" id="7489178">&gt;&gt;</span><span class="num" id="7489180">8</span><span class="op" id="7489181">)</span><span class="op" id="7489182">,</span>&nbsp;<span class="builtintype" id="7489184">byte</span><span class="op" id="7489188">(</span><span class="ident" id="7489189">p</span><span class="op" id="7489190">.</span><span class="ident" id="7489191">ID</span><span class="op" id="7489193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489196">b</span><span class="op" id="7489197">[</span><span class="num" id="7489198">2</span><span class="op" id="7489199">]</span><span class="op" id="7489200">,</span>&nbsp;<span class="ident" id="7489202">b</span><span class="op" id="7489203">[</span><span class="num" id="7489204">3</span><span class="op" id="7489205">]</span>&nbsp;<span class="op" id="7489207">=</span>&nbsp;<span class="builtintype" id="7489209">byte</span><span class="op" id="7489213">(</span><span class="ident" id="7489214">p</span><span class="op" id="7489215">.</span><span class="ident" id="7489216">Seq</span><span class="op" id="7489219">&gt;&gt;</span><span class="num" id="7489221">8</span><span class="op" id="7489222">)</span><span class="op" id="7489223">,</span>&nbsp;<span class="builtintype" id="7489225">byte</span><span class="op" id="7489229">(</span><span class="ident" id="7489230">p</span><span class="op" id="7489231">.</span><span class="ident" id="7489232">Seq</span><span class="op" id="7489235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7489238">copy</span><span class="op" id="7489242">(</span><span class="ident" id="7489243">b</span><span class="op" id="7489244">[</span><span class="num" id="7489245">4</span><span class="op" id="7489246">:</span><span class="op" id="7489247">]</span><span class="op" id="7489248">,</span>&nbsp;<span class="ident" id="7489250">p</span><span class="op" id="7489251">.</span><span class="ident" id="7489252">Data</span><span class="op" id="7489256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7489259">return</span>&nbsp;<span class="ident" id="7489266">b</span><span class="op" id="7489267">,</span>&nbsp;<span class="ident" id="7489269">nil</span><br>
<span class="lineno"></span><span class="op" id="7489273">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="7489276">//&nbsp;parseICMPEcho&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;ICMP&nbsp;echo&nbsp;request&nbsp;or&nbsp;reply&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="7489343">//&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="7489352">func</span>&nbsp;<span class="ident" id="7489357">parseICMPEcho</span><span class="op" id="7489370">(</span><span class="ident" id="7489371">b</span>&nbsp;<span class="op" id="7489373">[</span><span class="op" id="7489374">]</span><span class="builtintype" id="7489375">byte</span><span class="op" id="7489379">)</span>&nbsp;<span class="op" id="7489381">(</span><span class="op" id="7489382">*</span><span class="ident" id="7489383">icmpEcho</span><span class="op" id="7489391">,</span>&nbsp;<span class="builtintype" id="7489393">error</span><span class="op" id="7489398">)</span>&nbsp;<span class="op" id="7489400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489403">bodylen</span>&nbsp;<span class="op" id="7489411">:=</span>&nbsp;<span class="builtinfunc" id="7489414">len</span><span class="op" id="7489417">(</span><span class="ident" id="7489418">b</span><span class="op" id="7489419">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489422">p</span>&nbsp;<span class="op" id="7489424">:=</span>&nbsp;<span class="op" id="7489427">&amp;</span><span class="ident" id="7489428">icmpEcho</span><span class="op" id="7489436">{</span><span class="ident" id="7489437">ID</span><span class="op" id="7489439">:</span>&nbsp;<span class="builtintype" id="7489441">int</span><span class="op" id="7489444">(</span><span class="ident" id="7489445">b</span><span class="op" id="7489446">[</span><span class="num" id="7489447">0</span><span class="op" id="7489448">]</span><span class="op" id="7489449">)</span><span class="op" id="7489450">&lt;&lt;</span><span class="num" id="7489452">8</span>&nbsp;<span class="op" id="7489454">|</span>&nbsp;<span class="builtintype" id="7489456">int</span><span class="op" id="7489459">(</span><span class="ident" id="7489460">b</span><span class="op" id="7489461">[</span><span class="num" id="7489462">1</span><span class="op" id="7489463">]</span><span class="op" id="7489464">)</span><span class="op" id="7489465">,</span>&nbsp;<span class="ident" id="7489467">Seq</span><span class="op" id="7489470">:</span>&nbsp;<span class="builtintype" id="7489472">int</span><span class="op" id="7489475">(</span><span class="ident" id="7489476">b</span><span class="op" id="7489477">[</span><span class="num" id="7489478">2</span><span class="op" id="7489479">]</span><span class="op" id="7489480">)</span><span class="op" id="7489481">&lt;&lt;</span><span class="num" id="7489483">8</span>&nbsp;<span class="op" id="7489485">|</span>&nbsp;<span class="builtintype" id="7489487">int</span><span class="op" id="7489490">(</span><span class="ident" id="7489491">b</span><span class="op" id="7489492">[</span><span class="num" id="7489493">3</span><span class="op" id="7489494">]</span><span class="op" id="7489495">)</span><span class="op" id="7489496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7489499">if</span>&nbsp;<span class="ident" id="7489502">bodylen</span>&nbsp;<span class="op" id="7489510">&gt;</span>&nbsp;<span class="num" id="7489512">4</span>&nbsp;<span class="op" id="7489514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7489518">p</span><span class="op" id="7489519">.</span><span class="ident" id="7489520">Data</span>&nbsp;<span class="op" id="7489525">=</span>&nbsp;<span class="builtinfunc" id="7489527">make</span><span class="op" id="7489531">(</span><span class="op" id="7489532">[</span><span class="op" id="7489533">]</span><span class="builtintype" id="7489534">byte</span><span class="op" id="7489538">,</span>&nbsp;<span class="ident" id="7489540">bodylen</span><span class="op" id="7489547">-</span><span class="num" id="7489548">4</span><span class="op" id="7489549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7489553">copy</span><span class="op" id="7489557">(</span><span class="ident" id="7489558">p</span><span class="op" id="7489559">.</span><span class="ident" id="7489560">Data</span><span class="op" id="7489564">,</span>&nbsp;<span class="ident" id="7489566">b</span><span class="op" id="7489567">[</span><span class="num" id="7489568">4</span><span class="op" id="7489569">:</span><span class="op" id="7489570">]</span><span class="op" id="7489571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7489574">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7489577">return</span>&nbsp;<span class="ident" id="7489584">p</span><span class="op" id="7489585">,</span>&nbsp;<span class="ident" id="7489587">nil</span><br>
<span class="lineno"></span><span class="op" id="7489591">}</span>
</div>
</body>
</html>
