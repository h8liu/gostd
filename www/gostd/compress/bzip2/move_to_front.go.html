<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html" class="current">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6395991">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6396046">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6396100">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6396151">package</span>&nbsp;<span class="ident" id="6396159">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6396166">//&nbsp;moveToFrontDecoder&nbsp;implements&nbsp;a&nbsp;move-to-front&nbsp;list.&nbsp;Such&nbsp;a&nbsp;list&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6396239">//&nbsp;efficient&nbsp;way&nbsp;to&nbsp;transform&nbsp;a&nbsp;string&nbsp;with&nbsp;repeating&nbsp;elements&nbsp;into&nbsp;one&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6396316">//&nbsp;many&nbsp;small&nbsp;valued&nbsp;numbers,&nbsp;which&nbsp;is&nbsp;suitable&nbsp;for&nbsp;entropy&nbsp;encoding.&nbsp;It&nbsp;works</span><br>
<span class="lineno">10</span><span class="comment" id="6396395">//&nbsp;by&nbsp;starting&nbsp;with&nbsp;an&nbsp;initial&nbsp;list&nbsp;of&nbsp;symbols&nbsp;and&nbsp;references&nbsp;symbols&nbsp;by&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="6396474">//&nbsp;index&nbsp;into&nbsp;that&nbsp;list.&nbsp;When&nbsp;a&nbsp;symbol&nbsp;is&nbsp;referenced,&nbsp;it&#39;s&nbsp;moved&nbsp;to&nbsp;the&nbsp;front</span><br>
<span class="lineno"></span><span class="comment" id="6396552">//&nbsp;of&nbsp;the&nbsp;list.&nbsp;Thus,&nbsp;a&nbsp;repeated&nbsp;symbol&nbsp;ends&nbsp;up&nbsp;being&nbsp;encoded&nbsp;with&nbsp;many&nbsp;zeros,</span><br>
<span class="lineno"></span><span class="comment" id="6396631">//&nbsp;as&nbsp;the&nbsp;symbol&nbsp;will&nbsp;be&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list&nbsp;after&nbsp;the&nbsp;first&nbsp;access.</span><br>
<span class="lineno"></span><span class="keyword" id="6396705">type</span>&nbsp;<span class="ident" id="6396710">moveToFrontDecoder</span>&nbsp;<span class="op" id="6396729">[</span><span class="op" id="6396730">]</span><span class="builtintype" id="6396731">byte</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="6396737">//&nbsp;newMTFDecoder&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;explicit&nbsp;initial&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="6396816">//&nbsp;of&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="6396831">func</span>&nbsp;<span class="ident" id="6396836">newMTFDecoder</span><span class="op" id="6396849">(</span><span class="ident" id="6396850">symbols</span>&nbsp;<span class="op" id="6396858">[</span><span class="op" id="6396859">]</span><span class="builtintype" id="6396860">byte</span><span class="op" id="6396864">)</span>&nbsp;<span class="ident" id="6396866">moveToFrontDecoder</span>&nbsp;<span class="op" id="6396885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396888">if</span>&nbsp;<span class="builtinfunc" id="6396891">len</span><span class="op" id="6396894">(</span><span class="ident" id="6396895">symbols</span><span class="op" id="6396902">)</span>&nbsp;<span class="op" id="6396904">&gt;</span>&nbsp;<span class="num" id="6396906">256</span>&nbsp;<span class="op" id="6396910">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6396914">panic</span><span class="op" id="6396919">(</span><span class="string" id="6396920">&#34;too&nbsp;many&nbsp;symbols&#34;</span><span class="op" id="6396938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396944">return</span>&nbsp;<span class="ident" id="6396951">moveToFrontDecoder</span><span class="op" id="6396969">(</span><span class="ident" id="6396970">symbols</span><span class="op" id="6396977">)</span><br>
<span class="lineno"></span><span class="op" id="6396979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="6396982">//&nbsp;newMTFDecoderWithRange&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="6397056">//&nbsp;symbol&nbsp;list&nbsp;of&nbsp;0...n-1.</span><br>
<span class="lineno"></span><span class="keyword" id="6397083">func</span>&nbsp;<span class="ident" id="6397088">newMTFDecoderWithRange</span><span class="op" id="6397110">(</span><span class="ident" id="6397111">n</span>&nbsp;<span class="builtintype" id="6397113">int</span><span class="op" id="6397116">)</span>&nbsp;<span class="ident" id="6397118">moveToFrontDecoder</span>&nbsp;<span class="op" id="6397137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397140">if</span>&nbsp;<span class="ident" id="6397143">n</span>&nbsp;<span class="op" id="6397145">&gt;</span>&nbsp;<span class="num" id="6397147">256</span>&nbsp;<span class="op" id="6397151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6397155">panic</span><span class="op" id="6397160">(</span><span class="string" id="6397161">&#34;newMTFDecoderWithRange:&nbsp;cannot&nbsp;have&nbsp;&gt;&nbsp;256&nbsp;symbols&#34;</span><span class="op" id="6397212">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397219">m</span>&nbsp;<span class="op" id="6397221">:=</span>&nbsp;<span class="builtinfunc" id="6397224">make</span><span class="op" id="6397228">(</span><span class="op" id="6397229">[</span><span class="op" id="6397230">]</span><span class="builtintype" id="6397231">byte</span><span class="op" id="6397235">,</span>&nbsp;<span class="ident" id="6397237">n</span><span class="op" id="6397238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397241">for</span>&nbsp;<span class="ident" id="6397245">i</span>&nbsp;<span class="op" id="6397247">:=</span>&nbsp;<span class="num" id="6397250">0</span><span class="op" id="6397251">;</span>&nbsp;<span class="ident" id="6397253">i</span>&nbsp;<span class="op" id="6397255">&lt;</span>&nbsp;<span class="ident" id="6397257">n</span><span class="op" id="6397258">;</span>&nbsp;<span class="ident" id="6397260">i</span><span class="op" id="6397261">++</span>&nbsp;<span class="op" id="6397264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397268">m</span><span class="op" id="6397269">[</span><span class="ident" id="6397270">i</span><span class="op" id="6397271">]</span>&nbsp;<span class="op" id="6397273">=</span>&nbsp;<span class="builtintype" id="6397275">byte</span><span class="op" id="6397279">(</span><span class="ident" id="6397280">i</span><span class="op" id="6397281">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397287">return</span>&nbsp;<span class="ident" id="6397294">moveToFrontDecoder</span><span class="op" id="6397312">(</span><span class="ident" id="6397313">m</span><span class="op" id="6397314">)</span><br>
<span class="lineno"></span><span class="op" id="6397316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6397319">func</span>&nbsp;<span class="op" id="6397324">(</span><span class="ident" id="6397325">m</span>&nbsp;<span class="ident" id="6397327">moveToFrontDecoder</span><span class="op" id="6397345">)</span>&nbsp;<span class="ident" id="6397347">Decode</span><span class="op" id="6397353">(</span><span class="ident" id="6397354">n</span>&nbsp;<span class="builtintype" id="6397356">int</span><span class="op" id="6397359">)</span>&nbsp;<span class="op" id="6397361">(</span><span class="ident" id="6397362">b</span>&nbsp;<span class="builtintype" id="6397364">byte</span><span class="op" id="6397368">)</span>&nbsp;<span class="op" id="6397370">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6397373">//&nbsp;Implement&nbsp;move-to-front&nbsp;with&nbsp;a&nbsp;simple&nbsp;copy.&nbsp;This&nbsp;approach</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6397435">//&nbsp;beats&nbsp;more&nbsp;sophisticated&nbsp;approaches&nbsp;in&nbsp;benchmarking,&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6397501">//&nbsp;because&nbsp;it&nbsp;has&nbsp;high&nbsp;locality&nbsp;of&nbsp;reference&nbsp;inside&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6397559">//&nbsp;single&nbsp;cache&nbsp;line&nbsp;(most&nbsp;move-to-front&nbsp;operations&nbsp;have&nbsp;n&nbsp;&lt;&nbsp;64).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397626">b</span>&nbsp;<span class="op" id="6397628">=</span>&nbsp;<span class="ident" id="6397630">m</span><span class="op" id="6397631">[</span><span class="ident" id="6397632">n</span><span class="op" id="6397633">]</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6397636">copy</span><span class="op" id="6397640">(</span><span class="ident" id="6397641">m</span><span class="op" id="6397642">[</span><span class="num" id="6397643">1</span><span class="op" id="6397644">:</span><span class="op" id="6397645">]</span><span class="op" id="6397646">,</span>&nbsp;<span class="ident" id="6397648">m</span><span class="op" id="6397649">[</span><span class="op" id="6397650">:</span><span class="ident" id="6397651">n</span><span class="op" id="6397652">]</span><span class="op" id="6397653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397656">m</span><span class="op" id="6397657">[</span><span class="num" id="6397658">0</span><span class="op" id="6397659">]</span>&nbsp;<span class="op" id="6397661">=</span>&nbsp;<span class="ident" id="6397663">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397666">return</span><br>
<span class="lineno"></span><span class="op" id="6397673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="6397676">//&nbsp;First&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="6397730">func</span>&nbsp;<span class="op" id="6397735">(</span><span class="ident" id="6397736">m</span>&nbsp;<span class="ident" id="6397738">moveToFrontDecoder</span><span class="op" id="6397756">)</span>&nbsp;<span class="ident" id="6397758">First</span><span class="op" id="6397763">(</span><span class="op" id="6397764">)</span>&nbsp;<span class="builtintype" id="6397766">byte</span>&nbsp;<span class="op" id="6397771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397774">return</span>&nbsp;<span class="ident" id="6397781">m</span><span class="op" id="6397782">[</span><span class="num" id="6397783">0</span><span class="op" id="6397784">]</span><br>
<span class="lineno"></span><span class="op" id="6397786">}</span>
</div>
</body>
</html>
