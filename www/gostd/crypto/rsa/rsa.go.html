<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html" class="current">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4807915">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4807970">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4808024">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4808075">//&nbsp;Package&nbsp;rsa&nbsp;implements&nbsp;RSA&nbsp;encryption&nbsp;as&nbsp;specified&nbsp;in&nbsp;PKCS#1.</span><br>
<span class="lineno"></span><span class="keyword" id="4808140">package</span>&nbsp;<span class="ident" id="4808148">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4808153">import</span>&nbsp;<span class="op" id="4808160">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4808163">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4808173">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4808188">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4808205">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4808215">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4808223">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4808229">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4808240">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4808243">var</span>&nbsp;<span class="ident" id="4808247">bigZero</span>&nbsp;<span class="op" id="4808255">=</span>&nbsp;<span class="ident" id="4808257">big</span><span class="op" id="4808260">.</span><span class="ident" id="4808261">NewInt</span><span class="op" id="4808267">(</span><span class="num" id="4808268">0</span><span class="op" id="4808269">)</span><br>
<span class="lineno"></span><span class="keyword" id="4808271">var</span>&nbsp;<span class="ident" id="4808275">bigOne</span>&nbsp;<span class="op" id="4808282">=</span>&nbsp;<span class="ident" id="4808284">big</span><span class="op" id="4808287">.</span><span class="ident" id="4808288">NewInt</span><span class="op" id="4808294">(</span><span class="num" id="4808295">1</span><span class="op" id="4808296">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4808299">//&nbsp;A&nbsp;PublicKey&nbsp;represents&nbsp;the&nbsp;public&nbsp;part&nbsp;of&nbsp;an&nbsp;RSA&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4808356">type</span>&nbsp;<span class="ident" id="4808361">PublicKey</span>&nbsp;<span class="keyword" id="4808371">struct</span>&nbsp;<span class="op" id="4808378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808381">N</span>&nbsp;<span class="op" id="4808383">*</span><span class="ident" id="4808384">big</span><span class="op" id="4808387">.</span><span class="ident" id="4808388">Int</span>&nbsp;<span class="comment" id="4808392">//&nbsp;modulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808404">E</span>&nbsp;<span class="builtintype" id="4808406">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4808415">//&nbsp;public&nbsp;exponent</span><br>
<span class="lineno">25</span><span class="op" id="4808434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4808437">var</span>&nbsp;<span class="op" id="4808441">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808444">errPublicModulus</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4808467">=</span>&nbsp;<span class="ident" id="4808469">errors</span><span class="op" id="4808475">.</span><span class="ident" id="4808476">New</span><span class="op" id="4808479">(</span><span class="string" id="4808480">&#34;crypto/rsa:&nbsp;missing&nbsp;public&nbsp;modulus&#34;</span><span class="op" id="4808516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808519">errPublicExponentSmall</span>&nbsp;<span class="op" id="4808542">=</span>&nbsp;<span class="ident" id="4808544">errors</span><span class="op" id="4808550">.</span><span class="ident" id="4808551">New</span><span class="op" id="4808554">(</span><span class="string" id="4808555">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;small&#34;</span><span class="op" id="4808594">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808597">errPublicExponentLarge</span>&nbsp;<span class="op" id="4808620">=</span>&nbsp;<span class="ident" id="4808622">errors</span><span class="op" id="4808628">.</span><span class="ident" id="4808629">New</span><span class="op" id="4808632">(</span><span class="string" id="4808633">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;large&#34;</span><span class="op" id="4808672">)</span><br>
<span class="lineno"></span><span class="op" id="4808674">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4808677">//&nbsp;checkPub&nbsp;sanity&nbsp;checks&nbsp;the&nbsp;public&nbsp;key&nbsp;before&nbsp;we&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4808736">//&nbsp;We&nbsp;require&nbsp;pub.E&nbsp;to&nbsp;fit&nbsp;into&nbsp;a&nbsp;32-bit&nbsp;integer&nbsp;so&nbsp;that&nbsp;we</span><br>
<span class="lineno">35</span><span class="comment" id="4808796">//&nbsp;do&nbsp;not&nbsp;have&nbsp;different&nbsp;behavior&nbsp;depending&nbsp;on&nbsp;whether</span><br>
<span class="lineno"></span><span class="comment" id="4808851">//&nbsp;int&nbsp;is&nbsp;32&nbsp;or&nbsp;64&nbsp;bits.&nbsp;See&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="4808885">//&nbsp;http://www.imperialviolet.org/2012/03/16/rsae.html.</span><br>
<span class="lineno"></span><span class="keyword" id="4808940">func</span>&nbsp;<span class="ident" id="4808945">checkPub</span><span class="op" id="4808953">(</span><span class="ident" id="4808954">pub</span>&nbsp;<span class="op" id="4808958">*</span><span class="ident" id="4808959">PublicKey</span><span class="op" id="4808968">)</span>&nbsp;<span class="builtintype" id="4808970">error</span>&nbsp;<span class="op" id="4808976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808979">if</span>&nbsp;<span class="ident" id="4808982">pub</span><span class="op" id="4808985">.</span><span class="ident" id="4808986">N</span>&nbsp;<span class="op" id="4808988">==</span>&nbsp;<span class="ident" id="4808991">nil</span>&nbsp;<span class="op" id="4808995">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808999">return</span>&nbsp;<span class="ident" id="4809006">errPublicModulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809027">if</span>&nbsp;<span class="ident" id="4809030">pub</span><span class="op" id="4809033">.</span><span class="ident" id="4809034">E</span>&nbsp;<span class="op" id="4809036">&lt;</span>&nbsp;<span class="num" id="4809038">2</span>&nbsp;<span class="op" id="4809040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809044">return</span>&nbsp;<span class="ident" id="4809051">errPublicExponentSmall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809075">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809078">if</span>&nbsp;<span class="ident" id="4809081">pub</span><span class="op" id="4809084">.</span><span class="ident" id="4809085">E</span>&nbsp;<span class="op" id="4809087">&gt;</span>&nbsp;<span class="num" id="4809089">1</span><span class="op" id="4809090">&lt;&lt;</span><span class="num" id="4809092">31</span><span class="op" id="4809094">-</span><span class="num" id="4809095">1</span>&nbsp;<span class="op" id="4809097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809101">return</span>&nbsp;<span class="ident" id="4809108">errPublicExponentLarge</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809135">return</span>&nbsp;<span class="ident" id="4809142">nil</span><br>
<span class="lineno"></span><span class="op" id="4809146">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4809149">//&nbsp;A&nbsp;PrivateKey&nbsp;represents&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno"></span><span class="keyword" id="4809187">type</span>&nbsp;<span class="ident" id="4809192">PrivateKey</span>&nbsp;<span class="keyword" id="4809203">struct</span>&nbsp;<span class="op" id="4809210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809213">PublicKey</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4809234">//&nbsp;public&nbsp;part.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809251">D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4809261">*</span><span class="ident" id="4809262">big</span><span class="op" id="4809265">.</span><span class="ident" id="4809266">Int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4809272">//&nbsp;private&nbsp;exponent</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809293">Primes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4809303">[</span><span class="op" id="4809304">]</span><span class="op" id="4809305">*</span><span class="ident" id="4809306">big</span><span class="op" id="4809309">.</span><span class="ident" id="4809310">Int</span>&nbsp;<span class="comment" id="4809314">//&nbsp;prime&nbsp;factors&nbsp;of&nbsp;N,&nbsp;has&nbsp;&gt;=&nbsp;2&nbsp;elements.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4809358">//&nbsp;Precomputed&nbsp;contains&nbsp;precomputed&nbsp;values&nbsp;that&nbsp;speed&nbsp;up&nbsp;private</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4809424">//&nbsp;operations,&nbsp;if&nbsp;available.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809454">Precomputed</span>&nbsp;<span class="ident" id="4809466">PrecomputedValues</span><br>
<span class="lineno">60</span><span class="op" id="4809484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4809487">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno"></span><span class="keyword" id="4809543">func</span>&nbsp;<span class="op" id="4809548">(</span><span class="ident" id="4809549">priv</span>&nbsp;<span class="op" id="4809554">*</span><span class="ident" id="4809555">PrivateKey</span><span class="op" id="4809565">)</span>&nbsp;<span class="ident" id="4809567">Public</span><span class="op" id="4809573">(</span><span class="op" id="4809574">)</span>&nbsp;<span class="ident" id="4809576">crypto</span><span class="op" id="4809582">.</span><span class="ident" id="4809583">PublicKey</span>&nbsp;<span class="op" id="4809593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809596">return</span>&nbsp;<span class="op" id="4809603">&amp;</span><span class="ident" id="4809604">priv</span><span class="op" id="4809608">.</span><span class="ident" id="4809609">PublicKey</span><br>
<span class="lineno">65</span><span class="op" id="4809619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4809622">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;If&nbsp;opts&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4809694">//&nbsp;*PSSOptions&nbsp;then&nbsp;the&nbsp;PSS&nbsp;algorithm&nbsp;will&nbsp;be&nbsp;used,&nbsp;otherwise&nbsp;PKCS#1&nbsp;v1.5&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="4809773">//&nbsp;be&nbsp;used.&nbsp;This&nbsp;method&nbsp;is&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="4809851">//&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign*</span><br>
<span class="lineno"></span><span class="comment" id="4809928">//&nbsp;functions&nbsp;in&nbsp;this&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="4809958">func</span>&nbsp;<span class="op" id="4809963">(</span><span class="ident" id="4809964">priv</span>&nbsp;<span class="op" id="4809969">*</span><span class="ident" id="4809970">PrivateKey</span><span class="op" id="4809980">)</span>&nbsp;<span class="ident" id="4809982">Sign</span><span class="op" id="4809986">(</span><span class="ident" id="4809987">rand</span>&nbsp;<span class="ident" id="4809992">io</span><span class="op" id="4809994">.</span><span class="ident" id="4809995">Reader</span><span class="op" id="4810001">,</span>&nbsp;<span class="ident" id="4810003">msg</span>&nbsp;<span class="op" id="4810007">[</span><span class="op" id="4810008">]</span><span class="builtintype" id="4810009">byte</span><span class="op" id="4810013">,</span>&nbsp;<span class="ident" id="4810015">opts</span>&nbsp;<span class="ident" id="4810020">crypto</span><span class="op" id="4810026">.</span><span class="ident" id="4810027">SignerOpts</span><span class="op" id="4810037">)</span>&nbsp;<span class="op" id="4810039">(</span><span class="op" id="4810040">[</span><span class="op" id="4810041">]</span><span class="builtintype" id="4810042">byte</span><span class="op" id="4810046">,</span>&nbsp;<span class="builtintype" id="4810048">error</span><span class="op" id="4810053">)</span>&nbsp;<span class="op" id="4810055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810058">if</span>&nbsp;<span class="ident" id="4810061">pssOpts</span><span class="op" id="4810068">,</span>&nbsp;<span class="ident" id="4810070">ok</span>&nbsp;<span class="op" id="4810073">:=</span>&nbsp;<span class="ident" id="4810076">opts</span><span class="op" id="4810080">.</span><span class="op" id="4810081">(</span><span class="op" id="4810082">*</span><span class="ident" id="4810083">PSSOptions</span><span class="op" id="4810093">)</span><span class="op" id="4810094">;</span>&nbsp;<span class="ident" id="4810096">ok</span>&nbsp;<span class="op" id="4810099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810103">return</span>&nbsp;<span class="ident" id="4810110">SignPSS</span><span class="op" id="4810117">(</span><span class="ident" id="4810118">rand</span><span class="op" id="4810122">,</span>&nbsp;<span class="ident" id="4810124">priv</span><span class="op" id="4810128">,</span>&nbsp;<span class="ident" id="4810130">pssOpts</span><span class="op" id="4810137">.</span><span class="ident" id="4810138">Hash</span><span class="op" id="4810142">,</span>&nbsp;<span class="ident" id="4810144">msg</span><span class="op" id="4810147">,</span>&nbsp;<span class="ident" id="4810149">pssOpts</span><span class="op" id="4810156">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810163">return</span>&nbsp;<span class="ident" id="4810170">SignPKCS1v15</span><span class="op" id="4810182">(</span><span class="ident" id="4810183">rand</span><span class="op" id="4810187">,</span>&nbsp;<span class="ident" id="4810189">priv</span><span class="op" id="4810193">,</span>&nbsp;<span class="ident" id="4810195">opts</span><span class="op" id="4810199">.</span><span class="ident" id="4810200">HashFunc</span><span class="op" id="4810208">(</span><span class="op" id="4810209">)</span><span class="op" id="4810210">,</span>&nbsp;<span class="ident" id="4810212">msg</span><span class="op" id="4810215">)</span><br>
<span class="lineno"></span><span class="op" id="4810217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4810220">type</span>&nbsp;<span class="ident" id="4810225">PrecomputedValues</span>&nbsp;<span class="keyword" id="4810243">struct</span>&nbsp;<span class="op" id="4810250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810253">Dp</span><span class="op" id="4810255">,</span>&nbsp;<span class="ident" id="4810257">Dq</span>&nbsp;<span class="op" id="4810260">*</span><span class="ident" id="4810261">big</span><span class="op" id="4810264">.</span><span class="ident" id="4810265">Int</span>&nbsp;<span class="comment" id="4810269">//&nbsp;D&nbsp;mod&nbsp;(P-1)&nbsp;(or&nbsp;mod&nbsp;Q-1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810298">Qinv</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4810305">*</span><span class="ident" id="4810306">big</span><span class="op" id="4810309">.</span><span class="ident" id="4810310">Int</span>&nbsp;<span class="comment" id="4810314">//&nbsp;Q^-1&nbsp;mod&nbsp;P</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810330">//&nbsp;CRTValues&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;3rd&nbsp;and&nbsp;subsequent&nbsp;primes.&nbsp;Due&nbsp;to&nbsp;a</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810396">//&nbsp;historical&nbsp;accident,&nbsp;the&nbsp;CRT&nbsp;for&nbsp;the&nbsp;first&nbsp;two&nbsp;primes&nbsp;is&nbsp;handled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810465">//&nbsp;differently&nbsp;in&nbsp;PKCS#1&nbsp;and&nbsp;interoperability&nbsp;is&nbsp;sufficiently</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810528">//&nbsp;important&nbsp;that&nbsp;we&nbsp;mirror&nbsp;this.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810563">CRTValues</span>&nbsp;<span class="op" id="4810573">[</span><span class="op" id="4810574">]</span><span class="ident" id="4810575">CRTValue</span><br>
<span class="lineno"></span><span class="op" id="4810584">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="4810587">//&nbsp;CRTValue&nbsp;contains&nbsp;the&nbsp;precomputed&nbsp;chinese&nbsp;remainder&nbsp;theorem&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4810658">type</span>&nbsp;<span class="ident" id="4810663">CRTValue</span>&nbsp;<span class="keyword" id="4810672">struct</span>&nbsp;<span class="op" id="4810679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810682">Exp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4810688">*</span><span class="ident" id="4810689">big</span><span class="op" id="4810692">.</span><span class="ident" id="4810693">Int</span>&nbsp;<span class="comment" id="4810697">//&nbsp;D&nbsp;mod&nbsp;(prime-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810718">Coeff</span>&nbsp;<span class="op" id="4810724">*</span><span class="ident" id="4810725">big</span><span class="op" id="4810728">.</span><span class="ident" id="4810729">Int</span>&nbsp;<span class="comment" id="4810733">//&nbsp;R·Coeff&nbsp;≡&nbsp;1&nbsp;mod&nbsp;Prime.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810763">R</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4810769">*</span><span class="ident" id="4810770">big</span><span class="op" id="4810773">.</span><span class="ident" id="4810774">Int</span>&nbsp;<span class="comment" id="4810778">//&nbsp;product&nbsp;of&nbsp;primes&nbsp;prior&nbsp;to&nbsp;this&nbsp;(inc&nbsp;p&nbsp;and&nbsp;q).</span><br>
<span class="lineno"></span><span class="op" id="4810828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4810831">//&nbsp;Validate&nbsp;performs&nbsp;basic&nbsp;sanity&nbsp;checks&nbsp;on&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="4810884">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;the&nbsp;key&nbsp;is&nbsp;valid,&nbsp;or&nbsp;else&nbsp;an&nbsp;error&nbsp;describing&nbsp;a&nbsp;problem.</span><br>
<span class="lineno">100</span><span class="keyword" id="4810962">func</span>&nbsp;<span class="op" id="4810967">(</span><span class="ident" id="4810968">priv</span>&nbsp;<span class="op" id="4810973">*</span><span class="ident" id="4810974">PrivateKey</span><span class="op" id="4810984">)</span>&nbsp;<span class="ident" id="4810986">Validate</span><span class="op" id="4810994">(</span><span class="op" id="4810995">)</span>&nbsp;<span class="builtintype" id="4810997">error</span>&nbsp;<span class="op" id="4811003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811006">if</span>&nbsp;<span class="ident" id="4811009">err</span>&nbsp;<span class="op" id="4811013">:=</span>&nbsp;<span class="ident" id="4811016">checkPub</span><span class="op" id="4811024">(</span><span class="op" id="4811025">&amp;</span><span class="ident" id="4811026">priv</span><span class="op" id="4811030">.</span><span class="ident" id="4811031">PublicKey</span><span class="op" id="4811040">)</span><span class="op" id="4811041">;</span>&nbsp;<span class="ident" id="4811043">err</span>&nbsp;<span class="op" id="4811047">!=</span>&nbsp;<span class="ident" id="4811050">nil</span>&nbsp;<span class="op" id="4811054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811058">return</span>&nbsp;<span class="ident" id="4811065">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811074">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;prime&nbsp;factors&nbsp;are&nbsp;actually&nbsp;prime.&nbsp;Note&nbsp;that&nbsp;this&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811145">//&nbsp;just&nbsp;a&nbsp;sanity&nbsp;check.&nbsp;Since&nbsp;the&nbsp;random&nbsp;witnesses&nbsp;chosen&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811207">//&nbsp;ProbablyPrime&nbsp;are&nbsp;deterministic,&nbsp;given&nbsp;the&nbsp;candidate&nbsp;number,&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811277">//&nbsp;easy&nbsp;for&nbsp;an&nbsp;attack&nbsp;to&nbsp;generate&nbsp;composites&nbsp;that&nbsp;pass&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811344">for</span>&nbsp;<span class="ident" id="4811348">_</span><span class="op" id="4811349">,</span>&nbsp;<span class="ident" id="4811351">prime</span>&nbsp;<span class="op" id="4811357">:=</span>&nbsp;<span class="keyword" id="4811360">range</span>&nbsp;<span class="ident" id="4811366">priv</span><span class="op" id="4811370">.</span><span class="ident" id="4811371">Primes</span>&nbsp;<span class="op" id="4811378">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811382">if</span>&nbsp;<span class="op" id="4811385">!</span><span class="ident" id="4811386">prime</span><span class="op" id="4811391">.</span><span class="ident" id="4811392">ProbablyPrime</span><span class="op" id="4811405">(</span><span class="num" id="4811406">20</span><span class="op" id="4811408">)</span>&nbsp;<span class="op" id="4811410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811415">return</span>&nbsp;<span class="ident" id="4811422">errors</span><span class="op" id="4811428">.</span><span class="ident" id="4811429">New</span><span class="op" id="4811432">(</span><span class="string" id="4811433">&#34;crypto/rsa:&nbsp;prime&nbsp;factor&nbsp;is&nbsp;composite&#34;</span><span class="op" id="4811472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811483">//&nbsp;Check&nbsp;that&nbsp;Πprimes&nbsp;==&nbsp;n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4811513">modulus</span>&nbsp;<span class="op" id="4811521">:=</span>&nbsp;<span class="builtinfunc" id="4811524">new</span><span class="op" id="4811527">(</span><span class="ident" id="4811528">big</span><span class="op" id="4811531">.</span><span class="ident" id="4811532">Int</span><span class="op" id="4811535">)</span><span class="op" id="4811536">.</span><span class="ident" id="4811537">Set</span><span class="op" id="4811540">(</span><span class="ident" id="4811541">bigOne</span><span class="op" id="4811547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811550">for</span>&nbsp;<span class="ident" id="4811554">_</span><span class="op" id="4811555">,</span>&nbsp;<span class="ident" id="4811557">prime</span>&nbsp;<span class="op" id="4811563">:=</span>&nbsp;<span class="keyword" id="4811566">range</span>&nbsp;<span class="ident" id="4811572">priv</span><span class="op" id="4811576">.</span><span class="ident" id="4811577">Primes</span>&nbsp;<span class="op" id="4811584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4811588">modulus</span><span class="op" id="4811595">.</span><span class="ident" id="4811596">Mul</span><span class="op" id="4811599">(</span><span class="ident" id="4811600">modulus</span><span class="op" id="4811607">,</span>&nbsp;<span class="ident" id="4811609">prime</span><span class="op" id="4811614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811617">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811620">if</span>&nbsp;<span class="ident" id="4811623">modulus</span><span class="op" id="4811630">.</span><span class="ident" id="4811631">Cmp</span><span class="op" id="4811634">(</span><span class="ident" id="4811635">priv</span><span class="op" id="4811639">.</span><span class="ident" id="4811640">N</span><span class="op" id="4811641">)</span>&nbsp;<span class="op" id="4811643">!=</span>&nbsp;<span class="num" id="4811646">0</span>&nbsp;<span class="op" id="4811648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811652">return</span>&nbsp;<span class="ident" id="4811659">errors</span><span class="op" id="4811665">.</span><span class="ident" id="4811666">New</span><span class="op" id="4811669">(</span><span class="string" id="4811670">&#34;crypto/rsa:&nbsp;invalid&nbsp;modulus&#34;</span><span class="op" id="4811699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811706">//&nbsp;Check&nbsp;that&nbsp;de&nbsp;≡&nbsp;1&nbsp;mod&nbsp;p-1,&nbsp;for&nbsp;each&nbsp;prime.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811755">//&nbsp;This&nbsp;implies&nbsp;that&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;each&nbsp;p-1&nbsp;as&nbsp;e&nbsp;has&nbsp;a&nbsp;multiplicative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811828">//&nbsp;inverse.&nbsp;Therefore&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;lcm(p-1,q-1,r-1,...)&nbsp;=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811890">//&nbsp;exponent(ℤ/nℤ).&nbsp;It&nbsp;also&nbsp;implies&nbsp;that&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;p&nbsp;as&nbsp;a^(p-1)&nbsp;≡&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811969">//&nbsp;mod&nbsp;p.&nbsp;Thus&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;n&nbsp;for&nbsp;all&nbsp;a&nbsp;coprime&nbsp;to&nbsp;n,&nbsp;as&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812039">congruence</span>&nbsp;<span class="op" id="4812050">:=</span>&nbsp;<span class="builtinfunc" id="4812053">new</span><span class="op" id="4812056">(</span><span class="ident" id="4812057">big</span><span class="op" id="4812060">.</span><span class="ident" id="4812061">Int</span><span class="op" id="4812064">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812067">de</span>&nbsp;<span class="op" id="4812070">:=</span>&nbsp;<span class="builtinfunc" id="4812073">new</span><span class="op" id="4812076">(</span><span class="ident" id="4812077">big</span><span class="op" id="4812080">.</span><span class="ident" id="4812081">Int</span><span class="op" id="4812084">)</span><span class="op" id="4812085">.</span><span class="ident" id="4812086">SetInt64</span><span class="op" id="4812094">(</span><span class="ident" id="4812095">int64</span><span class="op" id="4812100">(</span><span class="ident" id="4812101">priv</span><span class="op" id="4812105">.</span><span class="ident" id="4812106">E</span><span class="op" id="4812107">)</span><span class="op" id="4812108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812111">de</span><span class="op" id="4812113">.</span><span class="ident" id="4812114">Mul</span><span class="op" id="4812117">(</span><span class="ident" id="4812118">de</span><span class="op" id="4812120">,</span>&nbsp;<span class="ident" id="4812122">priv</span><span class="op" id="4812126">.</span><span class="ident" id="4812127">D</span><span class="op" id="4812128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812131">for</span>&nbsp;<span class="ident" id="4812135">_</span><span class="op" id="4812136">,</span>&nbsp;<span class="ident" id="4812138">prime</span>&nbsp;<span class="op" id="4812144">:=</span>&nbsp;<span class="keyword" id="4812147">range</span>&nbsp;<span class="ident" id="4812153">priv</span><span class="op" id="4812157">.</span><span class="ident" id="4812158">Primes</span>&nbsp;<span class="op" id="4812165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812169">pminus1</span>&nbsp;<span class="op" id="4812177">:=</span>&nbsp;<span class="builtinfunc" id="4812180">new</span><span class="op" id="4812183">(</span><span class="ident" id="4812184">big</span><span class="op" id="4812187">.</span><span class="ident" id="4812188">Int</span><span class="op" id="4812191">)</span><span class="op" id="4812192">.</span><span class="ident" id="4812193">Sub</span><span class="op" id="4812196">(</span><span class="ident" id="4812197">prime</span><span class="op" id="4812202">,</span>&nbsp;<span class="ident" id="4812204">bigOne</span><span class="op" id="4812210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4812214">congruence</span><span class="op" id="4812224">.</span><span class="ident" id="4812225">Mod</span><span class="op" id="4812228">(</span><span class="ident" id="4812229">de</span><span class="op" id="4812231">,</span>&nbsp;<span class="ident" id="4812233">pminus1</span><span class="op" id="4812240">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812244">if</span>&nbsp;<span class="ident" id="4812247">congruence</span><span class="op" id="4812257">.</span><span class="ident" id="4812258">Cmp</span><span class="op" id="4812261">(</span><span class="ident" id="4812262">bigOne</span><span class="op" id="4812268">)</span>&nbsp;<span class="op" id="4812270">!=</span>&nbsp;<span class="num" id="4812273">0</span>&nbsp;<span class="op" id="4812275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812280">return</span>&nbsp;<span class="ident" id="4812287">errors</span><span class="op" id="4812293">.</span><span class="ident" id="4812294">New</span><span class="op" id="4812297">(</span><span class="string" id="4812298">&#34;crypto/rsa:&nbsp;invalid&nbsp;exponents&#34;</span><span class="op" id="4812329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4812333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4812336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812339">return</span>&nbsp;<span class="ident" id="4812346">nil</span><br>
<span class="lineno">140</span><span class="op" id="4812350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4812353">//&nbsp;GenerateKey&nbsp;generates&nbsp;an&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit&nbsp;size&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4812425">//&nbsp;random&nbsp;source&nbsp;random&nbsp;(for&nbsp;example,&nbsp;crypto/rand.Reader).</span><br>
<span class="lineno"></span><span class="keyword" id="4812484">func</span>&nbsp;<span class="ident" id="4812489">GenerateKey</span><span class="op" id="4812500">(</span><span class="ident" id="4812501">random</span>&nbsp;<span class="ident" id="4812508">io</span><span class="op" id="4812510">.</span><span class="ident" id="4812511">Reader</span><span class="op" id="4812517">,</span>&nbsp;<span class="ident" id="4812519">bits</span>&nbsp;<span class="builtintype" id="4812524">int</span><span class="op" id="4812527">)</span>&nbsp;<span class="op" id="4812529">(</span><span class="ident" id="4812530">priv</span>&nbsp;<span class="op" id="4812535">*</span><span class="ident" id="4812536">PrivateKey</span><span class="op" id="4812546">,</span>&nbsp;<span class="ident" id="4812548">err</span>&nbsp;<span class="builtintype" id="4812552">error</span><span class="op" id="4812557">)</span>&nbsp;<span class="op" id="4812559">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4812562">return</span>&nbsp;<span class="ident" id="4812569">GenerateMultiPrimeKey</span><span class="op" id="4812590">(</span><span class="ident" id="4812591">random</span><span class="op" id="4812597">,</span>&nbsp;<span class="num" id="4812599">2</span><span class="op" id="4812600">,</span>&nbsp;<span class="ident" id="4812602">bits</span><span class="op" id="4812606">)</span><br>
<span class="lineno"></span><span class="op" id="4812608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4812611">//&nbsp;GenerateMultiPrimeKey&nbsp;generates&nbsp;a&nbsp;multi-prime&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="4812689">//&nbsp;size&nbsp;and&nbsp;the&nbsp;given&nbsp;random&nbsp;source,&nbsp;as&nbsp;suggested&nbsp;in&nbsp;[1].&nbsp;Although&nbsp;the&nbsp;public</span><br>
<span class="lineno">150</span><span class="comment" id="4812767">//&nbsp;keys&nbsp;are&nbsp;compatible&nbsp;(actually,&nbsp;indistinguishable)&nbsp;from&nbsp;the&nbsp;2-prime&nbsp;case,</span><br>
<span class="lineno"></span><span class="comment" id="4812843">//&nbsp;the&nbsp;private&nbsp;keys&nbsp;are&nbsp;not.&nbsp;Thus&nbsp;it&nbsp;may&nbsp;not&nbsp;be&nbsp;possible&nbsp;to&nbsp;export&nbsp;multi-prime</span><br>
<span class="lineno"></span><span class="comment" id="4812922">//&nbsp;private&nbsp;keys&nbsp;in&nbsp;certain&nbsp;formats&nbsp;or&nbsp;to&nbsp;subsequently&nbsp;import&nbsp;them&nbsp;into&nbsp;other</span><br>
<span class="lineno"></span><span class="comment" id="4812999">//&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4813008">//</span><br>
<span class="lineno">155</span><span class="comment" id="4813011">//&nbsp;Table&nbsp;1&nbsp;in&nbsp;[2]&nbsp;suggests&nbsp;maximum&nbsp;numbers&nbsp;of&nbsp;primes&nbsp;for&nbsp;a&nbsp;given&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="4813082">//</span><br>
<span class="lineno"></span><span class="comment" id="4813085">//&nbsp;[1]&nbsp;US&nbsp;patent&nbsp;4405829&nbsp;(1972,&nbsp;expired)</span><br>
<span class="lineno"></span><span class="comment" id="4813126">//&nbsp;[2]&nbsp;http://www.cacr.math.uwaterloo.ca/techreports/2006/cacr2006-16.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="4813200">func</span>&nbsp;<span class="ident" id="4813205">GenerateMultiPrimeKey</span><span class="op" id="4813226">(</span><span class="ident" id="4813227">random</span>&nbsp;<span class="ident" id="4813234">io</span><span class="op" id="4813236">.</span><span class="ident" id="4813237">Reader</span><span class="op" id="4813243">,</span>&nbsp;<span class="ident" id="4813245">nprimes</span>&nbsp;<span class="builtintype" id="4813253">int</span><span class="op" id="4813256">,</span>&nbsp;<span class="ident" id="4813258">bits</span>&nbsp;<span class="builtintype" id="4813263">int</span><span class="op" id="4813266">)</span>&nbsp;<span class="op" id="4813268">(</span><span class="ident" id="4813269">priv</span>&nbsp;<span class="op" id="4813274">*</span><span class="ident" id="4813275">PrivateKey</span><span class="op" id="4813285">,</span>&nbsp;<span class="ident" id="4813287">err</span>&nbsp;<span class="builtintype" id="4813291">error</span><span class="op" id="4813296">)</span>&nbsp;<span class="op" id="4813298">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813301">priv</span>&nbsp;<span class="op" id="4813306">=</span>&nbsp;<span class="builtinfunc" id="4813308">new</span><span class="op" id="4813311">(</span><span class="ident" id="4813312">PrivateKey</span><span class="op" id="4813322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813325">priv</span><span class="op" id="4813329">.</span><span class="ident" id="4813330">E</span>&nbsp;<span class="op" id="4813332">=</span>&nbsp;<span class="num" id="4813334">65537</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813342">if</span>&nbsp;<span class="ident" id="4813345">nprimes</span>&nbsp;<span class="op" id="4813353">&lt;</span>&nbsp;<span class="num" id="4813355">2</span>&nbsp;<span class="op" id="4813357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813361">return</span>&nbsp;<span class="ident" id="4813368">nil</span><span class="op" id="4813371">,</span>&nbsp;<span class="ident" id="4813373">errors</span><span class="op" id="4813379">.</span><span class="ident" id="4813380">New</span><span class="op" id="4813383">(</span><span class="string" id="4813384">&#34;crypto/rsa:&nbsp;GenerateMultiPrimeKey:&nbsp;nprimes&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&#34;</span><span class="op" id="4813441">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4813444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813448">primes</span>&nbsp;<span class="op" id="4813455">:=</span>&nbsp;<span class="builtinfunc" id="4813458">make</span><span class="op" id="4813462">(</span><span class="op" id="4813463">[</span><span class="op" id="4813464">]</span><span class="op" id="4813465">*</span><span class="ident" id="4813466">big</span><span class="op" id="4813469">.</span><span class="ident" id="4813470">Int</span><span class="op" id="4813473">,</span>&nbsp;<span class="ident" id="4813475">nprimes</span><span class="op" id="4813482">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4813485">NextSetOfPrimes</span><span class="op" id="4813500">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4813503">for</span>&nbsp;<span class="op" id="4813507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4813511">todo</span>&nbsp;<span class="op" id="4813516">:=</span>&nbsp;<span class="ident" id="4813519">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4813526">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4813586">//&nbsp;Thus&nbsp;each&nbsp;prime&nbsp;has&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4813620">//&nbsp;&nbsp;&nbsp;p_i&nbsp;=&nbsp;2^bitlen(p_i)&nbsp;×&nbsp;0.11...&nbsp;(in&nbsp;base&nbsp;2).</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4813671">//&nbsp;And&nbsp;the&nbsp;product&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4813696">//&nbsp;&nbsp;&nbsp;P&nbsp;=&nbsp;2^todo&nbsp;×&nbsp;α</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4813720">//&nbsp;where&nbsp;α&nbsp;is&nbsp;the&nbsp;product&nbsp;of&nbsp;nprimes&nbsp;numbers&nbsp;of&nbsp;the&nbsp;form&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4813788">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4813793">//&nbsp;If&nbsp;α&nbsp;&lt;&nbsp;1/2&nbsp;(which&nbsp;can&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;&gt;&nbsp;2),&nbsp;we&nbsp;need&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4813857">//&nbsp;shift&nbsp;todo&nbsp;to&nbsp;compensate&nbsp;for&nbsp;lost&nbsp;bits:&nbsp;the&nbsp;mean&nbsp;value&nbsp;of&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4813928">//&nbsp;is&nbsp;7/8,&nbsp;so&nbsp;todo&nbsp;+&nbsp;shift&nbsp;-&nbsp;nprimes&nbsp;*&nbsp;log2(7/8)&nbsp;~=&nbsp;bits&nbsp;-&nbsp;1/2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4813993">//&nbsp;will&nbsp;give&nbsp;good&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814022">if</span>&nbsp;<span class="ident" id="4814025">nprimes</span>&nbsp;<span class="op" id="4814033">&gt;=</span>&nbsp;<span class="num" id="4814036">7</span>&nbsp;<span class="op" id="4814038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814043">todo</span>&nbsp;<span class="op" id="4814048">+=</span>&nbsp;<span class="op" id="4814051">(</span><span class="ident" id="4814052">nprimes</span>&nbsp;<span class="op" id="4814060">-</span>&nbsp;<span class="num" id="4814062">2</span><span class="op" id="4814063">)</span>&nbsp;<span class="op" id="4814065">/</span>&nbsp;<span class="num" id="4814067">5</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4814071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814075">for</span>&nbsp;<span class="ident" id="4814079">i</span>&nbsp;<span class="op" id="4814081">:=</span>&nbsp;<span class="num" id="4814084">0</span><span class="op" id="4814085">;</span>&nbsp;<span class="ident" id="4814087">i</span>&nbsp;<span class="op" id="4814089">&lt;</span>&nbsp;<span class="ident" id="4814091">nprimes</span><span class="op" id="4814098">;</span>&nbsp;<span class="ident" id="4814100">i</span><span class="op" id="4814101">++</span>&nbsp;<span class="op" id="4814104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814109">primes</span><span class="op" id="4814115">[</span><span class="ident" id="4814116">i</span><span class="op" id="4814117">]</span><span class="op" id="4814118">,</span>&nbsp;<span class="ident" id="4814120">err</span>&nbsp;<span class="op" id="4814124">=</span>&nbsp;<span class="ident" id="4814126">rand</span><span class="op" id="4814130">.</span><span class="ident" id="4814131">Prime</span><span class="op" id="4814136">(</span><span class="ident" id="4814137">random</span><span class="op" id="4814143">,</span>&nbsp;<span class="ident" id="4814145">todo</span><span class="op" id="4814149">/</span><span class="op" id="4814150">(</span><span class="ident" id="4814151">nprimes</span><span class="op" id="4814158">-</span><span class="ident" id="4814159">i</span><span class="op" id="4814160">)</span><span class="op" id="4814161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814166">if</span>&nbsp;<span class="ident" id="4814169">err</span>&nbsp;<span class="op" id="4814173">!=</span>&nbsp;<span class="ident" id="4814176">nil</span>&nbsp;<span class="op" id="4814180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814186">return</span>&nbsp;<span class="ident" id="4814193">nil</span><span class="op" id="4814196">,</span>&nbsp;<span class="ident" id="4814198">err</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4814205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814210">todo</span>&nbsp;<span class="op" id="4814215">-=</span>&nbsp;<span class="ident" id="4814218">primes</span><span class="op" id="4814224">[</span><span class="ident" id="4814225">i</span><span class="op" id="4814226">]</span><span class="op" id="4814227">.</span><span class="ident" id="4814228">BitLen</span><span class="op" id="4814234">(</span><span class="op" id="4814235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4814239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4814244">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;primes&nbsp;is&nbsp;pairwise&nbsp;unequal.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814292">for</span>&nbsp;<span class="ident" id="4814296">i</span><span class="op" id="4814297">,</span>&nbsp;<span class="ident" id="4814299">prime</span>&nbsp;<span class="op" id="4814305">:=</span>&nbsp;<span class="keyword" id="4814308">range</span>&nbsp;<span class="ident" id="4814314">primes</span>&nbsp;<span class="op" id="4814321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814326">for</span>&nbsp;<span class="ident" id="4814330">j</span>&nbsp;<span class="op" id="4814332">:=</span>&nbsp;<span class="num" id="4814335">0</span><span class="op" id="4814336">;</span>&nbsp;<span class="ident" id="4814338">j</span>&nbsp;<span class="op" id="4814340">&lt;</span>&nbsp;<span class="ident" id="4814342">i</span><span class="op" id="4814343">;</span>&nbsp;<span class="ident" id="4814345">j</span><span class="op" id="4814346">++</span>&nbsp;<span class="op" id="4814349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814355">if</span>&nbsp;<span class="ident" id="4814358">prime</span><span class="op" id="4814363">.</span><span class="ident" id="4814364">Cmp</span><span class="op" id="4814367">(</span><span class="ident" id="4814368">primes</span><span class="op" id="4814374">[</span><span class="ident" id="4814375">j</span><span class="op" id="4814376">]</span><span class="op" id="4814377">)</span>&nbsp;<span class="op" id="4814379">==</span>&nbsp;<span class="num" id="4814382">0</span>&nbsp;<span class="op" id="4814384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814391">continue</span>&nbsp;<span class="ident" id="4814400">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4814420">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4814425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4814429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814434">n</span>&nbsp;<span class="op" id="4814436">:=</span>&nbsp;<span class="builtinfunc" id="4814439">new</span><span class="op" id="4814442">(</span><span class="ident" id="4814443">big</span><span class="op" id="4814446">.</span><span class="ident" id="4814447">Int</span><span class="op" id="4814450">)</span><span class="op" id="4814451">.</span><span class="ident" id="4814452">Set</span><span class="op" id="4814455">(</span><span class="ident" id="4814456">bigOne</span><span class="op" id="4814462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814466">totient</span>&nbsp;<span class="op" id="4814474">:=</span>&nbsp;<span class="builtinfunc" id="4814477">new</span><span class="op" id="4814480">(</span><span class="ident" id="4814481">big</span><span class="op" id="4814484">.</span><span class="ident" id="4814485">Int</span><span class="op" id="4814488">)</span><span class="op" id="4814489">.</span><span class="ident" id="4814490">Set</span><span class="op" id="4814493">(</span><span class="ident" id="4814494">bigOne</span><span class="op" id="4814500">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814504">pminus1</span>&nbsp;<span class="op" id="4814512">:=</span>&nbsp;<span class="builtinfunc" id="4814515">new</span><span class="op" id="4814518">(</span><span class="ident" id="4814519">big</span><span class="op" id="4814522">.</span><span class="ident" id="4814523">Int</span><span class="op" id="4814526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814530">for</span>&nbsp;<span class="ident" id="4814534">_</span><span class="op" id="4814535">,</span>&nbsp;<span class="ident" id="4814537">prime</span>&nbsp;<span class="op" id="4814543">:=</span>&nbsp;<span class="keyword" id="4814546">range</span>&nbsp;<span class="ident" id="4814552">primes</span>&nbsp;<span class="op" id="4814559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814564">n</span><span class="op" id="4814565">.</span><span class="ident" id="4814566">Mul</span><span class="op" id="4814569">(</span><span class="ident" id="4814570">n</span><span class="op" id="4814571">,</span>&nbsp;<span class="ident" id="4814573">prime</span><span class="op" id="4814578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814583">pminus1</span><span class="op" id="4814590">.</span><span class="ident" id="4814591">Sub</span><span class="op" id="4814594">(</span><span class="ident" id="4814595">prime</span><span class="op" id="4814600">,</span>&nbsp;<span class="ident" id="4814602">bigOne</span><span class="op" id="4814608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814613">totient</span><span class="op" id="4814620">.</span><span class="ident" id="4814621">Mul</span><span class="op" id="4814624">(</span><span class="ident" id="4814625">totient</span><span class="op" id="4814632">,</span>&nbsp;<span class="ident" id="4814634">pminus1</span><span class="op" id="4814641">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4814645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814649">if</span>&nbsp;<span class="ident" id="4814652">n</span><span class="op" id="4814653">.</span><span class="ident" id="4814654">BitLen</span><span class="op" id="4814660">(</span><span class="op" id="4814661">)</span>&nbsp;<span class="op" id="4814663">!=</span>&nbsp;<span class="ident" id="4814666">bits</span>&nbsp;<span class="op" id="4814671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4814676">//&nbsp;This&nbsp;should&nbsp;never&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;==&nbsp;2&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4814732">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4814793">//&nbsp;For&nbsp;nprimes&nbsp;&gt;&nbsp;2&nbsp;we&nbsp;hope&nbsp;it&nbsp;does&nbsp;not&nbsp;happen&nbsp;often.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4814849">continue</span>&nbsp;<span class="ident" id="4814858">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4814876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814881">g</span>&nbsp;<span class="op" id="4814883">:=</span>&nbsp;<span class="builtinfunc" id="4814886">new</span><span class="op" id="4814889">(</span><span class="ident" id="4814890">big</span><span class="op" id="4814893">.</span><span class="ident" id="4814894">Int</span><span class="op" id="4814897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814901">priv</span><span class="op" id="4814905">.</span><span class="ident" id="4814906">D</span>&nbsp;<span class="op" id="4814908">=</span>&nbsp;<span class="builtinfunc" id="4814910">new</span><span class="op" id="4814913">(</span><span class="ident" id="4814914">big</span><span class="op" id="4814917">.</span><span class="ident" id="4814918">Int</span><span class="op" id="4814921">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814925">y</span>&nbsp;<span class="op" id="4814927">:=</span>&nbsp;<span class="builtinfunc" id="4814930">new</span><span class="op" id="4814933">(</span><span class="ident" id="4814934">big</span><span class="op" id="4814937">.</span><span class="ident" id="4814938">Int</span><span class="op" id="4814941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814945">e</span>&nbsp;<span class="op" id="4814947">:=</span>&nbsp;<span class="ident" id="4814950">big</span><span class="op" id="4814953">.</span><span class="ident" id="4814954">NewInt</span><span class="op" id="4814960">(</span><span class="ident" id="4814961">int64</span><span class="op" id="4814966">(</span><span class="ident" id="4814967">priv</span><span class="op" id="4814971">.</span><span class="ident" id="4814972">E</span><span class="op" id="4814973">)</span><span class="op" id="4814974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4814978">g</span><span class="op" id="4814979">.</span><span class="ident" id="4814980">GCD</span><span class="op" id="4814983">(</span><span class="ident" id="4814984">priv</span><span class="op" id="4814988">.</span><span class="ident" id="4814989">D</span><span class="op" id="4814990">,</span>&nbsp;<span class="ident" id="4814992">y</span><span class="op" id="4814993">,</span>&nbsp;<span class="ident" id="4814995">e</span><span class="op" id="4814996">,</span>&nbsp;<span class="ident" id="4814998">totient</span><span class="op" id="4815005">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815010">if</span>&nbsp;<span class="ident" id="4815013">g</span><span class="op" id="4815014">.</span><span class="ident" id="4815015">Cmp</span><span class="op" id="4815018">(</span><span class="ident" id="4815019">bigOne</span><span class="op" id="4815025">)</span>&nbsp;<span class="op" id="4815027">==</span>&nbsp;<span class="num" id="4815030">0</span>&nbsp;<span class="op" id="4815032">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815037">if</span>&nbsp;<span class="ident" id="4815040">priv</span><span class="op" id="4815044">.</span><span class="ident" id="4815045">D</span><span class="op" id="4815046">.</span><span class="ident" id="4815047">Sign</span><span class="op" id="4815051">(</span><span class="op" id="4815052">)</span>&nbsp;<span class="op" id="4815054">&lt;</span>&nbsp;<span class="num" id="4815056">0</span>&nbsp;<span class="op" id="4815058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815064">priv</span><span class="op" id="4815068">.</span><span class="ident" id="4815069">D</span><span class="op" id="4815070">.</span><span class="ident" id="4815071">Add</span><span class="op" id="4815074">(</span><span class="ident" id="4815075">priv</span><span class="op" id="4815079">.</span><span class="ident" id="4815080">D</span><span class="op" id="4815081">,</span>&nbsp;<span class="ident" id="4815083">totient</span><span class="op" id="4815090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4815095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815100">priv</span><span class="op" id="4815104">.</span><span class="ident" id="4815105">Primes</span>&nbsp;<span class="op" id="4815112">=</span>&nbsp;<span class="ident" id="4815114">primes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815124">priv</span><span class="op" id="4815128">.</span><span class="ident" id="4815129">N</span>&nbsp;<span class="op" id="4815131">=</span>&nbsp;<span class="ident" id="4815133">n</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815139">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4815147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4815150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815154">priv</span><span class="op" id="4815158">.</span><span class="ident" id="4815159">Precompute</span><span class="op" id="4815169">(</span><span class="op" id="4815170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815173">return</span><br>
<span class="lineno"></span><span class="op" id="4815180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4815183">//&nbsp;incCounter&nbsp;increments&nbsp;a&nbsp;four&nbsp;byte,&nbsp;big-endian&nbsp;counter.</span><br>
<span class="lineno">240</span><span class="keyword" id="4815241">func</span>&nbsp;<span class="ident" id="4815246">incCounter</span><span class="op" id="4815256">(</span><span class="ident" id="4815257">c</span>&nbsp;<span class="op" id="4815259">*</span><span class="op" id="4815260">[</span><span class="num" id="4815261">4</span><span class="op" id="4815262">]</span><span class="builtintype" id="4815263">byte</span><span class="op" id="4815267">)</span>&nbsp;<span class="op" id="4815269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815272">if</span>&nbsp;<span class="ident" id="4815275">c</span><span class="op" id="4815276">[</span><span class="num" id="4815277">3</span><span class="op" id="4815278">]</span><span class="op" id="4815279">++</span><span class="op" id="4815281">;</span>&nbsp;<span class="ident" id="4815283">c</span><span class="op" id="4815284">[</span><span class="num" id="4815285">3</span><span class="op" id="4815286">]</span>&nbsp;<span class="op" id="4815288">!=</span>&nbsp;<span class="num" id="4815291">0</span>&nbsp;<span class="op" id="4815293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815297">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4815305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815308">if</span>&nbsp;<span class="ident" id="4815311">c</span><span class="op" id="4815312">[</span><span class="num" id="4815313">2</span><span class="op" id="4815314">]</span><span class="op" id="4815315">++</span><span class="op" id="4815317">;</span>&nbsp;<span class="ident" id="4815319">c</span><span class="op" id="4815320">[</span><span class="num" id="4815321">2</span><span class="op" id="4815322">]</span>&nbsp;<span class="op" id="4815324">!=</span>&nbsp;<span class="num" id="4815327">0</span>&nbsp;<span class="op" id="4815329">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815333">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4815341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815344">if</span>&nbsp;<span class="ident" id="4815347">c</span><span class="op" id="4815348">[</span><span class="num" id="4815349">1</span><span class="op" id="4815350">]</span><span class="op" id="4815351">++</span><span class="op" id="4815353">;</span>&nbsp;<span class="ident" id="4815355">c</span><span class="op" id="4815356">[</span><span class="num" id="4815357">1</span><span class="op" id="4815358">]</span>&nbsp;<span class="op" id="4815360">!=</span>&nbsp;<span class="num" id="4815363">0</span>&nbsp;<span class="op" id="4815365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815369">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4815377">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815380">c</span><span class="op" id="4815381">[</span><span class="num" id="4815382">0</span><span class="op" id="4815383">]</span><span class="op" id="4815384">++</span><br>
<span class="lineno"></span><span class="op" id="4815387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4815390">//&nbsp;mgf1XOR&nbsp;XORs&nbsp;the&nbsp;bytes&nbsp;in&nbsp;out&nbsp;with&nbsp;a&nbsp;mask&nbsp;generated&nbsp;using&nbsp;the&nbsp;MGF1&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4815469">//&nbsp;specified&nbsp;in&nbsp;PKCS#1&nbsp;v2.1.</span><br>
<span class="lineno">255</span><span class="keyword" id="4815498">func</span>&nbsp;<span class="ident" id="4815503">mgf1XOR</span><span class="op" id="4815510">(</span><span class="ident" id="4815511">out</span>&nbsp;<span class="op" id="4815515">[</span><span class="op" id="4815516">]</span><span class="builtintype" id="4815517">byte</span><span class="op" id="4815521">,</span>&nbsp;<span class="ident" id="4815523">hash</span>&nbsp;<span class="ident" id="4815528">hash</span><span class="op" id="4815532">.</span><span class="ident" id="4815533">Hash</span><span class="op" id="4815537">,</span>&nbsp;<span class="ident" id="4815539">seed</span>&nbsp;<span class="op" id="4815544">[</span><span class="op" id="4815545">]</span><span class="builtintype" id="4815546">byte</span><span class="op" id="4815550">)</span>&nbsp;<span class="op" id="4815552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815555">var</span>&nbsp;<span class="ident" id="4815559">counter</span>&nbsp;<span class="op" id="4815567">[</span><span class="num" id="4815568">4</span><span class="op" id="4815569">]</span><span class="builtintype" id="4815570">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815576">var</span>&nbsp;<span class="ident" id="4815580">digest</span>&nbsp;<span class="op" id="4815587">[</span><span class="op" id="4815588">]</span><span class="builtintype" id="4815589">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815596">done</span>&nbsp;<span class="op" id="4815601">:=</span>&nbsp;<span class="num" id="4815604">0</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815607">for</span>&nbsp;<span class="ident" id="4815611">done</span>&nbsp;<span class="op" id="4815616">&lt;</span>&nbsp;<span class="builtinfunc" id="4815618">len</span><span class="op" id="4815621">(</span><span class="ident" id="4815622">out</span><span class="op" id="4815625">)</span>&nbsp;<span class="op" id="4815627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815631">hash</span><span class="op" id="4815635">.</span><span class="ident" id="4815636">Write</span><span class="op" id="4815641">(</span><span class="ident" id="4815642">seed</span><span class="op" id="4815646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815650">hash</span><span class="op" id="4815654">.</span><span class="ident" id="4815655">Write</span><span class="op" id="4815660">(</span><span class="ident" id="4815661">counter</span><span class="op" id="4815668">[</span><span class="num" id="4815669">0</span><span class="op" id="4815670">:</span><span class="num" id="4815671">4</span><span class="op" id="4815672">]</span><span class="op" id="4815673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815677">digest</span>&nbsp;<span class="op" id="4815684">=</span>&nbsp;<span class="ident" id="4815686">hash</span><span class="op" id="4815690">.</span><span class="ident" id="4815691">Sum</span><span class="op" id="4815694">(</span><span class="ident" id="4815695">digest</span><span class="op" id="4815701">[</span><span class="op" id="4815702">:</span><span class="num" id="4815703">0</span><span class="op" id="4815704">]</span><span class="op" id="4815705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815709">hash</span><span class="op" id="4815713">.</span><span class="ident" id="4815714">Reset</span><span class="op" id="4815719">(</span><span class="op" id="4815720">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4815725">for</span>&nbsp;<span class="ident" id="4815729">i</span>&nbsp;<span class="op" id="4815731">:=</span>&nbsp;<span class="num" id="4815734">0</span><span class="op" id="4815735">;</span>&nbsp;<span class="ident" id="4815737">i</span>&nbsp;<span class="op" id="4815739">&lt;</span>&nbsp;<span class="builtinfunc" id="4815741">len</span><span class="op" id="4815744">(</span><span class="ident" id="4815745">digest</span><span class="op" id="4815751">)</span>&nbsp;<span class="op" id="4815753">&amp;&amp;</span>&nbsp;<span class="ident" id="4815756">done</span>&nbsp;<span class="op" id="4815761">&lt;</span>&nbsp;<span class="builtinfunc" id="4815763">len</span><span class="op" id="4815766">(</span><span class="ident" id="4815767">out</span><span class="op" id="4815770">)</span><span class="op" id="4815771">;</span>&nbsp;<span class="ident" id="4815773">i</span><span class="op" id="4815774">++</span>&nbsp;<span class="op" id="4815777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815782">out</span><span class="op" id="4815785">[</span><span class="ident" id="4815786">done</span><span class="op" id="4815790">]</span>&nbsp;<span class="op" id="4815792">^=</span>&nbsp;<span class="ident" id="4815795">digest</span><span class="op" id="4815801">[</span><span class="ident" id="4815802">i</span><span class="op" id="4815803">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815808">done</span><span class="op" id="4815812">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4815817">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4815821">incCounter</span><span class="op" id="4815831">(</span><span class="op" id="4815832">&amp;</span><span class="ident" id="4815833">counter</span><span class="op" id="4815840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4815843">}</span><br>
<span class="lineno"></span><span class="op" id="4815845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4815848">//&nbsp;ErrMessageTooLong&nbsp;is&nbsp;returned&nbsp;when&nbsp;attempting&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;message&nbsp;which&nbsp;is</span><br>
<span class="lineno">275</span><span class="comment" id="4815927">//&nbsp;too&nbsp;large&nbsp;for&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4815972">var</span>&nbsp;<span class="ident" id="4815976">ErrMessageTooLong</span>&nbsp;<span class="op" id="4815994">=</span>&nbsp;<span class="ident" id="4815996">errors</span><span class="op" id="4816002">.</span><span class="ident" id="4816003">New</span><span class="op" id="4816006">(</span><span class="string" id="4816007">&#34;crypto/rsa:&nbsp;message&nbsp;too&nbsp;long&nbsp;for&nbsp;RSA&nbsp;public&nbsp;key&nbsp;size&#34;</span><span class="op" id="4816061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4816064">func</span>&nbsp;<span class="ident" id="4816069">encrypt</span><span class="op" id="4816076">(</span><span class="ident" id="4816077">c</span>&nbsp;<span class="op" id="4816079">*</span><span class="ident" id="4816080">big</span><span class="op" id="4816083">.</span><span class="ident" id="4816084">Int</span><span class="op" id="4816087">,</span>&nbsp;<span class="ident" id="4816089">pub</span>&nbsp;<span class="op" id="4816093">*</span><span class="ident" id="4816094">PublicKey</span><span class="op" id="4816103">,</span>&nbsp;<span class="ident" id="4816105">m</span>&nbsp;<span class="op" id="4816107">*</span><span class="ident" id="4816108">big</span><span class="op" id="4816111">.</span><span class="ident" id="4816112">Int</span><span class="op" id="4816115">)</span>&nbsp;<span class="op" id="4816117">*</span><span class="ident" id="4816118">big</span><span class="op" id="4816121">.</span><span class="ident" id="4816122">Int</span>&nbsp;<span class="op" id="4816126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816129">e</span>&nbsp;<span class="op" id="4816131">:=</span>&nbsp;<span class="ident" id="4816134">big</span><span class="op" id="4816137">.</span><span class="ident" id="4816138">NewInt</span><span class="op" id="4816144">(</span><span class="ident" id="4816145">int64</span><span class="op" id="4816150">(</span><span class="ident" id="4816151">pub</span><span class="op" id="4816154">.</span><span class="ident" id="4816155">E</span><span class="op" id="4816156">)</span><span class="op" id="4816157">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816160">c</span><span class="op" id="4816161">.</span><span class="ident" id="4816162">Exp</span><span class="op" id="4816165">(</span><span class="ident" id="4816166">m</span><span class="op" id="4816167">,</span>&nbsp;<span class="ident" id="4816169">e</span><span class="op" id="4816170">,</span>&nbsp;<span class="ident" id="4816172">pub</span><span class="op" id="4816175">.</span><span class="ident" id="4816176">N</span><span class="op" id="4816177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816180">return</span>&nbsp;<span class="ident" id="4816187">c</span><br>
<span class="lineno"></span><span class="op" id="4816189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4816192">//&nbsp;EncryptOAEP&nbsp;encrypts&nbsp;the&nbsp;given&nbsp;message&nbsp;with&nbsp;RSA-OAEP.</span><br>
<span class="lineno">285</span><span class="comment" id="4816249">//&nbsp;The&nbsp;message&nbsp;must&nbsp;be&nbsp;no&nbsp;longer&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;public&nbsp;modulus&nbsp;less</span><br>
<span class="lineno"></span><span class="comment" id="4816325">//&nbsp;twice&nbsp;the&nbsp;hash&nbsp;length&nbsp;plus&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="4816358">func</span>&nbsp;<span class="ident" id="4816363">EncryptOAEP</span><span class="op" id="4816374">(</span><span class="ident" id="4816375">hash</span>&nbsp;<span class="ident" id="4816380">hash</span><span class="op" id="4816384">.</span><span class="ident" id="4816385">Hash</span><span class="op" id="4816389">,</span>&nbsp;<span class="ident" id="4816391">random</span>&nbsp;<span class="ident" id="4816398">io</span><span class="op" id="4816400">.</span><span class="ident" id="4816401">Reader</span><span class="op" id="4816407">,</span>&nbsp;<span class="ident" id="4816409">pub</span>&nbsp;<span class="op" id="4816413">*</span><span class="ident" id="4816414">PublicKey</span><span class="op" id="4816423">,</span>&nbsp;<span class="ident" id="4816425">msg</span>&nbsp;<span class="op" id="4816429">[</span><span class="op" id="4816430">]</span><span class="builtintype" id="4816431">byte</span><span class="op" id="4816435">,</span>&nbsp;<span class="ident" id="4816437">label</span>&nbsp;<span class="op" id="4816443">[</span><span class="op" id="4816444">]</span><span class="builtintype" id="4816445">byte</span><span class="op" id="4816449">)</span>&nbsp;<span class="op" id="4816451">(</span><span class="ident" id="4816452">out</span>&nbsp;<span class="op" id="4816456">[</span><span class="op" id="4816457">]</span><span class="builtintype" id="4816458">byte</span><span class="op" id="4816462">,</span>&nbsp;<span class="ident" id="4816464">err</span>&nbsp;<span class="builtintype" id="4816468">error</span><span class="op" id="4816473">)</span>&nbsp;<span class="op" id="4816475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816478">if</span>&nbsp;<span class="ident" id="4816481">err</span>&nbsp;<span class="op" id="4816485">:=</span>&nbsp;<span class="ident" id="4816488">checkPub</span><span class="op" id="4816496">(</span><span class="ident" id="4816497">pub</span><span class="op" id="4816500">)</span><span class="op" id="4816501">;</span>&nbsp;<span class="ident" id="4816503">err</span>&nbsp;<span class="op" id="4816507">!=</span>&nbsp;<span class="ident" id="4816510">nil</span>&nbsp;<span class="op" id="4816514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816518">return</span>&nbsp;<span class="ident" id="4816525">nil</span><span class="op" id="4816528">,</span>&nbsp;<span class="ident" id="4816530">err</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4816535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816538">hash</span><span class="op" id="4816542">.</span><span class="ident" id="4816543">Reset</span><span class="op" id="4816548">(</span><span class="op" id="4816549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816552">k</span>&nbsp;<span class="op" id="4816554">:=</span>&nbsp;<span class="op" id="4816557">(</span><span class="ident" id="4816558">pub</span><span class="op" id="4816561">.</span><span class="ident" id="4816562">N</span><span class="op" id="4816563">.</span><span class="ident" id="4816564">BitLen</span><span class="op" id="4816570">(</span><span class="op" id="4816571">)</span>&nbsp;<span class="op" id="4816573">+</span>&nbsp;<span class="num" id="4816575">7</span><span class="op" id="4816576">)</span>&nbsp;<span class="op" id="4816578">/</span>&nbsp;<span class="num" id="4816580">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816583">if</span>&nbsp;<span class="builtinfunc" id="4816586">len</span><span class="op" id="4816589">(</span><span class="ident" id="4816590">msg</span><span class="op" id="4816593">)</span>&nbsp;<span class="op" id="4816595">&gt;</span>&nbsp;<span class="ident" id="4816597">k</span><span class="op" id="4816598">-</span><span class="num" id="4816599">2</span><span class="op" id="4816600">*</span><span class="ident" id="4816601">hash</span><span class="op" id="4816605">.</span><span class="ident" id="4816606">Size</span><span class="op" id="4816610">(</span><span class="op" id="4816611">)</span><span class="op" id="4816612">-</span><span class="num" id="4816613">2</span>&nbsp;<span class="op" id="4816615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816619">err</span>&nbsp;<span class="op" id="4816623">=</span>&nbsp;<span class="ident" id="4816625">ErrMessageTooLong</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816645">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4816653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816657">hash</span><span class="op" id="4816661">.</span><span class="ident" id="4816662">Write</span><span class="op" id="4816667">(</span><span class="ident" id="4816668">label</span><span class="op" id="4816673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816676">lHash</span>&nbsp;<span class="op" id="4816682">:=</span>&nbsp;<span class="ident" id="4816685">hash</span><span class="op" id="4816689">.</span><span class="ident" id="4816690">Sum</span><span class="op" id="4816693">(</span><span class="ident" id="4816694">nil</span><span class="op" id="4816697">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816700">hash</span><span class="op" id="4816704">.</span><span class="ident" id="4816705">Reset</span><span class="op" id="4816710">(</span><span class="op" id="4816711">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816715">em</span>&nbsp;<span class="op" id="4816718">:=</span>&nbsp;<span class="builtinfunc" id="4816721">make</span><span class="op" id="4816725">(</span><span class="op" id="4816726">[</span><span class="op" id="4816727">]</span><span class="builtintype" id="4816728">byte</span><span class="op" id="4816732">,</span>&nbsp;<span class="ident" id="4816734">k</span><span class="op" id="4816735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816738">seed</span>&nbsp;<span class="op" id="4816743">:=</span>&nbsp;<span class="ident" id="4816746">em</span><span class="op" id="4816748">[</span><span class="num" id="4816749">1</span>&nbsp;<span class="op" id="4816751">:</span>&nbsp;<span class="num" id="4816753">1</span><span class="op" id="4816754">+</span><span class="ident" id="4816755">hash</span><span class="op" id="4816759">.</span><span class="ident" id="4816760">Size</span><span class="op" id="4816764">(</span><span class="op" id="4816765">)</span><span class="op" id="4816766">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816769">db</span>&nbsp;<span class="op" id="4816772">:=</span>&nbsp;<span class="ident" id="4816775">em</span><span class="op" id="4816777">[</span><span class="num" id="4816778">1</span><span class="op" id="4816779">+</span><span class="ident" id="4816780">hash</span><span class="op" id="4816784">.</span><span class="ident" id="4816785">Size</span><span class="op" id="4816789">(</span><span class="op" id="4816790">)</span><span class="op" id="4816791">:</span><span class="op" id="4816792">]</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4816796">copy</span><span class="op" id="4816800">(</span><span class="ident" id="4816801">db</span><span class="op" id="4816803">[</span><span class="num" id="4816804">0</span><span class="op" id="4816805">:</span><span class="ident" id="4816806">hash</span><span class="op" id="4816810">.</span><span class="ident" id="4816811">Size</span><span class="op" id="4816815">(</span><span class="op" id="4816816">)</span><span class="op" id="4816817">]</span><span class="op" id="4816818">,</span>&nbsp;<span class="ident" id="4816820">lHash</span><span class="op" id="4816825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816828">db</span><span class="op" id="4816830">[</span><span class="builtinfunc" id="4816831">len</span><span class="op" id="4816834">(</span><span class="ident" id="4816835">db</span><span class="op" id="4816837">)</span><span class="op" id="4816838">-</span><span class="builtinfunc" id="4816839">len</span><span class="op" id="4816842">(</span><span class="ident" id="4816843">msg</span><span class="op" id="4816846">)</span><span class="op" id="4816847">-</span><span class="num" id="4816848">1</span><span class="op" id="4816849">]</span>&nbsp;<span class="op" id="4816851">=</span>&nbsp;<span class="num" id="4816853">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4816856">copy</span><span class="op" id="4816860">(</span><span class="ident" id="4816861">db</span><span class="op" id="4816863">[</span><span class="builtinfunc" id="4816864">len</span><span class="op" id="4816867">(</span><span class="ident" id="4816868">db</span><span class="op" id="4816870">)</span><span class="op" id="4816871">-</span><span class="builtinfunc" id="4816872">len</span><span class="op" id="4816875">(</span><span class="ident" id="4816876">msg</span><span class="op" id="4816879">)</span><span class="op" id="4816880">:</span><span class="op" id="4816881">]</span><span class="op" id="4816882">,</span>&nbsp;<span class="ident" id="4816884">msg</span><span class="op" id="4816887">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816891">_</span><span class="op" id="4816892">,</span>&nbsp;<span class="ident" id="4816894">err</span>&nbsp;<span class="op" id="4816898">=</span>&nbsp;<span class="ident" id="4816900">io</span><span class="op" id="4816902">.</span><span class="ident" id="4816903">ReadFull</span><span class="op" id="4816911">(</span><span class="ident" id="4816912">random</span><span class="op" id="4816918">,</span>&nbsp;<span class="ident" id="4816920">seed</span><span class="op" id="4816924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816927">if</span>&nbsp;<span class="ident" id="4816930">err</span>&nbsp;<span class="op" id="4816934">!=</span>&nbsp;<span class="ident" id="4816937">nil</span>&nbsp;<span class="op" id="4816941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4816945">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4816953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816957">mgf1XOR</span><span class="op" id="4816964">(</span><span class="ident" id="4816965">db</span><span class="op" id="4816967">,</span>&nbsp;<span class="ident" id="4816969">hash</span><span class="op" id="4816973">,</span>&nbsp;<span class="ident" id="4816975">seed</span><span class="op" id="4816979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816982">mgf1XOR</span><span class="op" id="4816989">(</span><span class="ident" id="4816990">seed</span><span class="op" id="4816994">,</span>&nbsp;<span class="ident" id="4816996">hash</span><span class="op" id="4817000">,</span>&nbsp;<span class="ident" id="4817002">db</span><span class="op" id="4817004">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817008">m</span>&nbsp;<span class="op" id="4817010">:=</span>&nbsp;<span class="builtinfunc" id="4817013">new</span><span class="op" id="4817016">(</span><span class="ident" id="4817017">big</span><span class="op" id="4817020">.</span><span class="ident" id="4817021">Int</span><span class="op" id="4817024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817027">m</span><span class="op" id="4817028">.</span><span class="ident" id="4817029">SetBytes</span><span class="op" id="4817037">(</span><span class="ident" id="4817038">em</span><span class="op" id="4817040">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817043">c</span>&nbsp;<span class="op" id="4817045">:=</span>&nbsp;<span class="ident" id="4817048">encrypt</span><span class="op" id="4817055">(</span><span class="builtinfunc" id="4817056">new</span><span class="op" id="4817059">(</span><span class="ident" id="4817060">big</span><span class="op" id="4817063">.</span><span class="ident" id="4817064">Int</span><span class="op" id="4817067">)</span><span class="op" id="4817068">,</span>&nbsp;<span class="ident" id="4817070">pub</span><span class="op" id="4817073">,</span>&nbsp;<span class="ident" id="4817075">m</span><span class="op" id="4817076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817079">out</span>&nbsp;<span class="op" id="4817083">=</span>&nbsp;<span class="ident" id="4817085">c</span><span class="op" id="4817086">.</span><span class="ident" id="4817087">Bytes</span><span class="op" id="4817092">(</span><span class="op" id="4817093">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817097">if</span>&nbsp;<span class="builtinfunc" id="4817100">len</span><span class="op" id="4817103">(</span><span class="ident" id="4817104">out</span><span class="op" id="4817107">)</span>&nbsp;<span class="op" id="4817109">&lt;</span>&nbsp;<span class="ident" id="4817111">k</span>&nbsp;<span class="op" id="4817113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4817117">//&nbsp;If&nbsp;the&nbsp;output&nbsp;is&nbsp;too&nbsp;small,&nbsp;we&nbsp;need&nbsp;to&nbsp;left-pad&nbsp;with&nbsp;zeros.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817182">t</span>&nbsp;<span class="op" id="4817184">:=</span>&nbsp;<span class="builtinfunc" id="4817187">make</span><span class="op" id="4817191">(</span><span class="op" id="4817192">[</span><span class="op" id="4817193">]</span><span class="builtintype" id="4817194">byte</span><span class="op" id="4817198">,</span>&nbsp;<span class="ident" id="4817200">k</span><span class="op" id="4817201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4817205">copy</span><span class="op" id="4817209">(</span><span class="ident" id="4817210">t</span><span class="op" id="4817211">[</span><span class="ident" id="4817212">k</span><span class="op" id="4817213">-</span><span class="builtinfunc" id="4817214">len</span><span class="op" id="4817217">(</span><span class="ident" id="4817218">out</span><span class="op" id="4817221">)</span><span class="op" id="4817222">:</span><span class="op" id="4817223">]</span><span class="op" id="4817224">,</span>&nbsp;<span class="ident" id="4817226">out</span><span class="op" id="4817229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817233">out</span>&nbsp;<span class="op" id="4817237">=</span>&nbsp;<span class="ident" id="4817239">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4817242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817246">return</span><br>
<span class="lineno"></span><span class="op" id="4817253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4817256">//&nbsp;ErrDecryption&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;decrypt&nbsp;a&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="4817316">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno">335</span><span class="keyword" id="4817371">var</span>&nbsp;<span class="ident" id="4817375">ErrDecryption</span>&nbsp;<span class="op" id="4817389">=</span>&nbsp;<span class="ident" id="4817391">errors</span><span class="op" id="4817397">.</span><span class="ident" id="4817398">New</span><span class="op" id="4817401">(</span><span class="string" id="4817402">&#34;crypto/rsa:&nbsp;decryption&nbsp;error&#34;</span><span class="op" id="4817432">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4817435">//&nbsp;ErrVerification&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;verify&nbsp;a&nbsp;signature.</span><br>
<span class="lineno"></span><span class="comment" id="4817498">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4817553">var</span>&nbsp;<span class="ident" id="4817557">ErrVerification</span>&nbsp;<span class="op" id="4817573">=</span>&nbsp;<span class="ident" id="4817575">errors</span><span class="op" id="4817581">.</span><span class="ident" id="4817582">New</span><span class="op" id="4817585">(</span><span class="string" id="4817586">&#34;crypto/rsa:&nbsp;verification&nbsp;error&#34;</span><span class="op" id="4817618">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="comment" id="4817621">//&nbsp;modInverse&nbsp;returns&nbsp;ia,&nbsp;the&nbsp;inverse&nbsp;of&nbsp;a&nbsp;in&nbsp;the&nbsp;multiplicative&nbsp;group&nbsp;of&nbsp;prime</span><br>
<span class="lineno"></span><span class="comment" id="4817701">//&nbsp;order&nbsp;n.&nbsp;It&nbsp;requires&nbsp;that&nbsp;a&nbsp;be&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;group&nbsp;(i.e.&nbsp;less&nbsp;than&nbsp;n).</span><br>
<span class="lineno"></span><span class="keyword" id="4817777">func</span>&nbsp;<span class="ident" id="4817782">modInverse</span><span class="op" id="4817792">(</span><span class="ident" id="4817793">a</span><span class="op" id="4817794">,</span>&nbsp;<span class="ident" id="4817796">n</span>&nbsp;<span class="op" id="4817798">*</span><span class="ident" id="4817799">big</span><span class="op" id="4817802">.</span><span class="ident" id="4817803">Int</span><span class="op" id="4817806">)</span>&nbsp;<span class="op" id="4817808">(</span><span class="ident" id="4817809">ia</span>&nbsp;<span class="op" id="4817812">*</span><span class="ident" id="4817813">big</span><span class="op" id="4817816">.</span><span class="ident" id="4817817">Int</span><span class="op" id="4817820">,</span>&nbsp;<span class="ident" id="4817822">ok</span>&nbsp;<span class="builtintype" id="4817825">bool</span><span class="op" id="4817829">)</span>&nbsp;<span class="op" id="4817831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817834">g</span>&nbsp;<span class="op" id="4817836">:=</span>&nbsp;<span class="builtinfunc" id="4817839">new</span><span class="op" id="4817842">(</span><span class="ident" id="4817843">big</span><span class="op" id="4817846">.</span><span class="ident" id="4817847">Int</span><span class="op" id="4817850">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817853">x</span>&nbsp;<span class="op" id="4817855">:=</span>&nbsp;<span class="builtinfunc" id="4817858">new</span><span class="op" id="4817861">(</span><span class="ident" id="4817862">big</span><span class="op" id="4817865">.</span><span class="ident" id="4817866">Int</span><span class="op" id="4817869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817872">y</span>&nbsp;<span class="op" id="4817874">:=</span>&nbsp;<span class="builtinfunc" id="4817877">new</span><span class="op" id="4817880">(</span><span class="ident" id="4817881">big</span><span class="op" id="4817884">.</span><span class="ident" id="4817885">Int</span><span class="op" id="4817888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817891">g</span><span class="op" id="4817892">.</span><span class="ident" id="4817893">GCD</span><span class="op" id="4817896">(</span><span class="ident" id="4817897">x</span><span class="op" id="4817898">,</span>&nbsp;<span class="ident" id="4817900">y</span><span class="op" id="4817901">,</span>&nbsp;<span class="ident" id="4817903">a</span><span class="op" id="4817904">,</span>&nbsp;<span class="ident" id="4817906">n</span><span class="op" id="4817907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817910">if</span>&nbsp;<span class="ident" id="4817913">g</span><span class="op" id="4817914">.</span><span class="ident" id="4817915">Cmp</span><span class="op" id="4817918">(</span><span class="ident" id="4817919">bigOne</span><span class="op" id="4817925">)</span>&nbsp;<span class="op" id="4817927">!=</span>&nbsp;<span class="num" id="4817930">0</span>&nbsp;<span class="op" id="4817932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4817936">//&nbsp;In&nbsp;this&nbsp;case,&nbsp;a&nbsp;and&nbsp;n&nbsp;aren&#39;t&nbsp;coprime&nbsp;and&nbsp;we&nbsp;cannot&nbsp;calculate</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818002">//&nbsp;the&nbsp;inverse.&nbsp;This&nbsp;happens&nbsp;because&nbsp;the&nbsp;values&nbsp;of&nbsp;n&nbsp;are&nbsp;nearly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818068">//&nbsp;prime&nbsp;(being&nbsp;the&nbsp;product&nbsp;of&nbsp;two&nbsp;primes)&nbsp;rather&nbsp;than&nbsp;truly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818131">//&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818143">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4818151">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818155">if</span>&nbsp;<span class="ident" id="4818158">x</span><span class="op" id="4818159">.</span><span class="ident" id="4818160">Cmp</span><span class="op" id="4818163">(</span><span class="ident" id="4818164">bigOne</span><span class="op" id="4818170">)</span>&nbsp;<span class="op" id="4818172">&lt;</span>&nbsp;<span class="num" id="4818174">0</span>&nbsp;<span class="op" id="4818176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818180">//&nbsp;0&nbsp;is&nbsp;not&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;any&nbsp;element&nbsp;so,&nbsp;if&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818245">//&nbsp;&lt;&nbsp;1,&nbsp;then&nbsp;x&nbsp;is&nbsp;negative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818275">x</span><span class="op" id="4818276">.</span><span class="ident" id="4818277">Add</span><span class="op" id="4818280">(</span><span class="ident" id="4818281">x</span><span class="op" id="4818282">,</span>&nbsp;<span class="ident" id="4818284">n</span><span class="op" id="4818285">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4818288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818292">return</span>&nbsp;<span class="ident" id="4818299">x</span><span class="op" id="4818300">,</span>&nbsp;<span class="builtintype" id="4818302">true</span><br>
<span class="lineno"></span><span class="op" id="4818307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="4818310">//&nbsp;Precompute&nbsp;performs&nbsp;some&nbsp;calculations&nbsp;that&nbsp;speed&nbsp;up&nbsp;private&nbsp;key&nbsp;operations</span><br>
<span class="lineno"></span><span class="comment" id="4818388">//&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="4818406">func</span>&nbsp;<span class="op" id="4818411">(</span><span class="ident" id="4818412">priv</span>&nbsp;<span class="op" id="4818417">*</span><span class="ident" id="4818418">PrivateKey</span><span class="op" id="4818428">)</span>&nbsp;<span class="ident" id="4818430">Precompute</span><span class="op" id="4818440">(</span><span class="op" id="4818441">)</span>&nbsp;<span class="op" id="4818443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818446">if</span>&nbsp;<span class="ident" id="4818449">priv</span><span class="op" id="4818453">.</span><span class="ident" id="4818454">Precomputed</span><span class="op" id="4818465">.</span><span class="ident" id="4818466">Dp</span>&nbsp;<span class="op" id="4818469">!=</span>&nbsp;<span class="ident" id="4818472">nil</span>&nbsp;<span class="op" id="4818476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818480">return</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4818488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818492">priv</span><span class="op" id="4818496">.</span><span class="ident" id="4818497">Precomputed</span><span class="op" id="4818508">.</span><span class="ident" id="4818509">Dp</span>&nbsp;<span class="op" id="4818512">=</span>&nbsp;<span class="builtinfunc" id="4818514">new</span><span class="op" id="4818517">(</span><span class="ident" id="4818518">big</span><span class="op" id="4818521">.</span><span class="ident" id="4818522">Int</span><span class="op" id="4818525">)</span><span class="op" id="4818526">.</span><span class="ident" id="4818527">Sub</span><span class="op" id="4818530">(</span><span class="ident" id="4818531">priv</span><span class="op" id="4818535">.</span><span class="ident" id="4818536">Primes</span><span class="op" id="4818542">[</span><span class="num" id="4818543">0</span><span class="op" id="4818544">]</span><span class="op" id="4818545">,</span>&nbsp;<span class="ident" id="4818547">bigOne</span><span class="op" id="4818553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818556">priv</span><span class="op" id="4818560">.</span><span class="ident" id="4818561">Precomputed</span><span class="op" id="4818572">.</span><span class="ident" id="4818573">Dp</span><span class="op" id="4818575">.</span><span class="ident" id="4818576">Mod</span><span class="op" id="4818579">(</span><span class="ident" id="4818580">priv</span><span class="op" id="4818584">.</span><span class="ident" id="4818585">D</span><span class="op" id="4818586">,</span>&nbsp;<span class="ident" id="4818588">priv</span><span class="op" id="4818592">.</span><span class="ident" id="4818593">Precomputed</span><span class="op" id="4818604">.</span><span class="ident" id="4818605">Dp</span><span class="op" id="4818607">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818611">priv</span><span class="op" id="4818615">.</span><span class="ident" id="4818616">Precomputed</span><span class="op" id="4818627">.</span><span class="ident" id="4818628">Dq</span>&nbsp;<span class="op" id="4818631">=</span>&nbsp;<span class="builtinfunc" id="4818633">new</span><span class="op" id="4818636">(</span><span class="ident" id="4818637">big</span><span class="op" id="4818640">.</span><span class="ident" id="4818641">Int</span><span class="op" id="4818644">)</span><span class="op" id="4818645">.</span><span class="ident" id="4818646">Sub</span><span class="op" id="4818649">(</span><span class="ident" id="4818650">priv</span><span class="op" id="4818654">.</span><span class="ident" id="4818655">Primes</span><span class="op" id="4818661">[</span><span class="num" id="4818662">1</span><span class="op" id="4818663">]</span><span class="op" id="4818664">,</span>&nbsp;<span class="ident" id="4818666">bigOne</span><span class="op" id="4818672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818675">priv</span><span class="op" id="4818679">.</span><span class="ident" id="4818680">Precomputed</span><span class="op" id="4818691">.</span><span class="ident" id="4818692">Dq</span><span class="op" id="4818694">.</span><span class="ident" id="4818695">Mod</span><span class="op" id="4818698">(</span><span class="ident" id="4818699">priv</span><span class="op" id="4818703">.</span><span class="ident" id="4818704">D</span><span class="op" id="4818705">,</span>&nbsp;<span class="ident" id="4818707">priv</span><span class="op" id="4818711">.</span><span class="ident" id="4818712">Precomputed</span><span class="op" id="4818723">.</span><span class="ident" id="4818724">Dq</span><span class="op" id="4818726">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818730">priv</span><span class="op" id="4818734">.</span><span class="ident" id="4818735">Precomputed</span><span class="op" id="4818746">.</span><span class="ident" id="4818747">Qinv</span>&nbsp;<span class="op" id="4818752">=</span>&nbsp;<span class="builtinfunc" id="4818754">new</span><span class="op" id="4818757">(</span><span class="ident" id="4818758">big</span><span class="op" id="4818761">.</span><span class="ident" id="4818762">Int</span><span class="op" id="4818765">)</span><span class="op" id="4818766">.</span><span class="ident" id="4818767">ModInverse</span><span class="op" id="4818777">(</span><span class="ident" id="4818778">priv</span><span class="op" id="4818782">.</span><span class="ident" id="4818783">Primes</span><span class="op" id="4818789">[</span><span class="num" id="4818790">1</span><span class="op" id="4818791">]</span><span class="op" id="4818792">,</span>&nbsp;<span class="ident" id="4818794">priv</span><span class="op" id="4818798">.</span><span class="ident" id="4818799">Primes</span><span class="op" id="4818805">[</span><span class="num" id="4818806">0</span><span class="op" id="4818807">]</span><span class="op" id="4818808">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818812">r</span>&nbsp;<span class="op" id="4818814">:=</span>&nbsp;<span class="builtinfunc" id="4818817">new</span><span class="op" id="4818820">(</span><span class="ident" id="4818821">big</span><span class="op" id="4818824">.</span><span class="ident" id="4818825">Int</span><span class="op" id="4818828">)</span><span class="op" id="4818829">.</span><span class="ident" id="4818830">Mul</span><span class="op" id="4818833">(</span><span class="ident" id="4818834">priv</span><span class="op" id="4818838">.</span><span class="ident" id="4818839">Primes</span><span class="op" id="4818845">[</span><span class="num" id="4818846">0</span><span class="op" id="4818847">]</span><span class="op" id="4818848">,</span>&nbsp;<span class="ident" id="4818850">priv</span><span class="op" id="4818854">.</span><span class="ident" id="4818855">Primes</span><span class="op" id="4818861">[</span><span class="num" id="4818862">1</span><span class="op" id="4818863">]</span><span class="op" id="4818864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818867">priv</span><span class="op" id="4818871">.</span><span class="ident" id="4818872">Precomputed</span><span class="op" id="4818883">.</span><span class="ident" id="4818884">CRTValues</span>&nbsp;<span class="op" id="4818894">=</span>&nbsp;<span class="builtinfunc" id="4818896">make</span><span class="op" id="4818900">(</span><span class="op" id="4818901">[</span><span class="op" id="4818902">]</span><span class="ident" id="4818903">CRTValue</span><span class="op" id="4818911">,</span>&nbsp;<span class="builtinfunc" id="4818913">len</span><span class="op" id="4818916">(</span><span class="ident" id="4818917">priv</span><span class="op" id="4818921">.</span><span class="ident" id="4818922">Primes</span><span class="op" id="4818928">)</span><span class="op" id="4818929">-</span><span class="num" id="4818930">2</span><span class="op" id="4818931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818934">for</span>&nbsp;<span class="ident" id="4818938">i</span>&nbsp;<span class="op" id="4818940">:=</span>&nbsp;<span class="num" id="4818943">2</span><span class="op" id="4818944">;</span>&nbsp;<span class="ident" id="4818946">i</span>&nbsp;<span class="op" id="4818948">&lt;</span>&nbsp;<span class="builtinfunc" id="4818950">len</span><span class="op" id="4818953">(</span><span class="ident" id="4818954">priv</span><span class="op" id="4818958">.</span><span class="ident" id="4818959">Primes</span><span class="op" id="4818965">)</span><span class="op" id="4818966">;</span>&nbsp;<span class="ident" id="4818968">i</span><span class="op" id="4818969">++</span>&nbsp;<span class="op" id="4818972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818976">prime</span>&nbsp;<span class="op" id="4818982">:=</span>&nbsp;<span class="ident" id="4818985">priv</span><span class="op" id="4818989">.</span><span class="ident" id="4818990">Primes</span><span class="op" id="4818996">[</span><span class="ident" id="4818997">i</span><span class="op" id="4818998">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819002">values</span>&nbsp;<span class="op" id="4819009">:=</span>&nbsp;<span class="op" id="4819012">&amp;</span><span class="ident" id="4819013">priv</span><span class="op" id="4819017">.</span><span class="ident" id="4819018">Precomputed</span><span class="op" id="4819029">.</span><span class="ident" id="4819030">CRTValues</span><span class="op" id="4819039">[</span><span class="ident" id="4819040">i</span><span class="op" id="4819041">-</span><span class="num" id="4819042">2</span><span class="op" id="4819043">]</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819048">values</span><span class="op" id="4819054">.</span><span class="ident" id="4819055">Exp</span>&nbsp;<span class="op" id="4819059">=</span>&nbsp;<span class="builtinfunc" id="4819061">new</span><span class="op" id="4819064">(</span><span class="ident" id="4819065">big</span><span class="op" id="4819068">.</span><span class="ident" id="4819069">Int</span><span class="op" id="4819072">)</span><span class="op" id="4819073">.</span><span class="ident" id="4819074">Sub</span><span class="op" id="4819077">(</span><span class="ident" id="4819078">prime</span><span class="op" id="4819083">,</span>&nbsp;<span class="ident" id="4819085">bigOne</span><span class="op" id="4819091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819095">values</span><span class="op" id="4819101">.</span><span class="ident" id="4819102">Exp</span><span class="op" id="4819105">.</span><span class="ident" id="4819106">Mod</span><span class="op" id="4819109">(</span><span class="ident" id="4819110">priv</span><span class="op" id="4819114">.</span><span class="ident" id="4819115">D</span><span class="op" id="4819116">,</span>&nbsp;<span class="ident" id="4819118">values</span><span class="op" id="4819124">.</span><span class="ident" id="4819125">Exp</span><span class="op" id="4819128">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819133">values</span><span class="op" id="4819139">.</span><span class="ident" id="4819140">R</span>&nbsp;<span class="op" id="4819142">=</span>&nbsp;<span class="builtinfunc" id="4819144">new</span><span class="op" id="4819147">(</span><span class="ident" id="4819148">big</span><span class="op" id="4819151">.</span><span class="ident" id="4819152">Int</span><span class="op" id="4819155">)</span><span class="op" id="4819156">.</span><span class="ident" id="4819157">Set</span><span class="op" id="4819160">(</span><span class="ident" id="4819161">r</span><span class="op" id="4819162">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819166">values</span><span class="op" id="4819172">.</span><span class="ident" id="4819173">Coeff</span>&nbsp;<span class="op" id="4819179">=</span>&nbsp;<span class="builtinfunc" id="4819181">new</span><span class="op" id="4819184">(</span><span class="ident" id="4819185">big</span><span class="op" id="4819188">.</span><span class="ident" id="4819189">Int</span><span class="op" id="4819192">)</span><span class="op" id="4819193">.</span><span class="ident" id="4819194">ModInverse</span><span class="op" id="4819204">(</span><span class="ident" id="4819205">r</span><span class="op" id="4819206">,</span>&nbsp;<span class="ident" id="4819208">prime</span><span class="op" id="4819213">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819218">r</span><span class="op" id="4819219">.</span><span class="ident" id="4819220">Mul</span><span class="op" id="4819223">(</span><span class="ident" id="4819224">r</span><span class="op" id="4819225">,</span>&nbsp;<span class="ident" id="4819227">prime</span><span class="op" id="4819232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819235">}</span><br>
<span class="lineno"></span><span class="op" id="4819237">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="4819240">//&nbsp;decrypt&nbsp;performs&nbsp;an&nbsp;RSA&nbsp;decryption,&nbsp;resulting&nbsp;in&nbsp;a&nbsp;plaintext&nbsp;integer.&nbsp;If&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4819318">//&nbsp;random&nbsp;source&nbsp;is&nbsp;given,&nbsp;RSA&nbsp;blinding&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4819367">func</span>&nbsp;<span class="ident" id="4819372">decrypt</span><span class="op" id="4819379">(</span><span class="ident" id="4819380">random</span>&nbsp;<span class="ident" id="4819387">io</span><span class="op" id="4819389">.</span><span class="ident" id="4819390">Reader</span><span class="op" id="4819396">,</span>&nbsp;<span class="ident" id="4819398">priv</span>&nbsp;<span class="op" id="4819403">*</span><span class="ident" id="4819404">PrivateKey</span><span class="op" id="4819414">,</span>&nbsp;<span class="ident" id="4819416">c</span>&nbsp;<span class="op" id="4819418">*</span><span class="ident" id="4819419">big</span><span class="op" id="4819422">.</span><span class="ident" id="4819423">Int</span><span class="op" id="4819426">)</span>&nbsp;<span class="op" id="4819428">(</span><span class="ident" id="4819429">m</span>&nbsp;<span class="op" id="4819431">*</span><span class="ident" id="4819432">big</span><span class="op" id="4819435">.</span><span class="ident" id="4819436">Int</span><span class="op" id="4819439">,</span>&nbsp;<span class="ident" id="4819441">err</span>&nbsp;<span class="builtintype" id="4819445">error</span><span class="op" id="4819450">)</span>&nbsp;<span class="op" id="4819452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4819455">//&nbsp;TODO(agl):&nbsp;can&nbsp;we&nbsp;get&nbsp;away&nbsp;with&nbsp;reusing&nbsp;blinds?</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819507">if</span>&nbsp;<span class="ident" id="4819510">c</span><span class="op" id="4819511">.</span><span class="ident" id="4819512">Cmp</span><span class="op" id="4819515">(</span><span class="ident" id="4819516">priv</span><span class="op" id="4819520">.</span><span class="ident" id="4819521">N</span><span class="op" id="4819522">)</span>&nbsp;<span class="op" id="4819524">&gt;</span>&nbsp;<span class="num" id="4819526">0</span>&nbsp;<span class="op" id="4819528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819532">err</span>&nbsp;<span class="op" id="4819536">=</span>&nbsp;<span class="ident" id="4819538">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819554">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819566">var</span>&nbsp;<span class="ident" id="4819570">ir</span>&nbsp;<span class="op" id="4819573">*</span><span class="ident" id="4819574">big</span><span class="op" id="4819577">.</span><span class="ident" id="4819578">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819583">if</span>&nbsp;<span class="ident" id="4819586">random</span>&nbsp;<span class="op" id="4819593">!=</span>&nbsp;<span class="ident" id="4819596">nil</span>&nbsp;<span class="op" id="4819600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4819604">//&nbsp;Blinding&nbsp;enabled.&nbsp;Blinding&nbsp;involves&nbsp;multiplying&nbsp;c&nbsp;by&nbsp;r^e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4819667">//&nbsp;Then&nbsp;the&nbsp;decryption&nbsp;operation&nbsp;performs&nbsp;(m^e&nbsp;*&nbsp;r^e)^d&nbsp;mod&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4819731">//&nbsp;which&nbsp;equals&nbsp;mr&nbsp;mod&nbsp;n.&nbsp;The&nbsp;factor&nbsp;of&nbsp;r&nbsp;can&nbsp;then&nbsp;be&nbsp;removed</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4819795">//&nbsp;by&nbsp;multiplying&nbsp;by&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819852">var</span>&nbsp;<span class="ident" id="4819856">r</span>&nbsp;<span class="op" id="4819858">*</span><span class="ident" id="4819859">big</span><span class="op" id="4819862">.</span><span class="ident" id="4819863">Int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819870">for</span>&nbsp;<span class="op" id="4819874">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819879">r</span><span class="op" id="4819880">,</span>&nbsp;<span class="ident" id="4819882">err</span>&nbsp;<span class="op" id="4819886">=</span>&nbsp;<span class="ident" id="4819888">rand</span><span class="op" id="4819892">.</span><span class="ident" id="4819893">Int</span><span class="op" id="4819896">(</span><span class="ident" id="4819897">random</span><span class="op" id="4819903">,</span>&nbsp;<span class="ident" id="4819905">priv</span><span class="op" id="4819909">.</span><span class="ident" id="4819910">N</span><span class="op" id="4819911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819916">if</span>&nbsp;<span class="ident" id="4819919">err</span>&nbsp;<span class="op" id="4819923">!=</span>&nbsp;<span class="ident" id="4819926">nil</span>&nbsp;<span class="op" id="4819930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819936">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819951">if</span>&nbsp;<span class="ident" id="4819954">r</span><span class="op" id="4819955">.</span><span class="ident" id="4819956">Cmp</span><span class="op" id="4819959">(</span><span class="ident" id="4819960">bigZero</span><span class="op" id="4819967">)</span>&nbsp;<span class="op" id="4819969">==</span>&nbsp;<span class="num" id="4819972">0</span>&nbsp;<span class="op" id="4819974">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819980">r</span>&nbsp;<span class="op" id="4819982">=</span>&nbsp;<span class="ident" id="4819984">bigOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819999">var</span>&nbsp;<span class="ident" id="4820003">ok</span>&nbsp;<span class="builtintype" id="4820006">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820014">ir</span><span class="op" id="4820016">,</span>&nbsp;<span class="ident" id="4820018">ok</span>&nbsp;<span class="op" id="4820021">=</span>&nbsp;<span class="ident" id="4820023">modInverse</span><span class="op" id="4820033">(</span><span class="ident" id="4820034">r</span><span class="op" id="4820035">,</span>&nbsp;<span class="ident" id="4820037">priv</span><span class="op" id="4820041">.</span><span class="ident" id="4820042">N</span><span class="op" id="4820043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820048">if</span>&nbsp;<span class="ident" id="4820051">ok</span>&nbsp;<span class="op" id="4820054">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820060">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820077">bigE</span>&nbsp;<span class="op" id="4820082">:=</span>&nbsp;<span class="ident" id="4820085">big</span><span class="op" id="4820088">.</span><span class="ident" id="4820089">NewInt</span><span class="op" id="4820095">(</span><span class="ident" id="4820096">int64</span><span class="op" id="4820101">(</span><span class="ident" id="4820102">priv</span><span class="op" id="4820106">.</span><span class="ident" id="4820107">E</span><span class="op" id="4820108">)</span><span class="op" id="4820109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820113">rpowe</span>&nbsp;<span class="op" id="4820119">:=</span>&nbsp;<span class="builtinfunc" id="4820122">new</span><span class="op" id="4820125">(</span><span class="ident" id="4820126">big</span><span class="op" id="4820129">.</span><span class="ident" id="4820130">Int</span><span class="op" id="4820133">)</span><span class="op" id="4820134">.</span><span class="ident" id="4820135">Exp</span><span class="op" id="4820138">(</span><span class="ident" id="4820139">r</span><span class="op" id="4820140">,</span>&nbsp;<span class="ident" id="4820142">bigE</span><span class="op" id="4820146">,</span>&nbsp;<span class="ident" id="4820148">priv</span><span class="op" id="4820152">.</span><span class="ident" id="4820153">N</span><span class="op" id="4820154">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820158">cCopy</span>&nbsp;<span class="op" id="4820164">:=</span>&nbsp;<span class="builtinfunc" id="4820167">new</span><span class="op" id="4820170">(</span><span class="ident" id="4820171">big</span><span class="op" id="4820174">.</span><span class="ident" id="4820175">Int</span><span class="op" id="4820178">)</span><span class="op" id="4820179">.</span><span class="ident" id="4820180">Set</span><span class="op" id="4820183">(</span><span class="ident" id="4820184">c</span><span class="op" id="4820185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820189">cCopy</span><span class="op" id="4820194">.</span><span class="ident" id="4820195">Mul</span><span class="op" id="4820198">(</span><span class="ident" id="4820199">cCopy</span><span class="op" id="4820204">,</span>&nbsp;<span class="ident" id="4820206">rpowe</span><span class="op" id="4820211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820215">cCopy</span><span class="op" id="4820220">.</span><span class="ident" id="4820221">Mod</span><span class="op" id="4820224">(</span><span class="ident" id="4820225">cCopy</span><span class="op" id="4820230">,</span>&nbsp;<span class="ident" id="4820232">priv</span><span class="op" id="4820236">.</span><span class="ident" id="4820237">N</span><span class="op" id="4820238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820242">c</span>&nbsp;<span class="op" id="4820244">=</span>&nbsp;<span class="ident" id="4820246">cCopy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820253">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820257">if</span>&nbsp;<span class="ident" id="4820260">priv</span><span class="op" id="4820264">.</span><span class="ident" id="4820265">Precomputed</span><span class="op" id="4820276">.</span><span class="ident" id="4820277">Dp</span>&nbsp;<span class="op" id="4820280">==</span>&nbsp;<span class="ident" id="4820283">nil</span>&nbsp;<span class="op" id="4820287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820291">m</span>&nbsp;<span class="op" id="4820293">=</span>&nbsp;<span class="builtinfunc" id="4820295">new</span><span class="op" id="4820298">(</span><span class="ident" id="4820299">big</span><span class="op" id="4820302">.</span><span class="ident" id="4820303">Int</span><span class="op" id="4820306">)</span><span class="op" id="4820307">.</span><span class="ident" id="4820308">Exp</span><span class="op" id="4820311">(</span><span class="ident" id="4820312">c</span><span class="op" id="4820313">,</span>&nbsp;<span class="ident" id="4820315">priv</span><span class="op" id="4820319">.</span><span class="ident" id="4820320">D</span><span class="op" id="4820321">,</span>&nbsp;<span class="ident" id="4820323">priv</span><span class="op" id="4820327">.</span><span class="ident" id="4820328">N</span><span class="op" id="4820329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820332">}</span>&nbsp;<span class="keyword" id="4820334">else</span>&nbsp;<span class="op" id="4820339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4820343">//&nbsp;We&nbsp;have&nbsp;the&nbsp;precalculated&nbsp;values&nbsp;needed&nbsp;for&nbsp;the&nbsp;CRT.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820401">m</span>&nbsp;<span class="op" id="4820403">=</span>&nbsp;<span class="builtinfunc" id="4820405">new</span><span class="op" id="4820408">(</span><span class="ident" id="4820409">big</span><span class="op" id="4820412">.</span><span class="ident" id="4820413">Int</span><span class="op" id="4820416">)</span><span class="op" id="4820417">.</span><span class="ident" id="4820418">Exp</span><span class="op" id="4820421">(</span><span class="ident" id="4820422">c</span><span class="op" id="4820423">,</span>&nbsp;<span class="ident" id="4820425">priv</span><span class="op" id="4820429">.</span><span class="ident" id="4820430">Precomputed</span><span class="op" id="4820441">.</span><span class="ident" id="4820442">Dp</span><span class="op" id="4820444">,</span>&nbsp;<span class="ident" id="4820446">priv</span><span class="op" id="4820450">.</span><span class="ident" id="4820451">Primes</span><span class="op" id="4820457">[</span><span class="num" id="4820458">0</span><span class="op" id="4820459">]</span><span class="op" id="4820460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820464">m2</span>&nbsp;<span class="op" id="4820467">:=</span>&nbsp;<span class="builtinfunc" id="4820470">new</span><span class="op" id="4820473">(</span><span class="ident" id="4820474">big</span><span class="op" id="4820477">.</span><span class="ident" id="4820478">Int</span><span class="op" id="4820481">)</span><span class="op" id="4820482">.</span><span class="ident" id="4820483">Exp</span><span class="op" id="4820486">(</span><span class="ident" id="4820487">c</span><span class="op" id="4820488">,</span>&nbsp;<span class="ident" id="4820490">priv</span><span class="op" id="4820494">.</span><span class="ident" id="4820495">Precomputed</span><span class="op" id="4820506">.</span><span class="ident" id="4820507">Dq</span><span class="op" id="4820509">,</span>&nbsp;<span class="ident" id="4820511">priv</span><span class="op" id="4820515">.</span><span class="ident" id="4820516">Primes</span><span class="op" id="4820522">[</span><span class="num" id="4820523">1</span><span class="op" id="4820524">]</span><span class="op" id="4820525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820529">m</span><span class="op" id="4820530">.</span><span class="ident" id="4820531">Sub</span><span class="op" id="4820534">(</span><span class="ident" id="4820535">m</span><span class="op" id="4820536">,</span>&nbsp;<span class="ident" id="4820538">m2</span><span class="op" id="4820540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820544">if</span>&nbsp;<span class="ident" id="4820547">m</span><span class="op" id="4820548">.</span><span class="ident" id="4820549">Sign</span><span class="op" id="4820553">(</span><span class="op" id="4820554">)</span>&nbsp;<span class="op" id="4820556">&lt;</span>&nbsp;<span class="num" id="4820558">0</span>&nbsp;<span class="op" id="4820560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820565">m</span><span class="op" id="4820566">.</span><span class="ident" id="4820567">Add</span><span class="op" id="4820570">(</span><span class="ident" id="4820571">m</span><span class="op" id="4820572">,</span>&nbsp;<span class="ident" id="4820574">priv</span><span class="op" id="4820578">.</span><span class="ident" id="4820579">Primes</span><span class="op" id="4820585">[</span><span class="num" id="4820586">0</span><span class="op" id="4820587">]</span><span class="op" id="4820588">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820596">m</span><span class="op" id="4820597">.</span><span class="ident" id="4820598">Mul</span><span class="op" id="4820601">(</span><span class="ident" id="4820602">m</span><span class="op" id="4820603">,</span>&nbsp;<span class="ident" id="4820605">priv</span><span class="op" id="4820609">.</span><span class="ident" id="4820610">Precomputed</span><span class="op" id="4820621">.</span><span class="ident" id="4820622">Qinv</span><span class="op" id="4820626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820630">m</span><span class="op" id="4820631">.</span><span class="ident" id="4820632">Mod</span><span class="op" id="4820635">(</span><span class="ident" id="4820636">m</span><span class="op" id="4820637">,</span>&nbsp;<span class="ident" id="4820639">priv</span><span class="op" id="4820643">.</span><span class="ident" id="4820644">Primes</span><span class="op" id="4820650">[</span><span class="num" id="4820651">0</span><span class="op" id="4820652">]</span><span class="op" id="4820653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820657">m</span><span class="op" id="4820658">.</span><span class="ident" id="4820659">Mul</span><span class="op" id="4820662">(</span><span class="ident" id="4820663">m</span><span class="op" id="4820664">,</span>&nbsp;<span class="ident" id="4820666">priv</span><span class="op" id="4820670">.</span><span class="ident" id="4820671">Primes</span><span class="op" id="4820677">[</span><span class="num" id="4820678">1</span><span class="op" id="4820679">]</span><span class="op" id="4820680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820684">m</span><span class="op" id="4820685">.</span><span class="ident" id="4820686">Add</span><span class="op" id="4820689">(</span><span class="ident" id="4820690">m</span><span class="op" id="4820691">,</span>&nbsp;<span class="ident" id="4820693">m2</span><span class="op" id="4820695">)</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820700">for</span>&nbsp;<span class="ident" id="4820704">i</span><span class="op" id="4820705">,</span>&nbsp;<span class="ident" id="4820707">values</span>&nbsp;<span class="op" id="4820714">:=</span>&nbsp;<span class="keyword" id="4820717">range</span>&nbsp;<span class="ident" id="4820723">priv</span><span class="op" id="4820727">.</span><span class="ident" id="4820728">Precomputed</span><span class="op" id="4820739">.</span><span class="ident" id="4820740">CRTValues</span>&nbsp;<span class="op" id="4820750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820755">prime</span>&nbsp;<span class="op" id="4820761">:=</span>&nbsp;<span class="ident" id="4820764">priv</span><span class="op" id="4820768">.</span><span class="ident" id="4820769">Primes</span><span class="op" id="4820775">[</span><span class="num" id="4820776">2</span><span class="op" id="4820777">+</span><span class="ident" id="4820778">i</span><span class="op" id="4820779">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820784">m2</span><span class="op" id="4820786">.</span><span class="ident" id="4820787">Exp</span><span class="op" id="4820790">(</span><span class="ident" id="4820791">c</span><span class="op" id="4820792">,</span>&nbsp;<span class="ident" id="4820794">values</span><span class="op" id="4820800">.</span><span class="ident" id="4820801">Exp</span><span class="op" id="4820804">,</span>&nbsp;<span class="ident" id="4820806">prime</span><span class="op" id="4820811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820816">m2</span><span class="op" id="4820818">.</span><span class="ident" id="4820819">Sub</span><span class="op" id="4820822">(</span><span class="ident" id="4820823">m2</span><span class="op" id="4820825">,</span>&nbsp;<span class="ident" id="4820827">m</span><span class="op" id="4820828">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820833">m2</span><span class="op" id="4820835">.</span><span class="ident" id="4820836">Mul</span><span class="op" id="4820839">(</span><span class="ident" id="4820840">m2</span><span class="op" id="4820842">,</span>&nbsp;<span class="ident" id="4820844">values</span><span class="op" id="4820850">.</span><span class="ident" id="4820851">Coeff</span><span class="op" id="4820856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820861">m2</span><span class="op" id="4820863">.</span><span class="ident" id="4820864">Mod</span><span class="op" id="4820867">(</span><span class="ident" id="4820868">m2</span><span class="op" id="4820870">,</span>&nbsp;<span class="ident" id="4820872">prime</span><span class="op" id="4820877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820882">if</span>&nbsp;<span class="ident" id="4820885">m2</span><span class="op" id="4820887">.</span><span class="ident" id="4820888">Sign</span><span class="op" id="4820892">(</span><span class="op" id="4820893">)</span>&nbsp;<span class="op" id="4820895">&lt;</span>&nbsp;<span class="num" id="4820897">0</span>&nbsp;<span class="op" id="4820899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820905">m2</span><span class="op" id="4820907">.</span><span class="ident" id="4820908">Add</span><span class="op" id="4820911">(</span><span class="ident" id="4820912">m2</span><span class="op" id="4820914">,</span>&nbsp;<span class="ident" id="4820916">prime</span><span class="op" id="4820921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820926">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820931">m2</span><span class="op" id="4820933">.</span><span class="ident" id="4820934">Mul</span><span class="op" id="4820937">(</span><span class="ident" id="4820938">m2</span><span class="op" id="4820940">,</span>&nbsp;<span class="ident" id="4820942">values</span><span class="op" id="4820948">.</span><span class="ident" id="4820949">R</span><span class="op" id="4820950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820955">m</span><span class="op" id="4820956">.</span><span class="ident" id="4820957">Add</span><span class="op" id="4820960">(</span><span class="ident" id="4820961">m</span><span class="op" id="4820962">,</span>&nbsp;<span class="ident" id="4820964">m2</span><span class="op" id="4820966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820977">if</span>&nbsp;<span class="ident" id="4820980">ir</span>&nbsp;<span class="op" id="4820983">!=</span>&nbsp;<span class="ident" id="4820986">nil</span>&nbsp;<span class="op" id="4820990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4820994">//&nbsp;Unblind.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821008">m</span><span class="op" id="4821009">.</span><span class="ident" id="4821010">Mul</span><span class="op" id="4821013">(</span><span class="ident" id="4821014">m</span><span class="op" id="4821015">,</span>&nbsp;<span class="ident" id="4821017">ir</span><span class="op" id="4821019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821023">m</span><span class="op" id="4821024">.</span><span class="ident" id="4821025">Mod</span><span class="op" id="4821028">(</span><span class="ident" id="4821029">m</span><span class="op" id="4821030">,</span>&nbsp;<span class="ident" id="4821032">priv</span><span class="op" id="4821036">.</span><span class="ident" id="4821037">N</span><span class="op" id="4821038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4821041">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821045">return</span><br>
<span class="lineno"></span><span class="op" id="4821052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4821055">//&nbsp;DecryptOAEP&nbsp;decrypts&nbsp;ciphertext&nbsp;using&nbsp;RSA-OAEP.</span><br>
<span class="lineno">475</span><span class="comment" id="4821106">//&nbsp;If&nbsp;random&nbsp;!=&nbsp;nil,&nbsp;DecryptOAEP&nbsp;uses&nbsp;RSA&nbsp;blinding&nbsp;to&nbsp;avoid&nbsp;timing&nbsp;side-channel&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4821195">func</span>&nbsp;<span class="ident" id="4821200">DecryptOAEP</span><span class="op" id="4821211">(</span><span class="ident" id="4821212">hash</span>&nbsp;<span class="ident" id="4821217">hash</span><span class="op" id="4821221">.</span><span class="ident" id="4821222">Hash</span><span class="op" id="4821226">,</span>&nbsp;<span class="ident" id="4821228">random</span>&nbsp;<span class="ident" id="4821235">io</span><span class="op" id="4821237">.</span><span class="ident" id="4821238">Reader</span><span class="op" id="4821244">,</span>&nbsp;<span class="ident" id="4821246">priv</span>&nbsp;<span class="op" id="4821251">*</span><span class="ident" id="4821252">PrivateKey</span><span class="op" id="4821262">,</span>&nbsp;<span class="ident" id="4821264">ciphertext</span>&nbsp;<span class="op" id="4821275">[</span><span class="op" id="4821276">]</span><span class="builtintype" id="4821277">byte</span><span class="op" id="4821281">,</span>&nbsp;<span class="ident" id="4821283">label</span>&nbsp;<span class="op" id="4821289">[</span><span class="op" id="4821290">]</span><span class="builtintype" id="4821291">byte</span><span class="op" id="4821295">)</span>&nbsp;<span class="op" id="4821297">(</span><span class="ident" id="4821298">msg</span>&nbsp;<span class="op" id="4821302">[</span><span class="op" id="4821303">]</span><span class="builtintype" id="4821304">byte</span><span class="op" id="4821308">,</span>&nbsp;<span class="ident" id="4821310">err</span>&nbsp;<span class="builtintype" id="4821314">error</span><span class="op" id="4821319">)</span>&nbsp;<span class="op" id="4821321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821324">if</span>&nbsp;<span class="ident" id="4821327">err</span>&nbsp;<span class="op" id="4821331">:=</span>&nbsp;<span class="ident" id="4821334">checkPub</span><span class="op" id="4821342">(</span><span class="op" id="4821343">&amp;</span><span class="ident" id="4821344">priv</span><span class="op" id="4821348">.</span><span class="ident" id="4821349">PublicKey</span><span class="op" id="4821358">)</span><span class="op" id="4821359">;</span>&nbsp;<span class="ident" id="4821361">err</span>&nbsp;<span class="op" id="4821365">!=</span>&nbsp;<span class="ident" id="4821368">nil</span>&nbsp;<span class="op" id="4821372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821376">return</span>&nbsp;<span class="ident" id="4821383">nil</span><span class="op" id="4821386">,</span>&nbsp;<span class="ident" id="4821388">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4821393">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821396">k</span>&nbsp;<span class="op" id="4821398">:=</span>&nbsp;<span class="op" id="4821401">(</span><span class="ident" id="4821402">priv</span><span class="op" id="4821406">.</span><span class="ident" id="4821407">N</span><span class="op" id="4821408">.</span><span class="ident" id="4821409">BitLen</span><span class="op" id="4821415">(</span><span class="op" id="4821416">)</span>&nbsp;<span class="op" id="4821418">+</span>&nbsp;<span class="num" id="4821420">7</span><span class="op" id="4821421">)</span>&nbsp;<span class="op" id="4821423">/</span>&nbsp;<span class="num" id="4821425">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821428">if</span>&nbsp;<span class="builtinfunc" id="4821431">len</span><span class="op" id="4821434">(</span><span class="ident" id="4821435">ciphertext</span><span class="op" id="4821445">)</span>&nbsp;<span class="op" id="4821447">&gt;</span>&nbsp;<span class="ident" id="4821449">k</span>&nbsp;<span class="op" id="4821451">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821456">k</span>&nbsp;<span class="op" id="4821458">&lt;</span>&nbsp;<span class="ident" id="4821460">hash</span><span class="op" id="4821464">.</span><span class="ident" id="4821465">Size</span><span class="op" id="4821469">(</span><span class="op" id="4821470">)</span><span class="op" id="4821471">*</span><span class="num" id="4821472">2</span><span class="op" id="4821473">+</span><span class="num" id="4821474">2</span>&nbsp;<span class="op" id="4821476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821480">err</span>&nbsp;<span class="op" id="4821484">=</span>&nbsp;<span class="ident" id="4821486">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821502">return</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4821510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821514">c</span>&nbsp;<span class="op" id="4821516">:=</span>&nbsp;<span class="builtinfunc" id="4821519">new</span><span class="op" id="4821522">(</span><span class="ident" id="4821523">big</span><span class="op" id="4821526">.</span><span class="ident" id="4821527">Int</span><span class="op" id="4821530">)</span><span class="op" id="4821531">.</span><span class="ident" id="4821532">SetBytes</span><span class="op" id="4821540">(</span><span class="ident" id="4821541">ciphertext</span><span class="op" id="4821551">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821555">m</span><span class="op" id="4821556">,</span>&nbsp;<span class="ident" id="4821558">err</span>&nbsp;<span class="op" id="4821562">:=</span>&nbsp;<span class="ident" id="4821565">decrypt</span><span class="op" id="4821572">(</span><span class="ident" id="4821573">random</span><span class="op" id="4821579">,</span>&nbsp;<span class="ident" id="4821581">priv</span><span class="op" id="4821585">,</span>&nbsp;<span class="ident" id="4821587">c</span><span class="op" id="4821588">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821591">if</span>&nbsp;<span class="ident" id="4821594">err</span>&nbsp;<span class="op" id="4821598">!=</span>&nbsp;<span class="ident" id="4821601">nil</span>&nbsp;<span class="op" id="4821605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4821609">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4821617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821621">hash</span><span class="op" id="4821625">.</span><span class="ident" id="4821626">Write</span><span class="op" id="4821631">(</span><span class="ident" id="4821632">label</span><span class="op" id="4821637">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821640">lHash</span>&nbsp;<span class="op" id="4821646">:=</span>&nbsp;<span class="ident" id="4821649">hash</span><span class="op" id="4821653">.</span><span class="ident" id="4821654">Sum</span><span class="op" id="4821657">(</span><span class="ident" id="4821658">nil</span><span class="op" id="4821661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821664">hash</span><span class="op" id="4821668">.</span><span class="ident" id="4821669">Reset</span><span class="op" id="4821674">(</span><span class="op" id="4821675">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4821679">//&nbsp;Converting&nbsp;the&nbsp;plaintext&nbsp;number&nbsp;to&nbsp;bytes&nbsp;will&nbsp;strip&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4821739">//&nbsp;leading&nbsp;zeros&nbsp;so&nbsp;we&nbsp;may&nbsp;have&nbsp;to&nbsp;left&nbsp;pad.&nbsp;We&nbsp;do&nbsp;this&nbsp;unconditionally</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4821812">//&nbsp;to&nbsp;avoid&nbsp;leaking&nbsp;timing&nbsp;information.&nbsp;(Although&nbsp;we&nbsp;still&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4821881">//&nbsp;leak&nbsp;the&nbsp;number&nbsp;of&nbsp;leading&nbsp;zeros.&nbsp;It&#39;s&nbsp;not&nbsp;clear&nbsp;that&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4821949">//&nbsp;anything&nbsp;about&nbsp;this.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4821975">em</span>&nbsp;<span class="op" id="4821978">:=</span>&nbsp;<span class="ident" id="4821981">leftPad</span><span class="op" id="4821988">(</span><span class="ident" id="4821989">m</span><span class="op" id="4821990">.</span><span class="ident" id="4821991">Bytes</span><span class="op" id="4821996">(</span><span class="op" id="4821997">)</span><span class="op" id="4821998">,</span>&nbsp;<span class="ident" id="4822000">k</span><span class="op" id="4822001">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822005">firstByteIsZero</span>&nbsp;<span class="op" id="4822021">:=</span>&nbsp;<span class="ident" id="4822024">subtle</span><span class="op" id="4822030">.</span><span class="ident" id="4822031">ConstantTimeByteEq</span><span class="op" id="4822049">(</span><span class="ident" id="4822050">em</span><span class="op" id="4822052">[</span><span class="num" id="4822053">0</span><span class="op" id="4822054">]</span><span class="op" id="4822055">,</span>&nbsp;<span class="num" id="4822057">0</span><span class="op" id="4822058">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822062">seed</span>&nbsp;<span class="op" id="4822067">:=</span>&nbsp;<span class="ident" id="4822070">em</span><span class="op" id="4822072">[</span><span class="num" id="4822073">1</span>&nbsp;<span class="op" id="4822075">:</span>&nbsp;<span class="ident" id="4822077">hash</span><span class="op" id="4822081">.</span><span class="ident" id="4822082">Size</span><span class="op" id="4822086">(</span><span class="op" id="4822087">)</span><span class="op" id="4822088">+</span><span class="num" id="4822089">1</span><span class="op" id="4822090">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822093">db</span>&nbsp;<span class="op" id="4822096">:=</span>&nbsp;<span class="ident" id="4822099">em</span><span class="op" id="4822101">[</span><span class="ident" id="4822102">hash</span><span class="op" id="4822106">.</span><span class="ident" id="4822107">Size</span><span class="op" id="4822111">(</span><span class="op" id="4822112">)</span><span class="op" id="4822113">+</span><span class="num" id="4822114">1</span><span class="op" id="4822115">:</span><span class="op" id="4822116">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822120">mgf1XOR</span><span class="op" id="4822127">(</span><span class="ident" id="4822128">seed</span><span class="op" id="4822132">,</span>&nbsp;<span class="ident" id="4822134">hash</span><span class="op" id="4822138">,</span>&nbsp;<span class="ident" id="4822140">db</span><span class="op" id="4822142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822145">mgf1XOR</span><span class="op" id="4822152">(</span><span class="ident" id="4822153">db</span><span class="op" id="4822155">,</span>&nbsp;<span class="ident" id="4822157">hash</span><span class="op" id="4822161">,</span>&nbsp;<span class="ident" id="4822163">seed</span><span class="op" id="4822167">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822171">lHash2</span>&nbsp;<span class="op" id="4822178">:=</span>&nbsp;<span class="ident" id="4822181">db</span><span class="op" id="4822183">[</span><span class="num" id="4822184">0</span><span class="op" id="4822185">:</span><span class="ident" id="4822186">hash</span><span class="op" id="4822190">.</span><span class="ident" id="4822191">Size</span><span class="op" id="4822195">(</span><span class="op" id="4822196">)</span><span class="op" id="4822197">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4822201">//&nbsp;We&nbsp;have&nbsp;to&nbsp;validate&nbsp;the&nbsp;plaintext&nbsp;in&nbsp;constant&nbsp;time&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4822274">//&nbsp;attacks&nbsp;like:&nbsp;J.&nbsp;Manger.&nbsp;A&nbsp;Chosen&nbsp;Ciphertext&nbsp;Attack&nbsp;on&nbsp;RSA&nbsp;Optimal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4822345">//&nbsp;Asymmetric&nbsp;Encryption&nbsp;Padding&nbsp;(OAEP)&nbsp;as&nbsp;Standardized&nbsp;in&nbsp;PKCS&nbsp;#1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4822413">//&nbsp;v2.0.&nbsp;In&nbsp;J.&nbsp;Kilian,&nbsp;editor,&nbsp;Advances&nbsp;in&nbsp;Cryptology.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822469">lHash2Good</span>&nbsp;<span class="op" id="4822480">:=</span>&nbsp;<span class="ident" id="4822483">subtle</span><span class="op" id="4822489">.</span><span class="ident" id="4822490">ConstantTimeCompare</span><span class="op" id="4822509">(</span><span class="ident" id="4822510">lHash</span><span class="op" id="4822515">,</span>&nbsp;<span class="ident" id="4822517">lHash2</span><span class="op" id="4822523">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4822527">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;plaintext&nbsp;must&nbsp;be&nbsp;zero&nbsp;or&nbsp;more&nbsp;0x00,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4822598">//&nbsp;by&nbsp;0x01,&nbsp;followed&nbsp;by&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4822636">//&nbsp;&nbsp;&nbsp;lookingForIndex:&nbsp;1&nbsp;iff&nbsp;we&nbsp;are&nbsp;still&nbsp;looking&nbsp;for&nbsp;the&nbsp;0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4822699">//&nbsp;&nbsp;&nbsp;index:&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;0x01&nbsp;byte</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4822746">//&nbsp;&nbsp;&nbsp;invalid:&nbsp;1&nbsp;iff&nbsp;we&nbsp;saw&nbsp;a&nbsp;non-zero&nbsp;byte&nbsp;before&nbsp;the&nbsp;0x01.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822807">var</span>&nbsp;<span class="ident" id="4822811">lookingForIndex</span><span class="op" id="4822826">,</span>&nbsp;<span class="ident" id="4822828">index</span><span class="op" id="4822833">,</span>&nbsp;<span class="ident" id="4822835">invalid</span>&nbsp;<span class="builtintype" id="4822843">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822848">lookingForIndex</span>&nbsp;<span class="op" id="4822864">=</span>&nbsp;<span class="num" id="4822866">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822869">rest</span>&nbsp;<span class="op" id="4822874">:=</span>&nbsp;<span class="ident" id="4822877">db</span><span class="op" id="4822879">[</span><span class="ident" id="4822880">hash</span><span class="op" id="4822884">.</span><span class="ident" id="4822885">Size</span><span class="op" id="4822889">(</span><span class="op" id="4822890">)</span><span class="op" id="4822891">:</span><span class="op" id="4822892">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4822896">for</span>&nbsp;<span class="ident" id="4822900">i</span>&nbsp;<span class="op" id="4822902">:=</span>&nbsp;<span class="num" id="4822905">0</span><span class="op" id="4822906">;</span>&nbsp;<span class="ident" id="4822908">i</span>&nbsp;<span class="op" id="4822910">&lt;</span>&nbsp;<span class="builtinfunc" id="4822912">len</span><span class="op" id="4822915">(</span><span class="ident" id="4822916">rest</span><span class="op" id="4822920">)</span><span class="op" id="4822921">;</span>&nbsp;<span class="ident" id="4822923">i</span><span class="op" id="4822924">++</span>&nbsp;<span class="op" id="4822927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822931">equals0</span>&nbsp;<span class="op" id="4822939">:=</span>&nbsp;<span class="ident" id="4822942">subtle</span><span class="op" id="4822948">.</span><span class="ident" id="4822949">ConstantTimeByteEq</span><span class="op" id="4822967">(</span><span class="ident" id="4822968">rest</span><span class="op" id="4822972">[</span><span class="ident" id="4822973">i</span><span class="op" id="4822974">]</span><span class="op" id="4822975">,</span>&nbsp;<span class="num" id="4822977">0</span><span class="op" id="4822978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4822982">equals1</span>&nbsp;<span class="op" id="4822990">:=</span>&nbsp;<span class="ident" id="4822993">subtle</span><span class="op" id="4822999">.</span><span class="ident" id="4823000">ConstantTimeByteEq</span><span class="op" id="4823018">(</span><span class="ident" id="4823019">rest</span><span class="op" id="4823023">[</span><span class="ident" id="4823024">i</span><span class="op" id="4823025">]</span><span class="op" id="4823026">,</span>&nbsp;<span class="num" id="4823028">1</span><span class="op" id="4823029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823033">index</span>&nbsp;<span class="op" id="4823039">=</span>&nbsp;<span class="ident" id="4823041">subtle</span><span class="op" id="4823047">.</span><span class="ident" id="4823048">ConstantTimeSelect</span><span class="op" id="4823066">(</span><span class="ident" id="4823067">lookingForIndex</span><span class="op" id="4823082">&amp;</span><span class="ident" id="4823083">equals1</span><span class="op" id="4823090">,</span>&nbsp;<span class="ident" id="4823092">i</span><span class="op" id="4823093">,</span>&nbsp;<span class="ident" id="4823095">index</span><span class="op" id="4823100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823104">lookingForIndex</span>&nbsp;<span class="op" id="4823120">=</span>&nbsp;<span class="ident" id="4823122">subtle</span><span class="op" id="4823128">.</span><span class="ident" id="4823129">ConstantTimeSelect</span><span class="op" id="4823147">(</span><span class="ident" id="4823148">equals1</span><span class="op" id="4823155">,</span>&nbsp;<span class="num" id="4823157">0</span><span class="op" id="4823158">,</span>&nbsp;<span class="ident" id="4823160">lookingForIndex</span><span class="op" id="4823175">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823179">invalid</span>&nbsp;<span class="op" id="4823187">=</span>&nbsp;<span class="ident" id="4823189">subtle</span><span class="op" id="4823195">.</span><span class="ident" id="4823196">ConstantTimeSelect</span><span class="op" id="4823214">(</span><span class="ident" id="4823215">lookingForIndex</span><span class="op" id="4823230">&amp;^</span><span class="ident" id="4823232">equals0</span><span class="op" id="4823239">,</span>&nbsp;<span class="num" id="4823241">1</span><span class="op" id="4823242">,</span>&nbsp;<span class="ident" id="4823244">invalid</span><span class="op" id="4823251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823258">if</span>&nbsp;<span class="ident" id="4823261">firstByteIsZero</span><span class="op" id="4823276">&amp;</span><span class="ident" id="4823277">lHash2Good</span><span class="op" id="4823287">&amp;^</span><span class="ident" id="4823289">invalid</span><span class="op" id="4823296">&amp;^</span><span class="ident" id="4823298">lookingForIndex</span>&nbsp;<span class="op" id="4823314">!=</span>&nbsp;<span class="num" id="4823317">1</span>&nbsp;<span class="op" id="4823319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823323">err</span>&nbsp;<span class="op" id="4823327">=</span>&nbsp;<span class="ident" id="4823329">ErrDecryption</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823345">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823357">msg</span>&nbsp;<span class="op" id="4823361">=</span>&nbsp;<span class="ident" id="4823363">rest</span><span class="op" id="4823367">[</span><span class="ident" id="4823368">index</span><span class="op" id="4823373">+</span><span class="num" id="4823374">1</span><span class="op" id="4823375">:</span><span class="op" id="4823376">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823379">return</span><br>
<span class="lineno">545</span><span class="op" id="4823386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4823389">//&nbsp;leftPad&nbsp;returns&nbsp;a&nbsp;new&nbsp;slice&nbsp;of&nbsp;length&nbsp;size.&nbsp;The&nbsp;contents&nbsp;of&nbsp;input&nbsp;are&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="4823468">//&nbsp;aligned&nbsp;in&nbsp;the&nbsp;new&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="4823497">func</span>&nbsp;<span class="ident" id="4823502">leftPad</span><span class="op" id="4823509">(</span><span class="ident" id="4823510">input</span>&nbsp;<span class="op" id="4823516">[</span><span class="op" id="4823517">]</span><span class="builtintype" id="4823518">byte</span><span class="op" id="4823522">,</span>&nbsp;<span class="ident" id="4823524">size</span>&nbsp;<span class="builtintype" id="4823529">int</span><span class="op" id="4823532">)</span>&nbsp;<span class="op" id="4823534">(</span><span class="ident" id="4823535">out</span>&nbsp;<span class="op" id="4823539">[</span><span class="op" id="4823540">]</span><span class="builtintype" id="4823541">byte</span><span class="op" id="4823545">)</span>&nbsp;<span class="op" id="4823547">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823550">n</span>&nbsp;<span class="op" id="4823552">:=</span>&nbsp;<span class="builtinfunc" id="4823555">len</span><span class="op" id="4823558">(</span><span class="ident" id="4823559">input</span><span class="op" id="4823564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823567">if</span>&nbsp;<span class="ident" id="4823570">n</span>&nbsp;<span class="op" id="4823572">&gt;</span>&nbsp;<span class="ident" id="4823574">size</span>&nbsp;<span class="op" id="4823579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823583">n</span>&nbsp;<span class="op" id="4823585">=</span>&nbsp;<span class="ident" id="4823587">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4823593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4823596">out</span>&nbsp;<span class="op" id="4823600">=</span>&nbsp;<span class="builtinfunc" id="4823602">make</span><span class="op" id="4823606">(</span><span class="op" id="4823607">[</span><span class="op" id="4823608">]</span><span class="builtintype" id="4823609">byte</span><span class="op" id="4823613">,</span>&nbsp;<span class="ident" id="4823615">size</span><span class="op" id="4823619">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4823622">copy</span><span class="op" id="4823626">(</span><span class="ident" id="4823627">out</span><span class="op" id="4823630">[</span><span class="builtinfunc" id="4823631">len</span><span class="op" id="4823634">(</span><span class="ident" id="4823635">out</span><span class="op" id="4823638">)</span><span class="op" id="4823639">-</span><span class="ident" id="4823640">n</span><span class="op" id="4823641">:</span><span class="op" id="4823642">]</span><span class="op" id="4823643">,</span>&nbsp;<span class="ident" id="4823645">input</span><span class="op" id="4823650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4823653">return</span><br>
<span class="lineno"></span><span class="op" id="4823660">}</span>
</div>
</body>
</html>
