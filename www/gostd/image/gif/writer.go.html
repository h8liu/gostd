<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6042171">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6042226">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6042280">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6042331">package</span>&nbsp;<span class="ident" id="6042339">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6042344">import</span>&nbsp;<span class="op" id="6042351">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6042354">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6042363">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6042379">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6042389">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6042398">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6042413">&#34;image/color/palette&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6042436">&#34;image/draw&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6042450">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6042455">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6042458">//&nbsp;Graphic&nbsp;control&nbsp;extension&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="6042495">const</span>&nbsp;<span class="op" id="6042501">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042504">gcLabel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6042516">=</span>&nbsp;<span class="num" id="6042518">0xF9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042524">gcBlockSize</span>&nbsp;<span class="op" id="6042536">=</span>&nbsp;<span class="num" id="6042538">0x04</span><br>
<span class="lineno"></span><span class="op" id="6042543">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6042546">var</span>&nbsp;<span class="ident" id="6042550">log2Lookup</span>&nbsp;<span class="op" id="6042561">=</span>&nbsp;<span class="op" id="6042563">[</span><span class="num" id="6042564">8</span><span class="op" id="6042565">]</span><span class="builtintype" id="6042566">int</span><span class="op" id="6042569">{</span><span class="num" id="6042570">2</span><span class="op" id="6042571">,</span>&nbsp;<span class="num" id="6042573">4</span><span class="op" id="6042574">,</span>&nbsp;<span class="num" id="6042576">8</span><span class="op" id="6042577">,</span>&nbsp;<span class="num" id="6042579">16</span><span class="op" id="6042581">,</span>&nbsp;<span class="num" id="6042583">32</span><span class="op" id="6042585">,</span>&nbsp;<span class="num" id="6042587">64</span><span class="op" id="6042589">,</span>&nbsp;<span class="num" id="6042591">128</span><span class="op" id="6042594">,</span>&nbsp;<span class="num" id="6042596">256</span><span class="op" id="6042599">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="6042602">func</span>&nbsp;<span class="ident" id="6042607">log2</span><span class="op" id="6042611">(</span><span class="ident" id="6042612">x</span>&nbsp;<span class="builtintype" id="6042614">int</span><span class="op" id="6042617">)</span>&nbsp;<span class="builtintype" id="6042619">int</span>&nbsp;<span class="op" id="6042623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6042626">for</span>&nbsp;<span class="ident" id="6042630">i</span><span class="op" id="6042631">,</span>&nbsp;<span class="ident" id="6042633">v</span>&nbsp;<span class="op" id="6042635">:=</span>&nbsp;<span class="keyword" id="6042638">range</span>&nbsp;<span class="ident" id="6042644">log2Lookup</span>&nbsp;<span class="op" id="6042655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6042659">if</span>&nbsp;<span class="ident" id="6042662">x</span>&nbsp;<span class="op" id="6042664">&lt;=</span>&nbsp;<span class="ident" id="6042667">v</span>&nbsp;<span class="op" id="6042669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6042674">return</span>&nbsp;<span class="ident" id="6042681">i</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6042685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6042688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6042691">return</span>&nbsp;<span class="op" id="6042698">-</span><span class="num" id="6042699">1</span><br>
<span class="lineno"></span><span class="op" id="6042701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="6042704">//&nbsp;Little-endian.</span><br>
<span class="lineno"></span><span class="keyword" id="6042722">func</span>&nbsp;<span class="ident" id="6042727">writeUint16</span><span class="op" id="6042738">(</span><span class="ident" id="6042739">b</span>&nbsp;<span class="op" id="6042741">[</span><span class="op" id="6042742">]</span><span class="builtintype" id="6042743">uint8</span><span class="op" id="6042748">,</span>&nbsp;<span class="ident" id="6042750">u</span>&nbsp;<span class="builtintype" id="6042752">uint16</span><span class="op" id="6042758">)</span>&nbsp;<span class="op" id="6042760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042763">b</span><span class="op" id="6042764">[</span><span class="num" id="6042765">0</span><span class="op" id="6042766">]</span>&nbsp;<span class="op" id="6042768">=</span>&nbsp;<span class="builtintype" id="6042770">uint8</span><span class="op" id="6042775">(</span><span class="ident" id="6042776">u</span><span class="op" id="6042777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042780">b</span><span class="op" id="6042781">[</span><span class="num" id="6042782">1</span><span class="op" id="6042783">]</span>&nbsp;<span class="op" id="6042785">=</span>&nbsp;<span class="builtintype" id="6042787">uint8</span><span class="op" id="6042792">(</span><span class="ident" id="6042793">u</span>&nbsp;<span class="op" id="6042795">&gt;&gt;</span>&nbsp;<span class="num" id="6042798">8</span><span class="op" id="6042799">)</span><br>
<span class="lineno"></span><span class="op" id="6042801">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="6042804">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6042836">type</span>&nbsp;<span class="ident" id="6042841">writer</span>&nbsp;<span class="keyword" id="6042848">interface</span>&nbsp;<span class="op" id="6042858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042861">Flush</span><span class="op" id="6042866">(</span><span class="op" id="6042867">)</span>&nbsp;<span class="builtintype" id="6042869">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042876">io</span><span class="op" id="6042878">.</span><span class="ident" id="6042879">Writer</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042887">io</span><span class="op" id="6042889">.</span><span class="ident" id="6042890">ByteWriter</span><br>
<span class="lineno"></span><span class="op" id="6042901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6042904">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;GIF&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="6042951">type</span>&nbsp;<span class="ident" id="6042956">encoder</span>&nbsp;<span class="keyword" id="6042964">struct</span>&nbsp;<span class="op" id="6042971">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6042974">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6043049">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043120">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6043124">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043132">err</span>&nbsp;<span class="builtintype" id="6043136">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6043143">//&nbsp;g&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;data&nbsp;that&nbsp;is&nbsp;being&nbsp;encoded.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043199">g</span>&nbsp;<span class="op" id="6043201">*</span><span class="ident" id="6043202">GIF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6043207">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.&nbsp;It&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;write&nbsp;the&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043291">buf</span>&nbsp;<span class="op" id="6043295">[</span><span class="num" id="6043296">1024</span><span class="op" id="6043300">]</span><span class="builtintype" id="6043301">byte</span><br>
<span class="lineno"></span><span class="op" id="6043306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6043309">//&nbsp;blockWriter&nbsp;writes&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="6043376">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6043442">//&nbsp;writer&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;encoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6043506">//&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="6043519">type</span>&nbsp;<span class="ident" id="6043524">blockWriter</span>&nbsp;<span class="keyword" id="6043536">struct</span>&nbsp;<span class="op" id="6043543">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043546">e</span>&nbsp;<span class="op" id="6043548">*</span><span class="ident" id="6043549">encoder</span><br>
<span class="lineno"></span><span class="op" id="6043557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6043560">func</span>&nbsp;<span class="op" id="6043565">(</span><span class="ident" id="6043566">b</span>&nbsp;<span class="ident" id="6043568">blockWriter</span><span class="op" id="6043579">)</span>&nbsp;<span class="ident" id="6043581">Write</span><span class="op" id="6043586">(</span><span class="ident" id="6043587">data</span>&nbsp;<span class="op" id="6043592">[</span><span class="op" id="6043593">]</span><span class="builtintype" id="6043594">byte</span><span class="op" id="6043598">)</span>&nbsp;<span class="op" id="6043600">(</span><span class="builtintype" id="6043601">int</span><span class="op" id="6043604">,</span>&nbsp;<span class="builtintype" id="6043606">error</span><span class="op" id="6043611">)</span>&nbsp;<span class="op" id="6043613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043616">if</span>&nbsp;<span class="ident" id="6043619">b</span><span class="op" id="6043620">.</span><span class="ident" id="6043621">e</span><span class="op" id="6043622">.</span><span class="ident" id="6043623">err</span>&nbsp;<span class="op" id="6043627">!=</span>&nbsp;<span class="builtintype" id="6043630">nil</span>&nbsp;<span class="op" id="6043634">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043638">return</span>&nbsp;<span class="num" id="6043645">0</span><span class="op" id="6043646">,</span>&nbsp;<span class="ident" id="6043648">b</span><span class="op" id="6043649">.</span><span class="ident" id="6043650">e</span><span class="op" id="6043651">.</span><span class="ident" id="6043652">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6043657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043660">if</span>&nbsp;<span class="builtinfunc" id="6043663">len</span><span class="op" id="6043666">(</span><span class="ident" id="6043667">data</span><span class="op" id="6043671">)</span>&nbsp;<span class="op" id="6043673">==</span>&nbsp;<span class="num" id="6043676">0</span>&nbsp;<span class="op" id="6043678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043682">return</span>&nbsp;<span class="num" id="6043689">0</span><span class="op" id="6043690">,</span>&nbsp;<span class="builtintype" id="6043692">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6043697">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043700">total</span>&nbsp;<span class="op" id="6043706">:=</span>&nbsp;<span class="num" id="6043709">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043712">for</span>&nbsp;<span class="ident" id="6043716">total</span>&nbsp;<span class="op" id="6043722">&lt;</span>&nbsp;<span class="builtinfunc" id="6043724">len</span><span class="op" id="6043727">(</span><span class="ident" id="6043728">data</span><span class="op" id="6043732">)</span>&nbsp;<span class="op" id="6043734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043738">n</span>&nbsp;<span class="op" id="6043740">:=</span>&nbsp;<span class="builtinfunc" id="6043743">copy</span><span class="op" id="6043747">(</span><span class="ident" id="6043748">b</span><span class="op" id="6043749">.</span><span class="ident" id="6043750">e</span><span class="op" id="6043751">.</span><span class="ident" id="6043752">buf</span><span class="op" id="6043755">[</span><span class="num" id="6043756">1</span><span class="op" id="6043757">:</span><span class="num" id="6043758">256</span><span class="op" id="6043761">]</span><span class="op" id="6043762">,</span>&nbsp;<span class="ident" id="6043764">data</span><span class="op" id="6043768">[</span><span class="ident" id="6043769">total</span><span class="op" id="6043774">:</span><span class="op" id="6043775">]</span><span class="op" id="6043776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043780">total</span>&nbsp;<span class="op" id="6043786">+=</span>&nbsp;<span class="ident" id="6043789">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043793">b</span><span class="op" id="6043794">.</span><span class="ident" id="6043795">e</span><span class="op" id="6043796">.</span><span class="ident" id="6043797">buf</span><span class="op" id="6043800">[</span><span class="num" id="6043801">0</span><span class="op" id="6043802">]</span>&nbsp;<span class="op" id="6043804">=</span>&nbsp;<span class="builtintype" id="6043806">uint8</span><span class="op" id="6043811">(</span><span class="ident" id="6043812">n</span><span class="op" id="6043813">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043818">n</span><span class="op" id="6043819">,</span>&nbsp;<span class="ident" id="6043821">b</span><span class="op" id="6043822">.</span><span class="ident" id="6043823">e</span><span class="op" id="6043824">.</span><span class="ident" id="6043825">err</span>&nbsp;<span class="op" id="6043829">=</span>&nbsp;<span class="ident" id="6043831">b</span><span class="op" id="6043832">.</span><span class="ident" id="6043833">e</span><span class="op" id="6043834">.</span><span class="ident" id="6043835">w</span><span class="op" id="6043836">.</span><span class="ident" id="6043837">Write</span><span class="op" id="6043842">(</span><span class="ident" id="6043843">b</span><span class="op" id="6043844">.</span><span class="ident" id="6043845">e</span><span class="op" id="6043846">.</span><span class="ident" id="6043847">buf</span><span class="op" id="6043850">[</span><span class="op" id="6043851">:</span><span class="ident" id="6043852">n</span><span class="op" id="6043853">+</span><span class="num" id="6043854">1</span><span class="op" id="6043855">]</span><span class="op" id="6043856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043860">if</span>&nbsp;<span class="ident" id="6043863">b</span><span class="op" id="6043864">.</span><span class="ident" id="6043865">e</span><span class="op" id="6043866">.</span><span class="ident" id="6043867">err</span>&nbsp;<span class="op" id="6043871">!=</span>&nbsp;<span class="builtintype" id="6043874">nil</span>&nbsp;<span class="op" id="6043878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043883">return</span>&nbsp;<span class="num" id="6043890">0</span><span class="op" id="6043891">,</span>&nbsp;<span class="ident" id="6043893">b</span><span class="op" id="6043894">.</span><span class="ident" id="6043895">e</span><span class="op" id="6043896">.</span><span class="ident" id="6043897">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6043903">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6043906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043909">return</span>&nbsp;<span class="ident" id="6043916">total</span><span class="op" id="6043921">,</span>&nbsp;<span class="ident" id="6043923">b</span><span class="op" id="6043924">.</span><span class="ident" id="6043925">e</span><span class="op" id="6043926">.</span><span class="ident" id="6043927">err</span><br>
<span class="lineno"></span><span class="op" id="6043931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6043934">func</span>&nbsp;<span class="op" id="6043939">(</span><span class="ident" id="6043940">e</span>&nbsp;<span class="op" id="6043942">*</span><span class="ident" id="6043943">encoder</span><span class="op" id="6043950">)</span>&nbsp;<span class="ident" id="6043952">flush</span><span class="op" id="6043957">(</span><span class="op" id="6043958">)</span>&nbsp;<span class="op" id="6043960">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043963">if</span>&nbsp;<span class="ident" id="6043966">e</span><span class="op" id="6043967">.</span><span class="ident" id="6043968">err</span>&nbsp;<span class="op" id="6043972">!=</span>&nbsp;<span class="builtintype" id="6043975">nil</span>&nbsp;<span class="op" id="6043979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043983">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6043991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043994">e</span><span class="op" id="6043995">.</span><span class="ident" id="6043996">err</span>&nbsp;<span class="op" id="6044000">=</span>&nbsp;<span class="ident" id="6044002">e</span><span class="op" id="6044003">.</span><span class="ident" id="6044004">w</span><span class="op" id="6044005">.</span><span class="ident" id="6044006">Flush</span><span class="op" id="6044011">(</span><span class="op" id="6044012">)</span><br>
<span class="lineno"></span><span class="op" id="6044014">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="6044017">func</span>&nbsp;<span class="op" id="6044022">(</span><span class="ident" id="6044023">e</span>&nbsp;<span class="op" id="6044025">*</span><span class="ident" id="6044026">encoder</span><span class="op" id="6044033">)</span>&nbsp;<span class="ident" id="6044035">write</span><span class="op" id="6044040">(</span><span class="ident" id="6044041">p</span>&nbsp;<span class="op" id="6044043">[</span><span class="op" id="6044044">]</span><span class="builtintype" id="6044045">byte</span><span class="op" id="6044049">)</span>&nbsp;<span class="op" id="6044051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044054">if</span>&nbsp;<span class="ident" id="6044057">e</span><span class="op" id="6044058">.</span><span class="ident" id="6044059">err</span>&nbsp;<span class="op" id="6044063">!=</span>&nbsp;<span class="builtintype" id="6044066">nil</span>&nbsp;<span class="op" id="6044070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044074">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6044082">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044085">_</span><span class="op" id="6044086">,</span>&nbsp;<span class="ident" id="6044088">e</span><span class="op" id="6044089">.</span><span class="ident" id="6044090">err</span>&nbsp;<span class="op" id="6044094">=</span>&nbsp;<span class="ident" id="6044096">e</span><span class="op" id="6044097">.</span><span class="ident" id="6044098">w</span><span class="op" id="6044099">.</span><span class="ident" id="6044100">Write</span><span class="op" id="6044105">(</span><span class="ident" id="6044106">p</span><span class="op" id="6044107">)</span><br>
<span class="lineno"></span><span class="op" id="6044109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6044112">func</span>&nbsp;<span class="op" id="6044117">(</span><span class="ident" id="6044118">e</span>&nbsp;<span class="op" id="6044120">*</span><span class="ident" id="6044121">encoder</span><span class="op" id="6044128">)</span>&nbsp;<span class="ident" id="6044130">writeByte</span><span class="op" id="6044139">(</span><span class="ident" id="6044140">b</span>&nbsp;<span class="builtintype" id="6044142">byte</span><span class="op" id="6044146">)</span>&nbsp;<span class="op" id="6044148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044151">if</span>&nbsp;<span class="ident" id="6044154">e</span><span class="op" id="6044155">.</span><span class="ident" id="6044156">err</span>&nbsp;<span class="op" id="6044160">!=</span>&nbsp;<span class="builtintype" id="6044163">nil</span>&nbsp;<span class="op" id="6044167">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044171">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6044179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044182">e</span><span class="op" id="6044183">.</span><span class="ident" id="6044184">err</span>&nbsp;<span class="op" id="6044188">=</span>&nbsp;<span class="ident" id="6044190">e</span><span class="op" id="6044191">.</span><span class="ident" id="6044192">w</span><span class="op" id="6044193">.</span><span class="ident" id="6044194">WriteByte</span><span class="op" id="6044203">(</span><span class="ident" id="6044204">b</span><span class="op" id="6044205">)</span><br>
<span class="lineno"></span><span class="op" id="6044207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6044210">func</span>&nbsp;<span class="op" id="6044215">(</span><span class="ident" id="6044216">e</span>&nbsp;<span class="op" id="6044218">*</span><span class="ident" id="6044219">encoder</span><span class="op" id="6044226">)</span>&nbsp;<span class="ident" id="6044228">writeHeader</span><span class="op" id="6044239">(</span><span class="op" id="6044240">)</span>&nbsp;<span class="op" id="6044242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044245">if</span>&nbsp;<span class="ident" id="6044248">e</span><span class="op" id="6044249">.</span><span class="ident" id="6044250">err</span>&nbsp;<span class="op" id="6044254">!=</span>&nbsp;<span class="builtintype" id="6044257">nil</span>&nbsp;<span class="op" id="6044261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044265">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6044273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044276">_</span><span class="op" id="6044277">,</span>&nbsp;<span class="ident" id="6044279">e</span><span class="op" id="6044280">.</span><span class="ident" id="6044281">err</span>&nbsp;<span class="op" id="6044285">=</span>&nbsp;<span class="ident" id="6044287">io</span><span class="op" id="6044289">.</span><span class="ident" id="6044290">WriteString</span><span class="op" id="6044301">(</span><span class="ident" id="6044302">e</span><span class="op" id="6044303">.</span><span class="ident" id="6044304">w</span><span class="op" id="6044305">,</span>&nbsp;<span class="string" id="6044307">&#34;GIF89a&#34;</span><span class="op" id="6044315">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044318">if</span>&nbsp;<span class="ident" id="6044321">e</span><span class="op" id="6044322">.</span><span class="ident" id="6044323">err</span>&nbsp;<span class="op" id="6044327">!=</span>&nbsp;<span class="builtintype" id="6044330">nil</span>&nbsp;<span class="op" id="6044334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044338">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6044346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044350">pm</span>&nbsp;<span class="op" id="6044353">:=</span>&nbsp;<span class="ident" id="6044356">e</span><span class="op" id="6044357">.</span><span class="ident" id="6044358">g</span><span class="op" id="6044359">.</span><span class="ident" id="6044360">Image</span><span class="op" id="6044365">[</span><span class="num" id="6044366">0</span><span class="op" id="6044367">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6044370">//&nbsp;Logical&nbsp;screen&nbsp;width&nbsp;and&nbsp;height.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044407">writeUint16</span><span class="op" id="6044418">(</span><span class="ident" id="6044419">e</span><span class="op" id="6044420">.</span><span class="ident" id="6044421">buf</span><span class="op" id="6044424">[</span><span class="num" id="6044425">0</span><span class="op" id="6044426">:</span><span class="num" id="6044427">2</span><span class="op" id="6044428">]</span><span class="op" id="6044429">,</span>&nbsp;<span class="builtintype" id="6044431">uint16</span><span class="op" id="6044437">(</span><span class="ident" id="6044438">pm</span><span class="op" id="6044440">.</span><span class="ident" id="6044441">Bounds</span><span class="op" id="6044447">(</span><span class="op" id="6044448">)</span><span class="op" id="6044449">.</span><span class="ident" id="6044450">Dx</span><span class="op" id="6044452">(</span><span class="op" id="6044453">)</span><span class="op" id="6044454">)</span><span class="op" id="6044455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044458">writeUint16</span><span class="op" id="6044469">(</span><span class="ident" id="6044470">e</span><span class="op" id="6044471">.</span><span class="ident" id="6044472">buf</span><span class="op" id="6044475">[</span><span class="num" id="6044476">2</span><span class="op" id="6044477">:</span><span class="num" id="6044478">4</span><span class="op" id="6044479">]</span><span class="op" id="6044480">,</span>&nbsp;<span class="builtintype" id="6044482">uint16</span><span class="op" id="6044488">(</span><span class="ident" id="6044489">pm</span><span class="op" id="6044491">.</span><span class="ident" id="6044492">Bounds</span><span class="op" id="6044498">(</span><span class="op" id="6044499">)</span><span class="op" id="6044500">.</span><span class="ident" id="6044501">Dy</span><span class="op" id="6044503">(</span><span class="op" id="6044504">)</span><span class="op" id="6044505">)</span><span class="op" id="6044506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044509">e</span><span class="op" id="6044510">.</span><span class="ident" id="6044511">write</span><span class="op" id="6044516">(</span><span class="ident" id="6044517">e</span><span class="op" id="6044518">.</span><span class="ident" id="6044519">buf</span><span class="op" id="6044522">[</span><span class="op" id="6044523">:</span><span class="num" id="6044524">4</span><span class="op" id="6044525">]</span><span class="op" id="6044526">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6044530">//&nbsp;All&nbsp;frames&nbsp;have&nbsp;a&nbsp;local&nbsp;color&nbsp;table,&nbsp;so&nbsp;a&nbsp;global&nbsp;color&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6044595">//&nbsp;is&nbsp;not&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044614">e</span><span class="op" id="6044615">.</span><span class="ident" id="6044616">buf</span><span class="op" id="6044619">[</span><span class="num" id="6044620">0</span><span class="op" id="6044621">]</span>&nbsp;<span class="op" id="6044623">=</span>&nbsp;<span class="num" id="6044625">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044631">e</span><span class="op" id="6044632">.</span><span class="ident" id="6044633">buf</span><span class="op" id="6044636">[</span><span class="num" id="6044637">1</span><span class="op" id="6044638">]</span>&nbsp;<span class="op" id="6044640">=</span>&nbsp;<span class="num" id="6044642">0x00</span>&nbsp;<span class="comment" id="6044647">//&nbsp;Background&nbsp;Color&nbsp;Index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044675">e</span><span class="op" id="6044676">.</span><span class="ident" id="6044677">buf</span><span class="op" id="6044680">[</span><span class="num" id="6044681">2</span><span class="op" id="6044682">]</span>&nbsp;<span class="op" id="6044684">=</span>&nbsp;<span class="num" id="6044686">0x00</span>&nbsp;<span class="comment" id="6044691">//&nbsp;Pixel&nbsp;Aspect&nbsp;Ratio.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044715">e</span><span class="op" id="6044716">.</span><span class="ident" id="6044717">write</span><span class="op" id="6044722">(</span><span class="ident" id="6044723">e</span><span class="op" id="6044724">.</span><span class="ident" id="6044725">buf</span><span class="op" id="6044728">[</span><span class="op" id="6044729">:</span><span class="num" id="6044730">3</span><span class="op" id="6044731">]</span><span class="op" id="6044732">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6044736">//&nbsp;Add&nbsp;animation&nbsp;info&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044773">if</span>&nbsp;<span class="builtinfunc" id="6044776">len</span><span class="op" id="6044779">(</span><span class="ident" id="6044780">e</span><span class="op" id="6044781">.</span><span class="ident" id="6044782">g</span><span class="op" id="6044783">.</span><span class="ident" id="6044784">Image</span><span class="op" id="6044789">)</span>&nbsp;<span class="op" id="6044791">&gt;</span>&nbsp;<span class="num" id="6044793">1</span>&nbsp;<span class="op" id="6044795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044799">e</span><span class="op" id="6044800">.</span><span class="ident" id="6044801">buf</span><span class="op" id="6044804">[</span><span class="num" id="6044805">0</span><span class="op" id="6044806">]</span>&nbsp;<span class="op" id="6044808">=</span>&nbsp;<span class="num" id="6044810">0x21</span>&nbsp;<span class="comment" id="6044815">//&nbsp;Extension&nbsp;Introducer.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044842">e</span><span class="op" id="6044843">.</span><span class="ident" id="6044844">buf</span><span class="op" id="6044847">[</span><span class="num" id="6044848">1</span><span class="op" id="6044849">]</span>&nbsp;<span class="op" id="6044851">=</span>&nbsp;<span class="num" id="6044853">0xff</span>&nbsp;<span class="comment" id="6044858">//&nbsp;Application&nbsp;Label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044882">e</span><span class="op" id="6044883">.</span><span class="ident" id="6044884">buf</span><span class="op" id="6044887">[</span><span class="num" id="6044888">2</span><span class="op" id="6044889">]</span>&nbsp;<span class="op" id="6044891">=</span>&nbsp;<span class="num" id="6044893">0x0b</span>&nbsp;<span class="comment" id="6044898">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044915">e</span><span class="op" id="6044916">.</span><span class="ident" id="6044917">write</span><span class="op" id="6044922">(</span><span class="ident" id="6044923">e</span><span class="op" id="6044924">.</span><span class="ident" id="6044925">buf</span><span class="op" id="6044928">[</span><span class="op" id="6044929">:</span><span class="num" id="6044930">3</span><span class="op" id="6044931">]</span><span class="op" id="6044932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6044936">_</span><span class="op" id="6044937">,</span>&nbsp;<span class="ident" id="6044939">e</span><span class="op" id="6044940">.</span><span class="ident" id="6044941">err</span>&nbsp;<span class="op" id="6044945">=</span>&nbsp;<span class="ident" id="6044947">io</span><span class="op" id="6044949">.</span><span class="ident" id="6044950">WriteString</span><span class="op" id="6044961">(</span><span class="ident" id="6044962">e</span><span class="op" id="6044963">.</span><span class="ident" id="6044964">w</span><span class="op" id="6044965">,</span>&nbsp;<span class="string" id="6044967">&#34;NETSCAPE2.0&#34;</span><span class="op" id="6044980">)</span>&nbsp;<span class="comment" id="6044982">//&nbsp;Application&nbsp;Identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045011">if</span>&nbsp;<span class="ident" id="6045014">e</span><span class="op" id="6045015">.</span><span class="ident" id="6045016">err</span>&nbsp;<span class="op" id="6045020">!=</span>&nbsp;<span class="builtintype" id="6045023">nil</span>&nbsp;<span class="op" id="6045027">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045032">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045045">e</span><span class="op" id="6045046">.</span><span class="ident" id="6045047">buf</span><span class="op" id="6045050">[</span><span class="num" id="6045051">0</span><span class="op" id="6045052">]</span>&nbsp;<span class="op" id="6045054">=</span>&nbsp;<span class="num" id="6045056">0x03</span>&nbsp;<span class="comment" id="6045061">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045078">e</span><span class="op" id="6045079">.</span><span class="ident" id="6045080">buf</span><span class="op" id="6045083">[</span><span class="num" id="6045084">1</span><span class="op" id="6045085">]</span>&nbsp;<span class="op" id="6045087">=</span>&nbsp;<span class="num" id="6045089">0x01</span>&nbsp;<span class="comment" id="6045094">//&nbsp;Sub-block&nbsp;Index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045116">writeUint16</span><span class="op" id="6045127">(</span><span class="ident" id="6045128">e</span><span class="op" id="6045129">.</span><span class="ident" id="6045130">buf</span><span class="op" id="6045133">[</span><span class="num" id="6045134">2</span><span class="op" id="6045135">:</span><span class="num" id="6045136">4</span><span class="op" id="6045137">]</span><span class="op" id="6045138">,</span>&nbsp;<span class="builtintype" id="6045140">uint16</span><span class="op" id="6045146">(</span><span class="ident" id="6045147">e</span><span class="op" id="6045148">.</span><span class="ident" id="6045149">g</span><span class="op" id="6045150">.</span><span class="ident" id="6045151">LoopCount</span><span class="op" id="6045160">)</span><span class="op" id="6045161">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045165">e</span><span class="op" id="6045166">.</span><span class="ident" id="6045167">buf</span><span class="op" id="6045170">[</span><span class="num" id="6045171">4</span><span class="op" id="6045172">]</span>&nbsp;<span class="op" id="6045174">=</span>&nbsp;<span class="num" id="6045176">0x00</span>&nbsp;<span class="comment" id="6045181">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045204">e</span><span class="op" id="6045205">.</span><span class="ident" id="6045206">write</span><span class="op" id="6045211">(</span><span class="ident" id="6045212">e</span><span class="op" id="6045213">.</span><span class="ident" id="6045214">buf</span><span class="op" id="6045217">[</span><span class="op" id="6045218">:</span><span class="num" id="6045219">5</span><span class="op" id="6045220">]</span><span class="op" id="6045221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045224">}</span><br>
<span class="lineno"></span><span class="op" id="6045226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="keyword" id="6045229">func</span>&nbsp;<span class="op" id="6045234">(</span><span class="ident" id="6045235">e</span>&nbsp;<span class="op" id="6045237">*</span><span class="ident" id="6045238">encoder</span><span class="op" id="6045245">)</span>&nbsp;<span class="ident" id="6045247">writeColorTable</span><span class="op" id="6045262">(</span><span class="ident" id="6045263">p</span>&nbsp;<span class="ident" id="6045265">color</span><span class="op" id="6045270">.</span><span class="ident" id="6045271">Palette</span><span class="op" id="6045278">,</span>&nbsp;<span class="ident" id="6045280">size</span>&nbsp;<span class="builtintype" id="6045285">int</span><span class="op" id="6045288">)</span>&nbsp;<span class="op" id="6045290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045293">if</span>&nbsp;<span class="ident" id="6045296">e</span><span class="op" id="6045297">.</span><span class="ident" id="6045298">err</span>&nbsp;<span class="op" id="6045302">!=</span>&nbsp;<span class="builtintype" id="6045305">nil</span>&nbsp;<span class="op" id="6045309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045313">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045325">for</span>&nbsp;<span class="ident" id="6045329">i</span>&nbsp;<span class="op" id="6045331">:=</span>&nbsp;<span class="num" id="6045334">0</span><span class="op" id="6045335">;</span>&nbsp;<span class="ident" id="6045337">i</span>&nbsp;<span class="op" id="6045339">&lt;</span>&nbsp;<span class="ident" id="6045341">log2Lookup</span><span class="op" id="6045351">[</span><span class="ident" id="6045352">size</span><span class="op" id="6045356">]</span><span class="op" id="6045357">;</span>&nbsp;<span class="ident" id="6045359">i</span><span class="op" id="6045360">++</span>&nbsp;<span class="op" id="6045363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045367">if</span>&nbsp;<span class="ident" id="6045370">i</span>&nbsp;<span class="op" id="6045372">&lt;</span>&nbsp;<span class="builtinfunc" id="6045374">len</span><span class="op" id="6045377">(</span><span class="ident" id="6045378">p</span><span class="op" id="6045379">)</span>&nbsp;<span class="op" id="6045381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045386">r</span><span class="op" id="6045387">,</span>&nbsp;<span class="ident" id="6045389">g</span><span class="op" id="6045390">,</span>&nbsp;<span class="ident" id="6045392">b</span><span class="op" id="6045393">,</span>&nbsp;<span class="ident" id="6045395">_</span>&nbsp;<span class="op" id="6045397">:=</span>&nbsp;<span class="ident" id="6045400">p</span><span class="op" id="6045401">[</span><span class="ident" id="6045402">i</span><span class="op" id="6045403">]</span><span class="op" id="6045404">.</span><span class="ident" id="6045405">RGBA</span><span class="op" id="6045409">(</span><span class="op" id="6045410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045415">e</span><span class="op" id="6045416">.</span><span class="ident" id="6045417">buf</span><span class="op" id="6045420">[</span><span class="num" id="6045421">3</span><span class="op" id="6045422">*</span><span class="ident" id="6045423">i</span><span class="op" id="6045424">+</span><span class="num" id="6045425">0</span><span class="op" id="6045426">]</span>&nbsp;<span class="op" id="6045428">=</span>&nbsp;<span class="builtintype" id="6045430">uint8</span><span class="op" id="6045435">(</span><span class="ident" id="6045436">r</span>&nbsp;<span class="op" id="6045438">&gt;&gt;</span>&nbsp;<span class="num" id="6045441">8</span><span class="op" id="6045442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045447">e</span><span class="op" id="6045448">.</span><span class="ident" id="6045449">buf</span><span class="op" id="6045452">[</span><span class="num" id="6045453">3</span><span class="op" id="6045454">*</span><span class="ident" id="6045455">i</span><span class="op" id="6045456">+</span><span class="num" id="6045457">1</span><span class="op" id="6045458">]</span>&nbsp;<span class="op" id="6045460">=</span>&nbsp;<span class="builtintype" id="6045462">uint8</span><span class="op" id="6045467">(</span><span class="ident" id="6045468">g</span>&nbsp;<span class="op" id="6045470">&gt;&gt;</span>&nbsp;<span class="num" id="6045473">8</span><span class="op" id="6045474">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045479">e</span><span class="op" id="6045480">.</span><span class="ident" id="6045481">buf</span><span class="op" id="6045484">[</span><span class="num" id="6045485">3</span><span class="op" id="6045486">*</span><span class="ident" id="6045487">i</span><span class="op" id="6045488">+</span><span class="num" id="6045489">2</span><span class="op" id="6045490">]</span>&nbsp;<span class="op" id="6045492">=</span>&nbsp;<span class="builtintype" id="6045494">uint8</span><span class="op" id="6045499">(</span><span class="ident" id="6045500">b</span>&nbsp;<span class="op" id="6045502">&gt;&gt;</span>&nbsp;<span class="num" id="6045505">8</span><span class="op" id="6045506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045510">}</span>&nbsp;<span class="keyword" id="6045512">else</span>&nbsp;<span class="op" id="6045517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6045522">//&nbsp;Pad&nbsp;with&nbsp;black.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045544">e</span><span class="op" id="6045545">.</span><span class="ident" id="6045546">buf</span><span class="op" id="6045549">[</span><span class="num" id="6045550">3</span><span class="op" id="6045551">*</span><span class="ident" id="6045552">i</span><span class="op" id="6045553">+</span><span class="num" id="6045554">0</span><span class="op" id="6045555">]</span>&nbsp;<span class="op" id="6045557">=</span>&nbsp;<span class="num" id="6045559">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045567">e</span><span class="op" id="6045568">.</span><span class="ident" id="6045569">buf</span><span class="op" id="6045572">[</span><span class="num" id="6045573">3</span><span class="op" id="6045574">*</span><span class="ident" id="6045575">i</span><span class="op" id="6045576">+</span><span class="num" id="6045577">1</span><span class="op" id="6045578">]</span>&nbsp;<span class="op" id="6045580">=</span>&nbsp;<span class="num" id="6045582">0x00</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045590">e</span><span class="op" id="6045591">.</span><span class="ident" id="6045592">buf</span><span class="op" id="6045595">[</span><span class="num" id="6045596">3</span><span class="op" id="6045597">*</span><span class="ident" id="6045598">i</span><span class="op" id="6045599">+</span><span class="num" id="6045600">2</span><span class="op" id="6045601">]</span>&nbsp;<span class="op" id="6045603">=</span>&nbsp;<span class="num" id="6045605">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045618">e</span><span class="op" id="6045619">.</span><span class="ident" id="6045620">write</span><span class="op" id="6045625">(</span><span class="ident" id="6045626">e</span><span class="op" id="6045627">.</span><span class="ident" id="6045628">buf</span><span class="op" id="6045631">[</span><span class="op" id="6045632">:</span><span class="num" id="6045633">3</span><span class="op" id="6045634">*</span><span class="ident" id="6045635">log2Lookup</span><span class="op" id="6045645">[</span><span class="ident" id="6045646">size</span><span class="op" id="6045650">]</span><span class="op" id="6045651">]</span><span class="op" id="6045652">)</span><br>
<span class="lineno"></span><span class="op" id="6045654">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6045657">func</span>&nbsp;<span class="op" id="6045662">(</span><span class="ident" id="6045663">e</span>&nbsp;<span class="op" id="6045665">*</span><span class="ident" id="6045666">encoder</span><span class="op" id="6045673">)</span>&nbsp;<span class="ident" id="6045675">writeImageBlock</span><span class="op" id="6045690">(</span><span class="ident" id="6045691">pm</span>&nbsp;<span class="op" id="6045694">*</span><span class="ident" id="6045695">image</span><span class="op" id="6045700">.</span><span class="ident" id="6045701">Paletted</span><span class="op" id="6045709">,</span>&nbsp;<span class="ident" id="6045711">delay</span>&nbsp;<span class="builtintype" id="6045717">int</span><span class="op" id="6045720">)</span>&nbsp;<span class="op" id="6045722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045725">if</span>&nbsp;<span class="ident" id="6045728">e</span><span class="op" id="6045729">.</span><span class="ident" id="6045730">err</span>&nbsp;<span class="op" id="6045734">!=</span>&nbsp;<span class="builtintype" id="6045737">nil</span>&nbsp;<span class="op" id="6045741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045745">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045753">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045757">if</span>&nbsp;<span class="builtinfunc" id="6045760">len</span><span class="op" id="6045763">(</span><span class="ident" id="6045764">pm</span><span class="op" id="6045766">.</span><span class="ident" id="6045767">Palette</span><span class="op" id="6045774">)</span>&nbsp;<span class="op" id="6045776">==</span>&nbsp;<span class="num" id="6045779">0</span>&nbsp;<span class="op" id="6045781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045785">e</span><span class="op" id="6045786">.</span><span class="ident" id="6045787">err</span>&nbsp;<span class="op" id="6045791">=</span>&nbsp;<span class="ident" id="6045793">errors</span><span class="op" id="6045799">.</span><span class="ident" id="6045800">New</span><span class="op" id="6045803">(</span><span class="string" id="6045804">&#34;gif:&nbsp;cannot&nbsp;encode&nbsp;image&nbsp;block&nbsp;with&nbsp;empty&nbsp;palette&#34;</span><span class="op" id="6045855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045859">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045867">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045871">b</span>&nbsp;<span class="op" id="6045873">:=</span>&nbsp;<span class="ident" id="6045876">pm</span><span class="op" id="6045878">.</span><span class="ident" id="6045879">Bounds</span><span class="op" id="6045885">(</span><span class="op" id="6045886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6045889">if</span>&nbsp;<span class="ident" id="6045892">b</span><span class="op" id="6045893">.</span><span class="ident" id="6045894">Dx</span><span class="op" id="6045896">(</span><span class="op" id="6045897">)</span>&nbsp;<span class="op" id="6045899">&gt;=</span>&nbsp;<span class="num" id="6045902">1</span><span class="op" id="6045903">&lt;&lt;</span><span class="num" id="6045905">16</span>&nbsp;<span class="op" id="6045908">||</span>&nbsp;<span class="ident" id="6045911">b</span><span class="op" id="6045912">.</span><span class="ident" id="6045913">Dy</span><span class="op" id="6045915">(</span><span class="op" id="6045916">)</span>&nbsp;<span class="op" id="6045918">&gt;=</span>&nbsp;<span class="num" id="6045921">1</span><span class="op" id="6045922">&lt;&lt;</span><span class="num" id="6045924">16</span>&nbsp;<span class="op" id="6045927">||</span>&nbsp;<span class="ident" id="6045930">b</span><span class="op" id="6045931">.</span><span class="ident" id="6045932">Min</span><span class="op" id="6045935">.</span><span class="ident" id="6045936">X</span>&nbsp;<span class="op" id="6045938">&lt;</span>&nbsp;<span class="num" id="6045940">0</span>&nbsp;<span class="op" id="6045942">||</span>&nbsp;<span class="ident" id="6045945">b</span><span class="op" id="6045946">.</span><span class="ident" id="6045947">Min</span><span class="op" id="6045950">.</span><span class="ident" id="6045951">X</span>&nbsp;<span class="op" id="6045953">&gt;=</span>&nbsp;<span class="num" id="6045956">1</span><span class="op" id="6045957">&lt;&lt;</span><span class="num" id="6045959">16</span>&nbsp;<span class="op" id="6045962">||</span>&nbsp;<span class="ident" id="6045965">b</span><span class="op" id="6045966">.</span><span class="ident" id="6045967">Min</span><span class="op" id="6045970">.</span><span class="ident" id="6045971">Y</span>&nbsp;<span class="op" id="6045973">&lt;</span>&nbsp;<span class="num" id="6045975">0</span>&nbsp;<span class="op" id="6045977">||</span>&nbsp;<span class="ident" id="6045980">b</span><span class="op" id="6045981">.</span><span class="ident" id="6045982">Min</span><span class="op" id="6045985">.</span><span class="ident" id="6045986">Y</span>&nbsp;<span class="op" id="6045988">&gt;=</span>&nbsp;<span class="num" id="6045991">1</span><span class="op" id="6045992">&lt;&lt;</span><span class="num" id="6045994">16</span>&nbsp;<span class="op" id="6045997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046001">e</span><span class="op" id="6046002">.</span><span class="ident" id="6046003">err</span>&nbsp;<span class="op" id="6046007">=</span>&nbsp;<span class="ident" id="6046009">errors</span><span class="op" id="6046015">.</span><span class="ident" id="6046016">New</span><span class="op" id="6046019">(</span><span class="string" id="6046020">&#34;gif:&nbsp;image&nbsp;block&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="6046061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046065">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046077">transparentIndex</span>&nbsp;<span class="op" id="6046094">:=</span>&nbsp;<span class="op" id="6046097">-</span><span class="num" id="6046098">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046101">for</span>&nbsp;<span class="ident" id="6046105">i</span><span class="op" id="6046106">,</span>&nbsp;<span class="ident" id="6046108">c</span>&nbsp;<span class="op" id="6046110">:=</span>&nbsp;<span class="keyword" id="6046113">range</span>&nbsp;<span class="ident" id="6046119">pm</span><span class="op" id="6046121">.</span><span class="ident" id="6046122">Palette</span>&nbsp;<span class="op" id="6046130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046134">if</span>&nbsp;<span class="ident" id="6046137">_</span><span class="op" id="6046138">,</span>&nbsp;<span class="ident" id="6046140">_</span><span class="op" id="6046141">,</span>&nbsp;<span class="ident" id="6046143">_</span><span class="op" id="6046144">,</span>&nbsp;<span class="ident" id="6046146">a</span>&nbsp;<span class="op" id="6046148">:=</span>&nbsp;<span class="ident" id="6046151">c</span><span class="op" id="6046152">.</span><span class="ident" id="6046153">RGBA</span><span class="op" id="6046157">(</span><span class="op" id="6046158">)</span><span class="op" id="6046159">;</span>&nbsp;<span class="ident" id="6046161">a</span>&nbsp;<span class="op" id="6046163">==</span>&nbsp;<span class="num" id="6046166">0</span>&nbsp;<span class="op" id="6046168">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046173">transparentIndex</span>&nbsp;<span class="op" id="6046190">=</span>&nbsp;<span class="ident" id="6046192">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046197">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046212">if</span>&nbsp;<span class="ident" id="6046215">delay</span>&nbsp;<span class="op" id="6046221">&gt;</span>&nbsp;<span class="num" id="6046223">0</span>&nbsp;<span class="op" id="6046225">||</span>&nbsp;<span class="ident" id="6046228">transparentIndex</span>&nbsp;<span class="op" id="6046245">!=</span>&nbsp;<span class="op" id="6046248">-</span><span class="num" id="6046249">1</span>&nbsp;<span class="op" id="6046251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046255">e</span><span class="op" id="6046256">.</span><span class="ident" id="6046257">buf</span><span class="op" id="6046260">[</span><span class="num" id="6046261">0</span><span class="op" id="6046262">]</span>&nbsp;<span class="op" id="6046264">=</span>&nbsp;<span class="ident" id="6046266">sExtension</span>&nbsp;&nbsp;<span class="comment" id="6046278">//&nbsp;Extension&nbsp;Introducer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046305">e</span><span class="op" id="6046306">.</span><span class="ident" id="6046307">buf</span><span class="op" id="6046310">[</span><span class="num" id="6046311">1</span><span class="op" id="6046312">]</span>&nbsp;<span class="op" id="6046314">=</span>&nbsp;<span class="ident" id="6046316">gcLabel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6046328">//&nbsp;Graphic&nbsp;Control&nbsp;Label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046356">e</span><span class="op" id="6046357">.</span><span class="ident" id="6046358">buf</span><span class="op" id="6046361">[</span><span class="num" id="6046362">2</span><span class="op" id="6046363">]</span>&nbsp;<span class="op" id="6046365">=</span>&nbsp;<span class="ident" id="6046367">gcBlockSize</span>&nbsp;<span class="comment" id="6046379">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046396">if</span>&nbsp;<span class="ident" id="6046399">transparentIndex</span>&nbsp;<span class="op" id="6046416">!=</span>&nbsp;<span class="op" id="6046419">-</span><span class="num" id="6046420">1</span>&nbsp;<span class="op" id="6046422">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046427">e</span><span class="op" id="6046428">.</span><span class="ident" id="6046429">buf</span><span class="op" id="6046432">[</span><span class="num" id="6046433">3</span><span class="op" id="6046434">]</span>&nbsp;<span class="op" id="6046436">=</span>&nbsp;<span class="num" id="6046438">0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046445">}</span>&nbsp;<span class="keyword" id="6046447">else</span>&nbsp;<span class="op" id="6046452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046457">e</span><span class="op" id="6046458">.</span><span class="ident" id="6046459">buf</span><span class="op" id="6046462">[</span><span class="num" id="6046463">3</span><span class="op" id="6046464">]</span>&nbsp;<span class="op" id="6046466">=</span>&nbsp;<span class="num" id="6046468">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046479">writeUint16</span><span class="op" id="6046490">(</span><span class="ident" id="6046491">e</span><span class="op" id="6046492">.</span><span class="ident" id="6046493">buf</span><span class="op" id="6046496">[</span><span class="num" id="6046497">4</span><span class="op" id="6046498">:</span><span class="num" id="6046499">6</span><span class="op" id="6046500">]</span><span class="op" id="6046501">,</span>&nbsp;<span class="builtintype" id="6046503">uint16</span><span class="op" id="6046509">(</span><span class="ident" id="6046510">delay</span><span class="op" id="6046515">)</span><span class="op" id="6046516">)</span>&nbsp;<span class="comment" id="6046518">//&nbsp;Delay&nbsp;Time&nbsp;(1/100ths&nbsp;of&nbsp;a&nbsp;second)</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6046558">//&nbsp;Transparent&nbsp;color&nbsp;index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046588">if</span>&nbsp;<span class="ident" id="6046591">transparentIndex</span>&nbsp;<span class="op" id="6046608">!=</span>&nbsp;<span class="op" id="6046611">-</span><span class="num" id="6046612">1</span>&nbsp;<span class="op" id="6046614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046619">e</span><span class="op" id="6046620">.</span><span class="ident" id="6046621">buf</span><span class="op" id="6046624">[</span><span class="num" id="6046625">6</span><span class="op" id="6046626">]</span>&nbsp;<span class="op" id="6046628">=</span>&nbsp;<span class="builtintype" id="6046630">uint8</span><span class="op" id="6046635">(</span><span class="ident" id="6046636">transparentIndex</span><span class="op" id="6046652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046656">}</span>&nbsp;<span class="keyword" id="6046658">else</span>&nbsp;<span class="op" id="6046663">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046668">e</span><span class="op" id="6046669">.</span><span class="ident" id="6046670">buf</span><span class="op" id="6046673">[</span><span class="num" id="6046674">6</span><span class="op" id="6046675">]</span>&nbsp;<span class="op" id="6046677">=</span>&nbsp;<span class="num" id="6046679">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046690">e</span><span class="op" id="6046691">.</span><span class="ident" id="6046692">buf</span><span class="op" id="6046695">[</span><span class="num" id="6046696">7</span><span class="op" id="6046697">]</span>&nbsp;<span class="op" id="6046699">=</span>&nbsp;<span class="num" id="6046701">0x00</span>&nbsp;<span class="comment" id="6046706">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046729">e</span><span class="op" id="6046730">.</span><span class="ident" id="6046731">write</span><span class="op" id="6046736">(</span><span class="ident" id="6046737">e</span><span class="op" id="6046738">.</span><span class="ident" id="6046739">buf</span><span class="op" id="6046742">[</span><span class="op" id="6046743">:</span><span class="num" id="6046744">8</span><span class="op" id="6046745">]</span><span class="op" id="6046746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046749">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046752">e</span><span class="op" id="6046753">.</span><span class="ident" id="6046754">buf</span><span class="op" id="6046757">[</span><span class="num" id="6046758">0</span><span class="op" id="6046759">]</span>&nbsp;<span class="op" id="6046761">=</span>&nbsp;<span class="ident" id="6046763">sImageDescriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046781">writeUint16</span><span class="op" id="6046792">(</span><span class="ident" id="6046793">e</span><span class="op" id="6046794">.</span><span class="ident" id="6046795">buf</span><span class="op" id="6046798">[</span><span class="num" id="6046799">1</span><span class="op" id="6046800">:</span><span class="num" id="6046801">3</span><span class="op" id="6046802">]</span><span class="op" id="6046803">,</span>&nbsp;<span class="builtintype" id="6046805">uint16</span><span class="op" id="6046811">(</span><span class="ident" id="6046812">b</span><span class="op" id="6046813">.</span><span class="ident" id="6046814">Min</span><span class="op" id="6046817">.</span><span class="ident" id="6046818">X</span><span class="op" id="6046819">)</span><span class="op" id="6046820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046823">writeUint16</span><span class="op" id="6046834">(</span><span class="ident" id="6046835">e</span><span class="op" id="6046836">.</span><span class="ident" id="6046837">buf</span><span class="op" id="6046840">[</span><span class="num" id="6046841">3</span><span class="op" id="6046842">:</span><span class="num" id="6046843">5</span><span class="op" id="6046844">]</span><span class="op" id="6046845">,</span>&nbsp;<span class="builtintype" id="6046847">uint16</span><span class="op" id="6046853">(</span><span class="ident" id="6046854">b</span><span class="op" id="6046855">.</span><span class="ident" id="6046856">Min</span><span class="op" id="6046859">.</span><span class="ident" id="6046860">Y</span><span class="op" id="6046861">)</span><span class="op" id="6046862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046865">writeUint16</span><span class="op" id="6046876">(</span><span class="ident" id="6046877">e</span><span class="op" id="6046878">.</span><span class="ident" id="6046879">buf</span><span class="op" id="6046882">[</span><span class="num" id="6046883">5</span><span class="op" id="6046884">:</span><span class="num" id="6046885">7</span><span class="op" id="6046886">]</span><span class="op" id="6046887">,</span>&nbsp;<span class="builtintype" id="6046889">uint16</span><span class="op" id="6046895">(</span><span class="ident" id="6046896">b</span><span class="op" id="6046897">.</span><span class="ident" id="6046898">Dx</span><span class="op" id="6046900">(</span><span class="op" id="6046901">)</span><span class="op" id="6046902">)</span><span class="op" id="6046903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046906">writeUint16</span><span class="op" id="6046917">(</span><span class="ident" id="6046918">e</span><span class="op" id="6046919">.</span><span class="ident" id="6046920">buf</span><span class="op" id="6046923">[</span><span class="num" id="6046924">7</span><span class="op" id="6046925">:</span><span class="num" id="6046926">9</span><span class="op" id="6046927">]</span><span class="op" id="6046928">,</span>&nbsp;<span class="builtintype" id="6046930">uint16</span><span class="op" id="6046936">(</span><span class="ident" id="6046937">b</span><span class="op" id="6046938">.</span><span class="ident" id="6046939">Dy</span><span class="op" id="6046941">(</span><span class="op" id="6046942">)</span><span class="op" id="6046943">)</span><span class="op" id="6046944">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046947">e</span><span class="op" id="6046948">.</span><span class="ident" id="6046949">write</span><span class="op" id="6046954">(</span><span class="ident" id="6046955">e</span><span class="op" id="6046956">.</span><span class="ident" id="6046957">buf</span><span class="op" id="6046960">[</span><span class="op" id="6046961">:</span><span class="num" id="6046962">9</span><span class="op" id="6046963">]</span><span class="op" id="6046964">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046968">paddedSize</span>&nbsp;<span class="op" id="6046979">:=</span>&nbsp;<span class="ident" id="6046982">log2</span><span class="op" id="6046986">(</span><span class="builtinfunc" id="6046987">len</span><span class="op" id="6046990">(</span><span class="ident" id="6046991">pm</span><span class="op" id="6046993">.</span><span class="ident" id="6046994">Palette</span><span class="op" id="6047001">)</span><span class="op" id="6047002">)</span>&nbsp;<span class="comment" id="6047004">//&nbsp;Size&nbsp;of&nbsp;Local&nbsp;Color&nbsp;Table:&nbsp;2^(1+n).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6047044">//&nbsp;Interlacing&nbsp;is&nbsp;not&nbsp;supported.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047078">e</span><span class="op" id="6047079">.</span><span class="ident" id="6047080">writeByte</span><span class="op" id="6047089">(</span><span class="num" id="6047090">0x80</span>&nbsp;<span class="op" id="6047095">|</span>&nbsp;<span class="builtintype" id="6047097">uint8</span><span class="op" id="6047102">(</span><span class="ident" id="6047103">paddedSize</span><span class="op" id="6047113">)</span><span class="op" id="6047114">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6047118">//&nbsp;Local&nbsp;Color&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047141">e</span><span class="op" id="6047142">.</span><span class="ident" id="6047143">writeColorTable</span><span class="op" id="6047158">(</span><span class="ident" id="6047159">pm</span><span class="op" id="6047161">.</span><span class="ident" id="6047162">Palette</span><span class="op" id="6047169">,</span>&nbsp;<span class="ident" id="6047171">paddedSize</span><span class="op" id="6047181">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047185">litWidth</span>&nbsp;<span class="op" id="6047194">:=</span>&nbsp;<span class="ident" id="6047197">paddedSize</span>&nbsp;<span class="op" id="6047208">+</span>&nbsp;<span class="num" id="6047210">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047213">if</span>&nbsp;<span class="ident" id="6047216">litWidth</span>&nbsp;<span class="op" id="6047225">&lt;</span>&nbsp;<span class="num" id="6047227">2</span>&nbsp;<span class="op" id="6047229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047233">litWidth</span>&nbsp;<span class="op" id="6047242">=</span>&nbsp;<span class="num" id="6047244">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6047247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047250">e</span><span class="op" id="6047251">.</span><span class="ident" id="6047252">writeByte</span><span class="op" id="6047261">(</span><span class="builtintype" id="6047262">uint8</span><span class="op" id="6047267">(</span><span class="ident" id="6047268">litWidth</span><span class="op" id="6047276">)</span><span class="op" id="6047277">)</span>&nbsp;<span class="comment" id="6047279">//&nbsp;LZW&nbsp;Minimum&nbsp;Code&nbsp;Size.</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047307">lzww</span>&nbsp;<span class="op" id="6047312">:=</span>&nbsp;<span class="ident" id="6047315">lzw</span><span class="op" id="6047318">.</span><span class="ident" id="6047319">NewWriter</span><span class="op" id="6047328">(</span><span class="ident" id="6047329">blockWriter</span><span class="op" id="6047340">{</span><span class="ident" id="6047341">e</span><span class="op" id="6047342">:</span>&nbsp;<span class="ident" id="6047344">e</span><span class="op" id="6047345">}</span><span class="op" id="6047346">,</span>&nbsp;<span class="ident" id="6047348">lzw</span><span class="op" id="6047351">.</span><span class="ident" id="6047352">LSB</span><span class="op" id="6047355">,</span>&nbsp;<span class="ident" id="6047357">litWidth</span><span class="op" id="6047365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047368">if</span>&nbsp;<span class="ident" id="6047371">dx</span>&nbsp;<span class="op" id="6047374">:=</span>&nbsp;<span class="ident" id="6047377">b</span><span class="op" id="6047378">.</span><span class="ident" id="6047379">Dx</span><span class="op" id="6047381">(</span><span class="op" id="6047382">)</span><span class="op" id="6047383">;</span>&nbsp;<span class="ident" id="6047385">dx</span>&nbsp;<span class="op" id="6047388">==</span>&nbsp;<span class="ident" id="6047391">pm</span><span class="op" id="6047393">.</span><span class="ident" id="6047394">Stride</span>&nbsp;<span class="op" id="6047401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047405">_</span><span class="op" id="6047406">,</span>&nbsp;<span class="ident" id="6047408">e</span><span class="op" id="6047409">.</span><span class="ident" id="6047410">err</span>&nbsp;<span class="op" id="6047414">=</span>&nbsp;<span class="ident" id="6047416">lzww</span><span class="op" id="6047420">.</span><span class="ident" id="6047421">Write</span><span class="op" id="6047426">(</span><span class="ident" id="6047427">pm</span><span class="op" id="6047429">.</span><span class="ident" id="6047430">Pix</span><span class="op" id="6047433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047437">if</span>&nbsp;<span class="ident" id="6047440">e</span><span class="op" id="6047441">.</span><span class="ident" id="6047442">err</span>&nbsp;<span class="op" id="6047446">!=</span>&nbsp;<span class="builtintype" id="6047449">nil</span>&nbsp;<span class="op" id="6047453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047458">lzww</span><span class="op" id="6047462">.</span><span class="ident" id="6047463">Close</span><span class="op" id="6047468">(</span><span class="op" id="6047469">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047474">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6047483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6047486">}</span>&nbsp;<span class="keyword" id="6047488">else</span>&nbsp;<span class="op" id="6047493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047497">for</span>&nbsp;<span class="ident" id="6047501">i</span><span class="op" id="6047502">,</span>&nbsp;<span class="ident" id="6047504">y</span>&nbsp;<span class="op" id="6047506">:=</span>&nbsp;<span class="num" id="6047509">0</span><span class="op" id="6047510">,</span>&nbsp;<span class="ident" id="6047512">b</span><span class="op" id="6047513">.</span><span class="ident" id="6047514">Min</span><span class="op" id="6047517">.</span><span class="ident" id="6047518">Y</span><span class="op" id="6047519">;</span>&nbsp;<span class="ident" id="6047521">y</span>&nbsp;<span class="op" id="6047523">&lt;</span>&nbsp;<span class="ident" id="6047525">b</span><span class="op" id="6047526">.</span><span class="ident" id="6047527">Max</span><span class="op" id="6047530">.</span><span class="ident" id="6047531">Y</span><span class="op" id="6047532">;</span>&nbsp;<span class="ident" id="6047534">i</span><span class="op" id="6047535">,</span>&nbsp;<span class="ident" id="6047537">y</span>&nbsp;<span class="op" id="6047539">=</span>&nbsp;<span class="ident" id="6047541">i</span><span class="op" id="6047542">+</span><span class="ident" id="6047543">pm</span><span class="op" id="6047545">.</span><span class="ident" id="6047546">Stride</span><span class="op" id="6047552">,</span>&nbsp;<span class="ident" id="6047554">y</span><span class="op" id="6047555">+</span><span class="num" id="6047556">1</span>&nbsp;<span class="op" id="6047558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047563">_</span><span class="op" id="6047564">,</span>&nbsp;<span class="ident" id="6047566">e</span><span class="op" id="6047567">.</span><span class="ident" id="6047568">err</span>&nbsp;<span class="op" id="6047572">=</span>&nbsp;<span class="ident" id="6047574">lzww</span><span class="op" id="6047578">.</span><span class="ident" id="6047579">Write</span><span class="op" id="6047584">(</span><span class="ident" id="6047585">pm</span><span class="op" id="6047587">.</span><span class="ident" id="6047588">Pix</span><span class="op" id="6047591">[</span><span class="ident" id="6047592">i</span>&nbsp;<span class="op" id="6047594">:</span>&nbsp;<span class="ident" id="6047596">i</span><span class="op" id="6047597">+</span><span class="ident" id="6047598">dx</span><span class="op" id="6047600">]</span><span class="op" id="6047601">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047606">if</span>&nbsp;<span class="ident" id="6047609">e</span><span class="op" id="6047610">.</span><span class="ident" id="6047611">err</span>&nbsp;<span class="op" id="6047615">!=</span>&nbsp;<span class="builtintype" id="6047618">nil</span>&nbsp;<span class="op" id="6047622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047628">lzww</span><span class="op" id="6047632">.</span><span class="ident" id="6047633">Close</span><span class="op" id="6047638">(</span><span class="op" id="6047639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047645">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6047655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6047659">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6047662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047665">lzww</span><span class="op" id="6047669">.</span><span class="ident" id="6047670">Close</span><span class="op" id="6047675">(</span><span class="op" id="6047676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047679">e</span><span class="op" id="6047680">.</span><span class="ident" id="6047681">writeByte</span><span class="op" id="6047690">(</span><span class="num" id="6047691">0x00</span><span class="op" id="6047695">)</span>&nbsp;<span class="comment" id="6047697">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span><span class="op" id="6047718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="6047721">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="6047761">type</span>&nbsp;<span class="ident" id="6047766">Options</span>&nbsp;<span class="keyword" id="6047774">struct</span>&nbsp;<span class="op" id="6047781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6047784">//&nbsp;NumColors&nbsp;is&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;colors&nbsp;used&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6047849">//&nbsp;It&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;256.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047878">NumColors</span>&nbsp;<span class="builtintype" id="6047888">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6047894">//&nbsp;Quantizer&nbsp;is&nbsp;used&nbsp;to&nbsp;produce&nbsp;a&nbsp;palette&nbsp;with&nbsp;size&nbsp;NumColors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6047958">//&nbsp;palette.Plan9&nbsp;is&nbsp;used&nbsp;in&nbsp;place&nbsp;of&nbsp;a&nbsp;nil&nbsp;Quantizer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048013">Quantizer</span>&nbsp;<span class="ident" id="6048023">draw</span><span class="op" id="6048027">.</span><span class="ident" id="6048028">Quantizer</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6048040">//&nbsp;Drawer&nbsp;is&nbsp;used&nbsp;to&nbsp;convert&nbsp;the&nbsp;source&nbsp;image&nbsp;to&nbsp;the&nbsp;desired&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6048111">//&nbsp;draw.FloydSteinberg&nbsp;is&nbsp;used&nbsp;in&nbsp;place&nbsp;of&nbsp;a&nbsp;nil&nbsp;Drawer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048169">Drawer</span>&nbsp;<span class="ident" id="6048176">draw</span><span class="op" id="6048180">.</span><span class="ident" id="6048181">Drawer</span><br>
<span class="lineno"></span><span class="op" id="6048188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="6048191">//&nbsp;EncodeAll&nbsp;writes&nbsp;the&nbsp;images&nbsp;in&nbsp;g&nbsp;to&nbsp;w&nbsp;in&nbsp;GIF&nbsp;format&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6048255">//&nbsp;given&nbsp;loop&nbsp;count&nbsp;and&nbsp;delay&nbsp;between&nbsp;frames.</span><br>
<span class="lineno"></span><span class="keyword" id="6048301">func</span>&nbsp;<span class="ident" id="6048306">EncodeAll</span><span class="op" id="6048315">(</span><span class="ident" id="6048316">w</span>&nbsp;<span class="ident" id="6048318">io</span><span class="op" id="6048320">.</span><span class="ident" id="6048321">Writer</span><span class="op" id="6048327">,</span>&nbsp;<span class="ident" id="6048329">g</span>&nbsp;<span class="op" id="6048331">*</span><span class="ident" id="6048332">GIF</span><span class="op" id="6048335">)</span>&nbsp;<span class="builtintype" id="6048337">error</span>&nbsp;<span class="op" id="6048343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048346">if</span>&nbsp;<span class="builtinfunc" id="6048349">len</span><span class="op" id="6048352">(</span><span class="ident" id="6048353">g</span><span class="op" id="6048354">.</span><span class="ident" id="6048355">Image</span><span class="op" id="6048360">)</span>&nbsp;<span class="op" id="6048362">==</span>&nbsp;<span class="num" id="6048365">0</span>&nbsp;<span class="op" id="6048367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048371">return</span>&nbsp;<span class="ident" id="6048378">errors</span><span class="op" id="6048384">.</span><span class="ident" id="6048385">New</span><span class="op" id="6048388">(</span><span class="string" id="6048389">&#34;gif:&nbsp;must&nbsp;provide&nbsp;at&nbsp;least&nbsp;one&nbsp;image&#34;</span><span class="op" id="6048427">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6048430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048434">if</span>&nbsp;<span class="builtinfunc" id="6048437">len</span><span class="op" id="6048440">(</span><span class="ident" id="6048441">g</span><span class="op" id="6048442">.</span><span class="ident" id="6048443">Image</span><span class="op" id="6048448">)</span>&nbsp;<span class="op" id="6048450">!=</span>&nbsp;<span class="builtinfunc" id="6048453">len</span><span class="op" id="6048456">(</span><span class="ident" id="6048457">g</span><span class="op" id="6048458">.</span><span class="ident" id="6048459">Delay</span><span class="op" id="6048464">)</span>&nbsp;<span class="op" id="6048466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048470">return</span>&nbsp;<span class="ident" id="6048477">errors</span><span class="op" id="6048483">.</span><span class="ident" id="6048484">New</span><span class="op" id="6048487">(</span><span class="string" id="6048488">&#34;gif:&nbsp;mismatched&nbsp;image&nbsp;and&nbsp;delay&nbsp;lengths&#34;</span><span class="op" id="6048529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6048532">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048535">if</span>&nbsp;<span class="ident" id="6048538">g</span><span class="op" id="6048539">.</span><span class="ident" id="6048540">LoopCount</span>&nbsp;<span class="op" id="6048550">&lt;</span>&nbsp;<span class="num" id="6048552">0</span>&nbsp;<span class="op" id="6048554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048558">g</span><span class="op" id="6048559">.</span><span class="ident" id="6048560">LoopCount</span>&nbsp;<span class="op" id="6048570">=</span>&nbsp;<span class="num" id="6048572">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6048575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048579">e</span>&nbsp;<span class="op" id="6048581">:=</span>&nbsp;<span class="ident" id="6048584">encoder</span><span class="op" id="6048591">{</span><span class="ident" id="6048592">g</span><span class="op" id="6048593">:</span>&nbsp;<span class="ident" id="6048595">g</span><span class="op" id="6048596">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048599">if</span>&nbsp;<span class="ident" id="6048602">ww</span><span class="op" id="6048604">,</span>&nbsp;<span class="ident" id="6048606">ok</span>&nbsp;<span class="op" id="6048609">:=</span>&nbsp;<span class="ident" id="6048612">w</span><span class="op" id="6048613">.</span><span class="op" id="6048614">(</span><span class="ident" id="6048615">writer</span><span class="op" id="6048621">)</span><span class="op" id="6048622">;</span>&nbsp;<span class="ident" id="6048624">ok</span>&nbsp;<span class="op" id="6048627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048631">e</span><span class="op" id="6048632">.</span><span class="ident" id="6048633">w</span>&nbsp;<span class="op" id="6048635">=</span>&nbsp;<span class="ident" id="6048637">ww</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6048641">}</span>&nbsp;<span class="keyword" id="6048643">else</span>&nbsp;<span class="op" id="6048648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048652">e</span><span class="op" id="6048653">.</span><span class="ident" id="6048654">w</span>&nbsp;<span class="op" id="6048656">=</span>&nbsp;<span class="ident" id="6048658">bufio</span><span class="op" id="6048663">.</span><span class="ident" id="6048664">NewWriter</span><span class="op" id="6048673">(</span><span class="ident" id="6048674">w</span><span class="op" id="6048675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6048678">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048682">e</span><span class="op" id="6048683">.</span><span class="ident" id="6048684">writeHeader</span><span class="op" id="6048695">(</span><span class="op" id="6048696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048699">for</span>&nbsp;<span class="ident" id="6048703">i</span><span class="op" id="6048704">,</span>&nbsp;<span class="ident" id="6048706">pm</span>&nbsp;<span class="op" id="6048709">:=</span>&nbsp;<span class="keyword" id="6048712">range</span>&nbsp;<span class="ident" id="6048718">g</span><span class="op" id="6048719">.</span><span class="ident" id="6048720">Image</span>&nbsp;<span class="op" id="6048726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048730">e</span><span class="op" id="6048731">.</span><span class="ident" id="6048732">writeImageBlock</span><span class="op" id="6048747">(</span><span class="ident" id="6048748">pm</span><span class="op" id="6048750">,</span>&nbsp;<span class="ident" id="6048752">g</span><span class="op" id="6048753">.</span><span class="ident" id="6048754">Delay</span><span class="op" id="6048759">[</span><span class="ident" id="6048760">i</span><span class="op" id="6048761">]</span><span class="op" id="6048762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6048765">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048768">e</span><span class="op" id="6048769">.</span><span class="ident" id="6048770">writeByte</span><span class="op" id="6048779">(</span><span class="ident" id="6048780">sTrailer</span><span class="op" id="6048788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048791">e</span><span class="op" id="6048792">.</span><span class="ident" id="6048793">flush</span><span class="op" id="6048798">(</span><span class="op" id="6048799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048802">return</span>&nbsp;<span class="ident" id="6048809">e</span><span class="op" id="6048810">.</span><span class="ident" id="6048811">err</span><br>
<span class="lineno"></span><span class="op" id="6048815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="6048818">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;GIF&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="6048867">func</span>&nbsp;<span class="ident" id="6048872">Encode</span><span class="op" id="6048878">(</span><span class="ident" id="6048879">w</span>&nbsp;<span class="ident" id="6048881">io</span><span class="op" id="6048883">.</span><span class="ident" id="6048884">Writer</span><span class="op" id="6048890">,</span>&nbsp;<span class="ident" id="6048892">m</span>&nbsp;<span class="ident" id="6048894">image</span><span class="op" id="6048899">.</span><span class="ident" id="6048900">Image</span><span class="op" id="6048905">,</span>&nbsp;<span class="ident" id="6048907">o</span>&nbsp;<span class="op" id="6048909">*</span><span class="ident" id="6048910">Options</span><span class="op" id="6048917">)</span>&nbsp;<span class="builtintype" id="6048919">error</span>&nbsp;<span class="op" id="6048925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6048928">//&nbsp;Check&nbsp;for&nbsp;bounds&nbsp;and&nbsp;size&nbsp;restrictions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048972">b</span>&nbsp;<span class="op" id="6048974">:=</span>&nbsp;<span class="ident" id="6048977">m</span><span class="op" id="6048978">.</span><span class="ident" id="6048979">Bounds</span><span class="op" id="6048985">(</span><span class="op" id="6048986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048989">if</span>&nbsp;<span class="ident" id="6048992">b</span><span class="op" id="6048993">.</span><span class="ident" id="6048994">Dx</span><span class="op" id="6048996">(</span><span class="op" id="6048997">)</span>&nbsp;<span class="op" id="6048999">&gt;=</span>&nbsp;<span class="num" id="6049002">1</span><span class="op" id="6049003">&lt;&lt;</span><span class="num" id="6049005">16</span>&nbsp;<span class="op" id="6049008">||</span>&nbsp;<span class="ident" id="6049011">b</span><span class="op" id="6049012">.</span><span class="ident" id="6049013">Dy</span><span class="op" id="6049015">(</span><span class="op" id="6049016">)</span>&nbsp;<span class="op" id="6049018">&gt;=</span>&nbsp;<span class="num" id="6049021">1</span><span class="op" id="6049022">&lt;&lt;</span><span class="num" id="6049024">16</span>&nbsp;<span class="op" id="6049027">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049031">return</span>&nbsp;<span class="ident" id="6049038">errors</span><span class="op" id="6049044">.</span><span class="ident" id="6049045">New</span><span class="op" id="6049048">(</span><span class="string" id="6049049">&#34;gif:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="6049084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049091">opts</span>&nbsp;<span class="op" id="6049096">:=</span>&nbsp;<span class="ident" id="6049099">Options</span><span class="op" id="6049106">{</span><span class="op" id="6049107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049110">if</span>&nbsp;<span class="ident" id="6049113">o</span>&nbsp;<span class="op" id="6049115">!=</span>&nbsp;<span class="builtintype" id="6049118">nil</span>&nbsp;<span class="op" id="6049122">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049126">opts</span>&nbsp;<span class="op" id="6049131">=</span>&nbsp;<span class="op" id="6049133">*</span><span class="ident" id="6049134">o</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049140">if</span>&nbsp;<span class="ident" id="6049143">opts</span><span class="op" id="6049147">.</span><span class="ident" id="6049148">NumColors</span>&nbsp;<span class="op" id="6049158">&lt;</span>&nbsp;<span class="num" id="6049160">1</span>&nbsp;<span class="op" id="6049162">||</span>&nbsp;<span class="num" id="6049165">256</span>&nbsp;<span class="op" id="6049169">&lt;</span>&nbsp;<span class="ident" id="6049171">opts</span><span class="op" id="6049175">.</span><span class="ident" id="6049176">NumColors</span>&nbsp;<span class="op" id="6049186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049190">opts</span><span class="op" id="6049194">.</span><span class="ident" id="6049195">NumColors</span>&nbsp;<span class="op" id="6049205">=</span>&nbsp;<span class="num" id="6049207">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049212">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049215">if</span>&nbsp;<span class="ident" id="6049218">opts</span><span class="op" id="6049222">.</span><span class="ident" id="6049223">Drawer</span>&nbsp;<span class="op" id="6049230">==</span>&nbsp;<span class="builtintype" id="6049233">nil</span>&nbsp;<span class="op" id="6049237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049241">opts</span><span class="op" id="6049245">.</span><span class="ident" id="6049246">Drawer</span>&nbsp;<span class="op" id="6049253">=</span>&nbsp;<span class="ident" id="6049255">draw</span><span class="op" id="6049259">.</span><span class="ident" id="6049260">FloydSteinberg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049280">pm</span><span class="op" id="6049282">,</span>&nbsp;<span class="ident" id="6049284">ok</span>&nbsp;<span class="op" id="6049287">:=</span>&nbsp;<span class="ident" id="6049290">m</span><span class="op" id="6049291">.</span><span class="op" id="6049292">(</span><span class="op" id="6049293">*</span><span class="ident" id="6049294">image</span><span class="op" id="6049299">.</span><span class="ident" id="6049300">Paletted</span><span class="op" id="6049308">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049311">if</span>&nbsp;<span class="op" id="6049314">!</span><span class="ident" id="6049315">ok</span>&nbsp;<span class="op" id="6049318">||</span>&nbsp;<span class="builtinfunc" id="6049321">len</span><span class="op" id="6049324">(</span><span class="ident" id="6049325">pm</span><span class="op" id="6049327">.</span><span class="ident" id="6049328">Palette</span><span class="op" id="6049335">)</span>&nbsp;<span class="op" id="6049337">&gt;</span>&nbsp;<span class="ident" id="6049339">opts</span><span class="op" id="6049343">.</span><span class="ident" id="6049344">NumColors</span>&nbsp;<span class="op" id="6049354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6049358">//&nbsp;TODO:&nbsp;Pick&nbsp;a&nbsp;better&nbsp;sub-sample&nbsp;of&nbsp;the&nbsp;Plan&nbsp;9&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049417">pm</span>&nbsp;<span class="op" id="6049420">=</span>&nbsp;<span class="ident" id="6049422">image</span><span class="op" id="6049427">.</span><span class="ident" id="6049428">NewPaletted</span><span class="op" id="6049439">(</span><span class="ident" id="6049440">b</span><span class="op" id="6049441">,</span>&nbsp;<span class="ident" id="6049443">palette</span><span class="op" id="6049450">.</span><span class="ident" id="6049451">Plan9</span><span class="op" id="6049456">[</span><span class="op" id="6049457">:</span><span class="ident" id="6049458">opts</span><span class="op" id="6049462">.</span><span class="ident" id="6049463">NumColors</span><span class="op" id="6049472">]</span><span class="op" id="6049473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049477">if</span>&nbsp;<span class="ident" id="6049480">opts</span><span class="op" id="6049484">.</span><span class="ident" id="6049485">Quantizer</span>&nbsp;<span class="op" id="6049495">!=</span>&nbsp;<span class="builtintype" id="6049498">nil</span>&nbsp;<span class="op" id="6049502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049507">pm</span><span class="op" id="6049509">.</span><span class="ident" id="6049510">Palette</span>&nbsp;<span class="op" id="6049518">=</span>&nbsp;<span class="ident" id="6049520">opts</span><span class="op" id="6049524">.</span><span class="ident" id="6049525">Quantizer</span><span class="op" id="6049534">.</span><span class="ident" id="6049535">Quantize</span><span class="op" id="6049543">(</span><span class="builtinfunc" id="6049544">make</span><span class="op" id="6049548">(</span><span class="ident" id="6049549">color</span><span class="op" id="6049554">.</span><span class="ident" id="6049555">Palette</span><span class="op" id="6049562">,</span>&nbsp;<span class="num" id="6049564">0</span><span class="op" id="6049565">,</span>&nbsp;<span class="ident" id="6049567">opts</span><span class="op" id="6049571">.</span><span class="ident" id="6049572">NumColors</span><span class="op" id="6049581">)</span><span class="op" id="6049582">,</span>&nbsp;<span class="ident" id="6049584">m</span><span class="op" id="6049585">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049593">opts</span><span class="op" id="6049597">.</span><span class="ident" id="6049598">Drawer</span><span class="op" id="6049604">.</span><span class="ident" id="6049605">Draw</span><span class="op" id="6049609">(</span><span class="ident" id="6049610">pm</span><span class="op" id="6049612">,</span>&nbsp;<span class="ident" id="6049614">b</span><span class="op" id="6049615">,</span>&nbsp;<span class="ident" id="6049617">m</span><span class="op" id="6049618">,</span>&nbsp;<span class="ident" id="6049620">image</span><span class="op" id="6049625">.</span><span class="ident" id="6049626">ZP</span><span class="op" id="6049628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049635">return</span>&nbsp;<span class="ident" id="6049642">EncodeAll</span><span class="op" id="6049651">(</span><span class="ident" id="6049652">w</span><span class="op" id="6049653">,</span>&nbsp;<span class="op" id="6049655">&amp;</span><span class="ident" id="6049656">GIF</span><span class="op" id="6049659">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049663">Image</span><span class="op" id="6049668">:</span>&nbsp;<span class="op" id="6049670">[</span><span class="op" id="6049671">]</span><span class="op" id="6049672">*</span><span class="ident" id="6049673">image</span><span class="op" id="6049678">.</span><span class="ident" id="6049679">Paletted</span><span class="op" id="6049687">{</span><span class="ident" id="6049688">pm</span><span class="op" id="6049690">}</span><span class="op" id="6049691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049695">Delay</span><span class="op" id="6049700">:</span>&nbsp;<span class="op" id="6049702">[</span><span class="op" id="6049703">]</span><span class="builtintype" id="6049704">int</span><span class="op" id="6049707">{</span><span class="num" id="6049708">0</span><span class="op" id="6049709">}</span><span class="op" id="6049710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049713">}</span><span class="op" id="6049714">)</span><br>
<span class="lineno"></span><span class="op" id="6049716">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
