<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cookiejar</h2>
<ul>
<li><a href="/gostd/net/http/cookiejar/jar.go.html" class="current">jar.go</a></li>
<li><a href="/gostd/net/http/cookiejar/jar_test.go.html">jar_test.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode.go.html">punycode.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode_test.go.html">punycode_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5911245">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5911300">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5911354">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5911405">//&nbsp;Package&nbsp;cookiejar&nbsp;implements&nbsp;an&nbsp;in-memory&nbsp;RFC&nbsp;6265-compliant&nbsp;http.CookieJar.</span><br>
<span class="lineno"></span><span class="keyword" id="5911485">package</span>&nbsp;<span class="ident" id="5911493">cookiejar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5911504">import</span>&nbsp;<span class="op" id="5911511">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5911514">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5911524">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5911531">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5911538">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5911550">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5911561">&#34;sort&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5911569">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5911580">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5911588">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5911595">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5911598">//&nbsp;PublicSuffixList&nbsp;provides&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;a&nbsp;domain.&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="5911671">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;example.com&#34;&nbsp;is&nbsp;&#34;com&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5911726">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;foo1.foo2.foo3.co.uk&#34;&nbsp;is&nbsp;&#34;co.uk&#34;,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5911796">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;bar.pvt.k12.ma.us&#34;&nbsp;is&nbsp;&#34;pvt.k12.ma.us&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5911867">//</span><br>
<span class="lineno">25</span><span class="comment" id="5911870">//&nbsp;Implementations&nbsp;of&nbsp;PublicSuffixList&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5911944">//&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="5911968">//</span><br>
<span class="lineno"></span><span class="comment" id="5911971">//&nbsp;An&nbsp;implementation&nbsp;that&nbsp;always&nbsp;returns&nbsp;&#34;&#34;&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5912046">//&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.com&nbsp;can</span><br>
<span class="lineno">30</span><span class="comment" id="5912125">//&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;bar.com.</span><br>
<span class="lineno"></span><span class="comment" id="5912154">//</span><br>
<span class="lineno"></span><span class="comment" id="5912157">//&nbsp;A&nbsp;public&nbsp;suffix&nbsp;list&nbsp;implementation&nbsp;is&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="5912214">//&nbsp;golang.org/x/net/publicsuffix.</span><br>
<span class="lineno"></span><span class="keyword" id="5912248">type</span>&nbsp;<span class="ident" id="5912253">PublicSuffixList</span>&nbsp;<span class="keyword" id="5912270">interface</span>&nbsp;<span class="op" id="5912280">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912283">//&nbsp;PublicSuffix&nbsp;returns&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912337">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912341">//&nbsp;TODO:&nbsp;specify&nbsp;which&nbsp;of&nbsp;the&nbsp;caller&nbsp;and&nbsp;callee&nbsp;is&nbsp;responsible&nbsp;for&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912412">//&nbsp;addresses,&nbsp;for&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;dots,&nbsp;for&nbsp;case&nbsp;sensitivity,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912484">//&nbsp;for&nbsp;IDN/Punycode.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912506">PublicSuffix</span><span class="op" id="5912518">(</span><span class="ident" id="5912519">domain</span>&nbsp;<span class="builtintype" id="5912526">string</span><span class="op" id="5912532">)</span>&nbsp;<span class="builtintype" id="5912534">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912543">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;source&nbsp;of&nbsp;this&nbsp;public&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912612">//&nbsp;list.&nbsp;The&nbsp;description&nbsp;will&nbsp;typically&nbsp;contain&nbsp;something&nbsp;like&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912683">//&nbsp;stamp&nbsp;or&nbsp;version&nbsp;number.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5912712">String</span><span class="op" id="5912718">(</span><span class="op" id="5912719">)</span>&nbsp;<span class="builtintype" id="5912721">string</span><br>
<span class="lineno"></span><span class="op" id="5912728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5912731">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;options&nbsp;for&nbsp;creating&nbsp;a&nbsp;new&nbsp;Jar.</span><br>
<span class="lineno"></span><span class="keyword" id="5912782">type</span>&nbsp;<span class="ident" id="5912787">Options</span>&nbsp;<span class="keyword" id="5912795">struct</span>&nbsp;<span class="op" id="5912802">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912805">//&nbsp;PublicSuffixList&nbsp;is&nbsp;the&nbsp;public&nbsp;suffix&nbsp;list&nbsp;that&nbsp;determines&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912876">//&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;a&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912926">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912930">//&nbsp;A&nbsp;nil&nbsp;value&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5912999">//&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.co.uk&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5913072">//&nbsp;for&nbsp;bar.co.uk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913091">PublicSuffixList</span>&nbsp;<span class="ident" id="5913108">PublicSuffixList</span><br>
<span class="lineno"></span><span class="op" id="5913125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5913128">//&nbsp;Jar&nbsp;implements&nbsp;the&nbsp;http.CookieJar&nbsp;interface&nbsp;from&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno">60</span><span class="keyword" id="5913202">type</span>&nbsp;<span class="ident" id="5913207">Jar</span>&nbsp;<span class="keyword" id="5913211">struct</span>&nbsp;<span class="op" id="5913218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913221">psList</span>&nbsp;<span class="ident" id="5913228">PublicSuffixList</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5913247">//&nbsp;mu&nbsp;locks&nbsp;the&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913282">mu</span>&nbsp;<span class="ident" id="5913285">sync</span><span class="op" id="5913289">.</span><span class="ident" id="5913290">Mutex</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5913298">//&nbsp;entries&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;entries,&nbsp;keyed&nbsp;by&nbsp;their&nbsp;eTLD+1&nbsp;and&nbsp;subkeyed&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5913369">//&nbsp;their&nbsp;name/domain/path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913397">entries</span>&nbsp;<span class="keyword" id="5913405">map</span><span class="op" id="5913408">[</span><span class="builtintype" id="5913409">string</span><span class="op" id="5913415">]</span><span class="keyword" id="5913416">map</span><span class="op" id="5913419">[</span><span class="builtintype" id="5913420">string</span><span class="op" id="5913426">]</span><span class="ident" id="5913427">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5913435">//&nbsp;nextSeqNum&nbsp;is&nbsp;the&nbsp;next&nbsp;sequence&nbsp;number&nbsp;assigned&nbsp;to&nbsp;a&nbsp;new&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5913503">//&nbsp;created&nbsp;SetCookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913527">nextSeqNum</span>&nbsp;<span class="ident" id="5913538">uint64</span><br>
<span class="lineno"></span><span class="op" id="5913545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="5913548">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;cookie&nbsp;jar.&nbsp;A&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="5913620">//&nbsp;Options.</span><br>
<span class="lineno"></span><span class="keyword" id="5913632">func</span>&nbsp;<span class="ident" id="5913637">New</span><span class="op" id="5913640">(</span><span class="ident" id="5913641">o</span>&nbsp;<span class="op" id="5913643">*</span><span class="ident" id="5913644">Options</span><span class="op" id="5913651">)</span>&nbsp;<span class="op" id="5913653">(</span><span class="op" id="5913654">*</span><span class="ident" id="5913655">Jar</span><span class="op" id="5913658">,</span>&nbsp;<span class="builtintype" id="5913660">error</span><span class="op" id="5913665">)</span>&nbsp;<span class="op" id="5913667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913670">jar</span>&nbsp;<span class="op" id="5913674">:=</span>&nbsp;<span class="op" id="5913677">&amp;</span><span class="ident" id="5913678">Jar</span><span class="op" id="5913681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913685">entries</span><span class="op" id="5913692">:</span>&nbsp;<span class="builtinfunc" id="5913694">make</span><span class="op" id="5913698">(</span><span class="keyword" id="5913699">map</span><span class="op" id="5913702">[</span><span class="builtintype" id="5913703">string</span><span class="op" id="5913709">]</span><span class="keyword" id="5913710">map</span><span class="op" id="5913713">[</span><span class="builtintype" id="5913714">string</span><span class="op" id="5913720">]</span><span class="ident" id="5913721">entry</span><span class="op" id="5913726">)</span><span class="op" id="5913727">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5913730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5913733">if</span>&nbsp;<span class="ident" id="5913736">o</span>&nbsp;<span class="op" id="5913738">!=</span>&nbsp;<span class="ident" id="5913741">nil</span>&nbsp;<span class="op" id="5913745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913749">jar</span><span class="op" id="5913752">.</span><span class="ident" id="5913753">psList</span>&nbsp;<span class="op" id="5913760">=</span>&nbsp;<span class="ident" id="5913762">o</span><span class="op" id="5913763">.</span><span class="ident" id="5913764">PublicSuffixList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5913782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5913785">return</span>&nbsp;<span class="ident" id="5913792">jar</span><span class="op" id="5913795">,</span>&nbsp;<span class="ident" id="5913797">nil</span><br>
<span class="lineno">85</span><span class="op" id="5913801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5913804">//&nbsp;entry&nbsp;is&nbsp;the&nbsp;internal&nbsp;representation&nbsp;of&nbsp;a&nbsp;cookie.</span><br>
<span class="lineno"></span><span class="comment" id="5913857">//</span><br>
<span class="lineno"></span><span class="comment" id="5913860">//&nbsp;This&nbsp;struct&nbsp;type&nbsp;is&nbsp;not&nbsp;used&nbsp;outside&nbsp;of&nbsp;this&nbsp;package&nbsp;per&nbsp;se,&nbsp;but&nbsp;the&nbsp;exported</span><br>
<span class="lineno">90</span><span class="comment" id="5913941">//&nbsp;fields&nbsp;are&nbsp;those&nbsp;of&nbsp;RFC&nbsp;6265.</span><br>
<span class="lineno"></span><span class="keyword" id="5913974">type</span>&nbsp;<span class="ident" id="5913979">entry</span>&nbsp;<span class="keyword" id="5913985">struct</span>&nbsp;<span class="op" id="5913992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5913995">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5914006">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914014">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5914025">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914033">Domain</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5914044">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914052">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5914063">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914071">Secure</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5914082">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914088">HttpOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5914099">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914105">Persistent</span>&nbsp;<span class="builtintype" id="5914116">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914122">HostOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5914133">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914139">Expires</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914150">time</span><span class="op" id="5914154">.</span><span class="ident" id="5914155">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914161">Creation</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5914172">time</span><span class="op" id="5914176">.</span><span class="ident" id="5914177">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914183">LastAccess</span>&nbsp;<span class="ident" id="5914194">time</span><span class="op" id="5914198">.</span><span class="ident" id="5914199">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5914206">//&nbsp;seqNum&nbsp;is&nbsp;a&nbsp;sequence&nbsp;number&nbsp;so&nbsp;that&nbsp;Cookies&nbsp;returns&nbsp;cookies&nbsp;in&nbsp;a</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5914275">//&nbsp;deterministic&nbsp;order,&nbsp;even&nbsp;for&nbsp;cookies&nbsp;that&nbsp;have&nbsp;equal&nbsp;Path&nbsp;length&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5914349">//&nbsp;equal&nbsp;Creation&nbsp;time.&nbsp;This&nbsp;simplifies&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5914399">seqNum</span>&nbsp;<span class="ident" id="5914406">uint64</span><br>
<span class="lineno"></span><span class="op" id="5914413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="5914416">//&nbsp;Id&nbsp;returns&nbsp;the&nbsp;domain;path;name&nbsp;triple&nbsp;of&nbsp;e&nbsp;as&nbsp;an&nbsp;id.</span><br>
<span class="lineno"></span><span class="keyword" id="5914473">func</span>&nbsp;<span class="op" id="5914478">(</span><span class="ident" id="5914479">e</span>&nbsp;<span class="op" id="5914481">*</span><span class="ident" id="5914482">entry</span><span class="op" id="5914487">)</span>&nbsp;<span class="ident" id="5914489">id</span><span class="op" id="5914491">(</span><span class="op" id="5914492">)</span>&nbsp;<span class="builtintype" id="5914494">string</span>&nbsp;<span class="op" id="5914501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914504">return</span>&nbsp;<span class="ident" id="5914511">fmt</span><span class="op" id="5914514">.</span><span class="ident" id="5914515">Sprintf</span><span class="op" id="5914522">(</span><span class="string" id="5914523">&#34;%s;%s;%s&#34;</span><span class="op" id="5914533">,</span>&nbsp;<span class="ident" id="5914535">e</span><span class="op" id="5914536">.</span><span class="ident" id="5914537">Domain</span><span class="op" id="5914543">,</span>&nbsp;<span class="ident" id="5914545">e</span><span class="op" id="5914546">.</span><span class="ident" id="5914547">Path</span><span class="op" id="5914551">,</span>&nbsp;<span class="ident" id="5914553">e</span><span class="op" id="5914554">.</span><span class="ident" id="5914555">Name</span><span class="op" id="5914559">)</span><br>
<span class="lineno"></span><span class="op" id="5914561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5914564">//&nbsp;shouldSend&nbsp;determines&nbsp;whether&nbsp;e&#39;s&nbsp;cookie&nbsp;qualifies&nbsp;to&nbsp;be&nbsp;included&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5914638">//&nbsp;request&nbsp;to&nbsp;host/path.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;check&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5914713">//&nbsp;cookie&nbsp;is&nbsp;expired.</span><br>
<span class="lineno"></span><span class="keyword" id="5914735">func</span>&nbsp;<span class="op" id="5914740">(</span><span class="ident" id="5914741">e</span>&nbsp;<span class="op" id="5914743">*</span><span class="ident" id="5914744">entry</span><span class="op" id="5914749">)</span>&nbsp;<span class="ident" id="5914751">shouldSend</span><span class="op" id="5914761">(</span><span class="ident" id="5914762">https</span>&nbsp;<span class="builtintype" id="5914768">bool</span><span class="op" id="5914772">,</span>&nbsp;<span class="ident" id="5914774">host</span><span class="op" id="5914778">,</span>&nbsp;<span class="ident" id="5914780">path</span>&nbsp;<span class="builtintype" id="5914785">string</span><span class="op" id="5914791">)</span>&nbsp;<span class="builtintype" id="5914793">bool</span>&nbsp;<span class="op" id="5914798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914801">return</span>&nbsp;<span class="ident" id="5914808">e</span><span class="op" id="5914809">.</span><span class="ident" id="5914810">domainMatch</span><span class="op" id="5914821">(</span><span class="ident" id="5914822">host</span><span class="op" id="5914826">)</span>&nbsp;<span class="op" id="5914828">&amp;&amp;</span>&nbsp;<span class="ident" id="5914831">e</span><span class="op" id="5914832">.</span><span class="ident" id="5914833">pathMatch</span><span class="op" id="5914842">(</span><span class="ident" id="5914843">path</span><span class="op" id="5914847">)</span>&nbsp;<span class="op" id="5914849">&amp;&amp;</span>&nbsp;<span class="op" id="5914852">(</span><span class="ident" id="5914853">https</span>&nbsp;<span class="op" id="5914859">||</span>&nbsp;<span class="op" id="5914862">!</span><span class="ident" id="5914863">e</span><span class="op" id="5914864">.</span><span class="ident" id="5914865">Secure</span><span class="op" id="5914871">)</span><br>
<span class="lineno">120</span><span class="op" id="5914873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5914876">//&nbsp;domainMatch&nbsp;implements&nbsp;&#34;domain-match&#34;&nbsp;of&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.3.</span><br>
<span class="lineno"></span><span class="keyword" id="5914944">func</span>&nbsp;<span class="op" id="5914949">(</span><span class="ident" id="5914950">e</span>&nbsp;<span class="op" id="5914952">*</span><span class="ident" id="5914953">entry</span><span class="op" id="5914958">)</span>&nbsp;<span class="ident" id="5914960">domainMatch</span><span class="op" id="5914971">(</span><span class="ident" id="5914972">host</span>&nbsp;<span class="builtintype" id="5914977">string</span><span class="op" id="5914983">)</span>&nbsp;<span class="builtintype" id="5914985">bool</span>&nbsp;<span class="op" id="5914990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5914993">if</span>&nbsp;<span class="ident" id="5914996">e</span><span class="op" id="5914997">.</span><span class="ident" id="5914998">Domain</span>&nbsp;<span class="op" id="5915005">==</span>&nbsp;<span class="ident" id="5915008">host</span>&nbsp;<span class="op" id="5915013">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915017">return</span>&nbsp;<span class="builtintype" id="5915024">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5915030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915033">return</span>&nbsp;<span class="op" id="5915040">!</span><span class="ident" id="5915041">e</span><span class="op" id="5915042">.</span><span class="ident" id="5915043">HostOnly</span>&nbsp;<span class="op" id="5915052">&amp;&amp;</span>&nbsp;<span class="ident" id="5915055">hasDotSuffix</span><span class="op" id="5915067">(</span><span class="ident" id="5915068">host</span><span class="op" id="5915072">,</span>&nbsp;<span class="ident" id="5915074">e</span><span class="op" id="5915075">.</span><span class="ident" id="5915076">Domain</span><span class="op" id="5915082">)</span><br>
<span class="lineno"></span><span class="op" id="5915084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5915087">//&nbsp;pathMatch&nbsp;implements&nbsp;&#34;path-match&#34;&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="5915161">func</span>&nbsp;<span class="op" id="5915166">(</span><span class="ident" id="5915167">e</span>&nbsp;<span class="op" id="5915169">*</span><span class="ident" id="5915170">entry</span><span class="op" id="5915175">)</span>&nbsp;<span class="ident" id="5915177">pathMatch</span><span class="op" id="5915186">(</span><span class="ident" id="5915187">requestPath</span>&nbsp;<span class="builtintype" id="5915199">string</span><span class="op" id="5915205">)</span>&nbsp;<span class="builtintype" id="5915207">bool</span>&nbsp;<span class="op" id="5915212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915215">if</span>&nbsp;<span class="ident" id="5915218">requestPath</span>&nbsp;<span class="op" id="5915230">==</span>&nbsp;<span class="ident" id="5915233">e</span><span class="op" id="5915234">.</span><span class="ident" id="5915235">Path</span>&nbsp;<span class="op" id="5915240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915244">return</span>&nbsp;<span class="builtintype" id="5915251">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5915257">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915260">if</span>&nbsp;<span class="ident" id="5915263">strings</span><span class="op" id="5915270">.</span><span class="ident" id="5915271">HasPrefix</span><span class="op" id="5915280">(</span><span class="ident" id="5915281">requestPath</span><span class="op" id="5915292">,</span>&nbsp;<span class="ident" id="5915294">e</span><span class="op" id="5915295">.</span><span class="ident" id="5915296">Path</span><span class="op" id="5915300">)</span>&nbsp;<span class="op" id="5915302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915306">if</span>&nbsp;<span class="ident" id="5915309">e</span><span class="op" id="5915310">.</span><span class="ident" id="5915311">Path</span><span class="op" id="5915315">[</span><span class="builtinfunc" id="5915316">len</span><span class="op" id="5915319">(</span><span class="ident" id="5915320">e</span><span class="op" id="5915321">.</span><span class="ident" id="5915322">Path</span><span class="op" id="5915326">)</span><span class="op" id="5915327">-</span><span class="num" id="5915328">1</span><span class="op" id="5915329">]</span>&nbsp;<span class="op" id="5915331">==</span>&nbsp;<span class="string" id="5915334">&#39;/&#39;</span>&nbsp;<span class="op" id="5915338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915343">return</span>&nbsp;<span class="builtintype" id="5915350">true</span>&nbsp;<span class="comment" id="5915355">//&nbsp;The&nbsp;&#34;/any/&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5915398">}</span>&nbsp;<span class="keyword" id="5915400">else</span>&nbsp;<span class="keyword" id="5915405">if</span>&nbsp;<span class="ident" id="5915408">requestPath</span><span class="op" id="5915419">[</span><span class="builtinfunc" id="5915420">len</span><span class="op" id="5915423">(</span><span class="ident" id="5915424">e</span><span class="op" id="5915425">.</span><span class="ident" id="5915426">Path</span><span class="op" id="5915430">)</span><span class="op" id="5915431">]</span>&nbsp;<span class="op" id="5915433">==</span>&nbsp;<span class="string" id="5915436">&#39;/&#39;</span>&nbsp;<span class="op" id="5915440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915445">return</span>&nbsp;<span class="builtintype" id="5915452">true</span>&nbsp;<span class="comment" id="5915457">//&nbsp;The&nbsp;&#34;/any&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5915499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5915502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915505">return</span>&nbsp;<span class="builtintype" id="5915512">false</span><br>
<span class="lineno"></span><span class="op" id="5915518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="5915521">//&nbsp;hasDotSuffix&nbsp;reports&nbsp;whether&nbsp;s&nbsp;ends&nbsp;in&nbsp;&#34;.&#34;+suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="5915575">func</span>&nbsp;<span class="ident" id="5915580">hasDotSuffix</span><span class="op" id="5915592">(</span><span class="ident" id="5915593">s</span><span class="op" id="5915594">,</span>&nbsp;<span class="ident" id="5915596">suffix</span>&nbsp;<span class="builtintype" id="5915603">string</span><span class="op" id="5915609">)</span>&nbsp;<span class="builtintype" id="5915611">bool</span>&nbsp;<span class="op" id="5915616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915619">return</span>&nbsp;<span class="builtinfunc" id="5915626">len</span><span class="op" id="5915629">(</span><span class="ident" id="5915630">s</span><span class="op" id="5915631">)</span>&nbsp;<span class="op" id="5915633">&gt;</span>&nbsp;<span class="builtinfunc" id="5915635">len</span><span class="op" id="5915638">(</span><span class="ident" id="5915639">suffix</span><span class="op" id="5915645">)</span>&nbsp;<span class="op" id="5915647">&amp;&amp;</span>&nbsp;<span class="ident" id="5915650">s</span><span class="op" id="5915651">[</span><span class="builtinfunc" id="5915652">len</span><span class="op" id="5915655">(</span><span class="ident" id="5915656">s</span><span class="op" id="5915657">)</span><span class="op" id="5915658">-</span><span class="builtinfunc" id="5915659">len</span><span class="op" id="5915662">(</span><span class="ident" id="5915663">suffix</span><span class="op" id="5915669">)</span><span class="op" id="5915670">-</span><span class="num" id="5915671">1</span><span class="op" id="5915672">]</span>&nbsp;<span class="op" id="5915674">==</span>&nbsp;<span class="string" id="5915677">&#39;.&#39;</span>&nbsp;<span class="op" id="5915681">&amp;&amp;</span>&nbsp;<span class="ident" id="5915684">s</span><span class="op" id="5915685">[</span><span class="builtinfunc" id="5915686">len</span><span class="op" id="5915689">(</span><span class="ident" id="5915690">s</span><span class="op" id="5915691">)</span><span class="op" id="5915692">-</span><span class="builtinfunc" id="5915693">len</span><span class="op" id="5915696">(</span><span class="ident" id="5915697">suffix</span><span class="op" id="5915703">)</span><span class="op" id="5915704">:</span><span class="op" id="5915705">]</span>&nbsp;<span class="op" id="5915707">==</span>&nbsp;<span class="ident" id="5915710">suffix</span><br>
<span class="lineno"></span><span class="op" id="5915717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="5915720">//&nbsp;byPathLength&nbsp;is&nbsp;a&nbsp;[]entry&nbsp;sort.Interface&nbsp;that&nbsp;sorts&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265</span><br>
<span class="lineno"></span><span class="comment" id="5915797">//&nbsp;section&nbsp;5.4&nbsp;point&nbsp;2:&nbsp;by&nbsp;longest&nbsp;path&nbsp;and&nbsp;then&nbsp;by&nbsp;earliest&nbsp;creation&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="5915873">type</span>&nbsp;<span class="ident" id="5915878">byPathLength</span>&nbsp;<span class="op" id="5915891">[</span><span class="op" id="5915892">]</span><span class="ident" id="5915893">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5915900">func</span>&nbsp;<span class="op" id="5915905">(</span><span class="ident" id="5915906">s</span>&nbsp;<span class="ident" id="5915908">byPathLength</span><span class="op" id="5915920">)</span>&nbsp;<span class="ident" id="5915922">Len</span><span class="op" id="5915925">(</span><span class="op" id="5915926">)</span>&nbsp;<span class="builtintype" id="5915928">int</span>&nbsp;<span class="op" id="5915932">{</span>&nbsp;<span class="keyword" id="5915934">return</span>&nbsp;<span class="builtinfunc" id="5915941">len</span><span class="op" id="5915944">(</span><span class="ident" id="5915945">s</span><span class="op" id="5915946">)</span>&nbsp;<span class="op" id="5915948">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="5915951">func</span>&nbsp;<span class="op" id="5915956">(</span><span class="ident" id="5915957">s</span>&nbsp;<span class="ident" id="5915959">byPathLength</span><span class="op" id="5915971">)</span>&nbsp;<span class="ident" id="5915973">Less</span><span class="op" id="5915977">(</span><span class="ident" id="5915978">i</span><span class="op" id="5915979">,</span>&nbsp;<span class="ident" id="5915981">j</span>&nbsp;<span class="builtintype" id="5915983">int</span><span class="op" id="5915986">)</span>&nbsp;<span class="builtintype" id="5915988">bool</span>&nbsp;<span class="op" id="5915993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5915996">if</span>&nbsp;<span class="builtinfunc" id="5915999">len</span><span class="op" id="5916002">(</span><span class="ident" id="5916003">s</span><span class="op" id="5916004">[</span><span class="ident" id="5916005">i</span><span class="op" id="5916006">]</span><span class="op" id="5916007">.</span><span class="ident" id="5916008">Path</span><span class="op" id="5916012">)</span>&nbsp;<span class="op" id="5916014">!=</span>&nbsp;<span class="builtinfunc" id="5916017">len</span><span class="op" id="5916020">(</span><span class="ident" id="5916021">s</span><span class="op" id="5916022">[</span><span class="ident" id="5916023">j</span><span class="op" id="5916024">]</span><span class="op" id="5916025">.</span><span class="ident" id="5916026">Path</span><span class="op" id="5916030">)</span>&nbsp;<span class="op" id="5916032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916036">return</span>&nbsp;<span class="builtinfunc" id="5916043">len</span><span class="op" id="5916046">(</span><span class="ident" id="5916047">s</span><span class="op" id="5916048">[</span><span class="ident" id="5916049">i</span><span class="op" id="5916050">]</span><span class="op" id="5916051">.</span><span class="ident" id="5916052">Path</span><span class="op" id="5916056">)</span>&nbsp;<span class="op" id="5916058">&gt;</span>&nbsp;<span class="builtinfunc" id="5916060">len</span><span class="op" id="5916063">(</span><span class="ident" id="5916064">s</span><span class="op" id="5916065">[</span><span class="ident" id="5916066">j</span><span class="op" id="5916067">]</span><span class="op" id="5916068">.</span><span class="ident" id="5916069">Path</span><span class="op" id="5916073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5916076">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916079">if</span>&nbsp;<span class="op" id="5916082">!</span><span class="ident" id="5916083">s</span><span class="op" id="5916084">[</span><span class="ident" id="5916085">i</span><span class="op" id="5916086">]</span><span class="op" id="5916087">.</span><span class="ident" id="5916088">Creation</span><span class="op" id="5916096">.</span><span class="ident" id="5916097">Equal</span><span class="op" id="5916102">(</span><span class="ident" id="5916103">s</span><span class="op" id="5916104">[</span><span class="ident" id="5916105">j</span><span class="op" id="5916106">]</span><span class="op" id="5916107">.</span><span class="ident" id="5916108">Creation</span><span class="op" id="5916116">)</span>&nbsp;<span class="op" id="5916118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916122">return</span>&nbsp;<span class="ident" id="5916129">s</span><span class="op" id="5916130">[</span><span class="ident" id="5916131">i</span><span class="op" id="5916132">]</span><span class="op" id="5916133">.</span><span class="ident" id="5916134">Creation</span><span class="op" id="5916142">.</span><span class="ident" id="5916143">Before</span><span class="op" id="5916149">(</span><span class="ident" id="5916150">s</span><span class="op" id="5916151">[</span><span class="ident" id="5916152">j</span><span class="op" id="5916153">]</span><span class="op" id="5916154">.</span><span class="ident" id="5916155">Creation</span><span class="op" id="5916163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5916166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916169">return</span>&nbsp;<span class="ident" id="5916176">s</span><span class="op" id="5916177">[</span><span class="ident" id="5916178">i</span><span class="op" id="5916179">]</span><span class="op" id="5916180">.</span><span class="ident" id="5916181">seqNum</span>&nbsp;<span class="op" id="5916188">&lt;</span>&nbsp;<span class="ident" id="5916190">s</span><span class="op" id="5916191">[</span><span class="ident" id="5916192">j</span><span class="op" id="5916193">]</span><span class="op" id="5916194">.</span><span class="ident" id="5916195">seqNum</span><br>
<span class="lineno"></span><span class="op" id="5916202">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="5916205">func</span>&nbsp;<span class="op" id="5916210">(</span><span class="ident" id="5916211">s</span>&nbsp;<span class="ident" id="5916213">byPathLength</span><span class="op" id="5916225">)</span>&nbsp;<span class="ident" id="5916227">Swap</span><span class="op" id="5916231">(</span><span class="ident" id="5916232">i</span><span class="op" id="5916233">,</span>&nbsp;<span class="ident" id="5916235">j</span>&nbsp;<span class="builtintype" id="5916237">int</span><span class="op" id="5916240">)</span>&nbsp;<span class="op" id="5916242">{</span>&nbsp;<span class="ident" id="5916244">s</span><span class="op" id="5916245">[</span><span class="ident" id="5916246">i</span><span class="op" id="5916247">]</span><span class="op" id="5916248">,</span>&nbsp;<span class="ident" id="5916250">s</span><span class="op" id="5916251">[</span><span class="ident" id="5916252">j</span><span class="op" id="5916253">]</span>&nbsp;<span class="op" id="5916255">=</span>&nbsp;<span class="ident" id="5916257">s</span><span class="op" id="5916258">[</span><span class="ident" id="5916259">j</span><span class="op" id="5916260">]</span><span class="op" id="5916261">,</span>&nbsp;<span class="ident" id="5916263">s</span><span class="op" id="5916264">[</span><span class="ident" id="5916265">i</span><span class="op" id="5916266">]</span>&nbsp;<span class="op" id="5916268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5916271">//&nbsp;Cookies&nbsp;implements&nbsp;the&nbsp;Cookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5916345">//</span><br>
<span class="lineno">170</span><span class="comment" id="5916348">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno"></span><span class="keyword" id="5916419">func</span>&nbsp;<span class="op" id="5916424">(</span><span class="ident" id="5916425">j</span>&nbsp;<span class="op" id="5916427">*</span><span class="ident" id="5916428">Jar</span><span class="op" id="5916431">)</span>&nbsp;<span class="ident" id="5916433">Cookies</span><span class="op" id="5916440">(</span><span class="ident" id="5916441">u</span>&nbsp;<span class="op" id="5916443">*</span><span class="ident" id="5916444">url</span><span class="op" id="5916447">.</span><span class="ident" id="5916448">URL</span><span class="op" id="5916451">)</span>&nbsp;<span class="op" id="5916453">(</span><span class="ident" id="5916454">cookies</span>&nbsp;<span class="op" id="5916462">[</span><span class="op" id="5916463">]</span><span class="op" id="5916464">*</span><span class="ident" id="5916465">http</span><span class="op" id="5916469">.</span><span class="ident" id="5916470">Cookie</span><span class="op" id="5916476">)</span>&nbsp;<span class="op" id="5916478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916481">return</span>&nbsp;<span class="ident" id="5916488">j</span><span class="op" id="5916489">.</span><span class="ident" id="5916490">cookies</span><span class="op" id="5916497">(</span><span class="ident" id="5916498">u</span><span class="op" id="5916499">,</span>&nbsp;<span class="ident" id="5916501">time</span><span class="op" id="5916505">.</span><span class="ident" id="5916506">Now</span><span class="op" id="5916509">(</span><span class="op" id="5916510">)</span><span class="op" id="5916511">)</span><br>
<span class="lineno"></span><span class="op" id="5916513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5916516">//&nbsp;cookies&nbsp;is&nbsp;like&nbsp;Cookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;a&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="5916586">func</span>&nbsp;<span class="op" id="5916591">(</span><span class="ident" id="5916592">j</span>&nbsp;<span class="op" id="5916594">*</span><span class="ident" id="5916595">Jar</span><span class="op" id="5916598">)</span>&nbsp;<span class="ident" id="5916600">cookies</span><span class="op" id="5916607">(</span><span class="ident" id="5916608">u</span>&nbsp;<span class="op" id="5916610">*</span><span class="ident" id="5916611">url</span><span class="op" id="5916614">.</span><span class="ident" id="5916615">URL</span><span class="op" id="5916618">,</span>&nbsp;<span class="ident" id="5916620">now</span>&nbsp;<span class="ident" id="5916624">time</span><span class="op" id="5916628">.</span><span class="ident" id="5916629">Time</span><span class="op" id="5916633">)</span>&nbsp;<span class="op" id="5916635">(</span><span class="ident" id="5916636">cookies</span>&nbsp;<span class="op" id="5916644">[</span><span class="op" id="5916645">]</span><span class="op" id="5916646">*</span><span class="ident" id="5916647">http</span><span class="op" id="5916651">.</span><span class="ident" id="5916652">Cookie</span><span class="op" id="5916658">)</span>&nbsp;<span class="op" id="5916660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916663">if</span>&nbsp;<span class="ident" id="5916666">u</span><span class="op" id="5916667">.</span><span class="ident" id="5916668">Scheme</span>&nbsp;<span class="op" id="5916675">!=</span>&nbsp;<span class="string" id="5916678">&#34;http&#34;</span>&nbsp;<span class="op" id="5916685">&amp;&amp;</span>&nbsp;<span class="ident" id="5916688">u</span><span class="op" id="5916689">.</span><span class="ident" id="5916690">Scheme</span>&nbsp;<span class="op" id="5916697">!=</span>&nbsp;<span class="string" id="5916700">&#34;https&#34;</span>&nbsp;<span class="op" id="5916708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916712">return</span>&nbsp;<span class="ident" id="5916719">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5916728">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916731">host</span><span class="op" id="5916735">,</span>&nbsp;<span class="ident" id="5916737">err</span>&nbsp;<span class="op" id="5916741">:=</span>&nbsp;<span class="ident" id="5916744">canonicalHost</span><span class="op" id="5916757">(</span><span class="ident" id="5916758">u</span><span class="op" id="5916759">.</span><span class="ident" id="5916760">Host</span><span class="op" id="5916764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916767">if</span>&nbsp;<span class="ident" id="5916770">err</span>&nbsp;<span class="op" id="5916774">!=</span>&nbsp;<span class="ident" id="5916777">nil</span>&nbsp;<span class="op" id="5916781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916785">return</span>&nbsp;<span class="ident" id="5916792">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5916801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916804">key</span>&nbsp;<span class="op" id="5916808">:=</span>&nbsp;<span class="ident" id="5916811">jarKey</span><span class="op" id="5916817">(</span><span class="ident" id="5916818">host</span><span class="op" id="5916822">,</span>&nbsp;<span class="ident" id="5916824">j</span><span class="op" id="5916825">.</span><span class="ident" id="5916826">psList</span><span class="op" id="5916832">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916836">j</span><span class="op" id="5916837">.</span><span class="ident" id="5916838">mu</span><span class="op" id="5916840">.</span><span class="ident" id="5916841">Lock</span><span class="op" id="5916845">(</span><span class="op" id="5916846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916849">defer</span>&nbsp;<span class="ident" id="5916855">j</span><span class="op" id="5916856">.</span><span class="ident" id="5916857">mu</span><span class="op" id="5916859">.</span><span class="ident" id="5916860">Unlock</span><span class="op" id="5916866">(</span><span class="op" id="5916867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916871">submap</span>&nbsp;<span class="op" id="5916878">:=</span>&nbsp;<span class="ident" id="5916881">j</span><span class="op" id="5916882">.</span><span class="ident" id="5916883">entries</span><span class="op" id="5916890">[</span><span class="ident" id="5916891">key</span><span class="op" id="5916894">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916897">if</span>&nbsp;<span class="ident" id="5916900">submap</span>&nbsp;<span class="op" id="5916907">==</span>&nbsp;<span class="ident" id="5916910">nil</span>&nbsp;<span class="op" id="5916914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916918">return</span>&nbsp;<span class="ident" id="5916925">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5916934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916938">https</span>&nbsp;<span class="op" id="5916944">:=</span>&nbsp;<span class="ident" id="5916947">u</span><span class="op" id="5916948">.</span><span class="ident" id="5916949">Scheme</span>&nbsp;<span class="op" id="5916956">==</span>&nbsp;<span class="string" id="5916959">&#34;https&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5916968">path</span>&nbsp;<span class="op" id="5916973">:=</span>&nbsp;<span class="ident" id="5916976">u</span><span class="op" id="5916977">.</span><span class="ident" id="5916978">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916984">if</span>&nbsp;<span class="ident" id="5916987">path</span>&nbsp;<span class="op" id="5916992">==</span>&nbsp;<span class="string" id="5916995">&#34;&#34;</span>&nbsp;<span class="op" id="5916998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917002">path</span>&nbsp;<span class="op" id="5917007">=</span>&nbsp;<span class="string" id="5917009">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917018">modified</span>&nbsp;<span class="op" id="5917027">:=</span>&nbsp;<span class="builtintype" id="5917030">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917037">var</span>&nbsp;<span class="ident" id="5917041">selected</span>&nbsp;<span class="op" id="5917050">[</span><span class="op" id="5917051">]</span><span class="ident" id="5917052">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917059">for</span>&nbsp;<span class="ident" id="5917063">id</span><span class="op" id="5917065">,</span>&nbsp;<span class="ident" id="5917067">e</span>&nbsp;<span class="op" id="5917069">:=</span>&nbsp;<span class="keyword" id="5917072">range</span>&nbsp;<span class="ident" id="5917078">submap</span>&nbsp;<span class="op" id="5917085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917089">if</span>&nbsp;<span class="ident" id="5917092">e</span><span class="op" id="5917093">.</span><span class="ident" id="5917094">Persistent</span>&nbsp;<span class="op" id="5917105">&amp;&amp;</span>&nbsp;<span class="op" id="5917108">!</span><span class="ident" id="5917109">e</span><span class="op" id="5917110">.</span><span class="ident" id="5917111">Expires</span><span class="op" id="5917118">.</span><span class="ident" id="5917119">After</span><span class="op" id="5917124">(</span><span class="ident" id="5917125">now</span><span class="op" id="5917128">)</span>&nbsp;<span class="op" id="5917130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5917135">delete</span><span class="op" id="5917141">(</span><span class="ident" id="5917142">submap</span><span class="op" id="5917148">,</span>&nbsp;<span class="ident" id="5917150">id</span><span class="op" id="5917152">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917157">modified</span>&nbsp;<span class="op" id="5917166">=</span>&nbsp;<span class="builtintype" id="5917168">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917176">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917191">if</span>&nbsp;<span class="op" id="5917194">!</span><span class="ident" id="5917195">e</span><span class="op" id="5917196">.</span><span class="ident" id="5917197">shouldSend</span><span class="op" id="5917207">(</span><span class="ident" id="5917208">https</span><span class="op" id="5917213">,</span>&nbsp;<span class="ident" id="5917215">host</span><span class="op" id="5917219">,</span>&nbsp;<span class="ident" id="5917221">path</span><span class="op" id="5917225">)</span>&nbsp;<span class="op" id="5917227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917232">continue</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917247">e</span><span class="op" id="5917248">.</span><span class="ident" id="5917249">LastAccess</span>&nbsp;<span class="op" id="5917260">=</span>&nbsp;<span class="ident" id="5917262">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917268">submap</span><span class="op" id="5917274">[</span><span class="ident" id="5917275">id</span><span class="op" id="5917277">]</span>&nbsp;<span class="op" id="5917279">=</span>&nbsp;<span class="ident" id="5917281">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917285">selected</span>&nbsp;<span class="op" id="5917294">=</span>&nbsp;<span class="builtinfunc" id="5917296">append</span><span class="op" id="5917302">(</span><span class="ident" id="5917303">selected</span><span class="op" id="5917311">,</span>&nbsp;<span class="ident" id="5917313">e</span><span class="op" id="5917314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917318">modified</span>&nbsp;<span class="op" id="5917327">=</span>&nbsp;<span class="builtintype" id="5917329">true</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917338">if</span>&nbsp;<span class="ident" id="5917341">modified</span>&nbsp;<span class="op" id="5917350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917354">if</span>&nbsp;<span class="builtinfunc" id="5917357">len</span><span class="op" id="5917360">(</span><span class="ident" id="5917361">submap</span><span class="op" id="5917367">)</span>&nbsp;<span class="op" id="5917369">==</span>&nbsp;<span class="num" id="5917372">0</span>&nbsp;<span class="op" id="5917374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5917379">delete</span><span class="op" id="5917385">(</span><span class="ident" id="5917386">j</span><span class="op" id="5917387">.</span><span class="ident" id="5917388">entries</span><span class="op" id="5917395">,</span>&nbsp;<span class="ident" id="5917397">key</span><span class="op" id="5917400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917404">}</span>&nbsp;<span class="keyword" id="5917406">else</span>&nbsp;<span class="op" id="5917411">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917416">j</span><span class="op" id="5917417">.</span><span class="ident" id="5917418">entries</span><span class="op" id="5917425">[</span><span class="ident" id="5917426">key</span><span class="op" id="5917429">]</span>&nbsp;<span class="op" id="5917431">=</span>&nbsp;<span class="ident" id="5917433">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917449">sort</span><span class="op" id="5917453">.</span><span class="ident" id="5917454">Sort</span><span class="op" id="5917458">(</span><span class="ident" id="5917459">byPathLength</span><span class="op" id="5917471">(</span><span class="ident" id="5917472">selected</span><span class="op" id="5917480">)</span><span class="op" id="5917481">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917484">for</span>&nbsp;<span class="ident" id="5917488">_</span><span class="op" id="5917489">,</span>&nbsp;<span class="ident" id="5917491">e</span>&nbsp;<span class="op" id="5917493">:=</span>&nbsp;<span class="keyword" id="5917496">range</span>&nbsp;<span class="ident" id="5917502">selected</span>&nbsp;<span class="op" id="5917511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917515">cookies</span>&nbsp;<span class="op" id="5917523">=</span>&nbsp;<span class="builtinfunc" id="5917525">append</span><span class="op" id="5917531">(</span><span class="ident" id="5917532">cookies</span><span class="op" id="5917539">,</span>&nbsp;<span class="op" id="5917541">&amp;</span><span class="ident" id="5917542">http</span><span class="op" id="5917546">.</span><span class="ident" id="5917547">Cookie</span><span class="op" id="5917553">{</span><span class="ident" id="5917554">Name</span><span class="op" id="5917558">:</span>&nbsp;<span class="ident" id="5917560">e</span><span class="op" id="5917561">.</span><span class="ident" id="5917562">Name</span><span class="op" id="5917566">,</span>&nbsp;<span class="ident" id="5917568">Value</span><span class="op" id="5917573">:</span>&nbsp;<span class="ident" id="5917575">e</span><span class="op" id="5917576">.</span><span class="ident" id="5917577">Value</span><span class="op" id="5917582">}</span><span class="op" id="5917583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5917586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5917590">return</span>&nbsp;<span class="ident" id="5917597">cookies</span><br>
<span class="lineno">230</span><span class="op" id="5917605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5917608">//&nbsp;SetCookies&nbsp;implements&nbsp;the&nbsp;SetCookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5917688">//</span><br>
<span class="lineno"></span><span class="comment" id="5917691">//&nbsp;It&nbsp;does&nbsp;nothing&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno">235</span><span class="keyword" id="5917752">func</span>&nbsp;<span class="op" id="5917757">(</span><span class="ident" id="5917758">j</span>&nbsp;<span class="op" id="5917760">*</span><span class="ident" id="5917761">Jar</span><span class="op" id="5917764">)</span>&nbsp;<span class="ident" id="5917766">SetCookies</span><span class="op" id="5917776">(</span><span class="ident" id="5917777">u</span>&nbsp;<span class="op" id="5917779">*</span><span class="ident" id="5917780">url</span><span class="op" id="5917783">.</span><span class="ident" id="5917784">URL</span><span class="op" id="5917787">,</span>&nbsp;<span class="ident" id="5917789">cookies</span>&nbsp;<span class="op" id="5917797">[</span><span class="op" id="5917798">]</span><span class="op" id="5917799">*</span><span class="ident" id="5917800">http</span><span class="op" id="5917804">.</span><span class="ident" id="5917805">Cookie</span><span class="op" id="5917811">)</span>&nbsp;<span class="op" id="5917813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5917816">j</span><span class="op" id="5917817">.</span><span class="ident" id="5917818">setCookies</span><span class="op" id="5917828">(</span><span class="ident" id="5917829">u</span><span class="op" id="5917830">,</span>&nbsp;<span class="ident" id="5917832">cookies</span><span class="op" id="5917839">,</span>&nbsp;<span class="ident" id="5917841">time</span><span class="op" id="5917845">.</span><span class="ident" id="5917846">Now</span><span class="op" id="5917849">(</span><span class="op" id="5917850">)</span><span class="op" id="5917851">)</span><br>
<span class="lineno"></span><span class="op" id="5917853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5917856">//&nbsp;setCookies&nbsp;is&nbsp;like&nbsp;SetCookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;parameter.</span><br>
<span class="lineno">240</span><span class="keyword" id="5917930">func</span>&nbsp;<span class="op" id="5917935">(</span><span class="ident" id="5917936">j</span>&nbsp;<span class="op" id="5917938">*</span><span class="ident" id="5917939">Jar</span><span class="op" id="5917942">)</span>&nbsp;<span class="ident" id="5917944">setCookies</span><span class="op" id="5917954">(</span><span class="ident" id="5917955">u</span>&nbsp;<span class="op" id="5917957">*</span><span class="ident" id="5917958">url</span><span class="op" id="5917961">.</span><span class="ident" id="5917962">URL</span><span class="op" id="5917965">,</span>&nbsp;<span class="ident" id="5917967">cookies</span>&nbsp;<span class="op" id="5917975">[</span><span class="op" id="5917976">]</span><span class="op" id="5917977">*</span><span class="ident" id="5917978">http</span><span class="op" id="5917982">.</span><span class="ident" id="5917983">Cookie</span><span class="op" id="5917989">,</span>&nbsp;<span class="ident" id="5917991">now</span>&nbsp;<span class="ident" id="5917995">time</span><span class="op" id="5917999">.</span><span class="ident" id="5918000">Time</span><span class="op" id="5918004">)</span>&nbsp;<span class="op" id="5918006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918009">if</span>&nbsp;<span class="builtinfunc" id="5918012">len</span><span class="op" id="5918015">(</span><span class="ident" id="5918016">cookies</span><span class="op" id="5918023">)</span>&nbsp;<span class="op" id="5918025">==</span>&nbsp;<span class="num" id="5918028">0</span>&nbsp;<span class="op" id="5918030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918034">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918045">if</span>&nbsp;<span class="ident" id="5918048">u</span><span class="op" id="5918049">.</span><span class="ident" id="5918050">Scheme</span>&nbsp;<span class="op" id="5918057">!=</span>&nbsp;<span class="string" id="5918060">&#34;http&#34;</span>&nbsp;<span class="op" id="5918067">&amp;&amp;</span>&nbsp;<span class="ident" id="5918070">u</span><span class="op" id="5918071">.</span><span class="ident" id="5918072">Scheme</span>&nbsp;<span class="op" id="5918079">!=</span>&nbsp;<span class="string" id="5918082">&#34;https&#34;</span>&nbsp;<span class="op" id="5918090">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918094">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918105">host</span><span class="op" id="5918109">,</span>&nbsp;<span class="ident" id="5918111">err</span>&nbsp;<span class="op" id="5918115">:=</span>&nbsp;<span class="ident" id="5918118">canonicalHost</span><span class="op" id="5918131">(</span><span class="ident" id="5918132">u</span><span class="op" id="5918133">.</span><span class="ident" id="5918134">Host</span><span class="op" id="5918138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918141">if</span>&nbsp;<span class="ident" id="5918144">err</span>&nbsp;<span class="op" id="5918148">!=</span>&nbsp;<span class="ident" id="5918151">nil</span>&nbsp;<span class="op" id="5918155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918159">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918170">key</span>&nbsp;<span class="op" id="5918174">:=</span>&nbsp;<span class="ident" id="5918177">jarKey</span><span class="op" id="5918183">(</span><span class="ident" id="5918184">host</span><span class="op" id="5918188">,</span>&nbsp;<span class="ident" id="5918190">j</span><span class="op" id="5918191">.</span><span class="ident" id="5918192">psList</span><span class="op" id="5918198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918201">defPath</span>&nbsp;<span class="op" id="5918209">:=</span>&nbsp;<span class="ident" id="5918212">defaultPath</span><span class="op" id="5918223">(</span><span class="ident" id="5918224">u</span><span class="op" id="5918225">.</span><span class="ident" id="5918226">Path</span><span class="op" id="5918230">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918234">j</span><span class="op" id="5918235">.</span><span class="ident" id="5918236">mu</span><span class="op" id="5918238">.</span><span class="ident" id="5918239">Lock</span><span class="op" id="5918243">(</span><span class="op" id="5918244">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918247">defer</span>&nbsp;<span class="ident" id="5918253">j</span><span class="op" id="5918254">.</span><span class="ident" id="5918255">mu</span><span class="op" id="5918257">.</span><span class="ident" id="5918258">Unlock</span><span class="op" id="5918264">(</span><span class="op" id="5918265">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918269">submap</span>&nbsp;<span class="op" id="5918276">:=</span>&nbsp;<span class="ident" id="5918279">j</span><span class="op" id="5918280">.</span><span class="ident" id="5918281">entries</span><span class="op" id="5918288">[</span><span class="ident" id="5918289">key</span><span class="op" id="5918292">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918296">modified</span>&nbsp;<span class="op" id="5918305">:=</span>&nbsp;<span class="builtintype" id="5918308">false</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918315">for</span>&nbsp;<span class="ident" id="5918319">_</span><span class="op" id="5918320">,</span>&nbsp;<span class="ident" id="5918322">cookie</span>&nbsp;<span class="op" id="5918329">:=</span>&nbsp;<span class="keyword" id="5918332">range</span>&nbsp;<span class="ident" id="5918338">cookies</span>&nbsp;<span class="op" id="5918346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918350">e</span><span class="op" id="5918351">,</span>&nbsp;<span class="ident" id="5918353">remove</span><span class="op" id="5918359">,</span>&nbsp;<span class="ident" id="5918361">err</span>&nbsp;<span class="op" id="5918365">:=</span>&nbsp;<span class="ident" id="5918368">j</span><span class="op" id="5918369">.</span><span class="ident" id="5918370">newEntry</span><span class="op" id="5918378">(</span><span class="ident" id="5918379">cookie</span><span class="op" id="5918385">,</span>&nbsp;<span class="ident" id="5918387">now</span><span class="op" id="5918390">,</span>&nbsp;<span class="ident" id="5918392">defPath</span><span class="op" id="5918399">,</span>&nbsp;<span class="ident" id="5918401">host</span><span class="op" id="5918405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918409">if</span>&nbsp;<span class="ident" id="5918412">err</span>&nbsp;<span class="op" id="5918416">!=</span>&nbsp;<span class="ident" id="5918419">nil</span>&nbsp;<span class="op" id="5918423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918428">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918439">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918443">id</span>&nbsp;<span class="op" id="5918446">:=</span>&nbsp;<span class="ident" id="5918449">e</span><span class="op" id="5918450">.</span><span class="ident" id="5918451">id</span><span class="op" id="5918453">(</span><span class="op" id="5918454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918458">if</span>&nbsp;<span class="ident" id="5918461">remove</span>&nbsp;<span class="op" id="5918468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918473">if</span>&nbsp;<span class="ident" id="5918476">submap</span>&nbsp;<span class="op" id="5918483">!=</span>&nbsp;<span class="ident" id="5918486">nil</span>&nbsp;<span class="op" id="5918490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918496">if</span>&nbsp;<span class="ident" id="5918499">_</span><span class="op" id="5918500">,</span>&nbsp;<span class="ident" id="5918502">ok</span>&nbsp;<span class="op" id="5918505">:=</span>&nbsp;<span class="ident" id="5918508">submap</span><span class="op" id="5918514">[</span><span class="ident" id="5918515">id</span><span class="op" id="5918517">]</span><span class="op" id="5918518">;</span>&nbsp;<span class="ident" id="5918520">ok</span>&nbsp;<span class="op" id="5918523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5918530">delete</span><span class="op" id="5918536">(</span><span class="ident" id="5918537">submap</span><span class="op" id="5918543">,</span>&nbsp;<span class="ident" id="5918545">id</span><span class="op" id="5918547">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918554">modified</span>&nbsp;<span class="op" id="5918563">=</span>&nbsp;<span class="builtintype" id="5918565">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918584">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918595">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918599">if</span>&nbsp;<span class="ident" id="5918602">submap</span>&nbsp;<span class="op" id="5918609">==</span>&nbsp;<span class="ident" id="5918612">nil</span>&nbsp;<span class="op" id="5918616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918621">submap</span>&nbsp;<span class="op" id="5918628">=</span>&nbsp;<span class="builtinfunc" id="5918630">make</span><span class="op" id="5918634">(</span><span class="keyword" id="5918635">map</span><span class="op" id="5918638">[</span><span class="builtintype" id="5918639">string</span><span class="op" id="5918645">]</span><span class="ident" id="5918646">entry</span><span class="op" id="5918651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918660">if</span>&nbsp;<span class="ident" id="5918663">old</span><span class="op" id="5918666">,</span>&nbsp;<span class="ident" id="5918668">ok</span>&nbsp;<span class="op" id="5918671">:=</span>&nbsp;<span class="ident" id="5918674">submap</span><span class="op" id="5918680">[</span><span class="ident" id="5918681">id</span><span class="op" id="5918683">]</span><span class="op" id="5918684">;</span>&nbsp;<span class="ident" id="5918686">ok</span>&nbsp;<span class="op" id="5918689">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918694">e</span><span class="op" id="5918695">.</span><span class="ident" id="5918696">Creation</span>&nbsp;<span class="op" id="5918705">=</span>&nbsp;<span class="ident" id="5918707">old</span><span class="op" id="5918710">.</span><span class="ident" id="5918711">Creation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918723">e</span><span class="op" id="5918724">.</span><span class="ident" id="5918725">seqNum</span>&nbsp;<span class="op" id="5918732">=</span>&nbsp;<span class="ident" id="5918734">old</span><span class="op" id="5918737">.</span><span class="ident" id="5918738">seqNum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918747">}</span>&nbsp;<span class="keyword" id="5918749">else</span>&nbsp;<span class="op" id="5918754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918759">e</span><span class="op" id="5918760">.</span><span class="ident" id="5918761">Creation</span>&nbsp;<span class="op" id="5918770">=</span>&nbsp;<span class="ident" id="5918772">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918779">e</span><span class="op" id="5918780">.</span><span class="ident" id="5918781">seqNum</span>&nbsp;<span class="op" id="5918788">=</span>&nbsp;<span class="ident" id="5918790">j</span><span class="op" id="5918791">.</span><span class="ident" id="5918792">nextSeqNum</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918806">j</span><span class="op" id="5918807">.</span><span class="ident" id="5918808">nextSeqNum</span><span class="op" id="5918818">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918827">e</span><span class="op" id="5918828">.</span><span class="ident" id="5918829">LastAccess</span>&nbsp;<span class="op" id="5918840">=</span>&nbsp;<span class="ident" id="5918842">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918848">submap</span><span class="op" id="5918854">[</span><span class="ident" id="5918855">id</span><span class="op" id="5918857">]</span>&nbsp;<span class="op" id="5918859">=</span>&nbsp;<span class="ident" id="5918861">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918865">modified</span>&nbsp;<span class="op" id="5918874">=</span>&nbsp;<span class="builtintype" id="5918876">true</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918886">if</span>&nbsp;<span class="ident" id="5918889">modified</span>&nbsp;<span class="op" id="5918898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5918902">if</span>&nbsp;<span class="builtinfunc" id="5918905">len</span><span class="op" id="5918908">(</span><span class="ident" id="5918909">submap</span><span class="op" id="5918915">)</span>&nbsp;<span class="op" id="5918917">==</span>&nbsp;<span class="num" id="5918920">0</span>&nbsp;<span class="op" id="5918922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5918927">delete</span><span class="op" id="5918933">(</span><span class="ident" id="5918934">j</span><span class="op" id="5918935">.</span><span class="ident" id="5918936">entries</span><span class="op" id="5918943">,</span>&nbsp;<span class="ident" id="5918945">key</span><span class="op" id="5918948">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918952">}</span>&nbsp;<span class="keyword" id="5918954">else</span>&nbsp;<span class="op" id="5918959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5918964">j</span><span class="op" id="5918965">.</span><span class="ident" id="5918966">entries</span><span class="op" id="5918973">[</span><span class="ident" id="5918974">key</span><span class="op" id="5918977">]</span>&nbsp;<span class="op" id="5918979">=</span>&nbsp;<span class="ident" id="5918981">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5918993">}</span><br>
<span class="lineno"></span><span class="op" id="5918995">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="5918998">//&nbsp;canonicalHost&nbsp;strips&nbsp;port&nbsp;from&nbsp;host&nbsp;if&nbsp;present&nbsp;and&nbsp;returns&nbsp;the&nbsp;canonicalized</span><br>
<span class="lineno"></span><span class="comment" id="5919078">//&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="5919092">func</span>&nbsp;<span class="ident" id="5919097">canonicalHost</span><span class="op" id="5919110">(</span><span class="ident" id="5919111">host</span>&nbsp;<span class="builtintype" id="5919116">string</span><span class="op" id="5919122">)</span>&nbsp;<span class="op" id="5919124">(</span><span class="builtintype" id="5919125">string</span><span class="op" id="5919131">,</span>&nbsp;<span class="builtintype" id="5919133">error</span><span class="op" id="5919138">)</span>&nbsp;<span class="op" id="5919140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919143">var</span>&nbsp;<span class="ident" id="5919147">err</span>&nbsp;<span class="builtintype" id="5919151">error</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919158">host</span>&nbsp;<span class="op" id="5919163">=</span>&nbsp;<span class="ident" id="5919165">strings</span><span class="op" id="5919172">.</span><span class="ident" id="5919173">ToLower</span><span class="op" id="5919180">(</span><span class="ident" id="5919181">host</span><span class="op" id="5919185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919188">if</span>&nbsp;<span class="ident" id="5919191">hasPort</span><span class="op" id="5919198">(</span><span class="ident" id="5919199">host</span><span class="op" id="5919203">)</span>&nbsp;<span class="op" id="5919205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919209">host</span><span class="op" id="5919213">,</span>&nbsp;<span class="ident" id="5919215">_</span><span class="op" id="5919216">,</span>&nbsp;<span class="ident" id="5919218">err</span>&nbsp;<span class="op" id="5919222">=</span>&nbsp;<span class="ident" id="5919224">net</span><span class="op" id="5919227">.</span><span class="ident" id="5919228">SplitHostPort</span><span class="op" id="5919241">(</span><span class="ident" id="5919242">host</span><span class="op" id="5919246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919250">if</span>&nbsp;<span class="ident" id="5919253">err</span>&nbsp;<span class="op" id="5919257">!=</span>&nbsp;<span class="ident" id="5919260">nil</span>&nbsp;<span class="op" id="5919264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919269">return</span>&nbsp;<span class="string" id="5919276">&#34;&#34;</span><span class="op" id="5919278">,</span>&nbsp;<span class="ident" id="5919280">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5919286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5919289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919292">if</span>&nbsp;<span class="ident" id="5919295">strings</span><span class="op" id="5919302">.</span><span class="ident" id="5919303">HasSuffix</span><span class="op" id="5919312">(</span><span class="ident" id="5919313">host</span><span class="op" id="5919317">,</span>&nbsp;<span class="string" id="5919319">&#34;.&#34;</span><span class="op" id="5919322">)</span>&nbsp;<span class="op" id="5919324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5919328">//&nbsp;Strip&nbsp;trailing&nbsp;dot&nbsp;from&nbsp;fully&nbsp;qualified&nbsp;domain&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919387">host</span>&nbsp;<span class="op" id="5919392">=</span>&nbsp;<span class="ident" id="5919394">host</span><span class="op" id="5919398">[</span><span class="op" id="5919399">:</span><span class="builtinfunc" id="5919400">len</span><span class="op" id="5919403">(</span><span class="ident" id="5919404">host</span><span class="op" id="5919408">)</span><span class="op" id="5919409">-</span><span class="num" id="5919410">1</span><span class="op" id="5919411">]</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5919414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919417">return</span>&nbsp;<span class="ident" id="5919424">toASCII</span><span class="op" id="5919431">(</span><span class="ident" id="5919432">host</span><span class="op" id="5919436">)</span><br>
<span class="lineno"></span><span class="op" id="5919438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5919441">//&nbsp;hasPort&nbsp;reports&nbsp;whether&nbsp;host&nbsp;contains&nbsp;a&nbsp;port&nbsp;number.&nbsp;host&nbsp;may&nbsp;be&nbsp;a&nbsp;host</span><br>
<span class="lineno">320</span><span class="comment" id="5919516">//&nbsp;name,&nbsp;an&nbsp;IPv4&nbsp;or&nbsp;an&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5919553">func</span>&nbsp;<span class="ident" id="5919558">hasPort</span><span class="op" id="5919565">(</span><span class="ident" id="5919566">host</span>&nbsp;<span class="builtintype" id="5919571">string</span><span class="op" id="5919577">)</span>&nbsp;<span class="builtintype" id="5919579">bool</span>&nbsp;<span class="op" id="5919584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919587">colons</span>&nbsp;<span class="op" id="5919594">:=</span>&nbsp;<span class="ident" id="5919597">strings</span><span class="op" id="5919604">.</span><span class="ident" id="5919605">Count</span><span class="op" id="5919610">(</span><span class="ident" id="5919611">host</span><span class="op" id="5919615">,</span>&nbsp;<span class="string" id="5919617">&#34;:&#34;</span><span class="op" id="5919620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919623">if</span>&nbsp;<span class="ident" id="5919626">colons</span>&nbsp;<span class="op" id="5919633">==</span>&nbsp;<span class="num" id="5919636">0</span>&nbsp;<span class="op" id="5919638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919642">return</span>&nbsp;<span class="builtintype" id="5919649">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5919656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919659">if</span>&nbsp;<span class="ident" id="5919662">colons</span>&nbsp;<span class="op" id="5919669">==</span>&nbsp;<span class="num" id="5919672">1</span>&nbsp;<span class="op" id="5919674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919678">return</span>&nbsp;<span class="builtintype" id="5919685">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5919691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919694">return</span>&nbsp;<span class="ident" id="5919701">host</span><span class="op" id="5919705">[</span><span class="num" id="5919706">0</span><span class="op" id="5919707">]</span>&nbsp;<span class="op" id="5919709">==</span>&nbsp;<span class="string" id="5919712">&#39;[&#39;</span>&nbsp;<span class="op" id="5919716">&amp;&amp;</span>&nbsp;<span class="ident" id="5919719">strings</span><span class="op" id="5919726">.</span><span class="ident" id="5919727">Contains</span><span class="op" id="5919735">(</span><span class="ident" id="5919736">host</span><span class="op" id="5919740">,</span>&nbsp;<span class="string" id="5919742">&#34;]:&#34;</span><span class="op" id="5919746">)</span><br>
<span class="lineno">330</span><span class="op" id="5919748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5919751">//&nbsp;jarKey&nbsp;returns&nbsp;the&nbsp;key&nbsp;to&nbsp;use&nbsp;for&nbsp;a&nbsp;jar.</span><br>
<span class="lineno"></span><span class="keyword" id="5919795">func</span>&nbsp;<span class="ident" id="5919800">jarKey</span><span class="op" id="5919806">(</span><span class="ident" id="5919807">host</span>&nbsp;<span class="builtintype" id="5919812">string</span><span class="op" id="5919818">,</span>&nbsp;<span class="ident" id="5919820">psl</span>&nbsp;<span class="ident" id="5919824">PublicSuffixList</span><span class="op" id="5919840">)</span>&nbsp;<span class="builtintype" id="5919842">string</span>&nbsp;<span class="op" id="5919849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919852">if</span>&nbsp;<span class="ident" id="5919855">isIP</span><span class="op" id="5919859">(</span><span class="ident" id="5919860">host</span><span class="op" id="5919864">)</span>&nbsp;<span class="op" id="5919866">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919870">return</span>&nbsp;<span class="ident" id="5919877">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5919883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919887">var</span>&nbsp;<span class="ident" id="5919891">i</span>&nbsp;<span class="builtintype" id="5919893">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919898">if</span>&nbsp;<span class="ident" id="5919901">psl</span>&nbsp;<span class="op" id="5919905">==</span>&nbsp;<span class="ident" id="5919908">nil</span>&nbsp;<span class="op" id="5919912">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919916">i</span>&nbsp;<span class="op" id="5919918">=</span>&nbsp;<span class="ident" id="5919920">strings</span><span class="op" id="5919927">.</span><span class="ident" id="5919928">LastIndex</span><span class="op" id="5919937">(</span><span class="ident" id="5919938">host</span><span class="op" id="5919942">,</span>&nbsp;<span class="string" id="5919944">&#34;.&#34;</span><span class="op" id="5919947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919951">if</span>&nbsp;<span class="ident" id="5919954">i</span>&nbsp;<span class="op" id="5919956">==</span>&nbsp;<span class="op" id="5919959">-</span><span class="num" id="5919960">1</span>&nbsp;<span class="op" id="5919962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5919967">return</span>&nbsp;<span class="ident" id="5919974">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5919981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5919984">}</span>&nbsp;<span class="keyword" id="5919986">else</span>&nbsp;<span class="op" id="5919991">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5919995">suffix</span>&nbsp;<span class="op" id="5920002">:=</span>&nbsp;<span class="ident" id="5920005">psl</span><span class="op" id="5920008">.</span><span class="ident" id="5920009">PublicSuffix</span><span class="op" id="5920021">(</span><span class="ident" id="5920022">host</span><span class="op" id="5920026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920030">if</span>&nbsp;<span class="ident" id="5920033">suffix</span>&nbsp;<span class="op" id="5920040">==</span>&nbsp;<span class="ident" id="5920043">host</span>&nbsp;<span class="op" id="5920048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920053">return</span>&nbsp;<span class="ident" id="5920060">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5920067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5920071">i</span>&nbsp;<span class="op" id="5920073">=</span>&nbsp;<span class="builtinfunc" id="5920075">len</span><span class="op" id="5920078">(</span><span class="ident" id="5920079">host</span><span class="op" id="5920083">)</span>&nbsp;<span class="op" id="5920085">-</span>&nbsp;<span class="builtinfunc" id="5920087">len</span><span class="op" id="5920090">(</span><span class="ident" id="5920091">suffix</span><span class="op" id="5920097">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920101">if</span>&nbsp;<span class="ident" id="5920104">i</span>&nbsp;<span class="op" id="5920106">&lt;=</span>&nbsp;<span class="num" id="5920109">0</span>&nbsp;<span class="op" id="5920111">||</span>&nbsp;<span class="ident" id="5920114">host</span><span class="op" id="5920118">[</span><span class="ident" id="5920119">i</span><span class="op" id="5920120">-</span><span class="num" id="5920121">1</span><span class="op" id="5920122">]</span>&nbsp;<span class="op" id="5920124">!=</span>&nbsp;<span class="string" id="5920127">&#39;.&#39;</span>&nbsp;<span class="op" id="5920131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5920136">//&nbsp;The&nbsp;provided&nbsp;public&nbsp;suffix&nbsp;list&nbsp;psl&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5920189">//&nbsp;Storing&nbsp;cookies&nbsp;under&nbsp;host&nbsp;is&nbsp;a&nbsp;safe&nbsp;stopgap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920241">return</span>&nbsp;<span class="ident" id="5920248">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5920255">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5920258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5920261">prevDot</span>&nbsp;<span class="op" id="5920269">:=</span>&nbsp;<span class="ident" id="5920272">strings</span><span class="op" id="5920279">.</span><span class="ident" id="5920280">LastIndex</span><span class="op" id="5920289">(</span><span class="ident" id="5920290">host</span><span class="op" id="5920294">[</span><span class="op" id="5920295">:</span><span class="ident" id="5920296">i</span><span class="op" id="5920297">-</span><span class="num" id="5920298">1</span><span class="op" id="5920299">]</span><span class="op" id="5920300">,</span>&nbsp;<span class="string" id="5920302">&#34;.&#34;</span><span class="op" id="5920305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920308">return</span>&nbsp;<span class="ident" id="5920315">host</span><span class="op" id="5920319">[</span><span class="ident" id="5920320">prevDot</span><span class="op" id="5920327">+</span><span class="num" id="5920328">1</span><span class="op" id="5920329">:</span><span class="op" id="5920330">]</span><br>
<span class="lineno"></span><span class="op" id="5920332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="comment" id="5920335">//&nbsp;isIP&nbsp;reports&nbsp;whether&nbsp;host&nbsp;is&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5920382">func</span>&nbsp;<span class="ident" id="5920387">isIP</span><span class="op" id="5920391">(</span><span class="ident" id="5920392">host</span>&nbsp;<span class="builtintype" id="5920397">string</span><span class="op" id="5920403">)</span>&nbsp;<span class="builtintype" id="5920405">bool</span>&nbsp;<span class="op" id="5920410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920413">return</span>&nbsp;<span class="ident" id="5920420">net</span><span class="op" id="5920423">.</span><span class="ident" id="5920424">ParseIP</span><span class="op" id="5920431">(</span><span class="ident" id="5920432">host</span><span class="op" id="5920436">)</span>&nbsp;<span class="op" id="5920438">!=</span>&nbsp;<span class="ident" id="5920441">nil</span><br>
<span class="lineno"></span><span class="op" id="5920445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="5920448">//&nbsp;defaultPath&nbsp;returns&nbsp;the&nbsp;directory&nbsp;part&nbsp;of&nbsp;an&nbsp;URL&#39;s&nbsp;path&nbsp;according&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5920520">//&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="5920547">func</span>&nbsp;<span class="ident" id="5920552">defaultPath</span><span class="op" id="5920563">(</span><span class="ident" id="5920564">path</span>&nbsp;<span class="builtintype" id="5920569">string</span><span class="op" id="5920575">)</span>&nbsp;<span class="builtintype" id="5920577">string</span>&nbsp;<span class="op" id="5920584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920587">if</span>&nbsp;<span class="builtinfunc" id="5920590">len</span><span class="op" id="5920593">(</span><span class="ident" id="5920594">path</span><span class="op" id="5920598">)</span>&nbsp;<span class="op" id="5920600">==</span>&nbsp;<span class="num" id="5920603">0</span>&nbsp;<span class="op" id="5920605">||</span>&nbsp;<span class="ident" id="5920608">path</span><span class="op" id="5920612">[</span><span class="num" id="5920613">0</span><span class="op" id="5920614">]</span>&nbsp;<span class="op" id="5920616">!=</span>&nbsp;<span class="string" id="5920619">&#39;/&#39;</span>&nbsp;<span class="op" id="5920623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920627">return</span>&nbsp;<span class="string" id="5920634">&#34;/&#34;</span>&nbsp;<span class="comment" id="5920638">//&nbsp;Path&nbsp;is&nbsp;empty&nbsp;or&nbsp;malformed.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5920670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5920674">i</span>&nbsp;<span class="op" id="5920676">:=</span>&nbsp;<span class="ident" id="5920679">strings</span><span class="op" id="5920686">.</span><span class="ident" id="5920687">LastIndex</span><span class="op" id="5920696">(</span><span class="ident" id="5920697">path</span><span class="op" id="5920701">,</span>&nbsp;<span class="string" id="5920703">&#34;/&#34;</span><span class="op" id="5920706">)</span>&nbsp;<span class="comment" id="5920708">//&nbsp;Path&nbsp;starts&nbsp;with&nbsp;&#34;/&#34;,&nbsp;so&nbsp;i&nbsp;!=&nbsp;-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920746">if</span>&nbsp;<span class="ident" id="5920749">i</span>&nbsp;<span class="op" id="5920751">==</span>&nbsp;<span class="num" id="5920754">0</span>&nbsp;<span class="op" id="5920756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920760">return</span>&nbsp;<span class="string" id="5920767">&#34;/&#34;</span>&nbsp;<span class="comment" id="5920771">//&nbsp;Path&nbsp;has&nbsp;the&nbsp;form&nbsp;&#34;/abc&#34;.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5920801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5920804">return</span>&nbsp;<span class="ident" id="5920811">path</span><span class="op" id="5920815">[</span><span class="op" id="5920816">:</span><span class="ident" id="5920817">i</span><span class="op" id="5920818">]</span>&nbsp;<span class="comment" id="5920820">//&nbsp;Path&nbsp;is&nbsp;either&nbsp;of&nbsp;form&nbsp;&#34;/abc/xyz&#34;&nbsp;or&nbsp;&#34;/abc/xyz/&#34;.</span><br>
<span class="lineno"></span><span class="op" id="5920873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5920876">//&nbsp;newEntry&nbsp;creates&nbsp;an&nbsp;entry&nbsp;from&nbsp;a&nbsp;http.Cookie&nbsp;c.&nbsp;now&nbsp;is&nbsp;the&nbsp;current&nbsp;time&nbsp;and</span><br>
<span class="lineno">380</span><span class="comment" id="5920955">//&nbsp;is&nbsp;compared&nbsp;to&nbsp;c.Expires&nbsp;to&nbsp;determine&nbsp;deletion&nbsp;of&nbsp;c.&nbsp;defPath&nbsp;and&nbsp;host&nbsp;are&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5921036">//&nbsp;default-path&nbsp;and&nbsp;the&nbsp;canonical&nbsp;host&nbsp;name&nbsp;of&nbsp;the&nbsp;URL&nbsp;c&nbsp;was&nbsp;received&nbsp;from.</span><br>
<span class="lineno"></span><span class="comment" id="5921112">//</span><br>
<span class="lineno"></span><span class="comment" id="5921115">//&nbsp;remove&nbsp;records&nbsp;whether&nbsp;the&nbsp;jar&nbsp;should&nbsp;delete&nbsp;this&nbsp;cookie,&nbsp;as&nbsp;it&nbsp;has&nbsp;already</span><br>
<span class="lineno"></span><span class="comment" id="5921194">//&nbsp;expired&nbsp;with&nbsp;respect&nbsp;to&nbsp;now.&nbsp;In&nbsp;this&nbsp;case,&nbsp;e&nbsp;may&nbsp;be&nbsp;incomplete,&nbsp;but&nbsp;it&nbsp;will</span><br>
<span class="lineno">385</span><span class="comment" id="5921273">//&nbsp;be&nbsp;valid&nbsp;to&nbsp;call&nbsp;e.id&nbsp;(which&nbsp;depends&nbsp;on&nbsp;e&#39;s&nbsp;Name,&nbsp;Domain&nbsp;and&nbsp;Path).</span><br>
<span class="lineno"></span><span class="comment" id="5921344">//</span><br>
<span class="lineno"></span><span class="comment" id="5921347">//&nbsp;A&nbsp;malformed&nbsp;c.Domain&nbsp;will&nbsp;result&nbsp;in&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="5921396">func</span>&nbsp;<span class="op" id="5921401">(</span><span class="ident" id="5921402">j</span>&nbsp;<span class="op" id="5921404">*</span><span class="ident" id="5921405">Jar</span><span class="op" id="5921408">)</span>&nbsp;<span class="ident" id="5921410">newEntry</span><span class="op" id="5921418">(</span><span class="ident" id="5921419">c</span>&nbsp;<span class="op" id="5921421">*</span><span class="ident" id="5921422">http</span><span class="op" id="5921426">.</span><span class="ident" id="5921427">Cookie</span><span class="op" id="5921433">,</span>&nbsp;<span class="ident" id="5921435">now</span>&nbsp;<span class="ident" id="5921439">time</span><span class="op" id="5921443">.</span><span class="ident" id="5921444">Time</span><span class="op" id="5921448">,</span>&nbsp;<span class="ident" id="5921450">defPath</span><span class="op" id="5921457">,</span>&nbsp;<span class="ident" id="5921459">host</span>&nbsp;<span class="builtintype" id="5921464">string</span><span class="op" id="5921470">)</span>&nbsp;<span class="op" id="5921472">(</span><span class="ident" id="5921473">e</span>&nbsp;<span class="ident" id="5921475">entry</span><span class="op" id="5921480">,</span>&nbsp;<span class="ident" id="5921482">remove</span>&nbsp;<span class="builtintype" id="5921489">bool</span><span class="op" id="5921493">,</span>&nbsp;<span class="ident" id="5921495">err</span>&nbsp;<span class="builtintype" id="5921499">error</span><span class="op" id="5921504">)</span>&nbsp;<span class="op" id="5921506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921509">e</span><span class="op" id="5921510">.</span><span class="ident" id="5921511">Name</span>&nbsp;<span class="op" id="5921516">=</span>&nbsp;<span class="ident" id="5921518">c</span><span class="op" id="5921519">.</span><span class="ident" id="5921520">Name</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5921527">if</span>&nbsp;<span class="ident" id="5921530">c</span><span class="op" id="5921531">.</span><span class="ident" id="5921532">Path</span>&nbsp;<span class="op" id="5921537">==</span>&nbsp;<span class="string" id="5921540">&#34;&#34;</span>&nbsp;<span class="op" id="5921543">||</span>&nbsp;<span class="ident" id="5921546">c</span><span class="op" id="5921547">.</span><span class="ident" id="5921548">Path</span><span class="op" id="5921552">[</span><span class="num" id="5921553">0</span><span class="op" id="5921554">]</span>&nbsp;<span class="op" id="5921556">!=</span>&nbsp;<span class="string" id="5921559">&#39;/&#39;</span>&nbsp;<span class="op" id="5921563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921567">e</span><span class="op" id="5921568">.</span><span class="ident" id="5921569">Path</span>&nbsp;<span class="op" id="5921574">=</span>&nbsp;<span class="ident" id="5921576">defPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5921585">}</span>&nbsp;<span class="keyword" id="5921587">else</span>&nbsp;<span class="op" id="5921592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921596">e</span><span class="op" id="5921597">.</span><span class="ident" id="5921598">Path</span>&nbsp;<span class="op" id="5921603">=</span>&nbsp;<span class="ident" id="5921605">c</span><span class="op" id="5921606">.</span><span class="ident" id="5921607">Path</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5921613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921617">e</span><span class="op" id="5921618">.</span><span class="ident" id="5921619">Domain</span><span class="op" id="5921625">,</span>&nbsp;<span class="ident" id="5921627">e</span><span class="op" id="5921628">.</span><span class="ident" id="5921629">HostOnly</span><span class="op" id="5921637">,</span>&nbsp;<span class="ident" id="5921639">err</span>&nbsp;<span class="op" id="5921643">=</span>&nbsp;<span class="ident" id="5921645">j</span><span class="op" id="5921646">.</span><span class="ident" id="5921647">domainAndType</span><span class="op" id="5921660">(</span><span class="ident" id="5921661">host</span><span class="op" id="5921665">,</span>&nbsp;<span class="ident" id="5921667">c</span><span class="op" id="5921668">.</span><span class="ident" id="5921669">Domain</span><span class="op" id="5921675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5921678">if</span>&nbsp;<span class="ident" id="5921681">err</span>&nbsp;<span class="op" id="5921685">!=</span>&nbsp;<span class="ident" id="5921688">nil</span>&nbsp;<span class="op" id="5921692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5921696">return</span>&nbsp;<span class="ident" id="5921703">e</span><span class="op" id="5921704">,</span>&nbsp;<span class="builtintype" id="5921706">false</span><span class="op" id="5921711">,</span>&nbsp;<span class="ident" id="5921713">err</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5921718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5921722">//&nbsp;MaxAge&nbsp;takes&nbsp;precedence&nbsp;over&nbsp;Expires.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5921764">if</span>&nbsp;<span class="ident" id="5921767">c</span><span class="op" id="5921768">.</span><span class="ident" id="5921769">MaxAge</span>&nbsp;<span class="op" id="5921776">&lt;</span>&nbsp;<span class="num" id="5921778">0</span>&nbsp;<span class="op" id="5921780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5921784">return</span>&nbsp;<span class="ident" id="5921791">e</span><span class="op" id="5921792">,</span>&nbsp;<span class="builtintype" id="5921794">true</span><span class="op" id="5921798">,</span>&nbsp;<span class="ident" id="5921800">nil</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5921805">}</span>&nbsp;<span class="keyword" id="5921807">else</span>&nbsp;<span class="keyword" id="5921812">if</span>&nbsp;<span class="ident" id="5921815">c</span><span class="op" id="5921816">.</span><span class="ident" id="5921817">MaxAge</span>&nbsp;<span class="op" id="5921824">&gt;</span>&nbsp;<span class="num" id="5921826">0</span>&nbsp;<span class="op" id="5921828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921832">e</span><span class="op" id="5921833">.</span><span class="ident" id="5921834">Expires</span>&nbsp;<span class="op" id="5921842">=</span>&nbsp;<span class="ident" id="5921844">now</span><span class="op" id="5921847">.</span><span class="ident" id="5921848">Add</span><span class="op" id="5921851">(</span><span class="ident" id="5921852">time</span><span class="op" id="5921856">.</span><span class="ident" id="5921857">Duration</span><span class="op" id="5921865">(</span><span class="ident" id="5921866">c</span><span class="op" id="5921867">.</span><span class="ident" id="5921868">MaxAge</span><span class="op" id="5921874">)</span>&nbsp;<span class="op" id="5921876">*</span>&nbsp;<span class="ident" id="5921878">time</span><span class="op" id="5921882">.</span><span class="ident" id="5921883">Second</span><span class="op" id="5921889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921893">e</span><span class="op" id="5921894">.</span><span class="ident" id="5921895">Persistent</span>&nbsp;<span class="op" id="5921906">=</span>&nbsp;<span class="builtintype" id="5921908">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5921914">}</span>&nbsp;<span class="keyword" id="5921916">else</span>&nbsp;<span class="op" id="5921921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5921925">if</span>&nbsp;<span class="ident" id="5921928">c</span><span class="op" id="5921929">.</span><span class="ident" id="5921930">Expires</span><span class="op" id="5921937">.</span><span class="ident" id="5921938">IsZero</span><span class="op" id="5921944">(</span><span class="op" id="5921945">)</span>&nbsp;<span class="op" id="5921947">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921952">e</span><span class="op" id="5921953">.</span><span class="ident" id="5921954">Expires</span>&nbsp;<span class="op" id="5921962">=</span>&nbsp;<span class="ident" id="5921964">endOfTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5921977">e</span><span class="op" id="5921978">.</span><span class="ident" id="5921979">Persistent</span>&nbsp;<span class="op" id="5921990">=</span>&nbsp;<span class="builtintype" id="5921992">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5922000">}</span>&nbsp;<span class="keyword" id="5922002">else</span>&nbsp;<span class="op" id="5922007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5922012">if</span>&nbsp;<span class="op" id="5922015">!</span><span class="ident" id="5922016">c</span><span class="op" id="5922017">.</span><span class="ident" id="5922018">Expires</span><span class="op" id="5922025">.</span><span class="ident" id="5922026">After</span><span class="op" id="5922031">(</span><span class="ident" id="5922032">now</span><span class="op" id="5922035">)</span>&nbsp;<span class="op" id="5922037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5922043">return</span>&nbsp;<span class="ident" id="5922050">e</span><span class="op" id="5922051">,</span>&nbsp;<span class="builtintype" id="5922053">true</span><span class="op" id="5922057">,</span>&nbsp;<span class="ident" id="5922059">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5922066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922071">e</span><span class="op" id="5922072">.</span><span class="ident" id="5922073">Expires</span>&nbsp;<span class="op" id="5922081">=</span>&nbsp;<span class="ident" id="5922083">c</span><span class="op" id="5922084">.</span><span class="ident" id="5922085">Expires</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922096">e</span><span class="op" id="5922097">.</span><span class="ident" id="5922098">Persistent</span>&nbsp;<span class="op" id="5922109">=</span>&nbsp;<span class="builtintype" id="5922111">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5922118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5922121">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922125">e</span><span class="op" id="5922126">.</span><span class="ident" id="5922127">Value</span>&nbsp;<span class="op" id="5922133">=</span>&nbsp;<span class="ident" id="5922135">c</span><span class="op" id="5922136">.</span><span class="ident" id="5922137">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922144">e</span><span class="op" id="5922145">.</span><span class="ident" id="5922146">Secure</span>&nbsp;<span class="op" id="5922153">=</span>&nbsp;<span class="ident" id="5922155">c</span><span class="op" id="5922156">.</span><span class="ident" id="5922157">Secure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922165">e</span><span class="op" id="5922166">.</span><span class="ident" id="5922167">HttpOnly</span>&nbsp;<span class="op" id="5922176">=</span>&nbsp;<span class="ident" id="5922178">c</span><span class="op" id="5922179">.</span><span class="ident" id="5922180">HttpOnly</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5922191">return</span>&nbsp;<span class="ident" id="5922198">e</span><span class="op" id="5922199">,</span>&nbsp;<span class="builtintype" id="5922201">false</span><span class="op" id="5922206">,</span>&nbsp;<span class="ident" id="5922208">nil</span><br>
<span class="lineno"></span><span class="op" id="5922212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5922215">var</span>&nbsp;<span class="op" id="5922219">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922222">errIllegalDomain</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5922241">=</span>&nbsp;<span class="ident" id="5922243">errors</span><span class="op" id="5922249">.</span><span class="ident" id="5922250">New</span><span class="op" id="5922253">(</span><span class="string" id="5922254">&#34;cookiejar:&nbsp;illegal&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="5922298">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922301">errMalformedDomain</span>&nbsp;<span class="op" id="5922320">=</span>&nbsp;<span class="ident" id="5922322">errors</span><span class="op" id="5922328">.</span><span class="ident" id="5922329">New</span><span class="op" id="5922332">(</span><span class="string" id="5922333">&#34;cookiejar:&nbsp;malformed&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="5922379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922382">errNoHostname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5922401">=</span>&nbsp;<span class="ident" id="5922403">errors</span><span class="op" id="5922409">.</span><span class="ident" id="5922410">New</span><span class="op" id="5922413">(</span><span class="string" id="5922414">&#34;cookiejar:&nbsp;no&nbsp;host&nbsp;name&nbsp;available&nbsp;(IP&nbsp;only)&#34;</span><span class="op" id="5922459">)</span><br>
<span class="lineno"></span><span class="op" id="5922461">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5922464">//&nbsp;endOfTime&nbsp;is&nbsp;the&nbsp;time&nbsp;when&nbsp;session&nbsp;(non-persistent)&nbsp;cookies&nbsp;expire.</span><br>
<span class="lineno">435</span><span class="comment" id="5922535">//&nbsp;This&nbsp;instant&nbsp;is&nbsp;representable&nbsp;in&nbsp;most&nbsp;date/time&nbsp;formats&nbsp;(not&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="5922604">//&nbsp;Go&#39;s&nbsp;time.Time)&nbsp;and&nbsp;should&nbsp;be&nbsp;far&nbsp;enough&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="5922663">var</span>&nbsp;<span class="ident" id="5922667">endOfTime</span>&nbsp;<span class="op" id="5922677">=</span>&nbsp;<span class="ident" id="5922679">time</span><span class="op" id="5922683">.</span><span class="ident" id="5922684">Date</span><span class="op" id="5922688">(</span><span class="num" id="5922689">9999</span><span class="op" id="5922693">,</span>&nbsp;<span class="num" id="5922695">12</span><span class="op" id="5922697">,</span>&nbsp;<span class="num" id="5922699">31</span><span class="op" id="5922701">,</span>&nbsp;<span class="num" id="5922703">23</span><span class="op" id="5922705">,</span>&nbsp;<span class="num" id="5922707">59</span><span class="op" id="5922709">,</span>&nbsp;<span class="num" id="5922711">59</span><span class="op" id="5922713">,</span>&nbsp;<span class="num" id="5922715">0</span><span class="op" id="5922716">,</span>&nbsp;<span class="ident" id="5922718">time</span><span class="op" id="5922722">.</span><span class="ident" id="5922723">UTC</span><span class="op" id="5922726">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5922729">//&nbsp;domainAndType&nbsp;determines&nbsp;the&nbsp;cookie&#39;s&nbsp;domain&nbsp;and&nbsp;hostOnly&nbsp;attribute.</span><br>
<span class="lineno">440</span><span class="keyword" id="5922801">func</span>&nbsp;<span class="op" id="5922806">(</span><span class="ident" id="5922807">j</span>&nbsp;<span class="op" id="5922809">*</span><span class="ident" id="5922810">Jar</span><span class="op" id="5922813">)</span>&nbsp;<span class="ident" id="5922815">domainAndType</span><span class="op" id="5922828">(</span><span class="ident" id="5922829">host</span><span class="op" id="5922833">,</span>&nbsp;<span class="ident" id="5922835">domain</span>&nbsp;<span class="builtintype" id="5922842">string</span><span class="op" id="5922848">)</span>&nbsp;<span class="op" id="5922850">(</span><span class="builtintype" id="5922851">string</span><span class="op" id="5922857">,</span>&nbsp;<span class="builtintype" id="5922859">bool</span><span class="op" id="5922863">,</span>&nbsp;<span class="builtintype" id="5922865">error</span><span class="op" id="5922870">)</span>&nbsp;<span class="op" id="5922872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5922875">if</span>&nbsp;<span class="ident" id="5922878">domain</span>&nbsp;<span class="op" id="5922885">==</span>&nbsp;<span class="string" id="5922888">&#34;&#34;</span>&nbsp;<span class="op" id="5922891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922895">//&nbsp;No&nbsp;domain&nbsp;attribute&nbsp;in&nbsp;the&nbsp;SetCookie&nbsp;header&nbsp;indicates&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922956">//&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5922974">return</span>&nbsp;<span class="ident" id="5922981">host</span><span class="op" id="5922985">,</span>&nbsp;<span class="builtintype" id="5922987">true</span><span class="op" id="5922991">,</span>&nbsp;<span class="ident" id="5922993">nil</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5922998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5923002">if</span>&nbsp;<span class="ident" id="5923005">isIP</span><span class="op" id="5923009">(</span><span class="ident" id="5923010">host</span><span class="op" id="5923014">)</span>&nbsp;<span class="op" id="5923016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923020">//&nbsp;According&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;domain-matching&nbsp;includes&nbsp;not&nbsp;being</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923082">//&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923102">//&nbsp;TODO:&nbsp;This&nbsp;might&nbsp;be&nbsp;relaxed&nbsp;as&nbsp;in&nbsp;common&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5923158">return</span>&nbsp;<span class="string" id="5923165">&#34;&#34;</span><span class="op" id="5923167">,</span>&nbsp;<span class="builtintype" id="5923169">false</span><span class="op" id="5923174">,</span>&nbsp;<span class="ident" id="5923176">errNoHostname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5923191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923195">//&nbsp;From&nbsp;here&nbsp;on:&nbsp;If&nbsp;the&nbsp;cookie&nbsp;is&nbsp;valid,&nbsp;it&nbsp;is&nbsp;a&nbsp;domain&nbsp;cookie&nbsp;(with</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923265">//&nbsp;the&nbsp;one&nbsp;exception&nbsp;of&nbsp;a&nbsp;public&nbsp;suffix&nbsp;below).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923314">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5923346">if</span>&nbsp;<span class="ident" id="5923349">domain</span><span class="op" id="5923355">[</span><span class="num" id="5923356">0</span><span class="op" id="5923357">]</span>&nbsp;<span class="op" id="5923359">==</span>&nbsp;<span class="string" id="5923362">&#39;.&#39;</span>&nbsp;<span class="op" id="5923366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5923370">domain</span>&nbsp;<span class="op" id="5923377">=</span>&nbsp;<span class="ident" id="5923379">domain</span><span class="op" id="5923385">[</span><span class="num" id="5923386">1</span><span class="op" id="5923387">:</span><span class="op" id="5923388">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5923391">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5923395">if</span>&nbsp;<span class="builtinfunc" id="5923398">len</span><span class="op" id="5923401">(</span><span class="ident" id="5923402">domain</span><span class="op" id="5923408">)</span>&nbsp;<span class="op" id="5923410">==</span>&nbsp;<span class="num" id="5923413">0</span>&nbsp;<span class="op" id="5923415">||</span>&nbsp;<span class="ident" id="5923418">domain</span><span class="op" id="5923424">[</span><span class="num" id="5923425">0</span><span class="op" id="5923426">]</span>&nbsp;<span class="op" id="5923428">==</span>&nbsp;<span class="string" id="5923431">&#39;.&#39;</span>&nbsp;<span class="op" id="5923435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923439">//&nbsp;Received&nbsp;either&nbsp;&#34;Domain=.&#34;&nbsp;or&nbsp;&#34;Domain=..some.thing&#34;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923497">//&nbsp;both&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5923520">return</span>&nbsp;<span class="string" id="5923527">&#34;&#34;</span><span class="op" id="5923529">,</span>&nbsp;<span class="builtintype" id="5923531">false</span><span class="op" id="5923536">,</span>&nbsp;<span class="ident" id="5923538">errMalformedDomain</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5923558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5923561">domain</span>&nbsp;<span class="op" id="5923568">=</span>&nbsp;<span class="ident" id="5923570">strings</span><span class="op" id="5923577">.</span><span class="ident" id="5923578">ToLower</span><span class="op" id="5923585">(</span><span class="ident" id="5923586">domain</span><span class="op" id="5923592">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5923596">if</span>&nbsp;<span class="ident" id="5923599">domain</span><span class="op" id="5923605">[</span><span class="builtinfunc" id="5923606">len</span><span class="op" id="5923609">(</span><span class="ident" id="5923610">domain</span><span class="op" id="5923616">)</span><span class="op" id="5923617">-</span><span class="num" id="5923618">1</span><span class="op" id="5923619">]</span>&nbsp;<span class="op" id="5923621">==</span>&nbsp;<span class="string" id="5923624">&#39;.&#39;</span>&nbsp;<span class="op" id="5923628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923632">//&nbsp;We&nbsp;received&nbsp;stuff&nbsp;like&nbsp;&#34;Domain=www.example.com.&#34;.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923687">//&nbsp;Browsers&nbsp;do&nbsp;handle&nbsp;such&nbsp;stuff&nbsp;(actually&nbsp;differently)&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923749">//&nbsp;RFC&nbsp;6265&nbsp;seems&nbsp;to&nbsp;be&nbsp;clear&nbsp;here&nbsp;(e.g.&nbsp;section&nbsp;4.1.2.3)&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923812">//&nbsp;requiring&nbsp;a&nbsp;reject.&nbsp;&nbsp;4.1.2.3&nbsp;is&nbsp;not&nbsp;normative,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923868">//&nbsp;&#34;Domain&nbsp;Matching&#34;&nbsp;(5.1.3)&nbsp;and&nbsp;&#34;Canonicalized&nbsp;Host&nbsp;Names&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923930">//&nbsp;(5.1.2)&nbsp;are.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5923948">return</span>&nbsp;<span class="string" id="5923955">&#34;&#34;</span><span class="op" id="5923957">,</span>&nbsp;<span class="builtintype" id="5923959">false</span><span class="op" id="5923964">,</span>&nbsp;<span class="ident" id="5923966">errMalformedDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5923986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5923990">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.3&nbsp;#5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5924023">if</span>&nbsp;<span class="ident" id="5924026">j</span><span class="op" id="5924027">.</span><span class="ident" id="5924028">psList</span>&nbsp;<span class="op" id="5924035">!=</span>&nbsp;<span class="ident" id="5924038">nil</span>&nbsp;<span class="op" id="5924042">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5924046">if</span>&nbsp;<span class="ident" id="5924049">ps</span>&nbsp;<span class="op" id="5924052">:=</span>&nbsp;<span class="ident" id="5924055">j</span><span class="op" id="5924056">.</span><span class="ident" id="5924057">psList</span><span class="op" id="5924063">.</span><span class="ident" id="5924064">PublicSuffix</span><span class="op" id="5924076">(</span><span class="ident" id="5924077">domain</span><span class="op" id="5924083">)</span><span class="op" id="5924084">;</span>&nbsp;<span class="ident" id="5924086">ps</span>&nbsp;<span class="op" id="5924089">!=</span>&nbsp;<span class="string" id="5924092">&#34;&#34;</span>&nbsp;<span class="op" id="5924095">&amp;&amp;</span>&nbsp;<span class="op" id="5924098">!</span><span class="ident" id="5924099">hasDotSuffix</span><span class="op" id="5924111">(</span><span class="ident" id="5924112">domain</span><span class="op" id="5924118">,</span>&nbsp;<span class="ident" id="5924120">ps</span><span class="op" id="5924122">)</span>&nbsp;<span class="op" id="5924124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5924129">if</span>&nbsp;<span class="ident" id="5924132">host</span>&nbsp;<span class="op" id="5924137">==</span>&nbsp;<span class="ident" id="5924140">domain</span>&nbsp;<span class="op" id="5924147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5924153">//&nbsp;This&nbsp;is&nbsp;the&nbsp;one&nbsp;exception&nbsp;in&nbsp;which&nbsp;a&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5924204">//&nbsp;with&nbsp;a&nbsp;domain&nbsp;attribute&nbsp;is&nbsp;a&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5924253">return</span>&nbsp;<span class="ident" id="5924260">host</span><span class="op" id="5924264">,</span>&nbsp;<span class="builtintype" id="5924266">true</span><span class="op" id="5924270">,</span>&nbsp;<span class="ident" id="5924272">nil</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5924279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5924284">return</span>&nbsp;<span class="string" id="5924291">&#34;&#34;</span><span class="op" id="5924293">,</span>&nbsp;<span class="builtintype" id="5924295">false</span><span class="op" id="5924300">,</span>&nbsp;<span class="ident" id="5924302">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5924321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5924324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5924328">//&nbsp;The&nbsp;domain&nbsp;must&nbsp;domain-match&nbsp;host:&nbsp;www.mycompany.com&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5924392">//&nbsp;set&nbsp;cookies&nbsp;for&nbsp;.ourcompetitors.com.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5924433">if</span>&nbsp;<span class="ident" id="5924436">host</span>&nbsp;<span class="op" id="5924441">!=</span>&nbsp;<span class="ident" id="5924444">domain</span>&nbsp;<span class="op" id="5924451">&amp;&amp;</span>&nbsp;<span class="op" id="5924454">!</span><span class="ident" id="5924455">hasDotSuffix</span><span class="op" id="5924467">(</span><span class="ident" id="5924468">host</span><span class="op" id="5924472">,</span>&nbsp;<span class="ident" id="5924474">domain</span><span class="op" id="5924480">)</span>&nbsp;<span class="op" id="5924482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5924486">return</span>&nbsp;<span class="string" id="5924493">&#34;&#34;</span><span class="op" id="5924495">,</span>&nbsp;<span class="builtintype" id="5924497">false</span><span class="op" id="5924502">,</span>&nbsp;<span class="ident" id="5924504">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5924522">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5924526">return</span>&nbsp;<span class="ident" id="5924533">domain</span><span class="op" id="5924539">,</span>&nbsp;<span class="builtintype" id="5924541">false</span><span class="op" id="5924546">,</span>&nbsp;<span class="ident" id="5924548">nil</span><br>
<span class="lineno"></span><span class="op" id="5924552">}</span>
</div>
</body>
</html>
