<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4155936">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4155991">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4156045">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4156096">package</span>&nbsp;<span class="ident" id="4156104">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4156109">import</span>&nbsp;<span class="op" id="4156116">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4156119">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4156128">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4156138">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4156154">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4156168">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4156185">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4156200">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4156210">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4156217">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4156223">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4156230">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="4156240">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="4156243">type</span>&nbsp;<span class="ident" id="4156248">clientHandshakeState</span>&nbsp;<span class="keyword" id="4156269">struct</span>&nbsp;<span class="op" id="4156276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156279">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4156292">*</span><span class="ident" id="4156293"><a href="/crypto/tls/conn.go.html#4127599">Conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156299">serverHello</span>&nbsp;&nbsp;<span class="op" id="4156312">*</span><span class="ident" id="4156313"><a href="/crypto/tls/handshake_messages.go.html#4185078">serverHelloMsg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156329">hello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4156342">*</span><span class="ident" id="4156343"><a href="/crypto/tls/handshake_messages.go.html#4173962">clientHelloMsg</a></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156359">suite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4156372">*</span><span class="ident" id="4156373"><a href="/crypto/tls/cipher_suites.go.html#4100373">cipherSuite</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156386">finishedHash</span>&nbsp;<span class="ident" id="4156399"><a href="/crypto/tls/prf.go.html#4241479">finishedHash</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156413">masterSecret</span>&nbsp;<span class="op" id="4156426">[</span><span class="op" id="4156427">]</span><span class="builtintype" id="4156428">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156434">session</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4156447">*</span><span class="ident" id="4156448"><a href="/crypto/tls/common.go.html#4113855">ClientSessionState</a></span><br>
<span class="lineno"></span><span class="op" id="4156467">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="4156470">func</span>&nbsp;<span class="op" id="4156475">(</span><span class="ident" id="4156476">c</span>&nbsp;<span class="op" id="4156478">*</span><span class="ident" id="4156479"><a href="/crypto/tls/conn.go.html#4127599">Conn</a></span><span class="op" id="4156483">)</span>&nbsp;<span class="ident" id="4156485">clientHandshake</span><span class="op" id="4156500">(</span><span class="op" id="4156501">)</span>&nbsp;<span class="builtintype" id="4156503">error</span>&nbsp;<span class="op" id="4156509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156512">if</span>&nbsp;<span class="ident" id="4156515"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4156516">.</span><span class="ident" id="4156517">config</span>&nbsp;<span class="op" id="4156524">==</span>&nbsp;<span class="ident" id="4156527">nil</span>&nbsp;<span class="op" id="4156531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156535"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4156536">.</span><span class="ident" id="4156537">config</span>&nbsp;<span class="op" id="4156544">=</span>&nbsp;<span class="ident" id="4156546"><a href="/crypto/tls/common.go.html#4126594">defaultConfig</a></span><span class="op" id="4156559">(</span><span class="op" id="4156560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156563">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156567">if</span>&nbsp;<span class="builtinfunc" id="4156570">len</span><span class="op" id="4156573">(</span><span class="ident" id="4156574"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4156575">.</span><span class="ident" id="4156576">config</span><span class="op" id="4156582">.</span><span class="ident" id="4156583">ServerName</span><span class="op" id="4156593">)</span>&nbsp;<span class="op" id="4156595">==</span>&nbsp;<span class="num" id="4156598">0</span>&nbsp;<span class="op" id="4156600">&amp;&amp;</span>&nbsp;<span class="op" id="4156603">!</span><span class="ident" id="4156604"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4156605">.</span><span class="ident" id="4156606">config</span><span class="op" id="4156612">.</span><span class="ident" id="4156613">InsecureSkipVerify</span>&nbsp;<span class="op" id="4156632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156636">return</span>&nbsp;<span class="ident" id="4156643"><a href="/crypto/tls/handshake_client.go.html#4156200">errors</a></span><span class="op" id="4156649">.</span><span class="ident" id="4156650">New</span><span class="op" id="4156653">(</span><span class="string" id="4156654">&#34;tls:&nbsp;either&nbsp;ServerName&nbsp;or&nbsp;InsecureSkipVerify&nbsp;must&nbsp;be&nbsp;specified&nbsp;in&nbsp;the&nbsp;tls.Config&#34;</span><span class="op" id="4156736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156743">nextProtosLength</span>&nbsp;<span class="op" id="4156760">:=</span>&nbsp;<span class="num" id="4156763">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156766">for</span>&nbsp;<span class="ident" id="4156770">_</span><span class="op" id="4156771">,</span>&nbsp;<span class="ident" id="4156773">proto</span>&nbsp;<span class="op" id="4156779">:=</span>&nbsp;<span class="keyword" id="4156782">range</span>&nbsp;<span class="ident" id="4156788"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4156789">.</span><span class="ident" id="4156790">config</span><span class="op" id="4156796">.</span><span class="ident" id="4156797">NextProtos</span>&nbsp;<span class="op" id="4156808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156812">if</span>&nbsp;<span class="ident" id="4156815">l</span>&nbsp;<span class="op" id="4156817">:=</span>&nbsp;<span class="builtinfunc" id="4156820">len</span><span class="op" id="4156823">(</span><span class="ident" id="4156824"><a href="/crypto/tls/handshake_client.go.html#4156773">proto</a></span><span class="op" id="4156829">)</span><span class="op" id="4156830">;</span>&nbsp;<span class="ident" id="4156832"><a href="/crypto/tls/handshake_client.go.html#4156815">l</a></span>&nbsp;<span class="op" id="4156834">==</span>&nbsp;<span class="num" id="4156837">0</span>&nbsp;<span class="op" id="4156839">||</span>&nbsp;<span class="ident" id="4156842"><a href="/crypto/tls/handshake_client.go.html#4156815">l</a></span>&nbsp;<span class="op" id="4156844">&gt;</span>&nbsp;<span class="num" id="4156846">255</span>&nbsp;<span class="op" id="4156850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156855">return</span>&nbsp;<span class="ident" id="4156862"><a href="/crypto/tls/handshake_client.go.html#4156200">errors</a></span><span class="op" id="4156868">.</span><span class="ident" id="4156869">New</span><span class="op" id="4156872">(</span><span class="string" id="4156873">&#34;tls:&nbsp;invalid&nbsp;NextProtos&nbsp;value&#34;</span><span class="op" id="4156904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156908">}</span>&nbsp;<span class="keyword" id="4156910">else</span>&nbsp;<span class="op" id="4156915">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156920"><a href="/crypto/tls/handshake_client.go.html#4156743">nextProtosLength</a></span>&nbsp;<span class="op" id="4156937">+=</span>&nbsp;<span class="num" id="4156940">1</span>&nbsp;<span class="op" id="4156942">+</span>&nbsp;<span class="ident" id="4156944"><a href="/crypto/tls/handshake_client.go.html#4156815">l</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4156951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156954">if</span>&nbsp;<span class="ident" id="4156957"><a href="/crypto/tls/handshake_client.go.html#4156743">nextProtosLength</a></span>&nbsp;<span class="op" id="4156974">&gt;</span>&nbsp;<span class="num" id="4156976">0xffff</span>&nbsp;<span class="op" id="4156983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156987">return</span>&nbsp;<span class="ident" id="4156994"><a href="/crypto/tls/handshake_client.go.html#4156200">errors</a></span><span class="op" id="4157000">.</span><span class="ident" id="4157001">New</span><span class="op" id="4157004">(</span><span class="string" id="4157005">&#34;tls:&nbsp;NextProtos&nbsp;values&nbsp;too&nbsp;large&#34;</span><span class="op" id="4157039">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157046">hello</span>&nbsp;<span class="op" id="4157052">:=</span>&nbsp;<span class="op" id="4157055">&amp;</span><span class="ident" id="4157056"><a href="/crypto/tls/handshake_messages.go.html#4173962">clientHelloMsg</a></span><span class="op" id="4157070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157074">vers</span><span class="op" id="4157078">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4157095"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4157096">.</span><span class="ident" id="4157097">config</span><span class="op" id="4157103">.</span><span class="ident" id="4157104">maxVersion</span><span class="op" id="4157114">(</span><span class="op" id="4157115">)</span><span class="op" id="4157116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157120">compressionMethods</span><span class="op" id="4157138">:</span>&nbsp;&nbsp;<span class="op" id="4157141">[</span><span class="op" id="4157142">]</span><span class="builtintype" id="4157143">uint8</span><span class="op" id="4157148">{</span><span class="ident" id="4157149"><a href="/crypto/tls/common.go.html#4109324">compressionNone</a></span><span class="op" id="4157164">}</span><span class="op" id="4157165">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157169">random</span><span class="op" id="4157175">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4157190">make</span><span class="op" id="4157194">(</span><span class="op" id="4157195">[</span><span class="op" id="4157196">]</span><span class="builtintype" id="4157197">byte</span><span class="op" id="4157201">,</span>&nbsp;<span class="num" id="4157203">32</span><span class="op" id="4157205">)</span><span class="op" id="4157206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157210">ocspStapling</span><span class="op" id="4157222">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4157231">true</span><span class="op" id="4157235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157239">serverName</span><span class="op" id="4157249">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4157260"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4157261">.</span><span class="ident" id="4157262">config</span><span class="op" id="4157268">.</span><span class="ident" id="4157269">ServerName</span><span class="op" id="4157279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157283">supportedCurves</span><span class="op" id="4157298">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4157304"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4157305">.</span><span class="ident" id="4157306">config</span><span class="op" id="4157312">.</span><span class="ident" id="4157313">curvePreferences</span><span class="op" id="4157329">(</span><span class="op" id="4157330">)</span><span class="op" id="4157331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157335">supportedPoints</span><span class="op" id="4157350">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4157356">[</span><span class="op" id="4157357">]</span><span class="builtintype" id="4157358">uint8</span><span class="op" id="4157363">{</span><span class="ident" id="4157364"><a href="/crypto/tls/common.go.html#4110267">pointFormatUncompressed</a></span><span class="op" id="4157387">}</span><span class="op" id="4157388">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157392">nextProtoNeg</span><span class="op" id="4157404">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4157413">len</span><span class="op" id="4157416">(</span><span class="ident" id="4157417"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4157418">.</span><span class="ident" id="4157419">config</span><span class="op" id="4157425">.</span><span class="ident" id="4157426">NextProtos</span><span class="op" id="4157436">)</span>&nbsp;<span class="op" id="4157438">&gt;</span>&nbsp;<span class="num" id="4157440">0</span><span class="op" id="4157441">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157445">secureRenegotiation</span><span class="op" id="4157464">:</span>&nbsp;<span class="ident" id="4157466">true</span><span class="op" id="4157470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157474">alpnProtocols</span><span class="op" id="4157487">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4157495"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4157496">.</span><span class="ident" id="4157497">config</span><span class="op" id="4157503">.</span><span class="ident" id="4157504">NextProtos</span><span class="op" id="4157514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157521">possibleCipherSuites</span>&nbsp;<span class="op" id="4157542">:=</span>&nbsp;<span class="ident" id="4157545"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4157546">.</span><span class="ident" id="4157547">config</span><span class="op" id="4157553">.</span><span class="ident" id="4157554">cipherSuites</span><span class="op" id="4157566">(</span><span class="op" id="4157567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157570"><a href="/crypto/tls/handshake_client.go.html#4157046">hello</a></span><span class="op" id="4157575">.</span><span class="ident" id="4157576">cipherSuites</span>&nbsp;<span class="op" id="4157589">=</span>&nbsp;<span class="builtinfunc" id="4157591">make</span><span class="op" id="4157595">(</span><span class="op" id="4157596">[</span><span class="op" id="4157597">]</span><span class="builtintype" id="4157598">uint16</span><span class="op" id="4157604">,</span>&nbsp;<span class="num" id="4157606">0</span><span class="op" id="4157607">,</span>&nbsp;<span class="builtinfunc" id="4157609">len</span><span class="op" id="4157612">(</span><span class="ident" id="4157613"><a href="/crypto/tls/handshake_client.go.html#4157521">possibleCipherSuites</a></span><span class="op" id="4157633">)</span><span class="op" id="4157634">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4157637">NextCipherSuite</span><span class="op" id="4157652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157655">for</span>&nbsp;<span class="ident" id="4157659">_</span><span class="op" id="4157660">,</span>&nbsp;<span class="ident" id="4157662">suiteId</span>&nbsp;<span class="op" id="4157670">:=</span>&nbsp;<span class="keyword" id="4157673">range</span>&nbsp;<span class="ident" id="4157679"><a href="/crypto/tls/handshake_client.go.html#4157521">possibleCipherSuites</a></span>&nbsp;<span class="op" id="4157700">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157704">for</span>&nbsp;<span class="ident" id="4157708">_</span><span class="op" id="4157709">,</span>&nbsp;<span class="ident" id="4157711">suite</span>&nbsp;<span class="op" id="4157717">:=</span>&nbsp;<span class="keyword" id="4157720">range</span>&nbsp;<span class="ident" id="4157726"><a href="/crypto/tls/cipher_suites.go.html#4100787">cipherSuites</a></span>&nbsp;<span class="op" id="4157739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157744">if</span>&nbsp;<span class="ident" id="4157747"><a href="/crypto/tls/handshake_client.go.html#4157711">suite</a></span><span class="op" id="4157752">.</span><span class="ident" id="4157753">id</span>&nbsp;<span class="op" id="4157756">!=</span>&nbsp;<span class="ident" id="4157759"><a href="/crypto/tls/handshake_client.go.html#4157662">suiteId</a></span>&nbsp;<span class="op" id="4157767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157773">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4157790">//&nbsp;Don&#39;t&nbsp;advertise&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suites&nbsp;unless</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4157846">//&nbsp;we&#39;re&nbsp;attempting&nbsp;TLS&nbsp;1.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157878">if</span>&nbsp;<span class="ident" id="4157881"><a href="/crypto/tls/handshake_client.go.html#4157046">hello</a></span><span class="op" id="4157886">.</span><span class="ident" id="4157887">vers</span>&nbsp;<span class="op" id="4157892">&lt;</span>&nbsp;<span class="ident" id="4157894"><a href="/crypto/tls/common.go.html#4108205">VersionTLS12</a></span>&nbsp;<span class="op" id="4157907">&amp;&amp;</span>&nbsp;<span class="ident" id="4157910"><a href="/crypto/tls/handshake_client.go.html#4157711">suite</a></span><span class="op" id="4157915">.</span><span class="ident" id="4157916">flags</span><span class="op" id="4157921">&amp;</span><span class="ident" id="4157922"><a href="/crypto/tls/cipher_suites.go.html#4100211">suiteTLS12</a></span>&nbsp;<span class="op" id="4157933">!=</span>&nbsp;<span class="num" id="4157936">0</span>&nbsp;<span class="op" id="4157938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157944">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157961"><a href="/crypto/tls/handshake_client.go.html#4157046">hello</a></span><span class="op" id="4157966">.</span><span class="ident" id="4157967">cipherSuites</span>&nbsp;<span class="op" id="4157980">=</span>&nbsp;<span class="builtinfunc" id="4157982">append</span><span class="op" id="4157988">(</span><span class="ident" id="4157989"><a href="/crypto/tls/handshake_client.go.html#4157046">hello</a></span><span class="op" id="4157994">.</span><span class="ident" id="4157995">cipherSuites</span><span class="op" id="4158007">,</span>&nbsp;<span class="ident" id="4158009"><a href="/crypto/tls/handshake_client.go.html#4157662">suiteId</a></span><span class="op" id="4158016">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158021">continue</span>&nbsp;<span class="ident" id="4158030">NextCipherSuite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4158048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4158051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158055">_</span><span class="op" id="4158056">,</span>&nbsp;<span class="ident" id="4158058">err</span>&nbsp;<span class="op" id="4158062">:=</span>&nbsp;<span class="ident" id="4158065"><a href="/crypto/tls/handshake_client.go.html#4156217">io</a></span><span class="op" id="4158067">.</span><span class="ident" id="4158068">ReadFull</span><span class="op" id="4158076">(</span><span class="ident" id="4158077"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4158078">.</span><span class="ident" id="4158079">config</span><span class="op" id="4158085">.</span><span class="ident" id="4158086">rand</span><span class="op" id="4158090">(</span><span class="op" id="4158091">)</span><span class="op" id="4158092">,</span>&nbsp;<span class="ident" id="4158094"><a href="/crypto/tls/handshake_client.go.html#4157046">hello</a></span><span class="op" id="4158099">.</span><span class="ident" id="4158100">random</span><span class="op" id="4158106">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158109">if</span>&nbsp;<span class="ident" id="4158112"><a href="/crypto/tls/handshake_client.go.html#4158058">err</a></span>&nbsp;<span class="op" id="4158116">!=</span>&nbsp;<span class="ident" id="4158119">nil</span>&nbsp;<span class="op" id="4158123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158127"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4158128">.</span><span class="ident" id="4158129">sendAlert</span><span class="op" id="4158138">(</span><span class="ident" id="4158139"><a href="/crypto/tls/alert.go.html#4096712">alertInternalError</a></span><span class="op" id="4158157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158161">return</span>&nbsp;<span class="ident" id="4158168"><a href="/crypto/tls/handshake_client.go.html#4156200">errors</a></span><span class="op" id="4158174">.</span><span class="ident" id="4158175">New</span><span class="op" id="4158178">(</span><span class="string" id="4158179">&#34;tls:&nbsp;short&nbsp;read&nbsp;from&nbsp;Rand:&nbsp;&#34;</span>&nbsp;<span class="op" id="4158209">+</span>&nbsp;<span class="ident" id="4158211"><a href="/crypto/tls/handshake_client.go.html#4158058">err</a></span><span class="op" id="4158214">.</span><span class="ident" id="4158215">Error</span><span class="op" id="4158220">(</span><span class="op" id="4158221">)</span><span class="op" id="4158222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4158225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158229">if</span>&nbsp;<span class="ident" id="4158232"><a href="/crypto/tls/handshake_client.go.html#4157046">hello</a></span><span class="op" id="4158237">.</span><span class="ident" id="4158238">vers</span>&nbsp;<span class="op" id="4158243">&gt;=</span>&nbsp;<span class="ident" id="4158246"><a href="/crypto/tls/common.go.html#4108205">VersionTLS12</a></span>&nbsp;<span class="op" id="4158259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158263"><a href="/crypto/tls/handshake_client.go.html#4157046">hello</a></span><span class="op" id="4158268">.</span><span class="ident" id="4158269">signatureAndHashes</span>&nbsp;<span class="op" id="4158288">=</span>&nbsp;<span class="ident" id="4158290"><a href="/crypto/tls/common.go.html#4111655">supportedSKXSignatureAlgorithms</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4158323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158327">var</span>&nbsp;<span class="ident" id="4158331">session</span>&nbsp;<span class="op" id="4158339">*</span><span class="ident" id="4158340"><a href="/crypto/tls/common.go.html#4113855">ClientSessionState</a></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158360">var</span>&nbsp;<span class="ident" id="4158364">cacheKey</span>&nbsp;<span class="builtintype" id="4158373">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158381">sessionCache</span>&nbsp;<span class="op" id="4158394">:=</span>&nbsp;<span class="ident" id="4158397"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4158398">.</span><span class="ident" id="4158399">config</span><span class="op" id="4158405">.</span><span class="ident" id="4158406">ClientSessionCache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158426">if</span>&nbsp;<span class="ident" id="4158429"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4158430">.</span><span class="ident" id="4158431">config</span><span class="op" id="4158437">.</span><span class="ident" id="4158438">SessionTicketsDisabled</span>&nbsp;<span class="op" id="4158461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158465"><a href="/crypto/tls/handshake_client.go.html#4158381">sessionCache</a></span>&nbsp;<span class="op" id="4158478">=</span>&nbsp;<span class="ident" id="4158480">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4158485">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158489">if</span>&nbsp;<span class="ident" id="4158492"><a href="/crypto/tls/handshake_client.go.html#4158381">sessionCache</a></span>&nbsp;<span class="op" id="4158505">!=</span>&nbsp;<span class="ident" id="4158508">nil</span>&nbsp;<span class="op" id="4158512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158516"><a href="/crypto/tls/handshake_client.go.html#4157046">hello</a></span><span class="op" id="4158521">.</span><span class="ident" id="4158522">ticketSupported</span>&nbsp;<span class="op" id="4158538">=</span>&nbsp;<span class="ident" id="4158540">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4158548">//&nbsp;Try&nbsp;to&nbsp;resume&nbsp;a&nbsp;previously&nbsp;negotiated&nbsp;TLS&nbsp;session,&nbsp;if</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4158607">//&nbsp;available.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158623"><a href="/crypto/tls/handshake_client.go.html#4158364">cacheKey</a></span>&nbsp;<span class="op" id="4158632">=</span>&nbsp;<span class="ident" id="4158634"><a href="/crypto/tls/handshake_client.go.html#4173114">clientSessionCacheKey</a></span><span class="op" id="4158655">(</span><span class="ident" id="4158656"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4158657">.</span><span class="ident" id="4158658">conn</span><span class="op" id="4158662">.</span><span class="ident" id="4158663">RemoteAddr</span><span class="op" id="4158673">(</span><span class="op" id="4158674">)</span><span class="op" id="4158675">,</span>&nbsp;<span class="ident" id="4158677"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4158678">.</span><span class="ident" id="4158679">config</span><span class="op" id="4158685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158689">candidateSession</span><span class="op" id="4158705">,</span>&nbsp;<span class="ident" id="4158707">ok</span>&nbsp;<span class="op" id="4158710">:=</span>&nbsp;<span class="ident" id="4158713"><a href="/crypto/tls/handshake_client.go.html#4158381">sessionCache</a></span><span class="op" id="4158725">.</span><span class="ident" id="4158726">Get</span><span class="op" id="4158729">(</span><span class="ident" id="4158730"><a href="/crypto/tls/handshake_client.go.html#4158364">cacheKey</a></span><span class="op" id="4158738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158742">if</span>&nbsp;<span class="ident" id="4158745"><a href="/crypto/tls/handshake_client.go.html#4158707">ok</a></span>&nbsp;<span class="op" id="4158748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4158753">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;ciphersuite/version&nbsp;used&nbsp;for&nbsp;the</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4158807">//&nbsp;previous&nbsp;session&nbsp;are&nbsp;still&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158847">cipherSuiteOk</span>&nbsp;<span class="op" id="4158861">:=</span>&nbsp;<span class="ident" id="4158864">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158873">for</span>&nbsp;<span class="ident" id="4158877">_</span><span class="op" id="4158878">,</span>&nbsp;<span class="ident" id="4158880">id</span>&nbsp;<span class="op" id="4158883">:=</span>&nbsp;<span class="keyword" id="4158886">range</span>&nbsp;<span class="ident" id="4158892"><a href="/crypto/tls/handshake_client.go.html#4157046">hello</a></span><span class="op" id="4158897">.</span><span class="ident" id="4158898">cipherSuites</span>&nbsp;<span class="op" id="4158911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158917">if</span>&nbsp;<span class="ident" id="4158920"><a href="/crypto/tls/handshake_client.go.html#4158880">id</a></span>&nbsp;<span class="op" id="4158923">==</span>&nbsp;<span class="ident" id="4158926"><a href="/crypto/tls/handshake_client.go.html#4158689">candidateSession</a></span><span class="op" id="4158942">.</span><span class="ident" id="4158943">cipherSuite</span>&nbsp;<span class="op" id="4158955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158962"><a href="/crypto/tls/handshake_client.go.html#4158847">cipherSuiteOk</a></span>&nbsp;<span class="op" id="4158976">=</span>&nbsp;<span class="ident" id="4158978">true</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158988">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4158998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4159003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159009">versOk</span>&nbsp;<span class="op" id="4159016">:=</span>&nbsp;<span class="ident" id="4159019"><a href="/crypto/tls/handshake_client.go.html#4158689">candidateSession</a></span><span class="op" id="4159035">.</span><span class="ident" id="4159036">vers</span>&nbsp;<span class="op" id="4159041">&gt;=</span>&nbsp;<span class="ident" id="4159044"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4159045">.</span><span class="ident" id="4159046">config</span><span class="op" id="4159052">.</span><span class="ident" id="4159053">minVersion</span><span class="op" id="4159063">(</span><span class="op" id="4159064">)</span>&nbsp;<span class="op" id="4159066">&amp;&amp;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159073"><a href="/crypto/tls/handshake_client.go.html#4158689">candidateSession</a></span><span class="op" id="4159089">.</span><span class="ident" id="4159090">vers</span>&nbsp;<span class="op" id="4159095">&lt;=</span>&nbsp;<span class="ident" id="4159098"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4159099">.</span><span class="ident" id="4159100">config</span><span class="op" id="4159106">.</span><span class="ident" id="4159107">maxVersion</span><span class="op" id="4159117">(</span><span class="op" id="4159118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159123">if</span>&nbsp;<span class="ident" id="4159126"><a href="/crypto/tls/handshake_client.go.html#4159009">versOk</a></span>&nbsp;<span class="op" id="4159133">&amp;&amp;</span>&nbsp;<span class="ident" id="4159136"><a href="/crypto/tls/handshake_client.go.html#4158847">cipherSuiteOk</a></span>&nbsp;<span class="op" id="4159150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159156"><a href="/crypto/tls/handshake_client.go.html#4158331">session</a></span>&nbsp;<span class="op" id="4159164">=</span>&nbsp;<span class="ident" id="4159166"><a href="/crypto/tls/handshake_client.go.html#4158689">candidateSession</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4159186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4159190">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4159193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159197">if</span>&nbsp;<span class="ident" id="4159200"><a href="/crypto/tls/handshake_client.go.html#4158331">session</a></span>&nbsp;<span class="op" id="4159208">!=</span>&nbsp;<span class="ident" id="4159211">nil</span>&nbsp;<span class="op" id="4159215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159219"><a href="/crypto/tls/handshake_client.go.html#4157046">hello</a></span><span class="op" id="4159224">.</span><span class="ident" id="4159225">sessionTicket</span>&nbsp;<span class="op" id="4159239">=</span>&nbsp;<span class="ident" id="4159241"><a href="/crypto/tls/handshake_client.go.html#4158331">session</a></span><span class="op" id="4159248">.</span><span class="ident" id="4159249">sessionTicket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4159265">//&nbsp;A&nbsp;random&nbsp;session&nbsp;ID&nbsp;is&nbsp;used&nbsp;to&nbsp;detect&nbsp;when&nbsp;the</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4159317">//&nbsp;server&nbsp;accepted&nbsp;the&nbsp;ticket&nbsp;and&nbsp;is&nbsp;resuming&nbsp;a&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4159375">//&nbsp;(see&nbsp;RFC&nbsp;5077).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159396"><a href="/crypto/tls/handshake_client.go.html#4157046">hello</a></span><span class="op" id="4159401">.</span><span class="ident" id="4159402">sessionId</span>&nbsp;<span class="op" id="4159412">=</span>&nbsp;<span class="builtinfunc" id="4159414">make</span><span class="op" id="4159418">(</span><span class="op" id="4159419">[</span><span class="op" id="4159420">]</span><span class="builtintype" id="4159421">byte</span><span class="op" id="4159425">,</span>&nbsp;<span class="num" id="4159427">16</span><span class="op" id="4159429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159433">if</span>&nbsp;<span class="ident" id="4159436">_</span><span class="op" id="4159437">,</span>&nbsp;<span class="ident" id="4159439">err</span>&nbsp;<span class="op" id="4159443">:=</span>&nbsp;<span class="ident" id="4159446"><a href="/crypto/tls/handshake_client.go.html#4156217">io</a></span><span class="op" id="4159448">.</span><span class="ident" id="4159449">ReadFull</span><span class="op" id="4159457">(</span><span class="ident" id="4159458"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4159459">.</span><span class="ident" id="4159460">config</span><span class="op" id="4159466">.</span><span class="ident" id="4159467">rand</span><span class="op" id="4159471">(</span><span class="op" id="4159472">)</span><span class="op" id="4159473">,</span>&nbsp;<span class="ident" id="4159475"><a href="/crypto/tls/handshake_client.go.html#4157046">hello</a></span><span class="op" id="4159480">.</span><span class="ident" id="4159481">sessionId</span><span class="op" id="4159490">)</span><span class="op" id="4159491">;</span>&nbsp;<span class="ident" id="4159493"><a href="/crypto/tls/handshake_client.go.html#4159439">err</a></span>&nbsp;<span class="op" id="4159497">!=</span>&nbsp;<span class="ident" id="4159500">nil</span>&nbsp;<span class="op" id="4159504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159509"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4159510">.</span><span class="ident" id="4159511">sendAlert</span><span class="op" id="4159520">(</span><span class="ident" id="4159521"><a href="/crypto/tls/alert.go.html#4096712">alertInternalError</a></span><span class="op" id="4159539">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159544">return</span>&nbsp;<span class="ident" id="4159551"><a href="/crypto/tls/handshake_client.go.html#4156200">errors</a></span><span class="op" id="4159557">.</span><span class="ident" id="4159558">New</span><span class="op" id="4159561">(</span><span class="string" id="4159562">&#34;tls:&nbsp;short&nbsp;read&nbsp;from&nbsp;Rand:&nbsp;&#34;</span>&nbsp;<span class="op" id="4159592">+</span>&nbsp;<span class="ident" id="4159594"><a href="/crypto/tls/handshake_client.go.html#4159439">err</a></span><span class="op" id="4159597">.</span><span class="ident" id="4159598">Error</span><span class="op" id="4159603">(</span><span class="op" id="4159604">)</span><span class="op" id="4159605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4159609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4159612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159616"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4159617">.</span><span class="ident" id="4159618">writeRecord</span><span class="op" id="4159629">(</span><span class="ident" id="4159630"><a href="/crypto/tls/common.go.html#4108718">recordTypeHandshake</a></span><span class="op" id="4159649">,</span>&nbsp;<span class="ident" id="4159651"><a href="/crypto/tls/handshake_client.go.html#4157046">hello</a></span><span class="op" id="4159656">.</span><span class="ident" id="4159657">marshal</span><span class="op" id="4159664">(</span><span class="op" id="4159665">)</span><span class="op" id="4159666">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159670">msg</span><span class="op" id="4159673">,</span>&nbsp;<span class="ident" id="4159675"><a href="/crypto/tls/handshake_client.go.html#4158058">err</a></span>&nbsp;<span class="op" id="4159679">:=</span>&nbsp;<span class="ident" id="4159682"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4159683">.</span><span class="ident" id="4159684">readHandshake</span><span class="op" id="4159697">(</span><span class="op" id="4159698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159701">if</span>&nbsp;<span class="ident" id="4159704"><a href="/crypto/tls/handshake_client.go.html#4158058">err</a></span>&nbsp;<span class="op" id="4159708">!=</span>&nbsp;<span class="ident" id="4159711">nil</span>&nbsp;<span class="op" id="4159715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159719">return</span>&nbsp;<span class="ident" id="4159726"><a href="/crypto/tls/handshake_client.go.html#4158058">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4159731">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159734">serverHello</span><span class="op" id="4159745">,</span>&nbsp;<span class="ident" id="4159747">ok</span>&nbsp;<span class="op" id="4159750">:=</span>&nbsp;<span class="ident" id="4159753"><a href="/crypto/tls/handshake_client.go.html#4159670">msg</a></span><span class="op" id="4159756">.</span><span class="op" id="4159757">(</span><span class="op" id="4159758">*</span><span class="ident" id="4159759"><a href="/crypto/tls/handshake_messages.go.html#4185078">serverHelloMsg</a></span><span class="op" id="4159773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159776">if</span>&nbsp;<span class="op" id="4159779">!</span><span class="ident" id="4159780"><a href="/crypto/tls/handshake_client.go.html#4159747">ok</a></span>&nbsp;<span class="op" id="4159783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159787"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4159788">.</span><span class="ident" id="4159789">sendAlert</span><span class="op" id="4159798">(</span><span class="ident" id="4159799"><a href="/crypto/tls/alert.go.html#4095992">alertUnexpectedMessage</a></span><span class="op" id="4159821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159825">return</span>&nbsp;<span class="ident" id="4159832"><a href="/crypto/tls/common.go.html#4127007">unexpectedMessageError</a></span><span class="op" id="4159854">(</span><span class="ident" id="4159855"><a href="/crypto/tls/handshake_client.go.html#4159734">serverHello</a></span><span class="op" id="4159866">,</span>&nbsp;<span class="ident" id="4159868"><a href="/crypto/tls/handshake_client.go.html#4159670">msg</a></span><span class="op" id="4159871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4159874">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4159878">vers</span><span class="op" id="4159882">,</span>&nbsp;<span class="ident" id="4159884"><a href="/crypto/tls/handshake_client.go.html#4159747">ok</a></span>&nbsp;<span class="op" id="4159887">:=</span>&nbsp;<span class="ident" id="4159890"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4159891">.</span><span class="ident" id="4159892">config</span><span class="op" id="4159898">.</span><span class="ident" id="4159899">mutualVersion</span><span class="op" id="4159912">(</span><span class="ident" id="4159913"><a href="/crypto/tls/handshake_client.go.html#4159734">serverHello</a></span><span class="op" id="4159924">.</span><span class="ident" id="4159925">vers</span><span class="op" id="4159929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4159932">if</span>&nbsp;<span class="op" id="4159935">!</span><span class="ident" id="4159936"><a href="/crypto/tls/handshake_client.go.html#4159747">ok</a></span>&nbsp;<span class="op" id="4159939">||</span>&nbsp;<span class="ident" id="4159942"><a href="/crypto/tls/handshake_client.go.html#4159878">vers</a></span>&nbsp;<span class="op" id="4159947">&lt;</span>&nbsp;<span class="ident" id="4159949"><a href="/crypto/tls/common.go.html#4108159">VersionTLS10</a></span>&nbsp;<span class="op" id="4159962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4159966">//&nbsp;TLS&nbsp;1.0&nbsp;is&nbsp;the&nbsp;minimum&nbsp;version&nbsp;supported&nbsp;as&nbsp;a&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160025"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4160026">.</span><span class="ident" id="4160027">sendAlert</span><span class="op" id="4160036">(</span><span class="ident" id="4160037"><a href="/crypto/tls/alert.go.html#4096632">alertProtocolVersion</a></span><span class="op" id="4160057">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160061">return</span>&nbsp;<span class="ident" id="4160068"><a href="/crypto/tls/handshake_client.go.html#4156210">fmt</a></span><span class="op" id="4160071">.</span><span class="ident" id="4160072">Errorf</span><span class="op" id="4160078">(</span><span class="string" id="4160079">&#34;tls:&nbsp;server&nbsp;selected&nbsp;unsupported&nbsp;protocol&nbsp;version&nbsp;%x&#34;</span><span class="op" id="4160133">,</span>&nbsp;<span class="ident" id="4160135"><a href="/crypto/tls/handshake_client.go.html#4159734">serverHello</a></span><span class="op" id="4160146">.</span><span class="ident" id="4160147">vers</span><span class="op" id="4160151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160157"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4160158">.</span><span class="ident" id="4160159">vers</span>&nbsp;<span class="op" id="4160164">=</span>&nbsp;<span class="ident" id="4160166"><a href="/crypto/tls/handshake_client.go.html#4159878">vers</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160172"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4160173">.</span><span class="ident" id="4160174">haveVers</span>&nbsp;<span class="op" id="4160183">=</span>&nbsp;<span class="ident" id="4160185">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160192">suite</span>&nbsp;<span class="op" id="4160198">:=</span>&nbsp;<span class="ident" id="4160201"><a href="/crypto/tls/cipher_suites.go.html#4106497">mutualCipherSuite</a></span><span class="op" id="4160218">(</span><span class="ident" id="4160219"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4160220">.</span><span class="ident" id="4160221">config</span><span class="op" id="4160227">.</span><span class="ident" id="4160228">cipherSuites</span><span class="op" id="4160240">(</span><span class="op" id="4160241">)</span><span class="op" id="4160242">,</span>&nbsp;<span class="ident" id="4160244"><a href="/crypto/tls/handshake_client.go.html#4159734">serverHello</a></span><span class="op" id="4160255">.</span><span class="ident" id="4160256">cipherSuite</span><span class="op" id="4160267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160270">if</span>&nbsp;<span class="ident" id="4160273"><a href="/crypto/tls/handshake_client.go.html#4160192">suite</a></span>&nbsp;<span class="op" id="4160279">==</span>&nbsp;<span class="ident" id="4160282">nil</span>&nbsp;<span class="op" id="4160286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160290"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4160291">.</span><span class="ident" id="4160292">sendAlert</span><span class="op" id="4160301">(</span><span class="ident" id="4160302"><a href="/crypto/tls/alert.go.html#4096192">alertHandshakeFailure</a></span><span class="op" id="4160323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160327">return</span>&nbsp;<span class="ident" id="4160334"><a href="/crypto/tls/handshake_client.go.html#4156210">fmt</a></span><span class="op" id="4160337">.</span><span class="ident" id="4160338">Errorf</span><span class="op" id="4160344">(</span><span class="string" id="4160345">&#34;tls:&nbsp;server&nbsp;selected&nbsp;an&nbsp;unsupported&nbsp;cipher&nbsp;suite&#34;</span><span class="op" id="4160395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160398">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160402">hs</span>&nbsp;<span class="op" id="4160405">:=</span>&nbsp;<span class="op" id="4160408">&amp;</span><span class="ident" id="4160409"><a href="/crypto/tls/handshake_client.go.html#4156248">clientHandshakeState</a></span><span class="op" id="4160429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160433">c</span><span class="op" id="4160434">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4160447"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4160448">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160452">serverHello</span><span class="op" id="4160463">:</span>&nbsp;&nbsp;<span class="ident" id="4160466"><a href="/crypto/tls/handshake_client.go.html#4159734">serverHello</a></span><span class="op" id="4160477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160481">hello</span><span class="op" id="4160486">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4160495"><a href="/crypto/tls/handshake_client.go.html#4157046">hello</a></span><span class="op" id="4160500">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160504">suite</span><span class="op" id="4160509">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4160518"><a href="/crypto/tls/handshake_client.go.html#4160192">suite</a></span><span class="op" id="4160523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160527">finishedHash</span><span class="op" id="4160539">:</span>&nbsp;<span class="ident" id="4160541"><a href="/crypto/tls/prf.go.html#4241128">newFinishedHash</a></span><span class="op" id="4160556">(</span><span class="ident" id="4160557"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4160558">.</span><span class="ident" id="4160559">vers</span><span class="op" id="4160563">)</span><span class="op" id="4160564">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160568">session</span><span class="op" id="4160575">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4160582"><a href="/crypto/tls/handshake_client.go.html#4158331">session</a></span><span class="op" id="4160589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160596"><a href="/crypto/tls/handshake_client.go.html#4160402">hs</a></span><span class="op" id="4160598">.</span><span class="ident" id="4160599">finishedHash</span><span class="op" id="4160611">.</span><span class="ident" id="4160612">Write</span><span class="op" id="4160617">(</span><span class="ident" id="4160618"><a href="/crypto/tls/handshake_client.go.html#4160402">hs</a></span><span class="op" id="4160620">.</span><span class="ident" id="4160621">hello</span><span class="op" id="4160626">.</span><span class="ident" id="4160627">marshal</span><span class="op" id="4160634">(</span><span class="op" id="4160635">)</span><span class="op" id="4160636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160639"><a href="/crypto/tls/handshake_client.go.html#4160402">hs</a></span><span class="op" id="4160641">.</span><span class="ident" id="4160642">finishedHash</span><span class="op" id="4160654">.</span><span class="ident" id="4160655">Write</span><span class="op" id="4160660">(</span><span class="ident" id="4160661"><a href="/crypto/tls/handshake_client.go.html#4160402">hs</a></span><span class="op" id="4160663">.</span><span class="ident" id="4160664">serverHello</span><span class="op" id="4160675">.</span><span class="ident" id="4160676">marshal</span><span class="op" id="4160683">(</span><span class="op" id="4160684">)</span><span class="op" id="4160685">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4160689">isResume</span><span class="op" id="4160697">,</span>&nbsp;<span class="ident" id="4160699"><a href="/crypto/tls/handshake_client.go.html#4158058">err</a></span>&nbsp;<span class="op" id="4160703">:=</span>&nbsp;<span class="ident" id="4160706"><a href="/crypto/tls/handshake_client.go.html#4160402">hs</a></span><span class="op" id="4160708">.</span><span class="ident" id="4160709">processServerHello</span><span class="op" id="4160727">(</span><span class="op" id="4160728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160731">if</span>&nbsp;<span class="ident" id="4160734"><a href="/crypto/tls/handshake_client.go.html#4158058">err</a></span>&nbsp;<span class="op" id="4160738">!=</span>&nbsp;<span class="ident" id="4160741">nil</span>&nbsp;<span class="op" id="4160745">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160749">return</span>&nbsp;<span class="ident" id="4160756"><a href="/crypto/tls/handshake_client.go.html#4158058">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160765">if</span>&nbsp;<span class="ident" id="4160768"><a href="/crypto/tls/handshake_client.go.html#4160689">isResume</a></span>&nbsp;<span class="op" id="4160777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160781">if</span>&nbsp;<span class="ident" id="4160784">err</span>&nbsp;<span class="op" id="4160788">:=</span>&nbsp;<span class="ident" id="4160791"><a href="/crypto/tls/handshake_client.go.html#4160402">hs</a></span><span class="op" id="4160793">.</span><span class="ident" id="4160794">establishKeys</span><span class="op" id="4160807">(</span><span class="op" id="4160808">)</span><span class="op" id="4160809">;</span>&nbsp;<span class="ident" id="4160811"><a href="/crypto/tls/handshake_client.go.html#4160784">err</a></span>&nbsp;<span class="op" id="4160815">!=</span>&nbsp;<span class="ident" id="4160818">nil</span>&nbsp;<span class="op" id="4160822">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160827">return</span>&nbsp;<span class="ident" id="4160834"><a href="/crypto/tls/handshake_client.go.html#4160784">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160844">if</span>&nbsp;<span class="ident" id="4160847">err</span>&nbsp;<span class="op" id="4160851">:=</span>&nbsp;<span class="ident" id="4160854"><a href="/crypto/tls/handshake_client.go.html#4160402">hs</a></span><span class="op" id="4160856">.</span><span class="ident" id="4160857">readSessionTicket</span><span class="op" id="4160874">(</span><span class="op" id="4160875">)</span><span class="op" id="4160876">;</span>&nbsp;<span class="ident" id="4160878"><a href="/crypto/tls/handshake_client.go.html#4160847">err</a></span>&nbsp;<span class="op" id="4160882">!=</span>&nbsp;<span class="ident" id="4160885">nil</span>&nbsp;<span class="op" id="4160889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160894">return</span>&nbsp;<span class="ident" id="4160901"><a href="/crypto/tls/handshake_client.go.html#4160847">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160907">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160911">if</span>&nbsp;<span class="ident" id="4160914">err</span>&nbsp;<span class="op" id="4160918">:=</span>&nbsp;<span class="ident" id="4160921"><a href="/crypto/tls/handshake_client.go.html#4160402">hs</a></span><span class="op" id="4160923">.</span><span class="ident" id="4160924">readFinished</span><span class="op" id="4160936">(</span><span class="ident" id="4160937"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4160938">.</span><span class="ident" id="4160939">firstFinished</span><span class="op" id="4160952">[</span><span class="op" id="4160953">:</span><span class="op" id="4160954">]</span><span class="op" id="4160955">)</span><span class="op" id="4160956">;</span>&nbsp;<span class="ident" id="4160958"><a href="/crypto/tls/handshake_client.go.html#4160914">err</a></span>&nbsp;<span class="op" id="4160962">!=</span>&nbsp;<span class="ident" id="4160965">nil</span>&nbsp;<span class="op" id="4160969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160974">return</span>&nbsp;<span class="ident" id="4160981"><a href="/crypto/tls/handshake_client.go.html#4160914">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4160987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4160991">if</span>&nbsp;<span class="ident" id="4160994">err</span>&nbsp;<span class="op" id="4160998">:=</span>&nbsp;<span class="ident" id="4161001"><a href="/crypto/tls/handshake_client.go.html#4160402">hs</a></span><span class="op" id="4161003">.</span><span class="ident" id="4161004">sendFinished</span><span class="op" id="4161016">(</span><span class="ident" id="4161017">nil</span><span class="op" id="4161020">)</span><span class="op" id="4161021">;</span>&nbsp;<span class="ident" id="4161023"><a href="/crypto/tls/handshake_client.go.html#4160994">err</a></span>&nbsp;<span class="op" id="4161027">!=</span>&nbsp;<span class="ident" id="4161030">nil</span>&nbsp;<span class="op" id="4161034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161039">return</span>&nbsp;<span class="ident" id="4161046"><a href="/crypto/tls/handshake_client.go.html#4160994">err</a></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161055">}</span>&nbsp;<span class="keyword" id="4161057">else</span>&nbsp;<span class="op" id="4161062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161066">if</span>&nbsp;<span class="ident" id="4161069">err</span>&nbsp;<span class="op" id="4161073">:=</span>&nbsp;<span class="ident" id="4161076"><a href="/crypto/tls/handshake_client.go.html#4160402">hs</a></span><span class="op" id="4161078">.</span><span class="ident" id="4161079">doFullHandshake</span><span class="op" id="4161094">(</span><span class="op" id="4161095">)</span><span class="op" id="4161096">;</span>&nbsp;<span class="ident" id="4161098"><a href="/crypto/tls/handshake_client.go.html#4161069">err</a></span>&nbsp;<span class="op" id="4161102">!=</span>&nbsp;<span class="ident" id="4161105">nil</span>&nbsp;<span class="op" id="4161109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161114">return</span>&nbsp;<span class="ident" id="4161121"><a href="/crypto/tls/handshake_client.go.html#4161069">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161127">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161131">if</span>&nbsp;<span class="ident" id="4161134">err</span>&nbsp;<span class="op" id="4161138">:=</span>&nbsp;<span class="ident" id="4161141"><a href="/crypto/tls/handshake_client.go.html#4160402">hs</a></span><span class="op" id="4161143">.</span><span class="ident" id="4161144">establishKeys</span><span class="op" id="4161157">(</span><span class="op" id="4161158">)</span><span class="op" id="4161159">;</span>&nbsp;<span class="ident" id="4161161"><a href="/crypto/tls/handshake_client.go.html#4161134">err</a></span>&nbsp;<span class="op" id="4161165">!=</span>&nbsp;<span class="ident" id="4161168">nil</span>&nbsp;<span class="op" id="4161172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161177">return</span>&nbsp;<span class="ident" id="4161184"><a href="/crypto/tls/handshake_client.go.html#4161134">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161194">if</span>&nbsp;<span class="ident" id="4161197">err</span>&nbsp;<span class="op" id="4161201">:=</span>&nbsp;<span class="ident" id="4161204"><a href="/crypto/tls/handshake_client.go.html#4160402">hs</a></span><span class="op" id="4161206">.</span><span class="ident" id="4161207">sendFinished</span><span class="op" id="4161219">(</span><span class="ident" id="4161220"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4161221">.</span><span class="ident" id="4161222">firstFinished</span><span class="op" id="4161235">[</span><span class="op" id="4161236">:</span><span class="op" id="4161237">]</span><span class="op" id="4161238">)</span><span class="op" id="4161239">;</span>&nbsp;<span class="ident" id="4161241"><a href="/crypto/tls/handshake_client.go.html#4161197">err</a></span>&nbsp;<span class="op" id="4161245">!=</span>&nbsp;<span class="ident" id="4161248">nil</span>&nbsp;<span class="op" id="4161252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161257">return</span>&nbsp;<span class="ident" id="4161264"><a href="/crypto/tls/handshake_client.go.html#4161197">err</a></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161274">if</span>&nbsp;<span class="ident" id="4161277">err</span>&nbsp;<span class="op" id="4161281">:=</span>&nbsp;<span class="ident" id="4161284"><a href="/crypto/tls/handshake_client.go.html#4160402">hs</a></span><span class="op" id="4161286">.</span><span class="ident" id="4161287">readSessionTicket</span><span class="op" id="4161304">(</span><span class="op" id="4161305">)</span><span class="op" id="4161306">;</span>&nbsp;<span class="ident" id="4161308"><a href="/crypto/tls/handshake_client.go.html#4161277">err</a></span>&nbsp;<span class="op" id="4161312">!=</span>&nbsp;<span class="ident" id="4161315">nil</span>&nbsp;<span class="op" id="4161319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161324">return</span>&nbsp;<span class="ident" id="4161331"><a href="/crypto/tls/handshake_client.go.html#4161277">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161341">if</span>&nbsp;<span class="ident" id="4161344">err</span>&nbsp;<span class="op" id="4161348">:=</span>&nbsp;<span class="ident" id="4161351"><a href="/crypto/tls/handshake_client.go.html#4160402">hs</a></span><span class="op" id="4161353">.</span><span class="ident" id="4161354">readFinished</span><span class="op" id="4161366">(</span><span class="ident" id="4161367">nil</span><span class="op" id="4161370">)</span><span class="op" id="4161371">;</span>&nbsp;<span class="ident" id="4161373"><a href="/crypto/tls/handshake_client.go.html#4161344">err</a></span>&nbsp;<span class="op" id="4161377">!=</span>&nbsp;<span class="ident" id="4161380">nil</span>&nbsp;<span class="op" id="4161384">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161389">return</span>&nbsp;<span class="ident" id="4161396"><a href="/crypto/tls/handshake_client.go.html#4161344">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161409">if</span>&nbsp;<span class="ident" id="4161412"><a href="/crypto/tls/handshake_client.go.html#4158381">sessionCache</a></span>&nbsp;<span class="op" id="4161425">!=</span>&nbsp;<span class="ident" id="4161428">nil</span>&nbsp;<span class="op" id="4161432">&amp;&amp;</span>&nbsp;<span class="ident" id="4161435"><a href="/crypto/tls/handshake_client.go.html#4160402">hs</a></span><span class="op" id="4161437">.</span><span class="ident" id="4161438">session</span>&nbsp;<span class="op" id="4161446">!=</span>&nbsp;<span class="ident" id="4161449">nil</span>&nbsp;<span class="op" id="4161453">&amp;&amp;</span>&nbsp;<span class="ident" id="4161456"><a href="/crypto/tls/handshake_client.go.html#4158331">session</a></span>&nbsp;<span class="op" id="4161464">!=</span>&nbsp;<span class="ident" id="4161467"><a href="/crypto/tls/handshake_client.go.html#4160402">hs</a></span><span class="op" id="4161469">.</span><span class="ident" id="4161470">session</span>&nbsp;<span class="op" id="4161478">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161482"><a href="/crypto/tls/handshake_client.go.html#4158381">sessionCache</a></span><span class="op" id="4161494">.</span><span class="ident" id="4161495">Put</span><span class="op" id="4161498">(</span><span class="ident" id="4161499"><a href="/crypto/tls/handshake_client.go.html#4158364">cacheKey</a></span><span class="op" id="4161507">,</span>&nbsp;<span class="ident" id="4161509"><a href="/crypto/tls/handshake_client.go.html#4160402">hs</a></span><span class="op" id="4161511">.</span><span class="ident" id="4161512">session</span><span class="op" id="4161519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161526"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4161527">.</span><span class="ident" id="4161528">didResume</span>&nbsp;<span class="op" id="4161538">=</span>&nbsp;<span class="ident" id="4161540"><a href="/crypto/tls/handshake_client.go.html#4160689">isResume</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161550"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4161551">.</span><span class="ident" id="4161552">handshakeComplete</span>&nbsp;<span class="op" id="4161570">=</span>&nbsp;<span class="ident" id="4161572">true</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161578"><a href="/crypto/tls/handshake_client.go.html#4156476">c</a></span><span class="op" id="4161579">.</span><span class="ident" id="4161580">cipherSuite</span>&nbsp;<span class="op" id="4161592">=</span>&nbsp;<span class="ident" id="4161594"><a href="/crypto/tls/handshake_client.go.html#4160192">suite</a></span><span class="op" id="4161599">.</span><span class="ident" id="4161600">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161604">return</span>&nbsp;<span class="ident" id="4161611">nil</span><br>
<span class="lineno"></span><span class="op" id="4161615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4161618">func</span>&nbsp;<span class="op" id="4161623">(</span><span class="ident" id="4161624">hs</span>&nbsp;<span class="op" id="4161627">*</span><span class="ident" id="4161628"><a href="/crypto/tls/handshake_client.go.html#4156248">clientHandshakeState</a></span><span class="op" id="4161648">)</span>&nbsp;<span class="ident" id="4161650">doFullHandshake</span><span class="op" id="4161665">(</span><span class="op" id="4161666">)</span>&nbsp;<span class="builtintype" id="4161668">error</span>&nbsp;<span class="op" id="4161674">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161677">c</span>&nbsp;<span class="op" id="4161679">:=</span>&nbsp;<span class="ident" id="4161682"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4161684">.</span><span class="ident" id="4161685">c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161689">msg</span><span class="op" id="4161692">,</span>&nbsp;<span class="ident" id="4161694">err</span>&nbsp;<span class="op" id="4161698">:=</span>&nbsp;<span class="ident" id="4161701"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4161702">.</span><span class="ident" id="4161703">readHandshake</span><span class="op" id="4161716">(</span><span class="op" id="4161717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161720">if</span>&nbsp;<span class="ident" id="4161723"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4161727">!=</span>&nbsp;<span class="ident" id="4161730">nil</span>&nbsp;<span class="op" id="4161734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161738">return</span>&nbsp;<span class="ident" id="4161745"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161753">certMsg</span><span class="op" id="4161760">,</span>&nbsp;<span class="ident" id="4161762">ok</span>&nbsp;<span class="op" id="4161765">:=</span>&nbsp;<span class="ident" id="4161768"><a href="/crypto/tls/handshake_client.go.html#4161689">msg</a></span><span class="op" id="4161771">.</span><span class="op" id="4161772">(</span><span class="op" id="4161773">*</span><span class="ident" id="4161774"><a href="/crypto/tls/handshake_messages.go.html#4190456">certificateMsg</a></span><span class="op" id="4161788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161791">if</span>&nbsp;<span class="op" id="4161794">!</span><span class="ident" id="4161795"><a href="/crypto/tls/handshake_client.go.html#4161762">ok</a></span>&nbsp;<span class="op" id="4161798">||</span>&nbsp;<span class="builtinfunc" id="4161801">len</span><span class="op" id="4161804">(</span><span class="ident" id="4161805"><a href="/crypto/tls/handshake_client.go.html#4161753">certMsg</a></span><span class="op" id="4161812">.</span><span class="ident" id="4161813">certificates</span><span class="op" id="4161825">)</span>&nbsp;<span class="op" id="4161827">==</span>&nbsp;<span class="num" id="4161830">0</span>&nbsp;<span class="op" id="4161832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161836"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4161837">.</span><span class="ident" id="4161838">sendAlert</span><span class="op" id="4161847">(</span><span class="ident" id="4161848"><a href="/crypto/tls/alert.go.html#4095992">alertUnexpectedMessage</a></span><span class="op" id="4161870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161874">return</span>&nbsp;<span class="ident" id="4161881"><a href="/crypto/tls/common.go.html#4127007">unexpectedMessageError</a></span><span class="op" id="4161903">(</span><span class="ident" id="4161904"><a href="/crypto/tls/handshake_client.go.html#4161753">certMsg</a></span><span class="op" id="4161911">,</span>&nbsp;<span class="ident" id="4161913"><a href="/crypto/tls/handshake_client.go.html#4161689">msg</a></span><span class="op" id="4161916">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161922"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4161924">.</span><span class="ident" id="4161925">finishedHash</span><span class="op" id="4161937">.</span><span class="ident" id="4161938">Write</span><span class="op" id="4161943">(</span><span class="ident" id="4161944"><a href="/crypto/tls/handshake_client.go.html#4161753">certMsg</a></span><span class="op" id="4161951">.</span><span class="ident" id="4161952">marshal</span><span class="op" id="4161959">(</span><span class="op" id="4161960">)</span><span class="op" id="4161961">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161965">certs</span>&nbsp;<span class="op" id="4161971">:=</span>&nbsp;<span class="builtinfunc" id="4161974">make</span><span class="op" id="4161978">(</span><span class="op" id="4161979">[</span><span class="op" id="4161980">]</span><span class="op" id="4161981">*</span><span class="ident" id="4161982"><a href="/crypto/tls/handshake_client.go.html#4156185">x509</a></span><span class="op" id="4161986">.</span><span class="ident" id="4161987">Certificate</span><span class="op" id="4161998">,</span>&nbsp;<span class="builtinfunc" id="4162000">len</span><span class="op" id="4162003">(</span><span class="ident" id="4162004"><a href="/crypto/tls/handshake_client.go.html#4161753">certMsg</a></span><span class="op" id="4162011">.</span><span class="ident" id="4162012">certificates</span><span class="op" id="4162024">)</span><span class="op" id="4162025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162028">for</span>&nbsp;<span class="ident" id="4162032">i</span><span class="op" id="4162033">,</span>&nbsp;<span class="ident" id="4162035">asn1Data</span>&nbsp;<span class="op" id="4162044">:=</span>&nbsp;<span class="keyword" id="4162047">range</span>&nbsp;<span class="ident" id="4162053"><a href="/crypto/tls/handshake_client.go.html#4161753">certMsg</a></span><span class="op" id="4162060">.</span><span class="ident" id="4162061">certificates</span>&nbsp;<span class="op" id="4162074">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162078">cert</span><span class="op" id="4162082">,</span>&nbsp;<span class="ident" id="4162084">err</span>&nbsp;<span class="op" id="4162088">:=</span>&nbsp;<span class="ident" id="4162091"><a href="/crypto/tls/handshake_client.go.html#4156185">x509</a></span><span class="op" id="4162095">.</span><span class="ident" id="4162096">ParseCertificate</span><span class="op" id="4162112">(</span><span class="ident" id="4162113"><a href="/crypto/tls/handshake_client.go.html#4162035">asn1Data</a></span><span class="op" id="4162121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162125">if</span>&nbsp;<span class="ident" id="4162128"><a href="/crypto/tls/handshake_client.go.html#4162084">err</a></span>&nbsp;<span class="op" id="4162132">!=</span>&nbsp;<span class="ident" id="4162135">nil</span>&nbsp;<span class="op" id="4162139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162144"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4162145">.</span><span class="ident" id="4162146">sendAlert</span><span class="op" id="4162155">(</span><span class="ident" id="4162156"><a href="/crypto/tls/alert.go.html#4096232">alertBadCertificate</a></span><span class="op" id="4162175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162180">return</span>&nbsp;<span class="ident" id="4162187"><a href="/crypto/tls/handshake_client.go.html#4156200">errors</a></span><span class="op" id="4162193">.</span><span class="ident" id="4162194">New</span><span class="op" id="4162197">(</span><span class="string" id="4162198">&#34;tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;certificate&nbsp;from&nbsp;server:&nbsp;&#34;</span>&nbsp;<span class="op" id="4162247">+</span>&nbsp;<span class="ident" id="4162249"><a href="/crypto/tls/handshake_client.go.html#4162084">err</a></span><span class="op" id="4162252">.</span><span class="ident" id="4162253">Error</span><span class="op" id="4162258">(</span><span class="op" id="4162259">)</span><span class="op" id="4162260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162264">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162268"><a href="/crypto/tls/handshake_client.go.html#4161965">certs</a></span><span class="op" id="4162273">[</span><span class="ident" id="4162274"><a href="/crypto/tls/handshake_client.go.html#4162032">i</a></span><span class="op" id="4162275">]</span>&nbsp;<span class="op" id="4162277">=</span>&nbsp;<span class="ident" id="4162279"><a href="/crypto/tls/handshake_client.go.html#4162078">cert</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162289">if</span>&nbsp;<span class="op" id="4162292">!</span><span class="ident" id="4162293"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4162294">.</span><span class="ident" id="4162295">config</span><span class="op" id="4162301">.</span><span class="ident" id="4162302">InsecureSkipVerify</span>&nbsp;<span class="op" id="4162321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162325">opts</span>&nbsp;<span class="op" id="4162330">:=</span>&nbsp;<span class="ident" id="4162333"><a href="/crypto/tls/handshake_client.go.html#4156185">x509</a></span><span class="op" id="4162337">.</span><span class="ident" id="4162338">VerifyOptions</span><span class="op" id="4162351">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162356">Roots</span><span class="op" id="4162361">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4162371"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4162372">.</span><span class="ident" id="4162373">config</span><span class="op" id="4162379">.</span><span class="ident" id="4162380">RootCAs</span><span class="op" id="4162387">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162392">CurrentTime</span><span class="op" id="4162403">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4162407"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4162408">.</span><span class="ident" id="4162409">config</span><span class="op" id="4162415">.</span><span class="ident" id="4162416">time</span><span class="op" id="4162420">(</span><span class="op" id="4162421">)</span><span class="op" id="4162422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162427">DNSName</span><span class="op" id="4162434">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4162442"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4162443">.</span><span class="ident" id="4162444">config</span><span class="op" id="4162450">.</span><span class="ident" id="4162451">ServerName</span><span class="op" id="4162461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162466">Intermediates</span><span class="op" id="4162479">:</span>&nbsp;<span class="ident" id="4162481"><a href="/crypto/tls/handshake_client.go.html#4156185">x509</a></span><span class="op" id="4162485">.</span><span class="ident" id="4162486">NewCertPool</span><span class="op" id="4162497">(</span><span class="op" id="4162498">)</span><span class="op" id="4162499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162503">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162508">for</span>&nbsp;<span class="ident" id="4162512">i</span><span class="op" id="4162513">,</span>&nbsp;<span class="ident" id="4162515">cert</span>&nbsp;<span class="op" id="4162520">:=</span>&nbsp;<span class="keyword" id="4162523">range</span>&nbsp;<span class="ident" id="4162529"><a href="/crypto/tls/handshake_client.go.html#4161965">certs</a></span>&nbsp;<span class="op" id="4162535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162540">if</span>&nbsp;<span class="ident" id="4162543"><a href="/crypto/tls/handshake_client.go.html#4162512">i</a></span>&nbsp;<span class="op" id="4162545">==</span>&nbsp;<span class="num" id="4162548">0</span>&nbsp;<span class="op" id="4162550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162556">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162568">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162573"><a href="/crypto/tls/handshake_client.go.html#4162325">opts</a></span><span class="op" id="4162577">.</span><span class="ident" id="4162578">Intermediates</span><span class="op" id="4162591">.</span><span class="ident" id="4162592">AddCert</span><span class="op" id="4162599">(</span><span class="ident" id="4162600"><a href="/crypto/tls/handshake_client.go.html#4162515">cert</a></span><span class="op" id="4162604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162612"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4162613">.</span><span class="ident" id="4162614">verifiedChains</span><span class="op" id="4162628">,</span>&nbsp;<span class="ident" id="4162630"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4162634">=</span>&nbsp;<span class="ident" id="4162636"><a href="/crypto/tls/handshake_client.go.html#4161965">certs</a></span><span class="op" id="4162641">[</span><span class="num" id="4162642">0</span><span class="op" id="4162643">]</span><span class="op" id="4162644">.</span><span class="ident" id="4162645">Verify</span><span class="op" id="4162651">(</span><span class="ident" id="4162652"><a href="/crypto/tls/handshake_client.go.html#4162325">opts</a></span><span class="op" id="4162656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162660">if</span>&nbsp;<span class="ident" id="4162663"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4162667">!=</span>&nbsp;<span class="ident" id="4162670">nil</span>&nbsp;<span class="op" id="4162674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162679"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4162680">.</span><span class="ident" id="4162681">sendAlert</span><span class="op" id="4162690">(</span><span class="ident" id="4162691"><a href="/crypto/tls/alert.go.html#4096232">alertBadCertificate</a></span><span class="op" id="4162710">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162715">return</span>&nbsp;<span class="ident" id="4162722"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162735">switch</span>&nbsp;<span class="ident" id="4162742"><a href="/crypto/tls/handshake_client.go.html#4161965">certs</a></span><span class="op" id="4162747">[</span><span class="num" id="4162748">0</span><span class="op" id="4162749">]</span><span class="op" id="4162750">.</span><span class="ident" id="4162751">PublicKey</span><span class="op" id="4162760">.</span><span class="op" id="4162761">(</span><span class="keyword" id="4162762">type</span><span class="op" id="4162766">)</span>&nbsp;<span class="op" id="4162768">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162771">case</span>&nbsp;<span class="op" id="4162776">*</span><span class="ident" id="4162777"><a href="/crypto/tls/handshake_client.go.html#4156154">rsa</a></span><span class="op" id="4162780">.</span><span class="ident" id="4162781">PublicKey</span><span class="op" id="4162790">,</span>&nbsp;<span class="op" id="4162792">*</span><span class="ident" id="4162793"><a href="/crypto/tls/handshake_client.go.html#4156138">ecdsa</a></span><span class="op" id="4162798">.</span><span class="ident" id="4162799">PublicKey</span><span class="op" id="4162808">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162812">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162819">default</span><span class="op" id="4162826">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162830"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4162831">.</span><span class="ident" id="4162832">sendAlert</span><span class="op" id="4162841">(</span><span class="ident" id="4162842"><a href="/crypto/tls/alert.go.html#4096272">alertUnsupportedCertificate</a></span><span class="op" id="4162869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162873">return</span>&nbsp;<span class="ident" id="4162880"><a href="/crypto/tls/handshake_client.go.html#4156210">fmt</a></span><span class="op" id="4162883">.</span><span class="ident" id="4162884">Errorf</span><span class="op" id="4162890">(</span><span class="string" id="4162891">&#34;tls:&nbsp;server&#39;s&nbsp;certificate&nbsp;contains&nbsp;an&nbsp;unsupported&nbsp;type&nbsp;of&nbsp;public&nbsp;key:&nbsp;%T&#34;</span><span class="op" id="4162965">,</span>&nbsp;<span class="ident" id="4162967"><a href="/crypto/tls/handshake_client.go.html#4161965">certs</a></span><span class="op" id="4162972">[</span><span class="num" id="4162973">0</span><span class="op" id="4162974">]</span><span class="op" id="4162975">.</span><span class="ident" id="4162976">PublicKey</span><span class="op" id="4162985">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162992"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4162993">.</span><span class="ident" id="4162994">peerCertificates</span>&nbsp;<span class="op" id="4163011">=</span>&nbsp;<span class="ident" id="4163013"><a href="/crypto/tls/handshake_client.go.html#4161965">certs</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163021">if</span>&nbsp;<span class="ident" id="4163024"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4163026">.</span><span class="ident" id="4163027">serverHello</span><span class="op" id="4163038">.</span><span class="ident" id="4163039">ocspStapling</span>&nbsp;<span class="op" id="4163052">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163056"><a href="/crypto/tls/handshake_client.go.html#4161689">msg</a></span><span class="op" id="4163059">,</span>&nbsp;<span class="ident" id="4163061"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4163065">=</span>&nbsp;<span class="ident" id="4163067"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4163068">.</span><span class="ident" id="4163069">readHandshake</span><span class="op" id="4163082">(</span><span class="op" id="4163083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163087">if</span>&nbsp;<span class="ident" id="4163090"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4163094">!=</span>&nbsp;<span class="ident" id="4163097">nil</span>&nbsp;<span class="op" id="4163101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163106">return</span>&nbsp;<span class="ident" id="4163113"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163123">cs</span><span class="op" id="4163125">,</span>&nbsp;<span class="ident" id="4163127">ok</span>&nbsp;<span class="op" id="4163130">:=</span>&nbsp;<span class="ident" id="4163133"><a href="/crypto/tls/handshake_client.go.html#4161689">msg</a></span><span class="op" id="4163136">.</span><span class="op" id="4163137">(</span><span class="op" id="4163138">*</span><span class="ident" id="4163139"><a href="/crypto/tls/handshake_messages.go.html#4192853">certificateStatusMsg</a></span><span class="op" id="4163159">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163163">if</span>&nbsp;<span class="op" id="4163166">!</span><span class="ident" id="4163167"><a href="/crypto/tls/handshake_client.go.html#4163127">ok</a></span>&nbsp;<span class="op" id="4163170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163175"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4163176">.</span><span class="ident" id="4163177">sendAlert</span><span class="op" id="4163186">(</span><span class="ident" id="4163187"><a href="/crypto/tls/alert.go.html#4095992">alertUnexpectedMessage</a></span><span class="op" id="4163209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163214">return</span>&nbsp;<span class="ident" id="4163221"><a href="/crypto/tls/common.go.html#4127007">unexpectedMessageError</a></span><span class="op" id="4163243">(</span><span class="ident" id="4163244"><a href="/crypto/tls/handshake_client.go.html#4163123">cs</a></span><span class="op" id="4163246">,</span>&nbsp;<span class="ident" id="4163248"><a href="/crypto/tls/handshake_client.go.html#4161689">msg</a></span><span class="op" id="4163251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163259"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4163261">.</span><span class="ident" id="4163262">finishedHash</span><span class="op" id="4163274">.</span><span class="ident" id="4163275">Write</span><span class="op" id="4163280">(</span><span class="ident" id="4163281"><a href="/crypto/tls/handshake_client.go.html#4163123">cs</a></span><span class="op" id="4163283">.</span><span class="ident" id="4163284">marshal</span><span class="op" id="4163291">(</span><span class="op" id="4163292">)</span><span class="op" id="4163293">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163298">if</span>&nbsp;<span class="ident" id="4163301"><a href="/crypto/tls/handshake_client.go.html#4163123">cs</a></span><span class="op" id="4163303">.</span><span class="ident" id="4163304">statusType</span>&nbsp;<span class="op" id="4163315">==</span>&nbsp;<span class="ident" id="4163318"><a href="/crypto/tls/common.go.html#4110353">statusTypeOCSP</a></span>&nbsp;<span class="op" id="4163333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163338"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4163339">.</span><span class="ident" id="4163340">ocspResponse</span>&nbsp;<span class="op" id="4163353">=</span>&nbsp;<span class="ident" id="4163355"><a href="/crypto/tls/handshake_client.go.html#4163123">cs</a></span><span class="op" id="4163357">.</span><span class="ident" id="4163358">response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163372">}</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163376"><a href="/crypto/tls/handshake_client.go.html#4161689">msg</a></span><span class="op" id="4163379">,</span>&nbsp;<span class="ident" id="4163381"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4163385">=</span>&nbsp;<span class="ident" id="4163387"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4163388">.</span><span class="ident" id="4163389">readHandshake</span><span class="op" id="4163402">(</span><span class="op" id="4163403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163406">if</span>&nbsp;<span class="ident" id="4163409"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4163413">!=</span>&nbsp;<span class="ident" id="4163416">nil</span>&nbsp;<span class="op" id="4163420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163424">return</span>&nbsp;<span class="ident" id="4163431"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163436">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163440">keyAgreement</span>&nbsp;<span class="op" id="4163453">:=</span>&nbsp;<span class="ident" id="4163456"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4163458">.</span><span class="ident" id="4163459">suite</span><span class="op" id="4163464">.</span><span class="ident" id="4163465">ka</span><span class="op" id="4163467">(</span><span class="ident" id="4163468"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4163469">.</span><span class="ident" id="4163470">vers</span><span class="op" id="4163474">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163478">skx</span><span class="op" id="4163481">,</span>&nbsp;<span class="ident" id="4163483"><a href="/crypto/tls/handshake_client.go.html#4161762">ok</a></span>&nbsp;<span class="op" id="4163486">:=</span>&nbsp;<span class="ident" id="4163489"><a href="/crypto/tls/handshake_client.go.html#4161689">msg</a></span><span class="op" id="4163492">.</span><span class="op" id="4163493">(</span><span class="op" id="4163494">*</span><span class="ident" id="4163495"><a href="/crypto/tls/handshake_messages.go.html#4192159">serverKeyExchangeMsg</a></span><span class="op" id="4163515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163518">if</span>&nbsp;<span class="ident" id="4163521"><a href="/crypto/tls/handshake_client.go.html#4161762">ok</a></span>&nbsp;<span class="op" id="4163524">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163528"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4163530">.</span><span class="ident" id="4163531">finishedHash</span><span class="op" id="4163543">.</span><span class="ident" id="4163544">Write</span><span class="op" id="4163549">(</span><span class="ident" id="4163550"><a href="/crypto/tls/handshake_client.go.html#4163478">skx</a></span><span class="op" id="4163553">.</span><span class="ident" id="4163554">marshal</span><span class="op" id="4163561">(</span><span class="op" id="4163562">)</span><span class="op" id="4163563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163567"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4163571">=</span>&nbsp;<span class="ident" id="4163573"><a href="/crypto/tls/handshake_client.go.html#4163440">keyAgreement</a></span><span class="op" id="4163585">.</span><span class="ident" id="4163586">processServerKeyExchange</span><span class="op" id="4163610">(</span><span class="ident" id="4163611"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4163612">.</span><span class="ident" id="4163613">config</span><span class="op" id="4163619">,</span>&nbsp;<span class="ident" id="4163621"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4163623">.</span><span class="ident" id="4163624">hello</span><span class="op" id="4163629">,</span>&nbsp;<span class="ident" id="4163631"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4163633">.</span><span class="ident" id="4163634">serverHello</span><span class="op" id="4163645">,</span>&nbsp;<span class="ident" id="4163647"><a href="/crypto/tls/handshake_client.go.html#4161965">certs</a></span><span class="op" id="4163652">[</span><span class="num" id="4163653">0</span><span class="op" id="4163654">]</span><span class="op" id="4163655">,</span>&nbsp;<span class="ident" id="4163657"><a href="/crypto/tls/handshake_client.go.html#4163478">skx</a></span><span class="op" id="4163660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163664">if</span>&nbsp;<span class="ident" id="4163667"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4163671">!=</span>&nbsp;<span class="ident" id="4163674">nil</span>&nbsp;<span class="op" id="4163678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163683"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4163684">.</span><span class="ident" id="4163685">sendAlert</span><span class="op" id="4163694">(</span><span class="ident" id="4163695"><a href="/crypto/tls/alert.go.html#4095992">alertUnexpectedMessage</a></span><span class="op" id="4163717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163722">return</span>&nbsp;<span class="ident" id="4163729"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163740"><a href="/crypto/tls/handshake_client.go.html#4161689">msg</a></span><span class="op" id="4163743">,</span>&nbsp;<span class="ident" id="4163745"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4163749">=</span>&nbsp;<span class="ident" id="4163751"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4163752">.</span><span class="ident" id="4163753">readHandshake</span><span class="op" id="4163766">(</span><span class="op" id="4163767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163771">if</span>&nbsp;<span class="ident" id="4163774"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4163778">!=</span>&nbsp;<span class="ident" id="4163781">nil</span>&nbsp;<span class="op" id="4163785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163790">return</span>&nbsp;<span class="ident" id="4163797"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163810">var</span>&nbsp;<span class="ident" id="4163814">chainToSend</span>&nbsp;<span class="op" id="4163826">*</span><span class="ident" id="4163827"><a href="/crypto/tls/common.go.html#4123683">Certificate</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163840">var</span>&nbsp;<span class="ident" id="4163844">certRequested</span>&nbsp;<span class="builtintype" id="4163858">bool</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163864">certReq</span><span class="op" id="4163871">,</span>&nbsp;<span class="ident" id="4163873"><a href="/crypto/tls/handshake_client.go.html#4161762">ok</a></span>&nbsp;<span class="op" id="4163876">:=</span>&nbsp;<span class="ident" id="4163879"><a href="/crypto/tls/handshake_client.go.html#4161689">msg</a></span><span class="op" id="4163882">.</span><span class="op" id="4163883">(</span><span class="op" id="4163884">*</span><span class="ident" id="4163885"><a href="/crypto/tls/handshake_messages.go.html#4197001">certificateRequestMsg</a></span><span class="op" id="4163906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163909">if</span>&nbsp;<span class="ident" id="4163912"><a href="/crypto/tls/handshake_client.go.html#4161762">ok</a></span>&nbsp;<span class="op" id="4163915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163919"><a href="/crypto/tls/handshake_client.go.html#4163844">certRequested</a></span>&nbsp;<span class="op" id="4163933">=</span>&nbsp;<span class="ident" id="4163935">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4163943">//&nbsp;RFC&nbsp;4346&nbsp;on&nbsp;the&nbsp;certificateAuthorities&nbsp;field:</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4163994">//&nbsp;A&nbsp;list&nbsp;of&nbsp;the&nbsp;distinguished&nbsp;names&nbsp;of&nbsp;acceptable&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164059">//&nbsp;authorities.&nbsp;These&nbsp;distinguished&nbsp;names&nbsp;may&nbsp;specify&nbsp;a&nbsp;desired</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164125">//&nbsp;distinguished&nbsp;name&nbsp;for&nbsp;a&nbsp;root&nbsp;CA&nbsp;or&nbsp;for&nbsp;a&nbsp;subordinate&nbsp;CA;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164188">//&nbsp;thus,&nbsp;this&nbsp;message&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;describe&nbsp;both&nbsp;known&nbsp;roots</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164253">//&nbsp;and&nbsp;a&nbsp;desired&nbsp;authorization&nbsp;space.&nbsp;If&nbsp;the</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164300">//&nbsp;certificate_authorities&nbsp;list&nbsp;is&nbsp;empty&nbsp;then&nbsp;the&nbsp;client&nbsp;MAY</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164363">//&nbsp;send&nbsp;any&nbsp;certificate&nbsp;of&nbsp;the&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164408">//&nbsp;ClientCertificateType,&nbsp;unless&nbsp;there&nbsp;is&nbsp;some&nbsp;external</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164466">//&nbsp;arrangement&nbsp;to&nbsp;the&nbsp;contrary.</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164501"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4164503">.</span><span class="ident" id="4164504">finishedHash</span><span class="op" id="4164516">.</span><span class="ident" id="4164517">Write</span><span class="op" id="4164522">(</span><span class="ident" id="4164523"><a href="/crypto/tls/handshake_client.go.html#4163864">certReq</a></span><span class="op" id="4164530">.</span><span class="ident" id="4164531">marshal</span><span class="op" id="4164538">(</span><span class="op" id="4164539">)</span><span class="op" id="4164540">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164545">var</span>&nbsp;<span class="ident" id="4164549">rsaAvail</span><span class="op" id="4164557">,</span>&nbsp;<span class="ident" id="4164559">ecdsaAvail</span>&nbsp;<span class="builtintype" id="4164570">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164577">for</span>&nbsp;<span class="ident" id="4164581">_</span><span class="op" id="4164582">,</span>&nbsp;<span class="ident" id="4164584">certType</span>&nbsp;<span class="op" id="4164593">:=</span>&nbsp;<span class="keyword" id="4164596">range</span>&nbsp;<span class="ident" id="4164602"><a href="/crypto/tls/handshake_client.go.html#4163864">certReq</a></span><span class="op" id="4164609">.</span><span class="ident" id="4164610">certificateTypes</span>&nbsp;<span class="op" id="4164627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164632">switch</span>&nbsp;<span class="ident" id="4164639"><a href="/crypto/tls/handshake_client.go.html#4164584">certType</a></span>&nbsp;<span class="op" id="4164648">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164653">case</span>&nbsp;<span class="ident" id="4164658"><a href="/crypto/tls/common.go.html#4110439">certTypeRSASign</a></span><span class="op" id="4164673">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164679"><a href="/crypto/tls/handshake_client.go.html#4164549">rsaAvail</a></span>&nbsp;<span class="op" id="4164688">=</span>&nbsp;<span class="ident" id="4164690">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164698">case</span>&nbsp;<span class="ident" id="4164703"><a href="/crypto/tls/common.go.html#4110737">certTypeECDSASign</a></span><span class="op" id="4164720">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164726"><a href="/crypto/tls/handshake_client.go.html#4164559">ecdsaAvail</a></span>&nbsp;<span class="op" id="4164737">=</span>&nbsp;<span class="ident" id="4164739">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4164747">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4164751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164756">//&nbsp;We&nbsp;need&nbsp;to&nbsp;search&nbsp;our&nbsp;list&nbsp;of&nbsp;client&nbsp;certs&nbsp;for&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164812">//&nbsp;where&nbsp;SignatureAlgorithm&nbsp;is&nbsp;acceptable&nbsp;to&nbsp;the&nbsp;server&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4164878">//&nbsp;Issuer&nbsp;is&nbsp;in&nbsp;certReq.certificateAuthorities</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4164926">findCert</span><span class="op" id="4164934">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164938">for</span>&nbsp;<span class="ident" id="4164942">i</span><span class="op" id="4164943">,</span>&nbsp;<span class="ident" id="4164945">chain</span>&nbsp;<span class="op" id="4164951">:=</span>&nbsp;<span class="keyword" id="4164954">range</span>&nbsp;<span class="ident" id="4164960"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4164961">.</span><span class="ident" id="4164962">config</span><span class="op" id="4164968">.</span><span class="ident" id="4164969">Certificates</span>&nbsp;<span class="op" id="4164982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4164987">if</span>&nbsp;<span class="op" id="4164990">!</span><span class="ident" id="4164991"><a href="/crypto/tls/handshake_client.go.html#4164549">rsaAvail</a></span>&nbsp;<span class="op" id="4165000">&amp;&amp;</span>&nbsp;<span class="op" id="4165003">!</span><span class="ident" id="4165004"><a href="/crypto/tls/handshake_client.go.html#4164559">ecdsaAvail</a></span>&nbsp;<span class="op" id="4165015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165021">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4165033">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165039">for</span>&nbsp;<span class="ident" id="4165043">j</span><span class="op" id="4165044">,</span>&nbsp;<span class="ident" id="4165046">cert</span>&nbsp;<span class="op" id="4165051">:=</span>&nbsp;<span class="keyword" id="4165054">range</span>&nbsp;<span class="ident" id="4165060"><a href="/crypto/tls/handshake_client.go.html#4164945">chain</a></span><span class="op" id="4165065">.</span><span class="ident" id="4165066">Certificate</span>&nbsp;<span class="op" id="4165078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165084">x509Cert</span>&nbsp;<span class="op" id="4165093">:=</span>&nbsp;<span class="ident" id="4165096"><a href="/crypto/tls/handshake_client.go.html#4164945">chain</a></span><span class="op" id="4165101">.</span><span class="ident" id="4165102">Leaf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165111">//&nbsp;parse&nbsp;the&nbsp;certificate&nbsp;if&nbsp;this&nbsp;isn&#39;t&nbsp;the&nbsp;leaf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165163">//&nbsp;node,&nbsp;or&nbsp;if&nbsp;chain.Leaf&nbsp;was&nbsp;nil</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165201">if</span>&nbsp;<span class="ident" id="4165204"><a href="/crypto/tls/handshake_client.go.html#4165043">j</a></span>&nbsp;<span class="op" id="4165206">!=</span>&nbsp;<span class="num" id="4165209">0</span>&nbsp;<span class="op" id="4165211">||</span>&nbsp;<span class="ident" id="4165214"><a href="/crypto/tls/handshake_client.go.html#4165084">x509Cert</a></span>&nbsp;<span class="op" id="4165223">==</span>&nbsp;<span class="ident" id="4165226">nil</span>&nbsp;<span class="op" id="4165230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165237">if</span>&nbsp;<span class="ident" id="4165240"><a href="/crypto/tls/handshake_client.go.html#4165084">x509Cert</a></span><span class="op" id="4165248">,</span>&nbsp;<span class="ident" id="4165250"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4165254">=</span>&nbsp;<span class="ident" id="4165256"><a href="/crypto/tls/handshake_client.go.html#4156185">x509</a></span><span class="op" id="4165260">.</span><span class="ident" id="4165261">ParseCertificate</span><span class="op" id="4165277">(</span><span class="ident" id="4165278"><a href="/crypto/tls/handshake_client.go.html#4165046">cert</a></span><span class="op" id="4165282">)</span><span class="op" id="4165283">;</span>&nbsp;<span class="ident" id="4165285"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4165289">!=</span>&nbsp;<span class="ident" id="4165292">nil</span>&nbsp;<span class="op" id="4165296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165304"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4165305">.</span><span class="ident" id="4165306">sendAlert</span><span class="op" id="4165315">(</span><span class="ident" id="4165316"><a href="/crypto/tls/alert.go.html#4096712">alertInternalError</a></span><span class="op" id="4165334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165342">return</span>&nbsp;<span class="ident" id="4165349"><a href="/crypto/tls/handshake_client.go.html#4156200">errors</a></span><span class="op" id="4165355">.</span><span class="ident" id="4165356">New</span><span class="op" id="4165359">(</span><span class="string" id="4165360">&#34;tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;client&nbsp;certificate&nbsp;#&#34;</span>&nbsp;<span class="op" id="4165404">+</span>&nbsp;<span class="ident" id="4165406"><a href="/crypto/tls/handshake_client.go.html#4156230">strconv</a></span><span class="op" id="4165413">.</span><span class="ident" id="4165414">Itoa</span><span class="op" id="4165418">(</span><span class="ident" id="4165419"><a href="/crypto/tls/handshake_client.go.html#4164942">i</a></span><span class="op" id="4165420">)</span>&nbsp;<span class="op" id="4165422">+</span>&nbsp;<span class="string" id="4165424">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4165429">+</span>&nbsp;<span class="ident" id="4165431"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span><span class="op" id="4165434">.</span><span class="ident" id="4165435">Error</span><span class="op" id="4165440">(</span><span class="op" id="4165441">)</span><span class="op" id="4165442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4165449">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4165455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165462">switch</span>&nbsp;<span class="op" id="4165469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165475">case</span>&nbsp;<span class="ident" id="4165480"><a href="/crypto/tls/handshake_client.go.html#4164549">rsaAvail</a></span>&nbsp;<span class="op" id="4165489">&amp;&amp;</span>&nbsp;<span class="ident" id="4165492"><a href="/crypto/tls/handshake_client.go.html#4165084">x509Cert</a></span><span class="op" id="4165500">.</span><span class="ident" id="4165501">PublicKeyAlgorithm</span>&nbsp;<span class="op" id="4165520">==</span>&nbsp;<span class="ident" id="4165523"><a href="/crypto/tls/handshake_client.go.html#4156185">x509</a></span><span class="op" id="4165527">.</span><span class="ident" id="4165528">RSA</span><span class="op" id="4165531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165537">case</span>&nbsp;<span class="ident" id="4165542"><a href="/crypto/tls/handshake_client.go.html#4164559">ecdsaAvail</a></span>&nbsp;<span class="op" id="4165553">&amp;&amp;</span>&nbsp;<span class="ident" id="4165556"><a href="/crypto/tls/handshake_client.go.html#4165084">x509Cert</a></span><span class="op" id="4165564">.</span><span class="ident" id="4165565">PublicKeyAlgorithm</span>&nbsp;<span class="op" id="4165584">==</span>&nbsp;<span class="ident" id="4165587"><a href="/crypto/tls/handshake_client.go.html#4156185">x509</a></span><span class="op" id="4165591">.</span><span class="ident" id="4165592">ECDSA</span><span class="op" id="4165597">:</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165603">default</span><span class="op" id="4165610">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165617">continue</span>&nbsp;<span class="ident" id="4165626">findCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4165639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165646">if</span>&nbsp;<span class="builtinfunc" id="4165649">len</span><span class="op" id="4165652">(</span><span class="ident" id="4165653"><a href="/crypto/tls/handshake_client.go.html#4163864">certReq</a></span><span class="op" id="4165660">.</span><span class="ident" id="4165661">certificateAuthorities</span><span class="op" id="4165683">)</span>&nbsp;<span class="op" id="4165685">==</span>&nbsp;<span class="num" id="4165688">0</span>&nbsp;<span class="op" id="4165690">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165697">//&nbsp;they&nbsp;gave&nbsp;us&nbsp;an&nbsp;empty&nbsp;list,&nbsp;so&nbsp;just&nbsp;take&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4165750">//&nbsp;first&nbsp;cert&nbsp;from&nbsp;c.config.Certificates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165796"><a href="/crypto/tls/handshake_client.go.html#4163814">chainToSend</a></span>&nbsp;<span class="op" id="4165808">=</span>&nbsp;<span class="op" id="4165810">&amp;</span><span class="ident" id="4165811"><a href="/crypto/tls/handshake_client.go.html#4164945">chain</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165822">break</span>&nbsp;<span class="ident" id="4165828">findCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4165841">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165848">for</span>&nbsp;<span class="ident" id="4165852">_</span><span class="op" id="4165853">,</span>&nbsp;<span class="ident" id="4165855">ca</span>&nbsp;<span class="op" id="4165858">:=</span>&nbsp;<span class="keyword" id="4165861">range</span>&nbsp;<span class="ident" id="4165867"><a href="/crypto/tls/handshake_client.go.html#4163864">certReq</a></span><span class="op" id="4165874">.</span><span class="ident" id="4165875">certificateAuthorities</span>&nbsp;<span class="op" id="4165898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165905">if</span>&nbsp;<span class="ident" id="4165908"><a href="/crypto/tls/handshake_client.go.html#4156119">bytes</a></span><span class="op" id="4165913">.</span><span class="ident" id="4165914">Equal</span><span class="op" id="4165919">(</span><span class="ident" id="4165920"><a href="/crypto/tls/handshake_client.go.html#4165084">x509Cert</a></span><span class="op" id="4165928">.</span><span class="ident" id="4165929">RawIssuer</span><span class="op" id="4165938">,</span>&nbsp;<span class="ident" id="4165940"><a href="/crypto/tls/handshake_client.go.html#4165855">ca</a></span><span class="op" id="4165942">)</span>&nbsp;<span class="op" id="4165944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4165952"><a href="/crypto/tls/handshake_client.go.html#4163814">chainToSend</a></span>&nbsp;<span class="op" id="4165964">=</span>&nbsp;<span class="op" id="4165966">&amp;</span><span class="ident" id="4165967"><a href="/crypto/tls/handshake_client.go.html#4164945">chain</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4165979">break</span>&nbsp;<span class="ident" id="4165985">findCert</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4165999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166019"><a href="/crypto/tls/handshake_client.go.html#4161689">msg</a></span><span class="op" id="4166022">,</span>&nbsp;<span class="ident" id="4166024"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4166028">=</span>&nbsp;<span class="ident" id="4166030"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4166031">.</span><span class="ident" id="4166032">readHandshake</span><span class="op" id="4166045">(</span><span class="op" id="4166046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166050">if</span>&nbsp;<span class="ident" id="4166053"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4166057">!=</span>&nbsp;<span class="ident" id="4166060">nil</span>&nbsp;<span class="op" id="4166064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166069">return</span>&nbsp;<span class="ident" id="4166076"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166085">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166089">shd</span><span class="op" id="4166092">,</span>&nbsp;<span class="ident" id="4166094"><a href="/crypto/tls/handshake_client.go.html#4161762">ok</a></span>&nbsp;<span class="op" id="4166097">:=</span>&nbsp;<span class="ident" id="4166100"><a href="/crypto/tls/handshake_client.go.html#4161689">msg</a></span><span class="op" id="4166103">.</span><span class="op" id="4166104">(</span><span class="op" id="4166105">*</span><span class="ident" id="4166106"><a href="/crypto/tls/handshake_messages.go.html#4194114">serverHelloDoneMsg</a></span><span class="op" id="4166124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166127">if</span>&nbsp;<span class="op" id="4166130">!</span><span class="ident" id="4166131"><a href="/crypto/tls/handshake_client.go.html#4161762">ok</a></span>&nbsp;<span class="op" id="4166134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166138"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4166139">.</span><span class="ident" id="4166140">sendAlert</span><span class="op" id="4166149">(</span><span class="ident" id="4166150"><a href="/crypto/tls/alert.go.html#4095992">alertUnexpectedMessage</a></span><span class="op" id="4166172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166176">return</span>&nbsp;<span class="ident" id="4166183"><a href="/crypto/tls/common.go.html#4127007">unexpectedMessageError</a></span><span class="op" id="4166205">(</span><span class="ident" id="4166206"><a href="/crypto/tls/handshake_client.go.html#4166089">shd</a></span><span class="op" id="4166209">,</span>&nbsp;<span class="ident" id="4166211"><a href="/crypto/tls/handshake_client.go.html#4161689">msg</a></span><span class="op" id="4166214">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166220"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4166222">.</span><span class="ident" id="4166223">finishedHash</span><span class="op" id="4166235">.</span><span class="ident" id="4166236">Write</span><span class="op" id="4166241">(</span><span class="ident" id="4166242"><a href="/crypto/tls/handshake_client.go.html#4166089">shd</a></span><span class="op" id="4166245">.</span><span class="ident" id="4166246">marshal</span><span class="op" id="4166253">(</span><span class="op" id="4166254">)</span><span class="op" id="4166255">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4166259">//&nbsp;If&nbsp;the&nbsp;server&nbsp;requested&nbsp;a&nbsp;certificate&nbsp;then&nbsp;we&nbsp;have&nbsp;to&nbsp;send&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4166324">//&nbsp;Certificate&nbsp;message,&nbsp;even&nbsp;if&nbsp;it&#39;s&nbsp;empty&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4166392">//&nbsp;certificate&nbsp;to&nbsp;send.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166417">if</span>&nbsp;<span class="ident" id="4166420"><a href="/crypto/tls/handshake_client.go.html#4163844">certRequested</a></span>&nbsp;<span class="op" id="4166434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166438"><a href="/crypto/tls/handshake_client.go.html#4161753">certMsg</a></span>&nbsp;<span class="op" id="4166446">=</span>&nbsp;<span class="builtinfunc" id="4166448">new</span><span class="op" id="4166451">(</span><span class="ident" id="4166452"><a href="/crypto/tls/handshake_messages.go.html#4190456">certificateMsg</a></span><span class="op" id="4166466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166470">if</span>&nbsp;<span class="ident" id="4166473"><a href="/crypto/tls/handshake_client.go.html#4163814">chainToSend</a></span>&nbsp;<span class="op" id="4166485">!=</span>&nbsp;<span class="ident" id="4166488">nil</span>&nbsp;<span class="op" id="4166492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166497"><a href="/crypto/tls/handshake_client.go.html#4161753">certMsg</a></span><span class="op" id="4166504">.</span><span class="ident" id="4166505">certificates</span>&nbsp;<span class="op" id="4166518">=</span>&nbsp;<span class="ident" id="4166520"><a href="/crypto/tls/handshake_client.go.html#4163814">chainToSend</a></span><span class="op" id="4166531">.</span><span class="ident" id="4166532">Certificate</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166550"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4166552">.</span><span class="ident" id="4166553">finishedHash</span><span class="op" id="4166565">.</span><span class="ident" id="4166566">Write</span><span class="op" id="4166571">(</span><span class="ident" id="4166572"><a href="/crypto/tls/handshake_client.go.html#4161753">certMsg</a></span><span class="op" id="4166579">.</span><span class="ident" id="4166580">marshal</span><span class="op" id="4166587">(</span><span class="op" id="4166588">)</span><span class="op" id="4166589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166593"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4166594">.</span><span class="ident" id="4166595">writeRecord</span><span class="op" id="4166606">(</span><span class="ident" id="4166607"><a href="/crypto/tls/common.go.html#4108718">recordTypeHandshake</a></span><span class="op" id="4166626">,</span>&nbsp;<span class="ident" id="4166628"><a href="/crypto/tls/handshake_client.go.html#4161753">certMsg</a></span><span class="op" id="4166635">.</span><span class="ident" id="4166636">marshal</span><span class="op" id="4166643">(</span><span class="op" id="4166644">)</span><span class="op" id="4166645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166652">preMasterSecret</span><span class="op" id="4166667">,</span>&nbsp;<span class="ident" id="4166669">ckx</span><span class="op" id="4166672">,</span>&nbsp;<span class="ident" id="4166674"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4166678">:=</span>&nbsp;<span class="ident" id="4166681"><a href="/crypto/tls/handshake_client.go.html#4163440">keyAgreement</a></span><span class="op" id="4166693">.</span><span class="ident" id="4166694">generateClientKeyExchange</span><span class="op" id="4166719">(</span><span class="ident" id="4166720"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4166721">.</span><span class="ident" id="4166722">config</span><span class="op" id="4166728">,</span>&nbsp;<span class="ident" id="4166730"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4166732">.</span><span class="ident" id="4166733">hello</span><span class="op" id="4166738">,</span>&nbsp;<span class="ident" id="4166740"><a href="/crypto/tls/handshake_client.go.html#4161965">certs</a></span><span class="op" id="4166745">[</span><span class="num" id="4166746">0</span><span class="op" id="4166747">]</span><span class="op" id="4166748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166751">if</span>&nbsp;<span class="ident" id="4166754"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4166758">!=</span>&nbsp;<span class="ident" id="4166761">nil</span>&nbsp;<span class="op" id="4166765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166769"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4166770">.</span><span class="ident" id="4166771">sendAlert</span><span class="op" id="4166780">(</span><span class="ident" id="4166781"><a href="/crypto/tls/alert.go.html#4096712">alertInternalError</a></span><span class="op" id="4166799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166803">return</span>&nbsp;<span class="ident" id="4166810"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166815">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166818">if</span>&nbsp;<span class="ident" id="4166821"><a href="/crypto/tls/handshake_client.go.html#4166669">ckx</a></span>&nbsp;<span class="op" id="4166825">!=</span>&nbsp;<span class="ident" id="4166828">nil</span>&nbsp;<span class="op" id="4166832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166836"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4166838">.</span><span class="ident" id="4166839">finishedHash</span><span class="op" id="4166851">.</span><span class="ident" id="4166852">Write</span><span class="op" id="4166857">(</span><span class="ident" id="4166858"><a href="/crypto/tls/handshake_client.go.html#4166669">ckx</a></span><span class="op" id="4166861">.</span><span class="ident" id="4166862">marshal</span><span class="op" id="4166869">(</span><span class="op" id="4166870">)</span><span class="op" id="4166871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166875"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4166876">.</span><span class="ident" id="4166877">writeRecord</span><span class="op" id="4166888">(</span><span class="ident" id="4166889"><a href="/crypto/tls/common.go.html#4108718">recordTypeHandshake</a></span><span class="op" id="4166908">,</span>&nbsp;<span class="ident" id="4166910"><a href="/crypto/tls/handshake_client.go.html#4166669">ckx</a></span><span class="op" id="4166913">.</span><span class="ident" id="4166914">marshal</span><span class="op" id="4166921">(</span><span class="op" id="4166922">)</span><span class="op" id="4166923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4166926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166930">if</span>&nbsp;<span class="ident" id="4166933"><a href="/crypto/tls/handshake_client.go.html#4163814">chainToSend</a></span>&nbsp;<span class="op" id="4166945">!=</span>&nbsp;<span class="ident" id="4166948">nil</span>&nbsp;<span class="op" id="4166952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4166956">var</span>&nbsp;<span class="ident" id="4166960">signed</span>&nbsp;<span class="op" id="4166967">[</span><span class="op" id="4166968">]</span><span class="builtintype" id="4166969">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4166976">certVerify</span>&nbsp;<span class="op" id="4166987">:=</span>&nbsp;<span class="op" id="4166990">&amp;</span><span class="ident" id="4166991"><a href="/crypto/tls/handshake_messages.go.html#4200426">certificateVerifyMsg</a></span><span class="op" id="4167011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167016">hasSignatureAndHash</span><span class="op" id="4167035">:</span>&nbsp;<span class="ident" id="4167037"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4167038">.</span><span class="ident" id="4167039">vers</span>&nbsp;<span class="op" id="4167044">&gt;=</span>&nbsp;<span class="ident" id="4167047"><a href="/crypto/tls/common.go.html#4108205">VersionTLS12</a></span><span class="op" id="4167059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167063">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167068">key</span><span class="op" id="4167071">,</span>&nbsp;<span class="ident" id="4167073">ok</span>&nbsp;<span class="op" id="4167076">:=</span>&nbsp;<span class="ident" id="4167079"><a href="/crypto/tls/handshake_client.go.html#4163814">chainToSend</a></span><span class="op" id="4167090">.</span><span class="ident" id="4167091">PrivateKey</span><span class="op" id="4167101">.</span><span class="op" id="4167102">(</span><span class="ident" id="4167103"><a href="/crypto/tls/handshake_client.go.html#4156128">crypto</a></span><span class="op" id="4167109">.</span><span class="ident" id="4167110">Signer</span><span class="op" id="4167116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167120">if</span>&nbsp;<span class="op" id="4167123">!</span><span class="ident" id="4167124"><a href="/crypto/tls/handshake_client.go.html#4167073">ok</a></span>&nbsp;<span class="op" id="4167127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167132"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4167133">.</span><span class="ident" id="4167134">sendAlert</span><span class="op" id="4167143">(</span><span class="ident" id="4167144"><a href="/crypto/tls/alert.go.html#4096712">alertInternalError</a></span><span class="op" id="4167162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167167">return</span>&nbsp;<span class="ident" id="4167174"><a href="/crypto/tls/handshake_client.go.html#4156210">fmt</a></span><span class="op" id="4167177">.</span><span class="ident" id="4167178">Errorf</span><span class="op" id="4167184">(</span><span class="string" id="4167185">&#34;tls:&nbsp;client&nbsp;certificate&nbsp;private&nbsp;key&nbsp;of&nbsp;type&nbsp;%T&nbsp;does&nbsp;not&nbsp;implement&nbsp;crypto.Signer&#34;</span><span class="op" id="4167266">,</span>&nbsp;<span class="ident" id="4167268"><a href="/crypto/tls/handshake_client.go.html#4163814">chainToSend</a></span><span class="op" id="4167279">.</span><span class="ident" id="4167280">PrivateKey</span><span class="op" id="4167290">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167298">switch</span>&nbsp;<span class="ident" id="4167305"><a href="/crypto/tls/handshake_client.go.html#4167068">key</a></span><span class="op" id="4167308">.</span><span class="ident" id="4167309">Public</span><span class="op" id="4167315">(</span><span class="op" id="4167316">)</span><span class="op" id="4167317">.</span><span class="op" id="4167318">(</span><span class="keyword" id="4167319">type</span><span class="op" id="4167323">)</span>&nbsp;<span class="op" id="4167325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167329">case</span>&nbsp;<span class="op" id="4167334">*</span><span class="ident" id="4167335"><a href="/crypto/tls/handshake_client.go.html#4156138">ecdsa</a></span><span class="op" id="4167340">.</span><span class="ident" id="4167341">PublicKey</span><span class="op" id="4167350">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167355">digest</span><span class="op" id="4167361">,</span>&nbsp;<span class="ident" id="4167363">hashFunc</span><span class="op" id="4167371">,</span>&nbsp;<span class="ident" id="4167373">hashId</span>&nbsp;<span class="op" id="4167380">:=</span>&nbsp;<span class="ident" id="4167383"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4167385">.</span><span class="ident" id="4167386">finishedHash</span><span class="op" id="4167398">.</span><span class="ident" id="4167399">hashForClientCertificate</span><span class="op" id="4167423">(</span><span class="ident" id="4167424"><a href="/crypto/tls/common.go.html#4111314">signatureECDSA</a></span><span class="op" id="4167438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167443"><a href="/crypto/tls/handshake_client.go.html#4166960">signed</a></span><span class="op" id="4167449">,</span>&nbsp;<span class="ident" id="4167451"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4167455">=</span>&nbsp;<span class="ident" id="4167457"><a href="/crypto/tls/handshake_client.go.html#4167068">key</a></span><span class="op" id="4167460">.</span><span class="ident" id="4167461">Sign</span><span class="op" id="4167465">(</span><span class="ident" id="4167466"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4167467">.</span><span class="ident" id="4167468">config</span><span class="op" id="4167474">.</span><span class="ident" id="4167475">rand</span><span class="op" id="4167479">(</span><span class="op" id="4167480">)</span><span class="op" id="4167481">,</span>&nbsp;<span class="ident" id="4167483"><a href="/crypto/tls/handshake_client.go.html#4167355">digest</a></span><span class="op" id="4167489">,</span>&nbsp;<span class="ident" id="4167491"><a href="/crypto/tls/handshake_client.go.html#4167363">hashFunc</a></span><span class="op" id="4167499">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167504"><a href="/crypto/tls/handshake_client.go.html#4166976">certVerify</a></span><span class="op" id="4167514">.</span><span class="ident" id="4167515">signatureAndHash</span><span class="op" id="4167531">.</span><span class="ident" id="4167532">signature</span>&nbsp;<span class="op" id="4167542">=</span>&nbsp;<span class="ident" id="4167544"><a href="/crypto/tls/common.go.html#4111314">signatureECDSA</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167562"><a href="/crypto/tls/handshake_client.go.html#4166976">certVerify</a></span><span class="op" id="4167572">.</span><span class="ident" id="4167573">signatureAndHash</span><span class="op" id="4167589">.</span><span class="ident" id="4167590">hash</span>&nbsp;<span class="op" id="4167595">=</span>&nbsp;<span class="ident" id="4167597"><a href="/crypto/tls/handshake_client.go.html#4167373">hashId</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167606">case</span>&nbsp;<span class="op" id="4167611">*</span><span class="ident" id="4167612"><a href="/crypto/tls/handshake_client.go.html#4156154">rsa</a></span><span class="op" id="4167615">.</span><span class="ident" id="4167616">PublicKey</span><span class="op" id="4167625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167630">digest</span><span class="op" id="4167636">,</span>&nbsp;<span class="ident" id="4167638">hashFunc</span><span class="op" id="4167646">,</span>&nbsp;<span class="ident" id="4167648">hashId</span>&nbsp;<span class="op" id="4167655">:=</span>&nbsp;<span class="ident" id="4167658"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4167660">.</span><span class="ident" id="4167661">finishedHash</span><span class="op" id="4167673">.</span><span class="ident" id="4167674">hashForClientCertificate</span><span class="op" id="4167698">(</span><span class="ident" id="4167699"><a href="/crypto/tls/common.go.html#4111288">signatureRSA</a></span><span class="op" id="4167711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167716"><a href="/crypto/tls/handshake_client.go.html#4166960">signed</a></span><span class="op" id="4167722">,</span>&nbsp;<span class="ident" id="4167724"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4167728">=</span>&nbsp;<span class="ident" id="4167730"><a href="/crypto/tls/handshake_client.go.html#4167068">key</a></span><span class="op" id="4167733">.</span><span class="ident" id="4167734">Sign</span><span class="op" id="4167738">(</span><span class="ident" id="4167739"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4167740">.</span><span class="ident" id="4167741">config</span><span class="op" id="4167747">.</span><span class="ident" id="4167748">rand</span><span class="op" id="4167752">(</span><span class="op" id="4167753">)</span><span class="op" id="4167754">,</span>&nbsp;<span class="ident" id="4167756"><a href="/crypto/tls/handshake_client.go.html#4167630">digest</a></span><span class="op" id="4167762">,</span>&nbsp;<span class="ident" id="4167764"><a href="/crypto/tls/handshake_client.go.html#4167638">hashFunc</a></span><span class="op" id="4167772">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167777"><a href="/crypto/tls/handshake_client.go.html#4166976">certVerify</a></span><span class="op" id="4167787">.</span><span class="ident" id="4167788">signatureAndHash</span><span class="op" id="4167804">.</span><span class="ident" id="4167805">signature</span>&nbsp;<span class="op" id="4167815">=</span>&nbsp;<span class="ident" id="4167817"><a href="/crypto/tls/common.go.html#4111288">signatureRSA</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167833"><a href="/crypto/tls/handshake_client.go.html#4166976">certVerify</a></span><span class="op" id="4167843">.</span><span class="ident" id="4167844">signatureAndHash</span><span class="op" id="4167860">.</span><span class="ident" id="4167861">hash</span>&nbsp;<span class="op" id="4167866">=</span>&nbsp;<span class="ident" id="4167868"><a href="/crypto/tls/handshake_client.go.html#4167648">hashId</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167877">default</span><span class="op" id="4167884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167889"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4167893">=</span>&nbsp;<span class="ident" id="4167895"><a href="/crypto/tls/handshake_client.go.html#4156210">fmt</a></span><span class="op" id="4167898">.</span><span class="ident" id="4167899">Errorf</span><span class="op" id="4167905">(</span><span class="string" id="4167906">&#34;tls:&nbsp;unknown&nbsp;client&nbsp;certificate&nbsp;key&nbsp;type:&nbsp;%T&#34;</span><span class="op" id="4167952">,</span>&nbsp;<span class="ident" id="4167954"><a href="/crypto/tls/handshake_client.go.html#4167068">key</a></span><span class="op" id="4167957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4167961">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4167965">if</span>&nbsp;<span class="ident" id="4167968"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span>&nbsp;<span class="op" id="4167972">!=</span>&nbsp;<span class="ident" id="4167975">nil</span>&nbsp;<span class="op" id="4167979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4167984"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4167985">.</span><span class="ident" id="4167986">sendAlert</span><span class="op" id="4167995">(</span><span class="ident" id="4167996"><a href="/crypto/tls/alert.go.html#4096712">alertInternalError</a></span><span class="op" id="4168014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168019">return</span>&nbsp;<span class="ident" id="4168026"><a href="/crypto/tls/handshake_client.go.html#4156200">errors</a></span><span class="op" id="4168032">.</span><span class="ident" id="4168033">New</span><span class="op" id="4168036">(</span><span class="string" id="4168037">&#34;tls:&nbsp;failed&nbsp;to&nbsp;sign&nbsp;handshake&nbsp;with&nbsp;client&nbsp;certificate:&nbsp;&#34;</span>&nbsp;<span class="op" id="4168095">+</span>&nbsp;<span class="ident" id="4168097"><a href="/crypto/tls/handshake_client.go.html#4161694">err</a></span><span class="op" id="4168100">.</span><span class="ident" id="4168101">Error</span><span class="op" id="4168106">(</span><span class="op" id="4168107">)</span><span class="op" id="4168108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4168112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168116"><a href="/crypto/tls/handshake_client.go.html#4166976">certVerify</a></span><span class="op" id="4168126">.</span><span class="ident" id="4168127">signature</span>&nbsp;<span class="op" id="4168137">=</span>&nbsp;<span class="ident" id="4168139"><a href="/crypto/tls/handshake_client.go.html#4166960">signed</a></span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168149"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4168151">.</span><span class="ident" id="4168152">finishedHash</span><span class="op" id="4168164">.</span><span class="ident" id="4168165">Write</span><span class="op" id="4168170">(</span><span class="ident" id="4168171"><a href="/crypto/tls/handshake_client.go.html#4166976">certVerify</a></span><span class="op" id="4168181">.</span><span class="ident" id="4168182">marshal</span><span class="op" id="4168189">(</span><span class="op" id="4168190">)</span><span class="op" id="4168191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168195"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4168196">.</span><span class="ident" id="4168197">writeRecord</span><span class="op" id="4168208">(</span><span class="ident" id="4168209"><a href="/crypto/tls/common.go.html#4108718">recordTypeHandshake</a></span><span class="op" id="4168228">,</span>&nbsp;<span class="ident" id="4168230"><a href="/crypto/tls/handshake_client.go.html#4166976">certVerify</a></span><span class="op" id="4168240">.</span><span class="ident" id="4168241">marshal</span><span class="op" id="4168248">(</span><span class="op" id="4168249">)</span><span class="op" id="4168250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4168253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168257"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4168259">.</span><span class="ident" id="4168260">masterSecret</span>&nbsp;<span class="op" id="4168273">=</span>&nbsp;<span class="ident" id="4168275"><a href="/crypto/tls/prf.go.html#4239699">masterFromPreMasterSecret</a></span><span class="op" id="4168300">(</span><span class="ident" id="4168301"><a href="/crypto/tls/handshake_client.go.html#4161677">c</a></span><span class="op" id="4168302">.</span><span class="ident" id="4168303">vers</span><span class="op" id="4168307">,</span>&nbsp;<span class="ident" id="4168309"><a href="/crypto/tls/handshake_client.go.html#4166652">preMasterSecret</a></span><span class="op" id="4168324">,</span>&nbsp;<span class="ident" id="4168326"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4168328">.</span><span class="ident" id="4168329">hello</span><span class="op" id="4168334">.</span><span class="ident" id="4168335">random</span><span class="op" id="4168341">,</span>&nbsp;<span class="ident" id="4168343"><a href="/crypto/tls/handshake_client.go.html#4161624">hs</a></span><span class="op" id="4168345">.</span><span class="ident" id="4168346">serverHello</span><span class="op" id="4168357">.</span><span class="ident" id="4168358">random</span><span class="op" id="4168364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168367">return</span>&nbsp;<span class="ident" id="4168374">nil</span><br>
<span class="lineno"></span><span class="op" id="4168378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4168381">func</span>&nbsp;<span class="op" id="4168386">(</span><span class="ident" id="4168387">hs</span>&nbsp;<span class="op" id="4168390">*</span><span class="ident" id="4168391"><a href="/crypto/tls/handshake_client.go.html#4156248">clientHandshakeState</a></span><span class="op" id="4168411">)</span>&nbsp;<span class="ident" id="4168413">establishKeys</span><span class="op" id="4168426">(</span><span class="op" id="4168427">)</span>&nbsp;<span class="builtintype" id="4168429">error</span>&nbsp;<span class="op" id="4168435">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168438">c</span>&nbsp;<span class="op" id="4168440">:=</span>&nbsp;<span class="ident" id="4168443"><a href="/crypto/tls/handshake_client.go.html#4168387">hs</a></span><span class="op" id="4168445">.</span><span class="ident" id="4168446">c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168450">clientMAC</span><span class="op" id="4168459">,</span>&nbsp;<span class="ident" id="4168461">serverMAC</span><span class="op" id="4168470">,</span>&nbsp;<span class="ident" id="4168472">clientKey</span><span class="op" id="4168481">,</span>&nbsp;<span class="ident" id="4168483">serverKey</span><span class="op" id="4168492">,</span>&nbsp;<span class="ident" id="4168494">clientIV</span><span class="op" id="4168502">,</span>&nbsp;<span class="ident" id="4168504">serverIV</span>&nbsp;<span class="op" id="4168513">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168518"><a href="/crypto/tls/prf.go.html#4240268">keysFromMasterSecret</a></span><span class="op" id="4168538">(</span><span class="ident" id="4168539"><a href="/crypto/tls/handshake_client.go.html#4168438">c</a></span><span class="op" id="4168540">.</span><span class="ident" id="4168541">vers</span><span class="op" id="4168545">,</span>&nbsp;<span class="ident" id="4168547"><a href="/crypto/tls/handshake_client.go.html#4168387">hs</a></span><span class="op" id="4168549">.</span><span class="ident" id="4168550">masterSecret</span><span class="op" id="4168562">,</span>&nbsp;<span class="ident" id="4168564"><a href="/crypto/tls/handshake_client.go.html#4168387">hs</a></span><span class="op" id="4168566">.</span><span class="ident" id="4168567">hello</span><span class="op" id="4168572">.</span><span class="ident" id="4168573">random</span><span class="op" id="4168579">,</span>&nbsp;<span class="ident" id="4168581"><a href="/crypto/tls/handshake_client.go.html#4168387">hs</a></span><span class="op" id="4168583">.</span><span class="ident" id="4168584">serverHello</span><span class="op" id="4168595">.</span><span class="ident" id="4168596">random</span><span class="op" id="4168602">,</span>&nbsp;<span class="ident" id="4168604"><a href="/crypto/tls/handshake_client.go.html#4168387">hs</a></span><span class="op" id="4168606">.</span><span class="ident" id="4168607">suite</span><span class="op" id="4168612">.</span><span class="ident" id="4168613">macLen</span><span class="op" id="4168619">,</span>&nbsp;<span class="ident" id="4168621"><a href="/crypto/tls/handshake_client.go.html#4168387">hs</a></span><span class="op" id="4168623">.</span><span class="ident" id="4168624">suite</span><span class="op" id="4168629">.</span><span class="ident" id="4168630">keyLen</span><span class="op" id="4168636">,</span>&nbsp;<span class="ident" id="4168638"><a href="/crypto/tls/handshake_client.go.html#4168387">hs</a></span><span class="op" id="4168640">.</span><span class="ident" id="4168641">suite</span><span class="op" id="4168646">.</span><span class="ident" id="4168647">ivLen</span><span class="op" id="4168652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168655">var</span>&nbsp;<span class="ident" id="4168659">clientCipher</span><span class="op" id="4168671">,</span>&nbsp;<span class="ident" id="4168673">serverCipher</span>&nbsp;<span class="keyword" id="4168686">interface</span><span class="op" id="4168695">{</span><span class="op" id="4168696">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168699">var</span>&nbsp;<span class="ident" id="4168703">clientHash</span><span class="op" id="4168713">,</span>&nbsp;<span class="ident" id="4168715">serverHash</span>&nbsp;<span class="ident" id="4168726"><a href="/crypto/tls/cipher_suites.go.html#4103068">macFunction</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4168739">if</span>&nbsp;<span class="ident" id="4168742"><a href="/crypto/tls/handshake_client.go.html#4168387">hs</a></span><span class="op" id="4168744">.</span><span class="ident" id="4168745">suite</span><span class="op" id="4168750">.</span><span class="ident" id="4168751">cipher</span>&nbsp;<span class="op" id="4168758">!=</span>&nbsp;<span class="ident" id="4168761">nil</span>&nbsp;<span class="op" id="4168765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168769"><a href="/crypto/tls/handshake_client.go.html#4168659">clientCipher</a></span>&nbsp;<span class="op" id="4168782">=</span>&nbsp;<span class="ident" id="4168784"><a href="/crypto/tls/handshake_client.go.html#4168387">hs</a></span><span class="op" id="4168786">.</span><span class="ident" id="4168787">suite</span><span class="op" id="4168792">.</span><span class="ident" id="4168793">cipher</span><span class="op" id="4168799">(</span><span class="ident" id="4168800"><a href="/crypto/tls/handshake_client.go.html#4168472">clientKey</a></span><span class="op" id="4168809">,</span>&nbsp;<span class="ident" id="4168811"><a href="/crypto/tls/handshake_client.go.html#4168494">clientIV</a></span><span class="op" id="4168819">,</span>&nbsp;<span class="ident" id="4168821">false</span>&nbsp;<span class="comment" id="4168827">/*&nbsp;not&nbsp;for&nbsp;reading&nbsp;*/</span><span class="op" id="4168848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168852"><a href="/crypto/tls/handshake_client.go.html#4168703">clientHash</a></span>&nbsp;<span class="op" id="4168863">=</span>&nbsp;<span class="ident" id="4168865"><a href="/crypto/tls/handshake_client.go.html#4168387">hs</a></span><span class="op" id="4168867">.</span><span class="ident" id="4168868">suite</span><span class="op" id="4168873">.</span><span class="ident" id="4168874">mac</span><span class="op" id="4168877">(</span><span class="ident" id="4168878"><a href="/crypto/tls/handshake_client.go.html#4168438">c</a></span><span class="op" id="4168879">.</span><span class="ident" id="4168880">vers</span><span class="op" id="4168884">,</span>&nbsp;<span class="ident" id="4168886"><a href="/crypto/tls/handshake_client.go.html#4168450">clientMAC</a></span><span class="op" id="4168895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168899"><a href="/crypto/tls/handshake_client.go.html#4168673">serverCipher</a></span>&nbsp;<span class="op" id="4168912">=</span>&nbsp;<span class="ident" id="4168914"><a href="/crypto/tls/handshake_client.go.html#4168387">hs</a></span><span class="op" id="4168916">.</span><span class="ident" id="4168917">suite</span><span class="op" id="4168922">.</span><span class="ident" id="4168923">cipher</span><span class="op" id="4168929">(</span><span class="ident" id="4168930"><a href="/crypto/tls/handshake_client.go.html#4168483">serverKey</a></span><span class="op" id="4168939">,</span>&nbsp;<span class="ident" id="4168941"><a href="/crypto/tls/handshake_client.go.html#4168504">serverIV</a></span><span class="op" id="4168949">,</span>&nbsp;<span class="ident" id="4168951">true</span>&nbsp;<span class="comment" id="4168956">/*&nbsp;for&nbsp;reading&nbsp;*/</span><span class="op" id="4168973">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4168977"><a href="/crypto/tls/handshake_client.go.html#4168715">serverHash</a></span>&nbsp;<span class="op" id="4168988">=</span>&nbsp;<span class="ident" id="4168990"><a href="/crypto/tls/handshake_client.go.html#4168387">hs</a></span><span class="op" id="4168992">.</span><span class="ident" id="4168993">suite</span><span class="op" id="4168998">.</span><span class="ident" id="4168999">mac</span><span class="op" id="4169002">(</span><span class="ident" id="4169003"><a href="/crypto/tls/handshake_client.go.html#4168438">c</a></span><span class="op" id="4169004">.</span><span class="ident" id="4169005">vers</span><span class="op" id="4169009">,</span>&nbsp;<span class="ident" id="4169011"><a href="/crypto/tls/handshake_client.go.html#4168461">serverMAC</a></span><span class="op" id="4169020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4169023">}</span>&nbsp;<span class="keyword" id="4169025">else</span>&nbsp;<span class="op" id="4169030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169034"><a href="/crypto/tls/handshake_client.go.html#4168659">clientCipher</a></span>&nbsp;<span class="op" id="4169047">=</span>&nbsp;<span class="ident" id="4169049"><a href="/crypto/tls/handshake_client.go.html#4168387">hs</a></span><span class="op" id="4169051">.</span><span class="ident" id="4169052">suite</span><span class="op" id="4169057">.</span><span class="ident" id="4169058">aead</span><span class="op" id="4169062">(</span><span class="ident" id="4169063"><a href="/crypto/tls/handshake_client.go.html#4168472">clientKey</a></span><span class="op" id="4169072">,</span>&nbsp;<span class="ident" id="4169074"><a href="/crypto/tls/handshake_client.go.html#4168494">clientIV</a></span><span class="op" id="4169082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169086"><a href="/crypto/tls/handshake_client.go.html#4168673">serverCipher</a></span>&nbsp;<span class="op" id="4169099">=</span>&nbsp;<span class="ident" id="4169101"><a href="/crypto/tls/handshake_client.go.html#4168387">hs</a></span><span class="op" id="4169103">.</span><span class="ident" id="4169104">suite</span><span class="op" id="4169109">.</span><span class="ident" id="4169110">aead</span><span class="op" id="4169114">(</span><span class="ident" id="4169115"><a href="/crypto/tls/handshake_client.go.html#4168483">serverKey</a></span><span class="op" id="4169124">,</span>&nbsp;<span class="ident" id="4169126"><a href="/crypto/tls/handshake_client.go.html#4168504">serverIV</a></span><span class="op" id="4169134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4169137">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169141"><a href="/crypto/tls/handshake_client.go.html#4168438">c</a></span><span class="op" id="4169142">.</span><span class="ident" id="4169143">in</span><span class="op" id="4169145">.</span><span class="ident" id="4169146">prepareCipherSpec</span><span class="op" id="4169163">(</span><span class="ident" id="4169164"><a href="/crypto/tls/handshake_client.go.html#4168438">c</a></span><span class="op" id="4169165">.</span><span class="ident" id="4169166">vers</span><span class="op" id="4169170">,</span>&nbsp;<span class="ident" id="4169172"><a href="/crypto/tls/handshake_client.go.html#4168673">serverCipher</a></span><span class="op" id="4169184">,</span>&nbsp;<span class="ident" id="4169186"><a href="/crypto/tls/handshake_client.go.html#4168715">serverHash</a></span><span class="op" id="4169196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169199"><a href="/crypto/tls/handshake_client.go.html#4168438">c</a></span><span class="op" id="4169200">.</span><span class="ident" id="4169201">out</span><span class="op" id="4169204">.</span><span class="ident" id="4169205">prepareCipherSpec</span><span class="op" id="4169222">(</span><span class="ident" id="4169223"><a href="/crypto/tls/handshake_client.go.html#4168438">c</a></span><span class="op" id="4169224">.</span><span class="ident" id="4169225">vers</span><span class="op" id="4169229">,</span>&nbsp;<span class="ident" id="4169231"><a href="/crypto/tls/handshake_client.go.html#4168659">clientCipher</a></span><span class="op" id="4169243">,</span>&nbsp;<span class="ident" id="4169245"><a href="/crypto/tls/handshake_client.go.html#4168703">clientHash</a></span><span class="op" id="4169255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169258">return</span>&nbsp;<span class="ident" id="4169265">nil</span><br>
<span class="lineno"></span><span class="op" id="4169269">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="keyword" id="4169272">func</span>&nbsp;<span class="op" id="4169277">(</span><span class="ident" id="4169278">hs</span>&nbsp;<span class="op" id="4169281">*</span><span class="ident" id="4169282"><a href="/crypto/tls/handshake_client.go.html#4156248">clientHandshakeState</a></span><span class="op" id="4169302">)</span>&nbsp;<span class="ident" id="4169304">serverResumedSession</span><span class="op" id="4169324">(</span><span class="op" id="4169325">)</span>&nbsp;<span class="builtintype" id="4169327">bool</span>&nbsp;<span class="op" id="4169332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4169335">//&nbsp;If&nbsp;the&nbsp;server&nbsp;responded&nbsp;with&nbsp;the&nbsp;same&nbsp;sessionId&nbsp;then&nbsp;it&nbsp;means&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4169405">//&nbsp;sessionTicket&nbsp;is&nbsp;being&nbsp;used&nbsp;to&nbsp;resume&nbsp;a&nbsp;TLS&nbsp;session.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169462">return</span>&nbsp;<span class="ident" id="4169469"><a href="/crypto/tls/handshake_client.go.html#4169278">hs</a></span><span class="op" id="4169471">.</span><span class="ident" id="4169472">session</span>&nbsp;<span class="op" id="4169480">!=</span>&nbsp;<span class="ident" id="4169483">nil</span>&nbsp;<span class="op" id="4169487">&amp;&amp;</span>&nbsp;<span class="ident" id="4169490"><a href="/crypto/tls/handshake_client.go.html#4169278">hs</a></span><span class="op" id="4169492">.</span><span class="ident" id="4169493">hello</span><span class="op" id="4169498">.</span><span class="ident" id="4169499">sessionId</span>&nbsp;<span class="op" id="4169509">!=</span>&nbsp;<span class="ident" id="4169512">nil</span>&nbsp;<span class="op" id="4169516">&amp;&amp;</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169521"><a href="/crypto/tls/handshake_client.go.html#4156119">bytes</a></span><span class="op" id="4169526">.</span><span class="ident" id="4169527">Equal</span><span class="op" id="4169532">(</span><span class="ident" id="4169533"><a href="/crypto/tls/handshake_client.go.html#4169278">hs</a></span><span class="op" id="4169535">.</span><span class="ident" id="4169536">serverHello</span><span class="op" id="4169547">.</span><span class="ident" id="4169548">sessionId</span><span class="op" id="4169557">,</span>&nbsp;<span class="ident" id="4169559"><a href="/crypto/tls/handshake_client.go.html#4169278">hs</a></span><span class="op" id="4169561">.</span><span class="ident" id="4169562">hello</span><span class="op" id="4169567">.</span><span class="ident" id="4169568">sessionId</span><span class="op" id="4169577">)</span><br>
<span class="lineno"></span><span class="op" id="4169579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4169582">func</span>&nbsp;<span class="op" id="4169587">(</span><span class="ident" id="4169588">hs</span>&nbsp;<span class="op" id="4169591">*</span><span class="ident" id="4169592"><a href="/crypto/tls/handshake_client.go.html#4156248">clientHandshakeState</a></span><span class="op" id="4169612">)</span>&nbsp;<span class="ident" id="4169614">processServerHello</span><span class="op" id="4169632">(</span><span class="op" id="4169633">)</span>&nbsp;<span class="op" id="4169635">(</span><span class="builtintype" id="4169636">bool</span><span class="op" id="4169640">,</span>&nbsp;<span class="builtintype" id="4169642">error</span><span class="op" id="4169647">)</span>&nbsp;<span class="op" id="4169649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169652">c</span>&nbsp;<span class="op" id="4169654">:=</span>&nbsp;<span class="ident" id="4169657"><a href="/crypto/tls/handshake_client.go.html#4169588">hs</a></span><span class="op" id="4169659">.</span><span class="ident" id="4169660">c</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169664">if</span>&nbsp;<span class="ident" id="4169667"><a href="/crypto/tls/handshake_client.go.html#4169588">hs</a></span><span class="op" id="4169669">.</span><span class="ident" id="4169670">serverHello</span><span class="op" id="4169681">.</span><span class="ident" id="4169682">compressionMethod</span>&nbsp;<span class="op" id="4169700">!=</span>&nbsp;<span class="ident" id="4169703"><a href="/crypto/tls/common.go.html#4109324">compressionNone</a></span>&nbsp;<span class="op" id="4169719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169723"><a href="/crypto/tls/handshake_client.go.html#4169652">c</a></span><span class="op" id="4169724">.</span><span class="ident" id="4169725">sendAlert</span><span class="op" id="4169734">(</span><span class="ident" id="4169735"><a href="/crypto/tls/alert.go.html#4095992">alertUnexpectedMessage</a></span><span class="op" id="4169757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4169761">return</span>&nbsp;<span class="ident" id="4169768">false</span><span class="op" id="4169773">,</span>&nbsp;<span class="ident" id="4169775"><a href="/crypto/tls/handshake_client.go.html#4156200">errors</a></span><span class="op" id="4169781">.</span><span class="ident" id="4169782">New</span><span class="op" id="4169785">(</span><span class="string" id="4169786">&#34;tls:&nbsp;server&nbsp;selected&nbsp;unsupported&nbsp;compression&nbsp;format&#34;</span><span class="op" id="4169839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4169842">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169846">clientDidNPN</span>&nbsp;<span class="op" id="4169859">:=</span>&nbsp;<span class="ident" id="4169862"><a href="/crypto/tls/handshake_client.go.html#4169588">hs</a></span><span class="op" id="4169864">.</span><span class="ident" id="4169865">hello</span><span class="op" id="4169870">.</span><span class="ident" id="4169871">nextProtoNeg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169885">clientDidALPN</span>&nbsp;<span class="op" id="4169899">:=</span>&nbsp;<span class="builtinfunc" id="4169902">len</span><span class="op" id="4169905">(</span><span class="ident" id="4169906"><a href="/crypto/tls/handshake_client.go.html#4169588">hs</a></span><span class="op" id="4169908">.</span><span class="ident" id="4169909">hello</span><span class="op" id="4169914">.</span><span class="ident" id="4169915">alpnProtocols</span><span class="op" id="4169928">)</span>&nbsp;<span class="op" id="4169930">&gt;</span>&nbsp;<span class="num" id="4169932">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169935">serverHasNPN</span>&nbsp;<span class="op" id="4169948">:=</span>&nbsp;<span class="ident" id="4169951"><a href="/crypto/tls/handshake_client.go.html#4169588">hs</a></span><span class="op" id="4169953">.</span><span class="ident" id="4169954">serverHello</span><span class="op" id="4169965">.</span><span class="ident" id="4169966">nextProtoNeg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4169980">serverHasALPN</span>&nbsp;<span class="op" id="4169994">:=</span>&nbsp;<span class="builtinfunc" id="4169997">len</span><span class="op" id="4170000">(</span><span class="ident" id="4170001"><a href="/crypto/tls/handshake_client.go.html#4169588">hs</a></span><span class="op" id="4170003">.</span><span class="ident" id="4170004">serverHello</span><span class="op" id="4170015">.</span><span class="ident" id="4170016">alpnProtocol</span><span class="op" id="4170028">)</span>&nbsp;<span class="op" id="4170030">&gt;</span>&nbsp;<span class="num" id="4170032">0</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4170036">if</span>&nbsp;<span class="op" id="4170039">!</span><span class="ident" id="4170040"><a href="/crypto/tls/handshake_client.go.html#4169846">clientDidNPN</a></span>&nbsp;<span class="op" id="4170053">&amp;&amp;</span>&nbsp;<span class="ident" id="4170056"><a href="/crypto/tls/handshake_client.go.html#4169935">serverHasNPN</a></span>&nbsp;<span class="op" id="4170069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4170073"><a href="/crypto/tls/handshake_client.go.html#4169652">c</a></span><span class="op" id="4170074">.</span><span class="ident" id="4170075">sendAlert</span><span class="op" id="4170084">(</span><span class="ident" id="4170085"><a href="/crypto/tls/alert.go.html#4096192">alertHandshakeFailure</a></span><span class="op" id="4170106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4170110">return</span>&nbsp;<span class="ident" id="4170117">false</span><span class="op" id="4170122">,</span>&nbsp;<span class="ident" id="4170124"><a href="/crypto/tls/handshake_client.go.html#4156200">errors</a></span><span class="op" id="4170130">.</span><span class="ident" id="4170131">New</span><span class="op" id="4170134">(</span><span class="string" id="4170135">&#34;server&nbsp;advertised&nbsp;unrequested&nbsp;NPN&nbsp;extension&#34;</span><span class="op" id="4170180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4170183">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4170187">if</span>&nbsp;<span class="op" id="4170190">!</span><span class="ident" id="4170191"><a href="/crypto/tls/handshake_client.go.html#4169885">clientDidALPN</a></span>&nbsp;<span class="op" id="4170205">&amp;&amp;</span>&nbsp;<span class="ident" id="4170208"><a href="/crypto/tls/handshake_client.go.html#4169980">serverHasALPN</a></span>&nbsp;<span class="op" id="4170222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4170226"><a href="/crypto/tls/handshake_client.go.html#4169652">c</a></span><span class="op" id="4170227">.</span><span class="ident" id="4170228">sendAlert</span><span class="op" id="4170237">(</span><span class="ident" id="4170238"><a href="/crypto/tls/alert.go.html#4096192">alertHandshakeFailure</a></span><span class="op" id="4170259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4170263">return</span>&nbsp;<span class="ident" id="4170270">false</span><span class="op" id="4170275">,</span>&nbsp;<span class="ident" id="4170277"><a href="/crypto/tls/handshake_client.go.html#4156200">errors</a></span><span class="op" id="4170283">.</span><span class="ident" id="4170284">New</span><span class="op" id="4170287">(</span><span class="string" id="4170288">&#34;server&nbsp;advertised&nbsp;unrequested&nbsp;ALPN&nbsp;extension&#34;</span><span class="op" id="4170334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4170337">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4170341">if</span>&nbsp;<span class="ident" id="4170344"><a href="/crypto/tls/handshake_client.go.html#4169935">serverHasNPN</a></span>&nbsp;<span class="op" id="4170357">&amp;&amp;</span>&nbsp;<span class="ident" id="4170360"><a href="/crypto/tls/handshake_client.go.html#4169980">serverHasALPN</a></span>&nbsp;<span class="op" id="4170374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4170378"><a href="/crypto/tls/handshake_client.go.html#4169652">c</a></span><span class="op" id="4170379">.</span><span class="ident" id="4170380">sendAlert</span><span class="op" id="4170389">(</span><span class="ident" id="4170390"><a href="/crypto/tls/alert.go.html#4096192">alertHandshakeFailure</a></span><span class="op" id="4170411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4170415">return</span>&nbsp;<span class="ident" id="4170422">false</span><span class="op" id="4170427">,</span>&nbsp;<span class="ident" id="4170429"><a href="/crypto/tls/handshake_client.go.html#4156200">errors</a></span><span class="op" id="4170435">.</span><span class="ident" id="4170436">New</span><span class="op" id="4170439">(</span><span class="string" id="4170440">&#34;server&nbsp;advertised&nbsp;both&nbsp;NPN&nbsp;and&nbsp;ALPN&nbsp;extensions&#34;</span><span class="op" id="4170488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4170491">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4170495">if</span>&nbsp;<span class="ident" id="4170498"><a href="/crypto/tls/handshake_client.go.html#4169980">serverHasALPN</a></span>&nbsp;<span class="op" id="4170512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4170516"><a href="/crypto/tls/handshake_client.go.html#4169652">c</a></span><span class="op" id="4170517">.</span><span class="ident" id="4170518">clientProtocol</span>&nbsp;<span class="op" id="4170533">=</span>&nbsp;<span class="ident" id="4170535"><a href="/crypto/tls/handshake_client.go.html#4169588">hs</a></span><span class="op" id="4170537">.</span><span class="ident" id="4170538">serverHello</span><span class="op" id="4170549">.</span><span class="ident" id="4170550">alpnProtocol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4170565"><a href="/crypto/tls/handshake_client.go.html#4169652">c</a></span><span class="op" id="4170566">.</span><span class="ident" id="4170567">clientProtocolFallback</span>&nbsp;<span class="op" id="4170590">=</span>&nbsp;<span class="ident" id="4170592">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4170599">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4170603">if</span>&nbsp;<span class="ident" id="4170606"><a href="/crypto/tls/handshake_client.go.html#4169588">hs</a></span><span class="op" id="4170608">.</span><span class="ident" id="4170609">serverResumedSession</span><span class="op" id="4170629">(</span><span class="op" id="4170630">)</span>&nbsp;<span class="op" id="4170632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4170636">//&nbsp;Restore&nbsp;masterSecret&nbsp;and&nbsp;peerCerts&nbsp;from&nbsp;previous&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4170696"><a href="/crypto/tls/handshake_client.go.html#4169588">hs</a></span><span class="op" id="4170698">.</span><span class="ident" id="4170699">masterSecret</span>&nbsp;<span class="op" id="4170712">=</span>&nbsp;<span class="ident" id="4170714"><a href="/crypto/tls/handshake_client.go.html#4169588">hs</a></span><span class="op" id="4170716">.</span><span class="ident" id="4170717">session</span><span class="op" id="4170724">.</span><span class="ident" id="4170725">masterSecret</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4170740"><a href="/crypto/tls/handshake_client.go.html#4169652">c</a></span><span class="op" id="4170741">.</span><span class="ident" id="4170742">peerCertificates</span>&nbsp;<span class="op" id="4170759">=</span>&nbsp;<span class="ident" id="4170761"><a href="/crypto/tls/handshake_client.go.html#4169588">hs</a></span><span class="op" id="4170763">.</span><span class="ident" id="4170764">session</span><span class="op" id="4170771">.</span><span class="ident" id="4170772">serverCertificates</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4170793">return</span>&nbsp;<span class="ident" id="4170800">true</span><span class="op" id="4170804">,</span>&nbsp;<span class="ident" id="4170806">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4170811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4170814">return</span>&nbsp;<span class="ident" id="4170821">false</span><span class="op" id="4170826">,</span>&nbsp;<span class="ident" id="4170828">nil</span><br>
<span class="lineno"></span><span class="op" id="4170832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="4170835">func</span>&nbsp;<span class="op" id="4170840">(</span><span class="ident" id="4170841">hs</span>&nbsp;<span class="op" id="4170844">*</span><span class="ident" id="4170845"><a href="/crypto/tls/handshake_client.go.html#4156248">clientHandshakeState</a></span><span class="op" id="4170865">)</span>&nbsp;<span class="ident" id="4170867">readFinished</span><span class="op" id="4170879">(</span><span class="ident" id="4170880">out</span>&nbsp;<span class="op" id="4170884">[</span><span class="op" id="4170885">]</span><span class="builtintype" id="4170886">byte</span><span class="op" id="4170890">)</span>&nbsp;<span class="builtintype" id="4170892">error</span>&nbsp;<span class="op" id="4170898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4170901">c</span>&nbsp;<span class="op" id="4170903">:=</span>&nbsp;<span class="ident" id="4170906"><a href="/crypto/tls/handshake_client.go.html#4170841">hs</a></span><span class="op" id="4170908">.</span><span class="ident" id="4170909">c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4170913"><a href="/crypto/tls/handshake_client.go.html#4170901">c</a></span><span class="op" id="4170914">.</span><span class="ident" id="4170915">readRecord</span><span class="op" id="4170925">(</span><span class="ident" id="4170926"><a href="/crypto/tls/common.go.html#4108630">recordTypeChangeCipherSpec</a></span><span class="op" id="4170952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4170955">if</span>&nbsp;<span class="ident" id="4170958">err</span>&nbsp;<span class="op" id="4170962">:=</span>&nbsp;<span class="ident" id="4170965"><a href="/crypto/tls/handshake_client.go.html#4170901">c</a></span><span class="op" id="4170966">.</span><span class="ident" id="4170967">in</span><span class="op" id="4170969">.</span><span class="builtintype" id="4170970">error</span><span class="op" id="4170975">(</span><span class="op" id="4170976">)</span><span class="op" id="4170977">;</span>&nbsp;<span class="ident" id="4170979"><a href="/crypto/tls/handshake_client.go.html#4170958">err</a></span>&nbsp;<span class="op" id="4170983">!=</span>&nbsp;<span class="ident" id="4170986">nil</span>&nbsp;<span class="op" id="4170990">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4170994">return</span>&nbsp;<span class="ident" id="4171001"><a href="/crypto/tls/handshake_client.go.html#4170958">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4171006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4171010">msg</span><span class="op" id="4171013">,</span>&nbsp;<span class="ident" id="4171015">err</span>&nbsp;<span class="op" id="4171019">:=</span>&nbsp;<span class="ident" id="4171022"><a href="/crypto/tls/handshake_client.go.html#4170901">c</a></span><span class="op" id="4171023">.</span><span class="ident" id="4171024">readHandshake</span><span class="op" id="4171037">(</span><span class="op" id="4171038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4171041">if</span>&nbsp;<span class="ident" id="4171044"><a href="/crypto/tls/handshake_client.go.html#4171015">err</a></span>&nbsp;<span class="op" id="4171048">!=</span>&nbsp;<span class="ident" id="4171051">nil</span>&nbsp;<span class="op" id="4171055">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4171059">return</span>&nbsp;<span class="ident" id="4171066"><a href="/crypto/tls/handshake_client.go.html#4171015">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4171071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4171074">serverFinished</span><span class="op" id="4171088">,</span>&nbsp;<span class="ident" id="4171090">ok</span>&nbsp;<span class="op" id="4171093">:=</span>&nbsp;<span class="ident" id="4171096"><a href="/crypto/tls/handshake_client.go.html#4171010">msg</a></span><span class="op" id="4171099">.</span><span class="op" id="4171100">(</span><span class="op" id="4171101">*</span><span class="ident" id="4171102"><a href="/crypto/tls/handshake_messages.go.html#4195289">finishedMsg</a></span><span class="op" id="4171113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4171116">if</span>&nbsp;<span class="op" id="4171119">!</span><span class="ident" id="4171120"><a href="/crypto/tls/handshake_client.go.html#4171090">ok</a></span>&nbsp;<span class="op" id="4171123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4171127"><a href="/crypto/tls/handshake_client.go.html#4170901">c</a></span><span class="op" id="4171128">.</span><span class="ident" id="4171129">sendAlert</span><span class="op" id="4171138">(</span><span class="ident" id="4171139"><a href="/crypto/tls/alert.go.html#4095992">alertUnexpectedMessage</a></span><span class="op" id="4171161">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4171165">return</span>&nbsp;<span class="ident" id="4171172"><a href="/crypto/tls/common.go.html#4127007">unexpectedMessageError</a></span><span class="op" id="4171194">(</span><span class="ident" id="4171195"><a href="/crypto/tls/handshake_client.go.html#4171074">serverFinished</a></span><span class="op" id="4171209">,</span>&nbsp;<span class="ident" id="4171211"><a href="/crypto/tls/handshake_client.go.html#4171010">msg</a></span><span class="op" id="4171214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4171217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4171221">verify</span>&nbsp;<span class="op" id="4171228">:=</span>&nbsp;<span class="ident" id="4171231"><a href="/crypto/tls/handshake_client.go.html#4170841">hs</a></span><span class="op" id="4171233">.</span><span class="ident" id="4171234">finishedHash</span><span class="op" id="4171246">.</span><span class="ident" id="4171247">serverSum</span><span class="op" id="4171256">(</span><span class="ident" id="4171257"><a href="/crypto/tls/handshake_client.go.html#4170841">hs</a></span><span class="op" id="4171259">.</span><span class="ident" id="4171260">masterSecret</span><span class="op" id="4171272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4171275">if</span>&nbsp;<span class="builtinfunc" id="4171278">len</span><span class="op" id="4171281">(</span><span class="ident" id="4171282"><a href="/crypto/tls/handshake_client.go.html#4171221">verify</a></span><span class="op" id="4171288">)</span>&nbsp;<span class="op" id="4171290">!=</span>&nbsp;<span class="builtinfunc" id="4171293">len</span><span class="op" id="4171296">(</span><span class="ident" id="4171297"><a href="/crypto/tls/handshake_client.go.html#4171074">serverFinished</a></span><span class="op" id="4171311">.</span><span class="ident" id="4171312">verifyData</span><span class="op" id="4171322">)</span>&nbsp;<span class="op" id="4171324">||</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4171329"><a href="/crypto/tls/handshake_client.go.html#4156168">subtle</a></span><span class="op" id="4171335">.</span><span class="ident" id="4171336">ConstantTimeCompare</span><span class="op" id="4171355">(</span><span class="ident" id="4171356"><a href="/crypto/tls/handshake_client.go.html#4171221">verify</a></span><span class="op" id="4171362">,</span>&nbsp;<span class="ident" id="4171364"><a href="/crypto/tls/handshake_client.go.html#4171074">serverFinished</a></span><span class="op" id="4171378">.</span><span class="ident" id="4171379">verifyData</span><span class="op" id="4171389">)</span>&nbsp;<span class="op" id="4171391">!=</span>&nbsp;<span class="num" id="4171394">1</span>&nbsp;<span class="op" id="4171396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4171400"><a href="/crypto/tls/handshake_client.go.html#4170901">c</a></span><span class="op" id="4171401">.</span><span class="ident" id="4171402">sendAlert</span><span class="op" id="4171411">(</span><span class="ident" id="4171412"><a href="/crypto/tls/alert.go.html#4096192">alertHandshakeFailure</a></span><span class="op" id="4171433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4171437">return</span>&nbsp;<span class="ident" id="4171444"><a href="/crypto/tls/handshake_client.go.html#4156200">errors</a></span><span class="op" id="4171450">.</span><span class="ident" id="4171451">New</span><span class="op" id="4171454">(</span><span class="string" id="4171455">&#34;tls:&nbsp;server&#39;s&nbsp;Finished&nbsp;message&nbsp;was&nbsp;incorrect&#34;</span><span class="op" id="4171501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4171504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4171507"><a href="/crypto/tls/handshake_client.go.html#4170841">hs</a></span><span class="op" id="4171509">.</span><span class="ident" id="4171510">finishedHash</span><span class="op" id="4171522">.</span><span class="ident" id="4171523">Write</span><span class="op" id="4171528">(</span><span class="ident" id="4171529"><a href="/crypto/tls/handshake_client.go.html#4171074">serverFinished</a></span><span class="op" id="4171543">.</span><span class="ident" id="4171544">marshal</span><span class="op" id="4171551">(</span><span class="op" id="4171552">)</span><span class="op" id="4171553">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4171556">copy</span><span class="op" id="4171560">(</span><span class="ident" id="4171561"><a href="/crypto/tls/handshake_client.go.html#4170880">out</a></span><span class="op" id="4171564">,</span>&nbsp;<span class="ident" id="4171566"><a href="/crypto/tls/handshake_client.go.html#4171221">verify</a></span><span class="op" id="4171572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4171575">return</span>&nbsp;<span class="ident" id="4171582">nil</span><br>
<span class="lineno"></span><span class="op" id="4171586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4171589">func</span>&nbsp;<span class="op" id="4171594">(</span><span class="ident" id="4171595">hs</span>&nbsp;<span class="op" id="4171598">*</span><span class="ident" id="4171599"><a href="/crypto/tls/handshake_client.go.html#4156248">clientHandshakeState</a></span><span class="op" id="4171619">)</span>&nbsp;<span class="ident" id="4171621">readSessionTicket</span><span class="op" id="4171638">(</span><span class="op" id="4171639">)</span>&nbsp;<span class="builtintype" id="4171641">error</span>&nbsp;<span class="op" id="4171647">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4171650">if</span>&nbsp;<span class="op" id="4171653">!</span><span class="ident" id="4171654"><a href="/crypto/tls/handshake_client.go.html#4171595">hs</a></span><span class="op" id="4171656">.</span><span class="ident" id="4171657">serverHello</span><span class="op" id="4171668">.</span><span class="ident" id="4171669">ticketSupported</span>&nbsp;<span class="op" id="4171685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4171689">return</span>&nbsp;<span class="ident" id="4171696">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4171701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4171705">c</span>&nbsp;<span class="op" id="4171707">:=</span>&nbsp;<span class="ident" id="4171710"><a href="/crypto/tls/handshake_client.go.html#4171595">hs</a></span><span class="op" id="4171712">.</span><span class="ident" id="4171713">c</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4171716">msg</span><span class="op" id="4171719">,</span>&nbsp;<span class="ident" id="4171721">err</span>&nbsp;<span class="op" id="4171725">:=</span>&nbsp;<span class="ident" id="4171728"><a href="/crypto/tls/handshake_client.go.html#4171705">c</a></span><span class="op" id="4171729">.</span><span class="ident" id="4171730">readHandshake</span><span class="op" id="4171743">(</span><span class="op" id="4171744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4171747">if</span>&nbsp;<span class="ident" id="4171750"><a href="/crypto/tls/handshake_client.go.html#4171721">err</a></span>&nbsp;<span class="op" id="4171754">!=</span>&nbsp;<span class="ident" id="4171757">nil</span>&nbsp;<span class="op" id="4171761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4171765">return</span>&nbsp;<span class="ident" id="4171772"><a href="/crypto/tls/handshake_client.go.html#4171721">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4171777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4171780">sessionTicketMsg</span><span class="op" id="4171796">,</span>&nbsp;<span class="ident" id="4171798">ok</span>&nbsp;<span class="op" id="4171801">:=</span>&nbsp;<span class="ident" id="4171804"><a href="/crypto/tls/handshake_client.go.html#4171716">msg</a></span><span class="op" id="4171807">.</span><span class="op" id="4171808">(</span><span class="op" id="4171809">*</span><span class="ident" id="4171810"><a href="/crypto/tls/handshake_messages.go.html#4202153">newSessionTicketMsg</a></span><span class="op" id="4171829">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4171832">if</span>&nbsp;<span class="op" id="4171835">!</span><span class="ident" id="4171836"><a href="/crypto/tls/handshake_client.go.html#4171798">ok</a></span>&nbsp;<span class="op" id="4171839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4171843"><a href="/crypto/tls/handshake_client.go.html#4171705">c</a></span><span class="op" id="4171844">.</span><span class="ident" id="4171845">sendAlert</span><span class="op" id="4171854">(</span><span class="ident" id="4171855"><a href="/crypto/tls/alert.go.html#4095992">alertUnexpectedMessage</a></span><span class="op" id="4171877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4171881">return</span>&nbsp;<span class="ident" id="4171888"><a href="/crypto/tls/common.go.html#4127007">unexpectedMessageError</a></span><span class="op" id="4171910">(</span><span class="ident" id="4171911"><a href="/crypto/tls/handshake_client.go.html#4171780">sessionTicketMsg</a></span><span class="op" id="4171927">,</span>&nbsp;<span class="ident" id="4171929"><a href="/crypto/tls/handshake_client.go.html#4171716">msg</a></span><span class="op" id="4171932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4171935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4171938"><a href="/crypto/tls/handshake_client.go.html#4171595">hs</a></span><span class="op" id="4171940">.</span><span class="ident" id="4171941">finishedHash</span><span class="op" id="4171953">.</span><span class="ident" id="4171954">Write</span><span class="op" id="4171959">(</span><span class="ident" id="4171960"><a href="/crypto/tls/handshake_client.go.html#4171780">sessionTicketMsg</a></span><span class="op" id="4171976">.</span><span class="ident" id="4171977">marshal</span><span class="op" id="4171984">(</span><span class="op" id="4171985">)</span><span class="op" id="4171986">)</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4171990"><a href="/crypto/tls/handshake_client.go.html#4171595">hs</a></span><span class="op" id="4171992">.</span><span class="ident" id="4171993">session</span>&nbsp;<span class="op" id="4172001">=</span>&nbsp;<span class="op" id="4172003">&amp;</span><span class="ident" id="4172004"><a href="/crypto/tls/common.go.html#4113855">ClientSessionState</a></span><span class="op" id="4172022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172026">sessionTicket</span><span class="op" id="4172039">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172046"><a href="/crypto/tls/handshake_client.go.html#4171780">sessionTicketMsg</a></span><span class="op" id="4172062">.</span><span class="ident" id="4172063">ticket</span><span class="op" id="4172069">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172073">vers</span><span class="op" id="4172077">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172093"><a href="/crypto/tls/handshake_client.go.html#4171705">c</a></span><span class="op" id="4172094">.</span><span class="ident" id="4172095">vers</span><span class="op" id="4172099">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172103">cipherSuite</span><span class="op" id="4172114">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172123"><a href="/crypto/tls/handshake_client.go.html#4171595">hs</a></span><span class="op" id="4172125">.</span><span class="ident" id="4172126">suite</span><span class="op" id="4172131">.</span><span class="ident" id="4172132">id</span><span class="op" id="4172134">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172138">masterSecret</span><span class="op" id="4172150">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172158"><a href="/crypto/tls/handshake_client.go.html#4171595">hs</a></span><span class="op" id="4172160">.</span><span class="ident" id="4172161">masterSecret</span><span class="op" id="4172173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172177">serverCertificates</span><span class="op" id="4172195">:</span>&nbsp;<span class="ident" id="4172197"><a href="/crypto/tls/handshake_client.go.html#4171705">c</a></span><span class="op" id="4172198">.</span><span class="ident" id="4172199">peerCertificates</span><span class="op" id="4172215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4172218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4172222">return</span>&nbsp;<span class="ident" id="4172229">nil</span><br>
<span class="lineno">590</span><span class="op" id="4172233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4172236">func</span>&nbsp;<span class="op" id="4172241">(</span><span class="ident" id="4172242">hs</span>&nbsp;<span class="op" id="4172245">*</span><span class="ident" id="4172246"><a href="/crypto/tls/handshake_client.go.html#4156248">clientHandshakeState</a></span><span class="op" id="4172266">)</span>&nbsp;<span class="ident" id="4172268">sendFinished</span><span class="op" id="4172280">(</span><span class="ident" id="4172281">out</span>&nbsp;<span class="op" id="4172285">[</span><span class="op" id="4172286">]</span><span class="builtintype" id="4172287">byte</span><span class="op" id="4172291">)</span>&nbsp;<span class="builtintype" id="4172293">error</span>&nbsp;<span class="op" id="4172299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172302">c</span>&nbsp;<span class="op" id="4172304">:=</span>&nbsp;<span class="ident" id="4172307"><a href="/crypto/tls/handshake_client.go.html#4172242">hs</a></span><span class="op" id="4172309">.</span><span class="ident" id="4172310">c</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172314"><a href="/crypto/tls/handshake_client.go.html#4172302">c</a></span><span class="op" id="4172315">.</span><span class="ident" id="4172316">writeRecord</span><span class="op" id="4172327">(</span><span class="ident" id="4172328"><a href="/crypto/tls/common.go.html#4108630">recordTypeChangeCipherSpec</a></span><span class="op" id="4172354">,</span>&nbsp;<span class="op" id="4172356">[</span><span class="op" id="4172357">]</span><span class="builtintype" id="4172358">byte</span><span class="op" id="4172362">{</span><span class="num" id="4172363">1</span><span class="op" id="4172364">}</span><span class="op" id="4172365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4172368">if</span>&nbsp;<span class="ident" id="4172371"><a href="/crypto/tls/handshake_client.go.html#4172242">hs</a></span><span class="op" id="4172373">.</span><span class="ident" id="4172374">serverHello</span><span class="op" id="4172385">.</span><span class="ident" id="4172386">nextProtoNeg</span>&nbsp;<span class="op" id="4172399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172403">nextProto</span>&nbsp;<span class="op" id="4172413">:=</span>&nbsp;<span class="builtinfunc" id="4172416">new</span><span class="op" id="4172419">(</span><span class="ident" id="4172420"><a href="/crypto/tls/handshake_messages.go.html#4195916">nextProtoMsg</a></span><span class="op" id="4172432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172436">proto</span><span class="op" id="4172441">,</span>&nbsp;<span class="ident" id="4172443">fallback</span>&nbsp;<span class="op" id="4172452">:=</span>&nbsp;<span class="ident" id="4172455"><a href="/crypto/tls/handshake_client.go.html#4173559">mutualProtocol</a></span><span class="op" id="4172469">(</span><span class="ident" id="4172470"><a href="/crypto/tls/handshake_client.go.html#4172302">c</a></span><span class="op" id="4172471">.</span><span class="ident" id="4172472">config</span><span class="op" id="4172478">.</span><span class="ident" id="4172479">NextProtos</span><span class="op" id="4172489">,</span>&nbsp;<span class="ident" id="4172491"><a href="/crypto/tls/handshake_client.go.html#4172242">hs</a></span><span class="op" id="4172493">.</span><span class="ident" id="4172494">serverHello</span><span class="op" id="4172505">.</span><span class="ident" id="4172506">nextProtos</span><span class="op" id="4172516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172520"><a href="/crypto/tls/handshake_client.go.html#4172403">nextProto</a></span><span class="op" id="4172529">.</span><span class="ident" id="4172530">proto</span>&nbsp;<span class="op" id="4172536">=</span>&nbsp;<span class="ident" id="4172538"><a href="/crypto/tls/handshake_client.go.html#4172436">proto</a></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172546"><a href="/crypto/tls/handshake_client.go.html#4172302">c</a></span><span class="op" id="4172547">.</span><span class="ident" id="4172548">clientProtocol</span>&nbsp;<span class="op" id="4172563">=</span>&nbsp;<span class="ident" id="4172565"><a href="/crypto/tls/handshake_client.go.html#4172436">proto</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172573"><a href="/crypto/tls/handshake_client.go.html#4172302">c</a></span><span class="op" id="4172574">.</span><span class="ident" id="4172575">clientProtocolFallback</span>&nbsp;<span class="op" id="4172598">=</span>&nbsp;<span class="ident" id="4172600"><a href="/crypto/tls/handshake_client.go.html#4172443">fallback</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172612"><a href="/crypto/tls/handshake_client.go.html#4172242">hs</a></span><span class="op" id="4172614">.</span><span class="ident" id="4172615">finishedHash</span><span class="op" id="4172627">.</span><span class="ident" id="4172628">Write</span><span class="op" id="4172633">(</span><span class="ident" id="4172634"><a href="/crypto/tls/handshake_client.go.html#4172403">nextProto</a></span><span class="op" id="4172643">.</span><span class="ident" id="4172644">marshal</span><span class="op" id="4172651">(</span><span class="op" id="4172652">)</span><span class="op" id="4172653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172657"><a href="/crypto/tls/handshake_client.go.html#4172302">c</a></span><span class="op" id="4172658">.</span><span class="ident" id="4172659">writeRecord</span><span class="op" id="4172670">(</span><span class="ident" id="4172671"><a href="/crypto/tls/common.go.html#4108718">recordTypeHandshake</a></span><span class="op" id="4172690">,</span>&nbsp;<span class="ident" id="4172692"><a href="/crypto/tls/handshake_client.go.html#4172403">nextProto</a></span><span class="op" id="4172701">.</span><span class="ident" id="4172702">marshal</span><span class="op" id="4172709">(</span><span class="op" id="4172710">)</span><span class="op" id="4172711">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4172714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172718">finished</span>&nbsp;<span class="op" id="4172727">:=</span>&nbsp;<span class="builtinfunc" id="4172730">new</span><span class="op" id="4172733">(</span><span class="ident" id="4172734"><a href="/crypto/tls/handshake_messages.go.html#4195289">finishedMsg</a></span><span class="op" id="4172745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172748"><a href="/crypto/tls/handshake_client.go.html#4172718">finished</a></span><span class="op" id="4172756">.</span><span class="ident" id="4172757">verifyData</span>&nbsp;<span class="op" id="4172768">=</span>&nbsp;<span class="ident" id="4172770"><a href="/crypto/tls/handshake_client.go.html#4172242">hs</a></span><span class="op" id="4172772">.</span><span class="ident" id="4172773">finishedHash</span><span class="op" id="4172785">.</span><span class="ident" id="4172786">clientSum</span><span class="op" id="4172795">(</span><span class="ident" id="4172796"><a href="/crypto/tls/handshake_client.go.html#4172242">hs</a></span><span class="op" id="4172798">.</span><span class="ident" id="4172799">masterSecret</span><span class="op" id="4172811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172814"><a href="/crypto/tls/handshake_client.go.html#4172242">hs</a></span><span class="op" id="4172816">.</span><span class="ident" id="4172817">finishedHash</span><span class="op" id="4172829">.</span><span class="ident" id="4172830">Write</span><span class="op" id="4172835">(</span><span class="ident" id="4172836"><a href="/crypto/tls/handshake_client.go.html#4172718">finished</a></span><span class="op" id="4172844">.</span><span class="ident" id="4172845">marshal</span><span class="op" id="4172852">(</span><span class="op" id="4172853">)</span><span class="op" id="4172854">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172857"><a href="/crypto/tls/handshake_client.go.html#4172302">c</a></span><span class="op" id="4172858">.</span><span class="ident" id="4172859">writeRecord</span><span class="op" id="4172870">(</span><span class="ident" id="4172871"><a href="/crypto/tls/common.go.html#4108718">recordTypeHandshake</a></span><span class="op" id="4172890">,</span>&nbsp;<span class="ident" id="4172892"><a href="/crypto/tls/handshake_client.go.html#4172718">finished</a></span><span class="op" id="4172900">.</span><span class="ident" id="4172901">marshal</span><span class="op" id="4172908">(</span><span class="op" id="4172909">)</span><span class="op" id="4172910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4172913">copy</span><span class="op" id="4172917">(</span><span class="ident" id="4172918"><a href="/crypto/tls/handshake_client.go.html#4172281">out</a></span><span class="op" id="4172921">,</span>&nbsp;<span class="ident" id="4172923"><a href="/crypto/tls/handshake_client.go.html#4172718">finished</a></span><span class="op" id="4172931">.</span><span class="ident" id="4172932">verifyData</span><span class="op" id="4172942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4172945">return</span>&nbsp;<span class="ident" id="4172952">nil</span><br>
<span class="lineno"></span><span class="op" id="4172956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span><span class="comment" id="4172959">//&nbsp;clientSessionCacheKey&nbsp;returns&nbsp;a&nbsp;key&nbsp;used&nbsp;to&nbsp;cache&nbsp;sessionTickets&nbsp;that&nbsp;could</span><br>
<span class="lineno"></span><span class="comment" id="4173038">//&nbsp;be&nbsp;used&nbsp;to&nbsp;resume&nbsp;previously&nbsp;negotiated&nbsp;TLS&nbsp;sessions&nbsp;with&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="4173109">func</span>&nbsp;<span class="ident" id="4173114">clientSessionCacheKey</span><span class="op" id="4173135">(</span><span class="ident" id="4173136">serverAddr</span>&nbsp;<span class="ident" id="4173147"><a href="/crypto/tls/handshake_client.go.html#4156223">net</a></span><span class="op" id="4173150">.</span><span class="ident" id="4173151">Addr</span><span class="op" id="4173155">,</span>&nbsp;<span class="ident" id="4173157">config</span>&nbsp;<span class="op" id="4173164">*</span><span class="ident" id="4173165"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="4173171">)</span>&nbsp;<span class="builtintype" id="4173173">string</span>&nbsp;<span class="op" id="4173180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4173183">if</span>&nbsp;<span class="builtinfunc" id="4173186">len</span><span class="op" id="4173189">(</span><span class="ident" id="4173190"><a href="/crypto/tls/handshake_client.go.html#4173157">config</a></span><span class="op" id="4173196">.</span><span class="ident" id="4173197">ServerName</span><span class="op" id="4173207">)</span>&nbsp;<span class="op" id="4173209">&gt;</span>&nbsp;<span class="num" id="4173211">0</span>&nbsp;<span class="op" id="4173213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4173217">return</span>&nbsp;<span class="ident" id="4173224"><a href="/crypto/tls/handshake_client.go.html#4173157">config</a></span><span class="op" id="4173230">.</span><span class="ident" id="4173231">ServerName</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4173243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4173246">return</span>&nbsp;<span class="ident" id="4173253"><a href="/crypto/tls/handshake_client.go.html#4173136">serverAddr</a></span><span class="op" id="4173263">.</span><span class="ident" id="4173264">String</span><span class="op" id="4173270">(</span><span class="op" id="4173271">)</span><br>
<span class="lineno"></span><span class="op" id="4173273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4173276">//&nbsp;mutualProtocol&nbsp;finds&nbsp;the&nbsp;mutual&nbsp;Next&nbsp;Protocol&nbsp;Negotiation&nbsp;or&nbsp;ALPN&nbsp;protocol</span><br>
<span class="lineno">625</span><span class="comment" id="4173354">//&nbsp;given&nbsp;list&nbsp;of&nbsp;possible&nbsp;protocols&nbsp;and&nbsp;a&nbsp;list&nbsp;of&nbsp;the&nbsp;preference&nbsp;order.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="4173430">//&nbsp;first&nbsp;list&nbsp;must&nbsp;not&nbsp;be&nbsp;empty.&nbsp;It&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;protocol&nbsp;and&nbsp;flag</span><br>
<span class="lineno"></span><span class="comment" id="4173506">//&nbsp;indicating&nbsp;if&nbsp;the&nbsp;fallback&nbsp;case&nbsp;was&nbsp;reached.</span><br>
<span class="lineno"></span><span class="keyword" id="4173554">func</span>&nbsp;<span class="ident" id="4173559">mutualProtocol</span><span class="op" id="4173573">(</span><span class="ident" id="4173574">protos</span><span class="op" id="4173580">,</span>&nbsp;<span class="ident" id="4173582">preferenceProtos</span>&nbsp;<span class="op" id="4173599">[</span><span class="op" id="4173600">]</span><span class="builtintype" id="4173601">string</span><span class="op" id="4173607">)</span>&nbsp;<span class="op" id="4173609">(</span><span class="builtintype" id="4173610">string</span><span class="op" id="4173616">,</span>&nbsp;<span class="builtintype" id="4173618">bool</span><span class="op" id="4173622">)</span>&nbsp;<span class="op" id="4173624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4173627">for</span>&nbsp;<span class="ident" id="4173631">_</span><span class="op" id="4173632">,</span>&nbsp;<span class="ident" id="4173634">s</span>&nbsp;<span class="op" id="4173636">:=</span>&nbsp;<span class="keyword" id="4173639">range</span>&nbsp;<span class="ident" id="4173645"><a href="/crypto/tls/handshake_client.go.html#4173582">preferenceProtos</a></span>&nbsp;<span class="op" id="4173662">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4173666">for</span>&nbsp;<span class="ident" id="4173670">_</span><span class="op" id="4173671">,</span>&nbsp;<span class="ident" id="4173673">c</span>&nbsp;<span class="op" id="4173675">:=</span>&nbsp;<span class="keyword" id="4173678">range</span>&nbsp;<span class="ident" id="4173684"><a href="/crypto/tls/handshake_client.go.html#4173574">protos</a></span>&nbsp;<span class="op" id="4173691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4173696">if</span>&nbsp;<span class="ident" id="4173699"><a href="/crypto/tls/handshake_client.go.html#4173634">s</a></span>&nbsp;<span class="op" id="4173701">==</span>&nbsp;<span class="ident" id="4173704"><a href="/crypto/tls/handshake_client.go.html#4173673">c</a></span>&nbsp;<span class="op" id="4173706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4173712">return</span>&nbsp;<span class="ident" id="4173719"><a href="/crypto/tls/handshake_client.go.html#4173634">s</a></span><span class="op" id="4173720">,</span>&nbsp;<span class="ident" id="4173722">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4173731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4173735">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4173738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4173742">return</span>&nbsp;<span class="ident" id="4173749"><a href="/crypto/tls/handshake_client.go.html#4173574">protos</a></span><span class="op" id="4173755">[</span><span class="num" id="4173756">0</span><span class="op" id="4173757">]</span><span class="op" id="4173758">,</span>&nbsp;<span class="ident" id="4173760">true</span><br>
<span class="lineno"></span><span class="op" id="4173765">}</span>
</div>
</body>
</html>
