<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2498734">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2498789">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2498843">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2498894">package</span>&nbsp;<span class="ident" id="2498902">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2498906">import</span>&nbsp;<span class="string" id="2498913">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2498924">//&nbsp;Pipe&nbsp;returns&nbsp;a&nbsp;connected&nbsp;pair&nbsp;of&nbsp;Files;&nbsp;reads&nbsp;from&nbsp;r&nbsp;return&nbsp;bytes&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">10</span><span class="comment" id="2499007">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;files&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2499053">func</span>&nbsp;<span class="ident" id="2499058">Pipe</span><span class="op" id="2499062">(</span><span class="op" id="2499063">)</span>&nbsp;<span class="op" id="2499065">(</span><span class="ident" id="2499066">r</span>&nbsp;<span class="op" id="2499068">*</span><span class="ident" id="2499069">File</span><span class="op" id="2499073">,</span>&nbsp;<span class="ident" id="2499075">w</span>&nbsp;<span class="op" id="2499077">*</span><span class="ident" id="2499078">File</span><span class="op" id="2499082">,</span>&nbsp;<span class="ident" id="2499084">err</span>&nbsp;<span class="builtintype" id="2499088">error</span><span class="op" id="2499093">)</span>&nbsp;<span class="op" id="2499095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499098">var</span>&nbsp;<span class="ident" id="2499102">p</span>&nbsp;<span class="op" id="2499104">[</span><span class="num" id="2499105">2</span><span class="op" id="2499106">]</span><span class="builtintype" id="2499107">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499113">e</span>&nbsp;<span class="op" id="2499115">:=</span>&nbsp;<span class="ident" id="2499118">syscall</span><span class="op" id="2499125">.</span><span class="ident" id="2499126">Pipe2</span><span class="op" id="2499131">(</span><span class="ident" id="2499132">p</span><span class="op" id="2499133">[</span><span class="num" id="2499134">0</span><span class="op" id="2499135">:</span><span class="op" id="2499136">]</span><span class="op" id="2499137">,</span>&nbsp;<span class="ident" id="2499139">syscall</span><span class="op" id="2499146">.</span><span class="ident" id="2499147">O_CLOEXEC</span><span class="op" id="2499156">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2499159">//&nbsp;pipe2&nbsp;was&nbsp;added&nbsp;in&nbsp;2.6.27&nbsp;and&nbsp;our&nbsp;minimum&nbsp;requirement&nbsp;is&nbsp;2.6.23,&nbsp;so&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2499234">//&nbsp;might&nbsp;not&nbsp;be&nbsp;implemented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499264">if</span>&nbsp;<span class="ident" id="2499267">e</span>&nbsp;<span class="op" id="2499269">==</span>&nbsp;<span class="ident" id="2499272">syscall</span><span class="op" id="2499279">.</span><span class="ident" id="2499280">ENOSYS</span>&nbsp;<span class="op" id="2499287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2499291">//&nbsp;See&nbsp;../syscall/exec.go&nbsp;for&nbsp;description&nbsp;of&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499344">syscall</span><span class="op" id="2499351">.</span><span class="ident" id="2499352">ForkLock</span><span class="op" id="2499360">.</span><span class="ident" id="2499361">RLock</span><span class="op" id="2499366">(</span><span class="op" id="2499367">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499371">e</span>&nbsp;<span class="op" id="2499373">=</span>&nbsp;<span class="ident" id="2499375">syscall</span><span class="op" id="2499382">.</span><span class="ident" id="2499383">Pipe</span><span class="op" id="2499387">(</span><span class="ident" id="2499388">p</span><span class="op" id="2499389">[</span><span class="num" id="2499390">0</span><span class="op" id="2499391">:</span><span class="op" id="2499392">]</span><span class="op" id="2499393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499397">if</span>&nbsp;<span class="ident" id="2499400">e</span>&nbsp;<span class="op" id="2499402">!=</span>&nbsp;<span class="ident" id="2499405">nil</span>&nbsp;<span class="op" id="2499409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499414">syscall</span><span class="op" id="2499421">.</span><span class="ident" id="2499422">ForkLock</span><span class="op" id="2499430">.</span><span class="ident" id="2499431">RUnlock</span><span class="op" id="2499438">(</span><span class="op" id="2499439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499444">return</span>&nbsp;<span class="ident" id="2499451">nil</span><span class="op" id="2499454">,</span>&nbsp;<span class="ident" id="2499456">nil</span><span class="op" id="2499459">,</span>&nbsp;<span class="ident" id="2499461">NewSyscallError</span><span class="op" id="2499476">(</span><span class="string" id="2499477">&#34;pipe&#34;</span><span class="op" id="2499483">,</span>&nbsp;<span class="ident" id="2499485">e</span><span class="op" id="2499486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2499490">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499494">syscall</span><span class="op" id="2499501">.</span><span class="ident" id="2499502">CloseOnExec</span><span class="op" id="2499513">(</span><span class="ident" id="2499514">p</span><span class="op" id="2499515">[</span><span class="num" id="2499516">0</span><span class="op" id="2499517">]</span><span class="op" id="2499518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499522">syscall</span><span class="op" id="2499529">.</span><span class="ident" id="2499530">CloseOnExec</span><span class="op" id="2499541">(</span><span class="ident" id="2499542">p</span><span class="op" id="2499543">[</span><span class="num" id="2499544">1</span><span class="op" id="2499545">]</span><span class="op" id="2499546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499550">syscall</span><span class="op" id="2499557">.</span><span class="ident" id="2499558">ForkLock</span><span class="op" id="2499566">.</span><span class="ident" id="2499567">RUnlock</span><span class="op" id="2499574">(</span><span class="op" id="2499575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2499578">}</span>&nbsp;<span class="keyword" id="2499580">else</span>&nbsp;<span class="keyword" id="2499585">if</span>&nbsp;<span class="ident" id="2499588">e</span>&nbsp;<span class="op" id="2499590">!=</span>&nbsp;<span class="ident" id="2499593">nil</span>&nbsp;<span class="op" id="2499597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499601">return</span>&nbsp;<span class="ident" id="2499608">nil</span><span class="op" id="2499611">,</span>&nbsp;<span class="ident" id="2499613">nil</span><span class="op" id="2499616">,</span>&nbsp;<span class="ident" id="2499618">NewSyscallError</span><span class="op" id="2499633">(</span><span class="string" id="2499634">&#34;pipe2&#34;</span><span class="op" id="2499641">,</span>&nbsp;<span class="ident" id="2499643">e</span><span class="op" id="2499644">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2499647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499651">return</span>&nbsp;<span class="ident" id="2499658">NewFile</span><span class="op" id="2499665">(</span><span class="builtintype" id="2499666">uintptr</span><span class="op" id="2499673">(</span><span class="ident" id="2499674">p</span><span class="op" id="2499675">[</span><span class="num" id="2499676">0</span><span class="op" id="2499677">]</span><span class="op" id="2499678">)</span><span class="op" id="2499679">,</span>&nbsp;<span class="string" id="2499681">&#34;|0&#34;</span><span class="op" id="2499685">)</span><span class="op" id="2499686">,</span>&nbsp;<span class="ident" id="2499688">NewFile</span><span class="op" id="2499695">(</span><span class="builtintype" id="2499696">uintptr</span><span class="op" id="2499703">(</span><span class="ident" id="2499704">p</span><span class="op" id="2499705">[</span><span class="num" id="2499706">1</span><span class="op" id="2499707">]</span><span class="op" id="2499708">)</span><span class="op" id="2499709">,</span>&nbsp;<span class="string" id="2499711">&#34;|1&#34;</span><span class="op" id="2499715">)</span><span class="op" id="2499716">,</span>&nbsp;<span class="ident" id="2499718">nil</span><br>
<span class="lineno"></span><span class="op" id="2499722">}</span>
</div>
</body>
</html>
