<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6266094">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6266149">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6266203">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6266254">//&nbsp;Package&nbsp;signal&nbsp;implements&nbsp;access&nbsp;to&nbsp;incoming&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="6266311">package</span>&nbsp;<span class="ident" id="6266319">signal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6266327">//&nbsp;BUG(rsc):&nbsp;This&nbsp;package&nbsp;is&nbsp;not&nbsp;yet&nbsp;implemented&nbsp;on&nbsp;Plan&nbsp;9.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6266388">import</span>&nbsp;<span class="op" id="6266395">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6266398">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6266404">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6266411">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6266414">var</span>&nbsp;<span class="ident" id="6266418">handlers</span>&nbsp;<span class="keyword" id="6266427">struct</span>&nbsp;<span class="op" id="6266434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266437">sync</span><span class="op" id="6266441">.</span><span class="ident" id="6266442">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266449">m</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6266453">map</span><span class="op" id="6266456">[</span><span class="keyword" id="6266457">chan</span><span class="op" id="6266461">&lt;-</span>&nbsp;<span class="ident" id="6266464">os</span><span class="op" id="6266466">.</span><span class="ident" id="6266467">Signal</span><span class="op" id="6266473">]</span><span class="op" id="6266474">*</span><span class="ident" id="6266475">handler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266484">ref</span>&nbsp;<span class="op" id="6266488">[</span><span class="ident" id="6266489">numSig</span><span class="op" id="6266495">]</span><span class="ident" id="6266496">int64</span><br>
<span class="lineno"></span><span class="op" id="6266502">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6266505">type</span>&nbsp;<span class="ident" id="6266510">handler</span>&nbsp;<span class="keyword" id="6266518">struct</span>&nbsp;<span class="op" id="6266525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266528">mask</span>&nbsp;<span class="op" id="6266533">[</span><span class="op" id="6266534">(</span><span class="ident" id="6266535">numSig</span>&nbsp;<span class="op" id="6266542">+</span>&nbsp;<span class="num" id="6266544">31</span><span class="op" id="6266546">)</span>&nbsp;<span class="op" id="6266548">/</span>&nbsp;<span class="num" id="6266550">32</span><span class="op" id="6266552">]</span><span class="builtintype" id="6266553">uint32</span><br>
<span class="lineno"></span><span class="op" id="6266560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6266563">func</span>&nbsp;<span class="op" id="6266568">(</span><span class="ident" id="6266569">h</span>&nbsp;<span class="op" id="6266571">*</span><span class="ident" id="6266572">handler</span><span class="op" id="6266579">)</span>&nbsp;<span class="ident" id="6266581">want</span><span class="op" id="6266585">(</span><span class="ident" id="6266586">sig</span>&nbsp;<span class="builtintype" id="6266590">int</span><span class="op" id="6266593">)</span>&nbsp;<span class="builtintype" id="6266595">bool</span>&nbsp;<span class="op" id="6266600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266603">return</span>&nbsp;<span class="op" id="6266610">(</span><span class="ident" id="6266611">h</span><span class="op" id="6266612">.</span><span class="ident" id="6266613">mask</span><span class="op" id="6266617">[</span><span class="ident" id="6266618">sig</span><span class="op" id="6266621">/</span><span class="num" id="6266622">32</span><span class="op" id="6266624">]</span><span class="op" id="6266625">&gt;&gt;</span><span class="builtintype" id="6266627">uint</span><span class="op" id="6266631">(</span><span class="ident" id="6266632">sig</span><span class="op" id="6266635">&amp;</span><span class="num" id="6266636">31</span><span class="op" id="6266638">)</span><span class="op" id="6266639">)</span><span class="op" id="6266640">&amp;</span><span class="num" id="6266641">1</span>&nbsp;<span class="op" id="6266643">!=</span>&nbsp;<span class="num" id="6266646">0</span><br>
<span class="lineno"></span><span class="op" id="6266648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6266651">func</span>&nbsp;<span class="op" id="6266656">(</span><span class="ident" id="6266657">h</span>&nbsp;<span class="op" id="6266659">*</span><span class="ident" id="6266660">handler</span><span class="op" id="6266667">)</span>&nbsp;<span class="ident" id="6266669">set</span><span class="op" id="6266672">(</span><span class="ident" id="6266673">sig</span>&nbsp;<span class="builtintype" id="6266677">int</span><span class="op" id="6266680">)</span>&nbsp;<span class="op" id="6266682">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266685">h</span><span class="op" id="6266686">.</span><span class="ident" id="6266687">mask</span><span class="op" id="6266691">[</span><span class="ident" id="6266692">sig</span><span class="op" id="6266695">/</span><span class="num" id="6266696">32</span><span class="op" id="6266698">]</span>&nbsp;<span class="op" id="6266700">|=</span>&nbsp;<span class="num" id="6266703">1</span>&nbsp;<span class="op" id="6266705">&lt;&lt;</span>&nbsp;<span class="builtintype" id="6266708">uint</span><span class="op" id="6266712">(</span><span class="ident" id="6266713">sig</span><span class="op" id="6266716">&amp;</span><span class="num" id="6266717">31</span><span class="op" id="6266719">)</span><br>
<span class="lineno"></span><span class="op" id="6266721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6266724">//&nbsp;Notify&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;relay&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6266788">//&nbsp;If&nbsp;no&nbsp;signals&nbsp;are&nbsp;listed,&nbsp;all&nbsp;incoming&nbsp;signals&nbsp;will&nbsp;be&nbsp;relayed&nbsp;to&nbsp;c.</span><br>
<span class="lineno">35</span><span class="comment" id="6266860">//&nbsp;Otherwise,&nbsp;just&nbsp;the&nbsp;listed&nbsp;signals&nbsp;will.</span><br>
<span class="lineno"></span><span class="comment" id="6266904">//</span><br>
<span class="lineno"></span><span class="comment" id="6266907">//&nbsp;Package&nbsp;signal&nbsp;will&nbsp;not&nbsp;block&nbsp;sending&nbsp;to&nbsp;c:&nbsp;the&nbsp;caller&nbsp;must&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="6266977">//&nbsp;that&nbsp;c&nbsp;has&nbsp;sufficient&nbsp;buffer&nbsp;space&nbsp;to&nbsp;keep&nbsp;up&nbsp;with&nbsp;the&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="6267044">//&nbsp;signal&nbsp;rate.&nbsp;&nbsp;For&nbsp;a&nbsp;channel&nbsp;used&nbsp;for&nbsp;notification&nbsp;of&nbsp;just&nbsp;one&nbsp;signal&nbsp;value,</span><br>
<span class="lineno">40</span><span class="comment" id="6267123">//&nbsp;a&nbsp;buffer&nbsp;of&nbsp;size&nbsp;1&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="comment" id="6267160">//</span><br>
<span class="lineno"></span><span class="comment" id="6267163">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;the&nbsp;same&nbsp;channel:</span><br>
<span class="lineno"></span><span class="comment" id="6267233">//&nbsp;each&nbsp;call&nbsp;expands&nbsp;the&nbsp;set&nbsp;of&nbsp;signals&nbsp;sent&nbsp;to&nbsp;that&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="6267295">//&nbsp;The&nbsp;only&nbsp;way&nbsp;to&nbsp;remove&nbsp;signals&nbsp;from&nbsp;the&nbsp;set&nbsp;is&nbsp;to&nbsp;call&nbsp;Stop.</span><br>
<span class="lineno">45</span><span class="comment" id="6267359">//</span><br>
<span class="lineno"></span><span class="comment" id="6267362">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;different&nbsp;channels</span><br>
<span class="lineno"></span><span class="comment" id="6267433">//&nbsp;and&nbsp;the&nbsp;same&nbsp;signals:&nbsp;each&nbsp;channel&nbsp;receives&nbsp;copies&nbsp;of&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="6267499">//&nbsp;signals&nbsp;independently.</span><br>
<span class="lineno"></span><span class="keyword" id="6267525">func</span>&nbsp;<span class="ident" id="6267530">Notify</span><span class="op" id="6267536">(</span><span class="ident" id="6267537">c</span>&nbsp;<span class="keyword" id="6267539">chan</span><span class="op" id="6267543">&lt;-</span>&nbsp;<span class="ident" id="6267546">os</span><span class="op" id="6267548">.</span><span class="ident" id="6267549">Signal</span><span class="op" id="6267555">,</span>&nbsp;<span class="ident" id="6267557">sig</span>&nbsp;<span class="op" id="6267561">...</span><span class="ident" id="6267564">os</span><span class="op" id="6267566">.</span><span class="ident" id="6267567">Signal</span><span class="op" id="6267573">)</span>&nbsp;<span class="op" id="6267575">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267578">if</span>&nbsp;<span class="ident" id="6267581">c</span>&nbsp;<span class="op" id="6267583">==</span>&nbsp;<span class="ident" id="6267586">nil</span>&nbsp;<span class="op" id="6267590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6267594">panic</span><span class="op" id="6267599">(</span><span class="string" id="6267600">&#34;os/signal:&nbsp;Notify&nbsp;using&nbsp;nil&nbsp;channel&#34;</span><span class="op" id="6267637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267644">handlers</span><span class="op" id="6267652">.</span><span class="ident" id="6267653">Lock</span><span class="op" id="6267657">(</span><span class="op" id="6267658">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267661">defer</span>&nbsp;<span class="ident" id="6267667">handlers</span><span class="op" id="6267675">.</span><span class="ident" id="6267676">Unlock</span><span class="op" id="6267682">(</span><span class="op" id="6267683">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267687">h</span>&nbsp;<span class="op" id="6267689">:=</span>&nbsp;<span class="ident" id="6267692">handlers</span><span class="op" id="6267700">.</span><span class="ident" id="6267701">m</span><span class="op" id="6267702">[</span><span class="ident" id="6267703">c</span><span class="op" id="6267704">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267707">if</span>&nbsp;<span class="ident" id="6267710">h</span>&nbsp;<span class="op" id="6267712">==</span>&nbsp;<span class="ident" id="6267715">nil</span>&nbsp;<span class="op" id="6267719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267723">if</span>&nbsp;<span class="ident" id="6267726">handlers</span><span class="op" id="6267734">.</span><span class="ident" id="6267735">m</span>&nbsp;<span class="op" id="6267737">==</span>&nbsp;<span class="ident" id="6267740">nil</span>&nbsp;<span class="op" id="6267744">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267749">handlers</span><span class="op" id="6267757">.</span><span class="ident" id="6267758">m</span>&nbsp;<span class="op" id="6267760">=</span>&nbsp;<span class="builtinfunc" id="6267762">make</span><span class="op" id="6267766">(</span><span class="keyword" id="6267767">map</span><span class="op" id="6267770">[</span><span class="keyword" id="6267771">chan</span><span class="op" id="6267775">&lt;-</span>&nbsp;<span class="ident" id="6267778">os</span><span class="op" id="6267780">.</span><span class="ident" id="6267781">Signal</span><span class="op" id="6267787">]</span><span class="op" id="6267788">*</span><span class="ident" id="6267789">handler</span><span class="op" id="6267796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267804">h</span>&nbsp;<span class="op" id="6267806">=</span>&nbsp;<span class="builtinfunc" id="6267808">new</span><span class="op" id="6267811">(</span><span class="ident" id="6267812">handler</span><span class="op" id="6267819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267823">handlers</span><span class="op" id="6267831">.</span><span class="ident" id="6267832">m</span><span class="op" id="6267833">[</span><span class="ident" id="6267834">c</span><span class="op" id="6267835">]</span>&nbsp;<span class="op" id="6267837">=</span>&nbsp;<span class="ident" id="6267839">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267842">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267846">add</span>&nbsp;<span class="op" id="6267850">:=</span>&nbsp;<span class="keyword" id="6267853">func</span><span class="op" id="6267857">(</span><span class="ident" id="6267858">n</span>&nbsp;<span class="builtintype" id="6267860">int</span><span class="op" id="6267863">)</span>&nbsp;<span class="op" id="6267865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267869">if</span>&nbsp;<span class="ident" id="6267872">n</span>&nbsp;<span class="op" id="6267874">&lt;</span>&nbsp;<span class="num" id="6267876">0</span>&nbsp;<span class="op" id="6267878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267883">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267892">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267896">if</span>&nbsp;<span class="op" id="6267899">!</span><span class="ident" id="6267900">h</span><span class="op" id="6267901">.</span><span class="ident" id="6267902">want</span><span class="op" id="6267906">(</span><span class="ident" id="6267907">n</span><span class="op" id="6267908">)</span>&nbsp;<span class="op" id="6267910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267915">h</span><span class="op" id="6267916">.</span><span class="ident" id="6267917">set</span><span class="op" id="6267920">(</span><span class="ident" id="6267921">n</span><span class="op" id="6267922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267927">if</span>&nbsp;<span class="ident" id="6267930">handlers</span><span class="op" id="6267938">.</span><span class="ident" id="6267939">ref</span><span class="op" id="6267942">[</span><span class="ident" id="6267943">n</span><span class="op" id="6267944">]</span>&nbsp;<span class="op" id="6267946">==</span>&nbsp;<span class="num" id="6267949">0</span>&nbsp;<span class="op" id="6267951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267957">enableSignal</span><span class="op" id="6267969">(</span><span class="ident" id="6267970">n</span><span class="op" id="6267971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267976">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267981">handlers</span><span class="op" id="6267989">.</span><span class="ident" id="6267990">ref</span><span class="op" id="6267993">[</span><span class="ident" id="6267994">n</span><span class="op" id="6267995">]</span><span class="op" id="6267996">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268008">if</span>&nbsp;<span class="builtinfunc" id="6268011">len</span><span class="op" id="6268014">(</span><span class="ident" id="6268015">sig</span><span class="op" id="6268018">)</span>&nbsp;<span class="op" id="6268020">==</span>&nbsp;<span class="num" id="6268023">0</span>&nbsp;<span class="op" id="6268025">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268029">for</span>&nbsp;<span class="ident" id="6268033">n</span>&nbsp;<span class="op" id="6268035">:=</span>&nbsp;<span class="num" id="6268038">0</span><span class="op" id="6268039">;</span>&nbsp;<span class="ident" id="6268041">n</span>&nbsp;<span class="op" id="6268043">&lt;</span>&nbsp;<span class="ident" id="6268045">numSig</span><span class="op" id="6268051">;</span>&nbsp;<span class="ident" id="6268053">n</span><span class="op" id="6268054">++</span>&nbsp;<span class="op" id="6268057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268062">add</span><span class="op" id="6268065">(</span><span class="ident" id="6268066">n</span><span class="op" id="6268067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268074">}</span>&nbsp;<span class="keyword" id="6268076">else</span>&nbsp;<span class="op" id="6268081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268085">for</span>&nbsp;<span class="ident" id="6268089">_</span><span class="op" id="6268090">,</span>&nbsp;<span class="ident" id="6268092">s</span>&nbsp;<span class="op" id="6268094">:=</span>&nbsp;<span class="keyword" id="6268097">range</span>&nbsp;<span class="ident" id="6268103">sig</span>&nbsp;<span class="op" id="6268107">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268112">add</span><span class="op" id="6268115">(</span><span class="ident" id="6268116">signum</span><span class="op" id="6268122">(</span><span class="ident" id="6268123">s</span><span class="op" id="6268124">)</span><span class="op" id="6268125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268132">}</span><br>
<span class="lineno"></span><span class="op" id="6268134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="6268137">//&nbsp;Stop&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;stop&nbsp;relaying&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6268207">//&nbsp;It&nbsp;undoes&nbsp;the&nbsp;effect&nbsp;of&nbsp;all&nbsp;prior&nbsp;calls&nbsp;to&nbsp;Notify&nbsp;using&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6268269">//&nbsp;When&nbsp;Stop&nbsp;returns,&nbsp;it&nbsp;is&nbsp;guaranteed&nbsp;that&nbsp;c&nbsp;will&nbsp;receive&nbsp;no&nbsp;more&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="6268345">func</span>&nbsp;<span class="ident" id="6268350">Stop</span><span class="op" id="6268354">(</span><span class="ident" id="6268355">c</span>&nbsp;<span class="keyword" id="6268357">chan</span><span class="op" id="6268361">&lt;-</span>&nbsp;<span class="ident" id="6268364">os</span><span class="op" id="6268366">.</span><span class="ident" id="6268367">Signal</span><span class="op" id="6268373">)</span>&nbsp;<span class="op" id="6268375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268378">handlers</span><span class="op" id="6268386">.</span><span class="ident" id="6268387">Lock</span><span class="op" id="6268391">(</span><span class="op" id="6268392">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268395">defer</span>&nbsp;<span class="ident" id="6268401">handlers</span><span class="op" id="6268409">.</span><span class="ident" id="6268410">Unlock</span><span class="op" id="6268416">(</span><span class="op" id="6268417">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268421">h</span>&nbsp;<span class="op" id="6268423">:=</span>&nbsp;<span class="ident" id="6268426">handlers</span><span class="op" id="6268434">.</span><span class="ident" id="6268435">m</span><span class="op" id="6268436">[</span><span class="ident" id="6268437">c</span><span class="op" id="6268438">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268441">if</span>&nbsp;<span class="ident" id="6268444">h</span>&nbsp;<span class="op" id="6268446">==</span>&nbsp;<span class="ident" id="6268449">nil</span>&nbsp;<span class="op" id="6268453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268457">return</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6268468">delete</span><span class="op" id="6268474">(</span><span class="ident" id="6268475">handlers</span><span class="op" id="6268483">.</span><span class="ident" id="6268484">m</span><span class="op" id="6268485">,</span>&nbsp;<span class="ident" id="6268487">c</span><span class="op" id="6268488">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268492">for</span>&nbsp;<span class="ident" id="6268496">n</span>&nbsp;<span class="op" id="6268498">:=</span>&nbsp;<span class="num" id="6268501">0</span><span class="op" id="6268502">;</span>&nbsp;<span class="ident" id="6268504">n</span>&nbsp;<span class="op" id="6268506">&lt;</span>&nbsp;<span class="ident" id="6268508">numSig</span><span class="op" id="6268514">;</span>&nbsp;<span class="ident" id="6268516">n</span><span class="op" id="6268517">++</span>&nbsp;<span class="op" id="6268520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268524">if</span>&nbsp;<span class="ident" id="6268527">h</span><span class="op" id="6268528">.</span><span class="ident" id="6268529">want</span><span class="op" id="6268533">(</span><span class="ident" id="6268534">n</span><span class="op" id="6268535">)</span>&nbsp;<span class="op" id="6268537">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268542">handlers</span><span class="op" id="6268550">.</span><span class="ident" id="6268551">ref</span><span class="op" id="6268554">[</span><span class="ident" id="6268555">n</span><span class="op" id="6268556">]</span><span class="op" id="6268557">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268563">if</span>&nbsp;<span class="ident" id="6268566">handlers</span><span class="op" id="6268574">.</span><span class="ident" id="6268575">ref</span><span class="op" id="6268578">[</span><span class="ident" id="6268579">n</span><span class="op" id="6268580">]</span>&nbsp;<span class="op" id="6268582">==</span>&nbsp;<span class="num" id="6268585">0</span>&nbsp;<span class="op" id="6268587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268593">disableSignal</span><span class="op" id="6268606">(</span><span class="ident" id="6268607">n</span><span class="op" id="6268608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268617">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268620">}</span><br>
<span class="lineno"></span><span class="op" id="6268622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6268625">func</span>&nbsp;<span class="ident" id="6268630">process</span><span class="op" id="6268637">(</span><span class="ident" id="6268638">sig</span>&nbsp;<span class="ident" id="6268642">os</span><span class="op" id="6268644">.</span><span class="ident" id="6268645">Signal</span><span class="op" id="6268651">)</span>&nbsp;<span class="op" id="6268653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268656">n</span>&nbsp;<span class="op" id="6268658">:=</span>&nbsp;<span class="ident" id="6268661">signum</span><span class="op" id="6268667">(</span><span class="ident" id="6268668">sig</span><span class="op" id="6268671">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268674">if</span>&nbsp;<span class="ident" id="6268677">n</span>&nbsp;<span class="op" id="6268679">&lt;</span>&nbsp;<span class="num" id="6268681">0</span>&nbsp;<span class="op" id="6268683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268687">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268699">handlers</span><span class="op" id="6268707">.</span><span class="ident" id="6268708">Lock</span><span class="op" id="6268712">(</span><span class="op" id="6268713">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268716">defer</span>&nbsp;<span class="ident" id="6268722">handlers</span><span class="op" id="6268730">.</span><span class="ident" id="6268731">Unlock</span><span class="op" id="6268737">(</span><span class="op" id="6268738">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268742">for</span>&nbsp;<span class="ident" id="6268746">c</span><span class="op" id="6268747">,</span>&nbsp;<span class="ident" id="6268749">h</span>&nbsp;<span class="op" id="6268751">:=</span>&nbsp;<span class="keyword" id="6268754">range</span>&nbsp;<span class="ident" id="6268760">handlers</span><span class="op" id="6268768">.</span><span class="ident" id="6268769">m</span>&nbsp;<span class="op" id="6268771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268775">if</span>&nbsp;<span class="ident" id="6268778">h</span><span class="op" id="6268779">.</span><span class="ident" id="6268780">want</span><span class="op" id="6268784">(</span><span class="ident" id="6268785">n</span><span class="op" id="6268786">)</span>&nbsp;<span class="op" id="6268788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268793">//&nbsp;send&nbsp;but&nbsp;do&nbsp;not&nbsp;block&nbsp;for&nbsp;it</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268828">select</span>&nbsp;<span class="op" id="6268835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268840">case</span>&nbsp;<span class="ident" id="6268845">c</span>&nbsp;<span class="op" id="6268847">&lt;-</span>&nbsp;<span class="ident" id="6268850">sig</span><span class="op" id="6268853">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268858">default</span><span class="op" id="6268865">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268874">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268877">}</span><br>
<span class="lineno"></span><span class="op" id="6268879">}</span>
</div>
</body>
</html>
