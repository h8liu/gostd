<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html" class="current">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3166979">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3167035">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3167089">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3167140">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3167218">package</span>&nbsp;<span class="ident" id="3167226">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3167231">import</span>&nbsp;<span class="op" id="3167238">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3167241">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3167247">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3167258">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3167265">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3167268">//&nbsp;A&nbsp;sockaddr&nbsp;represents&nbsp;a&nbsp;TCP,&nbsp;UDP,&nbsp;IP&nbsp;or&nbsp;Unix&nbsp;network&nbsp;endpoint</span><br>
<span class="lineno"></span><span class="comment" id="3167333">//&nbsp;address&nbsp;that&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall.Sockaddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3167391">type</span>&nbsp;<span class="ident" id="3167396">sockaddr</span>&nbsp;<span class="keyword" id="3167405">interface</span>&nbsp;<span class="op" id="3167415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3167418">Addr</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3167425">netaddr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3167435">//&nbsp;family&nbsp;returns&nbsp;the&nbsp;platform-dependent&nbsp;address&nbsp;family</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3167492">//&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3167508">family</span><span class="op" id="3167514">(</span><span class="op" id="3167515">)</span>&nbsp;<span class="builtintype" id="3167517">int</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3167523">//&nbsp;isWildcard&nbsp;reports&nbsp;whether&nbsp;the&nbsp;address&nbsp;is&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3167580">//&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3167593">isWildcard</span><span class="op" id="3167603">(</span><span class="op" id="3167604">)</span>&nbsp;<span class="builtintype" id="3167606">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3167613">//&nbsp;sockaddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3167671">//&nbsp;sockaddr&nbsp;type&nbsp;that&nbsp;implements&nbsp;syscall.Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3167722">//&nbsp;interface.&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3167784">//&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3167793">sockaddr</span><span class="op" id="3167801">(</span><span class="ident" id="3167802">family</span>&nbsp;<span class="builtintype" id="3167809">int</span><span class="op" id="3167812">)</span>&nbsp;<span class="op" id="3167814">(</span><span class="ident" id="3167815">syscall</span><span class="op" id="3167822">.</span><span class="ident" id="3167823">Sockaddr</span><span class="op" id="3167831">,</span>&nbsp;<span class="builtintype" id="3167833">error</span><span class="op" id="3167838">)</span><br>
<span class="lineno">35</span><span class="op" id="3167840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3167843">//&nbsp;socket&nbsp;returns&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;that&nbsp;is&nbsp;ready&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3167905">//&nbsp;asynchronous&nbsp;I/O&nbsp;using&nbsp;the&nbsp;network&nbsp;poller.</span><br>
<span class="lineno"></span><span class="keyword" id="3167951">func</span>&nbsp;<span class="ident" id="3167956">socket</span><span class="op" id="3167962">(</span><span class="ident" id="3167963">net</span>&nbsp;<span class="builtintype" id="3167967">string</span><span class="op" id="3167973">,</span>&nbsp;<span class="ident" id="3167975">family</span><span class="op" id="3167981">,</span>&nbsp;<span class="ident" id="3167983">sotype</span><span class="op" id="3167989">,</span>&nbsp;<span class="ident" id="3167991">proto</span>&nbsp;<span class="builtintype" id="3167997">int</span><span class="op" id="3168000">,</span>&nbsp;<span class="ident" id="3168002">ipv6only</span>&nbsp;<span class="builtintype" id="3168011">bool</span><span class="op" id="3168015">,</span>&nbsp;<span class="ident" id="3168017">laddr</span><span class="op" id="3168022">,</span>&nbsp;<span class="ident" id="3168024">raddr</span>&nbsp;<span class="ident" id="3168030">sockaddr</span><span class="op" id="3168038">,</span>&nbsp;<span class="ident" id="3168040">deadline</span>&nbsp;<span class="ident" id="3168049">time</span><span class="op" id="3168053">.</span><span class="ident" id="3168054">Time</span><span class="op" id="3168058">)</span>&nbsp;<span class="op" id="3168060">(</span><span class="ident" id="3168061">fd</span>&nbsp;<span class="op" id="3168064">*</span><span class="ident" id="3168065">netFD</span><span class="op" id="3168070">,</span>&nbsp;<span class="ident" id="3168072">err</span>&nbsp;<span class="builtintype" id="3168076">error</span><span class="op" id="3168081">)</span>&nbsp;<span class="op" id="3168083">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3168086">s</span><span class="op" id="3168087">,</span>&nbsp;<span class="ident" id="3168089">err</span>&nbsp;<span class="op" id="3168093">:=</span>&nbsp;<span class="ident" id="3168096">sysSocket</span><span class="op" id="3168105">(</span><span class="ident" id="3168106">family</span><span class="op" id="3168112">,</span>&nbsp;<span class="ident" id="3168114">sotype</span><span class="op" id="3168120">,</span>&nbsp;<span class="ident" id="3168122">proto</span><span class="op" id="3168127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168130">if</span>&nbsp;<span class="ident" id="3168133">err</span>&nbsp;<span class="op" id="3168137">!=</span>&nbsp;<span class="ident" id="3168140">nil</span>&nbsp;<span class="op" id="3168144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168148">return</span>&nbsp;<span class="ident" id="3168155">nil</span><span class="op" id="3168158">,</span>&nbsp;<span class="ident" id="3168160">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3168165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168168">if</span>&nbsp;<span class="ident" id="3168171">err</span>&nbsp;<span class="op" id="3168175">=</span>&nbsp;<span class="ident" id="3168177">setDefaultSockopts</span><span class="op" id="3168195">(</span><span class="ident" id="3168196">s</span><span class="op" id="3168197">,</span>&nbsp;<span class="ident" id="3168199">family</span><span class="op" id="3168205">,</span>&nbsp;<span class="ident" id="3168207">sotype</span><span class="op" id="3168213">,</span>&nbsp;<span class="ident" id="3168215">ipv6only</span><span class="op" id="3168223">)</span><span class="op" id="3168224">;</span>&nbsp;<span class="ident" id="3168226">err</span>&nbsp;<span class="op" id="3168230">!=</span>&nbsp;<span class="ident" id="3168233">nil</span>&nbsp;<span class="op" id="3168237">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3168241">closesocket</span><span class="op" id="3168252">(</span><span class="ident" id="3168253">s</span><span class="op" id="3168254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168258">return</span>&nbsp;<span class="ident" id="3168265">nil</span><span class="op" id="3168268">,</span>&nbsp;<span class="ident" id="3168270">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3168275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168278">if</span>&nbsp;<span class="ident" id="3168281">fd</span><span class="op" id="3168283">,</span>&nbsp;<span class="ident" id="3168285">err</span>&nbsp;<span class="op" id="3168289">=</span>&nbsp;<span class="ident" id="3168291">newFD</span><span class="op" id="3168296">(</span><span class="ident" id="3168297">s</span><span class="op" id="3168298">,</span>&nbsp;<span class="ident" id="3168300">family</span><span class="op" id="3168306">,</span>&nbsp;<span class="ident" id="3168308">sotype</span><span class="op" id="3168314">,</span>&nbsp;<span class="ident" id="3168316">net</span><span class="op" id="3168319">)</span><span class="op" id="3168320">;</span>&nbsp;<span class="ident" id="3168322">err</span>&nbsp;<span class="op" id="3168326">!=</span>&nbsp;<span class="ident" id="3168329">nil</span>&nbsp;<span class="op" id="3168333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3168337">closesocket</span><span class="op" id="3168348">(</span><span class="ident" id="3168349">s</span><span class="op" id="3168350">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3168354">return</span>&nbsp;<span class="ident" id="3168361">nil</span><span class="op" id="3168364">,</span>&nbsp;<span class="ident" id="3168366">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3168371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3168375">//&nbsp;This&nbsp;function&nbsp;makes&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3168433">//&nbsp;following&nbsp;applications:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3168461">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3168465">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;passive&nbsp;stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3168518">//&nbsp;&nbsp;&nbsp;connenction,&nbsp;known&nbsp;as&nbsp;a&nbsp;stream&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3168564">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3168568">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;destination-unspecific</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3168629">//&nbsp;&nbsp;&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a&nbsp;datagram&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3168685">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3168689">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;an&nbsp;active&nbsp;stream&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3168747">//&nbsp;&nbsp;&nbsp;destination-specific&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3168806">//&nbsp;&nbsp;&nbsp;dialer</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3168819">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3168823">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;the&nbsp;other&nbsp;connection,&nbsp;such</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3168886">//&nbsp;&nbsp;&nbsp;as&nbsp;talking&nbsp;to&nbsp;the&nbsp;protocol&nbsp;stack&nbsp;inside&nbsp;the&nbsp;kernel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3168943">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3168947">//&nbsp;For&nbsp;stream&nbsp;and&nbsp;datagram&nbsp;listeners,&nbsp;they&nbsp;will&nbsp;only&nbsp;require</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3169009">//&nbsp;named&nbsp;sockets,&nbsp;so&nbsp;we&nbsp;can&nbsp;assume&nbsp;that&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3169070">//&nbsp;from&nbsp;stream&nbsp;or&nbsp;datagram&nbsp;listeners&nbsp;when&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3169134">//&nbsp;raddr&nbsp;is&nbsp;nil.&nbsp;Otherwise&nbsp;we&nbsp;assume&nbsp;it&#39;s&nbsp;just&nbsp;for&nbsp;dialers&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3169197">//&nbsp;the&nbsp;other&nbsp;connection&nbsp;holders.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169232">if</span>&nbsp;<span class="ident" id="3169235">laddr</span>&nbsp;<span class="op" id="3169241">!=</span>&nbsp;<span class="ident" id="3169244">nil</span>&nbsp;<span class="op" id="3169248">&amp;&amp;</span>&nbsp;<span class="ident" id="3169251">raddr</span>&nbsp;<span class="op" id="3169257">==</span>&nbsp;<span class="ident" id="3169260">nil</span>&nbsp;<span class="op" id="3169264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169268">switch</span>&nbsp;<span class="ident" id="3169275">sotype</span>&nbsp;<span class="op" id="3169282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169286">case</span>&nbsp;<span class="ident" id="3169291">syscall</span><span class="op" id="3169298">.</span><span class="ident" id="3169299">SOCK_STREAM</span><span class="op" id="3169310">,</span>&nbsp;<span class="ident" id="3169312">syscall</span><span class="op" id="3169319">.</span><span class="ident" id="3169320">SOCK_SEQPACKET</span><span class="op" id="3169334">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169339">if</span>&nbsp;<span class="ident" id="3169342">err</span>&nbsp;<span class="op" id="3169346">:=</span>&nbsp;<span class="ident" id="3169349">fd</span><span class="op" id="3169351">.</span><span class="ident" id="3169352">listenStream</span><span class="op" id="3169364">(</span><span class="ident" id="3169365">laddr</span><span class="op" id="3169370">,</span>&nbsp;<span class="ident" id="3169372">listenerBacklog</span><span class="op" id="3169387">)</span><span class="op" id="3169388">;</span>&nbsp;<span class="ident" id="3169390">err</span>&nbsp;<span class="op" id="3169394">!=</span>&nbsp;<span class="ident" id="3169397">nil</span>&nbsp;<span class="op" id="3169401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3169407">fd</span><span class="op" id="3169409">.</span><span class="ident" id="3169410">Close</span><span class="op" id="3169415">(</span><span class="op" id="3169416">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169422">return</span>&nbsp;<span class="ident" id="3169429">nil</span><span class="op" id="3169432">,</span>&nbsp;<span class="ident" id="3169434">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3169441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169446">return</span>&nbsp;<span class="ident" id="3169453">fd</span><span class="op" id="3169455">,</span>&nbsp;<span class="ident" id="3169457">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169463">case</span>&nbsp;<span class="ident" id="3169468">syscall</span><span class="op" id="3169475">.</span><span class="ident" id="3169476">SOCK_DGRAM</span><span class="op" id="3169486">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169491">if</span>&nbsp;<span class="ident" id="3169494">err</span>&nbsp;<span class="op" id="3169498">:=</span>&nbsp;<span class="ident" id="3169501">fd</span><span class="op" id="3169503">.</span><span class="ident" id="3169504">listenDatagram</span><span class="op" id="3169518">(</span><span class="ident" id="3169519">laddr</span><span class="op" id="3169524">)</span><span class="op" id="3169525">;</span>&nbsp;<span class="ident" id="3169527">err</span>&nbsp;<span class="op" id="3169531">!=</span>&nbsp;<span class="ident" id="3169534">nil</span>&nbsp;<span class="op" id="3169538">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3169544">fd</span><span class="op" id="3169546">.</span><span class="ident" id="3169547">Close</span><span class="op" id="3169552">(</span><span class="op" id="3169553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169559">return</span>&nbsp;<span class="ident" id="3169566">nil</span><span class="op" id="3169569">,</span>&nbsp;<span class="ident" id="3169571">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3169578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169583">return</span>&nbsp;<span class="ident" id="3169590">fd</span><span class="op" id="3169592">,</span>&nbsp;<span class="ident" id="3169594">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3169600">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3169603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169606">if</span>&nbsp;<span class="ident" id="3169609">err</span>&nbsp;<span class="op" id="3169613">:=</span>&nbsp;<span class="ident" id="3169616">fd</span><span class="op" id="3169618">.</span><span class="ident" id="3169619">dial</span><span class="op" id="3169623">(</span><span class="ident" id="3169624">laddr</span><span class="op" id="3169629">,</span>&nbsp;<span class="ident" id="3169631">raddr</span><span class="op" id="3169636">,</span>&nbsp;<span class="ident" id="3169638">deadline</span><span class="op" id="3169646">)</span><span class="op" id="3169647">;</span>&nbsp;<span class="ident" id="3169649">err</span>&nbsp;<span class="op" id="3169653">!=</span>&nbsp;<span class="ident" id="3169656">nil</span>&nbsp;<span class="op" id="3169660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3169664">fd</span><span class="op" id="3169666">.</span><span class="ident" id="3169667">Close</span><span class="op" id="3169672">(</span><span class="op" id="3169673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169677">return</span>&nbsp;<span class="ident" id="3169684">nil</span><span class="op" id="3169687">,</span>&nbsp;<span class="ident" id="3169689">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3169694">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169697">return</span>&nbsp;<span class="ident" id="3169704">fd</span><span class="op" id="3169706">,</span>&nbsp;<span class="ident" id="3169708">nil</span><br>
<span class="lineno"></span><span class="op" id="3169712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3169715">func</span>&nbsp;<span class="op" id="3169720">(</span><span class="ident" id="3169721">fd</span>&nbsp;<span class="op" id="3169724">*</span><span class="ident" id="3169725">netFD</span><span class="op" id="3169730">)</span>&nbsp;<span class="ident" id="3169732">addrFunc</span><span class="op" id="3169740">(</span><span class="op" id="3169741">)</span>&nbsp;<span class="keyword" id="3169743">func</span><span class="op" id="3169747">(</span><span class="ident" id="3169748">syscall</span><span class="op" id="3169755">.</span><span class="ident" id="3169756">Sockaddr</span><span class="op" id="3169764">)</span>&nbsp;<span class="ident" id="3169766">Addr</span>&nbsp;<span class="op" id="3169771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169774">switch</span>&nbsp;<span class="ident" id="3169781">fd</span><span class="op" id="3169783">.</span><span class="ident" id="3169784">family</span>&nbsp;<span class="op" id="3169791">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169794">case</span>&nbsp;<span class="ident" id="3169799">syscall</span><span class="op" id="3169806">.</span><span class="ident" id="3169807">AF_INET</span><span class="op" id="3169814">,</span>&nbsp;<span class="ident" id="3169816">syscall</span><span class="op" id="3169823">.</span><span class="ident" id="3169824">AF_INET6</span><span class="op" id="3169832">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169836">switch</span>&nbsp;<span class="ident" id="3169843">fd</span><span class="op" id="3169845">.</span><span class="ident" id="3169846">sotype</span>&nbsp;<span class="op" id="3169853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169857">case</span>&nbsp;<span class="ident" id="3169862">syscall</span><span class="op" id="3169869">.</span><span class="ident" id="3169870">SOCK_STREAM</span><span class="op" id="3169881">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169886">return</span>&nbsp;<span class="ident" id="3169893">sockaddrToTCP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169909">case</span>&nbsp;<span class="ident" id="3169914">syscall</span><span class="op" id="3169921">.</span><span class="ident" id="3169922">SOCK_DGRAM</span><span class="op" id="3169932">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169937">return</span>&nbsp;<span class="ident" id="3169944">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169960">case</span>&nbsp;<span class="ident" id="3169965">syscall</span><span class="op" id="3169972">.</span><span class="ident" id="3169973">SOCK_RAW</span><span class="op" id="3169981">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3169986">return</span>&nbsp;<span class="ident" id="3169993">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3170008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170011">case</span>&nbsp;<span class="ident" id="3170016">syscall</span><span class="op" id="3170023">.</span><span class="ident" id="3170024">AF_UNIX</span><span class="op" id="3170031">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170035">switch</span>&nbsp;<span class="ident" id="3170042">fd</span><span class="op" id="3170044">.</span><span class="ident" id="3170045">sotype</span>&nbsp;<span class="op" id="3170052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170056">case</span>&nbsp;<span class="ident" id="3170061">syscall</span><span class="op" id="3170068">.</span><span class="ident" id="3170069">SOCK_STREAM</span><span class="op" id="3170080">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170085">return</span>&nbsp;<span class="ident" id="3170092">sockaddrToUnix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170109">case</span>&nbsp;<span class="ident" id="3170114">syscall</span><span class="op" id="3170121">.</span><span class="ident" id="3170122">SOCK_DGRAM</span><span class="op" id="3170132">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170137">return</span>&nbsp;<span class="ident" id="3170144">sockaddrToUnixgram</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170165">case</span>&nbsp;<span class="ident" id="3170170">syscall</span><span class="op" id="3170177">.</span><span class="ident" id="3170178">SOCK_SEQPACKET</span><span class="op" id="3170192">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170197">return</span>&nbsp;<span class="ident" id="3170204">sockaddrToUnixpacket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3170227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3170230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170233">return</span>&nbsp;<span class="keyword" id="3170240">func</span><span class="op" id="3170244">(</span><span class="ident" id="3170245">syscall</span><span class="op" id="3170252">.</span><span class="ident" id="3170253">Sockaddr</span><span class="op" id="3170261">)</span>&nbsp;<span class="ident" id="3170263">Addr</span>&nbsp;<span class="op" id="3170268">{</span>&nbsp;<span class="keyword" id="3170270">return</span>&nbsp;<span class="ident" id="3170277">nil</span>&nbsp;<span class="op" id="3170281">}</span><br>
<span class="lineno">120</span><span class="op" id="3170283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3170286">func</span>&nbsp;<span class="op" id="3170291">(</span><span class="ident" id="3170292">fd</span>&nbsp;<span class="op" id="3170295">*</span><span class="ident" id="3170296">netFD</span><span class="op" id="3170301">)</span>&nbsp;<span class="ident" id="3170303">dial</span><span class="op" id="3170307">(</span><span class="ident" id="3170308">laddr</span><span class="op" id="3170313">,</span>&nbsp;<span class="ident" id="3170315">raddr</span>&nbsp;<span class="ident" id="3170321">sockaddr</span><span class="op" id="3170329">,</span>&nbsp;<span class="ident" id="3170331">deadline</span>&nbsp;<span class="ident" id="3170340">time</span><span class="op" id="3170344">.</span><span class="ident" id="3170345">Time</span><span class="op" id="3170349">)</span>&nbsp;<span class="builtintype" id="3170351">error</span>&nbsp;<span class="op" id="3170357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170360">var</span>&nbsp;<span class="ident" id="3170364">err</span>&nbsp;<span class="builtintype" id="3170368">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170375">var</span>&nbsp;<span class="ident" id="3170379">lsa</span>&nbsp;<span class="ident" id="3170383">syscall</span><span class="op" id="3170390">.</span><span class="ident" id="3170391">Sockaddr</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170401">if</span>&nbsp;<span class="ident" id="3170404">laddr</span>&nbsp;<span class="op" id="3170410">!=</span>&nbsp;<span class="ident" id="3170413">nil</span>&nbsp;<span class="op" id="3170417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170421">if</span>&nbsp;<span class="ident" id="3170424">lsa</span><span class="op" id="3170427">,</span>&nbsp;<span class="ident" id="3170429">err</span>&nbsp;<span class="op" id="3170433">=</span>&nbsp;<span class="ident" id="3170435">laddr</span><span class="op" id="3170440">.</span><span class="ident" id="3170441">sockaddr</span><span class="op" id="3170449">(</span><span class="ident" id="3170450">fd</span><span class="op" id="3170452">.</span><span class="ident" id="3170453">family</span><span class="op" id="3170459">)</span><span class="op" id="3170460">;</span>&nbsp;<span class="ident" id="3170462">err</span>&nbsp;<span class="op" id="3170466">!=</span>&nbsp;<span class="ident" id="3170469">nil</span>&nbsp;<span class="op" id="3170473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170478">return</span>&nbsp;<span class="ident" id="3170485">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3170491">}</span>&nbsp;<span class="keyword" id="3170493">else</span>&nbsp;<span class="keyword" id="3170498">if</span>&nbsp;<span class="ident" id="3170501">lsa</span>&nbsp;<span class="op" id="3170505">!=</span>&nbsp;<span class="ident" id="3170508">nil</span>&nbsp;<span class="op" id="3170512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170517">if</span>&nbsp;<span class="ident" id="3170520">err</span>&nbsp;<span class="op" id="3170524">:=</span>&nbsp;<span class="ident" id="3170527">syscall</span><span class="op" id="3170534">.</span><span class="ident" id="3170535">Bind</span><span class="op" id="3170539">(</span><span class="ident" id="3170540">fd</span><span class="op" id="3170542">.</span><span class="ident" id="3170543">sysfd</span><span class="op" id="3170548">,</span>&nbsp;<span class="ident" id="3170550">lsa</span><span class="op" id="3170553">)</span><span class="op" id="3170554">;</span>&nbsp;<span class="ident" id="3170556">err</span>&nbsp;<span class="op" id="3170560">!=</span>&nbsp;<span class="ident" id="3170563">nil</span>&nbsp;<span class="op" id="3170567">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170573">return</span>&nbsp;<span class="ident" id="3170580">os</span><span class="op" id="3170582">.</span><span class="ident" id="3170583">NewSyscallError</span><span class="op" id="3170598">(</span><span class="string" id="3170599">&#34;bind&#34;</span><span class="op" id="3170605">,</span>&nbsp;<span class="ident" id="3170607">err</span><span class="op" id="3170610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3170615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3170619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3170622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170625">var</span>&nbsp;<span class="ident" id="3170629">rsa</span>&nbsp;<span class="ident" id="3170633">syscall</span><span class="op" id="3170640">.</span><span class="ident" id="3170641">Sockaddr</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170651">if</span>&nbsp;<span class="ident" id="3170654">raddr</span>&nbsp;<span class="op" id="3170660">!=</span>&nbsp;<span class="ident" id="3170663">nil</span>&nbsp;<span class="op" id="3170667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170671">if</span>&nbsp;<span class="ident" id="3170674">rsa</span><span class="op" id="3170677">,</span>&nbsp;<span class="ident" id="3170679">err</span>&nbsp;<span class="op" id="3170683">=</span>&nbsp;<span class="ident" id="3170685">raddr</span><span class="op" id="3170690">.</span><span class="ident" id="3170691">sockaddr</span><span class="op" id="3170699">(</span><span class="ident" id="3170700">fd</span><span class="op" id="3170702">.</span><span class="ident" id="3170703">family</span><span class="op" id="3170709">)</span><span class="op" id="3170710">;</span>&nbsp;<span class="ident" id="3170712">err</span>&nbsp;<span class="op" id="3170716">!=</span>&nbsp;<span class="ident" id="3170719">nil</span>&nbsp;<span class="op" id="3170723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170728">return</span>&nbsp;<span class="ident" id="3170735">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3170741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170745">if</span>&nbsp;<span class="ident" id="3170748">err</span>&nbsp;<span class="op" id="3170752">:=</span>&nbsp;<span class="ident" id="3170755">fd</span><span class="op" id="3170757">.</span><span class="ident" id="3170758">connect</span><span class="op" id="3170765">(</span><span class="ident" id="3170766">lsa</span><span class="op" id="3170769">,</span>&nbsp;<span class="ident" id="3170771">rsa</span><span class="op" id="3170774">,</span>&nbsp;<span class="ident" id="3170776">deadline</span><span class="op" id="3170784">)</span><span class="op" id="3170785">;</span>&nbsp;<span class="ident" id="3170787">err</span>&nbsp;<span class="op" id="3170791">!=</span>&nbsp;<span class="ident" id="3170794">nil</span>&nbsp;<span class="op" id="3170798">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170803">return</span>&nbsp;<span class="ident" id="3170810">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3170816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3170820">fd</span><span class="op" id="3170822">.</span><span class="ident" id="3170823">isConnected</span>&nbsp;<span class="op" id="3170835">=</span>&nbsp;<span class="builtintype" id="3170837">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3170843">}</span>&nbsp;<span class="keyword" id="3170845">else</span>&nbsp;<span class="op" id="3170850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170854">if</span>&nbsp;<span class="ident" id="3170857">err</span>&nbsp;<span class="op" id="3170861">:=</span>&nbsp;<span class="ident" id="3170864">fd</span><span class="op" id="3170866">.</span><span class="ident" id="3170867">init</span><span class="op" id="3170871">(</span><span class="op" id="3170872">)</span><span class="op" id="3170873">;</span>&nbsp;<span class="ident" id="3170875">err</span>&nbsp;<span class="op" id="3170879">!=</span>&nbsp;<span class="ident" id="3170882">nil</span>&nbsp;<span class="op" id="3170886">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170891">return</span>&nbsp;<span class="ident" id="3170898">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3170904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3170907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3170910">lsa</span><span class="op" id="3170913">,</span>&nbsp;<span class="ident" id="3170915">_</span>&nbsp;<span class="op" id="3170917">=</span>&nbsp;<span class="ident" id="3170919">syscall</span><span class="op" id="3170926">.</span><span class="ident" id="3170927">Getsockname</span><span class="op" id="3170938">(</span><span class="ident" id="3170939">fd</span><span class="op" id="3170941">.</span><span class="ident" id="3170942">sysfd</span><span class="op" id="3170947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3170950">if</span>&nbsp;<span class="ident" id="3170953">rsa</span><span class="op" id="3170956">,</span>&nbsp;<span class="ident" id="3170958">_</span>&nbsp;<span class="op" id="3170960">=</span>&nbsp;<span class="ident" id="3170962">syscall</span><span class="op" id="3170969">.</span><span class="ident" id="3170970">Getpeername</span><span class="op" id="3170981">(</span><span class="ident" id="3170982">fd</span><span class="op" id="3170984">.</span><span class="ident" id="3170985">sysfd</span><span class="op" id="3170990">)</span><span class="op" id="3170991">;</span>&nbsp;<span class="ident" id="3170993">rsa</span>&nbsp;<span class="op" id="3170997">!=</span>&nbsp;<span class="ident" id="3171000">nil</span>&nbsp;<span class="op" id="3171004">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171008">fd</span><span class="op" id="3171010">.</span><span class="ident" id="3171011">setAddr</span><span class="op" id="3171018">(</span><span class="ident" id="3171019">fd</span><span class="op" id="3171021">.</span><span class="ident" id="3171022">addrFunc</span><span class="op" id="3171030">(</span><span class="op" id="3171031">)</span><span class="op" id="3171032">(</span><span class="ident" id="3171033">lsa</span><span class="op" id="3171036">)</span><span class="op" id="3171037">,</span>&nbsp;<span class="ident" id="3171039">fd</span><span class="op" id="3171041">.</span><span class="ident" id="3171042">addrFunc</span><span class="op" id="3171050">(</span><span class="op" id="3171051">)</span><span class="op" id="3171052">(</span><span class="ident" id="3171053">rsa</span><span class="op" id="3171056">)</span><span class="op" id="3171057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171060">}</span>&nbsp;<span class="keyword" id="3171062">else</span>&nbsp;<span class="op" id="3171067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171071">fd</span><span class="op" id="3171073">.</span><span class="ident" id="3171074">setAddr</span><span class="op" id="3171081">(</span><span class="ident" id="3171082">fd</span><span class="op" id="3171084">.</span><span class="ident" id="3171085">addrFunc</span><span class="op" id="3171093">(</span><span class="op" id="3171094">)</span><span class="op" id="3171095">(</span><span class="ident" id="3171096">lsa</span><span class="op" id="3171099">)</span><span class="op" id="3171100">,</span>&nbsp;<span class="ident" id="3171102">raddr</span><span class="op" id="3171107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171113">return</span>&nbsp;<span class="ident" id="3171120">nil</span><br>
<span class="lineno">155</span><span class="op" id="3171124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3171127">func</span>&nbsp;<span class="op" id="3171132">(</span><span class="ident" id="3171133">fd</span>&nbsp;<span class="op" id="3171136">*</span><span class="ident" id="3171137">netFD</span><span class="op" id="3171142">)</span>&nbsp;<span class="ident" id="3171144">listenStream</span><span class="op" id="3171156">(</span><span class="ident" id="3171157">laddr</span>&nbsp;<span class="ident" id="3171163">sockaddr</span><span class="op" id="3171171">,</span>&nbsp;<span class="ident" id="3171173">backlog</span>&nbsp;<span class="builtintype" id="3171181">int</span><span class="op" id="3171184">)</span>&nbsp;<span class="builtintype" id="3171186">error</span>&nbsp;<span class="op" id="3171192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171195">if</span>&nbsp;<span class="ident" id="3171198">err</span>&nbsp;<span class="op" id="3171202">:=</span>&nbsp;<span class="ident" id="3171205">setDefaultListenerSockopts</span><span class="op" id="3171231">(</span><span class="ident" id="3171232">fd</span><span class="op" id="3171234">.</span><span class="ident" id="3171235">sysfd</span><span class="op" id="3171240">)</span><span class="op" id="3171241">;</span>&nbsp;<span class="ident" id="3171243">err</span>&nbsp;<span class="op" id="3171247">!=</span>&nbsp;<span class="ident" id="3171250">nil</span>&nbsp;<span class="op" id="3171254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171258">return</span>&nbsp;<span class="ident" id="3171265">err</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171273">if</span>&nbsp;<span class="ident" id="3171276">lsa</span><span class="op" id="3171279">,</span>&nbsp;<span class="ident" id="3171281">err</span>&nbsp;<span class="op" id="3171285">:=</span>&nbsp;<span class="ident" id="3171288">laddr</span><span class="op" id="3171293">.</span><span class="ident" id="3171294">sockaddr</span><span class="op" id="3171302">(</span><span class="ident" id="3171303">fd</span><span class="op" id="3171305">.</span><span class="ident" id="3171306">family</span><span class="op" id="3171312">)</span><span class="op" id="3171313">;</span>&nbsp;<span class="ident" id="3171315">err</span>&nbsp;<span class="op" id="3171319">!=</span>&nbsp;<span class="ident" id="3171322">nil</span>&nbsp;<span class="op" id="3171326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171330">return</span>&nbsp;<span class="ident" id="3171337">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171342">}</span>&nbsp;<span class="keyword" id="3171344">else</span>&nbsp;<span class="keyword" id="3171349">if</span>&nbsp;<span class="ident" id="3171352">lsa</span>&nbsp;<span class="op" id="3171356">!=</span>&nbsp;<span class="ident" id="3171359">nil</span>&nbsp;<span class="op" id="3171363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171367">if</span>&nbsp;<span class="ident" id="3171370">err</span>&nbsp;<span class="op" id="3171374">:=</span>&nbsp;<span class="ident" id="3171377">syscall</span><span class="op" id="3171384">.</span><span class="ident" id="3171385">Bind</span><span class="op" id="3171389">(</span><span class="ident" id="3171390">fd</span><span class="op" id="3171392">.</span><span class="ident" id="3171393">sysfd</span><span class="op" id="3171398">,</span>&nbsp;<span class="ident" id="3171400">lsa</span><span class="op" id="3171403">)</span><span class="op" id="3171404">;</span>&nbsp;<span class="ident" id="3171406">err</span>&nbsp;<span class="op" id="3171410">!=</span>&nbsp;<span class="ident" id="3171413">nil</span>&nbsp;<span class="op" id="3171417">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171422">return</span>&nbsp;<span class="ident" id="3171429">os</span><span class="op" id="3171431">.</span><span class="ident" id="3171432">NewSyscallError</span><span class="op" id="3171447">(</span><span class="string" id="3171448">&#34;bind&#34;</span><span class="op" id="3171454">,</span>&nbsp;<span class="ident" id="3171456">err</span><span class="op" id="3171459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171469">if</span>&nbsp;<span class="ident" id="3171472">err</span>&nbsp;<span class="op" id="3171476">:=</span>&nbsp;<span class="ident" id="3171479">syscall</span><span class="op" id="3171486">.</span><span class="ident" id="3171487">Listen</span><span class="op" id="3171493">(</span><span class="ident" id="3171494">fd</span><span class="op" id="3171496">.</span><span class="ident" id="3171497">sysfd</span><span class="op" id="3171502">,</span>&nbsp;<span class="ident" id="3171504">backlog</span><span class="op" id="3171511">)</span><span class="op" id="3171512">;</span>&nbsp;<span class="ident" id="3171514">err</span>&nbsp;<span class="op" id="3171518">!=</span>&nbsp;<span class="ident" id="3171521">nil</span>&nbsp;<span class="op" id="3171525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171529">return</span>&nbsp;<span class="ident" id="3171536">os</span><span class="op" id="3171538">.</span><span class="ident" id="3171539">NewSyscallError</span><span class="op" id="3171554">(</span><span class="string" id="3171555">&#34;listen&#34;</span><span class="op" id="3171563">,</span>&nbsp;<span class="ident" id="3171565">err</span><span class="op" id="3171568">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171574">if</span>&nbsp;<span class="ident" id="3171577">err</span>&nbsp;<span class="op" id="3171581">:=</span>&nbsp;<span class="ident" id="3171584">fd</span><span class="op" id="3171586">.</span><span class="ident" id="3171587">init</span><span class="op" id="3171591">(</span><span class="op" id="3171592">)</span><span class="op" id="3171593">;</span>&nbsp;<span class="ident" id="3171595">err</span>&nbsp;<span class="op" id="3171599">!=</span>&nbsp;<span class="ident" id="3171602">nil</span>&nbsp;<span class="op" id="3171606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171610">return</span>&nbsp;<span class="ident" id="3171617">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3171622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171625">lsa</span><span class="op" id="3171628">,</span>&nbsp;<span class="ident" id="3171630">_</span>&nbsp;<span class="op" id="3171632">:=</span>&nbsp;<span class="ident" id="3171635">syscall</span><span class="op" id="3171642">.</span><span class="ident" id="3171643">Getsockname</span><span class="op" id="3171654">(</span><span class="ident" id="3171655">fd</span><span class="op" id="3171657">.</span><span class="ident" id="3171658">sysfd</span><span class="op" id="3171663">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3171666">fd</span><span class="op" id="3171668">.</span><span class="ident" id="3171669">setAddr</span><span class="op" id="3171676">(</span><span class="ident" id="3171677">fd</span><span class="op" id="3171679">.</span><span class="ident" id="3171680">addrFunc</span><span class="op" id="3171688">(</span><span class="op" id="3171689">)</span><span class="op" id="3171690">(</span><span class="ident" id="3171691">lsa</span><span class="op" id="3171694">)</span><span class="op" id="3171695">,</span>&nbsp;<span class="ident" id="3171697">nil</span><span class="op" id="3171700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171703">return</span>&nbsp;<span class="ident" id="3171710">nil</span><br>
<span class="lineno"></span><span class="op" id="3171714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3171717">func</span>&nbsp;<span class="op" id="3171722">(</span><span class="ident" id="3171723">fd</span>&nbsp;<span class="op" id="3171726">*</span><span class="ident" id="3171727">netFD</span><span class="op" id="3171732">)</span>&nbsp;<span class="ident" id="3171734">listenDatagram</span><span class="op" id="3171748">(</span><span class="ident" id="3171749">laddr</span>&nbsp;<span class="ident" id="3171755">sockaddr</span><span class="op" id="3171763">)</span>&nbsp;<span class="builtintype" id="3171765">error</span>&nbsp;<span class="op" id="3171771">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171774">switch</span>&nbsp;<span class="ident" id="3171781">addr</span>&nbsp;<span class="op" id="3171786">:=</span>&nbsp;<span class="ident" id="3171789">laddr</span><span class="op" id="3171794">.</span><span class="op" id="3171795">(</span><span class="keyword" id="3171796">type</span><span class="op" id="3171800">)</span>&nbsp;<span class="op" id="3171802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3171805">case</span>&nbsp;<span class="op" id="3171810">*</span><span class="ident" id="3171811">UDPAddr</span><span class="op" id="3171818">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3171822">//&nbsp;We&nbsp;provide&nbsp;a&nbsp;socket&nbsp;that&nbsp;listens&nbsp;to&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3171874">//&nbsp;address&nbsp;with&nbsp;reusable&nbsp;UDP&nbsp;port&nbsp;when&nbsp;the&nbsp;given&nbsp;laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3171931">//&nbsp;is&nbsp;an&nbsp;appropriate&nbsp;UDP&nbsp;multicast&nbsp;address&nbsp;prefix.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3171984">//&nbsp;This&nbsp;makes&nbsp;it&nbsp;possible&nbsp;for&nbsp;a&nbsp;single&nbsp;UDP&nbsp;listener&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3172041">//&nbsp;join&nbsp;multiple&nbsp;different&nbsp;group&nbsp;addresses,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3172091">//&nbsp;multiple&nbsp;UDP&nbsp;listeners&nbsp;that&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;UDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3172147">//&nbsp;port&nbsp;to&nbsp;join&nbsp;the&nbsp;same&nbsp;group&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172189">if</span>&nbsp;<span class="ident" id="3172192">addr</span><span class="op" id="3172196">.</span><span class="ident" id="3172197">IP</span>&nbsp;<span class="op" id="3172200">!=</span>&nbsp;<span class="ident" id="3172203">nil</span>&nbsp;<span class="op" id="3172207">&amp;&amp;</span>&nbsp;<span class="ident" id="3172210">addr</span><span class="op" id="3172214">.</span><span class="ident" id="3172215">IP</span><span class="op" id="3172217">.</span><span class="ident" id="3172218">IsMulticast</span><span class="op" id="3172229">(</span><span class="op" id="3172230">)</span>&nbsp;<span class="op" id="3172232">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172237">if</span>&nbsp;<span class="ident" id="3172240">err</span>&nbsp;<span class="op" id="3172244">:=</span>&nbsp;<span class="ident" id="3172247">setDefaultMulticastSockopts</span><span class="op" id="3172274">(</span><span class="ident" id="3172275">fd</span><span class="op" id="3172277">.</span><span class="ident" id="3172278">sysfd</span><span class="op" id="3172283">)</span><span class="op" id="3172284">;</span>&nbsp;<span class="ident" id="3172286">err</span>&nbsp;<span class="op" id="3172290">!=</span>&nbsp;<span class="ident" id="3172293">nil</span>&nbsp;<span class="op" id="3172297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172303">return</span>&nbsp;<span class="ident" id="3172310">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3172317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3172322">addr</span>&nbsp;<span class="op" id="3172327">:=</span>&nbsp;<span class="op" id="3172330">*</span><span class="ident" id="3172331">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172339">switch</span>&nbsp;<span class="ident" id="3172346">fd</span><span class="op" id="3172348">.</span><span class="ident" id="3172349">family</span>&nbsp;<span class="op" id="3172356">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172361">case</span>&nbsp;<span class="ident" id="3172366">syscall</span><span class="op" id="3172373">.</span><span class="ident" id="3172374">AF_INET</span><span class="op" id="3172381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3172387">addr</span><span class="op" id="3172391">.</span><span class="ident" id="3172392">IP</span>&nbsp;<span class="op" id="3172395">=</span>&nbsp;<span class="ident" id="3172397">IPv4zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172409">case</span>&nbsp;<span class="ident" id="3172414">syscall</span><span class="op" id="3172421">.</span><span class="ident" id="3172422">AF_INET6</span><span class="op" id="3172430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3172436">addr</span><span class="op" id="3172440">.</span><span class="ident" id="3172441">IP</span>&nbsp;<span class="op" id="3172444">=</span>&nbsp;<span class="ident" id="3172446">IPv6unspecified</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3172465">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3172470">laddr</span>&nbsp;<span class="op" id="3172476">=</span>&nbsp;<span class="op" id="3172478">&amp;</span><span class="ident" id="3172479">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3172486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3172489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172492">if</span>&nbsp;<span class="ident" id="3172495">lsa</span><span class="op" id="3172498">,</span>&nbsp;<span class="ident" id="3172500">err</span>&nbsp;<span class="op" id="3172504">:=</span>&nbsp;<span class="ident" id="3172507">laddr</span><span class="op" id="3172512">.</span><span class="ident" id="3172513">sockaddr</span><span class="op" id="3172521">(</span><span class="ident" id="3172522">fd</span><span class="op" id="3172524">.</span><span class="ident" id="3172525">family</span><span class="op" id="3172531">)</span><span class="op" id="3172532">;</span>&nbsp;<span class="ident" id="3172534">err</span>&nbsp;<span class="op" id="3172538">!=</span>&nbsp;<span class="ident" id="3172541">nil</span>&nbsp;<span class="op" id="3172545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172549">return</span>&nbsp;<span class="ident" id="3172556">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3172561">}</span>&nbsp;<span class="keyword" id="3172563">else</span>&nbsp;<span class="keyword" id="3172568">if</span>&nbsp;<span class="ident" id="3172571">lsa</span>&nbsp;<span class="op" id="3172575">!=</span>&nbsp;<span class="ident" id="3172578">nil</span>&nbsp;<span class="op" id="3172582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172586">if</span>&nbsp;<span class="ident" id="3172589">err</span>&nbsp;<span class="op" id="3172593">:=</span>&nbsp;<span class="ident" id="3172596">syscall</span><span class="op" id="3172603">.</span><span class="ident" id="3172604">Bind</span><span class="op" id="3172608">(</span><span class="ident" id="3172609">fd</span><span class="op" id="3172611">.</span><span class="ident" id="3172612">sysfd</span><span class="op" id="3172617">,</span>&nbsp;<span class="ident" id="3172619">lsa</span><span class="op" id="3172622">)</span><span class="op" id="3172623">;</span>&nbsp;<span class="ident" id="3172625">err</span>&nbsp;<span class="op" id="3172629">!=</span>&nbsp;<span class="ident" id="3172632">nil</span>&nbsp;<span class="op" id="3172636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172641">return</span>&nbsp;<span class="ident" id="3172648">os</span><span class="op" id="3172650">.</span><span class="ident" id="3172651">NewSyscallError</span><span class="op" id="3172666">(</span><span class="string" id="3172667">&#34;bind&#34;</span><span class="op" id="3172673">,</span>&nbsp;<span class="ident" id="3172675">err</span><span class="op" id="3172678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3172682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3172685">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172688">if</span>&nbsp;<span class="ident" id="3172691">err</span>&nbsp;<span class="op" id="3172695">:=</span>&nbsp;<span class="ident" id="3172698">fd</span><span class="op" id="3172700">.</span><span class="ident" id="3172701">init</span><span class="op" id="3172705">(</span><span class="op" id="3172706">)</span><span class="op" id="3172707">;</span>&nbsp;<span class="ident" id="3172709">err</span>&nbsp;<span class="op" id="3172713">!=</span>&nbsp;<span class="ident" id="3172716">nil</span>&nbsp;<span class="op" id="3172720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172724">return</span>&nbsp;<span class="ident" id="3172731">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3172736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3172739">lsa</span><span class="op" id="3172742">,</span>&nbsp;<span class="ident" id="3172744">_</span>&nbsp;<span class="op" id="3172746">:=</span>&nbsp;<span class="ident" id="3172749">syscall</span><span class="op" id="3172756">.</span><span class="ident" id="3172757">Getsockname</span><span class="op" id="3172768">(</span><span class="ident" id="3172769">fd</span><span class="op" id="3172771">.</span><span class="ident" id="3172772">sysfd</span><span class="op" id="3172777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3172780">fd</span><span class="op" id="3172782">.</span><span class="ident" id="3172783">setAddr</span><span class="op" id="3172790">(</span><span class="ident" id="3172791">fd</span><span class="op" id="3172793">.</span><span class="ident" id="3172794">addrFunc</span><span class="op" id="3172802">(</span><span class="op" id="3172803">)</span><span class="op" id="3172804">(</span><span class="ident" id="3172805">lsa</span><span class="op" id="3172808">)</span><span class="op" id="3172809">,</span>&nbsp;<span class="ident" id="3172811">nil</span><span class="op" id="3172814">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3172817">return</span>&nbsp;<span class="ident" id="3172824">nil</span><br>
<span class="lineno"></span><span class="op" id="3172828">}</span>
</div>
</body>
</html>
