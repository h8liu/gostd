<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6060545">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6060600">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6060654">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6060705">/*<br>
<span class="lineno"></span>Package&nbsp;zip&nbsp;provides&nbsp;support&nbsp;for&nbsp;reading&nbsp;and&nbsp;writing&nbsp;ZIP&nbsp;archives.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>See:&nbsp;http://www.pkware.com/documents/casestudies/APPNOTE.TXT<br>
<span class="lineno"></span><br>
<span class="lineno">10</span>This&nbsp;package&nbsp;does&nbsp;not&nbsp;support&nbsp;disk&nbsp;spanning.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>A&nbsp;note&nbsp;about&nbsp;ZIP64:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>To&nbsp;be&nbsp;backwards&nbsp;compatible&nbsp;the&nbsp;FileHeader&nbsp;has&nbsp;both&nbsp;32&nbsp;and&nbsp;64&nbsp;bit&nbsp;Size<br>
<span class="lineno">15</span>fields.&nbsp;The&nbsp;64&nbsp;bit&nbsp;fields&nbsp;will&nbsp;always&nbsp;contain&nbsp;the&nbsp;correct&nbsp;value&nbsp;and<br>
<span class="lineno"></span>for&nbsp;normal&nbsp;archives&nbsp;both&nbsp;fields&nbsp;will&nbsp;be&nbsp;the&nbsp;same.&nbsp;For&nbsp;files&nbsp;requiring<br>
<span class="lineno"></span>the&nbsp;ZIP64&nbsp;format&nbsp;the&nbsp;32&nbsp;bit&nbsp;fields&nbsp;will&nbsp;be&nbsp;0xffffffff&nbsp;and&nbsp;the&nbsp;64&nbsp;bit<br>
<span class="lineno"></span>fields&nbsp;must&nbsp;be&nbsp;used&nbsp;instead.<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno">20</span><span class="keyword" id="6061214">package</span>&nbsp;<span class="ident" id="6061222">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6061227">import</span>&nbsp;<span class="op" id="6061234">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6061237">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6061243">&#34;path&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6061251">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6061258">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6061261">//&nbsp;Compression&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="6061285">const</span>&nbsp;<span class="op" id="6061291">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061294">Store</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6061302">uint16</span>&nbsp;<span class="op" id="6061309">=</span>&nbsp;<span class="num" id="6061311">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061314">Deflate</span>&nbsp;<span class="builtintype" id="6061322">uint16</span>&nbsp;<span class="op" id="6061329">=</span>&nbsp;<span class="num" id="6061331">8</span><br>
<span class="lineno"></span><span class="op" id="6061333">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6061336">const</span>&nbsp;<span class="op" id="6061342">(</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061345">fileHeaderSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061370">=</span>&nbsp;<span class="num" id="6061372">0x04034b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061384">directoryHeaderSignature</span>&nbsp;<span class="op" id="6061409">=</span>&nbsp;<span class="num" id="6061411">0x02014b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061423">directoryEndSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061448">=</span>&nbsp;<span class="num" id="6061450">0x06054b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061462">directory64LocSignature</span>&nbsp;&nbsp;<span class="op" id="6061487">=</span>&nbsp;<span class="num" id="6061489">0x07064b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061501">directory64EndSignature</span>&nbsp;&nbsp;<span class="op" id="6061526">=</span>&nbsp;<span class="num" id="6061528">0x06064b50</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061540">dataDescriptorSignature</span>&nbsp;&nbsp;<span class="op" id="6061565">=</span>&nbsp;<span class="num" id="6061567">0x08074b50</span>&nbsp;<span class="comment" id="6061578">//&nbsp;de-facto&nbsp;standard;&nbsp;required&nbsp;by&nbsp;OS&nbsp;X&nbsp;Finder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061625">fileHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061650">=</span>&nbsp;<span class="num" id="6061652">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6061663">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061686">directoryHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061711">=</span>&nbsp;<span class="num" id="6061713">46</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6061724">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061757">directoryEndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061782">=</span>&nbsp;<span class="num" id="6061784">22</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6061795">//&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061809">dataDescriptorLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061834">=</span>&nbsp;<span class="num" id="6061836">16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6061847">//&nbsp;four&nbsp;uint32:&nbsp;descriptor&nbsp;signature,&nbsp;crc32,&nbsp;compressed&nbsp;size,&nbsp;size</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061915">dataDescriptor64Len</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061940">=</span>&nbsp;<span class="num" id="6061942">24</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6061953">//&nbsp;descriptor&nbsp;with&nbsp;8&nbsp;byte&nbsp;sizes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061986">directory64LocLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6062011">=</span>&nbsp;<span class="num" id="6062013">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6062024">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062028">directory64EndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6062053">=</span>&nbsp;<span class="num" id="6062055">56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6062066">//&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062079">//&nbsp;Constants&nbsp;for&nbsp;the&nbsp;first&nbsp;byte&nbsp;in&nbsp;CreatorVersion</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062130">creatorFAT</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6062144">=</span>&nbsp;<span class="num" id="6062146">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062149">creatorUnix</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6062163">=</span>&nbsp;<span class="num" id="6062165">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062168">creatorNTFS</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6062182">=</span>&nbsp;<span class="num" id="6062184">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062188">creatorVFAT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6062202">=</span>&nbsp;<span class="num" id="6062204">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062208">creatorMacOSX</span>&nbsp;<span class="op" id="6062222">=</span>&nbsp;<span class="num" id="6062224">19</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062229">//&nbsp;version&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062249">zipVersion20</span>&nbsp;<span class="op" id="6062262">=</span>&nbsp;<span class="num" id="6062264">20</span>&nbsp;<span class="comment" id="6062267">//&nbsp;2.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062275">zipVersion45</span>&nbsp;<span class="op" id="6062288">=</span>&nbsp;<span class="num" id="6062290">45</span>&nbsp;<span class="comment" id="6062293">//&nbsp;4.5&nbsp;(reads&nbsp;and&nbsp;writes&nbsp;zip64&nbsp;archives)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062336">//&nbsp;limits&nbsp;for&nbsp;non&nbsp;zip64&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062367">uint16max</span>&nbsp;<span class="op" id="6062377">=</span>&nbsp;<span class="op" id="6062379">(</span><span class="num" id="6062380">1</span>&nbsp;<span class="op" id="6062382">&lt;&lt;</span>&nbsp;<span class="num" id="6062385">16</span><span class="op" id="6062387">)</span>&nbsp;<span class="op" id="6062389">-</span>&nbsp;<span class="num" id="6062391">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062394">uint32max</span>&nbsp;<span class="op" id="6062404">=</span>&nbsp;<span class="op" id="6062406">(</span><span class="num" id="6062407">1</span>&nbsp;<span class="op" id="6062409">&lt;&lt;</span>&nbsp;<span class="num" id="6062412">32</span><span class="op" id="6062414">)</span>&nbsp;<span class="op" id="6062416">-</span>&nbsp;<span class="num" id="6062418">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062422">//&nbsp;extra&nbsp;header&nbsp;id&#39;s</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062444">zip64ExtraId</span>&nbsp;<span class="op" id="6062457">=</span>&nbsp;<span class="num" id="6062459">0x0001</span>&nbsp;<span class="comment" id="6062466">//&nbsp;zip64&nbsp;Extended&nbsp;Information&nbsp;Extra&nbsp;Field</span><br>
<span class="lineno"></span><span class="op" id="6062508">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6062511">//&nbsp;FileHeader&nbsp;describes&nbsp;a&nbsp;file&nbsp;within&nbsp;a&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6062561">//&nbsp;See&nbsp;the&nbsp;zip&nbsp;spec&nbsp;for&nbsp;details.</span><br>
<span class="lineno">70</span><span class="keyword" id="6062594">type</span>&nbsp;<span class="ident" id="6062599">FileHeader</span>&nbsp;<span class="keyword" id="6062610">struct</span>&nbsp;<span class="op" id="6062617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062620">//&nbsp;Name&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062654">//&nbsp;It&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062717">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062781">//&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062798">Name</span>&nbsp;<span class="builtintype" id="6062803">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062812">CreatorVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6062831">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062839">ReaderVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6062858">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062866">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6062885">uint16</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062893">Method</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6062912">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062920">ModifiedTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6062939">uint16</span>&nbsp;<span class="comment" id="6062946">//&nbsp;MS-DOS&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062962">ModifiedDate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6062981">uint16</span>&nbsp;<span class="comment" id="6062988">//&nbsp;MS-DOS&nbsp;date</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063004">CRC32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6063023">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063031">CompressedSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6063050">uint32</span>&nbsp;<span class="comment" id="6063057">//&nbsp;deprecated;&nbsp;use&nbsp;CompressedSize64</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063094">UncompressedSize</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6063113">uint32</span>&nbsp;<span class="comment" id="6063120">//&nbsp;deprecated;&nbsp;use&nbsp;UncompressedSize64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063159">CompressedSize64</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6063178">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063186">UncompressedSize64</span>&nbsp;<span class="ident" id="6063205">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063213">Extra</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6063232">[</span><span class="op" id="6063233">]</span><span class="builtintype" id="6063234">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063240">ExternalAttrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6063259">uint32</span>&nbsp;<span class="comment" id="6063266">//&nbsp;Meaning&nbsp;depends&nbsp;on&nbsp;CreatorVersion</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063304">Comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6063323">string</span><br>
<span class="lineno"></span><span class="op" id="6063330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6063333">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="6063388">func</span>&nbsp;<span class="op" id="6063393">(</span><span class="ident" id="6063394">h</span>&nbsp;<span class="op" id="6063396">*</span><span class="ident" id="6063397">FileHeader</span><span class="op" id="6063407">)</span>&nbsp;<span class="ident" id="6063409">FileInfo</span><span class="op" id="6063417">(</span><span class="op" id="6063418">)</span>&nbsp;<span class="ident" id="6063420">os</span><span class="op" id="6063422">.</span><span class="ident" id="6063423">FileInfo</span>&nbsp;<span class="op" id="6063432">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063435">return</span>&nbsp;<span class="ident" id="6063442">headerFileInfo</span><span class="op" id="6063456">{</span><span class="ident" id="6063457">h</span><span class="op" id="6063458">}</span><br>
<span class="lineno"></span><span class="op" id="6063460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6063463">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="6063505">type</span>&nbsp;<span class="ident" id="6063510">headerFileInfo</span>&nbsp;<span class="keyword" id="6063525">struct</span>&nbsp;<span class="op" id="6063532">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063535">fh</span>&nbsp;<span class="op" id="6063538">*</span><span class="ident" id="6063539">FileHeader</span><br>
<span class="lineno"></span><span class="op" id="6063550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6063553">func</span>&nbsp;<span class="op" id="6063558">(</span><span class="ident" id="6063559">fi</span>&nbsp;<span class="ident" id="6063562">headerFileInfo</span><span class="op" id="6063576">)</span>&nbsp;<span class="ident" id="6063578">Name</span><span class="op" id="6063582">(</span><span class="op" id="6063583">)</span>&nbsp;<span class="builtintype" id="6063585">string</span>&nbsp;<span class="op" id="6063592">{</span>&nbsp;<span class="keyword" id="6063594">return</span>&nbsp;<span class="ident" id="6063601">path</span><span class="op" id="6063605">.</span><span class="ident" id="6063606">Base</span><span class="op" id="6063610">(</span><span class="ident" id="6063611">fi</span><span class="op" id="6063613">.</span><span class="ident" id="6063614">fh</span><span class="op" id="6063616">.</span><span class="ident" id="6063617">Name</span><span class="op" id="6063621">)</span>&nbsp;<span class="op" id="6063623">}</span><br>
<span class="lineno"></span><span class="keyword" id="6063625">func</span>&nbsp;<span class="op" id="6063630">(</span><span class="ident" id="6063631">fi</span>&nbsp;<span class="ident" id="6063634">headerFileInfo</span><span class="op" id="6063648">)</span>&nbsp;<span class="ident" id="6063650">Size</span><span class="op" id="6063654">(</span><span class="op" id="6063655">)</span>&nbsp;<span class="ident" id="6063657">int64</span>&nbsp;<span class="op" id="6063663">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063666">if</span>&nbsp;<span class="ident" id="6063669">fi</span><span class="op" id="6063671">.</span><span class="ident" id="6063672">fh</span><span class="op" id="6063674">.</span><span class="ident" id="6063675">UncompressedSize64</span>&nbsp;<span class="op" id="6063694">&gt;</span>&nbsp;<span class="num" id="6063696">0</span>&nbsp;<span class="op" id="6063698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063702">return</span>&nbsp;<span class="ident" id="6063709">int64</span><span class="op" id="6063714">(</span><span class="ident" id="6063715">fi</span><span class="op" id="6063717">.</span><span class="ident" id="6063718">fh</span><span class="op" id="6063720">.</span><span class="ident" id="6063721">UncompressedSize64</span><span class="op" id="6063739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063745">return</span>&nbsp;<span class="ident" id="6063752">int64</span><span class="op" id="6063757">(</span><span class="ident" id="6063758">fi</span><span class="op" id="6063760">.</span><span class="ident" id="6063761">fh</span><span class="op" id="6063763">.</span><span class="ident" id="6063764">UncompressedSize</span><span class="op" id="6063780">)</span><br>
<span class="lineno"></span><span class="op" id="6063782">}</span><br>
<span class="lineno">110</span><span class="keyword" id="6063784">func</span>&nbsp;<span class="op" id="6063789">(</span><span class="ident" id="6063790">fi</span>&nbsp;<span class="ident" id="6063793">headerFileInfo</span><span class="op" id="6063807">)</span>&nbsp;<span class="ident" id="6063809">IsDir</span><span class="op" id="6063814">(</span><span class="op" id="6063815">)</span>&nbsp;<span class="builtintype" id="6063817">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6063829">{</span>&nbsp;<span class="keyword" id="6063831">return</span>&nbsp;<span class="ident" id="6063838">fi</span><span class="op" id="6063840">.</span><span class="ident" id="6063841">Mode</span><span class="op" id="6063845">(</span><span class="op" id="6063846">)</span><span class="op" id="6063847">.</span><span class="ident" id="6063848">IsDir</span><span class="op" id="6063853">(</span><span class="op" id="6063854">)</span>&nbsp;<span class="op" id="6063856">}</span><br>
<span class="lineno"></span><span class="keyword" id="6063858">func</span>&nbsp;<span class="op" id="6063863">(</span><span class="ident" id="6063864">fi</span>&nbsp;<span class="ident" id="6063867">headerFileInfo</span><span class="op" id="6063881">)</span>&nbsp;<span class="ident" id="6063883">ModTime</span><span class="op" id="6063890">(</span><span class="op" id="6063891">)</span>&nbsp;<span class="ident" id="6063893">time</span><span class="op" id="6063897">.</span><span class="ident" id="6063898">Time</span>&nbsp;<span class="op" id="6063903">{</span>&nbsp;<span class="keyword" id="6063905">return</span>&nbsp;<span class="ident" id="6063912">fi</span><span class="op" id="6063914">.</span><span class="ident" id="6063915">fh</span><span class="op" id="6063917">.</span><span class="ident" id="6063918">ModTime</span><span class="op" id="6063925">(</span><span class="op" id="6063926">)</span>&nbsp;<span class="op" id="6063928">}</span><br>
<span class="lineno"></span><span class="keyword" id="6063930">func</span>&nbsp;<span class="op" id="6063935">(</span><span class="ident" id="6063936">fi</span>&nbsp;<span class="ident" id="6063939">headerFileInfo</span><span class="op" id="6063953">)</span>&nbsp;<span class="ident" id="6063955">Mode</span><span class="op" id="6063959">(</span><span class="op" id="6063960">)</span>&nbsp;<span class="ident" id="6063962">os</span><span class="op" id="6063964">.</span><span class="ident" id="6063965">FileMode</span>&nbsp;&nbsp;<span class="op" id="6063975">{</span>&nbsp;<span class="keyword" id="6063977">return</span>&nbsp;<span class="ident" id="6063984">fi</span><span class="op" id="6063986">.</span><span class="ident" id="6063987">fh</span><span class="op" id="6063989">.</span><span class="ident" id="6063990">Mode</span><span class="op" id="6063994">(</span><span class="op" id="6063995">)</span>&nbsp;<span class="op" id="6063997">}</span><br>
<span class="lineno"></span><span class="keyword" id="6063999">func</span>&nbsp;<span class="op" id="6064004">(</span><span class="ident" id="6064005">fi</span>&nbsp;<span class="ident" id="6064008">headerFileInfo</span><span class="op" id="6064022">)</span>&nbsp;<span class="ident" id="6064024">Sys</span><span class="op" id="6064027">(</span><span class="op" id="6064028">)</span>&nbsp;<span class="keyword" id="6064030">interface</span><span class="op" id="6064039">{</span><span class="op" id="6064040">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6064044">{</span>&nbsp;<span class="keyword" id="6064046">return</span>&nbsp;<span class="ident" id="6064053">fi</span><span class="op" id="6064055">.</span><span class="ident" id="6064056">fh</span>&nbsp;<span class="op" id="6064059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="6064062">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;FileHeader&nbsp;from&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6064129">//&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="comment" id="6064145">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6064212">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="6064283">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">120</span><span class="keyword" id="6064352">func</span>&nbsp;<span class="ident" id="6064357">FileInfoHeader</span><span class="op" id="6064371">(</span><span class="ident" id="6064372">fi</span>&nbsp;<span class="ident" id="6064375">os</span><span class="op" id="6064377">.</span><span class="ident" id="6064378">FileInfo</span><span class="op" id="6064386">)</span>&nbsp;<span class="op" id="6064388">(</span><span class="op" id="6064389">*</span><span class="ident" id="6064390">FileHeader</span><span class="op" id="6064400">,</span>&nbsp;<span class="builtintype" id="6064402">error</span><span class="op" id="6064407">)</span>&nbsp;<span class="op" id="6064409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064412">size</span>&nbsp;<span class="op" id="6064417">:=</span>&nbsp;<span class="ident" id="6064420">fi</span><span class="op" id="6064422">.</span><span class="ident" id="6064423">Size</span><span class="op" id="6064427">(</span><span class="op" id="6064428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064431">fh</span>&nbsp;<span class="op" id="6064434">:=</span>&nbsp;<span class="op" id="6064437">&amp;</span><span class="ident" id="6064438">FileHeader</span><span class="op" id="6064448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064452">Name</span><span class="op" id="6064456">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6064472">fi</span><span class="op" id="6064474">.</span><span class="ident" id="6064475">Name</span><span class="op" id="6064479">(</span><span class="op" id="6064480">)</span><span class="op" id="6064481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064485">UncompressedSize64</span><span class="op" id="6064503">:</span>&nbsp;<span class="ident" id="6064505">uint64</span><span class="op" id="6064511">(</span><span class="ident" id="6064512">size</span><span class="op" id="6064516">)</span><span class="op" id="6064517">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064523">fh</span><span class="op" id="6064525">.</span><span class="ident" id="6064526">SetModTime</span><span class="op" id="6064536">(</span><span class="ident" id="6064537">fi</span><span class="op" id="6064539">.</span><span class="ident" id="6064540">ModTime</span><span class="op" id="6064547">(</span><span class="op" id="6064548">)</span><span class="op" id="6064549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064552">fh</span><span class="op" id="6064554">.</span><span class="ident" id="6064555">SetMode</span><span class="op" id="6064562">(</span><span class="ident" id="6064563">fi</span><span class="op" id="6064565">.</span><span class="ident" id="6064566">Mode</span><span class="op" id="6064570">(</span><span class="op" id="6064571">)</span><span class="op" id="6064572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064575">if</span>&nbsp;<span class="ident" id="6064578">fh</span><span class="op" id="6064580">.</span><span class="ident" id="6064581">UncompressedSize64</span>&nbsp;<span class="op" id="6064600">&gt;</span>&nbsp;<span class="ident" id="6064602">uint32max</span>&nbsp;<span class="op" id="6064612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064616">fh</span><span class="op" id="6064618">.</span><span class="ident" id="6064619">UncompressedSize</span>&nbsp;<span class="op" id="6064636">=</span>&nbsp;<span class="ident" id="6064638">uint32max</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064649">}</span>&nbsp;<span class="keyword" id="6064651">else</span>&nbsp;<span class="op" id="6064656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064660">fh</span><span class="op" id="6064662">.</span><span class="ident" id="6064663">UncompressedSize</span>&nbsp;<span class="op" id="6064680">=</span>&nbsp;<span class="builtintype" id="6064682">uint32</span><span class="op" id="6064688">(</span><span class="ident" id="6064689">fh</span><span class="op" id="6064691">.</span><span class="ident" id="6064692">UncompressedSize64</span><span class="op" id="6064710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064716">return</span>&nbsp;<span class="ident" id="6064723">fh</span><span class="op" id="6064725">,</span>&nbsp;<span class="ident" id="6064727">nil</span><br>
<span class="lineno"></span><span class="op" id="6064731">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="6064734">type</span>&nbsp;<span class="ident" id="6064739">directoryEnd</span>&nbsp;<span class="keyword" id="6064752">struct</span>&nbsp;<span class="op" id="6064759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064762">diskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6064781">uint32</span>&nbsp;<span class="comment" id="6064788">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064799">dirDiskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6064818">uint32</span>&nbsp;<span class="comment" id="6064825">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064836">dirRecordsThisDisk</span>&nbsp;<span class="ident" id="6064855">uint64</span>&nbsp;<span class="comment" id="6064862">//&nbsp;unused</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064873">directoryRecords</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6064892">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064900">directorySize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6064919">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064927">directoryOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6064946">uint64</span>&nbsp;<span class="comment" id="6064953">//&nbsp;relative&nbsp;to&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064974">commentLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6064993">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065001">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6065020">string</span><br>
<span class="lineno">145</span><span class="op" id="6065027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6065030">//&nbsp;msDosTimeToTime&nbsp;converts&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time&nbsp;into&nbsp;a&nbsp;time.Time.</span><br>
<span class="lineno"></span><span class="comment" id="6065100">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="6065125">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724247(v=VS.85).aspx</span><br>
<span class="lineno">150</span><span class="keyword" id="6065196">func</span>&nbsp;<span class="ident" id="6065201">msDosTimeToTime</span><span class="op" id="6065216">(</span><span class="ident" id="6065217">dosDate</span><span class="op" id="6065224">,</span>&nbsp;<span class="ident" id="6065226">dosTime</span>&nbsp;<span class="builtintype" id="6065234">uint16</span><span class="op" id="6065240">)</span>&nbsp;<span class="ident" id="6065242">time</span><span class="op" id="6065246">.</span><span class="ident" id="6065247">Time</span>&nbsp;<span class="op" id="6065252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065255">return</span>&nbsp;<span class="ident" id="6065262">time</span><span class="op" id="6065266">.</span><span class="ident" id="6065267">Date</span><span class="op" id="6065271">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065275">//&nbsp;date&nbsp;bits&nbsp;0-4:&nbsp;day&nbsp;of&nbsp;month;&nbsp;5-8:&nbsp;month;&nbsp;9-15:&nbsp;years&nbsp;since&nbsp;1980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6065344">int</span><span class="op" id="6065347">(</span><span class="ident" id="6065348">dosDate</span><span class="op" id="6065355">&gt;&gt;</span><span class="num" id="6065357">9</span><span class="op" id="6065358">+</span><span class="num" id="6065359">1980</span><span class="op" id="6065363">)</span><span class="op" id="6065364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065368">time</span><span class="op" id="6065372">.</span><span class="ident" id="6065373">Month</span><span class="op" id="6065378">(</span><span class="ident" id="6065379">dosDate</span><span class="op" id="6065386">&gt;&gt;</span><span class="num" id="6065388">5</span><span class="op" id="6065389">&amp;</span><span class="num" id="6065390">0xf</span><span class="op" id="6065393">)</span><span class="op" id="6065394">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6065398">int</span><span class="op" id="6065401">(</span><span class="ident" id="6065402">dosDate</span><span class="op" id="6065409">&amp;</span><span class="num" id="6065410">0x1f</span><span class="op" id="6065414">)</span><span class="op" id="6065415">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065420">//&nbsp;time&nbsp;bits&nbsp;0-4:&nbsp;second/2;&nbsp;5-10:&nbsp;minute;&nbsp;11-15:&nbsp;hour</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6065476">int</span><span class="op" id="6065479">(</span><span class="ident" id="6065480">dosTime</span><span class="op" id="6065487">&gt;&gt;</span><span class="num" id="6065489">11</span><span class="op" id="6065491">)</span><span class="op" id="6065492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6065496">int</span><span class="op" id="6065499">(</span><span class="ident" id="6065500">dosTime</span><span class="op" id="6065507">&gt;&gt;</span><span class="num" id="6065509">5</span><span class="op" id="6065510">&amp;</span><span class="num" id="6065511">0x3f</span><span class="op" id="6065515">)</span><span class="op" id="6065516">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6065520">int</span><span class="op" id="6065523">(</span><span class="ident" id="6065524">dosTime</span><span class="op" id="6065531">&amp;</span><span class="num" id="6065532">0x1f</span><span class="op" id="6065536">*</span><span class="num" id="6065537">2</span><span class="op" id="6065538">)</span><span class="op" id="6065539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6065543">0</span><span class="op" id="6065544">,</span>&nbsp;<span class="comment" id="6065546">//&nbsp;nanoseconds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065564">time</span><span class="op" id="6065568">.</span><span class="ident" id="6065569">UTC</span><span class="op" id="6065572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6065575">)</span><br>
<span class="lineno">165</span><span class="op" id="6065577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6065580">//&nbsp;timeToMsDosTime&nbsp;converts&nbsp;a&nbsp;time.Time&nbsp;to&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="6065648">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="6065673">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724274(v=VS.85).aspx</span><br>
<span class="lineno">170</span><span class="keyword" id="6065744">func</span>&nbsp;<span class="ident" id="6065749">timeToMsDosTime</span><span class="op" id="6065764">(</span><span class="ident" id="6065765">t</span>&nbsp;<span class="ident" id="6065767">time</span><span class="op" id="6065771">.</span><span class="ident" id="6065772">Time</span><span class="op" id="6065776">)</span>&nbsp;<span class="op" id="6065778">(</span><span class="ident" id="6065779">fDate</span>&nbsp;<span class="builtintype" id="6065785">uint16</span><span class="op" id="6065791">,</span>&nbsp;<span class="ident" id="6065793">fTime</span>&nbsp;<span class="builtintype" id="6065799">uint16</span><span class="op" id="6065805">)</span>&nbsp;<span class="op" id="6065807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065810">t</span>&nbsp;<span class="op" id="6065812">=</span>&nbsp;<span class="ident" id="6065814">t</span><span class="op" id="6065815">.</span><span class="ident" id="6065816">In</span><span class="op" id="6065818">(</span><span class="ident" id="6065819">time</span><span class="op" id="6065823">.</span><span class="ident" id="6065824">UTC</span><span class="op" id="6065827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065830">fDate</span>&nbsp;<span class="op" id="6065836">=</span>&nbsp;<span class="builtintype" id="6065838">uint16</span><span class="op" id="6065844">(</span><span class="ident" id="6065845">t</span><span class="op" id="6065846">.</span><span class="ident" id="6065847">Day</span><span class="op" id="6065850">(</span><span class="op" id="6065851">)</span>&nbsp;<span class="op" id="6065853">+</span>&nbsp;<span class="builtintype" id="6065855">int</span><span class="op" id="6065858">(</span><span class="ident" id="6065859">t</span><span class="op" id="6065860">.</span><span class="ident" id="6065861">Month</span><span class="op" id="6065866">(</span><span class="op" id="6065867">)</span><span class="op" id="6065868">)</span><span class="op" id="6065869">&lt;&lt;</span><span class="num" id="6065871">5</span>&nbsp;<span class="op" id="6065873">+</span>&nbsp;<span class="op" id="6065875">(</span><span class="ident" id="6065876">t</span><span class="op" id="6065877">.</span><span class="ident" id="6065878">Year</span><span class="op" id="6065882">(</span><span class="op" id="6065883">)</span><span class="op" id="6065884">-</span><span class="num" id="6065885">1980</span><span class="op" id="6065889">)</span><span class="op" id="6065890">&lt;&lt;</span><span class="num" id="6065892">9</span><span class="op" id="6065893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065896">fTime</span>&nbsp;<span class="op" id="6065902">=</span>&nbsp;<span class="builtintype" id="6065904">uint16</span><span class="op" id="6065910">(</span><span class="ident" id="6065911">t</span><span class="op" id="6065912">.</span><span class="ident" id="6065913">Second</span><span class="op" id="6065919">(</span><span class="op" id="6065920">)</span><span class="op" id="6065921">/</span><span class="num" id="6065922">2</span>&nbsp;<span class="op" id="6065924">+</span>&nbsp;<span class="ident" id="6065926">t</span><span class="op" id="6065927">.</span><span class="ident" id="6065928">Minute</span><span class="op" id="6065934">(</span><span class="op" id="6065935">)</span><span class="op" id="6065936">&lt;&lt;</span><span class="num" id="6065938">5</span>&nbsp;<span class="op" id="6065940">+</span>&nbsp;<span class="ident" id="6065942">t</span><span class="op" id="6065943">.</span><span class="ident" id="6065944">Hour</span><span class="op" id="6065948">(</span><span class="op" id="6065949">)</span><span class="op" id="6065950">&lt;&lt;</span><span class="num" id="6065952">11</span><span class="op" id="6065954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065957">return</span><br>
<span class="lineno">175</span><span class="op" id="6065964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6065967">//&nbsp;ModTime&nbsp;returns&nbsp;the&nbsp;modification&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="6066016">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="keyword" id="6066041">func</span>&nbsp;<span class="op" id="6066046">(</span><span class="ident" id="6066047">h</span>&nbsp;<span class="op" id="6066049">*</span><span class="ident" id="6066050">FileHeader</span><span class="op" id="6066060">)</span>&nbsp;<span class="ident" id="6066062">ModTime</span><span class="op" id="6066069">(</span><span class="op" id="6066070">)</span>&nbsp;<span class="ident" id="6066072">time</span><span class="op" id="6066076">.</span><span class="ident" id="6066077">Time</span>&nbsp;<span class="op" id="6066082">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066085">return</span>&nbsp;<span class="ident" id="6066092">msDosTimeToTime</span><span class="op" id="6066107">(</span><span class="ident" id="6066108">h</span><span class="op" id="6066109">.</span><span class="ident" id="6066110">ModifiedDate</span><span class="op" id="6066122">,</span>&nbsp;<span class="ident" id="6066124">h</span><span class="op" id="6066125">.</span><span class="ident" id="6066126">ModifiedTime</span><span class="op" id="6066138">)</span><br>
<span class="lineno"></span><span class="op" id="6066140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6066143">//&nbsp;SetModTime&nbsp;sets&nbsp;the&nbsp;ModifiedTime&nbsp;and&nbsp;ModifiedDate&nbsp;fields&nbsp;to&nbsp;the&nbsp;given&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="6066229">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno">185</span><span class="keyword" id="6066254">func</span>&nbsp;<span class="op" id="6066259">(</span><span class="ident" id="6066260">h</span>&nbsp;<span class="op" id="6066262">*</span><span class="ident" id="6066263">FileHeader</span><span class="op" id="6066273">)</span>&nbsp;<span class="ident" id="6066275">SetModTime</span><span class="op" id="6066285">(</span><span class="ident" id="6066286">t</span>&nbsp;<span class="ident" id="6066288">time</span><span class="op" id="6066292">.</span><span class="ident" id="6066293">Time</span><span class="op" id="6066297">)</span>&nbsp;<span class="op" id="6066299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066302">h</span><span class="op" id="6066303">.</span><span class="ident" id="6066304">ModifiedDate</span><span class="op" id="6066316">,</span>&nbsp;<span class="ident" id="6066318">h</span><span class="op" id="6066319">.</span><span class="ident" id="6066320">ModifiedTime</span>&nbsp;<span class="op" id="6066333">=</span>&nbsp;<span class="ident" id="6066335">timeToMsDosTime</span><span class="op" id="6066350">(</span><span class="ident" id="6066351">t</span><span class="op" id="6066352">)</span><br>
<span class="lineno"></span><span class="op" id="6066354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6066357">const</span>&nbsp;<span class="op" id="6066363">(</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066366">//&nbsp;Unix&nbsp;constants.&nbsp;The&nbsp;specification&nbsp;doesn&#39;t&nbsp;mention&nbsp;them,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066426">//&nbsp;but&nbsp;these&nbsp;seem&nbsp;to&nbsp;be&nbsp;the&nbsp;values&nbsp;agreed&nbsp;on&nbsp;by&nbsp;tools.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066482">s_IFMT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6066491">=</span>&nbsp;<span class="num" id="6066493">0xf000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066501">s_IFSOCK</span>&nbsp;<span class="op" id="6066510">=</span>&nbsp;<span class="num" id="6066512">0xc000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066520">s_IFLNK</span>&nbsp;&nbsp;<span class="op" id="6066529">=</span>&nbsp;<span class="num" id="6066531">0xa000</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066539">s_IFREG</span>&nbsp;&nbsp;<span class="op" id="6066548">=</span>&nbsp;<span class="num" id="6066550">0x8000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066558">s_IFBLK</span>&nbsp;&nbsp;<span class="op" id="6066567">=</span>&nbsp;<span class="num" id="6066569">0x6000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066577">s_IFDIR</span>&nbsp;&nbsp;<span class="op" id="6066586">=</span>&nbsp;<span class="num" id="6066588">0x4000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066596">s_IFCHR</span>&nbsp;&nbsp;<span class="op" id="6066605">=</span>&nbsp;<span class="num" id="6066607">0x2000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066615">s_IFIFO</span>&nbsp;&nbsp;<span class="op" id="6066624">=</span>&nbsp;<span class="num" id="6066626">0x1000</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066634">s_ISUID</span>&nbsp;&nbsp;<span class="op" id="6066643">=</span>&nbsp;<span class="num" id="6066645">0x800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066652">s_ISGID</span>&nbsp;&nbsp;<span class="op" id="6066661">=</span>&nbsp;<span class="num" id="6066663">0x400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066670">s_ISVTX</span>&nbsp;&nbsp;<span class="op" id="6066679">=</span>&nbsp;<span class="num" id="6066681">0x200</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066689">msdosDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6066703">=</span>&nbsp;<span class="num" id="6066705">0x10</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066711">msdosReadOnly</span>&nbsp;<span class="op" id="6066725">=</span>&nbsp;<span class="num" id="6066727">0x01</span><br>
<span class="lineno"></span><span class="op" id="6066732">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6066735">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="6066800">func</span>&nbsp;<span class="op" id="6066805">(</span><span class="ident" id="6066806">h</span>&nbsp;<span class="op" id="6066808">*</span><span class="ident" id="6066809">FileHeader</span><span class="op" id="6066819">)</span>&nbsp;<span class="ident" id="6066821">Mode</span><span class="op" id="6066825">(</span><span class="op" id="6066826">)</span>&nbsp;<span class="op" id="6066828">(</span><span class="ident" id="6066829">mode</span>&nbsp;<span class="ident" id="6066834">os</span><span class="op" id="6066836">.</span><span class="ident" id="6066837">FileMode</span><span class="op" id="6066845">)</span>&nbsp;<span class="op" id="6066847">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066850">switch</span>&nbsp;<span class="ident" id="6066857">h</span><span class="op" id="6066858">.</span><span class="ident" id="6066859">CreatorVersion</span>&nbsp;<span class="op" id="6066874">&gt;&gt;</span>&nbsp;<span class="num" id="6066877">8</span>&nbsp;<span class="op" id="6066879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066882">case</span>&nbsp;<span class="ident" id="6066887">creatorUnix</span><span class="op" id="6066898">,</span>&nbsp;<span class="ident" id="6066900">creatorMacOSX</span><span class="op" id="6066913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066917">mode</span>&nbsp;<span class="op" id="6066922">=</span>&nbsp;<span class="ident" id="6066924">unixModeToFileMode</span><span class="op" id="6066942">(</span><span class="ident" id="6066943">h</span><span class="op" id="6066944">.</span><span class="ident" id="6066945">ExternalAttrs</span>&nbsp;<span class="op" id="6066959">&gt;&gt;</span>&nbsp;<span class="num" id="6066962">16</span><span class="op" id="6066964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066967">case</span>&nbsp;<span class="ident" id="6066972">creatorNTFS</span><span class="op" id="6066983">,</span>&nbsp;<span class="ident" id="6066985">creatorVFAT</span><span class="op" id="6066996">,</span>&nbsp;<span class="ident" id="6066998">creatorFAT</span><span class="op" id="6067008">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067012">mode</span>&nbsp;<span class="op" id="6067017">=</span>&nbsp;<span class="ident" id="6067019">msdosModeToFileMode</span><span class="op" id="6067038">(</span><span class="ident" id="6067039">h</span><span class="op" id="6067040">.</span><span class="ident" id="6067041">ExternalAttrs</span><span class="op" id="6067054">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6067057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067060">if</span>&nbsp;<span class="builtinfunc" id="6067063">len</span><span class="op" id="6067066">(</span><span class="ident" id="6067067">h</span><span class="op" id="6067068">.</span><span class="ident" id="6067069">Name</span><span class="op" id="6067073">)</span>&nbsp;<span class="op" id="6067075">&gt;</span>&nbsp;<span class="num" id="6067077">0</span>&nbsp;<span class="op" id="6067079">&amp;&amp;</span>&nbsp;<span class="ident" id="6067082">h</span><span class="op" id="6067083">.</span><span class="ident" id="6067084">Name</span><span class="op" id="6067088">[</span><span class="builtinfunc" id="6067089">len</span><span class="op" id="6067092">(</span><span class="ident" id="6067093">h</span><span class="op" id="6067094">.</span><span class="ident" id="6067095">Name</span><span class="op" id="6067099">)</span><span class="op" id="6067100">-</span><span class="num" id="6067101">1</span><span class="op" id="6067102">]</span>&nbsp;<span class="op" id="6067104">==</span>&nbsp;<span class="string" id="6067107">&#39;/&#39;</span>&nbsp;<span class="op" id="6067111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067115">mode</span>&nbsp;<span class="op" id="6067120">|=</span>&nbsp;<span class="ident" id="6067123">os</span><span class="op" id="6067125">.</span><span class="ident" id="6067126">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6067135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067138">return</span>&nbsp;<span class="ident" id="6067145">mode</span><br>
<span class="lineno">220</span><span class="op" id="6067150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6067153">//&nbsp;SetMode&nbsp;changes&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="6067221">func</span>&nbsp;<span class="op" id="6067226">(</span><span class="ident" id="6067227">h</span>&nbsp;<span class="op" id="6067229">*</span><span class="ident" id="6067230">FileHeader</span><span class="op" id="6067240">)</span>&nbsp;<span class="ident" id="6067242">SetMode</span><span class="op" id="6067249">(</span><span class="ident" id="6067250">mode</span>&nbsp;<span class="ident" id="6067255">os</span><span class="op" id="6067257">.</span><span class="ident" id="6067258">FileMode</span><span class="op" id="6067266">)</span>&nbsp;<span class="op" id="6067268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067271">h</span><span class="op" id="6067272">.</span><span class="ident" id="6067273">CreatorVersion</span>&nbsp;<span class="op" id="6067288">=</span>&nbsp;<span class="ident" id="6067290">h</span><span class="op" id="6067291">.</span><span class="ident" id="6067292">CreatorVersion</span><span class="op" id="6067306">&amp;</span><span class="num" id="6067307">0xff</span>&nbsp;<span class="op" id="6067312">|</span>&nbsp;<span class="ident" id="6067314">creatorUnix</span><span class="op" id="6067325">&lt;&lt;</span><span class="num" id="6067327">8</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067330">h</span><span class="op" id="6067331">.</span><span class="ident" id="6067332">ExternalAttrs</span>&nbsp;<span class="op" id="6067346">=</span>&nbsp;<span class="ident" id="6067348">fileModeToUnixMode</span><span class="op" id="6067366">(</span><span class="ident" id="6067367">mode</span><span class="op" id="6067371">)</span>&nbsp;<span class="op" id="6067373">&lt;&lt;</span>&nbsp;<span class="num" id="6067376">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067381">//&nbsp;set&nbsp;MSDOS&nbsp;attributes&nbsp;too,&nbsp;as&nbsp;the&nbsp;original&nbsp;zip&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067437">if</span>&nbsp;<span class="ident" id="6067440">mode</span><span class="op" id="6067444">&amp;</span><span class="ident" id="6067445">os</span><span class="op" id="6067447">.</span><span class="ident" id="6067448">ModeDir</span>&nbsp;<span class="op" id="6067456">!=</span>&nbsp;<span class="num" id="6067459">0</span>&nbsp;<span class="op" id="6067461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067465">h</span><span class="op" id="6067466">.</span><span class="ident" id="6067467">ExternalAttrs</span>&nbsp;<span class="op" id="6067481">|=</span>&nbsp;<span class="ident" id="6067484">msdosDir</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6067494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067497">if</span>&nbsp;<span class="ident" id="6067500">mode</span><span class="op" id="6067504">&amp;</span><span class="num" id="6067505">0200</span>&nbsp;<span class="op" id="6067510">==</span>&nbsp;<span class="num" id="6067513">0</span>&nbsp;<span class="op" id="6067515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067519">h</span><span class="op" id="6067520">.</span><span class="ident" id="6067521">ExternalAttrs</span>&nbsp;<span class="op" id="6067535">|=</span>&nbsp;<span class="ident" id="6067538">msdosReadOnly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6067553">}</span><br>
<span class="lineno"></span><span class="op" id="6067555">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="6067558">//&nbsp;isZip64&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;size&nbsp;exceeds&nbsp;the&nbsp;32&nbsp;bit&nbsp;limit</span><br>
<span class="lineno"></span><span class="keyword" id="6067624">func</span>&nbsp;<span class="op" id="6067629">(</span><span class="ident" id="6067630">fh</span>&nbsp;<span class="op" id="6067633">*</span><span class="ident" id="6067634">FileHeader</span><span class="op" id="6067644">)</span>&nbsp;<span class="ident" id="6067646">isZip64</span><span class="op" id="6067653">(</span><span class="op" id="6067654">)</span>&nbsp;<span class="builtintype" id="6067656">bool</span>&nbsp;<span class="op" id="6067661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067664">return</span>&nbsp;<span class="ident" id="6067671">fh</span><span class="op" id="6067673">.</span><span class="ident" id="6067674">CompressedSize64</span>&nbsp;<span class="op" id="6067691">&gt;</span>&nbsp;<span class="ident" id="6067693">uint32max</span>&nbsp;<span class="op" id="6067703">||</span>&nbsp;<span class="ident" id="6067706">fh</span><span class="op" id="6067708">.</span><span class="ident" id="6067709">UncompressedSize64</span>&nbsp;<span class="op" id="6067728">&gt;</span>&nbsp;<span class="ident" id="6067730">uint32max</span><br>
<span class="lineno"></span><span class="op" id="6067740">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="6067743">func</span>&nbsp;<span class="ident" id="6067748">msdosModeToFileMode</span><span class="op" id="6067767">(</span><span class="ident" id="6067768">m</span>&nbsp;<span class="builtintype" id="6067770">uint32</span><span class="op" id="6067776">)</span>&nbsp;<span class="op" id="6067778">(</span><span class="ident" id="6067779">mode</span>&nbsp;<span class="ident" id="6067784">os</span><span class="op" id="6067786">.</span><span class="ident" id="6067787">FileMode</span><span class="op" id="6067795">)</span>&nbsp;<span class="op" id="6067797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067800">if</span>&nbsp;<span class="ident" id="6067803">m</span><span class="op" id="6067804">&amp;</span><span class="ident" id="6067805">msdosDir</span>&nbsp;<span class="op" id="6067814">!=</span>&nbsp;<span class="num" id="6067817">0</span>&nbsp;<span class="op" id="6067819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067823">mode</span>&nbsp;<span class="op" id="6067828">=</span>&nbsp;<span class="ident" id="6067830">os</span><span class="op" id="6067832">.</span><span class="ident" id="6067833">ModeDir</span>&nbsp;<span class="op" id="6067841">|</span>&nbsp;<span class="num" id="6067843">0777</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6067849">}</span>&nbsp;<span class="keyword" id="6067851">else</span>&nbsp;<span class="op" id="6067856">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067860">mode</span>&nbsp;<span class="op" id="6067865">=</span>&nbsp;<span class="num" id="6067867">0666</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6067873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067876">if</span>&nbsp;<span class="ident" id="6067879">m</span><span class="op" id="6067880">&amp;</span><span class="ident" id="6067881">msdosReadOnly</span>&nbsp;<span class="op" id="6067895">!=</span>&nbsp;<span class="num" id="6067898">0</span>&nbsp;<span class="op" id="6067900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067904">mode</span>&nbsp;<span class="op" id="6067909">&amp;^=</span>&nbsp;<span class="num" id="6067913">0222</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6067919">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067922">return</span>&nbsp;<span class="ident" id="6067929">mode</span><br>
<span class="lineno"></span><span class="op" id="6067934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6067937">func</span>&nbsp;<span class="ident" id="6067942">fileModeToUnixMode</span><span class="op" id="6067960">(</span><span class="ident" id="6067961">mode</span>&nbsp;<span class="ident" id="6067966">os</span><span class="op" id="6067968">.</span><span class="ident" id="6067969">FileMode</span><span class="op" id="6067977">)</span>&nbsp;<span class="builtintype" id="6067979">uint32</span>&nbsp;<span class="op" id="6067986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067989">var</span>&nbsp;<span class="ident" id="6067993">m</span>&nbsp;<span class="builtintype" id="6067995">uint32</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068003">switch</span>&nbsp;<span class="ident" id="6068010">mode</span>&nbsp;<span class="op" id="6068015">&amp;</span>&nbsp;<span class="ident" id="6068017">os</span><span class="op" id="6068019">.</span><span class="ident" id="6068020">ModeType</span>&nbsp;<span class="op" id="6068029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068032">default</span><span class="op" id="6068039">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068043">m</span>&nbsp;<span class="op" id="6068045">=</span>&nbsp;<span class="ident" id="6068047">s_IFREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068056">case</span>&nbsp;<span class="ident" id="6068061">os</span><span class="op" id="6068063">.</span><span class="ident" id="6068064">ModeDir</span><span class="op" id="6068071">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068075">m</span>&nbsp;<span class="op" id="6068077">=</span>&nbsp;<span class="ident" id="6068079">s_IFDIR</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068088">case</span>&nbsp;<span class="ident" id="6068093">os</span><span class="op" id="6068095">.</span><span class="ident" id="6068096">ModeSymlink</span><span class="op" id="6068107">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068111">m</span>&nbsp;<span class="op" id="6068113">=</span>&nbsp;<span class="ident" id="6068115">s_IFLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068124">case</span>&nbsp;<span class="ident" id="6068129">os</span><span class="op" id="6068131">.</span><span class="ident" id="6068132">ModeNamedPipe</span><span class="op" id="6068145">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068149">m</span>&nbsp;<span class="op" id="6068151">=</span>&nbsp;<span class="ident" id="6068153">s_IFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068162">case</span>&nbsp;<span class="ident" id="6068167">os</span><span class="op" id="6068169">.</span><span class="ident" id="6068170">ModeSocket</span><span class="op" id="6068180">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068184">m</span>&nbsp;<span class="op" id="6068186">=</span>&nbsp;<span class="ident" id="6068188">s_IFSOCK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068198">case</span>&nbsp;<span class="ident" id="6068203">os</span><span class="op" id="6068205">.</span><span class="ident" id="6068206">ModeDevice</span><span class="op" id="6068216">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068220">if</span>&nbsp;<span class="ident" id="6068223">mode</span><span class="op" id="6068227">&amp;</span><span class="ident" id="6068228">os</span><span class="op" id="6068230">.</span><span class="ident" id="6068231">ModeCharDevice</span>&nbsp;<span class="op" id="6068246">!=</span>&nbsp;<span class="num" id="6068249">0</span>&nbsp;<span class="op" id="6068251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068256">m</span>&nbsp;<span class="op" id="6068258">=</span>&nbsp;<span class="ident" id="6068260">s_IFCHR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068270">}</span>&nbsp;<span class="keyword" id="6068272">else</span>&nbsp;<span class="op" id="6068277">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068282">m</span>&nbsp;<span class="op" id="6068284">=</span>&nbsp;<span class="ident" id="6068286">s_IFBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068302">if</span>&nbsp;<span class="ident" id="6068305">mode</span><span class="op" id="6068309">&amp;</span><span class="ident" id="6068310">os</span><span class="op" id="6068312">.</span><span class="ident" id="6068313">ModeSetuid</span>&nbsp;<span class="op" id="6068324">!=</span>&nbsp;<span class="num" id="6068327">0</span>&nbsp;<span class="op" id="6068329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068333">m</span>&nbsp;<span class="op" id="6068335">|=</span>&nbsp;<span class="ident" id="6068338">s_ISUID</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068350">if</span>&nbsp;<span class="ident" id="6068353">mode</span><span class="op" id="6068357">&amp;</span><span class="ident" id="6068358">os</span><span class="op" id="6068360">.</span><span class="ident" id="6068361">ModeSetgid</span>&nbsp;<span class="op" id="6068372">!=</span>&nbsp;<span class="num" id="6068375">0</span>&nbsp;<span class="op" id="6068377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068381">m</span>&nbsp;<span class="op" id="6068383">|=</span>&nbsp;<span class="ident" id="6068386">s_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068398">if</span>&nbsp;<span class="ident" id="6068401">mode</span><span class="op" id="6068405">&amp;</span><span class="ident" id="6068406">os</span><span class="op" id="6068408">.</span><span class="ident" id="6068409">ModeSticky</span>&nbsp;<span class="op" id="6068420">!=</span>&nbsp;<span class="num" id="6068423">0</span>&nbsp;<span class="op" id="6068425">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068429">m</span>&nbsp;<span class="op" id="6068431">|=</span>&nbsp;<span class="ident" id="6068434">s_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068446">return</span>&nbsp;<span class="ident" id="6068453">m</span>&nbsp;<span class="op" id="6068455">|</span>&nbsp;<span class="builtintype" id="6068457">uint32</span><span class="op" id="6068463">(</span><span class="ident" id="6068464">mode</span><span class="op" id="6068468">&amp;</span><span class="num" id="6068469">0777</span><span class="op" id="6068473">)</span><br>
<span class="lineno"></span><span class="op" id="6068475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="6068478">func</span>&nbsp;<span class="ident" id="6068483">unixModeToFileMode</span><span class="op" id="6068501">(</span><span class="ident" id="6068502">m</span>&nbsp;<span class="builtintype" id="6068504">uint32</span><span class="op" id="6068510">)</span>&nbsp;<span class="ident" id="6068512">os</span><span class="op" id="6068514">.</span><span class="ident" id="6068515">FileMode</span>&nbsp;<span class="op" id="6068524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068527">mode</span>&nbsp;<span class="op" id="6068532">:=</span>&nbsp;<span class="ident" id="6068535">os</span><span class="op" id="6068537">.</span><span class="ident" id="6068538">FileMode</span><span class="op" id="6068546">(</span><span class="ident" id="6068547">m</span>&nbsp;<span class="op" id="6068549">&amp;</span>&nbsp;<span class="num" id="6068551">0777</span><span class="op" id="6068555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068558">switch</span>&nbsp;<span class="ident" id="6068565">m</span>&nbsp;<span class="op" id="6068567">&amp;</span>&nbsp;<span class="ident" id="6068569">s_IFMT</span>&nbsp;<span class="op" id="6068576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068579">case</span>&nbsp;<span class="ident" id="6068584">s_IFBLK</span><span class="op" id="6068591">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068595">mode</span>&nbsp;<span class="op" id="6068600">|=</span>&nbsp;<span class="ident" id="6068603">os</span><span class="op" id="6068605">.</span><span class="ident" id="6068606">ModeDevice</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068618">case</span>&nbsp;<span class="ident" id="6068623">s_IFCHR</span><span class="op" id="6068630">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068634">mode</span>&nbsp;<span class="op" id="6068639">|=</span>&nbsp;<span class="ident" id="6068642">os</span><span class="op" id="6068644">.</span><span class="ident" id="6068645">ModeDevice</span>&nbsp;<span class="op" id="6068656">|</span>&nbsp;<span class="ident" id="6068658">os</span><span class="op" id="6068660">.</span><span class="ident" id="6068661">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068677">case</span>&nbsp;<span class="ident" id="6068682">s_IFDIR</span><span class="op" id="6068689">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068693">mode</span>&nbsp;<span class="op" id="6068698">|=</span>&nbsp;<span class="ident" id="6068701">os</span><span class="op" id="6068703">.</span><span class="ident" id="6068704">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068713">case</span>&nbsp;<span class="ident" id="6068718">s_IFIFO</span><span class="op" id="6068725">:</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068729">mode</span>&nbsp;<span class="op" id="6068734">|=</span>&nbsp;<span class="ident" id="6068737">os</span><span class="op" id="6068739">.</span><span class="ident" id="6068740">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068755">case</span>&nbsp;<span class="ident" id="6068760">s_IFLNK</span><span class="op" id="6068767">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068771">mode</span>&nbsp;<span class="op" id="6068776">|=</span>&nbsp;<span class="ident" id="6068779">os</span><span class="op" id="6068781">.</span><span class="ident" id="6068782">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068795">case</span>&nbsp;<span class="ident" id="6068800">s_IFREG</span><span class="op" id="6068807">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068811">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068829">case</span>&nbsp;<span class="ident" id="6068834">s_IFSOCK</span><span class="op" id="6068842">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068846">mode</span>&nbsp;<span class="op" id="6068851">|=</span>&nbsp;<span class="ident" id="6068854">os</span><span class="op" id="6068856">.</span><span class="ident" id="6068857">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068872">if</span>&nbsp;<span class="ident" id="6068875">m</span><span class="op" id="6068876">&amp;</span><span class="ident" id="6068877">s_ISGID</span>&nbsp;<span class="op" id="6068885">!=</span>&nbsp;<span class="num" id="6068888">0</span>&nbsp;<span class="op" id="6068890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068894">mode</span>&nbsp;<span class="op" id="6068899">|=</span>&nbsp;<span class="ident" id="6068902">os</span><span class="op" id="6068904">.</span><span class="ident" id="6068905">ModeSetgid</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068920">if</span>&nbsp;<span class="ident" id="6068923">m</span><span class="op" id="6068924">&amp;</span><span class="ident" id="6068925">s_ISUID</span>&nbsp;<span class="op" id="6068933">!=</span>&nbsp;<span class="num" id="6068936">0</span>&nbsp;<span class="op" id="6068938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068942">mode</span>&nbsp;<span class="op" id="6068947">|=</span>&nbsp;<span class="ident" id="6068950">os</span><span class="op" id="6068952">.</span><span class="ident" id="6068953">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068968">if</span>&nbsp;<span class="ident" id="6068971">m</span><span class="op" id="6068972">&amp;</span><span class="ident" id="6068973">s_ISVTX</span>&nbsp;<span class="op" id="6068981">!=</span>&nbsp;<span class="num" id="6068984">0</span>&nbsp;<span class="op" id="6068986">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068990">mode</span>&nbsp;<span class="op" id="6068995">|=</span>&nbsp;<span class="ident" id="6068998">os</span><span class="op" id="6069000">.</span><span class="ident" id="6069001">ModeSticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069016">return</span>&nbsp;<span class="ident" id="6069023">mode</span><br>
<span class="lineno"></span><span class="op" id="6069028">}</span>
</div>
</body>
</html>
