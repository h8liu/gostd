<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/internal</h2>
<ul>
<li><a href="/gostd/net/http/internal/chunked.go.html">chunked.go</a></li>
<li><a href="/gostd/net/http/internal/chunked_test.go.html" class="current">chunked_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7899731">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7899786">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7899840">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7899891">package</span>&nbsp;<span class="ident" id="7899899">internal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7899909">import</span>&nbsp;<span class="op" id="7899916">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7899919">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7899928">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7899937">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7899944">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7899950">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7899963">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7899974">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7899984">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7899987">func</span>&nbsp;<span class="ident" id="7899992">TestChunk</span><span class="op" id="7900001">(</span><span class="ident" id="7900002">t</span>&nbsp;<span class="op" id="7900004">*</span><span class="ident" id="7900005">testing</span><span class="op" id="7900012">.</span><span class="ident" id="7900013">T</span><span class="op" id="7900014">)</span>&nbsp;<span class="op" id="7900016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900019">var</span>&nbsp;<span class="ident" id="7900023">b</span>&nbsp;<span class="ident" id="7900025">bytes</span><span class="op" id="7900030">.</span><span class="ident" id="7900031">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900040">w</span>&nbsp;<span class="op" id="7900042">:=</span>&nbsp;<span class="ident" id="7900045">NewChunkedWriter</span><span class="op" id="7900061">(</span><span class="op" id="7900062">&amp;</span><span class="ident" id="7900063">b</span><span class="op" id="7900064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900067">const</span>&nbsp;<span class="ident" id="7900073">chunk1</span>&nbsp;<span class="op" id="7900080">=</span>&nbsp;<span class="string" id="7900082">&#34;hello,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900093">const</span>&nbsp;<span class="ident" id="7900099">chunk2</span>&nbsp;<span class="op" id="7900106">=</span>&nbsp;<span class="string" id="7900108">&#34;world!&nbsp;0123456789abcdef&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900135">w</span><span class="op" id="7900136">.</span><span class="ident" id="7900137">Write</span><span class="op" id="7900142">(</span><span class="op" id="7900143">[</span><span class="op" id="7900144">]</span><span class="builtintype" id="7900145">byte</span><span class="op" id="7900149">(</span><span class="ident" id="7900150">chunk1</span><span class="op" id="7900156">)</span><span class="op" id="7900157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900160">w</span><span class="op" id="7900161">.</span><span class="ident" id="7900162">Write</span><span class="op" id="7900167">(</span><span class="op" id="7900168">[</span><span class="op" id="7900169">]</span><span class="builtintype" id="7900170">byte</span><span class="op" id="7900174">(</span><span class="ident" id="7900175">chunk2</span><span class="op" id="7900181">)</span><span class="op" id="7900182">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900185">w</span><span class="op" id="7900186">.</span><span class="ident" id="7900187">Close</span><span class="op" id="7900192">(</span><span class="op" id="7900193">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900197">if</span>&nbsp;<span class="ident" id="7900200">g</span><span class="op" id="7900201">,</span>&nbsp;<span class="ident" id="7900203">e</span>&nbsp;<span class="op" id="7900205">:=</span>&nbsp;<span class="ident" id="7900208">b</span><span class="op" id="7900209">.</span><span class="ident" id="7900210">String</span><span class="op" id="7900216">(</span><span class="op" id="7900217">)</span><span class="op" id="7900218">,</span>&nbsp;<span class="string" id="7900220">&#34;7\r\nhello,&nbsp;\r\n17\r\nworld!&nbsp;0123456789abcdef\r\n0\r\n&#34;</span><span class="op" id="7900276">;</span>&nbsp;<span class="ident" id="7900278">g</span>&nbsp;<span class="op" id="7900280">!=</span>&nbsp;<span class="ident" id="7900283">e</span>&nbsp;<span class="op" id="7900285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900289">t</span><span class="op" id="7900290">.</span><span class="ident" id="7900291">Fatalf</span><span class="op" id="7900297">(</span><span class="string" id="7900298">&#34;chunk&nbsp;writer&nbsp;wrote&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7900330">,</span>&nbsp;<span class="ident" id="7900332">g</span><span class="op" id="7900333">,</span>&nbsp;<span class="ident" id="7900335">e</span><span class="op" id="7900336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900339">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900343">r</span>&nbsp;<span class="op" id="7900345">:=</span>&nbsp;<span class="ident" id="7900348">NewChunkedReader</span><span class="op" id="7900364">(</span><span class="op" id="7900365">&amp;</span><span class="ident" id="7900366">b</span><span class="op" id="7900367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900370">data</span><span class="op" id="7900374">,</span>&nbsp;<span class="ident" id="7900376">err</span>&nbsp;<span class="op" id="7900380">:=</span>&nbsp;<span class="ident" id="7900383">ioutil</span><span class="op" id="7900389">.</span><span class="ident" id="7900390">ReadAll</span><span class="op" id="7900397">(</span><span class="ident" id="7900398">r</span><span class="op" id="7900399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900402">if</span>&nbsp;<span class="ident" id="7900405">err</span>&nbsp;<span class="op" id="7900409">!=</span>&nbsp;<span class="ident" id="7900412">nil</span>&nbsp;<span class="op" id="7900416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900420">t</span><span class="op" id="7900421">.</span><span class="ident" id="7900422">Logf</span><span class="op" id="7900426">(</span><span class="string" id="7900427">`data:&nbsp;&#34;%s&#34;`</span><span class="op" id="7900439">,</span>&nbsp;<span class="ident" id="7900441">data</span><span class="op" id="7900445">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900449">t</span><span class="op" id="7900450">.</span><span class="ident" id="7900451">Fatalf</span><span class="op" id="7900457">(</span><span class="string" id="7900458">&#34;ReadAll&nbsp;from&nbsp;reader:&nbsp;%v&#34;</span><span class="op" id="7900483">,</span>&nbsp;<span class="ident" id="7900485">err</span><span class="op" id="7900488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900494">if</span>&nbsp;<span class="ident" id="7900497">g</span><span class="op" id="7900498">,</span>&nbsp;<span class="ident" id="7900500">e</span>&nbsp;<span class="op" id="7900502">:=</span>&nbsp;<span class="builtintype" id="7900505">string</span><span class="op" id="7900511">(</span><span class="ident" id="7900512">data</span><span class="op" id="7900516">)</span><span class="op" id="7900517">,</span>&nbsp;<span class="ident" id="7900519">chunk1</span><span class="op" id="7900525">+</span><span class="ident" id="7900526">chunk2</span><span class="op" id="7900532">;</span>&nbsp;<span class="ident" id="7900534">g</span>&nbsp;<span class="op" id="7900536">!=</span>&nbsp;<span class="ident" id="7900539">e</span>&nbsp;<span class="op" id="7900541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900545">t</span><span class="op" id="7900546">.</span><span class="ident" id="7900547">Errorf</span><span class="op" id="7900553">(</span><span class="string" id="7900554">&#34;chunk&nbsp;reader&nbsp;read&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7900585">,</span>&nbsp;<span class="ident" id="7900587">g</span><span class="op" id="7900588">,</span>&nbsp;<span class="ident" id="7900590">e</span><span class="op" id="7900591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900594">}</span><br>
<span class="lineno">40</span><span class="op" id="7900596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7900599">func</span>&nbsp;<span class="ident" id="7900604">TestChunkReadMultiple</span><span class="op" id="7900625">(</span><span class="ident" id="7900626">t</span>&nbsp;<span class="op" id="7900628">*</span><span class="ident" id="7900629">testing</span><span class="op" id="7900636">.</span><span class="ident" id="7900637">T</span><span class="op" id="7900638">)</span>&nbsp;<span class="op" id="7900640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7900643">//&nbsp;Bunch&nbsp;of&nbsp;small&nbsp;chunks,&nbsp;all&nbsp;read&nbsp;together.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900689">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900693">var</span>&nbsp;<span class="ident" id="7900697">b</span>&nbsp;<span class="ident" id="7900699">bytes</span><span class="op" id="7900704">.</span><span class="ident" id="7900705">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900714">w</span>&nbsp;<span class="op" id="7900716">:=</span>&nbsp;<span class="ident" id="7900719">NewChunkedWriter</span><span class="op" id="7900735">(</span><span class="op" id="7900736">&amp;</span><span class="ident" id="7900737">b</span><span class="op" id="7900738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900742">w</span><span class="op" id="7900743">.</span><span class="ident" id="7900744">Write</span><span class="op" id="7900749">(</span><span class="op" id="7900750">[</span><span class="op" id="7900751">]</span><span class="builtintype" id="7900752">byte</span><span class="op" id="7900756">(</span><span class="string" id="7900757">&#34;foo&#34;</span><span class="op" id="7900762">)</span><span class="op" id="7900763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900767">w</span><span class="op" id="7900768">.</span><span class="ident" id="7900769">Write</span><span class="op" id="7900774">(</span><span class="op" id="7900775">[</span><span class="op" id="7900776">]</span><span class="builtintype" id="7900777">byte</span><span class="op" id="7900781">(</span><span class="string" id="7900782">&#34;bar&#34;</span><span class="op" id="7900787">)</span><span class="op" id="7900788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900792">w</span><span class="op" id="7900793">.</span><span class="ident" id="7900794">Close</span><span class="op" id="7900799">(</span><span class="op" id="7900800">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900805">r</span>&nbsp;<span class="op" id="7900807">:=</span>&nbsp;<span class="ident" id="7900810">NewChunkedReader</span><span class="op" id="7900826">(</span><span class="op" id="7900827">&amp;</span><span class="ident" id="7900828">b</span><span class="op" id="7900829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900833">buf</span>&nbsp;<span class="op" id="7900837">:=</span>&nbsp;<span class="builtinfunc" id="7900840">make</span><span class="op" id="7900844">(</span><span class="op" id="7900845">[</span><span class="op" id="7900846">]</span><span class="builtintype" id="7900847">byte</span><span class="op" id="7900851">,</span>&nbsp;<span class="num" id="7900853">10</span><span class="op" id="7900855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900859">n</span><span class="op" id="7900860">,</span>&nbsp;<span class="ident" id="7900862">err</span>&nbsp;<span class="op" id="7900866">:=</span>&nbsp;<span class="ident" id="7900869">r</span><span class="op" id="7900870">.</span><span class="ident" id="7900871">Read</span><span class="op" id="7900875">(</span><span class="ident" id="7900876">buf</span><span class="op" id="7900879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900883">if</span>&nbsp;<span class="ident" id="7900886">n</span>&nbsp;<span class="op" id="7900888">!=</span>&nbsp;<span class="num" id="7900891">6</span>&nbsp;<span class="op" id="7900893">||</span>&nbsp;<span class="ident" id="7900896">err</span>&nbsp;<span class="op" id="7900900">!=</span>&nbsp;<span class="ident" id="7900903">io</span><span class="op" id="7900905">.</span><span class="ident" id="7900906">EOF</span>&nbsp;<span class="op" id="7900910">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900915">t</span><span class="op" id="7900916">.</span><span class="ident" id="7900917">Errorf</span><span class="op" id="7900923">(</span><span class="string" id="7900924">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;6,&nbsp;EOF&#34;</span><span class="op" id="7900952">,</span>&nbsp;<span class="ident" id="7900954">n</span><span class="op" id="7900955">,</span>&nbsp;<span class="ident" id="7900957">err</span><span class="op" id="7900960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7900964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7900968">buf</span>&nbsp;<span class="op" id="7900972">=</span>&nbsp;<span class="ident" id="7900974">buf</span><span class="op" id="7900977">[</span><span class="op" id="7900978">:</span><span class="ident" id="7900979">n</span><span class="op" id="7900980">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7900984">if</span>&nbsp;<span class="builtintype" id="7900987">string</span><span class="op" id="7900993">(</span><span class="ident" id="7900994">buf</span><span class="op" id="7900997">)</span>&nbsp;<span class="op" id="7900999">!=</span>&nbsp;<span class="string" id="7901002">&#34;foobar&#34;</span>&nbsp;<span class="op" id="7901011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901016">t</span><span class="op" id="7901017">.</span><span class="ident" id="7901018">Errorf</span><span class="op" id="7901024">(</span><span class="string" id="7901025">&#34;Read&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7901045">,</span>&nbsp;<span class="ident" id="7901047">buf</span><span class="op" id="7901050">,</span>&nbsp;<span class="string" id="7901052">&#34;foobar&#34;</span><span class="op" id="7901060">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7901071">//&nbsp;One&nbsp;big&nbsp;chunk&nbsp;followed&nbsp;by&nbsp;a&nbsp;little&nbsp;chunk,&nbsp;but&nbsp;the&nbsp;small&nbsp;bufio.Reader&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7901149">//&nbsp;should&nbsp;prevent&nbsp;the&nbsp;second&nbsp;chunk&nbsp;header&nbsp;from&nbsp;being&nbsp;read.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901213">var</span>&nbsp;<span class="ident" id="7901217">b</span>&nbsp;<span class="ident" id="7901219">bytes</span><span class="op" id="7901224">.</span><span class="ident" id="7901225">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901234">w</span>&nbsp;<span class="op" id="7901236">:=</span>&nbsp;<span class="ident" id="7901239">NewChunkedWriter</span><span class="op" id="7901255">(</span><span class="op" id="7901256">&amp;</span><span class="ident" id="7901257">b</span><span class="op" id="7901258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7901262">//&nbsp;fillBufChunk&nbsp;is&nbsp;11&nbsp;bytes&nbsp;+&nbsp;3&nbsp;bytes&nbsp;header&nbsp;+&nbsp;2&nbsp;bytes&nbsp;footer&nbsp;=&nbsp;16&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7901338">//&nbsp;the&nbsp;same&nbsp;as&nbsp;the&nbsp;bufio&nbsp;ReaderSize&nbsp;below&nbsp;(the&nbsp;minimum),&nbsp;so&nbsp;even</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7901405">//&nbsp;though&nbsp;we&#39;re&nbsp;going&nbsp;to&nbsp;try&nbsp;to&nbsp;Read&nbsp;with&nbsp;a&nbsp;buffer&nbsp;larger&nbsp;enough&nbsp;to&nbsp;also</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7901480">//&nbsp;receive&nbsp;&#34;foo&#34;,&nbsp;the&nbsp;second&nbsp;chunk&nbsp;header&nbsp;won&#39;t&nbsp;be&nbsp;read&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901543">const</span>&nbsp;<span class="ident" id="7901549">fillBufChunk</span>&nbsp;<span class="op" id="7901562">=</span>&nbsp;<span class="string" id="7901564">&#34;0123456789a&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901580">const</span>&nbsp;<span class="ident" id="7901586">shortChunk</span>&nbsp;<span class="op" id="7901597">=</span>&nbsp;<span class="string" id="7901599">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901607">w</span><span class="op" id="7901608">.</span><span class="ident" id="7901609">Write</span><span class="op" id="7901614">(</span><span class="op" id="7901615">[</span><span class="op" id="7901616">]</span><span class="builtintype" id="7901617">byte</span><span class="op" id="7901621">(</span><span class="ident" id="7901622">fillBufChunk</span><span class="op" id="7901634">)</span><span class="op" id="7901635">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901639">w</span><span class="op" id="7901640">.</span><span class="ident" id="7901641">Write</span><span class="op" id="7901646">(</span><span class="op" id="7901647">[</span><span class="op" id="7901648">]</span><span class="builtintype" id="7901649">byte</span><span class="op" id="7901653">(</span><span class="ident" id="7901654">shortChunk</span><span class="op" id="7901664">)</span><span class="op" id="7901665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901669">w</span><span class="op" id="7901670">.</span><span class="ident" id="7901671">Close</span><span class="op" id="7901676">(</span><span class="op" id="7901677">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901682">r</span>&nbsp;<span class="op" id="7901684">:=</span>&nbsp;<span class="ident" id="7901687">NewChunkedReader</span><span class="op" id="7901703">(</span><span class="ident" id="7901704">bufio</span><span class="op" id="7901709">.</span><span class="ident" id="7901710">NewReaderSize</span><span class="op" id="7901723">(</span><span class="op" id="7901724">&amp;</span><span class="ident" id="7901725">b</span><span class="op" id="7901726">,</span>&nbsp;<span class="num" id="7901728">16</span><span class="op" id="7901730">)</span><span class="op" id="7901731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901735">buf</span>&nbsp;<span class="op" id="7901739">:=</span>&nbsp;<span class="builtinfunc" id="7901742">make</span><span class="op" id="7901746">(</span><span class="op" id="7901747">[</span><span class="op" id="7901748">]</span><span class="builtintype" id="7901749">byte</span><span class="op" id="7901753">,</span>&nbsp;<span class="builtinfunc" id="7901755">len</span><span class="op" id="7901758">(</span><span class="ident" id="7901759">fillBufChunk</span><span class="op" id="7901771">)</span><span class="op" id="7901772">+</span><span class="builtinfunc" id="7901773">len</span><span class="op" id="7901776">(</span><span class="ident" id="7901777">shortChunk</span><span class="op" id="7901787">)</span><span class="op" id="7901788">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901792">n</span><span class="op" id="7901793">,</span>&nbsp;<span class="ident" id="7901795">err</span>&nbsp;<span class="op" id="7901799">:=</span>&nbsp;<span class="ident" id="7901802">r</span><span class="op" id="7901803">.</span><span class="ident" id="7901804">Read</span><span class="op" id="7901808">(</span><span class="ident" id="7901809">buf</span><span class="op" id="7901812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901816">if</span>&nbsp;<span class="ident" id="7901819">n</span>&nbsp;<span class="op" id="7901821">!=</span>&nbsp;<span class="builtinfunc" id="7901824">len</span><span class="op" id="7901827">(</span><span class="ident" id="7901828">fillBufChunk</span><span class="op" id="7901840">)</span>&nbsp;<span class="op" id="7901842">||</span>&nbsp;<span class="ident" id="7901845">err</span>&nbsp;<span class="op" id="7901849">!=</span>&nbsp;<span class="ident" id="7901852">nil</span>&nbsp;<span class="op" id="7901856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901861">t</span><span class="op" id="7901862">.</span><span class="ident" id="7901863">Errorf</span><span class="op" id="7901869">(</span><span class="string" id="7901870">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7901899">,</span>&nbsp;<span class="ident" id="7901901">n</span><span class="op" id="7901902">,</span>&nbsp;<span class="ident" id="7901904">err</span><span class="op" id="7901907">,</span>&nbsp;<span class="builtinfunc" id="7901909">len</span><span class="op" id="7901912">(</span><span class="ident" id="7901913">fillBufChunk</span><span class="op" id="7901925">)</span><span class="op" id="7901926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7901930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901934">buf</span>&nbsp;<span class="op" id="7901938">=</span>&nbsp;<span class="ident" id="7901940">buf</span><span class="op" id="7901943">[</span><span class="op" id="7901944">:</span><span class="ident" id="7901945">n</span><span class="op" id="7901946">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7901950">if</span>&nbsp;<span class="builtintype" id="7901953">string</span><span class="op" id="7901959">(</span><span class="ident" id="7901960">buf</span><span class="op" id="7901963">)</span>&nbsp;<span class="op" id="7901965">!=</span>&nbsp;<span class="ident" id="7901968">fillBufChunk</span>&nbsp;<span class="op" id="7901981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7901986">t</span><span class="op" id="7901987">.</span><span class="ident" id="7901988">Errorf</span><span class="op" id="7901994">(</span><span class="string" id="7901995">&#34;Read&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7902015">,</span>&nbsp;<span class="ident" id="7902017">buf</span><span class="op" id="7902020">,</span>&nbsp;<span class="ident" id="7902022">fillBufChunk</span><span class="op" id="7902034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902043">n</span><span class="op" id="7902044">,</span>&nbsp;<span class="ident" id="7902046">err</span>&nbsp;<span class="op" id="7902050">=</span>&nbsp;<span class="ident" id="7902052">r</span><span class="op" id="7902053">.</span><span class="ident" id="7902054">Read</span><span class="op" id="7902058">(</span><span class="ident" id="7902059">buf</span><span class="op" id="7902062">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902066">if</span>&nbsp;<span class="ident" id="7902069">n</span>&nbsp;<span class="op" id="7902071">!=</span>&nbsp;<span class="builtinfunc" id="7902074">len</span><span class="op" id="7902077">(</span><span class="ident" id="7902078">shortChunk</span><span class="op" id="7902088">)</span>&nbsp;<span class="op" id="7902090">||</span>&nbsp;<span class="ident" id="7902093">err</span>&nbsp;<span class="op" id="7902097">!=</span>&nbsp;<span class="ident" id="7902100">io</span><span class="op" id="7902102">.</span><span class="ident" id="7902103">EOF</span>&nbsp;<span class="op" id="7902107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902112">t</span><span class="op" id="7902113">.</span><span class="ident" id="7902114">Errorf</span><span class="op" id="7902120">(</span><span class="string" id="7902121">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;EOF&#34;</span><span class="op" id="7902150">,</span>&nbsp;<span class="ident" id="7902152">n</span><span class="op" id="7902153">,</span>&nbsp;<span class="ident" id="7902155">err</span><span class="op" id="7902158">,</span>&nbsp;<span class="builtinfunc" id="7902160">len</span><span class="op" id="7902163">(</span><span class="ident" id="7902164">shortChunk</span><span class="op" id="7902174">)</span><span class="op" id="7902175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7902186">//&nbsp;And&nbsp;test&nbsp;that&nbsp;we&nbsp;see&nbsp;an&nbsp;EOF&nbsp;chunk,&nbsp;even&nbsp;though&nbsp;our&nbsp;buffer&nbsp;is&nbsp;already&nbsp;full:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902269">r</span>&nbsp;<span class="op" id="7902271">:=</span>&nbsp;<span class="ident" id="7902274">NewChunkedReader</span><span class="op" id="7902290">(</span><span class="ident" id="7902291">bufio</span><span class="op" id="7902296">.</span><span class="ident" id="7902297">NewReader</span><span class="op" id="7902306">(</span><span class="ident" id="7902307">strings</span><span class="op" id="7902314">.</span><span class="ident" id="7902315">NewReader</span><span class="op" id="7902324">(</span><span class="string" id="7902325">&#34;3\r\nfoo\r\n0\r\n&#34;</span><span class="op" id="7902344">)</span><span class="op" id="7902345">)</span><span class="op" id="7902346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902350">buf</span>&nbsp;<span class="op" id="7902354">:=</span>&nbsp;<span class="builtinfunc" id="7902357">make</span><span class="op" id="7902361">(</span><span class="op" id="7902362">[</span><span class="op" id="7902363">]</span><span class="builtintype" id="7902364">byte</span><span class="op" id="7902368">,</span>&nbsp;<span class="num" id="7902370">3</span><span class="op" id="7902371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902375">n</span><span class="op" id="7902376">,</span>&nbsp;<span class="ident" id="7902378">err</span>&nbsp;<span class="op" id="7902382">:=</span>&nbsp;<span class="ident" id="7902385">r</span><span class="op" id="7902386">.</span><span class="ident" id="7902387">Read</span><span class="op" id="7902391">(</span><span class="ident" id="7902392">buf</span><span class="op" id="7902395">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902399">if</span>&nbsp;<span class="ident" id="7902402">n</span>&nbsp;<span class="op" id="7902404">!=</span>&nbsp;<span class="num" id="7902407">3</span>&nbsp;<span class="op" id="7902409">||</span>&nbsp;<span class="ident" id="7902412">err</span>&nbsp;<span class="op" id="7902416">!=</span>&nbsp;<span class="ident" id="7902419">io</span><span class="op" id="7902421">.</span><span class="ident" id="7902422">EOF</span>&nbsp;<span class="op" id="7902426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902431">t</span><span class="op" id="7902432">.</span><span class="ident" id="7902433">Errorf</span><span class="op" id="7902439">(</span><span class="string" id="7902440">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;3,&nbsp;EOF&#34;</span><span class="op" id="7902468">,</span>&nbsp;<span class="ident" id="7902470">n</span><span class="op" id="7902471">,</span>&nbsp;<span class="ident" id="7902473">err</span><span class="op" id="7902476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902484">if</span>&nbsp;<span class="builtintype" id="7902487">string</span><span class="op" id="7902493">(</span><span class="ident" id="7902494">buf</span><span class="op" id="7902497">)</span>&nbsp;<span class="op" id="7902499">!=</span>&nbsp;<span class="string" id="7902502">&#34;foo&#34;</span>&nbsp;<span class="op" id="7902508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902513">t</span><span class="op" id="7902514">.</span><span class="ident" id="7902515">Errorf</span><span class="op" id="7902521">(</span><span class="string" id="7902522">&#34;buf&nbsp;=&nbsp;%q;&nbsp;want&nbsp;foo&#34;</span><span class="op" id="7902542">,</span>&nbsp;<span class="ident" id="7902544">buf</span><span class="op" id="7902547">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902554">}</span><br>
<span class="lineno"></span><span class="op" id="7902556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7902559">func</span>&nbsp;<span class="ident" id="7902564">TestChunkReaderAllocs</span><span class="op" id="7902585">(</span><span class="ident" id="7902586">t</span>&nbsp;<span class="op" id="7902588">*</span><span class="ident" id="7902589">testing</span><span class="op" id="7902596">.</span><span class="ident" id="7902597">T</span><span class="op" id="7902598">)</span>&nbsp;<span class="op" id="7902600">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902603">if</span>&nbsp;<span class="ident" id="7902606">testing</span><span class="op" id="7902613">.</span><span class="ident" id="7902614">Short</span><span class="op" id="7902619">(</span><span class="op" id="7902620">)</span>&nbsp;<span class="op" id="7902622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902626">t</span><span class="op" id="7902627">.</span><span class="ident" id="7902628">Skip</span><span class="op" id="7902632">(</span><span class="string" id="7902633">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7902657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7902660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7902663">var</span>&nbsp;<span class="ident" id="7902667">buf</span>&nbsp;<span class="ident" id="7902671">bytes</span><span class="op" id="7902676">.</span><span class="ident" id="7902677">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902685">w</span>&nbsp;<span class="op" id="7902687">:=</span>&nbsp;<span class="ident" id="7902690">NewChunkedWriter</span><span class="op" id="7902706">(</span><span class="op" id="7902707">&amp;</span><span class="ident" id="7902708">buf</span><span class="op" id="7902711">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902714">a</span><span class="op" id="7902715">,</span>&nbsp;<span class="ident" id="7902717">b</span><span class="op" id="7902718">,</span>&nbsp;<span class="ident" id="7902720">c</span>&nbsp;<span class="op" id="7902722">:=</span>&nbsp;<span class="op" id="7902725">[</span><span class="op" id="7902726">]</span><span class="builtintype" id="7902727">byte</span><span class="op" id="7902731">(</span><span class="string" id="7902732">&#34;aaaaaa&#34;</span><span class="op" id="7902740">)</span><span class="op" id="7902741">,</span>&nbsp;<span class="op" id="7902743">[</span><span class="op" id="7902744">]</span><span class="builtintype" id="7902745">byte</span><span class="op" id="7902749">(</span><span class="string" id="7902750">&#34;bbbbbbbbbbbb&#34;</span><span class="op" id="7902764">)</span><span class="op" id="7902765">,</span>&nbsp;<span class="op" id="7902767">[</span><span class="op" id="7902768">]</span><span class="builtintype" id="7902769">byte</span><span class="op" id="7902773">(</span><span class="string" id="7902774">&#34;cccccccccccccccccccccccc&#34;</span><span class="op" id="7902800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902803">w</span><span class="op" id="7902804">.</span><span class="ident" id="7902805">Write</span><span class="op" id="7902810">(</span><span class="ident" id="7902811">a</span><span class="op" id="7902812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902815">w</span><span class="op" id="7902816">.</span><span class="ident" id="7902817">Write</span><span class="op" id="7902822">(</span><span class="ident" id="7902823">b</span><span class="op" id="7902824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902827">w</span><span class="op" id="7902828">.</span><span class="ident" id="7902829">Write</span><span class="op" id="7902834">(</span><span class="ident" id="7902835">c</span><span class="op" id="7902836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902839">w</span><span class="op" id="7902840">.</span><span class="ident" id="7902841">Close</span><span class="op" id="7902846">(</span><span class="op" id="7902847">)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902851">readBuf</span>&nbsp;<span class="op" id="7902859">:=</span>&nbsp;<span class="builtinfunc" id="7902862">make</span><span class="op" id="7902866">(</span><span class="op" id="7902867">[</span><span class="op" id="7902868">]</span><span class="builtintype" id="7902869">byte</span><span class="op" id="7902873">,</span>&nbsp;<span class="builtinfunc" id="7902875">len</span><span class="op" id="7902878">(</span><span class="ident" id="7902879">a</span><span class="op" id="7902880">)</span><span class="op" id="7902881">+</span><span class="builtinfunc" id="7902882">len</span><span class="op" id="7902885">(</span><span class="ident" id="7902886">b</span><span class="op" id="7902887">)</span><span class="op" id="7902888">+</span><span class="builtinfunc" id="7902889">len</span><span class="op" id="7902892">(</span><span class="ident" id="7902893">c</span><span class="op" id="7902894">)</span><span class="op" id="7902895">+</span><span class="num" id="7902896">1</span><span class="op" id="7902897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902900">byter</span>&nbsp;<span class="op" id="7902906">:=</span>&nbsp;<span class="ident" id="7902909">bytes</span><span class="op" id="7902914">.</span><span class="ident" id="7902915">NewReader</span><span class="op" id="7902924">(</span><span class="ident" id="7902925">buf</span><span class="op" id="7902928">.</span><span class="ident" id="7902929">Bytes</span><span class="op" id="7902934">(</span><span class="op" id="7902935">)</span><span class="op" id="7902936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902939">bufr</span>&nbsp;<span class="op" id="7902944">:=</span>&nbsp;<span class="ident" id="7902947">bufio</span><span class="op" id="7902952">.</span><span class="ident" id="7902953">NewReader</span><span class="op" id="7902962">(</span><span class="ident" id="7902963">byter</span><span class="op" id="7902968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7902971">mallocs</span>&nbsp;<span class="op" id="7902979">:=</span>&nbsp;<span class="ident" id="7902982">testing</span><span class="op" id="7902989">.</span><span class="ident" id="7902990">AllocsPerRun</span><span class="op" id="7903002">(</span><span class="num" id="7903003">100</span><span class="op" id="7903006">,</span>&nbsp;<span class="keyword" id="7903008">func</span><span class="op" id="7903012">(</span><span class="op" id="7903013">)</span>&nbsp;<span class="op" id="7903015">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903019">byter</span><span class="op" id="7903024">.</span><span class="ident" id="7903025">Seek</span><span class="op" id="7903029">(</span><span class="num" id="7903030">0</span><span class="op" id="7903031">,</span>&nbsp;<span class="num" id="7903033">0</span><span class="op" id="7903034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903038">bufr</span><span class="op" id="7903042">.</span><span class="ident" id="7903043">Reset</span><span class="op" id="7903048">(</span><span class="ident" id="7903049">byter</span><span class="op" id="7903054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903058">r</span>&nbsp;<span class="op" id="7903060">:=</span>&nbsp;<span class="ident" id="7903063">NewChunkedReader</span><span class="op" id="7903079">(</span><span class="ident" id="7903080">bufr</span><span class="op" id="7903084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903088">n</span><span class="op" id="7903089">,</span>&nbsp;<span class="ident" id="7903091">err</span>&nbsp;<span class="op" id="7903095">:=</span>&nbsp;<span class="ident" id="7903098">io</span><span class="op" id="7903100">.</span><span class="ident" id="7903101">ReadFull</span><span class="op" id="7903109">(</span><span class="ident" id="7903110">r</span><span class="op" id="7903111">,</span>&nbsp;<span class="ident" id="7903113">readBuf</span><span class="op" id="7903120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903124">if</span>&nbsp;<span class="ident" id="7903127">n</span>&nbsp;<span class="op" id="7903129">!=</span>&nbsp;<span class="builtinfunc" id="7903132">len</span><span class="op" id="7903135">(</span><span class="ident" id="7903136">readBuf</span><span class="op" id="7903143">)</span><span class="op" id="7903144">-</span><span class="num" id="7903145">1</span>&nbsp;<span class="op" id="7903147">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903152">t</span><span class="op" id="7903153">.</span><span class="ident" id="7903154">Fatalf</span><span class="op" id="7903160">(</span><span class="string" id="7903161">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7903185">,</span>&nbsp;<span class="ident" id="7903187">n</span><span class="op" id="7903188">,</span>&nbsp;<span class="builtinfunc" id="7903190">len</span><span class="op" id="7903193">(</span><span class="ident" id="7903194">readBuf</span><span class="op" id="7903201">)</span><span class="op" id="7903202">-</span><span class="num" id="7903203">1</span><span class="op" id="7903204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903212">if</span>&nbsp;<span class="ident" id="7903215">err</span>&nbsp;<span class="op" id="7903219">!=</span>&nbsp;<span class="ident" id="7903222">io</span><span class="op" id="7903224">.</span><span class="ident" id="7903225">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7903242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903247">t</span><span class="op" id="7903248">.</span><span class="ident" id="7903249">Fatalf</span><span class="op" id="7903255">(</span><span class="string" id="7903256">&#34;read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;ErrUnexpectedEOF&#34;</span><span class="op" id="7903296">,</span>&nbsp;<span class="ident" id="7903298">err</span><span class="op" id="7903301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903305">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903308">}</span><span class="op" id="7903309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903312">if</span>&nbsp;<span class="ident" id="7903315">mallocs</span>&nbsp;<span class="op" id="7903323">&gt;</span>&nbsp;<span class="num" id="7903325">1.5</span>&nbsp;<span class="op" id="7903329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903333">t</span><span class="op" id="7903334">.</span><span class="ident" id="7903335">Errorf</span><span class="op" id="7903341">(</span><span class="string" id="7903342">&#34;mallocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7903364">,</span>&nbsp;<span class="ident" id="7903366">mallocs</span><span class="op" id="7903373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903376">}</span><br>
<span class="lineno"></span><span class="op" id="7903378">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="7903381">func</span>&nbsp;<span class="ident" id="7903386">TestParseHexUint</span><span class="op" id="7903402">(</span><span class="ident" id="7903403">t</span>&nbsp;<span class="op" id="7903405">*</span><span class="ident" id="7903406">testing</span><span class="op" id="7903413">.</span><span class="ident" id="7903414">T</span><span class="op" id="7903415">)</span>&nbsp;<span class="op" id="7903417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903420">for</span>&nbsp;<span class="ident" id="7903424">i</span>&nbsp;<span class="op" id="7903426">:=</span>&nbsp;<span class="ident" id="7903429">uint64</span><span class="op" id="7903435">(</span><span class="num" id="7903436">0</span><span class="op" id="7903437">)</span><span class="op" id="7903438">;</span>&nbsp;<span class="ident" id="7903440">i</span>&nbsp;<span class="op" id="7903442">&lt;=</span>&nbsp;<span class="num" id="7903445">1234</span><span class="op" id="7903449">;</span>&nbsp;<span class="ident" id="7903451">i</span><span class="op" id="7903452">++</span>&nbsp;<span class="op" id="7903455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903459">line</span>&nbsp;<span class="op" id="7903464">:=</span>&nbsp;<span class="op" id="7903467">[</span><span class="op" id="7903468">]</span><span class="builtintype" id="7903469">byte</span><span class="op" id="7903473">(</span><span class="ident" id="7903474">fmt</span><span class="op" id="7903477">.</span><span class="ident" id="7903478">Sprintf</span><span class="op" id="7903485">(</span><span class="string" id="7903486">&#34;%x&#34;</span><span class="op" id="7903490">,</span>&nbsp;<span class="ident" id="7903492">i</span><span class="op" id="7903493">)</span><span class="op" id="7903494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903498">got</span><span class="op" id="7903501">,</span>&nbsp;<span class="ident" id="7903503">err</span>&nbsp;<span class="op" id="7903507">:=</span>&nbsp;<span class="ident" id="7903510">parseHexUint</span><span class="op" id="7903522">(</span><span class="ident" id="7903523">line</span><span class="op" id="7903527">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903531">if</span>&nbsp;<span class="ident" id="7903534">err</span>&nbsp;<span class="op" id="7903538">!=</span>&nbsp;<span class="ident" id="7903541">nil</span>&nbsp;<span class="op" id="7903545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903550">t</span><span class="op" id="7903551">.</span><span class="ident" id="7903552">Fatalf</span><span class="op" id="7903558">(</span><span class="string" id="7903559">&#34;on&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="7903570">,</span>&nbsp;<span class="ident" id="7903572">i</span><span class="op" id="7903573">,</span>&nbsp;<span class="ident" id="7903575">err</span><span class="op" id="7903578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903586">if</span>&nbsp;<span class="ident" id="7903589">got</span>&nbsp;<span class="op" id="7903593">!=</span>&nbsp;<span class="ident" id="7903596">i</span>&nbsp;<span class="op" id="7903598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903603">t</span><span class="op" id="7903604">.</span><span class="ident" id="7903605">Errorf</span><span class="op" id="7903611">(</span><span class="string" id="7903612">&#34;for&nbsp;input&nbsp;%q&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7903640">,</span>&nbsp;<span class="ident" id="7903642">line</span><span class="op" id="7903646">,</span>&nbsp;<span class="ident" id="7903648">got</span><span class="op" id="7903651">,</span>&nbsp;<span class="ident" id="7903653">i</span><span class="op" id="7903654">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903664">_</span><span class="op" id="7903665">,</span>&nbsp;<span class="ident" id="7903667">err</span>&nbsp;<span class="op" id="7903671">:=</span>&nbsp;<span class="ident" id="7903674">parseHexUint</span><span class="op" id="7903686">(</span><span class="op" id="7903687">[</span><span class="op" id="7903688">]</span><span class="builtintype" id="7903689">byte</span><span class="op" id="7903693">(</span><span class="string" id="7903694">&#34;bogus&#34;</span><span class="op" id="7903701">)</span><span class="op" id="7903702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7903705">if</span>&nbsp;<span class="ident" id="7903708">err</span>&nbsp;<span class="op" id="7903712">==</span>&nbsp;<span class="ident" id="7903715">nil</span>&nbsp;<span class="op" id="7903719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7903723">t</span><span class="op" id="7903724">.</span><span class="ident" id="7903725">Error</span><span class="op" id="7903730">(</span><span class="string" id="7903731">&#34;expected&nbsp;error&nbsp;on&nbsp;bogus&nbsp;input&#34;</span><span class="op" id="7903762">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7903765">}</span><br>
<span class="lineno"></span><span class="op" id="7903767">}</span>
</div>
</body>
</html>
