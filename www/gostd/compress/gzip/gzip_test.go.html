<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html" class="current">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7171852">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7171907">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7171961">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7172012">package</span>&nbsp;<span class="ident" id="7172020">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7172026">import</span>&nbsp;<span class="op" id="7172033">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7172036">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7172045">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7172054">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7172067">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7172078">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7172085">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="7172088">//&nbsp;TestEmpty&nbsp;tests&nbsp;that&nbsp;an&nbsp;empty&nbsp;payload&nbsp;still&nbsp;forms&nbsp;a&nbsp;valid&nbsp;GZIP&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="7172162">func</span>&nbsp;<span class="ident" id="7172167">TestEmpty</span><span class="op" id="7172176">(</span><span class="ident" id="7172177">t</span>&nbsp;<span class="op" id="7172179">*</span><span class="ident" id="7172180">testing</span><span class="op" id="7172187">.</span><span class="ident" id="7172188">T</span><span class="op" id="7172189">)</span>&nbsp;<span class="op" id="7172191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172194">buf</span>&nbsp;<span class="op" id="7172198">:=</span>&nbsp;<span class="builtinfunc" id="7172201">new</span><span class="op" id="7172204">(</span><span class="ident" id="7172205">bytes</span><span class="op" id="7172210">.</span><span class="ident" id="7172211">Buffer</span><span class="op" id="7172217">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7172221">if</span>&nbsp;<span class="ident" id="7172224">err</span>&nbsp;<span class="op" id="7172228">:=</span>&nbsp;<span class="ident" id="7172231">NewWriter</span><span class="op" id="7172240">(</span><span class="ident" id="7172241">buf</span><span class="op" id="7172244">)</span><span class="op" id="7172245">.</span><span class="ident" id="7172246">Close</span><span class="op" id="7172251">(</span><span class="op" id="7172252">)</span><span class="op" id="7172253">;</span>&nbsp;<span class="ident" id="7172255">err</span>&nbsp;<span class="op" id="7172259">!=</span>&nbsp;<span class="ident" id="7172262">nil</span>&nbsp;<span class="op" id="7172266">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172270">t</span><span class="op" id="7172271">.</span><span class="ident" id="7172272">Fatalf</span><span class="op" id="7172278">(</span><span class="string" id="7172279">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="7172297">,</span>&nbsp;<span class="ident" id="7172299">err</span><span class="op" id="7172302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7172305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172309">r</span><span class="op" id="7172310">,</span>&nbsp;<span class="ident" id="7172312">err</span>&nbsp;<span class="op" id="7172316">:=</span>&nbsp;<span class="ident" id="7172319">NewReader</span><span class="op" id="7172328">(</span><span class="ident" id="7172329">buf</span><span class="op" id="7172332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7172335">if</span>&nbsp;<span class="ident" id="7172338">err</span>&nbsp;<span class="op" id="7172342">!=</span>&nbsp;<span class="ident" id="7172345">nil</span>&nbsp;<span class="op" id="7172349">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172353">t</span><span class="op" id="7172354">.</span><span class="ident" id="7172355">Fatalf</span><span class="op" id="7172361">(</span><span class="string" id="7172362">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7172377">,</span>&nbsp;<span class="ident" id="7172379">err</span><span class="op" id="7172382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7172385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172388">b</span><span class="op" id="7172389">,</span>&nbsp;<span class="ident" id="7172391">err</span>&nbsp;<span class="op" id="7172395">:=</span>&nbsp;<span class="ident" id="7172398">ioutil</span><span class="op" id="7172404">.</span><span class="ident" id="7172405">ReadAll</span><span class="op" id="7172412">(</span><span class="ident" id="7172413">r</span><span class="op" id="7172414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7172417">if</span>&nbsp;<span class="ident" id="7172420">err</span>&nbsp;<span class="op" id="7172424">!=</span>&nbsp;<span class="ident" id="7172427">nil</span>&nbsp;<span class="op" id="7172431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172435">t</span><span class="op" id="7172436">.</span><span class="ident" id="7172437">Fatalf</span><span class="op" id="7172443">(</span><span class="string" id="7172444">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="7172457">,</span>&nbsp;<span class="ident" id="7172459">err</span><span class="op" id="7172462">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7172465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7172468">if</span>&nbsp;<span class="builtinfunc" id="7172471">len</span><span class="op" id="7172474">(</span><span class="ident" id="7172475">b</span><span class="op" id="7172476">)</span>&nbsp;<span class="op" id="7172478">!=</span>&nbsp;<span class="num" id="7172481">0</span>&nbsp;<span class="op" id="7172483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172487">t</span><span class="op" id="7172488">.</span><span class="ident" id="7172489">Fatalf</span><span class="op" id="7172495">(</span><span class="string" id="7172496">&#34;got&nbsp;%d&nbsp;bytes,&nbsp;want&nbsp;0&#34;</span><span class="op" id="7172518">,</span>&nbsp;<span class="builtinfunc" id="7172520">len</span><span class="op" id="7172523">(</span><span class="ident" id="7172524">b</span><span class="op" id="7172525">)</span><span class="op" id="7172526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7172529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7172532">if</span>&nbsp;<span class="ident" id="7172535">err</span>&nbsp;<span class="op" id="7172539">:=</span>&nbsp;<span class="ident" id="7172542">r</span><span class="op" id="7172543">.</span><span class="ident" id="7172544">Close</span><span class="op" id="7172549">(</span><span class="op" id="7172550">)</span><span class="op" id="7172551">;</span>&nbsp;<span class="ident" id="7172553">err</span>&nbsp;<span class="op" id="7172557">!=</span>&nbsp;<span class="ident" id="7172560">nil</span>&nbsp;<span class="op" id="7172564">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172568">t</span><span class="op" id="7172569">.</span><span class="ident" id="7172570">Fatalf</span><span class="op" id="7172576">(</span><span class="string" id="7172577">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="7172595">,</span>&nbsp;<span class="ident" id="7172597">err</span><span class="op" id="7172600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7172603">}</span><br>
<span class="lineno"></span><span class="op" id="7172605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7172608">//&nbsp;TestRoundTrip&nbsp;tests&nbsp;that&nbsp;gzipping&nbsp;and&nbsp;then&nbsp;gunzipping&nbsp;is&nbsp;the&nbsp;identity</span><br>
<span class="lineno">40</span><span class="comment" id="7172681">//&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="7172694">func</span>&nbsp;<span class="ident" id="7172699">TestRoundTrip</span><span class="op" id="7172712">(</span><span class="ident" id="7172713">t</span>&nbsp;<span class="op" id="7172715">*</span><span class="ident" id="7172716">testing</span><span class="op" id="7172723">.</span><span class="ident" id="7172724">T</span><span class="op" id="7172725">)</span>&nbsp;<span class="op" id="7172727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172730">buf</span>&nbsp;<span class="op" id="7172734">:=</span>&nbsp;<span class="builtinfunc" id="7172737">new</span><span class="op" id="7172740">(</span><span class="ident" id="7172741">bytes</span><span class="op" id="7172746">.</span><span class="ident" id="7172747">Buffer</span><span class="op" id="7172753">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172757">w</span>&nbsp;<span class="op" id="7172759">:=</span>&nbsp;<span class="ident" id="7172762">NewWriter</span><span class="op" id="7172771">(</span><span class="ident" id="7172772">buf</span><span class="op" id="7172775">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172778">w</span><span class="op" id="7172779">.</span><span class="ident" id="7172780">Comment</span>&nbsp;<span class="op" id="7172788">=</span>&nbsp;<span class="string" id="7172790">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172801">w</span><span class="op" id="7172802">.</span><span class="ident" id="7172803">Extra</span>&nbsp;<span class="op" id="7172809">=</span>&nbsp;<span class="op" id="7172811">[</span><span class="op" id="7172812">]</span><span class="builtintype" id="7172813">byte</span><span class="op" id="7172817">(</span><span class="string" id="7172818">&#34;extra&#34;</span><span class="op" id="7172825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172828">w</span><span class="op" id="7172829">.</span><span class="ident" id="7172830">ModTime</span>&nbsp;<span class="op" id="7172838">=</span>&nbsp;<span class="ident" id="7172840">time</span><span class="op" id="7172844">.</span><span class="ident" id="7172845">Unix</span><span class="op" id="7172849">(</span><span class="num" id="7172850">1e8</span><span class="op" id="7172853">,</span>&nbsp;<span class="num" id="7172855">0</span><span class="op" id="7172856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172859">w</span><span class="op" id="7172860">.</span><span class="ident" id="7172861">Name</span>&nbsp;<span class="op" id="7172866">=</span>&nbsp;<span class="string" id="7172868">&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7172876">if</span>&nbsp;<span class="ident" id="7172879">_</span><span class="op" id="7172880">,</span>&nbsp;<span class="ident" id="7172882">err</span>&nbsp;<span class="op" id="7172886">:=</span>&nbsp;<span class="ident" id="7172889">w</span><span class="op" id="7172890">.</span><span class="ident" id="7172891">Write</span><span class="op" id="7172896">(</span><span class="op" id="7172897">[</span><span class="op" id="7172898">]</span><span class="builtintype" id="7172899">byte</span><span class="op" id="7172903">(</span><span class="string" id="7172904">&#34;payload&#34;</span><span class="op" id="7172913">)</span><span class="op" id="7172914">)</span><span class="op" id="7172915">;</span>&nbsp;<span class="ident" id="7172917">err</span>&nbsp;<span class="op" id="7172921">!=</span>&nbsp;<span class="ident" id="7172924">nil</span>&nbsp;<span class="op" id="7172928">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172932">t</span><span class="op" id="7172933">.</span><span class="ident" id="7172934">Fatalf</span><span class="op" id="7172940">(</span><span class="string" id="7172941">&#34;Write:&nbsp;%v&#34;</span><span class="op" id="7172952">,</span>&nbsp;<span class="ident" id="7172954">err</span><span class="op" id="7172957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7172960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7172963">if</span>&nbsp;<span class="ident" id="7172966">err</span>&nbsp;<span class="op" id="7172970">:=</span>&nbsp;<span class="ident" id="7172973">w</span><span class="op" id="7172974">.</span><span class="ident" id="7172975">Close</span><span class="op" id="7172980">(</span><span class="op" id="7172981">)</span><span class="op" id="7172982">;</span>&nbsp;<span class="ident" id="7172984">err</span>&nbsp;<span class="op" id="7172988">!=</span>&nbsp;<span class="ident" id="7172991">nil</span>&nbsp;<span class="op" id="7172995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7172999">t</span><span class="op" id="7173000">.</span><span class="ident" id="7173001">Fatalf</span><span class="op" id="7173007">(</span><span class="string" id="7173008">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="7173026">,</span>&nbsp;<span class="ident" id="7173028">err</span><span class="op" id="7173031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173034">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173038">r</span><span class="op" id="7173039">,</span>&nbsp;<span class="ident" id="7173041">err</span>&nbsp;<span class="op" id="7173045">:=</span>&nbsp;<span class="ident" id="7173048">NewReader</span><span class="op" id="7173057">(</span><span class="ident" id="7173058">buf</span><span class="op" id="7173061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173064">if</span>&nbsp;<span class="ident" id="7173067">err</span>&nbsp;<span class="op" id="7173071">!=</span>&nbsp;<span class="ident" id="7173074">nil</span>&nbsp;<span class="op" id="7173078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173082">t</span><span class="op" id="7173083">.</span><span class="ident" id="7173084">Fatalf</span><span class="op" id="7173090">(</span><span class="string" id="7173091">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7173106">,</span>&nbsp;<span class="ident" id="7173108">err</span><span class="op" id="7173111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173114">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173117">b</span><span class="op" id="7173118">,</span>&nbsp;<span class="ident" id="7173120">err</span>&nbsp;<span class="op" id="7173124">:=</span>&nbsp;<span class="ident" id="7173127">ioutil</span><span class="op" id="7173133">.</span><span class="ident" id="7173134">ReadAll</span><span class="op" id="7173141">(</span><span class="ident" id="7173142">r</span><span class="op" id="7173143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173146">if</span>&nbsp;<span class="ident" id="7173149">err</span>&nbsp;<span class="op" id="7173153">!=</span>&nbsp;<span class="ident" id="7173156">nil</span>&nbsp;<span class="op" id="7173160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173164">t</span><span class="op" id="7173165">.</span><span class="ident" id="7173166">Fatalf</span><span class="op" id="7173172">(</span><span class="string" id="7173173">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="7173186">,</span>&nbsp;<span class="ident" id="7173188">err</span><span class="op" id="7173191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173197">if</span>&nbsp;<span class="builtintype" id="7173200">string</span><span class="op" id="7173206">(</span><span class="ident" id="7173207">b</span><span class="op" id="7173208">)</span>&nbsp;<span class="op" id="7173210">!=</span>&nbsp;<span class="string" id="7173213">&#34;payload&#34;</span>&nbsp;<span class="op" id="7173223">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173227">t</span><span class="op" id="7173228">.</span><span class="ident" id="7173229">Fatalf</span><span class="op" id="7173235">(</span><span class="string" id="7173236">&#34;payload&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7173260">,</span>&nbsp;<span class="builtintype" id="7173262">string</span><span class="op" id="7173268">(</span><span class="ident" id="7173269">b</span><span class="op" id="7173270">)</span><span class="op" id="7173271">,</span>&nbsp;<span class="string" id="7173273">&#34;payload&#34;</span><span class="op" id="7173282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173288">if</span>&nbsp;<span class="ident" id="7173291">r</span><span class="op" id="7173292">.</span><span class="ident" id="7173293">Comment</span>&nbsp;<span class="op" id="7173301">!=</span>&nbsp;<span class="string" id="7173304">&#34;comment&#34;</span>&nbsp;<span class="op" id="7173314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173318">t</span><span class="op" id="7173319">.</span><span class="ident" id="7173320">Fatalf</span><span class="op" id="7173326">(</span><span class="string" id="7173327">&#34;comment&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7173351">,</span>&nbsp;<span class="ident" id="7173353">r</span><span class="op" id="7173354">.</span><span class="ident" id="7173355">Comment</span><span class="op" id="7173362">,</span>&nbsp;<span class="string" id="7173364">&#34;comment&#34;</span><span class="op" id="7173373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173376">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173379">if</span>&nbsp;<span class="builtintype" id="7173382">string</span><span class="op" id="7173388">(</span><span class="ident" id="7173389">r</span><span class="op" id="7173390">.</span><span class="ident" id="7173391">Extra</span><span class="op" id="7173396">)</span>&nbsp;<span class="op" id="7173398">!=</span>&nbsp;<span class="string" id="7173401">&#34;extra&#34;</span>&nbsp;<span class="op" id="7173409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173413">t</span><span class="op" id="7173414">.</span><span class="ident" id="7173415">Fatalf</span><span class="op" id="7173421">(</span><span class="string" id="7173422">&#34;extra&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7173444">,</span>&nbsp;<span class="ident" id="7173446">r</span><span class="op" id="7173447">.</span><span class="ident" id="7173448">Extra</span><span class="op" id="7173453">,</span>&nbsp;<span class="string" id="7173455">&#34;extra&#34;</span><span class="op" id="7173462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173468">if</span>&nbsp;<span class="ident" id="7173471">r</span><span class="op" id="7173472">.</span><span class="ident" id="7173473">ModTime</span><span class="op" id="7173480">.</span><span class="ident" id="7173481">Unix</span><span class="op" id="7173485">(</span><span class="op" id="7173486">)</span>&nbsp;<span class="op" id="7173488">!=</span>&nbsp;<span class="num" id="7173491">1e8</span>&nbsp;<span class="op" id="7173495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173499">t</span><span class="op" id="7173500">.</span><span class="ident" id="7173501">Fatalf</span><span class="op" id="7173507">(</span><span class="string" id="7173508">&#34;mtime&nbsp;is&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7173530">,</span>&nbsp;<span class="ident" id="7173532">r</span><span class="op" id="7173533">.</span><span class="ident" id="7173534">ModTime</span><span class="op" id="7173541">.</span><span class="ident" id="7173542">Unix</span><span class="op" id="7173546">(</span><span class="op" id="7173547">)</span><span class="op" id="7173548">,</span>&nbsp;<span class="builtintype" id="7173550">uint32</span><span class="op" id="7173556">(</span><span class="num" id="7173557">1e8</span><span class="op" id="7173560">)</span><span class="op" id="7173561">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173567">if</span>&nbsp;<span class="ident" id="7173570">r</span><span class="op" id="7173571">.</span><span class="ident" id="7173572">Name</span>&nbsp;<span class="op" id="7173577">!=</span>&nbsp;<span class="string" id="7173580">&#34;name&#34;</span>&nbsp;<span class="op" id="7173587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173591">t</span><span class="op" id="7173592">.</span><span class="ident" id="7173593">Fatalf</span><span class="op" id="7173599">(</span><span class="string" id="7173600">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7173621">,</span>&nbsp;<span class="ident" id="7173623">r</span><span class="op" id="7173624">.</span><span class="ident" id="7173625">Name</span><span class="op" id="7173629">,</span>&nbsp;<span class="string" id="7173631">&#34;name&#34;</span><span class="op" id="7173637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173643">if</span>&nbsp;<span class="ident" id="7173646">err</span>&nbsp;<span class="op" id="7173650">:=</span>&nbsp;<span class="ident" id="7173653">r</span><span class="op" id="7173654">.</span><span class="ident" id="7173655">Close</span><span class="op" id="7173660">(</span><span class="op" id="7173661">)</span><span class="op" id="7173662">;</span>&nbsp;<span class="ident" id="7173664">err</span>&nbsp;<span class="op" id="7173668">!=</span>&nbsp;<span class="ident" id="7173671">nil</span>&nbsp;<span class="op" id="7173675">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173679">t</span><span class="op" id="7173680">.</span><span class="ident" id="7173681">Fatalf</span><span class="op" id="7173687">(</span><span class="string" id="7173688">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="7173706">,</span>&nbsp;<span class="ident" id="7173708">err</span><span class="op" id="7173711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173714">}</span><br>
<span class="lineno"></span><span class="op" id="7173716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7173719">//&nbsp;TestLatin1&nbsp;tests&nbsp;the&nbsp;internal&nbsp;functions&nbsp;for&nbsp;converting&nbsp;to&nbsp;and&nbsp;from&nbsp;Latin-1.</span><br>
<span class="lineno">85</span><span class="keyword" id="7173798">func</span>&nbsp;<span class="ident" id="7173803">TestLatin1</span><span class="op" id="7173813">(</span><span class="ident" id="7173814">t</span>&nbsp;<span class="op" id="7173816">*</span><span class="ident" id="7173817">testing</span><span class="op" id="7173824">.</span><span class="ident" id="7173825">T</span><span class="op" id="7173826">)</span>&nbsp;<span class="op" id="7173828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173831">latin1</span>&nbsp;<span class="op" id="7173838">:=</span>&nbsp;<span class="op" id="7173841">[</span><span class="op" id="7173842">]</span><span class="builtintype" id="7173843">byte</span><span class="op" id="7173847">{</span><span class="num" id="7173848">0xc4</span><span class="op" id="7173852">,</span>&nbsp;<span class="string" id="7173854">&#39;u&#39;</span><span class="op" id="7173857">,</span>&nbsp;<span class="num" id="7173859">0xdf</span><span class="op" id="7173863">,</span>&nbsp;<span class="string" id="7173865">&#39;e&#39;</span><span class="op" id="7173868">,</span>&nbsp;<span class="string" id="7173870">&#39;r&#39;</span><span class="op" id="7173873">,</span>&nbsp;<span class="string" id="7173875">&#39;u&#39;</span><span class="op" id="7173878">,</span>&nbsp;<span class="string" id="7173880">&#39;n&#39;</span><span class="op" id="7173883">,</span>&nbsp;<span class="string" id="7173885">&#39;g&#39;</span><span class="op" id="7173888">,</span>&nbsp;<span class="num" id="7173890">0</span><span class="op" id="7173891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173894">utf8</span>&nbsp;<span class="op" id="7173899">:=</span>&nbsp;<span class="string" id="7173902">&#34;Äußerung&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173916">z</span>&nbsp;<span class="op" id="7173918">:=</span>&nbsp;<span class="ident" id="7173921">Reader</span><span class="op" id="7173927">{</span><span class="ident" id="7173928">r</span><span class="op" id="7173929">:</span>&nbsp;<span class="ident" id="7173931">bufio</span><span class="op" id="7173936">.</span><span class="ident" id="7173937">NewReader</span><span class="op" id="7173946">(</span><span class="ident" id="7173947">bytes</span><span class="op" id="7173952">.</span><span class="ident" id="7173953">NewReader</span><span class="op" id="7173962">(</span><span class="ident" id="7173963">latin1</span><span class="op" id="7173969">)</span><span class="op" id="7173970">)</span><span class="op" id="7173971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173974">s</span><span class="op" id="7173975">,</span>&nbsp;<span class="ident" id="7173977">err</span>&nbsp;<span class="op" id="7173981">:=</span>&nbsp;<span class="ident" id="7173984">z</span><span class="op" id="7173985">.</span><span class="ident" id="7173986">readString</span><span class="op" id="7173996">(</span><span class="op" id="7173997">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174000">if</span>&nbsp;<span class="ident" id="7174003">err</span>&nbsp;<span class="op" id="7174007">!=</span>&nbsp;<span class="ident" id="7174010">nil</span>&nbsp;<span class="op" id="7174014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174018">t</span><span class="op" id="7174019">.</span><span class="ident" id="7174020">Fatalf</span><span class="op" id="7174026">(</span><span class="string" id="7174027">&#34;readString:&nbsp;%v&#34;</span><span class="op" id="7174043">,</span>&nbsp;<span class="ident" id="7174045">err</span><span class="op" id="7174048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174054">if</span>&nbsp;<span class="ident" id="7174057">s</span>&nbsp;<span class="op" id="7174059">!=</span>&nbsp;<span class="ident" id="7174062">utf8</span>&nbsp;<span class="op" id="7174067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174071">t</span><span class="op" id="7174072">.</span><span class="ident" id="7174073">Fatalf</span><span class="op" id="7174079">(</span><span class="string" id="7174080">&#34;read&nbsp;latin-1:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7174111">,</span>&nbsp;<span class="ident" id="7174113">s</span><span class="op" id="7174114">,</span>&nbsp;<span class="ident" id="7174116">utf8</span><span class="op" id="7174120">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174127">buf</span>&nbsp;<span class="op" id="7174131">:=</span>&nbsp;<span class="ident" id="7174134">bytes</span><span class="op" id="7174139">.</span><span class="ident" id="7174140">NewBuffer</span><span class="op" id="7174149">(</span><span class="builtinfunc" id="7174150">make</span><span class="op" id="7174154">(</span><span class="op" id="7174155">[</span><span class="op" id="7174156">]</span><span class="builtintype" id="7174157">byte</span><span class="op" id="7174161">,</span>&nbsp;<span class="num" id="7174163">0</span><span class="op" id="7174164">,</span>&nbsp;<span class="builtinfunc" id="7174166">len</span><span class="op" id="7174169">(</span><span class="ident" id="7174170">latin1</span><span class="op" id="7174176">)</span><span class="op" id="7174177">)</span><span class="op" id="7174178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174181">c</span>&nbsp;<span class="op" id="7174183">:=</span>&nbsp;<span class="ident" id="7174186">Writer</span><span class="op" id="7174192">{</span><span class="ident" id="7174193">w</span><span class="op" id="7174194">:</span>&nbsp;<span class="ident" id="7174196">buf</span><span class="op" id="7174199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174202">if</span>&nbsp;<span class="ident" id="7174205">err</span>&nbsp;<span class="op" id="7174209">=</span>&nbsp;<span class="ident" id="7174211">c</span><span class="op" id="7174212">.</span><span class="ident" id="7174213">writeString</span><span class="op" id="7174224">(</span><span class="ident" id="7174225">utf8</span><span class="op" id="7174229">)</span><span class="op" id="7174230">;</span>&nbsp;<span class="ident" id="7174232">err</span>&nbsp;<span class="op" id="7174236">!=</span>&nbsp;<span class="ident" id="7174239">nil</span>&nbsp;<span class="op" id="7174243">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174247">t</span><span class="op" id="7174248">.</span><span class="ident" id="7174249">Fatalf</span><span class="op" id="7174255">(</span><span class="string" id="7174256">&#34;writeString:&nbsp;%v&#34;</span><span class="op" id="7174273">,</span>&nbsp;<span class="ident" id="7174275">err</span><span class="op" id="7174278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174284">s</span>&nbsp;<span class="op" id="7174286">=</span>&nbsp;<span class="ident" id="7174288">buf</span><span class="op" id="7174291">.</span><span class="ident" id="7174292">String</span><span class="op" id="7174298">(</span><span class="op" id="7174299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174302">if</span>&nbsp;<span class="ident" id="7174305">s</span>&nbsp;<span class="op" id="7174307">!=</span>&nbsp;<span class="builtintype" id="7174310">string</span><span class="op" id="7174316">(</span><span class="ident" id="7174317">latin1</span><span class="op" id="7174323">)</span>&nbsp;<span class="op" id="7174325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174329">t</span><span class="op" id="7174330">.</span><span class="ident" id="7174331">Fatalf</span><span class="op" id="7174337">(</span><span class="string" id="7174338">&#34;write&nbsp;utf-8:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7174368">,</span>&nbsp;<span class="ident" id="7174370">s</span><span class="op" id="7174371">,</span>&nbsp;<span class="builtintype" id="7174373">string</span><span class="op" id="7174379">(</span><span class="ident" id="7174380">latin1</span><span class="op" id="7174386">)</span><span class="op" id="7174387">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174390">}</span><br>
<span class="lineno"></span><span class="op" id="7174392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7174395">//&nbsp;TestLatin1RoundTrip&nbsp;tests&nbsp;that&nbsp;metadata&nbsp;that&nbsp;is&nbsp;representable&nbsp;in&nbsp;Latin-1</span><br>
<span class="lineno"></span><span class="comment" id="7174471">//&nbsp;survives&nbsp;a&nbsp;round&nbsp;trip.</span><br>
<span class="lineno">110</span><span class="keyword" id="7174497">func</span>&nbsp;<span class="ident" id="7174502">TestLatin1RoundTrip</span><span class="op" id="7174521">(</span><span class="ident" id="7174522">t</span>&nbsp;<span class="op" id="7174524">*</span><span class="ident" id="7174525">testing</span><span class="op" id="7174532">.</span><span class="ident" id="7174533">T</span><span class="op" id="7174534">)</span>&nbsp;<span class="op" id="7174536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174539">testCases</span>&nbsp;<span class="op" id="7174549">:=</span>&nbsp;<span class="op" id="7174552">[</span><span class="op" id="7174553">]</span><span class="keyword" id="7174554">struct</span>&nbsp;<span class="op" id="7174561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174565">name</span>&nbsp;<span class="builtintype" id="7174570">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174579">ok</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7174584">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174590">}</span><span class="op" id="7174591">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174595">{</span><span class="string" id="7174596">&#34;&#34;</span><span class="op" id="7174598">,</span>&nbsp;<span class="builtintype" id="7174600">true</span><span class="op" id="7174604">}</span><span class="op" id="7174605">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174609">{</span><span class="string" id="7174610">&#34;ASCII&nbsp;is&nbsp;OK&#34;</span><span class="op" id="7174623">,</span>&nbsp;<span class="builtintype" id="7174625">true</span><span class="op" id="7174629">}</span><span class="op" id="7174630">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174634">{</span><span class="string" id="7174635">&#34;unless&nbsp;it&nbsp;contains&nbsp;a&nbsp;NUL\x00&#34;</span><span class="op" id="7174665">,</span>&nbsp;<span class="builtintype" id="7174667">false</span><span class="op" id="7174672">}</span><span class="op" id="7174673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174677">{</span><span class="string" id="7174678">&#34;no&nbsp;matter&nbsp;where&nbsp;\x00&nbsp;occurs&#34;</span><span class="op" id="7174707">,</span>&nbsp;<span class="builtintype" id="7174709">false</span><span class="op" id="7174714">}</span><span class="op" id="7174715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174719">{</span><span class="string" id="7174720">&#34;\x00\x00\x00&#34;</span><span class="op" id="7174734">,</span>&nbsp;<span class="builtintype" id="7174736">false</span><span class="op" id="7174741">}</span><span class="op" id="7174742">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174746">{</span><span class="string" id="7174747">&#34;Látin-1&nbsp;also&nbsp;passes&nbsp;(U+00E1)&#34;</span><span class="op" id="7174778">,</span>&nbsp;<span class="builtintype" id="7174780">true</span><span class="op" id="7174784">}</span><span class="op" id="7174785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174789">{</span><span class="string" id="7174790">&#34;but&nbsp;LĀtin&nbsp;Extended-A&nbsp;(U+0100)&nbsp;does&nbsp;not&#34;</span><span class="op" id="7174831">,</span>&nbsp;<span class="builtintype" id="7174833">false</span><span class="op" id="7174838">}</span><span class="op" id="7174839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174843">{</span><span class="string" id="7174844">&#34;neither&nbsp;does&nbsp;日本語&#34;</span><span class="op" id="7174868">,</span>&nbsp;<span class="builtintype" id="7174870">false</span><span class="op" id="7174875">}</span><span class="op" id="7174876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174880">{</span><span class="string" id="7174881">&#34;invalid&nbsp;UTF-8&nbsp;also&nbsp;\xffails&#34;</span><span class="op" id="7174910">,</span>&nbsp;<span class="builtintype" id="7174912">false</span><span class="op" id="7174917">}</span><span class="op" id="7174918">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174922">{</span><span class="string" id="7174923">&#34;\x00&nbsp;as&nbsp;does&nbsp;Látin-1&nbsp;with&nbsp;NUL&#34;</span><span class="op" id="7174955">,</span>&nbsp;<span class="builtintype" id="7174957">false</span><span class="op" id="7174962">}</span><span class="op" id="7174963">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174969">for</span>&nbsp;<span class="ident" id="7174973">_</span><span class="op" id="7174974">,</span>&nbsp;<span class="ident" id="7174976">tc</span>&nbsp;<span class="op" id="7174979">:=</span>&nbsp;<span class="keyword" id="7174982">range</span>&nbsp;<span class="ident" id="7174988">testCases</span>&nbsp;<span class="op" id="7174998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175002">buf</span>&nbsp;<span class="op" id="7175006">:=</span>&nbsp;<span class="builtinfunc" id="7175009">new</span><span class="op" id="7175012">(</span><span class="ident" id="7175013">bytes</span><span class="op" id="7175018">.</span><span class="ident" id="7175019">Buffer</span><span class="op" id="7175025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175030">w</span>&nbsp;<span class="op" id="7175032">:=</span>&nbsp;<span class="ident" id="7175035">NewWriter</span><span class="op" id="7175044">(</span><span class="ident" id="7175045">buf</span><span class="op" id="7175048">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175052">w</span><span class="op" id="7175053">.</span><span class="ident" id="7175054">Name</span>&nbsp;<span class="op" id="7175059">=</span>&nbsp;<span class="ident" id="7175061">tc</span><span class="op" id="7175063">.</span><span class="ident" id="7175064">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175071">err</span>&nbsp;<span class="op" id="7175075">:=</span>&nbsp;<span class="ident" id="7175078">w</span><span class="op" id="7175079">.</span><span class="ident" id="7175080">Close</span><span class="op" id="7175085">(</span><span class="op" id="7175086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175090">if</span>&nbsp;<span class="op" id="7175093">(</span><span class="ident" id="7175094">err</span>&nbsp;<span class="op" id="7175098">==</span>&nbsp;<span class="ident" id="7175101">nil</span><span class="op" id="7175104">)</span>&nbsp;<span class="op" id="7175106">!=</span>&nbsp;<span class="ident" id="7175109">tc</span><span class="op" id="7175111">.</span><span class="ident" id="7175112">ok</span>&nbsp;<span class="op" id="7175115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175120">t</span><span class="op" id="7175121">.</span><span class="ident" id="7175122">Errorf</span><span class="op" id="7175128">(</span><span class="string" id="7175129">&#34;Writer.Close:&nbsp;name&nbsp;=&nbsp;%q,&nbsp;err&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7175164">,</span>&nbsp;<span class="ident" id="7175166">tc</span><span class="op" id="7175168">.</span><span class="ident" id="7175169">name</span><span class="op" id="7175173">,</span>&nbsp;<span class="ident" id="7175175">err</span><span class="op" id="7175178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175183">continue</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175198">if</span>&nbsp;<span class="op" id="7175201">!</span><span class="ident" id="7175202">tc</span><span class="op" id="7175204">.</span><span class="ident" id="7175205">ok</span>&nbsp;<span class="op" id="7175208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175213">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175229">r</span><span class="op" id="7175230">,</span>&nbsp;<span class="ident" id="7175232">err</span>&nbsp;<span class="op" id="7175236">:=</span>&nbsp;<span class="ident" id="7175239">NewReader</span><span class="op" id="7175248">(</span><span class="ident" id="7175249">buf</span><span class="op" id="7175252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175256">if</span>&nbsp;<span class="ident" id="7175259">err</span>&nbsp;<span class="op" id="7175263">!=</span>&nbsp;<span class="ident" id="7175266">nil</span>&nbsp;<span class="op" id="7175270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175275">t</span><span class="op" id="7175276">.</span><span class="ident" id="7175277">Errorf</span><span class="op" id="7175283">(</span><span class="string" id="7175284">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7175299">,</span>&nbsp;<span class="ident" id="7175301">err</span><span class="op" id="7175304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175309">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175320">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175324">_</span><span class="op" id="7175325">,</span>&nbsp;<span class="ident" id="7175327">err</span>&nbsp;<span class="op" id="7175331">=</span>&nbsp;<span class="ident" id="7175333">ioutil</span><span class="op" id="7175339">.</span><span class="ident" id="7175340">ReadAll</span><span class="op" id="7175347">(</span><span class="ident" id="7175348">r</span><span class="op" id="7175349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175353">if</span>&nbsp;<span class="ident" id="7175356">err</span>&nbsp;<span class="op" id="7175360">!=</span>&nbsp;<span class="ident" id="7175363">nil</span>&nbsp;<span class="op" id="7175367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175372">t</span><span class="op" id="7175373">.</span><span class="ident" id="7175374">Errorf</span><span class="op" id="7175380">(</span><span class="string" id="7175381">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="7175394">,</span>&nbsp;<span class="ident" id="7175396">err</span><span class="op" id="7175399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175404">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175415">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175419">if</span>&nbsp;<span class="ident" id="7175422">r</span><span class="op" id="7175423">.</span><span class="ident" id="7175424">Name</span>&nbsp;<span class="op" id="7175429">!=</span>&nbsp;<span class="ident" id="7175432">tc</span><span class="op" id="7175434">.</span><span class="ident" id="7175435">name</span>&nbsp;<span class="op" id="7175440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175445">t</span><span class="op" id="7175446">.</span><span class="ident" id="7175447">Errorf</span><span class="op" id="7175453">(</span><span class="string" id="7175454">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7175475">,</span>&nbsp;<span class="ident" id="7175477">r</span><span class="op" id="7175478">.</span><span class="ident" id="7175479">Name</span><span class="op" id="7175483">,</span>&nbsp;<span class="ident" id="7175485">tc</span><span class="op" id="7175487">.</span><span class="ident" id="7175488">name</span><span class="op" id="7175492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175497">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175512">if</span>&nbsp;<span class="ident" id="7175515">err</span>&nbsp;<span class="op" id="7175519">:=</span>&nbsp;<span class="ident" id="7175522">r</span><span class="op" id="7175523">.</span><span class="ident" id="7175524">Close</span><span class="op" id="7175529">(</span><span class="op" id="7175530">)</span><span class="op" id="7175531">;</span>&nbsp;<span class="ident" id="7175533">err</span>&nbsp;<span class="op" id="7175537">!=</span>&nbsp;<span class="ident" id="7175540">nil</span>&nbsp;<span class="op" id="7175544">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175549">t</span><span class="op" id="7175550">.</span><span class="ident" id="7175551">Errorf</span><span class="op" id="7175557">(</span><span class="string" id="7175558">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="7175576">,</span>&nbsp;<span class="ident" id="7175578">err</span><span class="op" id="7175581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175586">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175600">}</span><br>
<span class="lineno"></span><span class="op" id="7175602">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="7175605">func</span>&nbsp;<span class="ident" id="7175610">TestWriterFlush</span><span class="op" id="7175625">(</span><span class="ident" id="7175626">t</span>&nbsp;<span class="op" id="7175628">*</span><span class="ident" id="7175629">testing</span><span class="op" id="7175636">.</span><span class="ident" id="7175637">T</span><span class="op" id="7175638">)</span>&nbsp;<span class="op" id="7175640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175643">buf</span>&nbsp;<span class="op" id="7175647">:=</span>&nbsp;<span class="builtinfunc" id="7175650">new</span><span class="op" id="7175653">(</span><span class="ident" id="7175654">bytes</span><span class="op" id="7175659">.</span><span class="ident" id="7175660">Buffer</span><span class="op" id="7175666">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175670">w</span>&nbsp;<span class="op" id="7175672">:=</span>&nbsp;<span class="ident" id="7175675">NewWriter</span><span class="op" id="7175684">(</span><span class="ident" id="7175685">buf</span><span class="op" id="7175688">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175691">w</span><span class="op" id="7175692">.</span><span class="ident" id="7175693">Comment</span>&nbsp;<span class="op" id="7175701">=</span>&nbsp;<span class="string" id="7175703">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175714">w</span><span class="op" id="7175715">.</span><span class="ident" id="7175716">Extra</span>&nbsp;<span class="op" id="7175722">=</span>&nbsp;<span class="op" id="7175724">[</span><span class="op" id="7175725">]</span><span class="builtintype" id="7175726">byte</span><span class="op" id="7175730">(</span><span class="string" id="7175731">&#34;extra&#34;</span><span class="op" id="7175738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175741">w</span><span class="op" id="7175742">.</span><span class="ident" id="7175743">ModTime</span>&nbsp;<span class="op" id="7175751">=</span>&nbsp;<span class="ident" id="7175753">time</span><span class="op" id="7175757">.</span><span class="ident" id="7175758">Unix</span><span class="op" id="7175762">(</span><span class="num" id="7175763">1e8</span><span class="op" id="7175766">,</span>&nbsp;<span class="num" id="7175768">0</span><span class="op" id="7175769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175772">w</span><span class="op" id="7175773">.</span><span class="ident" id="7175774">Name</span>&nbsp;<span class="op" id="7175779">=</span>&nbsp;<span class="string" id="7175781">&#34;name&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175790">n0</span>&nbsp;<span class="op" id="7175793">:=</span>&nbsp;<span class="ident" id="7175796">buf</span><span class="op" id="7175799">.</span><span class="ident" id="7175800">Len</span><span class="op" id="7175803">(</span><span class="op" id="7175804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175807">if</span>&nbsp;<span class="ident" id="7175810">n0</span>&nbsp;<span class="op" id="7175813">!=</span>&nbsp;<span class="num" id="7175816">0</span>&nbsp;<span class="op" id="7175818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175822">t</span><span class="op" id="7175823">.</span><span class="ident" id="7175824">Fatalf</span><span class="op" id="7175830">(</span><span class="string" id="7175831">&#34;buffer&nbsp;size&nbsp;=&nbsp;%d&nbsp;before&nbsp;writes;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7175871">,</span>&nbsp;<span class="ident" id="7175873">n0</span><span class="op" id="7175875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175882">if</span>&nbsp;<span class="ident" id="7175885">err</span>&nbsp;<span class="op" id="7175889">:=</span>&nbsp;<span class="ident" id="7175892">w</span><span class="op" id="7175893">.</span><span class="ident" id="7175894">Flush</span><span class="op" id="7175899">(</span><span class="op" id="7175900">)</span><span class="op" id="7175901">;</span>&nbsp;<span class="ident" id="7175903">err</span>&nbsp;<span class="op" id="7175907">!=</span>&nbsp;<span class="ident" id="7175910">nil</span>&nbsp;<span class="op" id="7175914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175918">t</span><span class="op" id="7175919">.</span><span class="ident" id="7175920">Fatal</span><span class="op" id="7175925">(</span><span class="ident" id="7175926">err</span><span class="op" id="7175929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175936">n1</span>&nbsp;<span class="op" id="7175939">:=</span>&nbsp;<span class="ident" id="7175942">buf</span><span class="op" id="7175945">.</span><span class="ident" id="7175946">Len</span><span class="op" id="7175949">(</span><span class="op" id="7175950">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175953">if</span>&nbsp;<span class="ident" id="7175956">n1</span>&nbsp;<span class="op" id="7175959">==</span>&nbsp;<span class="num" id="7175962">0</span>&nbsp;<span class="op" id="7175964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175968">t</span><span class="op" id="7175969">.</span><span class="ident" id="7175970">Fatal</span><span class="op" id="7175975">(</span><span class="string" id="7175976">&#34;no&nbsp;data&nbsp;after&nbsp;first&nbsp;flush&#34;</span><span class="op" id="7176003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176010">w</span><span class="op" id="7176011">.</span><span class="ident" id="7176012">Write</span><span class="op" id="7176017">(</span><span class="op" id="7176018">[</span><span class="op" id="7176019">]</span><span class="builtintype" id="7176020">byte</span><span class="op" id="7176024">(</span><span class="string" id="7176025">&#34;x&#34;</span><span class="op" id="7176028">)</span><span class="op" id="7176029">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176033">n2</span>&nbsp;<span class="op" id="7176036">:=</span>&nbsp;<span class="ident" id="7176039">buf</span><span class="op" id="7176042">.</span><span class="ident" id="7176043">Len</span><span class="op" id="7176046">(</span><span class="op" id="7176047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176050">if</span>&nbsp;<span class="ident" id="7176053">n1</span>&nbsp;<span class="op" id="7176056">!=</span>&nbsp;<span class="ident" id="7176059">n2</span>&nbsp;<span class="op" id="7176062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176066">t</span><span class="op" id="7176067">.</span><span class="ident" id="7176068">Fatalf</span><span class="op" id="7176074">(</span><span class="string" id="7176075">&#34;after&nbsp;writing&nbsp;a&nbsp;single&nbsp;byte,&nbsp;size&nbsp;changed&nbsp;from&nbsp;%d&nbsp;to&nbsp;%d;&nbsp;want&nbsp;no&nbsp;change&#34;</span><span class="op" id="7176148">,</span>&nbsp;<span class="ident" id="7176150">n1</span><span class="op" id="7176152">,</span>&nbsp;<span class="ident" id="7176154">n2</span><span class="op" id="7176156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176159">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176163">if</span>&nbsp;<span class="ident" id="7176166">err</span>&nbsp;<span class="op" id="7176170">:=</span>&nbsp;<span class="ident" id="7176173">w</span><span class="op" id="7176174">.</span><span class="ident" id="7176175">Flush</span><span class="op" id="7176180">(</span><span class="op" id="7176181">)</span><span class="op" id="7176182">;</span>&nbsp;<span class="ident" id="7176184">err</span>&nbsp;<span class="op" id="7176188">!=</span>&nbsp;<span class="ident" id="7176191">nil</span>&nbsp;<span class="op" id="7176195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176199">t</span><span class="op" id="7176200">.</span><span class="ident" id="7176201">Fatal</span><span class="op" id="7176206">(</span><span class="ident" id="7176207">err</span><span class="op" id="7176210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176217">n3</span>&nbsp;<span class="op" id="7176220">:=</span>&nbsp;<span class="ident" id="7176223">buf</span><span class="op" id="7176226">.</span><span class="ident" id="7176227">Len</span><span class="op" id="7176230">(</span><span class="op" id="7176231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176234">if</span>&nbsp;<span class="ident" id="7176237">n2</span>&nbsp;<span class="op" id="7176240">==</span>&nbsp;<span class="ident" id="7176243">n3</span>&nbsp;<span class="op" id="7176246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176250">t</span><span class="op" id="7176251">.</span><span class="ident" id="7176252">Fatal</span><span class="op" id="7176257">(</span><span class="string" id="7176258">&#34;Flush&nbsp;didn&#39;t&nbsp;flush&nbsp;any&nbsp;data&#34;</span><span class="op" id="7176287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176290">}</span><br>
<span class="lineno"></span><span class="op" id="7176292">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="7176295">//&nbsp;Multiple&nbsp;gzip&nbsp;files&nbsp;concatenated&nbsp;form&nbsp;a&nbsp;valid&nbsp;gzip&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="7176355">func</span>&nbsp;<span class="ident" id="7176360">TestConcat</span><span class="op" id="7176370">(</span><span class="ident" id="7176371">t</span>&nbsp;<span class="op" id="7176373">*</span><span class="ident" id="7176374">testing</span><span class="op" id="7176381">.</span><span class="ident" id="7176382">T</span><span class="op" id="7176383">)</span>&nbsp;<span class="op" id="7176385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176388">var</span>&nbsp;<span class="ident" id="7176392">buf</span>&nbsp;<span class="ident" id="7176396">bytes</span><span class="op" id="7176401">.</span><span class="ident" id="7176402">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176410">w</span>&nbsp;<span class="op" id="7176412">:=</span>&nbsp;<span class="ident" id="7176415">NewWriter</span><span class="op" id="7176424">(</span><span class="op" id="7176425">&amp;</span><span class="ident" id="7176426">buf</span><span class="op" id="7176429">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176432">w</span><span class="op" id="7176433">.</span><span class="ident" id="7176434">Write</span><span class="op" id="7176439">(</span><span class="op" id="7176440">[</span><span class="op" id="7176441">]</span><span class="builtintype" id="7176442">byte</span><span class="op" id="7176446">(</span><span class="string" id="7176447">&#34;hello&nbsp;&#34;</span><span class="op" id="7176455">)</span><span class="op" id="7176456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176459">w</span><span class="op" id="7176460">.</span><span class="ident" id="7176461">Close</span><span class="op" id="7176466">(</span><span class="op" id="7176467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176470">w</span>&nbsp;<span class="op" id="7176472">=</span>&nbsp;<span class="ident" id="7176474">NewWriter</span><span class="op" id="7176483">(</span><span class="op" id="7176484">&amp;</span><span class="ident" id="7176485">buf</span><span class="op" id="7176488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176491">w</span><span class="op" id="7176492">.</span><span class="ident" id="7176493">Write</span><span class="op" id="7176498">(</span><span class="op" id="7176499">[</span><span class="op" id="7176500">]</span><span class="builtintype" id="7176501">byte</span><span class="op" id="7176505">(</span><span class="string" id="7176506">&#34;world\n&#34;</span><span class="op" id="7176515">)</span><span class="op" id="7176516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176519">w</span><span class="op" id="7176520">.</span><span class="ident" id="7176521">Close</span><span class="op" id="7176526">(</span><span class="op" id="7176527">)</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176531">r</span><span class="op" id="7176532">,</span>&nbsp;<span class="ident" id="7176534">err</span>&nbsp;<span class="op" id="7176538">:=</span>&nbsp;<span class="ident" id="7176541">NewReader</span><span class="op" id="7176550">(</span><span class="op" id="7176551">&amp;</span><span class="ident" id="7176552">buf</span><span class="op" id="7176555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176558">data</span><span class="op" id="7176562">,</span>&nbsp;<span class="ident" id="7176564">err</span>&nbsp;<span class="op" id="7176568">:=</span>&nbsp;<span class="ident" id="7176571">ioutil</span><span class="op" id="7176577">.</span><span class="ident" id="7176578">ReadAll</span><span class="op" id="7176585">(</span><span class="ident" id="7176586">r</span><span class="op" id="7176587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176590">if</span>&nbsp;<span class="builtintype" id="7176593">string</span><span class="op" id="7176599">(</span><span class="ident" id="7176600">data</span><span class="op" id="7176604">)</span>&nbsp;<span class="op" id="7176606">!=</span>&nbsp;<span class="string" id="7176609">&#34;hello&nbsp;world\n&#34;</span>&nbsp;<span class="op" id="7176625">||</span>&nbsp;<span class="ident" id="7176628">err</span>&nbsp;<span class="op" id="7176632">!=</span>&nbsp;<span class="ident" id="7176635">nil</span>&nbsp;<span class="op" id="7176639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176643">t</span><span class="op" id="7176644">.</span><span class="ident" id="7176645">Fatalf</span><span class="op" id="7176651">(</span><span class="string" id="7176652">&#34;ReadAll&nbsp;=&nbsp;%q,&nbsp;%v,&nbsp;want&nbsp;%q,&nbsp;nil&#34;</span><span class="op" id="7176684">,</span>&nbsp;<span class="ident" id="7176686">data</span><span class="op" id="7176690">,</span>&nbsp;<span class="ident" id="7176692">err</span><span class="op" id="7176695">,</span>&nbsp;<span class="string" id="7176697">&#34;hello&nbsp;world&#34;</span><span class="op" id="7176710">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176713">}</span><br>
<span class="lineno"></span><span class="op" id="7176715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7176718">func</span>&nbsp;<span class="ident" id="7176723">TestWriterReset</span><span class="op" id="7176738">(</span><span class="ident" id="7176739">t</span>&nbsp;<span class="op" id="7176741">*</span><span class="ident" id="7176742">testing</span><span class="op" id="7176749">.</span><span class="ident" id="7176750">T</span><span class="op" id="7176751">)</span>&nbsp;<span class="op" id="7176753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176756">buf</span>&nbsp;<span class="op" id="7176760">:=</span>&nbsp;<span class="builtinfunc" id="7176763">new</span><span class="op" id="7176766">(</span><span class="ident" id="7176767">bytes</span><span class="op" id="7176772">.</span><span class="ident" id="7176773">Buffer</span><span class="op" id="7176779">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176782">buf2</span>&nbsp;<span class="op" id="7176787">:=</span>&nbsp;<span class="builtinfunc" id="7176790">new</span><span class="op" id="7176793">(</span><span class="ident" id="7176794">bytes</span><span class="op" id="7176799">.</span><span class="ident" id="7176800">Buffer</span><span class="op" id="7176806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176809">z</span>&nbsp;<span class="op" id="7176811">:=</span>&nbsp;<span class="ident" id="7176814">NewWriter</span><span class="op" id="7176823">(</span><span class="ident" id="7176824">buf</span><span class="op" id="7176827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176830">msg</span>&nbsp;<span class="op" id="7176834">:=</span>&nbsp;<span class="op" id="7176837">[</span><span class="op" id="7176838">]</span><span class="builtintype" id="7176839">byte</span><span class="op" id="7176843">(</span><span class="string" id="7176844">&#34;hello&nbsp;world&#34;</span><span class="op" id="7176857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176860">z</span><span class="op" id="7176861">.</span><span class="ident" id="7176862">Write</span><span class="op" id="7176867">(</span><span class="ident" id="7176868">msg</span><span class="op" id="7176871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176874">z</span><span class="op" id="7176875">.</span><span class="ident" id="7176876">Close</span><span class="op" id="7176881">(</span><span class="op" id="7176882">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176885">z</span><span class="op" id="7176886">.</span><span class="ident" id="7176887">Reset</span><span class="op" id="7176892">(</span><span class="ident" id="7176893">buf2</span><span class="op" id="7176897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176900">z</span><span class="op" id="7176901">.</span><span class="ident" id="7176902">Write</span><span class="op" id="7176907">(</span><span class="ident" id="7176908">msg</span><span class="op" id="7176911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176914">z</span><span class="op" id="7176915">.</span><span class="ident" id="7176916">Close</span><span class="op" id="7176921">(</span><span class="op" id="7176922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176925">if</span>&nbsp;<span class="ident" id="7176928">buf</span><span class="op" id="7176931">.</span><span class="ident" id="7176932">String</span><span class="op" id="7176938">(</span><span class="op" id="7176939">)</span>&nbsp;<span class="op" id="7176941">!=</span>&nbsp;<span class="ident" id="7176944">buf2</span><span class="op" id="7176948">.</span><span class="ident" id="7176949">String</span><span class="op" id="7176955">(</span><span class="op" id="7176956">)</span>&nbsp;<span class="op" id="7176958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176962">t</span><span class="op" id="7176963">.</span><span class="ident" id="7176964">Errorf</span><span class="op" id="7176970">(</span><span class="string" id="7176971">&#34;buf2&nbsp;%q&nbsp;!=&nbsp;original&nbsp;buf&nbsp;of&nbsp;%q&#34;</span><span class="op" id="7177002">,</span>&nbsp;<span class="ident" id="7177004">buf2</span><span class="op" id="7177008">.</span><span class="ident" id="7177009">String</span><span class="op" id="7177015">(</span><span class="op" id="7177016">)</span><span class="op" id="7177017">,</span>&nbsp;<span class="ident" id="7177019">buf</span><span class="op" id="7177022">.</span><span class="ident" id="7177023">String</span><span class="op" id="7177029">(</span><span class="op" id="7177030">)</span><span class="op" id="7177031">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177034">}</span><br>
<span class="lineno"></span><span class="op" id="7177036">}</span>
</div>
</body>
</html>
