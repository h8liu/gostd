<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/dasm8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/dasm8/dasm.go.html">dasm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/dasm8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/dasm8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/dasm8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/dasm8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/dasm8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/dasm8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/dasm8/line.go.html">line.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/dasm8/reg.go.html">reg.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="3694654">package</span>&nbsp;<span class="ident" id="3694662">dasm8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3694669">import</span>&nbsp;<span class="op" id="3694676">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3694679">&#34;fmt&#34;</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3694687">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span><span class="op" id="3694705">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3694708">//&nbsp;Dasm&nbsp;disassembles&nbsp;a&nbsp;byte&nbsp;block.</span><br>
<span class="lineno">10</span><span class="keyword" id="3694743">func</span>&nbsp;<span class="ident" id="3694748">Dasm</span><span class="op" id="3694752">(</span><span class="ident" id="3694753">bs</span>&nbsp;<span class="op" id="3694756">[</span><span class="op" id="3694757">]</span><span class="builtintype" id="3694758">byte</span><span class="op" id="3694762">,</span>&nbsp;<span class="ident" id="3694764">addr</span>&nbsp;<span class="builtintype" id="3694769">uint32</span><span class="op" id="3694775">)</span>&nbsp;<span class="op" id="3694777">[</span><span class="op" id="3694778">]</span><span class="op" id="3694779">*</span><span class="ident" id="3694780">Line</span>&nbsp;<span class="op" id="3694785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3694788">var</span>&nbsp;<span class="ident" id="3694792">ret</span>&nbsp;<span class="op" id="3694796">[</span><span class="op" id="3694797">]</span><span class="op" id="3694798">*</span><span class="ident" id="3694799">Line</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3694806">base</span>&nbsp;<span class="op" id="3694811">:=</span>&nbsp;<span class="ident" id="3694814">addr</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3694821">add</span>&nbsp;<span class="op" id="3694825">:=</span>&nbsp;<span class="keyword" id="3694828">func</span><span class="op" id="3694832">(</span><span class="ident" id="3694833">b</span>&nbsp;<span class="op" id="3694835">[</span><span class="op" id="3694836">]</span><span class="builtintype" id="3694837">byte</span><span class="op" id="3694841">)</span>&nbsp;<span class="op" id="3694843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3694847">inst</span>&nbsp;<span class="op" id="3694852">:=</span>&nbsp;<span class="ident" id="3694855">binary</span><span class="op" id="3694861">.</span><span class="ident" id="3694862">LittleEndian</span><span class="op" id="3694874">.</span><span class="ident" id="3694875">Uint32</span><span class="op" id="3694881">(</span><span class="ident" id="3694882">b</span><span class="op" id="3694883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3694887">ret</span>&nbsp;<span class="op" id="3694891">=</span>&nbsp;<span class="builtinfunc" id="3694893">append</span><span class="op" id="3694899">(</span><span class="ident" id="3694900">ret</span><span class="op" id="3694903">,</span>&nbsp;<span class="ident" id="3694905">NewLine</span><span class="op" id="3694912">(</span><span class="ident" id="3694913">addr</span><span class="op" id="3694917">,</span>&nbsp;<span class="ident" id="3694919">inst</span><span class="op" id="3694923">)</span><span class="op" id="3694924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3694928">addr</span>&nbsp;<span class="op" id="3694933">+=</span>&nbsp;<span class="num" id="3694936">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3694939">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3694943">nline</span>&nbsp;<span class="op" id="3694949">:=</span>&nbsp;<span class="builtinfunc" id="3694952">len</span><span class="op" id="3694955">(</span><span class="ident" id="3694956">bs</span><span class="op" id="3694958">)</span>&nbsp;<span class="op" id="3694960">/</span>&nbsp;<span class="num" id="3694962">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3694965">for</span>&nbsp;<span class="ident" id="3694969">i</span>&nbsp;<span class="op" id="3694971">:=</span>&nbsp;<span class="num" id="3694974">0</span><span class="op" id="3694975">;</span>&nbsp;<span class="ident" id="3694977">i</span>&nbsp;<span class="op" id="3694979">&lt;</span>&nbsp;<span class="ident" id="3694981">nline</span><span class="op" id="3694986">;</span>&nbsp;<span class="ident" id="3694988">i</span><span class="op" id="3694989">++</span>&nbsp;<span class="op" id="3694992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3694996">off</span>&nbsp;<span class="op" id="3695000">:=</span>&nbsp;<span class="ident" id="3695003">i</span>&nbsp;<span class="op" id="3695005">*</span>&nbsp;<span class="num" id="3695007">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695011">add</span><span class="op" id="3695014">(</span><span class="ident" id="3695015">bs</span><span class="op" id="3695017">[</span><span class="ident" id="3695018">off</span>&nbsp;<span class="op" id="3695022">:</span>&nbsp;<span class="ident" id="3695024">off</span><span class="op" id="3695027">+</span><span class="num" id="3695028">4</span><span class="op" id="3695029">]</span><span class="op" id="3695030">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3695033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3695037">//&nbsp;residue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695049">if</span>&nbsp;<span class="builtinfunc" id="3695052">len</span><span class="op" id="3695055">(</span><span class="ident" id="3695056">bs</span><span class="op" id="3695058">)</span><span class="op" id="3695059">%</span><span class="num" id="3695060">4</span>&nbsp;<span class="op" id="3695062">!=</span>&nbsp;<span class="num" id="3695065">0</span>&nbsp;<span class="op" id="3695067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695071">var</span>&nbsp;<span class="ident" id="3695075">buf</span>&nbsp;<span class="op" id="3695079">[</span><span class="num" id="3695080">4</span><span class="op" id="3695081">]</span><span class="builtintype" id="3695082">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3695089">copy</span><span class="op" id="3695093">(</span><span class="ident" id="3695094">buf</span><span class="op" id="3695097">[</span><span class="op" id="3695098">:</span><span class="op" id="3695099">]</span><span class="op" id="3695100">,</span>&nbsp;<span class="ident" id="3695102">bs</span><span class="op" id="3695104">[</span><span class="ident" id="3695105">nline</span><span class="op" id="3695110">*</span><span class="num" id="3695111">4</span><span class="op" id="3695112">:</span><span class="op" id="3695113">]</span><span class="op" id="3695114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695118">add</span><span class="op" id="3695121">(</span><span class="ident" id="3695122">buf</span><span class="op" id="3695125">[</span><span class="op" id="3695126">:</span><span class="op" id="3695127">]</span><span class="op" id="3695128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3695131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3695135">//&nbsp;link&nbsp;the&nbsp;jumps</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695154">for</span>&nbsp;<span class="ident" id="3695158">_</span><span class="op" id="3695159">,</span>&nbsp;<span class="ident" id="3695161">line</span>&nbsp;<span class="op" id="3695166">:=</span>&nbsp;<span class="keyword" id="3695169">range</span>&nbsp;<span class="ident" id="3695175">ret</span>&nbsp;<span class="op" id="3695179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695183">if</span>&nbsp;<span class="op" id="3695186">!</span><span class="ident" id="3695187">line</span><span class="op" id="3695191">.</span><span class="ident" id="3695192">IsJump</span>&nbsp;<span class="op" id="3695199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695204">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3695215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695220">index</span>&nbsp;<span class="op" id="3695226">:=</span>&nbsp;<span class="builtintype" id="3695229">int</span><span class="op" id="3695232">(</span><span class="ident" id="3695233">line</span><span class="op" id="3695237">.</span><span class="ident" id="3695238">To</span><span class="op" id="3695240">-</span><span class="ident" id="3695241">base</span><span class="op" id="3695245">)</span>&nbsp;<span class="op" id="3695247">/</span>&nbsp;<span class="num" id="3695249">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695253">if</span>&nbsp;<span class="ident" id="3695256">index</span>&nbsp;<span class="op" id="3695262">&gt;=</span>&nbsp;<span class="num" id="3695265">0</span>&nbsp;<span class="op" id="3695267">&amp;&amp;</span>&nbsp;<span class="ident" id="3695270">index</span>&nbsp;<span class="op" id="3695276">&lt;</span>&nbsp;<span class="ident" id="3695278">nline</span>&nbsp;<span class="op" id="3695284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695289">line</span><span class="op" id="3695293">.</span><span class="ident" id="3695294">ToLine</span>&nbsp;<span class="op" id="3695301">=</span>&nbsp;<span class="ident" id="3695303">ret</span><span class="op" id="3695306">[</span><span class="ident" id="3695307">index</span><span class="op" id="3695312">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3695316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3695319">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695323">return</span>&nbsp;<span class="ident" id="3695330">ret</span><br>
<span class="lineno"></span><span class="op" id="3695334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3695337">//&nbsp;Print&nbsp;prints&nbsp;a&nbsp;byte&nbsp;block&nbsp;as&nbsp;assembly&nbsp;lines.</span><br>
<span class="lineno">50</span><span class="keyword" id="3695385">func</span>&nbsp;<span class="ident" id="3695390">Print</span><span class="op" id="3695395">(</span><span class="ident" id="3695396">bs</span>&nbsp;<span class="op" id="3695399">[</span><span class="op" id="3695400">]</span><span class="builtintype" id="3695401">byte</span><span class="op" id="3695405">,</span>&nbsp;<span class="ident" id="3695407">addr</span>&nbsp;<span class="builtintype" id="3695412">uint32</span><span class="op" id="3695418">)</span>&nbsp;<span class="op" id="3695420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695423">lines</span>&nbsp;<span class="op" id="3695429">:=</span>&nbsp;<span class="ident" id="3695432">Dasm</span><span class="op" id="3695436">(</span><span class="ident" id="3695437">bs</span><span class="op" id="3695439">,</span>&nbsp;<span class="ident" id="3695441">addr</span><span class="op" id="3695445">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3695449">for</span>&nbsp;<span class="ident" id="3695453">_</span><span class="op" id="3695454">,</span>&nbsp;<span class="ident" id="3695456">line</span>&nbsp;<span class="op" id="3695461">:=</span>&nbsp;<span class="keyword" id="3695464">range</span>&nbsp;<span class="ident" id="3695470">lines</span>&nbsp;<span class="op" id="3695476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3695480">fmt</span><span class="op" id="3695483">.</span><span class="ident" id="3695484">Println</span><span class="op" id="3695491">(</span><span class="ident" id="3695492">line</span><span class="op" id="3695496">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3695499">}</span><br>
<span class="lineno"></span><span class="op" id="3695501">}</span>
</div>
</body>
</html>
