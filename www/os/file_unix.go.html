<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2224138">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2224193">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2224247">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2224298">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2224368">package</span>&nbsp;<span class="ident" id="2224376">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2224380">import</span>&nbsp;<span class="op" id="2224387">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2224390">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2224401">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2224416">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2224426">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2224429">//&nbsp;File&nbsp;represents&nbsp;an&nbsp;open&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2224473">type</span>&nbsp;<span class="ident" id="2224478">File</span>&nbsp;<span class="keyword" id="2224483">struct</span>&nbsp;<span class="op" id="2224490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2224493">*</span><span class="ident" id="2224494">file</span><br>
<span class="lineno"></span><span class="op" id="2224499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2224502">//&nbsp;file&nbsp;is&nbsp;the&nbsp;real&nbsp;representation&nbsp;of&nbsp;*File.</span><br>
<span class="lineno"></span><span class="comment" id="2224547">//&nbsp;The&nbsp;extra&nbsp;level&nbsp;of&nbsp;indirection&nbsp;ensures&nbsp;that&nbsp;no&nbsp;clients&nbsp;of&nbsp;os</span><br>
<span class="lineno"></span><span class="comment" id="2224611">//&nbsp;can&nbsp;overwrite&nbsp;this&nbsp;data,&nbsp;which&nbsp;could&nbsp;cause&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="2224671">//&nbsp;to&nbsp;close&nbsp;the&nbsp;wrong&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2224710">type</span>&nbsp;<span class="ident" id="2224715">file</span>&nbsp;<span class="keyword" id="2224720">struct</span>&nbsp;<span class="op" id="2224727">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224730">fd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2224738">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224743">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2224751">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224759">dirinfo</span>&nbsp;<span class="op" id="2224767">*</span><span class="ident" id="2224768">dirInfo</span>&nbsp;<span class="comment" id="2224776">//&nbsp;nil&nbsp;unless&nbsp;directory&nbsp;being&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2224812">nepipe</span>&nbsp;&nbsp;<span class="builtintype" id="2224820">int32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2224829">//&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;EPIPE&nbsp;in&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="2224869">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2224872">//&nbsp;Fd&nbsp;returns&nbsp;the&nbsp;integer&nbsp;Unix&nbsp;file&nbsp;descriptor&nbsp;referencing&nbsp;the&nbsp;open&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2224946">//&nbsp;The&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;valid&nbsp;only&nbsp;until&nbsp;f.Close&nbsp;is&nbsp;called&nbsp;or&nbsp;f&nbsp;is&nbsp;garbage&nbsp;collected.</span><br>
<span class="lineno"></span><span class="keyword" id="2225034">func</span>&nbsp;<span class="op" id="2225039">(</span><span class="ident" id="2225040">f</span>&nbsp;<span class="op" id="2225042">*</span><span class="ident" id="2225043">File</span><span class="op" id="2225047">)</span>&nbsp;<span class="ident" id="2225049">Fd</span><span class="op" id="2225051">(</span><span class="op" id="2225052">)</span>&nbsp;<span class="builtintype" id="2225054">uintptr</span>&nbsp;<span class="op" id="2225062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225065">if</span>&nbsp;<span class="ident" id="2225068">f</span>&nbsp;<span class="op" id="2225070">==</span>&nbsp;<span class="ident" id="2225073">nil</span>&nbsp;<span class="op" id="2225077">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225081">return</span>&nbsp;<span class="op" id="2225088">^</span><span class="op" id="2225089">(</span><span class="builtintype" id="2225090">uintptr</span><span class="op" id="2225097">(</span><span class="num" id="2225098">0</span><span class="op" id="2225099">)</span><span class="op" id="2225100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2225103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225106">return</span>&nbsp;<span class="builtintype" id="2225113">uintptr</span><span class="op" id="2225120">(</span><span class="ident" id="2225121">f</span><span class="op" id="2225122">.</span><span class="ident" id="2225123">fd</span><span class="op" id="2225125">)</span><br>
<span class="lineno"></span><span class="op" id="2225127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2225130">//&nbsp;NewFile&nbsp;returns&nbsp;a&nbsp;new&nbsp;File&nbsp;with&nbsp;the&nbsp;given&nbsp;file&nbsp;descriptor&nbsp;and&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="2225201">func</span>&nbsp;<span class="ident" id="2225206">NewFile</span><span class="op" id="2225213">(</span><span class="ident" id="2225214">fd</span>&nbsp;<span class="builtintype" id="2225217">uintptr</span><span class="op" id="2225224">,</span>&nbsp;<span class="ident" id="2225226">name</span>&nbsp;<span class="builtintype" id="2225231">string</span><span class="op" id="2225237">)</span>&nbsp;<span class="op" id="2225239">*</span><span class="ident" id="2225240">File</span>&nbsp;<span class="op" id="2225245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225248">fdi</span>&nbsp;<span class="op" id="2225252">:=</span>&nbsp;<span class="builtintype" id="2225255">int</span><span class="op" id="2225258">(</span><span class="ident" id="2225259">fd</span><span class="op" id="2225261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225264">if</span>&nbsp;<span class="ident" id="2225267">fdi</span>&nbsp;<span class="op" id="2225271">&lt;</span>&nbsp;<span class="num" id="2225273">0</span>&nbsp;<span class="op" id="2225275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225279">return</span>&nbsp;<span class="ident" id="2225286">nil</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2225291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225294">f</span>&nbsp;<span class="op" id="2225296">:=</span>&nbsp;<span class="op" id="2225299">&amp;</span><span class="ident" id="2225300">File</span><span class="op" id="2225304">{</span><span class="op" id="2225305">&amp;</span><span class="ident" id="2225306">file</span><span class="op" id="2225310">{</span><span class="ident" id="2225311">fd</span><span class="op" id="2225313">:</span>&nbsp;<span class="ident" id="2225315">fdi</span><span class="op" id="2225318">,</span>&nbsp;<span class="ident" id="2225320">name</span><span class="op" id="2225324">:</span>&nbsp;<span class="ident" id="2225326">name</span><span class="op" id="2225330">}</span><span class="op" id="2225331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225334">runtime</span><span class="op" id="2225341">.</span><span class="ident" id="2225342">SetFinalizer</span><span class="op" id="2225354">(</span><span class="ident" id="2225355">f</span><span class="op" id="2225356">.</span><span class="ident" id="2225357">file</span><span class="op" id="2225361">,</span>&nbsp;<span class="op" id="2225363">(</span><span class="op" id="2225364">*</span><span class="ident" id="2225365">file</span><span class="op" id="2225369">)</span><span class="op" id="2225370">.</span><span class="builtinfunc" id="2225371">close</span><span class="op" id="2225376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225379">return</span>&nbsp;<span class="ident" id="2225386">f</span><br>
<span class="lineno"></span><span class="op" id="2225388">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="2225391">//&nbsp;Auxiliary&nbsp;information&nbsp;if&nbsp;the&nbsp;File&nbsp;describes&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="keyword" id="2225450">type</span>&nbsp;<span class="ident" id="2225455">dirInfo</span>&nbsp;<span class="keyword" id="2225463">struct</span>&nbsp;<span class="op" id="2225470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225473">buf</span>&nbsp;&nbsp;<span class="op" id="2225478">[</span><span class="op" id="2225479">]</span><span class="builtintype" id="2225480">byte</span>&nbsp;<span class="comment" id="2225485">//&nbsp;buffer&nbsp;for&nbsp;directory&nbsp;I/O</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225514">nbuf</span>&nbsp;<span class="builtintype" id="2225519">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2225526">//&nbsp;length&nbsp;of&nbsp;buf;&nbsp;return&nbsp;value&nbsp;from&nbsp;Getdirentries</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225577">bufp</span>&nbsp;<span class="builtintype" id="2225582">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2225589">//&nbsp;location&nbsp;of&nbsp;next&nbsp;record&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span><span class="op" id="2225624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2225627">func</span>&nbsp;<span class="ident" id="2225632">epipecheck</span><span class="op" id="2225642">(</span><span class="ident" id="2225643">file</span>&nbsp;<span class="op" id="2225648">*</span><span class="ident" id="2225649">File</span><span class="op" id="2225653">,</span>&nbsp;<span class="ident" id="2225655">e</span>&nbsp;<span class="builtintype" id="2225657">error</span><span class="op" id="2225662">)</span>&nbsp;<span class="op" id="2225664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225667">if</span>&nbsp;<span class="ident" id="2225670">e</span>&nbsp;<span class="op" id="2225672">==</span>&nbsp;<span class="ident" id="2225675">syscall</span><span class="op" id="2225682">.</span><span class="ident" id="2225683">EPIPE</span>&nbsp;<span class="op" id="2225689">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2225693">if</span>&nbsp;<span class="ident" id="2225696">atomic</span><span class="op" id="2225702">.</span><span class="ident" id="2225703">AddInt32</span><span class="op" id="2225711">(</span><span class="op" id="2225712">&amp;</span><span class="ident" id="2225713">file</span><span class="op" id="2225717">.</span><span class="ident" id="2225718">nepipe</span><span class="op" id="2225724">,</span>&nbsp;<span class="num" id="2225726">1</span><span class="op" id="2225727">)</span>&nbsp;<span class="op" id="2225729">&gt;=</span>&nbsp;<span class="num" id="2225732">10</span>&nbsp;<span class="op" id="2225735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225740">sigpipe</span><span class="op" id="2225747">(</span><span class="op" id="2225748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2225752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2225755">}</span>&nbsp;<span class="keyword" id="2225757">else</span>&nbsp;<span class="op" id="2225762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2225766">atomic</span><span class="op" id="2225772">.</span><span class="ident" id="2225773">StoreInt32</span><span class="op" id="2225783">(</span><span class="op" id="2225784">&amp;</span><span class="ident" id="2225785">file</span><span class="op" id="2225789">.</span><span class="ident" id="2225790">nepipe</span><span class="op" id="2225796">,</span>&nbsp;<span class="num" id="2225798">0</span><span class="op" id="2225799">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2225802">}</span><br>
<span class="lineno"></span><span class="op" id="2225804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2225807">//&nbsp;DevNull&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;operating&nbsp;system&#39;s&nbsp;``null&nbsp;device.&#39;&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2225873">//&nbsp;On&nbsp;Unix-like&nbsp;systems,&nbsp;it&nbsp;is&nbsp;&#34;/dev/null&#34;;&nbsp;on&nbsp;Windows,&nbsp;&#34;NUL&#34;.</span><br>
<span class="lineno">70</span><span class="keyword" id="2225936">const</span>&nbsp;<span class="ident" id="2225942">DevNull</span>&nbsp;<span class="op" id="2225950">=</span>&nbsp;<span class="string" id="2225952">&#34;/dev/null&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2225965">//&nbsp;OpenFile&nbsp;is&nbsp;the&nbsp;generalized&nbsp;open&nbsp;call;&nbsp;most&nbsp;users&nbsp;will&nbsp;use&nbsp;Open</span><br>
<span class="lineno"></span><span class="comment" id="2226032">//&nbsp;or&nbsp;Create&nbsp;instead.&nbsp;&nbsp;It&nbsp;opens&nbsp;the&nbsp;named&nbsp;file&nbsp;with&nbsp;specified&nbsp;flag</span><br>
<span class="lineno"></span><span class="comment" id="2226099">//&nbsp;(O_RDONLY&nbsp;etc.)&nbsp;and&nbsp;perm,&nbsp;(0666&nbsp;etc.)&nbsp;if&nbsp;applicable.&nbsp;&nbsp;If&nbsp;successful,</span><br>
<span class="lineno">75</span><span class="comment" id="2226171">//&nbsp;methods&nbsp;on&nbsp;the&nbsp;returned&nbsp;File&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2226224">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2226280">func</span>&nbsp;<span class="ident" id="2226285">OpenFile</span><span class="op" id="2226293">(</span><span class="ident" id="2226294">name</span>&nbsp;<span class="builtintype" id="2226299">string</span><span class="op" id="2226305">,</span>&nbsp;<span class="ident" id="2226307">flag</span>&nbsp;<span class="builtintype" id="2226312">int</span><span class="op" id="2226315">,</span>&nbsp;<span class="ident" id="2226317">perm</span>&nbsp;<span class="ident" id="2226322">FileMode</span><span class="op" id="2226330">)</span>&nbsp;<span class="op" id="2226332">(</span><span class="ident" id="2226333">file</span>&nbsp;<span class="op" id="2226338">*</span><span class="ident" id="2226339">File</span><span class="op" id="2226343">,</span>&nbsp;<span class="ident" id="2226345">err</span>&nbsp;<span class="builtintype" id="2226349">error</span><span class="op" id="2226354">)</span>&nbsp;<span class="op" id="2226356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226359">r</span><span class="op" id="2226360">,</span>&nbsp;<span class="ident" id="2226362">e</span>&nbsp;<span class="op" id="2226364">:=</span>&nbsp;<span class="ident" id="2226367">syscall</span><span class="op" id="2226374">.</span><span class="ident" id="2226375">Open</span><span class="op" id="2226379">(</span><span class="ident" id="2226380">name</span><span class="op" id="2226384">,</span>&nbsp;<span class="ident" id="2226386">flag</span><span class="op" id="2226390">|</span><span class="ident" id="2226391">syscall</span><span class="op" id="2226398">.</span><span class="ident" id="2226399">O_CLOEXEC</span><span class="op" id="2226408">,</span>&nbsp;<span class="ident" id="2226410">syscallMode</span><span class="op" id="2226421">(</span><span class="ident" id="2226422">perm</span><span class="op" id="2226426">)</span><span class="op" id="2226427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226430">if</span>&nbsp;<span class="ident" id="2226433">e</span>&nbsp;<span class="op" id="2226435">!=</span>&nbsp;<span class="ident" id="2226438">nil</span>&nbsp;<span class="op" id="2226442">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226446">return</span>&nbsp;<span class="ident" id="2226453">nil</span><span class="op" id="2226456">,</span>&nbsp;<span class="op" id="2226458">&amp;</span><span class="ident" id="2226459">PathError</span><span class="op" id="2226468">{</span><span class="string" id="2226469">&#34;open&#34;</span><span class="op" id="2226475">,</span>&nbsp;<span class="ident" id="2226477">name</span><span class="op" id="2226481">,</span>&nbsp;<span class="ident" id="2226483">e</span><span class="op" id="2226484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2226491">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here&nbsp;with&nbsp;fork/exec,&nbsp;which&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2226544">//&nbsp;content&nbsp;to&nbsp;live&nbsp;with.&nbsp;&nbsp;See&nbsp;../syscall/exec_unix.go.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226600">if</span>&nbsp;<span class="op" id="2226603">!</span><span class="ident" id="2226604">supportsCloseOnExec</span>&nbsp;<span class="op" id="2226624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2226628">syscall</span><span class="op" id="2226635">.</span><span class="ident" id="2226636">CloseOnExec</span><span class="op" id="2226647">(</span><span class="ident" id="2226648">r</span><span class="op" id="2226649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226656">return</span>&nbsp;<span class="ident" id="2226663">NewFile</span><span class="op" id="2226670">(</span><span class="builtintype" id="2226671">uintptr</span><span class="op" id="2226678">(</span><span class="ident" id="2226679">r</span><span class="op" id="2226680">)</span><span class="op" id="2226681">,</span>&nbsp;<span class="ident" id="2226683">name</span><span class="op" id="2226687">)</span><span class="op" id="2226688">,</span>&nbsp;<span class="ident" id="2226690">nil</span><br>
<span class="lineno">90</span><span class="op" id="2226694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2226697">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;File,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2226754">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2226786">func</span>&nbsp;<span class="op" id="2226791">(</span><span class="ident" id="2226792">f</span>&nbsp;<span class="op" id="2226794">*</span><span class="ident" id="2226795">File</span><span class="op" id="2226799">)</span>&nbsp;<span class="ident" id="2226801">Close</span><span class="op" id="2226806">(</span><span class="op" id="2226807">)</span>&nbsp;<span class="builtintype" id="2226809">error</span>&nbsp;<span class="op" id="2226815">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226818">if</span>&nbsp;<span class="ident" id="2226821">f</span>&nbsp;<span class="op" id="2226823">==</span>&nbsp;<span class="ident" id="2226826">nil</span>&nbsp;<span class="op" id="2226830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226834">return</span>&nbsp;<span class="ident" id="2226841">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226856">return</span>&nbsp;<span class="ident" id="2226863">f</span><span class="op" id="2226864">.</span><span class="ident" id="2226865">file</span><span class="op" id="2226869">.</span><span class="builtinfunc" id="2226870">close</span><span class="op" id="2226875">(</span><span class="op" id="2226876">)</span><br>
<span class="lineno"></span><span class="op" id="2226878">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2226881">func</span>&nbsp;<span class="op" id="2226886">(</span><span class="ident" id="2226887">file</span>&nbsp;<span class="op" id="2226892">*</span><span class="ident" id="2226893">file</span><span class="op" id="2226897">)</span>&nbsp;<span class="builtinfunc" id="2226899">close</span><span class="op" id="2226904">(</span><span class="op" id="2226905">)</span>&nbsp;<span class="builtintype" id="2226907">error</span>&nbsp;<span class="op" id="2226913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226916">if</span>&nbsp;<span class="ident" id="2226919">file</span>&nbsp;<span class="op" id="2226924">==</span>&nbsp;<span class="ident" id="2226927">nil</span>&nbsp;<span class="op" id="2226931">||</span>&nbsp;<span class="ident" id="2226934">file</span><span class="op" id="2226938">.</span><span class="ident" id="2226939">fd</span>&nbsp;<span class="op" id="2226942">&lt;</span>&nbsp;<span class="num" id="2226944">0</span>&nbsp;<span class="op" id="2226946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226950">return</span>&nbsp;<span class="ident" id="2226957">syscall</span><span class="op" id="2226964">.</span><span class="ident" id="2226965">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2226973">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226976">var</span>&nbsp;<span class="ident" id="2226980">err</span>&nbsp;<span class="builtintype" id="2226984">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2226991">if</span>&nbsp;<span class="ident" id="2226994">e</span>&nbsp;<span class="op" id="2226996">:=</span>&nbsp;<span class="ident" id="2226999">syscall</span><span class="op" id="2227006">.</span><span class="ident" id="2227007">Close</span><span class="op" id="2227012">(</span><span class="ident" id="2227013">file</span><span class="op" id="2227017">.</span><span class="ident" id="2227018">fd</span><span class="op" id="2227020">)</span><span class="op" id="2227021">;</span>&nbsp;<span class="ident" id="2227023">e</span>&nbsp;<span class="op" id="2227025">!=</span>&nbsp;<span class="ident" id="2227028">nil</span>&nbsp;<span class="op" id="2227032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227036">err</span>&nbsp;<span class="op" id="2227040">=</span>&nbsp;<span class="op" id="2227042">&amp;</span><span class="ident" id="2227043">PathError</span><span class="op" id="2227052">{</span><span class="string" id="2227053">&#34;close&#34;</span><span class="op" id="2227060">,</span>&nbsp;<span class="ident" id="2227062">file</span><span class="op" id="2227066">.</span><span class="ident" id="2227067">name</span><span class="op" id="2227071">,</span>&nbsp;<span class="ident" id="2227073">e</span><span class="op" id="2227074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2227077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227080">file</span><span class="op" id="2227084">.</span><span class="ident" id="2227085">fd</span>&nbsp;<span class="op" id="2227088">=</span>&nbsp;<span class="op" id="2227090">-</span><span class="num" id="2227091">1</span>&nbsp;<span class="comment" id="2227093">//&nbsp;so&nbsp;it&nbsp;can&#39;t&nbsp;be&nbsp;closed&nbsp;again</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2227126">//&nbsp;no&nbsp;need&nbsp;for&nbsp;a&nbsp;finalizer&nbsp;anymore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227162">runtime</span><span class="op" id="2227169">.</span><span class="ident" id="2227170">SetFinalizer</span><span class="op" id="2227182">(</span><span class="ident" id="2227183">file</span><span class="op" id="2227187">,</span>&nbsp;<span class="ident" id="2227189">nil</span><span class="op" id="2227192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227195">return</span>&nbsp;<span class="ident" id="2227202">err</span><br>
<span class="lineno"></span><span class="op" id="2227206">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2227209">//&nbsp;Stat&nbsp;returns&nbsp;the&nbsp;FileInfo&nbsp;structure&nbsp;describing&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2227265">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2227321">func</span>&nbsp;<span class="op" id="2227326">(</span><span class="ident" id="2227327">f</span>&nbsp;<span class="op" id="2227329">*</span><span class="ident" id="2227330">File</span><span class="op" id="2227334">)</span>&nbsp;<span class="ident" id="2227336">Stat</span><span class="op" id="2227340">(</span><span class="op" id="2227341">)</span>&nbsp;<span class="op" id="2227343">(</span><span class="ident" id="2227344">fi</span>&nbsp;<span class="ident" id="2227347">FileInfo</span><span class="op" id="2227355">,</span>&nbsp;<span class="ident" id="2227357">err</span>&nbsp;<span class="builtintype" id="2227361">error</span><span class="op" id="2227366">)</span>&nbsp;<span class="op" id="2227368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227371">if</span>&nbsp;<span class="ident" id="2227374">f</span>&nbsp;<span class="op" id="2227376">==</span>&nbsp;<span class="ident" id="2227379">nil</span>&nbsp;<span class="op" id="2227383">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227387">return</span>&nbsp;<span class="ident" id="2227394">nil</span><span class="op" id="2227397">,</span>&nbsp;<span class="ident" id="2227399">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2227411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227414">var</span>&nbsp;<span class="ident" id="2227418">stat</span>&nbsp;<span class="ident" id="2227423">syscall</span><span class="op" id="2227430">.</span><span class="ident" id="2227431">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227439">err</span>&nbsp;<span class="op" id="2227443">=</span>&nbsp;<span class="ident" id="2227445">syscall</span><span class="op" id="2227452">.</span><span class="ident" id="2227453">Fstat</span><span class="op" id="2227458">(</span><span class="ident" id="2227459">f</span><span class="op" id="2227460">.</span><span class="ident" id="2227461">fd</span><span class="op" id="2227463">,</span>&nbsp;<span class="op" id="2227465">&amp;</span><span class="ident" id="2227466">stat</span><span class="op" id="2227470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227473">if</span>&nbsp;<span class="ident" id="2227476">err</span>&nbsp;<span class="op" id="2227480">!=</span>&nbsp;<span class="ident" id="2227483">nil</span>&nbsp;<span class="op" id="2227487">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227491">return</span>&nbsp;<span class="ident" id="2227498">nil</span><span class="op" id="2227501">,</span>&nbsp;<span class="op" id="2227503">&amp;</span><span class="ident" id="2227504">PathError</span><span class="op" id="2227513">{</span><span class="string" id="2227514">&#34;stat&#34;</span><span class="op" id="2227520">,</span>&nbsp;<span class="ident" id="2227522">f</span><span class="op" id="2227523">.</span><span class="ident" id="2227524">name</span><span class="op" id="2227528">,</span>&nbsp;<span class="ident" id="2227530">err</span><span class="op" id="2227533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2227536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227539">return</span>&nbsp;<span class="ident" id="2227546">fileInfoFromStat</span><span class="op" id="2227562">(</span><span class="op" id="2227563">&amp;</span><span class="ident" id="2227564">stat</span><span class="op" id="2227568">,</span>&nbsp;<span class="ident" id="2227570">f</span><span class="op" id="2227571">.</span><span class="ident" id="2227572">name</span><span class="op" id="2227576">)</span><span class="op" id="2227577">,</span>&nbsp;<span class="ident" id="2227579">nil</span><br>
<span class="lineno"></span><span class="op" id="2227583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="2227586">//&nbsp;Stat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2227640">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2227696">func</span>&nbsp;<span class="ident" id="2227701">Stat</span><span class="op" id="2227705">(</span><span class="ident" id="2227706">name</span>&nbsp;<span class="builtintype" id="2227711">string</span><span class="op" id="2227717">)</span>&nbsp;<span class="op" id="2227719">(</span><span class="ident" id="2227720">fi</span>&nbsp;<span class="ident" id="2227723">FileInfo</span><span class="op" id="2227731">,</span>&nbsp;<span class="ident" id="2227733">err</span>&nbsp;<span class="builtintype" id="2227737">error</span><span class="op" id="2227742">)</span>&nbsp;<span class="op" id="2227744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227747">var</span>&nbsp;<span class="ident" id="2227751">stat</span>&nbsp;<span class="ident" id="2227756">syscall</span><span class="op" id="2227763">.</span><span class="ident" id="2227764">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2227772">err</span>&nbsp;<span class="op" id="2227776">=</span>&nbsp;<span class="ident" id="2227778">syscall</span><span class="op" id="2227785">.</span><span class="ident" id="2227786">Stat</span><span class="op" id="2227790">(</span><span class="ident" id="2227791">name</span><span class="op" id="2227795">,</span>&nbsp;<span class="op" id="2227797">&amp;</span><span class="ident" id="2227798">stat</span><span class="op" id="2227802">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227805">if</span>&nbsp;<span class="ident" id="2227808">err</span>&nbsp;<span class="op" id="2227812">!=</span>&nbsp;<span class="ident" id="2227815">nil</span>&nbsp;<span class="op" id="2227819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227823">return</span>&nbsp;<span class="ident" id="2227830">nil</span><span class="op" id="2227833">,</span>&nbsp;<span class="op" id="2227835">&amp;</span><span class="ident" id="2227836">PathError</span><span class="op" id="2227845">{</span><span class="string" id="2227846">&#34;stat&#34;</span><span class="op" id="2227852">,</span>&nbsp;<span class="ident" id="2227854">name</span><span class="op" id="2227858">,</span>&nbsp;<span class="ident" id="2227860">err</span><span class="op" id="2227863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2227866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2227869">return</span>&nbsp;<span class="ident" id="2227876">fileInfoFromStat</span><span class="op" id="2227892">(</span><span class="op" id="2227893">&amp;</span><span class="ident" id="2227894">stat</span><span class="op" id="2227898">,</span>&nbsp;<span class="ident" id="2227900">name</span><span class="op" id="2227904">)</span><span class="op" id="2227905">,</span>&nbsp;<span class="ident" id="2227907">nil</span><br>
<span class="lineno"></span><span class="op" id="2227911">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="2227914">//&nbsp;Lstat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2227969">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;the&nbsp;returned&nbsp;FileInfo</span><br>
<span class="lineno"></span><span class="comment" id="2228026">//&nbsp;describes&nbsp;the&nbsp;symbolic&nbsp;link.&nbsp;&nbsp;Lstat&nbsp;makes&nbsp;no&nbsp;attempt&nbsp;to&nbsp;follow&nbsp;the&nbsp;link.</span><br>
<span class="lineno"></span><span class="comment" id="2228102">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno">145</span><span class="keyword" id="2228158">func</span>&nbsp;<span class="ident" id="2228163">Lstat</span><span class="op" id="2228168">(</span><span class="ident" id="2228169">name</span>&nbsp;<span class="builtintype" id="2228174">string</span><span class="op" id="2228180">)</span>&nbsp;<span class="op" id="2228182">(</span><span class="ident" id="2228183">fi</span>&nbsp;<span class="ident" id="2228186">FileInfo</span><span class="op" id="2228194">,</span>&nbsp;<span class="ident" id="2228196">err</span>&nbsp;<span class="builtintype" id="2228200">error</span><span class="op" id="2228205">)</span>&nbsp;<span class="op" id="2228207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228210">var</span>&nbsp;<span class="ident" id="2228214">stat</span>&nbsp;<span class="ident" id="2228219">syscall</span><span class="op" id="2228226">.</span><span class="ident" id="2228227">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2228235">err</span>&nbsp;<span class="op" id="2228239">=</span>&nbsp;<span class="ident" id="2228241">syscall</span><span class="op" id="2228248">.</span><span class="ident" id="2228249">Lstat</span><span class="op" id="2228254">(</span><span class="ident" id="2228255">name</span><span class="op" id="2228259">,</span>&nbsp;<span class="op" id="2228261">&amp;</span><span class="ident" id="2228262">stat</span><span class="op" id="2228266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228269">if</span>&nbsp;<span class="ident" id="2228272">err</span>&nbsp;<span class="op" id="2228276">!=</span>&nbsp;<span class="ident" id="2228279">nil</span>&nbsp;<span class="op" id="2228283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228287">return</span>&nbsp;<span class="ident" id="2228294">nil</span><span class="op" id="2228297">,</span>&nbsp;<span class="op" id="2228299">&amp;</span><span class="ident" id="2228300">PathError</span><span class="op" id="2228309">{</span><span class="string" id="2228310">&#34;lstat&#34;</span><span class="op" id="2228317">,</span>&nbsp;<span class="ident" id="2228319">name</span><span class="op" id="2228323">,</span>&nbsp;<span class="ident" id="2228325">err</span><span class="op" id="2228328">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2228331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228334">return</span>&nbsp;<span class="ident" id="2228341">fileInfoFromStat</span><span class="op" id="2228357">(</span><span class="op" id="2228358">&amp;</span><span class="ident" id="2228359">stat</span><span class="op" id="2228363">,</span>&nbsp;<span class="ident" id="2228365">name</span><span class="op" id="2228369">)</span><span class="op" id="2228370">,</span>&nbsp;<span class="ident" id="2228372">nil</span><br>
<span class="lineno"></span><span class="op" id="2228376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2228379">func</span>&nbsp;<span class="op" id="2228384">(</span><span class="ident" id="2228385">f</span>&nbsp;<span class="op" id="2228387">*</span><span class="ident" id="2228388">File</span><span class="op" id="2228392">)</span>&nbsp;<span class="ident" id="2228394">readdir</span><span class="op" id="2228401">(</span><span class="ident" id="2228402">n</span>&nbsp;<span class="builtintype" id="2228404">int</span><span class="op" id="2228407">)</span>&nbsp;<span class="op" id="2228409">(</span><span class="ident" id="2228410">fi</span>&nbsp;<span class="op" id="2228413">[</span><span class="op" id="2228414">]</span><span class="ident" id="2228415">FileInfo</span><span class="op" id="2228423">,</span>&nbsp;<span class="ident" id="2228425">err</span>&nbsp;<span class="builtintype" id="2228429">error</span><span class="op" id="2228434">)</span>&nbsp;<span class="op" id="2228436">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2228439">dirname</span>&nbsp;<span class="op" id="2228447">:=</span>&nbsp;<span class="ident" id="2228450">f</span><span class="op" id="2228451">.</span><span class="ident" id="2228452">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228458">if</span>&nbsp;<span class="ident" id="2228461">dirname</span>&nbsp;<span class="op" id="2228469">==</span>&nbsp;<span class="string" id="2228472">&#34;&#34;</span>&nbsp;<span class="op" id="2228475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2228479">dirname</span>&nbsp;<span class="op" id="2228487">=</span>&nbsp;<span class="string" id="2228489">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2228494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2228497">names</span><span class="op" id="2228502">,</span>&nbsp;<span class="ident" id="2228504">err</span>&nbsp;<span class="op" id="2228508">:=</span>&nbsp;<span class="ident" id="2228511">f</span><span class="op" id="2228512">.</span><span class="ident" id="2228513">Readdirnames</span><span class="op" id="2228525">(</span><span class="ident" id="2228526">n</span><span class="op" id="2228527">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2228530">fi</span>&nbsp;<span class="op" id="2228533">=</span>&nbsp;<span class="builtinfunc" id="2228535">make</span><span class="op" id="2228539">(</span><span class="op" id="2228540">[</span><span class="op" id="2228541">]</span><span class="ident" id="2228542">FileInfo</span><span class="op" id="2228550">,</span>&nbsp;<span class="num" id="2228552">0</span><span class="op" id="2228553">,</span>&nbsp;<span class="builtinfunc" id="2228555">len</span><span class="op" id="2228558">(</span><span class="ident" id="2228559">names</span><span class="op" id="2228564">)</span><span class="op" id="2228565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228568">for</span>&nbsp;<span class="ident" id="2228572">_</span><span class="op" id="2228573">,</span>&nbsp;<span class="ident" id="2228575">filename</span>&nbsp;<span class="op" id="2228584">:=</span>&nbsp;<span class="keyword" id="2228587">range</span>&nbsp;<span class="ident" id="2228593">names</span>&nbsp;<span class="op" id="2228599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2228603">fip</span><span class="op" id="2228606">,</span>&nbsp;<span class="ident" id="2228608">lerr</span>&nbsp;<span class="op" id="2228613">:=</span>&nbsp;<span class="ident" id="2228616">lstat</span><span class="op" id="2228621">(</span><span class="ident" id="2228622">dirname</span>&nbsp;<span class="op" id="2228630">+</span>&nbsp;<span class="string" id="2228632">&#34;/&#34;</span>&nbsp;<span class="op" id="2228636">+</span>&nbsp;<span class="ident" id="2228638">filename</span><span class="op" id="2228646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228650">if</span>&nbsp;<span class="ident" id="2228653">IsNotExist</span><span class="op" id="2228663">(</span><span class="ident" id="2228664">lerr</span><span class="op" id="2228668">)</span>&nbsp;<span class="op" id="2228670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2228675">//&nbsp;File&nbsp;disappeared&nbsp;between&nbsp;readdir&nbsp;+&nbsp;stat.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2228722">//&nbsp;Just&nbsp;treat&nbsp;it&nbsp;as&nbsp;if&nbsp;it&nbsp;didn&#39;t&nbsp;exist.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228765">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2228776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228780">if</span>&nbsp;<span class="ident" id="2228783">lerr</span>&nbsp;<span class="op" id="2228788">!=</span>&nbsp;<span class="ident" id="2228791">nil</span>&nbsp;<span class="op" id="2228795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228800">return</span>&nbsp;<span class="ident" id="2228807">fi</span><span class="op" id="2228809">,</span>&nbsp;<span class="ident" id="2228811">lerr</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2228818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2228822">fi</span>&nbsp;<span class="op" id="2228825">=</span>&nbsp;<span class="builtinfunc" id="2228827">append</span><span class="op" id="2228833">(</span><span class="ident" id="2228834">fi</span><span class="op" id="2228836">,</span>&nbsp;<span class="ident" id="2228838">fip</span><span class="op" id="2228841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2228844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2228847">return</span>&nbsp;<span class="ident" id="2228854">fi</span><span class="op" id="2228856">,</span>&nbsp;<span class="ident" id="2228858">err</span><br>
<span class="lineno"></span><span class="op" id="2228862">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="2228865">//&nbsp;Darwin&nbsp;and&nbsp;FreeBSD&nbsp;can&#39;t&nbsp;read&nbsp;or&nbsp;write&nbsp;2GB+&nbsp;at&nbsp;a&nbsp;time,</span><br>
<span class="lineno"></span><span class="comment" id="2228923">//&nbsp;even&nbsp;on&nbsp;64-bit&nbsp;systems.&nbsp;See&nbsp;golang.org/issue/7812.</span><br>
<span class="lineno"></span><span class="comment" id="2228977">//&nbsp;Use&nbsp;1GB&nbsp;instead&nbsp;of,&nbsp;say,&nbsp;2GB-1,&nbsp;to&nbsp;keep&nbsp;subsequent</span><br>
<span class="lineno"></span><span class="comment" id="2229031">//&nbsp;reads&nbsp;aligned.</span><br>
<span class="lineno">180</span><span class="keyword" id="2229049">const</span>&nbsp;<span class="op" id="2229055">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229058">needsMaxRW</span>&nbsp;<span class="op" id="2229069">=</span>&nbsp;<span class="ident" id="2229071">runtime</span><span class="op" id="2229078">.</span><span class="ident" id="2229079">GOOS</span>&nbsp;<span class="op" id="2229084">==</span>&nbsp;<span class="string" id="2229087">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2229096">||</span>&nbsp;<span class="ident" id="2229099">runtime</span><span class="op" id="2229106">.</span><span class="ident" id="2229107">GOOS</span>&nbsp;<span class="op" id="2229112">==</span>&nbsp;<span class="string" id="2229115">&#34;freebsd&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229126">maxRW</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2229137">=</span>&nbsp;<span class="num" id="2229139">1</span>&nbsp;<span class="op" id="2229141">&lt;&lt;</span>&nbsp;<span class="num" id="2229144">30</span><br>
<span class="lineno"></span><span class="op" id="2229147">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="2229150">//&nbsp;read&nbsp;reads&nbsp;up&nbsp;to&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File.</span><br>
<span class="lineno"></span><span class="comment" id="2229198">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2229259">func</span>&nbsp;<span class="op" id="2229264">(</span><span class="ident" id="2229265">f</span>&nbsp;<span class="op" id="2229267">*</span><span class="ident" id="2229268">File</span><span class="op" id="2229272">)</span>&nbsp;<span class="ident" id="2229274">read</span><span class="op" id="2229278">(</span><span class="ident" id="2229279">b</span>&nbsp;<span class="op" id="2229281">[</span><span class="op" id="2229282">]</span><span class="builtintype" id="2229283">byte</span><span class="op" id="2229287">)</span>&nbsp;<span class="op" id="2229289">(</span><span class="ident" id="2229290">n</span>&nbsp;<span class="builtintype" id="2229292">int</span><span class="op" id="2229295">,</span>&nbsp;<span class="ident" id="2229297">err</span>&nbsp;<span class="builtintype" id="2229301">error</span><span class="op" id="2229306">)</span>&nbsp;<span class="op" id="2229308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229311">if</span>&nbsp;<span class="ident" id="2229314">needsMaxRW</span>&nbsp;<span class="op" id="2229325">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2229328">len</span><span class="op" id="2229331">(</span><span class="ident" id="2229332">b</span><span class="op" id="2229333">)</span>&nbsp;<span class="op" id="2229335">&gt;</span>&nbsp;<span class="ident" id="2229337">maxRW</span>&nbsp;<span class="op" id="2229343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229347">b</span>&nbsp;<span class="op" id="2229349">=</span>&nbsp;<span class="ident" id="2229351">b</span><span class="op" id="2229352">[</span><span class="op" id="2229353">:</span><span class="ident" id="2229354">maxRW</span><span class="op" id="2229359">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2229362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229365">return</span>&nbsp;<span class="ident" id="2229372">fixCount</span><span class="op" id="2229380">(</span><span class="ident" id="2229381">syscall</span><span class="op" id="2229388">.</span><span class="ident" id="2229389">Read</span><span class="op" id="2229393">(</span><span class="ident" id="2229394">f</span><span class="op" id="2229395">.</span><span class="ident" id="2229396">fd</span><span class="op" id="2229398">,</span>&nbsp;<span class="ident" id="2229400">b</span><span class="op" id="2229401">)</span><span class="op" id="2229402">)</span><br>
<span class="lineno"></span><span class="op" id="2229404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2229407">//&nbsp;pread&nbsp;reads&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno">195</span><span class="comment" id="2229478">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;the&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="2229540">//&nbsp;EOF&nbsp;is&nbsp;signaled&nbsp;by&nbsp;a&nbsp;zero&nbsp;count&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2229596">func</span>&nbsp;<span class="op" id="2229601">(</span><span class="ident" id="2229602">f</span>&nbsp;<span class="op" id="2229604">*</span><span class="ident" id="2229605">File</span><span class="op" id="2229609">)</span>&nbsp;<span class="ident" id="2229611">pread</span><span class="op" id="2229616">(</span><span class="ident" id="2229617">b</span>&nbsp;<span class="op" id="2229619">[</span><span class="op" id="2229620">]</span><span class="builtintype" id="2229621">byte</span><span class="op" id="2229625">,</span>&nbsp;<span class="ident" id="2229627">off</span>&nbsp;<span class="ident" id="2229631">int64</span><span class="op" id="2229636">)</span>&nbsp;<span class="op" id="2229638">(</span><span class="ident" id="2229639">n</span>&nbsp;<span class="builtintype" id="2229641">int</span><span class="op" id="2229644">,</span>&nbsp;<span class="ident" id="2229646">err</span>&nbsp;<span class="builtintype" id="2229650">error</span><span class="op" id="2229655">)</span>&nbsp;<span class="op" id="2229657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229660">if</span>&nbsp;<span class="ident" id="2229663">needsMaxRW</span>&nbsp;<span class="op" id="2229674">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2229677">len</span><span class="op" id="2229680">(</span><span class="ident" id="2229681">b</span><span class="op" id="2229682">)</span>&nbsp;<span class="op" id="2229684">&gt;</span>&nbsp;<span class="ident" id="2229686">maxRW</span>&nbsp;<span class="op" id="2229692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229696">b</span>&nbsp;<span class="op" id="2229698">=</span>&nbsp;<span class="ident" id="2229700">b</span><span class="op" id="2229701">[</span><span class="op" id="2229702">:</span><span class="ident" id="2229703">maxRW</span><span class="op" id="2229708">]</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2229711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229714">return</span>&nbsp;<span class="ident" id="2229721">fixCount</span><span class="op" id="2229729">(</span><span class="ident" id="2229730">syscall</span><span class="op" id="2229737">.</span><span class="ident" id="2229738">Pread</span><span class="op" id="2229743">(</span><span class="ident" id="2229744">f</span><span class="op" id="2229745">.</span><span class="ident" id="2229746">fd</span><span class="op" id="2229748">,</span>&nbsp;<span class="ident" id="2229750">b</span><span class="op" id="2229751">,</span>&nbsp;<span class="ident" id="2229753">off</span><span class="op" id="2229756">)</span><span class="op" id="2229757">)</span><br>
<span class="lineno"></span><span class="op" id="2229759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2229762">//&nbsp;write&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File.</span><br>
<span class="lineno">205</span><span class="comment" id="2229804">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2229868">func</span>&nbsp;<span class="op" id="2229873">(</span><span class="ident" id="2229874">f</span>&nbsp;<span class="op" id="2229876">*</span><span class="ident" id="2229877">File</span><span class="op" id="2229881">)</span>&nbsp;<span class="ident" id="2229883">write</span><span class="op" id="2229888">(</span><span class="ident" id="2229889">b</span>&nbsp;<span class="op" id="2229891">[</span><span class="op" id="2229892">]</span><span class="builtintype" id="2229893">byte</span><span class="op" id="2229897">)</span>&nbsp;<span class="op" id="2229899">(</span><span class="ident" id="2229900">n</span>&nbsp;<span class="builtintype" id="2229902">int</span><span class="op" id="2229905">,</span>&nbsp;<span class="ident" id="2229907">err</span>&nbsp;<span class="builtintype" id="2229911">error</span><span class="op" id="2229916">)</span>&nbsp;<span class="op" id="2229918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229921">for</span>&nbsp;<span class="op" id="2229925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229929">bcap</span>&nbsp;<span class="op" id="2229934">:=</span>&nbsp;<span class="ident" id="2229937">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2229941">if</span>&nbsp;<span class="ident" id="2229944">needsMaxRW</span>&nbsp;<span class="op" id="2229955">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2229958">len</span><span class="op" id="2229961">(</span><span class="ident" id="2229962">bcap</span><span class="op" id="2229966">)</span>&nbsp;<span class="op" id="2229968">&gt;</span>&nbsp;<span class="ident" id="2229970">maxRW</span>&nbsp;<span class="op" id="2229976">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2229981">bcap</span>&nbsp;<span class="op" id="2229986">=</span>&nbsp;<span class="ident" id="2229988">bcap</span><span class="op" id="2229992">[</span><span class="op" id="2229993">:</span><span class="ident" id="2229994">maxRW</span><span class="op" id="2229999">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2230003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230007">m</span><span class="op" id="2230008">,</span>&nbsp;<span class="ident" id="2230010">err</span>&nbsp;<span class="op" id="2230014">:=</span>&nbsp;<span class="ident" id="2230017">fixCount</span><span class="op" id="2230025">(</span><span class="ident" id="2230026">syscall</span><span class="op" id="2230033">.</span><span class="ident" id="2230034">Write</span><span class="op" id="2230039">(</span><span class="ident" id="2230040">f</span><span class="op" id="2230041">.</span><span class="ident" id="2230042">fd</span><span class="op" id="2230044">,</span>&nbsp;<span class="ident" id="2230046">bcap</span><span class="op" id="2230050">)</span><span class="op" id="2230051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230055">n</span>&nbsp;<span class="op" id="2230057">+=</span>&nbsp;<span class="ident" id="2230060">m</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2230065">//&nbsp;If&nbsp;the&nbsp;syscall&nbsp;wrote&nbsp;some&nbsp;data&nbsp;but&nbsp;not&nbsp;all&nbsp;(short&nbsp;write)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2230127">//&nbsp;or&nbsp;it&nbsp;returned&nbsp;EINTR,&nbsp;then&nbsp;assume&nbsp;it&nbsp;stopped&nbsp;early&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2230187">//&nbsp;reasons&nbsp;that&nbsp;are&nbsp;uninteresting&nbsp;to&nbsp;the&nbsp;caller,&nbsp;and&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230253">if</span>&nbsp;<span class="num" id="2230256">0</span>&nbsp;<span class="op" id="2230258">&lt;</span>&nbsp;<span class="ident" id="2230260">m</span>&nbsp;<span class="op" id="2230262">&amp;&amp;</span>&nbsp;<span class="ident" id="2230265">m</span>&nbsp;<span class="op" id="2230267">&lt;</span>&nbsp;<span class="builtinfunc" id="2230269">len</span><span class="op" id="2230272">(</span><span class="ident" id="2230273">bcap</span><span class="op" id="2230277">)</span>&nbsp;<span class="op" id="2230279">||</span>&nbsp;<span class="ident" id="2230282">err</span>&nbsp;<span class="op" id="2230286">==</span>&nbsp;<span class="ident" id="2230289">syscall</span><span class="op" id="2230296">.</span><span class="ident" id="2230297">EINTR</span>&nbsp;<span class="op" id="2230303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230308">b</span>&nbsp;<span class="op" id="2230310">=</span>&nbsp;<span class="ident" id="2230312">b</span><span class="op" id="2230313">[</span><span class="ident" id="2230314">m</span><span class="op" id="2230315">:</span><span class="op" id="2230316">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230321">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2230332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230337">if</span>&nbsp;<span class="ident" id="2230340">needsMaxRW</span>&nbsp;<span class="op" id="2230351">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2230354">len</span><span class="op" id="2230357">(</span><span class="ident" id="2230358">bcap</span><span class="op" id="2230362">)</span>&nbsp;<span class="op" id="2230364">!=</span>&nbsp;<span class="builtinfunc" id="2230367">len</span><span class="op" id="2230370">(</span><span class="ident" id="2230371">b</span><span class="op" id="2230372">)</span>&nbsp;<span class="op" id="2230374">&amp;&amp;</span>&nbsp;<span class="ident" id="2230377">err</span>&nbsp;<span class="op" id="2230381">==</span>&nbsp;<span class="ident" id="2230384">nil</span>&nbsp;<span class="op" id="2230388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230393">b</span>&nbsp;<span class="op" id="2230395">=</span>&nbsp;<span class="ident" id="2230397">b</span><span class="op" id="2230398">[</span><span class="ident" id="2230399">m</span><span class="op" id="2230400">:</span><span class="op" id="2230401">]</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230406">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2230417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230422">return</span>&nbsp;<span class="ident" id="2230429">n</span><span class="op" id="2230430">,</span>&nbsp;<span class="ident" id="2230432">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2230437">}</span><br>
<span class="lineno">230</span><span class="op" id="2230439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2230442">//&nbsp;pwrite&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno"></span><span class="comment" id="2230513">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2230577">func</span>&nbsp;<span class="op" id="2230582">(</span><span class="ident" id="2230583">f</span>&nbsp;<span class="op" id="2230585">*</span><span class="ident" id="2230586">File</span><span class="op" id="2230590">)</span>&nbsp;<span class="ident" id="2230592">pwrite</span><span class="op" id="2230598">(</span><span class="ident" id="2230599">b</span>&nbsp;<span class="op" id="2230601">[</span><span class="op" id="2230602">]</span><span class="builtintype" id="2230603">byte</span><span class="op" id="2230607">,</span>&nbsp;<span class="ident" id="2230609">off</span>&nbsp;<span class="ident" id="2230613">int64</span><span class="op" id="2230618">)</span>&nbsp;<span class="op" id="2230620">(</span><span class="ident" id="2230621">n</span>&nbsp;<span class="builtintype" id="2230623">int</span><span class="op" id="2230626">,</span>&nbsp;<span class="ident" id="2230628">err</span>&nbsp;<span class="builtintype" id="2230632">error</span><span class="op" id="2230637">)</span>&nbsp;<span class="op" id="2230639">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230642">if</span>&nbsp;<span class="ident" id="2230645">needsMaxRW</span>&nbsp;<span class="op" id="2230656">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2230659">len</span><span class="op" id="2230662">(</span><span class="ident" id="2230663">b</span><span class="op" id="2230664">)</span>&nbsp;<span class="op" id="2230666">&gt;</span>&nbsp;<span class="ident" id="2230668">maxRW</span>&nbsp;<span class="op" id="2230674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2230678">b</span>&nbsp;<span class="op" id="2230680">=</span>&nbsp;<span class="ident" id="2230682">b</span><span class="op" id="2230683">[</span><span class="op" id="2230684">:</span><span class="ident" id="2230685">maxRW</span><span class="op" id="2230690">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2230693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2230696">return</span>&nbsp;<span class="ident" id="2230703">fixCount</span><span class="op" id="2230711">(</span><span class="ident" id="2230712">syscall</span><span class="op" id="2230719">.</span><span class="ident" id="2230720">Pwrite</span><span class="op" id="2230726">(</span><span class="ident" id="2230727">f</span><span class="op" id="2230728">.</span><span class="ident" id="2230729">fd</span><span class="op" id="2230731">,</span>&nbsp;<span class="ident" id="2230733">b</span><span class="op" id="2230734">,</span>&nbsp;<span class="ident" id="2230736">off</span><span class="op" id="2230739">)</span><span class="op" id="2230740">)</span><br>
<span class="lineno"></span><span class="op" id="2230742">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="2230745">//&nbsp;seek&nbsp;sets&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;Read&nbsp;or&nbsp;Write&nbsp;on&nbsp;file&nbsp;to&nbsp;offset,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="2230827">//&nbsp;according&nbsp;to&nbsp;whence:&nbsp;0&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;origin&nbsp;of&nbsp;the&nbsp;file,&nbsp;1&nbsp;means</span><br>
<span class="lineno"></span><span class="comment" id="2230903">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;offset,&nbsp;and&nbsp;2&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span><span class="comment" id="2230971">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;new&nbsp;offset&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">245</span><span class="keyword" id="2231022">func</span>&nbsp;<span class="op" id="2231027">(</span><span class="ident" id="2231028">f</span>&nbsp;<span class="op" id="2231030">*</span><span class="ident" id="2231031">File</span><span class="op" id="2231035">)</span>&nbsp;<span class="ident" id="2231037">seek</span><span class="op" id="2231041">(</span><span class="ident" id="2231042">offset</span>&nbsp;<span class="ident" id="2231049">int64</span><span class="op" id="2231054">,</span>&nbsp;<span class="ident" id="2231056">whence</span>&nbsp;<span class="builtintype" id="2231063">int</span><span class="op" id="2231066">)</span>&nbsp;<span class="op" id="2231068">(</span><span class="ident" id="2231069">ret</span>&nbsp;<span class="ident" id="2231073">int64</span><span class="op" id="2231078">,</span>&nbsp;<span class="ident" id="2231080">err</span>&nbsp;<span class="builtintype" id="2231084">error</span><span class="op" id="2231089">)</span>&nbsp;<span class="op" id="2231091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231094">return</span>&nbsp;<span class="ident" id="2231101">syscall</span><span class="op" id="2231108">.</span><span class="ident" id="2231109">Seek</span><span class="op" id="2231113">(</span><span class="ident" id="2231114">f</span><span class="op" id="2231115">.</span><span class="ident" id="2231116">fd</span><span class="op" id="2231118">,</span>&nbsp;<span class="ident" id="2231120">offset</span><span class="op" id="2231126">,</span>&nbsp;<span class="ident" id="2231128">whence</span><span class="op" id="2231134">)</span><br>
<span class="lineno"></span><span class="op" id="2231136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2231139">//&nbsp;Truncate&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno">250</span><span class="comment" id="2231187">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;it&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;link&#39;s&nbsp;target.</span><br>
<span class="lineno"></span><span class="comment" id="2231264">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2231320">func</span>&nbsp;<span class="ident" id="2231325">Truncate</span><span class="op" id="2231333">(</span><span class="ident" id="2231334">name</span>&nbsp;<span class="builtintype" id="2231339">string</span><span class="op" id="2231345">,</span>&nbsp;<span class="ident" id="2231347">size</span>&nbsp;<span class="ident" id="2231352">int64</span><span class="op" id="2231357">)</span>&nbsp;<span class="builtintype" id="2231359">error</span>&nbsp;<span class="op" id="2231365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231368">if</span>&nbsp;<span class="ident" id="2231371">e</span>&nbsp;<span class="op" id="2231373">:=</span>&nbsp;<span class="ident" id="2231376">syscall</span><span class="op" id="2231383">.</span><span class="ident" id="2231384">Truncate</span><span class="op" id="2231392">(</span><span class="ident" id="2231393">name</span><span class="op" id="2231397">,</span>&nbsp;<span class="ident" id="2231399">size</span><span class="op" id="2231403">)</span><span class="op" id="2231404">;</span>&nbsp;<span class="ident" id="2231406">e</span>&nbsp;<span class="op" id="2231408">!=</span>&nbsp;<span class="ident" id="2231411">nil</span>&nbsp;<span class="op" id="2231415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231419">return</span>&nbsp;<span class="op" id="2231426">&amp;</span><span class="ident" id="2231427">PathError</span><span class="op" id="2231436">{</span><span class="string" id="2231437">&#34;truncate&#34;</span><span class="op" id="2231447">,</span>&nbsp;<span class="ident" id="2231449">name</span><span class="op" id="2231453">,</span>&nbsp;<span class="ident" id="2231455">e</span><span class="op" id="2231456">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2231459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231462">return</span>&nbsp;<span class="ident" id="2231469">nil</span><br>
<span class="lineno"></span><span class="op" id="2231473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2231476">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;named&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno">260</span><span class="comment" id="2231523">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2231579">func</span>&nbsp;<span class="ident" id="2231584">Remove</span><span class="op" id="2231590">(</span><span class="ident" id="2231591">name</span>&nbsp;<span class="builtintype" id="2231596">string</span><span class="op" id="2231602">)</span>&nbsp;<span class="builtintype" id="2231604">error</span>&nbsp;<span class="op" id="2231610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2231613">//&nbsp;System&nbsp;call&nbsp;interface&nbsp;forces&nbsp;us&nbsp;to&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2231657">//&nbsp;whether&nbsp;name&nbsp;is&nbsp;a&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2231698">//&nbsp;Try&nbsp;both:&nbsp;it&nbsp;is&nbsp;cheaper&nbsp;on&nbsp;average&nbsp;than</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2231742">//&nbsp;doing&nbsp;a&nbsp;Stat&nbsp;plus&nbsp;the&nbsp;right&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231779">e</span>&nbsp;<span class="op" id="2231781">:=</span>&nbsp;<span class="ident" id="2231784">syscall</span><span class="op" id="2231791">.</span><span class="ident" id="2231792">Unlink</span><span class="op" id="2231798">(</span><span class="ident" id="2231799">name</span><span class="op" id="2231803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231806">if</span>&nbsp;<span class="ident" id="2231809">e</span>&nbsp;<span class="op" id="2231811">==</span>&nbsp;<span class="ident" id="2231814">nil</span>&nbsp;<span class="op" id="2231818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231822">return</span>&nbsp;<span class="ident" id="2231829">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2231834">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2231837">e1</span>&nbsp;<span class="op" id="2231840">:=</span>&nbsp;<span class="ident" id="2231843">syscall</span><span class="op" id="2231850">.</span><span class="ident" id="2231851">Rmdir</span><span class="op" id="2231856">(</span><span class="ident" id="2231857">name</span><span class="op" id="2231861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231864">if</span>&nbsp;<span class="ident" id="2231867">e1</span>&nbsp;<span class="op" id="2231870">==</span>&nbsp;<span class="ident" id="2231873">nil</span>&nbsp;<span class="op" id="2231877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2231881">return</span>&nbsp;<span class="ident" id="2231888">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2231893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2231897">//&nbsp;Both&nbsp;failed:&nbsp;figure&nbsp;out&nbsp;which&nbsp;error&nbsp;to&nbsp;return.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2231948">//&nbsp;OS&nbsp;X&nbsp;and&nbsp;Linux&nbsp;differ&nbsp;on&nbsp;whether&nbsp;unlink(dir)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2231997">//&nbsp;returns&nbsp;EISDIR,&nbsp;so&nbsp;can&#39;t&nbsp;use&nbsp;that.&nbsp;&nbsp;However,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2232046">//&nbsp;both&nbsp;agree&nbsp;that&nbsp;rmdir(file)&nbsp;returns&nbsp;ENOTDIR,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2232095">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;that&nbsp;to&nbsp;decide&nbsp;which&nbsp;error&nbsp;is&nbsp;real.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2232149">//&nbsp;Rmdir&nbsp;might&nbsp;also&nbsp;return&nbsp;ENOTDIR&nbsp;if&nbsp;given&nbsp;a&nbsp;bad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2232200">//&nbsp;file&nbsp;path,&nbsp;like&nbsp;/etc/passwd/foo,&nbsp;but&nbsp;in&nbsp;that&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2232255">//&nbsp;both&nbsp;errors&nbsp;will&nbsp;be&nbsp;ENOTDIR,&nbsp;so&nbsp;it&#39;s&nbsp;okay&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2232304">//&nbsp;use&nbsp;the&nbsp;error&nbsp;from&nbsp;unlink.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232335">if</span>&nbsp;<span class="ident" id="2232338">e1</span>&nbsp;<span class="op" id="2232341">!=</span>&nbsp;<span class="ident" id="2232344">syscall</span><span class="op" id="2232351">.</span><span class="ident" id="2232352">ENOTDIR</span>&nbsp;<span class="op" id="2232360">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232364">e</span>&nbsp;<span class="op" id="2232366">=</span>&nbsp;<span class="ident" id="2232368">e1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2232372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232375">return</span>&nbsp;<span class="op" id="2232382">&amp;</span><span class="ident" id="2232383">PathError</span><span class="op" id="2232392">{</span><span class="string" id="2232393">&#34;remove&#34;</span><span class="op" id="2232401">,</span>&nbsp;<span class="ident" id="2232403">name</span><span class="op" id="2232407">,</span>&nbsp;<span class="ident" id="2232409">e</span><span class="op" id="2232410">}</span><br>
<span class="lineno"></span><span class="op" id="2232412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="2232415">//&nbsp;basename&nbsp;removes&nbsp;trailing&nbsp;slashes&nbsp;and&nbsp;the&nbsp;leading&nbsp;directory&nbsp;name&nbsp;from&nbsp;path&nbsp;name</span><br>
<span class="lineno"></span><span class="keyword" id="2232498">func</span>&nbsp;<span class="ident" id="2232503">basename</span><span class="op" id="2232511">(</span><span class="ident" id="2232512">name</span>&nbsp;<span class="builtintype" id="2232517">string</span><span class="op" id="2232523">)</span>&nbsp;<span class="builtintype" id="2232525">string</span>&nbsp;<span class="op" id="2232532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232535">i</span>&nbsp;<span class="op" id="2232537">:=</span>&nbsp;<span class="builtinfunc" id="2232540">len</span><span class="op" id="2232543">(</span><span class="ident" id="2232544">name</span><span class="op" id="2232548">)</span>&nbsp;<span class="op" id="2232550">-</span>&nbsp;<span class="num" id="2232552">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2232555">//&nbsp;Remove&nbsp;trailing&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232583">for</span>&nbsp;<span class="op" id="2232587">;</span>&nbsp;<span class="ident" id="2232589">i</span>&nbsp;<span class="op" id="2232591">&gt;</span>&nbsp;<span class="num" id="2232593">0</span>&nbsp;<span class="op" id="2232595">&amp;&amp;</span>&nbsp;<span class="ident" id="2232598">name</span><span class="op" id="2232602">[</span><span class="ident" id="2232603">i</span><span class="op" id="2232604">]</span>&nbsp;<span class="op" id="2232606">==</span>&nbsp;<span class="string" id="2232609">&#39;/&#39;</span><span class="op" id="2232612">;</span>&nbsp;<span class="ident" id="2232614">i</span><span class="op" id="2232615">--</span>&nbsp;<span class="op" id="2232618">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232622">name</span>&nbsp;<span class="op" id="2232627">=</span>&nbsp;<span class="ident" id="2232629">name</span><span class="op" id="2232633">[</span><span class="op" id="2232634">:</span><span class="ident" id="2232635">i</span><span class="op" id="2232636">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2232639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2232642">//&nbsp;Remove&nbsp;leading&nbsp;directory&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232676">for</span>&nbsp;<span class="ident" id="2232680">i</span><span class="op" id="2232681">--</span><span class="op" id="2232683">;</span>&nbsp;<span class="ident" id="2232685">i</span>&nbsp;<span class="op" id="2232687">&gt;=</span>&nbsp;<span class="num" id="2232690">0</span><span class="op" id="2232691">;</span>&nbsp;<span class="ident" id="2232693">i</span><span class="op" id="2232694">--</span>&nbsp;<span class="op" id="2232697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232701">if</span>&nbsp;<span class="ident" id="2232704">name</span><span class="op" id="2232708">[</span><span class="ident" id="2232709">i</span><span class="op" id="2232710">]</span>&nbsp;<span class="op" id="2232712">==</span>&nbsp;<span class="string" id="2232715">&#39;/&#39;</span>&nbsp;<span class="op" id="2232719">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232724">name</span>&nbsp;<span class="op" id="2232729">=</span>&nbsp;<span class="ident" id="2232731">name</span><span class="op" id="2232735">[</span><span class="ident" id="2232736">i</span><span class="op" id="2232737">+</span><span class="num" id="2232738">1</span><span class="op" id="2232739">:</span><span class="op" id="2232740">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232745">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2232753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2232756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232760">return</span>&nbsp;<span class="ident" id="2232767">name</span><br>
<span class="lineno"></span><span class="op" id="2232772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2232775">//&nbsp;TempDir&nbsp;returns&nbsp;the&nbsp;default&nbsp;directory&nbsp;to&nbsp;use&nbsp;for&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="keyword" id="2232844">func</span>&nbsp;<span class="ident" id="2232849">TempDir</span><span class="op" id="2232856">(</span><span class="op" id="2232857">)</span>&nbsp;<span class="builtintype" id="2232859">string</span>&nbsp;<span class="op" id="2232866">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232869">dir</span>&nbsp;<span class="op" id="2232873">:=</span>&nbsp;<span class="ident" id="2232876">Getenv</span><span class="op" id="2232882">(</span><span class="string" id="2232883">&#34;TMPDIR&#34;</span><span class="op" id="2232891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232894">if</span>&nbsp;<span class="ident" id="2232897">dir</span>&nbsp;<span class="op" id="2232901">==</span>&nbsp;<span class="string" id="2232904">&#34;&#34;</span>&nbsp;<span class="op" id="2232907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2232911">if</span>&nbsp;<span class="ident" id="2232914">runtime</span><span class="op" id="2232921">.</span><span class="ident" id="2232922">GOOS</span>&nbsp;<span class="op" id="2232927">==</span>&nbsp;<span class="string" id="2232930">&#34;android&#34;</span>&nbsp;<span class="op" id="2232940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232945">dir</span>&nbsp;<span class="op" id="2232949">=</span>&nbsp;<span class="string" id="2232951">&#34;/data/local/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2232971">}</span>&nbsp;<span class="keyword" id="2232973">else</span>&nbsp;<span class="op" id="2232978">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2232983">dir</span>&nbsp;<span class="op" id="2232987">=</span>&nbsp;<span class="string" id="2232989">&#34;/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2232998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2233001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2233004">return</span>&nbsp;<span class="ident" id="2233011">dir</span><br>
<span class="lineno"></span><span class="op" id="2233015">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2233018">//&nbsp;Link&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;hard&nbsp;link&nbsp;to&nbsp;the&nbsp;oldname&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2233078">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2233134">func</span>&nbsp;<span class="ident" id="2233139">Link</span><span class="op" id="2233143">(</span><span class="ident" id="2233144">oldname</span><span class="op" id="2233151">,</span>&nbsp;<span class="ident" id="2233153">newname</span>&nbsp;<span class="builtintype" id="2233161">string</span><span class="op" id="2233167">)</span>&nbsp;<span class="builtintype" id="2233169">error</span>&nbsp;<span class="op" id="2233175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2233178">e</span>&nbsp;<span class="op" id="2233180">:=</span>&nbsp;<span class="ident" id="2233183">syscall</span><span class="op" id="2233190">.</span><span class="ident" id="2233191">Link</span><span class="op" id="2233195">(</span><span class="ident" id="2233196">oldname</span><span class="op" id="2233203">,</span>&nbsp;<span class="ident" id="2233205">newname</span><span class="op" id="2233212">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2233215">if</span>&nbsp;<span class="ident" id="2233218">e</span>&nbsp;<span class="op" id="2233220">!=</span>&nbsp;<span class="ident" id="2233223">nil</span>&nbsp;<span class="op" id="2233227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2233231">return</span>&nbsp;<span class="op" id="2233238">&amp;</span><span class="ident" id="2233239">LinkError</span><span class="op" id="2233248">{</span><span class="string" id="2233249">&#34;link&#34;</span><span class="op" id="2233255">,</span>&nbsp;<span class="ident" id="2233257">oldname</span><span class="op" id="2233264">,</span>&nbsp;<span class="ident" id="2233266">newname</span><span class="op" id="2233273">,</span>&nbsp;<span class="ident" id="2233275">e</span><span class="op" id="2233276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2233279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2233282">return</span>&nbsp;<span class="ident" id="2233289">nil</span><br>
<span class="lineno"></span><span class="op" id="2233293">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="2233296">//&nbsp;Symlink&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;symbolic&nbsp;link&nbsp;to&nbsp;oldname.</span><br>
<span class="lineno"></span><span class="comment" id="2233354">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2233410">func</span>&nbsp;<span class="ident" id="2233415">Symlink</span><span class="op" id="2233422">(</span><span class="ident" id="2233423">oldname</span><span class="op" id="2233430">,</span>&nbsp;<span class="ident" id="2233432">newname</span>&nbsp;<span class="builtintype" id="2233440">string</span><span class="op" id="2233446">)</span>&nbsp;<span class="builtintype" id="2233448">error</span>&nbsp;<span class="op" id="2233454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2233457">e</span>&nbsp;<span class="op" id="2233459">:=</span>&nbsp;<span class="ident" id="2233462">syscall</span><span class="op" id="2233469">.</span><span class="ident" id="2233470">Symlink</span><span class="op" id="2233477">(</span><span class="ident" id="2233478">oldname</span><span class="op" id="2233485">,</span>&nbsp;<span class="ident" id="2233487">newname</span><span class="op" id="2233494">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2233497">if</span>&nbsp;<span class="ident" id="2233500">e</span>&nbsp;<span class="op" id="2233502">!=</span>&nbsp;<span class="ident" id="2233505">nil</span>&nbsp;<span class="op" id="2233509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2233513">return</span>&nbsp;<span class="op" id="2233520">&amp;</span><span class="ident" id="2233521">LinkError</span><span class="op" id="2233530">{</span><span class="string" id="2233531">&#34;symlink&#34;</span><span class="op" id="2233540">,</span>&nbsp;<span class="ident" id="2233542">oldname</span><span class="op" id="2233549">,</span>&nbsp;<span class="ident" id="2233551">newname</span><span class="op" id="2233558">,</span>&nbsp;<span class="ident" id="2233560">e</span><span class="op" id="2233561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2233564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2233567">return</span>&nbsp;<span class="ident" id="2233574">nil</span><br>
<span class="lineno"></span><span class="op" id="2233578">}</span>
</div>
</body>
</html>
