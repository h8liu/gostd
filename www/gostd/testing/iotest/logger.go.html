<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing/iotest</h2>
<ul>
<li><a href="/gostd/testing/iotest/logger.go.html" class="current">logger.go</a></li>
<li><a href="/gostd/testing/iotest/reader.go.html">reader.go</a></li>
<li><a href="/gostd/testing/iotest/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4624541">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4624596">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4624650">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4624701">package</span>&nbsp;<span class="ident" id="4624709">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4624717">import</span>&nbsp;<span class="op" id="4624724">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4624727">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4624733">&#34;log&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4624739">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4624742">type</span>&nbsp;<span class="ident" id="4624747">writeLogger</span>&nbsp;<span class="keyword" id="4624759">struct</span>&nbsp;<span class="op" id="4624766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624769">prefix</span>&nbsp;<span class="builtintype" id="4624776">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624784">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624791">io</span><span class="op" id="4624793">.</span><span class="ident" id="4624794">Writer</span><br>
<span class="lineno">15</span><span class="op" id="4624801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4624804">func</span>&nbsp;<span class="op" id="4624809">(</span><span class="ident" id="4624810">l</span>&nbsp;<span class="op" id="4624812">*</span><span class="ident" id="4624813">writeLogger</span><span class="op" id="4624824">)</span>&nbsp;<span class="ident" id="4624826">Write</span><span class="op" id="4624831">(</span><span class="ident" id="4624832">p</span>&nbsp;<span class="op" id="4624834">[</span><span class="op" id="4624835">]</span><span class="builtintype" id="4624836">byte</span><span class="op" id="4624840">)</span>&nbsp;<span class="op" id="4624842">(</span><span class="ident" id="4624843">n</span>&nbsp;<span class="builtintype" id="4624845">int</span><span class="op" id="4624848">,</span>&nbsp;<span class="ident" id="4624850">err</span>&nbsp;<span class="builtintype" id="4624854">error</span><span class="op" id="4624859">)</span>&nbsp;<span class="op" id="4624861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624864">n</span><span class="op" id="4624865">,</span>&nbsp;<span class="ident" id="4624867">err</span>&nbsp;<span class="op" id="4624871">=</span>&nbsp;<span class="ident" id="4624873">l</span><span class="op" id="4624874">.</span><span class="ident" id="4624875">w</span><span class="op" id="4624876">.</span><span class="ident" id="4624877">Write</span><span class="op" id="4624882">(</span><span class="ident" id="4624883">p</span><span class="op" id="4624884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4624887">if</span>&nbsp;<span class="ident" id="4624890">err</span>&nbsp;<span class="op" id="4624894">!=</span>&nbsp;<span class="ident" id="4624897">nil</span>&nbsp;<span class="op" id="4624901">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624905">log</span><span class="op" id="4624908">.</span><span class="ident" id="4624909">Printf</span><span class="op" id="4624915">(</span><span class="string" id="4624916">&#34;%s&nbsp;%x:&nbsp;%v&#34;</span><span class="op" id="4624927">,</span>&nbsp;<span class="ident" id="4624929">l</span><span class="op" id="4624930">.</span><span class="ident" id="4624931">prefix</span><span class="op" id="4624937">,</span>&nbsp;<span class="ident" id="4624939">p</span><span class="op" id="4624940">[</span><span class="num" id="4624941">0</span><span class="op" id="4624942">:</span><span class="ident" id="4624943">n</span><span class="op" id="4624944">]</span><span class="op" id="4624945">,</span>&nbsp;<span class="ident" id="4624947">err</span><span class="op" id="4624950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4624953">}</span>&nbsp;<span class="keyword" id="4624955">else</span>&nbsp;<span class="op" id="4624960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624964">log</span><span class="op" id="4624967">.</span><span class="ident" id="4624968">Printf</span><span class="op" id="4624974">(</span><span class="string" id="4624975">&#34;%s&nbsp;%x&#34;</span><span class="op" id="4624982">,</span>&nbsp;<span class="ident" id="4624984">l</span><span class="op" id="4624985">.</span><span class="ident" id="4624986">prefix</span><span class="op" id="4624992">,</span>&nbsp;<span class="ident" id="4624994">p</span><span class="op" id="4624995">[</span><span class="num" id="4624996">0</span><span class="op" id="4624997">:</span><span class="ident" id="4624998">n</span><span class="op" id="4624999">]</span><span class="op" id="4625000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4625003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4625006">return</span><br>
<span class="lineno">25</span><span class="op" id="4625013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4625016">//&nbsp;NewWriteLogger&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that&nbsp;behaves&nbsp;like&nbsp;w&nbsp;except</span><br>
<span class="lineno"></span><span class="comment" id="4625078">//&nbsp;that&nbsp;it&nbsp;logs&nbsp;(using&nbsp;log.Printf)&nbsp;each&nbsp;write&nbsp;to&nbsp;standard&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="4625143">//&nbsp;printing&nbsp;the&nbsp;prefix&nbsp;and&nbsp;the&nbsp;hexadecimal&nbsp;data&nbsp;written.</span><br>
<span class="lineno">30</span><span class="keyword" id="4625200">func</span>&nbsp;<span class="ident" id="4625205">NewWriteLogger</span><span class="op" id="4625219">(</span><span class="ident" id="4625220">prefix</span>&nbsp;<span class="builtintype" id="4625227">string</span><span class="op" id="4625233">,</span>&nbsp;<span class="ident" id="4625235">w</span>&nbsp;<span class="ident" id="4625237">io</span><span class="op" id="4625239">.</span><span class="ident" id="4625240">Writer</span><span class="op" id="4625246">)</span>&nbsp;<span class="ident" id="4625248">io</span><span class="op" id="4625250">.</span><span class="ident" id="4625251">Writer</span>&nbsp;<span class="op" id="4625258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4625261">return</span>&nbsp;<span class="op" id="4625268">&amp;</span><span class="ident" id="4625269">writeLogger</span><span class="op" id="4625280">{</span><span class="ident" id="4625281">prefix</span><span class="op" id="4625287">,</span>&nbsp;<span class="ident" id="4625289">w</span><span class="op" id="4625290">}</span><br>
<span class="lineno"></span><span class="op" id="4625292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4625295">type</span>&nbsp;<span class="ident" id="4625300">readLogger</span>&nbsp;<span class="keyword" id="4625311">struct</span>&nbsp;<span class="op" id="4625318">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625321">prefix</span>&nbsp;<span class="builtintype" id="4625328">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625336">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625343">io</span><span class="op" id="4625345">.</span><span class="ident" id="4625346">Reader</span><br>
<span class="lineno"></span><span class="op" id="4625353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4625356">func</span>&nbsp;<span class="op" id="4625361">(</span><span class="ident" id="4625362">l</span>&nbsp;<span class="op" id="4625364">*</span><span class="ident" id="4625365">readLogger</span><span class="op" id="4625375">)</span>&nbsp;<span class="ident" id="4625377">Read</span><span class="op" id="4625381">(</span><span class="ident" id="4625382">p</span>&nbsp;<span class="op" id="4625384">[</span><span class="op" id="4625385">]</span><span class="builtintype" id="4625386">byte</span><span class="op" id="4625390">)</span>&nbsp;<span class="op" id="4625392">(</span><span class="ident" id="4625393">n</span>&nbsp;<span class="builtintype" id="4625395">int</span><span class="op" id="4625398">,</span>&nbsp;<span class="ident" id="4625400">err</span>&nbsp;<span class="builtintype" id="4625404">error</span><span class="op" id="4625409">)</span>&nbsp;<span class="op" id="4625411">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625414">n</span><span class="op" id="4625415">,</span>&nbsp;<span class="ident" id="4625417">err</span>&nbsp;<span class="op" id="4625421">=</span>&nbsp;<span class="ident" id="4625423">l</span><span class="op" id="4625424">.</span><span class="ident" id="4625425">r</span><span class="op" id="4625426">.</span><span class="ident" id="4625427">Read</span><span class="op" id="4625431">(</span><span class="ident" id="4625432">p</span><span class="op" id="4625433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4625436">if</span>&nbsp;<span class="ident" id="4625439">err</span>&nbsp;<span class="op" id="4625443">!=</span>&nbsp;<span class="ident" id="4625446">nil</span>&nbsp;<span class="op" id="4625450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625454">log</span><span class="op" id="4625457">.</span><span class="ident" id="4625458">Printf</span><span class="op" id="4625464">(</span><span class="string" id="4625465">&#34;%s&nbsp;%x:&nbsp;%v&#34;</span><span class="op" id="4625476">,</span>&nbsp;<span class="ident" id="4625478">l</span><span class="op" id="4625479">.</span><span class="ident" id="4625480">prefix</span><span class="op" id="4625486">,</span>&nbsp;<span class="ident" id="4625488">p</span><span class="op" id="4625489">[</span><span class="num" id="4625490">0</span><span class="op" id="4625491">:</span><span class="ident" id="4625492">n</span><span class="op" id="4625493">]</span><span class="op" id="4625494">,</span>&nbsp;<span class="ident" id="4625496">err</span><span class="op" id="4625499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4625502">}</span>&nbsp;<span class="keyword" id="4625504">else</span>&nbsp;<span class="op" id="4625509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625513">log</span><span class="op" id="4625516">.</span><span class="ident" id="4625517">Printf</span><span class="op" id="4625523">(</span><span class="string" id="4625524">&#34;%s&nbsp;%x&#34;</span><span class="op" id="4625531">,</span>&nbsp;<span class="ident" id="4625533">l</span><span class="op" id="4625534">.</span><span class="ident" id="4625535">prefix</span><span class="op" id="4625541">,</span>&nbsp;<span class="ident" id="4625543">p</span><span class="op" id="4625544">[</span><span class="num" id="4625545">0</span><span class="op" id="4625546">:</span><span class="ident" id="4625547">n</span><span class="op" id="4625548">]</span><span class="op" id="4625549">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4625552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4625555">return</span><br>
<span class="lineno"></span><span class="op" id="4625562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4625565">//&nbsp;NewReadLogger&nbsp;returns&nbsp;a&nbsp;reader&nbsp;that&nbsp;behaves&nbsp;like&nbsp;r&nbsp;except</span><br>
<span class="lineno">50</span><span class="comment" id="4625626">//&nbsp;that&nbsp;it&nbsp;logs&nbsp;(using&nbsp;log.Print)&nbsp;each&nbsp;read&nbsp;to&nbsp;standard&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="4625689">//&nbsp;printing&nbsp;the&nbsp;prefix&nbsp;and&nbsp;the&nbsp;hexadecimal&nbsp;data&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="4625746">func</span>&nbsp;<span class="ident" id="4625751">NewReadLogger</span><span class="op" id="4625764">(</span><span class="ident" id="4625765">prefix</span>&nbsp;<span class="builtintype" id="4625772">string</span><span class="op" id="4625778">,</span>&nbsp;<span class="ident" id="4625780">r</span>&nbsp;<span class="ident" id="4625782">io</span><span class="op" id="4625784">.</span><span class="ident" id="4625785">Reader</span><span class="op" id="4625791">)</span>&nbsp;<span class="ident" id="4625793">io</span><span class="op" id="4625795">.</span><span class="ident" id="4625796">Reader</span>&nbsp;<span class="op" id="4625803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4625806">return</span>&nbsp;<span class="op" id="4625813">&amp;</span><span class="ident" id="4625814">readLogger</span><span class="op" id="4625824">{</span><span class="ident" id="4625825">prefix</span><span class="op" id="4625831">,</span>&nbsp;<span class="ident" id="4625833">r</span><span class="op" id="4625834">}</span><br>
<span class="lineno"></span><span class="op" id="4625836">}</span>
</div>
</body>
</html>
