<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3275219">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3275275">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3275329">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3275380">package</span>&nbsp;<span class="ident" id="3275388">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3275393">import</span>&nbsp;<span class="op" id="3275400">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3275403">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3275413">&#34;time&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3275420">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3275423">//&nbsp;A&nbsp;Dialer&nbsp;contains&nbsp;options&nbsp;for&nbsp;connecting&nbsp;to&nbsp;an&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3275482">//</span><br>
<span class="lineno"></span><span class="comment" id="3275485">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;each&nbsp;field&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;dialing</span><br>
<span class="lineno">15</span><span class="comment" id="3275543">//&nbsp;without&nbsp;that&nbsp;option.&nbsp;Dialing&nbsp;with&nbsp;the&nbsp;zero&nbsp;value&nbsp;of&nbsp;Dialer</span><br>
<span class="lineno"></span><span class="comment" id="3275605">//&nbsp;is&nbsp;therefore&nbsp;equivalent&nbsp;to&nbsp;just&nbsp;calling&nbsp;the&nbsp;Dial&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="3275667">type</span>&nbsp;<span class="ident" id="3275672">Dialer</span>&nbsp;<span class="keyword" id="3275679">struct</span>&nbsp;<span class="op" id="3275686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3275689">//&nbsp;Timeout&nbsp;is&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;time&nbsp;a&nbsp;dial&nbsp;will&nbsp;wait&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3275752">//&nbsp;a&nbsp;connect&nbsp;to&nbsp;complete.&nbsp;If&nbsp;Deadline&nbsp;is&nbsp;also&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3275816">//&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3275829">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3275833">//&nbsp;The&nbsp;default&nbsp;is&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3275864">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3275868">//&nbsp;With&nbsp;or&nbsp;without&nbsp;a&nbsp;timeout,&nbsp;the&nbsp;operating&nbsp;system&nbsp;may&nbsp;impose</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3275931">//&nbsp;its&nbsp;own&nbsp;earlier&nbsp;timeout.&nbsp;For&nbsp;instance,&nbsp;TCP&nbsp;timeouts&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3275991">//&nbsp;often&nbsp;around&nbsp;3&nbsp;minutes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3276019">Timeout</span>&nbsp;<span class="ident" id="3276027">time</span><span class="op" id="3276031">.</span><span class="ident" id="3276032">Duration</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276043">//&nbsp;Deadline&nbsp;is&nbsp;the&nbsp;absolute&nbsp;point&nbsp;in&nbsp;time&nbsp;after&nbsp;which&nbsp;dials</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276104">//&nbsp;will&nbsp;fail.&nbsp;If&nbsp;Timeout&nbsp;is&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276159">//&nbsp;Zero&nbsp;means&nbsp;no&nbsp;deadline,&nbsp;or&nbsp;dependent&nbsp;on&nbsp;the&nbsp;operating&nbsp;system</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276224">//&nbsp;as&nbsp;with&nbsp;the&nbsp;Timeout&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3276256">Deadline</span>&nbsp;<span class="ident" id="3276265">time</span><span class="op" id="3276269">.</span><span class="ident" id="3276270">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276277">//&nbsp;LocalAddr&nbsp;is&nbsp;the&nbsp;local&nbsp;address&nbsp;to&nbsp;use&nbsp;when&nbsp;dialing&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276335">//&nbsp;address.&nbsp;The&nbsp;address&nbsp;must&nbsp;be&nbsp;of&nbsp;a&nbsp;compatible&nbsp;type&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276397">//&nbsp;network&nbsp;being&nbsp;dialed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276423">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;local&nbsp;address&nbsp;is&nbsp;automatically&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3276476">LocalAddr</span>&nbsp;<span class="ident" id="3276486">Addr</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276493">//&nbsp;DualStack&nbsp;allows&nbsp;a&nbsp;single&nbsp;dial&nbsp;to&nbsp;attempt&nbsp;to&nbsp;establish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276552">//&nbsp;multiple&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;connections&nbsp;and&nbsp;to&nbsp;return&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276615">//&nbsp;established&nbsp;connection&nbsp;when&nbsp;the&nbsp;network&nbsp;is&nbsp;&#34;tcp&#34;&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276676">//&nbsp;destination&nbsp;is&nbsp;a&nbsp;host&nbsp;name&nbsp;that&nbsp;has&nbsp;multiple&nbsp;address&nbsp;family</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276740">//&nbsp;DNS&nbsp;records.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3276757">DualStack</span>&nbsp;<span class="builtintype" id="3276767">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276774">//&nbsp;KeepAlive&nbsp;specifies&nbsp;the&nbsp;keep-alive&nbsp;period&nbsp;for&nbsp;an&nbsp;active</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276834">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276858">//&nbsp;If&nbsp;zero,&nbsp;keep-alives&nbsp;are&nbsp;not&nbsp;enabled.&nbsp;Network&nbsp;protocols</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3276918">//&nbsp;that&nbsp;do&nbsp;not&nbsp;support&nbsp;keep-alives&nbsp;ignore&nbsp;this&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3276973">KeepAlive</span>&nbsp;<span class="ident" id="3276983">time</span><span class="op" id="3276987">.</span><span class="ident" id="3276988">Duration</span><br>
<span class="lineno"></span><span class="op" id="3276997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3277000">//&nbsp;Return&nbsp;either&nbsp;now+Timeout&nbsp;or&nbsp;Deadline,&nbsp;whichever&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="3277065">//&nbsp;Or&nbsp;zero,&nbsp;if&nbsp;neither&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3277096">func</span>&nbsp;<span class="op" id="3277101">(</span><span class="ident" id="3277102">d</span>&nbsp;<span class="op" id="3277104">*</span><span class="ident" id="3277105">Dialer</span><span class="op" id="3277111">)</span>&nbsp;<span class="ident" id="3277113">deadline</span><span class="op" id="3277121">(</span><span class="op" id="3277122">)</span>&nbsp;<span class="ident" id="3277124">time</span><span class="op" id="3277128">.</span><span class="ident" id="3277129">Time</span>&nbsp;<span class="op" id="3277134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277137">if</span>&nbsp;<span class="ident" id="3277140">d</span><span class="op" id="3277141">.</span><span class="ident" id="3277142">Timeout</span>&nbsp;<span class="op" id="3277150">==</span>&nbsp;<span class="num" id="3277153">0</span>&nbsp;<span class="op" id="3277155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277159">return</span>&nbsp;<span class="ident" id="3277166">d</span><span class="op" id="3277167">.</span><span class="ident" id="3277168">Deadline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277181">timeoutDeadline</span>&nbsp;<span class="op" id="3277197">:=</span>&nbsp;<span class="ident" id="3277200">time</span><span class="op" id="3277204">.</span><span class="ident" id="3277205">Now</span><span class="op" id="3277208">(</span><span class="op" id="3277209">)</span><span class="op" id="3277210">.</span><span class="ident" id="3277211">Add</span><span class="op" id="3277214">(</span><span class="ident" id="3277215">d</span><span class="op" id="3277216">.</span><span class="ident" id="3277217">Timeout</span><span class="op" id="3277224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277227">if</span>&nbsp;<span class="ident" id="3277230">d</span><span class="op" id="3277231">.</span><span class="ident" id="3277232">Deadline</span><span class="op" id="3277240">.</span><span class="ident" id="3277241">IsZero</span><span class="op" id="3277247">(</span><span class="op" id="3277248">)</span>&nbsp;<span class="op" id="3277250">||</span>&nbsp;<span class="ident" id="3277253">timeoutDeadline</span><span class="op" id="3277268">.</span><span class="ident" id="3277269">Before</span><span class="op" id="3277275">(</span><span class="ident" id="3277276">d</span><span class="op" id="3277277">.</span><span class="ident" id="3277278">Deadline</span><span class="op" id="3277286">)</span>&nbsp;<span class="op" id="3277288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277292">return</span>&nbsp;<span class="ident" id="3277299">timeoutDeadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277316">}</span>&nbsp;<span class="keyword" id="3277318">else</span>&nbsp;<span class="op" id="3277323">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277327">return</span>&nbsp;<span class="ident" id="3277334">d</span><span class="op" id="3277335">.</span><span class="ident" id="3277336">Deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277346">}</span><br>
<span class="lineno"></span><span class="op" id="3277348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3277351">func</span>&nbsp;<span class="ident" id="3277356">parseNetwork</span><span class="op" id="3277368">(</span><span class="ident" id="3277369">net</span>&nbsp;<span class="builtintype" id="3277373">string</span><span class="op" id="3277379">)</span>&nbsp;<span class="op" id="3277381">(</span><span class="ident" id="3277382">afnet</span>&nbsp;<span class="builtintype" id="3277388">string</span><span class="op" id="3277394">,</span>&nbsp;<span class="ident" id="3277396">proto</span>&nbsp;<span class="builtintype" id="3277402">int</span><span class="op" id="3277405">,</span>&nbsp;<span class="ident" id="3277407">err</span>&nbsp;<span class="builtintype" id="3277411">error</span><span class="op" id="3277416">)</span>&nbsp;<span class="op" id="3277418">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277421">i</span>&nbsp;<span class="op" id="3277423">:=</span>&nbsp;<span class="ident" id="3277426">last</span><span class="op" id="3277430">(</span><span class="ident" id="3277431">net</span><span class="op" id="3277434">,</span>&nbsp;<span class="string" id="3277436">&#39;:&#39;</span><span class="op" id="3277439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277442">if</span>&nbsp;<span class="ident" id="3277445">i</span>&nbsp;<span class="op" id="3277447">&lt;</span>&nbsp;<span class="num" id="3277449">0</span>&nbsp;<span class="op" id="3277451">{</span>&nbsp;<span class="comment" id="3277453">//&nbsp;no&nbsp;colon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277467">switch</span>&nbsp;<span class="ident" id="3277474">net</span>&nbsp;<span class="op" id="3277478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277482">case</span>&nbsp;<span class="string" id="3277487">&#34;tcp&#34;</span><span class="op" id="3277492">,</span>&nbsp;<span class="string" id="3277494">&#34;tcp4&#34;</span><span class="op" id="3277500">,</span>&nbsp;<span class="string" id="3277502">&#34;tcp6&#34;</span><span class="op" id="3277508">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277512">case</span>&nbsp;<span class="string" id="3277517">&#34;udp&#34;</span><span class="op" id="3277522">,</span>&nbsp;<span class="string" id="3277524">&#34;udp4&#34;</span><span class="op" id="3277530">,</span>&nbsp;<span class="string" id="3277532">&#34;udp6&#34;</span><span class="op" id="3277538">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277542">case</span>&nbsp;<span class="string" id="3277547">&#34;ip&#34;</span><span class="op" id="3277551">,</span>&nbsp;<span class="string" id="3277553">&#34;ip4&#34;</span><span class="op" id="3277558">,</span>&nbsp;<span class="string" id="3277560">&#34;ip6&#34;</span><span class="op" id="3277565">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277569">case</span>&nbsp;<span class="string" id="3277574">&#34;unix&#34;</span><span class="op" id="3277580">,</span>&nbsp;<span class="string" id="3277582">&#34;unixgram&#34;</span><span class="op" id="3277592">,</span>&nbsp;<span class="string" id="3277594">&#34;unixpacket&#34;</span><span class="op" id="3277606">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277610">default</span><span class="op" id="3277617">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277622">return</span>&nbsp;<span class="string" id="3277629">&#34;&#34;</span><span class="op" id="3277631">,</span>&nbsp;<span class="num" id="3277633">0</span><span class="op" id="3277634">,</span>&nbsp;<span class="ident" id="3277636">UnknownNetworkError</span><span class="op" id="3277655">(</span><span class="ident" id="3277656">net</span><span class="op" id="3277659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277663">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277667">return</span>&nbsp;<span class="ident" id="3277674">net</span><span class="op" id="3277677">,</span>&nbsp;<span class="num" id="3277679">0</span><span class="op" id="3277680">,</span>&nbsp;<span class="ident" id="3277682">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277690">afnet</span>&nbsp;<span class="op" id="3277696">=</span>&nbsp;<span class="ident" id="3277698">net</span><span class="op" id="3277701">[</span><span class="op" id="3277702">:</span><span class="ident" id="3277703">i</span><span class="op" id="3277704">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277707">switch</span>&nbsp;<span class="ident" id="3277714">afnet</span>&nbsp;<span class="op" id="3277720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277723">case</span>&nbsp;<span class="string" id="3277728">&#34;ip&#34;</span><span class="op" id="3277732">,</span>&nbsp;<span class="string" id="3277734">&#34;ip4&#34;</span><span class="op" id="3277739">,</span>&nbsp;<span class="string" id="3277741">&#34;ip6&#34;</span><span class="op" id="3277746">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277750">protostr</span>&nbsp;<span class="op" id="3277759">:=</span>&nbsp;<span class="ident" id="3277762">net</span><span class="op" id="3277765">[</span><span class="ident" id="3277766">i</span><span class="op" id="3277767">+</span><span class="num" id="3277768">1</span><span class="op" id="3277769">:</span><span class="op" id="3277770">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277774">proto</span><span class="op" id="3277779">,</span>&nbsp;<span class="ident" id="3277781">i</span><span class="op" id="3277782">,</span>&nbsp;<span class="ident" id="3277784">ok</span>&nbsp;<span class="op" id="3277787">:=</span>&nbsp;<span class="ident" id="3277790">dtoi</span><span class="op" id="3277794">(</span><span class="ident" id="3277795">protostr</span><span class="op" id="3277803">,</span>&nbsp;<span class="num" id="3277805">0</span><span class="op" id="3277806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277810">if</span>&nbsp;<span class="op" id="3277813">!</span><span class="ident" id="3277814">ok</span>&nbsp;<span class="op" id="3277817">||</span>&nbsp;<span class="ident" id="3277820">i</span>&nbsp;<span class="op" id="3277822">!=</span>&nbsp;<span class="builtinfunc" id="3277825">len</span><span class="op" id="3277828">(</span><span class="ident" id="3277829">protostr</span><span class="op" id="3277837">)</span>&nbsp;<span class="op" id="3277839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3277844">proto</span><span class="op" id="3277849">,</span>&nbsp;<span class="ident" id="3277851">err</span>&nbsp;<span class="op" id="3277855">=</span>&nbsp;<span class="ident" id="3277857">lookupProtocol</span><span class="op" id="3277871">(</span><span class="ident" id="3277872">protostr</span><span class="op" id="3277880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277885">if</span>&nbsp;<span class="ident" id="3277888">err</span>&nbsp;<span class="op" id="3277892">!=</span>&nbsp;<span class="ident" id="3277895">nil</span>&nbsp;<span class="op" id="3277899">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277905">return</span>&nbsp;<span class="string" id="3277912">&#34;&#34;</span><span class="op" id="3277914">,</span>&nbsp;<span class="num" id="3277916">0</span><span class="op" id="3277917">,</span>&nbsp;<span class="ident" id="3277919">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277934">return</span>&nbsp;<span class="ident" id="3277941">afnet</span><span class="op" id="3277946">,</span>&nbsp;<span class="ident" id="3277948">proto</span><span class="op" id="3277953">,</span>&nbsp;<span class="ident" id="3277955">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3277960">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3277963">return</span>&nbsp;<span class="string" id="3277970">&#34;&#34;</span><span class="op" id="3277972">,</span>&nbsp;<span class="num" id="3277974">0</span><span class="op" id="3277975">,</span>&nbsp;<span class="ident" id="3277977">UnknownNetworkError</span><span class="op" id="3277996">(</span><span class="ident" id="3277997">net</span><span class="op" id="3278000">)</span><br>
<span class="lineno"></span><span class="op" id="3278002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3278005">func</span>&nbsp;<span class="ident" id="3278010">resolveAddr</span><span class="op" id="3278021">(</span><span class="ident" id="3278022">op</span><span class="op" id="3278024">,</span>&nbsp;<span class="ident" id="3278026">net</span><span class="op" id="3278029">,</span>&nbsp;<span class="ident" id="3278031">addr</span>&nbsp;<span class="builtintype" id="3278036">string</span><span class="op" id="3278042">,</span>&nbsp;<span class="ident" id="3278044">deadline</span>&nbsp;<span class="ident" id="3278053">time</span><span class="op" id="3278057">.</span><span class="ident" id="3278058">Time</span><span class="op" id="3278062">)</span>&nbsp;<span class="op" id="3278064">(</span><span class="ident" id="3278065">netaddr</span><span class="op" id="3278072">,</span>&nbsp;<span class="builtintype" id="3278074">error</span><span class="op" id="3278079">)</span>&nbsp;<span class="op" id="3278081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3278084">afnet</span><span class="op" id="3278089">,</span>&nbsp;<span class="ident" id="3278091">_</span><span class="op" id="3278092">,</span>&nbsp;<span class="ident" id="3278094">err</span>&nbsp;<span class="op" id="3278098">:=</span>&nbsp;<span class="ident" id="3278101">parseNetwork</span><span class="op" id="3278113">(</span><span class="ident" id="3278114">net</span><span class="op" id="3278117">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278120">if</span>&nbsp;<span class="ident" id="3278123">err</span>&nbsp;<span class="op" id="3278127">!=</span>&nbsp;<span class="ident" id="3278130">nil</span>&nbsp;<span class="op" id="3278134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278138">return</span>&nbsp;<span class="ident" id="3278145">nil</span><span class="op" id="3278148">,</span>&nbsp;<span class="ident" id="3278150">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278158">if</span>&nbsp;<span class="ident" id="3278161">op</span>&nbsp;<span class="op" id="3278164">==</span>&nbsp;<span class="string" id="3278167">&#34;dial&#34;</span>&nbsp;<span class="op" id="3278174">&amp;&amp;</span>&nbsp;<span class="ident" id="3278177">addr</span>&nbsp;<span class="op" id="3278182">==</span>&nbsp;<span class="string" id="3278185">&#34;&#34;</span>&nbsp;<span class="op" id="3278188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278192">return</span>&nbsp;<span class="ident" id="3278199">nil</span><span class="op" id="3278202">,</span>&nbsp;<span class="ident" id="3278204">errMissingAddress</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278226">switch</span>&nbsp;<span class="ident" id="3278233">afnet</span>&nbsp;<span class="op" id="3278239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278242">case</span>&nbsp;<span class="string" id="3278247">&#34;unix&#34;</span><span class="op" id="3278253">,</span>&nbsp;<span class="string" id="3278255">&#34;unixgram&#34;</span><span class="op" id="3278265">,</span>&nbsp;<span class="string" id="3278267">&#34;unixpacket&#34;</span><span class="op" id="3278279">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278283">return</span>&nbsp;<span class="ident" id="3278290">ResolveUnixAddr</span><span class="op" id="3278305">(</span><span class="ident" id="3278306">afnet</span><span class="op" id="3278311">,</span>&nbsp;<span class="ident" id="3278313">addr</span><span class="op" id="3278317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3278320">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3278323">return</span>&nbsp;<span class="ident" id="3278330">resolveInternetAddr</span><span class="op" id="3278349">(</span><span class="ident" id="3278350">afnet</span><span class="op" id="3278355">,</span>&nbsp;<span class="ident" id="3278357">addr</span><span class="op" id="3278361">,</span>&nbsp;<span class="ident" id="3278363">deadline</span><span class="op" id="3278371">)</span><br>
<span class="lineno"></span><span class="op" id="3278373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3278376">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3278430">//</span><br>
<span class="lineno">115</span><span class="comment" id="3278433">//&nbsp;Known&nbsp;networks&nbsp;are&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;tcp6&#34;&nbsp;(IPv6-only),</span><br>
<span class="lineno"></span><span class="comment" id="3278502">//&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;udp6&#34;&nbsp;(IPv6-only),&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3278564">//&nbsp;(IPv4-only),&nbsp;&#34;ip6&#34;&nbsp;(IPv6-only),&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3278622">//&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3278639">//</span><br>
<span class="lineno">120</span><span class="comment" id="3278642">//&nbsp;For&nbsp;TCP&nbsp;and&nbsp;UDP&nbsp;networks,&nbsp;addresses&nbsp;have&nbsp;the&nbsp;form&nbsp;host:port.</span><br>
<span class="lineno"></span><span class="comment" id="3278706">//&nbsp;If&nbsp;host&nbsp;is&nbsp;a&nbsp;literal&nbsp;IPv6&nbsp;address&nbsp;it&nbsp;must&nbsp;be&nbsp;enclosed</span><br>
<span class="lineno"></span><span class="comment" id="3278763">//&nbsp;in&nbsp;square&nbsp;brackets&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3278828">//&nbsp;The&nbsp;functions&nbsp;JoinHostPort&nbsp;and&nbsp;SplitHostPort&nbsp;manipulate&nbsp;addresses</span><br>
<span class="lineno"></span><span class="comment" id="3278897">//&nbsp;in&nbsp;this&nbsp;form.</span><br>
<span class="lineno">125</span><span class="comment" id="3278914">//</span><br>
<span class="lineno"></span><span class="comment" id="3278917">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3278930">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;12.34.56.78:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3278963">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;google.com:http&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3278997">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[2001:db8::1]:http&#34;)</span><br>
<span class="lineno">130</span><span class="comment" id="3279034">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[fe80::1%lo0]:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3279069">//</span><br>
<span class="lineno"></span><span class="comment" id="3279072">//&nbsp;For&nbsp;IP&nbsp;networks,&nbsp;the&nbsp;network&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed</span><br>
<span class="lineno"></span><span class="comment" id="3279142">//&nbsp;by&nbsp;a&nbsp;colon&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name&nbsp;and&nbsp;the&nbsp;addr&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3279209">//&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">135</span><span class="comment" id="3279232">//</span><br>
<span class="lineno"></span><span class="comment" id="3279235">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3279248">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip4:1&#34;,&nbsp;&#34;127.0.0.1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3279278">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip6:ospf&#34;,&nbsp;&#34;::1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3279305">//</span><br>
<span class="lineno">140</span><span class="comment" id="3279308">//&nbsp;For&nbsp;Unix&nbsp;networks,&nbsp;the&nbsp;address&nbsp;must&nbsp;be&nbsp;a&nbsp;file&nbsp;system&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="3279370">func</span>&nbsp;<span class="ident" id="3279375">Dial</span><span class="op" id="3279379">(</span><span class="ident" id="3279380">network</span><span class="op" id="3279387">,</span>&nbsp;<span class="ident" id="3279389">address</span>&nbsp;<span class="builtintype" id="3279397">string</span><span class="op" id="3279403">)</span>&nbsp;<span class="op" id="3279405">(</span><span class="ident" id="3279406">Conn</span><span class="op" id="3279410">,</span>&nbsp;<span class="builtintype" id="3279412">error</span><span class="op" id="3279417">)</span>&nbsp;<span class="op" id="3279419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279422">var</span>&nbsp;<span class="ident" id="3279426">d</span>&nbsp;<span class="ident" id="3279428">Dialer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279436">return</span>&nbsp;<span class="ident" id="3279443">d</span><span class="op" id="3279444">.</span><span class="ident" id="3279445">Dial</span><span class="op" id="3279449">(</span><span class="ident" id="3279450">network</span><span class="op" id="3279457">,</span>&nbsp;<span class="ident" id="3279459">address</span><span class="op" id="3279466">)</span><br>
<span class="lineno"></span><span class="op" id="3279468">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="3279471">//&nbsp;DialTimeout&nbsp;acts&nbsp;like&nbsp;Dial&nbsp;but&nbsp;takes&nbsp;a&nbsp;timeout.</span><br>
<span class="lineno"></span><span class="comment" id="3279522">//&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;name&nbsp;resolution,&nbsp;if&nbsp;required.</span><br>
<span class="lineno"></span><span class="keyword" id="3279576">func</span>&nbsp;<span class="ident" id="3279581">DialTimeout</span><span class="op" id="3279592">(</span><span class="ident" id="3279593">network</span><span class="op" id="3279600">,</span>&nbsp;<span class="ident" id="3279602">address</span>&nbsp;<span class="builtintype" id="3279610">string</span><span class="op" id="3279616">,</span>&nbsp;<span class="ident" id="3279618">timeout</span>&nbsp;<span class="ident" id="3279626">time</span><span class="op" id="3279630">.</span><span class="ident" id="3279631">Duration</span><span class="op" id="3279639">)</span>&nbsp;<span class="op" id="3279641">(</span><span class="ident" id="3279642">Conn</span><span class="op" id="3279646">,</span>&nbsp;<span class="builtintype" id="3279648">error</span><span class="op" id="3279653">)</span>&nbsp;<span class="op" id="3279655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3279658">d</span>&nbsp;<span class="op" id="3279660">:=</span>&nbsp;<span class="ident" id="3279663">Dialer</span><span class="op" id="3279669">{</span><span class="ident" id="3279670">Timeout</span><span class="op" id="3279677">:</span>&nbsp;<span class="ident" id="3279679">timeout</span><span class="op" id="3279686">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279689">return</span>&nbsp;<span class="ident" id="3279696">d</span><span class="op" id="3279697">.</span><span class="ident" id="3279698">Dial</span><span class="op" id="3279702">(</span><span class="ident" id="3279703">network</span><span class="op" id="3279710">,</span>&nbsp;<span class="ident" id="3279712">address</span><span class="op" id="3279719">)</span><br>
<span class="lineno"></span><span class="op" id="3279721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3279724">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3279778">//</span><br>
<span class="lineno">155</span><span class="comment" id="3279781">//&nbsp;See&nbsp;func&nbsp;Dial&nbsp;for&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;network&nbsp;and&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3279843">//&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="3279858">func</span>&nbsp;<span class="op" id="3279863">(</span><span class="ident" id="3279864">d</span>&nbsp;<span class="op" id="3279866">*</span><span class="ident" id="3279867">Dialer</span><span class="op" id="3279873">)</span>&nbsp;<span class="ident" id="3279875">Dial</span><span class="op" id="3279879">(</span><span class="ident" id="3279880">network</span><span class="op" id="3279887">,</span>&nbsp;<span class="ident" id="3279889">address</span>&nbsp;<span class="builtintype" id="3279897">string</span><span class="op" id="3279903">)</span>&nbsp;<span class="op" id="3279905">(</span><span class="ident" id="3279906">Conn</span><span class="op" id="3279910">,</span>&nbsp;<span class="builtintype" id="3279912">error</span><span class="op" id="3279917">)</span>&nbsp;<span class="op" id="3279919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3279922">ra</span><span class="op" id="3279924">,</span>&nbsp;<span class="ident" id="3279926">err</span>&nbsp;<span class="op" id="3279930">:=</span>&nbsp;<span class="ident" id="3279933">resolveAddr</span><span class="op" id="3279944">(</span><span class="string" id="3279945">&#34;dial&#34;</span><span class="op" id="3279951">,</span>&nbsp;<span class="ident" id="3279953">network</span><span class="op" id="3279960">,</span>&nbsp;<span class="ident" id="3279962">address</span><span class="op" id="3279969">,</span>&nbsp;<span class="ident" id="3279971">d</span><span class="op" id="3279972">.</span><span class="ident" id="3279973">deadline</span><span class="op" id="3279981">(</span><span class="op" id="3279982">)</span><span class="op" id="3279983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3279986">if</span>&nbsp;<span class="ident" id="3279989">err</span>&nbsp;<span class="op" id="3279993">!=</span>&nbsp;<span class="ident" id="3279996">nil</span>&nbsp;<span class="op" id="3280000">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280004">return</span>&nbsp;<span class="ident" id="3280011">nil</span><span class="op" id="3280014">,</span>&nbsp;<span class="op" id="3280016">&amp;</span><span class="ident" id="3280017">OpError</span><span class="op" id="3280024">{</span><span class="ident" id="3280025">Op</span><span class="op" id="3280027">:</span>&nbsp;<span class="string" id="3280029">&#34;dial&#34;</span><span class="op" id="3280035">,</span>&nbsp;<span class="ident" id="3280037">Net</span><span class="op" id="3280040">:</span>&nbsp;<span class="ident" id="3280042">network</span><span class="op" id="3280049">,</span>&nbsp;<span class="ident" id="3280051">Addr</span><span class="op" id="3280055">:</span>&nbsp;<span class="ident" id="3280057">nil</span><span class="op" id="3280060">,</span>&nbsp;<span class="ident" id="3280062">Err</span><span class="op" id="3280065">:</span>&nbsp;<span class="ident" id="3280067">err</span><span class="op" id="3280070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280076">dialer</span>&nbsp;<span class="op" id="3280083">:=</span>&nbsp;<span class="keyword" id="3280086">func</span><span class="op" id="3280090">(</span><span class="ident" id="3280091">deadline</span>&nbsp;<span class="ident" id="3280100">time</span><span class="op" id="3280104">.</span><span class="ident" id="3280105">Time</span><span class="op" id="3280109">)</span>&nbsp;<span class="op" id="3280111">(</span><span class="ident" id="3280112">Conn</span><span class="op" id="3280116">,</span>&nbsp;<span class="builtintype" id="3280118">error</span><span class="op" id="3280123">)</span>&nbsp;<span class="op" id="3280125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280129">return</span>&nbsp;<span class="ident" id="3280136">dialSingle</span><span class="op" id="3280146">(</span><span class="ident" id="3280147">network</span><span class="op" id="3280154">,</span>&nbsp;<span class="ident" id="3280156">address</span><span class="op" id="3280163">,</span>&nbsp;<span class="ident" id="3280165">d</span><span class="op" id="3280166">.</span><span class="ident" id="3280167">LocalAddr</span><span class="op" id="3280176">,</span>&nbsp;<span class="ident" id="3280178">ra</span><span class="op" id="3280180">.</span><span class="ident" id="3280181">toAddr</span><span class="op" id="3280187">(</span><span class="op" id="3280188">)</span><span class="op" id="3280189">,</span>&nbsp;<span class="ident" id="3280191">deadline</span><span class="op" id="3280199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280202">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280205">if</span>&nbsp;<span class="ident" id="3280208">ras</span><span class="op" id="3280211">,</span>&nbsp;<span class="ident" id="3280213">ok</span>&nbsp;<span class="op" id="3280216">:=</span>&nbsp;<span class="ident" id="3280219">ra</span><span class="op" id="3280221">.</span><span class="op" id="3280222">(</span><span class="ident" id="3280223">addrList</span><span class="op" id="3280231">)</span><span class="op" id="3280232">;</span>&nbsp;<span class="ident" id="3280234">ok</span>&nbsp;<span class="op" id="3280237">&amp;&amp;</span>&nbsp;<span class="ident" id="3280240">d</span><span class="op" id="3280241">.</span><span class="ident" id="3280242">DualStack</span>&nbsp;<span class="op" id="3280252">&amp;&amp;</span>&nbsp;<span class="ident" id="3280255">network</span>&nbsp;<span class="op" id="3280263">==</span>&nbsp;<span class="string" id="3280266">&#34;tcp&#34;</span>&nbsp;<span class="op" id="3280272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280276">dialer</span>&nbsp;<span class="op" id="3280283">=</span>&nbsp;<span class="keyword" id="3280285">func</span><span class="op" id="3280289">(</span><span class="ident" id="3280290">deadline</span>&nbsp;<span class="ident" id="3280299">time</span><span class="op" id="3280303">.</span><span class="ident" id="3280304">Time</span><span class="op" id="3280308">)</span>&nbsp;<span class="op" id="3280310">(</span><span class="ident" id="3280311">Conn</span><span class="op" id="3280315">,</span>&nbsp;<span class="builtintype" id="3280317">error</span><span class="op" id="3280322">)</span>&nbsp;<span class="op" id="3280324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280329">return</span>&nbsp;<span class="ident" id="3280336">dialMulti</span><span class="op" id="3280345">(</span><span class="ident" id="3280346">network</span><span class="op" id="3280353">,</span>&nbsp;<span class="ident" id="3280355">address</span><span class="op" id="3280362">,</span>&nbsp;<span class="ident" id="3280364">d</span><span class="op" id="3280365">.</span><span class="ident" id="3280366">LocalAddr</span><span class="op" id="3280375">,</span>&nbsp;<span class="ident" id="3280377">ras</span><span class="op" id="3280380">,</span>&nbsp;<span class="ident" id="3280382">deadline</span><span class="op" id="3280390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280397">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280400">c</span><span class="op" id="3280401">,</span>&nbsp;<span class="ident" id="3280403">err</span>&nbsp;<span class="op" id="3280407">:=</span>&nbsp;<span class="ident" id="3280410">dial</span><span class="op" id="3280414">(</span><span class="ident" id="3280415">network</span><span class="op" id="3280422">,</span>&nbsp;<span class="ident" id="3280424">ra</span><span class="op" id="3280426">.</span><span class="ident" id="3280427">toAddr</span><span class="op" id="3280433">(</span><span class="op" id="3280434">)</span><span class="op" id="3280435">,</span>&nbsp;<span class="ident" id="3280437">dialer</span><span class="op" id="3280443">,</span>&nbsp;<span class="ident" id="3280445">d</span><span class="op" id="3280446">.</span><span class="ident" id="3280447">deadline</span><span class="op" id="3280455">(</span><span class="op" id="3280456">)</span><span class="op" id="3280457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280460">if</span>&nbsp;<span class="ident" id="3280463">d</span><span class="op" id="3280464">.</span><span class="ident" id="3280465">KeepAlive</span>&nbsp;<span class="op" id="3280475">&gt;</span>&nbsp;<span class="num" id="3280477">0</span>&nbsp;<span class="op" id="3280479">&amp;&amp;</span>&nbsp;<span class="ident" id="3280482">err</span>&nbsp;<span class="op" id="3280486">==</span>&nbsp;<span class="ident" id="3280489">nil</span>&nbsp;<span class="op" id="3280493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280497">if</span>&nbsp;<span class="ident" id="3280500">tc</span><span class="op" id="3280502">,</span>&nbsp;<span class="ident" id="3280504">ok</span>&nbsp;<span class="op" id="3280507">:=</span>&nbsp;<span class="ident" id="3280510">c</span><span class="op" id="3280511">.</span><span class="op" id="3280512">(</span><span class="op" id="3280513">*</span><span class="ident" id="3280514">TCPConn</span><span class="op" id="3280521">)</span><span class="op" id="3280522">;</span>&nbsp;<span class="ident" id="3280524">ok</span>&nbsp;<span class="op" id="3280527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280532">tc</span><span class="op" id="3280534">.</span><span class="ident" id="3280535">SetKeepAlive</span><span class="op" id="3280547">(</span><span class="ident" id="3280548">true</span><span class="op" id="3280552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280557">tc</span><span class="op" id="3280559">.</span><span class="ident" id="3280560">SetKeepAlivePeriod</span><span class="op" id="3280578">(</span><span class="ident" id="3280579">d</span><span class="op" id="3280580">.</span><span class="ident" id="3280581">KeepAlive</span><span class="op" id="3280590">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3280595">testHookSetKeepAlive</span><span class="op" id="3280615">(</span><span class="op" id="3280616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3280623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3280626">return</span>&nbsp;<span class="ident" id="3280633">c</span><span class="op" id="3280634">,</span>&nbsp;<span class="ident" id="3280636">err</span><br>
<span class="lineno"></span><span class="op" id="3280640">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="3280643">var</span>&nbsp;<span class="ident" id="3280647">testHookSetKeepAlive</span>&nbsp;<span class="op" id="3280668">=</span>&nbsp;<span class="keyword" id="3280670">func</span><span class="op" id="3280674">(</span><span class="op" id="3280675">)</span>&nbsp;<span class="op" id="3280677">{</span><span class="op" id="3280678">}</span>&nbsp;<span class="comment" id="3280680">//&nbsp;changed&nbsp;by&nbsp;dial_test.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3280708">//&nbsp;dialMulti&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;connections&nbsp;to&nbsp;each&nbsp;destination&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3280778">//&nbsp;the&nbsp;list&nbsp;of&nbsp;addresses.&nbsp;It&nbsp;will&nbsp;return&nbsp;the&nbsp;first&nbsp;established</span><br>
<span class="lineno">185</span><span class="comment" id="3280841">//&nbsp;connection&nbsp;and&nbsp;close&nbsp;the&nbsp;other&nbsp;connections.&nbsp;Otherwise&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3280909">//&nbsp;error&nbsp;on&nbsp;the&nbsp;last&nbsp;attempt.</span><br>
<span class="lineno"></span><span class="keyword" id="3280939">func</span>&nbsp;<span class="ident" id="3280944">dialMulti</span><span class="op" id="3280953">(</span><span class="ident" id="3280954">net</span><span class="op" id="3280957">,</span>&nbsp;<span class="ident" id="3280959">addr</span>&nbsp;<span class="builtintype" id="3280964">string</span><span class="op" id="3280970">,</span>&nbsp;<span class="ident" id="3280972">la</span>&nbsp;<span class="ident" id="3280975">Addr</span><span class="op" id="3280979">,</span>&nbsp;<span class="ident" id="3280981">ras</span>&nbsp;<span class="ident" id="3280985">addrList</span><span class="op" id="3280993">,</span>&nbsp;<span class="ident" id="3280995">deadline</span>&nbsp;<span class="ident" id="3281004">time</span><span class="op" id="3281008">.</span><span class="ident" id="3281009">Time</span><span class="op" id="3281013">)</span>&nbsp;<span class="op" id="3281015">(</span><span class="ident" id="3281016">Conn</span><span class="op" id="3281020">,</span>&nbsp;<span class="builtintype" id="3281022">error</span><span class="op" id="3281027">)</span>&nbsp;<span class="op" id="3281029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281032">type</span>&nbsp;<span class="ident" id="3281037">racer</span>&nbsp;<span class="keyword" id="3281043">struct</span>&nbsp;<span class="op" id="3281050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281054">Conn</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3281061">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3281071">//&nbsp;Sig&nbsp;controls&nbsp;the&nbsp;flow&nbsp;of&nbsp;dial&nbsp;results&nbsp;on&nbsp;lane.&nbsp;It&nbsp;passes&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3281134">//&nbsp;token&nbsp;to&nbsp;the&nbsp;next&nbsp;racer&nbsp;and&nbsp;also&nbsp;indicates&nbsp;the&nbsp;end&nbsp;of&nbsp;flow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3281197">//&nbsp;by&nbsp;using&nbsp;closed&nbsp;channel.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281226">sig</span>&nbsp;<span class="op" id="3281230">:=</span>&nbsp;<span class="builtinfunc" id="3281233">make</span><span class="op" id="3281237">(</span><span class="keyword" id="3281238">chan</span>&nbsp;<span class="builtintype" id="3281243">bool</span><span class="op" id="3281247">,</span>&nbsp;<span class="num" id="3281249">1</span><span class="op" id="3281250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281253">lane</span>&nbsp;<span class="op" id="3281258">:=</span>&nbsp;<span class="builtinfunc" id="3281261">make</span><span class="op" id="3281265">(</span><span class="keyword" id="3281266">chan</span>&nbsp;<span class="ident" id="3281271">racer</span><span class="op" id="3281276">,</span>&nbsp;<span class="num" id="3281278">1</span><span class="op" id="3281279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281282">for</span>&nbsp;<span class="ident" id="3281286">_</span><span class="op" id="3281287">,</span>&nbsp;<span class="ident" id="3281289">ra</span>&nbsp;<span class="op" id="3281292">:=</span>&nbsp;<span class="keyword" id="3281295">range</span>&nbsp;<span class="ident" id="3281301">ras</span>&nbsp;<span class="op" id="3281305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281309">go</span>&nbsp;<span class="keyword" id="3281312">func</span><span class="op" id="3281316">(</span><span class="ident" id="3281317">ra</span>&nbsp;<span class="ident" id="3281320">Addr</span><span class="op" id="3281324">)</span>&nbsp;<span class="op" id="3281326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281331">c</span><span class="op" id="3281332">,</span>&nbsp;<span class="ident" id="3281334">err</span>&nbsp;<span class="op" id="3281338">:=</span>&nbsp;<span class="ident" id="3281341">dialSingle</span><span class="op" id="3281351">(</span><span class="ident" id="3281352">net</span><span class="op" id="3281355">,</span>&nbsp;<span class="ident" id="3281357">addr</span><span class="op" id="3281361">,</span>&nbsp;<span class="ident" id="3281363">la</span><span class="op" id="3281365">,</span>&nbsp;<span class="ident" id="3281367">ra</span><span class="op" id="3281369">,</span>&nbsp;<span class="ident" id="3281371">deadline</span><span class="op" id="3281379">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281384">if</span>&nbsp;<span class="ident" id="3281387">_</span><span class="op" id="3281388">,</span>&nbsp;<span class="ident" id="3281390">ok</span>&nbsp;<span class="op" id="3281393">:=</span>&nbsp;<span class="op" id="3281396">&lt;-</span><span class="ident" id="3281398">sig</span><span class="op" id="3281401">;</span>&nbsp;<span class="ident" id="3281403">ok</span>&nbsp;<span class="op" id="3281406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281412">lane</span>&nbsp;<span class="op" id="3281417">&lt;-</span>&nbsp;<span class="ident" id="3281420">racer</span><span class="op" id="3281425">{</span><span class="ident" id="3281426">c</span><span class="op" id="3281427">,</span>&nbsp;<span class="ident" id="3281429">err</span><span class="op" id="3281432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281437">}</span>&nbsp;<span class="keyword" id="3281439">else</span>&nbsp;<span class="keyword" id="3281444">if</span>&nbsp;<span class="ident" id="3281447">err</span>&nbsp;<span class="op" id="3281451">==</span>&nbsp;<span class="ident" id="3281454">nil</span>&nbsp;<span class="op" id="3281458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3281464">//&nbsp;We&nbsp;have&nbsp;to&nbsp;return&nbsp;the&nbsp;resources</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3281503">//&nbsp;that&nbsp;belong&nbsp;to&nbsp;the&nbsp;other</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3281535">//&nbsp;connections&nbsp;here&nbsp;for&nbsp;avoiding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3281572">//&nbsp;unnecessary&nbsp;resource&nbsp;starvation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281612">c</span><span class="op" id="3281613">.</span><span class="ident" id="3281614">Close</span><span class="op" id="3281619">(</span><span class="op" id="3281620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281629">}</span><span class="op" id="3281630">(</span><span class="ident" id="3281631">ra</span><span class="op" id="3281633">.</span><span class="ident" id="3281634">toAddr</span><span class="op" id="3281640">(</span><span class="op" id="3281641">)</span><span class="op" id="3281642">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281648">defer</span>&nbsp;<span class="builtinfunc" id="3281654">close</span><span class="op" id="3281659">(</span><span class="ident" id="3281660">sig</span><span class="op" id="3281663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281666">lastErr</span>&nbsp;<span class="op" id="3281674">:=</span>&nbsp;<span class="ident" id="3281677">errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281689">nracers</span>&nbsp;<span class="op" id="3281697">:=</span>&nbsp;<span class="builtinfunc" id="3281700">len</span><span class="op" id="3281703">(</span><span class="ident" id="3281704">ras</span><span class="op" id="3281707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281710">for</span>&nbsp;<span class="ident" id="3281714">nracers</span>&nbsp;<span class="op" id="3281722">&gt;</span>&nbsp;<span class="num" id="3281724">0</span>&nbsp;<span class="op" id="3281726">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281730">sig</span>&nbsp;<span class="op" id="3281734">&lt;-</span>&nbsp;<span class="ident" id="3281737">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281744">racer</span>&nbsp;<span class="op" id="3281750">:=</span>&nbsp;<span class="op" id="3281753">&lt;-</span><span class="ident" id="3281755">lane</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281762">if</span>&nbsp;<span class="ident" id="3281765">racer</span><span class="op" id="3281770">.</span><span class="builtintype" id="3281771">error</span>&nbsp;<span class="op" id="3281777">==</span>&nbsp;<span class="ident" id="3281780">nil</span>&nbsp;<span class="op" id="3281784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281789">return</span>&nbsp;<span class="ident" id="3281796">racer</span><span class="op" id="3281801">.</span><span class="ident" id="3281802">Conn</span><span class="op" id="3281806">,</span>&nbsp;<span class="ident" id="3281808">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281814">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281818">lastErr</span>&nbsp;<span class="op" id="3281826">=</span>&nbsp;<span class="ident" id="3281828">racer</span><span class="op" id="3281833">.</span><span class="builtintype" id="3281834">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3281842">nracers</span><span class="op" id="3281849">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3281853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3281856">return</span>&nbsp;<span class="ident" id="3281863">nil</span><span class="op" id="3281866">,</span>&nbsp;<span class="ident" id="3281868">lastErr</span><br>
<span class="lineno"></span><span class="op" id="3281876">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="3281879">//&nbsp;dialSingle&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;connection&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3281950">//&nbsp;the&nbsp;destination&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3281978">func</span>&nbsp;<span class="ident" id="3281983">dialSingle</span><span class="op" id="3281993">(</span><span class="ident" id="3281994">net</span><span class="op" id="3281997">,</span>&nbsp;<span class="ident" id="3281999">addr</span>&nbsp;<span class="builtintype" id="3282004">string</span><span class="op" id="3282010">,</span>&nbsp;<span class="ident" id="3282012">la</span><span class="op" id="3282014">,</span>&nbsp;<span class="ident" id="3282016">ra</span>&nbsp;<span class="ident" id="3282019">Addr</span><span class="op" id="3282023">,</span>&nbsp;<span class="ident" id="3282025">deadline</span>&nbsp;<span class="ident" id="3282034">time</span><span class="op" id="3282038">.</span><span class="ident" id="3282039">Time</span><span class="op" id="3282043">)</span>&nbsp;<span class="op" id="3282045">(</span><span class="ident" id="3282046">c</span>&nbsp;<span class="ident" id="3282048">Conn</span><span class="op" id="3282052">,</span>&nbsp;<span class="ident" id="3282054">err</span>&nbsp;<span class="builtintype" id="3282058">error</span><span class="op" id="3282063">)</span>&nbsp;<span class="op" id="3282065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282068">if</span>&nbsp;<span class="ident" id="3282071">la</span>&nbsp;<span class="op" id="3282074">!=</span>&nbsp;<span class="ident" id="3282077">nil</span>&nbsp;<span class="op" id="3282081">&amp;&amp;</span>&nbsp;<span class="ident" id="3282084">la</span><span class="op" id="3282086">.</span><span class="ident" id="3282087">Network</span><span class="op" id="3282094">(</span><span class="op" id="3282095">)</span>&nbsp;<span class="op" id="3282097">!=</span>&nbsp;<span class="ident" id="3282100">ra</span><span class="op" id="3282102">.</span><span class="ident" id="3282103">Network</span><span class="op" id="3282110">(</span><span class="op" id="3282111">)</span>&nbsp;<span class="op" id="3282113">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282117">return</span>&nbsp;<span class="ident" id="3282124">nil</span><span class="op" id="3282127">,</span>&nbsp;<span class="op" id="3282129">&amp;</span><span class="ident" id="3282130">OpError</span><span class="op" id="3282137">{</span><span class="ident" id="3282138">Op</span><span class="op" id="3282140">:</span>&nbsp;<span class="string" id="3282142">&#34;dial&#34;</span><span class="op" id="3282148">,</span>&nbsp;<span class="ident" id="3282150">Net</span><span class="op" id="3282153">:</span>&nbsp;<span class="ident" id="3282155">net</span><span class="op" id="3282158">,</span>&nbsp;<span class="ident" id="3282160">Addr</span><span class="op" id="3282164">:</span>&nbsp;<span class="ident" id="3282166">ra</span><span class="op" id="3282168">,</span>&nbsp;<span class="ident" id="3282170">Err</span><span class="op" id="3282173">:</span>&nbsp;<span class="ident" id="3282175">errors</span><span class="op" id="3282181">.</span><span class="ident" id="3282182">New</span><span class="op" id="3282185">(</span><span class="string" id="3282186">&#34;mismatched&nbsp;local&nbsp;address&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3282219">+</span>&nbsp;<span class="ident" id="3282221">la</span><span class="op" id="3282223">.</span><span class="ident" id="3282224">Network</span><span class="op" id="3282231">(</span><span class="op" id="3282232">)</span><span class="op" id="3282233">)</span><span class="op" id="3282234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3282237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282240">switch</span>&nbsp;<span class="ident" id="3282247">ra</span>&nbsp;<span class="op" id="3282250">:=</span>&nbsp;<span class="ident" id="3282253">ra</span><span class="op" id="3282255">.</span><span class="op" id="3282256">(</span><span class="keyword" id="3282257">type</span><span class="op" id="3282261">)</span>&nbsp;<span class="op" id="3282263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282266">case</span>&nbsp;<span class="op" id="3282271">*</span><span class="ident" id="3282272">TCPAddr</span><span class="op" id="3282279">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282283">la</span><span class="op" id="3282285">,</span>&nbsp;<span class="ident" id="3282287">_</span>&nbsp;<span class="op" id="3282289">:=</span>&nbsp;<span class="ident" id="3282292">la</span><span class="op" id="3282294">.</span><span class="op" id="3282295">(</span><span class="op" id="3282296">*</span><span class="ident" id="3282297">TCPAddr</span><span class="op" id="3282304">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282308">c</span><span class="op" id="3282309">,</span>&nbsp;<span class="ident" id="3282311">err</span>&nbsp;<span class="op" id="3282315">=</span>&nbsp;<span class="ident" id="3282317">dialTCP</span><span class="op" id="3282324">(</span><span class="ident" id="3282325">net</span><span class="op" id="3282328">,</span>&nbsp;<span class="ident" id="3282330">la</span><span class="op" id="3282332">,</span>&nbsp;<span class="ident" id="3282334">ra</span><span class="op" id="3282336">,</span>&nbsp;<span class="ident" id="3282338">deadline</span><span class="op" id="3282346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282349">case</span>&nbsp;<span class="op" id="3282354">*</span><span class="ident" id="3282355">UDPAddr</span><span class="op" id="3282362">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282366">la</span><span class="op" id="3282368">,</span>&nbsp;<span class="ident" id="3282370">_</span>&nbsp;<span class="op" id="3282372">:=</span>&nbsp;<span class="ident" id="3282375">la</span><span class="op" id="3282377">.</span><span class="op" id="3282378">(</span><span class="op" id="3282379">*</span><span class="ident" id="3282380">UDPAddr</span><span class="op" id="3282387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282391">c</span><span class="op" id="3282392">,</span>&nbsp;<span class="ident" id="3282394">err</span>&nbsp;<span class="op" id="3282398">=</span>&nbsp;<span class="ident" id="3282400">dialUDP</span><span class="op" id="3282407">(</span><span class="ident" id="3282408">net</span><span class="op" id="3282411">,</span>&nbsp;<span class="ident" id="3282413">la</span><span class="op" id="3282415">,</span>&nbsp;<span class="ident" id="3282417">ra</span><span class="op" id="3282419">,</span>&nbsp;<span class="ident" id="3282421">deadline</span><span class="op" id="3282429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282432">case</span>&nbsp;<span class="op" id="3282437">*</span><span class="ident" id="3282438">IPAddr</span><span class="op" id="3282444">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282448">la</span><span class="op" id="3282450">,</span>&nbsp;<span class="ident" id="3282452">_</span>&nbsp;<span class="op" id="3282454">:=</span>&nbsp;<span class="ident" id="3282457">la</span><span class="op" id="3282459">.</span><span class="op" id="3282460">(</span><span class="op" id="3282461">*</span><span class="ident" id="3282462">IPAddr</span><span class="op" id="3282468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282472">c</span><span class="op" id="3282473">,</span>&nbsp;<span class="ident" id="3282475">err</span>&nbsp;<span class="op" id="3282479">=</span>&nbsp;<span class="ident" id="3282481">dialIP</span><span class="op" id="3282487">(</span><span class="ident" id="3282488">net</span><span class="op" id="3282491">,</span>&nbsp;<span class="ident" id="3282493">la</span><span class="op" id="3282495">,</span>&nbsp;<span class="ident" id="3282497">ra</span><span class="op" id="3282499">,</span>&nbsp;<span class="ident" id="3282501">deadline</span><span class="op" id="3282509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282512">case</span>&nbsp;<span class="op" id="3282517">*</span><span class="ident" id="3282518">UnixAddr</span><span class="op" id="3282526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282530">la</span><span class="op" id="3282532">,</span>&nbsp;<span class="ident" id="3282534">_</span>&nbsp;<span class="op" id="3282536">:=</span>&nbsp;<span class="ident" id="3282539">la</span><span class="op" id="3282541">.</span><span class="op" id="3282542">(</span><span class="op" id="3282543">*</span><span class="ident" id="3282544">UnixAddr</span><span class="op" id="3282552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3282556">c</span><span class="op" id="3282557">,</span>&nbsp;<span class="ident" id="3282559">err</span>&nbsp;<span class="op" id="3282563">=</span>&nbsp;<span class="ident" id="3282565">dialUnix</span><span class="op" id="3282573">(</span><span class="ident" id="3282574">net</span><span class="op" id="3282577">,</span>&nbsp;<span class="ident" id="3282579">la</span><span class="op" id="3282581">,</span>&nbsp;<span class="ident" id="3282583">ra</span><span class="op" id="3282585">,</span>&nbsp;<span class="ident" id="3282587">deadline</span><span class="op" id="3282595">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282598">default</span><span class="op" id="3282605">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282609">return</span>&nbsp;<span class="ident" id="3282616">nil</span><span class="op" id="3282619">,</span>&nbsp;<span class="op" id="3282621">&amp;</span><span class="ident" id="3282622">OpError</span><span class="op" id="3282629">{</span><span class="ident" id="3282630">Op</span><span class="op" id="3282632">:</span>&nbsp;<span class="string" id="3282634">&#34;dial&#34;</span><span class="op" id="3282640">,</span>&nbsp;<span class="ident" id="3282642">Net</span><span class="op" id="3282645">:</span>&nbsp;<span class="ident" id="3282647">net</span><span class="op" id="3282650">,</span>&nbsp;<span class="ident" id="3282652">Addr</span><span class="op" id="3282656">:</span>&nbsp;<span class="ident" id="3282658">ra</span><span class="op" id="3282660">,</span>&nbsp;<span class="ident" id="3282662">Err</span><span class="op" id="3282665">:</span>&nbsp;<span class="op" id="3282667">&amp;</span><span class="ident" id="3282668">AddrError</span><span class="op" id="3282677">{</span><span class="ident" id="3282678">Err</span><span class="op" id="3282681">:</span>&nbsp;<span class="string" id="3282683">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3282708">,</span>&nbsp;<span class="ident" id="3282710">Addr</span><span class="op" id="3282714">:</span>&nbsp;<span class="ident" id="3282716">addr</span><span class="op" id="3282720">}</span><span class="op" id="3282721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3282724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282727">if</span>&nbsp;<span class="ident" id="3282730">err</span>&nbsp;<span class="op" id="3282734">!=</span>&nbsp;<span class="ident" id="3282737">nil</span>&nbsp;<span class="op" id="3282741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282745">return</span>&nbsp;<span class="ident" id="3282752">nil</span><span class="op" id="3282755">,</span>&nbsp;<span class="ident" id="3282757">err</span>&nbsp;<span class="comment" id="3282761">//&nbsp;c&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3282811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3282814">return</span>&nbsp;<span class="ident" id="3282821">c</span><span class="op" id="3282822">,</span>&nbsp;<span class="ident" id="3282824">nil</span><br>
<span class="lineno"></span><span class="op" id="3282828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3282831">//&nbsp;Listen&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno">255</span><span class="comment" id="3282887">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;stream-oriented&nbsp;network:&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3282956">//&nbsp;&#34;tcp6&#34;,&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3282991">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3283028">func</span>&nbsp;<span class="ident" id="3283033">Listen</span><span class="op" id="3283039">(</span><span class="ident" id="3283040">net</span><span class="op" id="3283043">,</span>&nbsp;<span class="ident" id="3283045">laddr</span>&nbsp;<span class="builtintype" id="3283051">string</span><span class="op" id="3283057">)</span>&nbsp;<span class="op" id="3283059">(</span><span class="ident" id="3283060">Listener</span><span class="op" id="3283068">,</span>&nbsp;<span class="builtintype" id="3283070">error</span><span class="op" id="3283075">)</span>&nbsp;<span class="op" id="3283077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283080">la</span><span class="op" id="3283082">,</span>&nbsp;<span class="ident" id="3283084">err</span>&nbsp;<span class="op" id="3283088">:=</span>&nbsp;<span class="ident" id="3283091">resolveAddr</span><span class="op" id="3283102">(</span><span class="string" id="3283103">&#34;listen&#34;</span><span class="op" id="3283111">,</span>&nbsp;<span class="ident" id="3283113">net</span><span class="op" id="3283116">,</span>&nbsp;<span class="ident" id="3283118">laddr</span><span class="op" id="3283123">,</span>&nbsp;<span class="ident" id="3283125">noDeadline</span><span class="op" id="3283135">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283138">if</span>&nbsp;<span class="ident" id="3283141">err</span>&nbsp;<span class="op" id="3283145">!=</span>&nbsp;<span class="ident" id="3283148">nil</span>&nbsp;<span class="op" id="3283152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283156">return</span>&nbsp;<span class="ident" id="3283163">nil</span><span class="op" id="3283166">,</span>&nbsp;<span class="op" id="3283168">&amp;</span><span class="ident" id="3283169">OpError</span><span class="op" id="3283176">{</span><span class="ident" id="3283177">Op</span><span class="op" id="3283179">:</span>&nbsp;<span class="string" id="3283181">&#34;listen&#34;</span><span class="op" id="3283189">,</span>&nbsp;<span class="ident" id="3283191">Net</span><span class="op" id="3283194">:</span>&nbsp;<span class="ident" id="3283196">net</span><span class="op" id="3283199">,</span>&nbsp;<span class="ident" id="3283201">Addr</span><span class="op" id="3283205">:</span>&nbsp;<span class="ident" id="3283207">nil</span><span class="op" id="3283210">,</span>&nbsp;<span class="ident" id="3283212">Err</span><span class="op" id="3283215">:</span>&nbsp;<span class="ident" id="3283217">err</span><span class="op" id="3283220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283226">var</span>&nbsp;<span class="ident" id="3283230">l</span>&nbsp;<span class="ident" id="3283232">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283242">switch</span>&nbsp;<span class="ident" id="3283249">la</span>&nbsp;<span class="op" id="3283252">:=</span>&nbsp;<span class="ident" id="3283255">la</span><span class="op" id="3283257">.</span><span class="ident" id="3283258">toAddr</span><span class="op" id="3283264">(</span><span class="op" id="3283265">)</span><span class="op" id="3283266">.</span><span class="op" id="3283267">(</span><span class="keyword" id="3283268">type</span><span class="op" id="3283272">)</span>&nbsp;<span class="op" id="3283274">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283277">case</span>&nbsp;<span class="op" id="3283282">*</span><span class="ident" id="3283283">TCPAddr</span><span class="op" id="3283290">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283294">l</span><span class="op" id="3283295">,</span>&nbsp;<span class="ident" id="3283297">err</span>&nbsp;<span class="op" id="3283301">=</span>&nbsp;<span class="ident" id="3283303">ListenTCP</span><span class="op" id="3283312">(</span><span class="ident" id="3283313">net</span><span class="op" id="3283316">,</span>&nbsp;<span class="ident" id="3283318">la</span><span class="op" id="3283320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283323">case</span>&nbsp;<span class="op" id="3283328">*</span><span class="ident" id="3283329">UnixAddr</span><span class="op" id="3283337">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283341">l</span><span class="op" id="3283342">,</span>&nbsp;<span class="ident" id="3283344">err</span>&nbsp;<span class="op" id="3283348">=</span>&nbsp;<span class="ident" id="3283350">ListenUnix</span><span class="op" id="3283360">(</span><span class="ident" id="3283361">net</span><span class="op" id="3283364">,</span>&nbsp;<span class="ident" id="3283366">la</span><span class="op" id="3283368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283371">default</span><span class="op" id="3283378">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283382">return</span>&nbsp;<span class="ident" id="3283389">nil</span><span class="op" id="3283392">,</span>&nbsp;<span class="op" id="3283394">&amp;</span><span class="ident" id="3283395">OpError</span><span class="op" id="3283402">{</span><span class="ident" id="3283403">Op</span><span class="op" id="3283405">:</span>&nbsp;<span class="string" id="3283407">&#34;listen&#34;</span><span class="op" id="3283415">,</span>&nbsp;<span class="ident" id="3283417">Net</span><span class="op" id="3283420">:</span>&nbsp;<span class="ident" id="3283422">net</span><span class="op" id="3283425">,</span>&nbsp;<span class="ident" id="3283427">Addr</span><span class="op" id="3283431">:</span>&nbsp;<span class="ident" id="3283433">la</span><span class="op" id="3283435">,</span>&nbsp;<span class="ident" id="3283437">Err</span><span class="op" id="3283440">:</span>&nbsp;<span class="op" id="3283442">&amp;</span><span class="ident" id="3283443">AddrError</span><span class="op" id="3283452">{</span><span class="ident" id="3283453">Err</span><span class="op" id="3283456">:</span>&nbsp;<span class="string" id="3283458">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3283483">,</span>&nbsp;<span class="ident" id="3283485">Addr</span><span class="op" id="3283489">:</span>&nbsp;<span class="ident" id="3283491">laddr</span><span class="op" id="3283496">}</span><span class="op" id="3283497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283503">if</span>&nbsp;<span class="ident" id="3283506">err</span>&nbsp;<span class="op" id="3283510">!=</span>&nbsp;<span class="ident" id="3283513">nil</span>&nbsp;<span class="op" id="3283517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283521">return</span>&nbsp;<span class="ident" id="3283528">nil</span><span class="op" id="3283531">,</span>&nbsp;<span class="ident" id="3283533">err</span>&nbsp;<span class="comment" id="3283537">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3283587">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283590">return</span>&nbsp;<span class="ident" id="3283597">l</span><span class="op" id="3283598">,</span>&nbsp;<span class="ident" id="3283600">nil</span><br>
<span class="lineno"></span><span class="op" id="3283604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3283607">//&nbsp;ListenPacket&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="comment" id="3283669">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;packet-oriented&nbsp;network:&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,</span><br>
<span class="lineno">280</span><span class="comment" id="3283738">//&nbsp;&#34;udp6&#34;,&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;&#34;ip6&#34;&nbsp;or&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3283783">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3283820">func</span>&nbsp;<span class="ident" id="3283825">ListenPacket</span><span class="op" id="3283837">(</span><span class="ident" id="3283838">net</span><span class="op" id="3283841">,</span>&nbsp;<span class="ident" id="3283843">laddr</span>&nbsp;<span class="builtintype" id="3283849">string</span><span class="op" id="3283855">)</span>&nbsp;<span class="op" id="3283857">(</span><span class="ident" id="3283858">PacketConn</span><span class="op" id="3283868">,</span>&nbsp;<span class="builtintype" id="3283870">error</span><span class="op" id="3283875">)</span>&nbsp;<span class="op" id="3283877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3283880">la</span><span class="op" id="3283882">,</span>&nbsp;<span class="ident" id="3283884">err</span>&nbsp;<span class="op" id="3283888">:=</span>&nbsp;<span class="ident" id="3283891">resolveAddr</span><span class="op" id="3283902">(</span><span class="string" id="3283903">&#34;listen&#34;</span><span class="op" id="3283911">,</span>&nbsp;<span class="ident" id="3283913">net</span><span class="op" id="3283916">,</span>&nbsp;<span class="ident" id="3283918">laddr</span><span class="op" id="3283923">,</span>&nbsp;<span class="ident" id="3283925">noDeadline</span><span class="op" id="3283935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283938">if</span>&nbsp;<span class="ident" id="3283941">err</span>&nbsp;<span class="op" id="3283945">!=</span>&nbsp;<span class="ident" id="3283948">nil</span>&nbsp;<span class="op" id="3283952">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3283956">return</span>&nbsp;<span class="ident" id="3283963">nil</span><span class="op" id="3283966">,</span>&nbsp;<span class="op" id="3283968">&amp;</span><span class="ident" id="3283969">OpError</span><span class="op" id="3283976">{</span><span class="ident" id="3283977">Op</span><span class="op" id="3283979">:</span>&nbsp;<span class="string" id="3283981">&#34;listen&#34;</span><span class="op" id="3283989">,</span>&nbsp;<span class="ident" id="3283991">Net</span><span class="op" id="3283994">:</span>&nbsp;<span class="ident" id="3283996">net</span><span class="op" id="3283999">,</span>&nbsp;<span class="ident" id="3284001">Addr</span><span class="op" id="3284005">:</span>&nbsp;<span class="ident" id="3284007">nil</span><span class="op" id="3284010">,</span>&nbsp;<span class="ident" id="3284012">Err</span><span class="op" id="3284015">:</span>&nbsp;<span class="ident" id="3284017">err</span><span class="op" id="3284020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3284023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284026">var</span>&nbsp;<span class="ident" id="3284030">l</span>&nbsp;<span class="ident" id="3284032">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284044">switch</span>&nbsp;<span class="ident" id="3284051">la</span>&nbsp;<span class="op" id="3284054">:=</span>&nbsp;<span class="ident" id="3284057">la</span><span class="op" id="3284059">.</span><span class="ident" id="3284060">toAddr</span><span class="op" id="3284066">(</span><span class="op" id="3284067">)</span><span class="op" id="3284068">.</span><span class="op" id="3284069">(</span><span class="keyword" id="3284070">type</span><span class="op" id="3284074">)</span>&nbsp;<span class="op" id="3284076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284079">case</span>&nbsp;<span class="op" id="3284084">*</span><span class="ident" id="3284085">UDPAddr</span><span class="op" id="3284092">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284096">l</span><span class="op" id="3284097">,</span>&nbsp;<span class="ident" id="3284099">err</span>&nbsp;<span class="op" id="3284103">=</span>&nbsp;<span class="ident" id="3284105">ListenUDP</span><span class="op" id="3284114">(</span><span class="ident" id="3284115">net</span><span class="op" id="3284118">,</span>&nbsp;<span class="ident" id="3284120">la</span><span class="op" id="3284122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284125">case</span>&nbsp;<span class="op" id="3284130">*</span><span class="ident" id="3284131">IPAddr</span><span class="op" id="3284137">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284141">l</span><span class="op" id="3284142">,</span>&nbsp;<span class="ident" id="3284144">err</span>&nbsp;<span class="op" id="3284148">=</span>&nbsp;<span class="ident" id="3284150">ListenIP</span><span class="op" id="3284158">(</span><span class="ident" id="3284159">net</span><span class="op" id="3284162">,</span>&nbsp;<span class="ident" id="3284164">la</span><span class="op" id="3284166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284169">case</span>&nbsp;<span class="op" id="3284174">*</span><span class="ident" id="3284175">UnixAddr</span><span class="op" id="3284183">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3284187">l</span><span class="op" id="3284188">,</span>&nbsp;<span class="ident" id="3284190">err</span>&nbsp;<span class="op" id="3284194">=</span>&nbsp;<span class="ident" id="3284196">ListenUnixgram</span><span class="op" id="3284210">(</span><span class="ident" id="3284211">net</span><span class="op" id="3284214">,</span>&nbsp;<span class="ident" id="3284216">la</span><span class="op" id="3284218">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284221">default</span><span class="op" id="3284228">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284232">return</span>&nbsp;<span class="ident" id="3284239">nil</span><span class="op" id="3284242">,</span>&nbsp;<span class="op" id="3284244">&amp;</span><span class="ident" id="3284245">OpError</span><span class="op" id="3284252">{</span><span class="ident" id="3284253">Op</span><span class="op" id="3284255">:</span>&nbsp;<span class="string" id="3284257">&#34;listen&#34;</span><span class="op" id="3284265">,</span>&nbsp;<span class="ident" id="3284267">Net</span><span class="op" id="3284270">:</span>&nbsp;<span class="ident" id="3284272">net</span><span class="op" id="3284275">,</span>&nbsp;<span class="ident" id="3284277">Addr</span><span class="op" id="3284281">:</span>&nbsp;<span class="ident" id="3284283">la</span><span class="op" id="3284285">,</span>&nbsp;<span class="ident" id="3284287">Err</span><span class="op" id="3284290">:</span>&nbsp;<span class="op" id="3284292">&amp;</span><span class="ident" id="3284293">AddrError</span><span class="op" id="3284302">{</span><span class="ident" id="3284303">Err</span><span class="op" id="3284306">:</span>&nbsp;<span class="string" id="3284308">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3284333">,</span>&nbsp;<span class="ident" id="3284335">Addr</span><span class="op" id="3284339">:</span>&nbsp;<span class="ident" id="3284341">laddr</span><span class="op" id="3284346">}</span><span class="op" id="3284347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3284350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284353">if</span>&nbsp;<span class="ident" id="3284356">err</span>&nbsp;<span class="op" id="3284360">!=</span>&nbsp;<span class="ident" id="3284363">nil</span>&nbsp;<span class="op" id="3284367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284371">return</span>&nbsp;<span class="ident" id="3284378">nil</span><span class="op" id="3284381">,</span>&nbsp;<span class="ident" id="3284383">err</span>&nbsp;<span class="comment" id="3284387">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3284437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3284440">return</span>&nbsp;<span class="ident" id="3284447">l</span><span class="op" id="3284448">,</span>&nbsp;<span class="ident" id="3284450">nil</span><br>
<span class="lineno"></span><span class="op" id="3284454">}</span>
</div>
</body>
</html>
