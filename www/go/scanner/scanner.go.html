<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5068391">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5068446">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5068500">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5068551">//&nbsp;Package&nbsp;scanner&nbsp;implements&nbsp;a&nbsp;scanner&nbsp;for&nbsp;Go&nbsp;source&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="5068611">//&nbsp;It&nbsp;takes&nbsp;a&nbsp;[]byte&nbsp;as&nbsp;source&nbsp;which&nbsp;can&nbsp;then&nbsp;be&nbsp;tokenized</span><br>
<span class="lineno"></span><span class="comment" id="5068670">//&nbsp;through&nbsp;repeated&nbsp;calls&nbsp;to&nbsp;the&nbsp;Scan&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="5068716">//</span><br>
<span class="lineno"></span><span class="keyword" id="5068719">package</span>&nbsp;<span class="ident" id="5068727">scanner</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="5068736">import</span>&nbsp;<span class="op" id="5068743">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5068746">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5068755">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5068762">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5068774">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5068791">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5068802">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5068813">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5068828">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5068831">//&nbsp;An&nbsp;ErrorHandler&nbsp;may&nbsp;be&nbsp;provided&nbsp;to&nbsp;Scanner.Init.&nbsp;If&nbsp;a&nbsp;syntax&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5068904">//&nbsp;encountered&nbsp;and&nbsp;a&nbsp;handler&nbsp;was&nbsp;installed,&nbsp;the&nbsp;handler&nbsp;is&nbsp;called&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5068977">//&nbsp;position&nbsp;and&nbsp;an&nbsp;error&nbsp;message.&nbsp;The&nbsp;position&nbsp;points&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5069051">//&nbsp;the&nbsp;offending&nbsp;token.</span><br>
<span class="lineno">25</span><span class="comment" id="5069075">//</span><br>
<span class="lineno"></span><span class="keyword" id="5069078">type</span>&nbsp;<span class="ident" id="5069083">ErrorHandler</span>&nbsp;<span class="keyword" id="5069096">func</span><span class="op" id="5069100">(</span><span class="ident" id="5069101">pos</span>&nbsp;<span class="ident" id="5069105">token</span><span class="op" id="5069110">.</span><span class="ident" id="5069111">Position</span><span class="op" id="5069119">,</span>&nbsp;<span class="ident" id="5069121">msg</span>&nbsp;<span class="builtintype" id="5069125">string</span><span class="op" id="5069131">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5069134">//&nbsp;A&nbsp;Scanner&nbsp;holds&nbsp;the&nbsp;scanner&#39;s&nbsp;internal&nbsp;state&nbsp;while&nbsp;processing</span><br>
<span class="lineno"></span><span class="comment" id="5069199">//&nbsp;a&nbsp;given&nbsp;text.&nbsp;&nbsp;It&nbsp;can&nbsp;be&nbsp;allocated&nbsp;as&nbsp;part&nbsp;of&nbsp;another&nbsp;data</span><br>
<span class="lineno">30</span><span class="comment" id="5069261">//&nbsp;structure&nbsp;but&nbsp;must&nbsp;be&nbsp;initialized&nbsp;via&nbsp;Init&nbsp;before&nbsp;use.</span><br>
<span class="lineno"></span><span class="comment" id="5069319">//</span><br>
<span class="lineno"></span><span class="keyword" id="5069322">type</span>&nbsp;<span class="ident" id="5069327">Scanner</span>&nbsp;<span class="keyword" id="5069335">struct</span>&nbsp;<span class="op" id="5069342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5069345">//&nbsp;immutable&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069365">file</span>&nbsp;<span class="op" id="5069370">*</span><span class="ident" id="5069371">token</span><span class="op" id="5069376">.</span><span class="ident" id="5069377">File</span>&nbsp;&nbsp;<span class="comment" id="5069383">//&nbsp;source&nbsp;file&nbsp;handle</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069406">dir</span>&nbsp;&nbsp;<span class="builtintype" id="5069411">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5069424">//&nbsp;directory&nbsp;portion&nbsp;of&nbsp;file.Name()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069461">src</span>&nbsp;&nbsp;<span class="op" id="5069466">[</span><span class="op" id="5069467">]</span><span class="builtintype" id="5069468">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5069479">//&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069490">err</span>&nbsp;&nbsp;<span class="ident" id="5069495">ErrorHandler</span>&nbsp;<span class="comment" id="5069508">//&nbsp;error&nbsp;reporting;&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069536">mode</span>&nbsp;<span class="ident" id="5069541">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5069554">//&nbsp;scanning&nbsp;mode</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5069573">//&nbsp;scanning&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069592">ch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5069603">rune</span>&nbsp;<span class="comment" id="5069608">//&nbsp;current&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069630">offset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5069641">int</span>&nbsp;&nbsp;<span class="comment" id="5069646">//&nbsp;character&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069667">rdOffset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5069678">int</span>&nbsp;&nbsp;<span class="comment" id="5069683">//&nbsp;reading&nbsp;offset&nbsp;(position&nbsp;after&nbsp;current&nbsp;character)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069737">lineOffset</span>&nbsp;<span class="builtintype" id="5069748">int</span>&nbsp;&nbsp;<span class="comment" id="5069753">//&nbsp;current&nbsp;line&nbsp;offset</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069777">insertSemi</span>&nbsp;<span class="builtintype" id="5069788">bool</span>&nbsp;<span class="comment" id="5069793">//&nbsp;insert&nbsp;a&nbsp;semicolon&nbsp;before&nbsp;next&nbsp;newline</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5069837">//&nbsp;public&nbsp;state&nbsp;-&nbsp;ok&nbsp;to&nbsp;modify</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5069869">ErrorCount</span>&nbsp;<span class="builtintype" id="5069880">int</span>&nbsp;<span class="comment" id="5069884">//&nbsp;number&nbsp;of&nbsp;errors&nbsp;encountered</span><br>
<span class="lineno"></span><span class="op" id="5069916">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5069919">const</span>&nbsp;<span class="ident" id="5069925">bom</span>&nbsp;<span class="op" id="5069929">=</span>&nbsp;<span class="num" id="5069931">0xFEFF</span>&nbsp;<span class="comment" id="5069938">//&nbsp;byte&nbsp;order&nbsp;mark,&nbsp;only&nbsp;permitted&nbsp;as&nbsp;very&nbsp;first&nbsp;character</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5069998">//&nbsp;Read&nbsp;the&nbsp;next&nbsp;Unicode&nbsp;char&nbsp;into&nbsp;s.ch.</span><br>
<span class="lineno"></span><span class="comment" id="5070039">//&nbsp;s.ch&nbsp;&lt;&nbsp;0&nbsp;means&nbsp;end-of-file.</span><br>
<span class="lineno">55</span><span class="comment" id="5070070">//</span><br>
<span class="lineno"></span><span class="keyword" id="5070073">func</span>&nbsp;<span class="op" id="5070078">(</span><span class="ident" id="5070079">s</span>&nbsp;<span class="op" id="5070081">*</span><span class="ident" id="5070082">Scanner</span><span class="op" id="5070089">)</span>&nbsp;<span class="ident" id="5070091">next</span><span class="op" id="5070095">(</span><span class="op" id="5070096">)</span>&nbsp;<span class="op" id="5070098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070101">if</span>&nbsp;<span class="ident" id="5070104">s</span><span class="op" id="5070105">.</span><span class="ident" id="5070106">rdOffset</span>&nbsp;<span class="op" id="5070115">&lt;</span>&nbsp;<span class="builtinfunc" id="5070117">len</span><span class="op" id="5070120">(</span><span class="ident" id="5070121">s</span><span class="op" id="5070122">.</span><span class="ident" id="5070123">src</span><span class="op" id="5070126">)</span>&nbsp;<span class="op" id="5070128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070132">s</span><span class="op" id="5070133">.</span><span class="ident" id="5070134">offset</span>&nbsp;<span class="op" id="5070141">=</span>&nbsp;<span class="ident" id="5070143">s</span><span class="op" id="5070144">.</span><span class="ident" id="5070145">rdOffset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070156">if</span>&nbsp;<span class="ident" id="5070159">s</span><span class="op" id="5070160">.</span><span class="ident" id="5070161">ch</span>&nbsp;<span class="op" id="5070164">==</span>&nbsp;<span class="string" id="5070167">&#39;\n&#39;</span>&nbsp;<span class="op" id="5070172">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070177">s</span><span class="op" id="5070178">.</span><span class="ident" id="5070179">lineOffset</span>&nbsp;<span class="op" id="5070190">=</span>&nbsp;<span class="ident" id="5070192">s</span><span class="op" id="5070193">.</span><span class="ident" id="5070194">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070204">s</span><span class="op" id="5070205">.</span><span class="ident" id="5070206">file</span><span class="op" id="5070210">.</span><span class="ident" id="5070211">AddLine</span><span class="op" id="5070218">(</span><span class="ident" id="5070219">s</span><span class="op" id="5070220">.</span><span class="ident" id="5070221">offset</span><span class="op" id="5070227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5070231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070235">r</span><span class="op" id="5070236">,</span>&nbsp;<span class="ident" id="5070238">w</span>&nbsp;<span class="op" id="5070240">:=</span>&nbsp;<span class="builtintype" id="5070243">rune</span><span class="op" id="5070247">(</span><span class="ident" id="5070248">s</span><span class="op" id="5070249">.</span><span class="ident" id="5070250">src</span><span class="op" id="5070253">[</span><span class="ident" id="5070254">s</span><span class="op" id="5070255">.</span><span class="ident" id="5070256">rdOffset</span><span class="op" id="5070264">]</span><span class="op" id="5070265">)</span><span class="op" id="5070266">,</span>&nbsp;<span class="num" id="5070268">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070272">switch</span>&nbsp;<span class="op" id="5070279">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070283">case</span>&nbsp;<span class="ident" id="5070288">r</span>&nbsp;<span class="op" id="5070290">==</span>&nbsp;<span class="num" id="5070293">0</span><span class="op" id="5070294">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070299">s</span><span class="op" id="5070300">.</span><span class="builtintype" id="5070301">error</span><span class="op" id="5070306">(</span><span class="ident" id="5070307">s</span><span class="op" id="5070308">.</span><span class="ident" id="5070309">offset</span><span class="op" id="5070315">,</span>&nbsp;<span class="string" id="5070317">&#34;illegal&nbsp;character&nbsp;NUL&#34;</span><span class="op" id="5070340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070344">case</span>&nbsp;<span class="ident" id="5070349">r</span>&nbsp;<span class="op" id="5070351">&gt;=</span>&nbsp;<span class="num" id="5070354">0x80</span><span class="op" id="5070358">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5070363">//&nbsp;not&nbsp;ASCII</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070379">r</span><span class="op" id="5070380">,</span>&nbsp;<span class="ident" id="5070382">w</span>&nbsp;<span class="op" id="5070384">=</span>&nbsp;<span class="ident" id="5070386">utf8</span><span class="op" id="5070390">.</span><span class="ident" id="5070391">DecodeRune</span><span class="op" id="5070401">(</span><span class="ident" id="5070402">s</span><span class="op" id="5070403">.</span><span class="ident" id="5070404">src</span><span class="op" id="5070407">[</span><span class="ident" id="5070408">s</span><span class="op" id="5070409">.</span><span class="ident" id="5070410">rdOffset</span><span class="op" id="5070418">:</span><span class="op" id="5070419">]</span><span class="op" id="5070420">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070425">if</span>&nbsp;<span class="ident" id="5070428">r</span>&nbsp;<span class="op" id="5070430">==</span>&nbsp;<span class="ident" id="5070433">utf8</span><span class="op" id="5070437">.</span><span class="ident" id="5070438">RuneError</span>&nbsp;<span class="op" id="5070448">&amp;&amp;</span>&nbsp;<span class="ident" id="5070451">w</span>&nbsp;<span class="op" id="5070453">==</span>&nbsp;<span class="num" id="5070456">1</span>&nbsp;<span class="op" id="5070458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070464">s</span><span class="op" id="5070465">.</span><span class="builtintype" id="5070466">error</span><span class="op" id="5070471">(</span><span class="ident" id="5070472">s</span><span class="op" id="5070473">.</span><span class="ident" id="5070474">offset</span><span class="op" id="5070480">,</span>&nbsp;<span class="string" id="5070482">&#34;illegal&nbsp;UTF-8&nbsp;encoding&#34;</span><span class="op" id="5070506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5070511">}</span>&nbsp;<span class="keyword" id="5070513">else</span>&nbsp;<span class="keyword" id="5070518">if</span>&nbsp;<span class="ident" id="5070521">r</span>&nbsp;<span class="op" id="5070523">==</span>&nbsp;<span class="ident" id="5070526">bom</span>&nbsp;<span class="op" id="5070530">&amp;&amp;</span>&nbsp;<span class="ident" id="5070533">s</span><span class="op" id="5070534">.</span><span class="ident" id="5070535">offset</span>&nbsp;<span class="op" id="5070542">&gt;</span>&nbsp;<span class="num" id="5070544">0</span>&nbsp;<span class="op" id="5070546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070552">s</span><span class="op" id="5070553">.</span><span class="builtintype" id="5070554">error</span><span class="op" id="5070559">(</span><span class="ident" id="5070560">s</span><span class="op" id="5070561">.</span><span class="ident" id="5070562">offset</span><span class="op" id="5070568">,</span>&nbsp;<span class="string" id="5070570">&#34;illegal&nbsp;byte&nbsp;order&nbsp;mark&#34;</span><span class="op" id="5070595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5070600">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5070604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070608">s</span><span class="op" id="5070609">.</span><span class="ident" id="5070610">rdOffset</span>&nbsp;<span class="op" id="5070619">+=</span>&nbsp;<span class="ident" id="5070622">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070626">s</span><span class="op" id="5070627">.</span><span class="ident" id="5070628">ch</span>&nbsp;<span class="op" id="5070631">=</span>&nbsp;<span class="ident" id="5070633">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5070636">}</span>&nbsp;<span class="keyword" id="5070638">else</span>&nbsp;<span class="op" id="5070643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070647">s</span><span class="op" id="5070648">.</span><span class="ident" id="5070649">offset</span>&nbsp;<span class="op" id="5070656">=</span>&nbsp;<span class="builtinfunc" id="5070658">len</span><span class="op" id="5070661">(</span><span class="ident" id="5070662">s</span><span class="op" id="5070663">.</span><span class="ident" id="5070664">src</span><span class="op" id="5070667">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5070671">if</span>&nbsp;<span class="ident" id="5070674">s</span><span class="op" id="5070675">.</span><span class="ident" id="5070676">ch</span>&nbsp;<span class="op" id="5070679">==</span>&nbsp;<span class="string" id="5070682">&#39;\n&#39;</span>&nbsp;<span class="op" id="5070687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070692">s</span><span class="op" id="5070693">.</span><span class="ident" id="5070694">lineOffset</span>&nbsp;<span class="op" id="5070705">=</span>&nbsp;<span class="ident" id="5070707">s</span><span class="op" id="5070708">.</span><span class="ident" id="5070709">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070719">s</span><span class="op" id="5070720">.</span><span class="ident" id="5070721">file</span><span class="op" id="5070725">.</span><span class="ident" id="5070726">AddLine</span><span class="op" id="5070733">(</span><span class="ident" id="5070734">s</span><span class="op" id="5070735">.</span><span class="ident" id="5070736">offset</span><span class="op" id="5070742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5070746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070750">s</span><span class="op" id="5070751">.</span><span class="ident" id="5070752">ch</span>&nbsp;<span class="op" id="5070755">=</span>&nbsp;<span class="op" id="5070757">-</span><span class="num" id="5070758">1</span>&nbsp;<span class="comment" id="5070760">//&nbsp;eof</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5070768">}</span><br>
<span class="lineno"></span><span class="op" id="5070770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5070773">//&nbsp;A&nbsp;mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="5070815">//&nbsp;They&nbsp;control&nbsp;scanner&nbsp;behavior.</span><br>
<span class="lineno">90</span><span class="comment" id="5070849">//</span><br>
<span class="lineno"></span><span class="keyword" id="5070852">type</span>&nbsp;<span class="ident" id="5070857">Mode</span>&nbsp;<span class="builtintype" id="5070862">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5070868">const</span>&nbsp;<span class="op" id="5070874">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070877">ScanComments</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5070893">Mode</span>&nbsp;<span class="op" id="5070898">=</span>&nbsp;<span class="num" id="5070900">1</span>&nbsp;<span class="op" id="5070902">&lt;&lt;</span>&nbsp;<span class="ident" id="5070905">iota</span>&nbsp;<span class="comment" id="5070910">//&nbsp;return&nbsp;comments&nbsp;as&nbsp;COMMENT&nbsp;tokens</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5070948">dontInsertSemis</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5070981">//&nbsp;do&nbsp;not&nbsp;automatically&nbsp;insert&nbsp;semicolons&nbsp;-&nbsp;for&nbsp;testing&nbsp;only</span><br>
<span class="lineno"></span><span class="op" id="5071042">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5071045">//&nbsp;Init&nbsp;prepares&nbsp;the&nbsp;scanner&nbsp;s&nbsp;to&nbsp;tokenize&nbsp;the&nbsp;text&nbsp;src&nbsp;by&nbsp;setting&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5071116">//&nbsp;scanner&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;src.&nbsp;The&nbsp;scanner&nbsp;uses&nbsp;the&nbsp;file&nbsp;set&nbsp;file</span><br>
<span class="lineno">100</span><span class="comment" id="5071187">//&nbsp;for&nbsp;position&nbsp;information&nbsp;and&nbsp;it&nbsp;adds&nbsp;line&nbsp;information&nbsp;for&nbsp;each&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="5071259">//&nbsp;It&nbsp;is&nbsp;ok&nbsp;to&nbsp;re-use&nbsp;the&nbsp;same&nbsp;file&nbsp;when&nbsp;re-scanning&nbsp;the&nbsp;same&nbsp;file&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="5071329">//&nbsp;line&nbsp;information&nbsp;which&nbsp;is&nbsp;already&nbsp;present&nbsp;is&nbsp;ignored.&nbsp;Init&nbsp;causes&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5071400">//&nbsp;panic&nbsp;if&nbsp;the&nbsp;file&nbsp;size&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;src&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="5071455">//</span><br>
<span class="lineno">105</span><span class="comment" id="5071458">//&nbsp;Calls&nbsp;to&nbsp;Scan&nbsp;will&nbsp;invoke&nbsp;the&nbsp;error&nbsp;handler&nbsp;err&nbsp;if&nbsp;they&nbsp;encounter&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5071529">//&nbsp;syntax&nbsp;error&nbsp;and&nbsp;err&nbsp;is&nbsp;not&nbsp;nil.&nbsp;Also,&nbsp;for&nbsp;each&nbsp;error&nbsp;encountered,</span><br>
<span class="lineno"></span><span class="comment" id="5071599">//&nbsp;the&nbsp;Scanner&nbsp;field&nbsp;ErrorCount&nbsp;is&nbsp;incremented&nbsp;by&nbsp;one.&nbsp;The&nbsp;mode&nbsp;parameter</span><br>
<span class="lineno"></span><span class="comment" id="5071673">//&nbsp;determines&nbsp;how&nbsp;comments&nbsp;are&nbsp;handled.</span><br>
<span class="lineno"></span><span class="comment" id="5071713">//</span><br>
<span class="lineno">110</span><span class="comment" id="5071716">//&nbsp;Note&nbsp;that&nbsp;Init&nbsp;may&nbsp;call&nbsp;err&nbsp;if&nbsp;there&nbsp;is&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;first&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="5071791">//&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5071807">//</span><br>
<span class="lineno"></span><span class="keyword" id="5071810">func</span>&nbsp;<span class="op" id="5071815">(</span><span class="ident" id="5071816">s</span>&nbsp;<span class="op" id="5071818">*</span><span class="ident" id="5071819">Scanner</span><span class="op" id="5071826">)</span>&nbsp;<span class="ident" id="5071828">Init</span><span class="op" id="5071832">(</span><span class="ident" id="5071833">file</span>&nbsp;<span class="op" id="5071838">*</span><span class="ident" id="5071839">token</span><span class="op" id="5071844">.</span><span class="ident" id="5071845">File</span><span class="op" id="5071849">,</span>&nbsp;<span class="ident" id="5071851">src</span>&nbsp;<span class="op" id="5071855">[</span><span class="op" id="5071856">]</span><span class="builtintype" id="5071857">byte</span><span class="op" id="5071861">,</span>&nbsp;<span class="ident" id="5071863">err</span>&nbsp;<span class="ident" id="5071867">ErrorHandler</span><span class="op" id="5071879">,</span>&nbsp;<span class="ident" id="5071881">mode</span>&nbsp;<span class="ident" id="5071886">Mode</span><span class="op" id="5071890">)</span>&nbsp;<span class="op" id="5071892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5071895">//&nbsp;Explicitly&nbsp;initialize&nbsp;all&nbsp;fields&nbsp;since&nbsp;a&nbsp;scanner&nbsp;may&nbsp;be&nbsp;reused.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5071963">if</span>&nbsp;<span class="ident" id="5071966">file</span><span class="op" id="5071970">.</span><span class="ident" id="5071971">Size</span><span class="op" id="5071975">(</span><span class="op" id="5071976">)</span>&nbsp;<span class="op" id="5071978">!=</span>&nbsp;<span class="builtinfunc" id="5071981">len</span><span class="op" id="5071984">(</span><span class="ident" id="5071985">src</span><span class="op" id="5071988">)</span>&nbsp;<span class="op" id="5071990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5071994">panic</span><span class="op" id="5071999">(</span><span class="ident" id="5072000">fmt</span><span class="op" id="5072003">.</span><span class="ident" id="5072004">Sprintf</span><span class="op" id="5072011">(</span><span class="string" id="5072012">&#34;file&nbsp;size&nbsp;(%d)&nbsp;does&nbsp;not&nbsp;match&nbsp;src&nbsp;len&nbsp;(%d)&#34;</span><span class="op" id="5072056">,</span>&nbsp;<span class="ident" id="5072058">file</span><span class="op" id="5072062">.</span><span class="ident" id="5072063">Size</span><span class="op" id="5072067">(</span><span class="op" id="5072068">)</span><span class="op" id="5072069">,</span>&nbsp;<span class="builtinfunc" id="5072071">len</span><span class="op" id="5072074">(</span><span class="ident" id="5072075">src</span><span class="op" id="5072078">)</span><span class="op" id="5072079">)</span><span class="op" id="5072080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072086">s</span><span class="op" id="5072087">.</span><span class="ident" id="5072088">file</span>&nbsp;<span class="op" id="5072093">=</span>&nbsp;<span class="ident" id="5072095">file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072101">s</span><span class="op" id="5072102">.</span><span class="ident" id="5072103">dir</span><span class="op" id="5072106">,</span>&nbsp;<span class="ident" id="5072108">_</span>&nbsp;<span class="op" id="5072110">=</span>&nbsp;<span class="ident" id="5072112">filepath</span><span class="op" id="5072120">.</span><span class="ident" id="5072121">Split</span><span class="op" id="5072126">(</span><span class="ident" id="5072127">file</span><span class="op" id="5072131">.</span><span class="ident" id="5072132">Name</span><span class="op" id="5072136">(</span><span class="op" id="5072137">)</span><span class="op" id="5072138">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072141">s</span><span class="op" id="5072142">.</span><span class="ident" id="5072143">src</span>&nbsp;<span class="op" id="5072147">=</span>&nbsp;<span class="ident" id="5072149">src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072154">s</span><span class="op" id="5072155">.</span><span class="ident" id="5072156">err</span>&nbsp;<span class="op" id="5072160">=</span>&nbsp;<span class="ident" id="5072162">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072167">s</span><span class="op" id="5072168">.</span><span class="ident" id="5072169">mode</span>&nbsp;<span class="op" id="5072174">=</span>&nbsp;<span class="ident" id="5072176">mode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072183">s</span><span class="op" id="5072184">.</span><span class="ident" id="5072185">ch</span>&nbsp;<span class="op" id="5072188">=</span>&nbsp;<span class="string" id="5072190">&#39;&nbsp;&#39;</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072195">s</span><span class="op" id="5072196">.</span><span class="ident" id="5072197">offset</span>&nbsp;<span class="op" id="5072204">=</span>&nbsp;<span class="num" id="5072206">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072209">s</span><span class="op" id="5072210">.</span><span class="ident" id="5072211">rdOffset</span>&nbsp;<span class="op" id="5072220">=</span>&nbsp;<span class="num" id="5072222">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072225">s</span><span class="op" id="5072226">.</span><span class="ident" id="5072227">lineOffset</span>&nbsp;<span class="op" id="5072238">=</span>&nbsp;<span class="num" id="5072240">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072243">s</span><span class="op" id="5072244">.</span><span class="ident" id="5072245">insertSemi</span>&nbsp;<span class="op" id="5072256">=</span>&nbsp;<span class="ident" id="5072258">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072265">s</span><span class="op" id="5072266">.</span><span class="ident" id="5072267">ErrorCount</span>&nbsp;<span class="op" id="5072278">=</span>&nbsp;<span class="num" id="5072280">0</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072284">s</span><span class="op" id="5072285">.</span><span class="ident" id="5072286">next</span><span class="op" id="5072290">(</span><span class="op" id="5072291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072294">if</span>&nbsp;<span class="ident" id="5072297">s</span><span class="op" id="5072298">.</span><span class="ident" id="5072299">ch</span>&nbsp;<span class="op" id="5072302">==</span>&nbsp;<span class="ident" id="5072305">bom</span>&nbsp;<span class="op" id="5072309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072313">s</span><span class="op" id="5072314">.</span><span class="ident" id="5072315">next</span><span class="op" id="5072319">(</span><span class="op" id="5072320">)</span>&nbsp;<span class="comment" id="5072322">//&nbsp;ignore&nbsp;BOM&nbsp;at&nbsp;file&nbsp;beginning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072355">}</span><br>
<span class="lineno">135</span><span class="op" id="5072357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5072360">func</span>&nbsp;<span class="op" id="5072365">(</span><span class="ident" id="5072366">s</span>&nbsp;<span class="op" id="5072368">*</span><span class="ident" id="5072369">Scanner</span><span class="op" id="5072376">)</span>&nbsp;<span class="builtintype" id="5072378">error</span><span class="op" id="5072383">(</span><span class="ident" id="5072384">offs</span>&nbsp;<span class="builtintype" id="5072389">int</span><span class="op" id="5072392">,</span>&nbsp;<span class="ident" id="5072394">msg</span>&nbsp;<span class="builtintype" id="5072398">string</span><span class="op" id="5072404">)</span>&nbsp;<span class="op" id="5072406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072409">if</span>&nbsp;<span class="ident" id="5072412">s</span><span class="op" id="5072413">.</span><span class="ident" id="5072414">err</span>&nbsp;<span class="op" id="5072418">!=</span>&nbsp;<span class="ident" id="5072421">nil</span>&nbsp;<span class="op" id="5072425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072429">s</span><span class="op" id="5072430">.</span><span class="ident" id="5072431">err</span><span class="op" id="5072434">(</span><span class="ident" id="5072435">s</span><span class="op" id="5072436">.</span><span class="ident" id="5072437">file</span><span class="op" id="5072441">.</span><span class="ident" id="5072442">Position</span><span class="op" id="5072450">(</span><span class="ident" id="5072451">s</span><span class="op" id="5072452">.</span><span class="ident" id="5072453">file</span><span class="op" id="5072457">.</span><span class="ident" id="5072458">Pos</span><span class="op" id="5072461">(</span><span class="ident" id="5072462">offs</span><span class="op" id="5072466">)</span><span class="op" id="5072467">)</span><span class="op" id="5072468">,</span>&nbsp;<span class="ident" id="5072470">msg</span><span class="op" id="5072473">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5072476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072479">s</span><span class="op" id="5072480">.</span><span class="ident" id="5072481">ErrorCount</span><span class="op" id="5072491">++</span><br>
<span class="lineno"></span><span class="op" id="5072494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5072497">var</span>&nbsp;<span class="ident" id="5072501">prefix</span>&nbsp;<span class="op" id="5072508">=</span>&nbsp;<span class="op" id="5072510">[</span><span class="op" id="5072511">]</span><span class="builtintype" id="5072512">byte</span><span class="op" id="5072516">(</span><span class="string" id="5072517">&#34;//line&nbsp;&#34;</span><span class="op" id="5072526">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="5072529">func</span>&nbsp;<span class="op" id="5072534">(</span><span class="ident" id="5072535">s</span>&nbsp;<span class="op" id="5072537">*</span><span class="ident" id="5072538">Scanner</span><span class="op" id="5072545">)</span>&nbsp;<span class="ident" id="5072547">interpretLineComment</span><span class="op" id="5072567">(</span><span class="ident" id="5072568">text</span>&nbsp;<span class="op" id="5072573">[</span><span class="op" id="5072574">]</span><span class="builtintype" id="5072575">byte</span><span class="op" id="5072579">)</span>&nbsp;<span class="op" id="5072581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072584">if</span>&nbsp;<span class="ident" id="5072587">bytes</span><span class="op" id="5072592">.</span><span class="ident" id="5072593">HasPrefix</span><span class="op" id="5072602">(</span><span class="ident" id="5072603">text</span><span class="op" id="5072607">,</span>&nbsp;<span class="ident" id="5072609">prefix</span><span class="op" id="5072615">)</span>&nbsp;<span class="op" id="5072617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5072621">//&nbsp;get&nbsp;filename&nbsp;and&nbsp;line&nbsp;number,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072663">if</span>&nbsp;<span class="ident" id="5072666">i</span>&nbsp;<span class="op" id="5072668">:=</span>&nbsp;<span class="ident" id="5072671">bytes</span><span class="op" id="5072676">.</span><span class="ident" id="5072677">LastIndex</span><span class="op" id="5072686">(</span><span class="ident" id="5072687">text</span><span class="op" id="5072691">,</span>&nbsp;<span class="op" id="5072693">[</span><span class="op" id="5072694">]</span><span class="builtintype" id="5072695">byte</span><span class="op" id="5072699">{</span><span class="string" id="5072700">&#39;:&#39;</span><span class="op" id="5072703">}</span><span class="op" id="5072704">)</span><span class="op" id="5072705">;</span>&nbsp;<span class="ident" id="5072707">i</span>&nbsp;<span class="op" id="5072709">&gt;</span>&nbsp;<span class="num" id="5072711">0</span>&nbsp;<span class="op" id="5072713">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072718">if</span>&nbsp;<span class="ident" id="5072721">line</span><span class="op" id="5072725">,</span>&nbsp;<span class="ident" id="5072727">err</span>&nbsp;<span class="op" id="5072731">:=</span>&nbsp;<span class="ident" id="5072734">strconv</span><span class="op" id="5072741">.</span><span class="ident" id="5072742">Atoi</span><span class="op" id="5072746">(</span><span class="builtintype" id="5072747">string</span><span class="op" id="5072753">(</span><span class="ident" id="5072754">text</span><span class="op" id="5072758">[</span><span class="ident" id="5072759">i</span><span class="op" id="5072760">+</span><span class="num" id="5072761">1</span><span class="op" id="5072762">:</span><span class="op" id="5072763">]</span><span class="op" id="5072764">)</span><span class="op" id="5072765">)</span><span class="op" id="5072766">;</span>&nbsp;<span class="ident" id="5072768">err</span>&nbsp;<span class="op" id="5072772">==</span>&nbsp;<span class="ident" id="5072775">nil</span>&nbsp;<span class="op" id="5072779">&amp;&amp;</span>&nbsp;<span class="ident" id="5072782">line</span>&nbsp;<span class="op" id="5072787">&gt;</span>&nbsp;<span class="num" id="5072789">0</span>&nbsp;<span class="op" id="5072791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5072797">//&nbsp;valid&nbsp;//line&nbsp;filename:line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072839">filename</span>&nbsp;<span class="op" id="5072848">:=</span>&nbsp;<span class="builtintype" id="5072851">string</span><span class="op" id="5072857">(</span><span class="ident" id="5072858">bytes</span><span class="op" id="5072863">.</span><span class="ident" id="5072864">TrimSpace</span><span class="op" id="5072873">(</span><span class="ident" id="5072874">text</span><span class="op" id="5072878">[</span><span class="builtinfunc" id="5072879">len</span><span class="op" id="5072882">(</span><span class="ident" id="5072883">prefix</span><span class="op" id="5072889">)</span><span class="op" id="5072890">:</span><span class="ident" id="5072891">i</span><span class="op" id="5072892">]</span><span class="op" id="5072893">)</span><span class="op" id="5072894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072900">if</span>&nbsp;<span class="ident" id="5072903">filename</span>&nbsp;<span class="op" id="5072912">!=</span>&nbsp;<span class="string" id="5072915">&#34;&#34;</span>&nbsp;<span class="op" id="5072918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5072925">filename</span>&nbsp;<span class="op" id="5072934">=</span>&nbsp;<span class="ident" id="5072936">filepath</span><span class="op" id="5072944">.</span><span class="ident" id="5072945">Clean</span><span class="op" id="5072950">(</span><span class="ident" id="5072951">filename</span><span class="op" id="5072959">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5072966">if</span>&nbsp;<span class="op" id="5072969">!</span><span class="ident" id="5072970">filepath</span><span class="op" id="5072978">.</span><span class="ident" id="5072979">IsAbs</span><span class="op" id="5072984">(</span><span class="ident" id="5072985">filename</span><span class="op" id="5072993">)</span>&nbsp;<span class="op" id="5072995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5073003">//&nbsp;make&nbsp;filename&nbsp;relative&nbsp;to&nbsp;current&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073056">filename</span>&nbsp;<span class="op" id="5073065">=</span>&nbsp;<span class="ident" id="5073067">filepath</span><span class="op" id="5073075">.</span><span class="ident" id="5073076">Join</span><span class="op" id="5073080">(</span><span class="ident" id="5073081">s</span><span class="op" id="5073082">.</span><span class="ident" id="5073083">dir</span><span class="op" id="5073086">,</span>&nbsp;<span class="ident" id="5073088">filename</span><span class="op" id="5073096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073109">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5073115">//&nbsp;update&nbsp;scanner&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073146">s</span><span class="op" id="5073147">.</span><span class="ident" id="5073148">file</span><span class="op" id="5073152">.</span><span class="ident" id="5073153">AddLineInfo</span><span class="op" id="5073164">(</span><span class="ident" id="5073165">s</span><span class="op" id="5073166">.</span><span class="ident" id="5073167">lineOffset</span><span class="op" id="5073177">+</span><span class="builtinfunc" id="5073178">len</span><span class="op" id="5073181">(</span><span class="ident" id="5073182">text</span><span class="op" id="5073186">)</span><span class="op" id="5073187">+</span><span class="num" id="5073188">1</span><span class="op" id="5073189">,</span>&nbsp;<span class="ident" id="5073191">filename</span><span class="op" id="5073199">,</span>&nbsp;<span class="ident" id="5073201">line</span><span class="op" id="5073205">)</span>&nbsp;<span class="comment" id="5073207">//&nbsp;+len(text)+1&nbsp;since&nbsp;comment&nbsp;applies&nbsp;to&nbsp;next&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073268">}</span><br>
<span class="lineno">165</span><span class="op" id="5073270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5073273">func</span>&nbsp;<span class="op" id="5073278">(</span><span class="ident" id="5073279">s</span>&nbsp;<span class="op" id="5073281">*</span><span class="ident" id="5073282">Scanner</span><span class="op" id="5073289">)</span>&nbsp;<span class="ident" id="5073291">scanComment</span><span class="op" id="5073302">(</span><span class="op" id="5073303">)</span>&nbsp;<span class="builtintype" id="5073305">string</span>&nbsp;<span class="op" id="5073312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5073315">//&nbsp;initial&nbsp;&#39;/&#39;&nbsp;already&nbsp;consumed;&nbsp;s.ch&nbsp;==&nbsp;&#39;/&#39;&nbsp;||&nbsp;s.ch&nbsp;==&nbsp;&#39;*&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073376">offs</span>&nbsp;<span class="op" id="5073381">:=</span>&nbsp;<span class="ident" id="5073384">s</span><span class="op" id="5073385">.</span><span class="ident" id="5073386">offset</span>&nbsp;<span class="op" id="5073393">-</span>&nbsp;<span class="num" id="5073395">1</span>&nbsp;<span class="comment" id="5073397">//&nbsp;position&nbsp;of&nbsp;initial&nbsp;&#39;/&#39;</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073425">hasCR</span>&nbsp;<span class="op" id="5073431">:=</span>&nbsp;<span class="ident" id="5073434">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073442">if</span>&nbsp;<span class="ident" id="5073445">s</span><span class="op" id="5073446">.</span><span class="ident" id="5073447">ch</span>&nbsp;<span class="op" id="5073450">==</span>&nbsp;<span class="string" id="5073453">&#39;/&#39;</span>&nbsp;<span class="op" id="5073457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5073461">//-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073480">s</span><span class="op" id="5073481">.</span><span class="ident" id="5073482">next</span><span class="op" id="5073486">(</span><span class="op" id="5073487">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073491">for</span>&nbsp;<span class="ident" id="5073495">s</span><span class="op" id="5073496">.</span><span class="ident" id="5073497">ch</span>&nbsp;<span class="op" id="5073500">!=</span>&nbsp;<span class="string" id="5073503">&#39;\n&#39;</span>&nbsp;<span class="op" id="5073508">&amp;&amp;</span>&nbsp;<span class="ident" id="5073511">s</span><span class="op" id="5073512">.</span><span class="ident" id="5073513">ch</span>&nbsp;<span class="op" id="5073516">&gt;=</span>&nbsp;<span class="num" id="5073519">0</span>&nbsp;<span class="op" id="5073521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073526">if</span>&nbsp;<span class="ident" id="5073529">s</span><span class="op" id="5073530">.</span><span class="ident" id="5073531">ch</span>&nbsp;<span class="op" id="5073534">==</span>&nbsp;<span class="string" id="5073537">&#39;\r&#39;</span>&nbsp;<span class="op" id="5073542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073548">hasCR</span>&nbsp;<span class="op" id="5073554">=</span>&nbsp;<span class="ident" id="5073556">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073569">s</span><span class="op" id="5073570">.</span><span class="ident" id="5073571">next</span><span class="op" id="5073575">(</span><span class="op" id="5073576">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073584">if</span>&nbsp;<span class="ident" id="5073587">offs</span>&nbsp;<span class="op" id="5073592">==</span>&nbsp;<span class="ident" id="5073595">s</span><span class="op" id="5073596">.</span><span class="ident" id="5073597">lineOffset</span>&nbsp;<span class="op" id="5073608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5073613">//&nbsp;comment&nbsp;starts&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;current&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073671">s</span><span class="op" id="5073672">.</span><span class="ident" id="5073673">interpretLineComment</span><span class="op" id="5073693">(</span><span class="ident" id="5073694">s</span><span class="op" id="5073695">.</span><span class="ident" id="5073696">src</span><span class="op" id="5073699">[</span><span class="ident" id="5073700">offs</span><span class="op" id="5073704">:</span><span class="ident" id="5073705">s</span><span class="op" id="5073706">.</span><span class="ident" id="5073707">offset</span><span class="op" id="5073713">]</span><span class="op" id="5073714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073718">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073722">goto</span>&nbsp;<span class="ident" id="5073727">exit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5073737">/*-style&nbsp;comment&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073758">s</span><span class="op" id="5073759">.</span><span class="ident" id="5073760">next</span><span class="op" id="5073764">(</span><span class="op" id="5073765">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073768">for</span>&nbsp;<span class="ident" id="5073772">s</span><span class="op" id="5073773">.</span><span class="ident" id="5073774">ch</span>&nbsp;<span class="op" id="5073777">&gt;=</span>&nbsp;<span class="num" id="5073780">0</span>&nbsp;<span class="op" id="5073782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073786">ch</span>&nbsp;<span class="op" id="5073789">:=</span>&nbsp;<span class="ident" id="5073792">s</span><span class="op" id="5073793">.</span><span class="ident" id="5073794">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073799">if</span>&nbsp;<span class="ident" id="5073802">ch</span>&nbsp;<span class="op" id="5073805">==</span>&nbsp;<span class="string" id="5073808">&#39;\r&#39;</span>&nbsp;<span class="op" id="5073813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073818">hasCR</span>&nbsp;<span class="op" id="5073824">=</span>&nbsp;<span class="ident" id="5073826">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073833">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073837">s</span><span class="op" id="5073838">.</span><span class="ident" id="5073839">next</span><span class="op" id="5073843">(</span><span class="op" id="5073844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073848">if</span>&nbsp;<span class="ident" id="5073851">ch</span>&nbsp;<span class="op" id="5073854">==</span>&nbsp;<span class="string" id="5073857">&#39;*&#39;</span>&nbsp;<span class="op" id="5073861">&amp;&amp;</span>&nbsp;<span class="ident" id="5073864">s</span><span class="op" id="5073865">.</span><span class="ident" id="5073866">ch</span>&nbsp;<span class="op" id="5073869">==</span>&nbsp;<span class="string" id="5073872">&#39;/&#39;</span>&nbsp;<span class="op" id="5073876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073881">s</span><span class="op" id="5073882">.</span><span class="ident" id="5073883">next</span><span class="op" id="5073887">(</span><span class="op" id="5073888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073893">goto</span>&nbsp;<span class="ident" id="5073898">exit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073905">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5073908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073912">s</span><span class="op" id="5073913">.</span><span class="builtintype" id="5073914">error</span><span class="op" id="5073919">(</span><span class="ident" id="5073920">offs</span><span class="op" id="5073924">,</span>&nbsp;<span class="string" id="5073926">&#34;comment&nbsp;not&nbsp;terminated&#34;</span><span class="op" id="5073950">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="5073953">exit</span><span class="op" id="5073957">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073960">lit</span>&nbsp;<span class="op" id="5073964">:=</span>&nbsp;<span class="ident" id="5073967">s</span><span class="op" id="5073968">.</span><span class="ident" id="5073969">src</span><span class="op" id="5073972">[</span><span class="ident" id="5073973">offs</span><span class="op" id="5073977">:</span><span class="ident" id="5073978">s</span><span class="op" id="5073979">.</span><span class="ident" id="5073980">offset</span><span class="op" id="5073986">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5073989">if</span>&nbsp;<span class="ident" id="5073992">hasCR</span>&nbsp;<span class="op" id="5073998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074002">lit</span>&nbsp;<span class="op" id="5074006">=</span>&nbsp;<span class="ident" id="5074008">stripCR</span><span class="op" id="5074015">(</span><span class="ident" id="5074016">lit</span><span class="op" id="5074019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074026">return</span>&nbsp;<span class="builtintype" id="5074033">string</span><span class="op" id="5074039">(</span><span class="ident" id="5074040">lit</span><span class="op" id="5074043">)</span><br>
<span class="lineno"></span><span class="op" id="5074045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5074048">func</span>&nbsp;<span class="op" id="5074053">(</span><span class="ident" id="5074054">s</span>&nbsp;<span class="op" id="5074056">*</span><span class="ident" id="5074057">Scanner</span><span class="op" id="5074064">)</span>&nbsp;<span class="ident" id="5074066">findLineEnd</span><span class="op" id="5074077">(</span><span class="op" id="5074078">)</span>&nbsp;<span class="builtintype" id="5074080">bool</span>&nbsp;<span class="op" id="5074085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5074088">//&nbsp;initial&nbsp;&#39;/&#39;&nbsp;already&nbsp;consumed</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074122">defer</span>&nbsp;<span class="keyword" id="5074128">func</span><span class="op" id="5074132">(</span><span class="ident" id="5074133">offs</span>&nbsp;<span class="builtintype" id="5074138">int</span><span class="op" id="5074141">)</span>&nbsp;<span class="op" id="5074143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5074147">//&nbsp;reset&nbsp;scanner&nbsp;state&nbsp;to&nbsp;where&nbsp;it&nbsp;was&nbsp;upon&nbsp;calling&nbsp;findLineEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074213">s</span><span class="op" id="5074214">.</span><span class="ident" id="5074215">ch</span>&nbsp;<span class="op" id="5074218">=</span>&nbsp;<span class="string" id="5074220">&#39;/&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074226">s</span><span class="op" id="5074227">.</span><span class="ident" id="5074228">offset</span>&nbsp;<span class="op" id="5074235">=</span>&nbsp;<span class="ident" id="5074237">offs</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074244">s</span><span class="op" id="5074245">.</span><span class="ident" id="5074246">rdOffset</span>&nbsp;<span class="op" id="5074255">=</span>&nbsp;<span class="ident" id="5074257">offs</span>&nbsp;<span class="op" id="5074262">+</span>&nbsp;<span class="num" id="5074264">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074268">s</span><span class="op" id="5074269">.</span><span class="ident" id="5074270">next</span><span class="op" id="5074274">(</span><span class="op" id="5074275">)</span>&nbsp;<span class="comment" id="5074277">//&nbsp;consume&nbsp;initial&nbsp;&#39;/&#39;&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074307">}</span><span class="op" id="5074308">(</span><span class="ident" id="5074309">s</span><span class="op" id="5074310">.</span><span class="ident" id="5074311">offset</span>&nbsp;<span class="op" id="5074318">-</span>&nbsp;<span class="num" id="5074320">1</span><span class="op" id="5074321">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5074325">//&nbsp;read&nbsp;ahead&nbsp;until&nbsp;a&nbsp;newline,&nbsp;EOF,&nbsp;or&nbsp;non-comment&nbsp;token&nbsp;is&nbsp;found</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074392">for</span>&nbsp;<span class="ident" id="5074396">s</span><span class="op" id="5074397">.</span><span class="ident" id="5074398">ch</span>&nbsp;<span class="op" id="5074401">==</span>&nbsp;<span class="string" id="5074404">&#39;/&#39;</span>&nbsp;<span class="op" id="5074408">||</span>&nbsp;<span class="ident" id="5074411">s</span><span class="op" id="5074412">.</span><span class="ident" id="5074413">ch</span>&nbsp;<span class="op" id="5074416">==</span>&nbsp;<span class="string" id="5074419">&#39;*&#39;</span>&nbsp;<span class="op" id="5074423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074427">if</span>&nbsp;<span class="ident" id="5074430">s</span><span class="op" id="5074431">.</span><span class="ident" id="5074432">ch</span>&nbsp;<span class="op" id="5074435">==</span>&nbsp;<span class="string" id="5074438">&#39;/&#39;</span>&nbsp;<span class="op" id="5074442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5074447">//-style&nbsp;comment&nbsp;always&nbsp;contains&nbsp;a&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074493">return</span>&nbsp;<span class="ident" id="5074500">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074507">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5074511">/*-style&nbsp;comment:&nbsp;look&nbsp;for&nbsp;newline&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074551">s</span><span class="op" id="5074552">.</span><span class="ident" id="5074553">next</span><span class="op" id="5074557">(</span><span class="op" id="5074558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074562">for</span>&nbsp;<span class="ident" id="5074566">s</span><span class="op" id="5074567">.</span><span class="ident" id="5074568">ch</span>&nbsp;<span class="op" id="5074571">&gt;=</span>&nbsp;<span class="num" id="5074574">0</span>&nbsp;<span class="op" id="5074576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074581">ch</span>&nbsp;<span class="op" id="5074584">:=</span>&nbsp;<span class="ident" id="5074587">s</span><span class="op" id="5074588">.</span><span class="ident" id="5074589">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074595">if</span>&nbsp;<span class="ident" id="5074598">ch</span>&nbsp;<span class="op" id="5074601">==</span>&nbsp;<span class="string" id="5074604">&#39;\n&#39;</span>&nbsp;<span class="op" id="5074609">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074615">return</span>&nbsp;<span class="ident" id="5074622">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074635">s</span><span class="op" id="5074636">.</span><span class="ident" id="5074637">next</span><span class="op" id="5074641">(</span><span class="op" id="5074642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074647">if</span>&nbsp;<span class="ident" id="5074650">ch</span>&nbsp;<span class="op" id="5074653">==</span>&nbsp;<span class="string" id="5074656">&#39;*&#39;</span>&nbsp;<span class="op" id="5074660">&amp;&amp;</span>&nbsp;<span class="ident" id="5074663">s</span><span class="op" id="5074664">.</span><span class="ident" id="5074665">ch</span>&nbsp;<span class="op" id="5074668">==</span>&nbsp;<span class="string" id="5074671">&#39;/&#39;</span>&nbsp;<span class="op" id="5074675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074681">s</span><span class="op" id="5074682">.</span><span class="ident" id="5074683">next</span><span class="op" id="5074687">(</span><span class="op" id="5074688">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074694">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074711">s</span><span class="op" id="5074712">.</span><span class="ident" id="5074713">skipWhitespace</span><span class="op" id="5074727">(</span><span class="op" id="5074728">)</span>&nbsp;<span class="comment" id="5074730">//&nbsp;s.insertSemi&nbsp;is&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074755">if</span>&nbsp;<span class="ident" id="5074758">s</span><span class="op" id="5074759">.</span><span class="ident" id="5074760">ch</span>&nbsp;<span class="op" id="5074763">&lt;</span>&nbsp;<span class="num" id="5074765">0</span>&nbsp;<span class="op" id="5074767">||</span>&nbsp;<span class="ident" id="5074770">s</span><span class="op" id="5074771">.</span><span class="ident" id="5074772">ch</span>&nbsp;<span class="op" id="5074775">==</span>&nbsp;<span class="string" id="5074778">&#39;\n&#39;</span>&nbsp;<span class="op" id="5074783">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074788">return</span>&nbsp;<span class="ident" id="5074795">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074806">if</span>&nbsp;<span class="ident" id="5074809">s</span><span class="op" id="5074810">.</span><span class="ident" id="5074811">ch</span>&nbsp;<span class="op" id="5074814">!=</span>&nbsp;<span class="string" id="5074817">&#39;/&#39;</span>&nbsp;<span class="op" id="5074821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5074826">//&nbsp;non-comment&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074850">return</span>&nbsp;<span class="ident" id="5074857">false</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074869">s</span><span class="op" id="5074870">.</span><span class="ident" id="5074871">next</span><span class="op" id="5074875">(</span><span class="op" id="5074876">)</span>&nbsp;<span class="comment" id="5074878">//&nbsp;consume&nbsp;&#39;/&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074898">return</span>&nbsp;<span class="ident" id="5074905">false</span><br>
<span class="lineno">255</span><span class="op" id="5074911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5074914">func</span>&nbsp;<span class="ident" id="5074919">isLetter</span><span class="op" id="5074927">(</span><span class="ident" id="5074928">ch</span>&nbsp;<span class="builtintype" id="5074931">rune</span><span class="op" id="5074935">)</span>&nbsp;<span class="builtintype" id="5074937">bool</span>&nbsp;<span class="op" id="5074942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074945">return</span>&nbsp;<span class="string" id="5074952">&#39;a&#39;</span>&nbsp;<span class="op" id="5074956">&lt;=</span>&nbsp;<span class="ident" id="5074959">ch</span>&nbsp;<span class="op" id="5074962">&amp;&amp;</span>&nbsp;<span class="ident" id="5074965">ch</span>&nbsp;<span class="op" id="5074968">&lt;=</span>&nbsp;<span class="string" id="5074971">&#39;z&#39;</span>&nbsp;<span class="op" id="5074975">||</span>&nbsp;<span class="string" id="5074978">&#39;A&#39;</span>&nbsp;<span class="op" id="5074982">&lt;=</span>&nbsp;<span class="ident" id="5074985">ch</span>&nbsp;<span class="op" id="5074988">&amp;&amp;</span>&nbsp;<span class="ident" id="5074991">ch</span>&nbsp;<span class="op" id="5074994">&lt;=</span>&nbsp;<span class="string" id="5074997">&#39;Z&#39;</span>&nbsp;<span class="op" id="5075001">||</span>&nbsp;<span class="ident" id="5075004">ch</span>&nbsp;<span class="op" id="5075007">==</span>&nbsp;<span class="string" id="5075010">&#39;_&#39;</span>&nbsp;<span class="op" id="5075014">||</span>&nbsp;<span class="ident" id="5075017">ch</span>&nbsp;<span class="op" id="5075020">&gt;=</span>&nbsp;<span class="num" id="5075023">0x80</span>&nbsp;<span class="op" id="5075028">&amp;&amp;</span>&nbsp;<span class="ident" id="5075031">unicode</span><span class="op" id="5075038">.</span><span class="ident" id="5075039">IsLetter</span><span class="op" id="5075047">(</span><span class="ident" id="5075048">ch</span><span class="op" id="5075050">)</span><br>
<span class="lineno"></span><span class="op" id="5075052">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="5075055">func</span>&nbsp;<span class="ident" id="5075060">isDigit</span><span class="op" id="5075067">(</span><span class="ident" id="5075068">ch</span>&nbsp;<span class="builtintype" id="5075071">rune</span><span class="op" id="5075075">)</span>&nbsp;<span class="builtintype" id="5075077">bool</span>&nbsp;<span class="op" id="5075082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075085">return</span>&nbsp;<span class="string" id="5075092">&#39;0&#39;</span>&nbsp;<span class="op" id="5075096">&lt;=</span>&nbsp;<span class="ident" id="5075099">ch</span>&nbsp;<span class="op" id="5075102">&amp;&amp;</span>&nbsp;<span class="ident" id="5075105">ch</span>&nbsp;<span class="op" id="5075108">&lt;=</span>&nbsp;<span class="string" id="5075111">&#39;9&#39;</span>&nbsp;<span class="op" id="5075115">||</span>&nbsp;<span class="ident" id="5075118">ch</span>&nbsp;<span class="op" id="5075121">&gt;=</span>&nbsp;<span class="num" id="5075124">0x80</span>&nbsp;<span class="op" id="5075129">&amp;&amp;</span>&nbsp;<span class="ident" id="5075132">unicode</span><span class="op" id="5075139">.</span><span class="ident" id="5075140">IsDigit</span><span class="op" id="5075147">(</span><span class="ident" id="5075148">ch</span><span class="op" id="5075150">)</span><br>
<span class="lineno"></span><span class="op" id="5075152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="keyword" id="5075155">func</span>&nbsp;<span class="op" id="5075160">(</span><span class="ident" id="5075161">s</span>&nbsp;<span class="op" id="5075163">*</span><span class="ident" id="5075164">Scanner</span><span class="op" id="5075171">)</span>&nbsp;<span class="ident" id="5075173">scanIdentifier</span><span class="op" id="5075187">(</span><span class="op" id="5075188">)</span>&nbsp;<span class="builtintype" id="5075190">string</span>&nbsp;<span class="op" id="5075197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075200">offs</span>&nbsp;<span class="op" id="5075205">:=</span>&nbsp;<span class="ident" id="5075208">s</span><span class="op" id="5075209">.</span><span class="ident" id="5075210">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075218">for</span>&nbsp;<span class="ident" id="5075222">isLetter</span><span class="op" id="5075230">(</span><span class="ident" id="5075231">s</span><span class="op" id="5075232">.</span><span class="ident" id="5075233">ch</span><span class="op" id="5075235">)</span>&nbsp;<span class="op" id="5075237">||</span>&nbsp;<span class="ident" id="5075240">isDigit</span><span class="op" id="5075247">(</span><span class="ident" id="5075248">s</span><span class="op" id="5075249">.</span><span class="ident" id="5075250">ch</span><span class="op" id="5075252">)</span>&nbsp;<span class="op" id="5075254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075258">s</span><span class="op" id="5075259">.</span><span class="ident" id="5075260">next</span><span class="op" id="5075264">(</span><span class="op" id="5075265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075268">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075271">return</span>&nbsp;<span class="builtintype" id="5075278">string</span><span class="op" id="5075284">(</span><span class="ident" id="5075285">s</span><span class="op" id="5075286">.</span><span class="ident" id="5075287">src</span><span class="op" id="5075290">[</span><span class="ident" id="5075291">offs</span><span class="op" id="5075295">:</span><span class="ident" id="5075296">s</span><span class="op" id="5075297">.</span><span class="ident" id="5075298">offset</span><span class="op" id="5075304">]</span><span class="op" id="5075305">)</span><br>
<span class="lineno"></span><span class="op" id="5075307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5075310">func</span>&nbsp;<span class="ident" id="5075315">digitVal</span><span class="op" id="5075323">(</span><span class="ident" id="5075324">ch</span>&nbsp;<span class="builtintype" id="5075327">rune</span><span class="op" id="5075331">)</span>&nbsp;<span class="builtintype" id="5075333">int</span>&nbsp;<span class="op" id="5075337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075340">switch</span>&nbsp;<span class="op" id="5075347">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075350">case</span>&nbsp;<span class="string" id="5075355">&#39;0&#39;</span>&nbsp;<span class="op" id="5075359">&lt;=</span>&nbsp;<span class="ident" id="5075362">ch</span>&nbsp;<span class="op" id="5075365">&amp;&amp;</span>&nbsp;<span class="ident" id="5075368">ch</span>&nbsp;<span class="op" id="5075371">&lt;=</span>&nbsp;<span class="string" id="5075374">&#39;9&#39;</span><span class="op" id="5075377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075381">return</span>&nbsp;<span class="builtintype" id="5075388">int</span><span class="op" id="5075391">(</span><span class="ident" id="5075392">ch</span>&nbsp;<span class="op" id="5075395">-</span>&nbsp;<span class="string" id="5075397">&#39;0&#39;</span><span class="op" id="5075400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075403">case</span>&nbsp;<span class="string" id="5075408">&#39;a&#39;</span>&nbsp;<span class="op" id="5075412">&lt;=</span>&nbsp;<span class="ident" id="5075415">ch</span>&nbsp;<span class="op" id="5075418">&amp;&amp;</span>&nbsp;<span class="ident" id="5075421">ch</span>&nbsp;<span class="op" id="5075424">&lt;=</span>&nbsp;<span class="string" id="5075427">&#39;f&#39;</span><span class="op" id="5075430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075434">return</span>&nbsp;<span class="builtintype" id="5075441">int</span><span class="op" id="5075444">(</span><span class="ident" id="5075445">ch</span>&nbsp;<span class="op" id="5075448">-</span>&nbsp;<span class="string" id="5075450">&#39;a&#39;</span>&nbsp;<span class="op" id="5075454">+</span>&nbsp;<span class="num" id="5075456">10</span><span class="op" id="5075458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075461">case</span>&nbsp;<span class="string" id="5075466">&#39;A&#39;</span>&nbsp;<span class="op" id="5075470">&lt;=</span>&nbsp;<span class="ident" id="5075473">ch</span>&nbsp;<span class="op" id="5075476">&amp;&amp;</span>&nbsp;<span class="ident" id="5075479">ch</span>&nbsp;<span class="op" id="5075482">&lt;=</span>&nbsp;<span class="string" id="5075485">&#39;F&#39;</span><span class="op" id="5075488">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075492">return</span>&nbsp;<span class="builtintype" id="5075499">int</span><span class="op" id="5075502">(</span><span class="ident" id="5075503">ch</span>&nbsp;<span class="op" id="5075506">-</span>&nbsp;<span class="string" id="5075508">&#39;A&#39;</span>&nbsp;<span class="op" id="5075512">+</span>&nbsp;<span class="num" id="5075514">10</span><span class="op" id="5075516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075522">return</span>&nbsp;<span class="num" id="5075529">16</span>&nbsp;<span class="comment" id="5075532">//&nbsp;larger&nbsp;than&nbsp;any&nbsp;legal&nbsp;digit&nbsp;val</span><br>
<span class="lineno"></span><span class="op" id="5075567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5075570">func</span>&nbsp;<span class="op" id="5075575">(</span><span class="ident" id="5075576">s</span>&nbsp;<span class="op" id="5075578">*</span><span class="ident" id="5075579">Scanner</span><span class="op" id="5075586">)</span>&nbsp;<span class="ident" id="5075588">scanMantissa</span><span class="op" id="5075600">(</span><span class="ident" id="5075601">base</span>&nbsp;<span class="builtintype" id="5075606">int</span><span class="op" id="5075609">)</span>&nbsp;<span class="op" id="5075611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075614">for</span>&nbsp;<span class="ident" id="5075618">digitVal</span><span class="op" id="5075626">(</span><span class="ident" id="5075627">s</span><span class="op" id="5075628">.</span><span class="ident" id="5075629">ch</span><span class="op" id="5075631">)</span>&nbsp;<span class="op" id="5075633">&lt;</span>&nbsp;<span class="ident" id="5075635">base</span>&nbsp;<span class="op" id="5075640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075644">s</span><span class="op" id="5075645">.</span><span class="ident" id="5075646">next</span><span class="op" id="5075650">(</span><span class="op" id="5075651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075654">}</span><br>
<span class="lineno"></span><span class="op" id="5075656">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span><span class="keyword" id="5075659">func</span>&nbsp;<span class="op" id="5075664">(</span><span class="ident" id="5075665">s</span>&nbsp;<span class="op" id="5075667">*</span><span class="ident" id="5075668">Scanner</span><span class="op" id="5075675">)</span>&nbsp;<span class="ident" id="5075677">scanNumber</span><span class="op" id="5075687">(</span><span class="ident" id="5075688">seenDecimalPoint</span>&nbsp;<span class="builtintype" id="5075705">bool</span><span class="op" id="5075709">)</span>&nbsp;<span class="op" id="5075711">(</span><span class="ident" id="5075712">token</span><span class="op" id="5075717">.</span><span class="ident" id="5075718">Token</span><span class="op" id="5075723">,</span>&nbsp;<span class="builtintype" id="5075725">string</span><span class="op" id="5075731">)</span>&nbsp;<span class="op" id="5075733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5075736">//&nbsp;digitVal(s.ch)&nbsp;&lt;&nbsp;10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075760">offs</span>&nbsp;<span class="op" id="5075765">:=</span>&nbsp;<span class="ident" id="5075768">s</span><span class="op" id="5075769">.</span><span class="ident" id="5075770">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075778">tok</span>&nbsp;<span class="op" id="5075782">:=</span>&nbsp;<span class="ident" id="5075785">token</span><span class="op" id="5075790">.</span><span class="ident" id="5075791">INT</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075797">if</span>&nbsp;<span class="ident" id="5075800">seenDecimalPoint</span>&nbsp;<span class="op" id="5075817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075821">offs</span><span class="op" id="5075825">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075830">tok</span>&nbsp;<span class="op" id="5075834">=</span>&nbsp;<span class="ident" id="5075836">token</span><span class="op" id="5075841">.</span><span class="ident" id="5075842">FLOAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075850">s</span><span class="op" id="5075851">.</span><span class="ident" id="5075852">scanMantissa</span><span class="op" id="5075864">(</span><span class="num" id="5075865">10</span><span class="op" id="5075867">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075871">goto</span>&nbsp;<span class="ident" id="5075876">exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075890">if</span>&nbsp;<span class="ident" id="5075893">s</span><span class="op" id="5075894">.</span><span class="ident" id="5075895">ch</span>&nbsp;<span class="op" id="5075898">==</span>&nbsp;<span class="string" id="5075901">&#39;0&#39;</span>&nbsp;<span class="op" id="5075905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5075909">//&nbsp;int&nbsp;or&nbsp;float</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075927">offs</span>&nbsp;<span class="op" id="5075932">:=</span>&nbsp;<span class="ident" id="5075935">s</span><span class="op" id="5075936">.</span><span class="ident" id="5075937">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075946">s</span><span class="op" id="5075947">.</span><span class="ident" id="5075948">next</span><span class="op" id="5075952">(</span><span class="op" id="5075953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075957">if</span>&nbsp;<span class="ident" id="5075960">s</span><span class="op" id="5075961">.</span><span class="ident" id="5075962">ch</span>&nbsp;<span class="op" id="5075965">==</span>&nbsp;<span class="string" id="5075968">&#39;x&#39;</span>&nbsp;<span class="op" id="5075972">||</span>&nbsp;<span class="ident" id="5075975">s</span><span class="op" id="5075976">.</span><span class="ident" id="5075977">ch</span>&nbsp;<span class="op" id="5075980">==</span>&nbsp;<span class="string" id="5075983">&#39;X&#39;</span>&nbsp;<span class="op" id="5075987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5075992">//&nbsp;hexadecimal&nbsp;int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076014">s</span><span class="op" id="5076015">.</span><span class="ident" id="5076016">next</span><span class="op" id="5076020">(</span><span class="op" id="5076021">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076026">s</span><span class="op" id="5076027">.</span><span class="ident" id="5076028">scanMantissa</span><span class="op" id="5076040">(</span><span class="num" id="5076041">16</span><span class="op" id="5076043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076048">if</span>&nbsp;<span class="ident" id="5076051">s</span><span class="op" id="5076052">.</span><span class="ident" id="5076053">offset</span><span class="op" id="5076059">-</span><span class="ident" id="5076060">offs</span>&nbsp;<span class="op" id="5076065">&lt;=</span>&nbsp;<span class="num" id="5076068">2</span>&nbsp;<span class="op" id="5076070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5076076">//&nbsp;only&nbsp;scanned&nbsp;&#34;0x&#34;&nbsp;or&nbsp;&#34;0X&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076109">s</span><span class="op" id="5076110">.</span><span class="builtintype" id="5076111">error</span><span class="op" id="5076116">(</span><span class="ident" id="5076117">offs</span><span class="op" id="5076121">,</span>&nbsp;<span class="string" id="5076123">&#34;illegal&nbsp;hexadecimal&nbsp;number&#34;</span><span class="op" id="5076151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076156">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076160">}</span>&nbsp;<span class="keyword" id="5076162">else</span>&nbsp;<span class="op" id="5076167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5076172">//&nbsp;octal&nbsp;int&nbsp;or&nbsp;float</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076197">seenDecimalDigit</span>&nbsp;<span class="op" id="5076214">:=</span>&nbsp;<span class="ident" id="5076217">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076226">s</span><span class="op" id="5076227">.</span><span class="ident" id="5076228">scanMantissa</span><span class="op" id="5076240">(</span><span class="num" id="5076241">8</span><span class="op" id="5076242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076247">if</span>&nbsp;<span class="ident" id="5076250">s</span><span class="op" id="5076251">.</span><span class="ident" id="5076252">ch</span>&nbsp;<span class="op" id="5076255">==</span>&nbsp;<span class="string" id="5076258">&#39;8&#39;</span>&nbsp;<span class="op" id="5076262">||</span>&nbsp;<span class="ident" id="5076265">s</span><span class="op" id="5076266">.</span><span class="ident" id="5076267">ch</span>&nbsp;<span class="op" id="5076270">==</span>&nbsp;<span class="string" id="5076273">&#39;9&#39;</span>&nbsp;<span class="op" id="5076277">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5076283">//&nbsp;illegal&nbsp;octal&nbsp;int&nbsp;or&nbsp;float</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076317">seenDecimalDigit</span>&nbsp;<span class="op" id="5076334">=</span>&nbsp;<span class="ident" id="5076336">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076345">s</span><span class="op" id="5076346">.</span><span class="ident" id="5076347">scanMantissa</span><span class="op" id="5076359">(</span><span class="num" id="5076360">10</span><span class="op" id="5076362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076372">if</span>&nbsp;<span class="ident" id="5076375">s</span><span class="op" id="5076376">.</span><span class="ident" id="5076377">ch</span>&nbsp;<span class="op" id="5076380">==</span>&nbsp;<span class="string" id="5076383">&#39;.&#39;</span>&nbsp;<span class="op" id="5076387">||</span>&nbsp;<span class="ident" id="5076390">s</span><span class="op" id="5076391">.</span><span class="ident" id="5076392">ch</span>&nbsp;<span class="op" id="5076395">==</span>&nbsp;<span class="string" id="5076398">&#39;e&#39;</span>&nbsp;<span class="op" id="5076402">||</span>&nbsp;<span class="ident" id="5076405">s</span><span class="op" id="5076406">.</span><span class="ident" id="5076407">ch</span>&nbsp;<span class="op" id="5076410">==</span>&nbsp;<span class="string" id="5076413">&#39;E&#39;</span>&nbsp;<span class="op" id="5076417">||</span>&nbsp;<span class="ident" id="5076420">s</span><span class="op" id="5076421">.</span><span class="ident" id="5076422">ch</span>&nbsp;<span class="op" id="5076425">==</span>&nbsp;<span class="string" id="5076428">&#39;i&#39;</span>&nbsp;<span class="op" id="5076432">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076438">goto</span>&nbsp;<span class="ident" id="5076443">fraction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5076460">//&nbsp;octal&nbsp;int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076476">if</span>&nbsp;<span class="ident" id="5076479">seenDecimalDigit</span>&nbsp;<span class="op" id="5076496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076502">s</span><span class="op" id="5076503">.</span><span class="builtintype" id="5076504">error</span><span class="op" id="5076509">(</span><span class="ident" id="5076510">offs</span><span class="op" id="5076514">,</span>&nbsp;<span class="string" id="5076516">&#34;illegal&nbsp;octal&nbsp;number&#34;</span><span class="op" id="5076538">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076551">goto</span>&nbsp;<span class="ident" id="5076556">exit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5076566">//&nbsp;decimal&nbsp;int&nbsp;or&nbsp;float</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076591">s</span><span class="op" id="5076592">.</span><span class="ident" id="5076593">scanMantissa</span><span class="op" id="5076605">(</span><span class="num" id="5076606">10</span><span class="op" id="5076608">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="5076611">fraction</span><span class="op" id="5076619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076622">if</span>&nbsp;<span class="ident" id="5076625">s</span><span class="op" id="5076626">.</span><span class="ident" id="5076627">ch</span>&nbsp;<span class="op" id="5076630">==</span>&nbsp;<span class="string" id="5076633">&#39;.&#39;</span>&nbsp;<span class="op" id="5076637">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076641">tok</span>&nbsp;<span class="op" id="5076645">=</span>&nbsp;<span class="ident" id="5076647">token</span><span class="op" id="5076652">.</span><span class="ident" id="5076653">FLOAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076661">s</span><span class="op" id="5076662">.</span><span class="ident" id="5076663">next</span><span class="op" id="5076667">(</span><span class="op" id="5076668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076672">s</span><span class="op" id="5076673">.</span><span class="ident" id="5076674">scanMantissa</span><span class="op" id="5076686">(</span><span class="num" id="5076687">10</span><span class="op" id="5076689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="ident" id="5076695">exponent</span><span class="op" id="5076703">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076706">if</span>&nbsp;<span class="ident" id="5076709">s</span><span class="op" id="5076710">.</span><span class="ident" id="5076711">ch</span>&nbsp;<span class="op" id="5076714">==</span>&nbsp;<span class="string" id="5076717">&#39;e&#39;</span>&nbsp;<span class="op" id="5076721">||</span>&nbsp;<span class="ident" id="5076724">s</span><span class="op" id="5076725">.</span><span class="ident" id="5076726">ch</span>&nbsp;<span class="op" id="5076729">==</span>&nbsp;<span class="string" id="5076732">&#39;E&#39;</span>&nbsp;<span class="op" id="5076736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076740">tok</span>&nbsp;<span class="op" id="5076744">=</span>&nbsp;<span class="ident" id="5076746">token</span><span class="op" id="5076751">.</span><span class="ident" id="5076752">FLOAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076760">s</span><span class="op" id="5076761">.</span><span class="ident" id="5076762">next</span><span class="op" id="5076766">(</span><span class="op" id="5076767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076771">if</span>&nbsp;<span class="ident" id="5076774">s</span><span class="op" id="5076775">.</span><span class="ident" id="5076776">ch</span>&nbsp;<span class="op" id="5076779">==</span>&nbsp;<span class="string" id="5076782">&#39;-&#39;</span>&nbsp;<span class="op" id="5076786">||</span>&nbsp;<span class="ident" id="5076789">s</span><span class="op" id="5076790">.</span><span class="ident" id="5076791">ch</span>&nbsp;<span class="op" id="5076794">==</span>&nbsp;<span class="string" id="5076797">&#39;+&#39;</span>&nbsp;<span class="op" id="5076801">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076806">s</span><span class="op" id="5076807">.</span><span class="ident" id="5076808">next</span><span class="op" id="5076812">(</span><span class="op" id="5076813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076821">s</span><span class="op" id="5076822">.</span><span class="ident" id="5076823">scanMantissa</span><span class="op" id="5076835">(</span><span class="num" id="5076836">10</span><span class="op" id="5076838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076845">if</span>&nbsp;<span class="ident" id="5076848">s</span><span class="op" id="5076849">.</span><span class="ident" id="5076850">ch</span>&nbsp;<span class="op" id="5076853">==</span>&nbsp;<span class="string" id="5076856">&#39;i&#39;</span>&nbsp;<span class="op" id="5076860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076864">tok</span>&nbsp;<span class="op" id="5076868">=</span>&nbsp;<span class="ident" id="5076870">token</span><span class="op" id="5076875">.</span><span class="ident" id="5076876">IMAG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076883">s</span><span class="op" id="5076884">.</span><span class="ident" id="5076885">next</span><span class="op" id="5076889">(</span><span class="op" id="5076890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="ident" id="5076896">exit</span><span class="op" id="5076900">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076903">return</span>&nbsp;<span class="ident" id="5076910">tok</span><span class="op" id="5076913">,</span>&nbsp;<span class="builtintype" id="5076915">string</span><span class="op" id="5076921">(</span><span class="ident" id="5076922">s</span><span class="op" id="5076923">.</span><span class="ident" id="5076924">src</span><span class="op" id="5076927">[</span><span class="ident" id="5076928">offs</span><span class="op" id="5076932">:</span><span class="ident" id="5076933">s</span><span class="op" id="5076934">.</span><span class="ident" id="5076935">offset</span><span class="op" id="5076941">]</span><span class="op" id="5076942">)</span><br>
<span class="lineno"></span><span class="op" id="5076944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5076947">//&nbsp;scanEscape&nbsp;parses&nbsp;an&nbsp;escape&nbsp;sequence&nbsp;where&nbsp;rune&nbsp;is&nbsp;the&nbsp;accepted</span><br>
<span class="lineno">365</span><span class="comment" id="5077014">//&nbsp;escaped&nbsp;quote.&nbsp;In&nbsp;case&nbsp;of&nbsp;a&nbsp;syntax&nbsp;error,&nbsp;it&nbsp;stops&nbsp;at&nbsp;the&nbsp;offending</span><br>
<span class="lineno"></span><span class="comment" id="5077085">//&nbsp;character&nbsp;(without&nbsp;consuming&nbsp;it)&nbsp;and&nbsp;returns&nbsp;false.&nbsp;Otherwise</span><br>
<span class="lineno"></span><span class="comment" id="5077150">//&nbsp;it&nbsp;returns&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5077170">func</span>&nbsp;<span class="op" id="5077175">(</span><span class="ident" id="5077176">s</span>&nbsp;<span class="op" id="5077178">*</span><span class="ident" id="5077179">Scanner</span><span class="op" id="5077186">)</span>&nbsp;<span class="ident" id="5077188">scanEscape</span><span class="op" id="5077198">(</span><span class="ident" id="5077199">quote</span>&nbsp;<span class="builtintype" id="5077205">rune</span><span class="op" id="5077209">)</span>&nbsp;<span class="builtintype" id="5077211">bool</span>&nbsp;<span class="op" id="5077216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077219">offs</span>&nbsp;<span class="op" id="5077224">:=</span>&nbsp;<span class="ident" id="5077227">s</span><span class="op" id="5077228">.</span><span class="ident" id="5077229">offset</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077238">var</span>&nbsp;<span class="ident" id="5077242">n</span>&nbsp;<span class="builtintype" id="5077244">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077249">var</span>&nbsp;<span class="ident" id="5077253">base</span><span class="op" id="5077257">,</span>&nbsp;<span class="ident" id="5077259">max</span>&nbsp;<span class="builtintype" id="5077263">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077271">switch</span>&nbsp;<span class="ident" id="5077278">s</span><span class="op" id="5077279">.</span><span class="ident" id="5077280">ch</span>&nbsp;<span class="op" id="5077283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077286">case</span>&nbsp;<span class="string" id="5077291">&#39;a&#39;</span><span class="op" id="5077294">,</span>&nbsp;<span class="string" id="5077296">&#39;b&#39;</span><span class="op" id="5077299">,</span>&nbsp;<span class="string" id="5077301">&#39;f&#39;</span><span class="op" id="5077304">,</span>&nbsp;<span class="string" id="5077306">&#39;n&#39;</span><span class="op" id="5077309">,</span>&nbsp;<span class="string" id="5077311">&#39;r&#39;</span><span class="op" id="5077314">,</span>&nbsp;<span class="string" id="5077316">&#39;t&#39;</span><span class="op" id="5077319">,</span>&nbsp;<span class="string" id="5077321">&#39;v&#39;</span><span class="op" id="5077324">,</span>&nbsp;<span class="string" id="5077326">&#39;\\&#39;</span><span class="op" id="5077330">,</span>&nbsp;<span class="ident" id="5077332">quote</span><span class="op" id="5077337">:</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077341">s</span><span class="op" id="5077342">.</span><span class="ident" id="5077343">next</span><span class="op" id="5077347">(</span><span class="op" id="5077348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077352">return</span>&nbsp;<span class="ident" id="5077359">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077365">case</span>&nbsp;<span class="string" id="5077370">&#39;0&#39;</span><span class="op" id="5077373">,</span>&nbsp;<span class="string" id="5077375">&#39;1&#39;</span><span class="op" id="5077378">,</span>&nbsp;<span class="string" id="5077380">&#39;2&#39;</span><span class="op" id="5077383">,</span>&nbsp;<span class="string" id="5077385">&#39;3&#39;</span><span class="op" id="5077388">,</span>&nbsp;<span class="string" id="5077390">&#39;4&#39;</span><span class="op" id="5077393">,</span>&nbsp;<span class="string" id="5077395">&#39;5&#39;</span><span class="op" id="5077398">,</span>&nbsp;<span class="string" id="5077400">&#39;6&#39;</span><span class="op" id="5077403">,</span>&nbsp;<span class="string" id="5077405">&#39;7&#39;</span><span class="op" id="5077408">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077412">n</span><span class="op" id="5077413">,</span>&nbsp;<span class="ident" id="5077415">base</span><span class="op" id="5077419">,</span>&nbsp;<span class="ident" id="5077421">max</span>&nbsp;<span class="op" id="5077425">=</span>&nbsp;<span class="num" id="5077427">3</span><span class="op" id="5077428">,</span>&nbsp;<span class="num" id="5077430">8</span><span class="op" id="5077431">,</span>&nbsp;<span class="num" id="5077433">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077438">case</span>&nbsp;<span class="string" id="5077443">&#39;x&#39;</span><span class="op" id="5077446">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077450">s</span><span class="op" id="5077451">.</span><span class="ident" id="5077452">next</span><span class="op" id="5077456">(</span><span class="op" id="5077457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077461">n</span><span class="op" id="5077462">,</span>&nbsp;<span class="ident" id="5077464">base</span><span class="op" id="5077468">,</span>&nbsp;<span class="ident" id="5077470">max</span>&nbsp;<span class="op" id="5077474">=</span>&nbsp;<span class="num" id="5077476">2</span><span class="op" id="5077477">,</span>&nbsp;<span class="num" id="5077479">16</span><span class="op" id="5077481">,</span>&nbsp;<span class="num" id="5077483">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077488">case</span>&nbsp;<span class="string" id="5077493">&#39;u&#39;</span><span class="op" id="5077496">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077500">s</span><span class="op" id="5077501">.</span><span class="ident" id="5077502">next</span><span class="op" id="5077506">(</span><span class="op" id="5077507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077511">n</span><span class="op" id="5077512">,</span>&nbsp;<span class="ident" id="5077514">base</span><span class="op" id="5077518">,</span>&nbsp;<span class="ident" id="5077520">max</span>&nbsp;<span class="op" id="5077524">=</span>&nbsp;<span class="num" id="5077526">4</span><span class="op" id="5077527">,</span>&nbsp;<span class="num" id="5077529">16</span><span class="op" id="5077531">,</span>&nbsp;<span class="ident" id="5077533">unicode</span><span class="op" id="5077540">.</span><span class="ident" id="5077541">MaxRune</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077550">case</span>&nbsp;<span class="string" id="5077555">&#39;U&#39;</span><span class="op" id="5077558">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077562">s</span><span class="op" id="5077563">.</span><span class="ident" id="5077564">next</span><span class="op" id="5077568">(</span><span class="op" id="5077569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077573">n</span><span class="op" id="5077574">,</span>&nbsp;<span class="ident" id="5077576">base</span><span class="op" id="5077580">,</span>&nbsp;<span class="ident" id="5077582">max</span>&nbsp;<span class="op" id="5077586">=</span>&nbsp;<span class="num" id="5077588">8</span><span class="op" id="5077589">,</span>&nbsp;<span class="num" id="5077591">16</span><span class="op" id="5077593">,</span>&nbsp;<span class="ident" id="5077595">unicode</span><span class="op" id="5077602">.</span><span class="ident" id="5077603">MaxRune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077612">default</span><span class="op" id="5077619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077623">msg</span>&nbsp;<span class="op" id="5077627">:=</span>&nbsp;<span class="string" id="5077630">&#34;unknown&nbsp;escape&nbsp;sequence&#34;</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077658">if</span>&nbsp;<span class="ident" id="5077661">s</span><span class="op" id="5077662">.</span><span class="ident" id="5077663">ch</span>&nbsp;<span class="op" id="5077666">&lt;</span>&nbsp;<span class="num" id="5077668">0</span>&nbsp;<span class="op" id="5077670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077675">msg</span>&nbsp;<span class="op" id="5077679">=</span>&nbsp;<span class="string" id="5077681">&#34;escape&nbsp;sequence&nbsp;not&nbsp;terminated&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5077716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077720">s</span><span class="op" id="5077721">.</span><span class="builtintype" id="5077722">error</span><span class="op" id="5077727">(</span><span class="ident" id="5077728">offs</span><span class="op" id="5077732">,</span>&nbsp;<span class="ident" id="5077734">msg</span><span class="op" id="5077737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077741">return</span>&nbsp;<span class="ident" id="5077748">false</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5077755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077759">var</span>&nbsp;<span class="ident" id="5077763">x</span>&nbsp;<span class="builtintype" id="5077765">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077773">for</span>&nbsp;<span class="ident" id="5077777">n</span>&nbsp;<span class="op" id="5077779">&gt;</span>&nbsp;<span class="num" id="5077781">0</span>&nbsp;<span class="op" id="5077783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077787">d</span>&nbsp;<span class="op" id="5077789">:=</span>&nbsp;<span class="builtintype" id="5077792">uint32</span><span class="op" id="5077798">(</span><span class="ident" id="5077799">digitVal</span><span class="op" id="5077807">(</span><span class="ident" id="5077808">s</span><span class="op" id="5077809">.</span><span class="ident" id="5077810">ch</span><span class="op" id="5077812">)</span><span class="op" id="5077813">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077817">if</span>&nbsp;<span class="ident" id="5077820">d</span>&nbsp;<span class="op" id="5077822">&gt;=</span>&nbsp;<span class="ident" id="5077825">base</span>&nbsp;<span class="op" id="5077830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077835">msg</span>&nbsp;<span class="op" id="5077839">:=</span>&nbsp;<span class="ident" id="5077842">fmt</span><span class="op" id="5077845">.</span><span class="ident" id="5077846">Sprintf</span><span class="op" id="5077853">(</span><span class="string" id="5077854">&#34;illegal&nbsp;character&nbsp;%#U&nbsp;in&nbsp;escape&nbsp;sequence&#34;</span><span class="op" id="5077896">,</span>&nbsp;<span class="ident" id="5077898">s</span><span class="op" id="5077899">.</span><span class="ident" id="5077900">ch</span><span class="op" id="5077902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077907">if</span>&nbsp;<span class="ident" id="5077910">s</span><span class="op" id="5077911">.</span><span class="ident" id="5077912">ch</span>&nbsp;<span class="op" id="5077915">&lt;</span>&nbsp;<span class="num" id="5077917">0</span>&nbsp;<span class="op" id="5077919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077925">msg</span>&nbsp;<span class="op" id="5077929">=</span>&nbsp;<span class="string" id="5077931">&#34;escape&nbsp;sequence&nbsp;not&nbsp;terminated&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5077967">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5077972">s</span><span class="op" id="5077973">.</span><span class="builtintype" id="5077974">error</span><span class="op" id="5077979">(</span><span class="ident" id="5077980">s</span><span class="op" id="5077981">.</span><span class="ident" id="5077982">offset</span><span class="op" id="5077988">,</span>&nbsp;<span class="ident" id="5077990">msg</span><span class="op" id="5077993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5077998">return</span>&nbsp;<span class="ident" id="5078005">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078017">x</span>&nbsp;<span class="op" id="5078019">=</span>&nbsp;<span class="ident" id="5078021">x</span><span class="op" id="5078022">*</span><span class="ident" id="5078023">base</span>&nbsp;<span class="op" id="5078028">+</span>&nbsp;<span class="ident" id="5078030">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078034">s</span><span class="op" id="5078035">.</span><span class="ident" id="5078036">next</span><span class="op" id="5078040">(</span><span class="op" id="5078041">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078045">n</span><span class="op" id="5078046">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078054">if</span>&nbsp;<span class="ident" id="5078057">x</span>&nbsp;<span class="op" id="5078059">&gt;</span>&nbsp;<span class="ident" id="5078061">max</span>&nbsp;<span class="op" id="5078065">||</span>&nbsp;<span class="num" id="5078068">0xD800</span>&nbsp;<span class="op" id="5078075">&lt;=</span>&nbsp;<span class="ident" id="5078078">x</span>&nbsp;<span class="op" id="5078080">&amp;&amp;</span>&nbsp;<span class="ident" id="5078083">x</span>&nbsp;<span class="op" id="5078085">&lt;</span>&nbsp;<span class="num" id="5078087">0xE000</span>&nbsp;<span class="op" id="5078094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078098">s</span><span class="op" id="5078099">.</span><span class="builtintype" id="5078100">error</span><span class="op" id="5078105">(</span><span class="ident" id="5078106">offs</span><span class="op" id="5078110">,</span>&nbsp;<span class="string" id="5078112">&#34;escape&nbsp;sequence&nbsp;is&nbsp;invalid&nbsp;Unicode&nbsp;code&nbsp;point&#34;</span><span class="op" id="5078159">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078163">return</span>&nbsp;<span class="ident" id="5078170">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078181">return</span>&nbsp;<span class="ident" id="5078188">true</span><br>
<span class="lineno"></span><span class="op" id="5078193">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span><span class="keyword" id="5078196">func</span>&nbsp;<span class="op" id="5078201">(</span><span class="ident" id="5078202">s</span>&nbsp;<span class="op" id="5078204">*</span><span class="ident" id="5078205">Scanner</span><span class="op" id="5078212">)</span>&nbsp;<span class="ident" id="5078214">scanRune</span><span class="op" id="5078222">(</span><span class="op" id="5078223">)</span>&nbsp;<span class="builtintype" id="5078225">string</span>&nbsp;<span class="op" id="5078232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078235">//&nbsp;&#39;\&#39;&#39;&nbsp;opening&nbsp;already&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078269">offs</span>&nbsp;<span class="op" id="5078274">:=</span>&nbsp;<span class="ident" id="5078277">s</span><span class="op" id="5078278">.</span><span class="ident" id="5078279">offset</span>&nbsp;<span class="op" id="5078286">-</span>&nbsp;<span class="num" id="5078288">1</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078292">valid</span>&nbsp;<span class="op" id="5078298">:=</span>&nbsp;<span class="ident" id="5078301">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078307">n</span>&nbsp;<span class="op" id="5078309">:=</span>&nbsp;<span class="num" id="5078312">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078315">for</span>&nbsp;<span class="op" id="5078319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078323">ch</span>&nbsp;<span class="op" id="5078326">:=</span>&nbsp;<span class="ident" id="5078329">s</span><span class="op" id="5078330">.</span><span class="ident" id="5078331">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078336">if</span>&nbsp;<span class="ident" id="5078339">ch</span>&nbsp;<span class="op" id="5078342">==</span>&nbsp;<span class="string" id="5078345">&#39;\n&#39;</span>&nbsp;<span class="op" id="5078350">||</span>&nbsp;<span class="ident" id="5078353">ch</span>&nbsp;<span class="op" id="5078356">&lt;</span>&nbsp;<span class="num" id="5078358">0</span>&nbsp;<span class="op" id="5078360">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078365">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;one&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078418">if</span>&nbsp;<span class="ident" id="5078421">valid</span>&nbsp;<span class="op" id="5078427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078433">s</span><span class="op" id="5078434">.</span><span class="builtintype" id="5078435">error</span><span class="op" id="5078440">(</span><span class="ident" id="5078441">offs</span><span class="op" id="5078445">,</span>&nbsp;<span class="string" id="5078447">&#34;rune&nbsp;literal&nbsp;not&nbsp;terminated&#34;</span><span class="op" id="5078476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078482">valid</span>&nbsp;<span class="op" id="5078488">=</span>&nbsp;<span class="ident" id="5078490">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078499">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078504">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078516">s</span><span class="op" id="5078517">.</span><span class="ident" id="5078518">next</span><span class="op" id="5078522">(</span><span class="op" id="5078523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078527">if</span>&nbsp;<span class="ident" id="5078530">ch</span>&nbsp;<span class="op" id="5078533">==</span>&nbsp;<span class="string" id="5078536">&#39;\&#39;&#39;</span>&nbsp;<span class="op" id="5078541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078546">break</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078558">n</span><span class="op" id="5078559">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078564">if</span>&nbsp;<span class="ident" id="5078567">ch</span>&nbsp;<span class="op" id="5078570">==</span>&nbsp;<span class="string" id="5078573">&#39;\\&#39;</span>&nbsp;<span class="op" id="5078578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078583">if</span>&nbsp;<span class="op" id="5078586">!</span><span class="ident" id="5078587">s</span><span class="op" id="5078588">.</span><span class="ident" id="5078589">scanEscape</span><span class="op" id="5078599">(</span><span class="string" id="5078600">&#39;\&#39;&#39;</span><span class="op" id="5078604">)</span>&nbsp;<span class="op" id="5078606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078612">valid</span>&nbsp;<span class="op" id="5078618">=</span>&nbsp;<span class="ident" id="5078620">false</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078634">//&nbsp;continue&nbsp;to&nbsp;read&nbsp;to&nbsp;closing&nbsp;quote</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078680">if</span>&nbsp;<span class="ident" id="5078683">valid</span>&nbsp;<span class="op" id="5078689">&amp;&amp;</span>&nbsp;<span class="ident" id="5078692">n</span>&nbsp;<span class="op" id="5078694">!=</span>&nbsp;<span class="num" id="5078697">1</span>&nbsp;<span class="op" id="5078699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078703">s</span><span class="op" id="5078704">.</span><span class="builtintype" id="5078705">error</span><span class="op" id="5078710">(</span><span class="ident" id="5078711">offs</span><span class="op" id="5078715">,</span>&nbsp;<span class="string" id="5078717">&#34;illegal&nbsp;rune&nbsp;literal&#34;</span><span class="op" id="5078739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078746">return</span>&nbsp;<span class="builtintype" id="5078753">string</span><span class="op" id="5078759">(</span><span class="ident" id="5078760">s</span><span class="op" id="5078761">.</span><span class="ident" id="5078762">src</span><span class="op" id="5078765">[</span><span class="ident" id="5078766">offs</span><span class="op" id="5078770">:</span><span class="ident" id="5078771">s</span><span class="op" id="5078772">.</span><span class="ident" id="5078773">offset</span><span class="op" id="5078779">]</span><span class="op" id="5078780">)</span><br>
<span class="lineno">455</span><span class="op" id="5078782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5078785">func</span>&nbsp;<span class="op" id="5078790">(</span><span class="ident" id="5078791">s</span>&nbsp;<span class="op" id="5078793">*</span><span class="ident" id="5078794">Scanner</span><span class="op" id="5078801">)</span>&nbsp;<span class="ident" id="5078803">scanString</span><span class="op" id="5078813">(</span><span class="op" id="5078814">)</span>&nbsp;<span class="builtintype" id="5078816">string</span>&nbsp;<span class="op" id="5078823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5078826">//&nbsp;&#39;&#34;&#39;&nbsp;opening&nbsp;already&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078859">offs</span>&nbsp;<span class="op" id="5078864">:=</span>&nbsp;<span class="ident" id="5078867">s</span><span class="op" id="5078868">.</span><span class="ident" id="5078869">offset</span>&nbsp;<span class="op" id="5078876">-</span>&nbsp;<span class="num" id="5078878">1</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078882">for</span>&nbsp;<span class="op" id="5078886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078890">ch</span>&nbsp;<span class="op" id="5078893">:=</span>&nbsp;<span class="ident" id="5078896">s</span><span class="op" id="5078897">.</span><span class="ident" id="5078898">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078903">if</span>&nbsp;<span class="ident" id="5078906">ch</span>&nbsp;<span class="op" id="5078909">==</span>&nbsp;<span class="string" id="5078912">&#39;\n&#39;</span>&nbsp;<span class="op" id="5078917">||</span>&nbsp;<span class="ident" id="5078920">ch</span>&nbsp;<span class="op" id="5078923">&lt;</span>&nbsp;<span class="num" id="5078925">0</span>&nbsp;<span class="op" id="5078927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078932">s</span><span class="op" id="5078933">.</span><span class="builtintype" id="5078934">error</span><span class="op" id="5078939">(</span><span class="ident" id="5078940">offs</span><span class="op" id="5078944">,</span>&nbsp;<span class="string" id="5078946">&#34;string&nbsp;literal&nbsp;not&nbsp;terminated&#34;</span><span class="op" id="5078977">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5078982">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5078990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5078994">s</span><span class="op" id="5078995">.</span><span class="ident" id="5078996">next</span><span class="op" id="5079000">(</span><span class="op" id="5079001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079005">if</span>&nbsp;<span class="ident" id="5079008">ch</span>&nbsp;<span class="op" id="5079011">==</span>&nbsp;<span class="string" id="5079014">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="5079018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079023">break</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079035">if</span>&nbsp;<span class="ident" id="5079038">ch</span>&nbsp;<span class="op" id="5079041">==</span>&nbsp;<span class="string" id="5079044">&#39;\\&#39;</span>&nbsp;<span class="op" id="5079049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079054">s</span><span class="op" id="5079055">.</span><span class="ident" id="5079056">scanEscape</span><span class="op" id="5079066">(</span><span class="string" id="5079067">&#39;&#34;&#39;</span><span class="op" id="5079070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079077">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079081">return</span>&nbsp;<span class="builtintype" id="5079088">string</span><span class="op" id="5079094">(</span><span class="ident" id="5079095">s</span><span class="op" id="5079096">.</span><span class="ident" id="5079097">src</span><span class="op" id="5079100">[</span><span class="ident" id="5079101">offs</span><span class="op" id="5079105">:</span><span class="ident" id="5079106">s</span><span class="op" id="5079107">.</span><span class="ident" id="5079108">offset</span><span class="op" id="5079114">]</span><span class="op" id="5079115">)</span><br>
<span class="lineno"></span><span class="op" id="5079117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5079120">func</span>&nbsp;<span class="ident" id="5079125">stripCR</span><span class="op" id="5079132">(</span><span class="ident" id="5079133">b</span>&nbsp;<span class="op" id="5079135">[</span><span class="op" id="5079136">]</span><span class="builtintype" id="5079137">byte</span><span class="op" id="5079141">)</span>&nbsp;<span class="op" id="5079143">[</span><span class="op" id="5079144">]</span><span class="builtintype" id="5079145">byte</span>&nbsp;<span class="op" id="5079150">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079153">c</span>&nbsp;<span class="op" id="5079155">:=</span>&nbsp;<span class="builtinfunc" id="5079158">make</span><span class="op" id="5079162">(</span><span class="op" id="5079163">[</span><span class="op" id="5079164">]</span><span class="builtintype" id="5079165">byte</span><span class="op" id="5079169">,</span>&nbsp;<span class="builtinfunc" id="5079171">len</span><span class="op" id="5079174">(</span><span class="ident" id="5079175">b</span><span class="op" id="5079176">)</span><span class="op" id="5079177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079180">i</span>&nbsp;<span class="op" id="5079182">:=</span>&nbsp;<span class="num" id="5079185">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079188">for</span>&nbsp;<span class="ident" id="5079192">_</span><span class="op" id="5079193">,</span>&nbsp;<span class="ident" id="5079195">ch</span>&nbsp;<span class="op" id="5079198">:=</span>&nbsp;<span class="keyword" id="5079201">range</span>&nbsp;<span class="ident" id="5079207">b</span>&nbsp;<span class="op" id="5079209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079213">if</span>&nbsp;<span class="ident" id="5079216">ch</span>&nbsp;<span class="op" id="5079219">!=</span>&nbsp;<span class="string" id="5079222">&#39;\r&#39;</span>&nbsp;<span class="op" id="5079227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079232">c</span><span class="op" id="5079233">[</span><span class="ident" id="5079234">i</span><span class="op" id="5079235">]</span>&nbsp;<span class="op" id="5079237">=</span>&nbsp;<span class="ident" id="5079239">ch</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079245">i</span><span class="op" id="5079246">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079257">return</span>&nbsp;<span class="ident" id="5079264">c</span><span class="op" id="5079265">[</span><span class="op" id="5079266">:</span><span class="ident" id="5079267">i</span><span class="op" id="5079268">]</span><br>
<span class="lineno"></span><span class="op" id="5079270">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="keyword" id="5079273">func</span>&nbsp;<span class="op" id="5079278">(</span><span class="ident" id="5079279">s</span>&nbsp;<span class="op" id="5079281">*</span><span class="ident" id="5079282">Scanner</span><span class="op" id="5079289">)</span>&nbsp;<span class="ident" id="5079291">scanRawString</span><span class="op" id="5079304">(</span><span class="op" id="5079305">)</span>&nbsp;<span class="builtintype" id="5079307">string</span>&nbsp;<span class="op" id="5079314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5079317">//&nbsp;&#39;`&#39;&nbsp;opening&nbsp;already&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079350">offs</span>&nbsp;<span class="op" id="5079355">:=</span>&nbsp;<span class="ident" id="5079358">s</span><span class="op" id="5079359">.</span><span class="ident" id="5079360">offset</span>&nbsp;<span class="op" id="5079367">-</span>&nbsp;<span class="num" id="5079369">1</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079373">hasCR</span>&nbsp;<span class="op" id="5079379">:=</span>&nbsp;<span class="ident" id="5079382">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079389">for</span>&nbsp;<span class="op" id="5079393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079397">ch</span>&nbsp;<span class="op" id="5079400">:=</span>&nbsp;<span class="ident" id="5079403">s</span><span class="op" id="5079404">.</span><span class="ident" id="5079405">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079410">if</span>&nbsp;<span class="ident" id="5079413">ch</span>&nbsp;<span class="op" id="5079416">&lt;</span>&nbsp;<span class="num" id="5079418">0</span>&nbsp;<span class="op" id="5079420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079425">s</span><span class="op" id="5079426">.</span><span class="builtintype" id="5079427">error</span><span class="op" id="5079432">(</span><span class="ident" id="5079433">offs</span><span class="op" id="5079437">,</span>&nbsp;<span class="string" id="5079439">&#34;raw&nbsp;string&nbsp;literal&nbsp;not&nbsp;terminated&#34;</span><span class="op" id="5079474">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079479">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079491">s</span><span class="op" id="5079492">.</span><span class="ident" id="5079493">next</span><span class="op" id="5079497">(</span><span class="op" id="5079498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079502">if</span>&nbsp;<span class="ident" id="5079505">ch</span>&nbsp;<span class="op" id="5079508">==</span>&nbsp;<span class="string" id="5079511">&#39;`&#39;</span>&nbsp;<span class="op" id="5079515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079520">break</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079532">if</span>&nbsp;<span class="ident" id="5079535">ch</span>&nbsp;<span class="op" id="5079538">==</span>&nbsp;<span class="string" id="5079541">&#39;\r&#39;</span>&nbsp;<span class="op" id="5079546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079551">hasCR</span>&nbsp;<span class="op" id="5079557">=</span>&nbsp;<span class="ident" id="5079559">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079569">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079573">lit</span>&nbsp;<span class="op" id="5079577">:=</span>&nbsp;<span class="ident" id="5079580">s</span><span class="op" id="5079581">.</span><span class="ident" id="5079582">src</span><span class="op" id="5079585">[</span><span class="ident" id="5079586">offs</span><span class="op" id="5079590">:</span><span class="ident" id="5079591">s</span><span class="op" id="5079592">.</span><span class="ident" id="5079593">offset</span><span class="op" id="5079599">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079602">if</span>&nbsp;<span class="ident" id="5079605">hasCR</span>&nbsp;<span class="op" id="5079611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079615">lit</span>&nbsp;<span class="op" id="5079619">=</span>&nbsp;<span class="ident" id="5079621">stripCR</span><span class="op" id="5079628">(</span><span class="ident" id="5079629">lit</span><span class="op" id="5079632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079635">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079639">return</span>&nbsp;<span class="builtintype" id="5079646">string</span><span class="op" id="5079652">(</span><span class="ident" id="5079653">lit</span><span class="op" id="5079656">)</span><br>
<span class="lineno"></span><span class="op" id="5079658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5079661">func</span>&nbsp;<span class="op" id="5079666">(</span><span class="ident" id="5079667">s</span>&nbsp;<span class="op" id="5079669">*</span><span class="ident" id="5079670">Scanner</span><span class="op" id="5079677">)</span>&nbsp;<span class="ident" id="5079679">skipWhitespace</span><span class="op" id="5079693">(</span><span class="op" id="5079694">)</span>&nbsp;<span class="op" id="5079696">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5079699">for</span>&nbsp;<span class="ident" id="5079703">s</span><span class="op" id="5079704">.</span><span class="ident" id="5079705">ch</span>&nbsp;<span class="op" id="5079708">==</span>&nbsp;<span class="string" id="5079711">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5079715">||</span>&nbsp;<span class="ident" id="5079718">s</span><span class="op" id="5079719">.</span><span class="ident" id="5079720">ch</span>&nbsp;<span class="op" id="5079723">==</span>&nbsp;<span class="string" id="5079726">&#39;\t&#39;</span>&nbsp;<span class="op" id="5079731">||</span>&nbsp;<span class="ident" id="5079734">s</span><span class="op" id="5079735">.</span><span class="ident" id="5079736">ch</span>&nbsp;<span class="op" id="5079739">==</span>&nbsp;<span class="string" id="5079742">&#39;\n&#39;</span>&nbsp;<span class="op" id="5079747">&amp;&amp;</span>&nbsp;<span class="op" id="5079750">!</span><span class="ident" id="5079751">s</span><span class="op" id="5079752">.</span><span class="ident" id="5079753">insertSemi</span>&nbsp;<span class="op" id="5079764">||</span>&nbsp;<span class="ident" id="5079767">s</span><span class="op" id="5079768">.</span><span class="ident" id="5079769">ch</span>&nbsp;<span class="op" id="5079772">==</span>&nbsp;<span class="string" id="5079775">&#39;\r&#39;</span>&nbsp;<span class="op" id="5079780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5079784">s</span><span class="op" id="5079785">.</span><span class="ident" id="5079786">next</span><span class="op" id="5079790">(</span><span class="op" id="5079791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5079794">}</span><br>
<span class="lineno"></span><span class="op" id="5079796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="comment" id="5079799">//&nbsp;Helper&nbsp;functions&nbsp;for&nbsp;scanning&nbsp;multi-byte&nbsp;tokens&nbsp;such&nbsp;as&nbsp;&gt;&gt;&nbsp;+=&nbsp;&gt;&gt;=&nbsp;.</span><br>
<span class="lineno"></span><span class="comment" id="5079870">//&nbsp;Different&nbsp;routines&nbsp;recognize&nbsp;different&nbsp;length&nbsp;tok_i&nbsp;based&nbsp;on&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="5079942">//&nbsp;of&nbsp;ch_i.&nbsp;If&nbsp;a&nbsp;token&nbsp;ends&nbsp;in&nbsp;&#39;=&#39;,&nbsp;the&nbsp;result&nbsp;is&nbsp;tok1&nbsp;or&nbsp;tok3</span><br>
<span class="lineno"></span><span class="comment" id="5080005">//&nbsp;respectively.&nbsp;Otherwise,&nbsp;the&nbsp;result&nbsp;is&nbsp;tok0&nbsp;if&nbsp;there&nbsp;was&nbsp;no&nbsp;other</span><br>
<span class="lineno"></span><span class="comment" id="5080074">//&nbsp;matching&nbsp;character,&nbsp;or&nbsp;tok2&nbsp;if&nbsp;the&nbsp;matching&nbsp;character&nbsp;was&nbsp;ch2.</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span><span class="keyword" id="5080141">func</span>&nbsp;<span class="op" id="5080146">(</span><span class="ident" id="5080147">s</span>&nbsp;<span class="op" id="5080149">*</span><span class="ident" id="5080150">Scanner</span><span class="op" id="5080157">)</span>&nbsp;<span class="ident" id="5080159">switch2</span><span class="op" id="5080166">(</span><span class="ident" id="5080167">tok0</span><span class="op" id="5080171">,</span>&nbsp;<span class="ident" id="5080173">tok1</span>&nbsp;<span class="ident" id="5080178">token</span><span class="op" id="5080183">.</span><span class="ident" id="5080184">Token</span><span class="op" id="5080189">)</span>&nbsp;<span class="ident" id="5080191">token</span><span class="op" id="5080196">.</span><span class="ident" id="5080197">Token</span>&nbsp;<span class="op" id="5080203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080206">if</span>&nbsp;<span class="ident" id="5080209">s</span><span class="op" id="5080210">.</span><span class="ident" id="5080211">ch</span>&nbsp;<span class="op" id="5080214">==</span>&nbsp;<span class="string" id="5080217">&#39;=&#39;</span>&nbsp;<span class="op" id="5080221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080225">s</span><span class="op" id="5080226">.</span><span class="ident" id="5080227">next</span><span class="op" id="5080231">(</span><span class="op" id="5080232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080236">return</span>&nbsp;<span class="ident" id="5080243">tok1</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5080249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080252">return</span>&nbsp;<span class="ident" id="5080259">tok0</span><br>
<span class="lineno"></span><span class="op" id="5080264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5080267">func</span>&nbsp;<span class="op" id="5080272">(</span><span class="ident" id="5080273">s</span>&nbsp;<span class="op" id="5080275">*</span><span class="ident" id="5080276">Scanner</span><span class="op" id="5080283">)</span>&nbsp;<span class="ident" id="5080285">switch3</span><span class="op" id="5080292">(</span><span class="ident" id="5080293">tok0</span><span class="op" id="5080297">,</span>&nbsp;<span class="ident" id="5080299">tok1</span>&nbsp;<span class="ident" id="5080304">token</span><span class="op" id="5080309">.</span><span class="ident" id="5080310">Token</span><span class="op" id="5080315">,</span>&nbsp;<span class="ident" id="5080317">ch2</span>&nbsp;<span class="builtintype" id="5080321">rune</span><span class="op" id="5080325">,</span>&nbsp;<span class="ident" id="5080327">tok2</span>&nbsp;<span class="ident" id="5080332">token</span><span class="op" id="5080337">.</span><span class="ident" id="5080338">Token</span><span class="op" id="5080343">)</span>&nbsp;<span class="ident" id="5080345">token</span><span class="op" id="5080350">.</span><span class="ident" id="5080351">Token</span>&nbsp;<span class="op" id="5080357">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080360">if</span>&nbsp;<span class="ident" id="5080363">s</span><span class="op" id="5080364">.</span><span class="ident" id="5080365">ch</span>&nbsp;<span class="op" id="5080368">==</span>&nbsp;<span class="string" id="5080371">&#39;=&#39;</span>&nbsp;<span class="op" id="5080375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080379">s</span><span class="op" id="5080380">.</span><span class="ident" id="5080381">next</span><span class="op" id="5080385">(</span><span class="op" id="5080386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080390">return</span>&nbsp;<span class="ident" id="5080397">tok1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5080403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080406">if</span>&nbsp;<span class="ident" id="5080409">s</span><span class="op" id="5080410">.</span><span class="ident" id="5080411">ch</span>&nbsp;<span class="op" id="5080414">==</span>&nbsp;<span class="ident" id="5080417">ch2</span>&nbsp;<span class="op" id="5080421">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080425">s</span><span class="op" id="5080426">.</span><span class="ident" id="5080427">next</span><span class="op" id="5080431">(</span><span class="op" id="5080432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080436">return</span>&nbsp;<span class="ident" id="5080443">tok2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5080449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080452">return</span>&nbsp;<span class="ident" id="5080459">tok0</span><br>
<span class="lineno"></span><span class="op" id="5080464">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="keyword" id="5080467">func</span>&nbsp;<span class="op" id="5080472">(</span><span class="ident" id="5080473">s</span>&nbsp;<span class="op" id="5080475">*</span><span class="ident" id="5080476">Scanner</span><span class="op" id="5080483">)</span>&nbsp;<span class="ident" id="5080485">switch4</span><span class="op" id="5080492">(</span><span class="ident" id="5080493">tok0</span><span class="op" id="5080497">,</span>&nbsp;<span class="ident" id="5080499">tok1</span>&nbsp;<span class="ident" id="5080504">token</span><span class="op" id="5080509">.</span><span class="ident" id="5080510">Token</span><span class="op" id="5080515">,</span>&nbsp;<span class="ident" id="5080517">ch2</span>&nbsp;<span class="builtintype" id="5080521">rune</span><span class="op" id="5080525">,</span>&nbsp;<span class="ident" id="5080527">tok2</span><span class="op" id="5080531">,</span>&nbsp;<span class="ident" id="5080533">tok3</span>&nbsp;<span class="ident" id="5080538">token</span><span class="op" id="5080543">.</span><span class="ident" id="5080544">Token</span><span class="op" id="5080549">)</span>&nbsp;<span class="ident" id="5080551">token</span><span class="op" id="5080556">.</span><span class="ident" id="5080557">Token</span>&nbsp;<span class="op" id="5080563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080566">if</span>&nbsp;<span class="ident" id="5080569">s</span><span class="op" id="5080570">.</span><span class="ident" id="5080571">ch</span>&nbsp;<span class="op" id="5080574">==</span>&nbsp;<span class="string" id="5080577">&#39;=&#39;</span>&nbsp;<span class="op" id="5080581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080585">s</span><span class="op" id="5080586">.</span><span class="ident" id="5080587">next</span><span class="op" id="5080591">(</span><span class="op" id="5080592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080596">return</span>&nbsp;<span class="ident" id="5080603">tok1</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5080609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080612">if</span>&nbsp;<span class="ident" id="5080615">s</span><span class="op" id="5080616">.</span><span class="ident" id="5080617">ch</span>&nbsp;<span class="op" id="5080620">==</span>&nbsp;<span class="ident" id="5080623">ch2</span>&nbsp;<span class="op" id="5080627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080631">s</span><span class="op" id="5080632">.</span><span class="ident" id="5080633">next</span><span class="op" id="5080637">(</span><span class="op" id="5080638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080642">if</span>&nbsp;<span class="ident" id="5080645">s</span><span class="op" id="5080646">.</span><span class="ident" id="5080647">ch</span>&nbsp;<span class="op" id="5080650">==</span>&nbsp;<span class="string" id="5080653">&#39;=&#39;</span>&nbsp;<span class="op" id="5080657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5080662">s</span><span class="op" id="5080663">.</span><span class="ident" id="5080664">next</span><span class="op" id="5080668">(</span><span class="op" id="5080669">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080674">return</span>&nbsp;<span class="ident" id="5080681">tok3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5080688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080692">return</span>&nbsp;<span class="ident" id="5080699">tok2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5080705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5080708">return</span>&nbsp;<span class="ident" id="5080715">tok0</span><br>
<span class="lineno">565</span><span class="op" id="5080720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5080723">//&nbsp;Scan&nbsp;scans&nbsp;the&nbsp;next&nbsp;token&nbsp;and&nbsp;returns&nbsp;the&nbsp;token&nbsp;position,&nbsp;the&nbsp;token,</span><br>
<span class="lineno"></span><span class="comment" id="5080795">//&nbsp;and&nbsp;its&nbsp;literal&nbsp;string&nbsp;if&nbsp;applicable.&nbsp;The&nbsp;source&nbsp;end&nbsp;is&nbsp;indicated&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5080867">//&nbsp;token.EOF.</span><br>
<span class="lineno">570</span><span class="comment" id="5080881">//</span><br>
<span class="lineno"></span><span class="comment" id="5080884">//&nbsp;If&nbsp;the&nbsp;returned&nbsp;token&nbsp;is&nbsp;a&nbsp;literal&nbsp;(token.IDENT,&nbsp;token.INT,&nbsp;token.FLOAT,</span><br>
<span class="lineno"></span><span class="comment" id="5080960">//&nbsp;token.IMAG,&nbsp;token.CHAR,&nbsp;token.STRING)&nbsp;or&nbsp;token.COMMENT,&nbsp;the&nbsp;literal&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="5081038">//&nbsp;has&nbsp;the&nbsp;corresponding&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5081070">//</span><br>
<span class="lineno">575</span><span class="comment" id="5081073">//&nbsp;If&nbsp;the&nbsp;returned&nbsp;token&nbsp;is&nbsp;a&nbsp;keyword,&nbsp;the&nbsp;literal&nbsp;string&nbsp;is&nbsp;the&nbsp;keyword.</span><br>
<span class="lineno"></span><span class="comment" id="5081147">//</span><br>
<span class="lineno"></span><span class="comment" id="5081150">//&nbsp;If&nbsp;the&nbsp;returned&nbsp;token&nbsp;is&nbsp;token.SEMICOLON,&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="5081213">//&nbsp;literal&nbsp;string&nbsp;is&nbsp;&#34;;&#34;&nbsp;if&nbsp;the&nbsp;semicolon&nbsp;was&nbsp;present&nbsp;in&nbsp;the&nbsp;source,</span><br>
<span class="lineno"></span><span class="comment" id="5081282">//&nbsp;and&nbsp;&#34;\n&#34;&nbsp;if&nbsp;the&nbsp;semicolon&nbsp;was&nbsp;inserted&nbsp;because&nbsp;of&nbsp;a&nbsp;newline&nbsp;or</span><br>
<span class="lineno">580</span><span class="comment" id="5081348">//&nbsp;at&nbsp;EOF.</span><br>
<span class="lineno"></span><span class="comment" id="5081359">//</span><br>
<span class="lineno"></span><span class="comment" id="5081362">//&nbsp;If&nbsp;the&nbsp;returned&nbsp;token&nbsp;is&nbsp;token.ILLEGAL,&nbsp;the&nbsp;literal&nbsp;string&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5081431">//&nbsp;offending&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="5081455">//</span><br>
<span class="lineno">585</span><span class="comment" id="5081458">//&nbsp;In&nbsp;all&nbsp;other&nbsp;cases,&nbsp;Scan&nbsp;returns&nbsp;an&nbsp;empty&nbsp;literal&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="5081519">//</span><br>
<span class="lineno"></span><span class="comment" id="5081522">//&nbsp;For&nbsp;more&nbsp;tolerant&nbsp;parsing,&nbsp;Scan&nbsp;will&nbsp;return&nbsp;a&nbsp;valid&nbsp;token&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5081586">//&nbsp;possible&nbsp;even&nbsp;if&nbsp;a&nbsp;syntax&nbsp;error&nbsp;was&nbsp;encountered.&nbsp;Thus,&nbsp;even</span><br>
<span class="lineno"></span><span class="comment" id="5081649">//&nbsp;if&nbsp;the&nbsp;resulting&nbsp;token&nbsp;sequence&nbsp;contains&nbsp;no&nbsp;illegal&nbsp;tokens,</span><br>
<span class="lineno">590</span><span class="comment" id="5081712">//&nbsp;a&nbsp;client&nbsp;may&nbsp;not&nbsp;assume&nbsp;that&nbsp;no&nbsp;error&nbsp;occurred.&nbsp;Instead&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="5081774">//&nbsp;must&nbsp;check&nbsp;the&nbsp;scanner&#39;s&nbsp;ErrorCount&nbsp;or&nbsp;the&nbsp;number&nbsp;of&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="5081836">//&nbsp;of&nbsp;the&nbsp;error&nbsp;handler,&nbsp;if&nbsp;there&nbsp;was&nbsp;one&nbsp;installed.</span><br>
<span class="lineno"></span><span class="comment" id="5081889">//</span><br>
<span class="lineno"></span><span class="comment" id="5081892">//&nbsp;Scan&nbsp;adds&nbsp;line&nbsp;information&nbsp;to&nbsp;the&nbsp;file&nbsp;added&nbsp;to&nbsp;the&nbsp;file</span><br>
<span class="lineno">595</span><span class="comment" id="5081952">//&nbsp;set&nbsp;with&nbsp;Init.&nbsp;Token&nbsp;positions&nbsp;are&nbsp;relative&nbsp;to&nbsp;that&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="5082012">//&nbsp;and&nbsp;thus&nbsp;relative&nbsp;to&nbsp;the&nbsp;file&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="5082050">//</span><br>
<span class="lineno"></span><span class="keyword" id="5082053">func</span>&nbsp;<span class="op" id="5082058">(</span><span class="ident" id="5082059">s</span>&nbsp;<span class="op" id="5082061">*</span><span class="ident" id="5082062">Scanner</span><span class="op" id="5082069">)</span>&nbsp;<span class="ident" id="5082071">Scan</span><span class="op" id="5082075">(</span><span class="op" id="5082076">)</span>&nbsp;<span class="op" id="5082078">(</span><span class="ident" id="5082079">pos</span>&nbsp;<span class="ident" id="5082083">token</span><span class="op" id="5082088">.</span><span class="ident" id="5082089">Pos</span><span class="op" id="5082092">,</span>&nbsp;<span class="ident" id="5082094">tok</span>&nbsp;<span class="ident" id="5082098">token</span><span class="op" id="5082103">.</span><span class="ident" id="5082104">Token</span><span class="op" id="5082109">,</span>&nbsp;<span class="ident" id="5082111">lit</span>&nbsp;<span class="builtintype" id="5082115">string</span><span class="op" id="5082121">)</span>&nbsp;<span class="op" id="5082123">{</span><br>
<span class="lineno"></span><span class="ident" id="5082125">scanAgain</span><span class="op" id="5082134">:</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082137">s</span><span class="op" id="5082138">.</span><span class="ident" id="5082139">skipWhitespace</span><span class="op" id="5082153">(</span><span class="op" id="5082154">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5082158">//&nbsp;current&nbsp;token&nbsp;start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082182">pos</span>&nbsp;<span class="op" id="5082186">=</span>&nbsp;<span class="ident" id="5082188">s</span><span class="op" id="5082189">.</span><span class="ident" id="5082190">file</span><span class="op" id="5082194">.</span><span class="ident" id="5082195">Pos</span><span class="op" id="5082198">(</span><span class="ident" id="5082199">s</span><span class="op" id="5082200">.</span><span class="ident" id="5082201">offset</span><span class="op" id="5082207">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5082211">//&nbsp;determine&nbsp;token&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082237">insertSemi</span>&nbsp;<span class="op" id="5082248">:=</span>&nbsp;<span class="ident" id="5082251">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082258">switch</span>&nbsp;<span class="ident" id="5082265">ch</span>&nbsp;<span class="op" id="5082268">:=</span>&nbsp;<span class="ident" id="5082271">s</span><span class="op" id="5082272">.</span><span class="ident" id="5082273">ch</span><span class="op" id="5082275">;</span>&nbsp;<span class="op" id="5082277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082280">case</span>&nbsp;<span class="ident" id="5082285">isLetter</span><span class="op" id="5082293">(</span><span class="ident" id="5082294">ch</span><span class="op" id="5082296">)</span><span class="op" id="5082297">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082301">lit</span>&nbsp;<span class="op" id="5082305">=</span>&nbsp;<span class="ident" id="5082307">s</span><span class="op" id="5082308">.</span><span class="ident" id="5082309">scanIdentifier</span><span class="op" id="5082323">(</span><span class="op" id="5082324">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082328">if</span>&nbsp;<span class="builtinfunc" id="5082331">len</span><span class="op" id="5082334">(</span><span class="ident" id="5082335">lit</span><span class="op" id="5082338">)</span>&nbsp;<span class="op" id="5082340">&gt;</span>&nbsp;<span class="num" id="5082342">1</span>&nbsp;<span class="op" id="5082344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5082349">//&nbsp;keywords&nbsp;are&nbsp;longer&nbsp;than&nbsp;one&nbsp;letter&nbsp;-&nbsp;avoid&nbsp;lookup&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082416">tok</span>&nbsp;<span class="op" id="5082420">=</span>&nbsp;<span class="ident" id="5082422">token</span><span class="op" id="5082427">.</span><span class="ident" id="5082428">Lookup</span><span class="op" id="5082434">(</span><span class="ident" id="5082435">lit</span><span class="op" id="5082438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082443">switch</span>&nbsp;<span class="ident" id="5082450">tok</span>&nbsp;<span class="op" id="5082454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082459">case</span>&nbsp;<span class="ident" id="5082464">token</span><span class="op" id="5082469">.</span><span class="ident" id="5082470">IDENT</span><span class="op" id="5082475">,</span>&nbsp;<span class="ident" id="5082477">token</span><span class="op" id="5082482">.</span><span class="ident" id="5082483">BREAK</span><span class="op" id="5082488">,</span>&nbsp;<span class="ident" id="5082490">token</span><span class="op" id="5082495">.</span><span class="ident" id="5082496">CONTINUE</span><span class="op" id="5082504">,</span>&nbsp;<span class="ident" id="5082506">token</span><span class="op" id="5082511">.</span><span class="ident" id="5082512">FALLTHROUGH</span><span class="op" id="5082523">,</span>&nbsp;<span class="ident" id="5082525">token</span><span class="op" id="5082530">.</span><span class="ident" id="5082531">RETURN</span><span class="op" id="5082537">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082543">insertSemi</span>&nbsp;<span class="op" id="5082554">=</span>&nbsp;<span class="ident" id="5082556">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5082564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5082568">}</span>&nbsp;<span class="keyword" id="5082570">else</span>&nbsp;<span class="op" id="5082575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082580">insertSemi</span>&nbsp;<span class="op" id="5082591">=</span>&nbsp;<span class="ident" id="5082593">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082601">tok</span>&nbsp;<span class="op" id="5082605">=</span>&nbsp;<span class="ident" id="5082607">token</span><span class="op" id="5082612">.</span><span class="ident" id="5082613">IDENT</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5082621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082624">case</span>&nbsp;<span class="string" id="5082629">&#39;0&#39;</span>&nbsp;<span class="op" id="5082633">&lt;=</span>&nbsp;<span class="ident" id="5082636">ch</span>&nbsp;<span class="op" id="5082639">&amp;&amp;</span>&nbsp;<span class="ident" id="5082642">ch</span>&nbsp;<span class="op" id="5082645">&lt;=</span>&nbsp;<span class="string" id="5082648">&#39;9&#39;</span><span class="op" id="5082651">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082655">insertSemi</span>&nbsp;<span class="op" id="5082666">=</span>&nbsp;<span class="ident" id="5082668">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082675">tok</span><span class="op" id="5082678">,</span>&nbsp;<span class="ident" id="5082680">lit</span>&nbsp;<span class="op" id="5082684">=</span>&nbsp;<span class="ident" id="5082686">s</span><span class="op" id="5082687">.</span><span class="ident" id="5082688">scanNumber</span><span class="op" id="5082698">(</span><span class="ident" id="5082699">false</span><span class="op" id="5082704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082707">default</span><span class="op" id="5082714">:</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082718">s</span><span class="op" id="5082719">.</span><span class="ident" id="5082720">next</span><span class="op" id="5082724">(</span><span class="op" id="5082725">)</span>&nbsp;<span class="comment" id="5082727">//&nbsp;always&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082753">switch</span>&nbsp;<span class="ident" id="5082760">ch</span>&nbsp;<span class="op" id="5082763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082767">case</span>&nbsp;<span class="op" id="5082772">-</span><span class="num" id="5082773">1</span><span class="op" id="5082774">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082779">if</span>&nbsp;<span class="ident" id="5082782">s</span><span class="op" id="5082783">.</span><span class="ident" id="5082784">insertSemi</span>&nbsp;<span class="op" id="5082795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082801">s</span><span class="op" id="5082802">.</span><span class="ident" id="5082803">insertSemi</span>&nbsp;<span class="op" id="5082814">=</span>&nbsp;<span class="ident" id="5082816">false</span>&nbsp;<span class="comment" id="5082822">//&nbsp;EOF&nbsp;consumed</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082842">return</span>&nbsp;<span class="ident" id="5082849">pos</span><span class="op" id="5082852">,</span>&nbsp;<span class="ident" id="5082854">token</span><span class="op" id="5082859">.</span><span class="ident" id="5082860">SEMICOLON</span><span class="op" id="5082869">,</span>&nbsp;<span class="string" id="5082871">&#34;\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5082879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5082884">tok</span>&nbsp;<span class="op" id="5082888">=</span>&nbsp;<span class="ident" id="5082890">token</span><span class="op" id="5082895">.</span><span class="ident" id="5082896">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5082902">case</span>&nbsp;<span class="string" id="5082907">&#39;\n&#39;</span><span class="op" id="5082911">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5082916">//&nbsp;we&nbsp;only&nbsp;reach&nbsp;here&nbsp;if&nbsp;s.insertSemi&nbsp;was</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5082961">//&nbsp;set&nbsp;in&nbsp;the&nbsp;first&nbsp;place&nbsp;and&nbsp;exited&nbsp;early</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5083007">//&nbsp;from&nbsp;s.skipWhitespace()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083037">s</span><span class="op" id="5083038">.</span><span class="ident" id="5083039">insertSemi</span>&nbsp;<span class="op" id="5083050">=</span>&nbsp;<span class="ident" id="5083052">false</span>&nbsp;<span class="comment" id="5083058">//&nbsp;newline&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083081">return</span>&nbsp;<span class="ident" id="5083088">pos</span><span class="op" id="5083091">,</span>&nbsp;<span class="ident" id="5083093">token</span><span class="op" id="5083098">.</span><span class="ident" id="5083099">SEMICOLON</span><span class="op" id="5083108">,</span>&nbsp;<span class="string" id="5083110">&#34;\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083117">case</span>&nbsp;<span class="string" id="5083122">&#39;&#34;&#39;</span><span class="op" id="5083125">:</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083130">insertSemi</span>&nbsp;<span class="op" id="5083141">=</span>&nbsp;<span class="ident" id="5083143">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083151">tok</span>&nbsp;<span class="op" id="5083155">=</span>&nbsp;<span class="ident" id="5083157">token</span><span class="op" id="5083162">.</span><span class="ident" id="5083163">STRING</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083173">lit</span>&nbsp;<span class="op" id="5083177">=</span>&nbsp;<span class="ident" id="5083179">s</span><span class="op" id="5083180">.</span><span class="ident" id="5083181">scanString</span><span class="op" id="5083191">(</span><span class="op" id="5083192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083196">case</span>&nbsp;<span class="string" id="5083201">&#39;\&#39;&#39;</span><span class="op" id="5083205">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083210">insertSemi</span>&nbsp;<span class="op" id="5083221">=</span>&nbsp;<span class="ident" id="5083223">true</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083231">tok</span>&nbsp;<span class="op" id="5083235">=</span>&nbsp;<span class="ident" id="5083237">token</span><span class="op" id="5083242">.</span><span class="ident" id="5083243">CHAR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083251">lit</span>&nbsp;<span class="op" id="5083255">=</span>&nbsp;<span class="ident" id="5083257">s</span><span class="op" id="5083258">.</span><span class="ident" id="5083259">scanRune</span><span class="op" id="5083267">(</span><span class="op" id="5083268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083272">case</span>&nbsp;<span class="string" id="5083277">&#39;`&#39;</span><span class="op" id="5083280">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083285">insertSemi</span>&nbsp;<span class="op" id="5083296">=</span>&nbsp;<span class="ident" id="5083298">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083306">tok</span>&nbsp;<span class="op" id="5083310">=</span>&nbsp;<span class="ident" id="5083312">token</span><span class="op" id="5083317">.</span><span class="ident" id="5083318">STRING</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083328">lit</span>&nbsp;<span class="op" id="5083332">=</span>&nbsp;<span class="ident" id="5083334">s</span><span class="op" id="5083335">.</span><span class="ident" id="5083336">scanRawString</span><span class="op" id="5083349">(</span><span class="op" id="5083350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083354">case</span>&nbsp;<span class="string" id="5083359">&#39;:&#39;</span><span class="op" id="5083362">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083367">tok</span>&nbsp;<span class="op" id="5083371">=</span>&nbsp;<span class="ident" id="5083373">s</span><span class="op" id="5083374">.</span><span class="ident" id="5083375">switch2</span><span class="op" id="5083382">(</span><span class="ident" id="5083383">token</span><span class="op" id="5083388">.</span><span class="ident" id="5083389">COLON</span><span class="op" id="5083394">,</span>&nbsp;<span class="ident" id="5083396">token</span><span class="op" id="5083401">.</span><span class="ident" id="5083402">DEFINE</span><span class="op" id="5083408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083412">case</span>&nbsp;<span class="string" id="5083417">&#39;.&#39;</span><span class="op" id="5083420">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083425">if</span>&nbsp;<span class="string" id="5083428">&#39;0&#39;</span>&nbsp;<span class="op" id="5083432">&lt;=</span>&nbsp;<span class="ident" id="5083435">s</span><span class="op" id="5083436">.</span><span class="ident" id="5083437">ch</span>&nbsp;<span class="op" id="5083440">&amp;&amp;</span>&nbsp;<span class="ident" id="5083443">s</span><span class="op" id="5083444">.</span><span class="ident" id="5083445">ch</span>&nbsp;<span class="op" id="5083448">&lt;=</span>&nbsp;<span class="string" id="5083451">&#39;9&#39;</span>&nbsp;<span class="op" id="5083455">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083461">insertSemi</span>&nbsp;<span class="op" id="5083472">=</span>&nbsp;<span class="ident" id="5083474">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083483">tok</span><span class="op" id="5083486">,</span>&nbsp;<span class="ident" id="5083488">lit</span>&nbsp;<span class="op" id="5083492">=</span>&nbsp;<span class="ident" id="5083494">s</span><span class="op" id="5083495">.</span><span class="ident" id="5083496">scanNumber</span><span class="op" id="5083506">(</span><span class="ident" id="5083507">true</span><span class="op" id="5083511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5083516">}</span>&nbsp;<span class="keyword" id="5083518">else</span>&nbsp;<span class="keyword" id="5083523">if</span>&nbsp;<span class="ident" id="5083526">s</span><span class="op" id="5083527">.</span><span class="ident" id="5083528">ch</span>&nbsp;<span class="op" id="5083531">==</span>&nbsp;<span class="string" id="5083534">&#39;.&#39;</span>&nbsp;<span class="op" id="5083538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083544">s</span><span class="op" id="5083545">.</span><span class="ident" id="5083546">next</span><span class="op" id="5083550">(</span><span class="op" id="5083551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083557">if</span>&nbsp;<span class="ident" id="5083560">s</span><span class="op" id="5083561">.</span><span class="ident" id="5083562">ch</span>&nbsp;<span class="op" id="5083565">==</span>&nbsp;<span class="string" id="5083568">&#39;.&#39;</span>&nbsp;<span class="op" id="5083572">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083579">s</span><span class="op" id="5083580">.</span><span class="ident" id="5083581">next</span><span class="op" id="5083585">(</span><span class="op" id="5083586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083593">tok</span>&nbsp;<span class="op" id="5083597">=</span>&nbsp;<span class="ident" id="5083599">token</span><span class="op" id="5083604">.</span><span class="ident" id="5083605">ELLIPSIS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5083618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5083623">}</span>&nbsp;<span class="keyword" id="5083625">else</span>&nbsp;<span class="op" id="5083630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083636">tok</span>&nbsp;<span class="op" id="5083640">=</span>&nbsp;<span class="ident" id="5083642">token</span><span class="op" id="5083647">.</span><span class="ident" id="5083648">PERIOD</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5083658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083662">case</span>&nbsp;<span class="string" id="5083667">&#39;,&#39;</span><span class="op" id="5083670">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083675">tok</span>&nbsp;<span class="op" id="5083679">=</span>&nbsp;<span class="ident" id="5083681">token</span><span class="op" id="5083686">.</span><span class="ident" id="5083687">COMMA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083695">case</span>&nbsp;<span class="string" id="5083700">&#39;;&#39;</span><span class="op" id="5083703">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083708">tok</span>&nbsp;<span class="op" id="5083712">=</span>&nbsp;<span class="ident" id="5083714">token</span><span class="op" id="5083719">.</span><span class="ident" id="5083720">SEMICOLON</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083733">lit</span>&nbsp;<span class="op" id="5083737">=</span>&nbsp;<span class="string" id="5083739">&#34;;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083745">case</span>&nbsp;<span class="string" id="5083750">&#39;(&#39;</span><span class="op" id="5083753">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083758">tok</span>&nbsp;<span class="op" id="5083762">=</span>&nbsp;<span class="ident" id="5083764">token</span><span class="op" id="5083769">.</span><span class="ident" id="5083770">LPAREN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083779">case</span>&nbsp;<span class="string" id="5083784">&#39;)&#39;</span><span class="op" id="5083787">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083792">insertSemi</span>&nbsp;<span class="op" id="5083803">=</span>&nbsp;<span class="ident" id="5083805">true</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083813">tok</span>&nbsp;<span class="op" id="5083817">=</span>&nbsp;<span class="ident" id="5083819">token</span><span class="op" id="5083824">.</span><span class="ident" id="5083825">RPAREN</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083834">case</span>&nbsp;<span class="string" id="5083839">&#39;[&#39;</span><span class="op" id="5083842">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083847">tok</span>&nbsp;<span class="op" id="5083851">=</span>&nbsp;<span class="ident" id="5083853">token</span><span class="op" id="5083858">.</span><span class="ident" id="5083859">LBRACK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083868">case</span>&nbsp;<span class="string" id="5083873">&#39;]&#39;</span><span class="op" id="5083876">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083881">insertSemi</span>&nbsp;<span class="op" id="5083892">=</span>&nbsp;<span class="ident" id="5083894">true</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083902">tok</span>&nbsp;<span class="op" id="5083906">=</span>&nbsp;<span class="ident" id="5083908">token</span><span class="op" id="5083913">.</span><span class="ident" id="5083914">RBRACK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083923">case</span>&nbsp;<span class="string" id="5083928">&#39;{&#39;</span><span class="op" id="5083931">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083936">tok</span>&nbsp;<span class="op" id="5083940">=</span>&nbsp;<span class="ident" id="5083942">token</span><span class="op" id="5083947">.</span><span class="ident" id="5083948">LBRACE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5083957">case</span>&nbsp;<span class="string" id="5083962">&#39;}&#39;</span><span class="op" id="5083965">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083970">insertSemi</span>&nbsp;<span class="op" id="5083981">=</span>&nbsp;<span class="ident" id="5083983">true</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5083991">tok</span>&nbsp;<span class="op" id="5083995">=</span>&nbsp;<span class="ident" id="5083997">token</span><span class="op" id="5084002">.</span><span class="ident" id="5084003">RBRACE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084012">case</span>&nbsp;<span class="string" id="5084017">&#39;+&#39;</span><span class="op" id="5084020">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084025">tok</span>&nbsp;<span class="op" id="5084029">=</span>&nbsp;<span class="ident" id="5084031">s</span><span class="op" id="5084032">.</span><span class="ident" id="5084033">switch3</span><span class="op" id="5084040">(</span><span class="ident" id="5084041">token</span><span class="op" id="5084046">.</span><span class="ident" id="5084047">ADD</span><span class="op" id="5084050">,</span>&nbsp;<span class="ident" id="5084052">token</span><span class="op" id="5084057">.</span><span class="ident" id="5084058">ADD_ASSIGN</span><span class="op" id="5084068">,</span>&nbsp;<span class="string" id="5084070">&#39;+&#39;</span><span class="op" id="5084073">,</span>&nbsp;<span class="ident" id="5084075">token</span><span class="op" id="5084080">.</span><span class="ident" id="5084081">INC</span><span class="op" id="5084084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084089">if</span>&nbsp;<span class="ident" id="5084092">tok</span>&nbsp;<span class="op" id="5084096">==</span>&nbsp;<span class="ident" id="5084099">token</span><span class="op" id="5084104">.</span><span class="ident" id="5084105">INC</span>&nbsp;<span class="op" id="5084109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084115">insertSemi</span>&nbsp;<span class="op" id="5084126">=</span>&nbsp;<span class="ident" id="5084128">true</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5084136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084140">case</span>&nbsp;<span class="string" id="5084145">&#39;-&#39;</span><span class="op" id="5084148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084153">tok</span>&nbsp;<span class="op" id="5084157">=</span>&nbsp;<span class="ident" id="5084159">s</span><span class="op" id="5084160">.</span><span class="ident" id="5084161">switch3</span><span class="op" id="5084168">(</span><span class="ident" id="5084169">token</span><span class="op" id="5084174">.</span><span class="ident" id="5084175">SUB</span><span class="op" id="5084178">,</span>&nbsp;<span class="ident" id="5084180">token</span><span class="op" id="5084185">.</span><span class="ident" id="5084186">SUB_ASSIGN</span><span class="op" id="5084196">,</span>&nbsp;<span class="string" id="5084198">&#39;-&#39;</span><span class="op" id="5084201">,</span>&nbsp;<span class="ident" id="5084203">token</span><span class="op" id="5084208">.</span><span class="ident" id="5084209">DEC</span><span class="op" id="5084212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084217">if</span>&nbsp;<span class="ident" id="5084220">tok</span>&nbsp;<span class="op" id="5084224">==</span>&nbsp;<span class="ident" id="5084227">token</span><span class="op" id="5084232">.</span><span class="ident" id="5084233">DEC</span>&nbsp;<span class="op" id="5084237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084243">insertSemi</span>&nbsp;<span class="op" id="5084254">=</span>&nbsp;<span class="ident" id="5084256">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5084264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084268">case</span>&nbsp;<span class="string" id="5084273">&#39;*&#39;</span><span class="op" id="5084276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084281">tok</span>&nbsp;<span class="op" id="5084285">=</span>&nbsp;<span class="ident" id="5084287">s</span><span class="op" id="5084288">.</span><span class="ident" id="5084289">switch2</span><span class="op" id="5084296">(</span><span class="ident" id="5084297">token</span><span class="op" id="5084302">.</span><span class="ident" id="5084303">MUL</span><span class="op" id="5084306">,</span>&nbsp;<span class="ident" id="5084308">token</span><span class="op" id="5084313">.</span><span class="ident" id="5084314">MUL_ASSIGN</span><span class="op" id="5084324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084328">case</span>&nbsp;<span class="string" id="5084333">&#39;/&#39;</span><span class="op" id="5084336">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084341">if</span>&nbsp;<span class="ident" id="5084344">s</span><span class="op" id="5084345">.</span><span class="ident" id="5084346">ch</span>&nbsp;<span class="op" id="5084349">==</span>&nbsp;<span class="string" id="5084352">&#39;/&#39;</span>&nbsp;<span class="op" id="5084356">||</span>&nbsp;<span class="ident" id="5084359">s</span><span class="op" id="5084360">.</span><span class="ident" id="5084361">ch</span>&nbsp;<span class="op" id="5084364">==</span>&nbsp;<span class="string" id="5084367">&#39;*&#39;</span>&nbsp;<span class="op" id="5084371">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5084377">//&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084392">if</span>&nbsp;<span class="ident" id="5084395">s</span><span class="op" id="5084396">.</span><span class="ident" id="5084397">insertSemi</span>&nbsp;<span class="op" id="5084408">&amp;&amp;</span>&nbsp;<span class="ident" id="5084411">s</span><span class="op" id="5084412">.</span><span class="ident" id="5084413">findLineEnd</span><span class="op" id="5084424">(</span><span class="op" id="5084425">)</span>&nbsp;<span class="op" id="5084427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5084434">//&nbsp;reset&nbsp;position&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084489">s</span><span class="op" id="5084490">.</span><span class="ident" id="5084491">ch</span>&nbsp;<span class="op" id="5084494">=</span>&nbsp;<span class="string" id="5084496">&#39;/&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084505">s</span><span class="op" id="5084506">.</span><span class="ident" id="5084507">offset</span>&nbsp;<span class="op" id="5084514">=</span>&nbsp;<span class="ident" id="5084516">s</span><span class="op" id="5084517">.</span><span class="ident" id="5084518">file</span><span class="op" id="5084522">.</span><span class="ident" id="5084523">Offset</span><span class="op" id="5084529">(</span><span class="ident" id="5084530">pos</span><span class="op" id="5084533">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084540">s</span><span class="op" id="5084541">.</span><span class="ident" id="5084542">rdOffset</span>&nbsp;<span class="op" id="5084551">=</span>&nbsp;<span class="ident" id="5084553">s</span><span class="op" id="5084554">.</span><span class="ident" id="5084555">offset</span>&nbsp;<span class="op" id="5084562">+</span>&nbsp;<span class="num" id="5084564">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084571">s</span><span class="op" id="5084572">.</span><span class="ident" id="5084573">insertSemi</span>&nbsp;<span class="op" id="5084584">=</span>&nbsp;<span class="ident" id="5084586">false</span>&nbsp;<span class="comment" id="5084592">//&nbsp;newline&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084617">return</span>&nbsp;<span class="ident" id="5084624">pos</span><span class="op" id="5084627">,</span>&nbsp;<span class="ident" id="5084629">token</span><span class="op" id="5084634">.</span><span class="ident" id="5084635">SEMICOLON</span><span class="op" id="5084644">,</span>&nbsp;<span class="string" id="5084646">&#34;\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5084655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084661">lit</span>&nbsp;<span class="op" id="5084665">=</span>&nbsp;<span class="ident" id="5084667">s</span><span class="op" id="5084668">.</span><span class="ident" id="5084669">scanComment</span><span class="op" id="5084680">(</span><span class="op" id="5084681">)</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084687">if</span>&nbsp;<span class="ident" id="5084690">s</span><span class="op" id="5084691">.</span><span class="ident" id="5084692">mode</span><span class="op" id="5084696">&amp;</span><span class="ident" id="5084697">ScanComments</span>&nbsp;<span class="op" id="5084710">==</span>&nbsp;<span class="num" id="5084713">0</span>&nbsp;<span class="op" id="5084715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5084722">//&nbsp;skip&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084743">s</span><span class="op" id="5084744">.</span><span class="ident" id="5084745">insertSemi</span>&nbsp;<span class="op" id="5084756">=</span>&nbsp;<span class="ident" id="5084758">false</span>&nbsp;<span class="comment" id="5084764">//&nbsp;newline&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084789">goto</span>&nbsp;<span class="ident" id="5084794">scanAgain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5084808">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084814">tok</span>&nbsp;<span class="op" id="5084818">=</span>&nbsp;<span class="ident" id="5084820">token</span><span class="op" id="5084825">.</span><span class="ident" id="5084826">COMMENT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5084837">}</span>&nbsp;<span class="keyword" id="5084839">else</span>&nbsp;<span class="op" id="5084844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084850">tok</span>&nbsp;<span class="op" id="5084854">=</span>&nbsp;<span class="ident" id="5084856">s</span><span class="op" id="5084857">.</span><span class="ident" id="5084858">switch2</span><span class="op" id="5084865">(</span><span class="ident" id="5084866">token</span><span class="op" id="5084871">.</span><span class="ident" id="5084872">QUO</span><span class="op" id="5084875">,</span>&nbsp;<span class="ident" id="5084877">token</span><span class="op" id="5084882">.</span><span class="ident" id="5084883">QUO_ASSIGN</span><span class="op" id="5084893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5084898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084902">case</span>&nbsp;<span class="string" id="5084907">&#39;%&#39;</span><span class="op" id="5084910">:</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084915">tok</span>&nbsp;<span class="op" id="5084919">=</span>&nbsp;<span class="ident" id="5084921">s</span><span class="op" id="5084922">.</span><span class="ident" id="5084923">switch2</span><span class="op" id="5084930">(</span><span class="ident" id="5084931">token</span><span class="op" id="5084936">.</span><span class="ident" id="5084937">REM</span><span class="op" id="5084940">,</span>&nbsp;<span class="ident" id="5084942">token</span><span class="op" id="5084947">.</span><span class="ident" id="5084948">REM_ASSIGN</span><span class="op" id="5084958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5084962">case</span>&nbsp;<span class="string" id="5084967">&#39;^&#39;</span><span class="op" id="5084970">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5084975">tok</span>&nbsp;<span class="op" id="5084979">=</span>&nbsp;<span class="ident" id="5084981">s</span><span class="op" id="5084982">.</span><span class="ident" id="5084983">switch2</span><span class="op" id="5084990">(</span><span class="ident" id="5084991">token</span><span class="op" id="5084996">.</span><span class="ident" id="5084997">XOR</span><span class="op" id="5085000">,</span>&nbsp;<span class="ident" id="5085002">token</span><span class="op" id="5085007">.</span><span class="ident" id="5085008">XOR_ASSIGN</span><span class="op" id="5085018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085022">case</span>&nbsp;<span class="string" id="5085027">&#39;&lt;&#39;</span><span class="op" id="5085030">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085035">if</span>&nbsp;<span class="ident" id="5085038">s</span><span class="op" id="5085039">.</span><span class="ident" id="5085040">ch</span>&nbsp;<span class="op" id="5085043">==</span>&nbsp;<span class="string" id="5085046">&#39;-&#39;</span>&nbsp;<span class="op" id="5085050">{</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085056">s</span><span class="op" id="5085057">.</span><span class="ident" id="5085058">next</span><span class="op" id="5085062">(</span><span class="op" id="5085063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085069">tok</span>&nbsp;<span class="op" id="5085073">=</span>&nbsp;<span class="ident" id="5085075">token</span><span class="op" id="5085080">.</span><span class="ident" id="5085081">ARROW</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5085090">}</span>&nbsp;<span class="keyword" id="5085092">else</span>&nbsp;<span class="op" id="5085097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085103">tok</span>&nbsp;<span class="op" id="5085107">=</span>&nbsp;<span class="ident" id="5085109">s</span><span class="op" id="5085110">.</span><span class="ident" id="5085111">switch4</span><span class="op" id="5085118">(</span><span class="ident" id="5085119">token</span><span class="op" id="5085124">.</span><span class="ident" id="5085125">LSS</span><span class="op" id="5085128">,</span>&nbsp;<span class="ident" id="5085130">token</span><span class="op" id="5085135">.</span><span class="ident" id="5085136">LEQ</span><span class="op" id="5085139">,</span>&nbsp;<span class="string" id="5085141">&#39;&lt;&#39;</span><span class="op" id="5085144">,</span>&nbsp;<span class="ident" id="5085146">token</span><span class="op" id="5085151">.</span><span class="ident" id="5085152">SHL</span><span class="op" id="5085155">,</span>&nbsp;<span class="ident" id="5085157">token</span><span class="op" id="5085162">.</span><span class="ident" id="5085163">SHL_ASSIGN</span><span class="op" id="5085173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5085178">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085182">case</span>&nbsp;<span class="string" id="5085187">&#39;&gt;&#39;</span><span class="op" id="5085190">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085195">tok</span>&nbsp;<span class="op" id="5085199">=</span>&nbsp;<span class="ident" id="5085201">s</span><span class="op" id="5085202">.</span><span class="ident" id="5085203">switch4</span><span class="op" id="5085210">(</span><span class="ident" id="5085211">token</span><span class="op" id="5085216">.</span><span class="ident" id="5085217">GTR</span><span class="op" id="5085220">,</span>&nbsp;<span class="ident" id="5085222">token</span><span class="op" id="5085227">.</span><span class="ident" id="5085228">GEQ</span><span class="op" id="5085231">,</span>&nbsp;<span class="string" id="5085233">&#39;&gt;&#39;</span><span class="op" id="5085236">,</span>&nbsp;<span class="ident" id="5085238">token</span><span class="op" id="5085243">.</span><span class="ident" id="5085244">SHR</span><span class="op" id="5085247">,</span>&nbsp;<span class="ident" id="5085249">token</span><span class="op" id="5085254">.</span><span class="ident" id="5085255">SHR_ASSIGN</span><span class="op" id="5085265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085269">case</span>&nbsp;<span class="string" id="5085274">&#39;=&#39;</span><span class="op" id="5085277">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085282">tok</span>&nbsp;<span class="op" id="5085286">=</span>&nbsp;<span class="ident" id="5085288">s</span><span class="op" id="5085289">.</span><span class="ident" id="5085290">switch2</span><span class="op" id="5085297">(</span><span class="ident" id="5085298">token</span><span class="op" id="5085303">.</span><span class="ident" id="5085304">ASSIGN</span><span class="op" id="5085310">,</span>&nbsp;<span class="ident" id="5085312">token</span><span class="op" id="5085317">.</span><span class="ident" id="5085318">EQL</span><span class="op" id="5085321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085325">case</span>&nbsp;<span class="string" id="5085330">&#39;!&#39;</span><span class="op" id="5085333">:</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085338">tok</span>&nbsp;<span class="op" id="5085342">=</span>&nbsp;<span class="ident" id="5085344">s</span><span class="op" id="5085345">.</span><span class="ident" id="5085346">switch2</span><span class="op" id="5085353">(</span><span class="ident" id="5085354">token</span><span class="op" id="5085359">.</span><span class="ident" id="5085360">NOT</span><span class="op" id="5085363">,</span>&nbsp;<span class="ident" id="5085365">token</span><span class="op" id="5085370">.</span><span class="ident" id="5085371">NEQ</span><span class="op" id="5085374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085378">case</span>&nbsp;<span class="string" id="5085383">&#39;&amp;&#39;</span><span class="op" id="5085386">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085391">if</span>&nbsp;<span class="ident" id="5085394">s</span><span class="op" id="5085395">.</span><span class="ident" id="5085396">ch</span>&nbsp;<span class="op" id="5085399">==</span>&nbsp;<span class="string" id="5085402">&#39;^&#39;</span>&nbsp;<span class="op" id="5085406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085412">s</span><span class="op" id="5085413">.</span><span class="ident" id="5085414">next</span><span class="op" id="5085418">(</span><span class="op" id="5085419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085425">tok</span>&nbsp;<span class="op" id="5085429">=</span>&nbsp;<span class="ident" id="5085431">s</span><span class="op" id="5085432">.</span><span class="ident" id="5085433">switch2</span><span class="op" id="5085440">(</span><span class="ident" id="5085441">token</span><span class="op" id="5085446">.</span><span class="ident" id="5085447">AND_NOT</span><span class="op" id="5085454">,</span>&nbsp;<span class="ident" id="5085456">token</span><span class="op" id="5085461">.</span><span class="ident" id="5085462">AND_NOT_ASSIGN</span><span class="op" id="5085476">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5085481">}</span>&nbsp;<span class="keyword" id="5085483">else</span>&nbsp;<span class="op" id="5085488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085494">tok</span>&nbsp;<span class="op" id="5085498">=</span>&nbsp;<span class="ident" id="5085500">s</span><span class="op" id="5085501">.</span><span class="ident" id="5085502">switch3</span><span class="op" id="5085509">(</span><span class="ident" id="5085510">token</span><span class="op" id="5085515">.</span><span class="ident" id="5085516">AND</span><span class="op" id="5085519">,</span>&nbsp;<span class="ident" id="5085521">token</span><span class="op" id="5085526">.</span><span class="ident" id="5085527">AND_ASSIGN</span><span class="op" id="5085537">,</span>&nbsp;<span class="string" id="5085539">&#39;&amp;&#39;</span><span class="op" id="5085542">,</span>&nbsp;<span class="ident" id="5085544">token</span><span class="op" id="5085549">.</span><span class="ident" id="5085550">LAND</span><span class="op" id="5085554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5085559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085563">case</span>&nbsp;<span class="string" id="5085568">&#39;|&#39;</span><span class="op" id="5085571">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085576">tok</span>&nbsp;<span class="op" id="5085580">=</span>&nbsp;<span class="ident" id="5085582">s</span><span class="op" id="5085583">.</span><span class="ident" id="5085584">switch3</span><span class="op" id="5085591">(</span><span class="ident" id="5085592">token</span><span class="op" id="5085597">.</span><span class="ident" id="5085598">OR</span><span class="op" id="5085600">,</span>&nbsp;<span class="ident" id="5085602">token</span><span class="op" id="5085607">.</span><span class="ident" id="5085608">OR_ASSIGN</span><span class="op" id="5085617">,</span>&nbsp;<span class="string" id="5085619">&#39;|&#39;</span><span class="op" id="5085622">,</span>&nbsp;<span class="ident" id="5085624">token</span><span class="op" id="5085629">.</span><span class="ident" id="5085630">LOR</span><span class="op" id="5085633">)</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085637">default</span><span class="op" id="5085644">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5085649">//&nbsp;next&nbsp;reports&nbsp;unexpected&nbsp;BOMs&nbsp;-&nbsp;don&#39;t&nbsp;repeat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085699">if</span>&nbsp;<span class="ident" id="5085702">ch</span>&nbsp;<span class="op" id="5085705">!=</span>&nbsp;<span class="ident" id="5085708">bom</span>&nbsp;<span class="op" id="5085712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085718">s</span><span class="op" id="5085719">.</span><span class="builtintype" id="5085720">error</span><span class="op" id="5085725">(</span><span class="ident" id="5085726">s</span><span class="op" id="5085727">.</span><span class="ident" id="5085728">file</span><span class="op" id="5085732">.</span><span class="ident" id="5085733">Offset</span><span class="op" id="5085739">(</span><span class="ident" id="5085740">pos</span><span class="op" id="5085743">)</span><span class="op" id="5085744">,</span>&nbsp;<span class="ident" id="5085746">fmt</span><span class="op" id="5085749">.</span><span class="ident" id="5085750">Sprintf</span><span class="op" id="5085757">(</span><span class="string" id="5085758">&#34;illegal&nbsp;character&nbsp;%#U&#34;</span><span class="op" id="5085781">,</span>&nbsp;<span class="ident" id="5085783">ch</span><span class="op" id="5085785">)</span><span class="op" id="5085786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5085791">}</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085796">insertSemi</span>&nbsp;<span class="op" id="5085807">=</span>&nbsp;<span class="ident" id="5085809">s</span><span class="op" id="5085810">.</span><span class="ident" id="5085811">insertSemi</span>&nbsp;<span class="comment" id="5085822">//&nbsp;preserve&nbsp;insertSemi&nbsp;info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085853">tok</span>&nbsp;<span class="op" id="5085857">=</span>&nbsp;<span class="ident" id="5085859">token</span><span class="op" id="5085864">.</span><span class="ident" id="5085865">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085876">lit</span>&nbsp;<span class="op" id="5085880">=</span>&nbsp;<span class="builtintype" id="5085882">string</span><span class="op" id="5085888">(</span><span class="ident" id="5085889">ch</span><span class="op" id="5085891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5085895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5085898">}</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085901">if</span>&nbsp;<span class="ident" id="5085904">s</span><span class="op" id="5085905">.</span><span class="ident" id="5085906">mode</span><span class="op" id="5085910">&amp;</span><span class="ident" id="5085911">dontInsertSemis</span>&nbsp;<span class="op" id="5085927">==</span>&nbsp;<span class="num" id="5085930">0</span>&nbsp;<span class="op" id="5085932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5085936">s</span><span class="op" id="5085937">.</span><span class="ident" id="5085938">insertSemi</span>&nbsp;<span class="op" id="5085949">=</span>&nbsp;<span class="ident" id="5085951">insertSemi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5085963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5085967">return</span><br>
<span class="lineno">760</span><span class="op" id="5085974">}</span>
</div>
</body>
</html>
