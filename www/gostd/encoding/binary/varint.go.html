<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/binary</h2>
<ul>
<li><a href="/gostd/encoding/binary/binary.go.html">binary.go</a></li>
<li><a href="/gostd/encoding/binary/binary_test.go.html">binary_test.go</a></li>
<li><a href="/gostd/encoding/binary/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/binary/varint.go.html" class="current">varint.go</a></li>
<li><a href="/gostd/encoding/binary/varint_test.go.html">varint_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3000971">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3001027">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3001081">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3001132">package</span>&nbsp;<span class="ident" id="3001140">binary</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3001148">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;&#34;varint&#34;&nbsp;encoding&nbsp;of&nbsp;64-bit&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="3001210">//&nbsp;The&nbsp;encoding&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3001230">//&nbsp;-&nbsp;unsigned&nbsp;integers&nbsp;are&nbsp;serialized&nbsp;7&nbsp;bits&nbsp;at&nbsp;a&nbsp;time,&nbsp;starting&nbsp;with&nbsp;the</span><br>
<span class="lineno">10</span><span class="comment" id="3001304">//&nbsp;&nbsp;&nbsp;least&nbsp;significant&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="3001332">//&nbsp;-&nbsp;the&nbsp;most&nbsp;significant&nbsp;bit&nbsp;(msb)&nbsp;in&nbsp;each&nbsp;output&nbsp;byte&nbsp;indicates&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="3001407">//&nbsp;&nbsp;&nbsp;is&nbsp;a&nbsp;continuation&nbsp;byte&nbsp;(msb&nbsp;=&nbsp;1)</span><br>
<span class="lineno"></span><span class="comment" id="3001445">//&nbsp;-&nbsp;signed&nbsp;integers&nbsp;are&nbsp;mapped&nbsp;to&nbsp;unsigned&nbsp;integers&nbsp;using&nbsp;&#34;zig-zag&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3001514">//&nbsp;&nbsp;&nbsp;encoding:&nbsp;Positive&nbsp;values&nbsp;x&nbsp;are&nbsp;written&nbsp;as&nbsp;2*x&nbsp;+&nbsp;0,&nbsp;negative&nbsp;values</span><br>
<span class="lineno">15</span><span class="comment" id="3001587">//&nbsp;&nbsp;&nbsp;are&nbsp;written&nbsp;as&nbsp;2*(^x)&nbsp;+&nbsp;1;&nbsp;that&nbsp;is,&nbsp;negative&nbsp;numbers&nbsp;are&nbsp;complemented</span><br>
<span class="lineno"></span><span class="comment" id="3001662">//&nbsp;&nbsp;&nbsp;and&nbsp;whether&nbsp;to&nbsp;complement&nbsp;is&nbsp;encoded&nbsp;in&nbsp;bit&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3001714">//</span><br>
<span class="lineno"></span><span class="comment" id="3001717">//&nbsp;Design&nbsp;note:</span><br>
<span class="lineno"></span><span class="comment" id="3001733">//&nbsp;At&nbsp;most&nbsp;10&nbsp;bytes&nbsp;are&nbsp;needed&nbsp;for&nbsp;64-bit&nbsp;values.&nbsp;The&nbsp;encoding&nbsp;could</span><br>
<span class="lineno">20</span><span class="comment" id="3001802">//&nbsp;be&nbsp;more&nbsp;dense:&nbsp;a&nbsp;full&nbsp;64-bit&nbsp;value&nbsp;needs&nbsp;an&nbsp;extra&nbsp;byte&nbsp;just&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="3001881">//&nbsp;Instead,&nbsp;the&nbsp;msb&nbsp;of&nbsp;the&nbsp;previous&nbsp;byte&nbsp;could&nbsp;be&nbsp;used&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63&nbsp;since&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="3001960">//&nbsp;know&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;more&nbsp;than&nbsp;64&nbsp;bits.&nbsp;This&nbsp;is&nbsp;a&nbsp;trivial&nbsp;improvement&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3002036">//&nbsp;would&nbsp;reduce&nbsp;the&nbsp;maximum&nbsp;encoding&nbsp;length&nbsp;to&nbsp;9&nbsp;bytes.&nbsp;However,&nbsp;it&nbsp;breaks&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3002115">//&nbsp;invariant&nbsp;that&nbsp;the&nbsp;msb&nbsp;is&nbsp;always&nbsp;the&nbsp;&#34;continuation&nbsp;bit&#34;&nbsp;and&nbsp;thus&nbsp;makes&nbsp;the</span><br>
<span class="lineno">25</span><span class="comment" id="3002193">//&nbsp;format&nbsp;incompatible&nbsp;with&nbsp;a&nbsp;varint&nbsp;encoding&nbsp;for&nbsp;larger&nbsp;numbers&nbsp;(say&nbsp;128-bit).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3002274">import</span>&nbsp;<span class="op" id="3002281">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3002284">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3002294">&#34;io&#34;</span><br>
<span class="lineno">30</span><span class="op" id="3002299">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3002302">//&nbsp;MaxVarintLenN&nbsp;is&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;a&nbsp;varint-encoded&nbsp;N-bit&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="3002376">const</span>&nbsp;<span class="op" id="3002382">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002385">MaxVarintLen16</span>&nbsp;<span class="op" id="3002400">=</span>&nbsp;<span class="num" id="3002402">3</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002405">MaxVarintLen32</span>&nbsp;<span class="op" id="3002420">=</span>&nbsp;<span class="num" id="3002422">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002425">MaxVarintLen64</span>&nbsp;<span class="op" id="3002440">=</span>&nbsp;<span class="num" id="3002442">10</span><br>
<span class="lineno"></span><span class="op" id="3002445">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3002448">//&nbsp;PutUvarint&nbsp;encodes&nbsp;a&nbsp;uint64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">40</span><span class="comment" id="3002529">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutUvarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="3002583">func</span>&nbsp;<span class="ident" id="3002588">PutUvarint</span><span class="op" id="3002598">(</span><span class="ident" id="3002599">buf</span>&nbsp;<span class="op" id="3002603">[</span><span class="op" id="3002604">]</span><span class="builtintype" id="3002605">byte</span><span class="op" id="3002609">,</span>&nbsp;<span class="ident" id="3002611">x</span>&nbsp;<span class="builtintype" id="3002613">uint64</span><span class="op" id="3002619">)</span>&nbsp;<span class="builtintype" id="3002621">int</span>&nbsp;<span class="op" id="3002625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002628">i</span>&nbsp;<span class="op" id="3002630">:=</span>&nbsp;<span class="num" id="3002633">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002636">for</span>&nbsp;<span class="ident" id="3002640"><a href="/gostd/encoding/binary/varint.go.html#3002611">x</a></span>&nbsp;<span class="op" id="3002642">&gt;=</span>&nbsp;<span class="num" id="3002645">0x80</span>&nbsp;<span class="op" id="3002650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002654"><a href="/gostd/encoding/binary/varint.go.html#3002599">buf</a></span><span class="op" id="3002657">[</span><span class="ident" id="3002658"><a href="/gostd/encoding/binary/varint.go.html#3002628">i</a></span><span class="op" id="3002659">]</span>&nbsp;<span class="op" id="3002661">=</span>&nbsp;<span class="builtintype" id="3002663">byte</span><span class="op" id="3002667">(</span><span class="ident" id="3002668"><a href="/gostd/encoding/binary/varint.go.html#3002611">x</a></span><span class="op" id="3002669">)</span>&nbsp;<span class="op" id="3002671">|</span>&nbsp;<span class="num" id="3002673">0x80</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002680"><a href="/gostd/encoding/binary/varint.go.html#3002611">x</a></span>&nbsp;<span class="op" id="3002682">&gt;&gt;=</span>&nbsp;<span class="num" id="3002686">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002690"><a href="/gostd/encoding/binary/varint.go.html#3002628">i</a></span><span class="op" id="3002691">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3002695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002698"><a href="/gostd/encoding/binary/varint.go.html#3002599">buf</a></span><span class="op" id="3002701">[</span><span class="ident" id="3002702"><a href="/gostd/encoding/binary/varint.go.html#3002628">i</a></span><span class="op" id="3002703">]</span>&nbsp;<span class="op" id="3002705">=</span>&nbsp;<span class="builtintype" id="3002707">byte</span><span class="op" id="3002711">(</span><span class="ident" id="3002712"><a href="/gostd/encoding/binary/varint.go.html#3002611">x</a></span><span class="op" id="3002713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002716">return</span>&nbsp;<span class="ident" id="3002723"><a href="/gostd/encoding/binary/varint.go.html#3002628">i</a></span>&nbsp;<span class="op" id="3002725">+</span>&nbsp;<span class="num" id="3002727">1</span><br>
<span class="lineno">50</span><span class="op" id="3002729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3002732">//&nbsp;Uvarint&nbsp;decodes&nbsp;a&nbsp;uint64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3002800">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3002868">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;meaning:</span><br>
<span class="lineno">55</span><span class="comment" id="3002914">//</span><br>
<span class="lineno"></span><span class="comment" id="3002917">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="3002942">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="3002990">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3003041">//</span><br>
<span class="lineno">60</span><span class="keyword" id="3003044">func</span>&nbsp;<span class="ident" id="3003049">Uvarint</span><span class="op" id="3003056">(</span><span class="ident" id="3003057">buf</span>&nbsp;<span class="op" id="3003061">[</span><span class="op" id="3003062">]</span><span class="builtintype" id="3003063">byte</span><span class="op" id="3003067">)</span>&nbsp;<span class="op" id="3003069">(</span><span class="builtintype" id="3003070">uint64</span><span class="op" id="3003076">,</span>&nbsp;<span class="builtintype" id="3003078">int</span><span class="op" id="3003081">)</span>&nbsp;<span class="op" id="3003083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003086">var</span>&nbsp;<span class="ident" id="3003090">x</span>&nbsp;<span class="builtintype" id="3003092">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003100">var</span>&nbsp;<span class="ident" id="3003104">s</span>&nbsp;<span class="builtintype" id="3003106">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003112">for</span>&nbsp;<span class="ident" id="3003116">i</span><span class="op" id="3003117">,</span>&nbsp;<span class="ident" id="3003119">b</span>&nbsp;<span class="op" id="3003121">:=</span>&nbsp;<span class="keyword" id="3003124">range</span>&nbsp;<span class="ident" id="3003130"><a href="/gostd/encoding/binary/varint.go.html#3003057">buf</a></span>&nbsp;<span class="op" id="3003134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003138">if</span>&nbsp;<span class="ident" id="3003141"><a href="/gostd/encoding/binary/varint.go.html#3003119">b</a></span>&nbsp;<span class="op" id="3003143">&lt;</span>&nbsp;<span class="num" id="3003145">0x80</span>&nbsp;<span class="op" id="3003150">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003155">if</span>&nbsp;<span class="ident" id="3003158"><a href="/gostd/encoding/binary/varint.go.html#3003116">i</a></span>&nbsp;<span class="op" id="3003160">&gt;</span>&nbsp;<span class="num" id="3003162">9</span>&nbsp;<span class="op" id="3003164">||</span>&nbsp;<span class="ident" id="3003167"><a href="/gostd/encoding/binary/varint.go.html#3003116">i</a></span>&nbsp;<span class="op" id="3003169">==</span>&nbsp;<span class="num" id="3003172">9</span>&nbsp;<span class="op" id="3003174">&amp;&amp;</span>&nbsp;<span class="ident" id="3003177"><a href="/gostd/encoding/binary/varint.go.html#3003119">b</a></span>&nbsp;<span class="op" id="3003179">&gt;</span>&nbsp;<span class="num" id="3003181">1</span>&nbsp;<span class="op" id="3003183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003189">return</span>&nbsp;<span class="num" id="3003196">0</span><span class="op" id="3003197">,</span>&nbsp;<span class="op" id="3003199">-</span><span class="op" id="3003200">(</span><span class="ident" id="3003201"><a href="/gostd/encoding/binary/varint.go.html#3003116">i</a></span>&nbsp;<span class="op" id="3003203">+</span>&nbsp;<span class="num" id="3003205">1</span><span class="op" id="3003206">)</span>&nbsp;<span class="comment" id="3003208">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3003223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003228">return</span>&nbsp;<span class="ident" id="3003235"><a href="/gostd/encoding/binary/varint.go.html#3003090">x</a></span>&nbsp;<span class="op" id="3003237">|</span>&nbsp;<span class="builtintype" id="3003239">uint64</span><span class="op" id="3003245">(</span><span class="ident" id="3003246"><a href="/gostd/encoding/binary/varint.go.html#3003119">b</a></span><span class="op" id="3003247">)</span><span class="op" id="3003248">&lt;&lt;</span><span class="ident" id="3003250"><a href="/gostd/encoding/binary/varint.go.html#3003104">s</a></span><span class="op" id="3003251">,</span>&nbsp;<span class="ident" id="3003253"><a href="/gostd/encoding/binary/varint.go.html#3003116">i</a></span>&nbsp;<span class="op" id="3003255">+</span>&nbsp;<span class="num" id="3003257">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3003261">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003265"><a href="/gostd/encoding/binary/varint.go.html#3003090">x</a></span>&nbsp;<span class="op" id="3003267">|=</span>&nbsp;<span class="builtintype" id="3003270">uint64</span><span class="op" id="3003276">(</span><span class="ident" id="3003277"><a href="/gostd/encoding/binary/varint.go.html#3003119">b</a></span><span class="op" id="3003278">&amp;</span><span class="num" id="3003279">0x7f</span><span class="op" id="3003283">)</span>&nbsp;<span class="op" id="3003285">&lt;&lt;</span>&nbsp;<span class="ident" id="3003288"><a href="/gostd/encoding/binary/varint.go.html#3003104">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003292"><a href="/gostd/encoding/binary/varint.go.html#3003104">s</a></span>&nbsp;<span class="op" id="3003294">+=</span>&nbsp;<span class="num" id="3003297">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3003300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003303">return</span>&nbsp;<span class="num" id="3003310">0</span><span class="op" id="3003311">,</span>&nbsp;<span class="num" id="3003313">0</span><br>
<span class="lineno"></span><span class="op" id="3003315">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="3003318">//&nbsp;PutVarint&nbsp;encodes&nbsp;an&nbsp;int64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="3003398">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutVarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="3003451">func</span>&nbsp;<span class="ident" id="3003456">PutVarint</span><span class="op" id="3003465">(</span><span class="ident" id="3003466">buf</span>&nbsp;<span class="op" id="3003470">[</span><span class="op" id="3003471">]</span><span class="builtintype" id="3003472">byte</span><span class="op" id="3003476">,</span>&nbsp;<span class="ident" id="3003478">x</span>&nbsp;<span class="builtintype" id="3003480">int64</span><span class="op" id="3003485">)</span>&nbsp;<span class="builtintype" id="3003487">int</span>&nbsp;<span class="op" id="3003491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003494">ux</span>&nbsp;<span class="op" id="3003497">:=</span>&nbsp;<span class="builtintype" id="3003500">uint64</span><span class="op" id="3003506">(</span><span class="ident" id="3003507"><a href="/gostd/encoding/binary/varint.go.html#3003478">x</a></span><span class="op" id="3003508">)</span>&nbsp;<span class="op" id="3003510">&lt;&lt;</span>&nbsp;<span class="num" id="3003513">1</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003516">if</span>&nbsp;<span class="ident" id="3003519"><a href="/gostd/encoding/binary/varint.go.html#3003478">x</a></span>&nbsp;<span class="op" id="3003521">&lt;</span>&nbsp;<span class="num" id="3003523">0</span>&nbsp;<span class="op" id="3003525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003529"><a href="/gostd/encoding/binary/varint.go.html#3003494">ux</a></span>&nbsp;<span class="op" id="3003532">=</span>&nbsp;<span class="op" id="3003534">^</span><span class="ident" id="3003535"><a href="/gostd/encoding/binary/varint.go.html#3003494">ux</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3003539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003542">return</span>&nbsp;<span class="ident" id="3003549"><a href="/gostd/encoding/binary/varint.go.html#3002588">PutUvarint</a></span><span class="op" id="3003559">(</span><span class="ident" id="3003560"><a href="/gostd/encoding/binary/varint.go.html#3003466">buf</a></span><span class="op" id="3003563">,</span>&nbsp;<span class="ident" id="3003565"><a href="/gostd/encoding/binary/varint.go.html#3003494">ux</a></span><span class="op" id="3003567">)</span><br>
<span class="lineno"></span><span class="op" id="3003569">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3003572">//&nbsp;Varint&nbsp;decodes&nbsp;an&nbsp;int64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3003639">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3003707">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;with&nbsp;the&nbsp;following&nbsp;meaning:</span><br>
<span class="lineno"></span><span class="comment" id="3003772">//</span><br>
<span class="lineno">90</span><span class="comment" id="3003775">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="3003800">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="3003848">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3003899">//</span><br>
<span class="lineno"></span><span class="keyword" id="3003902">func</span>&nbsp;<span class="ident" id="3003907">Varint</span><span class="op" id="3003913">(</span><span class="ident" id="3003914">buf</span>&nbsp;<span class="op" id="3003918">[</span><span class="op" id="3003919">]</span><span class="builtintype" id="3003920">byte</span><span class="op" id="3003924">)</span>&nbsp;<span class="op" id="3003926">(</span><span class="builtintype" id="3003927">int64</span><span class="op" id="3003932">,</span>&nbsp;<span class="builtintype" id="3003934">int</span><span class="op" id="3003937">)</span>&nbsp;<span class="op" id="3003939">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003942">ux</span><span class="op" id="3003944">,</span>&nbsp;<span class="ident" id="3003946">n</span>&nbsp;<span class="op" id="3003948">:=</span>&nbsp;<span class="ident" id="3003951"><a href="/gostd/encoding/binary/varint.go.html#3003049">Uvarint</a></span><span class="op" id="3003958">(</span><span class="ident" id="3003959"><a href="/gostd/encoding/binary/varint.go.html#3003914">buf</a></span><span class="op" id="3003962">)</span>&nbsp;<span class="comment" id="3003964">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004004">x</span>&nbsp;<span class="op" id="3004006">:=</span>&nbsp;<span class="builtintype" id="3004009">int64</span><span class="op" id="3004014">(</span><span class="ident" id="3004015"><a href="/gostd/encoding/binary/varint.go.html#3003942">ux</a></span>&nbsp;<span class="op" id="3004018">&gt;&gt;</span>&nbsp;<span class="num" id="3004021">1</span><span class="op" id="3004022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004025">if</span>&nbsp;<span class="ident" id="3004028"><a href="/gostd/encoding/binary/varint.go.html#3003942">ux</a></span><span class="op" id="3004030">&amp;</span><span class="num" id="3004031">1</span>&nbsp;<span class="op" id="3004033">!=</span>&nbsp;<span class="num" id="3004036">0</span>&nbsp;<span class="op" id="3004038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004042"><a href="/gostd/encoding/binary/varint.go.html#3004004">x</a></span>&nbsp;<span class="op" id="3004044">=</span>&nbsp;<span class="op" id="3004046">^</span><span class="ident" id="3004047"><a href="/gostd/encoding/binary/varint.go.html#3004004">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004050">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004053">return</span>&nbsp;<span class="ident" id="3004060"><a href="/gostd/encoding/binary/varint.go.html#3004004">x</a></span><span class="op" id="3004061">,</span>&nbsp;<span class="ident" id="3004063"><a href="/gostd/encoding/binary/varint.go.html#3003946">n</a></span><br>
<span class="lineno"></span><span class="op" id="3004065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3004068">var</span>&nbsp;<span class="ident" id="3004072">overflow</span>&nbsp;<span class="op" id="3004081">=</span>&nbsp;<span class="ident" id="3004083"><a href="/gostd/encoding/binary/varint.go.html#3002284">errors</a></span><span class="op" id="3004089">.</span><span class="ident" id="3004090"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="3004093">(</span><span class="string" id="3004094">&#34;binary:&nbsp;varint&nbsp;overflows&nbsp;a&nbsp;64-bit&nbsp;integer&#34;</span><span class="op" id="3004137">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3004140">//&nbsp;ReadUvarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64.</span><br>
<span class="lineno"></span><span class="keyword" id="3004224">func</span>&nbsp;<span class="ident" id="3004229">ReadUvarint</span><span class="op" id="3004240">(</span><span class="ident" id="3004241">r</span>&nbsp;<span class="ident" id="3004243"><a href="/gostd/encoding/binary/varint.go.html#3002294">io</a></span><span class="op" id="3004245">.</span><span class="ident" id="3004246"><a href="/gostd/io/io.go.html#1426965">ByteReader</a></span><span class="op" id="3004256">)</span>&nbsp;<span class="op" id="3004258">(</span><span class="builtintype" id="3004259">uint64</span><span class="op" id="3004265">,</span>&nbsp;<span class="builtintype" id="3004267">error</span><span class="op" id="3004272">)</span>&nbsp;<span class="op" id="3004274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004277">var</span>&nbsp;<span class="ident" id="3004281">x</span>&nbsp;<span class="builtintype" id="3004283">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004291">var</span>&nbsp;<span class="ident" id="3004295">s</span>&nbsp;<span class="builtintype" id="3004297">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004303">for</span>&nbsp;<span class="ident" id="3004307">i</span>&nbsp;<span class="op" id="3004309">:=</span>&nbsp;<span class="num" id="3004312">0</span><span class="op" id="3004313">;</span>&nbsp;<span class="op" id="3004315">;</span>&nbsp;<span class="ident" id="3004317"><a href="/gostd/encoding/binary/varint.go.html#3004307">i</a></span><span class="op" id="3004318">++</span>&nbsp;<span class="op" id="3004321">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004325">b</span><span class="op" id="3004326">,</span>&nbsp;<span class="ident" id="3004328">err</span>&nbsp;<span class="op" id="3004332">:=</span>&nbsp;<span class="ident" id="3004335"><a href="/gostd/encoding/binary/varint.go.html#3004241">r</a></span><span class="op" id="3004336">.</span><span class="ident" id="3004337"><a href="/gostd/io/io.go.html#1426989">ReadByte</a></span><span class="op" id="3004345">(</span><span class="op" id="3004346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004350">if</span>&nbsp;<span class="ident" id="3004353"><a href="/gostd/encoding/binary/varint.go.html#3004328">err</a></span>&nbsp;<span class="op" id="3004357">!=</span>&nbsp;<span class="builtintype" id="3004360">nil</span>&nbsp;<span class="op" id="3004364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004369">return</span>&nbsp;<span class="ident" id="3004376"><a href="/gostd/encoding/binary/varint.go.html#3004281">x</a></span><span class="op" id="3004377">,</span>&nbsp;<span class="ident" id="3004379"><a href="/gostd/encoding/binary/varint.go.html#3004328">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004389">if</span>&nbsp;<span class="ident" id="3004392"><a href="/gostd/encoding/binary/varint.go.html#3004325">b</a></span>&nbsp;<span class="op" id="3004394">&lt;</span>&nbsp;<span class="num" id="3004396">0x80</span>&nbsp;<span class="op" id="3004401">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004406">if</span>&nbsp;<span class="ident" id="3004409"><a href="/gostd/encoding/binary/varint.go.html#3004307">i</a></span>&nbsp;<span class="op" id="3004411">&gt;</span>&nbsp;<span class="num" id="3004413">9</span>&nbsp;<span class="op" id="3004415">||</span>&nbsp;<span class="ident" id="3004418"><a href="/gostd/encoding/binary/varint.go.html#3004307">i</a></span>&nbsp;<span class="op" id="3004420">==</span>&nbsp;<span class="num" id="3004423">9</span>&nbsp;<span class="op" id="3004425">&amp;&amp;</span>&nbsp;<span class="ident" id="3004428"><a href="/gostd/encoding/binary/varint.go.html#3004325">b</a></span>&nbsp;<span class="op" id="3004430">&gt;</span>&nbsp;<span class="num" id="3004432">1</span>&nbsp;<span class="op" id="3004434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004440">return</span>&nbsp;<span class="ident" id="3004447"><a href="/gostd/encoding/binary/varint.go.html#3004281">x</a></span><span class="op" id="3004448">,</span>&nbsp;<span class="ident" id="3004450"><a href="/gostd/encoding/binary/varint.go.html#3004072">overflow</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004467">return</span>&nbsp;<span class="ident" id="3004474"><a href="/gostd/encoding/binary/varint.go.html#3004281">x</a></span>&nbsp;<span class="op" id="3004476">|</span>&nbsp;<span class="builtintype" id="3004478">uint64</span><span class="op" id="3004484">(</span><span class="ident" id="3004485"><a href="/gostd/encoding/binary/varint.go.html#3004325">b</a></span><span class="op" id="3004486">)</span><span class="op" id="3004487">&lt;&lt;</span><span class="ident" id="3004489"><a href="/gostd/encoding/binary/varint.go.html#3004295">s</a></span><span class="op" id="3004490">,</span>&nbsp;<span class="builtintype" id="3004492">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004498">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004502"><a href="/gostd/encoding/binary/varint.go.html#3004281">x</a></span>&nbsp;<span class="op" id="3004504">|=</span>&nbsp;<span class="builtintype" id="3004507">uint64</span><span class="op" id="3004513">(</span><span class="ident" id="3004514"><a href="/gostd/encoding/binary/varint.go.html#3004325">b</a></span><span class="op" id="3004515">&amp;</span><span class="num" id="3004516">0x7f</span><span class="op" id="3004520">)</span>&nbsp;<span class="op" id="3004522">&lt;&lt;</span>&nbsp;<span class="ident" id="3004525"><a href="/gostd/encoding/binary/varint.go.html#3004295">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004529"><a href="/gostd/encoding/binary/varint.go.html#3004295">s</a></span>&nbsp;<span class="op" id="3004531">+=</span>&nbsp;<span class="num" id="3004534">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004537">}</span><br>
<span class="lineno"></span><span class="op" id="3004539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="3004542">//&nbsp;ReadVarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;int64.</span><br>
<span class="lineno"></span><span class="keyword" id="3004623">func</span>&nbsp;<span class="ident" id="3004628">ReadVarint</span><span class="op" id="3004638">(</span><span class="ident" id="3004639">r</span>&nbsp;<span class="ident" id="3004641"><a href="/gostd/encoding/binary/varint.go.html#3002294">io</a></span><span class="op" id="3004643">.</span><span class="ident" id="3004644"><a href="/gostd/io/io.go.html#1426965">ByteReader</a></span><span class="op" id="3004654">)</span>&nbsp;<span class="op" id="3004656">(</span><span class="builtintype" id="3004657">int64</span><span class="op" id="3004662">,</span>&nbsp;<span class="builtintype" id="3004664">error</span><span class="op" id="3004669">)</span>&nbsp;<span class="op" id="3004671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004674">ux</span><span class="op" id="3004676">,</span>&nbsp;<span class="ident" id="3004678">err</span>&nbsp;<span class="op" id="3004682">:=</span>&nbsp;<span class="ident" id="3004685"><a href="/gostd/encoding/binary/varint.go.html#3004229">ReadUvarint</a></span><span class="op" id="3004696">(</span><span class="ident" id="3004697"><a href="/gostd/encoding/binary/varint.go.html#3004639">r</a></span><span class="op" id="3004698">)</span>&nbsp;<span class="comment" id="3004700">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004740">x</span>&nbsp;<span class="op" id="3004742">:=</span>&nbsp;<span class="builtintype" id="3004745">int64</span><span class="op" id="3004750">(</span><span class="ident" id="3004751"><a href="/gostd/encoding/binary/varint.go.html#3004674">ux</a></span>&nbsp;<span class="op" id="3004754">&gt;&gt;</span>&nbsp;<span class="num" id="3004757">1</span><span class="op" id="3004758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004761">if</span>&nbsp;<span class="ident" id="3004764"><a href="/gostd/encoding/binary/varint.go.html#3004674">ux</a></span><span class="op" id="3004766">&amp;</span><span class="num" id="3004767">1</span>&nbsp;<span class="op" id="3004769">!=</span>&nbsp;<span class="num" id="3004772">0</span>&nbsp;<span class="op" id="3004774">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004778"><a href="/gostd/encoding/binary/varint.go.html#3004740">x</a></span>&nbsp;<span class="op" id="3004780">=</span>&nbsp;<span class="op" id="3004782">^</span><span class="ident" id="3004783"><a href="/gostd/encoding/binary/varint.go.html#3004740">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004789">return</span>&nbsp;<span class="ident" id="3004796"><a href="/gostd/encoding/binary/varint.go.html#3004740">x</a></span><span class="op" id="3004797">,</span>&nbsp;<span class="ident" id="3004799"><a href="/gostd/encoding/binary/varint.go.html#3004678">err</a></span><br>
<span class="lineno"></span><span class="op" id="3004803">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
