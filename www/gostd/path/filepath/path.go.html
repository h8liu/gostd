<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>path/filepath</h2>
<ul>
<li><a href="/gostd/path/filepath/example_unix_test.go.html">example_unix_test.go</a></li>
<li><a href="/gostd/path/filepath/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/path/filepath/match.go.html">match.go</a></li>
<li><a href="/gostd/path/filepath/match_test.go.html">match_test.go</a></li>
<li><a href="/gostd/path/filepath/path.go.html">path.go</a></li>
<li><a href="/gostd/path/filepath/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/path/filepath/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/path/filepath/symlink.go.html">symlink.go</a></li>
<li><a href="/gostd/path/filepath/symlink_unix.go.html">symlink_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3020386">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3020441">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3020495">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3020546">//&nbsp;Package&nbsp;filepath&nbsp;implements&nbsp;utility&nbsp;routines&nbsp;for&nbsp;manipulating&nbsp;filename&nbsp;paths</span><br>
<span class="lineno"></span><span class="comment" id="3020626">//&nbsp;in&nbsp;a&nbsp;way&nbsp;compatible&nbsp;with&nbsp;the&nbsp;target&nbsp;operating&nbsp;system-defined&nbsp;file&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="3020702">package</span>&nbsp;<span class="ident" id="3020710">filepath</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3020720">import</span>&nbsp;<span class="op" id="3020727">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3020730">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3020740">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3020746">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3020754">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3020764">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3020767">//&nbsp;A&nbsp;lazybuf&nbsp;is&nbsp;a&nbsp;lazily&nbsp;constructed&nbsp;path&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3020817">//&nbsp;It&nbsp;supports&nbsp;append,&nbsp;reading&nbsp;previously&nbsp;appended&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="3020875">//&nbsp;and&nbsp;retrieving&nbsp;the&nbsp;final&nbsp;string.&nbsp;It&nbsp;does&nbsp;not&nbsp;allocate&nbsp;a&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="3020941">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;output&nbsp;until&nbsp;that&nbsp;output&nbsp;diverges&nbsp;from&nbsp;s.</span><br>
<span class="lineno">20</span><span class="keyword" id="3020998">type</span>&nbsp;<span class="ident" id="3021003">lazybuf</span>&nbsp;<span class="keyword" id="3021011">struct</span>&nbsp;<span class="op" id="3021018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021021">path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3021032">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021040">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3021051">[</span><span class="op" id="3021052">]</span><span class="builtintype" id="3021053">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021059">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3021070">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021075">volAndPath</span>&nbsp;<span class="builtintype" id="3021086">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021094">volLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3021105">int</span><br>
<span class="lineno"></span><span class="op" id="3021109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3021112">func</span>&nbsp;<span class="op" id="3021117">(</span><span class="ident" id="3021118">b</span>&nbsp;<span class="op" id="3021120">*</span><span class="ident" id="3021121">lazybuf</span><span class="op" id="3021128">)</span>&nbsp;<span class="ident" id="3021130">index</span><span class="op" id="3021135">(</span><span class="ident" id="3021136">i</span>&nbsp;<span class="builtintype" id="3021138">int</span><span class="op" id="3021141">)</span>&nbsp;<span class="builtintype" id="3021143">byte</span>&nbsp;<span class="op" id="3021148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021151">if</span>&nbsp;<span class="ident" id="3021154">b</span><span class="op" id="3021155">.</span><span class="ident" id="3021156">buf</span>&nbsp;<span class="op" id="3021160">!=</span>&nbsp;<span class="ident" id="3021163">nil</span>&nbsp;<span class="op" id="3021167">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021171">return</span>&nbsp;<span class="ident" id="3021178">b</span><span class="op" id="3021179">.</span><span class="ident" id="3021180">buf</span><span class="op" id="3021183">[</span><span class="ident" id="3021184">i</span><span class="op" id="3021185">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021191">return</span>&nbsp;<span class="ident" id="3021198">b</span><span class="op" id="3021199">.</span><span class="ident" id="3021200">path</span><span class="op" id="3021204">[</span><span class="ident" id="3021205">i</span><span class="op" id="3021206">]</span><br>
<span class="lineno"></span><span class="op" id="3021208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="3021211">func</span>&nbsp;<span class="op" id="3021216">(</span><span class="ident" id="3021217">b</span>&nbsp;<span class="op" id="3021219">*</span><span class="ident" id="3021220">lazybuf</span><span class="op" id="3021227">)</span>&nbsp;<span class="builtinfunc" id="3021229">append</span><span class="op" id="3021235">(</span><span class="ident" id="3021236">c</span>&nbsp;<span class="builtintype" id="3021238">byte</span><span class="op" id="3021242">)</span>&nbsp;<span class="op" id="3021244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021247">if</span>&nbsp;<span class="ident" id="3021250">b</span><span class="op" id="3021251">.</span><span class="ident" id="3021252">buf</span>&nbsp;<span class="op" id="3021256">==</span>&nbsp;<span class="ident" id="3021259">nil</span>&nbsp;<span class="op" id="3021263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021267">if</span>&nbsp;<span class="ident" id="3021270">b</span><span class="op" id="3021271">.</span><span class="ident" id="3021272">w</span>&nbsp;<span class="op" id="3021274">&lt;</span>&nbsp;<span class="builtinfunc" id="3021276">len</span><span class="op" id="3021279">(</span><span class="ident" id="3021280">b</span><span class="op" id="3021281">.</span><span class="ident" id="3021282">path</span><span class="op" id="3021286">)</span>&nbsp;<span class="op" id="3021288">&amp;&amp;</span>&nbsp;<span class="ident" id="3021291">b</span><span class="op" id="3021292">.</span><span class="ident" id="3021293">path</span><span class="op" id="3021297">[</span><span class="ident" id="3021298">b</span><span class="op" id="3021299">.</span><span class="ident" id="3021300">w</span><span class="op" id="3021301">]</span>&nbsp;<span class="op" id="3021303">==</span>&nbsp;<span class="ident" id="3021306">c</span>&nbsp;<span class="op" id="3021308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021313">b</span><span class="op" id="3021314">.</span><span class="ident" id="3021315">w</span><span class="op" id="3021316">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021322">return</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021335">b</span><span class="op" id="3021336">.</span><span class="ident" id="3021337">buf</span>&nbsp;<span class="op" id="3021341">=</span>&nbsp;<span class="builtinfunc" id="3021343">make</span><span class="op" id="3021347">(</span><span class="op" id="3021348">[</span><span class="op" id="3021349">]</span><span class="builtintype" id="3021350">byte</span><span class="op" id="3021354">,</span>&nbsp;<span class="builtinfunc" id="3021356">len</span><span class="op" id="3021359">(</span><span class="ident" id="3021360">b</span><span class="op" id="3021361">.</span><span class="ident" id="3021362">path</span><span class="op" id="3021366">)</span><span class="op" id="3021367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3021371">copy</span><span class="op" id="3021375">(</span><span class="ident" id="3021376">b</span><span class="op" id="3021377">.</span><span class="ident" id="3021378">buf</span><span class="op" id="3021381">,</span>&nbsp;<span class="ident" id="3021383">b</span><span class="op" id="3021384">.</span><span class="ident" id="3021385">path</span><span class="op" id="3021389">[</span><span class="op" id="3021390">:</span><span class="ident" id="3021391">b</span><span class="op" id="3021392">.</span><span class="ident" id="3021393">w</span><span class="op" id="3021394">]</span><span class="op" id="3021395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021401">b</span><span class="op" id="3021402">.</span><span class="ident" id="3021403">buf</span><span class="op" id="3021406">[</span><span class="ident" id="3021407">b</span><span class="op" id="3021408">.</span><span class="ident" id="3021409">w</span><span class="op" id="3021410">]</span>&nbsp;<span class="op" id="3021412">=</span>&nbsp;<span class="ident" id="3021414">c</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021417">b</span><span class="op" id="3021418">.</span><span class="ident" id="3021419">w</span><span class="op" id="3021420">++</span><br>
<span class="lineno"></span><span class="op" id="3021423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3021426">func</span>&nbsp;<span class="op" id="3021431">(</span><span class="ident" id="3021432">b</span>&nbsp;<span class="op" id="3021434">*</span><span class="ident" id="3021435">lazybuf</span><span class="op" id="3021442">)</span>&nbsp;<span class="builtintype" id="3021444">string</span><span class="op" id="3021450">(</span><span class="op" id="3021451">)</span>&nbsp;<span class="builtintype" id="3021453">string</span>&nbsp;<span class="op" id="3021460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021463">if</span>&nbsp;<span class="ident" id="3021466">b</span><span class="op" id="3021467">.</span><span class="ident" id="3021468">buf</span>&nbsp;<span class="op" id="3021472">==</span>&nbsp;<span class="ident" id="3021475">nil</span>&nbsp;<span class="op" id="3021479">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021483">return</span>&nbsp;<span class="ident" id="3021490">b</span><span class="op" id="3021491">.</span><span class="ident" id="3021492">volAndPath</span><span class="op" id="3021502">[</span><span class="op" id="3021503">:</span><span class="ident" id="3021504">b</span><span class="op" id="3021505">.</span><span class="ident" id="3021506">volLen</span><span class="op" id="3021512">+</span><span class="ident" id="3021513">b</span><span class="op" id="3021514">.</span><span class="ident" id="3021515">w</span><span class="op" id="3021516">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021522">return</span>&nbsp;<span class="ident" id="3021529">b</span><span class="op" id="3021530">.</span><span class="ident" id="3021531">volAndPath</span><span class="op" id="3021541">[</span><span class="op" id="3021542">:</span><span class="ident" id="3021543">b</span><span class="op" id="3021544">.</span><span class="ident" id="3021545">volLen</span><span class="op" id="3021551">]</span>&nbsp;<span class="op" id="3021553">+</span>&nbsp;<span class="builtintype" id="3021555">string</span><span class="op" id="3021561">(</span><span class="ident" id="3021562">b</span><span class="op" id="3021563">.</span><span class="ident" id="3021564">buf</span><span class="op" id="3021567">[</span><span class="op" id="3021568">:</span><span class="ident" id="3021569">b</span><span class="op" id="3021570">.</span><span class="ident" id="3021571">w</span><span class="op" id="3021572">]</span><span class="op" id="3021573">)</span><br>
<span class="lineno"></span><span class="op" id="3021575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3021578">const</span>&nbsp;<span class="op" id="3021584">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021587">Separator</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3021601">=</span>&nbsp;<span class="ident" id="3021603">os</span><span class="op" id="3021605">.</span><span class="ident" id="3021606">PathSeparator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021621">ListSeparator</span>&nbsp;<span class="op" id="3021635">=</span>&nbsp;<span class="ident" id="3021637">os</span><span class="op" id="3021639">.</span><span class="ident" id="3021640">PathListSeparator</span><br>
<span class="lineno"></span><span class="op" id="3021658">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3021661">//&nbsp;Clean&nbsp;returns&nbsp;the&nbsp;shortest&nbsp;path&nbsp;name&nbsp;equivalent&nbsp;to&nbsp;path</span><br>
<span class="lineno"></span><span class="comment" id="3021720">//&nbsp;by&nbsp;purely&nbsp;lexical&nbsp;processing.&nbsp;&nbsp;It&nbsp;applies&nbsp;the&nbsp;following&nbsp;rules</span><br>
<span class="lineno"></span><span class="comment" id="3021785">//&nbsp;iteratively&nbsp;until&nbsp;no&nbsp;further&nbsp;processing&nbsp;can&nbsp;be&nbsp;done:</span><br>
<span class="lineno"></span><span class="comment" id="3021841">//</span><br>
<span class="lineno"></span><span class="comment" id="3021844">//&nbsp;&nbsp;&nbsp;&nbsp1.&nbsp;Replace&nbsp;multiple&nbsp;Separator&nbsp;elements&nbsp;with&nbsp;a&nbsp;single&nbsp;one.</span><br>
<span class="lineno">65</span><span class="comment" id="3021905">//&nbsp;&nbsp;&nbsp;&nbsp2.&nbsp;Eliminate&nbsp;each&nbsp;.&nbsp;path&nbsp;name&nbsp;element&nbsp;(the&nbsp;current&nbsp;directory).</span><br>
<span class="lineno"></span><span class="comment" id="3021971">//&nbsp;&nbsp;&nbsp;&nbsp3.&nbsp;Eliminate&nbsp;each&nbsp;inner&nbsp;..&nbsp;path&nbsp;name&nbsp;element&nbsp;(the&nbsp;parent&nbsp;directory)</span><br>
<span class="lineno"></span><span class="comment" id="3022042">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;along&nbsp;with&nbsp;the&nbsp;non-..&nbsp;element&nbsp;that&nbsp;precedes&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3022096">//&nbsp;&nbsp;&nbsp;&nbsp4.&nbsp;Eliminate&nbsp;..&nbsp;elements&nbsp;that&nbsp;begin&nbsp;a&nbsp;rooted&nbsp;path:</span><br>
<span class="lineno"></span><span class="comment" id="3022150">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;that&nbsp;is,&nbsp;replace&nbsp;&#34;/..&#34;&nbsp;by&nbsp;&#34;/&#34;&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;a&nbsp;path,</span><br>
<span class="lineno">70</span><span class="comment" id="3022214">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;assuming&nbsp;Separator&nbsp;is&nbsp;&#39;/&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="3022247">//</span><br>
<span class="lineno"></span><span class="comment" id="3022250">//&nbsp;The&nbsp;returned&nbsp;path&nbsp;ends&nbsp;in&nbsp;a&nbsp;slash&nbsp;only&nbsp;if&nbsp;it&nbsp;represents&nbsp;a&nbsp;root&nbsp;directory,</span><br>
<span class="lineno"></span><span class="comment" id="3022327">//&nbsp;such&nbsp;as&nbsp;&#34;/&#34;&nbsp;on&nbsp;Unix&nbsp;or&nbsp;`C:\`&nbsp;on&nbsp;Windows.</span><br>
<span class="lineno"></span><span class="comment" id="3022371">//</span><br>
<span class="lineno">75</span><span class="comment" id="3022374">//&nbsp;If&nbsp;the&nbsp;result&nbsp;of&nbsp;this&nbsp;process&nbsp;is&nbsp;an&nbsp;empty&nbsp;string,&nbsp;Clean</span><br>
<span class="lineno"></span><span class="comment" id="3022433">//&nbsp;returns&nbsp;the&nbsp;string&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3022460">//</span><br>
<span class="lineno"></span><span class="comment" id="3022463">//&nbsp;See&nbsp;also&nbsp;Rob&nbsp;Pike,&nbsp;``Lexical&nbsp;File&nbsp;Names&nbsp;in&nbsp;Plan&nbsp;9&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3022519">//&nbsp;Getting&nbsp;Dot-Dot&nbsp;Right,&#39;&#39;</span><br>
<span class="lineno">80</span><span class="comment" id="3022547">//&nbsp;http://plan9.bell-labs.com/sys/doc/lexnames.html</span><br>
<span class="lineno"></span><span class="keyword" id="3022599">func</span>&nbsp;<span class="ident" id="3022604">Clean</span><span class="op" id="3022609">(</span><span class="ident" id="3022610">path</span>&nbsp;<span class="builtintype" id="3022615">string</span><span class="op" id="3022621">)</span>&nbsp;<span class="builtintype" id="3022623">string</span>&nbsp;<span class="op" id="3022630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022633">originalPath</span>&nbsp;<span class="op" id="3022646">:=</span>&nbsp;<span class="ident" id="3022649">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022655">volLen</span>&nbsp;<span class="op" id="3022662">:=</span>&nbsp;<span class="ident" id="3022665">volumeNameLen</span><span class="op" id="3022678">(</span><span class="ident" id="3022679">path</span><span class="op" id="3022683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022686">path</span>&nbsp;<span class="op" id="3022691">=</span>&nbsp;<span class="ident" id="3022693">path</span><span class="op" id="3022697">[</span><span class="ident" id="3022698">volLen</span><span class="op" id="3022704">:</span><span class="op" id="3022705">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022708">if</span>&nbsp;<span class="ident" id="3022711">path</span>&nbsp;<span class="op" id="3022716">==</span>&nbsp;<span class="string" id="3022719">&#34;&#34;</span>&nbsp;<span class="op" id="3022722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022726">if</span>&nbsp;<span class="ident" id="3022729">volLen</span>&nbsp;<span class="op" id="3022736">&gt;</span>&nbsp;<span class="num" id="3022738">1</span>&nbsp;<span class="op" id="3022740">&amp;&amp;</span>&nbsp;<span class="ident" id="3022743">originalPath</span><span class="op" id="3022755">[</span><span class="num" id="3022756">1</span><span class="op" id="3022757">]</span>&nbsp;<span class="op" id="3022759">!=</span>&nbsp;<span class="string" id="3022762">&#39;:&#39;</span>&nbsp;<span class="op" id="3022766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022771">//&nbsp;should&nbsp;be&nbsp;UNC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022791">return</span>&nbsp;<span class="ident" id="3022798">FromSlash</span><span class="op" id="3022807">(</span><span class="ident" id="3022808">originalPath</span><span class="op" id="3022820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022824">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022828">return</span>&nbsp;<span class="ident" id="3022835">originalPath</span>&nbsp;<span class="op" id="3022848">+</span>&nbsp;<span class="string" id="3022850">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022858">rooted</span>&nbsp;<span class="op" id="3022865">:=</span>&nbsp;<span class="ident" id="3022868">os</span><span class="op" id="3022870">.</span><span class="ident" id="3022871">IsPathSeparator</span><span class="op" id="3022886">(</span><span class="ident" id="3022887">path</span><span class="op" id="3022891">[</span><span class="num" id="3022892">0</span><span class="op" id="3022893">]</span><span class="op" id="3022894">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022898">//&nbsp;Invariants:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022914">//&nbsp;&nbsp;&nbsp;&nbspreading&nbsp;from&nbsp;path;&nbsp;r&nbsp;is&nbsp;index&nbsp;of&nbsp;next&nbsp;byte&nbsp;to&nbsp;process.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022973">//&nbsp;&nbsp;&nbsp;&nbspwriting&nbsp;to&nbsp;buf;&nbsp;w&nbsp;is&nbsp;index&nbsp;of&nbsp;next&nbsp;byte&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023027">//&nbsp;&nbsp;&nbsp;&nbspdotdot&nbsp;is&nbsp;index&nbsp;in&nbsp;buf&nbsp;where&nbsp;..&nbsp;must&nbsp;stop,&nbsp;either&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023089">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspit&nbsp;is&nbsp;the&nbsp;leading&nbsp;slash&nbsp;or&nbsp;it&nbsp;is&nbsp;a&nbsp;leading&nbsp;../../..&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023154">n</span>&nbsp;<span class="op" id="3023156">:=</span>&nbsp;<span class="builtinfunc" id="3023159">len</span><span class="op" id="3023162">(</span><span class="ident" id="3023163">path</span><span class="op" id="3023167">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023170">out</span>&nbsp;<span class="op" id="3023174">:=</span>&nbsp;<span class="ident" id="3023177">lazybuf</span><span class="op" id="3023184">{</span><span class="ident" id="3023185">path</span><span class="op" id="3023189">:</span>&nbsp;<span class="ident" id="3023191">path</span><span class="op" id="3023195">,</span>&nbsp;<span class="ident" id="3023197">volAndPath</span><span class="op" id="3023207">:</span>&nbsp;<span class="ident" id="3023209">originalPath</span><span class="op" id="3023221">,</span>&nbsp;<span class="ident" id="3023223">volLen</span><span class="op" id="3023229">:</span>&nbsp;<span class="ident" id="3023231">volLen</span><span class="op" id="3023237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023240">r</span><span class="op" id="3023241">,</span>&nbsp;<span class="ident" id="3023243">dotdot</span>&nbsp;<span class="op" id="3023250">:=</span>&nbsp;<span class="num" id="3023253">0</span><span class="op" id="3023254">,</span>&nbsp;<span class="num" id="3023256">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023259">if</span>&nbsp;<span class="ident" id="3023262">rooted</span>&nbsp;<span class="op" id="3023269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023273">out</span><span class="op" id="3023276">.</span><span class="builtinfunc" id="3023277">append</span><span class="op" id="3023283">(</span><span class="ident" id="3023284">Separator</span><span class="op" id="3023293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023297">r</span><span class="op" id="3023298">,</span>&nbsp;<span class="ident" id="3023300">dotdot</span>&nbsp;<span class="op" id="3023307">=</span>&nbsp;<span class="num" id="3023309">1</span><span class="op" id="3023310">,</span>&nbsp;<span class="num" id="3023312">1</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3023315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023319">for</span>&nbsp;<span class="ident" id="3023323">r</span>&nbsp;<span class="op" id="3023325">&lt;</span>&nbsp;<span class="ident" id="3023327">n</span>&nbsp;<span class="op" id="3023329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023333">switch</span>&nbsp;<span class="op" id="3023340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023344">case</span>&nbsp;<span class="ident" id="3023349">os</span><span class="op" id="3023351">.</span><span class="ident" id="3023352">IsPathSeparator</span><span class="op" id="3023367">(</span><span class="ident" id="3023368">path</span><span class="op" id="3023372">[</span><span class="ident" id="3023373">r</span><span class="op" id="3023374">]</span><span class="op" id="3023375">)</span><span class="op" id="3023376">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023381">//&nbsp;empty&nbsp;path&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023406">r</span><span class="op" id="3023407">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023412">case</span>&nbsp;<span class="ident" id="3023417">path</span><span class="op" id="3023421">[</span><span class="ident" id="3023422">r</span><span class="op" id="3023423">]</span>&nbsp;<span class="op" id="3023425">==</span>&nbsp;<span class="string" id="3023428">&#39;.&#39;</span>&nbsp;<span class="op" id="3023432">&amp;&amp;</span>&nbsp;<span class="op" id="3023435">(</span><span class="ident" id="3023436">r</span><span class="op" id="3023437">+</span><span class="num" id="3023438">1</span>&nbsp;<span class="op" id="3023440">==</span>&nbsp;<span class="ident" id="3023443">n</span>&nbsp;<span class="op" id="3023445">||</span>&nbsp;<span class="ident" id="3023448">os</span><span class="op" id="3023450">.</span><span class="ident" id="3023451">IsPathSeparator</span><span class="op" id="3023466">(</span><span class="ident" id="3023467">path</span><span class="op" id="3023471">[</span><span class="ident" id="3023472">r</span><span class="op" id="3023473">+</span><span class="num" id="3023474">1</span><span class="op" id="3023475">]</span><span class="op" id="3023476">)</span><span class="op" id="3023477">)</span><span class="op" id="3023478">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023483">//&nbsp;.&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023499">r</span><span class="op" id="3023500">++</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023505">case</span>&nbsp;<span class="ident" id="3023510">path</span><span class="op" id="3023514">[</span><span class="ident" id="3023515">r</span><span class="op" id="3023516">]</span>&nbsp;<span class="op" id="3023518">==</span>&nbsp;<span class="string" id="3023521">&#39;.&#39;</span>&nbsp;<span class="op" id="3023525">&amp;&amp;</span>&nbsp;<span class="ident" id="3023528">path</span><span class="op" id="3023532">[</span><span class="ident" id="3023533">r</span><span class="op" id="3023534">+</span><span class="num" id="3023535">1</span><span class="op" id="3023536">]</span>&nbsp;<span class="op" id="3023538">==</span>&nbsp;<span class="string" id="3023541">&#39;.&#39;</span>&nbsp;<span class="op" id="3023545">&amp;&amp;</span>&nbsp;<span class="op" id="3023548">(</span><span class="ident" id="3023549">r</span><span class="op" id="3023550">+</span><span class="num" id="3023551">2</span>&nbsp;<span class="op" id="3023553">==</span>&nbsp;<span class="ident" id="3023556">n</span>&nbsp;<span class="op" id="3023558">||</span>&nbsp;<span class="ident" id="3023561">os</span><span class="op" id="3023563">.</span><span class="ident" id="3023564">IsPathSeparator</span><span class="op" id="3023579">(</span><span class="ident" id="3023580">path</span><span class="op" id="3023584">[</span><span class="ident" id="3023585">r</span><span class="op" id="3023586">+</span><span class="num" id="3023587">2</span><span class="op" id="3023588">]</span><span class="op" id="3023589">)</span><span class="op" id="3023590">)</span><span class="op" id="3023591">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023596">//&nbsp;..&nbsp;element:&nbsp;remove&nbsp;to&nbsp;last&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023639">r</span>&nbsp;<span class="op" id="3023641">+=</span>&nbsp;<span class="num" id="3023644">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023649">switch</span>&nbsp;<span class="op" id="3023656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023661">case</span>&nbsp;<span class="ident" id="3023666">out</span><span class="op" id="3023669">.</span><span class="ident" id="3023670">w</span>&nbsp;<span class="op" id="3023672">&gt;</span>&nbsp;<span class="ident" id="3023674">dotdot</span><span class="op" id="3023680">:</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023686">//&nbsp;can&nbsp;backtrack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023707">out</span><span class="op" id="3023710">.</span><span class="ident" id="3023711">w</span><span class="op" id="3023712">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023719">for</span>&nbsp;<span class="ident" id="3023723">out</span><span class="op" id="3023726">.</span><span class="ident" id="3023727">w</span>&nbsp;<span class="op" id="3023729">&gt;</span>&nbsp;<span class="ident" id="3023731">dotdot</span>&nbsp;<span class="op" id="3023738">&amp;&amp;</span>&nbsp;<span class="op" id="3023741">!</span><span class="ident" id="3023742">os</span><span class="op" id="3023744">.</span><span class="ident" id="3023745">IsPathSeparator</span><span class="op" id="3023760">(</span><span class="ident" id="3023761">out</span><span class="op" id="3023764">.</span><span class="ident" id="3023765">index</span><span class="op" id="3023770">(</span><span class="ident" id="3023771">out</span><span class="op" id="3023774">.</span><span class="ident" id="3023775">w</span><span class="op" id="3023776">)</span><span class="op" id="3023777">)</span>&nbsp;<span class="op" id="3023779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023786">out</span><span class="op" id="3023789">.</span><span class="ident" id="3023790">w</span><span class="op" id="3023791">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3023798">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023803">case</span>&nbsp;<span class="op" id="3023808">!</span><span class="ident" id="3023809">rooted</span><span class="op" id="3023815">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023821">//&nbsp;cannot&nbsp;backtrack,&nbsp;but&nbsp;not&nbsp;rooted,&nbsp;so&nbsp;append&nbsp;..&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023884">if</span>&nbsp;<span class="ident" id="3023887">out</span><span class="op" id="3023890">.</span><span class="ident" id="3023891">w</span>&nbsp;<span class="op" id="3023893">&gt;</span>&nbsp;<span class="num" id="3023895">0</span>&nbsp;<span class="op" id="3023897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023904">out</span><span class="op" id="3023907">.</span><span class="builtinfunc" id="3023908">append</span><span class="op" id="3023914">(</span><span class="ident" id="3023915">Separator</span><span class="op" id="3023924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3023930">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023936">out</span><span class="op" id="3023939">.</span><span class="builtinfunc" id="3023940">append</span><span class="op" id="3023946">(</span><span class="string" id="3023947">&#39;.&#39;</span><span class="op" id="3023950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023956">out</span><span class="op" id="3023959">.</span><span class="builtinfunc" id="3023960">append</span><span class="op" id="3023966">(</span><span class="string" id="3023967">&#39;.&#39;</span><span class="op" id="3023970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023976">dotdot</span>&nbsp;<span class="op" id="3023983">=</span>&nbsp;<span class="ident" id="3023985">out</span><span class="op" id="3023988">.</span><span class="ident" id="3023989">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3023994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023998">default</span><span class="op" id="3024005">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024010">//&nbsp;real&nbsp;path&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024035">//&nbsp;add&nbsp;slash&nbsp;if&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024061">if</span>&nbsp;<span class="ident" id="3024064">rooted</span>&nbsp;<span class="op" id="3024071">&amp;&amp;</span>&nbsp;<span class="ident" id="3024074">out</span><span class="op" id="3024077">.</span><span class="ident" id="3024078">w</span>&nbsp;<span class="op" id="3024080">!=</span>&nbsp;<span class="num" id="3024083">1</span>&nbsp;<span class="op" id="3024085">||</span>&nbsp;<span class="op" id="3024088">!</span><span class="ident" id="3024089">rooted</span>&nbsp;<span class="op" id="3024096">&amp;&amp;</span>&nbsp;<span class="ident" id="3024099">out</span><span class="op" id="3024102">.</span><span class="ident" id="3024103">w</span>&nbsp;<span class="op" id="3024105">!=</span>&nbsp;<span class="num" id="3024108">0</span>&nbsp;<span class="op" id="3024110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024116">out</span><span class="op" id="3024119">.</span><span class="builtinfunc" id="3024120">append</span><span class="op" id="3024126">(</span><span class="ident" id="3024127">Separator</span><span class="op" id="3024136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3024141">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024146">//&nbsp;copy&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024165">for</span>&nbsp;<span class="op" id="3024169">;</span>&nbsp;<span class="ident" id="3024171">r</span>&nbsp;<span class="op" id="3024173">&lt;</span>&nbsp;<span class="ident" id="3024175">n</span>&nbsp;<span class="op" id="3024177">&amp;&amp;</span>&nbsp;<span class="op" id="3024180">!</span><span class="ident" id="3024181">os</span><span class="op" id="3024183">.</span><span class="ident" id="3024184">IsPathSeparator</span><span class="op" id="3024199">(</span><span class="ident" id="3024200">path</span><span class="op" id="3024204">[</span><span class="ident" id="3024205">r</span><span class="op" id="3024206">]</span><span class="op" id="3024207">)</span><span class="op" id="3024208">;</span>&nbsp;<span class="ident" id="3024210">r</span><span class="op" id="3024211">++</span>&nbsp;<span class="op" id="3024214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024220">out</span><span class="op" id="3024223">.</span><span class="builtinfunc" id="3024224">append</span><span class="op" id="3024230">(</span><span class="ident" id="3024231">path</span><span class="op" id="3024235">[</span><span class="ident" id="3024236">r</span><span class="op" id="3024237">]</span><span class="op" id="3024238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3024243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3024247">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3024250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024254">//&nbsp;Turn&nbsp;empty&nbsp;string&nbsp;into&nbsp;&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024285">if</span>&nbsp;<span class="ident" id="3024288">out</span><span class="op" id="3024291">.</span><span class="ident" id="3024292">w</span>&nbsp;<span class="op" id="3024294">==</span>&nbsp;<span class="num" id="3024297">0</span>&nbsp;<span class="op" id="3024299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024303">out</span><span class="op" id="3024306">.</span><span class="builtinfunc" id="3024307">append</span><span class="op" id="3024313">(</span><span class="string" id="3024314">&#39;.&#39;</span><span class="op" id="3024317">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3024320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024324">return</span>&nbsp;<span class="ident" id="3024331">FromSlash</span><span class="op" id="3024340">(</span><span class="ident" id="3024341">out</span><span class="op" id="3024344">.</span><span class="builtintype" id="3024345">string</span><span class="op" id="3024351">(</span><span class="op" id="3024352">)</span><span class="op" id="3024353">)</span><br>
<span class="lineno"></span><span class="op" id="3024355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="3024358">//&nbsp;ToSlash&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;replacing&nbsp;each&nbsp;separator&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="3024426">//&nbsp;in&nbsp;path&nbsp;with&nbsp;a&nbsp;slash&nbsp;(&#39;/&#39;)&nbsp;character.&nbsp;Multiple&nbsp;separators&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3024491">//&nbsp;replaced&nbsp;by&nbsp;multiple&nbsp;slashes.</span><br>
<span class="lineno"></span><span class="keyword" id="3024524">func</span>&nbsp;<span class="ident" id="3024529">ToSlash</span><span class="op" id="3024536">(</span><span class="ident" id="3024537">path</span>&nbsp;<span class="builtintype" id="3024542">string</span><span class="op" id="3024548">)</span>&nbsp;<span class="builtintype" id="3024550">string</span>&nbsp;<span class="op" id="3024557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024560">if</span>&nbsp;<span class="ident" id="3024563">Separator</span>&nbsp;<span class="op" id="3024573">==</span>&nbsp;<span class="string" id="3024576">&#39;/&#39;</span>&nbsp;<span class="op" id="3024580">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024584">return</span>&nbsp;<span class="ident" id="3024591">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3024597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024600">return</span>&nbsp;<span class="ident" id="3024607">strings</span><span class="op" id="3024614">.</span><span class="ident" id="3024615">Replace</span><span class="op" id="3024622">(</span><span class="ident" id="3024623">path</span><span class="op" id="3024627">,</span>&nbsp;<span class="builtintype" id="3024629">string</span><span class="op" id="3024635">(</span><span class="ident" id="3024636">Separator</span><span class="op" id="3024645">)</span><span class="op" id="3024646">,</span>&nbsp;<span class="string" id="3024648">&#34;/&#34;</span><span class="op" id="3024651">,</span>&nbsp;<span class="op" id="3024653">-</span><span class="num" id="3024654">1</span><span class="op" id="3024655">)</span><br>
<span class="lineno"></span><span class="op" id="3024657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3024660">//&nbsp;FromSlash&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;replacing&nbsp;each&nbsp;slash&nbsp;(&#39;/&#39;)&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="3024732">//&nbsp;in&nbsp;path&nbsp;with&nbsp;a&nbsp;separator&nbsp;character.&nbsp;Multiple&nbsp;slashes&nbsp;are&nbsp;replaced</span><br>
<span class="lineno"></span><span class="comment" id="3024801">//&nbsp;by&nbsp;multiple&nbsp;separators.</span><br>
<span class="lineno"></span><span class="keyword" id="3024828">func</span>&nbsp;<span class="ident" id="3024833">FromSlash</span><span class="op" id="3024842">(</span><span class="ident" id="3024843">path</span>&nbsp;<span class="builtintype" id="3024848">string</span><span class="op" id="3024854">)</span>&nbsp;<span class="builtintype" id="3024856">string</span>&nbsp;<span class="op" id="3024863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024866">if</span>&nbsp;<span class="ident" id="3024869">Separator</span>&nbsp;<span class="op" id="3024879">==</span>&nbsp;<span class="string" id="3024882">&#39;/&#39;</span>&nbsp;<span class="op" id="3024886">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024890">return</span>&nbsp;<span class="ident" id="3024897">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3024903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024906">return</span>&nbsp;<span class="ident" id="3024913">strings</span><span class="op" id="3024920">.</span><span class="ident" id="3024921">Replace</span><span class="op" id="3024928">(</span><span class="ident" id="3024929">path</span><span class="op" id="3024933">,</span>&nbsp;<span class="string" id="3024935">&#34;/&#34;</span><span class="op" id="3024938">,</span>&nbsp;<span class="builtintype" id="3024940">string</span><span class="op" id="3024946">(</span><span class="ident" id="3024947">Separator</span><span class="op" id="3024956">)</span><span class="op" id="3024957">,</span>&nbsp;<span class="op" id="3024959">-</span><span class="num" id="3024960">1</span><span class="op" id="3024961">)</span><br>
<span class="lineno"></span><span class="op" id="3024963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="3024966">//&nbsp;SplitList&nbsp;splits&nbsp;a&nbsp;list&nbsp;of&nbsp;paths&nbsp;joined&nbsp;by&nbsp;the&nbsp;OS-specific&nbsp;ListSeparator,</span><br>
<span class="lineno"></span><span class="comment" id="3025043">//&nbsp;usually&nbsp;found&nbsp;in&nbsp;PATH&nbsp;or&nbsp;GOPATH&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><span class="comment" id="3025101">//&nbsp;Unlike&nbsp;strings.Split,&nbsp;SplitList&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;when&nbsp;passed&nbsp;an&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3025188">func</span>&nbsp;<span class="ident" id="3025193">SplitList</span><span class="op" id="3025202">(</span><span class="ident" id="3025203">path</span>&nbsp;<span class="builtintype" id="3025208">string</span><span class="op" id="3025214">)</span>&nbsp;<span class="op" id="3025216">[</span><span class="op" id="3025217">]</span><span class="builtintype" id="3025218">string</span>&nbsp;<span class="op" id="3025225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025228">return</span>&nbsp;<span class="ident" id="3025235">splitList</span><span class="op" id="3025244">(</span><span class="ident" id="3025245">path</span><span class="op" id="3025249">)</span><br>
<span class="lineno">180</span><span class="op" id="3025251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3025254">//&nbsp;Split&nbsp;splits&nbsp;path&nbsp;immediately&nbsp;following&nbsp;the&nbsp;final&nbsp;Separator,</span><br>
<span class="lineno"></span><span class="comment" id="3025318">//&nbsp;separating&nbsp;it&nbsp;into&nbsp;a&nbsp;directory&nbsp;and&nbsp;file&nbsp;name&nbsp;component.</span><br>
<span class="lineno"></span><span class="comment" id="3025377">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;Separator&nbsp;in&nbsp;path,&nbsp;Split&nbsp;returns&nbsp;an&nbsp;empty&nbsp;dir</span><br>
<span class="lineno">185</span><span class="comment" id="3025441">//&nbsp;and&nbsp;file&nbsp;set&nbsp;to&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3025466">//&nbsp;The&nbsp;returned&nbsp;values&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;path&nbsp;=&nbsp;dir+file.</span><br>
<span class="lineno"></span><span class="keyword" id="3025529">func</span>&nbsp;<span class="ident" id="3025534">Split</span><span class="op" id="3025539">(</span><span class="ident" id="3025540">path</span>&nbsp;<span class="builtintype" id="3025545">string</span><span class="op" id="3025551">)</span>&nbsp;<span class="op" id="3025553">(</span><span class="ident" id="3025554">dir</span><span class="op" id="3025557">,</span>&nbsp;<span class="ident" id="3025559">file</span>&nbsp;<span class="builtintype" id="3025564">string</span><span class="op" id="3025570">)</span>&nbsp;<span class="op" id="3025572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025575">vol</span>&nbsp;<span class="op" id="3025579">:=</span>&nbsp;<span class="ident" id="3025582">VolumeName</span><span class="op" id="3025592">(</span><span class="ident" id="3025593">path</span><span class="op" id="3025597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025600">i</span>&nbsp;<span class="op" id="3025602">:=</span>&nbsp;<span class="builtinfunc" id="3025605">len</span><span class="op" id="3025608">(</span><span class="ident" id="3025609">path</span><span class="op" id="3025613">)</span>&nbsp;<span class="op" id="3025615">-</span>&nbsp;<span class="num" id="3025617">1</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025620">for</span>&nbsp;<span class="ident" id="3025624">i</span>&nbsp;<span class="op" id="3025626">&gt;=</span>&nbsp;<span class="builtinfunc" id="3025629">len</span><span class="op" id="3025632">(</span><span class="ident" id="3025633">vol</span><span class="op" id="3025636">)</span>&nbsp;<span class="op" id="3025638">&amp;&amp;</span>&nbsp;<span class="op" id="3025641">!</span><span class="ident" id="3025642">os</span><span class="op" id="3025644">.</span><span class="ident" id="3025645">IsPathSeparator</span><span class="op" id="3025660">(</span><span class="ident" id="3025661">path</span><span class="op" id="3025665">[</span><span class="ident" id="3025666">i</span><span class="op" id="3025667">]</span><span class="op" id="3025668">)</span>&nbsp;<span class="op" id="3025670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025674">i</span><span class="op" id="3025675">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3025679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025682">return</span>&nbsp;<span class="ident" id="3025689">path</span><span class="op" id="3025693">[</span><span class="op" id="3025694">:</span><span class="ident" id="3025695">i</span><span class="op" id="3025696">+</span><span class="num" id="3025697">1</span><span class="op" id="3025698">]</span><span class="op" id="3025699">,</span>&nbsp;<span class="ident" id="3025701">path</span><span class="op" id="3025705">[</span><span class="ident" id="3025706">i</span><span class="op" id="3025707">+</span><span class="num" id="3025708">1</span><span class="op" id="3025709">:</span><span class="op" id="3025710">]</span><br>
<span class="lineno"></span><span class="op" id="3025712">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="3025715">//&nbsp;Join&nbsp;joins&nbsp;any&nbsp;number&nbsp;of&nbsp;path&nbsp;elements&nbsp;into&nbsp;a&nbsp;single&nbsp;path,&nbsp;adding</span><br>
<span class="lineno"></span><span class="comment" id="3025784">//&nbsp;a&nbsp;Separator&nbsp;if&nbsp;necessary.&nbsp;The&nbsp;result&nbsp;is&nbsp;Cleaned,&nbsp;in&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="3025850">//&nbsp;all&nbsp;empty&nbsp;strings&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="3025884">func</span>&nbsp;<span class="ident" id="3025889">Join</span><span class="op" id="3025893">(</span><span class="ident" id="3025894">elem</span>&nbsp;<span class="op" id="3025899">...</span><span class="builtintype" id="3025902">string</span><span class="op" id="3025908">)</span>&nbsp;<span class="builtintype" id="3025910">string</span>&nbsp;<span class="op" id="3025917">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025920">for</span>&nbsp;<span class="ident" id="3025924">i</span><span class="op" id="3025925">,</span>&nbsp;<span class="ident" id="3025927">e</span>&nbsp;<span class="op" id="3025929">:=</span>&nbsp;<span class="keyword" id="3025932">range</span>&nbsp;<span class="ident" id="3025938">elem</span>&nbsp;<span class="op" id="3025943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025947">if</span>&nbsp;<span class="ident" id="3025950">e</span>&nbsp;<span class="op" id="3025952">!=</span>&nbsp;<span class="string" id="3025955">&#34;&#34;</span>&nbsp;<span class="op" id="3025958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025963">return</span>&nbsp;<span class="ident" id="3025970">Clean</span><span class="op" id="3025975">(</span><span class="ident" id="3025976">strings</span><span class="op" id="3025983">.</span><span class="ident" id="3025984">Join</span><span class="op" id="3025988">(</span><span class="ident" id="3025989">elem</span><span class="op" id="3025993">[</span><span class="ident" id="3025994">i</span><span class="op" id="3025995">:</span><span class="op" id="3025996">]</span><span class="op" id="3025997">,</span>&nbsp;<span class="builtintype" id="3025999">string</span><span class="op" id="3026005">(</span><span class="ident" id="3026006">Separator</span><span class="op" id="3026015">)</span><span class="op" id="3026016">)</span><span class="op" id="3026017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3026021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3026024">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026027">return</span>&nbsp;<span class="string" id="3026034">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3026037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3026040">//&nbsp;Ext&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;extension&nbsp;used&nbsp;by&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3026093">//&nbsp;The&nbsp;extension&nbsp;is&nbsp;the&nbsp;suffix&nbsp;beginning&nbsp;at&nbsp;the&nbsp;final&nbsp;dot</span><br>
<span class="lineno">210</span><span class="comment" id="3026151">//&nbsp;in&nbsp;the&nbsp;final&nbsp;element&nbsp;of&nbsp;path;&nbsp;it&nbsp;is&nbsp;empty&nbsp;if&nbsp;there&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3026208">//&nbsp;no&nbsp;dot.</span><br>
<span class="lineno"></span><span class="keyword" id="3026219">func</span>&nbsp;<span class="ident" id="3026224">Ext</span><span class="op" id="3026227">(</span><span class="ident" id="3026228">path</span>&nbsp;<span class="builtintype" id="3026233">string</span><span class="op" id="3026239">)</span>&nbsp;<span class="builtintype" id="3026241">string</span>&nbsp;<span class="op" id="3026248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026251">for</span>&nbsp;<span class="ident" id="3026255">i</span>&nbsp;<span class="op" id="3026257">:=</span>&nbsp;<span class="builtinfunc" id="3026260">len</span><span class="op" id="3026263">(</span><span class="ident" id="3026264">path</span><span class="op" id="3026268">)</span>&nbsp;<span class="op" id="3026270">-</span>&nbsp;<span class="num" id="3026272">1</span><span class="op" id="3026273">;</span>&nbsp;<span class="ident" id="3026275">i</span>&nbsp;<span class="op" id="3026277">&gt;=</span>&nbsp;<span class="num" id="3026280">0</span>&nbsp;<span class="op" id="3026282">&amp;&amp;</span>&nbsp;<span class="op" id="3026285">!</span><span class="ident" id="3026286">os</span><span class="op" id="3026288">.</span><span class="ident" id="3026289">IsPathSeparator</span><span class="op" id="3026304">(</span><span class="ident" id="3026305">path</span><span class="op" id="3026309">[</span><span class="ident" id="3026310">i</span><span class="op" id="3026311">]</span><span class="op" id="3026312">)</span><span class="op" id="3026313">;</span>&nbsp;<span class="ident" id="3026315">i</span><span class="op" id="3026316">--</span>&nbsp;<span class="op" id="3026319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026323">if</span>&nbsp;<span class="ident" id="3026326">path</span><span class="op" id="3026330">[</span><span class="ident" id="3026331">i</span><span class="op" id="3026332">]</span>&nbsp;<span class="op" id="3026334">==</span>&nbsp;<span class="string" id="3026337">&#39;.&#39;</span>&nbsp;<span class="op" id="3026341">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026346">return</span>&nbsp;<span class="ident" id="3026353">path</span><span class="op" id="3026357">[</span><span class="ident" id="3026358">i</span><span class="op" id="3026359">:</span><span class="op" id="3026360">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3026364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3026367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026370">return</span>&nbsp;<span class="string" id="3026377">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3026380">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3026383">//&nbsp;EvalSymlinks&nbsp;returns&nbsp;the&nbsp;path&nbsp;name&nbsp;after&nbsp;the&nbsp;evaluation&nbsp;of&nbsp;any&nbsp;symbolic</span><br>
<span class="lineno"></span><span class="comment" id="3026458">//&nbsp;links.</span><br>
<span class="lineno"></span><span class="comment" id="3026468">//&nbsp;If&nbsp;path&nbsp;is&nbsp;relative&nbsp;the&nbsp;result&nbsp;will&nbsp;be&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;directory,</span><br>
<span class="lineno"></span><span class="comment" id="3026545">//&nbsp;unless&nbsp;one&nbsp;of&nbsp;the&nbsp;components&nbsp;is&nbsp;an&nbsp;absolute&nbsp;symbolic&nbsp;link.</span><br>
<span class="lineno">225</span><span class="keyword" id="3026607">func</span>&nbsp;<span class="ident" id="3026612">EvalSymlinks</span><span class="op" id="3026624">(</span><span class="ident" id="3026625">path</span>&nbsp;<span class="builtintype" id="3026630">string</span><span class="op" id="3026636">)</span>&nbsp;<span class="op" id="3026638">(</span><span class="builtintype" id="3026639">string</span><span class="op" id="3026645">,</span>&nbsp;<span class="builtintype" id="3026647">error</span><span class="op" id="3026652">)</span>&nbsp;<span class="op" id="3026654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026657">return</span>&nbsp;<span class="ident" id="3026664">evalSymlinks</span><span class="op" id="3026676">(</span><span class="ident" id="3026677">path</span><span class="op" id="3026681">)</span><br>
<span class="lineno"></span><span class="op" id="3026683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3026686">//&nbsp;Abs&nbsp;returns&nbsp;an&nbsp;absolute&nbsp;representation&nbsp;of&nbsp;path.</span><br>
<span class="lineno">230</span><span class="comment" id="3026737">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;not&nbsp;absolute&nbsp;it&nbsp;will&nbsp;be&nbsp;joined&nbsp;with&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="3026803">//&nbsp;working&nbsp;directory&nbsp;to&nbsp;turn&nbsp;it&nbsp;into&nbsp;an&nbsp;absolute&nbsp;path.&nbsp;&nbsp;The&nbsp;absolute</span><br>
<span class="lineno"></span><span class="comment" id="3026872">//&nbsp;path&nbsp;name&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span><span class="keyword" id="3026934">func</span>&nbsp;<span class="ident" id="3026939">Abs</span><span class="op" id="3026942">(</span><span class="ident" id="3026943">path</span>&nbsp;<span class="builtintype" id="3026948">string</span><span class="op" id="3026954">)</span>&nbsp;<span class="op" id="3026956">(</span><span class="builtintype" id="3026957">string</span><span class="op" id="3026963">,</span>&nbsp;<span class="builtintype" id="3026965">error</span><span class="op" id="3026970">)</span>&nbsp;<span class="op" id="3026972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3026975">return</span>&nbsp;<span class="ident" id="3026982">abs</span><span class="op" id="3026985">(</span><span class="ident" id="3026986">path</span><span class="op" id="3026990">)</span><br>
<span class="lineno">235</span><span class="op" id="3026992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3026995">func</span>&nbsp;<span class="ident" id="3027000">unixAbs</span><span class="op" id="3027007">(</span><span class="ident" id="3027008">path</span>&nbsp;<span class="builtintype" id="3027013">string</span><span class="op" id="3027019">)</span>&nbsp;<span class="op" id="3027021">(</span><span class="builtintype" id="3027022">string</span><span class="op" id="3027028">,</span>&nbsp;<span class="builtintype" id="3027030">error</span><span class="op" id="3027035">)</span>&nbsp;<span class="op" id="3027037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027040">if</span>&nbsp;<span class="ident" id="3027043">IsAbs</span><span class="op" id="3027048">(</span><span class="ident" id="3027049">path</span><span class="op" id="3027053">)</span>&nbsp;<span class="op" id="3027055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027059">return</span>&nbsp;<span class="ident" id="3027066">Clean</span><span class="op" id="3027071">(</span><span class="ident" id="3027072">path</span><span class="op" id="3027076">)</span><span class="op" id="3027077">,</span>&nbsp;<span class="ident" id="3027079">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3027084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027087">wd</span><span class="op" id="3027089">,</span>&nbsp;<span class="ident" id="3027091">err</span>&nbsp;<span class="op" id="3027095">:=</span>&nbsp;<span class="ident" id="3027098">os</span><span class="op" id="3027100">.</span><span class="ident" id="3027101">Getwd</span><span class="op" id="3027106">(</span><span class="op" id="3027107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027110">if</span>&nbsp;<span class="ident" id="3027113">err</span>&nbsp;<span class="op" id="3027117">!=</span>&nbsp;<span class="ident" id="3027120">nil</span>&nbsp;<span class="op" id="3027124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027128">return</span>&nbsp;<span class="string" id="3027135">&#34;&#34;</span><span class="op" id="3027137">,</span>&nbsp;<span class="ident" id="3027139">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3027144">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027147">return</span>&nbsp;<span class="ident" id="3027154">Join</span><span class="op" id="3027158">(</span><span class="ident" id="3027159">wd</span><span class="op" id="3027161">,</span>&nbsp;<span class="ident" id="3027163">path</span><span class="op" id="3027167">)</span><span class="op" id="3027168">,</span>&nbsp;<span class="ident" id="3027170">nil</span><br>
<span class="lineno"></span><span class="op" id="3027174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3027177">//&nbsp;Rel&nbsp;returns&nbsp;a&nbsp;relative&nbsp;path&nbsp;that&nbsp;is&nbsp;lexically&nbsp;equivalent&nbsp;to&nbsp;targpath&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3027254">//&nbsp;joined&nbsp;to&nbsp;basepath&nbsp;with&nbsp;an&nbsp;intervening&nbsp;separator.&nbsp;That&nbsp;is,</span><br>
<span class="lineno">250</span><span class="comment" id="3027316">//&nbsp;Join(basepath,&nbsp;Rel(basepath,&nbsp;targpath))&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;targpath&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="3027393">//&nbsp;On&nbsp;success,&nbsp;the&nbsp;returned&nbsp;path&nbsp;will&nbsp;always&nbsp;be&nbsp;relative&nbsp;to&nbsp;basepath,</span><br>
<span class="lineno"></span><span class="comment" id="3027463">//&nbsp;even&nbsp;if&nbsp;basepath&nbsp;and&nbsp;targpath&nbsp;share&nbsp;no&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="3027515">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;targpath&nbsp;can&#39;t&nbsp;be&nbsp;made&nbsp;relative&nbsp;to&nbsp;basepath&nbsp;or&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3027592">//&nbsp;knowing&nbsp;the&nbsp;current&nbsp;working&nbsp;directory&nbsp;would&nbsp;be&nbsp;necessary&nbsp;to&nbsp;compute&nbsp;it.</span><br>
<span class="lineno">255</span><span class="keyword" id="3027667">func</span>&nbsp;<span class="ident" id="3027672">Rel</span><span class="op" id="3027675">(</span><span class="ident" id="3027676">basepath</span><span class="op" id="3027684">,</span>&nbsp;<span class="ident" id="3027686">targpath</span>&nbsp;<span class="builtintype" id="3027695">string</span><span class="op" id="3027701">)</span>&nbsp;<span class="op" id="3027703">(</span><span class="builtintype" id="3027704">string</span><span class="op" id="3027710">,</span>&nbsp;<span class="builtintype" id="3027712">error</span><span class="op" id="3027717">)</span>&nbsp;<span class="op" id="3027719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027722">baseVol</span>&nbsp;<span class="op" id="3027730">:=</span>&nbsp;<span class="ident" id="3027733">VolumeName</span><span class="op" id="3027743">(</span><span class="ident" id="3027744">basepath</span><span class="op" id="3027752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027755">targVol</span>&nbsp;<span class="op" id="3027763">:=</span>&nbsp;<span class="ident" id="3027766">VolumeName</span><span class="op" id="3027776">(</span><span class="ident" id="3027777">targpath</span><span class="op" id="3027785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027788">base</span>&nbsp;<span class="op" id="3027793">:=</span>&nbsp;<span class="ident" id="3027796">Clean</span><span class="op" id="3027801">(</span><span class="ident" id="3027802">basepath</span><span class="op" id="3027810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027813">targ</span>&nbsp;<span class="op" id="3027818">:=</span>&nbsp;<span class="ident" id="3027821">Clean</span><span class="op" id="3027826">(</span><span class="ident" id="3027827">targpath</span><span class="op" id="3027835">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027838">if</span>&nbsp;<span class="ident" id="3027841">targ</span>&nbsp;<span class="op" id="3027846">==</span>&nbsp;<span class="ident" id="3027849">base</span>&nbsp;<span class="op" id="3027854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027858">return</span>&nbsp;<span class="string" id="3027865">&#34;.&#34;</span><span class="op" id="3027868">,</span>&nbsp;<span class="ident" id="3027870">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3027875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027878">base</span>&nbsp;<span class="op" id="3027883">=</span>&nbsp;<span class="ident" id="3027885">base</span><span class="op" id="3027889">[</span><span class="builtinfunc" id="3027890">len</span><span class="op" id="3027893">(</span><span class="ident" id="3027894">baseVol</span><span class="op" id="3027901">)</span><span class="op" id="3027902">:</span><span class="op" id="3027903">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027906">targ</span>&nbsp;<span class="op" id="3027911">=</span>&nbsp;<span class="ident" id="3027913">targ</span><span class="op" id="3027917">[</span><span class="builtinfunc" id="3027918">len</span><span class="op" id="3027921">(</span><span class="ident" id="3027922">targVol</span><span class="op" id="3027929">)</span><span class="op" id="3027930">:</span><span class="op" id="3027931">]</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027934">if</span>&nbsp;<span class="ident" id="3027937">base</span>&nbsp;<span class="op" id="3027942">==</span>&nbsp;<span class="string" id="3027945">&#34;.&#34;</span>&nbsp;<span class="op" id="3027949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027953">base</span>&nbsp;<span class="op" id="3027958">=</span>&nbsp;<span class="string" id="3027960">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3027964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3027967">//&nbsp;Can&#39;t&nbsp;use&nbsp;IsAbs&nbsp;-&nbsp;`\a`&nbsp;and&nbsp;`a`&nbsp;are&nbsp;both&nbsp;relative&nbsp;in&nbsp;Windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028032">baseSlashed</span>&nbsp;<span class="op" id="3028044">:=</span>&nbsp;<span class="builtinfunc" id="3028047">len</span><span class="op" id="3028050">(</span><span class="ident" id="3028051">base</span><span class="op" id="3028055">)</span>&nbsp;<span class="op" id="3028057">&gt;</span>&nbsp;<span class="num" id="3028059">0</span>&nbsp;<span class="op" id="3028061">&amp;&amp;</span>&nbsp;<span class="ident" id="3028064">base</span><span class="op" id="3028068">[</span><span class="num" id="3028069">0</span><span class="op" id="3028070">]</span>&nbsp;<span class="op" id="3028072">==</span>&nbsp;<span class="ident" id="3028075">Separator</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028086">targSlashed</span>&nbsp;<span class="op" id="3028098">:=</span>&nbsp;<span class="builtinfunc" id="3028101">len</span><span class="op" id="3028104">(</span><span class="ident" id="3028105">targ</span><span class="op" id="3028109">)</span>&nbsp;<span class="op" id="3028111">&gt;</span>&nbsp;<span class="num" id="3028113">0</span>&nbsp;<span class="op" id="3028115">&amp;&amp;</span>&nbsp;<span class="ident" id="3028118">targ</span><span class="op" id="3028122">[</span><span class="num" id="3028123">0</span><span class="op" id="3028124">]</span>&nbsp;<span class="op" id="3028126">==</span>&nbsp;<span class="ident" id="3028129">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028140">if</span>&nbsp;<span class="ident" id="3028143">baseSlashed</span>&nbsp;<span class="op" id="3028155">!=</span>&nbsp;<span class="ident" id="3028158">targSlashed</span>&nbsp;<span class="op" id="3028170">||</span>&nbsp;<span class="ident" id="3028173">baseVol</span>&nbsp;<span class="op" id="3028181">!=</span>&nbsp;<span class="ident" id="3028184">targVol</span>&nbsp;<span class="op" id="3028192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028196">return</span>&nbsp;<span class="string" id="3028203">&#34;&#34;</span><span class="op" id="3028205">,</span>&nbsp;<span class="ident" id="3028207">errors</span><span class="op" id="3028213">.</span><span class="ident" id="3028214">New</span><span class="op" id="3028217">(</span><span class="string" id="3028218">&#34;Rel:&nbsp;can&#39;t&nbsp;make&nbsp;&#34;</span>&nbsp;<span class="op" id="3028237">+</span>&nbsp;<span class="ident" id="3028239">targ</span>&nbsp;<span class="op" id="3028244">+</span>&nbsp;<span class="string" id="3028246">&#34;&nbsp;relative&nbsp;to&nbsp;&#34;</span>&nbsp;<span class="op" id="3028262">+</span>&nbsp;<span class="ident" id="3028264">base</span><span class="op" id="3028268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3028274">//&nbsp;Position&nbsp;base[b0:bi]&nbsp;and&nbsp;targ[t0:ti]&nbsp;at&nbsp;the&nbsp;first&nbsp;differing&nbsp;elements.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028348">bl</span>&nbsp;<span class="op" id="3028351">:=</span>&nbsp;<span class="builtinfunc" id="3028354">len</span><span class="op" id="3028357">(</span><span class="ident" id="3028358">base</span><span class="op" id="3028362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028365">tl</span>&nbsp;<span class="op" id="3028368">:=</span>&nbsp;<span class="builtinfunc" id="3028371">len</span><span class="op" id="3028374">(</span><span class="ident" id="3028375">targ</span><span class="op" id="3028379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028382">var</span>&nbsp;<span class="ident" id="3028386">b0</span><span class="op" id="3028388">,</span>&nbsp;<span class="ident" id="3028390">bi</span><span class="op" id="3028392">,</span>&nbsp;<span class="ident" id="3028394">t0</span><span class="op" id="3028396">,</span>&nbsp;<span class="ident" id="3028398">ti</span>&nbsp;<span class="builtintype" id="3028401">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028406">for</span>&nbsp;<span class="op" id="3028410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028414">for</span>&nbsp;<span class="ident" id="3028418">bi</span>&nbsp;<span class="op" id="3028421">&lt;</span>&nbsp;<span class="ident" id="3028423">bl</span>&nbsp;<span class="op" id="3028426">&amp;&amp;</span>&nbsp;<span class="ident" id="3028429">base</span><span class="op" id="3028433">[</span><span class="ident" id="3028434">bi</span><span class="op" id="3028436">]</span>&nbsp;<span class="op" id="3028438">!=</span>&nbsp;<span class="ident" id="3028441">Separator</span>&nbsp;<span class="op" id="3028451">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028456">bi</span><span class="op" id="3028458">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028467">for</span>&nbsp;<span class="ident" id="3028471">ti</span>&nbsp;<span class="op" id="3028474">&lt;</span>&nbsp;<span class="ident" id="3028476">tl</span>&nbsp;<span class="op" id="3028479">&amp;&amp;</span>&nbsp;<span class="ident" id="3028482">targ</span><span class="op" id="3028486">[</span><span class="ident" id="3028487">ti</span><span class="op" id="3028489">]</span>&nbsp;<span class="op" id="3028491">!=</span>&nbsp;<span class="ident" id="3028494">Separator</span>&nbsp;<span class="op" id="3028504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028509">ti</span><span class="op" id="3028511">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028516">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028520">if</span>&nbsp;<span class="ident" id="3028523">targ</span><span class="op" id="3028527">[</span><span class="ident" id="3028528">t0</span><span class="op" id="3028530">:</span><span class="ident" id="3028531">ti</span><span class="op" id="3028533">]</span>&nbsp;<span class="op" id="3028535">!=</span>&nbsp;<span class="ident" id="3028538">base</span><span class="op" id="3028542">[</span><span class="ident" id="3028543">b0</span><span class="op" id="3028545">:</span><span class="ident" id="3028546">bi</span><span class="op" id="3028548">]</span>&nbsp;<span class="op" id="3028550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028555">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028567">if</span>&nbsp;<span class="ident" id="3028570">bi</span>&nbsp;<span class="op" id="3028573">&lt;</span>&nbsp;<span class="ident" id="3028575">bl</span>&nbsp;<span class="op" id="3028578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028583">bi</span><span class="op" id="3028585">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028594">if</span>&nbsp;<span class="ident" id="3028597">ti</span>&nbsp;<span class="op" id="3028600">&lt;</span>&nbsp;<span class="ident" id="3028602">tl</span>&nbsp;<span class="op" id="3028605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028610">ti</span><span class="op" id="3028612">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028621">b0</span>&nbsp;<span class="op" id="3028624">=</span>&nbsp;<span class="ident" id="3028626">bi</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028631">t0</span>&nbsp;<span class="op" id="3028634">=</span>&nbsp;<span class="ident" id="3028636">ti</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028643">if</span>&nbsp;<span class="ident" id="3028646">base</span><span class="op" id="3028650">[</span><span class="ident" id="3028651">b0</span><span class="op" id="3028653">:</span><span class="ident" id="3028654">bi</span><span class="op" id="3028656">]</span>&nbsp;<span class="op" id="3028658">==</span>&nbsp;<span class="string" id="3028661">&#34;..&#34;</span>&nbsp;<span class="op" id="3028666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028670">return</span>&nbsp;<span class="string" id="3028677">&#34;&#34;</span><span class="op" id="3028679">,</span>&nbsp;<span class="ident" id="3028681">errors</span><span class="op" id="3028687">.</span><span class="ident" id="3028688">New</span><span class="op" id="3028691">(</span><span class="string" id="3028692">&#34;Rel:&nbsp;can&#39;t&nbsp;make&nbsp;&#34;</span>&nbsp;<span class="op" id="3028711">+</span>&nbsp;<span class="ident" id="3028713">targ</span>&nbsp;<span class="op" id="3028718">+</span>&nbsp;<span class="string" id="3028720">&#34;&nbsp;relative&nbsp;to&nbsp;&#34;</span>&nbsp;<span class="op" id="3028736">+</span>&nbsp;<span class="ident" id="3028738">base</span><span class="op" id="3028742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028745">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028748">if</span>&nbsp;<span class="ident" id="3028751">b0</span>&nbsp;<span class="op" id="3028754">!=</span>&nbsp;<span class="ident" id="3028757">bl</span>&nbsp;<span class="op" id="3028760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3028764">//&nbsp;Base&nbsp;elements&nbsp;left.&nbsp;Must&nbsp;go&nbsp;up&nbsp;before&nbsp;going&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028819">seps</span>&nbsp;<span class="op" id="3028824">:=</span>&nbsp;<span class="ident" id="3028827">strings</span><span class="op" id="3028834">.</span><span class="ident" id="3028835">Count</span><span class="op" id="3028840">(</span><span class="ident" id="3028841">base</span><span class="op" id="3028845">[</span><span class="ident" id="3028846">b0</span><span class="op" id="3028848">:</span><span class="ident" id="3028849">bl</span><span class="op" id="3028851">]</span><span class="op" id="3028852">,</span>&nbsp;<span class="builtintype" id="3028854">string</span><span class="op" id="3028860">(</span><span class="ident" id="3028861">Separator</span><span class="op" id="3028870">)</span><span class="op" id="3028871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028875">size</span>&nbsp;<span class="op" id="3028880">:=</span>&nbsp;<span class="num" id="3028883">2</span>&nbsp;<span class="op" id="3028885">+</span>&nbsp;<span class="ident" id="3028887">seps</span><span class="op" id="3028891">*</span><span class="num" id="3028892">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028896">if</span>&nbsp;<span class="ident" id="3028899">tl</span>&nbsp;<span class="op" id="3028902">!=</span>&nbsp;<span class="ident" id="3028905">t0</span>&nbsp;<span class="op" id="3028908">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028913">size</span>&nbsp;<span class="op" id="3028918">+=</span>&nbsp;<span class="num" id="3028921">1</span>&nbsp;<span class="op" id="3028923">+</span>&nbsp;<span class="ident" id="3028925">tl</span>&nbsp;<span class="op" id="3028928">-</span>&nbsp;<span class="ident" id="3028930">t0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028939">buf</span>&nbsp;<span class="op" id="3028943">:=</span>&nbsp;<span class="builtinfunc" id="3028946">make</span><span class="op" id="3028950">(</span><span class="op" id="3028951">[</span><span class="op" id="3028952">]</span><span class="builtintype" id="3028953">byte</span><span class="op" id="3028957">,</span>&nbsp;<span class="ident" id="3028959">size</span><span class="op" id="3028963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028967">n</span>&nbsp;<span class="op" id="3028969">:=</span>&nbsp;<span class="builtinfunc" id="3028972">copy</span><span class="op" id="3028976">(</span><span class="ident" id="3028977">buf</span><span class="op" id="3028980">,</span>&nbsp;<span class="string" id="3028982">&#34;..&#34;</span><span class="op" id="3028986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028990">for</span>&nbsp;<span class="ident" id="3028994">i</span>&nbsp;<span class="op" id="3028996">:=</span>&nbsp;<span class="num" id="3028999">0</span><span class="op" id="3029000">;</span>&nbsp;<span class="ident" id="3029002">i</span>&nbsp;<span class="op" id="3029004">&lt;</span>&nbsp;<span class="ident" id="3029006">seps</span><span class="op" id="3029010">;</span>&nbsp;<span class="ident" id="3029012">i</span><span class="op" id="3029013">++</span>&nbsp;<span class="op" id="3029016">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029021">buf</span><span class="op" id="3029024">[</span><span class="ident" id="3029025">n</span><span class="op" id="3029026">]</span>&nbsp;<span class="op" id="3029028">=</span>&nbsp;<span class="ident" id="3029030">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3029043">copy</span><span class="op" id="3029047">(</span><span class="ident" id="3029048">buf</span><span class="op" id="3029051">[</span><span class="ident" id="3029052">n</span><span class="op" id="3029053">+</span><span class="num" id="3029054">1</span><span class="op" id="3029055">:</span><span class="op" id="3029056">]</span><span class="op" id="3029057">,</span>&nbsp;<span class="string" id="3029059">&#34;..&#34;</span><span class="op" id="3029063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029068">n</span>&nbsp;<span class="op" id="3029070">+=</span>&nbsp;<span class="num" id="3029073">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3029077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3029081">if</span>&nbsp;<span class="ident" id="3029084">t0</span>&nbsp;<span class="op" id="3029087">!=</span>&nbsp;<span class="ident" id="3029090">tl</span>&nbsp;<span class="op" id="3029093">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029098">buf</span><span class="op" id="3029101">[</span><span class="ident" id="3029102">n</span><span class="op" id="3029103">]</span>&nbsp;<span class="op" id="3029105">=</span>&nbsp;<span class="ident" id="3029107">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3029120">copy</span><span class="op" id="3029124">(</span><span class="ident" id="3029125">buf</span><span class="op" id="3029128">[</span><span class="ident" id="3029129">n</span><span class="op" id="3029130">+</span><span class="num" id="3029131">1</span><span class="op" id="3029132">:</span><span class="op" id="3029133">]</span><span class="op" id="3029134">,</span>&nbsp;<span class="ident" id="3029136">targ</span><span class="op" id="3029140">[</span><span class="ident" id="3029141">t0</span><span class="op" id="3029143">:</span><span class="op" id="3029144">]</span><span class="op" id="3029145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3029149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3029153">return</span>&nbsp;<span class="builtintype" id="3029160">string</span><span class="op" id="3029166">(</span><span class="ident" id="3029167">buf</span><span class="op" id="3029170">)</span><span class="op" id="3029171">,</span>&nbsp;<span class="ident" id="3029173">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3029178">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3029181">return</span>&nbsp;<span class="ident" id="3029188">targ</span><span class="op" id="3029192">[</span><span class="ident" id="3029193">t0</span><span class="op" id="3029195">:</span><span class="op" id="3029196">]</span><span class="op" id="3029197">,</span>&nbsp;<span class="ident" id="3029199">nil</span><br>
<span class="lineno"></span><span class="op" id="3029203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3029206">//&nbsp;SkipDir&nbsp;is&nbsp;used&nbsp;as&nbsp;a&nbsp;return&nbsp;value&nbsp;from&nbsp;WalkFuncs&nbsp;to&nbsp;indicate&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3029275">//&nbsp;the&nbsp;directory&nbsp;named&nbsp;in&nbsp;the&nbsp;call&nbsp;is&nbsp;to&nbsp;be&nbsp;skipped.&nbsp;It&nbsp;is&nbsp;not&nbsp;returned</span><br>
<span class="lineno">325</span><span class="comment" id="3029347">//&nbsp;as&nbsp;an&nbsp;error&nbsp;by&nbsp;any&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="3029379">var</span>&nbsp;<span class="ident" id="3029383">SkipDir</span>&nbsp;<span class="op" id="3029391">=</span>&nbsp;<span class="ident" id="3029393">errors</span><span class="op" id="3029399">.</span><span class="ident" id="3029400">New</span><span class="op" id="3029403">(</span><span class="string" id="3029404">&#34;skip&nbsp;this&nbsp;directory&#34;</span><span class="op" id="3029425">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3029428">//&nbsp;WalkFunc&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;the&nbsp;function&nbsp;called&nbsp;for&nbsp;each&nbsp;file&nbsp;or&nbsp;directory</span><br>
<span class="lineno"></span><span class="comment" id="3029502">//&nbsp;visited&nbsp;by&nbsp;Walk.&nbsp;The&nbsp;path&nbsp;argument&nbsp;contains&nbsp;the&nbsp;argument&nbsp;to&nbsp;Walk&nbsp;as&nbsp;a</span><br>
<span class="lineno">330</span><span class="comment" id="3029575">//&nbsp;prefix;&nbsp;that&nbsp;is,&nbsp;if&nbsp;Walk&nbsp;is&nbsp;called&nbsp;with&nbsp;&#34;dir&#34;,&nbsp;which&nbsp;is&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="comment" id="3029646">//&nbsp;containing&nbsp;the&nbsp;file&nbsp;&#34;a&#34;,&nbsp;the&nbsp;walk&nbsp;function&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;argument</span><br>
<span class="lineno"></span><span class="comment" id="3029721">//&nbsp;&#34;dir/a&#34;.&nbsp;The&nbsp;info&nbsp;argument&nbsp;is&nbsp;the&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;named&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3029790">//</span><br>
<span class="lineno"></span><span class="comment" id="3029793">//&nbsp;If&nbsp;there&nbsp;was&nbsp;a&nbsp;problem&nbsp;walking&nbsp;to&nbsp;the&nbsp;file&nbsp;or&nbsp;directory&nbsp;named&nbsp;by&nbsp;path,&nbsp;the</span><br>
<span class="lineno">335</span><span class="comment" id="3029871">//&nbsp;incoming&nbsp;error&nbsp;will&nbsp;describe&nbsp;the&nbsp;problem&nbsp;and&nbsp;the&nbsp;function&nbsp;can&nbsp;decide&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="3029947">//&nbsp;to&nbsp;handle&nbsp;that&nbsp;error&nbsp;(and&nbsp;Walk&nbsp;will&nbsp;not&nbsp;descend&nbsp;into&nbsp;that&nbsp;directory).&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3030023">//&nbsp;an&nbsp;error&nbsp;is&nbsp;returned,&nbsp;processing&nbsp;stops.&nbsp;The&nbsp;sole&nbsp;exception&nbsp;is&nbsp;that&nbsp;if&nbsp;path</span><br>
<span class="lineno"></span><span class="comment" id="3030101">//&nbsp;is&nbsp;a&nbsp;directory&nbsp;and&nbsp;the&nbsp;function&nbsp;returns&nbsp;the&nbsp;special&nbsp;value&nbsp;SkipDir,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3030175">//&nbsp;contents&nbsp;of&nbsp;the&nbsp;directory&nbsp;are&nbsp;skipped&nbsp;and&nbsp;processing&nbsp;continues&nbsp;as&nbsp;usual&nbsp;on</span><br>
<span class="lineno">340</span><span class="comment" id="3030253">//&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="3030271">type</span>&nbsp;<span class="ident" id="3030276">WalkFunc</span>&nbsp;<span class="keyword" id="3030285">func</span><span class="op" id="3030289">(</span><span class="ident" id="3030290">path</span>&nbsp;<span class="builtintype" id="3030295">string</span><span class="op" id="3030301">,</span>&nbsp;<span class="ident" id="3030303">info</span>&nbsp;<span class="ident" id="3030308">os</span><span class="op" id="3030310">.</span><span class="ident" id="3030311">FileInfo</span><span class="op" id="3030319">,</span>&nbsp;<span class="ident" id="3030321">err</span>&nbsp;<span class="builtintype" id="3030325">error</span><span class="op" id="3030330">)</span>&nbsp;<span class="builtintype" id="3030332">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3030339">var</span>&nbsp;<span class="ident" id="3030343">lstat</span>&nbsp;<span class="op" id="3030349">=</span>&nbsp;<span class="ident" id="3030351">os</span><span class="op" id="3030353">.</span><span class="ident" id="3030354">Lstat</span>&nbsp;<span class="comment" id="3030360">//&nbsp;for&nbsp;testing</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="3030376">//&nbsp;walk&nbsp;recursively&nbsp;descends&nbsp;path,&nbsp;calling&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3030422">func</span>&nbsp;<span class="ident" id="3030427">walk</span><span class="op" id="3030431">(</span><span class="ident" id="3030432">path</span>&nbsp;<span class="builtintype" id="3030437">string</span><span class="op" id="3030443">,</span>&nbsp;<span class="ident" id="3030445">info</span>&nbsp;<span class="ident" id="3030450">os</span><span class="op" id="3030452">.</span><span class="ident" id="3030453">FileInfo</span><span class="op" id="3030461">,</span>&nbsp;<span class="ident" id="3030463">walkFn</span>&nbsp;<span class="ident" id="3030470">WalkFunc</span><span class="op" id="3030478">)</span>&nbsp;<span class="builtintype" id="3030480">error</span>&nbsp;<span class="op" id="3030486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3030489">err</span>&nbsp;<span class="op" id="3030493">:=</span>&nbsp;<span class="ident" id="3030496">walkFn</span><span class="op" id="3030502">(</span><span class="ident" id="3030503">path</span><span class="op" id="3030507">,</span>&nbsp;<span class="ident" id="3030509">info</span><span class="op" id="3030513">,</span>&nbsp;<span class="ident" id="3030515">nil</span><span class="op" id="3030518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030521">if</span>&nbsp;<span class="ident" id="3030524">err</span>&nbsp;<span class="op" id="3030528">!=</span>&nbsp;<span class="ident" id="3030531">nil</span>&nbsp;<span class="op" id="3030535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030539">if</span>&nbsp;<span class="ident" id="3030542">info</span><span class="op" id="3030546">.</span><span class="ident" id="3030547">IsDir</span><span class="op" id="3030552">(</span><span class="op" id="3030553">)</span>&nbsp;<span class="op" id="3030555">&amp;&amp;</span>&nbsp;<span class="ident" id="3030558">err</span>&nbsp;<span class="op" id="3030562">==</span>&nbsp;<span class="ident" id="3030565">SkipDir</span>&nbsp;<span class="op" id="3030573">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030578">return</span>&nbsp;<span class="ident" id="3030585">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3030591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030595">return</span>&nbsp;<span class="ident" id="3030602">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3030607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030611">if</span>&nbsp;<span class="op" id="3030614">!</span><span class="ident" id="3030615">info</span><span class="op" id="3030619">.</span><span class="ident" id="3030620">IsDir</span><span class="op" id="3030625">(</span><span class="op" id="3030626">)</span>&nbsp;<span class="op" id="3030628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030632">return</span>&nbsp;<span class="ident" id="3030639">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3030644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3030648">names</span><span class="op" id="3030653">,</span>&nbsp;<span class="ident" id="3030655">err</span>&nbsp;<span class="op" id="3030659">:=</span>&nbsp;<span class="ident" id="3030662">readDirNames</span><span class="op" id="3030674">(</span><span class="ident" id="3030675">path</span><span class="op" id="3030679">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030682">if</span>&nbsp;<span class="ident" id="3030685">err</span>&nbsp;<span class="op" id="3030689">!=</span>&nbsp;<span class="ident" id="3030692">nil</span>&nbsp;<span class="op" id="3030696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030700">return</span>&nbsp;<span class="ident" id="3030707">walkFn</span><span class="op" id="3030713">(</span><span class="ident" id="3030714">path</span><span class="op" id="3030718">,</span>&nbsp;<span class="ident" id="3030720">info</span><span class="op" id="3030724">,</span>&nbsp;<span class="ident" id="3030726">err</span><span class="op" id="3030729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3030732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030736">for</span>&nbsp;<span class="ident" id="3030740">_</span><span class="op" id="3030741">,</span>&nbsp;<span class="ident" id="3030743">name</span>&nbsp;<span class="op" id="3030748">:=</span>&nbsp;<span class="keyword" id="3030751">range</span>&nbsp;<span class="ident" id="3030757">names</span>&nbsp;<span class="op" id="3030763">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3030767">filename</span>&nbsp;<span class="op" id="3030776">:=</span>&nbsp;<span class="ident" id="3030779">Join</span><span class="op" id="3030783">(</span><span class="ident" id="3030784">path</span><span class="op" id="3030788">,</span>&nbsp;<span class="ident" id="3030790">name</span><span class="op" id="3030794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3030798">fileInfo</span><span class="op" id="3030806">,</span>&nbsp;<span class="ident" id="3030808">err</span>&nbsp;<span class="op" id="3030812">:=</span>&nbsp;<span class="ident" id="3030815">lstat</span><span class="op" id="3030820">(</span><span class="ident" id="3030821">filename</span><span class="op" id="3030829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030833">if</span>&nbsp;<span class="ident" id="3030836">err</span>&nbsp;<span class="op" id="3030840">!=</span>&nbsp;<span class="ident" id="3030843">nil</span>&nbsp;<span class="op" id="3030847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030852">if</span>&nbsp;<span class="ident" id="3030855">err</span>&nbsp;<span class="op" id="3030859">:=</span>&nbsp;<span class="ident" id="3030862">walkFn</span><span class="op" id="3030868">(</span><span class="ident" id="3030869">filename</span><span class="op" id="3030877">,</span>&nbsp;<span class="ident" id="3030879">fileInfo</span><span class="op" id="3030887">,</span>&nbsp;<span class="ident" id="3030889">err</span><span class="op" id="3030892">)</span><span class="op" id="3030893">;</span>&nbsp;<span class="ident" id="3030895">err</span>&nbsp;<span class="op" id="3030899">!=</span>&nbsp;<span class="ident" id="3030902">nil</span>&nbsp;<span class="op" id="3030906">&amp;&amp;</span>&nbsp;<span class="ident" id="3030909">err</span>&nbsp;<span class="op" id="3030913">!=</span>&nbsp;<span class="ident" id="3030916">SkipDir</span>&nbsp;<span class="op" id="3030924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030930">return</span>&nbsp;<span class="ident" id="3030937">err</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3030944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3030948">}</span>&nbsp;<span class="keyword" id="3030950">else</span>&nbsp;<span class="op" id="3030955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3030960">err</span>&nbsp;<span class="op" id="3030964">=</span>&nbsp;<span class="ident" id="3030966">walk</span><span class="op" id="3030970">(</span><span class="ident" id="3030971">filename</span><span class="op" id="3030979">,</span>&nbsp;<span class="ident" id="3030981">fileInfo</span><span class="op" id="3030989">,</span>&nbsp;<span class="ident" id="3030991">walkFn</span><span class="op" id="3030997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3031002">if</span>&nbsp;<span class="ident" id="3031005">err</span>&nbsp;<span class="op" id="3031009">!=</span>&nbsp;<span class="ident" id="3031012">nil</span>&nbsp;<span class="op" id="3031016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3031022">if</span>&nbsp;<span class="op" id="3031025">!</span><span class="ident" id="3031026">fileInfo</span><span class="op" id="3031034">.</span><span class="ident" id="3031035">IsDir</span><span class="op" id="3031040">(</span><span class="op" id="3031041">)</span>&nbsp;<span class="op" id="3031043">||</span>&nbsp;<span class="ident" id="3031046">err</span>&nbsp;<span class="op" id="3031050">!=</span>&nbsp;<span class="ident" id="3031053">SkipDir</span>&nbsp;<span class="op" id="3031061">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3031068">return</span>&nbsp;<span class="ident" id="3031075">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3031083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3031088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3031092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3031095">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3031098">return</span>&nbsp;<span class="ident" id="3031105">nil</span><br>
<span class="lineno"></span><span class="op" id="3031109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3031112">//&nbsp;Walk&nbsp;walks&nbsp;the&nbsp;file&nbsp;tree&nbsp;rooted&nbsp;at&nbsp;root,&nbsp;calling&nbsp;walkFn&nbsp;for&nbsp;each&nbsp;file&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3031188">//&nbsp;directory&nbsp;in&nbsp;the&nbsp;tree,&nbsp;including&nbsp;root.&nbsp;All&nbsp;errors&nbsp;that&nbsp;arise&nbsp;visiting&nbsp;files</span><br>
<span class="lineno">385</span><span class="comment" id="3031267">//&nbsp;and&nbsp;directories&nbsp;are&nbsp;filtered&nbsp;by&nbsp;walkFn.&nbsp;The&nbsp;files&nbsp;are&nbsp;walked&nbsp;in&nbsp;lexical</span><br>
<span class="lineno"></span><span class="comment" id="3031342">//&nbsp;order,&nbsp;which&nbsp;makes&nbsp;the&nbsp;output&nbsp;deterministic&nbsp;but&nbsp;means&nbsp;that&nbsp;for&nbsp;very</span><br>
<span class="lineno"></span><span class="comment" id="3031413">//&nbsp;large&nbsp;directories&nbsp;Walk&nbsp;can&nbsp;be&nbsp;inefficient.</span><br>
<span class="lineno"></span><span class="comment" id="3031459">//&nbsp;Walk&nbsp;does&nbsp;not&nbsp;follow&nbsp;symbolic&nbsp;links.</span><br>
<span class="lineno"></span><span class="keyword" id="3031499">func</span>&nbsp;<span class="ident" id="3031504">Walk</span><span class="op" id="3031508">(</span><span class="ident" id="3031509">root</span>&nbsp;<span class="builtintype" id="3031514">string</span><span class="op" id="3031520">,</span>&nbsp;<span class="ident" id="3031522">walkFn</span>&nbsp;<span class="ident" id="3031529">WalkFunc</span><span class="op" id="3031537">)</span>&nbsp;<span class="builtintype" id="3031539">error</span>&nbsp;<span class="op" id="3031545">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3031548">info</span><span class="op" id="3031552">,</span>&nbsp;<span class="ident" id="3031554">err</span>&nbsp;<span class="op" id="3031558">:=</span>&nbsp;<span class="ident" id="3031561">os</span><span class="op" id="3031563">.</span><span class="ident" id="3031564">Lstat</span><span class="op" id="3031569">(</span><span class="ident" id="3031570">root</span><span class="op" id="3031574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3031577">if</span>&nbsp;<span class="ident" id="3031580">err</span>&nbsp;<span class="op" id="3031584">!=</span>&nbsp;<span class="ident" id="3031587">nil</span>&nbsp;<span class="op" id="3031591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3031595">return</span>&nbsp;<span class="ident" id="3031602">walkFn</span><span class="op" id="3031608">(</span><span class="ident" id="3031609">root</span><span class="op" id="3031613">,</span>&nbsp;<span class="ident" id="3031615">nil</span><span class="op" id="3031618">,</span>&nbsp;<span class="ident" id="3031620">err</span><span class="op" id="3031623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3031626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3031629">return</span>&nbsp;<span class="ident" id="3031636">walk</span><span class="op" id="3031640">(</span><span class="ident" id="3031641">root</span><span class="op" id="3031645">,</span>&nbsp;<span class="ident" id="3031647">info</span><span class="op" id="3031651">,</span>&nbsp;<span class="ident" id="3031653">walkFn</span><span class="op" id="3031659">)</span><br>
<span class="lineno">395</span><span class="op" id="3031661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3031664">//&nbsp;readDirNames&nbsp;reads&nbsp;the&nbsp;directory&nbsp;named&nbsp;by&nbsp;dirname&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3031729">//&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="3031768">func</span>&nbsp;<span class="ident" id="3031773">readDirNames</span><span class="op" id="3031785">(</span><span class="ident" id="3031786">dirname</span>&nbsp;<span class="builtintype" id="3031794">string</span><span class="op" id="3031800">)</span>&nbsp;<span class="op" id="3031802">(</span><span class="op" id="3031803">[</span><span class="op" id="3031804">]</span><span class="builtintype" id="3031805">string</span><span class="op" id="3031811">,</span>&nbsp;<span class="builtintype" id="3031813">error</span><span class="op" id="3031818">)</span>&nbsp;<span class="op" id="3031820">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3031823">f</span><span class="op" id="3031824">,</span>&nbsp;<span class="ident" id="3031826">err</span>&nbsp;<span class="op" id="3031830">:=</span>&nbsp;<span class="ident" id="3031833">os</span><span class="op" id="3031835">.</span><span class="ident" id="3031836">Open</span><span class="op" id="3031840">(</span><span class="ident" id="3031841">dirname</span><span class="op" id="3031848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3031851">if</span>&nbsp;<span class="ident" id="3031854">err</span>&nbsp;<span class="op" id="3031858">!=</span>&nbsp;<span class="ident" id="3031861">nil</span>&nbsp;<span class="op" id="3031865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3031869">return</span>&nbsp;<span class="ident" id="3031876">nil</span><span class="op" id="3031879">,</span>&nbsp;<span class="ident" id="3031881">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3031886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3031889">names</span><span class="op" id="3031894">,</span>&nbsp;<span class="ident" id="3031896">err</span>&nbsp;<span class="op" id="3031900">:=</span>&nbsp;<span class="ident" id="3031903">f</span><span class="op" id="3031904">.</span><span class="ident" id="3031905">Readdirnames</span><span class="op" id="3031917">(</span><span class="op" id="3031918">-</span><span class="num" id="3031919">1</span><span class="op" id="3031920">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3031923">f</span><span class="op" id="3031924">.</span><span class="ident" id="3031925">Close</span><span class="op" id="3031930">(</span><span class="op" id="3031931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3031934">if</span>&nbsp;<span class="ident" id="3031937">err</span>&nbsp;<span class="op" id="3031941">!=</span>&nbsp;<span class="ident" id="3031944">nil</span>&nbsp;<span class="op" id="3031948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3031952">return</span>&nbsp;<span class="ident" id="3031959">nil</span><span class="op" id="3031962">,</span>&nbsp;<span class="ident" id="3031964">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3031969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3031972">sort</span><span class="op" id="3031976">.</span><span class="ident" id="3031977">Strings</span><span class="op" id="3031984">(</span><span class="ident" id="3031985">names</span><span class="op" id="3031990">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3031993">return</span>&nbsp;<span class="ident" id="3032000">names</span><span class="op" id="3032005">,</span>&nbsp;<span class="ident" id="3032007">nil</span><br>
<span class="lineno"></span><span class="op" id="3032011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3032014">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3032056">//&nbsp;Trailing&nbsp;path&nbsp;separators&nbsp;are&nbsp;removed&nbsp;before&nbsp;extracting&nbsp;the&nbsp;last&nbsp;element.</span><br>
<span class="lineno">415</span><span class="comment" id="3032132">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;empty,&nbsp;Base&nbsp;returns&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3032175">//&nbsp;If&nbsp;the&nbsp;path&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;separators,&nbsp;Base&nbsp;returns&nbsp;a&nbsp;single&nbsp;separator.</span><br>
<span class="lineno"></span><span class="keyword" id="3032256">func</span>&nbsp;<span class="ident" id="3032261">Base</span><span class="op" id="3032265">(</span><span class="ident" id="3032266">path</span>&nbsp;<span class="builtintype" id="3032271">string</span><span class="op" id="3032277">)</span>&nbsp;<span class="builtintype" id="3032279">string</span>&nbsp;<span class="op" id="3032286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3032289">if</span>&nbsp;<span class="ident" id="3032292">path</span>&nbsp;<span class="op" id="3032297">==</span>&nbsp;<span class="string" id="3032300">&#34;&#34;</span>&nbsp;<span class="op" id="3032303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3032307">return</span>&nbsp;<span class="string" id="3032314">&#34;.&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3032319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3032322">//&nbsp;Strip&nbsp;trailing&nbsp;slashes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3032350">for</span>&nbsp;<span class="builtinfunc" id="3032354">len</span><span class="op" id="3032357">(</span><span class="ident" id="3032358">path</span><span class="op" id="3032362">)</span>&nbsp;<span class="op" id="3032364">&gt;</span>&nbsp;<span class="num" id="3032366">0</span>&nbsp;<span class="op" id="3032368">&amp;&amp;</span>&nbsp;<span class="ident" id="3032371">os</span><span class="op" id="3032373">.</span><span class="ident" id="3032374">IsPathSeparator</span><span class="op" id="3032389">(</span><span class="ident" id="3032390">path</span><span class="op" id="3032394">[</span><span class="builtinfunc" id="3032395">len</span><span class="op" id="3032398">(</span><span class="ident" id="3032399">path</span><span class="op" id="3032403">)</span><span class="op" id="3032404">-</span><span class="num" id="3032405">1</span><span class="op" id="3032406">]</span><span class="op" id="3032407">)</span>&nbsp;<span class="op" id="3032409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3032413">path</span>&nbsp;<span class="op" id="3032418">=</span>&nbsp;<span class="ident" id="3032420">path</span><span class="op" id="3032424">[</span><span class="num" id="3032425">0</span>&nbsp;<span class="op" id="3032427">:</span>&nbsp;<span class="builtinfunc" id="3032429">len</span><span class="op" id="3032432">(</span><span class="ident" id="3032433">path</span><span class="op" id="3032437">)</span><span class="op" id="3032438">-</span><span class="num" id="3032439">1</span><span class="op" id="3032440">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3032443">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3032446">//&nbsp;Throw&nbsp;away&nbsp;volume&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3032473">path</span>&nbsp;<span class="op" id="3032478">=</span>&nbsp;<span class="ident" id="3032480">path</span><span class="op" id="3032484">[</span><span class="builtinfunc" id="3032485">len</span><span class="op" id="3032488">(</span><span class="ident" id="3032489">VolumeName</span><span class="op" id="3032499">(</span><span class="ident" id="3032500">path</span><span class="op" id="3032504">)</span><span class="op" id="3032505">)</span><span class="op" id="3032506">:</span><span class="op" id="3032507">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3032510">//&nbsp;Find&nbsp;the&nbsp;last&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3032536">i</span>&nbsp;<span class="op" id="3032538">:=</span>&nbsp;<span class="builtinfunc" id="3032541">len</span><span class="op" id="3032544">(</span><span class="ident" id="3032545">path</span><span class="op" id="3032549">)</span>&nbsp;<span class="op" id="3032551">-</span>&nbsp;<span class="num" id="3032553">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3032556">for</span>&nbsp;<span class="ident" id="3032560">i</span>&nbsp;<span class="op" id="3032562">&gt;=</span>&nbsp;<span class="num" id="3032565">0</span>&nbsp;<span class="op" id="3032567">&amp;&amp;</span>&nbsp;<span class="op" id="3032570">!</span><span class="ident" id="3032571">os</span><span class="op" id="3032573">.</span><span class="ident" id="3032574">IsPathSeparator</span><span class="op" id="3032589">(</span><span class="ident" id="3032590">path</span><span class="op" id="3032594">[</span><span class="ident" id="3032595">i</span><span class="op" id="3032596">]</span><span class="op" id="3032597">)</span>&nbsp;<span class="op" id="3032599">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3032603">i</span><span class="op" id="3032604">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3032608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3032611">if</span>&nbsp;<span class="ident" id="3032614">i</span>&nbsp;<span class="op" id="3032616">&gt;=</span>&nbsp;<span class="num" id="3032619">0</span>&nbsp;<span class="op" id="3032621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3032625">path</span>&nbsp;<span class="op" id="3032630">=</span>&nbsp;<span class="ident" id="3032632">path</span><span class="op" id="3032636">[</span><span class="ident" id="3032637">i</span><span class="op" id="3032638">+</span><span class="num" id="3032639">1</span><span class="op" id="3032640">:</span><span class="op" id="3032641">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3032644">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3032647">//&nbsp;If&nbsp;empty&nbsp;now,&nbsp;it&nbsp;had&nbsp;only&nbsp;slashes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3032686">if</span>&nbsp;<span class="ident" id="3032689">path</span>&nbsp;<span class="op" id="3032694">==</span>&nbsp;<span class="string" id="3032697">&#34;&#34;</span>&nbsp;<span class="op" id="3032700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3032704">return</span>&nbsp;<span class="builtintype" id="3032711">string</span><span class="op" id="3032717">(</span><span class="ident" id="3032718">Separator</span><span class="op" id="3032727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3032730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3032733">return</span>&nbsp;<span class="ident" id="3032740">path</span><br>
<span class="lineno">440</span><span class="op" id="3032745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3032748">//&nbsp;Dir&nbsp;returns&nbsp;all&nbsp;but&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;path,&nbsp;typically&nbsp;the&nbsp;path&#39;s&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="3032829">//&nbsp;After&nbsp;dropping&nbsp;the&nbsp;final&nbsp;element,&nbsp;the&nbsp;path&nbsp;is&nbsp;Cleaned&nbsp;and&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="3032899">//&nbsp;slashes&nbsp;are&nbsp;removed.</span><br>
<span class="lineno">445</span><span class="comment" id="3032923">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;empty,&nbsp;Dir&nbsp;returns&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3032965">//&nbsp;If&nbsp;the&nbsp;path&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;separators,&nbsp;Dir&nbsp;returns&nbsp;a&nbsp;single&nbsp;separator.</span><br>
<span class="lineno"></span><span class="comment" id="3033045">//&nbsp;The&nbsp;returned&nbsp;path&nbsp;does&nbsp;not&nbsp;end&nbsp;in&nbsp;a&nbsp;separator&nbsp;unless&nbsp;it&nbsp;is&nbsp;the&nbsp;root&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="3033127">func</span>&nbsp;<span class="ident" id="3033132">Dir</span><span class="op" id="3033135">(</span><span class="ident" id="3033136">path</span>&nbsp;<span class="builtintype" id="3033141">string</span><span class="op" id="3033147">)</span>&nbsp;<span class="builtintype" id="3033149">string</span>&nbsp;<span class="op" id="3033156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3033159">vol</span>&nbsp;<span class="op" id="3033163">:=</span>&nbsp;<span class="ident" id="3033166">VolumeName</span><span class="op" id="3033176">(</span><span class="ident" id="3033177">path</span><span class="op" id="3033181">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3033184">i</span>&nbsp;<span class="op" id="3033186">:=</span>&nbsp;<span class="builtinfunc" id="3033189">len</span><span class="op" id="3033192">(</span><span class="ident" id="3033193">path</span><span class="op" id="3033197">)</span>&nbsp;<span class="op" id="3033199">-</span>&nbsp;<span class="num" id="3033201">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033204">for</span>&nbsp;<span class="ident" id="3033208">i</span>&nbsp;<span class="op" id="3033210">&gt;=</span>&nbsp;<span class="builtinfunc" id="3033213">len</span><span class="op" id="3033216">(</span><span class="ident" id="3033217">vol</span><span class="op" id="3033220">)</span>&nbsp;<span class="op" id="3033222">&amp;&amp;</span>&nbsp;<span class="op" id="3033225">!</span><span class="ident" id="3033226">os</span><span class="op" id="3033228">.</span><span class="ident" id="3033229">IsPathSeparator</span><span class="op" id="3033244">(</span><span class="ident" id="3033245">path</span><span class="op" id="3033249">[</span><span class="ident" id="3033250">i</span><span class="op" id="3033251">]</span><span class="op" id="3033252">)</span>&nbsp;<span class="op" id="3033254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3033258">i</span><span class="op" id="3033259">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3033263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3033266">dir</span>&nbsp;<span class="op" id="3033270">:=</span>&nbsp;<span class="ident" id="3033273">Clean</span><span class="op" id="3033278">(</span><span class="ident" id="3033279">path</span><span class="op" id="3033283">[</span><span class="builtinfunc" id="3033284">len</span><span class="op" id="3033287">(</span><span class="ident" id="3033288">vol</span><span class="op" id="3033291">)</span>&nbsp;<span class="op" id="3033293">:</span>&nbsp;<span class="ident" id="3033295">i</span><span class="op" id="3033296">+</span><span class="num" id="3033297">1</span><span class="op" id="3033298">]</span><span class="op" id="3033299">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033302">return</span>&nbsp;<span class="ident" id="3033309">vol</span>&nbsp;<span class="op" id="3033313">+</span>&nbsp;<span class="ident" id="3033315">dir</span><br>
<span class="lineno"></span><span class="op" id="3033319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3033322">//&nbsp;VolumeName&nbsp;returns&nbsp;leading&nbsp;volume&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="3033365">//&nbsp;Given&nbsp;&#34;C:\foo\bar&#34;&nbsp;it&nbsp;returns&nbsp;&#34;C:&#34;&nbsp;under&nbsp;windows.</span><br>
<span class="lineno">460</span><span class="comment" id="3033418">//&nbsp;Given&nbsp;&#34;\\host\share\foo&#34;&nbsp;it&nbsp;returns&nbsp;&#34;\\host\share&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3033473">//&nbsp;On&nbsp;other&nbsp;platforms&nbsp;it&nbsp;returns&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3033510">func</span>&nbsp;<span class="ident" id="3033515">VolumeName</span><span class="op" id="3033525">(</span><span class="ident" id="3033526">path</span>&nbsp;<span class="builtintype" id="3033531">string</span><span class="op" id="3033537">)</span>&nbsp;<span class="op" id="3033539">(</span><span class="ident" id="3033540">v</span>&nbsp;<span class="builtintype" id="3033542">string</span><span class="op" id="3033548">)</span>&nbsp;<span class="op" id="3033550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033553">return</span>&nbsp;<span class="ident" id="3033560">path</span><span class="op" id="3033564">[</span><span class="op" id="3033565">:</span><span class="ident" id="3033566">volumeNameLen</span><span class="op" id="3033579">(</span><span class="ident" id="3033580">path</span><span class="op" id="3033584">)</span><span class="op" id="3033585">]</span><br>
<span class="lineno"></span><span class="op" id="3033587">}</span>
</div>
</body>
</html>
