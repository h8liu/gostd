<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7017659">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7017714">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7017768">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7017819">package</span>&nbsp;<span class="ident" id="7017827">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7017832">import</span>&nbsp;<span class="op" id="7017839">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017842">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017851">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017867">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017876">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017891">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017902">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7017912">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7017915">//&nbsp;header,&nbsp;palette&nbsp;and&nbsp;trailer&nbsp;are&nbsp;parts&nbsp;of&nbsp;a&nbsp;valid&nbsp;2x1&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="7017982">const</span>&nbsp;<span class="op" id="7017988">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017991">headerStr</span>&nbsp;<span class="op" id="7018001">=</span>&nbsp;<span class="string" id="7018003">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="7018012">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7018016">&#34;\x02\x00\x01\x00&#34;</span>&nbsp;<span class="op" id="7018035">+</span>&nbsp;<span class="comment" id="7018037">//&nbsp;width=2,&nbsp;height=1</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7018060">&#34;\x80\x00\x00&#34;</span>&nbsp;<span class="comment" id="7018075">//&nbsp;headerFields=(a&nbsp;color&nbsp;map&nbsp;of&nbsp;2&nbsp;pixels),&nbsp;backgroundIndex,&nbsp;aspect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018143">paletteStr</span>&nbsp;<span class="op" id="7018154">=</span>&nbsp;<span class="string" id="7018156">&#34;\x10\x20\x30\x40\x50\x60&#34;</span>&nbsp;<span class="comment" id="7018183">//&nbsp;the&nbsp;color&nbsp;map,&nbsp;also&nbsp;known&nbsp;as&nbsp;a&nbsp;palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018226">trailerStr</span>&nbsp;<span class="op" id="7018237">=</span>&nbsp;<span class="string" id="7018239">&#34;\x3b&#34;</span><br>
<span class="lineno"></span><span class="op" id="7018246">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="7018249">//&nbsp;lzwEncode&nbsp;returns&nbsp;an&nbsp;LZW&nbsp;encoding&nbsp;(with&nbsp;2-bit&nbsp;literals)&nbsp;of&nbsp;n&nbsp;zeroes.</span><br>
<span class="lineno"></span><span class="keyword" id="7018321">func</span>&nbsp;<span class="ident" id="7018326">lzwEncode</span><span class="op" id="7018335">(</span><span class="ident" id="7018336">n</span>&nbsp;<span class="builtintype" id="7018338">int</span><span class="op" id="7018341">)</span>&nbsp;<span class="op" id="7018343">[</span><span class="op" id="7018344">]</span><span class="builtintype" id="7018345">byte</span>&nbsp;<span class="op" id="7018350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018353">b</span>&nbsp;<span class="op" id="7018355">:=</span>&nbsp;<span class="op" id="7018358">&amp;</span><span class="ident" id="7018359">bytes</span><span class="op" id="7018364">.</span><span class="ident" id="7018365">Buffer</span><span class="op" id="7018371">{</span><span class="op" id="7018372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018375">w</span>&nbsp;<span class="op" id="7018377">:=</span>&nbsp;<span class="ident" id="7018380">lzw</span><span class="op" id="7018383">.</span><span class="ident" id="7018384">NewWriter</span><span class="op" id="7018393">(</span><span class="ident" id="7018394">b</span><span class="op" id="7018395">,</span>&nbsp;<span class="ident" id="7018397">lzw</span><span class="op" id="7018400">.</span><span class="ident" id="7018401">LSB</span><span class="op" id="7018404">,</span>&nbsp;<span class="num" id="7018406">2</span><span class="op" id="7018407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018410">w</span><span class="op" id="7018411">.</span><span class="ident" id="7018412">Write</span><span class="op" id="7018417">(</span><span class="builtinfunc" id="7018418">make</span><span class="op" id="7018422">(</span><span class="op" id="7018423">[</span><span class="op" id="7018424">]</span><span class="builtintype" id="7018425">byte</span><span class="op" id="7018429">,</span>&nbsp;<span class="ident" id="7018431">n</span><span class="op" id="7018432">)</span><span class="op" id="7018433">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018436">w</span><span class="op" id="7018437">.</span><span class="ident" id="7018438">Close</span><span class="op" id="7018443">(</span><span class="op" id="7018444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7018447">return</span>&nbsp;<span class="ident" id="7018454">b</span><span class="op" id="7018455">.</span><span class="ident" id="7018456">Bytes</span><span class="op" id="7018461">(</span><span class="op" id="7018462">)</span><br>
<span class="lineno"></span><span class="op" id="7018464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7018467">func</span>&nbsp;<span class="ident" id="7018472">TestDecode</span><span class="op" id="7018482">(</span><span class="ident" id="7018483">t</span>&nbsp;<span class="op" id="7018485">*</span><span class="ident" id="7018486">testing</span><span class="op" id="7018493">.</span><span class="ident" id="7018494">T</span><span class="op" id="7018495">)</span>&nbsp;<span class="op" id="7018497">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018500">testCases</span>&nbsp;<span class="op" id="7018510">:=</span>&nbsp;<span class="op" id="7018513">[</span><span class="op" id="7018514">]</span><span class="keyword" id="7018515">struct</span>&nbsp;<span class="op" id="7018522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018526">nPix</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7018534">int</span>&nbsp;&nbsp;<span class="comment" id="7018539">//&nbsp;The&nbsp;number&nbsp;of&nbsp;pixels&nbsp;in&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018584">extra</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7018592">bool</span>&nbsp;<span class="comment" id="7018597">//&nbsp;Whether&nbsp;to&nbsp;write&nbsp;an&nbsp;extra&nbsp;block&nbsp;after&nbsp;the&nbsp;LZW-encoded&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018662">wantErr</span>&nbsp;<span class="builtintype" id="7018670">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018677">}</span><span class="op" id="7018678">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018682">{</span><span class="num" id="7018683">0</span><span class="op" id="7018684">,</span>&nbsp;<span class="builtintype" id="7018686">false</span><span class="op" id="7018691">,</span>&nbsp;<span class="ident" id="7018693">errNotEnough</span><span class="op" id="7018705">}</span><span class="op" id="7018706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018710">{</span><span class="num" id="7018711">1</span><span class="op" id="7018712">,</span>&nbsp;<span class="builtintype" id="7018714">false</span><span class="op" id="7018719">,</span>&nbsp;<span class="ident" id="7018721">errNotEnough</span><span class="op" id="7018733">}</span><span class="op" id="7018734">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018738">{</span><span class="num" id="7018739">2</span><span class="op" id="7018740">,</span>&nbsp;<span class="builtintype" id="7018742">false</span><span class="op" id="7018747">,</span>&nbsp;<span class="ident" id="7018749">nil</span><span class="op" id="7018752">}</span><span class="op" id="7018753">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018757">{</span><span class="num" id="7018758">2</span><span class="op" id="7018759">,</span>&nbsp;<span class="builtintype" id="7018761">true</span><span class="op" id="7018765">,</span>&nbsp;<span class="ident" id="7018767">errTooMuch</span><span class="op" id="7018777">}</span><span class="op" id="7018778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018782">{</span><span class="num" id="7018783">3</span><span class="op" id="7018784">,</span>&nbsp;<span class="builtintype" id="7018786">false</span><span class="op" id="7018791">,</span>&nbsp;<span class="ident" id="7018793">errTooMuch</span><span class="op" id="7018803">}</span><span class="op" id="7018804">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7018810">for</span>&nbsp;<span class="ident" id="7018814">_</span><span class="op" id="7018815">,</span>&nbsp;<span class="ident" id="7018817">tc</span>&nbsp;<span class="op" id="7018820">:=</span>&nbsp;<span class="keyword" id="7018823">range</span>&nbsp;<span class="ident" id="7018829">testCases</span>&nbsp;<span class="op" id="7018839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018843">b</span>&nbsp;<span class="op" id="7018845">:=</span>&nbsp;<span class="op" id="7018848">&amp;</span><span class="ident" id="7018849">bytes</span><span class="op" id="7018854">.</span><span class="ident" id="7018855">Buffer</span><span class="op" id="7018861">{</span><span class="op" id="7018862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018866">b</span><span class="op" id="7018867">.</span><span class="ident" id="7018868">WriteString</span><span class="op" id="7018879">(</span><span class="ident" id="7018880">headerStr</span><span class="op" id="7018889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018893">b</span><span class="op" id="7018894">.</span><span class="ident" id="7018895">WriteString</span><span class="op" id="7018906">(</span><span class="ident" id="7018907">paletteStr</span><span class="op" id="7018917">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7018921">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1&nbsp;but&nbsp;tc.nPix&nbsp;pixels.&nbsp;If&nbsp;tc.nPix&nbsp;!=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7018993">//&nbsp;then&nbsp;this&nbsp;should&nbsp;result&nbsp;in&nbsp;an&nbsp;invalid&nbsp;GIF&nbsp;image.&nbsp;First,&nbsp;write&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7019062">//&nbsp;magic&nbsp;0x2c&nbsp;(image&nbsp;descriptor)&nbsp;byte,&nbsp;bounds=(0,0)-(2,1),&nbsp;a&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7019131">//&nbsp;byte,&nbsp;and&nbsp;2-bit&nbsp;LZW&nbsp;literals.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019166">b</span><span class="op" id="7019167">.</span><span class="ident" id="7019168">WriteString</span><span class="op" id="7019179">(</span><span class="string" id="7019180">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7019226">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019230">if</span>&nbsp;<span class="ident" id="7019233">tc</span><span class="op" id="7019235">.</span><span class="ident" id="7019236">nPix</span>&nbsp;<span class="op" id="7019241">&gt;</span>&nbsp;<span class="num" id="7019243">0</span>&nbsp;<span class="op" id="7019245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019250">enc</span>&nbsp;<span class="op" id="7019254">:=</span>&nbsp;<span class="ident" id="7019257">lzwEncode</span><span class="op" id="7019266">(</span><span class="ident" id="7019267">tc</span><span class="op" id="7019269">.</span><span class="ident" id="7019270">nPix</span><span class="op" id="7019274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019279">if</span>&nbsp;<span class="builtinfunc" id="7019282">len</span><span class="op" id="7019285">(</span><span class="ident" id="7019286">enc</span><span class="op" id="7019289">)</span>&nbsp;<span class="op" id="7019291">&gt;</span>&nbsp;<span class="num" id="7019293">0xff</span>&nbsp;<span class="op" id="7019298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019304">t</span><span class="op" id="7019305">.</span><span class="ident" id="7019306">Errorf</span><span class="op" id="7019312">(</span><span class="string" id="7019313">&#34;nPix=%d,&nbsp;extra=%t:&nbsp;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="7019367">,</span>&nbsp;<span class="ident" id="7019369">tc</span><span class="op" id="7019371">.</span><span class="ident" id="7019372">nPix</span><span class="op" id="7019376">,</span>&nbsp;<span class="ident" id="7019378">tc</span><span class="op" id="7019380">.</span><span class="ident" id="7019381">extra</span><span class="op" id="7019386">,</span>&nbsp;<span class="builtinfunc" id="7019388">len</span><span class="op" id="7019391">(</span><span class="ident" id="7019392">enc</span><span class="op" id="7019395">)</span><span class="op" id="7019396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019402">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019419">b</span><span class="op" id="7019420">.</span><span class="ident" id="7019421">WriteByte</span><span class="op" id="7019430">(</span><span class="builtintype" id="7019431">byte</span><span class="op" id="7019435">(</span><span class="builtinfunc" id="7019436">len</span><span class="op" id="7019439">(</span><span class="ident" id="7019440">enc</span><span class="op" id="7019443">)</span><span class="op" id="7019444">)</span><span class="op" id="7019445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019450">b</span><span class="op" id="7019451">.</span><span class="ident" id="7019452">Write</span><span class="op" id="7019457">(</span><span class="ident" id="7019458">enc</span><span class="op" id="7019461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019469">if</span>&nbsp;<span class="ident" id="7019472">tc</span><span class="op" id="7019474">.</span><span class="ident" id="7019475">extra</span>&nbsp;<span class="op" id="7019481">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019486">b</span><span class="op" id="7019487">.</span><span class="ident" id="7019488">WriteString</span><span class="op" id="7019499">(</span><span class="string" id="7019500">&#34;\x01\x02&#34;</span><span class="op" id="7019510">)</span>&nbsp;<span class="comment" id="7019512">//&nbsp;A&nbsp;1-byte&nbsp;payload&nbsp;with&nbsp;an&nbsp;0x02&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019557">b</span><span class="op" id="7019558">.</span><span class="ident" id="7019559">WriteByte</span><span class="op" id="7019568">(</span><span class="num" id="7019569">0x00</span><span class="op" id="7019573">)</span>&nbsp;<span class="comment" id="7019575">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019632">b</span><span class="op" id="7019633">.</span><span class="ident" id="7019634">WriteString</span><span class="op" id="7019645">(</span><span class="ident" id="7019646">trailerStr</span><span class="op" id="7019656">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019661">got</span><span class="op" id="7019664">,</span>&nbsp;<span class="ident" id="7019666">err</span>&nbsp;<span class="op" id="7019670">:=</span>&nbsp;<span class="ident" id="7019673">Decode</span><span class="op" id="7019679">(</span><span class="ident" id="7019680">b</span><span class="op" id="7019681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019685">if</span>&nbsp;<span class="ident" id="7019688">err</span>&nbsp;<span class="op" id="7019692">!=</span>&nbsp;<span class="ident" id="7019695">tc</span><span class="op" id="7019697">.</span><span class="ident" id="7019698">wantErr</span>&nbsp;<span class="op" id="7019706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019711">t</span><span class="op" id="7019712">.</span><span class="ident" id="7019713">Errorf</span><span class="op" id="7019719">(</span><span class="string" id="7019720">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7019757">,</span>&nbsp;<span class="ident" id="7019759">tc</span><span class="op" id="7019761">.</span><span class="ident" id="7019762">nPix</span><span class="op" id="7019766">,</span>&nbsp;<span class="ident" id="7019768">tc</span><span class="op" id="7019770">.</span><span class="ident" id="7019771">extra</span><span class="op" id="7019776">,</span>&nbsp;<span class="ident" id="7019778">err</span><span class="op" id="7019781">,</span>&nbsp;<span class="ident" id="7019783">tc</span><span class="op" id="7019785">.</span><span class="ident" id="7019786">wantErr</span><span class="op" id="7019793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019802">if</span>&nbsp;<span class="ident" id="7019805">tc</span><span class="op" id="7019807">.</span><span class="ident" id="7019808">wantErr</span>&nbsp;<span class="op" id="7019816">!=</span>&nbsp;<span class="ident" id="7019819">nil</span>&nbsp;<span class="op" id="7019823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019828">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019843">want</span>&nbsp;<span class="op" id="7019848">:=</span>&nbsp;<span class="op" id="7019851">&amp;</span><span class="ident" id="7019852">image</span><span class="op" id="7019857">.</span><span class="ident" id="7019858">Paletted</span><span class="op" id="7019866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019871">Pix</span><span class="op" id="7019874">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7019879">[</span><span class="op" id="7019880">]</span><span class="builtintype" id="7019881">uint8</span><span class="op" id="7019886">{</span><span class="num" id="7019887">0</span><span class="op" id="7019888">,</span>&nbsp;<span class="num" id="7019890">0</span><span class="op" id="7019891">}</span><span class="op" id="7019892">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019897">Stride</span><span class="op" id="7019903">:</span>&nbsp;<span class="num" id="7019905">2</span><span class="op" id="7019906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019911">Rect</span><span class="op" id="7019915">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7019919">image</span><span class="op" id="7019924">.</span><span class="ident" id="7019925">Rect</span><span class="op" id="7019929">(</span><span class="num" id="7019930">0</span><span class="op" id="7019931">,</span>&nbsp;<span class="num" id="7019933">0</span><span class="op" id="7019934">,</span>&nbsp;<span class="num" id="7019936">2</span><span class="op" id="7019937">,</span>&nbsp;<span class="num" id="7019939">1</span><span class="op" id="7019940">)</span><span class="op" id="7019941">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019946">Palette</span><span class="op" id="7019953">:</span>&nbsp;<span class="ident" id="7019955">color</span><span class="op" id="7019960">.</span><span class="ident" id="7019961">Palette</span><span class="op" id="7019968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019974">color</span><span class="op" id="7019979">.</span><span class="ident" id="7019980">RGBA</span><span class="op" id="7019984">{</span><span class="num" id="7019985">0x10</span><span class="op" id="7019989">,</span>&nbsp;<span class="num" id="7019991">0x20</span><span class="op" id="7019995">,</span>&nbsp;<span class="num" id="7019997">0x30</span><span class="op" id="7020001">,</span>&nbsp;<span class="num" id="7020003">0xff</span><span class="op" id="7020007">}</span><span class="op" id="7020008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020014">color</span><span class="op" id="7020019">.</span><span class="ident" id="7020020">RGBA</span><span class="op" id="7020024">{</span><span class="num" id="7020025">0x40</span><span class="op" id="7020029">,</span>&nbsp;<span class="num" id="7020031">0x50</span><span class="op" id="7020035">,</span>&nbsp;<span class="num" id="7020037">0x60</span><span class="op" id="7020041">,</span>&nbsp;<span class="num" id="7020043">0xff</span><span class="op" id="7020047">}</span><span class="op" id="7020048">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020053">}</span><span class="op" id="7020054">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020062">if</span>&nbsp;<span class="op" id="7020065">!</span><span class="ident" id="7020066">reflect</span><span class="op" id="7020073">.</span><span class="ident" id="7020074">DeepEqual</span><span class="op" id="7020083">(</span><span class="ident" id="7020084">got</span><span class="op" id="7020087">,</span>&nbsp;<span class="ident" id="7020089">want</span><span class="op" id="7020093">)</span>&nbsp;<span class="op" id="7020095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020100">t</span><span class="op" id="7020101">.</span><span class="ident" id="7020102">Errorf</span><span class="op" id="7020108">(</span><span class="string" id="7020109">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7020146">,</span>&nbsp;<span class="ident" id="7020148">tc</span><span class="op" id="7020150">.</span><span class="ident" id="7020151">nPix</span><span class="op" id="7020155">,</span>&nbsp;<span class="ident" id="7020157">tc</span><span class="op" id="7020159">.</span><span class="ident" id="7020160">extra</span><span class="op" id="7020165">,</span>&nbsp;<span class="ident" id="7020167">got</span><span class="op" id="7020170">,</span>&nbsp;<span class="ident" id="7020172">want</span><span class="op" id="7020176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020180">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020183">}</span><br>
<span class="lineno"></span><span class="op" id="7020185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7020188">func</span>&nbsp;<span class="ident" id="7020193">TestTransparentIndex</span><span class="op" id="7020213">(</span><span class="ident" id="7020214">t</span>&nbsp;<span class="op" id="7020216">*</span><span class="ident" id="7020217">testing</span><span class="op" id="7020224">.</span><span class="ident" id="7020225">T</span><span class="op" id="7020226">)</span>&nbsp;<span class="op" id="7020228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020231">b</span>&nbsp;<span class="op" id="7020233">:=</span>&nbsp;<span class="op" id="7020236">&amp;</span><span class="ident" id="7020237">bytes</span><span class="op" id="7020242">.</span><span class="ident" id="7020243">Buffer</span><span class="op" id="7020249">{</span><span class="op" id="7020250">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020253">b</span><span class="op" id="7020254">.</span><span class="ident" id="7020255">WriteString</span><span class="op" id="7020266">(</span><span class="ident" id="7020267">headerStr</span><span class="op" id="7020276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020279">b</span><span class="op" id="7020280">.</span><span class="ident" id="7020281">WriteString</span><span class="op" id="7020292">(</span><span class="ident" id="7020293">paletteStr</span><span class="op" id="7020303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020306">for</span>&nbsp;<span class="ident" id="7020310">transparentIndex</span>&nbsp;<span class="op" id="7020327">:=</span>&nbsp;<span class="num" id="7020330">0</span><span class="op" id="7020331">;</span>&nbsp;<span class="ident" id="7020333">transparentIndex</span>&nbsp;<span class="op" id="7020350">&lt;</span>&nbsp;<span class="num" id="7020352">3</span><span class="op" id="7020353">;</span>&nbsp;<span class="ident" id="7020355">transparentIndex</span><span class="op" id="7020371">++</span>&nbsp;<span class="op" id="7020374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020378">if</span>&nbsp;<span class="ident" id="7020381">transparentIndex</span>&nbsp;<span class="op" id="7020398">&lt;</span>&nbsp;<span class="num" id="7020400">2</span>&nbsp;<span class="op" id="7020402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7020407">//&nbsp;Write&nbsp;the&nbsp;graphic&nbsp;control&nbsp;for&nbsp;the&nbsp;transparent&nbsp;index.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020466">b</span><span class="op" id="7020467">.</span><span class="ident" id="7020468">WriteString</span><span class="op" id="7020479">(</span><span class="string" id="7020480">&#34;\x21\xf9\x00\x01\x00\x00&#34;</span><span class="op" id="7020506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020511">b</span><span class="op" id="7020512">.</span><span class="ident" id="7020513">WriteByte</span><span class="op" id="7020522">(</span><span class="builtintype" id="7020523">byte</span><span class="op" id="7020527">(</span><span class="ident" id="7020528">transparentIndex</span><span class="op" id="7020544">)</span><span class="op" id="7020545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020550">b</span><span class="op" id="7020551">.</span><span class="ident" id="7020552">WriteByte</span><span class="op" id="7020561">(</span><span class="num" id="7020562">0</span><span class="op" id="7020563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7020571">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1,&nbsp;as&nbsp;per&nbsp;TestDecode.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020627">b</span><span class="op" id="7020628">.</span><span class="ident" id="7020629">WriteString</span><span class="op" id="7020640">(</span><span class="string" id="7020641">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7020687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020691">enc</span>&nbsp;<span class="op" id="7020695">:=</span>&nbsp;<span class="ident" id="7020698">lzwEncode</span><span class="op" id="7020707">(</span><span class="num" id="7020708">2</span><span class="op" id="7020709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020713">if</span>&nbsp;<span class="builtinfunc" id="7020716">len</span><span class="op" id="7020719">(</span><span class="ident" id="7020720">enc</span><span class="op" id="7020723">)</span>&nbsp;<span class="op" id="7020725">&gt;</span>&nbsp;<span class="num" id="7020727">0xff</span>&nbsp;<span class="op" id="7020732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020737">t</span><span class="op" id="7020738">.</span><span class="ident" id="7020739">Fatalf</span><span class="op" id="7020745">(</span><span class="string" id="7020746">&#34;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="7020781">,</span>&nbsp;<span class="builtinfunc" id="7020783">len</span><span class="op" id="7020786">(</span><span class="ident" id="7020787">enc</span><span class="op" id="7020790">)</span><span class="op" id="7020791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020795">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020799">b</span><span class="op" id="7020800">.</span><span class="ident" id="7020801">WriteByte</span><span class="op" id="7020810">(</span><span class="builtintype" id="7020811">byte</span><span class="op" id="7020815">(</span><span class="builtinfunc" id="7020816">len</span><span class="op" id="7020819">(</span><span class="ident" id="7020820">enc</span><span class="op" id="7020823">)</span><span class="op" id="7020824">)</span><span class="op" id="7020825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020829">b</span><span class="op" id="7020830">.</span><span class="ident" id="7020831">Write</span><span class="op" id="7020836">(</span><span class="ident" id="7020837">enc</span><span class="op" id="7020840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020844">b</span><span class="op" id="7020845">.</span><span class="ident" id="7020846">WriteByte</span><span class="op" id="7020855">(</span><span class="num" id="7020856">0x00</span><span class="op" id="7020860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020866">b</span><span class="op" id="7020867">.</span><span class="ident" id="7020868">WriteString</span><span class="op" id="7020879">(</span><span class="ident" id="7020880">trailerStr</span><span class="op" id="7020890">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020894">g</span><span class="op" id="7020895">,</span>&nbsp;<span class="ident" id="7020897">err</span>&nbsp;<span class="op" id="7020901">:=</span>&nbsp;<span class="ident" id="7020904">DecodeAll</span><span class="op" id="7020913">(</span><span class="ident" id="7020914">b</span><span class="op" id="7020915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020918">if</span>&nbsp;<span class="ident" id="7020921">err</span>&nbsp;<span class="op" id="7020925">!=</span>&nbsp;<span class="ident" id="7020928">nil</span>&nbsp;<span class="op" id="7020932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020936">t</span><span class="op" id="7020937">.</span><span class="ident" id="7020938">Fatalf</span><span class="op" id="7020944">(</span><span class="string" id="7020945">&#34;DecodeAll:&nbsp;%v&#34;</span><span class="op" id="7020960">,</span>&nbsp;<span class="ident" id="7020962">err</span><span class="op" id="7020965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020968">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020971">c0</span>&nbsp;<span class="op" id="7020974">:=</span>&nbsp;<span class="ident" id="7020977">color</span><span class="op" id="7020982">.</span><span class="ident" id="7020983">RGBA</span><span class="op" id="7020987">{</span><span class="ident" id="7020988">paletteStr</span><span class="op" id="7020998">[</span><span class="num" id="7020999">0</span><span class="op" id="7021000">]</span><span class="op" id="7021001">,</span>&nbsp;<span class="ident" id="7021003">paletteStr</span><span class="op" id="7021013">[</span><span class="num" id="7021014">1</span><span class="op" id="7021015">]</span><span class="op" id="7021016">,</span>&nbsp;<span class="ident" id="7021018">paletteStr</span><span class="op" id="7021028">[</span><span class="num" id="7021029">2</span><span class="op" id="7021030">]</span><span class="op" id="7021031">,</span>&nbsp;<span class="num" id="7021033">0xff</span><span class="op" id="7021037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021040">c1</span>&nbsp;<span class="op" id="7021043">:=</span>&nbsp;<span class="ident" id="7021046">color</span><span class="op" id="7021051">.</span><span class="ident" id="7021052">RGBA</span><span class="op" id="7021056">{</span><span class="ident" id="7021057">paletteStr</span><span class="op" id="7021067">[</span><span class="num" id="7021068">3</span><span class="op" id="7021069">]</span><span class="op" id="7021070">,</span>&nbsp;<span class="ident" id="7021072">paletteStr</span><span class="op" id="7021082">[</span><span class="num" id="7021083">4</span><span class="op" id="7021084">]</span><span class="op" id="7021085">,</span>&nbsp;<span class="ident" id="7021087">paletteStr</span><span class="op" id="7021097">[</span><span class="num" id="7021098">5</span><span class="op" id="7021099">]</span><span class="op" id="7021100">,</span>&nbsp;<span class="num" id="7021102">0xff</span><span class="op" id="7021106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021109">cz</span>&nbsp;<span class="op" id="7021112">:=</span>&nbsp;<span class="ident" id="7021115">color</span><span class="op" id="7021120">.</span><span class="ident" id="7021121">RGBA</span><span class="op" id="7021125">{</span><span class="op" id="7021126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021129">wants</span>&nbsp;<span class="op" id="7021135">:=</span>&nbsp;<span class="op" id="7021138">[</span><span class="op" id="7021139">]</span><span class="ident" id="7021140">color</span><span class="op" id="7021145">.</span><span class="ident" id="7021146">Palette</span><span class="op" id="7021153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021157">{</span><span class="ident" id="7021158">cz</span><span class="op" id="7021160">,</span>&nbsp;<span class="ident" id="7021162">c1</span><span class="op" id="7021164">}</span><span class="op" id="7021165">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021169">{</span><span class="ident" id="7021170">c0</span><span class="op" id="7021172">,</span>&nbsp;<span class="ident" id="7021174">cz</span><span class="op" id="7021176">}</span><span class="op" id="7021177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021181">{</span><span class="ident" id="7021182">c0</span><span class="op" id="7021184">,</span>&nbsp;<span class="ident" id="7021186">c1</span><span class="op" id="7021188">}</span><span class="op" id="7021189">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021195">if</span>&nbsp;<span class="builtinfunc" id="7021198">len</span><span class="op" id="7021201">(</span><span class="ident" id="7021202">g</span><span class="op" id="7021203">.</span><span class="ident" id="7021204">Image</span><span class="op" id="7021209">)</span>&nbsp;<span class="op" id="7021211">!=</span>&nbsp;<span class="builtinfunc" id="7021214">len</span><span class="op" id="7021217">(</span><span class="ident" id="7021218">wants</span><span class="op" id="7021223">)</span>&nbsp;<span class="op" id="7021225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021229">t</span><span class="op" id="7021230">.</span><span class="ident" id="7021231">Fatalf</span><span class="op" id="7021237">(</span><span class="string" id="7021238">&#34;got&nbsp;%d&nbsp;images,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7021262">,</span>&nbsp;<span class="builtinfunc" id="7021264">len</span><span class="op" id="7021267">(</span><span class="ident" id="7021268">g</span><span class="op" id="7021269">.</span><span class="ident" id="7021270">Image</span><span class="op" id="7021275">)</span><span class="op" id="7021276">,</span>&nbsp;<span class="builtinfunc" id="7021278">len</span><span class="op" id="7021281">(</span><span class="ident" id="7021282">wants</span><span class="op" id="7021287">)</span><span class="op" id="7021288">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021294">for</span>&nbsp;<span class="ident" id="7021298">i</span><span class="op" id="7021299">,</span>&nbsp;<span class="ident" id="7021301">want</span>&nbsp;<span class="op" id="7021306">:=</span>&nbsp;<span class="keyword" id="7021309">range</span>&nbsp;<span class="ident" id="7021315">wants</span>&nbsp;<span class="op" id="7021321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021325">got</span>&nbsp;<span class="op" id="7021329">:=</span>&nbsp;<span class="ident" id="7021332">g</span><span class="op" id="7021333">.</span><span class="ident" id="7021334">Image</span><span class="op" id="7021339">[</span><span class="ident" id="7021340">i</span><span class="op" id="7021341">]</span><span class="op" id="7021342">.</span><span class="ident" id="7021343">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021353">if</span>&nbsp;<span class="op" id="7021356">!</span><span class="ident" id="7021357">reflect</span><span class="op" id="7021364">.</span><span class="ident" id="7021365">DeepEqual</span><span class="op" id="7021374">(</span><span class="ident" id="7021375">got</span><span class="op" id="7021378">,</span>&nbsp;<span class="ident" id="7021380">want</span><span class="op" id="7021384">)</span>&nbsp;<span class="op" id="7021386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021391">t</span><span class="op" id="7021392">.</span><span class="ident" id="7021393">Errorf</span><span class="op" id="7021399">(</span><span class="string" id="7021400">&#34;palette&nbsp;#%d:\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7021432">,</span>&nbsp;<span class="ident" id="7021434">i</span><span class="op" id="7021435">,</span>&nbsp;<span class="ident" id="7021437">got</span><span class="op" id="7021440">,</span>&nbsp;<span class="ident" id="7021442">want</span><span class="op" id="7021446">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021453">}</span><br>
<span class="lineno"></span><span class="op" id="7021455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7021458">//&nbsp;testGIF&nbsp;is&nbsp;a&nbsp;simple&nbsp;GIF&nbsp;that&nbsp;we&nbsp;can&nbsp;modify&nbsp;to&nbsp;test&nbsp;different&nbsp;scenarios.</span><br>
<span class="lineno">140</span><span class="keyword" id="7021533">var</span>&nbsp;<span class="ident" id="7021537">testGIF</span>&nbsp;<span class="op" id="7021545">=</span>&nbsp;<span class="op" id="7021547">[</span><span class="op" id="7021548">]</span><span class="builtintype" id="7021549">byte</span><span class="op" id="7021553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7021556">&#39;G&#39;</span><span class="op" id="7021559">,</span>&nbsp;<span class="string" id="7021561">&#39;I&#39;</span><span class="op" id="7021564">,</span>&nbsp;<span class="string" id="7021566">&#39;F&#39;</span><span class="op" id="7021569">,</span>&nbsp;<span class="string" id="7021571">&#39;8&#39;</span><span class="op" id="7021574">,</span>&nbsp;<span class="string" id="7021576">&#39;9&#39;</span><span class="op" id="7021579">,</span>&nbsp;<span class="string" id="7021581">&#39;a&#39;</span><span class="op" id="7021584">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7021587">1</span><span class="op" id="7021588">,</span>&nbsp;<span class="num" id="7021590">0</span><span class="op" id="7021591">,</span>&nbsp;<span class="num" id="7021593">1</span><span class="op" id="7021594">,</span>&nbsp;<span class="num" id="7021596">0</span><span class="op" id="7021597">,</span>&nbsp;<span class="comment" id="7021599">//&nbsp;w=1,&nbsp;h=1&nbsp;(6)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7021616">128</span><span class="op" id="7021619">,</span>&nbsp;<span class="num" id="7021621">0</span><span class="op" id="7021622">,</span>&nbsp;<span class="num" id="7021624">0</span><span class="op" id="7021625">,</span>&nbsp;<span class="comment" id="7021627">//&nbsp;headerFields,&nbsp;bg,&nbsp;aspect&nbsp;(10)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7021661">0</span><span class="op" id="7021662">,</span>&nbsp;<span class="num" id="7021664">0</span><span class="op" id="7021665">,</span>&nbsp;<span class="num" id="7021667">0</span><span class="op" id="7021668">,</span>&nbsp;<span class="num" id="7021670">1</span><span class="op" id="7021671">,</span>&nbsp;<span class="num" id="7021673">1</span><span class="op" id="7021674">,</span>&nbsp;<span class="num" id="7021676">1</span><span class="op" id="7021677">,</span>&nbsp;<span class="comment" id="7021679">//&nbsp;color&nbsp;map&nbsp;and&nbsp;graphics&nbsp;control&nbsp;(13)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7021719">0x21</span><span class="op" id="7021723">,</span>&nbsp;<span class="num" id="7021725">0xf9</span><span class="op" id="7021729">,</span>&nbsp;<span class="num" id="7021731">0x04</span><span class="op" id="7021735">,</span>&nbsp;<span class="num" id="7021737">0x00</span><span class="op" id="7021741">,</span>&nbsp;<span class="num" id="7021743">0x00</span><span class="op" id="7021747">,</span>&nbsp;<span class="num" id="7021749">0x00</span><span class="op" id="7021753">,</span>&nbsp;<span class="num" id="7021755">0xff</span><span class="op" id="7021759">,</span>&nbsp;<span class="num" id="7021761">0x00</span><span class="op" id="7021765">,</span>&nbsp;<span class="comment" id="7021767">//&nbsp;(19)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7021776">//&nbsp;frame&nbsp;1&nbsp;(0,0&nbsp;-&nbsp;1,1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7021800">0x2c</span><span class="op" id="7021804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7021807">0x00</span><span class="op" id="7021811">,</span>&nbsp;<span class="num" id="7021813">0x00</span><span class="op" id="7021817">,</span>&nbsp;<span class="num" id="7021819">0x00</span><span class="op" id="7021823">,</span>&nbsp;<span class="num" id="7021825">0x00</span><span class="op" id="7021829">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7021832">0x01</span><span class="op" id="7021836">,</span>&nbsp;<span class="num" id="7021838">0x00</span><span class="op" id="7021842">,</span>&nbsp;<span class="num" id="7021844">0x01</span><span class="op" id="7021848">,</span>&nbsp;<span class="num" id="7021850">0x00</span><span class="op" id="7021854">,</span>&nbsp;<span class="comment" id="7021856">//&nbsp;(32)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7021865">0x00</span><span class="op" id="7021869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7021872">0x02</span><span class="op" id="7021876">,</span>&nbsp;<span class="num" id="7021878">0x02</span><span class="op" id="7021882">,</span>&nbsp;<span class="num" id="7021884">0x4c</span><span class="op" id="7021888">,</span>&nbsp;<span class="num" id="7021890">0x01</span><span class="op" id="7021894">,</span>&nbsp;<span class="num" id="7021896">0x00</span><span class="op" id="7021900">,</span>&nbsp;<span class="comment" id="7021902">//&nbsp;lzw&nbsp;pixels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7021917">//&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7021929">0x3b</span><span class="op" id="7021933">,</span><br>
<span class="lineno"></span><span class="op" id="7021935">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="7021938">func</span>&nbsp;<span class="ident" id="7021943">try</span><span class="op" id="7021946">(</span><span class="ident" id="7021947">t</span>&nbsp;<span class="op" id="7021949">*</span><span class="ident" id="7021950">testing</span><span class="op" id="7021957">.</span><span class="ident" id="7021958">T</span><span class="op" id="7021959">,</span>&nbsp;<span class="ident" id="7021961">b</span>&nbsp;<span class="op" id="7021963">[</span><span class="op" id="7021964">]</span><span class="builtintype" id="7021965">byte</span><span class="op" id="7021969">,</span>&nbsp;<span class="ident" id="7021971">want</span>&nbsp;<span class="builtintype" id="7021976">string</span><span class="op" id="7021982">)</span>&nbsp;<span class="op" id="7021984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021987">_</span><span class="op" id="7021988">,</span>&nbsp;<span class="ident" id="7021990">err</span>&nbsp;<span class="op" id="7021994">:=</span>&nbsp;<span class="ident" id="7021997">DecodeAll</span><span class="op" id="7022006">(</span><span class="ident" id="7022007">bytes</span><span class="op" id="7022012">.</span><span class="ident" id="7022013">NewReader</span><span class="op" id="7022022">(</span><span class="ident" id="7022023">b</span><span class="op" id="7022024">)</span><span class="op" id="7022025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022028">var</span>&nbsp;<span class="ident" id="7022032">got</span>&nbsp;<span class="builtintype" id="7022036">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022044">if</span>&nbsp;<span class="ident" id="7022047">err</span>&nbsp;<span class="op" id="7022051">!=</span>&nbsp;<span class="ident" id="7022054">nil</span>&nbsp;<span class="op" id="7022058">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022062">got</span>&nbsp;<span class="op" id="7022066">=</span>&nbsp;<span class="ident" id="7022068">err</span><span class="op" id="7022071">.</span><span class="ident" id="7022072">Error</span><span class="op" id="7022077">(</span><span class="op" id="7022078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022084">if</span>&nbsp;<span class="ident" id="7022087">got</span>&nbsp;<span class="op" id="7022091">!=</span>&nbsp;<span class="ident" id="7022094">want</span>&nbsp;<span class="op" id="7022099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022103">t</span><span class="op" id="7022104">.</span><span class="ident" id="7022105">Fatalf</span><span class="op" id="7022111">(</span><span class="string" id="7022112">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7022129">,</span>&nbsp;<span class="ident" id="7022131">got</span><span class="op" id="7022134">,</span>&nbsp;<span class="ident" id="7022136">want</span><span class="op" id="7022140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022143">}</span><br>
<span class="lineno">165</span><span class="op" id="7022145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7022148">func</span>&nbsp;<span class="ident" id="7022153">TestBounds</span><span class="op" id="7022163">(</span><span class="ident" id="7022164">t</span>&nbsp;<span class="op" id="7022166">*</span><span class="ident" id="7022167">testing</span><span class="op" id="7022174">.</span><span class="ident" id="7022175">T</span><span class="op" id="7022176">)</span>&nbsp;<span class="op" id="7022178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7022181">//&nbsp;Make&nbsp;a&nbsp;local&nbsp;copy&nbsp;of&nbsp;testGIF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022215">gif</span>&nbsp;<span class="op" id="7022219">:=</span>&nbsp;<span class="builtinfunc" id="7022222">make</span><span class="op" id="7022226">(</span><span class="op" id="7022227">[</span><span class="op" id="7022228">]</span><span class="builtintype" id="7022229">byte</span><span class="op" id="7022233">,</span>&nbsp;<span class="builtinfunc" id="7022235">len</span><span class="op" id="7022238">(</span><span class="ident" id="7022239">testGIF</span><span class="op" id="7022246">)</span><span class="op" id="7022247">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7022250">copy</span><span class="op" id="7022254">(</span><span class="ident" id="7022255">gif</span><span class="op" id="7022258">,</span>&nbsp;<span class="ident" id="7022260">testGIF</span><span class="op" id="7022267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7022270">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;big,&nbsp;just&nbsp;by&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022312">gif</span><span class="op" id="7022315">[</span><span class="num" id="7022316">32</span><span class="op" id="7022318">]</span>&nbsp;<span class="op" id="7022320">=</span>&nbsp;<span class="num" id="7022322">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022325">want</span>&nbsp;<span class="op" id="7022330">:=</span>&nbsp;<span class="string" id="7022333">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022379">try</span><span class="op" id="7022382">(</span><span class="ident" id="7022383">t</span><span class="op" id="7022384">,</span>&nbsp;<span class="ident" id="7022386">gif</span><span class="op" id="7022389">,</span>&nbsp;<span class="ident" id="7022391">want</span><span class="op" id="7022395">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7022399">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;small;&nbsp;does&nbsp;not&nbsp;trigger&nbsp;bounds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7022454">//&nbsp;check,&nbsp;but&nbsp;now&nbsp;there&#39;s&nbsp;too&nbsp;much&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022496">gif</span><span class="op" id="7022499">[</span><span class="num" id="7022500">32</span><span class="op" id="7022502">]</span>&nbsp;<span class="op" id="7022504">=</span>&nbsp;<span class="num" id="7022506">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022509">want</span>&nbsp;<span class="op" id="7022514">=</span>&nbsp;<span class="string" id="7022516">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022544">try</span><span class="op" id="7022547">(</span><span class="ident" id="7022548">t</span><span class="op" id="7022549">,</span>&nbsp;<span class="ident" id="7022551">gif</span><span class="op" id="7022554">,</span>&nbsp;<span class="ident" id="7022556">want</span><span class="op" id="7022560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022563">gif</span><span class="op" id="7022566">[</span><span class="num" id="7022567">32</span><span class="op" id="7022569">]</span>&nbsp;<span class="op" id="7022571">=</span>&nbsp;<span class="num" id="7022573">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7022577">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;really&nbsp;big,&nbsp;expect&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022626">want</span>&nbsp;<span class="op" id="7022631">=</span>&nbsp;<span class="string" id="7022633">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022679">for</span>&nbsp;<span class="ident" id="7022683">i</span>&nbsp;<span class="op" id="7022685">:=</span>&nbsp;<span class="num" id="7022688">0</span><span class="op" id="7022689">;</span>&nbsp;<span class="ident" id="7022691">i</span>&nbsp;<span class="op" id="7022693">&lt;</span>&nbsp;<span class="num" id="7022695">4</span><span class="op" id="7022696">;</span>&nbsp;<span class="ident" id="7022698">i</span><span class="op" id="7022699">++</span>&nbsp;<span class="op" id="7022702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022706">gif</span><span class="op" id="7022709">[</span><span class="num" id="7022710">32</span><span class="op" id="7022712">+</span><span class="ident" id="7022713">i</span><span class="op" id="7022714">]</span>&nbsp;<span class="op" id="7022716">=</span>&nbsp;<span class="num" id="7022718">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022727">try</span><span class="op" id="7022730">(</span><span class="ident" id="7022731">t</span><span class="op" id="7022732">,</span>&nbsp;<span class="ident" id="7022734">gif</span><span class="op" id="7022737">,</span>&nbsp;<span class="ident" id="7022739">want</span><span class="op" id="7022743">)</span><br>
<span class="lineno"></span><span class="op" id="7022745">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="7022748">func</span>&nbsp;<span class="ident" id="7022753">TestNoPalette</span><span class="op" id="7022766">(</span><span class="ident" id="7022767">t</span>&nbsp;<span class="op" id="7022769">*</span><span class="ident" id="7022770">testing</span><span class="op" id="7022777">.</span><span class="ident" id="7022778">T</span><span class="op" id="7022779">)</span>&nbsp;<span class="op" id="7022781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022784">b</span>&nbsp;<span class="op" id="7022786">:=</span>&nbsp;<span class="op" id="7022789">&amp;</span><span class="ident" id="7022790">bytes</span><span class="op" id="7022795">.</span><span class="ident" id="7022796">Buffer</span><span class="op" id="7022802">{</span><span class="op" id="7022803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7022807">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;no&nbsp;palette,&nbsp;so&nbsp;any&nbsp;pixel&nbsp;at&nbsp;all</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7022866">//&nbsp;will&nbsp;be&nbsp;invalid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022887">b</span><span class="op" id="7022888">.</span><span class="ident" id="7022889">WriteString</span><span class="op" id="7022900">(</span><span class="ident" id="7022901">headerStr</span><span class="op" id="7022910">[</span><span class="op" id="7022911">:</span><span class="builtinfunc" id="7022912">len</span><span class="op" id="7022915">(</span><span class="ident" id="7022916">headerStr</span><span class="op" id="7022925">)</span><span class="op" id="7022926">-</span><span class="num" id="7022927">3</span><span class="op" id="7022928">]</span><span class="op" id="7022929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022932">b</span><span class="op" id="7022933">.</span><span class="ident" id="7022934">WriteString</span><span class="op" id="7022945">(</span><span class="string" id="7022946">&#34;\x00\x00\x00&#34;</span><span class="op" id="7022960">)</span>&nbsp;<span class="comment" id="7022962">//&nbsp;No&nbsp;global&nbsp;palette.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7022986">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023031">b</span><span class="op" id="7023032">.</span><span class="ident" id="7023033">WriteString</span><span class="op" id="7023044">(</span><span class="string" id="7023045">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7023091">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7023095">//&nbsp;Encode&nbsp;the&nbsp;pixels:&nbsp;neither&nbsp;is&nbsp;in&nbsp;range,&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023168">pix</span>&nbsp;<span class="op" id="7023172">:=</span>&nbsp;<span class="op" id="7023175">[</span><span class="op" id="7023176">]</span><span class="builtintype" id="7023177">byte</span><span class="op" id="7023181">{</span><span class="num" id="7023182">0</span><span class="op" id="7023183">,</span>&nbsp;<span class="num" id="7023185">128</span><span class="op" id="7023188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023191">enc</span>&nbsp;<span class="op" id="7023195">:=</span>&nbsp;<span class="op" id="7023198">&amp;</span><span class="ident" id="7023199">bytes</span><span class="op" id="7023204">.</span><span class="ident" id="7023205">Buffer</span><span class="op" id="7023211">{</span><span class="op" id="7023212">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023215">w</span>&nbsp;<span class="op" id="7023217">:=</span>&nbsp;<span class="ident" id="7023220">lzw</span><span class="op" id="7023223">.</span><span class="ident" id="7023224">NewWriter</span><span class="op" id="7023233">(</span><span class="ident" id="7023234">enc</span><span class="op" id="7023237">,</span>&nbsp;<span class="ident" id="7023239">lzw</span><span class="op" id="7023242">.</span><span class="ident" id="7023243">LSB</span><span class="op" id="7023246">,</span>&nbsp;<span class="num" id="7023248">2</span><span class="op" id="7023249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023252">w</span><span class="op" id="7023253">.</span><span class="ident" id="7023254">Write</span><span class="op" id="7023259">(</span><span class="ident" id="7023260">pix</span><span class="op" id="7023263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023266">w</span><span class="op" id="7023267">.</span><span class="ident" id="7023268">Close</span><span class="op" id="7023273">(</span><span class="op" id="7023274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023277">b</span><span class="op" id="7023278">.</span><span class="ident" id="7023279">WriteByte</span><span class="op" id="7023288">(</span><span class="builtintype" id="7023289">byte</span><span class="op" id="7023293">(</span><span class="builtinfunc" id="7023294">len</span><span class="op" id="7023297">(</span><span class="ident" id="7023298">enc</span><span class="op" id="7023301">.</span><span class="ident" id="7023302">Bytes</span><span class="op" id="7023307">(</span><span class="op" id="7023308">)</span><span class="op" id="7023309">)</span><span class="op" id="7023310">)</span><span class="op" id="7023311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023314">b</span><span class="op" id="7023315">.</span><span class="ident" id="7023316">Write</span><span class="op" id="7023321">(</span><span class="ident" id="7023322">enc</span><span class="op" id="7023325">.</span><span class="ident" id="7023326">Bytes</span><span class="op" id="7023331">(</span><span class="op" id="7023332">)</span><span class="op" id="7023333">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023336">b</span><span class="op" id="7023337">.</span><span class="ident" id="7023338">WriteByte</span><span class="op" id="7023347">(</span><span class="num" id="7023348">0x00</span><span class="op" id="7023352">)</span>&nbsp;<span class="comment" id="7023354">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023411">b</span><span class="op" id="7023412">.</span><span class="ident" id="7023413">WriteString</span><span class="op" id="7023424">(</span><span class="ident" id="7023425">trailerStr</span><span class="op" id="7023435">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023439">try</span><span class="op" id="7023442">(</span><span class="ident" id="7023443">t</span><span class="op" id="7023444">,</span>&nbsp;<span class="ident" id="7023446">b</span><span class="op" id="7023447">.</span><span class="ident" id="7023448">Bytes</span><span class="op" id="7023453">(</span><span class="op" id="7023454">)</span><span class="op" id="7023455">,</span>&nbsp;<span class="string" id="7023457">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="7023483">)</span><br>
<span class="lineno">215</span><span class="op" id="7023485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7023488">func</span>&nbsp;<span class="ident" id="7023493">TestPixelOutsidePaletteRange</span><span class="op" id="7023521">(</span><span class="ident" id="7023522">t</span>&nbsp;<span class="op" id="7023524">*</span><span class="ident" id="7023525">testing</span><span class="op" id="7023532">.</span><span class="ident" id="7023533">T</span><span class="op" id="7023534">)</span>&nbsp;<span class="op" id="7023536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7023539">for</span>&nbsp;<span class="ident" id="7023543">_</span><span class="op" id="7023544">,</span>&nbsp;<span class="ident" id="7023546">pval</span>&nbsp;<span class="op" id="7023551">:=</span>&nbsp;<span class="keyword" id="7023554">range</span>&nbsp;<span class="op" id="7023560">[</span><span class="op" id="7023561">]</span><span class="builtintype" id="7023562">byte</span><span class="op" id="7023566">{</span><span class="num" id="7023567">0</span><span class="op" id="7023568">,</span>&nbsp;<span class="num" id="7023570">1</span><span class="op" id="7023571">,</span>&nbsp;<span class="num" id="7023573">2</span><span class="op" id="7023574">,</span>&nbsp;<span class="num" id="7023576">3</span><span class="op" id="7023577">,</span>&nbsp;<span class="num" id="7023579">255</span><span class="op" id="7023582">}</span>&nbsp;<span class="op" id="7023584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023588">b</span>&nbsp;<span class="op" id="7023590">:=</span>&nbsp;<span class="op" id="7023593">&amp;</span><span class="ident" id="7023594">bytes</span><span class="op" id="7023599">.</span><span class="ident" id="7023600">Buffer</span><span class="op" id="7023606">{</span><span class="op" id="7023607">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7023612">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;a&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023659">b</span><span class="op" id="7023660">.</span><span class="ident" id="7023661">WriteString</span><span class="op" id="7023672">(</span><span class="ident" id="7023673">headerStr</span><span class="op" id="7023682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023686">b</span><span class="op" id="7023687">.</span><span class="ident" id="7023688">WriteString</span><span class="op" id="7023699">(</span><span class="ident" id="7023700">paletteStr</span><span class="op" id="7023710">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7023715">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023761">b</span><span class="op" id="7023762">.</span><span class="ident" id="7023763">WriteString</span><span class="op" id="7023774">(</span><span class="string" id="7023775">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7023821">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7023826">//&nbsp;Encode&nbsp;the&nbsp;pixels;&nbsp;some&nbsp;pvals&nbsp;trigger&nbsp;the&nbsp;expected&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023889">pix</span>&nbsp;<span class="op" id="7023893">:=</span>&nbsp;<span class="op" id="7023896">[</span><span class="op" id="7023897">]</span><span class="builtintype" id="7023898">byte</span><span class="op" id="7023902">{</span><span class="ident" id="7023903">pval</span><span class="op" id="7023907">,</span>&nbsp;<span class="ident" id="7023909">pval</span><span class="op" id="7023913">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023917">enc</span>&nbsp;<span class="op" id="7023921">:=</span>&nbsp;<span class="op" id="7023924">&amp;</span><span class="ident" id="7023925">bytes</span><span class="op" id="7023930">.</span><span class="ident" id="7023931">Buffer</span><span class="op" id="7023937">{</span><span class="op" id="7023938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023942">w</span>&nbsp;<span class="op" id="7023944">:=</span>&nbsp;<span class="ident" id="7023947">lzw</span><span class="op" id="7023950">.</span><span class="ident" id="7023951">NewWriter</span><span class="op" id="7023960">(</span><span class="ident" id="7023961">enc</span><span class="op" id="7023964">,</span>&nbsp;<span class="ident" id="7023966">lzw</span><span class="op" id="7023969">.</span><span class="ident" id="7023970">LSB</span><span class="op" id="7023973">,</span>&nbsp;<span class="num" id="7023975">2</span><span class="op" id="7023976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023980">w</span><span class="op" id="7023981">.</span><span class="ident" id="7023982">Write</span><span class="op" id="7023987">(</span><span class="ident" id="7023988">pix</span><span class="op" id="7023991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7023995">w</span><span class="op" id="7023996">.</span><span class="ident" id="7023997">Close</span><span class="op" id="7024002">(</span><span class="op" id="7024003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024007">b</span><span class="op" id="7024008">.</span><span class="ident" id="7024009">WriteByte</span><span class="op" id="7024018">(</span><span class="builtintype" id="7024019">byte</span><span class="op" id="7024023">(</span><span class="builtinfunc" id="7024024">len</span><span class="op" id="7024027">(</span><span class="ident" id="7024028">enc</span><span class="op" id="7024031">.</span><span class="ident" id="7024032">Bytes</span><span class="op" id="7024037">(</span><span class="op" id="7024038">)</span><span class="op" id="7024039">)</span><span class="op" id="7024040">)</span><span class="op" id="7024041">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024045">b</span><span class="op" id="7024046">.</span><span class="ident" id="7024047">Write</span><span class="op" id="7024052">(</span><span class="ident" id="7024053">enc</span><span class="op" id="7024056">.</span><span class="ident" id="7024057">Bytes</span><span class="op" id="7024062">(</span><span class="op" id="7024063">)</span><span class="op" id="7024064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024068">b</span><span class="op" id="7024069">.</span><span class="ident" id="7024070">WriteByte</span><span class="op" id="7024079">(</span><span class="num" id="7024080">0x00</span><span class="op" id="7024084">)</span>&nbsp;<span class="comment" id="7024086">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024144">b</span><span class="op" id="7024145">.</span><span class="ident" id="7024146">WriteString</span><span class="op" id="7024157">(</span><span class="ident" id="7024158">trailerStr</span><span class="op" id="7024168">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7024173">//&nbsp;No&nbsp;error&nbsp;expected,&nbsp;unless&nbsp;the&nbsp;pixels&nbsp;are&nbsp;beyond&nbsp;the&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024247">want</span>&nbsp;<span class="op" id="7024252">:=</span>&nbsp;<span class="string" id="7024255">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7024260">if</span>&nbsp;<span class="ident" id="7024263">pval</span>&nbsp;<span class="op" id="7024268">&gt;=</span>&nbsp;<span class="num" id="7024271">2</span>&nbsp;<span class="op" id="7024273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024278">want</span>&nbsp;<span class="op" id="7024283">=</span>&nbsp;<span class="string" id="7024285">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7024314">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7024318">try</span><span class="op" id="7024321">(</span><span class="ident" id="7024322">t</span><span class="op" id="7024323">,</span>&nbsp;<span class="ident" id="7024325">b</span><span class="op" id="7024326">.</span><span class="ident" id="7024327">Bytes</span><span class="op" id="7024332">(</span><span class="op" id="7024333">)</span><span class="op" id="7024334">,</span>&nbsp;<span class="ident" id="7024336">want</span><span class="op" id="7024340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7024343">}</span><br>
<span class="lineno"></span><span class="op" id="7024345">}</span>
</div>
</body>
</html>
