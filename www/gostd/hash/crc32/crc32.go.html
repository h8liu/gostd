<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4316710">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4316765">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4316819">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4316870">//&nbsp;Package&nbsp;crc32&nbsp;implements&nbsp;the&nbsp;32-bit&nbsp;cyclic&nbsp;redundancy&nbsp;check,&nbsp;or&nbsp;CRC-32,</span><br>
<span class="lineno"></span><span class="comment" id="4316945">//&nbsp;checksum.&nbsp;See&nbsp;http://en.wikipedia.org/wiki/Cyclic_redundancy_check&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4317019">//&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="4317035">package</span>&nbsp;<span class="ident" id="4317043">crc32</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4317050">import</span>&nbsp;<span class="op" id="4317057">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4317060">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4317068">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="4317075">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4317078">//&nbsp;The&nbsp;size&nbsp;of&nbsp;a&nbsp;CRC-32&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4317121">const</span>&nbsp;<span class="ident" id="4317127">Size</span>&nbsp;<span class="op" id="4317132">=</span>&nbsp;<span class="num" id="4317134">4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4317137">//&nbsp;Predefined&nbsp;polynomials.</span><br>
<span class="lineno"></span><span class="keyword" id="4317164">const</span>&nbsp;<span class="op" id="4317170">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4317173">//&nbsp;IEEE&nbsp;is&nbsp;by&nbsp;far&nbsp;and&nbsp;away&nbsp;the&nbsp;most&nbsp;common&nbsp;CRC-32&nbsp;polynomial.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4317236">//&nbsp;Used&nbsp;by&nbsp;ethernet&nbsp;(IEEE&nbsp;802.3),&nbsp;v.42,&nbsp;fddi,&nbsp;gzip,&nbsp;zip,&nbsp;png,&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317303">IEEE</span>&nbsp;<span class="op" id="4317308">=</span>&nbsp;<span class="num" id="4317310">0xedb88320</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4317323">//&nbsp;Castagnoli&#39;s&nbsp;polynomial,&nbsp;used&nbsp;in&nbsp;iSCSI.</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4317367">//&nbsp;Has&nbsp;better&nbsp;error&nbsp;detection&nbsp;characteristics&nbsp;than&nbsp;IEEE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4317425">//&nbsp;http://dx.doi.org/10.1109/26.231911</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317465">Castagnoli</span>&nbsp;<span class="op" id="4317476">=</span>&nbsp;<span class="num" id="4317478">0x82f63b78</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4317491">//&nbsp;Koopman&#39;s&nbsp;polynomial.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4317517">//&nbsp;Also&nbsp;has&nbsp;better&nbsp;error&nbsp;detection&nbsp;characteristics&nbsp;than&nbsp;IEEE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4317580">//&nbsp;http://dx.doi.org/10.1109/DSN.2002.1028931</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4317627">Koopman</span>&nbsp;<span class="op" id="4317635">=</span>&nbsp;<span class="num" id="4317637">0xeb31d82e</span><br>
<span class="lineno"></span><span class="op" id="4317648">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4317651">//&nbsp;Table&nbsp;is&nbsp;a&nbsp;256-word&nbsp;table&nbsp;representing&nbsp;the&nbsp;polynomial&nbsp;for&nbsp;efficient&nbsp;processing.</span><br>
<span class="lineno"></span><span class="keyword" id="4317734">type</span>&nbsp;<span class="ident" id="4317739">Table</span>&nbsp;<span class="op" id="4317745">[</span><span class="num" id="4317746">256</span><span class="op" id="4317749">]</span><span class="builtintype" id="4317750">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4317758">//&nbsp;castagnoliTable&nbsp;points&nbsp;to&nbsp;a&nbsp;lazily&nbsp;initialized&nbsp;Table&nbsp;for&nbsp;the&nbsp;Castagnoli</span><br>
<span class="lineno"></span><span class="comment" id="4317833">//&nbsp;polynomial.&nbsp;MakeTable&nbsp;will&nbsp;always&nbsp;return&nbsp;this&nbsp;value&nbsp;when&nbsp;asked&nbsp;to&nbsp;make&nbsp;a</span><br>
<span class="lineno">40</span><span class="comment" id="4317909">//&nbsp;Castagnoli&nbsp;table&nbsp;so&nbsp;we&nbsp;can&nbsp;compare&nbsp;against&nbsp;it&nbsp;to&nbsp;find&nbsp;when&nbsp;the&nbsp;caller&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4317985">//&nbsp;using&nbsp;this&nbsp;polynomial.</span><br>
<span class="lineno"></span><span class="keyword" id="4318011">var</span>&nbsp;<span class="ident" id="4318015">castagnoliTable</span>&nbsp;<span class="op" id="4318031">*</span><span class="ident" id="4318032">Table</span><br>
<span class="lineno"></span><span class="keyword" id="4318038">var</span>&nbsp;<span class="ident" id="4318042">castagnoliOnce</span>&nbsp;<span class="ident" id="4318057">sync</span><span class="op" id="4318061">.</span><span class="ident" id="4318062">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="4318068">func</span>&nbsp;<span class="ident" id="4318073">castagnoliInit</span><span class="op" id="4318087">(</span><span class="op" id="4318088">)</span>&nbsp;<span class="op" id="4318090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318093">castagnoliTable</span>&nbsp;<span class="op" id="4318109">=</span>&nbsp;<span class="ident" id="4318111">makeTable</span><span class="op" id="4318120">(</span><span class="ident" id="4318121">Castagnoli</span><span class="op" id="4318131">)</span><br>
<span class="lineno"></span><span class="op" id="4318133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4318136">//&nbsp;IEEETable&nbsp;is&nbsp;the&nbsp;table&nbsp;for&nbsp;the&nbsp;IEEE&nbsp;polynomial.</span><br>
<span class="lineno">50</span><span class="keyword" id="4318187">var</span>&nbsp;<span class="ident" id="4318191">IEEETable</span>&nbsp;<span class="op" id="4318201">=</span>&nbsp;<span class="ident" id="4318203">makeTable</span><span class="op" id="4318212">(</span><span class="ident" id="4318213">IEEE</span><span class="op" id="4318217">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4318220">//&nbsp;MakeTable&nbsp;returns&nbsp;the&nbsp;Table&nbsp;constructed&nbsp;from&nbsp;the&nbsp;specified&nbsp;polynomial.</span><br>
<span class="lineno"></span><span class="keyword" id="4318294">func</span>&nbsp;<span class="ident" id="4318299">MakeTable</span><span class="op" id="4318308">(</span><span class="ident" id="4318309">poly</span>&nbsp;<span class="builtintype" id="4318314">uint32</span><span class="op" id="4318320">)</span>&nbsp;<span class="op" id="4318322">*</span><span class="ident" id="4318323">Table</span>&nbsp;<span class="op" id="4318329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318332">switch</span>&nbsp;<span class="ident" id="4318339">poly</span>&nbsp;<span class="op" id="4318344">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318347">case</span>&nbsp;<span class="ident" id="4318352">IEEE</span><span class="op" id="4318356">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318360">return</span>&nbsp;<span class="ident" id="4318367">IEEETable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318378">case</span>&nbsp;<span class="ident" id="4318383">Castagnoli</span><span class="op" id="4318393">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318397">castagnoliOnce</span><span class="op" id="4318411">.</span><span class="ident" id="4318412">Do</span><span class="op" id="4318414">(</span><span class="ident" id="4318415">castagnoliInit</span><span class="op" id="4318429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318433">return</span>&nbsp;<span class="ident" id="4318440">castagnoliTable</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4318457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318460">return</span>&nbsp;<span class="ident" id="4318467">makeTable</span><span class="op" id="4318476">(</span><span class="ident" id="4318477">poly</span><span class="op" id="4318481">)</span><br>
<span class="lineno"></span><span class="op" id="4318483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4318486">//&nbsp;makeTable&nbsp;returns&nbsp;the&nbsp;Table&nbsp;constructed&nbsp;from&nbsp;the&nbsp;specified&nbsp;polynomial.</span><br>
<span class="lineno">65</span><span class="keyword" id="4318560">func</span>&nbsp;<span class="ident" id="4318565">makeTable</span><span class="op" id="4318574">(</span><span class="ident" id="4318575">poly</span>&nbsp;<span class="builtintype" id="4318580">uint32</span><span class="op" id="4318586">)</span>&nbsp;<span class="op" id="4318588">*</span><span class="ident" id="4318589">Table</span>&nbsp;<span class="op" id="4318595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318598">t</span>&nbsp;<span class="op" id="4318600">:=</span>&nbsp;<span class="builtinfunc" id="4318603">new</span><span class="op" id="4318606">(</span><span class="ident" id="4318607">Table</span><span class="op" id="4318612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318615">for</span>&nbsp;<span class="ident" id="4318619">i</span>&nbsp;<span class="op" id="4318621">:=</span>&nbsp;<span class="num" id="4318624">0</span><span class="op" id="4318625">;</span>&nbsp;<span class="ident" id="4318627">i</span>&nbsp;<span class="op" id="4318629">&lt;</span>&nbsp;<span class="num" id="4318631">256</span><span class="op" id="4318634">;</span>&nbsp;<span class="ident" id="4318636">i</span><span class="op" id="4318637">++</span>&nbsp;<span class="op" id="4318640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318644">crc</span>&nbsp;<span class="op" id="4318648">:=</span>&nbsp;<span class="builtintype" id="4318651">uint32</span><span class="op" id="4318657">(</span><span class="ident" id="4318658">i</span><span class="op" id="4318659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318663">for</span>&nbsp;<span class="ident" id="4318667">j</span>&nbsp;<span class="op" id="4318669">:=</span>&nbsp;<span class="num" id="4318672">0</span><span class="op" id="4318673">;</span>&nbsp;<span class="ident" id="4318675">j</span>&nbsp;<span class="op" id="4318677">&lt;</span>&nbsp;<span class="num" id="4318679">8</span><span class="op" id="4318680">;</span>&nbsp;<span class="ident" id="4318682">j</span><span class="op" id="4318683">++</span>&nbsp;<span class="op" id="4318686">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318691">if</span>&nbsp;<span class="ident" id="4318694">crc</span><span class="op" id="4318697">&amp;</span><span class="num" id="4318698">1</span>&nbsp;<span class="op" id="4318700">==</span>&nbsp;<span class="num" id="4318703">1</span>&nbsp;<span class="op" id="4318705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318711">crc</span>&nbsp;<span class="op" id="4318715">=</span>&nbsp;<span class="op" id="4318717">(</span><span class="ident" id="4318718">crc</span>&nbsp;<span class="op" id="4318722">&gt;&gt;</span>&nbsp;<span class="num" id="4318725">1</span><span class="op" id="4318726">)</span>&nbsp;<span class="op" id="4318728">^</span>&nbsp;<span class="ident" id="4318730">poly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4318738">}</span>&nbsp;<span class="keyword" id="4318740">else</span>&nbsp;<span class="op" id="4318745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318751">crc</span>&nbsp;<span class="op" id="4318755">&gt;&gt;=</span>&nbsp;<span class="num" id="4318759">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4318764">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4318768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318772">t</span><span class="op" id="4318773">[</span><span class="ident" id="4318774">i</span><span class="op" id="4318775">]</span>&nbsp;<span class="op" id="4318777">=</span>&nbsp;<span class="ident" id="4318779">crc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4318784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4318787">return</span>&nbsp;<span class="ident" id="4318794">t</span><br>
<span class="lineno"></span><span class="op" id="4318796">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="4318799">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4318858">type</span>&nbsp;<span class="ident" id="4318863">digest</span>&nbsp;<span class="keyword" id="4318870">struct</span>&nbsp;<span class="op" id="4318877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318880">crc</span>&nbsp;<span class="builtintype" id="4318884">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318892">tab</span>&nbsp;<span class="op" id="4318896">*</span><span class="ident" id="4318897">Table</span><br>
<span class="lineno">85</span><span class="op" id="4318903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4318906">//&nbsp;New&nbsp;creates&nbsp;a&nbsp;new&nbsp;hash.Hash32&nbsp;computing&nbsp;the&nbsp;CRC-32&nbsp;checksum</span><br>
<span class="lineno"></span><span class="comment" id="4318969">//&nbsp;using&nbsp;the&nbsp;polynomial&nbsp;represented&nbsp;by&nbsp;the&nbsp;Table.</span><br>
<span class="lineno"></span><span class="keyword" id="4319019">func</span>&nbsp;<span class="ident" id="4319024">New</span><span class="op" id="4319027">(</span><span class="ident" id="4319028">tab</span>&nbsp;<span class="op" id="4319032">*</span><span class="ident" id="4319033">Table</span><span class="op" id="4319038">)</span>&nbsp;<span class="ident" id="4319040">hash</span><span class="op" id="4319044">.</span><span class="ident" id="4319045">Hash32</span>&nbsp;<span class="op" id="4319052">{</span>&nbsp;<span class="keyword" id="4319054">return</span>&nbsp;<span class="op" id="4319061">&amp;</span><span class="ident" id="4319062">digest</span><span class="op" id="4319068">{</span><span class="num" id="4319069">0</span><span class="op" id="4319070">,</span>&nbsp;<span class="ident" id="4319072">tab</span><span class="op" id="4319075">}</span>&nbsp;<span class="op" id="4319077">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="4319080">//&nbsp;NewIEEE&nbsp;creates&nbsp;a&nbsp;new&nbsp;hash.Hash32&nbsp;computing&nbsp;the&nbsp;CRC-32&nbsp;checksum</span><br>
<span class="lineno"></span><span class="comment" id="4319147">//&nbsp;using&nbsp;the&nbsp;IEEE&nbsp;polynomial.</span><br>
<span class="lineno"></span><span class="keyword" id="4319177">func</span>&nbsp;<span class="ident" id="4319182">NewIEEE</span><span class="op" id="4319189">(</span><span class="op" id="4319190">)</span>&nbsp;<span class="ident" id="4319192">hash</span><span class="op" id="4319196">.</span><span class="ident" id="4319197">Hash32</span>&nbsp;<span class="op" id="4319204">{</span>&nbsp;<span class="keyword" id="4319206">return</span>&nbsp;<span class="ident" id="4319213">New</span><span class="op" id="4319216">(</span><span class="ident" id="4319217">IEEETable</span><span class="op" id="4319226">)</span>&nbsp;<span class="op" id="4319228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4319231">func</span>&nbsp;<span class="op" id="4319236">(</span><span class="ident" id="4319237">d</span>&nbsp;<span class="op" id="4319239">*</span><span class="ident" id="4319240">digest</span><span class="op" id="4319246">)</span>&nbsp;<span class="ident" id="4319248">Size</span><span class="op" id="4319252">(</span><span class="op" id="4319253">)</span>&nbsp;<span class="builtintype" id="4319255">int</span>&nbsp;<span class="op" id="4319259">{</span>&nbsp;<span class="keyword" id="4319261">return</span>&nbsp;<span class="ident" id="4319268">Size</span>&nbsp;<span class="op" id="4319273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4319276">func</span>&nbsp;<span class="op" id="4319281">(</span><span class="ident" id="4319282">d</span>&nbsp;<span class="op" id="4319284">*</span><span class="ident" id="4319285">digest</span><span class="op" id="4319291">)</span>&nbsp;<span class="ident" id="4319293">BlockSize</span><span class="op" id="4319302">(</span><span class="op" id="4319303">)</span>&nbsp;<span class="builtintype" id="4319305">int</span>&nbsp;<span class="op" id="4319309">{</span>&nbsp;<span class="keyword" id="4319311">return</span>&nbsp;<span class="num" id="4319318">1</span>&nbsp;<span class="op" id="4319320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4319323">func</span>&nbsp;<span class="op" id="4319328">(</span><span class="ident" id="4319329">d</span>&nbsp;<span class="op" id="4319331">*</span><span class="ident" id="4319332">digest</span><span class="op" id="4319338">)</span>&nbsp;<span class="ident" id="4319340">Reset</span><span class="op" id="4319345">(</span><span class="op" id="4319346">)</span>&nbsp;<span class="op" id="4319348">{</span>&nbsp;<span class="ident" id="4319350">d</span><span class="op" id="4319351">.</span><span class="ident" id="4319352">crc</span>&nbsp;<span class="op" id="4319356">=</span>&nbsp;<span class="num" id="4319358">0</span>&nbsp;<span class="op" id="4319360">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="4319363">func</span>&nbsp;<span class="ident" id="4319368">update</span><span class="op" id="4319374">(</span><span class="ident" id="4319375">crc</span>&nbsp;<span class="builtintype" id="4319379">uint32</span><span class="op" id="4319385">,</span>&nbsp;<span class="ident" id="4319387">tab</span>&nbsp;<span class="op" id="4319391">*</span><span class="ident" id="4319392">Table</span><span class="op" id="4319397">,</span>&nbsp;<span class="ident" id="4319399">p</span>&nbsp;<span class="op" id="4319401">[</span><span class="op" id="4319402">]</span><span class="builtintype" id="4319403">byte</span><span class="op" id="4319407">)</span>&nbsp;<span class="builtintype" id="4319409">uint32</span>&nbsp;<span class="op" id="4319416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319419">crc</span>&nbsp;<span class="op" id="4319423">=</span>&nbsp;<span class="op" id="4319425">^</span><span class="ident" id="4319426">crc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319431">for</span>&nbsp;<span class="ident" id="4319435">_</span><span class="op" id="4319436">,</span>&nbsp;<span class="ident" id="4319438">v</span>&nbsp;<span class="op" id="4319440">:=</span>&nbsp;<span class="keyword" id="4319443">range</span>&nbsp;<span class="ident" id="4319449">p</span>&nbsp;<span class="op" id="4319451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319455">crc</span>&nbsp;<span class="op" id="4319459">=</span>&nbsp;<span class="ident" id="4319461">tab</span><span class="op" id="4319464">[</span><span class="builtintype" id="4319465">byte</span><span class="op" id="4319469">(</span><span class="ident" id="4319470">crc</span><span class="op" id="4319473">)</span><span class="op" id="4319474">^</span><span class="ident" id="4319475">v</span><span class="op" id="4319476">]</span>&nbsp;<span class="op" id="4319478">^</span>&nbsp;<span class="op" id="4319480">(</span><span class="ident" id="4319481">crc</span>&nbsp;<span class="op" id="4319485">&gt;&gt;</span>&nbsp;<span class="num" id="4319488">8</span><span class="op" id="4319489">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4319492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319495">return</span>&nbsp;<span class="op" id="4319502">^</span><span class="ident" id="4319503">crc</span><br>
<span class="lineno"></span><span class="op" id="4319507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4319510">//&nbsp;Update&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;adding&nbsp;the&nbsp;bytes&nbsp;in&nbsp;p&nbsp;to&nbsp;the&nbsp;crc.</span><br>
<span class="lineno">110</span><span class="keyword" id="4319576">func</span>&nbsp;<span class="ident" id="4319581">Update</span><span class="op" id="4319587">(</span><span class="ident" id="4319588">crc</span>&nbsp;<span class="builtintype" id="4319592">uint32</span><span class="op" id="4319598">,</span>&nbsp;<span class="ident" id="4319600">tab</span>&nbsp;<span class="op" id="4319604">*</span><span class="ident" id="4319605">Table</span><span class="op" id="4319610">,</span>&nbsp;<span class="ident" id="4319612">p</span>&nbsp;<span class="op" id="4319614">[</span><span class="op" id="4319615">]</span><span class="builtintype" id="4319616">byte</span><span class="op" id="4319620">)</span>&nbsp;<span class="builtintype" id="4319622">uint32</span>&nbsp;<span class="op" id="4319629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319632">if</span>&nbsp;<span class="ident" id="4319635">tab</span>&nbsp;<span class="op" id="4319639">==</span>&nbsp;<span class="ident" id="4319642">castagnoliTable</span>&nbsp;<span class="op" id="4319658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319662">return</span>&nbsp;<span class="ident" id="4319669">updateCastagnoli</span><span class="op" id="4319685">(</span><span class="ident" id="4319686">crc</span><span class="op" id="4319689">,</span>&nbsp;<span class="ident" id="4319691">p</span><span class="op" id="4319692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4319695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319698">return</span>&nbsp;<span class="ident" id="4319705">update</span><span class="op" id="4319711">(</span><span class="ident" id="4319712">crc</span><span class="op" id="4319715">,</span>&nbsp;<span class="ident" id="4319717">tab</span><span class="op" id="4319720">,</span>&nbsp;<span class="ident" id="4319722">p</span><span class="op" id="4319723">)</span><br>
<span class="lineno">115</span><span class="op" id="4319725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4319728">func</span>&nbsp;<span class="op" id="4319733">(</span><span class="ident" id="4319734">d</span>&nbsp;<span class="op" id="4319736">*</span><span class="ident" id="4319737">digest</span><span class="op" id="4319743">)</span>&nbsp;<span class="ident" id="4319745">Write</span><span class="op" id="4319750">(</span><span class="ident" id="4319751">p</span>&nbsp;<span class="op" id="4319753">[</span><span class="op" id="4319754">]</span><span class="builtintype" id="4319755">byte</span><span class="op" id="4319759">)</span>&nbsp;<span class="op" id="4319761">(</span><span class="ident" id="4319762">n</span>&nbsp;<span class="builtintype" id="4319764">int</span><span class="op" id="4319767">,</span>&nbsp;<span class="ident" id="4319769">err</span>&nbsp;<span class="builtintype" id="4319773">error</span><span class="op" id="4319778">)</span>&nbsp;<span class="op" id="4319780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319783">d</span><span class="op" id="4319784">.</span><span class="ident" id="4319785">crc</span>&nbsp;<span class="op" id="4319789">=</span>&nbsp;<span class="ident" id="4319791">Update</span><span class="op" id="4319797">(</span><span class="ident" id="4319798">d</span><span class="op" id="4319799">.</span><span class="ident" id="4319800">crc</span><span class="op" id="4319803">,</span>&nbsp;<span class="ident" id="4319805">d</span><span class="op" id="4319806">.</span><span class="ident" id="4319807">tab</span><span class="op" id="4319810">,</span>&nbsp;<span class="ident" id="4319812">p</span><span class="op" id="4319813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319816">return</span>&nbsp;<span class="builtinfunc" id="4319823">len</span><span class="op" id="4319826">(</span><span class="ident" id="4319827">p</span><span class="op" id="4319828">)</span><span class="op" id="4319829">,</span>&nbsp;<span class="ident" id="4319831">nil</span><br>
<span class="lineno">120</span><span class="op" id="4319835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4319838">func</span>&nbsp;<span class="op" id="4319843">(</span><span class="ident" id="4319844">d</span>&nbsp;<span class="op" id="4319846">*</span><span class="ident" id="4319847">digest</span><span class="op" id="4319853">)</span>&nbsp;<span class="ident" id="4319855">Sum32</span><span class="op" id="4319860">(</span><span class="op" id="4319861">)</span>&nbsp;<span class="builtintype" id="4319863">uint32</span>&nbsp;<span class="op" id="4319870">{</span>&nbsp;<span class="keyword" id="4319872">return</span>&nbsp;<span class="ident" id="4319879">d</span><span class="op" id="4319880">.</span><span class="ident" id="4319881">crc</span>&nbsp;<span class="op" id="4319885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4319888">func</span>&nbsp;<span class="op" id="4319893">(</span><span class="ident" id="4319894">d</span>&nbsp;<span class="op" id="4319896">*</span><span class="ident" id="4319897">digest</span><span class="op" id="4319903">)</span>&nbsp;<span class="ident" id="4319905">Sum</span><span class="op" id="4319908">(</span><span class="ident" id="4319909">in</span>&nbsp;<span class="op" id="4319912">[</span><span class="op" id="4319913">]</span><span class="builtintype" id="4319914">byte</span><span class="op" id="4319918">)</span>&nbsp;<span class="op" id="4319920">[</span><span class="op" id="4319921">]</span><span class="builtintype" id="4319922">byte</span>&nbsp;<span class="op" id="4319927">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319930">s</span>&nbsp;<span class="op" id="4319932">:=</span>&nbsp;<span class="ident" id="4319935">d</span><span class="op" id="4319936">.</span><span class="ident" id="4319937">Sum32</span><span class="op" id="4319942">(</span><span class="op" id="4319943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4319946">return</span>&nbsp;<span class="builtinfunc" id="4319953">append</span><span class="op" id="4319959">(</span><span class="ident" id="4319960">in</span><span class="op" id="4319962">,</span>&nbsp;<span class="builtintype" id="4319964">byte</span><span class="op" id="4319968">(</span><span class="ident" id="4319969">s</span><span class="op" id="4319970">&gt;&gt;</span><span class="num" id="4319972">24</span><span class="op" id="4319974">)</span><span class="op" id="4319975">,</span>&nbsp;<span class="builtintype" id="4319977">byte</span><span class="op" id="4319981">(</span><span class="ident" id="4319982">s</span><span class="op" id="4319983">&gt;&gt;</span><span class="num" id="4319985">16</span><span class="op" id="4319987">)</span><span class="op" id="4319988">,</span>&nbsp;<span class="builtintype" id="4319990">byte</span><span class="op" id="4319994">(</span><span class="ident" id="4319995">s</span><span class="op" id="4319996">&gt;&gt;</span><span class="num" id="4319998">8</span><span class="op" id="4319999">)</span><span class="op" id="4320000">,</span>&nbsp;<span class="builtintype" id="4320002">byte</span><span class="op" id="4320006">(</span><span class="ident" id="4320007">s</span><span class="op" id="4320008">)</span><span class="op" id="4320009">)</span><br>
<span class="lineno"></span><span class="op" id="4320011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4320014">//&nbsp;Checksum&nbsp;returns&nbsp;the&nbsp;CRC-32&nbsp;checksum&nbsp;of&nbsp;data</span><br>
<span class="lineno">130</span><span class="comment" id="4320062">//&nbsp;using&nbsp;the&nbsp;polynomial&nbsp;represented&nbsp;by&nbsp;the&nbsp;Table.</span><br>
<span class="lineno"></span><span class="keyword" id="4320112">func</span>&nbsp;<span class="ident" id="4320117">Checksum</span><span class="op" id="4320125">(</span><span class="ident" id="4320126">data</span>&nbsp;<span class="op" id="4320131">[</span><span class="op" id="4320132">]</span><span class="builtintype" id="4320133">byte</span><span class="op" id="4320137">,</span>&nbsp;<span class="ident" id="4320139">tab</span>&nbsp;<span class="op" id="4320143">*</span><span class="ident" id="4320144">Table</span><span class="op" id="4320149">)</span>&nbsp;<span class="builtintype" id="4320151">uint32</span>&nbsp;<span class="op" id="4320158">{</span>&nbsp;<span class="keyword" id="4320160">return</span>&nbsp;<span class="ident" id="4320167">Update</span><span class="op" id="4320173">(</span><span class="num" id="4320174">0</span><span class="op" id="4320175">,</span>&nbsp;<span class="ident" id="4320177">tab</span><span class="op" id="4320180">,</span>&nbsp;<span class="ident" id="4320182">data</span><span class="op" id="4320186">)</span>&nbsp;<span class="op" id="4320188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4320191">//&nbsp;ChecksumIEEE&nbsp;returns&nbsp;the&nbsp;CRC-32&nbsp;checksum&nbsp;of&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="4320243">//&nbsp;using&nbsp;the&nbsp;IEEE&nbsp;polynomial.</span><br>
<span class="lineno">135</span><span class="keyword" id="4320273">func</span>&nbsp;<span class="ident" id="4320278">ChecksumIEEE</span><span class="op" id="4320290">(</span><span class="ident" id="4320291">data</span>&nbsp;<span class="op" id="4320296">[</span><span class="op" id="4320297">]</span><span class="builtintype" id="4320298">byte</span><span class="op" id="4320302">)</span>&nbsp;<span class="builtintype" id="4320304">uint32</span>&nbsp;<span class="op" id="4320311">{</span>&nbsp;<span class="keyword" id="4320313">return</span>&nbsp;<span class="ident" id="4320320">update</span><span class="op" id="4320326">(</span><span class="num" id="4320327">0</span><span class="op" id="4320328">,</span>&nbsp;<span class="ident" id="4320330">IEEETable</span><span class="op" id="4320339">,</span>&nbsp;<span class="ident" id="4320341">data</span><span class="op" id="4320345">)</span>&nbsp;<span class="op" id="4320347">}</span>
</div>
</body>
</html>
