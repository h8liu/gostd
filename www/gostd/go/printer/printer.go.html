<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4458753">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4458808">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4458862">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4458913">//&nbsp;Package&nbsp;printer&nbsp;implements&nbsp;printing&nbsp;of&nbsp;AST&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="4458966">package</span>&nbsp;<span class="ident" id="4458974">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4458983">import</span>&nbsp;<span class="op" id="4458990">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4458993">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4459000">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4459010">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4459022">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4459028">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4459034">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4459045">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4459056">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4459074">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="4459084">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4459087">const</span>&nbsp;<span class="op" id="4459093">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459096">maxNewlines</span>&nbsp;<span class="op" id="4459108">=</span>&nbsp;<span class="num" id="4459110">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4459116">//&nbsp;max.&nbsp;number&nbsp;of&nbsp;newlines&nbsp;between&nbsp;source&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459164">debug</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4459176">=</span>&nbsp;<span class="builtintype" id="4459178">false</span>&nbsp;<span class="comment" id="4459184">//&nbsp;enable&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459209">infinity</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4459221">=</span>&nbsp;<span class="num" id="4459223">1</span>&nbsp;<span class="op" id="4459225">&lt;&lt;</span>&nbsp;<span class="num" id="4459228">30</span><br>
<span class="lineno"></span><span class="op" id="4459231">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="4459234">type</span>&nbsp;<span class="ident" id="4459239">whiteSpace</span>&nbsp;<span class="builtintype" id="4459250">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4459256">const</span>&nbsp;<span class="op" id="4459262">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459265">ignore</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4459274">=</span>&nbsp;<span class="ident" id="4459276">whiteSpace</span><span class="op" id="4459286">(</span><span class="num" id="4459287">0</span><span class="op" id="4459288">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459291">blank</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4459300">=</span>&nbsp;<span class="ident" id="4459302">whiteSpace</span><span class="op" id="4459312">(</span><span class="string" id="4459313">&#39;&nbsp;&#39;</span><span class="op" id="4459316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459319">vtab</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4459328">=</span>&nbsp;<span class="ident" id="4459330">whiteSpace</span><span class="op" id="4459340">(</span><span class="string" id="4459341">&#39;\v&#39;</span><span class="op" id="4459345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459348">newline</span>&nbsp;&nbsp;<span class="op" id="4459357">=</span>&nbsp;<span class="ident" id="4459359">whiteSpace</span><span class="op" id="4459369">(</span><span class="string" id="4459370">&#39;\n&#39;</span><span class="op" id="4459374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459377">formfeed</span>&nbsp;<span class="op" id="4459386">=</span>&nbsp;<span class="ident" id="4459388">whiteSpace</span><span class="op" id="4459398">(</span><span class="string" id="4459399">&#39;\f&#39;</span><span class="op" id="4459403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459406">indent</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4459415">=</span>&nbsp;<span class="ident" id="4459417">whiteSpace</span><span class="op" id="4459427">(</span><span class="string" id="4459428">&#39;&gt;&#39;</span><span class="op" id="4459431">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459434">unindent</span>&nbsp;<span class="op" id="4459443">=</span>&nbsp;<span class="ident" id="4459445">whiteSpace</span><span class="op" id="4459455">(</span><span class="string" id="4459456">&#39;&lt;&#39;</span><span class="op" id="4459459">)</span><br>
<span class="lineno"></span><span class="op" id="4459461">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4459464">//&nbsp;A&nbsp;pmode&nbsp;value&nbsp;represents&nbsp;the&nbsp;current&nbsp;printer&nbsp;mode.</span><br>
<span class="lineno"></span><span class="keyword" id="4459518">type</span>&nbsp;<span class="ident" id="4459523">pmode</span>&nbsp;<span class="builtintype" id="4459529">int</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="4459534">const</span>&nbsp;<span class="op" id="4459540">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459543">noExtraBlank</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459560">pmode</span>&nbsp;<span class="op" id="4459566">=</span>&nbsp;<span class="num" id="4459568">1</span>&nbsp;<span class="op" id="4459570">&lt;&lt;</span>&nbsp;<span class="ident" id="4459573">iota</span>&nbsp;<span class="comment" id="4459578">//&nbsp;disables&nbsp;extra&nbsp;blank&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459626">noExtraLinebreak</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4459661">//&nbsp;disables&nbsp;extra&nbsp;line&nbsp;break&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span><span class="op" id="4459713">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="4459716">type</span>&nbsp;<span class="ident" id="4459721">commentInfo</span>&nbsp;<span class="keyword" id="4459733">struct</span>&nbsp;<span class="op" id="4459740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459743">cindex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4459758">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4459776">//&nbsp;current&nbsp;comment&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459802">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4459817">*</span><span class="ident" id="4459818">ast</span><span class="op" id="4459821">.</span><span class="ident" id="4459822">CommentGroup</span>&nbsp;<span class="comment" id="4459835">//&nbsp;=&nbsp;printer.comments[cindex];&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459874">commentOffset</span>&nbsp;&nbsp;<span class="builtintype" id="4459889">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4459907">//&nbsp;=&nbsp;printer.posFor(printer.comments[cindex].List[0].Pos()).Offset;&nbsp;or&nbsp;infinity</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4459988">commentNewline</span>&nbsp;<span class="builtintype" id="4460003">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4460021">//&nbsp;true&nbsp;if&nbsp;the&nbsp;comment&nbsp;group&nbsp;contains&nbsp;newlines</span><br>
<span class="lineno"></span><span class="op" id="4460068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4460071">type</span>&nbsp;<span class="ident" id="4460076">printer</span>&nbsp;<span class="keyword" id="4460084">struct</span>&nbsp;<span class="op" id="4460091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4460094">//&nbsp;Configuration&nbsp;(does&nbsp;not&nbsp;change&nbsp;after&nbsp;initialization)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460151">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460159">fset</span>&nbsp;<span class="op" id="4460164">*</span><span class="ident" id="4460165">token</span><span class="op" id="4460170">.</span><span class="ident" id="4460171">FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4460181">//&nbsp;Current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460199">output</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4460211">[</span><span class="op" id="4460212">]</span><span class="builtintype" id="4460213">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4460224">//&nbsp;raw&nbsp;printer&nbsp;result</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460247">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4460259">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4460272">//&nbsp;current&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460296">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460308">pmode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4460321">//&nbsp;current&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460346">impliedSemi</span>&nbsp;<span class="builtintype" id="4460358">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4460371">//&nbsp;if&nbsp;set,&nbsp;a&nbsp;linebreak&nbsp;implies&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460415">lastTok</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460427">token</span><span class="op" id="4460432">.</span><span class="ident" id="4460433">Token</span>&nbsp;&nbsp;<span class="comment" id="4460440">//&nbsp;last&nbsp;token&nbsp;printed&nbsp;(token.ILLEGAL&nbsp;if&nbsp;it&#39;s&nbsp;whitespace)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460498">prevOpen</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460510">token</span><span class="op" id="4460515">.</span><span class="ident" id="4460516">Token</span>&nbsp;&nbsp;<span class="comment" id="4460523">//&nbsp;previous&nbsp;non-brace&nbsp;&#34;open&#34;&nbsp;token&nbsp;(,&nbsp;[,&nbsp;or&nbsp;token.ILLEGAL</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460582">wsbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4460594">[</span><span class="op" id="4460595">]</span><span class="ident" id="4460596">whiteSpace</span>&nbsp;<span class="comment" id="4460607">//&nbsp;delayed&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4460632">//&nbsp;Positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4460646">//&nbsp;The&nbsp;out&nbsp;position&nbsp;differs&nbsp;from&nbsp;the&nbsp;pos&nbsp;position&nbsp;when&nbsp;the&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4460713">//&nbsp;formatting&nbsp;differs&nbsp;from&nbsp;the&nbsp;source&nbsp;formatting&nbsp;(in&nbsp;the&nbsp;amount&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4460781">//&nbsp;white&nbsp;space).&nbsp;If&nbsp;there&#39;s&nbsp;a&nbsp;difference&nbsp;and&nbsp;SourcePos&nbsp;is&nbsp;set&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4460847">//&nbsp;ConfigMode,&nbsp;//line&nbsp;comments&nbsp;are&nbsp;used&nbsp;in&nbsp;the&nbsp;output&nbsp;to&nbsp;restore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4460913">//&nbsp;original&nbsp;source&nbsp;positions&nbsp;for&nbsp;a&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4460957">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460965">token</span><span class="op" id="4460970">.</span><span class="ident" id="4460971">Position</span>&nbsp;<span class="comment" id="4460980">//&nbsp;current&nbsp;position&nbsp;in&nbsp;AST&nbsp;(source)&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461023">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461031">token</span><span class="op" id="4461036">.</span><span class="ident" id="4461037">Position</span>&nbsp;<span class="comment" id="4461046">//&nbsp;current&nbsp;position&nbsp;in&nbsp;output&nbsp;space</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461083">last</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461091">token</span><span class="op" id="4461096">.</span><span class="ident" id="4461097">Position</span>&nbsp;<span class="comment" id="4461106">//&nbsp;value&nbsp;of&nbsp;pos&nbsp;after&nbsp;calling&nbsp;writeString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461149">linePtr</span>&nbsp;<span class="op" id="4461157">*</span><span class="builtintype" id="4461158">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4461172">//&nbsp;if&nbsp;set,&nbsp;record&nbsp;out.Line&nbsp;for&nbsp;the&nbsp;next&nbsp;token&nbsp;in&nbsp;*linePtr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4461232">//&nbsp;The&nbsp;list&nbsp;of&nbsp;all&nbsp;source&nbsp;comments,&nbsp;in&nbsp;order&nbsp;of&nbsp;appearance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461293">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4461309">[</span><span class="op" id="4461310">]</span><span class="op" id="4461311">*</span><span class="ident" id="4461312">ast</span><span class="op" id="4461315">.</span><span class="ident" id="4461316">CommentGroup</span>&nbsp;<span class="comment" id="4461329">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461344">useNodeComments</span>&nbsp;<span class="builtintype" id="4461360">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4461380">//&nbsp;if&nbsp;not&nbsp;set,&nbsp;ignore&nbsp;lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;of&nbsp;nodes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4461436">//&nbsp;Information&nbsp;about&nbsp;p.comments[p.cindex];&nbsp;set&nbsp;up&nbsp;by&nbsp;nextComment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461503">commentInfo</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4461517">//&nbsp;Cache&nbsp;of&nbsp;already&nbsp;computed&nbsp;node&nbsp;sizes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461559">nodeSizes</span>&nbsp;<span class="keyword" id="4461569">map</span><span class="op" id="4461572">[</span><span class="ident" id="4461573">ast</span><span class="op" id="4461576">.</span><span class="ident" id="4461577">Node</span><span class="op" id="4461581">]</span><span class="builtintype" id="4461582">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4461588">//&nbsp;Cache&nbsp;of&nbsp;most&nbsp;recently&nbsp;computed&nbsp;line&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461639">cachedPos</span>&nbsp;&nbsp;<span class="ident" id="4461650">token</span><span class="op" id="4461655">.</span><span class="ident" id="4461656">Pos</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461661">cachedLine</span>&nbsp;<span class="builtintype" id="4461672">int</span>&nbsp;<span class="comment" id="4461676">//&nbsp;line&nbsp;corresponding&nbsp;to&nbsp;cachedPos</span><br>
<span class="lineno"></span><span class="op" id="4461711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4461714">func</span>&nbsp;<span class="op" id="4461719">(</span><span class="ident" id="4461720">p</span>&nbsp;<span class="op" id="4461722">*</span><span class="ident" id="4461723">printer</span><span class="op" id="4461730">)</span>&nbsp;<span class="ident" id="4461732">init</span><span class="op" id="4461736">(</span><span class="ident" id="4461737">cfg</span>&nbsp;<span class="op" id="4461741">*</span><span class="ident" id="4461742">Config</span><span class="op" id="4461748">,</span>&nbsp;<span class="ident" id="4461750">fset</span>&nbsp;<span class="op" id="4461755">*</span><span class="ident" id="4461756">token</span><span class="op" id="4461761">.</span><span class="ident" id="4461762">FileSet</span><span class="op" id="4461769">,</span>&nbsp;<span class="ident" id="4461771">nodeSizes</span>&nbsp;<span class="keyword" id="4461781">map</span><span class="op" id="4461784">[</span><span class="ident" id="4461785">ast</span><span class="op" id="4461788">.</span><span class="ident" id="4461789">Node</span><span class="op" id="4461793">]</span><span class="builtintype" id="4461794">int</span><span class="op" id="4461797">)</span>&nbsp;<span class="op" id="4461799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461802">p</span><span class="op" id="4461803">.</span><span class="ident" id="4461804">Config</span>&nbsp;<span class="op" id="4461811">=</span>&nbsp;<span class="op" id="4461813">*</span><span class="ident" id="4461814">cfg</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461819">p</span><span class="op" id="4461820">.</span><span class="ident" id="4461821">fset</span>&nbsp;<span class="op" id="4461826">=</span>&nbsp;<span class="ident" id="4461828">fset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461834">p</span><span class="op" id="4461835">.</span><span class="ident" id="4461836">pos</span>&nbsp;<span class="op" id="4461840">=</span>&nbsp;<span class="ident" id="4461842">token</span><span class="op" id="4461847">.</span><span class="ident" id="4461848">Position</span><span class="op" id="4461856">{</span><span class="ident" id="4461857">Line</span><span class="op" id="4461861">:</span>&nbsp;<span class="num" id="4461863">1</span><span class="op" id="4461864">,</span>&nbsp;<span class="ident" id="4461866">Column</span><span class="op" id="4461872">:</span>&nbsp;<span class="num" id="4461874">1</span><span class="op" id="4461875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461878">p</span><span class="op" id="4461879">.</span><span class="ident" id="4461880">out</span>&nbsp;<span class="op" id="4461884">=</span>&nbsp;<span class="ident" id="4461886">token</span><span class="op" id="4461891">.</span><span class="ident" id="4461892">Position</span><span class="op" id="4461900">{</span><span class="ident" id="4461901">Line</span><span class="op" id="4461905">:</span>&nbsp;<span class="num" id="4461907">1</span><span class="op" id="4461908">,</span>&nbsp;<span class="ident" id="4461910">Column</span><span class="op" id="4461916">:</span>&nbsp;<span class="num" id="4461918">1</span><span class="op" id="4461919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461922">p</span><span class="op" id="4461923">.</span><span class="ident" id="4461924">wsbuf</span>&nbsp;<span class="op" id="4461930">=</span>&nbsp;<span class="builtinfunc" id="4461932">make</span><span class="op" id="4461936">(</span><span class="op" id="4461937">[</span><span class="op" id="4461938">]</span><span class="ident" id="4461939">whiteSpace</span><span class="op" id="4461949">,</span>&nbsp;<span class="num" id="4461951">0</span><span class="op" id="4461952">,</span>&nbsp;<span class="num" id="4461954">16</span><span class="op" id="4461956">)</span>&nbsp;<span class="comment" id="4461958">//&nbsp;whitespace&nbsp;sequences&nbsp;are&nbsp;short</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4461993">p</span><span class="op" id="4461994">.</span><span class="ident" id="4461995">nodeSizes</span>&nbsp;<span class="op" id="4462005">=</span>&nbsp;<span class="ident" id="4462007">nodeSizes</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462018">p</span><span class="op" id="4462019">.</span><span class="ident" id="4462020">cachedPos</span>&nbsp;<span class="op" id="4462030">=</span>&nbsp;<span class="op" id="4462032">-</span><span class="num" id="4462033">1</span><br>
<span class="lineno"></span><span class="op" id="4462035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4462038">func</span>&nbsp;<span class="op" id="4462043">(</span><span class="ident" id="4462044">p</span>&nbsp;<span class="op" id="4462046">*</span><span class="ident" id="4462047">printer</span><span class="op" id="4462054">)</span>&nbsp;<span class="ident" id="4462056">internalError</span><span class="op" id="4462069">(</span><span class="ident" id="4462070">msg</span>&nbsp;<span class="op" id="4462074">...</span><span class="keyword" id="4462077">interface</span><span class="op" id="4462086">{</span><span class="op" id="4462087">}</span><span class="op" id="4462088">)</span>&nbsp;<span class="op" id="4462090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4462093">if</span>&nbsp;<span class="ident" id="4462096">debug</span>&nbsp;<span class="op" id="4462102">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462106">fmt</span><span class="op" id="4462109">.</span><span class="ident" id="4462110">Print</span><span class="op" id="4462115">(</span><span class="ident" id="4462116">p</span><span class="op" id="4462117">.</span><span class="ident" id="4462118">pos</span><span class="op" id="4462121">.</span><span class="ident" id="4462122">String</span><span class="op" id="4462128">(</span><span class="op" id="4462129">)</span>&nbsp;<span class="op" id="4462131">+</span>&nbsp;<span class="string" id="4462133">&#34;:&nbsp;&#34;</span><span class="op" id="4462137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462141">fmt</span><span class="op" id="4462144">.</span><span class="ident" id="4462145">Println</span><span class="op" id="4462152">(</span><span class="ident" id="4462153">msg</span><span class="op" id="4462156">...</span><span class="op" id="4462159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4462163">panic</span><span class="op" id="4462168">(</span><span class="string" id="4462169">&#34;go/printer&#34;</span><span class="op" id="4462181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4462184">}</span><br>
<span class="lineno"></span><span class="op" id="4462186">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4462189">//&nbsp;commentsHaveNewline&nbsp;reports&nbsp;whether&nbsp;a&nbsp;list&nbsp;of&nbsp;comments&nbsp;belonging&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4462260">//&nbsp;an&nbsp;*ast.CommentGroup&nbsp;contains&nbsp;newlines.&nbsp;Because&nbsp;the&nbsp;position&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="4462336">//&nbsp;may&nbsp;only&nbsp;be&nbsp;partially&nbsp;correct,&nbsp;we&nbsp;also&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;comment&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="4462409">func</span>&nbsp;<span class="op" id="4462414">(</span><span class="ident" id="4462415">p</span>&nbsp;<span class="op" id="4462417">*</span><span class="ident" id="4462418">printer</span><span class="op" id="4462425">)</span>&nbsp;<span class="ident" id="4462427">commentsHaveNewline</span><span class="op" id="4462446">(</span><span class="ident" id="4462447">list</span>&nbsp;<span class="op" id="4462452">[</span><span class="op" id="4462453">]</span><span class="op" id="4462454">*</span><span class="ident" id="4462455">ast</span><span class="op" id="4462458">.</span><span class="ident" id="4462459">Comment</span><span class="op" id="4462466">)</span>&nbsp;<span class="builtintype" id="4462468">bool</span>&nbsp;<span class="op" id="4462473">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4462476">//&nbsp;len(list)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462494">line</span>&nbsp;<span class="op" id="4462499">:=</span>&nbsp;<span class="ident" id="4462502">p</span><span class="op" id="4462503">.</span><span class="ident" id="4462504">lineFor</span><span class="op" id="4462511">(</span><span class="ident" id="4462512">list</span><span class="op" id="4462516">[</span><span class="num" id="4462517">0</span><span class="op" id="4462518">]</span><span class="op" id="4462519">.</span><span class="ident" id="4462520">Pos</span><span class="op" id="4462523">(</span><span class="op" id="4462524">)</span><span class="op" id="4462525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4462528">for</span>&nbsp;<span class="ident" id="4462532">i</span><span class="op" id="4462533">,</span>&nbsp;<span class="ident" id="4462535">c</span>&nbsp;<span class="op" id="4462537">:=</span>&nbsp;<span class="keyword" id="4462540">range</span>&nbsp;<span class="ident" id="4462546">list</span>&nbsp;<span class="op" id="4462551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4462555">if</span>&nbsp;<span class="ident" id="4462558">i</span>&nbsp;<span class="op" id="4462560">&gt;</span>&nbsp;<span class="num" id="4462562">0</span>&nbsp;<span class="op" id="4462564">&amp;&amp;</span>&nbsp;<span class="ident" id="4462567">p</span><span class="op" id="4462568">.</span><span class="ident" id="4462569">lineFor</span><span class="op" id="4462576">(</span><span class="ident" id="4462577">list</span><span class="op" id="4462581">[</span><span class="ident" id="4462582">i</span><span class="op" id="4462583">]</span><span class="op" id="4462584">.</span><span class="ident" id="4462585">Pos</span><span class="op" id="4462588">(</span><span class="op" id="4462589">)</span><span class="op" id="4462590">)</span>&nbsp;<span class="op" id="4462592">!=</span>&nbsp;<span class="ident" id="4462595">line</span>&nbsp;<span class="op" id="4462600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4462605">//&nbsp;not&nbsp;all&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4462645">return</span>&nbsp;<span class="builtintype" id="4462652">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4462659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4462663">if</span>&nbsp;<span class="ident" id="4462666">t</span>&nbsp;<span class="op" id="4462668">:=</span>&nbsp;<span class="ident" id="4462671">c</span><span class="op" id="4462672">.</span><span class="ident" id="4462673">Text</span><span class="op" id="4462677">;</span>&nbsp;<span class="builtinfunc" id="4462679">len</span><span class="op" id="4462682">(</span><span class="ident" id="4462683">t</span><span class="op" id="4462684">)</span>&nbsp;<span class="op" id="4462686">&gt;=</span>&nbsp;<span class="num" id="4462689">2</span>&nbsp;<span class="op" id="4462691">&amp;&amp;</span>&nbsp;<span class="op" id="4462694">(</span><span class="ident" id="4462695">t</span><span class="op" id="4462696">[</span><span class="num" id="4462697">1</span><span class="op" id="4462698">]</span>&nbsp;<span class="op" id="4462700">==</span>&nbsp;<span class="string" id="4462703">&#39;/&#39;</span>&nbsp;<span class="op" id="4462707">||</span>&nbsp;<span class="ident" id="4462710">strings</span><span class="op" id="4462717">.</span><span class="ident" id="4462718">Contains</span><span class="op" id="4462726">(</span><span class="ident" id="4462727">t</span><span class="op" id="4462728">,</span>&nbsp;<span class="string" id="4462730">&#34;\n&#34;</span><span class="op" id="4462734">)</span><span class="op" id="4462735">)</span>&nbsp;<span class="op" id="4462737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4462742">return</span>&nbsp;<span class="builtintype" id="4462749">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4462756">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4462759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462762">_</span>&nbsp;<span class="op" id="4462764">=</span>&nbsp;<span class="ident" id="4462766">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4462772">return</span>&nbsp;<span class="builtintype" id="4462779">false</span><br>
<span class="lineno"></span><span class="op" id="4462785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="4462788">func</span>&nbsp;<span class="op" id="4462793">(</span><span class="ident" id="4462794">p</span>&nbsp;<span class="op" id="4462796">*</span><span class="ident" id="4462797">printer</span><span class="op" id="4462804">)</span>&nbsp;<span class="ident" id="4462806">nextComment</span><span class="op" id="4462817">(</span><span class="op" id="4462818">)</span>&nbsp;<span class="op" id="4462820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4462823">for</span>&nbsp;<span class="ident" id="4462827">p</span><span class="op" id="4462828">.</span><span class="ident" id="4462829">cindex</span>&nbsp;<span class="op" id="4462836">&lt;</span>&nbsp;<span class="builtinfunc" id="4462838">len</span><span class="op" id="4462841">(</span><span class="ident" id="4462842">p</span><span class="op" id="4462843">.</span><span class="ident" id="4462844">comments</span><span class="op" id="4462852">)</span>&nbsp;<span class="op" id="4462854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462858">c</span>&nbsp;<span class="op" id="4462860">:=</span>&nbsp;<span class="ident" id="4462863">p</span><span class="op" id="4462864">.</span><span class="ident" id="4462865">comments</span><span class="op" id="4462873">[</span><span class="ident" id="4462874">p</span><span class="op" id="4462875">.</span><span class="ident" id="4462876">cindex</span><span class="op" id="4462882">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462886">p</span><span class="op" id="4462887">.</span><span class="ident" id="4462888">cindex</span><span class="op" id="4462894">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4462899">if</span>&nbsp;<span class="ident" id="4462902">list</span>&nbsp;<span class="op" id="4462907">:=</span>&nbsp;<span class="ident" id="4462910">c</span><span class="op" id="4462911">.</span><span class="ident" id="4462912">List</span><span class="op" id="4462916">;</span>&nbsp;<span class="builtinfunc" id="4462918">len</span><span class="op" id="4462921">(</span><span class="ident" id="4462922">list</span><span class="op" id="4462926">)</span>&nbsp;<span class="op" id="4462928">&gt;</span>&nbsp;<span class="num" id="4462930">0</span>&nbsp;<span class="op" id="4462932">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462937">p</span><span class="op" id="4462938">.</span><span class="ident" id="4462939">comment</span>&nbsp;<span class="op" id="4462947">=</span>&nbsp;<span class="ident" id="4462949">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4462954">p</span><span class="op" id="4462955">.</span><span class="ident" id="4462956">commentOffset</span>&nbsp;<span class="op" id="4462970">=</span>&nbsp;<span class="ident" id="4462972">p</span><span class="op" id="4462973">.</span><span class="ident" id="4462974">posFor</span><span class="op" id="4462980">(</span><span class="ident" id="4462981">list</span><span class="op" id="4462985">[</span><span class="num" id="4462986">0</span><span class="op" id="4462987">]</span><span class="op" id="4462988">.</span><span class="ident" id="4462989">Pos</span><span class="op" id="4462992">(</span><span class="op" id="4462993">)</span><span class="op" id="4462994">)</span><span class="op" id="4462995">.</span><span class="ident" id="4462996">Offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4463006">p</span><span class="op" id="4463007">.</span><span class="ident" id="4463008">commentNewline</span>&nbsp;<span class="op" id="4463023">=</span>&nbsp;<span class="ident" id="4463025">p</span><span class="op" id="4463026">.</span><span class="ident" id="4463027">commentsHaveNewline</span><span class="op" id="4463046">(</span><span class="ident" id="4463047">list</span><span class="op" id="4463051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4463056">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4463065">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4463069">//&nbsp;we&nbsp;should&nbsp;not&nbsp;reach&nbsp;here&nbsp;(correct&nbsp;ASTs&nbsp;don&#39;t&nbsp;have&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4463130">//&nbsp;ast.CommentGroup&nbsp;nodes),&nbsp;but&nbsp;be&nbsp;conservative&nbsp;and&nbsp;try&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4463193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4463196">//&nbsp;no&nbsp;more&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4463217">p</span><span class="op" id="4463218">.</span><span class="ident" id="4463219">commentOffset</span>&nbsp;<span class="op" id="4463233">=</span>&nbsp;<span class="ident" id="4463235">infinity</span><br>
<span class="lineno">145</span><span class="op" id="4463244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4463247">//&nbsp;commentBefore&nbsp;returns&nbsp;true&nbsp;iff&nbsp;the&nbsp;current&nbsp;comment&nbsp;group&nbsp;occurs</span><br>
<span class="lineno"></span><span class="comment" id="4463314">//&nbsp;before&nbsp;the&nbsp;next&nbsp;position&nbsp;in&nbsp;the&nbsp;source&nbsp;code&nbsp;and&nbsp;printing&nbsp;it&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="4463382">//&nbsp;not&nbsp;introduce&nbsp;implicit&nbsp;semicolons.</span><br>
<span class="lineno">150</span><span class="comment" id="4463420">//</span><br>
<span class="lineno"></span><span class="keyword" id="4463423">func</span>&nbsp;<span class="op" id="4463428">(</span><span class="ident" id="4463429">p</span>&nbsp;<span class="op" id="4463431">*</span><span class="ident" id="4463432">printer</span><span class="op" id="4463439">)</span>&nbsp;<span class="ident" id="4463441">commentBefore</span><span class="op" id="4463454">(</span><span class="ident" id="4463455">next</span>&nbsp;<span class="ident" id="4463460">token</span><span class="op" id="4463465">.</span><span class="ident" id="4463466">Position</span><span class="op" id="4463474">)</span>&nbsp;<span class="builtintype" id="4463476">bool</span>&nbsp;<span class="op" id="4463481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4463484">return</span>&nbsp;<span class="ident" id="4463491">p</span><span class="op" id="4463492">.</span><span class="ident" id="4463493">commentOffset</span>&nbsp;<span class="op" id="4463507">&lt;</span>&nbsp;<span class="ident" id="4463509">next</span><span class="op" id="4463513">.</span><span class="ident" id="4463514">Offset</span>&nbsp;<span class="op" id="4463521">&amp;&amp;</span>&nbsp;<span class="op" id="4463524">(</span><span class="op" id="4463525">!</span><span class="ident" id="4463526">p</span><span class="op" id="4463527">.</span><span class="ident" id="4463528">impliedSemi</span>&nbsp;<span class="op" id="4463540">||</span>&nbsp;<span class="op" id="4463543">!</span><span class="ident" id="4463544">p</span><span class="op" id="4463545">.</span><span class="ident" id="4463546">commentNewline</span><span class="op" id="4463560">)</span><br>
<span class="lineno"></span><span class="op" id="4463562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="4463565">//&nbsp;commentSizeBefore&nbsp;returns&nbsp;the&nbsp;estimated&nbsp;size&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4463620">//&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;before&nbsp;the&nbsp;next&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="4463675">//</span><br>
<span class="lineno"></span><span class="keyword" id="4463678">func</span>&nbsp;<span class="op" id="4463683">(</span><span class="ident" id="4463684">p</span>&nbsp;<span class="op" id="4463686">*</span><span class="ident" id="4463687">printer</span><span class="op" id="4463694">)</span>&nbsp;<span class="ident" id="4463696">commentSizeBefore</span><span class="op" id="4463713">(</span><span class="ident" id="4463714">next</span>&nbsp;<span class="ident" id="4463719">token</span><span class="op" id="4463724">.</span><span class="ident" id="4463725">Position</span><span class="op" id="4463733">)</span>&nbsp;<span class="builtintype" id="4463735">int</span>&nbsp;<span class="op" id="4463739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4463742">//&nbsp;save/restore&nbsp;current&nbsp;p.commentInfo&nbsp;(p.nextComment()&nbsp;modifies&nbsp;it)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4463811">defer</span>&nbsp;<span class="keyword" id="4463817">func</span><span class="op" id="4463821">(</span><span class="ident" id="4463822">info</span>&nbsp;<span class="ident" id="4463827">commentInfo</span><span class="op" id="4463838">)</span>&nbsp;<span class="op" id="4463840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4463844">p</span><span class="op" id="4463845">.</span><span class="ident" id="4463846">commentInfo</span>&nbsp;<span class="op" id="4463858">=</span>&nbsp;<span class="ident" id="4463860">info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4463866">}</span><span class="op" id="4463867">(</span><span class="ident" id="4463868">p</span><span class="op" id="4463869">.</span><span class="ident" id="4463870">commentInfo</span><span class="op" id="4463881">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4463885">size</span>&nbsp;<span class="op" id="4463890">:=</span>&nbsp;<span class="num" id="4463893">0</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4463896">for</span>&nbsp;<span class="ident" id="4463900">p</span><span class="op" id="4463901">.</span><span class="ident" id="4463902">commentBefore</span><span class="op" id="4463915">(</span><span class="ident" id="4463916">next</span><span class="op" id="4463920">)</span>&nbsp;<span class="op" id="4463922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4463926">for</span>&nbsp;<span class="ident" id="4463930">_</span><span class="op" id="4463931">,</span>&nbsp;<span class="ident" id="4463933">c</span>&nbsp;<span class="op" id="4463935">:=</span>&nbsp;<span class="keyword" id="4463938">range</span>&nbsp;<span class="ident" id="4463944">p</span><span class="op" id="4463945">.</span><span class="ident" id="4463946">comment</span><span class="op" id="4463953">.</span><span class="ident" id="4463954">List</span>&nbsp;<span class="op" id="4463959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4463964">size</span>&nbsp;<span class="op" id="4463969">+=</span>&nbsp;<span class="builtinfunc" id="4463972">len</span><span class="op" id="4463975">(</span><span class="ident" id="4463976">c</span><span class="op" id="4463977">.</span><span class="ident" id="4463978">Text</span><span class="op" id="4463982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4463986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4463990">p</span><span class="op" id="4463991">.</span><span class="ident" id="4463992">nextComment</span><span class="op" id="4464003">(</span><span class="op" id="4464004">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4464007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4464010">return</span>&nbsp;<span class="ident" id="4464017">size</span><br>
<span class="lineno"></span><span class="op" id="4464022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4464025">//&nbsp;recordLine&nbsp;records&nbsp;the&nbsp;output&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;next&nbsp;non-whitespace</span><br>
<span class="lineno">175</span><span class="comment" id="4464098">//&nbsp;token&nbsp;in&nbsp;*linePtr.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate&nbsp;line&nbsp;number&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4464172">//&nbsp;formatted&nbsp;construct,&nbsp;independent&nbsp;of&nbsp;pending&nbsp;(not&nbsp;yet&nbsp;emitted)&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="4464248">//&nbsp;or&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="4464264">//</span><br>
<span class="lineno"></span><span class="keyword" id="4464267">func</span>&nbsp;<span class="op" id="4464272">(</span><span class="ident" id="4464273">p</span>&nbsp;<span class="op" id="4464275">*</span><span class="ident" id="4464276">printer</span><span class="op" id="4464283">)</span>&nbsp;<span class="ident" id="4464285">recordLine</span><span class="op" id="4464295">(</span><span class="ident" id="4464296">linePtr</span>&nbsp;<span class="op" id="4464304">*</span><span class="builtintype" id="4464305">int</span><span class="op" id="4464308">)</span>&nbsp;<span class="op" id="4464310">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4464313">p</span><span class="op" id="4464314">.</span><span class="ident" id="4464315">linePtr</span>&nbsp;<span class="op" id="4464323">=</span>&nbsp;<span class="ident" id="4464325">linePtr</span><br>
<span class="lineno"></span><span class="op" id="4464333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4464336">//&nbsp;linesFrom&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;output&nbsp;lines&nbsp;between&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="4464404">//&nbsp;output&nbsp;line&nbsp;and&nbsp;the&nbsp;line&nbsp;argument,&nbsp;ignoring&nbsp;any&nbsp;pending&nbsp;(not&nbsp;yet</span><br>
<span class="lineno">185</span><span class="comment" id="4464472">//&nbsp;emitted)&nbsp;whitespace&nbsp;or&nbsp;comments.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate</span><br>
<span class="lineno"></span><span class="comment" id="4464542">//&nbsp;size&nbsp;(in&nbsp;number&nbsp;of&nbsp;lines)&nbsp;for&nbsp;a&nbsp;formatted&nbsp;construct.</span><br>
<span class="lineno"></span><span class="comment" id="4464598">//</span><br>
<span class="lineno"></span><span class="keyword" id="4464601">func</span>&nbsp;<span class="op" id="4464606">(</span><span class="ident" id="4464607">p</span>&nbsp;<span class="op" id="4464609">*</span><span class="ident" id="4464610">printer</span><span class="op" id="4464617">)</span>&nbsp;<span class="ident" id="4464619">linesFrom</span><span class="op" id="4464628">(</span><span class="ident" id="4464629">line</span>&nbsp;<span class="builtintype" id="4464634">int</span><span class="op" id="4464637">)</span>&nbsp;<span class="builtintype" id="4464639">int</span>&nbsp;<span class="op" id="4464643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4464646">return</span>&nbsp;<span class="ident" id="4464653">p</span><span class="op" id="4464654">.</span><span class="ident" id="4464655">out</span><span class="op" id="4464658">.</span><span class="ident" id="4464659">Line</span>&nbsp;<span class="op" id="4464664">-</span>&nbsp;<span class="ident" id="4464666">line</span><br>
<span class="lineno">190</span><span class="op" id="4464671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4464674">func</span>&nbsp;<span class="op" id="4464679">(</span><span class="ident" id="4464680">p</span>&nbsp;<span class="op" id="4464682">*</span><span class="ident" id="4464683">printer</span><span class="op" id="4464690">)</span>&nbsp;<span class="ident" id="4464692">posFor</span><span class="op" id="4464698">(</span><span class="ident" id="4464699">pos</span>&nbsp;<span class="ident" id="4464703">token</span><span class="op" id="4464708">.</span><span class="ident" id="4464709">Pos</span><span class="op" id="4464712">)</span>&nbsp;<span class="ident" id="4464714">token</span><span class="op" id="4464719">.</span><span class="ident" id="4464720">Position</span>&nbsp;<span class="op" id="4464729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4464732">//&nbsp;not&nbsp;used&nbsp;frequently&nbsp;enough&nbsp;to&nbsp;cache&nbsp;entire&nbsp;token.Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4464794">return</span>&nbsp;<span class="ident" id="4464801">p</span><span class="op" id="4464802">.</span><span class="ident" id="4464803">fset</span><span class="op" id="4464807">.</span><span class="ident" id="4464808">Position</span><span class="op" id="4464816">(</span><span class="ident" id="4464817">pos</span><span class="op" id="4464820">)</span><br>
<span class="lineno">195</span><span class="op" id="4464822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4464825">func</span>&nbsp;<span class="op" id="4464830">(</span><span class="ident" id="4464831">p</span>&nbsp;<span class="op" id="4464833">*</span><span class="ident" id="4464834">printer</span><span class="op" id="4464841">)</span>&nbsp;<span class="ident" id="4464843">lineFor</span><span class="op" id="4464850">(</span><span class="ident" id="4464851">pos</span>&nbsp;<span class="ident" id="4464855">token</span><span class="op" id="4464860">.</span><span class="ident" id="4464861">Pos</span><span class="op" id="4464864">)</span>&nbsp;<span class="builtintype" id="4464866">int</span>&nbsp;<span class="op" id="4464870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4464873">if</span>&nbsp;<span class="ident" id="4464876">pos</span>&nbsp;<span class="op" id="4464880">!=</span>&nbsp;<span class="ident" id="4464883">p</span><span class="op" id="4464884">.</span><span class="ident" id="4464885">cachedPos</span>&nbsp;<span class="op" id="4464895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4464899">p</span><span class="op" id="4464900">.</span><span class="ident" id="4464901">cachedPos</span>&nbsp;<span class="op" id="4464911">=</span>&nbsp;<span class="ident" id="4464913">pos</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4464919">p</span><span class="op" id="4464920">.</span><span class="ident" id="4464921">cachedLine</span>&nbsp;<span class="op" id="4464932">=</span>&nbsp;<span class="ident" id="4464934">p</span><span class="op" id="4464935">.</span><span class="ident" id="4464936">fset</span><span class="op" id="4464940">.</span><span class="ident" id="4464941">Position</span><span class="op" id="4464949">(</span><span class="ident" id="4464950">pos</span><span class="op" id="4464953">)</span><span class="op" id="4464954">.</span><span class="ident" id="4464955">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4464961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4464964">return</span>&nbsp;<span class="ident" id="4464971">p</span><span class="op" id="4464972">.</span><span class="ident" id="4464973">cachedLine</span><br>
<span class="lineno"></span><span class="op" id="4464984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="4464987">//&nbsp;atLineBegin&nbsp;emits&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary&nbsp;and&nbsp;prints&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="keyword" id="4465062">func</span>&nbsp;<span class="op" id="4465067">(</span><span class="ident" id="4465068">p</span>&nbsp;<span class="op" id="4465070">*</span><span class="ident" id="4465071">printer</span><span class="op" id="4465078">)</span>&nbsp;<span class="ident" id="4465080">atLineBegin</span><span class="op" id="4465091">(</span><span class="ident" id="4465092">pos</span>&nbsp;<span class="ident" id="4465096">token</span><span class="op" id="4465101">.</span><span class="ident" id="4465102">Position</span><span class="op" id="4465110">)</span>&nbsp;<span class="op" id="4465112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4465115">//&nbsp;write&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4465155">if</span>&nbsp;<span class="ident" id="4465158">p</span><span class="op" id="4465159">.</span><span class="ident" id="4465160">Config</span><span class="op" id="4465166">.</span><span class="ident" id="4465167">Mode</span><span class="op" id="4465171">&amp;</span><span class="ident" id="4465172">SourcePos</span>&nbsp;<span class="op" id="4465182">!=</span>&nbsp;<span class="num" id="4465185">0</span>&nbsp;<span class="op" id="4465187">&amp;&amp;</span>&nbsp;<span class="ident" id="4465190">pos</span><span class="op" id="4465193">.</span><span class="ident" id="4465194">IsValid</span><span class="op" id="4465201">(</span><span class="op" id="4465202">)</span>&nbsp;<span class="op" id="4465204">&amp;&amp;</span>&nbsp;<span class="op" id="4465207">(</span><span class="ident" id="4465208">p</span><span class="op" id="4465209">.</span><span class="ident" id="4465210">out</span><span class="op" id="4465213">.</span><span class="ident" id="4465214">Line</span>&nbsp;<span class="op" id="4465219">!=</span>&nbsp;<span class="ident" id="4465222">pos</span><span class="op" id="4465225">.</span><span class="ident" id="4465226">Line</span>&nbsp;<span class="op" id="4465231">||</span>&nbsp;<span class="ident" id="4465234">p</span><span class="op" id="4465235">.</span><span class="ident" id="4465236">out</span><span class="op" id="4465239">.</span><span class="ident" id="4465240">Filename</span>&nbsp;<span class="op" id="4465249">!=</span>&nbsp;<span class="ident" id="4465252">pos</span><span class="op" id="4465255">.</span><span class="ident" id="4465256">Filename</span><span class="op" id="4465264">)</span>&nbsp;<span class="op" id="4465266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465270">p</span><span class="op" id="4465271">.</span><span class="ident" id="4465272">output</span>&nbsp;<span class="op" id="4465279">=</span>&nbsp;<span class="builtinfunc" id="4465281">append</span><span class="op" id="4465287">(</span><span class="ident" id="4465288">p</span><span class="op" id="4465289">.</span><span class="ident" id="4465290">output</span><span class="op" id="4465296">,</span>&nbsp;<span class="ident" id="4465298">tabwriter</span><span class="op" id="4465307">.</span><span class="ident" id="4465308">Escape</span><span class="op" id="4465314">)</span>&nbsp;<span class="comment" id="4465316">//&nbsp;protect&nbsp;&#39;\n&#39;&nbsp;in&nbsp;//line&nbsp;from&nbsp;tabwriter&nbsp;interpretation</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465374">p</span><span class="op" id="4465375">.</span><span class="ident" id="4465376">output</span>&nbsp;<span class="op" id="4465383">=</span>&nbsp;<span class="builtinfunc" id="4465385">append</span><span class="op" id="4465391">(</span><span class="ident" id="4465392">p</span><span class="op" id="4465393">.</span><span class="ident" id="4465394">output</span><span class="op" id="4465400">,</span>&nbsp;<span class="ident" id="4465402">fmt</span><span class="op" id="4465405">.</span><span class="ident" id="4465406">Sprintf</span><span class="op" id="4465413">(</span><span class="string" id="4465414">&#34;//line&nbsp;%s:%d\n&#34;</span><span class="op" id="4465430">,</span>&nbsp;<span class="ident" id="4465432">pos</span><span class="op" id="4465435">.</span><span class="ident" id="4465436">Filename</span><span class="op" id="4465444">,</span>&nbsp;<span class="ident" id="4465446">pos</span><span class="op" id="4465449">.</span><span class="ident" id="4465450">Line</span><span class="op" id="4465454">)</span><span class="op" id="4465455">...</span><span class="op" id="4465458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465462">p</span><span class="op" id="4465463">.</span><span class="ident" id="4465464">output</span>&nbsp;<span class="op" id="4465471">=</span>&nbsp;<span class="builtinfunc" id="4465473">append</span><span class="op" id="4465479">(</span><span class="ident" id="4465480">p</span><span class="op" id="4465481">.</span><span class="ident" id="4465482">output</span><span class="op" id="4465488">,</span>&nbsp;<span class="ident" id="4465490">tabwriter</span><span class="op" id="4465499">.</span><span class="ident" id="4465500">Escape</span><span class="op" id="4465506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4465510">//&nbsp;p.out&nbsp;must&nbsp;match&nbsp;the&nbsp;//line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465551">p</span><span class="op" id="4465552">.</span><span class="ident" id="4465553">out</span><span class="op" id="4465556">.</span><span class="ident" id="4465557">Filename</span>&nbsp;<span class="op" id="4465566">=</span>&nbsp;<span class="ident" id="4465568">pos</span><span class="op" id="4465571">.</span><span class="ident" id="4465572">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465583">p</span><span class="op" id="4465584">.</span><span class="ident" id="4465585">out</span><span class="op" id="4465588">.</span><span class="ident" id="4465589">Line</span>&nbsp;<span class="op" id="4465594">=</span>&nbsp;<span class="ident" id="4465596">pos</span><span class="op" id="4465599">.</span><span class="ident" id="4465600">Line</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4465606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4465610">//&nbsp;write&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4465632">//&nbsp;use&nbsp;&#34;hard&#34;&nbsp;htabs&nbsp;-&nbsp;indentation&nbsp;columns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4465675">//&nbsp;must&nbsp;not&nbsp;be&nbsp;discarded&nbsp;by&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465718">n</span>&nbsp;<span class="op" id="4465720">:=</span>&nbsp;<span class="ident" id="4465723">p</span><span class="op" id="4465724">.</span><span class="ident" id="4465725">Config</span><span class="op" id="4465731">.</span><span class="ident" id="4465732">Indent</span>&nbsp;<span class="op" id="4465739">+</span>&nbsp;<span class="ident" id="4465741">p</span><span class="op" id="4465742">.</span><span class="ident" id="4465743">indent</span>&nbsp;<span class="comment" id="4465750">//&nbsp;include&nbsp;base&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4465779">for</span>&nbsp;<span class="ident" id="4465783">i</span>&nbsp;<span class="op" id="4465785">:=</span>&nbsp;<span class="num" id="4465788">0</span><span class="op" id="4465789">;</span>&nbsp;<span class="ident" id="4465791">i</span>&nbsp;<span class="op" id="4465793">&lt;</span>&nbsp;<span class="ident" id="4465795">n</span><span class="op" id="4465796">;</span>&nbsp;<span class="ident" id="4465798">i</span><span class="op" id="4465799">++</span>&nbsp;<span class="op" id="4465802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465806">p</span><span class="op" id="4465807">.</span><span class="ident" id="4465808">output</span>&nbsp;<span class="op" id="4465815">=</span>&nbsp;<span class="builtinfunc" id="4465817">append</span><span class="op" id="4465823">(</span><span class="ident" id="4465824">p</span><span class="op" id="4465825">.</span><span class="ident" id="4465826">output</span><span class="op" id="4465832">,</span>&nbsp;<span class="string" id="4465834">&#39;\t&#39;</span><span class="op" id="4465838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4465841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4465845">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465866">p</span><span class="op" id="4465867">.</span><span class="ident" id="4465868">pos</span><span class="op" id="4465871">.</span><span class="ident" id="4465872">Offset</span>&nbsp;<span class="op" id="4465879">+=</span>&nbsp;<span class="ident" id="4465882">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465885">p</span><span class="op" id="4465886">.</span><span class="ident" id="4465887">pos</span><span class="op" id="4465890">.</span><span class="ident" id="4465891">Column</span>&nbsp;<span class="op" id="4465898">+=</span>&nbsp;<span class="ident" id="4465901">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4465904">p</span><span class="op" id="4465905">.</span><span class="ident" id="4465906">out</span><span class="op" id="4465909">.</span><span class="ident" id="4465910">Column</span>&nbsp;<span class="op" id="4465917">+=</span>&nbsp;<span class="ident" id="4465920">n</span><br>
<span class="lineno"></span><span class="op" id="4465922">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="4465925">//&nbsp;writeByte&nbsp;writes&nbsp;ch&nbsp;n&nbsp;times&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos.</span><br>
<span class="lineno"></span><span class="keyword" id="4465987">func</span>&nbsp;<span class="op" id="4465992">(</span><span class="ident" id="4465993">p</span>&nbsp;<span class="op" id="4465995">*</span><span class="ident" id="4465996">printer</span><span class="op" id="4466003">)</span>&nbsp;<span class="ident" id="4466005">writeByte</span><span class="op" id="4466014">(</span><span class="ident" id="4466015">ch</span>&nbsp;<span class="builtintype" id="4466018">byte</span><span class="op" id="4466022">,</span>&nbsp;<span class="ident" id="4466024">n</span>&nbsp;<span class="builtintype" id="4466026">int</span><span class="op" id="4466029">)</span>&nbsp;<span class="op" id="4466031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4466034">if</span>&nbsp;<span class="ident" id="4466037">p</span><span class="op" id="4466038">.</span><span class="ident" id="4466039">out</span><span class="op" id="4466042">.</span><span class="ident" id="4466043">Column</span>&nbsp;<span class="op" id="4466050">==</span>&nbsp;<span class="num" id="4466053">1</span>&nbsp;<span class="op" id="4466055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466059">p</span><span class="op" id="4466060">.</span><span class="ident" id="4466061">atLineBegin</span><span class="op" id="4466072">(</span><span class="ident" id="4466073">p</span><span class="op" id="4466074">.</span><span class="ident" id="4466075">pos</span><span class="op" id="4466078">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4466081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4466085">for</span>&nbsp;<span class="ident" id="4466089">i</span>&nbsp;<span class="op" id="4466091">:=</span>&nbsp;<span class="num" id="4466094">0</span><span class="op" id="4466095">;</span>&nbsp;<span class="ident" id="4466097">i</span>&nbsp;<span class="op" id="4466099">&lt;</span>&nbsp;<span class="ident" id="4466101">n</span><span class="op" id="4466102">;</span>&nbsp;<span class="ident" id="4466104">i</span><span class="op" id="4466105">++</span>&nbsp;<span class="op" id="4466108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466112">p</span><span class="op" id="4466113">.</span><span class="ident" id="4466114">output</span>&nbsp;<span class="op" id="4466121">=</span>&nbsp;<span class="builtinfunc" id="4466123">append</span><span class="op" id="4466129">(</span><span class="ident" id="4466130">p</span><span class="op" id="4466131">.</span><span class="ident" id="4466132">output</span><span class="op" id="4466138">,</span>&nbsp;<span class="ident" id="4466140">ch</span><span class="op" id="4466142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4466145">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4466149">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466170">p</span><span class="op" id="4466171">.</span><span class="ident" id="4466172">pos</span><span class="op" id="4466175">.</span><span class="ident" id="4466176">Offset</span>&nbsp;<span class="op" id="4466183">+=</span>&nbsp;<span class="ident" id="4466186">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4466189">if</span>&nbsp;<span class="ident" id="4466192">ch</span>&nbsp;<span class="op" id="4466195">==</span>&nbsp;<span class="string" id="4466198">&#39;\n&#39;</span>&nbsp;<span class="op" id="4466203">||</span>&nbsp;<span class="ident" id="4466206">ch</span>&nbsp;<span class="op" id="4466209">==</span>&nbsp;<span class="string" id="4466212">&#39;\f&#39;</span>&nbsp;<span class="op" id="4466217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466221">p</span><span class="op" id="4466222">.</span><span class="ident" id="4466223">pos</span><span class="op" id="4466226">.</span><span class="ident" id="4466227">Line</span>&nbsp;<span class="op" id="4466232">+=</span>&nbsp;<span class="ident" id="4466235">n</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466239">p</span><span class="op" id="4466240">.</span><span class="ident" id="4466241">out</span><span class="op" id="4466244">.</span><span class="ident" id="4466245">Line</span>&nbsp;<span class="op" id="4466250">+=</span>&nbsp;<span class="ident" id="4466253">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466257">p</span><span class="op" id="4466258">.</span><span class="ident" id="4466259">pos</span><span class="op" id="4466262">.</span><span class="ident" id="4466263">Column</span>&nbsp;<span class="op" id="4466270">=</span>&nbsp;<span class="num" id="4466272">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466276">p</span><span class="op" id="4466277">.</span><span class="ident" id="4466278">out</span><span class="op" id="4466281">.</span><span class="ident" id="4466282">Column</span>&nbsp;<span class="op" id="4466289">=</span>&nbsp;<span class="num" id="4466291">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4466295">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4466303">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466306">p</span><span class="op" id="4466307">.</span><span class="ident" id="4466308">pos</span><span class="op" id="4466311">.</span><span class="ident" id="4466312">Column</span>&nbsp;<span class="op" id="4466319">+=</span>&nbsp;<span class="ident" id="4466322">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466325">p</span><span class="op" id="4466326">.</span><span class="ident" id="4466327">out</span><span class="op" id="4466330">.</span><span class="ident" id="4466331">Column</span>&nbsp;<span class="op" id="4466338">+=</span>&nbsp;<span class="ident" id="4466341">n</span><br>
<span class="lineno"></span><span class="op" id="4466343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4466346">//&nbsp;writeString&nbsp;writes&nbsp;the&nbsp;string&nbsp;s&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos,&nbsp;p.out,</span><br>
<span class="lineno">255</span><span class="comment" id="4466419">//&nbsp;and&nbsp;p.last.&nbsp;If&nbsp;isLit&nbsp;is&nbsp;set,&nbsp;s&nbsp;is&nbsp;escaped&nbsp;w/&nbsp;tabwriter.Escape&nbsp;characters</span><br>
<span class="lineno"></span><span class="comment" id="4466495">//&nbsp;to&nbsp;protect&nbsp;s&nbsp;from&nbsp;being&nbsp;interpreted&nbsp;by&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><span class="comment" id="4466552">//</span><br>
<span class="lineno"></span><span class="comment" id="4466555">//&nbsp;Note:&nbsp;writeString&nbsp;is&nbsp;only&nbsp;used&nbsp;to&nbsp;write&nbsp;Go&nbsp;tokens,&nbsp;literals,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4466623">//&nbsp;comments,&nbsp;all&nbsp;of&nbsp;which&nbsp;must&nbsp;be&nbsp;written&nbsp;literally.&nbsp;Thus,&nbsp;it&nbsp;is&nbsp;correct</span><br>
<span class="lineno">260</span><span class="comment" id="4466696">//&nbsp;to&nbsp;always&nbsp;set&nbsp;isLit&nbsp;=&nbsp;true.&nbsp;However,&nbsp;setting&nbsp;it&nbsp;explicitly&nbsp;only&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="4466768">//&nbsp;needed&nbsp;(i.e.,&nbsp;when&nbsp;we&nbsp;don&#39;t&nbsp;know&nbsp;that&nbsp;s&nbsp;contains&nbsp;no&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks)</span><br>
<span class="lineno"></span><span class="comment" id="4466844">//&nbsp;avoids&nbsp;processing&nbsp;extra&nbsp;escape&nbsp;characters&nbsp;and&nbsp;reduces&nbsp;run&nbsp;time&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4466917">//&nbsp;printer&nbsp;benchmark&nbsp;by&nbsp;up&nbsp;to&nbsp;10%.</span><br>
<span class="lineno"></span><span class="comment" id="4466952">//</span><br>
<span class="lineno">265</span><span class="keyword" id="4466955">func</span>&nbsp;<span class="op" id="4466960">(</span><span class="ident" id="4466961">p</span>&nbsp;<span class="op" id="4466963">*</span><span class="ident" id="4466964">printer</span><span class="op" id="4466971">)</span>&nbsp;<span class="ident" id="4466973">writeString</span><span class="op" id="4466984">(</span><span class="ident" id="4466985">pos</span>&nbsp;<span class="ident" id="4466989">token</span><span class="op" id="4466994">.</span><span class="ident" id="4466995">Position</span><span class="op" id="4467003">,</span>&nbsp;<span class="ident" id="4467005">s</span>&nbsp;<span class="builtintype" id="4467007">string</span><span class="op" id="4467013">,</span>&nbsp;<span class="ident" id="4467015">isLit</span>&nbsp;<span class="builtintype" id="4467021">bool</span><span class="op" id="4467025">)</span>&nbsp;<span class="op" id="4467027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467030">if</span>&nbsp;<span class="ident" id="4467033">p</span><span class="op" id="4467034">.</span><span class="ident" id="4467035">out</span><span class="op" id="4467038">.</span><span class="ident" id="4467039">Column</span>&nbsp;<span class="op" id="4467046">==</span>&nbsp;<span class="num" id="4467049">1</span>&nbsp;<span class="op" id="4467051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467055">p</span><span class="op" id="4467056">.</span><span class="ident" id="4467057">atLineBegin</span><span class="op" id="4467068">(</span><span class="ident" id="4467069">pos</span><span class="op" id="4467072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467079">if</span>&nbsp;<span class="ident" id="4467082">pos</span><span class="op" id="4467085">.</span><span class="ident" id="4467086">IsValid</span><span class="op" id="4467093">(</span><span class="op" id="4467094">)</span>&nbsp;<span class="op" id="4467096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4467100">//&nbsp;update&nbsp;p.pos&nbsp;(if&nbsp;pos&nbsp;is&nbsp;invalid,&nbsp;continue&nbsp;with&nbsp;existing&nbsp;p.pos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4467168">//&nbsp;Note:&nbsp;Must&nbsp;do&nbsp;this&nbsp;after&nbsp;handling&nbsp;line&nbsp;beginnings&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4467231">//&nbsp;atLineBegin&nbsp;updates&nbsp;p.pos&nbsp;if&nbsp;there&#39;s&nbsp;indentation,&nbsp;but&nbsp;p.pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4467296">//&nbsp;is&nbsp;the&nbsp;position&nbsp;of&nbsp;s.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467323">p</span><span class="op" id="4467324">.</span><span class="ident" id="4467325">pos</span>&nbsp;<span class="op" id="4467329">=</span>&nbsp;<span class="ident" id="4467331">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467340">if</span>&nbsp;<span class="ident" id="4467343">isLit</span>&nbsp;<span class="op" id="4467349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4467353">//&nbsp;Protect&nbsp;s&nbsp;such&nbsp;that&nbsp;is&nbsp;passes&nbsp;through&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4467410">//&nbsp;unchanged.&nbsp;Note&nbsp;that&nbsp;valid&nbsp;Go&nbsp;programs&nbsp;cannot&nbsp;contain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4467469">//&nbsp;tabwriter.Escape&nbsp;bytes&nbsp;since&nbsp;they&nbsp;do&nbsp;not&nbsp;appear&nbsp;in&nbsp;legal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4467531">//&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467553">p</span><span class="op" id="4467554">.</span><span class="ident" id="4467555">output</span>&nbsp;<span class="op" id="4467562">=</span>&nbsp;<span class="builtinfunc" id="4467564">append</span><span class="op" id="4467570">(</span><span class="ident" id="4467571">p</span><span class="op" id="4467572">.</span><span class="ident" id="4467573">output</span><span class="op" id="4467579">,</span>&nbsp;<span class="ident" id="4467581">tabwriter</span><span class="op" id="4467590">.</span><span class="ident" id="4467591">Escape</span><span class="op" id="4467597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467600">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467604">if</span>&nbsp;<span class="ident" id="4467607">debug</span>&nbsp;<span class="op" id="4467613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467617">p</span><span class="op" id="4467618">.</span><span class="ident" id="4467619">output</span>&nbsp;<span class="op" id="4467626">=</span>&nbsp;<span class="builtinfunc" id="4467628">append</span><span class="op" id="4467634">(</span><span class="ident" id="4467635">p</span><span class="op" id="4467636">.</span><span class="ident" id="4467637">output</span><span class="op" id="4467643">,</span>&nbsp;<span class="ident" id="4467645">fmt</span><span class="op" id="4467648">.</span><span class="ident" id="4467649">Sprintf</span><span class="op" id="4467656">(</span><span class="string" id="4467657">&#34;/*%s*/&#34;</span><span class="op" id="4467665">,</span>&nbsp;<span class="ident" id="4467667">pos</span><span class="op" id="4467670">)</span><span class="op" id="4467671">...</span><span class="op" id="4467674">)</span>&nbsp;<span class="comment" id="4467676">//&nbsp;do&nbsp;not&nbsp;update&nbsp;p.pos!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467704">p</span><span class="op" id="4467705">.</span><span class="ident" id="4467706">output</span>&nbsp;<span class="op" id="4467713">=</span>&nbsp;<span class="builtinfunc" id="4467715">append</span><span class="op" id="4467721">(</span><span class="ident" id="4467722">p</span><span class="op" id="4467723">.</span><span class="ident" id="4467724">output</span><span class="op" id="4467730">,</span>&nbsp;<span class="ident" id="4467732">s</span><span class="op" id="4467733">...</span><span class="op" id="4467736">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4467740">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467761">nlines</span>&nbsp;<span class="op" id="4467768">:=</span>&nbsp;<span class="num" id="4467771">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467774">var</span>&nbsp;<span class="ident" id="4467778">li</span>&nbsp;<span class="builtintype" id="4467781">int</span>&nbsp;<span class="comment" id="4467785">//&nbsp;index&nbsp;of&nbsp;last&nbsp;newline;&nbsp;valid&nbsp;if&nbsp;nlines&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467832">for</span>&nbsp;<span class="ident" id="4467836">i</span>&nbsp;<span class="op" id="4467838">:=</span>&nbsp;<span class="num" id="4467841">0</span><span class="op" id="4467842">;</span>&nbsp;<span class="ident" id="4467844">i</span>&nbsp;<span class="op" id="4467846">&lt;</span>&nbsp;<span class="builtinfunc" id="4467848">len</span><span class="op" id="4467851">(</span><span class="ident" id="4467852">s</span><span class="op" id="4467853">)</span><span class="op" id="4467854">;</span>&nbsp;<span class="ident" id="4467856">i</span><span class="op" id="4467857">++</span>&nbsp;<span class="op" id="4467860">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4467864">//&nbsp;Go&nbsp;tokens&nbsp;cannot&nbsp;contain&nbsp;&#39;\f&#39;&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467924">if</span>&nbsp;<span class="ident" id="4467927">s</span><span class="op" id="4467928">[</span><span class="ident" id="4467929">i</span><span class="op" id="4467930">]</span>&nbsp;<span class="op" id="4467932">==</span>&nbsp;<span class="string" id="4467935">&#39;\n&#39;</span>&nbsp;<span class="op" id="4467940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467945">nlines</span><span class="op" id="4467951">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467957">li</span>&nbsp;<span class="op" id="4467960">=</span>&nbsp;<span class="ident" id="4467962">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467966">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4467969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467972">p</span><span class="op" id="4467973">.</span><span class="ident" id="4467974">pos</span><span class="op" id="4467977">.</span><span class="ident" id="4467978">Offset</span>&nbsp;<span class="op" id="4467985">+=</span>&nbsp;<span class="builtinfunc" id="4467988">len</span><span class="op" id="4467991">(</span><span class="ident" id="4467992">s</span><span class="op" id="4467993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4467996">if</span>&nbsp;<span class="ident" id="4467999">nlines</span>&nbsp;<span class="op" id="4468006">&gt;</span>&nbsp;<span class="num" id="4468008">0</span>&nbsp;<span class="op" id="4468010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468014">p</span><span class="op" id="4468015">.</span><span class="ident" id="4468016">pos</span><span class="op" id="4468019">.</span><span class="ident" id="4468020">Line</span>&nbsp;<span class="op" id="4468025">+=</span>&nbsp;<span class="ident" id="4468028">nlines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468037">p</span><span class="op" id="4468038">.</span><span class="ident" id="4468039">out</span><span class="op" id="4468042">.</span><span class="ident" id="4468043">Line</span>&nbsp;<span class="op" id="4468048">+=</span>&nbsp;<span class="ident" id="4468051">nlines</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468060">c</span>&nbsp;<span class="op" id="4468062">:=</span>&nbsp;<span class="builtinfunc" id="4468065">len</span><span class="op" id="4468068">(</span><span class="ident" id="4468069">s</span><span class="op" id="4468070">)</span>&nbsp;<span class="op" id="4468072">-</span>&nbsp;<span class="ident" id="4468074">li</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468079">p</span><span class="op" id="4468080">.</span><span class="ident" id="4468081">pos</span><span class="op" id="4468084">.</span><span class="ident" id="4468085">Column</span>&nbsp;<span class="op" id="4468092">=</span>&nbsp;<span class="ident" id="4468094">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468098">p</span><span class="op" id="4468099">.</span><span class="ident" id="4468100">out</span><span class="op" id="4468103">.</span><span class="ident" id="4468104">Column</span>&nbsp;<span class="op" id="4468111">=</span>&nbsp;<span class="ident" id="4468113">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4468116">}</span>&nbsp;<span class="keyword" id="4468118">else</span>&nbsp;<span class="op" id="4468123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468127">p</span><span class="op" id="4468128">.</span><span class="ident" id="4468129">pos</span><span class="op" id="4468132">.</span><span class="ident" id="4468133">Column</span>&nbsp;<span class="op" id="4468140">+=</span>&nbsp;<span class="builtinfunc" id="4468143">len</span><span class="op" id="4468146">(</span><span class="ident" id="4468147">s</span><span class="op" id="4468148">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468152">p</span><span class="op" id="4468153">.</span><span class="ident" id="4468154">out</span><span class="op" id="4468157">.</span><span class="ident" id="4468158">Column</span>&nbsp;<span class="op" id="4468165">+=</span>&nbsp;<span class="builtinfunc" id="4468168">len</span><span class="op" id="4468171">(</span><span class="ident" id="4468172">s</span><span class="op" id="4468173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4468176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468180">if</span>&nbsp;<span class="ident" id="4468183">isLit</span>&nbsp;<span class="op" id="4468189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468193">p</span><span class="op" id="4468194">.</span><span class="ident" id="4468195">output</span>&nbsp;<span class="op" id="4468202">=</span>&nbsp;<span class="builtinfunc" id="4468204">append</span><span class="op" id="4468210">(</span><span class="ident" id="4468211">p</span><span class="op" id="4468212">.</span><span class="ident" id="4468213">output</span><span class="op" id="4468219">,</span>&nbsp;<span class="ident" id="4468221">tabwriter</span><span class="op" id="4468230">.</span><span class="ident" id="4468231">Escape</span><span class="op" id="4468237">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4468240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468244">p</span><span class="op" id="4468245">.</span><span class="ident" id="4468246">last</span>&nbsp;<span class="op" id="4468251">=</span>&nbsp;<span class="ident" id="4468253">p</span><span class="op" id="4468254">.</span><span class="ident" id="4468255">pos</span><br>
<span class="lineno"></span><span class="op" id="4468259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="comment" id="4468262">//&nbsp;writeCommentPrefix&nbsp;writes&nbsp;the&nbsp;whitespace&nbsp;before&nbsp;a&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="4468324">//&nbsp;If&nbsp;there&nbsp;is&nbsp;any&nbsp;pending&nbsp;whitespace,&nbsp;it&nbsp;consumes&nbsp;as&nbsp;much&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4468386">//&nbsp;it&nbsp;as&nbsp;is&nbsp;likely&nbsp;to&nbsp;help&nbsp;position&nbsp;the&nbsp;comment&nbsp;nicely.</span><br>
<span class="lineno"></span><span class="comment" id="4468442">//&nbsp;pos&nbsp;is&nbsp;the&nbsp;comment&nbsp;position,&nbsp;next&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;item</span><br>
<span class="lineno"></span><span class="comment" id="4468504">//&nbsp;after&nbsp;all&nbsp;pending&nbsp;comments,&nbsp;prev&nbsp;is&nbsp;the&nbsp;previous&nbsp;comment&nbsp;in</span><br>
<span class="lineno">325</span><span class="comment" id="4468567">//&nbsp;a&nbsp;group&nbsp;of&nbsp;comments&nbsp;(or&nbsp;nil),&nbsp;and&nbsp;tok&nbsp;is&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="4468627">//</span><br>
<span class="lineno"></span><span class="keyword" id="4468630">func</span>&nbsp;<span class="op" id="4468635">(</span><span class="ident" id="4468636">p</span>&nbsp;<span class="op" id="4468638">*</span><span class="ident" id="4468639">printer</span><span class="op" id="4468646">)</span>&nbsp;<span class="ident" id="4468648">writeCommentPrefix</span><span class="op" id="4468666">(</span><span class="ident" id="4468667">pos</span><span class="op" id="4468670">,</span>&nbsp;<span class="ident" id="4468672">next</span>&nbsp;<span class="ident" id="4468677">token</span><span class="op" id="4468682">.</span><span class="ident" id="4468683">Position</span><span class="op" id="4468691">,</span>&nbsp;<span class="ident" id="4468693">prev</span><span class="op" id="4468697">,</span>&nbsp;<span class="ident" id="4468699">comment</span>&nbsp;<span class="op" id="4468707">*</span><span class="ident" id="4468708">ast</span><span class="op" id="4468711">.</span><span class="ident" id="4468712">Comment</span><span class="op" id="4468719">,</span>&nbsp;<span class="ident" id="4468721">tok</span>&nbsp;<span class="ident" id="4468725">token</span><span class="op" id="4468730">.</span><span class="ident" id="4468731">Token</span><span class="op" id="4468736">)</span>&nbsp;<span class="op" id="4468738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468741">if</span>&nbsp;<span class="builtinfunc" id="4468744">len</span><span class="op" id="4468747">(</span><span class="ident" id="4468748">p</span><span class="op" id="4468749">.</span><span class="ident" id="4468750">output</span><span class="op" id="4468756">)</span>&nbsp;<span class="op" id="4468758">==</span>&nbsp;<span class="num" id="4468761">0</span>&nbsp;<span class="op" id="4468763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4468767">//&nbsp;the&nbsp;comment&nbsp;is&nbsp;the&nbsp;first&nbsp;item&nbsp;to&nbsp;be&nbsp;printed&nbsp;-&nbsp;don&#39;t&nbsp;write&nbsp;any&nbsp;whitespace</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468845">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4468853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468857">if</span>&nbsp;<span class="ident" id="4468860">pos</span><span class="op" id="4468863">.</span><span class="ident" id="4468864">IsValid</span><span class="op" id="4468871">(</span><span class="op" id="4468872">)</span>&nbsp;<span class="op" id="4468874">&amp;&amp;</span>&nbsp;<span class="ident" id="4468877">pos</span><span class="op" id="4468880">.</span><span class="ident" id="4468881">Filename</span>&nbsp;<span class="op" id="4468890">!=</span>&nbsp;<span class="ident" id="4468893">p</span><span class="op" id="4468894">.</span><span class="ident" id="4468895">last</span><span class="op" id="4468899">.</span><span class="ident" id="4468900">Filename</span>&nbsp;<span class="op" id="4468909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4468913">//&nbsp;comment&nbsp;in&nbsp;a&nbsp;different&nbsp;file&nbsp;-&nbsp;separate&nbsp;with&nbsp;newlines</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468971">p</span><span class="op" id="4468972">.</span><span class="ident" id="4468973">writeByte</span><span class="op" id="4468982">(</span><span class="string" id="4468983">&#39;\f&#39;</span><span class="op" id="4468987">,</span>&nbsp;<span class="ident" id="4468989">maxNewlines</span><span class="op" id="4469000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469004">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469016">if</span>&nbsp;<span class="ident" id="4469019">pos</span><span class="op" id="4469022">.</span><span class="ident" id="4469023">Line</span>&nbsp;<span class="op" id="4469028">==</span>&nbsp;<span class="ident" id="4469031">p</span><span class="op" id="4469032">.</span><span class="ident" id="4469033">last</span><span class="op" id="4469037">.</span><span class="ident" id="4469038">Line</span>&nbsp;<span class="op" id="4469043">&amp;&amp;</span>&nbsp;<span class="op" id="4469046">(</span><span class="ident" id="4469047">prev</span>&nbsp;<span class="op" id="4469052">==</span>&nbsp;<span class="ident" id="4469055">nil</span>&nbsp;<span class="op" id="4469059">||</span>&nbsp;<span class="ident" id="4469062">prev</span><span class="op" id="4469066">.</span><span class="ident" id="4469067">Text</span><span class="op" id="4469071">[</span><span class="num" id="4469072">1</span><span class="op" id="4469073">]</span>&nbsp;<span class="op" id="4469075">!=</span>&nbsp;<span class="string" id="4469078">&#39;/&#39;</span><span class="op" id="4469081">)</span>&nbsp;<span class="op" id="4469083">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4469087">//&nbsp;comment&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;last&nbsp;item:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4469131">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469173">hasSep</span>&nbsp;<span class="op" id="4469180">:=</span>&nbsp;<span class="builtintype" id="4469183">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469191">if</span>&nbsp;<span class="ident" id="4469194">prev</span>&nbsp;<span class="op" id="4469199">==</span>&nbsp;<span class="ident" id="4469202">nil</span>&nbsp;<span class="op" id="4469206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4469211">//&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;comment&nbsp;group</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469250">j</span>&nbsp;<span class="op" id="4469252">:=</span>&nbsp;<span class="num" id="4469255">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469260">for</span>&nbsp;<span class="ident" id="4469264">i</span><span class="op" id="4469265">,</span>&nbsp;<span class="ident" id="4469267">ch</span>&nbsp;<span class="op" id="4469270">:=</span>&nbsp;<span class="keyword" id="4469273">range</span>&nbsp;<span class="ident" id="4469279">p</span><span class="op" id="4469280">.</span><span class="ident" id="4469281">wsbuf</span>&nbsp;<span class="op" id="4469287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469293">switch</span>&nbsp;<span class="ident" id="4469300">ch</span>&nbsp;<span class="op" id="4469303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469309">case</span>&nbsp;<span class="ident" id="4469314">blank</span><span class="op" id="4469319">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4469326">//&nbsp;ignore&nbsp;any&nbsp;blanks&nbsp;before&nbsp;a&nbsp;comment</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469369">p</span><span class="op" id="4469370">.</span><span class="ident" id="4469371">wsbuf</span><span class="op" id="4469376">[</span><span class="ident" id="4469377">i</span><span class="op" id="4469378">]</span>&nbsp;<span class="op" id="4469380">=</span>&nbsp;<span class="ident" id="4469382">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469394">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469407">case</span>&nbsp;<span class="ident" id="4469412">vtab</span><span class="op" id="4469416">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4469423">//&nbsp;respect&nbsp;existing&nbsp;tabs&nbsp;-&nbsp;important</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4469465">//&nbsp;for&nbsp;proper&nbsp;formatting&nbsp;of&nbsp;commented&nbsp;structs</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469516">hasSep</span>&nbsp;<span class="op" id="4469523">=</span>&nbsp;<span class="builtintype" id="4469525">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469535">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469548">case</span>&nbsp;<span class="ident" id="4469553">indent</span><span class="op" id="4469559">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4469566">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469600">continue</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469619">j</span>&nbsp;<span class="op" id="4469621">=</span>&nbsp;<span class="ident" id="4469623">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469629">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469643">p</span><span class="op" id="4469644">.</span><span class="ident" id="4469645">writeWhitespace</span><span class="op" id="4469660">(</span><span class="ident" id="4469661">j</span><span class="op" id="4469662">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4469670">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469717">if</span>&nbsp;<span class="op" id="4469720">!</span><span class="ident" id="4469721">hasSep</span>&nbsp;<span class="op" id="4469728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469733">sep</span>&nbsp;<span class="op" id="4469737">:=</span>&nbsp;<span class="builtintype" id="4469740">byte</span><span class="op" id="4469744">(</span><span class="string" id="4469745">&#39;\t&#39;</span><span class="op" id="4469749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469754">if</span>&nbsp;<span class="ident" id="4469757">pos</span><span class="op" id="4469760">.</span><span class="ident" id="4469761">Line</span>&nbsp;<span class="op" id="4469766">==</span>&nbsp;<span class="ident" id="4469769">next</span><span class="op" id="4469773">.</span><span class="ident" id="4469774">Line</span>&nbsp;<span class="op" id="4469779">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4469785">//&nbsp;next&nbsp;item&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4469837">//&nbsp;(which&nbsp;must&nbsp;be&nbsp;a&nbsp;/*-style&nbsp;comment):&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4469889">//&nbsp;with&nbsp;a&nbsp;blank&nbsp;instead&nbsp;of&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469926">sep</span>&nbsp;<span class="op" id="4469930">=</span>&nbsp;<span class="string" id="4469932">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469939">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469944">p</span><span class="op" id="4469945">.</span><span class="ident" id="4469946">writeByte</span><span class="op" id="4469955">(</span><span class="ident" id="4469956">sep</span><span class="op" id="4469959">,</span>&nbsp;<span class="num" id="4469961">1</span><span class="op" id="4469962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469970">}</span>&nbsp;<span class="keyword" id="4469972">else</span>&nbsp;<span class="op" id="4469977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4469981">//&nbsp;comment&nbsp;on&nbsp;a&nbsp;different&nbsp;line:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4470015">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470058">droppedLinebreak</span>&nbsp;<span class="op" id="4470075">:=</span>&nbsp;<span class="builtintype" id="4470078">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470086">j</span>&nbsp;<span class="op" id="4470088">:=</span>&nbsp;<span class="num" id="4470091">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470095">for</span>&nbsp;<span class="ident" id="4470099">i</span><span class="op" id="4470100">,</span>&nbsp;<span class="ident" id="4470102">ch</span>&nbsp;<span class="op" id="4470105">:=</span>&nbsp;<span class="keyword" id="4470108">range</span>&nbsp;<span class="ident" id="4470114">p</span><span class="op" id="4470115">.</span><span class="ident" id="4470116">wsbuf</span>&nbsp;<span class="op" id="4470122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470127">switch</span>&nbsp;<span class="ident" id="4470134">ch</span>&nbsp;<span class="op" id="4470137">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470142">case</span>&nbsp;<span class="ident" id="4470147">blank</span><span class="op" id="4470152">,</span>&nbsp;<span class="ident" id="4470154">vtab</span><span class="op" id="4470158">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4470164">//&nbsp;ignore&nbsp;any&nbsp;horizontal&nbsp;whitespace&nbsp;before&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470223">p</span><span class="op" id="4470224">.</span><span class="ident" id="4470225">wsbuf</span><span class="op" id="4470230">[</span><span class="ident" id="4470231">i</span><span class="op" id="4470232">]</span>&nbsp;<span class="op" id="4470234">=</span>&nbsp;<span class="ident" id="4470236">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470247">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470259">case</span>&nbsp;<span class="ident" id="4470264">indent</span><span class="op" id="4470270">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4470276">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470309">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470321">case</span>&nbsp;<span class="ident" id="4470326">unindent</span><span class="op" id="4470334">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4470340">//&nbsp;if&nbsp;this&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;unindent,&nbsp;apply&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4470390">//&nbsp;as&nbsp;it&nbsp;is&nbsp;(likely)&nbsp;belonging&nbsp;to&nbsp;the&nbsp;last</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4470437">//&nbsp;construct&nbsp;(e.g.,&nbsp;a&nbsp;multi-line&nbsp;expression&nbsp;list)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4470491">//&nbsp;and&nbsp;is&nbsp;not&nbsp;part&nbsp;of&nbsp;closing&nbsp;a&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470533">if</span>&nbsp;<span class="ident" id="4470536">i</span><span class="op" id="4470537">+</span><span class="num" id="4470538">1</span>&nbsp;<span class="op" id="4470540">&lt;</span>&nbsp;<span class="builtinfunc" id="4470542">len</span><span class="op" id="4470545">(</span><span class="ident" id="4470546">p</span><span class="op" id="4470547">.</span><span class="ident" id="4470548">wsbuf</span><span class="op" id="4470553">)</span>&nbsp;<span class="op" id="4470555">&amp;&amp;</span>&nbsp;<span class="ident" id="4470558">p</span><span class="op" id="4470559">.</span><span class="ident" id="4470560">wsbuf</span><span class="op" id="4470565">[</span><span class="ident" id="4470566">i</span><span class="op" id="4470567">+</span><span class="num" id="4470568">1</span><span class="op" id="4470569">]</span>&nbsp;<span class="op" id="4470571">==</span>&nbsp;<span class="ident" id="4470574">unindent</span>&nbsp;<span class="op" id="4470583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470590">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4470603">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4470609">//&nbsp;if&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;not&nbsp;a&nbsp;closing&nbsp;},&nbsp;apply&nbsp;the&nbsp;unindent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4470673">//&nbsp;if&nbsp;it&nbsp;appears&nbsp;that&nbsp;the&nbsp;comment&nbsp;is&nbsp;aligned&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4470731">//&nbsp;token;&nbsp;otherwise&nbsp;assume&nbsp;the&nbsp;unindent&nbsp;is&nbsp;part&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4470788">//&nbsp;closing&nbsp;block&nbsp;and&nbsp;stop&nbsp;(this&nbsp;scenario&nbsp;appears&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4470846">//&nbsp;comments&nbsp;before&nbsp;a&nbsp;case&nbsp;label&nbsp;where&nbsp;the&nbsp;comments</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4470901">//&nbsp;apply&nbsp;to&nbsp;the&nbsp;next&nbsp;case&nbsp;instead&nbsp;of&nbsp;the&nbsp;current&nbsp;one)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470959">if</span>&nbsp;<span class="ident" id="4470962">tok</span>&nbsp;<span class="op" id="4470966">!=</span>&nbsp;<span class="ident" id="4470969">token</span><span class="op" id="4470974">.</span><span class="ident" id="4470975">RBRACE</span>&nbsp;<span class="op" id="4470982">&amp;&amp;</span>&nbsp;<span class="ident" id="4470985">pos</span><span class="op" id="4470988">.</span><span class="ident" id="4470989">Column</span>&nbsp;<span class="op" id="4470996">==</span>&nbsp;<span class="ident" id="4470999">next</span><span class="op" id="4471003">.</span><span class="ident" id="4471004">Column</span>&nbsp;<span class="op" id="4471011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471018">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4471031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471036">case</span>&nbsp;<span class="ident" id="4471041">newline</span><span class="op" id="4471048">,</span>&nbsp;<span class="ident" id="4471050">formfeed</span><span class="op" id="4471058">:</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471064">p</span><span class="op" id="4471065">.</span><span class="ident" id="4471066">wsbuf</span><span class="op" id="4471071">[</span><span class="ident" id="4471072">i</span><span class="op" id="4471073">]</span>&nbsp;<span class="op" id="4471075">=</span>&nbsp;<span class="ident" id="4471077">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471088">droppedLinebreak</span>&nbsp;<span class="op" id="4471105">=</span>&nbsp;<span class="ident" id="4471107">prev</span>&nbsp;<span class="op" id="4471112">==</span>&nbsp;<span class="ident" id="4471115">nil</span>&nbsp;<span class="comment" id="4471119">//&nbsp;record&nbsp;only&nbsp;if&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4471165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471170">j</span>&nbsp;<span class="op" id="4471172">=</span>&nbsp;<span class="ident" id="4471174">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471179">break</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4471187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471191">p</span><span class="op" id="4471192">.</span><span class="ident" id="4471193">writeWhitespace</span><span class="op" id="4471208">(</span><span class="ident" id="4471209">j</span><span class="op" id="4471210">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4471215">//&nbsp;determine&nbsp;number&nbsp;of&nbsp;linebreaks&nbsp;before&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471270">n</span>&nbsp;<span class="op" id="4471272">:=</span>&nbsp;<span class="num" id="4471275">0</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471279">if</span>&nbsp;<span class="ident" id="4471282">pos</span><span class="op" id="4471285">.</span><span class="ident" id="4471286">IsValid</span><span class="op" id="4471293">(</span><span class="op" id="4471294">)</span>&nbsp;<span class="op" id="4471296">&amp;&amp;</span>&nbsp;<span class="ident" id="4471299">p</span><span class="op" id="4471300">.</span><span class="ident" id="4471301">last</span><span class="op" id="4471305">.</span><span class="ident" id="4471306">IsValid</span><span class="op" id="4471313">(</span><span class="op" id="4471314">)</span>&nbsp;<span class="op" id="4471316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471321">n</span>&nbsp;<span class="op" id="4471323">=</span>&nbsp;<span class="ident" id="4471325">pos</span><span class="op" id="4471328">.</span><span class="ident" id="4471329">Line</span>&nbsp;<span class="op" id="4471334">-</span>&nbsp;<span class="ident" id="4471336">p</span><span class="op" id="4471337">.</span><span class="ident" id="4471338">last</span><span class="op" id="4471342">.</span><span class="ident" id="4471343">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471351">if</span>&nbsp;<span class="ident" id="4471354">n</span>&nbsp;<span class="op" id="4471356">&lt;</span>&nbsp;<span class="num" id="4471358">0</span>&nbsp;<span class="op" id="4471360">{</span>&nbsp;<span class="comment" id="4471362">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471389">n</span>&nbsp;<span class="op" id="4471391">=</span>&nbsp;<span class="num" id="4471393">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4471398">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4471402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4471407">//&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;only&nbsp;(p.indent&nbsp;==&nbsp;0),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4471461">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;newline&nbsp;if&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4471513">//&nbsp;this&nbsp;preserves&nbsp;a&nbsp;blank&nbsp;line&nbsp;before&nbsp;documentation</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4471567">//&nbsp;comments&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;(issue&nbsp;2570)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471621">if</span>&nbsp;<span class="ident" id="4471624">p</span><span class="op" id="4471625">.</span><span class="ident" id="4471626">indent</span>&nbsp;<span class="op" id="4471633">==</span>&nbsp;<span class="num" id="4471636">0</span>&nbsp;<span class="op" id="4471638">&amp;&amp;</span>&nbsp;<span class="ident" id="4471641">droppedLinebreak</span>&nbsp;<span class="op" id="4471658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471663">n</span><span class="op" id="4471664">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4471669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4471674">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4471722">//&nbsp;if&nbsp;the&nbsp;previous&nbsp;comment&nbsp;was&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471770">if</span>&nbsp;<span class="ident" id="4471773">n</span>&nbsp;<span class="op" id="4471775">==</span>&nbsp;<span class="num" id="4471778">0</span>&nbsp;<span class="op" id="4471780">&amp;&amp;</span>&nbsp;<span class="ident" id="4471783">prev</span>&nbsp;<span class="op" id="4471788">!=</span>&nbsp;<span class="ident" id="4471791">nil</span>&nbsp;<span class="op" id="4471795">&amp;&amp;</span>&nbsp;<span class="ident" id="4471798">prev</span><span class="op" id="4471802">.</span><span class="ident" id="4471803">Text</span><span class="op" id="4471807">[</span><span class="num" id="4471808">1</span><span class="op" id="4471809">]</span>&nbsp;<span class="op" id="4471811">==</span>&nbsp;<span class="string" id="4471814">&#39;/&#39;</span>&nbsp;<span class="op" id="4471818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471823">n</span>&nbsp;<span class="op" id="4471825">=</span>&nbsp;<span class="num" id="4471827">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4471831">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471836">if</span>&nbsp;<span class="ident" id="4471839">n</span>&nbsp;<span class="op" id="4471841">&gt;</span>&nbsp;<span class="num" id="4471843">0</span>&nbsp;<span class="op" id="4471845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4471850">//&nbsp;use&nbsp;formfeeds&nbsp;to&nbsp;break&nbsp;columns&nbsp;before&nbsp;a&nbsp;comment;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4471905">//&nbsp;this&nbsp;is&nbsp;analogous&nbsp;to&nbsp;using&nbsp;formfeeds&nbsp;to&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4471960">//&nbsp;individual&nbsp;lines&nbsp;of&nbsp;/*-style&nbsp;comments</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472004">p</span><span class="op" id="4472005">.</span><span class="ident" id="4472006">writeByte</span><span class="op" id="4472015">(</span><span class="string" id="4472016">&#39;\f&#39;</span><span class="op" id="4472020">,</span>&nbsp;<span class="ident" id="4472022">nlimit</span><span class="op" id="4472028">(</span><span class="ident" id="4472029">n</span><span class="op" id="4472030">)</span><span class="op" id="4472031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4472035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4472038">}</span><br>
<span class="lineno"></span><span class="op" id="4472040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="comment" id="4472043">//&nbsp;Returns&nbsp;true&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="4472090">//&nbsp;(only&nbsp;tabs&nbsp;and&nbsp;blanks&nbsp;can&nbsp;appear&nbsp;in&nbsp;the&nbsp;printer&#39;s&nbsp;context).</span><br>
<span class="lineno"></span><span class="comment" id="4472153">//</span><br>
<span class="lineno"></span><span class="keyword" id="4472156">func</span>&nbsp;<span class="ident" id="4472161">isBlank</span><span class="op" id="4472168">(</span><span class="ident" id="4472169">s</span>&nbsp;<span class="builtintype" id="4472171">string</span><span class="op" id="4472177">)</span>&nbsp;<span class="builtintype" id="4472179">bool</span>&nbsp;<span class="op" id="4472184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472187">for</span>&nbsp;<span class="ident" id="4472191">i</span>&nbsp;<span class="op" id="4472193">:=</span>&nbsp;<span class="num" id="4472196">0</span><span class="op" id="4472197">;</span>&nbsp;<span class="ident" id="4472199">i</span>&nbsp;<span class="op" id="4472201">&lt;</span>&nbsp;<span class="builtinfunc" id="4472203">len</span><span class="op" id="4472206">(</span><span class="ident" id="4472207">s</span><span class="op" id="4472208">)</span><span class="op" id="4472209">;</span>&nbsp;<span class="ident" id="4472211">i</span><span class="op" id="4472212">++</span>&nbsp;<span class="op" id="4472215">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472219">if</span>&nbsp;<span class="ident" id="4472222">s</span><span class="op" id="4472223">[</span><span class="ident" id="4472224">i</span><span class="op" id="4472225">]</span>&nbsp;<span class="op" id="4472227">&gt;</span>&nbsp;<span class="string" id="4472229">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4472233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472238">return</span>&nbsp;<span class="builtintype" id="4472245">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4472253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4472256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472259">return</span>&nbsp;<span class="builtintype" id="4472266">true</span><br>
<span class="lineno">460</span><span class="op" id="4472271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4472274">//&nbsp;commonPrefix&nbsp;returns&nbsp;the&nbsp;common&nbsp;prefix&nbsp;of&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="4472328">func</span>&nbsp;<span class="ident" id="4472333">commonPrefix</span><span class="op" id="4472345">(</span><span class="ident" id="4472346">a</span><span class="op" id="4472347">,</span>&nbsp;<span class="ident" id="4472349">b</span>&nbsp;<span class="builtintype" id="4472351">string</span><span class="op" id="4472357">)</span>&nbsp;<span class="builtintype" id="4472359">string</span>&nbsp;<span class="op" id="4472366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472369">i</span>&nbsp;<span class="op" id="4472371">:=</span>&nbsp;<span class="num" id="4472374">0</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472377">for</span>&nbsp;<span class="ident" id="4472381">i</span>&nbsp;<span class="op" id="4472383">&lt;</span>&nbsp;<span class="builtinfunc" id="4472385">len</span><span class="op" id="4472388">(</span><span class="ident" id="4472389">a</span><span class="op" id="4472390">)</span>&nbsp;<span class="op" id="4472392">&amp;&amp;</span>&nbsp;<span class="ident" id="4472395">i</span>&nbsp;<span class="op" id="4472397">&lt;</span>&nbsp;<span class="builtinfunc" id="4472399">len</span><span class="op" id="4472402">(</span><span class="ident" id="4472403">b</span><span class="op" id="4472404">)</span>&nbsp;<span class="op" id="4472406">&amp;&amp;</span>&nbsp;<span class="ident" id="4472409">a</span><span class="op" id="4472410">[</span><span class="ident" id="4472411">i</span><span class="op" id="4472412">]</span>&nbsp;<span class="op" id="4472414">==</span>&nbsp;<span class="ident" id="4472417">b</span><span class="op" id="4472418">[</span><span class="ident" id="4472419">i</span><span class="op" id="4472420">]</span>&nbsp;<span class="op" id="4472422">&amp;&amp;</span>&nbsp;<span class="op" id="4472425">(</span><span class="ident" id="4472426">a</span><span class="op" id="4472427">[</span><span class="ident" id="4472428">i</span><span class="op" id="4472429">]</span>&nbsp;<span class="op" id="4472431">&lt;=</span>&nbsp;<span class="string" id="4472434">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4472438">||</span>&nbsp;<span class="ident" id="4472441">a</span><span class="op" id="4472442">[</span><span class="ident" id="4472443">i</span><span class="op" id="4472444">]</span>&nbsp;<span class="op" id="4472446">==</span>&nbsp;<span class="string" id="4472449">&#39;*&#39;</span><span class="op" id="4472452">)</span>&nbsp;<span class="op" id="4472454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472458">i</span><span class="op" id="4472459">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4472463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472466">return</span>&nbsp;<span class="ident" id="4472473">a</span><span class="op" id="4472474">[</span><span class="num" id="4472475">0</span><span class="op" id="4472476">:</span><span class="ident" id="4472477">i</span><span class="op" id="4472478">]</span><br>
<span class="lineno"></span><span class="op" id="4472480">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="4472483">//&nbsp;trimRight&nbsp;returns&nbsp;s&nbsp;with&nbsp;trailing&nbsp;whitespace&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="4472540">func</span>&nbsp;<span class="ident" id="4472545">trimRight</span><span class="op" id="4472554">(</span><span class="ident" id="4472555">s</span>&nbsp;<span class="builtintype" id="4472557">string</span><span class="op" id="4472563">)</span>&nbsp;<span class="builtintype" id="4472565">string</span>&nbsp;<span class="op" id="4472572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472575">return</span>&nbsp;<span class="ident" id="4472582">strings</span><span class="op" id="4472589">.</span><span class="ident" id="4472590">TrimRightFunc</span><span class="op" id="4472603">(</span><span class="ident" id="4472604">s</span><span class="op" id="4472605">,</span>&nbsp;<span class="ident" id="4472607">unicode</span><span class="op" id="4472614">.</span><span class="ident" id="4472615">IsSpace</span><span class="op" id="4472622">)</span><br>
<span class="lineno"></span><span class="op" id="4472624">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="4472627">//&nbsp;stripCommonPrefix&nbsp;removes&nbsp;a&nbsp;common&nbsp;prefix&nbsp;from&nbsp;/*-style&nbsp;comment&nbsp;lines&nbsp;(unless&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="4472711">//&nbsp;comment&nbsp;line&nbsp;is&nbsp;indented,&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;line&nbsp;have&nbsp;some&nbsp;form&nbsp;of&nbsp;space&nbsp;prefix).</span><br>
<span class="lineno"></span><span class="comment" id="4472796">//&nbsp;The&nbsp;prefix&nbsp;is&nbsp;computed&nbsp;using&nbsp;heuristics&nbsp;such&nbsp;that&nbsp;is&nbsp;likely&nbsp;that&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="4472876">//&nbsp;contents&nbsp;are&nbsp;nicely&nbsp;laid&nbsp;out&nbsp;after&nbsp;re-printing&nbsp;each&nbsp;line&nbsp;using&nbsp;the&nbsp;printer&#39;s</span><br>
<span class="lineno">480</span><span class="comment" id="4472956">//&nbsp;current&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="comment" id="4472980">//</span><br>
<span class="lineno"></span><span class="keyword" id="4472983">func</span>&nbsp;<span class="ident" id="4472988">stripCommonPrefix</span><span class="op" id="4473005">(</span><span class="ident" id="4473006">lines</span>&nbsp;<span class="op" id="4473012">[</span><span class="op" id="4473013">]</span><span class="builtintype" id="4473014">string</span><span class="op" id="4473020">)</span>&nbsp;<span class="op" id="4473022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473025">if</span>&nbsp;<span class="builtinfunc" id="4473028">len</span><span class="op" id="4473031">(</span><span class="ident" id="4473032">lines</span><span class="op" id="4473037">)</span>&nbsp;<span class="op" id="4473039">&lt;=</span>&nbsp;<span class="num" id="4473042">1</span>&nbsp;<span class="op" id="4473044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473048">return</span>&nbsp;<span class="comment" id="4473055">//&nbsp;at&nbsp;most&nbsp;one&nbsp;line&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4473092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473095">//&nbsp;len(lines)&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473115">//&nbsp;The&nbsp;heuristic&nbsp;in&nbsp;this&nbsp;function&nbsp;tries&nbsp;to&nbsp;handle&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473172">//&nbsp;common&nbsp;patterns&nbsp;of&nbsp;/*-style&nbsp;comments:&nbsp;Comments&nbsp;where</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473229">//&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;are&nbsp;aligned&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473283">//&nbsp;rest&nbsp;of&nbsp;the&nbsp;comment&nbsp;text&nbsp;is&nbsp;aligned&nbsp;and&nbsp;indented&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473341">//&nbsp;blanks&nbsp;or&nbsp;tabs,&nbsp;cases&nbsp;with&nbsp;a&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473399">//&nbsp;on&nbsp;the&nbsp;left,&nbsp;and&nbsp;cases&nbsp;where&nbsp;the&nbsp;closing&nbsp;*/&nbsp;is&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473457">//&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;last&nbsp;comment&nbsp;text.</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473498">//&nbsp;Compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix&nbsp;of&nbsp;all&nbsp;but&nbsp;the&nbsp;first,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473560">//&nbsp;last,&nbsp;and&nbsp;blank&nbsp;lines,&nbsp;and&nbsp;replace&nbsp;blank&nbsp;lines&nbsp;with&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473622">//&nbsp;lines&nbsp;(the&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;/*&nbsp;and&nbsp;has&nbsp;no&nbsp;prefix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473683">//&nbsp;In&nbsp;case&nbsp;of&nbsp;two-line&nbsp;comments,&nbsp;consider&nbsp;the&nbsp;last&nbsp;line&nbsp;for</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473744">//&nbsp;the&nbsp;prefix&nbsp;computation&nbsp;since&nbsp;otherwise&nbsp;the&nbsp;prefix&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473804">//&nbsp;be&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473818">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473822">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;line&nbsp;are&nbsp;never&nbsp;empty&nbsp;(they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473882">//&nbsp;contain&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;respectively)&nbsp;and</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473942">//&nbsp;thus&nbsp;they&nbsp;can&nbsp;be&nbsp;ignored&nbsp;by&nbsp;the&nbsp;blank&nbsp;line&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473996">var</span>&nbsp;<span class="ident" id="4474000">prefix</span>&nbsp;<span class="builtintype" id="4474007">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474015">if</span>&nbsp;<span class="builtinfunc" id="4474018">len</span><span class="op" id="4474021">(</span><span class="ident" id="4474022">lines</span><span class="op" id="4474027">)</span>&nbsp;<span class="op" id="4474029">&gt;</span>&nbsp;<span class="num" id="4474031">2</span>&nbsp;<span class="op" id="4474033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4474037">first</span>&nbsp;<span class="op" id="4474043">:=</span>&nbsp;<span class="builtintype" id="4474046">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474053">for</span>&nbsp;<span class="ident" id="4474057">i</span><span class="op" id="4474058">,</span>&nbsp;<span class="ident" id="4474060">line</span>&nbsp;<span class="op" id="4474065">:=</span>&nbsp;<span class="keyword" id="4474068">range</span>&nbsp;<span class="ident" id="4474074">lines</span><span class="op" id="4474079">[</span><span class="num" id="4474080">1</span>&nbsp;<span class="op" id="4474082">:</span>&nbsp;<span class="builtinfunc" id="4474084">len</span><span class="op" id="4474087">(</span><span class="ident" id="4474088">lines</span><span class="op" id="4474093">)</span><span class="op" id="4474094">-</span><span class="num" id="4474095">1</span><span class="op" id="4474096">]</span>&nbsp;<span class="op" id="4474098">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474103">switch</span>&nbsp;<span class="op" id="4474110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474115">case</span>&nbsp;<span class="ident" id="4474120">isBlank</span><span class="op" id="4474127">(</span><span class="ident" id="4474128">line</span><span class="op" id="4474132">)</span><span class="op" id="4474133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4474139">lines</span><span class="op" id="4474144">[</span><span class="num" id="4474145">1</span><span class="op" id="4474146">+</span><span class="ident" id="4474147">i</span><span class="op" id="4474148">]</span>&nbsp;<span class="op" id="4474150">=</span>&nbsp;<span class="string" id="4474152">&#34;&#34;</span>&nbsp;<span class="comment" id="4474155">//&nbsp;range&nbsp;starts&nbsp;with&nbsp;lines[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474188">case</span>&nbsp;<span class="ident" id="4474193">first</span><span class="op" id="4474198">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4474204">prefix</span>&nbsp;<span class="op" id="4474211">=</span>&nbsp;<span class="ident" id="4474213">commonPrefix</span><span class="op" id="4474225">(</span><span class="ident" id="4474226">line</span><span class="op" id="4474230">,</span>&nbsp;<span class="ident" id="4474232">line</span><span class="op" id="4474236">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4474242">first</span>&nbsp;<span class="op" id="4474248">=</span>&nbsp;<span class="builtintype" id="4474250">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474259">default</span><span class="op" id="4474266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4474272">prefix</span>&nbsp;<span class="op" id="4474279">=</span>&nbsp;<span class="ident" id="4474281">commonPrefix</span><span class="op" id="4474293">(</span><span class="ident" id="4474294">prefix</span><span class="op" id="4474300">,</span>&nbsp;<span class="ident" id="4474302">line</span><span class="op" id="4474306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4474311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4474315">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4474318">}</span>&nbsp;<span class="keyword" id="4474320">else</span>&nbsp;<span class="op" id="4474325">{</span>&nbsp;<span class="comment" id="4474327">//&nbsp;len(lines)&nbsp;==&nbsp;2,&nbsp;lines&nbsp;cannot&nbsp;be&nbsp;blank&nbsp;(contain&nbsp;/*&nbsp;and&nbsp;*/)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4474391">line</span>&nbsp;<span class="op" id="4474396">:=</span>&nbsp;<span class="ident" id="4474399">lines</span><span class="op" id="4474404">[</span><span class="num" id="4474405">1</span><span class="op" id="4474406">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4474410">prefix</span>&nbsp;<span class="op" id="4474417">=</span>&nbsp;<span class="ident" id="4474419">commonPrefix</span><span class="op" id="4474431">(</span><span class="ident" id="4474432">line</span><span class="op" id="4474436">,</span>&nbsp;<span class="ident" id="4474438">line</span><span class="op" id="4474442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4474445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474449">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Check&nbsp;for&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;&nbsp;and&nbsp;correct&nbsp;prefix&nbsp;accordingly.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4474529">lineOfStars</span>&nbsp;<span class="op" id="4474541">:=</span>&nbsp;<span class="builtintype" id="4474544">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474551">if</span>&nbsp;<span class="ident" id="4474554">i</span>&nbsp;<span class="op" id="4474556">:=</span>&nbsp;<span class="ident" id="4474559">strings</span><span class="op" id="4474566">.</span><span class="ident" id="4474567">Index</span><span class="op" id="4474572">(</span><span class="ident" id="4474573">prefix</span><span class="op" id="4474579">,</span>&nbsp;<span class="string" id="4474581">&#34;*&#34;</span><span class="op" id="4474584">)</span><span class="op" id="4474585">;</span>&nbsp;<span class="ident" id="4474587">i</span>&nbsp;<span class="op" id="4474589">&gt;=</span>&nbsp;<span class="num" id="4474592">0</span>&nbsp;<span class="op" id="4474594">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474598">//&nbsp;Line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474626">if</span>&nbsp;<span class="ident" id="4474629">i</span>&nbsp;<span class="op" id="4474631">&gt;</span>&nbsp;<span class="num" id="4474633">0</span>&nbsp;<span class="op" id="4474635">&amp;&amp;</span>&nbsp;<span class="ident" id="4474638">prefix</span><span class="op" id="4474644">[</span><span class="ident" id="4474645">i</span><span class="op" id="4474646">-</span><span class="num" id="4474647">1</span><span class="op" id="4474648">]</span>&nbsp;<span class="op" id="4474650">==</span>&nbsp;<span class="string" id="4474653">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4474657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4474662">i</span><span class="op" id="4474663">--</span>&nbsp;<span class="comment" id="4474666">//&nbsp;remove&nbsp;trailing&nbsp;blank&nbsp;from&nbsp;prefix&nbsp;so&nbsp;stars&nbsp;remain&nbsp;aligned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4474729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4474733">prefix</span>&nbsp;<span class="op" id="4474740">=</span>&nbsp;<span class="ident" id="4474742">prefix</span><span class="op" id="4474748">[</span><span class="num" id="4474749">0</span><span class="op" id="4474750">:</span><span class="ident" id="4474751">i</span><span class="op" id="4474752">]</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4474756">lineOfStars</span>&nbsp;<span class="op" id="4474768">=</span>&nbsp;<span class="builtintype" id="4474770">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4474776">}</span>&nbsp;<span class="keyword" id="4474778">else</span>&nbsp;<span class="op" id="4474783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474787">//&nbsp;No&nbsp;line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474818">//&nbsp;Determine&nbsp;the&nbsp;white&nbsp;space&nbsp;on&nbsp;the&nbsp;first&nbsp;line&nbsp;after&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474880">//&nbsp;and&nbsp;before&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;comment&nbsp;text,&nbsp;assume&nbsp;two</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4474942">//&nbsp;blanks&nbsp;instead&nbsp;of&nbsp;the&nbsp;/*&nbsp;unless&nbsp;the&nbsp;first&nbsp;character&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475005">//&nbsp;the&nbsp;/*&nbsp;is&nbsp;a&nbsp;tab.&nbsp;If&nbsp;the&nbsp;first&nbsp;comment&nbsp;line&nbsp;is&nbsp;empty&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475066">//&nbsp;for&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;assume&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab.&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475128">//&nbsp;whitespace&nbsp;may&nbsp;be&nbsp;found&nbsp;as&nbsp;suffix&nbsp;in&nbsp;the&nbsp;common&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475189">first</span>&nbsp;<span class="op" id="4475195">:=</span>&nbsp;<span class="ident" id="4475198">lines</span><span class="op" id="4475203">[</span><span class="num" id="4475204">0</span><span class="op" id="4475205">]</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4475209">if</span>&nbsp;<span class="ident" id="4475212">isBlank</span><span class="op" id="4475219">(</span><span class="ident" id="4475220">first</span><span class="op" id="4475225">[</span><span class="num" id="4475226">2</span><span class="op" id="4475227">:</span><span class="op" id="4475228">]</span><span class="op" id="4475229">)</span>&nbsp;<span class="op" id="4475231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475236">//&nbsp;no&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475277">//&nbsp;reduce&nbsp;prefix&nbsp;by&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475324">//&nbsp;if&nbsp;present&nbsp;-&nbsp;this&nbsp;keeps&nbsp;comment&nbsp;text&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475376">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;/*&nbsp;and&nbsp;*/&#39;s&nbsp;if&nbsp;it&nbsp;was&nbsp;indented</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475429">//&nbsp;in&nbsp;the&nbsp;first&nbsp;place</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475454">i</span>&nbsp;<span class="op" id="4475456">:=</span>&nbsp;<span class="builtinfunc" id="4475459">len</span><span class="op" id="4475462">(</span><span class="ident" id="4475463">prefix</span><span class="op" id="4475469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4475474">for</span>&nbsp;<span class="ident" id="4475478">n</span>&nbsp;<span class="op" id="4475480">:=</span>&nbsp;<span class="num" id="4475483">0</span><span class="op" id="4475484">;</span>&nbsp;<span class="ident" id="4475486">n</span>&nbsp;<span class="op" id="4475488">&lt;</span>&nbsp;<span class="num" id="4475490">3</span>&nbsp;<span class="op" id="4475492">&amp;&amp;</span>&nbsp;<span class="ident" id="4475495">i</span>&nbsp;<span class="op" id="4475497">&gt;</span>&nbsp;<span class="num" id="4475499">0</span>&nbsp;<span class="op" id="4475501">&amp;&amp;</span>&nbsp;<span class="ident" id="4475504">prefix</span><span class="op" id="4475510">[</span><span class="ident" id="4475511">i</span><span class="op" id="4475512">-</span><span class="num" id="4475513">1</span><span class="op" id="4475514">]</span>&nbsp;<span class="op" id="4475516">==</span>&nbsp;<span class="string" id="4475519">&#39;&nbsp;&#39;</span><span class="op" id="4475522">;</span>&nbsp;<span class="ident" id="4475524">n</span><span class="op" id="4475525">++</span>&nbsp;<span class="op" id="4475528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475534">i</span><span class="op" id="4475535">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4475541">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4475546">if</span>&nbsp;<span class="ident" id="4475549">i</span>&nbsp;<span class="op" id="4475551">==</span>&nbsp;<span class="builtinfunc" id="4475554">len</span><span class="op" id="4475557">(</span><span class="ident" id="4475558">prefix</span><span class="op" id="4475564">)</span>&nbsp;<span class="op" id="4475566">&amp;&amp;</span>&nbsp;<span class="ident" id="4475569">i</span>&nbsp;<span class="op" id="4475571">&gt;</span>&nbsp;<span class="num" id="4475573">0</span>&nbsp;<span class="op" id="4475575">&amp;&amp;</span>&nbsp;<span class="ident" id="4475578">prefix</span><span class="op" id="4475584">[</span><span class="ident" id="4475585">i</span><span class="op" id="4475586">-</span><span class="num" id="4475587">1</span><span class="op" id="4475588">]</span>&nbsp;<span class="op" id="4475590">==</span>&nbsp;<span class="string" id="4475593">&#39;\t&#39;</span>&nbsp;<span class="op" id="4475598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475604">i</span><span class="op" id="4475605">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4475611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475616">prefix</span>&nbsp;<span class="op" id="4475623">=</span>&nbsp;<span class="ident" id="4475625">prefix</span><span class="op" id="4475631">[</span><span class="num" id="4475632">0</span><span class="op" id="4475633">:</span><span class="ident" id="4475634">i</span><span class="op" id="4475635">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4475639">}</span>&nbsp;<span class="keyword" id="4475641">else</span>&nbsp;<span class="op" id="4475646">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475651">//&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475688">suffix</span>&nbsp;<span class="op" id="4475695">:=</span>&nbsp;<span class="builtinfunc" id="4475698">make</span><span class="op" id="4475702">(</span><span class="op" id="4475703">[</span><span class="op" id="4475704">]</span><span class="builtintype" id="4475705">byte</span><span class="op" id="4475709">,</span>&nbsp;<span class="builtinfunc" id="4475711">len</span><span class="op" id="4475714">(</span><span class="ident" id="4475715">first</span><span class="op" id="4475720">)</span><span class="op" id="4475721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475726">n</span>&nbsp;<span class="op" id="4475728">:=</span>&nbsp;<span class="num" id="4475731">2</span>&nbsp;<span class="comment" id="4475733">//&nbsp;start&nbsp;after&nbsp;opening&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4475762">for</span>&nbsp;<span class="ident" id="4475766">n</span>&nbsp;<span class="op" id="4475768">&lt;</span>&nbsp;<span class="builtinfunc" id="4475770">len</span><span class="op" id="4475773">(</span><span class="ident" id="4475774">first</span><span class="op" id="4475779">)</span>&nbsp;<span class="op" id="4475781">&amp;&amp;</span>&nbsp;<span class="ident" id="4475784">first</span><span class="op" id="4475789">[</span><span class="ident" id="4475790">n</span><span class="op" id="4475791">]</span>&nbsp;<span class="op" id="4475793">&lt;=</span>&nbsp;<span class="string" id="4475796">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4475800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475806">suffix</span><span class="op" id="4475812">[</span><span class="ident" id="4475813">n</span><span class="op" id="4475814">]</span>&nbsp;<span class="op" id="4475816">=</span>&nbsp;<span class="ident" id="4475818">first</span><span class="op" id="4475823">[</span><span class="ident" id="4475824">n</span><span class="op" id="4475825">]</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475831">n</span><span class="op" id="4475832">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4475838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4475843">if</span>&nbsp;<span class="ident" id="4475846">n</span>&nbsp;<span class="op" id="4475848">&gt;</span>&nbsp;<span class="num" id="4475850">2</span>&nbsp;<span class="op" id="4475852">&amp;&amp;</span>&nbsp;<span class="ident" id="4475855">suffix</span><span class="op" id="4475861">[</span><span class="num" id="4475862">2</span><span class="op" id="4475863">]</span>&nbsp;<span class="op" id="4475865">==</span>&nbsp;<span class="string" id="4475868">&#39;\t&#39;</span>&nbsp;<span class="op" id="4475873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475879">//&nbsp;assume&nbsp;the&nbsp;&#39;\t&#39;&nbsp;compensates&nbsp;for&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475925">suffix</span>&nbsp;<span class="op" id="4475932">=</span>&nbsp;<span class="ident" id="4475934">suffix</span><span class="op" id="4475940">[</span><span class="num" id="4475941">2</span><span class="op" id="4475942">:</span><span class="ident" id="4475943">n</span><span class="op" id="4475944">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4475949">}</span>&nbsp;<span class="keyword" id="4475951">else</span>&nbsp;<span class="op" id="4475956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475962">//&nbsp;otherwise&nbsp;assume&nbsp;two&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475997">suffix</span><span class="op" id="4476003">[</span><span class="num" id="4476004">0</span><span class="op" id="4476005">]</span><span class="op" id="4476006">,</span>&nbsp;<span class="ident" id="4476008">suffix</span><span class="op" id="4476014">[</span><span class="num" id="4476015">1</span><span class="op" id="4476016">]</span>&nbsp;<span class="op" id="4476018">=</span>&nbsp;<span class="string" id="4476020">&#39;&nbsp;&#39;</span><span class="op" id="4476023">,</span>&nbsp;<span class="string" id="4476025">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476033">suffix</span>&nbsp;<span class="op" id="4476040">=</span>&nbsp;<span class="ident" id="4476042">suffix</span><span class="op" id="4476048">[</span><span class="num" id="4476049">0</span><span class="op" id="4476050">:</span><span class="ident" id="4476051">n</span><span class="op" id="4476052">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4476057">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4476062">//&nbsp;Shorten&nbsp;the&nbsp;computed&nbsp;common&nbsp;prefix&nbsp;by&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4476120">//&nbsp;suffix,&nbsp;if&nbsp;it&nbsp;is&nbsp;found&nbsp;as&nbsp;suffix&nbsp;of&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476174">prefix</span>&nbsp;<span class="op" id="4476181">=</span>&nbsp;<span class="ident" id="4476183">strings</span><span class="op" id="4476190">.</span><span class="ident" id="4476191">TrimSuffix</span><span class="op" id="4476201">(</span><span class="ident" id="4476202">prefix</span><span class="op" id="4476208">,</span>&nbsp;<span class="builtintype" id="4476210">string</span><span class="op" id="4476216">(</span><span class="ident" id="4476217">suffix</span><span class="op" id="4476223">)</span><span class="op" id="4476224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4476228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4476231">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4476235">//&nbsp;Handle&nbsp;last&nbsp;line:&nbsp;If&nbsp;it&nbsp;only&nbsp;contains&nbsp;a&nbsp;closing&nbsp;*/,&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4476300">//&nbsp;with&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;otherwise&nbsp;align&nbsp;the&nbsp;text&nbsp;with&nbsp;the&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4476365">//&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476376">last</span>&nbsp;<span class="op" id="4476381">:=</span>&nbsp;<span class="ident" id="4476384">lines</span><span class="op" id="4476389">[</span><span class="builtinfunc" id="4476390">len</span><span class="op" id="4476393">(</span><span class="ident" id="4476394">lines</span><span class="op" id="4476399">)</span><span class="op" id="4476400">-</span><span class="num" id="4476401">1</span><span class="op" id="4476402">]</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476405">closing</span>&nbsp;<span class="op" id="4476413">:=</span>&nbsp;<span class="string" id="4476416">&#34;*/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476422">i</span>&nbsp;<span class="op" id="4476424">:=</span>&nbsp;<span class="ident" id="4476427">strings</span><span class="op" id="4476434">.</span><span class="ident" id="4476435">Index</span><span class="op" id="4476440">(</span><span class="ident" id="4476441">last</span><span class="op" id="4476445">,</span>&nbsp;<span class="ident" id="4476447">closing</span><span class="op" id="4476454">)</span>&nbsp;<span class="comment" id="4476456">//&nbsp;i&nbsp;&gt;=&nbsp;0&nbsp;(closing&nbsp;is&nbsp;always&nbsp;present)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476495">if</span>&nbsp;<span class="ident" id="4476498">isBlank</span><span class="op" id="4476505">(</span><span class="ident" id="4476506">last</span><span class="op" id="4476510">[</span><span class="num" id="4476511">0</span><span class="op" id="4476512">:</span><span class="ident" id="4476513">i</span><span class="op" id="4476514">]</span><span class="op" id="4476515">)</span>&nbsp;<span class="op" id="4476517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4476521">//&nbsp;last&nbsp;line&nbsp;only&nbsp;contains&nbsp;closing&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476561">if</span>&nbsp;<span class="ident" id="4476564">lineOfStars</span>&nbsp;<span class="op" id="4476576">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476581">closing</span>&nbsp;<span class="op" id="4476589">=</span>&nbsp;<span class="string" id="4476591">&#34;&nbsp;*/&#34;</span>&nbsp;<span class="comment" id="4476597">//&nbsp;add&nbsp;blank&nbsp;to&nbsp;align&nbsp;final&nbsp;star</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4476632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476636">lines</span><span class="op" id="4476641">[</span><span class="builtinfunc" id="4476642">len</span><span class="op" id="4476645">(</span><span class="ident" id="4476646">lines</span><span class="op" id="4476651">)</span><span class="op" id="4476652">-</span><span class="num" id="4476653">1</span><span class="op" id="4476654">]</span>&nbsp;<span class="op" id="4476656">=</span>&nbsp;<span class="ident" id="4476658">prefix</span>&nbsp;<span class="op" id="4476665">+</span>&nbsp;<span class="ident" id="4476667">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4476676">}</span>&nbsp;<span class="keyword" id="4476678">else</span>&nbsp;<span class="op" id="4476683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4476687">//&nbsp;last&nbsp;line&nbsp;contains&nbsp;more&nbsp;comment&nbsp;text&nbsp;-&nbsp;assume</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4476738">//&nbsp;it&nbsp;is&nbsp;aligned&nbsp;like&nbsp;the&nbsp;other&nbsp;lines&nbsp;and&nbsp;include</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4476790">//&nbsp;in&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476817">prefix</span>&nbsp;<span class="op" id="4476824">=</span>&nbsp;<span class="ident" id="4476826">commonPrefix</span><span class="op" id="4476838">(</span><span class="ident" id="4476839">prefix</span><span class="op" id="4476845">,</span>&nbsp;<span class="ident" id="4476847">last</span><span class="op" id="4476851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4476854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4476858">//&nbsp;Remove&nbsp;the&nbsp;common&nbsp;prefix&nbsp;from&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;empty&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476927">for</span>&nbsp;<span class="ident" id="4476931">i</span><span class="op" id="4476932">,</span>&nbsp;<span class="ident" id="4476934">line</span>&nbsp;<span class="op" id="4476939">:=</span>&nbsp;<span class="keyword" id="4476942">range</span>&nbsp;<span class="ident" id="4476948">lines</span>&nbsp;<span class="op" id="4476954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476958">if</span>&nbsp;<span class="ident" id="4476961">i</span>&nbsp;<span class="op" id="4476963">&gt;</span>&nbsp;<span class="num" id="4476965">0</span>&nbsp;<span class="op" id="4476967">&amp;&amp;</span>&nbsp;<span class="ident" id="4476970">line</span>&nbsp;<span class="op" id="4476975">!=</span>&nbsp;<span class="string" id="4476978">&#34;&#34;</span>&nbsp;<span class="op" id="4476981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476986">lines</span><span class="op" id="4476991">[</span><span class="ident" id="4476992">i</span><span class="op" id="4476993">]</span>&nbsp;<span class="op" id="4476995">=</span>&nbsp;<span class="ident" id="4476997">line</span><span class="op" id="4477001">[</span><span class="builtinfunc" id="4477002">len</span><span class="op" id="4477005">(</span><span class="ident" id="4477006">prefix</span><span class="op" id="4477012">)</span><span class="op" id="4477013">:</span><span class="op" id="4477014">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477018">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477021">}</span><br>
<span class="lineno"></span><span class="op" id="4477023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4477026">func</span>&nbsp;<span class="op" id="4477031">(</span><span class="ident" id="4477032">p</span>&nbsp;<span class="op" id="4477034">*</span><span class="ident" id="4477035">printer</span><span class="op" id="4477042">)</span>&nbsp;<span class="ident" id="4477044">writeComment</span><span class="op" id="4477056">(</span><span class="ident" id="4477057">comment</span>&nbsp;<span class="op" id="4477065">*</span><span class="ident" id="4477066">ast</span><span class="op" id="4477069">.</span><span class="ident" id="4477070">Comment</span><span class="op" id="4477077">)</span>&nbsp;<span class="op" id="4477079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477082">text</span>&nbsp;<span class="op" id="4477087">:=</span>&nbsp;<span class="ident" id="4477090">comment</span><span class="op" id="4477097">.</span><span class="ident" id="4477098">Text</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477104">pos</span>&nbsp;<span class="op" id="4477108">:=</span>&nbsp;<span class="ident" id="4477111">p</span><span class="op" id="4477112">.</span><span class="ident" id="4477113">posFor</span><span class="op" id="4477119">(</span><span class="ident" id="4477120">comment</span><span class="op" id="4477127">.</span><span class="ident" id="4477128">Pos</span><span class="op" id="4477131">(</span><span class="op" id="4477132">)</span><span class="op" id="4477133">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477137">const</span>&nbsp;<span class="ident" id="4477143">linePrefix</span>&nbsp;<span class="op" id="4477154">=</span>&nbsp;<span class="string" id="4477156">&#34;//line&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477167">if</span>&nbsp;<span class="ident" id="4477170">strings</span><span class="op" id="4477177">.</span><span class="ident" id="4477178">HasPrefix</span><span class="op" id="4477187">(</span><span class="ident" id="4477188">text</span><span class="op" id="4477192">,</span>&nbsp;<span class="ident" id="4477194">linePrefix</span><span class="op" id="4477204">)</span>&nbsp;<span class="op" id="4477206">&amp;&amp;</span>&nbsp;<span class="op" id="4477209">(</span><span class="op" id="4477210">!</span><span class="ident" id="4477211">pos</span><span class="op" id="4477214">.</span><span class="ident" id="4477215">IsValid</span><span class="op" id="4477222">(</span><span class="op" id="4477223">)</span>&nbsp;<span class="op" id="4477225">||</span>&nbsp;<span class="ident" id="4477228">pos</span><span class="op" id="4477231">.</span><span class="ident" id="4477232">Column</span>&nbsp;<span class="op" id="4477239">==</span>&nbsp;<span class="num" id="4477242">1</span><span class="op" id="4477243">)</span>&nbsp;<span class="op" id="4477245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4477249">//&nbsp;possibly&nbsp;a&nbsp;line&nbsp;directive</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477280">ldir</span>&nbsp;<span class="op" id="4477285">:=</span>&nbsp;<span class="ident" id="4477288">strings</span><span class="op" id="4477295">.</span><span class="ident" id="4477296">TrimSpace</span><span class="op" id="4477305">(</span><span class="ident" id="4477306">text</span><span class="op" id="4477310">[</span><span class="builtinfunc" id="4477311">len</span><span class="op" id="4477314">(</span><span class="ident" id="4477315">linePrefix</span><span class="op" id="4477325">)</span><span class="op" id="4477326">:</span><span class="op" id="4477327">]</span><span class="op" id="4477328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477332">if</span>&nbsp;<span class="ident" id="4477335">i</span>&nbsp;<span class="op" id="4477337">:=</span>&nbsp;<span class="ident" id="4477340">strings</span><span class="op" id="4477347">.</span><span class="ident" id="4477348">LastIndex</span><span class="op" id="4477357">(</span><span class="ident" id="4477358">ldir</span><span class="op" id="4477362">,</span>&nbsp;<span class="string" id="4477364">&#34;:&#34;</span><span class="op" id="4477367">)</span><span class="op" id="4477368">;</span>&nbsp;<span class="ident" id="4477370">i</span>&nbsp;<span class="op" id="4477372">&gt;=</span>&nbsp;<span class="num" id="4477375">0</span>&nbsp;<span class="op" id="4477377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477382">if</span>&nbsp;<span class="ident" id="4477385">line</span><span class="op" id="4477389">,</span>&nbsp;<span class="ident" id="4477391">err</span>&nbsp;<span class="op" id="4477395">:=</span>&nbsp;<span class="ident" id="4477398">strconv</span><span class="op" id="4477405">.</span><span class="ident" id="4477406">Atoi</span><span class="op" id="4477410">(</span><span class="ident" id="4477411">ldir</span><span class="op" id="4477415">[</span><span class="ident" id="4477416">i</span><span class="op" id="4477417">+</span><span class="num" id="4477418">1</span><span class="op" id="4477419">:</span><span class="op" id="4477420">]</span><span class="op" id="4477421">)</span><span class="op" id="4477422">;</span>&nbsp;<span class="ident" id="4477424">err</span>&nbsp;<span class="op" id="4477428">==</span>&nbsp;<span class="ident" id="4477431">nil</span>&nbsp;<span class="op" id="4477435">&amp;&amp;</span>&nbsp;<span class="ident" id="4477438">line</span>&nbsp;<span class="op" id="4477443">&gt;</span>&nbsp;<span class="num" id="4477445">0</span>&nbsp;<span class="op" id="4477447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4477453">//&nbsp;The&nbsp;line&nbsp;directive&nbsp;we&nbsp;are&nbsp;about&nbsp;to&nbsp;print&nbsp;changed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4477509">//&nbsp;the&nbsp;Filename&nbsp;and&nbsp;Line&nbsp;number&nbsp;used&nbsp;for&nbsp;subsequent</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4477565">//&nbsp;tokens.&nbsp;We&nbsp;have&nbsp;to&nbsp;update&nbsp;our&nbsp;AST-space&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4477621">//&nbsp;accordingly&nbsp;and&nbsp;suspend&nbsp;indentation&nbsp;temporarily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477677">indent</span>&nbsp;<span class="op" id="4477684">:=</span>&nbsp;<span class="ident" id="4477687">p</span><span class="op" id="4477688">.</span><span class="ident" id="4477689">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477700">p</span><span class="op" id="4477701">.</span><span class="ident" id="4477702">indent</span>&nbsp;<span class="op" id="4477709">=</span>&nbsp;<span class="num" id="4477711">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477717">defer</span>&nbsp;<span class="keyword" id="4477723">func</span><span class="op" id="4477727">(</span><span class="op" id="4477728">)</span>&nbsp;<span class="op" id="4477730">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477737">p</span><span class="op" id="4477738">.</span><span class="ident" id="4477739">pos</span><span class="op" id="4477742">.</span><span class="ident" id="4477743">Filename</span>&nbsp;<span class="op" id="4477752">=</span>&nbsp;<span class="ident" id="4477754">ldir</span><span class="op" id="4477758">[</span><span class="op" id="4477759">:</span><span class="ident" id="4477760">i</span><span class="op" id="4477761">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477768">p</span><span class="op" id="4477769">.</span><span class="ident" id="4477770">pos</span><span class="op" id="4477773">.</span><span class="ident" id="4477774">Line</span>&nbsp;<span class="op" id="4477779">=</span>&nbsp;<span class="ident" id="4477781">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477791">p</span><span class="op" id="4477792">.</span><span class="ident" id="4477793">pos</span><span class="op" id="4477796">.</span><span class="ident" id="4477797">Column</span>&nbsp;<span class="op" id="4477804">=</span>&nbsp;<span class="num" id="4477806">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477813">p</span><span class="op" id="4477814">.</span><span class="ident" id="4477815">indent</span>&nbsp;<span class="op" id="4477822">=</span>&nbsp;<span class="ident" id="4477824">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477835">}</span><span class="op" id="4477836">(</span><span class="op" id="4477837">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4477853">//&nbsp;shortcut&nbsp;common&nbsp;case&nbsp;of&nbsp;//-style&nbsp;comments</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477899">if</span>&nbsp;<span class="ident" id="4477902">text</span><span class="op" id="4477906">[</span><span class="num" id="4477907">1</span><span class="op" id="4477908">]</span>&nbsp;<span class="op" id="4477910">==</span>&nbsp;<span class="string" id="4477913">&#39;/&#39;</span>&nbsp;<span class="op" id="4477917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477921">p</span><span class="op" id="4477922">.</span><span class="ident" id="4477923">writeString</span><span class="op" id="4477934">(</span><span class="ident" id="4477935">pos</span><span class="op" id="4477938">,</span>&nbsp;<span class="ident" id="4477940">trimRight</span><span class="op" id="4477949">(</span><span class="ident" id="4477950">text</span><span class="op" id="4477954">)</span><span class="op" id="4477955">,</span>&nbsp;<span class="builtintype" id="4477957">true</span><span class="op" id="4477961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477965">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4477977">//&nbsp;for&nbsp;/*-style&nbsp;comments,&nbsp;print&nbsp;line&nbsp;by&nbsp;line&nbsp;and&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478035">//&nbsp;write&nbsp;function&nbsp;take&nbsp;care&nbsp;of&nbsp;the&nbsp;proper&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4478090">lines</span>&nbsp;<span class="op" id="4478096">:=</span>&nbsp;<span class="ident" id="4478099">strings</span><span class="op" id="4478106">.</span><span class="ident" id="4478107">Split</span><span class="op" id="4478112">(</span><span class="ident" id="4478113">text</span><span class="op" id="4478117">,</span>&nbsp;<span class="string" id="4478119">&#34;\n&#34;</span><span class="op" id="4478123">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478127">//&nbsp;The&nbsp;comment&nbsp;started&nbsp;in&nbsp;the&nbsp;first&nbsp;column&nbsp;but&nbsp;is&nbsp;going</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478184">//&nbsp;to&nbsp;be&nbsp;indented.&nbsp;For&nbsp;an&nbsp;idempotent&nbsp;result,&nbsp;add&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478246">//&nbsp;to&nbsp;all&nbsp;lines&nbsp;such&nbsp;that&nbsp;they&nbsp;look&nbsp;like&nbsp;they&nbsp;were&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478307">//&nbsp;before&nbsp;-&nbsp;this&nbsp;will&nbsp;make&nbsp;sure&nbsp;the&nbsp;common&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478370">//&nbsp;is&nbsp;the&nbsp;same&nbsp;independent&nbsp;of&nbsp;how&nbsp;many&nbsp;times&nbsp;formatting&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478430">//&nbsp;applied&nbsp;(was&nbsp;issue&nbsp;1835).</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478460">if</span>&nbsp;<span class="ident" id="4478463">pos</span><span class="op" id="4478466">.</span><span class="ident" id="4478467">IsValid</span><span class="op" id="4478474">(</span><span class="op" id="4478475">)</span>&nbsp;<span class="op" id="4478477">&amp;&amp;</span>&nbsp;<span class="ident" id="4478480">pos</span><span class="op" id="4478483">.</span><span class="ident" id="4478484">Column</span>&nbsp;<span class="op" id="4478491">==</span>&nbsp;<span class="num" id="4478494">1</span>&nbsp;<span class="op" id="4478496">&amp;&amp;</span>&nbsp;<span class="ident" id="4478499">p</span><span class="op" id="4478500">.</span><span class="ident" id="4478501">indent</span>&nbsp;<span class="op" id="4478508">&gt;</span>&nbsp;<span class="num" id="4478510">0</span>&nbsp;<span class="op" id="4478512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478516">for</span>&nbsp;<span class="ident" id="4478520">i</span><span class="op" id="4478521">,</span>&nbsp;<span class="ident" id="4478523">line</span>&nbsp;<span class="op" id="4478528">:=</span>&nbsp;<span class="keyword" id="4478531">range</span>&nbsp;<span class="ident" id="4478537">lines</span><span class="op" id="4478542">[</span><span class="num" id="4478543">1</span><span class="op" id="4478544">:</span><span class="op" id="4478545">]</span>&nbsp;<span class="op" id="4478547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4478552">lines</span><span class="op" id="4478557">[</span><span class="num" id="4478558">1</span><span class="op" id="4478559">+</span><span class="ident" id="4478560">i</span><span class="op" id="4478561">]</span>&nbsp;<span class="op" id="4478563">=</span>&nbsp;<span class="string" id="4478565">&#34;&nbsp;&nbsp;&nbsp;&#34;</span>&nbsp;<span class="op" id="4478571">+</span>&nbsp;<span class="ident" id="4478573">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4478580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4478583">}</span><br>
<span class="lineno">655</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4478587">stripCommonPrefix</span><span class="op" id="4478604">(</span><span class="ident" id="4478605">lines</span><span class="op" id="4478610">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478614">//&nbsp;write&nbsp;comment&nbsp;lines,&nbsp;separated&nbsp;by&nbsp;formfeed,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478662">//&nbsp;without&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;the&nbsp;last&nbsp;line</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478707">for</span>&nbsp;<span class="ident" id="4478711">i</span><span class="op" id="4478712">,</span>&nbsp;<span class="ident" id="4478714">line</span>&nbsp;<span class="op" id="4478719">:=</span>&nbsp;<span class="keyword" id="4478722">range</span>&nbsp;<span class="ident" id="4478728">lines</span>&nbsp;<span class="op" id="4478734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478738">if</span>&nbsp;<span class="ident" id="4478741">i</span>&nbsp;<span class="op" id="4478743">&gt;</span>&nbsp;<span class="num" id="4478745">0</span>&nbsp;<span class="op" id="4478747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4478752">p</span><span class="op" id="4478753">.</span><span class="ident" id="4478754">writeByte</span><span class="op" id="4478763">(</span><span class="string" id="4478764">&#39;\f&#39;</span><span class="op" id="4478768">,</span>&nbsp;<span class="num" id="4478770">1</span><span class="op" id="4478771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4478776">pos</span>&nbsp;<span class="op" id="4478780">=</span>&nbsp;<span class="ident" id="4478782">p</span><span class="op" id="4478783">.</span><span class="ident" id="4478784">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4478790">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478794">if</span>&nbsp;<span class="builtinfunc" id="4478797">len</span><span class="op" id="4478800">(</span><span class="ident" id="4478801">line</span><span class="op" id="4478805">)</span>&nbsp;<span class="op" id="4478807">&gt;</span>&nbsp;<span class="num" id="4478809">0</span>&nbsp;<span class="op" id="4478811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4478816">p</span><span class="op" id="4478817">.</span><span class="ident" id="4478818">writeString</span><span class="op" id="4478829">(</span><span class="ident" id="4478830">pos</span><span class="op" id="4478833">,</span>&nbsp;<span class="ident" id="4478835">trimRight</span><span class="op" id="4478844">(</span><span class="ident" id="4478845">line</span><span class="op" id="4478849">)</span><span class="op" id="4478850">,</span>&nbsp;<span class="builtintype" id="4478852">true</span><span class="op" id="4478856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4478860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4478863">}</span><br>
<span class="lineno"></span><span class="op" id="4478865">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="4478868">//&nbsp;writeCommentSuffix&nbsp;writes&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;comment&nbsp;if&nbsp;indicated</span><br>
<span class="lineno"></span><span class="comment" id="4478939">//&nbsp;and&nbsp;processes&nbsp;any&nbsp;leftover&nbsp;indentation&nbsp;information.&nbsp;If&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span><span class="comment" id="4479010">//&nbsp;is&nbsp;needed,&nbsp;the&nbsp;kind&nbsp;of&nbsp;break&nbsp;(newline&nbsp;vs&nbsp;formfeed)&nbsp;depends&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4479079">//&nbsp;pending&nbsp;whitespace.&nbsp;The&nbsp;writeCommentSuffix&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="4479147">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="4479219">//&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="4479230">//</span><br>
<span class="lineno"></span><span class="keyword" id="4479233">func</span>&nbsp;<span class="op" id="4479238">(</span><span class="ident" id="4479239">p</span>&nbsp;<span class="op" id="4479241">*</span><span class="ident" id="4479242">printer</span><span class="op" id="4479249">)</span>&nbsp;<span class="ident" id="4479251">writeCommentSuffix</span><span class="op" id="4479269">(</span><span class="ident" id="4479270">needsLinebreak</span>&nbsp;<span class="builtintype" id="4479285">bool</span><span class="op" id="4479289">)</span>&nbsp;<span class="op" id="4479291">(</span><span class="ident" id="4479292">wroteNewline</span><span class="op" id="4479304">,</span>&nbsp;<span class="ident" id="4479306">droppedFF</span>&nbsp;<span class="builtintype" id="4479316">bool</span><span class="op" id="4479320">)</span>&nbsp;<span class="op" id="4479322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479325">for</span>&nbsp;<span class="ident" id="4479329">i</span><span class="op" id="4479330">,</span>&nbsp;<span class="ident" id="4479332">ch</span>&nbsp;<span class="op" id="4479335">:=</span>&nbsp;<span class="keyword" id="4479338">range</span>&nbsp;<span class="ident" id="4479344">p</span><span class="op" id="4479345">.</span><span class="ident" id="4479346">wsbuf</span>&nbsp;<span class="op" id="4479352">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479356">switch</span>&nbsp;<span class="ident" id="4479363">ch</span>&nbsp;<span class="op" id="4479366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479370">case</span>&nbsp;<span class="ident" id="4479375">blank</span><span class="op" id="4479380">,</span>&nbsp;<span class="ident" id="4479382">vtab</span><span class="op" id="4479386">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4479391">//&nbsp;ignore&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479424">p</span><span class="op" id="4479425">.</span><span class="ident" id="4479426">wsbuf</span><span class="op" id="4479431">[</span><span class="ident" id="4479432">i</span><span class="op" id="4479433">]</span>&nbsp;<span class="op" id="4479435">=</span>&nbsp;<span class="ident" id="4479437">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479446">case</span>&nbsp;<span class="ident" id="4479451">indent</span><span class="op" id="4479457">,</span>&nbsp;<span class="ident" id="4479459">unindent</span><span class="op" id="4479467">:</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4479472">//&nbsp;don&#39;t&nbsp;lose&nbsp;indentation&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479512">case</span>&nbsp;<span class="ident" id="4479517">newline</span><span class="op" id="4479524">,</span>&nbsp;<span class="ident" id="4479526">formfeed</span><span class="op" id="4479534">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4479539">//&nbsp;if&nbsp;we&nbsp;need&nbsp;a&nbsp;line&nbsp;break,&nbsp;keep&nbsp;exactly&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4479587">//&nbsp;but&nbsp;remember&nbsp;if&nbsp;we&nbsp;dropped&nbsp;any&nbsp;formfeeds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479634">if</span>&nbsp;<span class="ident" id="4479637">needsLinebreak</span>&nbsp;<span class="op" id="4479652">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479658">needsLinebreak</span>&nbsp;<span class="op" id="4479673">=</span>&nbsp;<span class="builtintype" id="4479675">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479685">wroteNewline</span>&nbsp;<span class="op" id="4479698">=</span>&nbsp;<span class="builtintype" id="4479700">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4479708">}</span>&nbsp;<span class="keyword" id="4479710">else</span>&nbsp;<span class="op" id="4479715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479721">if</span>&nbsp;<span class="ident" id="4479724">ch</span>&nbsp;<span class="op" id="4479727">==</span>&nbsp;<span class="ident" id="4479730">formfeed</span>&nbsp;<span class="op" id="4479739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479746">droppedFF</span>&nbsp;<span class="op" id="4479756">=</span>&nbsp;<span class="builtintype" id="4479758">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4479767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479773">p</span><span class="op" id="4479774">.</span><span class="ident" id="4479775">wsbuf</span><span class="op" id="4479780">[</span><span class="ident" id="4479781">i</span><span class="op" id="4479782">]</span>&nbsp;<span class="op" id="4479784">=</span>&nbsp;<span class="ident" id="4479786">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4479796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4479800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4479803">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479806">p</span><span class="op" id="4479807">.</span><span class="ident" id="4479808">writeWhitespace</span><span class="op" id="4479823">(</span><span class="builtinfunc" id="4479824">len</span><span class="op" id="4479827">(</span><span class="ident" id="4479828">p</span><span class="op" id="4479829">.</span><span class="ident" id="4479830">wsbuf</span><span class="op" id="4479835">)</span><span class="op" id="4479836">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4479840">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;have&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479875">if</span>&nbsp;<span class="ident" id="4479878">needsLinebreak</span>&nbsp;<span class="op" id="4479893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479897">p</span><span class="op" id="4479898">.</span><span class="ident" id="4479899">writeByte</span><span class="op" id="4479908">(</span><span class="string" id="4479909">&#39;\n&#39;</span><span class="op" id="4479913">,</span>&nbsp;<span class="num" id="4479915">1</span><span class="op" id="4479916">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479920">wroteNewline</span>&nbsp;<span class="op" id="4479933">=</span>&nbsp;<span class="builtintype" id="4479935">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4479941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479945">return</span><br>
<span class="lineno"></span><span class="op" id="4479952">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span><span class="comment" id="4479955">//&nbsp;intersperseComments&nbsp;consumes&nbsp;all&nbsp;comments&nbsp;that&nbsp;appear&nbsp;before&nbsp;the&nbsp;next&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="4480034">//&nbsp;tok&nbsp;and&nbsp;prints&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;buffered&nbsp;whitespace&nbsp;(i.e.,&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="4480115">//&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;written&nbsp;before&nbsp;the&nbsp;next&nbsp;token).&nbsp;A&nbsp;heuristic&nbsp;is&nbsp;used&nbsp;to&nbsp;mix</span><br>
<span class="lineno"></span><span class="comment" id="4480194">//&nbsp;the&nbsp;comments&nbsp;and&nbsp;whitespace.&nbsp;The&nbsp;intersperseComments&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">715</span><span class="comment" id="4480272">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="4480352">//</span><br>
<span class="lineno"></span><span class="keyword" id="4480355">func</span>&nbsp;<span class="op" id="4480360">(</span><span class="ident" id="4480361">p</span>&nbsp;<span class="op" id="4480363">*</span><span class="ident" id="4480364">printer</span><span class="op" id="4480371">)</span>&nbsp;<span class="ident" id="4480373">intersperseComments</span><span class="op" id="4480392">(</span><span class="ident" id="4480393">next</span>&nbsp;<span class="ident" id="4480398">token</span><span class="op" id="4480403">.</span><span class="ident" id="4480404">Position</span><span class="op" id="4480412">,</span>&nbsp;<span class="ident" id="4480414">tok</span>&nbsp;<span class="ident" id="4480418">token</span><span class="op" id="4480423">.</span><span class="ident" id="4480424">Token</span><span class="op" id="4480429">)</span>&nbsp;<span class="op" id="4480431">(</span><span class="ident" id="4480432">wroteNewline</span><span class="op" id="4480444">,</span>&nbsp;<span class="ident" id="4480446">droppedFF</span>&nbsp;<span class="builtintype" id="4480456">bool</span><span class="op" id="4480460">)</span>&nbsp;<span class="op" id="4480462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480465">var</span>&nbsp;<span class="ident" id="4480469">last</span>&nbsp;<span class="op" id="4480474">*</span><span class="ident" id="4480475">ast</span><span class="op" id="4480478">.</span><span class="ident" id="4480479">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480488">for</span>&nbsp;<span class="ident" id="4480492">p</span><span class="op" id="4480493">.</span><span class="ident" id="4480494">commentBefore</span><span class="op" id="4480507">(</span><span class="ident" id="4480508">next</span><span class="op" id="4480512">)</span>&nbsp;<span class="op" id="4480514">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480518">for</span>&nbsp;<span class="ident" id="4480522">_</span><span class="op" id="4480523">,</span>&nbsp;<span class="ident" id="4480525">c</span>&nbsp;<span class="op" id="4480527">:=</span>&nbsp;<span class="keyword" id="4480530">range</span>&nbsp;<span class="ident" id="4480536">p</span><span class="op" id="4480537">.</span><span class="ident" id="4480538">comment</span><span class="op" id="4480545">.</span><span class="ident" id="4480546">List</span>&nbsp;<span class="op" id="4480551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4480556">p</span><span class="op" id="4480557">.</span><span class="ident" id="4480558">writeCommentPrefix</span><span class="op" id="4480576">(</span><span class="ident" id="4480577">p</span><span class="op" id="4480578">.</span><span class="ident" id="4480579">posFor</span><span class="op" id="4480585">(</span><span class="ident" id="4480586">c</span><span class="op" id="4480587">.</span><span class="ident" id="4480588">Pos</span><span class="op" id="4480591">(</span><span class="op" id="4480592">)</span><span class="op" id="4480593">)</span><span class="op" id="4480594">,</span>&nbsp;<span class="ident" id="4480596">next</span><span class="op" id="4480600">,</span>&nbsp;<span class="ident" id="4480602">last</span><span class="op" id="4480606">,</span>&nbsp;<span class="ident" id="4480608">c</span><span class="op" id="4480609">,</span>&nbsp;<span class="ident" id="4480611">tok</span><span class="op" id="4480614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4480619">p</span><span class="op" id="4480620">.</span><span class="ident" id="4480621">writeComment</span><span class="op" id="4480633">(</span><span class="ident" id="4480634">c</span><span class="op" id="4480635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4480640">last</span>&nbsp;<span class="op" id="4480645">=</span>&nbsp;<span class="ident" id="4480647">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4480651">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4480655">p</span><span class="op" id="4480656">.</span><span class="ident" id="4480657">nextComment</span><span class="op" id="4480668">(</span><span class="op" id="4480669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4480672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480676">if</span>&nbsp;<span class="ident" id="4480679">last</span>&nbsp;<span class="op" id="4480684">!=</span>&nbsp;<span class="ident" id="4480687">nil</span>&nbsp;<span class="op" id="4480691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4480695">//&nbsp;if&nbsp;the&nbsp;last&nbsp;comment&nbsp;is&nbsp;a&nbsp;/*-style&nbsp;comment&nbsp;and&nbsp;the&nbsp;next&nbsp;item</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4480760">//&nbsp;follows&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;but&nbsp;is&nbsp;not&nbsp;a&nbsp;comma,&nbsp;and&nbsp;not&nbsp;a&nbsp;&#34;closing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4480830">//&nbsp;token&nbsp;immediately&nbsp;following&nbsp;its&nbsp;corresponding&nbsp;&#34;opening&#34;&nbsp;token,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4480898">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;blank&nbsp;for&nbsp;separation&nbsp;unless&nbsp;explicitly&nbsp;disabled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480964">if</span>&nbsp;<span class="ident" id="4480967">p</span><span class="op" id="4480968">.</span><span class="ident" id="4480969">mode</span><span class="op" id="4480973">&amp;</span><span class="ident" id="4480974">noExtraBlank</span>&nbsp;<span class="op" id="4480987">==</span>&nbsp;<span class="num" id="4480990">0</span>&nbsp;<span class="op" id="4480992">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4480998">last</span><span class="op" id="4481002">.</span><span class="ident" id="4481003">Text</span><span class="op" id="4481007">[</span><span class="num" id="4481008">1</span><span class="op" id="4481009">]</span>&nbsp;<span class="op" id="4481011">==</span>&nbsp;<span class="string" id="4481014">&#39;*&#39;</span>&nbsp;<span class="op" id="4481018">&amp;&amp;</span>&nbsp;<span class="ident" id="4481021">p</span><span class="op" id="4481022">.</span><span class="ident" id="4481023">lineFor</span><span class="op" id="4481030">(</span><span class="ident" id="4481031">last</span><span class="op" id="4481035">.</span><span class="ident" id="4481036">Pos</span><span class="op" id="4481039">(</span><span class="op" id="4481040">)</span><span class="op" id="4481041">)</span>&nbsp;<span class="op" id="4481043">==</span>&nbsp;<span class="ident" id="4481046">next</span><span class="op" id="4481050">.</span><span class="ident" id="4481051">Line</span>&nbsp;<span class="op" id="4481056">&amp;&amp;</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481062">tok</span>&nbsp;<span class="op" id="4481066">!=</span>&nbsp;<span class="ident" id="4481069">token</span><span class="op" id="4481074">.</span><span class="ident" id="4481075">COMMA</span>&nbsp;<span class="op" id="4481081">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4481087">(</span><span class="ident" id="4481088">tok</span>&nbsp;<span class="op" id="4481092">!=</span>&nbsp;<span class="ident" id="4481095">token</span><span class="op" id="4481100">.</span><span class="ident" id="4481101">RPAREN</span>&nbsp;<span class="op" id="4481108">||</span>&nbsp;<span class="ident" id="4481111">p</span><span class="op" id="4481112">.</span><span class="ident" id="4481113">prevOpen</span>&nbsp;<span class="op" id="4481122">==</span>&nbsp;<span class="ident" id="4481125">token</span><span class="op" id="4481130">.</span><span class="ident" id="4481131">LPAREN</span><span class="op" id="4481137">)</span>&nbsp;<span class="op" id="4481139">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4481145">(</span><span class="ident" id="4481146">tok</span>&nbsp;<span class="op" id="4481150">!=</span>&nbsp;<span class="ident" id="4481153">token</span><span class="op" id="4481158">.</span><span class="ident" id="4481159">RBRACK</span>&nbsp;<span class="op" id="4481166">||</span>&nbsp;<span class="ident" id="4481169">p</span><span class="op" id="4481170">.</span><span class="ident" id="4481171">prevOpen</span>&nbsp;<span class="op" id="4481180">==</span>&nbsp;<span class="ident" id="4481183">token</span><span class="op" id="4481188">.</span><span class="ident" id="4481189">LBRACK</span><span class="op" id="4481195">)</span>&nbsp;<span class="op" id="4481197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481202">p</span><span class="op" id="4481203">.</span><span class="ident" id="4481204">writeByte</span><span class="op" id="4481213">(</span><span class="string" id="4481214">&#39;&nbsp;&#39;</span><span class="op" id="4481217">,</span>&nbsp;<span class="num" id="4481219">1</span><span class="op" id="4481220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4481224">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481228">//&nbsp;ensure&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;//-style&nbsp;comment,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481293">//&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;}&#39;&nbsp;unless&nbsp;explicitly&nbsp;disabled,&nbsp;or&nbsp;at&nbsp;eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481357">needsLinebreak</span>&nbsp;<span class="op" id="4481372">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481378">last</span><span class="op" id="4481382">.</span><span class="ident" id="4481383">Text</span><span class="op" id="4481387">[</span><span class="num" id="4481388">1</span><span class="op" id="4481389">]</span>&nbsp;<span class="op" id="4481391">==</span>&nbsp;<span class="string" id="4481394">&#39;/&#39;</span>&nbsp;<span class="op" id="4481398">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481405">tok</span>&nbsp;<span class="op" id="4481409">==</span>&nbsp;<span class="ident" id="4481412">token</span><span class="op" id="4481417">.</span><span class="ident" id="4481418">RBRACE</span>&nbsp;<span class="op" id="4481425">&amp;&amp;</span>&nbsp;<span class="ident" id="4481428">p</span><span class="op" id="4481429">.</span><span class="ident" id="4481430">mode</span><span class="op" id="4481434">&amp;</span><span class="ident" id="4481435">noExtraLinebreak</span>&nbsp;<span class="op" id="4481452">==</span>&nbsp;<span class="num" id="4481455">0</span>&nbsp;<span class="op" id="4481457">||</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481464">tok</span>&nbsp;<span class="op" id="4481468">==</span>&nbsp;<span class="ident" id="4481471">token</span><span class="op" id="4481476">.</span><span class="ident" id="4481477">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4481483">return</span>&nbsp;<span class="ident" id="4481490">p</span><span class="op" id="4481491">.</span><span class="ident" id="4481492">writeCommentSuffix</span><span class="op" id="4481510">(</span><span class="ident" id="4481511">needsLinebreak</span><span class="op" id="4481525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4481528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481532">//&nbsp;no&nbsp;comment&nbsp;was&nbsp;written&nbsp;-&nbsp;we&nbsp;should&nbsp;never&nbsp;reach&nbsp;here&nbsp;since</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481594">//&nbsp;intersperseComments&nbsp;should&nbsp;not&nbsp;be&nbsp;called&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481652">p</span><span class="op" id="4481653">.</span><span class="ident" id="4481654">internalError</span><span class="op" id="4481667">(</span><span class="string" id="4481668">&#34;intersperseComments&nbsp;called&nbsp;without&nbsp;pending&nbsp;comments&#34;</span><span class="op" id="4481721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4481724">return</span><br>
<span class="lineno"></span><span class="op" id="4481731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="4481734">//&nbsp;whiteWhitespace&nbsp;writes&nbsp;the&nbsp;first&nbsp;n&nbsp;whitespace&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="4481792">func</span>&nbsp;<span class="op" id="4481797">(</span><span class="ident" id="4481798">p</span>&nbsp;<span class="op" id="4481800">*</span><span class="ident" id="4481801">printer</span><span class="op" id="4481808">)</span>&nbsp;<span class="ident" id="4481810">writeWhitespace</span><span class="op" id="4481825">(</span><span class="ident" id="4481826">n</span>&nbsp;<span class="builtintype" id="4481828">int</span><span class="op" id="4481831">)</span>&nbsp;<span class="op" id="4481833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481836">//&nbsp;write&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4481854">for</span>&nbsp;<span class="ident" id="4481858">i</span>&nbsp;<span class="op" id="4481860">:=</span>&nbsp;<span class="num" id="4481863">0</span><span class="op" id="4481864">;</span>&nbsp;<span class="ident" id="4481866">i</span>&nbsp;<span class="op" id="4481868">&lt;</span>&nbsp;<span class="ident" id="4481870">n</span><span class="op" id="4481871">;</span>&nbsp;<span class="ident" id="4481873">i</span><span class="op" id="4481874">++</span>&nbsp;<span class="op" id="4481877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4481881">switch</span>&nbsp;<span class="ident" id="4481888">ch</span>&nbsp;<span class="op" id="4481891">:=</span>&nbsp;<span class="ident" id="4481894">p</span><span class="op" id="4481895">.</span><span class="ident" id="4481896">wsbuf</span><span class="op" id="4481901">[</span><span class="ident" id="4481902">i</span><span class="op" id="4481903">]</span><span class="op" id="4481904">;</span>&nbsp;<span class="ident" id="4481906">ch</span>&nbsp;<span class="op" id="4481909">{</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4481913">case</span>&nbsp;<span class="ident" id="4481918">ignore</span><span class="op" id="4481924">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481929">//&nbsp;ignore!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4481942">case</span>&nbsp;<span class="ident" id="4481947">indent</span><span class="op" id="4481953">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481958">p</span><span class="op" id="4481959">.</span><span class="ident" id="4481960">indent</span><span class="op" id="4481966">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4481971">case</span>&nbsp;<span class="ident" id="4481976">unindent</span><span class="op" id="4481984">:</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481989">p</span><span class="op" id="4481990">.</span><span class="ident" id="4481991">indent</span><span class="op" id="4481997">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482003">if</span>&nbsp;<span class="ident" id="4482006">p</span><span class="op" id="4482007">.</span><span class="ident" id="4482008">indent</span>&nbsp;<span class="op" id="4482015">&lt;</span>&nbsp;<span class="num" id="4482017">0</span>&nbsp;<span class="op" id="4482019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482025">p</span><span class="op" id="4482026">.</span><span class="ident" id="4482027">internalError</span><span class="op" id="4482040">(</span><span class="string" id="4482041">&#34;negative&nbsp;indentation:&#34;</span><span class="op" id="4482064">,</span>&nbsp;<span class="ident" id="4482066">p</span><span class="op" id="4482067">.</span><span class="ident" id="4482068">indent</span><span class="op" id="4482074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482080">p</span><span class="op" id="4482081">.</span><span class="ident" id="4482082">indent</span>&nbsp;<span class="op" id="4482089">=</span>&nbsp;<span class="num" id="4482091">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4482096">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482100">case</span>&nbsp;<span class="ident" id="4482105">newline</span><span class="op" id="4482112">,</span>&nbsp;<span class="ident" id="4482114">formfeed</span><span class="op" id="4482122">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482127">//&nbsp;A&nbsp;line&nbsp;break&nbsp;immediately&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#34;correcting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482185">//&nbsp;unindent&nbsp;is&nbsp;swapped&nbsp;with&nbsp;the&nbsp;unindent&nbsp;-&nbsp;this&nbsp;permits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482244">//&nbsp;proper&nbsp;label&nbsp;positioning.&nbsp;If&nbsp;a&nbsp;comment&nbsp;is&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482300">//&nbsp;the&nbsp;line&nbsp;break&nbsp;and&nbsp;the&nbsp;label,&nbsp;the&nbsp;unindent&nbsp;is&nbsp;not</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482356">//&nbsp;part&nbsp;of&nbsp;the&nbsp;comment&nbsp;whitespace&nbsp;prefix&nbsp;and&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482416">//&nbsp;will&nbsp;be&nbsp;positioned&nbsp;correctly&nbsp;indented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482461">if</span>&nbsp;<span class="ident" id="4482464">i</span><span class="op" id="4482465">+</span><span class="num" id="4482466">1</span>&nbsp;<span class="op" id="4482468">&lt;</span>&nbsp;<span class="ident" id="4482470">n</span>&nbsp;<span class="op" id="4482472">&amp;&amp;</span>&nbsp;<span class="ident" id="4482475">p</span><span class="op" id="4482476">.</span><span class="ident" id="4482477">wsbuf</span><span class="op" id="4482482">[</span><span class="ident" id="4482483">i</span><span class="op" id="4482484">+</span><span class="num" id="4482485">1</span><span class="op" id="4482486">]</span>&nbsp;<span class="op" id="4482488">==</span>&nbsp;<span class="ident" id="4482491">unindent</span>&nbsp;<span class="op" id="4482500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482506">//&nbsp;Use&nbsp;a&nbsp;formfeed&nbsp;to&nbsp;terminate&nbsp;the&nbsp;current&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482562">//&nbsp;Otherwise,&nbsp;a&nbsp;long&nbsp;label&nbsp;name&nbsp;on&nbsp;the&nbsp;next&nbsp;line&nbsp;leading</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482623">//&nbsp;to&nbsp;a&nbsp;wide&nbsp;column&nbsp;may&nbsp;increase&nbsp;the&nbsp;indentation&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482683">//&nbsp;of&nbsp;lines&nbsp;before&nbsp;the&nbsp;label;&nbsp;effectively&nbsp;leading&nbsp;to&nbsp;wrong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482746">//&nbsp;indentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482766">p</span><span class="op" id="4482767">.</span><span class="ident" id="4482768">wsbuf</span><span class="op" id="4482773">[</span><span class="ident" id="4482774">i</span><span class="op" id="4482775">]</span><span class="op" id="4482776">,</span>&nbsp;<span class="ident" id="4482778">p</span><span class="op" id="4482779">.</span><span class="ident" id="4482780">wsbuf</span><span class="op" id="4482785">[</span><span class="ident" id="4482786">i</span><span class="op" id="4482787">+</span><span class="num" id="4482788">1</span><span class="op" id="4482789">]</span>&nbsp;<span class="op" id="4482791">=</span>&nbsp;<span class="ident" id="4482793">unindent</span><span class="op" id="4482801">,</span>&nbsp;<span class="ident" id="4482803">formfeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482816">i</span><span class="op" id="4482817">--</span>&nbsp;<span class="comment" id="4482820">//&nbsp;do&nbsp;it&nbsp;again</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482839">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4482851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482856">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482870">default</span><span class="op" id="4482877">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482882">p</span><span class="op" id="4482883">.</span><span class="ident" id="4482884">writeByte</span><span class="op" id="4482893">(</span><span class="builtintype" id="4482894">byte</span><span class="op" id="4482898">(</span><span class="ident" id="4482899">ch</span><span class="op" id="4482901">)</span><span class="op" id="4482902">,</span>&nbsp;<span class="num" id="4482904">1</span><span class="op" id="4482905">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4482909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4482912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482916">//&nbsp;shift&nbsp;remaining&nbsp;entries&nbsp;down</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482949">l</span>&nbsp;<span class="op" id="4482951">:=</span>&nbsp;<span class="builtinfunc" id="4482954">copy</span><span class="op" id="4482958">(</span><span class="ident" id="4482959">p</span><span class="op" id="4482960">.</span><span class="ident" id="4482961">wsbuf</span><span class="op" id="4482966">,</span>&nbsp;<span class="ident" id="4482968">p</span><span class="op" id="4482969">.</span><span class="ident" id="4482970">wsbuf</span><span class="op" id="4482975">[</span><span class="ident" id="4482976">n</span><span class="op" id="4482977">:</span><span class="op" id="4482978">]</span><span class="op" id="4482979">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482982">p</span><span class="op" id="4482983">.</span><span class="ident" id="4482984">wsbuf</span>&nbsp;<span class="op" id="4482990">=</span>&nbsp;<span class="ident" id="4482992">p</span><span class="op" id="4482993">.</span><span class="ident" id="4482994">wsbuf</span><span class="op" id="4482999">[</span><span class="op" id="4483000">:</span><span class="ident" id="4483001">l</span><span class="op" id="4483002">]</span><br>
<span class="lineno"></span><span class="op" id="4483004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4483007">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4483087">//&nbsp;Printing&nbsp;interface</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="4483110">//&nbsp;nlines&nbsp;limits&nbsp;n&nbsp;to&nbsp;maxNewlines.</span><br>
<span class="lineno"></span><span class="keyword" id="4483145">func</span>&nbsp;<span class="ident" id="4483150">nlimit</span><span class="op" id="4483156">(</span><span class="ident" id="4483157">n</span>&nbsp;<span class="builtintype" id="4483159">int</span><span class="op" id="4483162">)</span>&nbsp;<span class="builtintype" id="4483164">int</span>&nbsp;<span class="op" id="4483168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483171">if</span>&nbsp;<span class="ident" id="4483174">n</span>&nbsp;<span class="op" id="4483176">&gt;</span>&nbsp;<span class="ident" id="4483178">maxNewlines</span>&nbsp;<span class="op" id="4483190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483194">n</span>&nbsp;<span class="op" id="4483196">=</span>&nbsp;<span class="ident" id="4483198">maxNewlines</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4483211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483214">return</span>&nbsp;<span class="ident" id="4483221">n</span><br>
<span class="lineno"></span><span class="op" id="4483223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4483226">func</span>&nbsp;<span class="ident" id="4483231">mayCombine</span><span class="op" id="4483241">(</span><span class="ident" id="4483242">prev</span>&nbsp;<span class="ident" id="4483247">token</span><span class="op" id="4483252">.</span><span class="ident" id="4483253">Token</span><span class="op" id="4483258">,</span>&nbsp;<span class="ident" id="4483260">next</span>&nbsp;<span class="builtintype" id="4483265">byte</span><span class="op" id="4483269">)</span>&nbsp;<span class="op" id="4483271">(</span><span class="ident" id="4483272">b</span>&nbsp;<span class="builtintype" id="4483274">bool</span><span class="op" id="4483278">)</span>&nbsp;<span class="op" id="4483280">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483283">switch</span>&nbsp;<span class="ident" id="4483290">prev</span>&nbsp;<span class="op" id="4483295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483298">case</span>&nbsp;<span class="ident" id="4483303">token</span><span class="op" id="4483308">.</span><span class="ident" id="4483309">INT</span><span class="op" id="4483312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483316">b</span>&nbsp;<span class="op" id="4483318">=</span>&nbsp;<span class="ident" id="4483320">next</span>&nbsp;<span class="op" id="4483325">==</span>&nbsp;<span class="string" id="4483328">&#39;.&#39;</span>&nbsp;<span class="comment" id="4483332">//&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483339">case</span>&nbsp;<span class="ident" id="4483344">token</span><span class="op" id="4483349">.</span><span class="ident" id="4483350">ADD</span><span class="op" id="4483353">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483357">b</span>&nbsp;<span class="op" id="4483359">=</span>&nbsp;<span class="ident" id="4483361">next</span>&nbsp;<span class="op" id="4483366">==</span>&nbsp;<span class="string" id="4483369">&#39;+&#39;</span>&nbsp;<span class="comment" id="4483373">//&nbsp;++</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483380">case</span>&nbsp;<span class="ident" id="4483385">token</span><span class="op" id="4483390">.</span><span class="ident" id="4483391">SUB</span><span class="op" id="4483394">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483398">b</span>&nbsp;<span class="op" id="4483400">=</span>&nbsp;<span class="ident" id="4483402">next</span>&nbsp;<span class="op" id="4483407">==</span>&nbsp;<span class="string" id="4483410">&#39;-&#39;</span>&nbsp;<span class="comment" id="4483414">//&nbsp;--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483421">case</span>&nbsp;<span class="ident" id="4483426">token</span><span class="op" id="4483431">.</span><span class="ident" id="4483432">QUO</span><span class="op" id="4483435">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483439">b</span>&nbsp;<span class="op" id="4483441">=</span>&nbsp;<span class="ident" id="4483443">next</span>&nbsp;<span class="op" id="4483448">==</span>&nbsp;<span class="string" id="4483451">&#39;*&#39;</span>&nbsp;<span class="comment" id="4483455">//&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483462">case</span>&nbsp;<span class="ident" id="4483467">token</span><span class="op" id="4483472">.</span><span class="ident" id="4483473">LSS</span><span class="op" id="4483476">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483480">b</span>&nbsp;<span class="op" id="4483482">=</span>&nbsp;<span class="ident" id="4483484">next</span>&nbsp;<span class="op" id="4483489">==</span>&nbsp;<span class="string" id="4483492">&#39;-&#39;</span>&nbsp;<span class="op" id="4483496">||</span>&nbsp;<span class="ident" id="4483499">next</span>&nbsp;<span class="op" id="4483504">==</span>&nbsp;<span class="string" id="4483507">&#39;&lt;&#39;</span>&nbsp;<span class="comment" id="4483511">//&nbsp;&lt;-&nbsp;or&nbsp;&lt;&lt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483524">case</span>&nbsp;<span class="ident" id="4483529">token</span><span class="op" id="4483534">.</span><span class="ident" id="4483535">AND</span><span class="op" id="4483538">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483542">b</span>&nbsp;<span class="op" id="4483544">=</span>&nbsp;<span class="ident" id="4483546">next</span>&nbsp;<span class="op" id="4483551">==</span>&nbsp;<span class="string" id="4483554">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4483558">||</span>&nbsp;<span class="ident" id="4483561">next</span>&nbsp;<span class="op" id="4483566">==</span>&nbsp;<span class="string" id="4483569">&#39;^&#39;</span>&nbsp;<span class="comment" id="4483573">//&nbsp;&amp;&amp;&nbsp;or&nbsp;&amp;^</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4483586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483589">return</span><br>
<span class="lineno">825</span><span class="op" id="4483596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4483599">//&nbsp;print&nbsp;prints&nbsp;a&nbsp;list&nbsp;of&nbsp;&#34;items&#34;&nbsp;(roughly&nbsp;corresponding&nbsp;to&nbsp;syntactic</span><br>
<span class="lineno"></span><span class="comment" id="4483669">//&nbsp;tokens,&nbsp;but&nbsp;also&nbsp;including&nbsp;whitespace&nbsp;and&nbsp;formatting&nbsp;information).</span><br>
<span class="lineno"></span><span class="comment" id="4483739">//&nbsp;It&nbsp;is&nbsp;the&nbsp;only&nbsp;print&nbsp;function&nbsp;that&nbsp;should&nbsp;be&nbsp;called&nbsp;directly&nbsp;from</span><br>
<span class="lineno">830</span><span class="comment" id="4483808">//&nbsp;any&nbsp;of&nbsp;the&nbsp;AST&nbsp;printing&nbsp;functions&nbsp;in&nbsp;nodes.go.</span><br>
<span class="lineno"></span><span class="comment" id="4483858">//</span><br>
<span class="lineno"></span><span class="comment" id="4483861">//&nbsp;Whitespace&nbsp;is&nbsp;accumulated&nbsp;until&nbsp;a&nbsp;non-whitespace&nbsp;token&nbsp;appears.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="4483932">//&nbsp;comments&nbsp;that&nbsp;need&nbsp;to&nbsp;appear&nbsp;before&nbsp;that&nbsp;token&nbsp;are&nbsp;printed&nbsp;first,</span><br>
<span class="lineno"></span><span class="comment" id="4484001">//&nbsp;taking&nbsp;into&nbsp;account&nbsp;the&nbsp;amount&nbsp;and&nbsp;structure&nbsp;of&nbsp;any&nbsp;pending&nbsp;white-</span><br>
<span class="lineno">835</span><span class="comment" id="4484071">//&nbsp;space&nbsp;for&nbsp;best&nbsp;comment&nbsp;placement.&nbsp;Then,&nbsp;any&nbsp;leftover&nbsp;whitespace&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4484141">//&nbsp;printed,&nbsp;followed&nbsp;by&nbsp;the&nbsp;actual&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="4484183">//</span><br>
<span class="lineno"></span><span class="keyword" id="4484186">func</span>&nbsp;<span class="op" id="4484191">(</span><span class="ident" id="4484192">p</span>&nbsp;<span class="op" id="4484194">*</span><span class="ident" id="4484195">printer</span><span class="op" id="4484202">)</span>&nbsp;<span class="builtinfunc" id="4484204">print</span><span class="op" id="4484209">(</span><span class="ident" id="4484210">args</span>&nbsp;<span class="op" id="4484215">...</span><span class="keyword" id="4484218">interface</span><span class="op" id="4484227">{</span><span class="op" id="4484228">}</span><span class="op" id="4484229">)</span>&nbsp;<span class="op" id="4484231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484234">for</span>&nbsp;<span class="ident" id="4484238">_</span><span class="op" id="4484239">,</span>&nbsp;<span class="ident" id="4484241">arg</span>&nbsp;<span class="op" id="4484245">:=</span>&nbsp;<span class="keyword" id="4484248">range</span>&nbsp;<span class="ident" id="4484254">args</span>&nbsp;<span class="op" id="4484259">{</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4484263">//&nbsp;information&nbsp;about&nbsp;the&nbsp;current&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484302">var</span>&nbsp;<span class="ident" id="4484306">data</span>&nbsp;<span class="builtintype" id="4484311">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484320">var</span>&nbsp;<span class="ident" id="4484324">isLit</span>&nbsp;<span class="builtintype" id="4484330">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484337">var</span>&nbsp;<span class="ident" id="4484341">impliedSemi</span>&nbsp;<span class="builtintype" id="4484353">bool</span>&nbsp;<span class="comment" id="4484358">//&nbsp;value&nbsp;for&nbsp;p.impliedSemi&nbsp;after&nbsp;this&nbsp;arg</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4484403">//&nbsp;record&nbsp;previous&nbsp;opening&nbsp;token,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484446">switch</span>&nbsp;<span class="ident" id="4484453">p</span><span class="op" id="4484454">.</span><span class="ident" id="4484455">lastTok</span>&nbsp;<span class="op" id="4484463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484467">case</span>&nbsp;<span class="ident" id="4484472">token</span><span class="op" id="4484477">.</span><span class="ident" id="4484478">ILLEGAL</span><span class="op" id="4484485">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4484490">//&nbsp;ignore&nbsp;(white&nbsp;space)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484516">case</span>&nbsp;<span class="ident" id="4484521">token</span><span class="op" id="4484526">.</span><span class="ident" id="4484527">LPAREN</span><span class="op" id="4484533">,</span>&nbsp;<span class="ident" id="4484535">token</span><span class="op" id="4484540">.</span><span class="ident" id="4484541">LBRACK</span><span class="op" id="4484547">:</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4484552">p</span><span class="op" id="4484553">.</span><span class="ident" id="4484554">prevOpen</span>&nbsp;<span class="op" id="4484563">=</span>&nbsp;<span class="ident" id="4484565">p</span><span class="op" id="4484566">.</span><span class="ident" id="4484567">lastTok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484577">default</span><span class="op" id="4484584">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4484589">//&nbsp;other&nbsp;tokens&nbsp;followed&nbsp;any&nbsp;opening&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4484635">p</span><span class="op" id="4484636">.</span><span class="ident" id="4484637">prevOpen</span>&nbsp;<span class="op" id="4484646">=</span>&nbsp;<span class="ident" id="4484648">token</span><span class="op" id="4484653">.</span><span class="ident" id="4484654">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4484664">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484669">switch</span>&nbsp;<span class="ident" id="4484676">x</span>&nbsp;<span class="op" id="4484678">:=</span>&nbsp;<span class="ident" id="4484681">arg</span><span class="op" id="4484684">.</span><span class="op" id="4484685">(</span><span class="keyword" id="4484686">type</span><span class="op" id="4484690">)</span>&nbsp;<span class="op" id="4484692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484696">case</span>&nbsp;<span class="ident" id="4484701">pmode</span><span class="op" id="4484706">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4484711">//&nbsp;toggle&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4484737">p</span><span class="op" id="4484738">.</span><span class="ident" id="4484739">mode</span>&nbsp;<span class="op" id="4484744">^=</span>&nbsp;<span class="ident" id="4484747">x</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484752">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484764">case</span>&nbsp;<span class="ident" id="4484769">whiteSpace</span><span class="op" id="4484779">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484784">if</span>&nbsp;<span class="ident" id="4484787">x</span>&nbsp;<span class="op" id="4484789">==</span>&nbsp;<span class="ident" id="4484792">ignore</span>&nbsp;<span class="op" id="4484799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4484805">//&nbsp;don&#39;t&nbsp;add&nbsp;ignore&#39;s&nbsp;to&nbsp;the&nbsp;buffer;&nbsp;they</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4484851">//&nbsp;may&nbsp;screw&nbsp;up&nbsp;&#34;correcting&#34;&nbsp;unindents&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4484899">//&nbsp;LabeledStmt)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484919">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4484931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4484936">i</span>&nbsp;<span class="op" id="4484938">:=</span>&nbsp;<span class="builtinfunc" id="4484941">len</span><span class="op" id="4484944">(</span><span class="ident" id="4484945">p</span><span class="op" id="4484946">.</span><span class="ident" id="4484947">wsbuf</span><span class="op" id="4484952">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484957">if</span>&nbsp;<span class="ident" id="4484960">i</span>&nbsp;<span class="op" id="4484962">==</span>&nbsp;<span class="builtinfunc" id="4484965">cap</span><span class="op" id="4484968">(</span><span class="ident" id="4484969">p</span><span class="op" id="4484970">.</span><span class="ident" id="4484971">wsbuf</span><span class="op" id="4484976">)</span>&nbsp;<span class="op" id="4484978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4484984">//&nbsp;Whitespace&nbsp;sequences&nbsp;are&nbsp;very&nbsp;short&nbsp;so&nbsp;this&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4485042">//&nbsp;never&nbsp;happen.&nbsp;Handle&nbsp;gracefully&nbsp;(but&nbsp;possibly&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4485100">//&nbsp;bad&nbsp;comment&nbsp;placement)&nbsp;if&nbsp;it&nbsp;does&nbsp;happen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485149">p</span><span class="op" id="4485150">.</span><span class="ident" id="4485151">writeWhitespace</span><span class="op" id="4485166">(</span><span class="ident" id="4485167">i</span><span class="op" id="4485168">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485174">i</span>&nbsp;<span class="op" id="4485176">=</span>&nbsp;<span class="num" id="4485178">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4485183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485188">p</span><span class="op" id="4485189">.</span><span class="ident" id="4485190">wsbuf</span>&nbsp;<span class="op" id="4485196">=</span>&nbsp;<span class="ident" id="4485198">p</span><span class="op" id="4485199">.</span><span class="ident" id="4485200">wsbuf</span><span class="op" id="4485205">[</span><span class="num" id="4485206">0</span>&nbsp;<span class="op" id="4485208">:</span>&nbsp;<span class="ident" id="4485210">i</span><span class="op" id="4485211">+</span><span class="num" id="4485212">1</span><span class="op" id="4485213">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485218">p</span><span class="op" id="4485219">.</span><span class="ident" id="4485220">wsbuf</span><span class="op" id="4485225">[</span><span class="ident" id="4485226">i</span><span class="op" id="4485227">]</span>&nbsp;<span class="op" id="4485229">=</span>&nbsp;<span class="ident" id="4485231">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485236">if</span>&nbsp;<span class="ident" id="4485239">x</span>&nbsp;<span class="op" id="4485241">==</span>&nbsp;<span class="ident" id="4485244">newline</span>&nbsp;<span class="op" id="4485252">||</span>&nbsp;<span class="ident" id="4485255">x</span>&nbsp;<span class="op" id="4485257">==</span>&nbsp;<span class="ident" id="4485260">formfeed</span>&nbsp;<span class="op" id="4485269">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4485275">//&nbsp;newlines&nbsp;affect&nbsp;the&nbsp;current&nbsp;state&nbsp;(p.impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4485332">//&nbsp;and&nbsp;not&nbsp;the&nbsp;state&nbsp;after&nbsp;printing&nbsp;arg&nbsp;(impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4485390">//&nbsp;because&nbsp;comments&nbsp;can&nbsp;be&nbsp;interspersed&nbsp;before&nbsp;the&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4485449">//&nbsp;in&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485469">p</span><span class="op" id="4485470">.</span><span class="ident" id="4485471">impliedSemi</span>&nbsp;<span class="op" id="4485483">=</span>&nbsp;<span class="builtintype" id="4485485">false</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4485494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485499">p</span><span class="op" id="4485500">.</span><span class="ident" id="4485501">lastTok</span>&nbsp;<span class="op" id="4485509">=</span>&nbsp;<span class="ident" id="4485511">token</span><span class="op" id="4485516">.</span><span class="ident" id="4485517">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485528">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485540">case</span>&nbsp;<span class="op" id="4485545">*</span><span class="ident" id="4485546">ast</span><span class="op" id="4485549">.</span><span class="ident" id="4485550">Ident</span><span class="op" id="4485555">:</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485560">data</span>&nbsp;<span class="op" id="4485565">=</span>&nbsp;<span class="ident" id="4485567">x</span><span class="op" id="4485568">.</span><span class="ident" id="4485569">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485577">impliedSemi</span>&nbsp;<span class="op" id="4485589">=</span>&nbsp;<span class="builtintype" id="4485591">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485599">p</span><span class="op" id="4485600">.</span><span class="ident" id="4485601">lastTok</span>&nbsp;<span class="op" id="4485609">=</span>&nbsp;<span class="ident" id="4485611">token</span><span class="op" id="4485616">.</span><span class="ident" id="4485617">IDENT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485626">case</span>&nbsp;<span class="op" id="4485631">*</span><span class="ident" id="4485632">ast</span><span class="op" id="4485635">.</span><span class="ident" id="4485636">BasicLit</span><span class="op" id="4485644">:</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485649">data</span>&nbsp;<span class="op" id="4485654">=</span>&nbsp;<span class="ident" id="4485656">x</span><span class="op" id="4485657">.</span><span class="ident" id="4485658">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485667">isLit</span>&nbsp;<span class="op" id="4485673">=</span>&nbsp;<span class="builtintype" id="4485675">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485683">impliedSemi</span>&nbsp;<span class="op" id="4485695">=</span>&nbsp;<span class="builtintype" id="4485697">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485705">p</span><span class="op" id="4485706">.</span><span class="ident" id="4485707">lastTok</span>&nbsp;<span class="op" id="4485715">=</span>&nbsp;<span class="ident" id="4485717">x</span><span class="op" id="4485718">.</span><span class="ident" id="4485719">Kind</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485727">case</span>&nbsp;<span class="ident" id="4485732">token</span><span class="op" id="4485737">.</span><span class="ident" id="4485738">Token</span><span class="op" id="4485743">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485748">s</span>&nbsp;<span class="op" id="4485750">:=</span>&nbsp;<span class="ident" id="4485753">x</span><span class="op" id="4485754">.</span><span class="ident" id="4485755">String</span><span class="op" id="4485761">(</span><span class="op" id="4485762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485767">if</span>&nbsp;<span class="ident" id="4485770">mayCombine</span><span class="op" id="4485780">(</span><span class="ident" id="4485781">p</span><span class="op" id="4485782">.</span><span class="ident" id="4485783">lastTok</span><span class="op" id="4485790">,</span>&nbsp;<span class="ident" id="4485792">s</span><span class="op" id="4485793">[</span><span class="num" id="4485794">0</span><span class="op" id="4485795">]</span><span class="op" id="4485796">)</span>&nbsp;<span class="op" id="4485798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4485804">//&nbsp;the&nbsp;previous&nbsp;and&nbsp;the&nbsp;current&nbsp;token&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4485854">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;blank&nbsp;otherwise&nbsp;they&nbsp;combine</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4485905">//&nbsp;into&nbsp;a&nbsp;different&nbsp;incorrect&nbsp;token&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4485954">//&nbsp;(except&nbsp;for&nbsp;token.INT&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#39;.&#39;&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4486006">//&nbsp;should&nbsp;never&nbsp;happen&nbsp;because&nbsp;it&nbsp;is&nbsp;taken&nbsp;care</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4486058">//&nbsp;of&nbsp;via&nbsp;binary&nbsp;expression&nbsp;formatting)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486102">if</span>&nbsp;<span class="builtinfunc" id="4486105">len</span><span class="op" id="4486108">(</span><span class="ident" id="4486109">p</span><span class="op" id="4486110">.</span><span class="ident" id="4486111">wsbuf</span><span class="op" id="4486116">)</span>&nbsp;<span class="op" id="4486118">!=</span>&nbsp;<span class="num" id="4486121">0</span>&nbsp;<span class="op" id="4486123">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486130">p</span><span class="op" id="4486131">.</span><span class="ident" id="4486132">internalError</span><span class="op" id="4486145">(</span><span class="string" id="4486146">&#34;whitespace&nbsp;buffer&nbsp;not&nbsp;empty&#34;</span><span class="op" id="4486175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4486181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486187">p</span><span class="op" id="4486188">.</span><span class="ident" id="4486189">wsbuf</span>&nbsp;<span class="op" id="4486195">=</span>&nbsp;<span class="ident" id="4486197">p</span><span class="op" id="4486198">.</span><span class="ident" id="4486199">wsbuf</span><span class="op" id="4486204">[</span><span class="num" id="4486205">0</span><span class="op" id="4486206">:</span><span class="num" id="4486207">1</span><span class="op" id="4486208">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486214">p</span><span class="op" id="4486215">.</span><span class="ident" id="4486216">wsbuf</span><span class="op" id="4486221">[</span><span class="num" id="4486222">0</span><span class="op" id="4486223">]</span>&nbsp;<span class="op" id="4486225">=</span>&nbsp;<span class="string" id="4486227">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4486234">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486239">data</span>&nbsp;<span class="op" id="4486244">=</span>&nbsp;<span class="ident" id="4486246">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4486251">//&nbsp;some&nbsp;keywords&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;imply&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486311">switch</span>&nbsp;<span class="ident" id="4486318">x</span>&nbsp;<span class="op" id="4486320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486325">case</span>&nbsp;<span class="ident" id="4486330">token</span><span class="op" id="4486335">.</span><span class="ident" id="4486336">BREAK</span><span class="op" id="4486341">,</span>&nbsp;<span class="ident" id="4486343">token</span><span class="op" id="4486348">.</span><span class="ident" id="4486349">CONTINUE</span><span class="op" id="4486357">,</span>&nbsp;<span class="ident" id="4486359">token</span><span class="op" id="4486364">.</span><span class="ident" id="4486365">FALLTHROUGH</span><span class="op" id="4486376">,</span>&nbsp;<span class="ident" id="4486378">token</span><span class="op" id="4486383">.</span><span class="ident" id="4486384">RETURN</span><span class="op" id="4486390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486396">token</span><span class="op" id="4486401">.</span><span class="ident" id="4486402">INC</span><span class="op" id="4486405">,</span>&nbsp;<span class="ident" id="4486407">token</span><span class="op" id="4486412">.</span><span class="ident" id="4486413">DEC</span><span class="op" id="4486416">,</span>&nbsp;<span class="ident" id="4486418">token</span><span class="op" id="4486423">.</span><span class="ident" id="4486424">RPAREN</span><span class="op" id="4486430">,</span>&nbsp;<span class="ident" id="4486432">token</span><span class="op" id="4486437">.</span><span class="ident" id="4486438">RBRACK</span><span class="op" id="4486444">,</span>&nbsp;<span class="ident" id="4486446">token</span><span class="op" id="4486451">.</span><span class="ident" id="4486452">RBRACE</span><span class="op" id="4486458">:</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486464">impliedSemi</span>&nbsp;<span class="op" id="4486476">=</span>&nbsp;<span class="builtintype" id="4486478">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4486486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486491">p</span><span class="op" id="4486492">.</span><span class="ident" id="4486493">lastTok</span>&nbsp;<span class="op" id="4486501">=</span>&nbsp;<span class="ident" id="4486503">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486508">case</span>&nbsp;<span class="ident" id="4486513">token</span><span class="op" id="4486518">.</span><span class="ident" id="4486519">Pos</span><span class="op" id="4486522">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486527">if</span>&nbsp;<span class="ident" id="4486530">x</span><span class="op" id="4486531">.</span><span class="ident" id="4486532">IsValid</span><span class="op" id="4486539">(</span><span class="op" id="4486540">)</span>&nbsp;<span class="op" id="4486542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486548">p</span><span class="op" id="4486549">.</span><span class="ident" id="4486550">pos</span>&nbsp;<span class="op" id="4486554">=</span>&nbsp;<span class="ident" id="4486556">p</span><span class="op" id="4486557">.</span><span class="ident" id="4486558">posFor</span><span class="op" id="4486564">(</span><span class="ident" id="4486565">x</span><span class="op" id="4486566">)</span>&nbsp;<span class="comment" id="4486568">//&nbsp;accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4486605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486610">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486622">case</span>&nbsp;<span class="builtintype" id="4486627">string</span><span class="op" id="4486633">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4486638">//&nbsp;incorrect&nbsp;AST&nbsp;-&nbsp;print&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486680">data</span>&nbsp;<span class="op" id="4486685">=</span>&nbsp;<span class="ident" id="4486687">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486692">isLit</span>&nbsp;<span class="op" id="4486698">=</span>&nbsp;<span class="builtintype" id="4486700">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486708">impliedSemi</span>&nbsp;<span class="op" id="4486720">=</span>&nbsp;<span class="builtintype" id="4486722">true</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486730">p</span><span class="op" id="4486731">.</span><span class="ident" id="4486732">lastTok</span>&nbsp;<span class="op" id="4486740">=</span>&nbsp;<span class="ident" id="4486742">token</span><span class="op" id="4486747">.</span><span class="ident" id="4486748">STRING</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486758">default</span><span class="op" id="4486765">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486770">fmt</span><span class="op" id="4486773">.</span><span class="ident" id="4486774">Fprintf</span><span class="op" id="4486781">(</span><span class="ident" id="4486782">os</span><span class="op" id="4486784">.</span><span class="ident" id="4486785">Stderr</span><span class="op" id="4486791">,</span>&nbsp;<span class="string" id="4486793">&#34;print:&nbsp;unsupported&nbsp;argument&nbsp;%v&nbsp;(%T)\n&#34;</span><span class="op" id="4486832">,</span>&nbsp;<span class="ident" id="4486834">arg</span><span class="op" id="4486837">,</span>&nbsp;<span class="ident" id="4486839">arg</span><span class="op" id="4486842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4486847">panic</span><span class="op" id="4486852">(</span><span class="string" id="4486853">&#34;go/printer&nbsp;type&#34;</span><span class="op" id="4486870">)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4486874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4486878">//&nbsp;data&nbsp;!=&nbsp;&#34;&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486895">next</span>&nbsp;<span class="op" id="4486900">:=</span>&nbsp;<span class="ident" id="4486903">p</span><span class="op" id="4486904">.</span><span class="ident" id="4486905">pos</span>&nbsp;<span class="comment" id="4486909">//&nbsp;estimated/accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486955">wroteNewline</span><span class="op" id="4486967">,</span>&nbsp;<span class="ident" id="4486969">droppedFF</span>&nbsp;<span class="op" id="4486979">:=</span>&nbsp;<span class="ident" id="4486982">p</span><span class="op" id="4486983">.</span><span class="ident" id="4486984">flush</span><span class="op" id="4486989">(</span><span class="ident" id="4486990">next</span><span class="op" id="4486994">,</span>&nbsp;<span class="ident" id="4486996">p</span><span class="op" id="4486997">.</span><span class="ident" id="4486998">lastTok</span><span class="op" id="4487005">)</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4487010">//&nbsp;intersperse&nbsp;extra&nbsp;newlines&nbsp;if&nbsp;present&nbsp;in&nbsp;the&nbsp;source&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4487071">//&nbsp;if&nbsp;they&nbsp;don&#39;t&nbsp;cause&nbsp;extra&nbsp;semicolons&nbsp;(don&#39;t&nbsp;do&nbsp;this&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4487131">//&nbsp;flush&nbsp;as&nbsp;it&nbsp;will&nbsp;cause&nbsp;extra&nbsp;newlines&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;file)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487196">if</span>&nbsp;<span class="op" id="4487199">!</span><span class="ident" id="4487200">p</span><span class="op" id="4487201">.</span><span class="ident" id="4487202">impliedSemi</span>&nbsp;<span class="op" id="4487214">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487219">n</span>&nbsp;<span class="op" id="4487221">:=</span>&nbsp;<span class="ident" id="4487224">nlimit</span><span class="op" id="4487230">(</span><span class="ident" id="4487231">next</span><span class="op" id="4487235">.</span><span class="ident" id="4487236">Line</span>&nbsp;<span class="op" id="4487241">-</span>&nbsp;<span class="ident" id="4487243">p</span><span class="op" id="4487244">.</span><span class="ident" id="4487245">pos</span><span class="op" id="4487248">.</span><span class="ident" id="4487249">Line</span><span class="op" id="4487253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4487258">//&nbsp;don&#39;t&nbsp;exceed&nbsp;maxNewlines&nbsp;if&nbsp;we&nbsp;already&nbsp;wrote&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487313">if</span>&nbsp;<span class="ident" id="4487316">wroteNewline</span>&nbsp;<span class="op" id="4487329">&amp;&amp;</span>&nbsp;<span class="ident" id="4487332">n</span>&nbsp;<span class="op" id="4487334">==</span>&nbsp;<span class="ident" id="4487337">maxNewlines</span>&nbsp;<span class="op" id="4487349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487355">n</span>&nbsp;<span class="op" id="4487357">=</span>&nbsp;<span class="ident" id="4487359">maxNewlines</span>&nbsp;<span class="op" id="4487371">-</span>&nbsp;<span class="num" id="4487373">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4487378">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487383">if</span>&nbsp;<span class="ident" id="4487386">n</span>&nbsp;<span class="op" id="4487388">&gt;</span>&nbsp;<span class="num" id="4487390">0</span>&nbsp;<span class="op" id="4487392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487398">ch</span>&nbsp;<span class="op" id="4487401">:=</span>&nbsp;<span class="builtintype" id="4487404">byte</span><span class="op" id="4487408">(</span><span class="string" id="4487409">&#39;\n&#39;</span><span class="op" id="4487413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487419">if</span>&nbsp;<span class="ident" id="4487422">droppedFF</span>&nbsp;<span class="op" id="4487432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487439">ch</span>&nbsp;<span class="op" id="4487442">=</span>&nbsp;<span class="string" id="4487444">&#39;\f&#39;</span>&nbsp;<span class="comment" id="4487449">//&nbsp;use&nbsp;formfeed&nbsp;since&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4487497">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487503">p</span><span class="op" id="4487504">.</span><span class="ident" id="4487505">writeByte</span><span class="op" id="4487514">(</span><span class="ident" id="4487515">ch</span><span class="op" id="4487517">,</span>&nbsp;<span class="ident" id="4487519">n</span><span class="op" id="4487520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487526">impliedSemi</span>&nbsp;<span class="op" id="4487538">=</span>&nbsp;<span class="builtintype" id="4487540">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4487549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4487553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4487558">//&nbsp;the&nbsp;next&nbsp;token&nbsp;starts&nbsp;now&nbsp;-&nbsp;record&nbsp;its&nbsp;line&nbsp;number&nbsp;if&nbsp;requested</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487627">if</span>&nbsp;<span class="ident" id="4487630">p</span><span class="op" id="4487631">.</span><span class="ident" id="4487632">linePtr</span>&nbsp;<span class="op" id="4487640">!=</span>&nbsp;<span class="ident" id="4487643">nil</span>&nbsp;<span class="op" id="4487647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4487652">*</span><span class="ident" id="4487653">p</span><span class="op" id="4487654">.</span><span class="ident" id="4487655">linePtr</span>&nbsp;<span class="op" id="4487663">=</span>&nbsp;<span class="ident" id="4487665">p</span><span class="op" id="4487666">.</span><span class="ident" id="4487667">out</span><span class="op" id="4487670">.</span><span class="ident" id="4487671">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487679">p</span><span class="op" id="4487680">.</span><span class="ident" id="4487681">linePtr</span>&nbsp;<span class="op" id="4487689">=</span>&nbsp;<span class="ident" id="4487691">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4487697">}</span><br>
<span class="lineno">970</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487702">p</span><span class="op" id="4487703">.</span><span class="ident" id="4487704">writeString</span><span class="op" id="4487715">(</span><span class="ident" id="4487716">next</span><span class="op" id="4487720">,</span>&nbsp;<span class="ident" id="4487722">data</span><span class="op" id="4487726">,</span>&nbsp;<span class="ident" id="4487728">isLit</span><span class="op" id="4487733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487737">p</span><span class="op" id="4487738">.</span><span class="ident" id="4487739">impliedSemi</span>&nbsp;<span class="op" id="4487751">=</span>&nbsp;<span class="ident" id="4487753">impliedSemi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4487766">}</span><br>
<span class="lineno"></span><span class="op" id="4487768">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span><span class="comment" id="4487771">//&nbsp;flush&nbsp;prints&nbsp;any&nbsp;pending&nbsp;comments&nbsp;and&nbsp;whitespace&nbsp;occurring&nbsp;textually</span><br>
<span class="lineno"></span><span class="comment" id="4487843">//&nbsp;before&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;next&nbsp;token&nbsp;tok.&nbsp;The&nbsp;flush&nbsp;result&nbsp;indicates</span><br>
<span class="lineno"></span><span class="comment" id="4487916">//&nbsp;if&nbsp;a&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="4487993">//&nbsp;buffer.</span><br>
<span class="lineno">980</span><span class="comment" id="4488004">//</span><br>
<span class="lineno"></span><span class="keyword" id="4488007">func</span>&nbsp;<span class="op" id="4488012">(</span><span class="ident" id="4488013">p</span>&nbsp;<span class="op" id="4488015">*</span><span class="ident" id="4488016">printer</span><span class="op" id="4488023">)</span>&nbsp;<span class="ident" id="4488025">flush</span><span class="op" id="4488030">(</span><span class="ident" id="4488031">next</span>&nbsp;<span class="ident" id="4488036">token</span><span class="op" id="4488041">.</span><span class="ident" id="4488042">Position</span><span class="op" id="4488050">,</span>&nbsp;<span class="ident" id="4488052">tok</span>&nbsp;<span class="ident" id="4488056">token</span><span class="op" id="4488061">.</span><span class="ident" id="4488062">Token</span><span class="op" id="4488067">)</span>&nbsp;<span class="op" id="4488069">(</span><span class="ident" id="4488070">wroteNewline</span><span class="op" id="4488082">,</span>&nbsp;<span class="ident" id="4488084">droppedFF</span>&nbsp;<span class="builtintype" id="4488094">bool</span><span class="op" id="4488098">)</span>&nbsp;<span class="op" id="4488100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488103">if</span>&nbsp;<span class="ident" id="4488106">p</span><span class="op" id="4488107">.</span><span class="ident" id="4488108">commentBefore</span><span class="op" id="4488121">(</span><span class="ident" id="4488122">next</span><span class="op" id="4488126">)</span>&nbsp;<span class="op" id="4488128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4488132">//&nbsp;if&nbsp;there&nbsp;are&nbsp;comments&nbsp;before&nbsp;the&nbsp;next&nbsp;item,&nbsp;intersperse&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488198">wroteNewline</span><span class="op" id="4488210">,</span>&nbsp;<span class="ident" id="4488212">droppedFF</span>&nbsp;<span class="op" id="4488222">=</span>&nbsp;<span class="ident" id="4488224">p</span><span class="op" id="4488225">.</span><span class="ident" id="4488226">intersperseComments</span><span class="op" id="4488245">(</span><span class="ident" id="4488246">next</span><span class="op" id="4488250">,</span>&nbsp;<span class="ident" id="4488252">tok</span><span class="op" id="4488255">)</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4488258">}</span>&nbsp;<span class="keyword" id="4488260">else</span>&nbsp;<span class="op" id="4488265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4488269">//&nbsp;otherwise,&nbsp;write&nbsp;any&nbsp;leftover&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488315">p</span><span class="op" id="4488316">.</span><span class="ident" id="4488317">writeWhitespace</span><span class="op" id="4488332">(</span><span class="builtinfunc" id="4488333">len</span><span class="op" id="4488336">(</span><span class="ident" id="4488337">p</span><span class="op" id="4488338">.</span><span class="ident" id="4488339">wsbuf</span><span class="op" id="4488344">)</span><span class="op" id="4488345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4488348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488351">return</span><br>
<span class="lineno">990</span><span class="op" id="4488358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4488361">//&nbsp;getNode&nbsp;returns&nbsp;the&nbsp;ast.CommentGroup&nbsp;associated&nbsp;with&nbsp;n,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="4488428">func</span>&nbsp;<span class="ident" id="4488433">getDoc</span><span class="op" id="4488439">(</span><span class="ident" id="4488440">n</span>&nbsp;<span class="ident" id="4488442">ast</span><span class="op" id="4488445">.</span><span class="ident" id="4488446">Node</span><span class="op" id="4488450">)</span>&nbsp;<span class="op" id="4488452">*</span><span class="ident" id="4488453">ast</span><span class="op" id="4488456">.</span><span class="ident" id="4488457">CommentGroup</span>&nbsp;<span class="op" id="4488470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488473">switch</span>&nbsp;<span class="ident" id="4488480">n</span>&nbsp;<span class="op" id="4488482">:=</span>&nbsp;<span class="ident" id="4488485">n</span><span class="op" id="4488486">.</span><span class="op" id="4488487">(</span><span class="keyword" id="4488488">type</span><span class="op" id="4488492">)</span>&nbsp;<span class="op" id="4488494">{</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488497">case</span>&nbsp;<span class="op" id="4488502">*</span><span class="ident" id="4488503">ast</span><span class="op" id="4488506">.</span><span class="ident" id="4488507">Field</span><span class="op" id="4488512">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488516">return</span>&nbsp;<span class="ident" id="4488523">n</span><span class="op" id="4488524">.</span><span class="ident" id="4488525">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488530">case</span>&nbsp;<span class="op" id="4488535">*</span><span class="ident" id="4488536">ast</span><span class="op" id="4488539">.</span><span class="ident" id="4488540">ImportSpec</span><span class="op" id="4488550">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488554">return</span>&nbsp;<span class="ident" id="4488561">n</span><span class="op" id="4488562">.</span><span class="ident" id="4488563">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488568">case</span>&nbsp;<span class="op" id="4488573">*</span><span class="ident" id="4488574">ast</span><span class="op" id="4488577">.</span><span class="ident" id="4488578">ValueSpec</span><span class="op" id="4488587">:</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488591">return</span>&nbsp;<span class="ident" id="4488598">n</span><span class="op" id="4488599">.</span><span class="ident" id="4488600">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488605">case</span>&nbsp;<span class="op" id="4488610">*</span><span class="ident" id="4488611">ast</span><span class="op" id="4488614">.</span><span class="ident" id="4488615">TypeSpec</span><span class="op" id="4488623">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488627">return</span>&nbsp;<span class="ident" id="4488634">n</span><span class="op" id="4488635">.</span><span class="ident" id="4488636">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488641">case</span>&nbsp;<span class="op" id="4488646">*</span><span class="ident" id="4488647">ast</span><span class="op" id="4488650">.</span><span class="ident" id="4488651">GenDecl</span><span class="op" id="4488658">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488662">return</span>&nbsp;<span class="ident" id="4488669">n</span><span class="op" id="4488670">.</span><span class="ident" id="4488671">Doc</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488676">case</span>&nbsp;<span class="op" id="4488681">*</span><span class="ident" id="4488682">ast</span><span class="op" id="4488685">.</span><span class="ident" id="4488686">FuncDecl</span><span class="op" id="4488694">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488698">return</span>&nbsp;<span class="ident" id="4488705">n</span><span class="op" id="4488706">.</span><span class="ident" id="4488707">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488712">case</span>&nbsp;<span class="op" id="4488717">*</span><span class="ident" id="4488718">ast</span><span class="op" id="4488721">.</span><span class="ident" id="4488722">File</span><span class="op" id="4488726">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488730">return</span>&nbsp;<span class="ident" id="4488737">n</span><span class="op" id="4488738">.</span><span class="ident" id="4488739">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4488744">}</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488747">return</span>&nbsp;<span class="ident" id="4488754">nil</span><br>
<span class="lineno"></span><span class="op" id="4488758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4488761">func</span>&nbsp;<span class="op" id="4488766">(</span><span class="ident" id="4488767">p</span>&nbsp;<span class="op" id="4488769">*</span><span class="ident" id="4488770">printer</span><span class="op" id="4488777">)</span>&nbsp;<span class="ident" id="4488779">printNode</span><span class="op" id="4488788">(</span><span class="ident" id="4488789">node</span>&nbsp;<span class="keyword" id="4488794">interface</span><span class="op" id="4488803">{</span><span class="op" id="4488804">}</span><span class="op" id="4488805">)</span>&nbsp;<span class="builtintype" id="4488807">error</span>&nbsp;<span class="op" id="4488813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4488816">//&nbsp;unpack&nbsp;*CommentedNode,&nbsp;if&nbsp;any</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488850">var</span>&nbsp;<span class="ident" id="4488854">comments</span>&nbsp;<span class="op" id="4488863">[</span><span class="op" id="4488864">]</span><span class="op" id="4488865">*</span><span class="ident" id="4488866">ast</span><span class="op" id="4488869">.</span><span class="ident" id="4488870">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488884">if</span>&nbsp;<span class="ident" id="4488887">cnode</span><span class="op" id="4488892">,</span>&nbsp;<span class="ident" id="4488894">ok</span>&nbsp;<span class="op" id="4488897">:=</span>&nbsp;<span class="ident" id="4488900">node</span><span class="op" id="4488904">.</span><span class="op" id="4488905">(</span><span class="op" id="4488906">*</span><span class="ident" id="4488907">CommentedNode</span><span class="op" id="4488920">)</span><span class="op" id="4488921">;</span>&nbsp;<span class="ident" id="4488923">ok</span>&nbsp;<span class="op" id="4488926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488930">node</span>&nbsp;<span class="op" id="4488935">=</span>&nbsp;<span class="ident" id="4488937">cnode</span><span class="op" id="4488942">.</span><span class="ident" id="4488943">Node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488950">comments</span>&nbsp;<span class="op" id="4488959">=</span>&nbsp;<span class="ident" id="4488961">cnode</span><span class="op" id="4488966">.</span><span class="ident" id="4488967">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4488977">}</span><br>
<span class="lineno">1020</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488981">if</span>&nbsp;<span class="ident" id="4488984">comments</span>&nbsp;<span class="op" id="4488993">!=</span>&nbsp;<span class="ident" id="4488996">nil</span>&nbsp;<span class="op" id="4489000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4489004">//&nbsp;commented&nbsp;node&nbsp;-&nbsp;restrict&nbsp;comment&nbsp;list&nbsp;to&nbsp;relevant&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489066">n</span><span class="op" id="4489067">,</span>&nbsp;<span class="ident" id="4489069">ok</span>&nbsp;<span class="op" id="4489072">:=</span>&nbsp;<span class="ident" id="4489075">node</span><span class="op" id="4489079">.</span><span class="op" id="4489080">(</span><span class="ident" id="4489081">ast</span><span class="op" id="4489084">.</span><span class="ident" id="4489085">Node</span><span class="op" id="4489089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489093">if</span>&nbsp;<span class="op" id="4489096">!</span><span class="ident" id="4489097">ok</span>&nbsp;<span class="op" id="4489100">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489105">goto</span>&nbsp;<span class="ident" id="4489110">unsupported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489128">beg</span>&nbsp;<span class="op" id="4489132">:=</span>&nbsp;<span class="ident" id="4489135">n</span><span class="op" id="4489136">.</span><span class="ident" id="4489137">Pos</span><span class="op" id="4489140">(</span><span class="op" id="4489141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489145">end</span>&nbsp;<span class="op" id="4489149">:=</span>&nbsp;<span class="ident" id="4489152">n</span><span class="op" id="4489153">.</span><span class="ident" id="4489154">End</span><span class="op" id="4489157">(</span><span class="op" id="4489158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4489162">//&nbsp;if&nbsp;the&nbsp;node&nbsp;has&nbsp;associated&nbsp;documentation,</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4489209">//&nbsp;include&nbsp;that&nbsp;commentgroup&nbsp;in&nbsp;the&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4489253">//&nbsp;(the&nbsp;comment&nbsp;list&nbsp;is&nbsp;sorted&nbsp;in&nbsp;the&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4489299">//&nbsp;of&nbsp;the&nbsp;comment&nbsp;appearance&nbsp;in&nbsp;the&nbsp;source&nbsp;code)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489350">if</span>&nbsp;<span class="ident" id="4489353">doc</span>&nbsp;<span class="op" id="4489357">:=</span>&nbsp;<span class="ident" id="4489360">getDoc</span><span class="op" id="4489366">(</span><span class="ident" id="4489367">n</span><span class="op" id="4489368">)</span><span class="op" id="4489369">;</span>&nbsp;<span class="ident" id="4489371">doc</span>&nbsp;<span class="op" id="4489375">!=</span>&nbsp;<span class="ident" id="4489378">nil</span>&nbsp;<span class="op" id="4489382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489387">beg</span>&nbsp;<span class="op" id="4489391">=</span>&nbsp;<span class="ident" id="4489393">doc</span><span class="op" id="4489396">.</span><span class="ident" id="4489397">Pos</span><span class="op" id="4489400">(</span><span class="op" id="4489401">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4489409">//&nbsp;token.Pos&nbsp;values&nbsp;are&nbsp;global&nbsp;offsets,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4489458">//&nbsp;compare&nbsp;them&nbsp;directly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489485">i</span>&nbsp;<span class="op" id="4489487">:=</span>&nbsp;<span class="num" id="4489490">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489494">for</span>&nbsp;<span class="ident" id="4489498">i</span>&nbsp;<span class="op" id="4489500">&lt;</span>&nbsp;<span class="builtinfunc" id="4489502">len</span><span class="op" id="4489505">(</span><span class="ident" id="4489506">comments</span><span class="op" id="4489514">)</span>&nbsp;<span class="op" id="4489516">&amp;&amp;</span>&nbsp;<span class="ident" id="4489519">comments</span><span class="op" id="4489527">[</span><span class="ident" id="4489528">i</span><span class="op" id="4489529">]</span><span class="op" id="4489530">.</span><span class="ident" id="4489531">End</span><span class="op" id="4489534">(</span><span class="op" id="4489535">)</span>&nbsp;<span class="op" id="4489537">&lt;</span>&nbsp;<span class="ident" id="4489539">beg</span>&nbsp;<span class="op" id="4489543">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489548">i</span><span class="op" id="4489549">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489558">j</span>&nbsp;<span class="op" id="4489560">:=</span>&nbsp;<span class="ident" id="4489563">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489567">for</span>&nbsp;<span class="ident" id="4489571">j</span>&nbsp;<span class="op" id="4489573">&lt;</span>&nbsp;<span class="builtinfunc" id="4489575">len</span><span class="op" id="4489578">(</span><span class="ident" id="4489579">comments</span><span class="op" id="4489587">)</span>&nbsp;<span class="op" id="4489589">&amp;&amp;</span>&nbsp;<span class="ident" id="4489592">comments</span><span class="op" id="4489600">[</span><span class="ident" id="4489601">j</span><span class="op" id="4489602">]</span><span class="op" id="4489603">.</span><span class="ident" id="4489604">Pos</span><span class="op" id="4489607">(</span><span class="op" id="4489608">)</span>&nbsp;<span class="op" id="4489610">&lt;</span>&nbsp;<span class="ident" id="4489612">end</span>&nbsp;<span class="op" id="4489616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489621">j</span><span class="op" id="4489622">++</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489631">if</span>&nbsp;<span class="ident" id="4489634">i</span>&nbsp;<span class="op" id="4489636">&lt;</span>&nbsp;<span class="ident" id="4489638">j</span>&nbsp;<span class="op" id="4489640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489645">p</span><span class="op" id="4489646">.</span><span class="ident" id="4489647">comments</span>&nbsp;<span class="op" id="4489656">=</span>&nbsp;<span class="ident" id="4489658">comments</span><span class="op" id="4489666">[</span><span class="ident" id="4489667">i</span><span class="op" id="4489668">:</span><span class="ident" id="4489669">j</span><span class="op" id="4489670">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489677">}</span>&nbsp;<span class="keyword" id="4489679">else</span>&nbsp;<span class="keyword" id="4489684">if</span>&nbsp;<span class="ident" id="4489687">n</span><span class="op" id="4489688">,</span>&nbsp;<span class="ident" id="4489690">ok</span>&nbsp;<span class="op" id="4489693">:=</span>&nbsp;<span class="ident" id="4489696">node</span><span class="op" id="4489700">.</span><span class="op" id="4489701">(</span><span class="op" id="4489702">*</span><span class="ident" id="4489703">ast</span><span class="op" id="4489706">.</span><span class="ident" id="4489707">File</span><span class="op" id="4489711">)</span><span class="op" id="4489712">;</span>&nbsp;<span class="ident" id="4489714">ok</span>&nbsp;<span class="op" id="4489717">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4489721">//&nbsp;use&nbsp;ast.File&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489756">p</span><span class="op" id="4489757">.</span><span class="ident" id="4489758">comments</span>&nbsp;<span class="op" id="4489767">=</span>&nbsp;<span class="ident" id="4489769">n</span><span class="op" id="4489770">.</span><span class="ident" id="4489771">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4489785">//&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;comments,&nbsp;use&nbsp;node&nbsp;comments</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489833">p</span><span class="op" id="4489834">.</span><span class="ident" id="4489835">useNodeComments</span>&nbsp;<span class="op" id="4489851">=</span>&nbsp;<span class="ident" id="4489853">p</span><span class="op" id="4489854">.</span><span class="ident" id="4489855">comments</span>&nbsp;<span class="op" id="4489864">==</span>&nbsp;<span class="ident" id="4489867">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4489873">//&nbsp;get&nbsp;comments&nbsp;ready&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489904">p</span><span class="op" id="4489905">.</span><span class="ident" id="4489906">nextComment</span><span class="op" id="4489917">(</span><span class="op" id="4489918">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4489922">//&nbsp;format&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489938">switch</span>&nbsp;<span class="ident" id="4489945">n</span>&nbsp;<span class="op" id="4489947">:=</span>&nbsp;<span class="ident" id="4489950">node</span><span class="op" id="4489954">.</span><span class="op" id="4489955">(</span><span class="keyword" id="4489956">type</span><span class="op" id="4489960">)</span>&nbsp;<span class="op" id="4489962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489965">case</span>&nbsp;<span class="ident" id="4489970">ast</span><span class="op" id="4489973">.</span><span class="ident" id="4489974">Expr</span><span class="op" id="4489978">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489982">p</span><span class="op" id="4489983">.</span><span class="ident" id="4489984">expr</span><span class="op" id="4489988">(</span><span class="ident" id="4489989">n</span><span class="op" id="4489990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489993">case</span>&nbsp;<span class="ident" id="4489998">ast</span><span class="op" id="4490001">.</span><span class="ident" id="4490002">Stmt</span><span class="op" id="4490006">:</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4490010">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4490073">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4490132">if</span>&nbsp;<span class="ident" id="4490135">_</span><span class="op" id="4490136">,</span>&nbsp;<span class="ident" id="4490138">ok</span>&nbsp;<span class="op" id="4490141">:=</span>&nbsp;<span class="ident" id="4490144">n</span><span class="op" id="4490145">.</span><span class="op" id="4490146">(</span><span class="op" id="4490147">*</span><span class="ident" id="4490148">ast</span><span class="op" id="4490151">.</span><span class="ident" id="4490152">LabeledStmt</span><span class="op" id="4490163">)</span><span class="op" id="4490164">;</span>&nbsp;<span class="ident" id="4490166">ok</span>&nbsp;<span class="op" id="4490169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4490174">p</span><span class="op" id="4490175">.</span><span class="ident" id="4490176">indent</span>&nbsp;<span class="op" id="4490183">=</span>&nbsp;<span class="num" id="4490185">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4490189">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4490193">p</span><span class="op" id="4490194">.</span><span class="ident" id="4490195">stmt</span><span class="op" id="4490199">(</span><span class="ident" id="4490200">n</span><span class="op" id="4490201">,</span>&nbsp;<span class="builtintype" id="4490203">false</span><span class="op" id="4490208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4490211">case</span>&nbsp;<span class="ident" id="4490216">ast</span><span class="op" id="4490219">.</span><span class="ident" id="4490220">Decl</span><span class="op" id="4490224">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4490228">p</span><span class="op" id="4490229">.</span><span class="ident" id="4490230">decl</span><span class="op" id="4490234">(</span><span class="ident" id="4490235">n</span><span class="op" id="4490236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4490239">case</span>&nbsp;<span class="ident" id="4490244">ast</span><span class="op" id="4490247">.</span><span class="ident" id="4490248">Spec</span><span class="op" id="4490252">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4490256">p</span><span class="op" id="4490257">.</span><span class="ident" id="4490258">spec</span><span class="op" id="4490262">(</span><span class="ident" id="4490263">n</span><span class="op" id="4490264">,</span>&nbsp;<span class="num" id="4490266">1</span><span class="op" id="4490267">,</span>&nbsp;<span class="builtintype" id="4490269">false</span><span class="op" id="4490274">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4490277">case</span>&nbsp;<span class="op" id="4490282">[</span><span class="op" id="4490283">]</span><span class="ident" id="4490284">ast</span><span class="op" id="4490287">.</span><span class="ident" id="4490288">Stmt</span><span class="op" id="4490292">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4490296">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4490359">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4490418">for</span>&nbsp;<span class="ident" id="4490422">_</span><span class="op" id="4490423">,</span>&nbsp;<span class="ident" id="4490425">s</span>&nbsp;<span class="op" id="4490427">:=</span>&nbsp;<span class="keyword" id="4490430">range</span>&nbsp;<span class="ident" id="4490436">n</span>&nbsp;<span class="op" id="4490438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4490443">if</span>&nbsp;<span class="ident" id="4490446">_</span><span class="op" id="4490447">,</span>&nbsp;<span class="ident" id="4490449">ok</span>&nbsp;<span class="op" id="4490452">:=</span>&nbsp;<span class="ident" id="4490455">s</span><span class="op" id="4490456">.</span><span class="op" id="4490457">(</span><span class="op" id="4490458">*</span><span class="ident" id="4490459">ast</span><span class="op" id="4490462">.</span><span class="ident" id="4490463">LabeledStmt</span><span class="op" id="4490474">)</span><span class="op" id="4490475">;</span>&nbsp;<span class="ident" id="4490477">ok</span>&nbsp;<span class="op" id="4490480">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4490486">p</span><span class="op" id="4490487">.</span><span class="ident" id="4490488">indent</span>&nbsp;<span class="op" id="4490495">=</span>&nbsp;<span class="num" id="4490497">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4490502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4490506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4490510">p</span><span class="op" id="4490511">.</span><span class="ident" id="4490512">stmtList</span><span class="op" id="4490520">(</span><span class="ident" id="4490521">n</span><span class="op" id="4490522">,</span>&nbsp;<span class="num" id="4490524">0</span><span class="op" id="4490525">,</span>&nbsp;<span class="builtintype" id="4490527">false</span><span class="op" id="4490532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4490535">case</span>&nbsp;<span class="op" id="4490540">[</span><span class="op" id="4490541">]</span><span class="ident" id="4490542">ast</span><span class="op" id="4490545">.</span><span class="ident" id="4490546">Decl</span><span class="op" id="4490550">:</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4490554">p</span><span class="op" id="4490555">.</span><span class="ident" id="4490556">declList</span><span class="op" id="4490564">(</span><span class="ident" id="4490565">n</span><span class="op" id="4490566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4490569">case</span>&nbsp;<span class="op" id="4490574">*</span><span class="ident" id="4490575">ast</span><span class="op" id="4490578">.</span><span class="ident" id="4490579">File</span><span class="op" id="4490583">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4490587">p</span><span class="op" id="4490588">.</span><span class="ident" id="4490589">file</span><span class="op" id="4490593">(</span><span class="ident" id="4490594">n</span><span class="op" id="4490595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4490598">default</span><span class="op" id="4490605">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4490609">goto</span>&nbsp;<span class="ident" id="4490614">unsupported</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4490627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4490631">return</span>&nbsp;<span class="ident" id="4490638">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4490643">unsupported</span><span class="op" id="4490654">:</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4490657">return</span>&nbsp;<span class="ident" id="4490664">fmt</span><span class="op" id="4490667">.</span><span class="ident" id="4490668">Errorf</span><span class="op" id="4490674">(</span><span class="string" id="4490675">&#34;go/printer:&nbsp;unsupported&nbsp;node&nbsp;type&nbsp;%T&#34;</span><span class="op" id="4490713">,</span>&nbsp;<span class="ident" id="4490715">node</span><span class="op" id="4490719">)</span><br>
<span class="lineno"></span><span class="op" id="4490721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4490724">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4490804">//&nbsp;Trimmer</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span><span class="comment" id="4490816">//&nbsp;A&nbsp;trimmer&nbsp;is&nbsp;an&nbsp;io.Writer&nbsp;filter&nbsp;for&nbsp;stripping&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span><span class="comment" id="4490883">//&nbsp;characters,&nbsp;trailing&nbsp;blanks&nbsp;and&nbsp;tabs,&nbsp;and&nbsp;for&nbsp;converting&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="4490952">//&nbsp;and&nbsp;vtab&nbsp;characters&nbsp;into&nbsp;newlines&nbsp;and&nbsp;htabs&nbsp;(in&nbsp;case&nbsp;no&nbsp;tabwriter</span><br>
<span class="lineno"></span><span class="comment" id="4491021">//&nbsp;is&nbsp;used).&nbsp;Text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escape&nbsp;characters&nbsp;is&nbsp;passed</span><br>
<span class="lineno">1105</span><span class="comment" id="4491090">//&nbsp;through&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="comment" id="4491112">//</span><br>
<span class="lineno"></span><span class="keyword" id="4491115">type</span>&nbsp;<span class="ident" id="4491120">trimmer</span>&nbsp;<span class="keyword" id="4491128">struct</span>&nbsp;<span class="op" id="4491135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491138">output</span>&nbsp;<span class="ident" id="4491145">io</span><span class="op" id="4491147">.</span><span class="ident" id="4491148">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491156">state</span>&nbsp;&nbsp;<span class="builtintype" id="4491163">int</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491168">space</span>&nbsp;&nbsp;<span class="op" id="4491175">[</span><span class="op" id="4491176">]</span><span class="builtintype" id="4491177">byte</span><br>
<span class="lineno"></span><span class="op" id="4491182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4491185">//&nbsp;trimmer&nbsp;is&nbsp;implemented&nbsp;as&nbsp;a&nbsp;state&nbsp;machine.</span><br>
<span class="lineno"></span><span class="comment" id="4491231">//&nbsp;It&nbsp;can&nbsp;be&nbsp;in&nbsp;one&nbsp;of&nbsp;the&nbsp;following&nbsp;states:</span><br>
<span class="lineno">1115</span><span class="keyword" id="4491276">const</span>&nbsp;<span class="op" id="4491282">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491285">inSpace</span>&nbsp;&nbsp;<span class="op" id="4491294">=</span>&nbsp;<span class="ident" id="4491296">iota</span>&nbsp;<span class="comment" id="4491301">//&nbsp;inside&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491318">inEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4491334">//&nbsp;inside&nbsp;text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escapes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491381">inText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4491397">//&nbsp;inside&nbsp;text</span><br>
<span class="lineno"></span><span class="op" id="4491412">)</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span><span class="keyword" id="4491415">func</span>&nbsp;<span class="op" id="4491420">(</span><span class="ident" id="4491421">p</span>&nbsp;<span class="op" id="4491423">*</span><span class="ident" id="4491424">trimmer</span><span class="op" id="4491431">)</span>&nbsp;<span class="ident" id="4491433">resetSpace</span><span class="op" id="4491443">(</span><span class="op" id="4491444">)</span>&nbsp;<span class="op" id="4491446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491449">p</span><span class="op" id="4491450">.</span><span class="ident" id="4491451">state</span>&nbsp;<span class="op" id="4491457">=</span>&nbsp;<span class="ident" id="4491459">inSpace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491468">p</span><span class="op" id="4491469">.</span><span class="ident" id="4491470">space</span>&nbsp;<span class="op" id="4491476">=</span>&nbsp;<span class="ident" id="4491478">p</span><span class="op" id="4491479">.</span><span class="ident" id="4491480">space</span><span class="op" id="4491485">[</span><span class="num" id="4491486">0</span><span class="op" id="4491487">:</span><span class="num" id="4491488">0</span><span class="op" id="4491489">]</span><br>
<span class="lineno"></span><span class="op" id="4491491">}</span><br>
<span class="lineno">1125</span><br>
<span class="lineno"></span><span class="comment" id="4491494">//&nbsp;Design&nbsp;note:&nbsp;It&nbsp;is&nbsp;tempting&nbsp;to&nbsp;eliminate&nbsp;extra&nbsp;blanks&nbsp;occurring&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4491564">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whitespace&nbsp;in&nbsp;this&nbsp;function&nbsp;as&nbsp;it&nbsp;could&nbsp;simplify&nbsp;some</span><br>
<span class="lineno"></span><span class="comment" id="4491634">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;blanks&nbsp;logic&nbsp;in&nbsp;the&nbsp;node&nbsp;printing&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="4491702">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;However,&nbsp;this&nbsp;would&nbsp;mess&nbsp;up&nbsp;any&nbsp;formatting&nbsp;done&nbsp;by</span><br>
<span class="lineno">1130</span><span class="comment" id="4491769">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4491801">var</span>&nbsp;<span class="ident" id="4491805">aNewline</span>&nbsp;<span class="op" id="4491814">=</span>&nbsp;<span class="op" id="4491816">[</span><span class="op" id="4491817">]</span><span class="builtintype" id="4491818">byte</span><span class="op" id="4491822">(</span><span class="string" id="4491823">&#34;\n&#34;</span><span class="op" id="4491827">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4491830">func</span>&nbsp;<span class="op" id="4491835">(</span><span class="ident" id="4491836">p</span>&nbsp;<span class="op" id="4491838">*</span><span class="ident" id="4491839">trimmer</span><span class="op" id="4491846">)</span>&nbsp;<span class="ident" id="4491848">Write</span><span class="op" id="4491853">(</span><span class="ident" id="4491854">data</span>&nbsp;<span class="op" id="4491859">[</span><span class="op" id="4491860">]</span><span class="builtintype" id="4491861">byte</span><span class="op" id="4491865">)</span>&nbsp;<span class="op" id="4491867">(</span><span class="ident" id="4491868">n</span>&nbsp;<span class="builtintype" id="4491870">int</span><span class="op" id="4491873">,</span>&nbsp;<span class="ident" id="4491875">err</span>&nbsp;<span class="builtintype" id="4491879">error</span><span class="op" id="4491884">)</span>&nbsp;<span class="op" id="4491886">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4491889">//&nbsp;invariants:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4491905">//&nbsp;p.state&nbsp;==&nbsp;inSpace:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4491929">//&nbsp;&nbsp;&nbsp;&nbspp.space&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4491954">//&nbsp;p.state&nbsp;==&nbsp;inEscape,&nbsp;inText:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4491987">//&nbsp;&nbsp;&nbsp;&nbspdata[m:n]&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492014">m</span>&nbsp;<span class="op" id="4492016">:=</span>&nbsp;<span class="num" id="4492019">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492022">var</span>&nbsp;<span class="ident" id="4492026">b</span>&nbsp;<span class="builtintype" id="4492028">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492034">for</span>&nbsp;<span class="ident" id="4492038">n</span><span class="op" id="4492039">,</span>&nbsp;<span class="ident" id="4492041">b</span>&nbsp;<span class="op" id="4492043">=</span>&nbsp;<span class="keyword" id="4492045">range</span>&nbsp;<span class="ident" id="4492051">data</span>&nbsp;<span class="op" id="4492056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492060">if</span>&nbsp;<span class="ident" id="4492063">b</span>&nbsp;<span class="op" id="4492065">==</span>&nbsp;<span class="string" id="4492068">&#39;\v&#39;</span>&nbsp;<span class="op" id="4492073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492078">b</span>&nbsp;<span class="op" id="4492080">=</span>&nbsp;<span class="string" id="4492082">&#39;\t&#39;</span>&nbsp;<span class="comment" id="4492087">//&nbsp;convert&nbsp;to&nbsp;htab</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4492108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492112">switch</span>&nbsp;<span class="ident" id="4492119">p</span><span class="op" id="4492120">.</span><span class="ident" id="4492121">state</span>&nbsp;<span class="op" id="4492127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492131">case</span>&nbsp;<span class="ident" id="4492136">inSpace</span><span class="op" id="4492143">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492148">switch</span>&nbsp;<span class="ident" id="4492155">b</span>&nbsp;<span class="op" id="4492157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492162">case</span>&nbsp;<span class="string" id="4492167">&#39;\t&#39;</span><span class="op" id="4492171">,</span>&nbsp;<span class="string" id="4492173">&#39;&nbsp;&#39;</span><span class="op" id="4492176">:</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492182">p</span><span class="op" id="4492183">.</span><span class="ident" id="4492184">space</span>&nbsp;<span class="op" id="4492190">=</span>&nbsp;<span class="builtinfunc" id="4492192">append</span><span class="op" id="4492198">(</span><span class="ident" id="4492199">p</span><span class="op" id="4492200">.</span><span class="ident" id="4492201">space</span><span class="op" id="4492206">,</span>&nbsp;<span class="ident" id="4492208">b</span><span class="op" id="4492209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492214">case</span>&nbsp;<span class="string" id="4492219">&#39;\n&#39;</span><span class="op" id="4492223">,</span>&nbsp;<span class="string" id="4492225">&#39;\f&#39;</span><span class="op" id="4492229">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492235">p</span><span class="op" id="4492236">.</span><span class="ident" id="4492237">resetSpace</span><span class="op" id="4492247">(</span><span class="op" id="4492248">)</span>&nbsp;<span class="comment" id="4492250">//&nbsp;discard&nbsp;trailing&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492280">_</span><span class="op" id="4492281">,</span>&nbsp;<span class="ident" id="4492283">err</span>&nbsp;<span class="op" id="4492287">=</span>&nbsp;<span class="ident" id="4492289">p</span><span class="op" id="4492290">.</span><span class="ident" id="4492291">output</span><span class="op" id="4492297">.</span><span class="ident" id="4492298">Write</span><span class="op" id="4492303">(</span><span class="ident" id="4492304">aNewline</span><span class="op" id="4492312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492317">case</span>&nbsp;<span class="ident" id="4492322">tabwriter</span><span class="op" id="4492331">.</span><span class="ident" id="4492332">Escape</span><span class="op" id="4492338">:</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492344">_</span><span class="op" id="4492345">,</span>&nbsp;<span class="ident" id="4492347">err</span>&nbsp;<span class="op" id="4492351">=</span>&nbsp;<span class="ident" id="4492353">p</span><span class="op" id="4492354">.</span><span class="ident" id="4492355">output</span><span class="op" id="4492361">.</span><span class="ident" id="4492362">Write</span><span class="op" id="4492367">(</span><span class="ident" id="4492368">p</span><span class="op" id="4492369">.</span><span class="ident" id="4492370">space</span><span class="op" id="4492375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492381">p</span><span class="op" id="4492382">.</span><span class="ident" id="4492383">state</span>&nbsp;<span class="op" id="4492389">=</span>&nbsp;<span class="ident" id="4492391">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492404">m</span>&nbsp;<span class="op" id="4492406">=</span>&nbsp;<span class="ident" id="4492408">n</span>&nbsp;<span class="op" id="4492410">+</span>&nbsp;<span class="num" id="4492412">1</span>&nbsp;<span class="comment" id="4492414">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492446">default</span><span class="op" id="4492453">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492459">_</span><span class="op" id="4492460">,</span>&nbsp;<span class="ident" id="4492462">err</span>&nbsp;<span class="op" id="4492466">=</span>&nbsp;<span class="ident" id="4492468">p</span><span class="op" id="4492469">.</span><span class="ident" id="4492470">output</span><span class="op" id="4492476">.</span><span class="ident" id="4492477">Write</span><span class="op" id="4492482">(</span><span class="ident" id="4492483">p</span><span class="op" id="4492484">.</span><span class="ident" id="4492485">space</span><span class="op" id="4492490">)</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492496">p</span><span class="op" id="4492497">.</span><span class="ident" id="4492498">state</span>&nbsp;<span class="op" id="4492504">=</span>&nbsp;<span class="ident" id="4492506">inText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492517">m</span>&nbsp;<span class="op" id="4492519">=</span>&nbsp;<span class="ident" id="4492521">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4492526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492530">case</span>&nbsp;<span class="ident" id="4492535">inEscape</span><span class="op" id="4492543">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492548">if</span>&nbsp;<span class="ident" id="4492551">b</span>&nbsp;<span class="op" id="4492553">==</span>&nbsp;<span class="ident" id="4492556">tabwriter</span><span class="op" id="4492565">.</span><span class="ident" id="4492566">Escape</span>&nbsp;<span class="op" id="4492573">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492579">_</span><span class="op" id="4492580">,</span>&nbsp;<span class="ident" id="4492582">err</span>&nbsp;<span class="op" id="4492586">=</span>&nbsp;<span class="ident" id="4492588">p</span><span class="op" id="4492589">.</span><span class="ident" id="4492590">output</span><span class="op" id="4492596">.</span><span class="ident" id="4492597">Write</span><span class="op" id="4492602">(</span><span class="ident" id="4492603">data</span><span class="op" id="4492607">[</span><span class="ident" id="4492608">m</span><span class="op" id="4492609">:</span><span class="ident" id="4492610">n</span><span class="op" id="4492611">]</span><span class="op" id="4492612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492618">p</span><span class="op" id="4492619">.</span><span class="ident" id="4492620">resetSpace</span><span class="op" id="4492630">(</span><span class="op" id="4492631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4492636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492640">case</span>&nbsp;<span class="ident" id="4492645">inText</span><span class="op" id="4492651">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492656">switch</span>&nbsp;<span class="ident" id="4492663">b</span>&nbsp;<span class="op" id="4492665">{</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492670">case</span>&nbsp;<span class="string" id="4492675">&#39;\t&#39;</span><span class="op" id="4492679">,</span>&nbsp;<span class="string" id="4492681">&#39;&nbsp;&#39;</span><span class="op" id="4492684">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492690">_</span><span class="op" id="4492691">,</span>&nbsp;<span class="ident" id="4492693">err</span>&nbsp;<span class="op" id="4492697">=</span>&nbsp;<span class="ident" id="4492699">p</span><span class="op" id="4492700">.</span><span class="ident" id="4492701">output</span><span class="op" id="4492707">.</span><span class="ident" id="4492708">Write</span><span class="op" id="4492713">(</span><span class="ident" id="4492714">data</span><span class="op" id="4492718">[</span><span class="ident" id="4492719">m</span><span class="op" id="4492720">:</span><span class="ident" id="4492721">n</span><span class="op" id="4492722">]</span><span class="op" id="4492723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492729">p</span><span class="op" id="4492730">.</span><span class="ident" id="4492731">resetSpace</span><span class="op" id="4492741">(</span><span class="op" id="4492742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492748">p</span><span class="op" id="4492749">.</span><span class="ident" id="4492750">space</span>&nbsp;<span class="op" id="4492756">=</span>&nbsp;<span class="builtinfunc" id="4492758">append</span><span class="op" id="4492764">(</span><span class="ident" id="4492765">p</span><span class="op" id="4492766">.</span><span class="ident" id="4492767">space</span><span class="op" id="4492772">,</span>&nbsp;<span class="ident" id="4492774">b</span><span class="op" id="4492775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492780">case</span>&nbsp;<span class="string" id="4492785">&#39;\n&#39;</span><span class="op" id="4492789">,</span>&nbsp;<span class="string" id="4492791">&#39;\f&#39;</span><span class="op" id="4492795">:</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492801">_</span><span class="op" id="4492802">,</span>&nbsp;<span class="ident" id="4492804">err</span>&nbsp;<span class="op" id="4492808">=</span>&nbsp;<span class="ident" id="4492810">p</span><span class="op" id="4492811">.</span><span class="ident" id="4492812">output</span><span class="op" id="4492818">.</span><span class="ident" id="4492819">Write</span><span class="op" id="4492824">(</span><span class="ident" id="4492825">data</span><span class="op" id="4492829">[</span><span class="ident" id="4492830">m</span><span class="op" id="4492831">:</span><span class="ident" id="4492832">n</span><span class="op" id="4492833">]</span><span class="op" id="4492834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492840">p</span><span class="op" id="4492841">.</span><span class="ident" id="4492842">resetSpace</span><span class="op" id="4492852">(</span><span class="op" id="4492853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492859">_</span><span class="op" id="4492860">,</span>&nbsp;<span class="ident" id="4492862">err</span>&nbsp;<span class="op" id="4492866">=</span>&nbsp;<span class="ident" id="4492868">p</span><span class="op" id="4492869">.</span><span class="ident" id="4492870">output</span><span class="op" id="4492876">.</span><span class="ident" id="4492877">Write</span><span class="op" id="4492882">(</span><span class="ident" id="4492883">aNewline</span><span class="op" id="4492891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492896">case</span>&nbsp;<span class="ident" id="4492901">tabwriter</span><span class="op" id="4492910">.</span><span class="ident" id="4492911">Escape</span><span class="op" id="4492917">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492923">_</span><span class="op" id="4492924">,</span>&nbsp;<span class="ident" id="4492926">err</span>&nbsp;<span class="op" id="4492930">=</span>&nbsp;<span class="ident" id="4492932">p</span><span class="op" id="4492933">.</span><span class="ident" id="4492934">output</span><span class="op" id="4492940">.</span><span class="ident" id="4492941">Write</span><span class="op" id="4492946">(</span><span class="ident" id="4492947">data</span><span class="op" id="4492951">[</span><span class="ident" id="4492952">m</span><span class="op" id="4492953">:</span><span class="ident" id="4492954">n</span><span class="op" id="4492955">]</span><span class="op" id="4492956">)</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492962">p</span><span class="op" id="4492963">.</span><span class="ident" id="4492964">state</span>&nbsp;<span class="op" id="4492970">=</span>&nbsp;<span class="ident" id="4492972">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492985">m</span>&nbsp;<span class="op" id="4492987">=</span>&nbsp;<span class="ident" id="4492989">n</span>&nbsp;<span class="op" id="4492991">+</span>&nbsp;<span class="num" id="4492993">1</span>&nbsp;<span class="comment" id="4492995">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4493027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493031">default</span><span class="op" id="4493038">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4493043">panic</span><span class="op" id="4493048">(</span><span class="string" id="4493049">&#34;unreachable&#34;</span><span class="op" id="4493062">)</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4493066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493070">if</span>&nbsp;<span class="ident" id="4493073">err</span>&nbsp;<span class="op" id="4493077">!=</span>&nbsp;<span class="ident" id="4493080">nil</span>&nbsp;<span class="op" id="4493084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493089">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4493098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4493101">}</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493104">n</span>&nbsp;<span class="op" id="4493106">=</span>&nbsp;<span class="builtinfunc" id="4493108">len</span><span class="op" id="4493111">(</span><span class="ident" id="4493112">data</span><span class="op" id="4493116">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493120">switch</span>&nbsp;<span class="ident" id="4493127">p</span><span class="op" id="4493128">.</span><span class="ident" id="4493129">state</span>&nbsp;<span class="op" id="4493135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493138">case</span>&nbsp;<span class="ident" id="4493143">inEscape</span><span class="op" id="4493151">,</span>&nbsp;<span class="ident" id="4493153">inText</span><span class="op" id="4493159">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493163">_</span><span class="op" id="4493164">,</span>&nbsp;<span class="ident" id="4493166">err</span>&nbsp;<span class="op" id="4493170">=</span>&nbsp;<span class="ident" id="4493172">p</span><span class="op" id="4493173">.</span><span class="ident" id="4493174">output</span><span class="op" id="4493180">.</span><span class="ident" id="4493181">Write</span><span class="op" id="4493186">(</span><span class="ident" id="4493187">data</span><span class="op" id="4493191">[</span><span class="ident" id="4493192">m</span><span class="op" id="4493193">:</span><span class="ident" id="4493194">n</span><span class="op" id="4493195">]</span><span class="op" id="4493196">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493200">p</span><span class="op" id="4493201">.</span><span class="ident" id="4493202">resetSpace</span><span class="op" id="4493212">(</span><span class="op" id="4493213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4493216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493220">return</span><br>
<span class="lineno"></span><span class="op" id="4493227">}</span><br>
<span class="lineno">1200</span><br>
<span class="lineno"></span><span class="comment" id="4493230">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4493310">//&nbsp;Public&nbsp;interface</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4493331">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).&nbsp;They&nbsp;control&nbsp;printing.</span><br>
<span class="lineno">1205</span><span class="keyword" id="4493396">type</span>&nbsp;<span class="ident" id="4493401">Mode</span>&nbsp;<span class="builtintype" id="4493406">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4493412">const</span>&nbsp;<span class="op" id="4493418">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493421">RawFormat</span>&nbsp;<span class="ident" id="4493431">Mode</span>&nbsp;<span class="op" id="4493436">=</span>&nbsp;<span class="num" id="4493438">1</span>&nbsp;<span class="op" id="4493440">&lt;&lt;</span>&nbsp;<span class="ident" id="4493443">iota</span>&nbsp;<span class="comment" id="4493448">//&nbsp;do&nbsp;not&nbsp;use&nbsp;a&nbsp;tabwriter;&nbsp;if&nbsp;set,&nbsp;UseSpaces&nbsp;is&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493505">TabIndent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4493532">//&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;independent&nbsp;of&nbsp;UseSpaces</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493586">UseSpaces</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4493613">//&nbsp;use&nbsp;spaces&nbsp;instead&nbsp;of&nbsp;tabs&nbsp;for&nbsp;alignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493658">SourcePos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4493685">//&nbsp;emit&nbsp;//line&nbsp;comments&nbsp;to&nbsp;preserve&nbsp;original&nbsp;source&nbsp;positions</span><br>
<span class="lineno"></span><span class="op" id="4493747">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4493750">//&nbsp;A&nbsp;Config&nbsp;node&nbsp;controls&nbsp;the&nbsp;output&nbsp;of&nbsp;Fprint.</span><br>
<span class="lineno">1215</span><span class="keyword" id="4493798">type</span>&nbsp;<span class="ident" id="4493803">Config</span>&nbsp;<span class="keyword" id="4493810">struct</span>&nbsp;<span class="op" id="4493817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493820">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4493829">Mode</span>&nbsp;<span class="comment" id="4493834">//&nbsp;default:&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493849">Tabwidth</span>&nbsp;<span class="builtintype" id="4493858">int</span>&nbsp;&nbsp;<span class="comment" id="4493863">//&nbsp;default:&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493878">Indent</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4493887">int</span>&nbsp;&nbsp;<span class="comment" id="4493892">//&nbsp;default:&nbsp;0&nbsp;(all&nbsp;code&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;by&nbsp;this&nbsp;much)</span><br>
<span class="lineno"></span><span class="op" id="4493951">}</span><br>
<span class="lineno">1220</span><br>
<span class="lineno"></span><span class="comment" id="4493954">//&nbsp;fprint&nbsp;implements&nbsp;Fprint&nbsp;and&nbsp;takes&nbsp;a&nbsp;nodesSizes&nbsp;map&nbsp;for&nbsp;setting&nbsp;up&nbsp;the&nbsp;printer&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4494043">func</span>&nbsp;<span class="op" id="4494048">(</span><span class="ident" id="4494049">cfg</span>&nbsp;<span class="op" id="4494053">*</span><span class="ident" id="4494054">Config</span><span class="op" id="4494060">)</span>&nbsp;<span class="ident" id="4494062">fprint</span><span class="op" id="4494068">(</span><span class="ident" id="4494069">output</span>&nbsp;<span class="ident" id="4494076">io</span><span class="op" id="4494078">.</span><span class="ident" id="4494079">Writer</span><span class="op" id="4494085">,</span>&nbsp;<span class="ident" id="4494087">fset</span>&nbsp;<span class="op" id="4494092">*</span><span class="ident" id="4494093">token</span><span class="op" id="4494098">.</span><span class="ident" id="4494099">FileSet</span><span class="op" id="4494106">,</span>&nbsp;<span class="ident" id="4494108">node</span>&nbsp;<span class="keyword" id="4494113">interface</span><span class="op" id="4494122">{</span><span class="op" id="4494123">}</span><span class="op" id="4494124">,</span>&nbsp;<span class="ident" id="4494126">nodeSizes</span>&nbsp;<span class="keyword" id="4494136">map</span><span class="op" id="4494139">[</span><span class="ident" id="4494140">ast</span><span class="op" id="4494143">.</span><span class="ident" id="4494144">Node</span><span class="op" id="4494148">]</span><span class="builtintype" id="4494149">int</span><span class="op" id="4494152">)</span>&nbsp;<span class="op" id="4494154">(</span><span class="ident" id="4494155">err</span>&nbsp;<span class="builtintype" id="4494159">error</span><span class="op" id="4494164">)</span>&nbsp;<span class="op" id="4494166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494169">//&nbsp;print&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494184">var</span>&nbsp;<span class="ident" id="4494188">p</span>&nbsp;<span class="ident" id="4494190">printer</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4494199">p</span><span class="op" id="4494200">.</span><span class="ident" id="4494201">init</span><span class="op" id="4494205">(</span><span class="ident" id="4494206">cfg</span><span class="op" id="4494209">,</span>&nbsp;<span class="ident" id="4494211">fset</span><span class="op" id="4494215">,</span>&nbsp;<span class="ident" id="4494217">nodeSizes</span><span class="op" id="4494226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494229">if</span>&nbsp;<span class="ident" id="4494232">err</span>&nbsp;<span class="op" id="4494236">=</span>&nbsp;<span class="ident" id="4494238">p</span><span class="op" id="4494239">.</span><span class="ident" id="4494240">printNode</span><span class="op" id="4494249">(</span><span class="ident" id="4494250">node</span><span class="op" id="4494254">)</span><span class="op" id="4494255">;</span>&nbsp;<span class="ident" id="4494257">err</span>&nbsp;<span class="op" id="4494261">!=</span>&nbsp;<span class="ident" id="4494264">nil</span>&nbsp;<span class="op" id="4494268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494272">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4494280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494283">//&nbsp;print&nbsp;outstanding&nbsp;comments</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4494314">p</span><span class="op" id="4494315">.</span><span class="ident" id="4494316">impliedSemi</span>&nbsp;<span class="op" id="4494328">=</span>&nbsp;<span class="builtintype" id="4494330">false</span>&nbsp;<span class="comment" id="4494336">//&nbsp;EOF&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4494364">p</span><span class="op" id="4494365">.</span><span class="ident" id="4494366">flush</span><span class="op" id="4494371">(</span><span class="ident" id="4494372">token</span><span class="op" id="4494377">.</span><span class="ident" id="4494378">Position</span><span class="op" id="4494386">{</span><span class="ident" id="4494387">Offset</span><span class="op" id="4494393">:</span>&nbsp;<span class="ident" id="4494395">infinity</span><span class="op" id="4494403">,</span>&nbsp;<span class="ident" id="4494405">Line</span><span class="op" id="4494409">:</span>&nbsp;<span class="ident" id="4494411">infinity</span><span class="op" id="4494419">}</span><span class="op" id="4494420">,</span>&nbsp;<span class="ident" id="4494422">token</span><span class="op" id="4494427">.</span><span class="ident" id="4494428">EOF</span><span class="op" id="4494431">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494435">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;trimmer&nbsp;to&nbsp;eliminate&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494506">//&nbsp;(Input&nbsp;to&nbsp;a&nbsp;tabwriter&nbsp;must&nbsp;be&nbsp;untrimmed&nbsp;since&nbsp;trailing&nbsp;tabs&nbsp;provide</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494578">//&nbsp;formatting&nbsp;information.&nbsp;The&nbsp;tabwriter&nbsp;could&nbsp;provide&nbsp;trimming</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494643">//&nbsp;functionality&nbsp;but&nbsp;no&nbsp;tabwriter&nbsp;is&nbsp;used&nbsp;when&nbsp;RawFormat&nbsp;is&nbsp;set.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4494710">output</span>&nbsp;<span class="op" id="4494717">=</span>&nbsp;<span class="op" id="4494719">&amp;</span><span class="ident" id="4494720">trimmer</span><span class="op" id="4494727">{</span><span class="ident" id="4494728">output</span><span class="op" id="4494734">:</span>&nbsp;<span class="ident" id="4494736">output</span><span class="op" id="4494742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494746">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;tabwriter&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494799">if</span>&nbsp;<span class="ident" id="4494802">cfg</span><span class="op" id="4494805">.</span><span class="ident" id="4494806">Mode</span><span class="op" id="4494810">&amp;</span><span class="ident" id="4494811">RawFormat</span>&nbsp;<span class="op" id="4494821">==</span>&nbsp;<span class="num" id="4494824">0</span>&nbsp;<span class="op" id="4494826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4494830">minwidth</span>&nbsp;<span class="op" id="4494839">:=</span>&nbsp;<span class="ident" id="4494842">cfg</span><span class="op" id="4494845">.</span><span class="ident" id="4494846">Tabwidth</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4494858">padchar</span>&nbsp;<span class="op" id="4494866">:=</span>&nbsp;<span class="builtintype" id="4494869">byte</span><span class="op" id="4494873">(</span><span class="string" id="4494874">&#39;\t&#39;</span><span class="op" id="4494878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494882">if</span>&nbsp;<span class="ident" id="4494885">cfg</span><span class="op" id="4494888">.</span><span class="ident" id="4494889">Mode</span><span class="op" id="4494893">&amp;</span><span class="ident" id="4494894">UseSpaces</span>&nbsp;<span class="op" id="4494904">!=</span>&nbsp;<span class="num" id="4494907">0</span>&nbsp;<span class="op" id="4494909">{</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4494914">padchar</span>&nbsp;<span class="op" id="4494922">=</span>&nbsp;<span class="string" id="4494924">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4494930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4494935">twmode</span>&nbsp;<span class="op" id="4494942">:=</span>&nbsp;<span class="ident" id="4494945">tabwriter</span><span class="op" id="4494954">.</span><span class="ident" id="4494955">DiscardEmptyColumns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494977">if</span>&nbsp;<span class="ident" id="4494980">cfg</span><span class="op" id="4494983">.</span><span class="ident" id="4494984">Mode</span><span class="op" id="4494988">&amp;</span><span class="ident" id="4494989">TabIndent</span>&nbsp;<span class="op" id="4494999">!=</span>&nbsp;<span class="num" id="4495002">0</span>&nbsp;<span class="op" id="4495004">{</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4495009">minwidth</span>&nbsp;<span class="op" id="4495018">=</span>&nbsp;<span class="num" id="4495020">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4495025">twmode</span>&nbsp;<span class="op" id="4495032">|=</span>&nbsp;<span class="ident" id="4495035">tabwriter</span><span class="op" id="4495044">.</span><span class="ident" id="4495045">TabIndent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4495057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4495062">output</span>&nbsp;<span class="op" id="4495069">=</span>&nbsp;<span class="ident" id="4495071">tabwriter</span><span class="op" id="4495080">.</span><span class="ident" id="4495081">NewWriter</span><span class="op" id="4495090">(</span><span class="ident" id="4495091">output</span><span class="op" id="4495097">,</span>&nbsp;<span class="ident" id="4495099">minwidth</span><span class="op" id="4495107">,</span>&nbsp;<span class="ident" id="4495109">cfg</span><span class="op" id="4495112">.</span><span class="ident" id="4495113">Tabwidth</span><span class="op" id="4495121">,</span>&nbsp;<span class="num" id="4495123">1</span><span class="op" id="4495124">,</span>&nbsp;<span class="ident" id="4495126">padchar</span><span class="op" id="4495133">,</span>&nbsp;<span class="ident" id="4495135">twmode</span><span class="op" id="4495141">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4495144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4495148">//&nbsp;write&nbsp;printer&nbsp;result&nbsp;via&nbsp;tabwriter/trimmer&nbsp;to&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495205">if</span>&nbsp;<span class="ident" id="4495208">_</span><span class="op" id="4495209">,</span>&nbsp;<span class="ident" id="4495211">err</span>&nbsp;<span class="op" id="4495215">=</span>&nbsp;<span class="ident" id="4495217">output</span><span class="op" id="4495223">.</span><span class="ident" id="4495224">Write</span><span class="op" id="4495229">(</span><span class="ident" id="4495230">p</span><span class="op" id="4495231">.</span><span class="ident" id="4495232">output</span><span class="op" id="4495238">)</span><span class="op" id="4495239">;</span>&nbsp;<span class="ident" id="4495241">err</span>&nbsp;<span class="op" id="4495245">!=</span>&nbsp;<span class="ident" id="4495248">nil</span>&nbsp;<span class="op" id="4495252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495256">return</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4495264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4495268">//&nbsp;flush&nbsp;tabwriter,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495296">if</span>&nbsp;<span class="ident" id="4495299">tw</span><span class="op" id="4495301">,</span>&nbsp;<span class="ident" id="4495303">_</span>&nbsp;<span class="op" id="4495305">:=</span>&nbsp;<span class="ident" id="4495308">output</span><span class="op" id="4495314">.</span><span class="op" id="4495315">(</span><span class="op" id="4495316">*</span><span class="ident" id="4495317">tabwriter</span><span class="op" id="4495326">.</span><span class="ident" id="4495327">Writer</span><span class="op" id="4495333">)</span><span class="op" id="4495334">;</span>&nbsp;<span class="ident" id="4495336">tw</span>&nbsp;<span class="op" id="4495339">!=</span>&nbsp;<span class="ident" id="4495342">nil</span>&nbsp;<span class="op" id="4495346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4495350">err</span>&nbsp;<span class="op" id="4495354">=</span>&nbsp;<span class="ident" id="4495356">tw</span><span class="op" id="4495358">.</span><span class="ident" id="4495359">Flush</span><span class="op" id="4495364">(</span><span class="op" id="4495365">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4495368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495372">return</span><br>
<span class="lineno"></span><span class="op" id="4495379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span><span class="comment" id="4495382">//&nbsp;A&nbsp;CommentedNode&nbsp;bundles&nbsp;an&nbsp;AST&nbsp;node&nbsp;and&nbsp;corresponding&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="4495449">//&nbsp;It&nbsp;may&nbsp;be&nbsp;provided&nbsp;as&nbsp;argument&nbsp;to&nbsp;any&nbsp;of&nbsp;the&nbsp;Fprint&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="4495515">//</span><br>
<span class="lineno"></span><span class="keyword" id="4495518">type</span>&nbsp;<span class="ident" id="4495523">CommentedNode</span>&nbsp;<span class="keyword" id="4495537">struct</span>&nbsp;<span class="op" id="4495544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4495547">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4495556">interface</span><span class="op" id="4495565">{</span><span class="op" id="4495566">}</span>&nbsp;<span class="comment" id="4495568">//&nbsp;*ast.File,&nbsp;or&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4495628">Comments</span>&nbsp;<span class="op" id="4495637">[</span><span class="op" id="4495638">]</span><span class="op" id="4495639">*</span><span class="ident" id="4495640">ast</span><span class="op" id="4495643">.</span><span class="ident" id="4495644">CommentGroup</span><br>
<span class="lineno"></span><span class="op" id="4495657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4495660">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output&nbsp;for&nbsp;a&nbsp;given&nbsp;configuration&nbsp;cfg.</span><br>
<span class="lineno"></span><span class="comment" id="4495739">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;interpreted&nbsp;relative&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno">1280</span><span class="comment" id="4495809">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*CommentedNode,&nbsp;[]ast.Decl,&nbsp;[]ast.Stmt,</span><br>
<span class="lineno"></span><span class="comment" id="4495885">//&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt.</span><br>
<span class="lineno"></span><span class="comment" id="4495959">//</span><br>
<span class="lineno"></span><span class="keyword" id="4495962">func</span>&nbsp;<span class="op" id="4495967">(</span><span class="ident" id="4495968">cfg</span>&nbsp;<span class="op" id="4495972">*</span><span class="ident" id="4495973">Config</span><span class="op" id="4495979">)</span>&nbsp;<span class="ident" id="4495981">Fprint</span><span class="op" id="4495987">(</span><span class="ident" id="4495988">output</span>&nbsp;<span class="ident" id="4495995">io</span><span class="op" id="4495997">.</span><span class="ident" id="4495998">Writer</span><span class="op" id="4496004">,</span>&nbsp;<span class="ident" id="4496006">fset</span>&nbsp;<span class="op" id="4496011">*</span><span class="ident" id="4496012">token</span><span class="op" id="4496017">.</span><span class="ident" id="4496018">FileSet</span><span class="op" id="4496025">,</span>&nbsp;<span class="ident" id="4496027">node</span>&nbsp;<span class="keyword" id="4496032">interface</span><span class="op" id="4496041">{</span><span class="op" id="4496042">}</span><span class="op" id="4496043">)</span>&nbsp;<span class="builtintype" id="4496045">error</span>&nbsp;<span class="op" id="4496051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4496054">return</span>&nbsp;<span class="ident" id="4496061">cfg</span><span class="op" id="4496064">.</span><span class="ident" id="4496065">fprint</span><span class="op" id="4496071">(</span><span class="ident" id="4496072">output</span><span class="op" id="4496078">,</span>&nbsp;<span class="ident" id="4496080">fset</span><span class="op" id="4496084">,</span>&nbsp;<span class="ident" id="4496086">node</span><span class="op" id="4496090">,</span>&nbsp;<span class="builtinfunc" id="4496092">make</span><span class="op" id="4496096">(</span><span class="keyword" id="4496097">map</span><span class="op" id="4496100">[</span><span class="ident" id="4496101">ast</span><span class="op" id="4496104">.</span><span class="ident" id="4496105">Node</span><span class="op" id="4496109">]</span><span class="builtintype" id="4496110">int</span><span class="op" id="4496113">)</span><span class="op" id="4496114">)</span><br>
<span class="lineno">1285</span><span class="op" id="4496116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4496119">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="4496168">//&nbsp;It&nbsp;calls&nbsp;Config.Fprint&nbsp;with&nbsp;default&nbsp;settings.</span><br>
<span class="lineno"></span><span class="comment" id="4496217">//</span><br>
<span class="lineno">1290</span><span class="keyword" id="4496220">func</span>&nbsp;<span class="ident" id="4496225">Fprint</span><span class="op" id="4496231">(</span><span class="ident" id="4496232">output</span>&nbsp;<span class="ident" id="4496239">io</span><span class="op" id="4496241">.</span><span class="ident" id="4496242">Writer</span><span class="op" id="4496248">,</span>&nbsp;<span class="ident" id="4496250">fset</span>&nbsp;<span class="op" id="4496255">*</span><span class="ident" id="4496256">token</span><span class="op" id="4496261">.</span><span class="ident" id="4496262">FileSet</span><span class="op" id="4496269">,</span>&nbsp;<span class="ident" id="4496271">node</span>&nbsp;<span class="keyword" id="4496276">interface</span><span class="op" id="4496285">{</span><span class="op" id="4496286">}</span><span class="op" id="4496287">)</span>&nbsp;<span class="builtintype" id="4496289">error</span>&nbsp;<span class="op" id="4496295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4496298">return</span>&nbsp;<span class="op" id="4496305">(</span><span class="op" id="4496306">&amp;</span><span class="ident" id="4496307">Config</span><span class="op" id="4496313">{</span><span class="ident" id="4496314">Tabwidth</span><span class="op" id="4496322">:</span>&nbsp;<span class="num" id="4496324">8</span><span class="op" id="4496325">}</span><span class="op" id="4496326">)</span><span class="op" id="4496327">.</span><span class="ident" id="4496328">Fprint</span><span class="op" id="4496334">(</span><span class="ident" id="4496335">output</span><span class="op" id="4496341">,</span>&nbsp;<span class="ident" id="4496343">fset</span><span class="op" id="4496347">,</span>&nbsp;<span class="ident" id="4496349">node</span><span class="op" id="4496353">)</span><br>
<span class="lineno"></span><span class="op" id="4496355">}</span>
</div>
</body>
</html>
