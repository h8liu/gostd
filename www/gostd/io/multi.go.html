<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1767226">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1767281">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1767335">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1767386">package</span>&nbsp;<span class="ident" id="1767394">io</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1767398">type</span>&nbsp;<span class="ident" id="1767403">multiReader</span>&nbsp;<span class="keyword" id="1767415">struct</span>&nbsp;<span class="op" id="1767422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767425">readers</span>&nbsp;<span class="op" id="1767433">[</span><span class="op" id="1767434">]</span><span class="ident" id="1767435">Reader</span><br>
<span class="lineno"></span><span class="op" id="1767442">}</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1767445">func</span>&nbsp;<span class="op" id="1767450">(</span><span class="ident" id="1767451">mr</span>&nbsp;<span class="op" id="1767454">*</span><span class="ident" id="1767455">multiReader</span><span class="op" id="1767466">)</span>&nbsp;<span class="ident" id="1767468">Read</span><span class="op" id="1767472">(</span><span class="ident" id="1767473">p</span>&nbsp;<span class="op" id="1767475">[</span><span class="op" id="1767476">]</span><span class="builtintype" id="1767477">byte</span><span class="op" id="1767481">)</span>&nbsp;<span class="op" id="1767483">(</span><span class="ident" id="1767484">n</span>&nbsp;<span class="builtintype" id="1767486">int</span><span class="op" id="1767489">,</span>&nbsp;<span class="ident" id="1767491">err</span>&nbsp;<span class="builtintype" id="1767495">error</span><span class="op" id="1767500">)</span>&nbsp;<span class="op" id="1767502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767505">for</span>&nbsp;<span class="builtinfunc" id="1767509">len</span><span class="op" id="1767512">(</span><span class="ident" id="1767513">mr</span><span class="op" id="1767515">.</span><span class="ident" id="1767516">readers</span><span class="op" id="1767523">)</span>&nbsp;<span class="op" id="1767525">&gt;</span>&nbsp;<span class="num" id="1767527">0</span>&nbsp;<span class="op" id="1767529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767533">n</span><span class="op" id="1767534">,</span>&nbsp;<span class="ident" id="1767536">err</span>&nbsp;<span class="op" id="1767540">=</span>&nbsp;<span class="ident" id="1767542">mr</span><span class="op" id="1767544">.</span><span class="ident" id="1767545">readers</span><span class="op" id="1767552">[</span><span class="num" id="1767553">0</span><span class="op" id="1767554">]</span><span class="op" id="1767555">.</span><span class="ident" id="1767556">Read</span><span class="op" id="1767560">(</span><span class="ident" id="1767561">p</span><span class="op" id="1767562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767566">if</span>&nbsp;<span class="ident" id="1767569">n</span>&nbsp;<span class="op" id="1767571">&gt;</span>&nbsp;<span class="num" id="1767573">0</span>&nbsp;<span class="op" id="1767575">||</span>&nbsp;<span class="ident" id="1767578">err</span>&nbsp;<span class="op" id="1767582">!=</span>&nbsp;<span class="ident" id="1767585">EOF</span>&nbsp;<span class="op" id="1767589">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767594">if</span>&nbsp;<span class="ident" id="1767597">err</span>&nbsp;<span class="op" id="1767601">==</span>&nbsp;<span class="ident" id="1767604">EOF</span>&nbsp;<span class="op" id="1767608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767614">//&nbsp;Don&#39;t&nbsp;return&nbsp;EOF&nbsp;yet.&nbsp;There&nbsp;may&nbsp;be&nbsp;more&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767667">//&nbsp;in&nbsp;the&nbsp;remaining&nbsp;readers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767700">err</span>&nbsp;<span class="op" id="1767704">=</span>&nbsp;<span class="ident" id="1767706">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767713">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767718">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767731">mr</span><span class="op" id="1767733">.</span><span class="ident" id="1767734">readers</span>&nbsp;<span class="op" id="1767742">=</span>&nbsp;<span class="ident" id="1767744">mr</span><span class="op" id="1767746">.</span><span class="ident" id="1767747">readers</span><span class="op" id="1767754">[</span><span class="num" id="1767755">1</span><span class="op" id="1767756">:</span><span class="op" id="1767757">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767763">return</span>&nbsp;<span class="num" id="1767770">0</span><span class="op" id="1767771">,</span>&nbsp;<span class="ident" id="1767773">EOF</span><br>
<span class="lineno">25</span><span class="op" id="1767777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1767780">//&nbsp;MultiReader&nbsp;returns&nbsp;a&nbsp;Reader&nbsp;that&#39;s&nbsp;the&nbsp;logical&nbsp;concatenation&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1767848">//&nbsp;the&nbsp;provided&nbsp;input&nbsp;readers.&nbsp;&nbsp;They&#39;re&nbsp;read&nbsp;sequentially.&nbsp;&nbsp;Once&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="1767917">//&nbsp;inputs&nbsp;have&nbsp;returned&nbsp;EOF,&nbsp;Read&nbsp;will&nbsp;return&nbsp;EOF.&nbsp;&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;readers</span><br>
<span class="lineno">30</span><span class="comment" id="1767991">//&nbsp;return&nbsp;a&nbsp;non-nil,&nbsp;non-EOF&nbsp;error,&nbsp;Read&nbsp;will&nbsp;return&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="1768056">func</span>&nbsp;<span class="ident" id="1768061">MultiReader</span><span class="op" id="1768072">(</span><span class="ident" id="1768073">readers</span>&nbsp;<span class="op" id="1768081">...</span><span class="ident" id="1768084">Reader</span><span class="op" id="1768090">)</span>&nbsp;<span class="ident" id="1768092">Reader</span>&nbsp;<span class="op" id="1768099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768102">r</span>&nbsp;<span class="op" id="1768104">:=</span>&nbsp;<span class="builtinfunc" id="1768107">make</span><span class="op" id="1768111">(</span><span class="op" id="1768112">[</span><span class="op" id="1768113">]</span><span class="ident" id="1768114">Reader</span><span class="op" id="1768120">,</span>&nbsp;<span class="builtinfunc" id="1768122">len</span><span class="op" id="1768125">(</span><span class="ident" id="1768126">readers</span><span class="op" id="1768133">)</span><span class="op" id="1768134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1768137">copy</span><span class="op" id="1768141">(</span><span class="ident" id="1768142">r</span><span class="op" id="1768143">,</span>&nbsp;<span class="ident" id="1768145">readers</span><span class="op" id="1768152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768155">return</span>&nbsp;<span class="op" id="1768162">&amp;</span><span class="ident" id="1768163">multiReader</span><span class="op" id="1768174">{</span><span class="ident" id="1768175">r</span><span class="op" id="1768176">}</span><br>
<span class="lineno">35</span><span class="op" id="1768178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1768181">type</span>&nbsp;<span class="ident" id="1768186">multiWriter</span>&nbsp;<span class="keyword" id="1768198">struct</span>&nbsp;<span class="op" id="1768205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768208">writers</span>&nbsp;<span class="op" id="1768216">[</span><span class="op" id="1768217">]</span><span class="ident" id="1768218">Writer</span><br>
<span class="lineno"></span><span class="op" id="1768225">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1768228">func</span>&nbsp;<span class="op" id="1768233">(</span><span class="ident" id="1768234">t</span>&nbsp;<span class="op" id="1768236">*</span><span class="ident" id="1768237">multiWriter</span><span class="op" id="1768248">)</span>&nbsp;<span class="ident" id="1768250">Write</span><span class="op" id="1768255">(</span><span class="ident" id="1768256">p</span>&nbsp;<span class="op" id="1768258">[</span><span class="op" id="1768259">]</span><span class="builtintype" id="1768260">byte</span><span class="op" id="1768264">)</span>&nbsp;<span class="op" id="1768266">(</span><span class="ident" id="1768267">n</span>&nbsp;<span class="builtintype" id="1768269">int</span><span class="op" id="1768272">,</span>&nbsp;<span class="ident" id="1768274">err</span>&nbsp;<span class="builtintype" id="1768278">error</span><span class="op" id="1768283">)</span>&nbsp;<span class="op" id="1768285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768288">for</span>&nbsp;<span class="ident" id="1768292">_</span><span class="op" id="1768293">,</span>&nbsp;<span class="ident" id="1768295">w</span>&nbsp;<span class="op" id="1768297">:=</span>&nbsp;<span class="keyword" id="1768300">range</span>&nbsp;<span class="ident" id="1768306">t</span><span class="op" id="1768307">.</span><span class="ident" id="1768308">writers</span>&nbsp;<span class="op" id="1768316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768320">n</span><span class="op" id="1768321">,</span>&nbsp;<span class="ident" id="1768323">err</span>&nbsp;<span class="op" id="1768327">=</span>&nbsp;<span class="ident" id="1768329">w</span><span class="op" id="1768330">.</span><span class="ident" id="1768331">Write</span><span class="op" id="1768336">(</span><span class="ident" id="1768337">p</span><span class="op" id="1768338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768342">if</span>&nbsp;<span class="ident" id="1768345">err</span>&nbsp;<span class="op" id="1768349">!=</span>&nbsp;<span class="ident" id="1768352">nil</span>&nbsp;<span class="op" id="1768356">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768361">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768374">if</span>&nbsp;<span class="ident" id="1768377">n</span>&nbsp;<span class="op" id="1768379">!=</span>&nbsp;<span class="builtinfunc" id="1768382">len</span><span class="op" id="1768385">(</span><span class="ident" id="1768386">p</span><span class="op" id="1768387">)</span>&nbsp;<span class="op" id="1768389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768394">err</span>&nbsp;<span class="op" id="1768398">=</span>&nbsp;<span class="ident" id="1768400">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768417">return</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768432">return</span>&nbsp;<span class="builtinfunc" id="1768439">len</span><span class="op" id="1768442">(</span><span class="ident" id="1768443">p</span><span class="op" id="1768444">)</span><span class="op" id="1768445">,</span>&nbsp;<span class="ident" id="1768447">nil</span><br>
<span class="lineno"></span><span class="op" id="1768451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1768454">//&nbsp;MultiWriter&nbsp;creates&nbsp;a&nbsp;writer&nbsp;that&nbsp;duplicates&nbsp;its&nbsp;writes&nbsp;to&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1768524">//&nbsp;provided&nbsp;writers,&nbsp;similar&nbsp;to&nbsp;the&nbsp;Unix&nbsp;tee(1)&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="1768581">func</span>&nbsp;<span class="ident" id="1768586">MultiWriter</span><span class="op" id="1768597">(</span><span class="ident" id="1768598">writers</span>&nbsp;<span class="op" id="1768606">...</span><span class="ident" id="1768609">Writer</span><span class="op" id="1768615">)</span>&nbsp;<span class="ident" id="1768617">Writer</span>&nbsp;<span class="op" id="1768624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768627">w</span>&nbsp;<span class="op" id="1768629">:=</span>&nbsp;<span class="builtinfunc" id="1768632">make</span><span class="op" id="1768636">(</span><span class="op" id="1768637">[</span><span class="op" id="1768638">]</span><span class="ident" id="1768639">Writer</span><span class="op" id="1768645">,</span>&nbsp;<span class="builtinfunc" id="1768647">len</span><span class="op" id="1768650">(</span><span class="ident" id="1768651">writers</span><span class="op" id="1768658">)</span><span class="op" id="1768659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1768662">copy</span><span class="op" id="1768666">(</span><span class="ident" id="1768667">w</span><span class="op" id="1768668">,</span>&nbsp;<span class="ident" id="1768670">writers</span><span class="op" id="1768677">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768680">return</span>&nbsp;<span class="op" id="1768687">&amp;</span><span class="ident" id="1768688">multiWriter</span><span class="op" id="1768699">{</span><span class="ident" id="1768700">w</span><span class="op" id="1768701">}</span><br>
<span class="lineno"></span><span class="op" id="1768703">}</span>
</div>
</body>
</html>
