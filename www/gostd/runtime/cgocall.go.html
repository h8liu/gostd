<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html" class="current">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1478547">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1478603">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1478657">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1478708">//&nbsp;Cgo&nbsp;call&nbsp;and&nbsp;callback&nbsp;support.</span><br>
<span class="lineno"></span><span class="comment" id="1478742">//</span><br>
<span class="lineno"></span><span class="comment" id="1478745">//&nbsp;To&nbsp;call&nbsp;into&nbsp;the&nbsp;C&nbsp;function&nbsp;f&nbsp;from&nbsp;Go,&nbsp;the&nbsp;cgo-generated&nbsp;code&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1478816">//&nbsp;runtime.cgocall(_cgo_Cfunc_f,&nbsp;frame),&nbsp;where&nbsp;_cgo_Cfunc_f&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1478881">//&nbsp;gcc-compiled&nbsp;function&nbsp;written&nbsp;by&nbsp;cgo.</span><br>
<span class="lineno">10</span><span class="comment" id="1478922">//</span><br>
<span class="lineno"></span><span class="comment" id="1478925">//&nbsp;runtime.cgocall&nbsp;(below)&nbsp;locks&nbsp;g&nbsp;to&nbsp;m,&nbsp;calls&nbsp;entersyscall</span><br>
<span class="lineno"></span><span class="comment" id="1478985">//&nbsp;so&nbsp;as&nbsp;not&nbsp;to&nbsp;block&nbsp;other&nbsp;goroutines&nbsp;or&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span><span class="comment" id="1479050">//&nbsp;and&nbsp;then&nbsp;calls&nbsp;runtime.asmcgocall(_cgo_Cfunc_f,&nbsp;frame).</span><br>
<span class="lineno"></span><span class="comment" id="1479109">//</span><br>
<span class="lineno">15</span><span class="comment" id="1479112">//&nbsp;runtime.asmcgocall&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;to&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1479181">//&nbsp;(assumed&nbsp;to&nbsp;be&nbsp;an&nbsp;operating&nbsp;system-allocated&nbsp;stack,&nbsp;so&nbsp;safe&nbsp;to&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="1479251">//&nbsp;gcc-compiled&nbsp;code&nbsp;on)&nbsp;and&nbsp;calls&nbsp;_cgo_Cfunc_f(frame).</span><br>
<span class="lineno"></span><span class="comment" id="1479307">//</span><br>
<span class="lineno"></span><span class="comment" id="1479310">//&nbsp;_cgo_Cfunc_f&nbsp;invokes&nbsp;the&nbsp;actual&nbsp;C&nbsp;function&nbsp;f&nbsp;with&nbsp;arguments</span><br>
<span class="lineno">20</span><span class="comment" id="1479373">//&nbsp;taken&nbsp;from&nbsp;the&nbsp;frame&nbsp;structure,&nbsp;records&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;frame,</span><br>
<span class="lineno"></span><span class="comment" id="1479442">//&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.asmcgocall.</span><br>
<span class="lineno"></span><span class="comment" id="1479480">//</span><br>
<span class="lineno"></span><span class="comment" id="1479483">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.asmcgocall&nbsp;switches&nbsp;back&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1479552">//&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocall.</span><br>
<span class="lineno">25</span><span class="comment" id="1479616">//</span><br>
<span class="lineno"></span><span class="comment" id="1479619">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocall&nbsp;calls&nbsp;exitsyscall,&nbsp;which&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="1479696">//&nbsp;until&nbsp;this&nbsp;m&nbsp;can&nbsp;run&nbsp;Go&nbsp;code&nbsp;without&nbsp;violating&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit,</span><br>
<span class="lineno"></span><span class="comment" id="1479769">//&nbsp;and&nbsp;then&nbsp;unlocks&nbsp;g&nbsp;from&nbsp;m.</span><br>
<span class="lineno"></span><span class="comment" id="1479799">//</span><br>
<span class="lineno">30</span><span class="comment" id="1479802">//&nbsp;The&nbsp;above&nbsp;description&nbsp;skipped&nbsp;over&nbsp;the&nbsp;possibility&nbsp;of&nbsp;the&nbsp;gcc-compiled</span><br>
<span class="lineno"></span><span class="comment" id="1479876">//&nbsp;function&nbsp;f&nbsp;calling&nbsp;back&nbsp;into&nbsp;Go.&nbsp;&nbsp;If&nbsp;that&nbsp;happens,&nbsp;we&nbsp;continue&nbsp;down</span><br>
<span class="lineno"></span><span class="comment" id="1479947">//&nbsp;the&nbsp;rabbit&nbsp;hole&nbsp;during&nbsp;the&nbsp;execution&nbsp;of&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="1479993">//</span><br>
<span class="lineno"></span><span class="comment" id="1479996">//&nbsp;To&nbsp;make&nbsp;it&nbsp;possible&nbsp;for&nbsp;gcc-compiled&nbsp;C&nbsp;code&nbsp;to&nbsp;call&nbsp;a&nbsp;Go&nbsp;function&nbsp;p.GoF,</span><br>
<span class="lineno">35</span><span class="comment" id="1480072">//&nbsp;cgo&nbsp;writes&nbsp;a&nbsp;gcc-compiled&nbsp;function&nbsp;named&nbsp;GoF&nbsp;(not&nbsp;p.GoF,&nbsp;since&nbsp;gcc&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="1480150">//&nbsp;know&nbsp;about&nbsp;packages).&nbsp;&nbsp;The&nbsp;gcc-compiled&nbsp;C&nbsp;function&nbsp;f&nbsp;calls&nbsp;GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1480217">//</span><br>
<span class="lineno"></span><span class="comment" id="1480220">//&nbsp;GoF&nbsp;calls&nbsp;crosscall2(_cgoexp_GoF,&nbsp;frame,&nbsp;framesize).&nbsp;&nbsp;Crosscall2</span><br>
<span class="lineno"></span><span class="comment" id="1480288">//&nbsp;(in&nbsp;cgo/gcc_$GOARCH.S,&nbsp;a&nbsp;gcc-compiled&nbsp;assembly&nbsp;file)&nbsp;is&nbsp;a&nbsp;two-argument</span><br>
<span class="lineno">40</span><span class="comment" id="1480362">//&nbsp;adapter&nbsp;from&nbsp;the&nbsp;gcc&nbsp;function&nbsp;call&nbsp;ABI&nbsp;to&nbsp;the&nbsp;6c&nbsp;function&nbsp;call&nbsp;ABI.</span><br>
<span class="lineno"></span><span class="comment" id="1480433">//&nbsp;It&nbsp;is&nbsp;called&nbsp;from&nbsp;gcc&nbsp;to&nbsp;call&nbsp;6c&nbsp;functions.&nbsp;&nbsp;In&nbsp;this&nbsp;case&nbsp;it&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1480503">//&nbsp;_cgoexp_GoF(frame,&nbsp;framesize),&nbsp;still&nbsp;running&nbsp;on&nbsp;m-&gt;g0&#39;s&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1480568">//&nbsp;and&nbsp;outside&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit.&nbsp;&nbsp;Thus,&nbsp;this&nbsp;code&nbsp;cannot&nbsp;yet</span><br>
<span class="lineno"></span><span class="comment" id="1480634">//&nbsp;call&nbsp;arbitrary&nbsp;Go&nbsp;code&nbsp;directly&nbsp;and&nbsp;must&nbsp;be&nbsp;careful&nbsp;not&nbsp;to&nbsp;allocate</span><br>
<span class="lineno">45</span><span class="comment" id="1480705">//&nbsp;memory&nbsp;or&nbsp;use&nbsp;up&nbsp;m-&gt;g0&#39;s&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="1480740">//</span><br>
<span class="lineno"></span><span class="comment" id="1480743">//&nbsp;_cgoexp_GoF&nbsp;calls&nbsp;runtime.cgocallback(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1480810">//&nbsp;(The&nbsp;reason&nbsp;for&nbsp;having&nbsp;_cgoexp_GoF&nbsp;instead&nbsp;of&nbsp;writing&nbsp;a&nbsp;crosscall3</span><br>
<span class="lineno"></span><span class="comment" id="1480880">//&nbsp;to&nbsp;make&nbsp;this&nbsp;call&nbsp;directly&nbsp;is&nbsp;that&nbsp;_cgoexp_GoF,&nbsp;because&nbsp;it&nbsp;is&nbsp;compiled</span><br>
<span class="lineno">50</span><span class="comment" id="1480954">//&nbsp;with&nbsp;6c&nbsp;instead&nbsp;of&nbsp;gcc,&nbsp;can&nbsp;refer&nbsp;to&nbsp;dotted&nbsp;names&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="1481012">//&nbsp;runtime.cgocallback&nbsp;and&nbsp;p.GoF.)</span><br>
<span class="lineno"></span><span class="comment" id="1481047">//</span><br>
<span class="lineno"></span><span class="comment" id="1481050">//&nbsp;runtime.cgocallback&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;from&nbsp;m-&gt;g0&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1481114">//&nbsp;stack&nbsp;to&nbsp;the&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack,&nbsp;on&nbsp;which&nbsp;it&nbsp;calls</span><br>
<span class="lineno">55</span><span class="comment" id="1481178">//&nbsp;runtime.cgocallbackg(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1481228">//&nbsp;As&nbsp;part&nbsp;of&nbsp;the&nbsp;stack&nbsp;switch,&nbsp;runtime.cgocallback&nbsp;saves&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="1481298">//&nbsp;SP&nbsp;as&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;so&nbsp;that&nbsp;any&nbsp;use&nbsp;of&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1481368">//&nbsp;execution&nbsp;of&nbsp;the&nbsp;callback&nbsp;will&nbsp;be&nbsp;done&nbsp;below&nbsp;the&nbsp;existing&nbsp;stack&nbsp;frames.</span><br>
<span class="lineno"></span><span class="comment" id="1481443">//&nbsp;Before&nbsp;overwriting&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;it&nbsp;pushes&nbsp;the&nbsp;old&nbsp;value&nbsp;on&nbsp;the</span><br>
<span class="lineno">60</span><span class="comment" id="1481513">//&nbsp;m-&gt;g0&nbsp;stack,&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;restored&nbsp;later.</span><br>
<span class="lineno"></span><span class="comment" id="1481563">//</span><br>
<span class="lineno"></span><span class="comment" id="1481566">//&nbsp;runtime.cgocallbackg&nbsp;(below)&nbsp;is&nbsp;now&nbsp;running&nbsp;on&nbsp;a&nbsp;real&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1481633">//&nbsp;stack&nbsp;(not&nbsp;an&nbsp;m-&gt;g0&nbsp;stack).&nbsp;&nbsp;First&nbsp;it&nbsp;calls&nbsp;runtime.exitsyscall,&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="1481712">//&nbsp;block&nbsp;until&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit&nbsp;allows&nbsp;running&nbsp;this&nbsp;goroutine.</span><br>
<span class="lineno">65</span><span class="comment" id="1481780">//&nbsp;Once&nbsp;exitsyscall&nbsp;has&nbsp;returned,&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;do&nbsp;things&nbsp;like&nbsp;call&nbsp;the&nbsp;memory</span><br>
<span class="lineno"></span><span class="comment" id="1481859">//&nbsp;allocator&nbsp;or&nbsp;invoke&nbsp;the&nbsp;Go&nbsp;callback&nbsp;function&nbsp;p.GoF.&nbsp;&nbsp;runtime.cgocallbackg</span><br>
<span class="lineno"></span><span class="comment" id="1481936">//&nbsp;first&nbsp;defers&nbsp;a&nbsp;function&nbsp;to&nbsp;unwind&nbsp;m-&gt;g0.sched.sp,&nbsp;so&nbsp;that&nbsp;if&nbsp;p.GoF</span><br>
<span class="lineno"></span><span class="comment" id="1482006">//&nbsp;panics,&nbsp;m-&gt;g0.sched.sp&nbsp;will&nbsp;be&nbsp;restored&nbsp;to&nbsp;its&nbsp;old&nbsp;value:&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1482083">//&nbsp;and&nbsp;the&nbsp;m-&gt;curg&nbsp;stack&nbsp;will&nbsp;be&nbsp;unwound&nbsp;in&nbsp;lock&nbsp;step.</span><br>
<span class="lineno">70</span><span class="comment" id="1482138">//&nbsp;Then&nbsp;it&nbsp;calls&nbsp;p.GoF.&nbsp;&nbsp;Finally&nbsp;it&nbsp;pops&nbsp;but&nbsp;does&nbsp;not&nbsp;execute&nbsp;the&nbsp;deferred</span><br>
<span class="lineno"></span><span class="comment" id="1482213">//&nbsp;function,&nbsp;calls&nbsp;runtime.entersyscall,&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocallback.</span><br>
<span class="lineno"></span><span class="comment" id="1482290">//</span><br>
<span class="lineno"></span><span class="comment" id="1482293">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocallback&nbsp;switches&nbsp;back&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1482359">//&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;(the&nbsp;pointer&nbsp;is&nbsp;still&nbsp;in&nbsp;m-&gt;g0.sched.sp),&nbsp;restores&nbsp;the&nbsp;old</span><br>
<span class="lineno">75</span><span class="comment" id="1482435">//&nbsp;m-&gt;g0.sched.sp&nbsp;value&nbsp;from&nbsp;the&nbsp;stack,&nbsp;and&nbsp;returns&nbsp;to&nbsp;_cgoexp_GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1482503">//</span><br>
<span class="lineno"></span><span class="comment" id="1482506">//&nbsp;_cgoexp_GoF&nbsp;immediately&nbsp;returns&nbsp;to&nbsp;crosscall2,&nbsp;which&nbsp;restores&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1482575">//&nbsp;callee-save&nbsp;registers&nbsp;for&nbsp;gcc&nbsp;and&nbsp;returns&nbsp;to&nbsp;GoF,&nbsp;which&nbsp;returns&nbsp;to&nbsp;f.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="1482649">package</span>&nbsp;<span class="ident" id="1482657">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1482666">import</span>&nbsp;<span class="string" id="1482673">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1482683">//&nbsp;Call&nbsp;from&nbsp;Go&nbsp;to&nbsp;C.</span><br>
<span class="lineno">85</span><span class="comment" id="1482705">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1482718">func</span>&nbsp;<span class="ident" id="1482723">cgocall</span><span class="op" id="1482730">(</span><span class="ident" id="1482731">fn</span><span class="op" id="1482733">,</span>&nbsp;<span class="ident" id="1482735">arg</span>&nbsp;<span class="ident" id="1482739">unsafe</span><span class="op" id="1482745">.</span><span class="ident" id="1482746">Pointer</span><span class="op" id="1482753">)</span>&nbsp;<span class="op" id="1482755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1482758">cgocall_errno</span><span class="op" id="1482771">(</span><span class="ident" id="1482772">fn</span><span class="op" id="1482774">,</span>&nbsp;<span class="ident" id="1482776">arg</span><span class="op" id="1482779">)</span><br>
<span class="lineno"></span><span class="op" id="1482781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="1482784">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1482797">func</span>&nbsp;<span class="ident" id="1482802">cgocall_errno</span><span class="op" id="1482815">(</span><span class="ident" id="1482816">fn</span><span class="op" id="1482818">,</span>&nbsp;<span class="ident" id="1482820">arg</span>&nbsp;<span class="ident" id="1482824">unsafe</span><span class="op" id="1482830">.</span><span class="ident" id="1482831">Pointer</span><span class="op" id="1482838">)</span>&nbsp;<span class="builtintype" id="1482840">int32</span>&nbsp;<span class="op" id="1482846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1482849">if</span>&nbsp;<span class="op" id="1482852">!</span><span class="ident" id="1482853">iscgo</span>&nbsp;<span class="op" id="1482859">&amp;&amp;</span>&nbsp;<span class="ident" id="1482862">GOOS</span>&nbsp;<span class="op" id="1482867">!=</span>&nbsp;<span class="string" id="1482870">&#34;solaris&#34;</span>&nbsp;<span class="op" id="1482880">&amp;&amp;</span>&nbsp;<span class="ident" id="1482883">GOOS</span>&nbsp;<span class="op" id="1482888">!=</span>&nbsp;<span class="string" id="1482891">&#34;windows&#34;</span>&nbsp;<span class="op" id="1482901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1482905">gothrow</span><span class="op" id="1482912">(</span><span class="string" id="1482913">&#34;cgocall&nbsp;unavailable&#34;</span><span class="op" id="1482934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1482937">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1482941">if</span>&nbsp;<span class="ident" id="1482944">fn</span>&nbsp;<span class="op" id="1482947">==</span>&nbsp;<span class="ident" id="1482950">nil</span>&nbsp;<span class="op" id="1482954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1482958">gothrow</span><span class="op" id="1482965">(</span><span class="string" id="1482966">&#34;cgocall&nbsp;nil&#34;</span><span class="op" id="1482979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1482982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1482986">if</span>&nbsp;<span class="ident" id="1482989">raceenabled</span>&nbsp;<span class="op" id="1483001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1483005">racereleasemerge</span><span class="op" id="1483021">(</span><span class="ident" id="1483022">unsafe</span><span class="op" id="1483028">.</span><span class="ident" id="1483029">Pointer</span><span class="op" id="1483036">(</span><span class="op" id="1483037">&amp;</span><span class="ident" id="1483038">racecgosync</span><span class="op" id="1483049">)</span><span class="op" id="1483050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1483053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1483057">//&nbsp;Create&nbsp;an&nbsp;extra&nbsp;M&nbsp;for&nbsp;callbacks&nbsp;on&nbsp;threads&nbsp;not&nbsp;created&nbsp;by&nbsp;Go&nbsp;on&nbsp;first&nbsp;cgo&nbsp;call.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1483141">if</span>&nbsp;<span class="ident" id="1483144">needextram</span>&nbsp;<span class="op" id="1483155">==</span>&nbsp;<span class="num" id="1483158">1</span>&nbsp;<span class="op" id="1483160">&amp;&amp;</span>&nbsp;<span class="ident" id="1483163">cas</span><span class="op" id="1483166">(</span><span class="op" id="1483167">&amp;</span><span class="ident" id="1483168">needextram</span><span class="op" id="1483178">,</span>&nbsp;<span class="num" id="1483180">1</span><span class="op" id="1483181">,</span>&nbsp;<span class="num" id="1483183">0</span><span class="op" id="1483184">)</span>&nbsp;<span class="op" id="1483186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1483190">onM</span><span class="op" id="1483193">(</span><span class="ident" id="1483194">newextram</span><span class="op" id="1483203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1483206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1483210">/*<br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Lock&nbsp;g&nbsp;to&nbsp;m&nbsp;to&nbsp;ensure&nbsp;we&nbsp;stay&nbsp;on&nbsp;the&nbsp;same&nbsp;stack&nbsp;if&nbsp;we&nbsp;do&nbsp;a<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;cgo&nbsp;callback.&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1483343">lockOSThread</span><span class="op" id="1483355">(</span><span class="op" id="1483356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1483359">mp</span>&nbsp;<span class="op" id="1483362">:=</span>&nbsp;<span class="ident" id="1483365">getg</span><span class="op" id="1483369">(</span><span class="op" id="1483370">)</span><span class="op" id="1483371">.</span><span class="ident" id="1483372">m</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1483375">mp</span><span class="op" id="1483377">.</span><span class="ident" id="1483378">ncgocall</span><span class="op" id="1483386">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1483390">mp</span><span class="op" id="1483392">.</span><span class="ident" id="1483393">ncgo</span><span class="op" id="1483397">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1483401">defer</span>&nbsp;<span class="ident" id="1483407">endcgo</span><span class="op" id="1483413">(</span><span class="ident" id="1483414">mp</span><span class="op" id="1483416">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1483420">/*<br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Announce&nbsp;we&nbsp;are&nbsp;entering&nbsp;a&nbsp;system&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;so&nbsp;that&nbsp;the&nbsp;scheduler&nbsp;knows&nbsp;to&nbsp;create&nbsp;another<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;M&nbsp;to&nbsp;run&nbsp;goroutines&nbsp;while&nbsp;we&nbsp;are&nbsp;in&nbsp;the<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;foreign&nbsp;code.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;The&nbsp;call&nbsp;to&nbsp;asmcgocall&nbsp;is&nbsp;guaranteed&nbsp;not&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;split&nbsp;the&nbsp;stack&nbsp;and&nbsp;does&nbsp;not&nbsp;allocate&nbsp;memory,<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;so&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;while&nbsp;&#34;in&nbsp;a&nbsp;system&nbsp;call&#34;,&nbsp;outside<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;the&nbsp;$GOMAXPROCS&nbsp;accounting.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1483778">entersyscall</span><span class="op" id="1483790">(</span><span class="op" id="1483791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1483794">errno</span>&nbsp;<span class="op" id="1483800">:=</span>&nbsp;<span class="ident" id="1483803">asmcgocall_errno</span><span class="op" id="1483819">(</span><span class="ident" id="1483820">fn</span><span class="op" id="1483822">,</span>&nbsp;<span class="ident" id="1483824">arg</span><span class="op" id="1483827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1483830">exitsyscall</span><span class="op" id="1483841">(</span><span class="op" id="1483842">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1483846">return</span>&nbsp;<span class="ident" id="1483853">errno</span><br>
<span class="lineno">135</span><span class="op" id="1483859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1483862">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1483875">func</span>&nbsp;<span class="ident" id="1483880">endcgo</span><span class="op" id="1483886">(</span><span class="ident" id="1483887">mp</span>&nbsp;<span class="op" id="1483890">*</span><span class="ident" id="1483891">m</span><span class="op" id="1483892">)</span>&nbsp;<span class="op" id="1483894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1483897">mp</span><span class="op" id="1483899">.</span><span class="ident" id="1483900">ncgo</span><span class="op" id="1483904">--</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1483908">if</span>&nbsp;<span class="ident" id="1483911">mp</span><span class="op" id="1483913">.</span><span class="ident" id="1483914">ncgo</span>&nbsp;<span class="op" id="1483919">==</span>&nbsp;<span class="num" id="1483922">0</span>&nbsp;<span class="op" id="1483924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1483928">//&nbsp;We&nbsp;are&nbsp;going&nbsp;back&nbsp;to&nbsp;Go&nbsp;and&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;recursive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1483984">//&nbsp;call.&nbsp;&nbsp;Let&nbsp;the&nbsp;GC&nbsp;collect&nbsp;any&nbsp;memory&nbsp;allocated&nbsp;via</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1484040">//&nbsp;_cgo_allocate&nbsp;that&nbsp;is&nbsp;no&nbsp;longer&nbsp;referenced.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484089">mp</span><span class="op" id="1484091">.</span><span class="ident" id="1484092">cgomal</span>&nbsp;<span class="op" id="1484099">=</span>&nbsp;<span class="ident" id="1484101">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1484106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1484110">if</span>&nbsp;<span class="ident" id="1484113">raceenabled</span>&nbsp;<span class="op" id="1484125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484129">raceacquire</span><span class="op" id="1484140">(</span><span class="ident" id="1484141">unsafe</span><span class="op" id="1484147">.</span><span class="ident" id="1484148">Pointer</span><span class="op" id="1484155">(</span><span class="op" id="1484156">&amp;</span><span class="ident" id="1484157">racecgosync</span><span class="op" id="1484168">)</span><span class="op" id="1484169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1484172">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484176">unlockOSThread</span><span class="op" id="1484190">(</span><span class="op" id="1484191">)</span>&nbsp;<span class="comment" id="1484193">//&nbsp;invalidates&nbsp;mp</span><br>
<span class="lineno"></span><span class="op" id="1484211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1484214">//&nbsp;Helper&nbsp;functions&nbsp;for&nbsp;cgo&nbsp;code.</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="1484249">//&nbsp;Filled&nbsp;by&nbsp;schedinit&nbsp;from&nbsp;corresponding&nbsp;C&nbsp;variables,</span><br>
<span class="lineno"></span><span class="comment" id="1484304">//&nbsp;which&nbsp;are&nbsp;in&nbsp;turn&nbsp;filled&nbsp;in&nbsp;by&nbsp;dynamic&nbsp;linker&nbsp;when&nbsp;Cgo&nbsp;is&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="1484376">var</span>&nbsp;<span class="ident" id="1484380">cgoMalloc</span><span class="op" id="1484389">,</span>&nbsp;<span class="ident" id="1484391">cgoFree</span>&nbsp;<span class="ident" id="1484399">unsafe</span><span class="op" id="1484405">.</span><span class="ident" id="1484406">Pointer</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="keyword" id="1484415">func</span>&nbsp;<span class="ident" id="1484420">cmalloc</span><span class="op" id="1484427">(</span><span class="ident" id="1484428">n</span>&nbsp;<span class="builtintype" id="1484430">uintptr</span><span class="op" id="1484437">)</span>&nbsp;<span class="ident" id="1484439">unsafe</span><span class="op" id="1484445">.</span><span class="ident" id="1484446">Pointer</span>&nbsp;<span class="op" id="1484454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1484457">var</span>&nbsp;<span class="ident" id="1484461">args</span>&nbsp;<span class="keyword" id="1484466">struct</span>&nbsp;<span class="op" id="1484473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484477">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1484481">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484490">ret</span>&nbsp;<span class="ident" id="1484494">unsafe</span><span class="op" id="1484500">.</span><span class="ident" id="1484501">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1484510">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484513">args</span><span class="op" id="1484517">.</span><span class="ident" id="1484518">n</span>&nbsp;<span class="op" id="1484520">=</span>&nbsp;<span class="ident" id="1484522">uint64</span><span class="op" id="1484528">(</span><span class="ident" id="1484529">n</span><span class="op" id="1484530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484533">cgocall</span><span class="op" id="1484540">(</span><span class="ident" id="1484541">cgoMalloc</span><span class="op" id="1484550">,</span>&nbsp;<span class="ident" id="1484552">unsafe</span><span class="op" id="1484558">.</span><span class="ident" id="1484559">Pointer</span><span class="op" id="1484566">(</span><span class="op" id="1484567">&amp;</span><span class="ident" id="1484568">args</span><span class="op" id="1484572">)</span><span class="op" id="1484573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1484576">if</span>&nbsp;<span class="ident" id="1484579">args</span><span class="op" id="1484583">.</span><span class="ident" id="1484584">ret</span>&nbsp;<span class="op" id="1484588">==</span>&nbsp;<span class="ident" id="1484591">nil</span>&nbsp;<span class="op" id="1484595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484599">gothrow</span><span class="op" id="1484606">(</span><span class="string" id="1484607">&#34;C&nbsp;malloc&nbsp;failed&#34;</span><span class="op" id="1484624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1484627">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1484630">return</span>&nbsp;<span class="ident" id="1484637">args</span><span class="op" id="1484641">.</span><span class="ident" id="1484642">ret</span><br>
<span class="lineno"></span><span class="op" id="1484646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1484649">func</span>&nbsp;<span class="ident" id="1484654">cfree</span><span class="op" id="1484659">(</span><span class="ident" id="1484660">p</span>&nbsp;<span class="ident" id="1484662">unsafe</span><span class="op" id="1484668">.</span><span class="ident" id="1484669">Pointer</span><span class="op" id="1484676">)</span>&nbsp;<span class="op" id="1484678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484681">cgocall</span><span class="op" id="1484688">(</span><span class="ident" id="1484689">cgoFree</span><span class="op" id="1484696">,</span>&nbsp;<span class="ident" id="1484698">p</span><span class="op" id="1484699">)</span><br>
<span class="lineno">175</span><span class="op" id="1484701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1484704">//&nbsp;Call&nbsp;from&nbsp;C&nbsp;back&nbsp;to&nbsp;Go.</span><br>
<span class="lineno"></span><span class="comment" id="1484731">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1484744">func</span>&nbsp;<span class="ident" id="1484749">cgocallbackg</span><span class="op" id="1484761">(</span><span class="op" id="1484762">)</span>&nbsp;<span class="op" id="1484764">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484767">gp</span>&nbsp;<span class="op" id="1484770">:=</span>&nbsp;<span class="ident" id="1484773">getg</span><span class="op" id="1484777">(</span><span class="op" id="1484778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1484781">if</span>&nbsp;<span class="ident" id="1484784">gp</span>&nbsp;<span class="op" id="1484787">!=</span>&nbsp;<span class="ident" id="1484790">gp</span><span class="op" id="1484792">.</span><span class="ident" id="1484793">m</span><span class="op" id="1484794">.</span><span class="ident" id="1484795">curg</span>&nbsp;<span class="op" id="1484800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1484804">println</span><span class="op" id="1484811">(</span><span class="string" id="1484812">&#34;runtime:&nbsp;bad&nbsp;g&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1484843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484847">exit</span><span class="op" id="1484851">(</span><span class="num" id="1484852">2</span><span class="op" id="1484853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1484856">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1484860">//&nbsp;entersyscall&nbsp;saves&nbsp;the&nbsp;caller&#39;s&nbsp;SP&nbsp;to&nbsp;allow&nbsp;the&nbsp;GC&nbsp;to&nbsp;trace&nbsp;the&nbsp;Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1484931">//&nbsp;stack.&nbsp;However,&nbsp;since&nbsp;we&#39;re&nbsp;returning&nbsp;to&nbsp;an&nbsp;earlier&nbsp;stack&nbsp;frame&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1485003">//&nbsp;need&nbsp;to&nbsp;pair&nbsp;with&nbsp;the&nbsp;entersyscall()&nbsp;call&nbsp;made&nbsp;by&nbsp;cgocall,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1485074">//&nbsp;save&nbsp;syscall*&nbsp;and&nbsp;let&nbsp;reentersyscall&nbsp;restore&nbsp;them.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485129">savedsp</span>&nbsp;<span class="op" id="1485137">:=</span>&nbsp;<span class="ident" id="1485140">unsafe</span><span class="op" id="1485146">.</span><span class="ident" id="1485147">Pointer</span><span class="op" id="1485154">(</span><span class="ident" id="1485155">gp</span><span class="op" id="1485157">.</span><span class="ident" id="1485158">syscallsp</span><span class="op" id="1485167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485170">savedpc</span>&nbsp;<span class="op" id="1485178">:=</span>&nbsp;<span class="ident" id="1485181">gp</span><span class="op" id="1485183">.</span><span class="ident" id="1485184">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485195">exitsyscall</span><span class="op" id="1485206">(</span><span class="op" id="1485207">)</span>&nbsp;<span class="comment" id="1485209">//&nbsp;coming&nbsp;out&nbsp;of&nbsp;cgo&nbsp;call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485236">cgocallbackg1</span><span class="op" id="1485249">(</span><span class="op" id="1485250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1485253">//&nbsp;going&nbsp;back&nbsp;to&nbsp;cgo&nbsp;call</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485280">reentersyscall</span><span class="op" id="1485294">(</span><span class="ident" id="1485295">savedpc</span><span class="op" id="1485302">,</span>&nbsp;<span class="ident" id="1485304">savedsp</span><span class="op" id="1485311">)</span><br>
<span class="lineno"></span><span class="op" id="1485313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1485316">func</span>&nbsp;<span class="ident" id="1485321">cgocallbackg1</span><span class="op" id="1485334">(</span><span class="op" id="1485335">)</span>&nbsp;<span class="op" id="1485337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485340">gp</span>&nbsp;<span class="op" id="1485343">:=</span>&nbsp;<span class="ident" id="1485346">getg</span><span class="op" id="1485350">(</span><span class="op" id="1485351">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485354">if</span>&nbsp;<span class="ident" id="1485357">gp</span><span class="op" id="1485359">.</span><span class="ident" id="1485360">m</span><span class="op" id="1485361">.</span><span class="ident" id="1485362">needextram</span>&nbsp;<span class="op" id="1485373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485377">gp</span><span class="op" id="1485379">.</span><span class="ident" id="1485380">m</span><span class="op" id="1485381">.</span><span class="ident" id="1485382">needextram</span>&nbsp;<span class="op" id="1485393">=</span>&nbsp;<span class="builtintype" id="1485395">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485403">onM</span><span class="op" id="1485406">(</span><span class="ident" id="1485407">newextram</span><span class="op" id="1485416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1485419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1485423">//&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485470">restore</span>&nbsp;<span class="op" id="1485478">:=</span>&nbsp;<span class="builtintype" id="1485481">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485487">defer</span>&nbsp;<span class="ident" id="1485493">unwindm</span><span class="op" id="1485500">(</span><span class="op" id="1485501">&amp;</span><span class="ident" id="1485502">restore</span><span class="op" id="1485509">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485513">if</span>&nbsp;<span class="ident" id="1485516">raceenabled</span>&nbsp;<span class="op" id="1485528">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485532">raceacquire</span><span class="op" id="1485543">(</span><span class="ident" id="1485544">unsafe</span><span class="op" id="1485550">.</span><span class="ident" id="1485551">Pointer</span><span class="op" id="1485558">(</span><span class="op" id="1485559">&amp;</span><span class="ident" id="1485560">racecgosync</span><span class="op" id="1485571">)</span><span class="op" id="1485572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1485575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485579">type</span>&nbsp;<span class="ident" id="1485584">args</span>&nbsp;<span class="keyword" id="1485589">struct</span>&nbsp;<span class="op" id="1485596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485600">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1485608">*</span><span class="ident" id="1485609">funcval</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485619">arg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1485627">unsafe</span><span class="op" id="1485633">.</span><span class="ident" id="1485634">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485644">argsize</span>&nbsp;<span class="builtintype" id="1485652">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1485661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485664">var</span>&nbsp;<span class="ident" id="1485668">cb</span>&nbsp;<span class="op" id="1485671">*</span><span class="ident" id="1485672">args</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1485679">//&nbsp;Location&nbsp;of&nbsp;callback&nbsp;arguments&nbsp;depends&nbsp;on&nbsp;stack&nbsp;frame&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1485744">//&nbsp;and&nbsp;size&nbsp;of&nbsp;stack&nbsp;frame&nbsp;of&nbsp;cgocallback_gofunc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485795">sp</span>&nbsp;<span class="op" id="1485798">:=</span>&nbsp;<span class="ident" id="1485801">gp</span><span class="op" id="1485803">.</span><span class="ident" id="1485804">m</span><span class="op" id="1485805">.</span><span class="ident" id="1485806">g0</span><span class="op" id="1485808">.</span><span class="ident" id="1485809">sched</span><span class="op" id="1485814">.</span><span class="ident" id="1485815">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485819">switch</span>&nbsp;<span class="ident" id="1485826">GOARCH</span>&nbsp;<span class="op" id="1485833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485836">default</span><span class="op" id="1485843">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485847">gothrow</span><span class="op" id="1485854">(</span><span class="string" id="1485855">&#34;cgocallbackg&nbsp;is&nbsp;unimplemented&nbsp;on&nbsp;arch&#34;</span><span class="op" id="1485894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485897">case</span>&nbsp;<span class="string" id="1485902">&#34;arm&#34;</span><span class="op" id="1485907">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1485911">//&nbsp;On&nbsp;arm,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;two&nbsp;words&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;saved&nbsp;LR&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1485980">//&nbsp;SP&nbsp;and&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;between&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;the&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486055">cb</span>&nbsp;<span class="op" id="1486058">=</span>&nbsp;<span class="op" id="1486060">(</span><span class="op" id="1486061">*</span><span class="ident" id="1486062">args</span><span class="op" id="1486066">)</span><span class="op" id="1486067">(</span><span class="ident" id="1486068">unsafe</span><span class="op" id="1486074">.</span><span class="ident" id="1486075">Pointer</span><span class="op" id="1486082">(</span><span class="ident" id="1486083">sp</span>&nbsp;<span class="op" id="1486086">+</span>&nbsp;<span class="num" id="1486088">4</span><span class="op" id="1486089">*</span><span class="ident" id="1486090">ptrSize</span><span class="op" id="1486097">)</span><span class="op" id="1486098">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486101">case</span>&nbsp;<span class="string" id="1486106">&#34;amd64&#34;</span><span class="op" id="1486113">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1486117">//&nbsp;On&nbsp;amd64,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;one&nbsp;word,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486173">cb</span>&nbsp;<span class="op" id="1486176">=</span>&nbsp;<span class="op" id="1486178">(</span><span class="op" id="1486179">*</span><span class="ident" id="1486180">args</span><span class="op" id="1486184">)</span><span class="op" id="1486185">(</span><span class="ident" id="1486186">unsafe</span><span class="op" id="1486192">.</span><span class="ident" id="1486193">Pointer</span><span class="op" id="1486200">(</span><span class="ident" id="1486201">sp</span>&nbsp;<span class="op" id="1486204">+</span>&nbsp;<span class="num" id="1486206">2</span><span class="op" id="1486207">*</span><span class="ident" id="1486208">ptrSize</span><span class="op" id="1486215">)</span><span class="op" id="1486216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486219">case</span>&nbsp;<span class="string" id="1486224">&#34;386&#34;</span><span class="op" id="1486229">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1486233">//&nbsp;On&nbsp;386,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;three&nbsp;words,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486290">cb</span>&nbsp;<span class="op" id="1486293">=</span>&nbsp;<span class="op" id="1486295">(</span><span class="op" id="1486296">*</span><span class="ident" id="1486297">args</span><span class="op" id="1486301">)</span><span class="op" id="1486302">(</span><span class="ident" id="1486303">unsafe</span><span class="op" id="1486309">.</span><span class="ident" id="1486310">Pointer</span><span class="op" id="1486317">(</span><span class="ident" id="1486318">sp</span>&nbsp;<span class="op" id="1486321">+</span>&nbsp;<span class="num" id="1486323">4</span><span class="op" id="1486324">*</span><span class="ident" id="1486325">ptrSize</span><span class="op" id="1486332">)</span><span class="op" id="1486333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1486336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1486340">//&nbsp;Invoke&nbsp;callback.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486361">reflectcall</span><span class="op" id="1486372">(</span><span class="ident" id="1486373">unsafe</span><span class="op" id="1486379">.</span><span class="ident" id="1486380">Pointer</span><span class="op" id="1486387">(</span><span class="ident" id="1486388">cb</span><span class="op" id="1486390">.</span><span class="ident" id="1486391">fn</span><span class="op" id="1486393">)</span><span class="op" id="1486394">,</span>&nbsp;<span class="ident" id="1486396">unsafe</span><span class="op" id="1486402">.</span><span class="ident" id="1486403">Pointer</span><span class="op" id="1486410">(</span><span class="ident" id="1486411">cb</span><span class="op" id="1486413">.</span><span class="ident" id="1486414">arg</span><span class="op" id="1486417">)</span><span class="op" id="1486418">,</span>&nbsp;<span class="builtintype" id="1486420">uint32</span><span class="op" id="1486426">(</span><span class="ident" id="1486427">cb</span><span class="op" id="1486429">.</span><span class="ident" id="1486430">argsize</span><span class="op" id="1486437">)</span><span class="op" id="1486438">,</span>&nbsp;<span class="num" id="1486440">0</span><span class="op" id="1486441">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486445">if</span>&nbsp;<span class="ident" id="1486448">raceenabled</span>&nbsp;<span class="op" id="1486460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486464">racereleasemerge</span><span class="op" id="1486480">(</span><span class="ident" id="1486481">unsafe</span><span class="op" id="1486487">.</span><span class="ident" id="1486488">Pointer</span><span class="op" id="1486495">(</span><span class="op" id="1486496">&amp;</span><span class="ident" id="1486497">racecgosync</span><span class="op" id="1486508">)</span><span class="op" id="1486509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1486512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1486516">//&nbsp;Do&nbsp;not&nbsp;unwind&nbsp;m-&gt;g0-&gt;sched.sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1486551">//&nbsp;Our&nbsp;caller,&nbsp;cgocallback,&nbsp;will&nbsp;do&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486594">restore</span>&nbsp;<span class="op" id="1486602">=</span>&nbsp;<span class="builtintype" id="1486604">false</span><br>
<span class="lineno"></span><span class="op" id="1486610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="1486613">func</span>&nbsp;<span class="ident" id="1486618">unwindm</span><span class="op" id="1486625">(</span><span class="ident" id="1486626">restore</span>&nbsp;<span class="op" id="1486634">*</span><span class="builtintype" id="1486635">bool</span><span class="op" id="1486639">)</span>&nbsp;<span class="op" id="1486641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486644">if</span>&nbsp;<span class="op" id="1486647">!</span><span class="op" id="1486648">*</span><span class="ident" id="1486649">restore</span>&nbsp;<span class="op" id="1486657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486661">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1486669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1486672">//&nbsp;Restore&nbsp;sp&nbsp;saved&nbsp;by&nbsp;cgocallback&nbsp;during</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1486715">//&nbsp;unwind&nbsp;of&nbsp;g&#39;s&nbsp;stack&nbsp;(see&nbsp;comment&nbsp;at&nbsp;top&nbsp;of&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486769">mp</span>&nbsp;<span class="op" id="1486772">:=</span>&nbsp;<span class="ident" id="1486775">acquirem</span><span class="op" id="1486783">(</span><span class="op" id="1486784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486787">sched</span>&nbsp;<span class="op" id="1486793">:=</span>&nbsp;<span class="op" id="1486796">&amp;</span><span class="ident" id="1486797">mp</span><span class="op" id="1486799">.</span><span class="ident" id="1486800">g0</span><span class="op" id="1486802">.</span><span class="ident" id="1486803">sched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486810">switch</span>&nbsp;<span class="ident" id="1486817">GOARCH</span>&nbsp;<span class="op" id="1486824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486827">default</span><span class="op" id="1486834">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486838">gothrow</span><span class="op" id="1486845">(</span><span class="string" id="1486846">&#34;unwindm&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1486871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486874">case</span>&nbsp;<span class="string" id="1486879">&#34;386&#34;</span><span class="op" id="1486884">,</span>&nbsp;<span class="string" id="1486886">&#34;amd64&#34;</span><span class="op" id="1486893">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486897">sched</span><span class="op" id="1486902">.</span><span class="ident" id="1486903">sp</span>&nbsp;<span class="op" id="1486906">=</span>&nbsp;<span class="op" id="1486908">*</span><span class="op" id="1486909">(</span><span class="op" id="1486910">*</span><span class="builtintype" id="1486911">uintptr</span><span class="op" id="1486918">)</span><span class="op" id="1486919">(</span><span class="ident" id="1486920">unsafe</span><span class="op" id="1486926">.</span><span class="ident" id="1486927">Pointer</span><span class="op" id="1486934">(</span><span class="ident" id="1486935">sched</span><span class="op" id="1486940">.</span><span class="ident" id="1486941">sp</span><span class="op" id="1486943">)</span><span class="op" id="1486944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486947">case</span>&nbsp;<span class="string" id="1486952">&#34;arm&#34;</span><span class="op" id="1486957">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486961">sched</span><span class="op" id="1486966">.</span><span class="ident" id="1486967">sp</span>&nbsp;<span class="op" id="1486970">=</span>&nbsp;<span class="op" id="1486972">*</span><span class="op" id="1486973">(</span><span class="op" id="1486974">*</span><span class="builtintype" id="1486975">uintptr</span><span class="op" id="1486982">)</span><span class="op" id="1486983">(</span><span class="ident" id="1486984">unsafe</span><span class="op" id="1486990">.</span><span class="ident" id="1486991">Pointer</span><span class="op" id="1486998">(</span><span class="ident" id="1486999">sched</span><span class="op" id="1487004">.</span><span class="ident" id="1487005">sp</span>&nbsp;<span class="op" id="1487008">+</span>&nbsp;<span class="num" id="1487010">4</span><span class="op" id="1487011">)</span><span class="op" id="1487012">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1487015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1487018">releasem</span><span class="op" id="1487026">(</span><span class="ident" id="1487027">mp</span><span class="op" id="1487029">)</span><br>
<span class="lineno"></span><span class="op" id="1487031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1487034">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno">270</span><span class="keyword" id="1487058">func</span>&nbsp;<span class="ident" id="1487063">badcgocallback</span><span class="op" id="1487077">(</span><span class="op" id="1487078">)</span>&nbsp;<span class="op" id="1487080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1487083">gothrow</span><span class="op" id="1487090">(</span><span class="string" id="1487091">&#34;misaligned&nbsp;stack&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1487124">)</span><br>
<span class="lineno"></span><span class="op" id="1487126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1487129">//&nbsp;called&nbsp;from&nbsp;(incomplete)&nbsp;assembly</span><br>
<span class="lineno">275</span><span class="keyword" id="1487166">func</span>&nbsp;<span class="ident" id="1487171">cgounimpl</span><span class="op" id="1487180">(</span><span class="op" id="1487181">)</span>&nbsp;<span class="op" id="1487183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1487186">gothrow</span><span class="op" id="1487193">(</span><span class="string" id="1487194">&#34;cgo&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1487215">)</span><br>
<span class="lineno"></span><span class="op" id="1487217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1487220">var</span>&nbsp;<span class="ident" id="1487224">racecgosync</span>&nbsp;<span class="ident" id="1487236">uint64</span>&nbsp;<span class="comment" id="1487243">//&nbsp;represents&nbsp;possible&nbsp;synchronization&nbsp;in&nbsp;C&nbsp;code</span>
</div>
</body>
</html>
