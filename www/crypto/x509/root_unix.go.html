<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4298221">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4298276">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4298330">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4298381">//&nbsp;+build&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4298444">package</span>&nbsp;<span class="ident" id="4298452">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4298458">import</span>&nbsp;<span class="string" id="4298465">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4298478">//&nbsp;Possible&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;finding&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4298533">var</span>&nbsp;<span class="ident" id="4298537">certFiles</span>&nbsp;<span class="op" id="4298547">=</span>&nbsp;<span class="op" id="4298549">[</span><span class="op" id="4298550">]</span><span class="builtintype" id="4298551">string</span><span class="op" id="4298557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4298560">&#34;/etc/ssl/certs/ca-certificates.crt&#34;</span><span class="op" id="4298596">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4298602">//&nbsp;Debian/Ubuntu/Gentoo&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4298632">&#34;/etc/pki/tls/certs/ca-bundle.crt&#34;</span><span class="op" id="4298666">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4298674">//&nbsp;Fedora/RHEL</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4298690">&#34;/etc/ssl/ca-bundle.pem&#34;</span><span class="op" id="4298714">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4298732">//&nbsp;OpenSUSE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4298745">&#34;/etc/ssl/cert.pem&#34;</span><span class="op" id="4298764">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4298787">//&nbsp;OpenBSD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4298799">&#34;/usr/local/share/certs/ca-root-nss.crt&#34;</span><span class="op" id="4298839">,</span>&nbsp;<span class="comment" id="4298841">//&nbsp;FreeBSD/DragonFly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4298863">&#34;/etc/pki/tls/cacert.pem&#34;</span><span class="op" id="4298888">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4298905">//&nbsp;OpenELEC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4298918">&#34;/etc/certs/ca-certificates.crt&#34;</span><span class="op" id="4298950">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4298960">//&nbsp;Solaris&nbsp;11.2+</span><br>
<span class="lineno">20</span><span class="op" id="4298977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4298980">//&nbsp;Possible&nbsp;directories&nbsp;with&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;successfully</span><br>
<span class="lineno"></span><span class="comment" id="4299052">//&nbsp;reading&nbsp;at&nbsp;least&nbsp;one&nbsp;file&nbsp;from&nbsp;a&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="4299099">var</span>&nbsp;<span class="ident" id="4299103">certDirectories</span>&nbsp;<span class="op" id="4299119">=</span>&nbsp;<span class="op" id="4299121">[</span><span class="op" id="4299122">]</span><span class="builtintype" id="4299123">string</span><span class="op" id="4299129">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4299132">&#34;/system/etc/security/cacerts&#34;</span><span class="op" id="4299162">,</span>&nbsp;<span class="comment" id="4299164">//&nbsp;Android</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="4299176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4299179">func</span>&nbsp;<span class="op" id="4299184">(</span><span class="ident" id="4299185">c</span>&nbsp;<span class="op" id="4299187">*</span><span class="ident" id="4299188"><a href="/crypto/x509/x509.go.html#4330775">Certificate</a></span><span class="op" id="4299199">)</span>&nbsp;<span class="ident" id="4299201">systemVerify</span><span class="op" id="4299213">(</span><span class="ident" id="4299214">opts</span>&nbsp;<span class="op" id="4299219">*</span><span class="ident" id="4299220"><a href="/crypto/x509/verify.go.html#4306479">VerifyOptions</a></span><span class="op" id="4299233">)</span>&nbsp;<span class="op" id="4299235">(</span><span class="ident" id="4299236">chains</span>&nbsp;<span class="op" id="4299243">[</span><span class="op" id="4299244">]</span><span class="op" id="4299245">[</span><span class="op" id="4299246">]</span><span class="op" id="4299247">*</span><span class="ident" id="4299248"><a href="/crypto/x509/x509.go.html#4330775">Certificate</a></span><span class="op" id="4299259">,</span>&nbsp;<span class="ident" id="4299261">err</span>&nbsp;<span class="builtintype" id="4299265">error</span><span class="op" id="4299270">)</span>&nbsp;<span class="op" id="4299272">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299275">return</span>&nbsp;<span class="ident" id="4299282">nil</span><span class="op" id="4299285">,</span>&nbsp;<span class="ident" id="4299287">nil</span><br>
<span class="lineno"></span><span class="op" id="4299291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4299294">func</span>&nbsp;<span class="ident" id="4299299">initSystemRoots</span><span class="op" id="4299314">(</span><span class="op" id="4299315">)</span>&nbsp;<span class="op" id="4299317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299320">roots</span>&nbsp;<span class="op" id="4299326">:=</span>&nbsp;<span class="ident" id="4299329"><a href="/crypto/x509/cert_pool.go.html#4284604">NewCertPool</a></span><span class="op" id="4299340">(</span><span class="op" id="4299341">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299344">for</span>&nbsp;<span class="ident" id="4299348">_</span><span class="op" id="4299349">,</span>&nbsp;<span class="ident" id="4299351">file</span>&nbsp;<span class="op" id="4299356">:=</span>&nbsp;<span class="keyword" id="4299359">range</span>&nbsp;<span class="ident" id="4299365"><a href="/crypto/x509/root_unix.go.html#4298537">certFiles</a></span>&nbsp;<span class="op" id="4299375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299379">data</span><span class="op" id="4299383">,</span>&nbsp;<span class="ident" id="4299385">err</span>&nbsp;<span class="op" id="4299389">:=</span>&nbsp;<span class="ident" id="4299392"><a href="/crypto/x509/root_unix.go.html#4298465">ioutil</a></span><span class="op" id="4299398">.</span><span class="ident" id="4299399">ReadFile</span><span class="op" id="4299407">(</span><span class="ident" id="4299408"><a href="/crypto/x509/root_unix.go.html#4299351">file</a></span><span class="op" id="4299412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299416">if</span>&nbsp;<span class="ident" id="4299419"><a href="/crypto/x509/root_unix.go.html#4299385">err</a></span>&nbsp;<span class="op" id="4299423">==</span>&nbsp;<span class="ident" id="4299426">nil</span>&nbsp;<span class="op" id="4299430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299435"><a href="/crypto/x509/root_unix.go.html#4299320">roots</a></span><span class="op" id="4299440">.</span><span class="ident" id="4299441">AppendCertsFromPEM</span><span class="op" id="4299459">(</span><span class="ident" id="4299460"><a href="/crypto/x509/root_unix.go.html#4299379">data</a></span><span class="op" id="4299464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299469"><a href="/crypto/x509/root.go.html#4298112">systemRoots</a></span>&nbsp;<span class="op" id="4299481">=</span>&nbsp;<span class="ident" id="4299483"><a href="/crypto/x509/root_unix.go.html#4299320">roots</a></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299492">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299508">for</span>&nbsp;<span class="ident" id="4299512">_</span><span class="op" id="4299513">,</span>&nbsp;<span class="ident" id="4299515">directory</span>&nbsp;<span class="op" id="4299525">:=</span>&nbsp;<span class="keyword" id="4299528">range</span>&nbsp;<span class="ident" id="4299534"><a href="/crypto/x509/root_unix.go.html#4299103">certDirectories</a></span>&nbsp;<span class="op" id="4299550">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299554">fis</span><span class="op" id="4299557">,</span>&nbsp;<span class="ident" id="4299559">err</span>&nbsp;<span class="op" id="4299563">:=</span>&nbsp;<span class="ident" id="4299566"><a href="/crypto/x509/root_unix.go.html#4298465">ioutil</a></span><span class="op" id="4299572">.</span><span class="ident" id="4299573">ReadDir</span><span class="op" id="4299580">(</span><span class="ident" id="4299581"><a href="/crypto/x509/root_unix.go.html#4299515">directory</a></span><span class="op" id="4299590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299594">if</span>&nbsp;<span class="ident" id="4299597"><a href="/crypto/x509/root_unix.go.html#4299559">err</a></span>&nbsp;<span class="op" id="4299601">!=</span>&nbsp;<span class="ident" id="4299604">nil</span>&nbsp;<span class="op" id="4299608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299613">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299628">rootsAdded</span>&nbsp;<span class="op" id="4299639">:=</span>&nbsp;<span class="ident" id="4299642">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299650">for</span>&nbsp;<span class="ident" id="4299654">_</span><span class="op" id="4299655">,</span>&nbsp;<span class="ident" id="4299657">fi</span>&nbsp;<span class="op" id="4299660">:=</span>&nbsp;<span class="keyword" id="4299663">range</span>&nbsp;<span class="ident" id="4299669"><a href="/crypto/x509/root_unix.go.html#4299554">fis</a></span>&nbsp;<span class="op" id="4299673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299678">data</span><span class="op" id="4299682">,</span>&nbsp;<span class="ident" id="4299684">err</span>&nbsp;<span class="op" id="4299688">:=</span>&nbsp;<span class="ident" id="4299691"><a href="/crypto/x509/root_unix.go.html#4298465">ioutil</a></span><span class="op" id="4299697">.</span><span class="ident" id="4299698">ReadFile</span><span class="op" id="4299706">(</span><span class="ident" id="4299707"><a href="/crypto/x509/root_unix.go.html#4299515">directory</a></span>&nbsp;<span class="op" id="4299717">+</span>&nbsp;<span class="string" id="4299719">&#34;/&#34;</span>&nbsp;<span class="op" id="4299723">+</span>&nbsp;<span class="ident" id="4299725"><a href="/crypto/x509/root_unix.go.html#4299657">fi</a></span><span class="op" id="4299727">.</span><span class="ident" id="4299728">Name</span><span class="op" id="4299732">(</span><span class="op" id="4299733">)</span><span class="op" id="4299734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299739">if</span>&nbsp;<span class="ident" id="4299742"><a href="/crypto/x509/root_unix.go.html#4299684">err</a></span>&nbsp;<span class="op" id="4299746">==</span>&nbsp;<span class="ident" id="4299749">nil</span>&nbsp;<span class="op" id="4299753">&amp;&amp;</span>&nbsp;<span class="ident" id="4299756"><a href="/crypto/x509/root_unix.go.html#4299320">roots</a></span><span class="op" id="4299761">.</span><span class="ident" id="4299762">AppendCertsFromPEM</span><span class="op" id="4299780">(</span><span class="ident" id="4299781"><a href="/crypto/x509/root_unix.go.html#4299678">data</a></span><span class="op" id="4299785">)</span>&nbsp;<span class="op" id="4299787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299793"><a href="/crypto/x509/root_unix.go.html#4299628">rootsAdded</a></span>&nbsp;<span class="op" id="4299804">=</span>&nbsp;<span class="ident" id="4299806">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299814">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299822">if</span>&nbsp;<span class="ident" id="4299825"><a href="/crypto/x509/root_unix.go.html#4299628">rootsAdded</a></span>&nbsp;<span class="op" id="4299836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299841"><a href="/crypto/x509/root.go.html#4298112">systemRoots</a></span>&nbsp;<span class="op" id="4299853">=</span>&nbsp;<span class="ident" id="4299855"><a href="/crypto/x509/root_unix.go.html#4299320">roots</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299864">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299873">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4299880">//&nbsp;All&nbsp;of&nbsp;the&nbsp;files&nbsp;failed&nbsp;to&nbsp;load.&nbsp;systemRoots&nbsp;will&nbsp;be&nbsp;nil&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4299952">//&nbsp;trigger&nbsp;a&nbsp;specific&nbsp;error&nbsp;at&nbsp;verification&nbsp;time.</span><br>
<span class="lineno"></span><span class="op" id="4300002">}</span>
</div>
</body>
</html>
