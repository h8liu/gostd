<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2675542">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2675597">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2675651">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2675702">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;sysSocket&nbsp;and&nbsp;accept&nbsp;for&nbsp;platforms&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2675766">//&nbsp;provide&nbsp;a&nbsp;fast&nbsp;path&nbsp;for&nbsp;setting&nbsp;SetNonblock&nbsp;and&nbsp;CloseOnExec.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2675831">//&nbsp;+build&nbsp;freebsd&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="2675856">package</span>&nbsp;<span class="ident" id="2675864">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2675869">import</span>&nbsp;<span class="string" id="2675876">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2675887">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;socket&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">15</span><span class="comment" id="2675957">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="2676005">func</span>&nbsp;<span class="ident" id="2676010">sysSocket</span><span class="op" id="2676019">(</span><span class="ident" id="2676020">family</span><span class="op" id="2676026">,</span>&nbsp;<span class="ident" id="2676028">sotype</span><span class="op" id="2676034">,</span>&nbsp;<span class="ident" id="2676036">proto</span>&nbsp;<span class="builtintype" id="2676042">int</span><span class="op" id="2676045">)</span>&nbsp;<span class="op" id="2676047">(</span><span class="builtintype" id="2676048">int</span><span class="op" id="2676051">,</span>&nbsp;<span class="builtintype" id="2676053">error</span><span class="op" id="2676058">)</span>&nbsp;<span class="op" id="2676060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2676063">s</span><span class="op" id="2676064">,</span>&nbsp;<span class="ident" id="2676066">err</span>&nbsp;<span class="op" id="2676070">:=</span>&nbsp;<span class="ident" id="2676073"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2676080">.</span><span class="ident" id="2676081">Socket</span><span class="op" id="2676087">(</span><span class="ident" id="2676088"><a href="/net/sock_cloexec.go.html#2676020">family</a></span><span class="op" id="2676094">,</span>&nbsp;<span class="ident" id="2676096"><a href="/net/sock_cloexec.go.html#2676028">sotype</a></span><span class="op" id="2676102">|</span><span class="ident" id="2676103"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2676110">.</span><span class="ident" id="2676111">SOCK_NONBLOCK</span><span class="op" id="2676124">|</span><span class="ident" id="2676125"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2676132">.</span><span class="ident" id="2676133">SOCK_CLOEXEC</span><span class="op" id="2676145">,</span>&nbsp;<span class="ident" id="2676147"><a href="/net/sock_cloexec.go.html#2676036">proto</a></span><span class="op" id="2676152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2676155">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;SOCK_NONBLOCK&nbsp;and&nbsp;SOCK_CLOEXEC&nbsp;flags&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2676214">//&nbsp;introduced&nbsp;in&nbsp;2.6.27&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;both&nbsp;flags&nbsp;were</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2676277">//&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we&nbsp;get&nbsp;an&nbsp;EINVAL&nbsp;error&nbsp;on&nbsp;Linux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2676341">//&nbsp;or&nbsp;EPROTONOSUPPORT&nbsp;error&nbsp;on&nbsp;FreeBSD,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2676401">//&nbsp;socket&nbsp;without&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676426">if</span>&nbsp;<span class="ident" id="2676429"><a href="/net/sock_cloexec.go.html#2676066">err</a></span>&nbsp;<span class="op" id="2676433">==</span>&nbsp;<span class="ident" id="2676436">nil</span>&nbsp;<span class="op" id="2676440">||</span>&nbsp;<span class="op" id="2676443">(</span><span class="ident" id="2676444"><a href="/net/sock_cloexec.go.html#2676066">err</a></span>&nbsp;<span class="op" id="2676448">!=</span>&nbsp;<span class="ident" id="2676451"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2676458">.</span><span class="ident" id="2676459">EPROTONOSUPPORT</span>&nbsp;<span class="op" id="2676475">&amp;&amp;</span>&nbsp;<span class="ident" id="2676478"><a href="/net/sock_cloexec.go.html#2676066">err</a></span>&nbsp;<span class="op" id="2676482">!=</span>&nbsp;<span class="ident" id="2676485"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2676492">.</span><span class="ident" id="2676493">EINVAL</span><span class="op" id="2676499">)</span>&nbsp;<span class="op" id="2676501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676505">return</span>&nbsp;<span class="ident" id="2676512"><a href="/net/sock_cloexec.go.html#2676063">s</a></span><span class="op" id="2676513">,</span>&nbsp;<span class="ident" id="2676515"><a href="/net/sock_cloexec.go.html#2676066">err</a></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2676520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2676524">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2676585"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2676592">.</span><span class="ident" id="2676593">ForkLock</span><span class="op" id="2676601">.</span><span class="ident" id="2676602">RLock</span><span class="op" id="2676607">(</span><span class="op" id="2676608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2676611"><a href="/net/sock_cloexec.go.html#2676063">s</a></span><span class="op" id="2676612">,</span>&nbsp;<span class="ident" id="2676614"><a href="/net/sock_cloexec.go.html#2676066">err</a></span>&nbsp;<span class="op" id="2676618">=</span>&nbsp;<span class="ident" id="2676620"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2676627">.</span><span class="ident" id="2676628">Socket</span><span class="op" id="2676634">(</span><span class="ident" id="2676635"><a href="/net/sock_cloexec.go.html#2676020">family</a></span><span class="op" id="2676641">,</span>&nbsp;<span class="ident" id="2676643"><a href="/net/sock_cloexec.go.html#2676028">sotype</a></span><span class="op" id="2676649">,</span>&nbsp;<span class="ident" id="2676651"><a href="/net/sock_cloexec.go.html#2676036">proto</a></span><span class="op" id="2676656">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676659">if</span>&nbsp;<span class="ident" id="2676662"><a href="/net/sock_cloexec.go.html#2676066">err</a></span>&nbsp;<span class="op" id="2676666">==</span>&nbsp;<span class="ident" id="2676669">nil</span>&nbsp;<span class="op" id="2676673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2676677"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2676684">.</span><span class="ident" id="2676685">CloseOnExec</span><span class="op" id="2676696">(</span><span class="ident" id="2676697"><a href="/net/sock_cloexec.go.html#2676063">s</a></span><span class="op" id="2676698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2676701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2676704"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2676711">.</span><span class="ident" id="2676712">ForkLock</span><span class="op" id="2676720">.</span><span class="ident" id="2676721">RUnlock</span><span class="op" id="2676728">(</span><span class="op" id="2676729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676732">if</span>&nbsp;<span class="ident" id="2676735"><a href="/net/sock_cloexec.go.html#2676066">err</a></span>&nbsp;<span class="op" id="2676739">!=</span>&nbsp;<span class="ident" id="2676742">nil</span>&nbsp;<span class="op" id="2676746">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676750">return</span>&nbsp;<span class="op" id="2676757">-</span><span class="num" id="2676758">1</span><span class="op" id="2676759">,</span>&nbsp;<span class="ident" id="2676761"><a href="/net/sock_cloexec.go.html#2676066">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2676766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676769">if</span>&nbsp;<span class="ident" id="2676772"><a href="/net/sock_cloexec.go.html#2676066">err</a></span>&nbsp;<span class="op" id="2676776">=</span>&nbsp;<span class="ident" id="2676778"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2676785">.</span><span class="ident" id="2676786">SetNonblock</span><span class="op" id="2676797">(</span><span class="ident" id="2676798"><a href="/net/sock_cloexec.go.html#2676063">s</a></span><span class="op" id="2676799">,</span>&nbsp;<span class="ident" id="2676801">true</span><span class="op" id="2676805">)</span><span class="op" id="2676806">;</span>&nbsp;<span class="ident" id="2676808"><a href="/net/sock_cloexec.go.html#2676066">err</a></span>&nbsp;<span class="op" id="2676812">!=</span>&nbsp;<span class="ident" id="2676815">nil</span>&nbsp;<span class="op" id="2676819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2676823"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2676830">.</span><span class="ident" id="2676831">Close</span><span class="op" id="2676836">(</span><span class="ident" id="2676837"><a href="/net/sock_cloexec.go.html#2676063">s</a></span><span class="op" id="2676838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676842">return</span>&nbsp;<span class="op" id="2676849">-</span><span class="num" id="2676850">1</span><span class="op" id="2676851">,</span>&nbsp;<span class="ident" id="2676853"><a href="/net/sock_cloexec.go.html#2676066">err</a></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2676858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2676861">return</span>&nbsp;<span class="ident" id="2676868"><a href="/net/sock_cloexec.go.html#2676063">s</a></span><span class="op" id="2676869">,</span>&nbsp;<span class="ident" id="2676871">nil</span><br>
<span class="lineno"></span><span class="op" id="2676875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2676878">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;accept&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">45</span><span class="comment" id="2676948">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="2676996">func</span>&nbsp;<span class="ident" id="2677001">accept</span><span class="op" id="2677007">(</span><span class="ident" id="2677008">s</span>&nbsp;<span class="builtintype" id="2677010">int</span><span class="op" id="2677013">)</span>&nbsp;<span class="op" id="2677015">(</span><span class="builtintype" id="2677016">int</span><span class="op" id="2677019">,</span>&nbsp;<span class="ident" id="2677021"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2677028">.</span><span class="ident" id="2677029">Sockaddr</span><span class="op" id="2677037">,</span>&nbsp;<span class="builtintype" id="2677039">error</span><span class="op" id="2677044">)</span>&nbsp;<span class="op" id="2677046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2677049">ns</span><span class="op" id="2677051">,</span>&nbsp;<span class="ident" id="2677053">sa</span><span class="op" id="2677055">,</span>&nbsp;<span class="ident" id="2677057">err</span>&nbsp;<span class="op" id="2677061">:=</span>&nbsp;<span class="ident" id="2677064"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2677071">.</span><span class="ident" id="2677072">Accept4</span><span class="op" id="2677079">(</span><span class="ident" id="2677080"><a href="/net/sock_cloexec.go.html#2677008">s</a></span><span class="op" id="2677081">,</span>&nbsp;<span class="ident" id="2677083"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2677090">.</span><span class="ident" id="2677091">SOCK_NONBLOCK</span><span class="op" id="2677104">|</span><span class="ident" id="2677105"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2677112">.</span><span class="ident" id="2677113">SOCK_CLOEXEC</span><span class="op" id="2677125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2677128">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;accept4&nbsp;system&nbsp;call&nbsp;was&nbsp;introduced&nbsp;in&nbsp;2.6.28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2677190">//&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;it&nbsp;was&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2677254">//&nbsp;get&nbsp;an&nbsp;ENOSYS&nbsp;error&nbsp;on&nbsp;both&nbsp;Linux&nbsp;and&nbsp;FreeBSD,&nbsp;or&nbsp;EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2677315">//&nbsp;error&nbsp;on&nbsp;Linux,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using&nbsp;accept.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2677362">switch</span>&nbsp;<span class="ident" id="2677369"><a href="/net/sock_cloexec.go.html#2677057">err</a></span>&nbsp;<span class="op" id="2677373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2677376">default</span><span class="op" id="2677383">:</span>&nbsp;<span class="comment" id="2677385">//&nbsp;nil&nbsp;and&nbsp;errors&nbsp;other&nbsp;than&nbsp;the&nbsp;ones&nbsp;listed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2677432">return</span>&nbsp;<span class="ident" id="2677439"><a href="/net/sock_cloexec.go.html#2677049">ns</a></span><span class="op" id="2677441">,</span>&nbsp;<span class="ident" id="2677443"><a href="/net/sock_cloexec.go.html#2677053">sa</a></span><span class="op" id="2677445">,</span>&nbsp;<span class="ident" id="2677447"><a href="/net/sock_cloexec.go.html#2677057">err</a></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2677452">case</span>&nbsp;<span class="ident" id="2677457"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2677464">.</span><span class="ident" id="2677465">ENOSYS</span><span class="op" id="2677471">:</span>&nbsp;<span class="comment" id="2677473">//&nbsp;syscall&nbsp;missing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2677493">case</span>&nbsp;<span class="ident" id="2677498"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2677505">.</span><span class="ident" id="2677506">EINVAL</span><span class="op" id="2677512">:</span>&nbsp;<span class="comment" id="2677514">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2677556">case</span>&nbsp;<span class="ident" id="2677561"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2677568">.</span><span class="ident" id="2677569">EACCES</span><span class="op" id="2677575">:</span>&nbsp;<span class="comment" id="2677577">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2677619">case</span>&nbsp;<span class="ident" id="2677624"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2677631">.</span><span class="ident" id="2677632">EFAULT</span><span class="op" id="2677638">:</span>&nbsp;<span class="comment" id="2677640">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2677682">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2677686">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2677747">//&nbsp;It&nbsp;is&nbsp;probably&nbsp;okay&nbsp;to&nbsp;hold&nbsp;the&nbsp;lock&nbsp;across&nbsp;syscall.Accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2677810">//&nbsp;because&nbsp;we&nbsp;have&nbsp;put&nbsp;fd.sysfd&nbsp;into&nbsp;non-blocking&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2677867">//&nbsp;However,&nbsp;a&nbsp;call&nbsp;to&nbsp;the&nbsp;File&nbsp;method&nbsp;will&nbsp;put&nbsp;it&nbsp;back&nbsp;into</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2677928">//&nbsp;blocking&nbsp;mode.&nbsp;We&nbsp;can&#39;t&nbsp;take&nbsp;that&nbsp;risk,&nbsp;so&nbsp;no&nbsp;use&nbsp;of&nbsp;ForkLock&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2678000"><a href="/net/sock_cloexec.go.html#2677049">ns</a></span><span class="op" id="2678002">,</span>&nbsp;<span class="ident" id="2678004"><a href="/net/sock_cloexec.go.html#2677053">sa</a></span><span class="op" id="2678006">,</span>&nbsp;<span class="ident" id="2678008"><a href="/net/sock_cloexec.go.html#2677057">err</a></span>&nbsp;<span class="op" id="2678012">=</span>&nbsp;<span class="ident" id="2678014"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2678021">.</span><span class="ident" id="2678022">Accept</span><span class="op" id="2678028">(</span><span class="ident" id="2678029"><a href="/net/sock_cloexec.go.html#2677008">s</a></span><span class="op" id="2678030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2678033">if</span>&nbsp;<span class="ident" id="2678036"><a href="/net/sock_cloexec.go.html#2677057">err</a></span>&nbsp;<span class="op" id="2678040">==</span>&nbsp;<span class="ident" id="2678043">nil</span>&nbsp;<span class="op" id="2678047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2678051"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2678058">.</span><span class="ident" id="2678059">CloseOnExec</span><span class="op" id="2678070">(</span><span class="ident" id="2678071"><a href="/net/sock_cloexec.go.html#2677049">ns</a></span><span class="op" id="2678073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2678076">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2678079">if</span>&nbsp;<span class="ident" id="2678082"><a href="/net/sock_cloexec.go.html#2677057">err</a></span>&nbsp;<span class="op" id="2678086">!=</span>&nbsp;<span class="ident" id="2678089">nil</span>&nbsp;<span class="op" id="2678093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2678097">return</span>&nbsp;<span class="op" id="2678104">-</span><span class="num" id="2678105">1</span><span class="op" id="2678106">,</span>&nbsp;<span class="ident" id="2678108">nil</span><span class="op" id="2678111">,</span>&nbsp;<span class="ident" id="2678113"><a href="/net/sock_cloexec.go.html#2677057">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2678118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2678121">if</span>&nbsp;<span class="ident" id="2678124"><a href="/net/sock_cloexec.go.html#2677057">err</a></span>&nbsp;<span class="op" id="2678128">=</span>&nbsp;<span class="ident" id="2678130"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2678137">.</span><span class="ident" id="2678138">SetNonblock</span><span class="op" id="2678149">(</span><span class="ident" id="2678150"><a href="/net/sock_cloexec.go.html#2677049">ns</a></span><span class="op" id="2678152">,</span>&nbsp;<span class="ident" id="2678154">true</span><span class="op" id="2678158">)</span><span class="op" id="2678159">;</span>&nbsp;<span class="ident" id="2678161"><a href="/net/sock_cloexec.go.html#2677057">err</a></span>&nbsp;<span class="op" id="2678165">!=</span>&nbsp;<span class="ident" id="2678168">nil</span>&nbsp;<span class="op" id="2678172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2678176"><a href="/net/sock_cloexec.go.html#2675876">syscall</a></span><span class="op" id="2678183">.</span><span class="ident" id="2678184">Close</span><span class="op" id="2678189">(</span><span class="ident" id="2678190"><a href="/net/sock_cloexec.go.html#2677049">ns</a></span><span class="op" id="2678192">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2678196">return</span>&nbsp;<span class="op" id="2678203">-</span><span class="num" id="2678204">1</span><span class="op" id="2678205">,</span>&nbsp;<span class="ident" id="2678207">nil</span><span class="op" id="2678210">,</span>&nbsp;<span class="ident" id="2678212"><a href="/net/sock_cloexec.go.html#2677057">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2678217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2678220">return</span>&nbsp;<span class="ident" id="2678227"><a href="/net/sock_cloexec.go.html#2677049">ns</a></span><span class="op" id="2678229">,</span>&nbsp;<span class="ident" id="2678231"><a href="/net/sock_cloexec.go.html#2677053">sa</a></span><span class="op" id="2678233">,</span>&nbsp;<span class="ident" id="2678235">nil</span><br>
<span class="lineno"></span><span class="op" id="2678239">}</span>
</div>
</body>
</html>
