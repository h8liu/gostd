<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html" class="current">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8186610">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8186666">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8186720">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8186771">//&nbsp;Bridge&nbsp;package&nbsp;to&nbsp;expose&nbsp;http&nbsp;internals&nbsp;to&nbsp;tests&nbsp;in&nbsp;the&nbsp;http_test</span><br>
<span class="lineno"></span><span class="comment" id="8186840">//&nbsp;package.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8186853">package</span>&nbsp;<span class="ident" id="8186861">http</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="8186867">import</span>&nbsp;<span class="op" id="8186874">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8186877">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8186884">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8186895">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8186902">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8186905">func</span>&nbsp;<span class="ident" id="8186910">NewLoggingConn</span><span class="op" id="8186924">(</span><span class="ident" id="8186925">baseName</span>&nbsp;<span class="builtintype" id="8186934">string</span><span class="op" id="8186940">,</span>&nbsp;<span class="ident" id="8186942">c</span>&nbsp;<span class="ident" id="8186944">net</span><span class="op" id="8186947">.</span><span class="ident" id="8186948">Conn</span><span class="op" id="8186952">)</span>&nbsp;<span class="ident" id="8186954">net</span><span class="op" id="8186957">.</span><span class="ident" id="8186958">Conn</span>&nbsp;<span class="op" id="8186963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8186966">return</span>&nbsp;<span class="ident" id="8186973">newLoggingConn</span><span class="op" id="8186987">(</span><span class="ident" id="8186988">baseName</span><span class="op" id="8186996">,</span>&nbsp;<span class="ident" id="8186998">c</span><span class="op" id="8186999">)</span><br>
<span class="lineno"></span><span class="op" id="8187001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8187004">var</span>&nbsp;<span class="ident" id="8187008">ExportAppendTime</span>&nbsp;<span class="op" id="8187025">=</span>&nbsp;<span class="ident" id="8187027">appendTime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8187039">func</span>&nbsp;<span class="op" id="8187044">(</span><span class="ident" id="8187045">t</span>&nbsp;<span class="op" id="8187047">*</span><span class="ident" id="8187048">Transport</span><span class="op" id="8187057">)</span>&nbsp;<span class="ident" id="8187059">NumPendingRequestsForTesting</span><span class="op" id="8187087">(</span><span class="op" id="8187088">)</span>&nbsp;<span class="builtintype" id="8187090">int</span>&nbsp;<span class="op" id="8187094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187097">t</span><span class="op" id="8187098">.</span><span class="ident" id="8187099">reqMu</span><span class="op" id="8187104">.</span><span class="ident" id="8187105">Lock</span><span class="op" id="8187109">(</span><span class="op" id="8187110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187113">defer</span>&nbsp;<span class="ident" id="8187119">t</span><span class="op" id="8187120">.</span><span class="ident" id="8187121">reqMu</span><span class="op" id="8187126">.</span><span class="ident" id="8187127">Unlock</span><span class="op" id="8187133">(</span><span class="op" id="8187134">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187137">return</span>&nbsp;<span class="builtinfunc" id="8187144">len</span><span class="op" id="8187147">(</span><span class="ident" id="8187148">t</span><span class="op" id="8187149">.</span><span class="ident" id="8187150">reqCanceler</span><span class="op" id="8187161">)</span><br>
<span class="lineno"></span><span class="op" id="8187163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8187166">func</span>&nbsp;<span class="op" id="8187171">(</span><span class="ident" id="8187172">t</span>&nbsp;<span class="op" id="8187174">*</span><span class="ident" id="8187175">Transport</span><span class="op" id="8187184">)</span>&nbsp;<span class="ident" id="8187186">IdleConnKeysForTesting</span><span class="op" id="8187208">(</span><span class="op" id="8187209">)</span>&nbsp;<span class="op" id="8187211">(</span><span class="ident" id="8187212">keys</span>&nbsp;<span class="op" id="8187217">[</span><span class="op" id="8187218">]</span><span class="builtintype" id="8187219">string</span><span class="op" id="8187225">)</span>&nbsp;<span class="op" id="8187227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187230">keys</span>&nbsp;<span class="op" id="8187235">=</span>&nbsp;<span class="builtinfunc" id="8187237">make</span><span class="op" id="8187241">(</span><span class="op" id="8187242">[</span><span class="op" id="8187243">]</span><span class="builtintype" id="8187244">string</span><span class="op" id="8187250">,</span>&nbsp;<span class="num" id="8187252">0</span><span class="op" id="8187253">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187256">t</span><span class="op" id="8187257">.</span><span class="ident" id="8187258">idleMu</span><span class="op" id="8187264">.</span><span class="ident" id="8187265">Lock</span><span class="op" id="8187269">(</span><span class="op" id="8187270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187273">defer</span>&nbsp;<span class="ident" id="8187279">t</span><span class="op" id="8187280">.</span><span class="ident" id="8187281">idleMu</span><span class="op" id="8187287">.</span><span class="ident" id="8187288">Unlock</span><span class="op" id="8187294">(</span><span class="op" id="8187295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187298">if</span>&nbsp;<span class="ident" id="8187301">t</span><span class="op" id="8187302">.</span><span class="ident" id="8187303">idleConn</span>&nbsp;<span class="op" id="8187312">==</span>&nbsp;<span class="ident" id="8187315">nil</span>&nbsp;<span class="op" id="8187319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187323">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187331">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187334">for</span>&nbsp;<span class="ident" id="8187338">key</span>&nbsp;<span class="op" id="8187342">:=</span>&nbsp;<span class="keyword" id="8187345">range</span>&nbsp;<span class="ident" id="8187351">t</span><span class="op" id="8187352">.</span><span class="ident" id="8187353">idleConn</span>&nbsp;<span class="op" id="8187362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187366">keys</span>&nbsp;<span class="op" id="8187371">=</span>&nbsp;<span class="builtinfunc" id="8187373">append</span><span class="op" id="8187379">(</span><span class="ident" id="8187380">keys</span><span class="op" id="8187384">,</span>&nbsp;<span class="ident" id="8187386">key</span><span class="op" id="8187389">.</span><span class="ident" id="8187390">String</span><span class="op" id="8187396">(</span><span class="op" id="8187397">)</span><span class="op" id="8187398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187404">return</span><br>
<span class="lineno"></span><span class="op" id="8187411">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="8187414">func</span>&nbsp;<span class="op" id="8187419">(</span><span class="ident" id="8187420">t</span>&nbsp;<span class="op" id="8187422">*</span><span class="ident" id="8187423">Transport</span><span class="op" id="8187432">)</span>&nbsp;<span class="ident" id="8187434">IdleConnCountForTesting</span><span class="op" id="8187457">(</span><span class="ident" id="8187458">cacheKey</span>&nbsp;<span class="builtintype" id="8187467">string</span><span class="op" id="8187473">)</span>&nbsp;<span class="builtintype" id="8187475">int</span>&nbsp;<span class="op" id="8187479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187482">t</span><span class="op" id="8187483">.</span><span class="ident" id="8187484">idleMu</span><span class="op" id="8187490">.</span><span class="ident" id="8187491">Lock</span><span class="op" id="8187495">(</span><span class="op" id="8187496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187499">defer</span>&nbsp;<span class="ident" id="8187505">t</span><span class="op" id="8187506">.</span><span class="ident" id="8187507">idleMu</span><span class="op" id="8187513">.</span><span class="ident" id="8187514">Unlock</span><span class="op" id="8187520">(</span><span class="op" id="8187521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187524">if</span>&nbsp;<span class="ident" id="8187527">t</span><span class="op" id="8187528">.</span><span class="ident" id="8187529">idleConn</span>&nbsp;<span class="op" id="8187538">==</span>&nbsp;<span class="ident" id="8187541">nil</span>&nbsp;<span class="op" id="8187545">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187549">return</span>&nbsp;<span class="num" id="8187556">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187562">for</span>&nbsp;<span class="ident" id="8187566">k</span><span class="op" id="8187567">,</span>&nbsp;<span class="ident" id="8187569">conns</span>&nbsp;<span class="op" id="8187575">:=</span>&nbsp;<span class="keyword" id="8187578">range</span>&nbsp;<span class="ident" id="8187584">t</span><span class="op" id="8187585">.</span><span class="ident" id="8187586">idleConn</span>&nbsp;<span class="op" id="8187595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187599">if</span>&nbsp;<span class="ident" id="8187602">k</span><span class="op" id="8187603">.</span><span class="ident" id="8187604">String</span><span class="op" id="8187610">(</span><span class="op" id="8187611">)</span>&nbsp;<span class="op" id="8187613">==</span>&nbsp;<span class="ident" id="8187616">cacheKey</span>&nbsp;<span class="op" id="8187625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187630">return</span>&nbsp;<span class="builtinfunc" id="8187637">len</span><span class="op" id="8187640">(</span><span class="ident" id="8187641">conns</span><span class="op" id="8187646">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8187653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187656">return</span>&nbsp;<span class="num" id="8187663">0</span><br>
<span class="lineno"></span><span class="op" id="8187665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="8187668">func</span>&nbsp;<span class="op" id="8187673">(</span><span class="ident" id="8187674">t</span>&nbsp;<span class="op" id="8187676">*</span><span class="ident" id="8187677">Transport</span><span class="op" id="8187686">)</span>&nbsp;<span class="ident" id="8187688">IdleConnChMapSizeForTesting</span><span class="op" id="8187715">(</span><span class="op" id="8187716">)</span>&nbsp;<span class="builtintype" id="8187718">int</span>&nbsp;<span class="op" id="8187722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187725">t</span><span class="op" id="8187726">.</span><span class="ident" id="8187727">idleMu</span><span class="op" id="8187733">.</span><span class="ident" id="8187734">Lock</span><span class="op" id="8187738">(</span><span class="op" id="8187739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187742">defer</span>&nbsp;<span class="ident" id="8187748">t</span><span class="op" id="8187749">.</span><span class="ident" id="8187750">idleMu</span><span class="op" id="8187756">.</span><span class="ident" id="8187757">Unlock</span><span class="op" id="8187763">(</span><span class="op" id="8187764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187767">return</span>&nbsp;<span class="builtinfunc" id="8187774">len</span><span class="op" id="8187777">(</span><span class="ident" id="8187778">t</span><span class="op" id="8187779">.</span><span class="ident" id="8187780">idleConnCh</span><span class="op" id="8187790">)</span><br>
<span class="lineno"></span><span class="op" id="8187792">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="8187795">func</span>&nbsp;<span class="op" id="8187800">(</span><span class="ident" id="8187801">t</span>&nbsp;<span class="op" id="8187803">*</span><span class="ident" id="8187804">Transport</span><span class="op" id="8187813">)</span>&nbsp;<span class="ident" id="8187815">IsIdleForTesting</span><span class="op" id="8187831">(</span><span class="op" id="8187832">)</span>&nbsp;<span class="builtintype" id="8187834">bool</span>&nbsp;<span class="op" id="8187839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187842">t</span><span class="op" id="8187843">.</span><span class="ident" id="8187844">idleMu</span><span class="op" id="8187850">.</span><span class="ident" id="8187851">Lock</span><span class="op" id="8187855">(</span><span class="op" id="8187856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187859">defer</span>&nbsp;<span class="ident" id="8187865">t</span><span class="op" id="8187866">.</span><span class="ident" id="8187867">idleMu</span><span class="op" id="8187873">.</span><span class="ident" id="8187874">Unlock</span><span class="op" id="8187880">(</span><span class="op" id="8187881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8187884">return</span>&nbsp;<span class="ident" id="8187891">t</span><span class="op" id="8187892">.</span><span class="ident" id="8187893">wantIdle</span><br>
<span class="lineno">65</span><span class="op" id="8187902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8187905">func</span>&nbsp;<span class="op" id="8187910">(</span><span class="ident" id="8187911">t</span>&nbsp;<span class="op" id="8187913">*</span><span class="ident" id="8187914">Transport</span><span class="op" id="8187923">)</span>&nbsp;<span class="ident" id="8187925">RequestIdleConnChForTesting</span><span class="op" id="8187952">(</span><span class="op" id="8187953">)</span>&nbsp;<span class="op" id="8187955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8187958">t</span><span class="op" id="8187959">.</span><span class="ident" id="8187960">getIdleConnCh</span><span class="op" id="8187973">(</span><span class="ident" id="8187974">connectMethod</span><span class="op" id="8187987">{</span><span class="ident" id="8187988">nil</span><span class="op" id="8187991">,</span>&nbsp;<span class="string" id="8187993">&#34;http&#34;</span><span class="op" id="8187999">,</span>&nbsp;<span class="string" id="8188001">&#34;example.com&#34;</span><span class="op" id="8188014">}</span><span class="op" id="8188015">)</span><br>
<span class="lineno"></span><span class="op" id="8188017">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="8188020">func</span>&nbsp;<span class="op" id="8188025">(</span><span class="ident" id="8188026">t</span>&nbsp;<span class="op" id="8188028">*</span><span class="ident" id="8188029">Transport</span><span class="op" id="8188038">)</span>&nbsp;<span class="ident" id="8188040">PutIdleTestConn</span><span class="op" id="8188055">(</span><span class="op" id="8188056">)</span>&nbsp;<span class="builtintype" id="8188058">bool</span>&nbsp;<span class="op" id="8188063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188066">c</span><span class="op" id="8188067">,</span>&nbsp;<span class="ident" id="8188069">_</span>&nbsp;<span class="op" id="8188071">:=</span>&nbsp;<span class="ident" id="8188074">net</span><span class="op" id="8188077">.</span><span class="ident" id="8188078">Pipe</span><span class="op" id="8188082">(</span><span class="op" id="8188083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188086">return</span>&nbsp;<span class="ident" id="8188093">t</span><span class="op" id="8188094">.</span><span class="ident" id="8188095">putIdleConn</span><span class="op" id="8188106">(</span><span class="op" id="8188107">&amp;</span><span class="ident" id="8188108">persistConn</span><span class="op" id="8188119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188123">t</span><span class="op" id="8188124">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8188133">t</span><span class="op" id="8188134">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188138">conn</span><span class="op" id="8188142">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8188148">c</span><span class="op" id="8188149">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8188169">//&nbsp;dummy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188180">closech</span><span class="op" id="8188187">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="8188190">make</span><span class="op" id="8188194">(</span><span class="keyword" id="8188195">chan</span>&nbsp;<span class="keyword" id="8188200">struct</span><span class="op" id="8188206">{</span><span class="op" id="8188207">}</span><span class="op" id="8188208">)</span><span class="op" id="8188209">,</span>&nbsp;<span class="comment" id="8188211">//&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188236">cacheKey</span><span class="op" id="8188244">:</span>&nbsp;<span class="ident" id="8188246">connectMethodKey</span><span class="op" id="8188262">{</span><span class="string" id="8188263">&#34;&#34;</span><span class="op" id="8188265">,</span>&nbsp;<span class="string" id="8188267">&#34;http&#34;</span><span class="op" id="8188273">,</span>&nbsp;<span class="string" id="8188275">&#34;example.com&#34;</span><span class="op" id="8188288">}</span><span class="op" id="8188289">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188292">}</span><span class="op" id="8188293">)</span><br>
<span class="lineno"></span><span class="op" id="8188295">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="8188298">func</span>&nbsp;<span class="ident" id="8188303">NewTestTimeoutHandler</span><span class="op" id="8188324">(</span><span class="ident" id="8188325">handler</span>&nbsp;<span class="ident" id="8188333">Handler</span><span class="op" id="8188340">,</span>&nbsp;<span class="ident" id="8188342">ch</span>&nbsp;<span class="op" id="8188345">&lt;-</span><span class="keyword" id="8188347">chan</span>&nbsp;<span class="ident" id="8188352">time</span><span class="op" id="8188356">.</span><span class="ident" id="8188357">Time</span><span class="op" id="8188361">)</span>&nbsp;<span class="ident" id="8188363">Handler</span>&nbsp;<span class="op" id="8188371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188374">f</span>&nbsp;<span class="op" id="8188376">:=</span>&nbsp;<span class="keyword" id="8188379">func</span><span class="op" id="8188383">(</span><span class="op" id="8188384">)</span>&nbsp;<span class="op" id="8188386">&lt;-</span><span class="keyword" id="8188388">chan</span>&nbsp;<span class="ident" id="8188393">time</span><span class="op" id="8188397">.</span><span class="ident" id="8188398">Time</span>&nbsp;<span class="op" id="8188403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188407">return</span>&nbsp;<span class="ident" id="8188414">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8188418">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188421">return</span>&nbsp;<span class="op" id="8188428">&amp;</span><span class="ident" id="8188429">timeoutHandler</span><span class="op" id="8188443">{</span><span class="ident" id="8188444">handler</span><span class="op" id="8188451">,</span>&nbsp;<span class="ident" id="8188453">f</span><span class="op" id="8188454">,</span>&nbsp;<span class="string" id="8188456">&#34;&#34;</span><span class="op" id="8188458">}</span><br>
<span class="lineno"></span><span class="op" id="8188460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8188463">func</span>&nbsp;<span class="ident" id="8188468">ResetCachedEnvironment</span><span class="op" id="8188490">(</span><span class="op" id="8188491">)</span>&nbsp;<span class="op" id="8188493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188496">httpProxyEnv</span><span class="op" id="8188508">.</span><span class="ident" id="8188509">reset</span><span class="op" id="8188514">(</span><span class="op" id="8188515">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188518">httpsProxyEnv</span><span class="op" id="8188531">.</span><span class="ident" id="8188532">reset</span><span class="op" id="8188537">(</span><span class="op" id="8188538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188541">noProxyEnv</span><span class="op" id="8188551">.</span><span class="ident" id="8188552">reset</span><span class="op" id="8188557">(</span><span class="op" id="8188558">)</span><br>
<span class="lineno"></span><span class="op" id="8188560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8188563">var</span>&nbsp;<span class="ident" id="8188567">DefaultUserAgent</span>&nbsp;<span class="op" id="8188584">=</span>&nbsp;<span class="ident" id="8188586">defaultUserAgent</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="8188604">func</span>&nbsp;<span class="ident" id="8188609">ExportRefererForURL</span><span class="op" id="8188628">(</span><span class="ident" id="8188629">lastReq</span><span class="op" id="8188636">,</span>&nbsp;<span class="ident" id="8188638">newReq</span>&nbsp;<span class="op" id="8188645">*</span><span class="ident" id="8188646">url</span><span class="op" id="8188649">.</span><span class="ident" id="8188650">URL</span><span class="op" id="8188653">)</span>&nbsp;<span class="builtintype" id="8188655">string</span>&nbsp;<span class="op" id="8188662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8188665">return</span>&nbsp;<span class="ident" id="8188672">refererForURL</span><span class="op" id="8188685">(</span><span class="ident" id="8188686">lastReq</span><span class="op" id="8188693">,</span>&nbsp;<span class="ident" id="8188695">newReq</span><span class="op" id="8188701">)</span><br>
<span class="lineno"></span><span class="op" id="8188703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="8188706">//&nbsp;SetPendingDialHooks&nbsp;sets&nbsp;the&nbsp;hooks&nbsp;that&nbsp;run&nbsp;before&nbsp;and&nbsp;after&nbsp;handling</span><br>
<span class="lineno"></span><span class="comment" id="8188779">//&nbsp;pending&nbsp;dials.</span><br>
<span class="lineno"></span><span class="keyword" id="8188797">func</span>&nbsp;<span class="ident" id="8188802">SetPendingDialHooks</span><span class="op" id="8188821">(</span><span class="ident" id="8188822">before</span><span class="op" id="8188828">,</span>&nbsp;<span class="ident" id="8188830">after</span>&nbsp;<span class="keyword" id="8188836">func</span><span class="op" id="8188840">(</span><span class="op" id="8188841">)</span><span class="op" id="8188842">)</span>&nbsp;<span class="op" id="8188844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8188847">prePendingDial</span><span class="op" id="8188861">,</span>&nbsp;<span class="ident" id="8188863">postPendingDial</span>&nbsp;<span class="op" id="8188879">=</span>&nbsp;<span class="ident" id="8188881">before</span><span class="op" id="8188887">,</span>&nbsp;<span class="ident" id="8188889">after</span><br>
<span class="lineno"></span><span class="op" id="8188895">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="8188898">var</span>&nbsp;<span class="ident" id="8188902">ExportServerNewConn</span>&nbsp;<span class="op" id="8188922">=</span>&nbsp;<span class="op" id="8188924">(</span><span class="op" id="8188925">*</span><span class="ident" id="8188926">Server</span><span class="op" id="8188932">)</span><span class="op" id="8188933">.</span><span class="ident" id="8188934">newConn</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8188943">var</span>&nbsp;<span class="ident" id="8188947">ExportCloseWriteAndWait</span>&nbsp;<span class="op" id="8188971">=</span>&nbsp;<span class="op" id="8188973">(</span><span class="op" id="8188974">*</span><span class="ident" id="8188975">conn</span><span class="op" id="8188979">)</span><span class="op" id="8188980">.</span><span class="ident" id="8188981">closeWriteAndWait</span>
</div>
</body>
</html>
