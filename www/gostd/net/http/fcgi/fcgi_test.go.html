<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/fcgi</h2>
<ul>
<li><a href="/gostd/net/http/fcgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi.go.html">fcgi.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi_test.go.html">fcgi_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7520113">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7520168">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7520222">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7520273">package</span>&nbsp;<span class="ident" id="7520281">fcgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7520287">import</span>&nbsp;<span class="op" id="7520294">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7520297">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7520306">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7520316">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7520322">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7520332">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7520335">var</span>&nbsp;<span class="ident" id="7520339">sizeTests</span>&nbsp;<span class="op" id="7520349">=</span>&nbsp;<span class="op" id="7520351">[</span><span class="op" id="7520352">]</span><span class="keyword" id="7520353">struct</span>&nbsp;<span class="op" id="7520360">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520363">size</span>&nbsp;&nbsp;<span class="builtintype" id="7520369">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520377">bytes</span>&nbsp;<span class="op" id="7520383">[</span><span class="op" id="7520384">]</span><span class="builtintype" id="7520385">byte</span><br>
<span class="lineno"></span><span class="op" id="7520390">}</span><span class="op" id="7520391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520394">{</span><span class="num" id="7520395">0</span><span class="op" id="7520396">,</span>&nbsp;<span class="op" id="7520398">[</span><span class="op" id="7520399">]</span><span class="builtintype" id="7520400">byte</span><span class="op" id="7520404">{</span><span class="num" id="7520405">0x00</span><span class="op" id="7520409">}</span><span class="op" id="7520410">}</span><span class="op" id="7520411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520414">{</span><span class="num" id="7520415">127</span><span class="op" id="7520418">,</span>&nbsp;<span class="op" id="7520420">[</span><span class="op" id="7520421">]</span><span class="builtintype" id="7520422">byte</span><span class="op" id="7520426">{</span><span class="num" id="7520427">0x7F</span><span class="op" id="7520431">}</span><span class="op" id="7520432">}</span><span class="op" id="7520433">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520436">{</span><span class="num" id="7520437">128</span><span class="op" id="7520440">,</span>&nbsp;<span class="op" id="7520442">[</span><span class="op" id="7520443">]</span><span class="builtintype" id="7520444">byte</span><span class="op" id="7520448">{</span><span class="num" id="7520449">0x80</span><span class="op" id="7520453">,</span>&nbsp;<span class="num" id="7520455">0x00</span><span class="op" id="7520459">,</span>&nbsp;<span class="num" id="7520461">0x00</span><span class="op" id="7520465">,</span>&nbsp;<span class="num" id="7520467">0x80</span><span class="op" id="7520471">}</span><span class="op" id="7520472">}</span><span class="op" id="7520473">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520476">{</span><span class="num" id="7520477">1000</span><span class="op" id="7520481">,</span>&nbsp;<span class="op" id="7520483">[</span><span class="op" id="7520484">]</span><span class="builtintype" id="7520485">byte</span><span class="op" id="7520489">{</span><span class="num" id="7520490">0x80</span><span class="op" id="7520494">,</span>&nbsp;<span class="num" id="7520496">0x00</span><span class="op" id="7520500">,</span>&nbsp;<span class="num" id="7520502">0x03</span><span class="op" id="7520506">,</span>&nbsp;<span class="num" id="7520508">0xE8</span><span class="op" id="7520512">}</span><span class="op" id="7520513">}</span><span class="op" id="7520514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520517">{</span><span class="num" id="7520518">33554431</span><span class="op" id="7520526">,</span>&nbsp;<span class="op" id="7520528">[</span><span class="op" id="7520529">]</span><span class="builtintype" id="7520530">byte</span><span class="op" id="7520534">{</span><span class="num" id="7520535">0x81</span><span class="op" id="7520539">,</span>&nbsp;<span class="num" id="7520541">0xFF</span><span class="op" id="7520545">,</span>&nbsp;<span class="num" id="7520547">0xFF</span><span class="op" id="7520551">,</span>&nbsp;<span class="num" id="7520553">0xFF</span><span class="op" id="7520557">}</span><span class="op" id="7520558">}</span><span class="op" id="7520559">,</span><br>
<span class="lineno"></span><span class="op" id="7520561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7520564">func</span>&nbsp;<span class="ident" id="7520569">TestSize</span><span class="op" id="7520577">(</span><span class="ident" id="7520578">t</span>&nbsp;<span class="op" id="7520580">*</span><span class="ident" id="7520581">testing</span><span class="op" id="7520588">.</span><span class="ident" id="7520589">T</span><span class="op" id="7520590">)</span>&nbsp;<span class="op" id="7520592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520595">b</span>&nbsp;<span class="op" id="7520597">:=</span>&nbsp;<span class="builtinfunc" id="7520600">make</span><span class="op" id="7520604">(</span><span class="op" id="7520605">[</span><span class="op" id="7520606">]</span><span class="builtintype" id="7520607">byte</span><span class="op" id="7520611">,</span>&nbsp;<span class="num" id="7520613">4</span><span class="op" id="7520614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520617">for</span>&nbsp;<span class="ident" id="7520621">i</span><span class="op" id="7520622">,</span>&nbsp;<span class="ident" id="7520624">test</span>&nbsp;<span class="op" id="7520629">:=</span>&nbsp;<span class="keyword" id="7520632">range</span>&nbsp;<span class="ident" id="7520638">sizeTests</span>&nbsp;<span class="op" id="7520648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520652">n</span>&nbsp;<span class="op" id="7520654">:=</span>&nbsp;<span class="ident" id="7520657">encodeSize</span><span class="op" id="7520667">(</span><span class="ident" id="7520668">b</span><span class="op" id="7520669">,</span>&nbsp;<span class="ident" id="7520671">test</span><span class="op" id="7520675">.</span><span class="ident" id="7520676">size</span><span class="op" id="7520680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520684">if</span>&nbsp;<span class="op" id="7520687">!</span><span class="ident" id="7520688">bytes</span><span class="op" id="7520693">.</span><span class="ident" id="7520694">Equal</span><span class="op" id="7520699">(</span><span class="ident" id="7520700">b</span><span class="op" id="7520701">[</span><span class="op" id="7520702">:</span><span class="ident" id="7520703">n</span><span class="op" id="7520704">]</span><span class="op" id="7520705">,</span>&nbsp;<span class="ident" id="7520707">test</span><span class="op" id="7520711">.</span><span class="ident" id="7520712">bytes</span><span class="op" id="7520717">)</span>&nbsp;<span class="op" id="7520719">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520724">t</span><span class="op" id="7520725">.</span><span class="ident" id="7520726">Errorf</span><span class="op" id="7520732">(</span><span class="string" id="7520733">&#34;%d&nbsp;expected&nbsp;%x,&nbsp;encoded&nbsp;%x&#34;</span><span class="op" id="7520761">,</span>&nbsp;<span class="ident" id="7520763">i</span><span class="op" id="7520764">,</span>&nbsp;<span class="ident" id="7520766">test</span><span class="op" id="7520770">.</span><span class="ident" id="7520771">bytes</span><span class="op" id="7520776">,</span>&nbsp;<span class="ident" id="7520778">b</span><span class="op" id="7520779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520787">size</span><span class="op" id="7520791">,</span>&nbsp;<span class="ident" id="7520793">n</span>&nbsp;<span class="op" id="7520795">:=</span>&nbsp;<span class="ident" id="7520798">readSize</span><span class="op" id="7520806">(</span><span class="ident" id="7520807">test</span><span class="op" id="7520811">.</span><span class="ident" id="7520812">bytes</span><span class="op" id="7520817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520821">if</span>&nbsp;<span class="ident" id="7520824">size</span>&nbsp;<span class="op" id="7520829">!=</span>&nbsp;<span class="ident" id="7520832">test</span><span class="op" id="7520836">.</span><span class="ident" id="7520837">size</span>&nbsp;<span class="op" id="7520842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520847">t</span><span class="op" id="7520848">.</span><span class="ident" id="7520849">Errorf</span><span class="op" id="7520855">(</span><span class="string" id="7520856">&#34;%d&nbsp;expected&nbsp;%d,&nbsp;read&nbsp;%d&#34;</span><span class="op" id="7520881">,</span>&nbsp;<span class="ident" id="7520883">i</span><span class="op" id="7520884">,</span>&nbsp;<span class="ident" id="7520886">test</span><span class="op" id="7520890">.</span><span class="ident" id="7520891">size</span><span class="op" id="7520895">,</span>&nbsp;<span class="ident" id="7520897">size</span><span class="op" id="7520901">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520909">if</span>&nbsp;<span class="builtinfunc" id="7520912">len</span><span class="op" id="7520915">(</span><span class="ident" id="7520916">test</span><span class="op" id="7520920">.</span><span class="ident" id="7520921">bytes</span><span class="op" id="7520926">)</span>&nbsp;<span class="op" id="7520928">!=</span>&nbsp;<span class="ident" id="7520931">n</span>&nbsp;<span class="op" id="7520933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7520938">t</span><span class="op" id="7520939">.</span><span class="ident" id="7520940">Errorf</span><span class="op" id="7520946">(</span><span class="string" id="7520947">&#34;%d&nbsp;did&nbsp;not&nbsp;consume&nbsp;all&nbsp;the&nbsp;bytes&#34;</span><span class="op" id="7520981">,</span>&nbsp;<span class="ident" id="7520983">i</span><span class="op" id="7520984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7520991">}</span><br>
<span class="lineno">40</span><span class="op" id="7520993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7520996">var</span>&nbsp;<span class="ident" id="7521000">streamTests</span>&nbsp;<span class="op" id="7521012">=</span>&nbsp;<span class="op" id="7521014">[</span><span class="op" id="7521015">]</span><span class="keyword" id="7521016">struct</span>&nbsp;<span class="op" id="7521023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521026">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7521034">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521042">recType</span>&nbsp;<span class="ident" id="7521050">recType</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521059">reqId</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7521067">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521075">content</span>&nbsp;<span class="op" id="7521083">[</span><span class="op" id="7521084">]</span><span class="builtintype" id="7521085">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521091">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7521099">[</span><span class="op" id="7521100">]</span><span class="builtintype" id="7521101">byte</span><br>
<span class="lineno"></span><span class="op" id="7521106">}</span><span class="op" id="7521107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521110">{</span><span class="string" id="7521111">&#34;single&nbsp;record&#34;</span><span class="op" id="7521126">,</span>&nbsp;<span class="ident" id="7521128">typeStdout</span><span class="op" id="7521138">,</span>&nbsp;<span class="num" id="7521140">1</span><span class="op" id="7521141">,</span>&nbsp;<span class="ident" id="7521143">nil</span><span class="op" id="7521146">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521150">[</span><span class="op" id="7521151">]</span><span class="builtintype" id="7521152">byte</span><span class="op" id="7521156">{</span><span class="num" id="7521157">1</span><span class="op" id="7521158">,</span>&nbsp;<span class="builtintype" id="7521160">byte</span><span class="op" id="7521164">(</span><span class="ident" id="7521165">typeStdout</span><span class="op" id="7521175">)</span><span class="op" id="7521176">,</span>&nbsp;<span class="num" id="7521178">0</span><span class="op" id="7521179">,</span>&nbsp;<span class="num" id="7521181">1</span><span class="op" id="7521182">,</span>&nbsp;<span class="num" id="7521184">0</span><span class="op" id="7521185">,</span>&nbsp;<span class="num" id="7521187">0</span><span class="op" id="7521188">,</span>&nbsp;<span class="num" id="7521190">0</span><span class="op" id="7521191">,</span>&nbsp;<span class="num" id="7521193">0</span><span class="op" id="7521194">}</span><span class="op" id="7521195">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521198">}</span><span class="op" id="7521199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7521202">//&nbsp;this&nbsp;data&nbsp;will&nbsp;have&nbsp;to&nbsp;be&nbsp;split&nbsp;into&nbsp;two&nbsp;records</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521255">{</span><span class="string" id="7521256">&#34;two&nbsp;records&#34;</span><span class="op" id="7521269">,</span>&nbsp;<span class="ident" id="7521271">typeStdin</span><span class="op" id="7521280">,</span>&nbsp;<span class="num" id="7521282">300</span><span class="op" id="7521285">,</span>&nbsp;<span class="builtinfunc" id="7521287">make</span><span class="op" id="7521291">(</span><span class="op" id="7521292">[</span><span class="op" id="7521293">]</span><span class="builtintype" id="7521294">byte</span><span class="op" id="7521298">,</span>&nbsp;<span class="num" id="7521300">66000</span><span class="op" id="7521305">)</span><span class="op" id="7521306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521310">bytes</span><span class="op" id="7521315">.</span><span class="ident" id="7521316">Join</span><span class="op" id="7521320">(</span><span class="op" id="7521321">[</span><span class="op" id="7521322">]</span><span class="op" id="7521323">[</span><span class="op" id="7521324">]</span><span class="builtintype" id="7521325">byte</span><span class="op" id="7521329">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7521334">//&nbsp;header&nbsp;for&nbsp;the&nbsp;first&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521368">{</span><span class="num" id="7521369">1</span><span class="op" id="7521370">,</span>&nbsp;<span class="builtintype" id="7521372">byte</span><span class="op" id="7521376">(</span><span class="ident" id="7521377">typeStdin</span><span class="op" id="7521386">)</span><span class="op" id="7521387">,</span>&nbsp;<span class="num" id="7521389">0x01</span><span class="op" id="7521393">,</span>&nbsp;<span class="num" id="7521395">0x2C</span><span class="op" id="7521399">,</span>&nbsp;<span class="num" id="7521401">0xFF</span><span class="op" id="7521405">,</span>&nbsp;<span class="num" id="7521407">0xFF</span><span class="op" id="7521411">,</span>&nbsp;<span class="num" id="7521413">1</span><span class="op" id="7521414">,</span>&nbsp;<span class="num" id="7521416">0</span><span class="op" id="7521417">}</span><span class="op" id="7521418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7521423">make</span><span class="op" id="7521427">(</span><span class="op" id="7521428">[</span><span class="op" id="7521429">]</span><span class="builtintype" id="7521430">byte</span><span class="op" id="7521434">,</span>&nbsp;<span class="num" id="7521436">65536</span><span class="op" id="7521441">)</span><span class="op" id="7521442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7521447">//&nbsp;header&nbsp;for&nbsp;the&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521475">{</span><span class="num" id="7521476">1</span><span class="op" id="7521477">,</span>&nbsp;<span class="builtintype" id="7521479">byte</span><span class="op" id="7521483">(</span><span class="ident" id="7521484">typeStdin</span><span class="op" id="7521493">)</span><span class="op" id="7521494">,</span>&nbsp;<span class="num" id="7521496">0x01</span><span class="op" id="7521500">,</span>&nbsp;<span class="num" id="7521502">0x2C</span><span class="op" id="7521506">,</span>&nbsp;<span class="num" id="7521508">0x01</span><span class="op" id="7521512">,</span>&nbsp;<span class="num" id="7521514">0xD1</span><span class="op" id="7521518">,</span>&nbsp;<span class="num" id="7521520">7</span><span class="op" id="7521521">,</span>&nbsp;<span class="num" id="7521523">0</span><span class="op" id="7521524">}</span><span class="op" id="7521525">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7521530">make</span><span class="op" id="7521534">(</span><span class="op" id="7521535">[</span><span class="op" id="7521536">]</span><span class="builtintype" id="7521537">byte</span><span class="op" id="7521541">,</span>&nbsp;<span class="num" id="7521543">472</span><span class="op" id="7521546">)</span><span class="op" id="7521547">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7521552">//&nbsp;header&nbsp;for&nbsp;the&nbsp;empty&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521586">{</span><span class="num" id="7521587">1</span><span class="op" id="7521588">,</span>&nbsp;<span class="builtintype" id="7521590">byte</span><span class="op" id="7521594">(</span><span class="ident" id="7521595">typeStdin</span><span class="op" id="7521604">)</span><span class="op" id="7521605">,</span>&nbsp;<span class="num" id="7521607">0x01</span><span class="op" id="7521611">,</span>&nbsp;<span class="num" id="7521613">0x2C</span><span class="op" id="7521617">,</span>&nbsp;<span class="num" id="7521619">0</span><span class="op" id="7521620">,</span>&nbsp;<span class="num" id="7521622">0</span><span class="op" id="7521623">,</span>&nbsp;<span class="num" id="7521625">0</span><span class="op" id="7521626">,</span>&nbsp;<span class="num" id="7521628">0</span><span class="op" id="7521629">}</span><span class="op" id="7521630">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521634">}</span><span class="op" id="7521635">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521640">nil</span><span class="op" id="7521643">)</span><span class="op" id="7521644">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521647">}</span><span class="op" id="7521648">,</span><br>
<span class="lineno"></span><span class="op" id="7521650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7521653">type</span>&nbsp;<span class="ident" id="7521658">nilCloser</span>&nbsp;<span class="keyword" id="7521668">struct</span>&nbsp;<span class="op" id="7521675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521678">io</span><span class="op" id="7521680">.</span><span class="ident" id="7521681">ReadWriter</span><br>
<span class="lineno">70</span><span class="op" id="7521692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7521695">func</span>&nbsp;<span class="op" id="7521700">(</span><span class="ident" id="7521701">c</span>&nbsp;<span class="op" id="7521703">*</span><span class="ident" id="7521704">nilCloser</span><span class="op" id="7521713">)</span>&nbsp;<span class="ident" id="7521715">Close</span><span class="op" id="7521720">(</span><span class="op" id="7521721">)</span>&nbsp;<span class="builtintype" id="7521723">error</span>&nbsp;<span class="op" id="7521729">{</span>&nbsp;<span class="keyword" id="7521731">return</span>&nbsp;<span class="ident" id="7521738">nil</span>&nbsp;<span class="op" id="7521742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7521745">func</span>&nbsp;<span class="ident" id="7521750">TestStreams</span><span class="op" id="7521761">(</span><span class="ident" id="7521762">t</span>&nbsp;<span class="op" id="7521764">*</span><span class="ident" id="7521765">testing</span><span class="op" id="7521772">.</span><span class="ident" id="7521773">T</span><span class="op" id="7521774">)</span>&nbsp;<span class="op" id="7521776">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521779">var</span>&nbsp;<span class="ident" id="7521783">rec</span>&nbsp;<span class="ident" id="7521787">record</span><br>
<span class="lineno"></span><span class="ident" id="7521794">outer</span><span class="op" id="7521799">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521802">for</span>&nbsp;<span class="ident" id="7521806">_</span><span class="op" id="7521807">,</span>&nbsp;<span class="ident" id="7521809">test</span>&nbsp;<span class="op" id="7521814">:=</span>&nbsp;<span class="keyword" id="7521817">range</span>&nbsp;<span class="ident" id="7521823">streamTests</span>&nbsp;<span class="op" id="7521835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521839">buf</span>&nbsp;<span class="op" id="7521843">:=</span>&nbsp;<span class="ident" id="7521846">bytes</span><span class="op" id="7521851">.</span><span class="ident" id="7521852">NewBuffer</span><span class="op" id="7521861">(</span><span class="ident" id="7521862">test</span><span class="op" id="7521866">.</span><span class="ident" id="7521867">raw</span><span class="op" id="7521870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521874">var</span>&nbsp;<span class="ident" id="7521878">content</span>&nbsp;<span class="op" id="7521886">[</span><span class="op" id="7521887">]</span><span class="builtintype" id="7521888">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521895">for</span>&nbsp;<span class="ident" id="7521899">buf</span><span class="op" id="7521902">.</span><span class="ident" id="7521903">Len</span><span class="op" id="7521906">(</span><span class="op" id="7521907">)</span>&nbsp;<span class="op" id="7521909">&gt;</span>&nbsp;<span class="num" id="7521911">0</span>&nbsp;<span class="op" id="7521913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521918">if</span>&nbsp;<span class="ident" id="7521921">err</span>&nbsp;<span class="op" id="7521925">:=</span>&nbsp;<span class="ident" id="7521928">rec</span><span class="op" id="7521931">.</span><span class="ident" id="7521932">read</span><span class="op" id="7521936">(</span><span class="ident" id="7521937">buf</span><span class="op" id="7521940">)</span><span class="op" id="7521941">;</span>&nbsp;<span class="ident" id="7521943">err</span>&nbsp;<span class="op" id="7521947">!=</span>&nbsp;<span class="ident" id="7521950">nil</span>&nbsp;<span class="op" id="7521954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521960">t</span><span class="op" id="7521961">.</span><span class="ident" id="7521962">Errorf</span><span class="op" id="7521968">(</span><span class="string" id="7521969">&#34;%s:&nbsp;error&nbsp;reading&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="7521999">,</span>&nbsp;<span class="ident" id="7522001">test</span><span class="op" id="7522005">.</span><span class="ident" id="7522006">desc</span><span class="op" id="7522010">,</span>&nbsp;<span class="ident" id="7522012">err</span><span class="op" id="7522015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522021">continue</span>&nbsp;<span class="ident" id="7522030">outer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522039">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522044">content</span>&nbsp;<span class="op" id="7522052">=</span>&nbsp;<span class="builtinfunc" id="7522054">append</span><span class="op" id="7522060">(</span><span class="ident" id="7522061">content</span><span class="op" id="7522068">,</span>&nbsp;<span class="ident" id="7522070">rec</span><span class="op" id="7522073">.</span><span class="ident" id="7522074">content</span><span class="op" id="7522081">(</span><span class="op" id="7522082">)</span><span class="op" id="7522083">...</span><span class="op" id="7522086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522094">if</span>&nbsp;<span class="ident" id="7522097">rec</span><span class="op" id="7522100">.</span><span class="ident" id="7522101">h</span><span class="op" id="7522102">.</span><span class="ident" id="7522103">Type</span>&nbsp;<span class="op" id="7522108">!=</span>&nbsp;<span class="ident" id="7522111">test</span><span class="op" id="7522115">.</span><span class="ident" id="7522116">recType</span>&nbsp;<span class="op" id="7522124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522129">t</span><span class="op" id="7522130">.</span><span class="ident" id="7522131">Errorf</span><span class="op" id="7522137">(</span><span class="string" id="7522138">&#34;%s:&nbsp;got&nbsp;type&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7522167">,</span>&nbsp;<span class="ident" id="7522169">test</span><span class="op" id="7522173">.</span><span class="ident" id="7522174">desc</span><span class="op" id="7522178">,</span>&nbsp;<span class="ident" id="7522180">rec</span><span class="op" id="7522183">.</span><span class="ident" id="7522184">h</span><span class="op" id="7522185">.</span><span class="ident" id="7522186">Type</span><span class="op" id="7522190">,</span>&nbsp;<span class="ident" id="7522192">test</span><span class="op" id="7522196">.</span><span class="ident" id="7522197">recType</span><span class="op" id="7522204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522209">continue</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522224">if</span>&nbsp;<span class="ident" id="7522227">rec</span><span class="op" id="7522230">.</span><span class="ident" id="7522231">h</span><span class="op" id="7522232">.</span><span class="ident" id="7522233">Id</span>&nbsp;<span class="op" id="7522236">!=</span>&nbsp;<span class="ident" id="7522239">test</span><span class="op" id="7522243">.</span><span class="ident" id="7522244">reqId</span>&nbsp;<span class="op" id="7522250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522255">t</span><span class="op" id="7522256">.</span><span class="ident" id="7522257">Errorf</span><span class="op" id="7522263">(</span><span class="string" id="7522264">&#34;%s:&nbsp;got&nbsp;request&nbsp;ID&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7522299">,</span>&nbsp;<span class="ident" id="7522301">test</span><span class="op" id="7522305">.</span><span class="ident" id="7522306">desc</span><span class="op" id="7522310">,</span>&nbsp;<span class="ident" id="7522312">rec</span><span class="op" id="7522315">.</span><span class="ident" id="7522316">h</span><span class="op" id="7522317">.</span><span class="ident" id="7522318">Id</span><span class="op" id="7522320">,</span>&nbsp;<span class="ident" id="7522322">test</span><span class="op" id="7522326">.</span><span class="ident" id="7522327">reqId</span><span class="op" id="7522332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522337">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522348">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522352">if</span>&nbsp;<span class="op" id="7522355">!</span><span class="ident" id="7522356">bytes</span><span class="op" id="7522361">.</span><span class="ident" id="7522362">Equal</span><span class="op" id="7522367">(</span><span class="ident" id="7522368">content</span><span class="op" id="7522375">,</span>&nbsp;<span class="ident" id="7522377">test</span><span class="op" id="7522381">.</span><span class="ident" id="7522382">content</span><span class="op" id="7522389">)</span>&nbsp;<span class="op" id="7522391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522396">t</span><span class="op" id="7522397">.</span><span class="ident" id="7522398">Errorf</span><span class="op" id="7522404">(</span><span class="string" id="7522405">&#34;%s:&nbsp;read&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="7522429">,</span>&nbsp;<span class="ident" id="7522431">test</span><span class="op" id="7522435">.</span><span class="ident" id="7522436">desc</span><span class="op" id="7522440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522445">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522460">buf</span><span class="op" id="7522463">.</span><span class="ident" id="7522464">Reset</span><span class="op" id="7522469">(</span><span class="op" id="7522470">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522474">c</span>&nbsp;<span class="op" id="7522476">:=</span>&nbsp;<span class="ident" id="7522479">newConn</span><span class="op" id="7522486">(</span><span class="op" id="7522487">&amp;</span><span class="ident" id="7522488">nilCloser</span><span class="op" id="7522497">{</span><span class="ident" id="7522498">buf</span><span class="op" id="7522501">}</span><span class="op" id="7522502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522506">w</span>&nbsp;<span class="op" id="7522508">:=</span>&nbsp;<span class="ident" id="7522511">newWriter</span><span class="op" id="7522520">(</span><span class="ident" id="7522521">c</span><span class="op" id="7522522">,</span>&nbsp;<span class="ident" id="7522524">test</span><span class="op" id="7522528">.</span><span class="ident" id="7522529">recType</span><span class="op" id="7522536">,</span>&nbsp;<span class="ident" id="7522538">test</span><span class="op" id="7522542">.</span><span class="ident" id="7522543">reqId</span><span class="op" id="7522548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522552">if</span>&nbsp;<span class="ident" id="7522555">_</span><span class="op" id="7522556">,</span>&nbsp;<span class="ident" id="7522558">err</span>&nbsp;<span class="op" id="7522562">:=</span>&nbsp;<span class="ident" id="7522565">w</span><span class="op" id="7522566">.</span><span class="ident" id="7522567">Write</span><span class="op" id="7522572">(</span><span class="ident" id="7522573">test</span><span class="op" id="7522577">.</span><span class="ident" id="7522578">content</span><span class="op" id="7522585">)</span><span class="op" id="7522586">;</span>&nbsp;<span class="ident" id="7522588">err</span>&nbsp;<span class="op" id="7522592">!=</span>&nbsp;<span class="ident" id="7522595">nil</span>&nbsp;<span class="op" id="7522599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522604">t</span><span class="op" id="7522605">.</span><span class="ident" id="7522606">Errorf</span><span class="op" id="7522612">(</span><span class="string" id="7522613">&#34;%s:&nbsp;error&nbsp;writing&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="7522643">,</span>&nbsp;<span class="ident" id="7522645">test</span><span class="op" id="7522649">.</span><span class="ident" id="7522650">desc</span><span class="op" id="7522654">,</span>&nbsp;<span class="ident" id="7522656">err</span><span class="op" id="7522659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522664">continue</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522679">if</span>&nbsp;<span class="ident" id="7522682">err</span>&nbsp;<span class="op" id="7522686">:=</span>&nbsp;<span class="ident" id="7522689">w</span><span class="op" id="7522690">.</span><span class="ident" id="7522691">Close</span><span class="op" id="7522696">(</span><span class="op" id="7522697">)</span><span class="op" id="7522698">;</span>&nbsp;<span class="ident" id="7522700">err</span>&nbsp;<span class="op" id="7522704">!=</span>&nbsp;<span class="ident" id="7522707">nil</span>&nbsp;<span class="op" id="7522711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522716">t</span><span class="op" id="7522717">.</span><span class="ident" id="7522718">Errorf</span><span class="op" id="7522724">(</span><span class="string" id="7522725">&#34;%s:&nbsp;error&nbsp;closing&nbsp;stream:&nbsp;%v&#34;</span><span class="op" id="7522755">,</span>&nbsp;<span class="ident" id="7522757">test</span><span class="op" id="7522761">.</span><span class="ident" id="7522762">desc</span><span class="op" id="7522766">,</span>&nbsp;<span class="ident" id="7522768">err</span><span class="op" id="7522771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522776">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522787">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7522791">if</span>&nbsp;<span class="op" id="7522794">!</span><span class="ident" id="7522795">bytes</span><span class="op" id="7522800">.</span><span class="ident" id="7522801">Equal</span><span class="op" id="7522806">(</span><span class="ident" id="7522807">buf</span><span class="op" id="7522810">.</span><span class="ident" id="7522811">Bytes</span><span class="op" id="7522816">(</span><span class="op" id="7522817">)</span><span class="op" id="7522818">,</span>&nbsp;<span class="ident" id="7522820">test</span><span class="op" id="7522824">.</span><span class="ident" id="7522825">raw</span><span class="op" id="7522828">)</span>&nbsp;<span class="op" id="7522830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522835">t</span><span class="op" id="7522836">.</span><span class="ident" id="7522837">Errorf</span><span class="op" id="7522843">(</span><span class="string" id="7522844">&#34;%s:&nbsp;wrote&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="7522869">,</span>&nbsp;<span class="ident" id="7522871">test</span><span class="op" id="7522875">.</span><span class="ident" id="7522876">desc</span><span class="op" id="7522880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522887">}</span><br>
<span class="lineno"></span><span class="op" id="7522889">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="7522892">type</span>&nbsp;<span class="ident" id="7522897">writeOnlyConn</span>&nbsp;<span class="keyword" id="7522911">struct</span>&nbsp;<span class="op" id="7522918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522921">buf</span>&nbsp;<span class="op" id="7522925">[</span><span class="op" id="7522926">]</span><span class="builtintype" id="7522927">byte</span><br>
<span class="lineno"></span><span class="op" id="7522932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7522935">func</span>&nbsp;<span class="op" id="7522940">(</span><span class="ident" id="7522941">c</span>&nbsp;<span class="op" id="7522943">*</span><span class="ident" id="7522944">writeOnlyConn</span><span class="op" id="7522957">)</span>&nbsp;<span class="ident" id="7522959">Write</span><span class="op" id="7522964">(</span><span class="ident" id="7522965">p</span>&nbsp;<span class="op" id="7522967">[</span><span class="op" id="7522968">]</span><span class="builtintype" id="7522969">byte</span><span class="op" id="7522973">)</span>&nbsp;<span class="op" id="7522975">(</span><span class="builtintype" id="7522976">int</span><span class="op" id="7522979">,</span>&nbsp;<span class="builtintype" id="7522981">error</span><span class="op" id="7522986">)</span>&nbsp;<span class="op" id="7522988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7522991">c</span><span class="op" id="7522992">.</span><span class="ident" id="7522993">buf</span>&nbsp;<span class="op" id="7522997">=</span>&nbsp;<span class="builtinfunc" id="7522999">append</span><span class="op" id="7523005">(</span><span class="ident" id="7523006">c</span><span class="op" id="7523007">.</span><span class="ident" id="7523008">buf</span><span class="op" id="7523011">,</span>&nbsp;<span class="ident" id="7523013">p</span><span class="op" id="7523014">...</span><span class="op" id="7523017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523020">return</span>&nbsp;<span class="builtinfunc" id="7523027">len</span><span class="op" id="7523030">(</span><span class="ident" id="7523031">p</span><span class="op" id="7523032">)</span><span class="op" id="7523033">,</span>&nbsp;<span class="ident" id="7523035">nil</span><br>
<span class="lineno"></span><span class="op" id="7523039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="7523042">func</span>&nbsp;<span class="op" id="7523047">(</span><span class="ident" id="7523048">c</span>&nbsp;<span class="op" id="7523050">*</span><span class="ident" id="7523051">writeOnlyConn</span><span class="op" id="7523064">)</span>&nbsp;<span class="ident" id="7523066">Read</span><span class="op" id="7523070">(</span><span class="ident" id="7523071">p</span>&nbsp;<span class="op" id="7523073">[</span><span class="op" id="7523074">]</span><span class="builtintype" id="7523075">byte</span><span class="op" id="7523079">)</span>&nbsp;<span class="op" id="7523081">(</span><span class="builtintype" id="7523082">int</span><span class="op" id="7523085">,</span>&nbsp;<span class="builtintype" id="7523087">error</span><span class="op" id="7523092">)</span>&nbsp;<span class="op" id="7523094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523097">return</span>&nbsp;<span class="num" id="7523104">0</span><span class="op" id="7523105">,</span>&nbsp;<span class="ident" id="7523107">errors</span><span class="op" id="7523113">.</span><span class="ident" id="7523114">New</span><span class="op" id="7523117">(</span><span class="string" id="7523118">&#34;conn&nbsp;is&nbsp;write-only&#34;</span><span class="op" id="7523138">)</span><br>
<span class="lineno"></span><span class="op" id="7523140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7523143">func</span>&nbsp;<span class="op" id="7523148">(</span><span class="ident" id="7523149">c</span>&nbsp;<span class="op" id="7523151">*</span><span class="ident" id="7523152">writeOnlyConn</span><span class="op" id="7523165">)</span>&nbsp;<span class="ident" id="7523167">Close</span><span class="op" id="7523172">(</span><span class="op" id="7523173">)</span>&nbsp;<span class="builtintype" id="7523175">error</span>&nbsp;<span class="op" id="7523181">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523184">return</span>&nbsp;<span class="ident" id="7523191">nil</span><br>
<span class="lineno"></span><span class="op" id="7523195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7523198">func</span>&nbsp;<span class="ident" id="7523203">TestGetValues</span><span class="op" id="7523216">(</span><span class="ident" id="7523217">t</span>&nbsp;<span class="op" id="7523219">*</span><span class="ident" id="7523220">testing</span><span class="op" id="7523227">.</span><span class="ident" id="7523228">T</span><span class="op" id="7523229">)</span>&nbsp;<span class="op" id="7523231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523234">var</span>&nbsp;<span class="ident" id="7523238">rec</span>&nbsp;<span class="ident" id="7523242">record</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523250">rec</span><span class="op" id="7523253">.</span><span class="ident" id="7523254">h</span><span class="op" id="7523255">.</span><span class="ident" id="7523256">Type</span>&nbsp;<span class="op" id="7523261">=</span>&nbsp;<span class="ident" id="7523263">typeGetValues</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523279">wc</span>&nbsp;<span class="op" id="7523282">:=</span>&nbsp;<span class="builtinfunc" id="7523285">new</span><span class="op" id="7523288">(</span><span class="ident" id="7523289">writeOnlyConn</span><span class="op" id="7523302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523305">c</span>&nbsp;<span class="op" id="7523307">:=</span>&nbsp;<span class="ident" id="7523310">newChild</span><span class="op" id="7523318">(</span><span class="ident" id="7523319">wc</span><span class="op" id="7523321">,</span>&nbsp;<span class="ident" id="7523323">nil</span><span class="op" id="7523326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523329">err</span>&nbsp;<span class="op" id="7523333">:=</span>&nbsp;<span class="ident" id="7523336">c</span><span class="op" id="7523337">.</span><span class="ident" id="7523338">handleRecord</span><span class="op" id="7523350">(</span><span class="op" id="7523351">&amp;</span><span class="ident" id="7523352">rec</span><span class="op" id="7523355">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523358">if</span>&nbsp;<span class="ident" id="7523361">err</span>&nbsp;<span class="op" id="7523365">!=</span>&nbsp;<span class="ident" id="7523368">nil</span>&nbsp;<span class="op" id="7523372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523376">t</span><span class="op" id="7523377">.</span><span class="ident" id="7523378">Fatalf</span><span class="op" id="7523384">(</span><span class="string" id="7523385">&#34;handleRecord:&nbsp;%v&#34;</span><span class="op" id="7523403">,</span>&nbsp;<span class="ident" id="7523405">err</span><span class="op" id="7523408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523415">const</span>&nbsp;<span class="ident" id="7523421">want</span>&nbsp;<span class="op" id="7523426">=</span>&nbsp;<span class="string" id="7523428">&#34;\x01\n\x00\x00\x00\x12\x06\x00&#34;</span>&nbsp;<span class="op" id="7523461">+</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7523465">&#34;\x0f\x01FCGI_MPXS_CONNS1&#34;</span>&nbsp;<span class="op" id="7523492">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7523496">&#34;\x00\x00\x00\x00\x00\x00\x01\n\x00\x00\x00\x00\x00\x00&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523554">if</span>&nbsp;<span class="ident" id="7523557">got</span>&nbsp;<span class="op" id="7523561">:=</span>&nbsp;<span class="builtintype" id="7523564">string</span><span class="op" id="7523570">(</span><span class="ident" id="7523571">wc</span><span class="op" id="7523573">.</span><span class="ident" id="7523574">buf</span><span class="op" id="7523577">)</span><span class="op" id="7523578">;</span>&nbsp;<span class="ident" id="7523580">got</span>&nbsp;<span class="op" id="7523584">!=</span>&nbsp;<span class="ident" id="7523587">want</span>&nbsp;<span class="op" id="7523592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7523596">t</span><span class="op" id="7523597">.</span><span class="ident" id="7523598">Errorf</span><span class="op" id="7523604">(</span><span class="string" id="7523605">&#34;&nbsp;got:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="7523627">,</span>&nbsp;<span class="ident" id="7523629">got</span><span class="op" id="7523632">,</span>&nbsp;<span class="ident" id="7523634">want</span><span class="op" id="7523638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523641">}</span><br>
<span class="lineno">150</span><span class="op" id="7523643">}</span>
</div>
</body>
</html>
