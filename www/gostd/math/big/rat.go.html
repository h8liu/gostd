<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4010245">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4010300">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4010354">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4010405">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;multi-precision&nbsp;rational&nbsp;numbers.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4010464">package</span>&nbsp;<span class="ident" id="4010472">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4010477">import</span>&nbsp;<span class="op" id="4010484">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4010487">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4010506">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4010516">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4010523">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4010531">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4010541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4010544">//&nbsp;A&nbsp;Rat&nbsp;represents&nbsp;a&nbsp;quotient&nbsp;a/b&nbsp;of&nbsp;arbitrary&nbsp;precision.</span><br>
<span class="lineno"></span><span class="comment" id="4010603">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Rat&nbsp;represents&nbsp;the&nbsp;value&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="4010655">type</span>&nbsp;<span class="ident" id="4010660">Rat</span>&nbsp;<span class="keyword" id="4010664">struct</span>&nbsp;<span class="op" id="4010671">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4010674">//&nbsp;To&nbsp;make&nbsp;zero&nbsp;values&nbsp;for&nbsp;Rat&nbsp;work&nbsp;w/o&nbsp;initialization,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4010731">//&nbsp;a&nbsp;zero&nbsp;value&nbsp;of&nbsp;b&nbsp;(len(b)&nbsp;==&nbsp;0)&nbsp;acts&nbsp;like&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4010785">//&nbsp;a.neg&nbsp;determines&nbsp;the&nbsp;sign&nbsp;of&nbsp;the&nbsp;Rat,&nbsp;b.neg&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4010845">a</span><span class="op" id="4010846">,</span>&nbsp;<span class="ident" id="4010848">b</span>&nbsp;<span class="ident" id="4010850">Int</span><br>
<span class="lineno"></span><span class="op" id="4010854">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4010857">//&nbsp;NewRat&nbsp;creates&nbsp;a&nbsp;new&nbsp;Rat&nbsp;with&nbsp;numerator&nbsp;a&nbsp;and&nbsp;denominator&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="4010921">func</span>&nbsp;<span class="ident" id="4010926">NewRat</span><span class="op" id="4010932">(</span><span class="ident" id="4010933">a</span><span class="op" id="4010934">,</span>&nbsp;<span class="ident" id="4010936">b</span>&nbsp;<span class="ident" id="4010938">int64</span><span class="op" id="4010943">)</span>&nbsp;<span class="op" id="4010945">*</span><span class="ident" id="4010946">Rat</span>&nbsp;<span class="op" id="4010950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4010953">return</span>&nbsp;<span class="builtinfunc" id="4010960">new</span><span class="op" id="4010963">(</span><span class="ident" id="4010964">Rat</span><span class="op" id="4010967">)</span><span class="op" id="4010968">.</span><span class="ident" id="4010969">SetFrac64</span><span class="op" id="4010978">(</span><span class="ident" id="4010979">a</span><span class="op" id="4010980">,</span>&nbsp;<span class="ident" id="4010982">b</span><span class="op" id="4010983">)</span><br>
<span class="lineno"></span><span class="op" id="4010985">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="4010988">//&nbsp;SetFloat64&nbsp;sets&nbsp;z&nbsp;to&nbsp;exactly&nbsp;f&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="4011037">//&nbsp;If&nbsp;f&nbsp;is&nbsp;not&nbsp;finite,&nbsp;SetFloat&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4011082">func</span>&nbsp;<span class="op" id="4011087">(</span><span class="ident" id="4011088">z</span>&nbsp;<span class="op" id="4011090">*</span><span class="ident" id="4011091">Rat</span><span class="op" id="4011094">)</span>&nbsp;<span class="ident" id="4011096">SetFloat64</span><span class="op" id="4011106">(</span><span class="ident" id="4011107">f</span>&nbsp;<span class="builtintype" id="4011109">float64</span><span class="op" id="4011116">)</span>&nbsp;<span class="op" id="4011118">*</span><span class="ident" id="4011119">Rat</span>&nbsp;<span class="op" id="4011123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011126">const</span>&nbsp;<span class="ident" id="4011132">expMask</span>&nbsp;<span class="op" id="4011140">=</span>&nbsp;<span class="num" id="4011142">1</span><span class="op" id="4011143">&lt;&lt;</span><span class="num" id="4011145">11</span>&nbsp;<span class="op" id="4011148">-</span>&nbsp;<span class="num" id="4011150">1</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011153">bits</span>&nbsp;<span class="op" id="4011158">:=</span>&nbsp;<span class="ident" id="4011161">math</span><span class="op" id="4011165">.</span><span class="ident" id="4011166">Float64bits</span><span class="op" id="4011177">(</span><span class="ident" id="4011178">f</span><span class="op" id="4011179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011182">mantissa</span>&nbsp;<span class="op" id="4011191">:=</span>&nbsp;<span class="ident" id="4011194">bits</span>&nbsp;<span class="op" id="4011199">&amp;</span>&nbsp;<span class="op" id="4011201">(</span><span class="num" id="4011202">1</span><span class="op" id="4011203">&lt;&lt;</span><span class="num" id="4011205">52</span>&nbsp;<span class="op" id="4011208">-</span>&nbsp;<span class="num" id="4011210">1</span><span class="op" id="4011211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011214">exp</span>&nbsp;<span class="op" id="4011218">:=</span>&nbsp;<span class="builtintype" id="4011221">int</span><span class="op" id="4011224">(</span><span class="op" id="4011225">(</span><span class="ident" id="4011226">bits</span>&nbsp;<span class="op" id="4011231">&gt;&gt;</span>&nbsp;<span class="num" id="4011234">52</span><span class="op" id="4011236">)</span>&nbsp;<span class="op" id="4011238">&amp;</span>&nbsp;<span class="ident" id="4011240">expMask</span><span class="op" id="4011247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011250">switch</span>&nbsp;<span class="ident" id="4011257">exp</span>&nbsp;<span class="op" id="4011261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011264">case</span>&nbsp;<span class="ident" id="4011269">expMask</span><span class="op" id="4011276">:</span>&nbsp;<span class="comment" id="4011278">//&nbsp;non-finite</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011294">return</span>&nbsp;<span class="ident" id="4011301">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011306">case</span>&nbsp;<span class="num" id="4011311">0</span><span class="op" id="4011312">:</span>&nbsp;<span class="comment" id="4011314">//&nbsp;denormal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011328">exp</span>&nbsp;<span class="op" id="4011332">-=</span>&nbsp;<span class="num" id="4011335">1022</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011341">default</span><span class="op" id="4011348">:</span>&nbsp;<span class="comment" id="4011350">//&nbsp;normal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011362">mantissa</span>&nbsp;<span class="op" id="4011371">|=</span>&nbsp;<span class="num" id="4011374">1</span>&nbsp;<span class="op" id="4011376">&lt;&lt;</span>&nbsp;<span class="num" id="4011379">52</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011384">exp</span>&nbsp;<span class="op" id="4011388">-=</span>&nbsp;<span class="num" id="4011391">1023</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4011397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011401">shift</span>&nbsp;<span class="op" id="4011407">:=</span>&nbsp;<span class="num" id="4011410">52</span>&nbsp;<span class="op" id="4011413">-</span>&nbsp;<span class="ident" id="4011415">exp</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4011421">//&nbsp;Optimization&nbsp;(?):&nbsp;partially&nbsp;pre-normalise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011468">for</span>&nbsp;<span class="ident" id="4011472">mantissa</span><span class="op" id="4011480">&amp;</span><span class="num" id="4011481">1</span>&nbsp;<span class="op" id="4011483">==</span>&nbsp;<span class="num" id="4011486">0</span>&nbsp;<span class="op" id="4011488">&amp;&amp;</span>&nbsp;<span class="ident" id="4011491">shift</span>&nbsp;<span class="op" id="4011497">&gt;</span>&nbsp;<span class="num" id="4011499">0</span>&nbsp;<span class="op" id="4011501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011505">mantissa</span>&nbsp;<span class="op" id="4011514">&gt;&gt;=</span>&nbsp;<span class="num" id="4011518">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011522">shift</span><span class="op" id="4011527">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4011531">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011535">z</span><span class="op" id="4011536">.</span><span class="ident" id="4011537">a</span><span class="op" id="4011538">.</span><span class="ident" id="4011539">SetUint64</span><span class="op" id="4011548">(</span><span class="ident" id="4011549">mantissa</span><span class="op" id="4011557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011560">z</span><span class="op" id="4011561">.</span><span class="ident" id="4011562">a</span><span class="op" id="4011563">.</span><span class="ident" id="4011564">neg</span>&nbsp;<span class="op" id="4011568">=</span>&nbsp;<span class="ident" id="4011570">f</span>&nbsp;<span class="op" id="4011572">&lt;</span>&nbsp;<span class="num" id="4011574">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011577">z</span><span class="op" id="4011578">.</span><span class="ident" id="4011579">b</span><span class="op" id="4011580">.</span><span class="ident" id="4011581">Set</span><span class="op" id="4011584">(</span><span class="ident" id="4011585">intOne</span><span class="op" id="4011591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011594">if</span>&nbsp;<span class="ident" id="4011597">shift</span>&nbsp;<span class="op" id="4011603">&gt;</span>&nbsp;<span class="num" id="4011605">0</span>&nbsp;<span class="op" id="4011607">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011611">z</span><span class="op" id="4011612">.</span><span class="ident" id="4011613">b</span><span class="op" id="4011614">.</span><span class="ident" id="4011615">Lsh</span><span class="op" id="4011618">(</span><span class="op" id="4011619">&amp;</span><span class="ident" id="4011620">z</span><span class="op" id="4011621">.</span><span class="ident" id="4011622">b</span><span class="op" id="4011623">,</span>&nbsp;<span class="builtintype" id="4011625">uint</span><span class="op" id="4011629">(</span><span class="ident" id="4011630">shift</span><span class="op" id="4011635">)</span><span class="op" id="4011636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4011639">}</span>&nbsp;<span class="keyword" id="4011641">else</span>&nbsp;<span class="op" id="4011646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011650">z</span><span class="op" id="4011651">.</span><span class="ident" id="4011652">a</span><span class="op" id="4011653">.</span><span class="ident" id="4011654">Lsh</span><span class="op" id="4011657">(</span><span class="op" id="4011658">&amp;</span><span class="ident" id="4011659">z</span><span class="op" id="4011660">.</span><span class="ident" id="4011661">a</span><span class="op" id="4011662">,</span>&nbsp;<span class="builtintype" id="4011664">uint</span><span class="op" id="4011668">(</span><span class="op" id="4011669">-</span><span class="ident" id="4011670">shift</span><span class="op" id="4011675">)</span><span class="op" id="4011676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4011679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011682">return</span>&nbsp;<span class="ident" id="4011689">z</span><span class="op" id="4011690">.</span><span class="ident" id="4011691">norm</span><span class="op" id="4011695">(</span><span class="op" id="4011696">)</span><br>
<span class="lineno">65</span><span class="op" id="4011698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4011701">//&nbsp;quotToFloat32&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float32&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4011757">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4011812">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno">70</span><span class="comment" id="4011865">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="4011930">func</span>&nbsp;<span class="ident" id="4011935">quotToFloat32</span><span class="op" id="4011948">(</span><span class="ident" id="4011949">a</span><span class="op" id="4011950">,</span>&nbsp;<span class="ident" id="4011952">b</span>&nbsp;<span class="ident" id="4011954">nat</span><span class="op" id="4011957">)</span>&nbsp;<span class="op" id="4011959">(</span><span class="ident" id="4011960">f</span>&nbsp;<span class="builtintype" id="4011962">float32</span><span class="op" id="4011969">,</span>&nbsp;<span class="ident" id="4011971">exact</span>&nbsp;<span class="builtintype" id="4011977">bool</span><span class="op" id="4011981">)</span>&nbsp;<span class="op" id="4011983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011986">const</span>&nbsp;<span class="op" id="4011992">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4011996">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012020">Fsize</span>&nbsp;<span class="op" id="4012026">=</span>&nbsp;<span class="num" id="4012028">32</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4012034">//&nbsp;mantissa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012048">Msize</span>&nbsp;&nbsp;<span class="op" id="4012055">=</span>&nbsp;<span class="num" id="4012057">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012062">Msize1</span>&nbsp;<span class="op" id="4012069">=</span>&nbsp;<span class="ident" id="4012071">Msize</span>&nbsp;<span class="op" id="4012077">+</span>&nbsp;<span class="num" id="4012079">1</span>&nbsp;<span class="comment" id="4012081">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012103">Msize2</span>&nbsp;<span class="op" id="4012110">=</span>&nbsp;<span class="ident" id="4012112">Msize1</span>&nbsp;<span class="op" id="4012119">+</span>&nbsp;<span class="num" id="4012121">1</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4012126">//&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012140">Esize</span>&nbsp;<span class="op" id="4012146">=</span>&nbsp;<span class="ident" id="4012148">Fsize</span>&nbsp;<span class="op" id="4012154">-</span>&nbsp;<span class="ident" id="4012156">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012165">Ebias</span>&nbsp;<span class="op" id="4012171">=</span>&nbsp;<span class="num" id="4012173">1</span><span class="op" id="4012174">&lt;&lt;</span><span class="op" id="4012176">(</span><span class="ident" id="4012177">Esize</span><span class="op" id="4012182">-</span><span class="num" id="4012183">1</span><span class="op" id="4012184">)</span>&nbsp;<span class="op" id="4012186">-</span>&nbsp;<span class="num" id="4012188">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012192">Emin</span>&nbsp;&nbsp;<span class="op" id="4012198">=</span>&nbsp;<span class="num" id="4012200">1</span>&nbsp;<span class="op" id="4012202">-</span>&nbsp;<span class="ident" id="4012204">Ebias</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012212">Emax</span>&nbsp;&nbsp;<span class="op" id="4012218">=</span>&nbsp;<span class="ident" id="4012220">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4012227">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4012231">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012302">alen</span>&nbsp;<span class="op" id="4012307">:=</span>&nbsp;<span class="ident" id="4012310">a</span><span class="op" id="4012311">.</span><span class="ident" id="4012312">bitLen</span><span class="op" id="4012318">(</span><span class="op" id="4012319">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4012322">if</span>&nbsp;<span class="ident" id="4012325">alen</span>&nbsp;<span class="op" id="4012330">==</span>&nbsp;<span class="num" id="4012333">0</span>&nbsp;<span class="op" id="4012335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4012339">return</span>&nbsp;<span class="num" id="4012346">0</span><span class="op" id="4012347">,</span>&nbsp;<span class="builtintype" id="4012349">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4012355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012358">blen</span>&nbsp;<span class="op" id="4012363">:=</span>&nbsp;<span class="ident" id="4012366">b</span><span class="op" id="4012367">.</span><span class="ident" id="4012368">bitLen</span><span class="op" id="4012374">(</span><span class="op" id="4012375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4012378">if</span>&nbsp;<span class="ident" id="4012381">blen</span>&nbsp;<span class="op" id="4012386">==</span>&nbsp;<span class="num" id="4012389">0</span>&nbsp;<span class="op" id="4012391">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4012395">panic</span><span class="op" id="4012400">(</span><span class="string" id="4012401">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4012419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4012422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4012426">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4012506">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4012586">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float32&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4012658">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4012720">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4012782">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012849">exp</span>&nbsp;<span class="op" id="4012853">:=</span>&nbsp;<span class="ident" id="4012856">alen</span>&nbsp;<span class="op" id="4012861">-</span>&nbsp;<span class="ident" id="4012863">blen</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4012869">var</span>&nbsp;<span class="ident" id="4012873">a2</span><span class="op" id="4012875">,</span>&nbsp;<span class="ident" id="4012877">b2</span>&nbsp;<span class="ident" id="4012880">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012885">a2</span>&nbsp;<span class="op" id="4012888">=</span>&nbsp;<span class="ident" id="4012890">a2</span><span class="op" id="4012892">.</span><span class="ident" id="4012893">set</span><span class="op" id="4012896">(</span><span class="ident" id="4012897">a</span><span class="op" id="4012898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012901">b2</span>&nbsp;<span class="op" id="4012904">=</span>&nbsp;<span class="ident" id="4012906">b2</span><span class="op" id="4012908">.</span><span class="ident" id="4012909">set</span><span class="op" id="4012912">(</span><span class="ident" id="4012913">b</span><span class="op" id="4012914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4012917">if</span>&nbsp;<span class="ident" id="4012920">shift</span>&nbsp;<span class="op" id="4012926">:=</span>&nbsp;<span class="ident" id="4012929">Msize2</span>&nbsp;<span class="op" id="4012936">-</span>&nbsp;<span class="ident" id="4012938">exp</span><span class="op" id="4012941">;</span>&nbsp;<span class="ident" id="4012943">shift</span>&nbsp;<span class="op" id="4012949">&gt;</span>&nbsp;<span class="num" id="4012951">0</span>&nbsp;<span class="op" id="4012953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012957">a2</span>&nbsp;<span class="op" id="4012960">=</span>&nbsp;<span class="ident" id="4012962">a2</span><span class="op" id="4012964">.</span><span class="ident" id="4012965">shl</span><span class="op" id="4012968">(</span><span class="ident" id="4012969">a2</span><span class="op" id="4012971">,</span>&nbsp;<span class="builtintype" id="4012973">uint</span><span class="op" id="4012977">(</span><span class="ident" id="4012978">shift</span><span class="op" id="4012983">)</span><span class="op" id="4012984">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4012987">}</span>&nbsp;<span class="keyword" id="4012989">else</span>&nbsp;<span class="keyword" id="4012994">if</span>&nbsp;<span class="ident" id="4012997">shift</span>&nbsp;<span class="op" id="4013003">&lt;</span>&nbsp;<span class="num" id="4013005">0</span>&nbsp;<span class="op" id="4013007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013011">b2</span>&nbsp;<span class="op" id="4013014">=</span>&nbsp;<span class="ident" id="4013016">b2</span><span class="op" id="4013018">.</span><span class="ident" id="4013019">shl</span><span class="op" id="4013022">(</span><span class="ident" id="4013023">b2</span><span class="op" id="4013025">,</span>&nbsp;<span class="builtintype" id="4013027">uint</span><span class="op" id="4013031">(</span><span class="op" id="4013032">-</span><span class="ident" id="4013033">shift</span><span class="op" id="4013038">)</span><span class="op" id="4013039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4013042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4013046">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4013108">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4013165">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4013190">var</span>&nbsp;<span class="ident" id="4013194">q</span>&nbsp;<span class="ident" id="4013196">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013201">q</span><span class="op" id="4013202">,</span>&nbsp;<span class="ident" id="4013204">r</span>&nbsp;<span class="op" id="4013206">:=</span>&nbsp;<span class="ident" id="4013209">q</span><span class="op" id="4013210">.</span><span class="ident" id="4013211">div</span><span class="op" id="4013214">(</span><span class="ident" id="4013215">a2</span><span class="op" id="4013217">,</span>&nbsp;<span class="ident" id="4013219">a2</span><span class="op" id="4013221">,</span>&nbsp;<span class="ident" id="4013223">b2</span><span class="op" id="4013225">)</span>&nbsp;<span class="comment" id="4013227">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013244">mantissa</span>&nbsp;<span class="op" id="4013253">:=</span>&nbsp;<span class="ident" id="4013256">low32</span><span class="op" id="4013261">(</span><span class="ident" id="4013262">q</span><span class="op" id="4013263">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013266">haveRem</span>&nbsp;<span class="op" id="4013274">:=</span>&nbsp;<span class="builtinfunc" id="4013277">len</span><span class="op" id="4013280">(</span><span class="ident" id="4013281">r</span><span class="op" id="4013282">)</span>&nbsp;<span class="op" id="4013284">&gt;</span>&nbsp;<span class="num" id="4013286">0</span>&nbsp;<span class="comment" id="4013288">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4013345">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4013414">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4013466">if</span>&nbsp;<span class="ident" id="4013469">mantissa</span><span class="op" id="4013477">&gt;&gt;</span><span class="ident" id="4013479">Msize2</span>&nbsp;<span class="op" id="4013486">==</span>&nbsp;<span class="num" id="4013489">1</span>&nbsp;<span class="op" id="4013491">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4013495">if</span>&nbsp;<span class="ident" id="4013498">mantissa</span><span class="op" id="4013506">&amp;</span><span class="num" id="4013507">1</span>&nbsp;<span class="op" id="4013509">==</span>&nbsp;<span class="num" id="4013512">1</span>&nbsp;<span class="op" id="4013514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013519">haveRem</span>&nbsp;<span class="op" id="4013527">=</span>&nbsp;<span class="builtintype" id="4013529">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4013536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013540">mantissa</span>&nbsp;<span class="op" id="4013549">&gt;&gt;=</span>&nbsp;<span class="num" id="4013553">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013557">exp</span><span class="op" id="4013560">++</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4013564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4013567">if</span>&nbsp;<span class="ident" id="4013570">mantissa</span><span class="op" id="4013578">&gt;&gt;</span><span class="ident" id="4013580">Msize1</span>&nbsp;<span class="op" id="4013587">!=</span>&nbsp;<span class="num" id="4013590">1</span>&nbsp;<span class="op" id="4013592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4013596">panic</span><span class="op" id="4013601">(</span><span class="ident" id="4013602">fmt</span><span class="op" id="4013605">.</span><span class="ident" id="4013606">Sprintf</span><span class="op" id="4013613">(</span><span class="string" id="4013614">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="4013650">,</span>&nbsp;<span class="ident" id="4013652">Msize2</span><span class="op" id="4013658">)</span><span class="op" id="4013659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4013662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4013666">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4013683">if</span>&nbsp;<span class="ident" id="4013686">Emin</span><span class="op" id="4013690">-</span><span class="ident" id="4013691">Msize</span>&nbsp;<span class="op" id="4013697">&lt;=</span>&nbsp;<span class="ident" id="4013700">exp</span>&nbsp;<span class="op" id="4013704">&amp;&amp;</span>&nbsp;<span class="ident" id="4013707">exp</span>&nbsp;<span class="op" id="4013711">&lt;=</span>&nbsp;<span class="ident" id="4013714">Emin</span>&nbsp;<span class="op" id="4013719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4013723">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013775">shift</span>&nbsp;<span class="op" id="4013781">:=</span>&nbsp;<span class="builtintype" id="4013784">uint</span><span class="op" id="4013788">(</span><span class="ident" id="4013789">Emin</span>&nbsp;<span class="op" id="4013794">-</span>&nbsp;<span class="op" id="4013796">(</span><span class="ident" id="4013797">exp</span>&nbsp;<span class="op" id="4013801">-</span>&nbsp;<span class="num" id="4013803">1</span><span class="op" id="4013804">)</span><span class="op" id="4013805">)</span>&nbsp;<span class="comment" id="4013807">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013824">lostbits</span>&nbsp;<span class="op" id="4013833">:=</span>&nbsp;<span class="ident" id="4013836">mantissa</span>&nbsp;<span class="op" id="4013845">&amp;</span>&nbsp;<span class="op" id="4013847">(</span><span class="num" id="4013848">1</span><span class="op" id="4013849">&lt;&lt;</span><span class="ident" id="4013851">shift</span>&nbsp;<span class="op" id="4013857">-</span>&nbsp;<span class="num" id="4013859">1</span><span class="op" id="4013860">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013864">haveRem</span>&nbsp;<span class="op" id="4013872">=</span>&nbsp;<span class="ident" id="4013874">haveRem</span>&nbsp;<span class="op" id="4013882">||</span>&nbsp;<span class="ident" id="4013885">lostbits</span>&nbsp;<span class="op" id="4013894">!=</span>&nbsp;<span class="num" id="4013897">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013901">mantissa</span>&nbsp;<span class="op" id="4013910">&gt;&gt;=</span>&nbsp;<span class="ident" id="4013914">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013922">exp</span>&nbsp;<span class="op" id="4013926">=</span>&nbsp;<span class="num" id="4013928">2</span>&nbsp;<span class="op" id="4013930">-</span>&nbsp;<span class="ident" id="4013932">Ebias</span>&nbsp;<span class="comment" id="4013938">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4013957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4013960">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4013998">exact</span>&nbsp;<span class="op" id="4014004">=</span>&nbsp;<span class="op" id="4014006">!</span><span class="ident" id="4014007">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4014016">if</span>&nbsp;<span class="ident" id="4014019">mantissa</span><span class="op" id="4014027">&amp;</span><span class="num" id="4014028">1</span>&nbsp;<span class="op" id="4014030">!=</span>&nbsp;<span class="num" id="4014033">0</span>&nbsp;<span class="op" id="4014035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014039">exact</span>&nbsp;<span class="op" id="4014045">=</span>&nbsp;<span class="builtintype" id="4014047">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4014055">if</span>&nbsp;<span class="ident" id="4014058">haveRem</span>&nbsp;<span class="op" id="4014066">||</span>&nbsp;<span class="ident" id="4014069">mantissa</span><span class="op" id="4014077">&amp;</span><span class="num" id="4014078">2</span>&nbsp;<span class="op" id="4014080">!=</span>&nbsp;<span class="num" id="4014083">0</span>&nbsp;<span class="op" id="4014085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4014090">if</span>&nbsp;<span class="ident" id="4014093">mantissa</span><span class="op" id="4014101">++</span><span class="op" id="4014103">;</span>&nbsp;<span class="ident" id="4014105">mantissa</span>&nbsp;<span class="op" id="4014114">&gt;=</span>&nbsp;<span class="num" id="4014117">1</span><span class="op" id="4014118">&lt;&lt;</span><span class="ident" id="4014120">Msize2</span>&nbsp;<span class="op" id="4014127">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4014133">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014194">mantissa</span>&nbsp;<span class="op" id="4014203">&gt;&gt;=</span>&nbsp;<span class="num" id="4014207">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014213">exp</span><span class="op" id="4014216">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4014222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4014226">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4014229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014232">mantissa</span>&nbsp;<span class="op" id="4014241">&gt;&gt;=</span>&nbsp;<span class="num" id="4014245">1</span>&nbsp;<span class="comment" id="4014247">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014309">f</span>&nbsp;<span class="op" id="4014311">=</span>&nbsp;<span class="builtintype" id="4014313">float32</span><span class="op" id="4014320">(</span><span class="ident" id="4014321">math</span><span class="op" id="4014325">.</span><span class="ident" id="4014326">Ldexp</span><span class="op" id="4014331">(</span><span class="builtintype" id="4014332">float64</span><span class="op" id="4014339">(</span><span class="ident" id="4014340">mantissa</span><span class="op" id="4014348">)</span><span class="op" id="4014349">,</span>&nbsp;<span class="ident" id="4014351">exp</span><span class="op" id="4014354">-</span><span class="ident" id="4014355">Msize1</span><span class="op" id="4014361">)</span><span class="op" id="4014362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4014365">if</span>&nbsp;<span class="ident" id="4014368">math</span><span class="op" id="4014372">.</span><span class="ident" id="4014373">IsInf</span><span class="op" id="4014378">(</span><span class="builtintype" id="4014379">float64</span><span class="op" id="4014386">(</span><span class="ident" id="4014387">f</span><span class="op" id="4014388">)</span><span class="op" id="4014389">,</span>&nbsp;<span class="num" id="4014391">0</span><span class="op" id="4014392">)</span>&nbsp;<span class="op" id="4014394">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014398">exact</span>&nbsp;<span class="op" id="4014404">=</span>&nbsp;<span class="builtintype" id="4014406">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4014413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4014416">return</span><br>
<span class="lineno"></span><span class="op" id="4014423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="4014426">//&nbsp;quotToFloat64&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float64&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4014482">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4014537">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="4014590">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="4014655">func</span>&nbsp;<span class="ident" id="4014660">quotToFloat64</span><span class="op" id="4014673">(</span><span class="ident" id="4014674">a</span><span class="op" id="4014675">,</span>&nbsp;<span class="ident" id="4014677">b</span>&nbsp;<span class="ident" id="4014679">nat</span><span class="op" id="4014682">)</span>&nbsp;<span class="op" id="4014684">(</span><span class="ident" id="4014685">f</span>&nbsp;<span class="builtintype" id="4014687">float64</span><span class="op" id="4014694">,</span>&nbsp;<span class="ident" id="4014696">exact</span>&nbsp;<span class="builtintype" id="4014702">bool</span><span class="op" id="4014706">)</span>&nbsp;<span class="op" id="4014708">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4014711">const</span>&nbsp;<span class="op" id="4014717">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4014721">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014745">Fsize</span>&nbsp;<span class="op" id="4014751">=</span>&nbsp;<span class="num" id="4014753">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4014759">//&nbsp;mantissa</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014773">Msize</span>&nbsp;&nbsp;<span class="op" id="4014780">=</span>&nbsp;<span class="num" id="4014782">52</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014787">Msize1</span>&nbsp;<span class="op" id="4014794">=</span>&nbsp;<span class="ident" id="4014796">Msize</span>&nbsp;<span class="op" id="4014802">+</span>&nbsp;<span class="num" id="4014804">1</span>&nbsp;<span class="comment" id="4014806">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014828">Msize2</span>&nbsp;<span class="op" id="4014835">=</span>&nbsp;<span class="ident" id="4014837">Msize1</span>&nbsp;<span class="op" id="4014844">+</span>&nbsp;<span class="num" id="4014846">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4014851">//&nbsp;exponent</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014865">Esize</span>&nbsp;<span class="op" id="4014871">=</span>&nbsp;<span class="ident" id="4014873">Fsize</span>&nbsp;<span class="op" id="4014879">-</span>&nbsp;<span class="ident" id="4014881">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014890">Ebias</span>&nbsp;<span class="op" id="4014896">=</span>&nbsp;<span class="num" id="4014898">1</span><span class="op" id="4014899">&lt;&lt;</span><span class="op" id="4014901">(</span><span class="ident" id="4014902">Esize</span><span class="op" id="4014907">-</span><span class="num" id="4014908">1</span><span class="op" id="4014909">)</span>&nbsp;<span class="op" id="4014911">-</span>&nbsp;<span class="num" id="4014913">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014917">Emin</span>&nbsp;&nbsp;<span class="op" id="4014923">=</span>&nbsp;<span class="num" id="4014925">1</span>&nbsp;<span class="op" id="4014927">-</span>&nbsp;<span class="ident" id="4014929">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014937">Emax</span>&nbsp;&nbsp;<span class="op" id="4014943">=</span>&nbsp;<span class="ident" id="4014945">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4014952">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4014956">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015027">alen</span>&nbsp;<span class="op" id="4015032">:=</span>&nbsp;<span class="ident" id="4015035">a</span><span class="op" id="4015036">.</span><span class="ident" id="4015037">bitLen</span><span class="op" id="4015043">(</span><span class="op" id="4015044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4015047">if</span>&nbsp;<span class="ident" id="4015050">alen</span>&nbsp;<span class="op" id="4015055">==</span>&nbsp;<span class="num" id="4015058">0</span>&nbsp;<span class="op" id="4015060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4015064">return</span>&nbsp;<span class="num" id="4015071">0</span><span class="op" id="4015072">,</span>&nbsp;<span class="builtintype" id="4015074">true</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4015080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015083">blen</span>&nbsp;<span class="op" id="4015088">:=</span>&nbsp;<span class="ident" id="4015091">b</span><span class="op" id="4015092">.</span><span class="ident" id="4015093">bitLen</span><span class="op" id="4015099">(</span><span class="op" id="4015100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4015103">if</span>&nbsp;<span class="ident" id="4015106">blen</span>&nbsp;<span class="op" id="4015111">==</span>&nbsp;<span class="num" id="4015114">0</span>&nbsp;<span class="op" id="4015116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4015120">panic</span><span class="op" id="4015125">(</span><span class="string" id="4015126">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4015144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4015147">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4015151">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4015231">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4015311">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float64&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4015383">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4015445">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4015507">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015574">exp</span>&nbsp;<span class="op" id="4015578">:=</span>&nbsp;<span class="ident" id="4015581">alen</span>&nbsp;<span class="op" id="4015586">-</span>&nbsp;<span class="ident" id="4015588">blen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4015594">var</span>&nbsp;<span class="ident" id="4015598">a2</span><span class="op" id="4015600">,</span>&nbsp;<span class="ident" id="4015602">b2</span>&nbsp;<span class="ident" id="4015605">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015610">a2</span>&nbsp;<span class="op" id="4015613">=</span>&nbsp;<span class="ident" id="4015615">a2</span><span class="op" id="4015617">.</span><span class="ident" id="4015618">set</span><span class="op" id="4015621">(</span><span class="ident" id="4015622">a</span><span class="op" id="4015623">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015626">b2</span>&nbsp;<span class="op" id="4015629">=</span>&nbsp;<span class="ident" id="4015631">b2</span><span class="op" id="4015633">.</span><span class="ident" id="4015634">set</span><span class="op" id="4015637">(</span><span class="ident" id="4015638">b</span><span class="op" id="4015639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4015642">if</span>&nbsp;<span class="ident" id="4015645">shift</span>&nbsp;<span class="op" id="4015651">:=</span>&nbsp;<span class="ident" id="4015654">Msize2</span>&nbsp;<span class="op" id="4015661">-</span>&nbsp;<span class="ident" id="4015663">exp</span><span class="op" id="4015666">;</span>&nbsp;<span class="ident" id="4015668">shift</span>&nbsp;<span class="op" id="4015674">&gt;</span>&nbsp;<span class="num" id="4015676">0</span>&nbsp;<span class="op" id="4015678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015682">a2</span>&nbsp;<span class="op" id="4015685">=</span>&nbsp;<span class="ident" id="4015687">a2</span><span class="op" id="4015689">.</span><span class="ident" id="4015690">shl</span><span class="op" id="4015693">(</span><span class="ident" id="4015694">a2</span><span class="op" id="4015696">,</span>&nbsp;<span class="builtintype" id="4015698">uint</span><span class="op" id="4015702">(</span><span class="ident" id="4015703">shift</span><span class="op" id="4015708">)</span><span class="op" id="4015709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4015712">}</span>&nbsp;<span class="keyword" id="4015714">else</span>&nbsp;<span class="keyword" id="4015719">if</span>&nbsp;<span class="ident" id="4015722">shift</span>&nbsp;<span class="op" id="4015728">&lt;</span>&nbsp;<span class="num" id="4015730">0</span>&nbsp;<span class="op" id="4015732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015736">b2</span>&nbsp;<span class="op" id="4015739">=</span>&nbsp;<span class="ident" id="4015741">b2</span><span class="op" id="4015743">.</span><span class="ident" id="4015744">shl</span><span class="op" id="4015747">(</span><span class="ident" id="4015748">b2</span><span class="op" id="4015750">,</span>&nbsp;<span class="builtintype" id="4015752">uint</span><span class="op" id="4015756">(</span><span class="op" id="4015757">-</span><span class="ident" id="4015758">shift</span><span class="op" id="4015763">)</span><span class="op" id="4015764">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4015767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4015771">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4015833">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4015890">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4015915">var</span>&nbsp;<span class="ident" id="4015919">q</span>&nbsp;<span class="ident" id="4015921">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015926">q</span><span class="op" id="4015927">,</span>&nbsp;<span class="ident" id="4015929">r</span>&nbsp;<span class="op" id="4015931">:=</span>&nbsp;<span class="ident" id="4015934">q</span><span class="op" id="4015935">.</span><span class="ident" id="4015936">div</span><span class="op" id="4015939">(</span><span class="ident" id="4015940">a2</span><span class="op" id="4015942">,</span>&nbsp;<span class="ident" id="4015944">a2</span><span class="op" id="4015946">,</span>&nbsp;<span class="ident" id="4015948">b2</span><span class="op" id="4015950">)</span>&nbsp;<span class="comment" id="4015952">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015969">mantissa</span>&nbsp;<span class="op" id="4015978">:=</span>&nbsp;<span class="ident" id="4015981">low64</span><span class="op" id="4015986">(</span><span class="ident" id="4015987">q</span><span class="op" id="4015988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015991">haveRem</span>&nbsp;<span class="op" id="4015999">:=</span>&nbsp;<span class="builtinfunc" id="4016002">len</span><span class="op" id="4016005">(</span><span class="ident" id="4016006">r</span><span class="op" id="4016007">)</span>&nbsp;<span class="op" id="4016009">&gt;</span>&nbsp;<span class="num" id="4016011">0</span>&nbsp;<span class="comment" id="4016013">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4016070">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4016139">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016191">if</span>&nbsp;<span class="ident" id="4016194">mantissa</span><span class="op" id="4016202">&gt;&gt;</span><span class="ident" id="4016204">Msize2</span>&nbsp;<span class="op" id="4016211">==</span>&nbsp;<span class="num" id="4016214">1</span>&nbsp;<span class="op" id="4016216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016220">if</span>&nbsp;<span class="ident" id="4016223">mantissa</span><span class="op" id="4016231">&amp;</span><span class="num" id="4016232">1</span>&nbsp;<span class="op" id="4016234">==</span>&nbsp;<span class="num" id="4016237">1</span>&nbsp;<span class="op" id="4016239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016244">haveRem</span>&nbsp;<span class="op" id="4016252">=</span>&nbsp;<span class="builtintype" id="4016254">true</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4016261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016265">mantissa</span>&nbsp;<span class="op" id="4016274">&gt;&gt;=</span>&nbsp;<span class="num" id="4016278">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016282">exp</span><span class="op" id="4016285">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4016289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016292">if</span>&nbsp;<span class="ident" id="4016295">mantissa</span><span class="op" id="4016303">&gt;&gt;</span><span class="ident" id="4016305">Msize1</span>&nbsp;<span class="op" id="4016312">!=</span>&nbsp;<span class="num" id="4016315">1</span>&nbsp;<span class="op" id="4016317">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4016321">panic</span><span class="op" id="4016326">(</span><span class="ident" id="4016327">fmt</span><span class="op" id="4016330">.</span><span class="ident" id="4016331">Sprintf</span><span class="op" id="4016338">(</span><span class="string" id="4016339">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="4016375">,</span>&nbsp;<span class="ident" id="4016377">Msize2</span><span class="op" id="4016383">)</span><span class="op" id="4016384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4016387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4016391">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016408">if</span>&nbsp;<span class="ident" id="4016411">Emin</span><span class="op" id="4016415">-</span><span class="ident" id="4016416">Msize</span>&nbsp;<span class="op" id="4016422">&lt;=</span>&nbsp;<span class="ident" id="4016425">exp</span>&nbsp;<span class="op" id="4016429">&amp;&amp;</span>&nbsp;<span class="ident" id="4016432">exp</span>&nbsp;<span class="op" id="4016436">&lt;=</span>&nbsp;<span class="ident" id="4016439">Emin</span>&nbsp;<span class="op" id="4016444">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4016448">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016500">shift</span>&nbsp;<span class="op" id="4016506">:=</span>&nbsp;<span class="builtintype" id="4016509">uint</span><span class="op" id="4016513">(</span><span class="ident" id="4016514">Emin</span>&nbsp;<span class="op" id="4016519">-</span>&nbsp;<span class="op" id="4016521">(</span><span class="ident" id="4016522">exp</span>&nbsp;<span class="op" id="4016526">-</span>&nbsp;<span class="num" id="4016528">1</span><span class="op" id="4016529">)</span><span class="op" id="4016530">)</span>&nbsp;<span class="comment" id="4016532">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016549">lostbits</span>&nbsp;<span class="op" id="4016558">:=</span>&nbsp;<span class="ident" id="4016561">mantissa</span>&nbsp;<span class="op" id="4016570">&amp;</span>&nbsp;<span class="op" id="4016572">(</span><span class="num" id="4016573">1</span><span class="op" id="4016574">&lt;&lt;</span><span class="ident" id="4016576">shift</span>&nbsp;<span class="op" id="4016582">-</span>&nbsp;<span class="num" id="4016584">1</span><span class="op" id="4016585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016589">haveRem</span>&nbsp;<span class="op" id="4016597">=</span>&nbsp;<span class="ident" id="4016599">haveRem</span>&nbsp;<span class="op" id="4016607">||</span>&nbsp;<span class="ident" id="4016610">lostbits</span>&nbsp;<span class="op" id="4016619">!=</span>&nbsp;<span class="num" id="4016622">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016626">mantissa</span>&nbsp;<span class="op" id="4016635">&gt;&gt;=</span>&nbsp;<span class="ident" id="4016639">shift</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016647">exp</span>&nbsp;<span class="op" id="4016651">=</span>&nbsp;<span class="num" id="4016653">2</span>&nbsp;<span class="op" id="4016655">-</span>&nbsp;<span class="ident" id="4016657">Ebias</span>&nbsp;<span class="comment" id="4016663">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4016682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4016685">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016723">exact</span>&nbsp;<span class="op" id="4016729">=</span>&nbsp;<span class="op" id="4016731">!</span><span class="ident" id="4016732">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016741">if</span>&nbsp;<span class="ident" id="4016744">mantissa</span><span class="op" id="4016752">&amp;</span><span class="num" id="4016753">1</span>&nbsp;<span class="op" id="4016755">!=</span>&nbsp;<span class="num" id="4016758">0</span>&nbsp;<span class="op" id="4016760">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016764">exact</span>&nbsp;<span class="op" id="4016770">=</span>&nbsp;<span class="builtintype" id="4016772">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016780">if</span>&nbsp;<span class="ident" id="4016783">haveRem</span>&nbsp;<span class="op" id="4016791">||</span>&nbsp;<span class="ident" id="4016794">mantissa</span><span class="op" id="4016802">&amp;</span><span class="num" id="4016803">2</span>&nbsp;<span class="op" id="4016805">!=</span>&nbsp;<span class="num" id="4016808">0</span>&nbsp;<span class="op" id="4016810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016815">if</span>&nbsp;<span class="ident" id="4016818">mantissa</span><span class="op" id="4016826">++</span><span class="op" id="4016828">;</span>&nbsp;<span class="ident" id="4016830">mantissa</span>&nbsp;<span class="op" id="4016839">&gt;=</span>&nbsp;<span class="num" id="4016842">1</span><span class="op" id="4016843">&lt;&lt;</span><span class="ident" id="4016845">Msize2</span>&nbsp;<span class="op" id="4016852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4016858">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016919">mantissa</span>&nbsp;<span class="op" id="4016928">&gt;&gt;=</span>&nbsp;<span class="num" id="4016932">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016938">exp</span><span class="op" id="4016941">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4016947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4016951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4016954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016957">mantissa</span>&nbsp;<span class="op" id="4016966">&gt;&gt;=</span>&nbsp;<span class="num" id="4016970">1</span>&nbsp;<span class="comment" id="4016972">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017034">f</span>&nbsp;<span class="op" id="4017036">=</span>&nbsp;<span class="ident" id="4017038">math</span><span class="op" id="4017042">.</span><span class="ident" id="4017043">Ldexp</span><span class="op" id="4017048">(</span><span class="builtintype" id="4017049">float64</span><span class="op" id="4017056">(</span><span class="ident" id="4017057">mantissa</span><span class="op" id="4017065">)</span><span class="op" id="4017066">,</span>&nbsp;<span class="ident" id="4017068">exp</span><span class="op" id="4017071">-</span><span class="ident" id="4017072">Msize1</span><span class="op" id="4017078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017081">if</span>&nbsp;<span class="ident" id="4017084">math</span><span class="op" id="4017088">.</span><span class="ident" id="4017089">IsInf</span><span class="op" id="4017094">(</span><span class="ident" id="4017095">f</span><span class="op" id="4017096">,</span>&nbsp;<span class="num" id="4017098">0</span><span class="op" id="4017099">)</span>&nbsp;<span class="op" id="4017101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017105">exact</span>&nbsp;<span class="op" id="4017111">=</span>&nbsp;<span class="builtintype" id="4017113">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4017120">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017123">return</span><br>
<span class="lineno"></span><span class="op" id="4017130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4017133">//&nbsp;Float32&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float32&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="4017206">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno">265</span><span class="comment" id="4017279">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float32,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="4017348">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="4017411">func</span>&nbsp;<span class="op" id="4017416">(</span><span class="ident" id="4017417">x</span>&nbsp;<span class="op" id="4017419">*</span><span class="ident" id="4017420">Rat</span><span class="op" id="4017423">)</span>&nbsp;<span class="ident" id="4017425">Float32</span><span class="op" id="4017432">(</span><span class="op" id="4017433">)</span>&nbsp;<span class="op" id="4017435">(</span><span class="ident" id="4017436">f</span>&nbsp;<span class="builtintype" id="4017438">float32</span><span class="op" id="4017445">,</span>&nbsp;<span class="ident" id="4017447">exact</span>&nbsp;<span class="builtintype" id="4017453">bool</span><span class="op" id="4017457">)</span>&nbsp;<span class="op" id="4017459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017462">b</span>&nbsp;<span class="op" id="4017464">:=</span>&nbsp;<span class="ident" id="4017467">x</span><span class="op" id="4017468">.</span><span class="ident" id="4017469">b</span><span class="op" id="4017470">.</span><span class="ident" id="4017471">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017476">if</span>&nbsp;<span class="builtinfunc" id="4017479">len</span><span class="op" id="4017482">(</span><span class="ident" id="4017483">b</span><span class="op" id="4017484">)</span>&nbsp;<span class="op" id="4017486">==</span>&nbsp;<span class="num" id="4017489">0</span>&nbsp;<span class="op" id="4017491">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017495">b</span>&nbsp;<span class="op" id="4017497">=</span>&nbsp;<span class="ident" id="4017499">b</span><span class="op" id="4017500">.</span><span class="ident" id="4017501">set</span><span class="op" id="4017504">(</span><span class="ident" id="4017505">natOne</span><span class="op" id="4017511">)</span>&nbsp;<span class="comment" id="4017513">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4017541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017544">f</span><span class="op" id="4017545">,</span>&nbsp;<span class="ident" id="4017547">exact</span>&nbsp;<span class="op" id="4017553">=</span>&nbsp;<span class="ident" id="4017555">quotToFloat32</span><span class="op" id="4017568">(</span><span class="ident" id="4017569">x</span><span class="op" id="4017570">.</span><span class="ident" id="4017571">a</span><span class="op" id="4017572">.</span><span class="ident" id="4017573">abs</span><span class="op" id="4017576">,</span>&nbsp;<span class="ident" id="4017578">b</span><span class="op" id="4017579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017582">if</span>&nbsp;<span class="ident" id="4017585">x</span><span class="op" id="4017586">.</span><span class="ident" id="4017587">a</span><span class="op" id="4017588">.</span><span class="ident" id="4017589">neg</span>&nbsp;<span class="op" id="4017593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017597">f</span>&nbsp;<span class="op" id="4017599">=</span>&nbsp;<span class="op" id="4017601">-</span><span class="ident" id="4017602">f</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4017605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017608">return</span><br>
<span class="lineno"></span><span class="op" id="4017615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4017618">//&nbsp;Float64&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float64&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno">280</span><span class="comment" id="4017691">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4017764">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float64,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="4017833">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="4017896">func</span>&nbsp;<span class="op" id="4017901">(</span><span class="ident" id="4017902">x</span>&nbsp;<span class="op" id="4017904">*</span><span class="ident" id="4017905">Rat</span><span class="op" id="4017908">)</span>&nbsp;<span class="ident" id="4017910">Float64</span><span class="op" id="4017917">(</span><span class="op" id="4017918">)</span>&nbsp;<span class="op" id="4017920">(</span><span class="ident" id="4017921">f</span>&nbsp;<span class="builtintype" id="4017923">float64</span><span class="op" id="4017930">,</span>&nbsp;<span class="ident" id="4017932">exact</span>&nbsp;<span class="builtintype" id="4017938">bool</span><span class="op" id="4017942">)</span>&nbsp;<span class="op" id="4017944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017947">b</span>&nbsp;<span class="op" id="4017949">:=</span>&nbsp;<span class="ident" id="4017952">x</span><span class="op" id="4017953">.</span><span class="ident" id="4017954">b</span><span class="op" id="4017955">.</span><span class="ident" id="4017956">abs</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017961">if</span>&nbsp;<span class="builtinfunc" id="4017964">len</span><span class="op" id="4017967">(</span><span class="ident" id="4017968">b</span><span class="op" id="4017969">)</span>&nbsp;<span class="op" id="4017971">==</span>&nbsp;<span class="num" id="4017974">0</span>&nbsp;<span class="op" id="4017976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017980">b</span>&nbsp;<span class="op" id="4017982">=</span>&nbsp;<span class="ident" id="4017984">b</span><span class="op" id="4017985">.</span><span class="ident" id="4017986">set</span><span class="op" id="4017989">(</span><span class="ident" id="4017990">natOne</span><span class="op" id="4017996">)</span>&nbsp;<span class="comment" id="4017998">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018029">f</span><span class="op" id="4018030">,</span>&nbsp;<span class="ident" id="4018032">exact</span>&nbsp;<span class="op" id="4018038">=</span>&nbsp;<span class="ident" id="4018040">quotToFloat64</span><span class="op" id="4018053">(</span><span class="ident" id="4018054">x</span><span class="op" id="4018055">.</span><span class="ident" id="4018056">a</span><span class="op" id="4018057">.</span><span class="ident" id="4018058">abs</span><span class="op" id="4018061">,</span>&nbsp;<span class="ident" id="4018063">b</span><span class="op" id="4018064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018067">if</span>&nbsp;<span class="ident" id="4018070">x</span><span class="op" id="4018071">.</span><span class="ident" id="4018072">a</span><span class="op" id="4018073">.</span><span class="ident" id="4018074">neg</span>&nbsp;<span class="op" id="4018078">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018082">f</span>&nbsp;<span class="op" id="4018084">=</span>&nbsp;<span class="op" id="4018086">-</span><span class="ident" id="4018087">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018093">return</span><br>
<span class="lineno"></span><span class="op" id="4018100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="4018103">//&nbsp;SetFrac&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4018143">func</span>&nbsp;<span class="op" id="4018148">(</span><span class="ident" id="4018149">z</span>&nbsp;<span class="op" id="4018151">*</span><span class="ident" id="4018152">Rat</span><span class="op" id="4018155">)</span>&nbsp;<span class="ident" id="4018157">SetFrac</span><span class="op" id="4018164">(</span><span class="ident" id="4018165">a</span><span class="op" id="4018166">,</span>&nbsp;<span class="ident" id="4018168">b</span>&nbsp;<span class="op" id="4018170">*</span><span class="ident" id="4018171">Int</span><span class="op" id="4018174">)</span>&nbsp;<span class="op" id="4018176">*</span><span class="ident" id="4018177">Rat</span>&nbsp;<span class="op" id="4018181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018184">z</span><span class="op" id="4018185">.</span><span class="ident" id="4018186">a</span><span class="op" id="4018187">.</span><span class="ident" id="4018188">neg</span>&nbsp;<span class="op" id="4018192">=</span>&nbsp;<span class="ident" id="4018194">a</span><span class="op" id="4018195">.</span><span class="ident" id="4018196">neg</span>&nbsp;<span class="op" id="4018200">!=</span>&nbsp;<span class="ident" id="4018203">b</span><span class="op" id="4018204">.</span><span class="ident" id="4018205">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018210">babs</span>&nbsp;<span class="op" id="4018215">:=</span>&nbsp;<span class="ident" id="4018218">b</span><span class="op" id="4018219">.</span><span class="ident" id="4018220">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018225">if</span>&nbsp;<span class="builtinfunc" id="4018228">len</span><span class="op" id="4018231">(</span><span class="ident" id="4018232">babs</span><span class="op" id="4018236">)</span>&nbsp;<span class="op" id="4018238">==</span>&nbsp;<span class="num" id="4018241">0</span>&nbsp;<span class="op" id="4018243">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4018247">panic</span><span class="op" id="4018252">(</span><span class="string" id="4018253">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4018271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018277">if</span>&nbsp;<span class="op" id="4018280">&amp;</span><span class="ident" id="4018281">z</span><span class="op" id="4018282">.</span><span class="ident" id="4018283">a</span>&nbsp;<span class="op" id="4018285">==</span>&nbsp;<span class="ident" id="4018288">b</span>&nbsp;<span class="op" id="4018290">||</span>&nbsp;<span class="ident" id="4018293">alias</span><span class="op" id="4018298">(</span><span class="ident" id="4018299">z</span><span class="op" id="4018300">.</span><span class="ident" id="4018301">a</span><span class="op" id="4018302">.</span><span class="ident" id="4018303">abs</span><span class="op" id="4018306">,</span>&nbsp;<span class="ident" id="4018308">babs</span><span class="op" id="4018312">)</span>&nbsp;<span class="op" id="4018314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018318">babs</span>&nbsp;<span class="op" id="4018323">=</span>&nbsp;<span class="ident" id="4018325">nat</span><span class="op" id="4018328">(</span><span class="ident" id="4018329">nil</span><span class="op" id="4018332">)</span><span class="op" id="4018333">.</span><span class="ident" id="4018334">set</span><span class="op" id="4018337">(</span><span class="ident" id="4018338">babs</span><span class="op" id="4018342">)</span>&nbsp;<span class="comment" id="4018344">//&nbsp;make&nbsp;a&nbsp;copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018360">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018363">z</span><span class="op" id="4018364">.</span><span class="ident" id="4018365">a</span><span class="op" id="4018366">.</span><span class="ident" id="4018367">abs</span>&nbsp;<span class="op" id="4018371">=</span>&nbsp;<span class="ident" id="4018373">z</span><span class="op" id="4018374">.</span><span class="ident" id="4018375">a</span><span class="op" id="4018376">.</span><span class="ident" id="4018377">abs</span><span class="op" id="4018380">.</span><span class="ident" id="4018381">set</span><span class="op" id="4018384">(</span><span class="ident" id="4018385">a</span><span class="op" id="4018386">.</span><span class="ident" id="4018387">abs</span><span class="op" id="4018390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018393">z</span><span class="op" id="4018394">.</span><span class="ident" id="4018395">b</span><span class="op" id="4018396">.</span><span class="ident" id="4018397">abs</span>&nbsp;<span class="op" id="4018401">=</span>&nbsp;<span class="ident" id="4018403">z</span><span class="op" id="4018404">.</span><span class="ident" id="4018405">b</span><span class="op" id="4018406">.</span><span class="ident" id="4018407">abs</span><span class="op" id="4018410">.</span><span class="ident" id="4018411">set</span><span class="op" id="4018414">(</span><span class="ident" id="4018415">babs</span><span class="op" id="4018419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018422">return</span>&nbsp;<span class="ident" id="4018429">z</span><span class="op" id="4018430">.</span><span class="ident" id="4018431">norm</span><span class="op" id="4018435">(</span><span class="op" id="4018436">)</span><br>
<span class="lineno"></span><span class="op" id="4018438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="4018441">//&nbsp;SetFrac64&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4018483">func</span>&nbsp;<span class="op" id="4018488">(</span><span class="ident" id="4018489">z</span>&nbsp;<span class="op" id="4018491">*</span><span class="ident" id="4018492">Rat</span><span class="op" id="4018495">)</span>&nbsp;<span class="ident" id="4018497">SetFrac64</span><span class="op" id="4018506">(</span><span class="ident" id="4018507">a</span><span class="op" id="4018508">,</span>&nbsp;<span class="ident" id="4018510">b</span>&nbsp;<span class="ident" id="4018512">int64</span><span class="op" id="4018517">)</span>&nbsp;<span class="op" id="4018519">*</span><span class="ident" id="4018520">Rat</span>&nbsp;<span class="op" id="4018524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018527">z</span><span class="op" id="4018528">.</span><span class="ident" id="4018529">a</span><span class="op" id="4018530">.</span><span class="ident" id="4018531">SetInt64</span><span class="op" id="4018539">(</span><span class="ident" id="4018540">a</span><span class="op" id="4018541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018544">if</span>&nbsp;<span class="ident" id="4018547">b</span>&nbsp;<span class="op" id="4018549">==</span>&nbsp;<span class="num" id="4018552">0</span>&nbsp;<span class="op" id="4018554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4018558">panic</span><span class="op" id="4018563">(</span><span class="string" id="4018564">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4018582">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018588">if</span>&nbsp;<span class="ident" id="4018591">b</span>&nbsp;<span class="op" id="4018593">&lt;</span>&nbsp;<span class="num" id="4018595">0</span>&nbsp;<span class="op" id="4018597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018601">b</span>&nbsp;<span class="op" id="4018603">=</span>&nbsp;<span class="op" id="4018605">-</span><span class="ident" id="4018606">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018610">z</span><span class="op" id="4018611">.</span><span class="ident" id="4018612">a</span><span class="op" id="4018613">.</span><span class="ident" id="4018614">neg</span>&nbsp;<span class="op" id="4018618">=</span>&nbsp;<span class="op" id="4018620">!</span><span class="ident" id="4018621">z</span><span class="op" id="4018622">.</span><span class="ident" id="4018623">a</span><span class="op" id="4018624">.</span><span class="ident" id="4018625">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018630">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018633">z</span><span class="op" id="4018634">.</span><span class="ident" id="4018635">b</span><span class="op" id="4018636">.</span><span class="ident" id="4018637">abs</span>&nbsp;<span class="op" id="4018641">=</span>&nbsp;<span class="ident" id="4018643">z</span><span class="op" id="4018644">.</span><span class="ident" id="4018645">b</span><span class="op" id="4018646">.</span><span class="ident" id="4018647">abs</span><span class="op" id="4018650">.</span><span class="ident" id="4018651">setUint64</span><span class="op" id="4018660">(</span><span class="ident" id="4018661">uint64</span><span class="op" id="4018667">(</span><span class="ident" id="4018668">b</span><span class="op" id="4018669">)</span><span class="op" id="4018670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018673">return</span>&nbsp;<span class="ident" id="4018680">z</span><span class="op" id="4018681">.</span><span class="ident" id="4018682">norm</span><span class="op" id="4018686">(</span><span class="op" id="4018687">)</span><br>
<span class="lineno"></span><span class="op" id="4018689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4018692">//&nbsp;SetInt&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">325</span><span class="keyword" id="4018753">func</span>&nbsp;<span class="op" id="4018758">(</span><span class="ident" id="4018759">z</span>&nbsp;<span class="op" id="4018761">*</span><span class="ident" id="4018762">Rat</span><span class="op" id="4018765">)</span>&nbsp;<span class="ident" id="4018767">SetInt</span><span class="op" id="4018773">(</span><span class="ident" id="4018774">x</span>&nbsp;<span class="op" id="4018776">*</span><span class="ident" id="4018777">Int</span><span class="op" id="4018780">)</span>&nbsp;<span class="op" id="4018782">*</span><span class="ident" id="4018783">Rat</span>&nbsp;<span class="op" id="4018787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018790">z</span><span class="op" id="4018791">.</span><span class="ident" id="4018792">a</span><span class="op" id="4018793">.</span><span class="ident" id="4018794">Set</span><span class="op" id="4018797">(</span><span class="ident" id="4018798">x</span><span class="op" id="4018799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018802">z</span><span class="op" id="4018803">.</span><span class="ident" id="4018804">b</span><span class="op" id="4018805">.</span><span class="ident" id="4018806">abs</span>&nbsp;<span class="op" id="4018810">=</span>&nbsp;<span class="ident" id="4018812">z</span><span class="op" id="4018813">.</span><span class="ident" id="4018814">b</span><span class="op" id="4018815">.</span><span class="ident" id="4018816">abs</span><span class="op" id="4018819">.</span><span class="builtinfunc" id="4018820">make</span><span class="op" id="4018824">(</span><span class="num" id="4018825">0</span><span class="op" id="4018826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018829">return</span>&nbsp;<span class="ident" id="4018836">z</span><br>
<span class="lineno"></span><span class="op" id="4018838">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="4018841">//&nbsp;SetInt64&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4018880">func</span>&nbsp;<span class="op" id="4018885">(</span><span class="ident" id="4018886">z</span>&nbsp;<span class="op" id="4018888">*</span><span class="ident" id="4018889">Rat</span><span class="op" id="4018892">)</span>&nbsp;<span class="ident" id="4018894">SetInt64</span><span class="op" id="4018902">(</span><span class="ident" id="4018903">x</span>&nbsp;<span class="ident" id="4018905">int64</span><span class="op" id="4018910">)</span>&nbsp;<span class="op" id="4018912">*</span><span class="ident" id="4018913">Rat</span>&nbsp;<span class="op" id="4018917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018920">z</span><span class="op" id="4018921">.</span><span class="ident" id="4018922">a</span><span class="op" id="4018923">.</span><span class="ident" id="4018924">SetInt64</span><span class="op" id="4018932">(</span><span class="ident" id="4018933">x</span><span class="op" id="4018934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018937">z</span><span class="op" id="4018938">.</span><span class="ident" id="4018939">b</span><span class="op" id="4018940">.</span><span class="ident" id="4018941">abs</span>&nbsp;<span class="op" id="4018945">=</span>&nbsp;<span class="ident" id="4018947">z</span><span class="op" id="4018948">.</span><span class="ident" id="4018949">b</span><span class="op" id="4018950">.</span><span class="ident" id="4018951">abs</span><span class="op" id="4018954">.</span><span class="builtinfunc" id="4018955">make</span><span class="op" id="4018959">(</span><span class="num" id="4018960">0</span><span class="op" id="4018961">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018964">return</span>&nbsp;<span class="ident" id="4018971">z</span><br>
<span class="lineno"></span><span class="op" id="4018973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4018976">//&nbsp;Set&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4019034">func</span>&nbsp;<span class="op" id="4019039">(</span><span class="ident" id="4019040">z</span>&nbsp;<span class="op" id="4019042">*</span><span class="ident" id="4019043">Rat</span><span class="op" id="4019046">)</span>&nbsp;<span class="ident" id="4019048">Set</span><span class="op" id="4019051">(</span><span class="ident" id="4019052">x</span>&nbsp;<span class="op" id="4019054">*</span><span class="ident" id="4019055">Rat</span><span class="op" id="4019058">)</span>&nbsp;<span class="op" id="4019060">*</span><span class="ident" id="4019061">Rat</span>&nbsp;<span class="op" id="4019065">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019068">if</span>&nbsp;<span class="ident" id="4019071">z</span>&nbsp;<span class="op" id="4019073">!=</span>&nbsp;<span class="ident" id="4019076">x</span>&nbsp;<span class="op" id="4019078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019082">z</span><span class="op" id="4019083">.</span><span class="ident" id="4019084">a</span><span class="op" id="4019085">.</span><span class="ident" id="4019086">Set</span><span class="op" id="4019089">(</span><span class="op" id="4019090">&amp;</span><span class="ident" id="4019091">x</span><span class="op" id="4019092">.</span><span class="ident" id="4019093">a</span><span class="op" id="4019094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019098">z</span><span class="op" id="4019099">.</span><span class="ident" id="4019100">b</span><span class="op" id="4019101">.</span><span class="ident" id="4019102">Set</span><span class="op" id="4019105">(</span><span class="op" id="4019106">&amp;</span><span class="ident" id="4019107">x</span><span class="op" id="4019108">.</span><span class="ident" id="4019109">b</span><span class="op" id="4019110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4019113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019116">return</span>&nbsp;<span class="ident" id="4019123">z</span><br>
<span class="lineno">345</span><span class="op" id="4019125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4019128">//&nbsp;Abs&nbsp;sets&nbsp;z&nbsp;to&nbsp;|x|&nbsp;(the&nbsp;absolute&nbsp;value&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4019190">func</span>&nbsp;<span class="op" id="4019195">(</span><span class="ident" id="4019196">z</span>&nbsp;<span class="op" id="4019198">*</span><span class="ident" id="4019199">Rat</span><span class="op" id="4019202">)</span>&nbsp;<span class="ident" id="4019204">Abs</span><span class="op" id="4019207">(</span><span class="ident" id="4019208">x</span>&nbsp;<span class="op" id="4019210">*</span><span class="ident" id="4019211">Rat</span><span class="op" id="4019214">)</span>&nbsp;<span class="op" id="4019216">*</span><span class="ident" id="4019217">Rat</span>&nbsp;<span class="op" id="4019221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019224">z</span><span class="op" id="4019225">.</span><span class="ident" id="4019226">Set</span><span class="op" id="4019229">(</span><span class="ident" id="4019230">x</span><span class="op" id="4019231">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019234">z</span><span class="op" id="4019235">.</span><span class="ident" id="4019236">a</span><span class="op" id="4019237">.</span><span class="ident" id="4019238">neg</span>&nbsp;<span class="op" id="4019242">=</span>&nbsp;<span class="builtintype" id="4019244">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019251">return</span>&nbsp;<span class="ident" id="4019258">z</span><br>
<span class="lineno"></span><span class="op" id="4019260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4019263">//&nbsp;Neg&nbsp;sets&nbsp;z&nbsp;to&nbsp;-x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">355</span><span class="keyword" id="4019298">func</span>&nbsp;<span class="op" id="4019303">(</span><span class="ident" id="4019304">z</span>&nbsp;<span class="op" id="4019306">*</span><span class="ident" id="4019307">Rat</span><span class="op" id="4019310">)</span>&nbsp;<span class="ident" id="4019312">Neg</span><span class="op" id="4019315">(</span><span class="ident" id="4019316">x</span>&nbsp;<span class="op" id="4019318">*</span><span class="ident" id="4019319">Rat</span><span class="op" id="4019322">)</span>&nbsp;<span class="op" id="4019324">*</span><span class="ident" id="4019325">Rat</span>&nbsp;<span class="op" id="4019329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019332">z</span><span class="op" id="4019333">.</span><span class="ident" id="4019334">Set</span><span class="op" id="4019337">(</span><span class="ident" id="4019338">x</span><span class="op" id="4019339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019342">z</span><span class="op" id="4019343">.</span><span class="ident" id="4019344">a</span><span class="op" id="4019345">.</span><span class="ident" id="4019346">neg</span>&nbsp;<span class="op" id="4019350">=</span>&nbsp;<span class="builtinfunc" id="4019352">len</span><span class="op" id="4019355">(</span><span class="ident" id="4019356">z</span><span class="op" id="4019357">.</span><span class="ident" id="4019358">a</span><span class="op" id="4019359">.</span><span class="ident" id="4019360">abs</span><span class="op" id="4019363">)</span>&nbsp;<span class="op" id="4019365">&gt;</span>&nbsp;<span class="num" id="4019367">0</span>&nbsp;<span class="op" id="4019369">&amp;&amp;</span>&nbsp;<span class="op" id="4019372">!</span><span class="ident" id="4019373">z</span><span class="op" id="4019374">.</span><span class="ident" id="4019375">a</span><span class="op" id="4019376">.</span><span class="ident" id="4019377">neg</span>&nbsp;<span class="comment" id="4019381">//&nbsp;0&nbsp;has&nbsp;no&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019399">return</span>&nbsp;<span class="ident" id="4019406">z</span><br>
<span class="lineno"></span><span class="op" id="4019408">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="4019411">//&nbsp;Inv&nbsp;sets&nbsp;z&nbsp;to&nbsp;1/x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4019447">func</span>&nbsp;<span class="op" id="4019452">(</span><span class="ident" id="4019453">z</span>&nbsp;<span class="op" id="4019455">*</span><span class="ident" id="4019456">Rat</span><span class="op" id="4019459">)</span>&nbsp;<span class="ident" id="4019461">Inv</span><span class="op" id="4019464">(</span><span class="ident" id="4019465">x</span>&nbsp;<span class="op" id="4019467">*</span><span class="ident" id="4019468">Rat</span><span class="op" id="4019471">)</span>&nbsp;<span class="op" id="4019473">*</span><span class="ident" id="4019474">Rat</span>&nbsp;<span class="op" id="4019478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019481">if</span>&nbsp;<span class="builtinfunc" id="4019484">len</span><span class="op" id="4019487">(</span><span class="ident" id="4019488">x</span><span class="op" id="4019489">.</span><span class="ident" id="4019490">a</span><span class="op" id="4019491">.</span><span class="ident" id="4019492">abs</span><span class="op" id="4019495">)</span>&nbsp;<span class="op" id="4019497">==</span>&nbsp;<span class="num" id="4019500">0</span>&nbsp;<span class="op" id="4019502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4019506">panic</span><span class="op" id="4019511">(</span><span class="string" id="4019512">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4019530">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4019533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019536">z</span><span class="op" id="4019537">.</span><span class="ident" id="4019538">Set</span><span class="op" id="4019541">(</span><span class="ident" id="4019542">x</span><span class="op" id="4019543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019546">a</span>&nbsp;<span class="op" id="4019548">:=</span>&nbsp;<span class="ident" id="4019551">z</span><span class="op" id="4019552">.</span><span class="ident" id="4019553">b</span><span class="op" id="4019554">.</span><span class="ident" id="4019555">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019560">if</span>&nbsp;<span class="builtinfunc" id="4019563">len</span><span class="op" id="4019566">(</span><span class="ident" id="4019567">a</span><span class="op" id="4019568">)</span>&nbsp;<span class="op" id="4019570">==</span>&nbsp;<span class="num" id="4019573">0</span>&nbsp;<span class="op" id="4019575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019579">a</span>&nbsp;<span class="op" id="4019581">=</span>&nbsp;<span class="ident" id="4019583">a</span><span class="op" id="4019584">.</span><span class="ident" id="4019585">set</span><span class="op" id="4019588">(</span><span class="ident" id="4019589">natOne</span><span class="op" id="4019595">)</span>&nbsp;<span class="comment" id="4019597">//&nbsp;materialize&nbsp;numerator</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4019623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019626">b</span>&nbsp;<span class="op" id="4019628">:=</span>&nbsp;<span class="ident" id="4019631">z</span><span class="op" id="4019632">.</span><span class="ident" id="4019633">a</span><span class="op" id="4019634">.</span><span class="ident" id="4019635">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019640">if</span>&nbsp;<span class="ident" id="4019643">b</span><span class="op" id="4019644">.</span><span class="ident" id="4019645">cmp</span><span class="op" id="4019648">(</span><span class="ident" id="4019649">natOne</span><span class="op" id="4019655">)</span>&nbsp;<span class="op" id="4019657">==</span>&nbsp;<span class="num" id="4019660">0</span>&nbsp;<span class="op" id="4019662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019666">b</span>&nbsp;<span class="op" id="4019668">=</span>&nbsp;<span class="ident" id="4019670">b</span><span class="op" id="4019671">.</span><span class="builtinfunc" id="4019672">make</span><span class="op" id="4019676">(</span><span class="num" id="4019677">0</span><span class="op" id="4019678">)</span>&nbsp;<span class="comment" id="4019680">//&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4019706">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019709">z</span><span class="op" id="4019710">.</span><span class="ident" id="4019711">a</span><span class="op" id="4019712">.</span><span class="ident" id="4019713">abs</span><span class="op" id="4019716">,</span>&nbsp;<span class="ident" id="4019718">z</span><span class="op" id="4019719">.</span><span class="ident" id="4019720">b</span><span class="op" id="4019721">.</span><span class="ident" id="4019722">abs</span>&nbsp;<span class="op" id="4019726">=</span>&nbsp;<span class="ident" id="4019728">a</span><span class="op" id="4019729">,</span>&nbsp;<span class="ident" id="4019731">b</span>&nbsp;<span class="comment" id="4019733">//&nbsp;sign&nbsp;doesn&#39;t&nbsp;change</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019757">return</span>&nbsp;<span class="ident" id="4019764">z</span><br>
<span class="lineno"></span><span class="op" id="4019766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4019769">//&nbsp;Sign&nbsp;returns:</span><br>
<span class="lineno">380</span><span class="comment" id="4019786">//</span><br>
<span class="lineno"></span><span class="comment" id="4019789">//&nbsp;&nbsp;&nbsp;&nbsp-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4019805">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4019821">//&nbsp;&nbsp;&nbsp;&nbsp+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4019837">//</span><br>
<span class="lineno">385</span><span class="keyword" id="4019840">func</span>&nbsp;<span class="op" id="4019845">(</span><span class="ident" id="4019846">x</span>&nbsp;<span class="op" id="4019848">*</span><span class="ident" id="4019849">Rat</span><span class="op" id="4019852">)</span>&nbsp;<span class="ident" id="4019854">Sign</span><span class="op" id="4019858">(</span><span class="op" id="4019859">)</span>&nbsp;<span class="builtintype" id="4019861">int</span>&nbsp;<span class="op" id="4019865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019868">return</span>&nbsp;<span class="ident" id="4019875">x</span><span class="op" id="4019876">.</span><span class="ident" id="4019877">a</span><span class="op" id="4019878">.</span><span class="ident" id="4019879">Sign</span><span class="op" id="4019883">(</span><span class="op" id="4019884">)</span><br>
<span class="lineno"></span><span class="op" id="4019886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4019889">//&nbsp;IsInt&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x&nbsp;is&nbsp;1.</span><br>
<span class="lineno">390</span><span class="keyword" id="4019941">func</span>&nbsp;<span class="op" id="4019946">(</span><span class="ident" id="4019947">x</span>&nbsp;<span class="op" id="4019949">*</span><span class="ident" id="4019950">Rat</span><span class="op" id="4019953">)</span>&nbsp;<span class="ident" id="4019955">IsInt</span><span class="op" id="4019960">(</span><span class="op" id="4019961">)</span>&nbsp;<span class="builtintype" id="4019963">bool</span>&nbsp;<span class="op" id="4019968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019971">return</span>&nbsp;<span class="builtinfunc" id="4019978">len</span><span class="op" id="4019981">(</span><span class="ident" id="4019982">x</span><span class="op" id="4019983">.</span><span class="ident" id="4019984">b</span><span class="op" id="4019985">.</span><span class="ident" id="4019986">abs</span><span class="op" id="4019989">)</span>&nbsp;<span class="op" id="4019991">==</span>&nbsp;<span class="num" id="4019994">0</span>&nbsp;<span class="op" id="4019996">||</span>&nbsp;<span class="ident" id="4019999">x</span><span class="op" id="4020000">.</span><span class="ident" id="4020001">b</span><span class="op" id="4020002">.</span><span class="ident" id="4020003">abs</span><span class="op" id="4020006">.</span><span class="ident" id="4020007">cmp</span><span class="op" id="4020010">(</span><span class="ident" id="4020011">natOne</span><span class="op" id="4020017">)</span>&nbsp;<span class="op" id="4020019">==</span>&nbsp;<span class="num" id="4020022">0</span><br>
<span class="lineno"></span><span class="op" id="4020024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4020027">//&nbsp;Num&nbsp;returns&nbsp;the&nbsp;numerator&nbsp;of&nbsp;x;&nbsp;it&nbsp;may&nbsp;be&nbsp;&lt;=&nbsp;0.</span><br>
<span class="lineno">395</span><span class="comment" id="4020078">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;numerator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4020128">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span><span class="comment" id="4020191">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;the&nbsp;numerator&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;sign&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4020250">func</span>&nbsp;<span class="op" id="4020255">(</span><span class="ident" id="4020256">x</span>&nbsp;<span class="op" id="4020258">*</span><span class="ident" id="4020259">Rat</span><span class="op" id="4020262">)</span>&nbsp;<span class="ident" id="4020264">Num</span><span class="op" id="4020267">(</span><span class="op" id="4020268">)</span>&nbsp;<span class="op" id="4020270">*</span><span class="ident" id="4020271">Int</span>&nbsp;<span class="op" id="4020275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020278">return</span>&nbsp;<span class="op" id="4020285">&amp;</span><span class="ident" id="4020286">x</span><span class="op" id="4020287">.</span><span class="ident" id="4020288">a</span><br>
<span class="lineno">400</span><span class="op" id="4020290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4020293">//&nbsp;Denom&nbsp;returns&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x;&nbsp;it&nbsp;is&nbsp;always&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="4020350">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;denominator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4020402">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno">405</span><span class="keyword" id="4020465">func</span>&nbsp;<span class="op" id="4020470">(</span><span class="ident" id="4020471">x</span>&nbsp;<span class="op" id="4020473">*</span><span class="ident" id="4020474">Rat</span><span class="op" id="4020477">)</span>&nbsp;<span class="ident" id="4020479">Denom</span><span class="op" id="4020484">(</span><span class="op" id="4020485">)</span>&nbsp;<span class="op" id="4020487">*</span><span class="ident" id="4020488">Int</span>&nbsp;<span class="op" id="4020492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4020495">x</span><span class="op" id="4020496">.</span><span class="ident" id="4020497">b</span><span class="op" id="4020498">.</span><span class="ident" id="4020499">neg</span>&nbsp;<span class="op" id="4020503">=</span>&nbsp;<span class="builtintype" id="4020505">false</span>&nbsp;<span class="comment" id="4020511">//&nbsp;the&nbsp;result&nbsp;is&nbsp;always&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020541">if</span>&nbsp;<span class="builtinfunc" id="4020544">len</span><span class="op" id="4020547">(</span><span class="ident" id="4020548">x</span><span class="op" id="4020549">.</span><span class="ident" id="4020550">b</span><span class="op" id="4020551">.</span><span class="ident" id="4020552">abs</span><span class="op" id="4020555">)</span>&nbsp;<span class="op" id="4020557">==</span>&nbsp;<span class="num" id="4020560">0</span>&nbsp;<span class="op" id="4020562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4020566">x</span><span class="op" id="4020567">.</span><span class="ident" id="4020568">b</span><span class="op" id="4020569">.</span><span class="ident" id="4020570">abs</span>&nbsp;<span class="op" id="4020574">=</span>&nbsp;<span class="ident" id="4020576">x</span><span class="op" id="4020577">.</span><span class="ident" id="4020578">b</span><span class="op" id="4020579">.</span><span class="ident" id="4020580">abs</span><span class="op" id="4020583">.</span><span class="ident" id="4020584">set</span><span class="op" id="4020587">(</span><span class="ident" id="4020588">natOne</span><span class="op" id="4020594">)</span>&nbsp;<span class="comment" id="4020596">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4020624">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020627">return</span>&nbsp;<span class="op" id="4020634">&amp;</span><span class="ident" id="4020635">x</span><span class="op" id="4020636">.</span><span class="ident" id="4020637">b</span><br>
<span class="lineno"></span><span class="op" id="4020639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4020642">func</span>&nbsp;<span class="op" id="4020647">(</span><span class="ident" id="4020648">z</span>&nbsp;<span class="op" id="4020650">*</span><span class="ident" id="4020651">Rat</span><span class="op" id="4020654">)</span>&nbsp;<span class="ident" id="4020656">norm</span><span class="op" id="4020660">(</span><span class="op" id="4020661">)</span>&nbsp;<span class="op" id="4020663">*</span><span class="ident" id="4020664">Rat</span>&nbsp;<span class="op" id="4020668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020671">switch</span>&nbsp;<span class="op" id="4020678">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020681">case</span>&nbsp;<span class="builtinfunc" id="4020686">len</span><span class="op" id="4020689">(</span><span class="ident" id="4020690">z</span><span class="op" id="4020691">.</span><span class="ident" id="4020692">a</span><span class="op" id="4020693">.</span><span class="ident" id="4020694">abs</span><span class="op" id="4020697">)</span>&nbsp;<span class="op" id="4020699">==</span>&nbsp;<span class="num" id="4020702">0</span><span class="op" id="4020703">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4020707">//&nbsp;z&nbsp;==&nbsp;0&nbsp;-&nbsp;normalize&nbsp;sign&nbsp;and&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4020752">z</span><span class="op" id="4020753">.</span><span class="ident" id="4020754">a</span><span class="op" id="4020755">.</span><span class="ident" id="4020756">neg</span>&nbsp;<span class="op" id="4020760">=</span>&nbsp;<span class="builtintype" id="4020762">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4020770">z</span><span class="op" id="4020771">.</span><span class="ident" id="4020772">b</span><span class="op" id="4020773">.</span><span class="ident" id="4020774">abs</span>&nbsp;<span class="op" id="4020778">=</span>&nbsp;<span class="ident" id="4020780">z</span><span class="op" id="4020781">.</span><span class="ident" id="4020782">b</span><span class="op" id="4020783">.</span><span class="ident" id="4020784">abs</span><span class="op" id="4020787">.</span><span class="builtinfunc" id="4020788">make</span><span class="op" id="4020792">(</span><span class="num" id="4020793">0</span><span class="op" id="4020794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020797">case</span>&nbsp;<span class="builtinfunc" id="4020802">len</span><span class="op" id="4020805">(</span><span class="ident" id="4020806">z</span><span class="op" id="4020807">.</span><span class="ident" id="4020808">b</span><span class="op" id="4020809">.</span><span class="ident" id="4020810">abs</span><span class="op" id="4020813">)</span>&nbsp;<span class="op" id="4020815">==</span>&nbsp;<span class="num" id="4020818">0</span><span class="op" id="4020819">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4020823">//&nbsp;z&nbsp;is&nbsp;normalized&nbsp;int&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020863">case</span>&nbsp;<span class="ident" id="4020868">z</span><span class="op" id="4020869">.</span><span class="ident" id="4020870">b</span><span class="op" id="4020871">.</span><span class="ident" id="4020872">abs</span><span class="op" id="4020875">.</span><span class="ident" id="4020876">cmp</span><span class="op" id="4020879">(</span><span class="ident" id="4020880">natOne</span><span class="op" id="4020886">)</span>&nbsp;<span class="op" id="4020888">==</span>&nbsp;<span class="num" id="4020891">0</span><span class="op" id="4020892">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4020896">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4020934">z</span><span class="op" id="4020935">.</span><span class="ident" id="4020936">b</span><span class="op" id="4020937">.</span><span class="ident" id="4020938">abs</span>&nbsp;<span class="op" id="4020942">=</span>&nbsp;<span class="ident" id="4020944">z</span><span class="op" id="4020945">.</span><span class="ident" id="4020946">b</span><span class="op" id="4020947">.</span><span class="ident" id="4020948">abs</span><span class="op" id="4020951">.</span><span class="builtinfunc" id="4020952">make</span><span class="op" id="4020956">(</span><span class="num" id="4020957">0</span><span class="op" id="4020958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020961">default</span><span class="op" id="4020968">:</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4020972">neg</span>&nbsp;<span class="op" id="4020976">:=</span>&nbsp;<span class="ident" id="4020979">z</span><span class="op" id="4020980">.</span><span class="ident" id="4020981">a</span><span class="op" id="4020982">.</span><span class="ident" id="4020983">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4020989">z</span><span class="op" id="4020990">.</span><span class="ident" id="4020991">a</span><span class="op" id="4020992">.</span><span class="ident" id="4020993">neg</span>&nbsp;<span class="op" id="4020997">=</span>&nbsp;<span class="builtintype" id="4020999">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4021007">z</span><span class="op" id="4021008">.</span><span class="ident" id="4021009">b</span><span class="op" id="4021010">.</span><span class="ident" id="4021011">neg</span>&nbsp;<span class="op" id="4021015">=</span>&nbsp;<span class="builtintype" id="4021017">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021025">if</span>&nbsp;<span class="ident" id="4021028">f</span>&nbsp;<span class="op" id="4021030">:=</span>&nbsp;<span class="ident" id="4021033">NewInt</span><span class="op" id="4021039">(</span><span class="num" id="4021040">0</span><span class="op" id="4021041">)</span><span class="op" id="4021042">.</span><span class="ident" id="4021043">binaryGCD</span><span class="op" id="4021052">(</span><span class="op" id="4021053">&amp;</span><span class="ident" id="4021054">z</span><span class="op" id="4021055">.</span><span class="ident" id="4021056">a</span><span class="op" id="4021057">,</span>&nbsp;<span class="op" id="4021059">&amp;</span><span class="ident" id="4021060">z</span><span class="op" id="4021061">.</span><span class="ident" id="4021062">b</span><span class="op" id="4021063">)</span><span class="op" id="4021064">;</span>&nbsp;<span class="ident" id="4021066">f</span><span class="op" id="4021067">.</span><span class="ident" id="4021068">Cmp</span><span class="op" id="4021071">(</span><span class="ident" id="4021072">intOne</span><span class="op" id="4021078">)</span>&nbsp;<span class="op" id="4021080">!=</span>&nbsp;<span class="num" id="4021083">0</span>&nbsp;<span class="op" id="4021085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4021090">z</span><span class="op" id="4021091">.</span><span class="ident" id="4021092">a</span><span class="op" id="4021093">.</span><span class="ident" id="4021094">abs</span><span class="op" id="4021097">,</span>&nbsp;<span class="ident" id="4021099">_</span>&nbsp;<span class="op" id="4021101">=</span>&nbsp;<span class="ident" id="4021103">z</span><span class="op" id="4021104">.</span><span class="ident" id="4021105">a</span><span class="op" id="4021106">.</span><span class="ident" id="4021107">abs</span><span class="op" id="4021110">.</span><span class="ident" id="4021111">div</span><span class="op" id="4021114">(</span><span class="ident" id="4021115">nil</span><span class="op" id="4021118">,</span>&nbsp;<span class="ident" id="4021120">z</span><span class="op" id="4021121">.</span><span class="ident" id="4021122">a</span><span class="op" id="4021123">.</span><span class="ident" id="4021124">abs</span><span class="op" id="4021127">,</span>&nbsp;<span class="ident" id="4021129">f</span><span class="op" id="4021130">.</span><span class="ident" id="4021131">abs</span><span class="op" id="4021134">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4021139">z</span><span class="op" id="4021140">.</span><span class="ident" id="4021141">b</span><span class="op" id="4021142">.</span><span class="ident" id="4021143">abs</span><span class="op" id="4021146">,</span>&nbsp;<span class="ident" id="4021148">_</span>&nbsp;<span class="op" id="4021150">=</span>&nbsp;<span class="ident" id="4021152">z</span><span class="op" id="4021153">.</span><span class="ident" id="4021154">b</span><span class="op" id="4021155">.</span><span class="ident" id="4021156">abs</span><span class="op" id="4021159">.</span><span class="ident" id="4021160">div</span><span class="op" id="4021163">(</span><span class="ident" id="4021164">nil</span><span class="op" id="4021167">,</span>&nbsp;<span class="ident" id="4021169">z</span><span class="op" id="4021170">.</span><span class="ident" id="4021171">b</span><span class="op" id="4021172">.</span><span class="ident" id="4021173">abs</span><span class="op" id="4021176">,</span>&nbsp;<span class="ident" id="4021178">f</span><span class="op" id="4021179">.</span><span class="ident" id="4021180">abs</span><span class="op" id="4021183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021188">if</span>&nbsp;<span class="ident" id="4021191">z</span><span class="op" id="4021192">.</span><span class="ident" id="4021193">b</span><span class="op" id="4021194">.</span><span class="ident" id="4021195">abs</span><span class="op" id="4021198">.</span><span class="ident" id="4021199">cmp</span><span class="op" id="4021202">(</span><span class="ident" id="4021203">natOne</span><span class="op" id="4021209">)</span>&nbsp;<span class="op" id="4021211">==</span>&nbsp;<span class="num" id="4021214">0</span>&nbsp;<span class="op" id="4021216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4021222">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4021262">z</span><span class="op" id="4021263">.</span><span class="ident" id="4021264">b</span><span class="op" id="4021265">.</span><span class="ident" id="4021266">abs</span>&nbsp;<span class="op" id="4021270">=</span>&nbsp;<span class="ident" id="4021272">z</span><span class="op" id="4021273">.</span><span class="ident" id="4021274">b</span><span class="op" id="4021275">.</span><span class="ident" id="4021276">abs</span><span class="op" id="4021279">.</span><span class="builtinfunc" id="4021280">make</span><span class="op" id="4021284">(</span><span class="num" id="4021285">0</span><span class="op" id="4021286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4021291">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4021295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4021299">z</span><span class="op" id="4021300">.</span><span class="ident" id="4021301">a</span><span class="op" id="4021302">.</span><span class="ident" id="4021303">neg</span>&nbsp;<span class="op" id="4021307">=</span>&nbsp;<span class="ident" id="4021309">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4021314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021317">return</span>&nbsp;<span class="ident" id="4021324">z</span><br>
<span class="lineno"></span><span class="op" id="4021326">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="4021329">//&nbsp;mulDenom&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;denominator&nbsp;product&nbsp;x*y&nbsp;(by&nbsp;taking&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="4021395">//&nbsp;account&nbsp;that&nbsp;0&nbsp;values&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;as&nbsp;1)&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4021461">//&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4021475">func</span>&nbsp;<span class="ident" id="4021480">mulDenom</span><span class="op" id="4021488">(</span><span class="ident" id="4021489">z</span><span class="op" id="4021490">,</span>&nbsp;<span class="ident" id="4021492">x</span><span class="op" id="4021493">,</span>&nbsp;<span class="ident" id="4021495">y</span>&nbsp;<span class="ident" id="4021497">nat</span><span class="op" id="4021500">)</span>&nbsp;<span class="ident" id="4021502">nat</span>&nbsp;<span class="op" id="4021506">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021509">switch</span>&nbsp;<span class="op" id="4021516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021519">case</span>&nbsp;<span class="builtinfunc" id="4021524">len</span><span class="op" id="4021527">(</span><span class="ident" id="4021528">x</span><span class="op" id="4021529">)</span>&nbsp;<span class="op" id="4021531">==</span>&nbsp;<span class="num" id="4021534">0</span><span class="op" id="4021535">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021539">return</span>&nbsp;<span class="ident" id="4021546">z</span><span class="op" id="4021547">.</span><span class="ident" id="4021548">set</span><span class="op" id="4021551">(</span><span class="ident" id="4021552">y</span><span class="op" id="4021553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021556">case</span>&nbsp;<span class="builtinfunc" id="4021561">len</span><span class="op" id="4021564">(</span><span class="ident" id="4021565">y</span><span class="op" id="4021566">)</span>&nbsp;<span class="op" id="4021568">==</span>&nbsp;<span class="num" id="4021571">0</span><span class="op" id="4021572">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021576">return</span>&nbsp;<span class="ident" id="4021583">z</span><span class="op" id="4021584">.</span><span class="ident" id="4021585">set</span><span class="op" id="4021588">(</span><span class="ident" id="4021589">x</span><span class="op" id="4021590">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4021593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021596">return</span>&nbsp;<span class="ident" id="4021603">z</span><span class="op" id="4021604">.</span><span class="ident" id="4021605">mul</span><span class="op" id="4021608">(</span><span class="ident" id="4021609">x</span><span class="op" id="4021610">,</span>&nbsp;<span class="ident" id="4021612">y</span><span class="op" id="4021613">)</span><br>
<span class="lineno"></span><span class="op" id="4021615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4021618">//&nbsp;scaleDenom&nbsp;computes&nbsp;x*f.</span><br>
<span class="lineno">455</span><span class="comment" id="4021646">//&nbsp;If&nbsp;f&nbsp;==&nbsp;0&nbsp;(zero&nbsp;value&nbsp;of&nbsp;denominator),&nbsp;the&nbsp;result&nbsp;is&nbsp;(a&nbsp;copy&nbsp;of)&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4021717">func</span>&nbsp;<span class="ident" id="4021722">scaleDenom</span><span class="op" id="4021732">(</span><span class="ident" id="4021733">x</span>&nbsp;<span class="op" id="4021735">*</span><span class="ident" id="4021736">Int</span><span class="op" id="4021739">,</span>&nbsp;<span class="ident" id="4021741">f</span>&nbsp;<span class="ident" id="4021743">nat</span><span class="op" id="4021746">)</span>&nbsp;<span class="op" id="4021748">*</span><span class="ident" id="4021749">Int</span>&nbsp;<span class="op" id="4021753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021756">var</span>&nbsp;<span class="ident" id="4021760">z</span>&nbsp;<span class="ident" id="4021762">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021767">if</span>&nbsp;<span class="builtinfunc" id="4021770">len</span><span class="op" id="4021773">(</span><span class="ident" id="4021774">f</span><span class="op" id="4021775">)</span>&nbsp;<span class="op" id="4021777">==</span>&nbsp;<span class="num" id="4021780">0</span>&nbsp;<span class="op" id="4021782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021786">return</span>&nbsp;<span class="ident" id="4021793">z</span><span class="op" id="4021794">.</span><span class="ident" id="4021795">Set</span><span class="op" id="4021798">(</span><span class="ident" id="4021799">x</span><span class="op" id="4021800">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4021803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4021806">z</span><span class="op" id="4021807">.</span><span class="ident" id="4021808">abs</span>&nbsp;<span class="op" id="4021812">=</span>&nbsp;<span class="ident" id="4021814">z</span><span class="op" id="4021815">.</span><span class="ident" id="4021816">abs</span><span class="op" id="4021819">.</span><span class="ident" id="4021820">mul</span><span class="op" id="4021823">(</span><span class="ident" id="4021824">x</span><span class="op" id="4021825">.</span><span class="ident" id="4021826">abs</span><span class="op" id="4021829">,</span>&nbsp;<span class="ident" id="4021831">f</span><span class="op" id="4021832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4021835">z</span><span class="op" id="4021836">.</span><span class="ident" id="4021837">neg</span>&nbsp;<span class="op" id="4021841">=</span>&nbsp;<span class="ident" id="4021843">x</span><span class="op" id="4021844">.</span><span class="ident" id="4021845">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021850">return</span>&nbsp;<span class="op" id="4021857">&amp;</span><span class="ident" id="4021858">z</span><br>
<span class="lineno"></span><span class="op" id="4021860">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span><span class="comment" id="4021863">//&nbsp;Cmp&nbsp;compares&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;returns:</span><br>
<span class="lineno"></span><span class="comment" id="4021900">//</span><br>
<span class="lineno"></span><span class="comment" id="4021903">//&nbsp;&nbsp;&nbsp;-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="4021921">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;y</span><br>
<span class="lineno">470</span><span class="comment" id="4021939">//&nbsp;&nbsp;&nbsp;+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="4021957">//</span><br>
<span class="lineno"></span><span class="keyword" id="4021960">func</span>&nbsp;<span class="op" id="4021965">(</span><span class="ident" id="4021966">x</span>&nbsp;<span class="op" id="4021968">*</span><span class="ident" id="4021969">Rat</span><span class="op" id="4021972">)</span>&nbsp;<span class="ident" id="4021974">Cmp</span><span class="op" id="4021977">(</span><span class="ident" id="4021978">y</span>&nbsp;<span class="op" id="4021980">*</span><span class="ident" id="4021981">Rat</span><span class="op" id="4021984">)</span>&nbsp;<span class="builtintype" id="4021986">int</span>&nbsp;<span class="op" id="4021990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021993">return</span>&nbsp;<span class="ident" id="4022000">scaleDenom</span><span class="op" id="4022010">(</span><span class="op" id="4022011">&amp;</span><span class="ident" id="4022012">x</span><span class="op" id="4022013">.</span><span class="ident" id="4022014">a</span><span class="op" id="4022015">,</span>&nbsp;<span class="ident" id="4022017">y</span><span class="op" id="4022018">.</span><span class="ident" id="4022019">b</span><span class="op" id="4022020">.</span><span class="ident" id="4022021">abs</span><span class="op" id="4022024">)</span><span class="op" id="4022025">.</span><span class="ident" id="4022026">Cmp</span><span class="op" id="4022029">(</span><span class="ident" id="4022030">scaleDenom</span><span class="op" id="4022040">(</span><span class="op" id="4022041">&amp;</span><span class="ident" id="4022042">y</span><span class="op" id="4022043">.</span><span class="ident" id="4022044">a</span><span class="op" id="4022045">,</span>&nbsp;<span class="ident" id="4022047">x</span><span class="op" id="4022048">.</span><span class="ident" id="4022049">b</span><span class="op" id="4022050">.</span><span class="ident" id="4022051">abs</span><span class="op" id="4022054">)</span><span class="op" id="4022055">)</span><br>
<span class="lineno"></span><span class="op" id="4022057">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="4022060">//&nbsp;Add&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;sum&nbsp;x+y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4022104">func</span>&nbsp;<span class="op" id="4022109">(</span><span class="ident" id="4022110">z</span>&nbsp;<span class="op" id="4022112">*</span><span class="ident" id="4022113">Rat</span><span class="op" id="4022116">)</span>&nbsp;<span class="ident" id="4022118">Add</span><span class="op" id="4022121">(</span><span class="ident" id="4022122">x</span><span class="op" id="4022123">,</span>&nbsp;<span class="ident" id="4022125">y</span>&nbsp;<span class="op" id="4022127">*</span><span class="ident" id="4022128">Rat</span><span class="op" id="4022131">)</span>&nbsp;<span class="op" id="4022133">*</span><span class="ident" id="4022134">Rat</span>&nbsp;<span class="op" id="4022138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022141">a1</span>&nbsp;<span class="op" id="4022144">:=</span>&nbsp;<span class="ident" id="4022147">scaleDenom</span><span class="op" id="4022157">(</span><span class="op" id="4022158">&amp;</span><span class="ident" id="4022159">x</span><span class="op" id="4022160">.</span><span class="ident" id="4022161">a</span><span class="op" id="4022162">,</span>&nbsp;<span class="ident" id="4022164">y</span><span class="op" id="4022165">.</span><span class="ident" id="4022166">b</span><span class="op" id="4022167">.</span><span class="ident" id="4022168">abs</span><span class="op" id="4022171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022174">a2</span>&nbsp;<span class="op" id="4022177">:=</span>&nbsp;<span class="ident" id="4022180">scaleDenom</span><span class="op" id="4022190">(</span><span class="op" id="4022191">&amp;</span><span class="ident" id="4022192">y</span><span class="op" id="4022193">.</span><span class="ident" id="4022194">a</span><span class="op" id="4022195">,</span>&nbsp;<span class="ident" id="4022197">x</span><span class="op" id="4022198">.</span><span class="ident" id="4022199">b</span><span class="op" id="4022200">.</span><span class="ident" id="4022201">abs</span><span class="op" id="4022204">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022207">z</span><span class="op" id="4022208">.</span><span class="ident" id="4022209">a</span><span class="op" id="4022210">.</span><span class="ident" id="4022211">Add</span><span class="op" id="4022214">(</span><span class="ident" id="4022215">a1</span><span class="op" id="4022217">,</span>&nbsp;<span class="ident" id="4022219">a2</span><span class="op" id="4022221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022224">z</span><span class="op" id="4022225">.</span><span class="ident" id="4022226">b</span><span class="op" id="4022227">.</span><span class="ident" id="4022228">abs</span>&nbsp;<span class="op" id="4022232">=</span>&nbsp;<span class="ident" id="4022234">mulDenom</span><span class="op" id="4022242">(</span><span class="ident" id="4022243">z</span><span class="op" id="4022244">.</span><span class="ident" id="4022245">b</span><span class="op" id="4022246">.</span><span class="ident" id="4022247">abs</span><span class="op" id="4022250">,</span>&nbsp;<span class="ident" id="4022252">x</span><span class="op" id="4022253">.</span><span class="ident" id="4022254">b</span><span class="op" id="4022255">.</span><span class="ident" id="4022256">abs</span><span class="op" id="4022259">,</span>&nbsp;<span class="ident" id="4022261">y</span><span class="op" id="4022262">.</span><span class="ident" id="4022263">b</span><span class="op" id="4022264">.</span><span class="ident" id="4022265">abs</span><span class="op" id="4022268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4022271">return</span>&nbsp;<span class="ident" id="4022278">z</span><span class="op" id="4022279">.</span><span class="ident" id="4022280">norm</span><span class="op" id="4022284">(</span><span class="op" id="4022285">)</span><br>
<span class="lineno"></span><span class="op" id="4022287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span><span class="comment" id="4022290">//&nbsp;Sub&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;difference&nbsp;x-y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4022341">func</span>&nbsp;<span class="op" id="4022346">(</span><span class="ident" id="4022347">z</span>&nbsp;<span class="op" id="4022349">*</span><span class="ident" id="4022350">Rat</span><span class="op" id="4022353">)</span>&nbsp;<span class="ident" id="4022355">Sub</span><span class="op" id="4022358">(</span><span class="ident" id="4022359">x</span><span class="op" id="4022360">,</span>&nbsp;<span class="ident" id="4022362">y</span>&nbsp;<span class="op" id="4022364">*</span><span class="ident" id="4022365">Rat</span><span class="op" id="4022368">)</span>&nbsp;<span class="op" id="4022370">*</span><span class="ident" id="4022371">Rat</span>&nbsp;<span class="op" id="4022375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022378">a1</span>&nbsp;<span class="op" id="4022381">:=</span>&nbsp;<span class="ident" id="4022384">scaleDenom</span><span class="op" id="4022394">(</span><span class="op" id="4022395">&amp;</span><span class="ident" id="4022396">x</span><span class="op" id="4022397">.</span><span class="ident" id="4022398">a</span><span class="op" id="4022399">,</span>&nbsp;<span class="ident" id="4022401">y</span><span class="op" id="4022402">.</span><span class="ident" id="4022403">b</span><span class="op" id="4022404">.</span><span class="ident" id="4022405">abs</span><span class="op" id="4022408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022411">a2</span>&nbsp;<span class="op" id="4022414">:=</span>&nbsp;<span class="ident" id="4022417">scaleDenom</span><span class="op" id="4022427">(</span><span class="op" id="4022428">&amp;</span><span class="ident" id="4022429">y</span><span class="op" id="4022430">.</span><span class="ident" id="4022431">a</span><span class="op" id="4022432">,</span>&nbsp;<span class="ident" id="4022434">x</span><span class="op" id="4022435">.</span><span class="ident" id="4022436">b</span><span class="op" id="4022437">.</span><span class="ident" id="4022438">abs</span><span class="op" id="4022441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022444">z</span><span class="op" id="4022445">.</span><span class="ident" id="4022446">a</span><span class="op" id="4022447">.</span><span class="ident" id="4022448">Sub</span><span class="op" id="4022451">(</span><span class="ident" id="4022452">a1</span><span class="op" id="4022454">,</span>&nbsp;<span class="ident" id="4022456">a2</span><span class="op" id="4022458">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022461">z</span><span class="op" id="4022462">.</span><span class="ident" id="4022463">b</span><span class="op" id="4022464">.</span><span class="ident" id="4022465">abs</span>&nbsp;<span class="op" id="4022469">=</span>&nbsp;<span class="ident" id="4022471">mulDenom</span><span class="op" id="4022479">(</span><span class="ident" id="4022480">z</span><span class="op" id="4022481">.</span><span class="ident" id="4022482">b</span><span class="op" id="4022483">.</span><span class="ident" id="4022484">abs</span><span class="op" id="4022487">,</span>&nbsp;<span class="ident" id="4022489">x</span><span class="op" id="4022490">.</span><span class="ident" id="4022491">b</span><span class="op" id="4022492">.</span><span class="ident" id="4022493">abs</span><span class="op" id="4022496">,</span>&nbsp;<span class="ident" id="4022498">y</span><span class="op" id="4022499">.</span><span class="ident" id="4022500">b</span><span class="op" id="4022501">.</span><span class="ident" id="4022502">abs</span><span class="op" id="4022505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4022508">return</span>&nbsp;<span class="ident" id="4022515">z</span><span class="op" id="4022516">.</span><span class="ident" id="4022517">norm</span><span class="op" id="4022521">(</span><span class="op" id="4022522">)</span><br>
<span class="lineno"></span><span class="op" id="4022524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4022527">//&nbsp;Mul&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;product&nbsp;x*y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">495</span><span class="keyword" id="4022575">func</span>&nbsp;<span class="op" id="4022580">(</span><span class="ident" id="4022581">z</span>&nbsp;<span class="op" id="4022583">*</span><span class="ident" id="4022584">Rat</span><span class="op" id="4022587">)</span>&nbsp;<span class="ident" id="4022589">Mul</span><span class="op" id="4022592">(</span><span class="ident" id="4022593">x</span><span class="op" id="4022594">,</span>&nbsp;<span class="ident" id="4022596">y</span>&nbsp;<span class="op" id="4022598">*</span><span class="ident" id="4022599">Rat</span><span class="op" id="4022602">)</span>&nbsp;<span class="op" id="4022604">*</span><span class="ident" id="4022605">Rat</span>&nbsp;<span class="op" id="4022609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022612">z</span><span class="op" id="4022613">.</span><span class="ident" id="4022614">a</span><span class="op" id="4022615">.</span><span class="ident" id="4022616">Mul</span><span class="op" id="4022619">(</span><span class="op" id="4022620">&amp;</span><span class="ident" id="4022621">x</span><span class="op" id="4022622">.</span><span class="ident" id="4022623">a</span><span class="op" id="4022624">,</span>&nbsp;<span class="op" id="4022626">&amp;</span><span class="ident" id="4022627">y</span><span class="op" id="4022628">.</span><span class="ident" id="4022629">a</span><span class="op" id="4022630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022633">z</span><span class="op" id="4022634">.</span><span class="ident" id="4022635">b</span><span class="op" id="4022636">.</span><span class="ident" id="4022637">abs</span>&nbsp;<span class="op" id="4022641">=</span>&nbsp;<span class="ident" id="4022643">mulDenom</span><span class="op" id="4022651">(</span><span class="ident" id="4022652">z</span><span class="op" id="4022653">.</span><span class="ident" id="4022654">b</span><span class="op" id="4022655">.</span><span class="ident" id="4022656">abs</span><span class="op" id="4022659">,</span>&nbsp;<span class="ident" id="4022661">x</span><span class="op" id="4022662">.</span><span class="ident" id="4022663">b</span><span class="op" id="4022664">.</span><span class="ident" id="4022665">abs</span><span class="op" id="4022668">,</span>&nbsp;<span class="ident" id="4022670">y</span><span class="op" id="4022671">.</span><span class="ident" id="4022672">b</span><span class="op" id="4022673">.</span><span class="ident" id="4022674">abs</span><span class="op" id="4022677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4022680">return</span>&nbsp;<span class="ident" id="4022687">z</span><span class="op" id="4022688">.</span><span class="ident" id="4022689">norm</span><span class="op" id="4022693">(</span><span class="op" id="4022694">)</span><br>
<span class="lineno"></span><span class="op" id="4022696">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="4022699">//&nbsp;Quo&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;quotient&nbsp;x/y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="4022748">//&nbsp;If&nbsp;y&nbsp;==&nbsp;0,&nbsp;a&nbsp;division-by-zero&nbsp;run-time&nbsp;panic&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="keyword" id="4022804">func</span>&nbsp;<span class="op" id="4022809">(</span><span class="ident" id="4022810">z</span>&nbsp;<span class="op" id="4022812">*</span><span class="ident" id="4022813">Rat</span><span class="op" id="4022816">)</span>&nbsp;<span class="ident" id="4022818">Quo</span><span class="op" id="4022821">(</span><span class="ident" id="4022822">x</span><span class="op" id="4022823">,</span>&nbsp;<span class="ident" id="4022825">y</span>&nbsp;<span class="op" id="4022827">*</span><span class="ident" id="4022828">Rat</span><span class="op" id="4022831">)</span>&nbsp;<span class="op" id="4022833">*</span><span class="ident" id="4022834">Rat</span>&nbsp;<span class="op" id="4022838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4022841">if</span>&nbsp;<span class="builtinfunc" id="4022844">len</span><span class="op" id="4022847">(</span><span class="ident" id="4022848">y</span><span class="op" id="4022849">.</span><span class="ident" id="4022850">a</span><span class="op" id="4022851">.</span><span class="ident" id="4022852">abs</span><span class="op" id="4022855">)</span>&nbsp;<span class="op" id="4022857">==</span>&nbsp;<span class="num" id="4022860">0</span>&nbsp;<span class="op" id="4022862">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4022866">panic</span><span class="op" id="4022871">(</span><span class="string" id="4022872">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4022890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4022893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022896">a</span>&nbsp;<span class="op" id="4022898">:=</span>&nbsp;<span class="ident" id="4022901">scaleDenom</span><span class="op" id="4022911">(</span><span class="op" id="4022912">&amp;</span><span class="ident" id="4022913">x</span><span class="op" id="4022914">.</span><span class="ident" id="4022915">a</span><span class="op" id="4022916">,</span>&nbsp;<span class="ident" id="4022918">y</span><span class="op" id="4022919">.</span><span class="ident" id="4022920">b</span><span class="op" id="4022921">.</span><span class="ident" id="4022922">abs</span><span class="op" id="4022925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022928">b</span>&nbsp;<span class="op" id="4022930">:=</span>&nbsp;<span class="ident" id="4022933">scaleDenom</span><span class="op" id="4022943">(</span><span class="op" id="4022944">&amp;</span><span class="ident" id="4022945">y</span><span class="op" id="4022946">.</span><span class="ident" id="4022947">a</span><span class="op" id="4022948">,</span>&nbsp;<span class="ident" id="4022950">x</span><span class="op" id="4022951">.</span><span class="ident" id="4022952">b</span><span class="op" id="4022953">.</span><span class="ident" id="4022954">abs</span><span class="op" id="4022957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022960">z</span><span class="op" id="4022961">.</span><span class="ident" id="4022962">a</span><span class="op" id="4022963">.</span><span class="ident" id="4022964">abs</span>&nbsp;<span class="op" id="4022968">=</span>&nbsp;<span class="ident" id="4022970">a</span><span class="op" id="4022971">.</span><span class="ident" id="4022972">abs</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022977">z</span><span class="op" id="4022978">.</span><span class="ident" id="4022979">b</span><span class="op" id="4022980">.</span><span class="ident" id="4022981">abs</span>&nbsp;<span class="op" id="4022985">=</span>&nbsp;<span class="ident" id="4022987">b</span><span class="op" id="4022988">.</span><span class="ident" id="4022989">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022994">z</span><span class="op" id="4022995">.</span><span class="ident" id="4022996">a</span><span class="op" id="4022997">.</span><span class="ident" id="4022998">neg</span>&nbsp;<span class="op" id="4023002">=</span>&nbsp;<span class="ident" id="4023004">a</span><span class="op" id="4023005">.</span><span class="ident" id="4023006">neg</span>&nbsp;<span class="op" id="4023010">!=</span>&nbsp;<span class="ident" id="4023013">b</span><span class="op" id="4023014">.</span><span class="ident" id="4023015">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4023020">return</span>&nbsp;<span class="ident" id="4023027">z</span><span class="op" id="4023028">.</span><span class="ident" id="4023029">norm</span><span class="op" id="4023033">(</span><span class="op" id="4023034">)</span><br>
<span class="lineno"></span><span class="op" id="4023036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="4023039">func</span>&nbsp;<span class="ident" id="4023044">ratTok</span><span class="op" id="4023050">(</span><span class="ident" id="4023051">ch</span>&nbsp;<span class="builtintype" id="4023054">rune</span><span class="op" id="4023058">)</span>&nbsp;<span class="builtintype" id="4023060">bool</span>&nbsp;<span class="op" id="4023065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4023068">return</span>&nbsp;<span class="ident" id="4023075">strings</span><span class="op" id="4023082">.</span><span class="ident" id="4023083">IndexRune</span><span class="op" id="4023092">(</span><span class="string" id="4023093">&#34;+-/0123456789.eE&#34;</span><span class="op" id="4023111">,</span>&nbsp;<span class="ident" id="4023113">ch</span><span class="op" id="4023115">)</span>&nbsp;<span class="op" id="4023117">&gt;=</span>&nbsp;<span class="num" id="4023120">0</span><br>
<span class="lineno"></span><span class="op" id="4023122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4023125">//&nbsp;Scan&nbsp;is&nbsp;a&nbsp;support&nbsp;routine&nbsp;for&nbsp;fmt.Scanner.&nbsp;It&nbsp;accepts&nbsp;the&nbsp;formats</span><br>
<span class="lineno">520</span><span class="comment" id="4023194">//&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;F&#39;,&nbsp;&#39;g&#39;,&nbsp;&#39;G&#39;,&nbsp;and&nbsp;&#39;v&#39;.&nbsp;All&nbsp;formats&nbsp;are&nbsp;equivalent.</span><br>
<span class="lineno"></span><span class="keyword" id="4023264">func</span>&nbsp;<span class="op" id="4023269">(</span><span class="ident" id="4023270">z</span>&nbsp;<span class="op" id="4023272">*</span><span class="ident" id="4023273">Rat</span><span class="op" id="4023276">)</span>&nbsp;<span class="ident" id="4023278">Scan</span><span class="op" id="4023282">(</span><span class="ident" id="4023283">s</span>&nbsp;<span class="ident" id="4023285">fmt</span><span class="op" id="4023288">.</span><span class="ident" id="4023289">ScanState</span><span class="op" id="4023298">,</span>&nbsp;<span class="ident" id="4023300">ch</span>&nbsp;<span class="builtintype" id="4023303">rune</span><span class="op" id="4023307">)</span>&nbsp;<span class="builtintype" id="4023309">error</span>&nbsp;<span class="op" id="4023315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4023318">tok</span><span class="op" id="4023321">,</span>&nbsp;<span class="ident" id="4023323">err</span>&nbsp;<span class="op" id="4023327">:=</span>&nbsp;<span class="ident" id="4023330">s</span><span class="op" id="4023331">.</span><span class="ident" id="4023332">Token</span><span class="op" id="4023337">(</span><span class="builtintype" id="4023338">true</span><span class="op" id="4023342">,</span>&nbsp;<span class="ident" id="4023344">ratTok</span><span class="op" id="4023350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4023353">if</span>&nbsp;<span class="ident" id="4023356">err</span>&nbsp;<span class="op" id="4023360">!=</span>&nbsp;<span class="ident" id="4023363">nil</span>&nbsp;<span class="op" id="4023367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4023371">return</span>&nbsp;<span class="ident" id="4023378">err</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4023383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4023386">if</span>&nbsp;<span class="ident" id="4023389">strings</span><span class="op" id="4023396">.</span><span class="ident" id="4023397">IndexRune</span><span class="op" id="4023406">(</span><span class="string" id="4023407">&#34;efgEFGv&#34;</span><span class="op" id="4023416">,</span>&nbsp;<span class="ident" id="4023418">ch</span><span class="op" id="4023420">)</span>&nbsp;<span class="op" id="4023422">&lt;</span>&nbsp;<span class="num" id="4023424">0</span>&nbsp;<span class="op" id="4023426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4023430">return</span>&nbsp;<span class="ident" id="4023437">errors</span><span class="op" id="4023443">.</span><span class="ident" id="4023444">New</span><span class="op" id="4023447">(</span><span class="string" id="4023448">&#34;Rat.Scan:&nbsp;invalid&nbsp;verb&#34;</span><span class="op" id="4023472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4023475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4023478">if</span>&nbsp;<span class="ident" id="4023481">_</span><span class="op" id="4023482">,</span>&nbsp;<span class="ident" id="4023484">ok</span>&nbsp;<span class="op" id="4023487">:=</span>&nbsp;<span class="ident" id="4023490">z</span><span class="op" id="4023491">.</span><span class="ident" id="4023492">SetString</span><span class="op" id="4023501">(</span><span class="builtintype" id="4023502">string</span><span class="op" id="4023508">(</span><span class="ident" id="4023509">tok</span><span class="op" id="4023512">)</span><span class="op" id="4023513">)</span><span class="op" id="4023514">;</span>&nbsp;<span class="op" id="4023516">!</span><span class="ident" id="4023517">ok</span>&nbsp;<span class="op" id="4023520">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4023524">return</span>&nbsp;<span class="ident" id="4023531">errors</span><span class="op" id="4023537">.</span><span class="ident" id="4023538">New</span><span class="op" id="4023541">(</span><span class="string" id="4023542">&#34;Rat.Scan:&nbsp;invalid&nbsp;syntax&#34;</span><span class="op" id="4023568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4023571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4023574">return</span>&nbsp;<span class="ident" id="4023581">nil</span><br>
<span class="lineno"></span><span class="op" id="4023585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="4023588">//&nbsp;SetString&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;value&nbsp;of&nbsp;s&nbsp;and&nbsp;returns&nbsp;z&nbsp;and&nbsp;a&nbsp;boolean&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="4023665">//&nbsp;success.&nbsp;s&nbsp;can&nbsp;be&nbsp;given&nbsp;as&nbsp;a&nbsp;fraction&nbsp;&#34;a/b&#34;&nbsp;or&nbsp;as&nbsp;a&nbsp;floating-point&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="4023742">//&nbsp;optionally&nbsp;followed&nbsp;by&nbsp;an&nbsp;exponent.&nbsp;If&nbsp;the&nbsp;operation&nbsp;failed,&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4023819">//&nbsp;z&nbsp;is&nbsp;undefined&nbsp;but&nbsp;the&nbsp;returned&nbsp;value&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4023868">func</span>&nbsp;<span class="op" id="4023873">(</span><span class="ident" id="4023874">z</span>&nbsp;<span class="op" id="4023876">*</span><span class="ident" id="4023877">Rat</span><span class="op" id="4023880">)</span>&nbsp;<span class="ident" id="4023882">SetString</span><span class="op" id="4023891">(</span><span class="ident" id="4023892">s</span>&nbsp;<span class="builtintype" id="4023894">string</span><span class="op" id="4023900">)</span>&nbsp;<span class="op" id="4023902">(</span><span class="op" id="4023903">*</span><span class="ident" id="4023904">Rat</span><span class="op" id="4023907">,</span>&nbsp;<span class="builtintype" id="4023909">bool</span><span class="op" id="4023913">)</span>&nbsp;<span class="op" id="4023915">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4023918">if</span>&nbsp;<span class="builtinfunc" id="4023921">len</span><span class="op" id="4023924">(</span><span class="ident" id="4023925">s</span><span class="op" id="4023926">)</span>&nbsp;<span class="op" id="4023928">==</span>&nbsp;<span class="num" id="4023931">0</span>&nbsp;<span class="op" id="4023933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4023937">return</span>&nbsp;<span class="ident" id="4023944">nil</span><span class="op" id="4023947">,</span>&nbsp;<span class="builtintype" id="4023949">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4023956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4023960">//&nbsp;check&nbsp;for&nbsp;a&nbsp;quotient</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4023985">sep</span>&nbsp;<span class="op" id="4023989">:=</span>&nbsp;<span class="ident" id="4023992">strings</span><span class="op" id="4023999">.</span><span class="ident" id="4024000">Index</span><span class="op" id="4024005">(</span><span class="ident" id="4024006">s</span><span class="op" id="4024007">,</span>&nbsp;<span class="string" id="4024009">&#34;/&#34;</span><span class="op" id="4024012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024015">if</span>&nbsp;<span class="ident" id="4024018">sep</span>&nbsp;<span class="op" id="4024022">&gt;=</span>&nbsp;<span class="num" id="4024025">0</span>&nbsp;<span class="op" id="4024027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024031">if</span>&nbsp;<span class="ident" id="4024034">_</span><span class="op" id="4024035">,</span>&nbsp;<span class="ident" id="4024037">ok</span>&nbsp;<span class="op" id="4024040">:=</span>&nbsp;<span class="ident" id="4024043">z</span><span class="op" id="4024044">.</span><span class="ident" id="4024045">a</span><span class="op" id="4024046">.</span><span class="ident" id="4024047">SetString</span><span class="op" id="4024056">(</span><span class="ident" id="4024057">s</span><span class="op" id="4024058">[</span><span class="num" id="4024059">0</span><span class="op" id="4024060">:</span><span class="ident" id="4024061">sep</span><span class="op" id="4024064">]</span><span class="op" id="4024065">,</span>&nbsp;<span class="num" id="4024067">10</span><span class="op" id="4024069">)</span><span class="op" id="4024070">;</span>&nbsp;<span class="op" id="4024072">!</span><span class="ident" id="4024073">ok</span>&nbsp;<span class="op" id="4024076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024081">return</span>&nbsp;<span class="ident" id="4024088">nil</span><span class="op" id="4024091">,</span>&nbsp;<span class="builtintype" id="4024093">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4024101">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024105">s</span>&nbsp;<span class="op" id="4024107">=</span>&nbsp;<span class="ident" id="4024109">s</span><span class="op" id="4024110">[</span><span class="ident" id="4024111">sep</span><span class="op" id="4024114">+</span><span class="num" id="4024115">1</span><span class="op" id="4024116">:</span><span class="op" id="4024117">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024121">var</span>&nbsp;<span class="ident" id="4024125">err</span>&nbsp;<span class="builtintype" id="4024129">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024137">if</span>&nbsp;<span class="ident" id="4024140">z</span><span class="op" id="4024141">.</span><span class="ident" id="4024142">b</span><span class="op" id="4024143">.</span><span class="ident" id="4024144">abs</span><span class="op" id="4024147">,</span>&nbsp;<span class="ident" id="4024149">_</span><span class="op" id="4024150">,</span>&nbsp;<span class="ident" id="4024152">err</span>&nbsp;<span class="op" id="4024156">=</span>&nbsp;<span class="ident" id="4024158">z</span><span class="op" id="4024159">.</span><span class="ident" id="4024160">b</span><span class="op" id="4024161">.</span><span class="ident" id="4024162">abs</span><span class="op" id="4024165">.</span><span class="ident" id="4024166">scan</span><span class="op" id="4024170">(</span><span class="ident" id="4024171">strings</span><span class="op" id="4024178">.</span><span class="ident" id="4024179">NewReader</span><span class="op" id="4024188">(</span><span class="ident" id="4024189">s</span><span class="op" id="4024190">)</span><span class="op" id="4024191">,</span>&nbsp;<span class="num" id="4024193">10</span><span class="op" id="4024195">)</span><span class="op" id="4024196">;</span>&nbsp;<span class="ident" id="4024198">err</span>&nbsp;<span class="op" id="4024202">!=</span>&nbsp;<span class="ident" id="4024205">nil</span>&nbsp;<span class="op" id="4024209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024214">return</span>&nbsp;<span class="ident" id="4024221">nil</span><span class="op" id="4024224">,</span>&nbsp;<span class="builtintype" id="4024226">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4024234">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024238">if</span>&nbsp;<span class="builtinfunc" id="4024241">len</span><span class="op" id="4024244">(</span><span class="ident" id="4024245">z</span><span class="op" id="4024246">.</span><span class="ident" id="4024247">b</span><span class="op" id="4024248">.</span><span class="ident" id="4024249">abs</span><span class="op" id="4024252">)</span>&nbsp;<span class="op" id="4024254">==</span>&nbsp;<span class="num" id="4024257">0</span>&nbsp;<span class="op" id="4024259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024264">return</span>&nbsp;<span class="ident" id="4024271">nil</span><span class="op" id="4024274">,</span>&nbsp;<span class="builtintype" id="4024276">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4024284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024288">return</span>&nbsp;<span class="ident" id="4024295">z</span><span class="op" id="4024296">.</span><span class="ident" id="4024297">norm</span><span class="op" id="4024301">(</span><span class="op" id="4024302">)</span><span class="op" id="4024303">,</span>&nbsp;<span class="builtintype" id="4024305">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4024311">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4024315">//&nbsp;check&nbsp;for&nbsp;a&nbsp;decimal&nbsp;point</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024345">sep</span>&nbsp;<span class="op" id="4024349">=</span>&nbsp;<span class="ident" id="4024351">strings</span><span class="op" id="4024358">.</span><span class="ident" id="4024359">Index</span><span class="op" id="4024364">(</span><span class="ident" id="4024365">s</span><span class="op" id="4024366">,</span>&nbsp;<span class="string" id="4024368">&#34;.&#34;</span><span class="op" id="4024371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4024374">//&nbsp;check&nbsp;for&nbsp;an&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024400">e</span>&nbsp;<span class="op" id="4024402">:=</span>&nbsp;<span class="ident" id="4024405">strings</span><span class="op" id="4024412">.</span><span class="ident" id="4024413">IndexAny</span><span class="op" id="4024421">(</span><span class="ident" id="4024422">s</span><span class="op" id="4024423">,</span>&nbsp;<span class="string" id="4024425">&#34;eE&#34;</span><span class="op" id="4024429">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024432">var</span>&nbsp;<span class="ident" id="4024436">exp</span>&nbsp;<span class="ident" id="4024440">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024445">if</span>&nbsp;<span class="ident" id="4024448">e</span>&nbsp;<span class="op" id="4024450">&gt;=</span>&nbsp;<span class="num" id="4024453">0</span>&nbsp;<span class="op" id="4024455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024459">if</span>&nbsp;<span class="ident" id="4024462">e</span>&nbsp;<span class="op" id="4024464">&lt;</span>&nbsp;<span class="ident" id="4024466">sep</span>&nbsp;<span class="op" id="4024470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4024475">//&nbsp;The&nbsp;E&nbsp;must&nbsp;come&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024522">return</span>&nbsp;<span class="ident" id="4024529">nil</span><span class="op" id="4024532">,</span>&nbsp;<span class="builtintype" id="4024534">false</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4024542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024546">if</span>&nbsp;<span class="ident" id="4024549">_</span><span class="op" id="4024550">,</span>&nbsp;<span class="ident" id="4024552">ok</span>&nbsp;<span class="op" id="4024555">:=</span>&nbsp;<span class="ident" id="4024558">exp</span><span class="op" id="4024561">.</span><span class="ident" id="4024562">SetString</span><span class="op" id="4024571">(</span><span class="ident" id="4024572">s</span><span class="op" id="4024573">[</span><span class="ident" id="4024574">e</span><span class="op" id="4024575">+</span><span class="num" id="4024576">1</span><span class="op" id="4024577">:</span><span class="op" id="4024578">]</span><span class="op" id="4024579">,</span>&nbsp;<span class="num" id="4024581">10</span><span class="op" id="4024583">)</span><span class="op" id="4024584">;</span>&nbsp;<span class="op" id="4024586">!</span><span class="ident" id="4024587">ok</span>&nbsp;<span class="op" id="4024590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024595">return</span>&nbsp;<span class="ident" id="4024602">nil</span><span class="op" id="4024605">,</span>&nbsp;<span class="builtintype" id="4024607">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4024615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024619">s</span>&nbsp;<span class="op" id="4024621">=</span>&nbsp;<span class="ident" id="4024623">s</span><span class="op" id="4024624">[</span><span class="num" id="4024625">0</span><span class="op" id="4024626">:</span><span class="ident" id="4024627">e</span><span class="op" id="4024628">]</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4024631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024634">if</span>&nbsp;<span class="ident" id="4024637">sep</span>&nbsp;<span class="op" id="4024641">&gt;=</span>&nbsp;<span class="num" id="4024644">0</span>&nbsp;<span class="op" id="4024646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024650">s</span>&nbsp;<span class="op" id="4024652">=</span>&nbsp;<span class="ident" id="4024654">s</span><span class="op" id="4024655">[</span><span class="num" id="4024656">0</span><span class="op" id="4024657">:</span><span class="ident" id="4024658">sep</span><span class="op" id="4024661">]</span>&nbsp;<span class="op" id="4024663">+</span>&nbsp;<span class="ident" id="4024665">s</span><span class="op" id="4024666">[</span><span class="ident" id="4024667">sep</span><span class="op" id="4024670">+</span><span class="num" id="4024671">1</span><span class="op" id="4024672">:</span><span class="op" id="4024673">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024677">exp</span><span class="op" id="4024680">.</span><span class="ident" id="4024681">Sub</span><span class="op" id="4024684">(</span><span class="op" id="4024685">&amp;</span><span class="ident" id="4024686">exp</span><span class="op" id="4024689">,</span>&nbsp;<span class="ident" id="4024691">NewInt</span><span class="op" id="4024697">(</span><span class="ident" id="4024698">int64</span><span class="op" id="4024703">(</span><span class="builtinfunc" id="4024704">len</span><span class="op" id="4024707">(</span><span class="ident" id="4024708">s</span><span class="op" id="4024709">)</span><span class="op" id="4024710">-</span><span class="ident" id="4024711">sep</span><span class="op" id="4024714">)</span><span class="op" id="4024715">)</span><span class="op" id="4024716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4024719">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024723">if</span>&nbsp;<span class="ident" id="4024726">_</span><span class="op" id="4024727">,</span>&nbsp;<span class="ident" id="4024729">ok</span>&nbsp;<span class="op" id="4024732">:=</span>&nbsp;<span class="ident" id="4024735">z</span><span class="op" id="4024736">.</span><span class="ident" id="4024737">a</span><span class="op" id="4024738">.</span><span class="ident" id="4024739">SetString</span><span class="op" id="4024748">(</span><span class="ident" id="4024749">s</span><span class="op" id="4024750">,</span>&nbsp;<span class="num" id="4024752">10</span><span class="op" id="4024754">)</span><span class="op" id="4024755">;</span>&nbsp;<span class="op" id="4024757">!</span><span class="ident" id="4024758">ok</span>&nbsp;<span class="op" id="4024761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024765">return</span>&nbsp;<span class="ident" id="4024772">nil</span><span class="op" id="4024775">,</span>&nbsp;<span class="builtintype" id="4024777">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4024784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024787">powTen</span>&nbsp;<span class="op" id="4024794">:=</span>&nbsp;<span class="ident" id="4024797">nat</span><span class="op" id="4024800">(</span><span class="ident" id="4024801">nil</span><span class="op" id="4024804">)</span><span class="op" id="4024805">.</span><span class="ident" id="4024806">expNN</span><span class="op" id="4024811">(</span><span class="ident" id="4024812">natTen</span><span class="op" id="4024818">,</span>&nbsp;<span class="ident" id="4024820">exp</span><span class="op" id="4024823">.</span><span class="ident" id="4024824">abs</span><span class="op" id="4024827">,</span>&nbsp;<span class="ident" id="4024829">nil</span><span class="op" id="4024832">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024835">if</span>&nbsp;<span class="ident" id="4024838">exp</span><span class="op" id="4024841">.</span><span class="ident" id="4024842">neg</span>&nbsp;<span class="op" id="4024846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024850">z</span><span class="op" id="4024851">.</span><span class="ident" id="4024852">b</span><span class="op" id="4024853">.</span><span class="ident" id="4024854">abs</span>&nbsp;<span class="op" id="4024858">=</span>&nbsp;<span class="ident" id="4024860">powTen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024869">z</span><span class="op" id="4024870">.</span><span class="ident" id="4024871">norm</span><span class="op" id="4024875">(</span><span class="op" id="4024876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4024879">}</span>&nbsp;<span class="keyword" id="4024881">else</span>&nbsp;<span class="op" id="4024886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024890">z</span><span class="op" id="4024891">.</span><span class="ident" id="4024892">a</span><span class="op" id="4024893">.</span><span class="ident" id="4024894">abs</span>&nbsp;<span class="op" id="4024898">=</span>&nbsp;<span class="ident" id="4024900">z</span><span class="op" id="4024901">.</span><span class="ident" id="4024902">a</span><span class="op" id="4024903">.</span><span class="ident" id="4024904">abs</span><span class="op" id="4024907">.</span><span class="ident" id="4024908">mul</span><span class="op" id="4024911">(</span><span class="ident" id="4024912">z</span><span class="op" id="4024913">.</span><span class="ident" id="4024914">a</span><span class="op" id="4024915">.</span><span class="ident" id="4024916">abs</span><span class="op" id="4024919">,</span>&nbsp;<span class="ident" id="4024921">powTen</span><span class="op" id="4024927">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024931">z</span><span class="op" id="4024932">.</span><span class="ident" id="4024933">b</span><span class="op" id="4024934">.</span><span class="ident" id="4024935">abs</span>&nbsp;<span class="op" id="4024939">=</span>&nbsp;<span class="ident" id="4024941">z</span><span class="op" id="4024942">.</span><span class="ident" id="4024943">b</span><span class="op" id="4024944">.</span><span class="ident" id="4024945">abs</span><span class="op" id="4024948">.</span><span class="builtinfunc" id="4024949">make</span><span class="op" id="4024953">(</span><span class="num" id="4024954">0</span><span class="op" id="4024955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4024958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024962">return</span>&nbsp;<span class="ident" id="4024969">z</span><span class="op" id="4024970">,</span>&nbsp;<span class="builtintype" id="4024972">true</span><br>
<span class="lineno"></span><span class="op" id="4024977">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="comment" id="4024980">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;(even&nbsp;if&nbsp;b&nbsp;==&nbsp;1).</span><br>
<span class="lineno"></span><span class="keyword" id="4025063">func</span>&nbsp;<span class="op" id="4025068">(</span><span class="ident" id="4025069">x</span>&nbsp;<span class="op" id="4025071">*</span><span class="ident" id="4025072">Rat</span><span class="op" id="4025075">)</span>&nbsp;<span class="ident" id="4025077">String</span><span class="op" id="4025083">(</span><span class="op" id="4025084">)</span>&nbsp;<span class="builtintype" id="4025086">string</span>&nbsp;<span class="op" id="4025093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025096">s</span>&nbsp;<span class="op" id="4025098">:=</span>&nbsp;<span class="string" id="4025101">&#34;/1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4025107">if</span>&nbsp;<span class="builtinfunc" id="4025110">len</span><span class="op" id="4025113">(</span><span class="ident" id="4025114">x</span><span class="op" id="4025115">.</span><span class="ident" id="4025116">b</span><span class="op" id="4025117">.</span><span class="ident" id="4025118">abs</span><span class="op" id="4025121">)</span>&nbsp;<span class="op" id="4025123">!=</span>&nbsp;<span class="num" id="4025126">0</span>&nbsp;<span class="op" id="4025128">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025132">s</span>&nbsp;<span class="op" id="4025134">=</span>&nbsp;<span class="string" id="4025136">&#34;/&#34;</span>&nbsp;<span class="op" id="4025140">+</span>&nbsp;<span class="ident" id="4025142">x</span><span class="op" id="4025143">.</span><span class="ident" id="4025144">b</span><span class="op" id="4025145">.</span><span class="ident" id="4025146">abs</span><span class="op" id="4025149">.</span><span class="ident" id="4025150">decimalString</span><span class="op" id="4025163">(</span><span class="op" id="4025164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4025167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4025170">return</span>&nbsp;<span class="ident" id="4025177">x</span><span class="op" id="4025178">.</span><span class="ident" id="4025179">a</span><span class="op" id="4025180">.</span><span class="ident" id="4025181">String</span><span class="op" id="4025187">(</span><span class="op" id="4025188">)</span>&nbsp;<span class="op" id="4025190">+</span>&nbsp;<span class="ident" id="4025192">s</span><br>
<span class="lineno"></span><span class="op" id="4025194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span><span class="comment" id="4025197">//&nbsp;RatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;if&nbsp;b&nbsp;!=&nbsp;1,</span><br>
<span class="lineno"></span><span class="comment" id="4025276">//&nbsp;and&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a&#34;&nbsp;if&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="4025310">func</span>&nbsp;<span class="op" id="4025315">(</span><span class="ident" id="4025316">x</span>&nbsp;<span class="op" id="4025318">*</span><span class="ident" id="4025319">Rat</span><span class="op" id="4025322">)</span>&nbsp;<span class="ident" id="4025324">RatString</span><span class="op" id="4025333">(</span><span class="op" id="4025334">)</span>&nbsp;<span class="builtintype" id="4025336">string</span>&nbsp;<span class="op" id="4025343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4025346">if</span>&nbsp;<span class="ident" id="4025349">x</span><span class="op" id="4025350">.</span><span class="ident" id="4025351">IsInt</span><span class="op" id="4025356">(</span><span class="op" id="4025357">)</span>&nbsp;<span class="op" id="4025359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4025363">return</span>&nbsp;<span class="ident" id="4025370">x</span><span class="op" id="4025371">.</span><span class="ident" id="4025372">a</span><span class="op" id="4025373">.</span><span class="ident" id="4025374">String</span><span class="op" id="4025380">(</span><span class="op" id="4025381">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4025384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4025387">return</span>&nbsp;<span class="ident" id="4025394">x</span><span class="op" id="4025395">.</span><span class="ident" id="4025396">String</span><span class="op" id="4025402">(</span><span class="op" id="4025403">)</span><br>
<span class="lineno"></span><span class="op" id="4025405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4025408">//&nbsp;FloatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;decimal&nbsp;form&nbsp;with&nbsp;prec</span><br>
<span class="lineno">615</span><span class="comment" id="4025486">//&nbsp;digits&nbsp;of&nbsp;precision&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point&nbsp;and&nbsp;the&nbsp;last&nbsp;digit&nbsp;rounded.</span><br>
<span class="lineno"></span><span class="keyword" id="4025561">func</span>&nbsp;<span class="op" id="4025566">(</span><span class="ident" id="4025567">x</span>&nbsp;<span class="op" id="4025569">*</span><span class="ident" id="4025570">Rat</span><span class="op" id="4025573">)</span>&nbsp;<span class="ident" id="4025575">FloatString</span><span class="op" id="4025586">(</span><span class="ident" id="4025587">prec</span>&nbsp;<span class="builtintype" id="4025592">int</span><span class="op" id="4025595">)</span>&nbsp;<span class="builtintype" id="4025597">string</span>&nbsp;<span class="op" id="4025604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4025607">if</span>&nbsp;<span class="ident" id="4025610">x</span><span class="op" id="4025611">.</span><span class="ident" id="4025612">IsInt</span><span class="op" id="4025617">(</span><span class="op" id="4025618">)</span>&nbsp;<span class="op" id="4025620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025624">s</span>&nbsp;<span class="op" id="4025626">:=</span>&nbsp;<span class="ident" id="4025629">x</span><span class="op" id="4025630">.</span><span class="ident" id="4025631">a</span><span class="op" id="4025632">.</span><span class="ident" id="4025633">String</span><span class="op" id="4025639">(</span><span class="op" id="4025640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4025644">if</span>&nbsp;<span class="ident" id="4025647">prec</span>&nbsp;<span class="op" id="4025652">&gt;</span>&nbsp;<span class="num" id="4025654">0</span>&nbsp;<span class="op" id="4025656">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025661">s</span>&nbsp;<span class="op" id="4025663">+=</span>&nbsp;<span class="string" id="4025666">&#34;.&#34;</span>&nbsp;<span class="op" id="4025670">+</span>&nbsp;<span class="ident" id="4025672">strings</span><span class="op" id="4025679">.</span><span class="ident" id="4025680">Repeat</span><span class="op" id="4025686">(</span><span class="string" id="4025687">&#34;0&#34;</span><span class="op" id="4025690">,</span>&nbsp;<span class="ident" id="4025692">prec</span><span class="op" id="4025696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4025700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4025704">return</span>&nbsp;<span class="ident" id="4025711">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4025714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4025717">//&nbsp;x.b.abs&nbsp;!=&nbsp;0</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025735">q</span><span class="op" id="4025736">,</span>&nbsp;<span class="ident" id="4025738">r</span>&nbsp;<span class="op" id="4025740">:=</span>&nbsp;<span class="ident" id="4025743">nat</span><span class="op" id="4025746">(</span><span class="ident" id="4025747">nil</span><span class="op" id="4025750">)</span><span class="op" id="4025751">.</span><span class="ident" id="4025752">div</span><span class="op" id="4025755">(</span><span class="ident" id="4025756">nat</span><span class="op" id="4025759">(</span><span class="ident" id="4025760">nil</span><span class="op" id="4025763">)</span><span class="op" id="4025764">,</span>&nbsp;<span class="ident" id="4025766">x</span><span class="op" id="4025767">.</span><span class="ident" id="4025768">a</span><span class="op" id="4025769">.</span><span class="ident" id="4025770">abs</span><span class="op" id="4025773">,</span>&nbsp;<span class="ident" id="4025775">x</span><span class="op" id="4025776">.</span><span class="ident" id="4025777">b</span><span class="op" id="4025778">.</span><span class="ident" id="4025779">abs</span><span class="op" id="4025782">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025786">p</span>&nbsp;<span class="op" id="4025788">:=</span>&nbsp;<span class="ident" id="4025791">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4025799">if</span>&nbsp;<span class="ident" id="4025802">prec</span>&nbsp;<span class="op" id="4025807">&gt;</span>&nbsp;<span class="num" id="4025809">0</span>&nbsp;<span class="op" id="4025811">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025815">p</span>&nbsp;<span class="op" id="4025817">=</span>&nbsp;<span class="ident" id="4025819">nat</span><span class="op" id="4025822">(</span><span class="ident" id="4025823">nil</span><span class="op" id="4025826">)</span><span class="op" id="4025827">.</span><span class="ident" id="4025828">expNN</span><span class="op" id="4025833">(</span><span class="ident" id="4025834">natTen</span><span class="op" id="4025840">,</span>&nbsp;<span class="ident" id="4025842">nat</span><span class="op" id="4025845">(</span><span class="ident" id="4025846">nil</span><span class="op" id="4025849">)</span><span class="op" id="4025850">.</span><span class="ident" id="4025851">setUint64</span><span class="op" id="4025860">(</span><span class="ident" id="4025861">uint64</span><span class="op" id="4025867">(</span><span class="ident" id="4025868">prec</span><span class="op" id="4025872">)</span><span class="op" id="4025873">)</span><span class="op" id="4025874">,</span>&nbsp;<span class="ident" id="4025876">nil</span><span class="op" id="4025879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4025882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025886">r</span>&nbsp;<span class="op" id="4025888">=</span>&nbsp;<span class="ident" id="4025890">r</span><span class="op" id="4025891">.</span><span class="ident" id="4025892">mul</span><span class="op" id="4025895">(</span><span class="ident" id="4025896">r</span><span class="op" id="4025897">,</span>&nbsp;<span class="ident" id="4025899">p</span><span class="op" id="4025900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025903">r</span><span class="op" id="4025904">,</span>&nbsp;<span class="ident" id="4025906">r2</span>&nbsp;<span class="op" id="4025909">:=</span>&nbsp;<span class="ident" id="4025912">r</span><span class="op" id="4025913">.</span><span class="ident" id="4025914">div</span><span class="op" id="4025917">(</span><span class="ident" id="4025918">nat</span><span class="op" id="4025921">(</span><span class="ident" id="4025922">nil</span><span class="op" id="4025925">)</span><span class="op" id="4025926">,</span>&nbsp;<span class="ident" id="4025928">r</span><span class="op" id="4025929">,</span>&nbsp;<span class="ident" id="4025931">x</span><span class="op" id="4025932">.</span><span class="ident" id="4025933">b</span><span class="op" id="4025934">.</span><span class="ident" id="4025935">abs</span><span class="op" id="4025938">)</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4025942">//&nbsp;see&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;round&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025973">r2</span>&nbsp;<span class="op" id="4025976">=</span>&nbsp;<span class="ident" id="4025978">r2</span><span class="op" id="4025980">.</span><span class="ident" id="4025981">add</span><span class="op" id="4025984">(</span><span class="ident" id="4025985">r2</span><span class="op" id="4025987">,</span>&nbsp;<span class="ident" id="4025989">r2</span><span class="op" id="4025991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4025994">if</span>&nbsp;<span class="ident" id="4025997">x</span><span class="op" id="4025998">.</span><span class="ident" id="4025999">b</span><span class="op" id="4026000">.</span><span class="ident" id="4026001">abs</span><span class="op" id="4026004">.</span><span class="ident" id="4026005">cmp</span><span class="op" id="4026008">(</span><span class="ident" id="4026009">r2</span><span class="op" id="4026011">)</span>&nbsp;<span class="op" id="4026013">&lt;=</span>&nbsp;<span class="num" id="4026016">0</span>&nbsp;<span class="op" id="4026018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026022">r</span>&nbsp;<span class="op" id="4026024">=</span>&nbsp;<span class="ident" id="4026026">r</span><span class="op" id="4026027">.</span><span class="ident" id="4026028">add</span><span class="op" id="4026031">(</span><span class="ident" id="4026032">r</span><span class="op" id="4026033">,</span>&nbsp;<span class="ident" id="4026035">natOne</span><span class="op" id="4026041">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4026045">if</span>&nbsp;<span class="ident" id="4026048">r</span><span class="op" id="4026049">.</span><span class="ident" id="4026050">cmp</span><span class="op" id="4026053">(</span><span class="ident" id="4026054">p</span><span class="op" id="4026055">)</span>&nbsp;<span class="op" id="4026057">&gt;=</span>&nbsp;<span class="num" id="4026060">0</span>&nbsp;<span class="op" id="4026062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026067">q</span>&nbsp;<span class="op" id="4026069">=</span>&nbsp;<span class="ident" id="4026071">nat</span><span class="op" id="4026074">(</span><span class="ident" id="4026075">nil</span><span class="op" id="4026078">)</span><span class="op" id="4026079">.</span><span class="ident" id="4026080">add</span><span class="op" id="4026083">(</span><span class="ident" id="4026084">q</span><span class="op" id="4026085">,</span>&nbsp;<span class="ident" id="4026087">natOne</span><span class="op" id="4026093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026098">r</span>&nbsp;<span class="op" id="4026100">=</span>&nbsp;<span class="ident" id="4026102">nat</span><span class="op" id="4026105">(</span><span class="ident" id="4026106">nil</span><span class="op" id="4026109">)</span><span class="op" id="4026110">.</span><span class="ident" id="4026111">sub</span><span class="op" id="4026114">(</span><span class="ident" id="4026115">r</span><span class="op" id="4026116">,</span>&nbsp;<span class="ident" id="4026118">p</span><span class="op" id="4026119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4026123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4026126">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026130">s</span>&nbsp;<span class="op" id="4026132">:=</span>&nbsp;<span class="ident" id="4026135">q</span><span class="op" id="4026136">.</span><span class="ident" id="4026137">decimalString</span><span class="op" id="4026150">(</span><span class="op" id="4026151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4026154">if</span>&nbsp;<span class="ident" id="4026157">x</span><span class="op" id="4026158">.</span><span class="ident" id="4026159">a</span><span class="op" id="4026160">.</span><span class="ident" id="4026161">neg</span>&nbsp;<span class="op" id="4026165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026169">s</span>&nbsp;<span class="op" id="4026171">=</span>&nbsp;<span class="string" id="4026173">&#34;-&#34;</span>&nbsp;<span class="op" id="4026177">+</span>&nbsp;<span class="ident" id="4026179">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4026182">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4026186">if</span>&nbsp;<span class="ident" id="4026189">prec</span>&nbsp;<span class="op" id="4026194">&gt;</span>&nbsp;<span class="num" id="4026196">0</span>&nbsp;<span class="op" id="4026198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026202">rs</span>&nbsp;<span class="op" id="4026205">:=</span>&nbsp;<span class="ident" id="4026208">r</span><span class="op" id="4026209">.</span><span class="ident" id="4026210">decimalString</span><span class="op" id="4026223">(</span><span class="op" id="4026224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026228">leadingZeros</span>&nbsp;<span class="op" id="4026241">:=</span>&nbsp;<span class="ident" id="4026244">prec</span>&nbsp;<span class="op" id="4026249">-</span>&nbsp;<span class="builtinfunc" id="4026251">len</span><span class="op" id="4026254">(</span><span class="ident" id="4026255">rs</span><span class="op" id="4026257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026261">s</span>&nbsp;<span class="op" id="4026263">+=</span>&nbsp;<span class="string" id="4026266">&#34;.&#34;</span>&nbsp;<span class="op" id="4026270">+</span>&nbsp;<span class="ident" id="4026272">strings</span><span class="op" id="4026279">.</span><span class="ident" id="4026280">Repeat</span><span class="op" id="4026286">(</span><span class="string" id="4026287">&#34;0&#34;</span><span class="op" id="4026290">,</span>&nbsp;<span class="ident" id="4026292">leadingZeros</span><span class="op" id="4026304">)</span>&nbsp;<span class="op" id="4026306">+</span>&nbsp;<span class="ident" id="4026308">rs</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4026312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4026316">return</span>&nbsp;<span class="ident" id="4026323">s</span><br>
<span class="lineno"></span><span class="op" id="4026325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="4026328">//&nbsp;Gob&nbsp;codec&nbsp;version.&nbsp;Permits&nbsp;backward-compatible&nbsp;changes&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4026403">const</span>&nbsp;<span class="ident" id="4026409">ratGobVersion</span>&nbsp;<span class="builtintype" id="4026423">byte</span>&nbsp;<span class="op" id="4026428">=</span>&nbsp;<span class="num" id="4026430">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4026433">//&nbsp;GobEncode&nbsp;implements&nbsp;the&nbsp;gob.GobEncoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4026487">func</span>&nbsp;<span class="op" id="4026492">(</span><span class="ident" id="4026493">x</span>&nbsp;<span class="op" id="4026495">*</span><span class="ident" id="4026496">Rat</span><span class="op" id="4026499">)</span>&nbsp;<span class="ident" id="4026501">GobEncode</span><span class="op" id="4026510">(</span><span class="op" id="4026511">)</span>&nbsp;<span class="op" id="4026513">(</span><span class="op" id="4026514">[</span><span class="op" id="4026515">]</span><span class="builtintype" id="4026516">byte</span><span class="op" id="4026520">,</span>&nbsp;<span class="builtintype" id="4026522">error</span><span class="op" id="4026527">)</span>&nbsp;<span class="op" id="4026529">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4026532">if</span>&nbsp;<span class="ident" id="4026535">x</span>&nbsp;<span class="op" id="4026537">==</span>&nbsp;<span class="ident" id="4026540">nil</span>&nbsp;<span class="op" id="4026544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4026548">return</span>&nbsp;<span class="ident" id="4026555">nil</span><span class="op" id="4026558">,</span>&nbsp;<span class="ident" id="4026560">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4026565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026568">buf</span>&nbsp;<span class="op" id="4026572">:=</span>&nbsp;<span class="builtinfunc" id="4026575">make</span><span class="op" id="4026579">(</span><span class="op" id="4026580">[</span><span class="op" id="4026581">]</span><span class="builtintype" id="4026582">byte</span><span class="op" id="4026586">,</span>&nbsp;<span class="num" id="4026588">1</span><span class="op" id="4026589">+</span><span class="num" id="4026590">4</span><span class="op" id="4026591">+</span><span class="op" id="4026592">(</span><span class="builtinfunc" id="4026593">len</span><span class="op" id="4026596">(</span><span class="ident" id="4026597">x</span><span class="op" id="4026598">.</span><span class="ident" id="4026599">a</span><span class="op" id="4026600">.</span><span class="ident" id="4026601">abs</span><span class="op" id="4026604">)</span><span class="op" id="4026605">+</span><span class="builtinfunc" id="4026606">len</span><span class="op" id="4026609">(</span><span class="ident" id="4026610">x</span><span class="op" id="4026611">.</span><span class="ident" id="4026612">b</span><span class="op" id="4026613">.</span><span class="ident" id="4026614">abs</span><span class="op" id="4026617">)</span><span class="op" id="4026618">)</span><span class="op" id="4026619">*</span><span class="ident" id="4026620">_S</span><span class="op" id="4026622">)</span>&nbsp;<span class="comment" id="4026624">//&nbsp;extra&nbsp;bytes&nbsp;for&nbsp;version&nbsp;and&nbsp;sign&nbsp;bit&nbsp;(1),&nbsp;and&nbsp;numerator&nbsp;length&nbsp;(4)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026695">i</span>&nbsp;<span class="op" id="4026697">:=</span>&nbsp;<span class="ident" id="4026700">x</span><span class="op" id="4026701">.</span><span class="ident" id="4026702">b</span><span class="op" id="4026703">.</span><span class="ident" id="4026704">abs</span><span class="op" id="4026707">.</span><span class="ident" id="4026708">bytes</span><span class="op" id="4026713">(</span><span class="ident" id="4026714">buf</span><span class="op" id="4026717">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026720">j</span>&nbsp;<span class="op" id="4026722">:=</span>&nbsp;<span class="ident" id="4026725">x</span><span class="op" id="4026726">.</span><span class="ident" id="4026727">a</span><span class="op" id="4026728">.</span><span class="ident" id="4026729">abs</span><span class="op" id="4026732">.</span><span class="ident" id="4026733">bytes</span><span class="op" id="4026738">(</span><span class="ident" id="4026739">buf</span><span class="op" id="4026742">[</span><span class="num" id="4026743">0</span><span class="op" id="4026744">:</span><span class="ident" id="4026745">i</span><span class="op" id="4026746">]</span><span class="op" id="4026747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026750">n</span>&nbsp;<span class="op" id="4026752">:=</span>&nbsp;<span class="ident" id="4026755">i</span>&nbsp;<span class="op" id="4026757">-</span>&nbsp;<span class="ident" id="4026759">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4026762">if</span>&nbsp;<span class="builtintype" id="4026765">int</span><span class="op" id="4026768">(</span><span class="builtintype" id="4026769">uint32</span><span class="op" id="4026775">(</span><span class="ident" id="4026776">n</span><span class="op" id="4026777">)</span><span class="op" id="4026778">)</span>&nbsp;<span class="op" id="4026780">!=</span>&nbsp;<span class="ident" id="4026783">n</span>&nbsp;<span class="op" id="4026785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4026789">//&nbsp;this&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4026819">return</span>&nbsp;<span class="ident" id="4026826">nil</span><span class="op" id="4026829">,</span>&nbsp;<span class="ident" id="4026831">errors</span><span class="op" id="4026837">.</span><span class="ident" id="4026838">New</span><span class="op" id="4026841">(</span><span class="string" id="4026842">&#34;Rat.GobEncode:&nbsp;numerator&nbsp;too&nbsp;large&#34;</span><span class="op" id="4026878">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4026881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026884">binary</span><span class="op" id="4026890">.</span><span class="ident" id="4026891">BigEndian</span><span class="op" id="4026900">.</span><span class="ident" id="4026901">PutUint32</span><span class="op" id="4026910">(</span><span class="ident" id="4026911">buf</span><span class="op" id="4026914">[</span><span class="ident" id="4026915">j</span><span class="op" id="4026916">-</span><span class="num" id="4026917">4</span><span class="op" id="4026918">:</span><span class="ident" id="4026919">j</span><span class="op" id="4026920">]</span><span class="op" id="4026921">,</span>&nbsp;<span class="builtintype" id="4026923">uint32</span><span class="op" id="4026929">(</span><span class="ident" id="4026930">n</span><span class="op" id="4026931">)</span><span class="op" id="4026932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026935">j</span>&nbsp;<span class="op" id="4026937">-=</span>&nbsp;<span class="num" id="4026940">1</span>&nbsp;<span class="op" id="4026942">+</span>&nbsp;<span class="num" id="4026944">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026947">b</span>&nbsp;<span class="op" id="4026949">:=</span>&nbsp;<span class="ident" id="4026952">ratGobVersion</span>&nbsp;<span class="op" id="4026966">&lt;&lt;</span>&nbsp;<span class="num" id="4026969">1</span>&nbsp;<span class="comment" id="4026971">//&nbsp;make&nbsp;space&nbsp;for&nbsp;sign&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4026999">if</span>&nbsp;<span class="ident" id="4027002">x</span><span class="op" id="4027003">.</span><span class="ident" id="4027004">a</span><span class="op" id="4027005">.</span><span class="ident" id="4027006">neg</span>&nbsp;<span class="op" id="4027010">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4027014">b</span>&nbsp;<span class="op" id="4027016">|=</span>&nbsp;<span class="num" id="4027019">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4027022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4027025">buf</span><span class="op" id="4027028">[</span><span class="ident" id="4027029">j</span><span class="op" id="4027030">]</span>&nbsp;<span class="op" id="4027032">=</span>&nbsp;<span class="ident" id="4027034">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027037">return</span>&nbsp;<span class="ident" id="4027044">buf</span><span class="op" id="4027047">[</span><span class="ident" id="4027048">j</span><span class="op" id="4027049">:</span><span class="op" id="4027050">]</span><span class="op" id="4027051">,</span>&nbsp;<span class="ident" id="4027053">nil</span><br>
<span class="lineno"></span><span class="op" id="4027057">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="4027060">//&nbsp;GobDecode&nbsp;implements&nbsp;the&nbsp;gob.GobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4027114">func</span>&nbsp;<span class="op" id="4027119">(</span><span class="ident" id="4027120">z</span>&nbsp;<span class="op" id="4027122">*</span><span class="ident" id="4027123">Rat</span><span class="op" id="4027126">)</span>&nbsp;<span class="ident" id="4027128">GobDecode</span><span class="op" id="4027137">(</span><span class="ident" id="4027138">buf</span>&nbsp;<span class="op" id="4027142">[</span><span class="op" id="4027143">]</span><span class="builtintype" id="4027144">byte</span><span class="op" id="4027148">)</span>&nbsp;<span class="builtintype" id="4027150">error</span>&nbsp;<span class="op" id="4027156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027159">if</span>&nbsp;<span class="builtinfunc" id="4027162">len</span><span class="op" id="4027165">(</span><span class="ident" id="4027166">buf</span><span class="op" id="4027169">)</span>&nbsp;<span class="op" id="4027171">==</span>&nbsp;<span class="num" id="4027174">0</span>&nbsp;<span class="op" id="4027176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4027180">//&nbsp;Other&nbsp;side&nbsp;sent&nbsp;a&nbsp;nil&nbsp;or&nbsp;default&nbsp;value.</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4027225">*</span><span class="ident" id="4027226">z</span>&nbsp;<span class="op" id="4027228">=</span>&nbsp;<span class="ident" id="4027230">Rat</span><span class="op" id="4027233">{</span><span class="op" id="4027234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027238">return</span>&nbsp;<span class="ident" id="4027245">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4027250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4027253">b</span>&nbsp;<span class="op" id="4027255">:=</span>&nbsp;<span class="ident" id="4027258">buf</span><span class="op" id="4027261">[</span><span class="num" id="4027262">0</span><span class="op" id="4027263">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027266">if</span>&nbsp;<span class="ident" id="4027269">b</span><span class="op" id="4027270">&gt;&gt;</span><span class="num" id="4027272">1</span>&nbsp;<span class="op" id="4027274">!=</span>&nbsp;<span class="ident" id="4027277">ratGobVersion</span>&nbsp;<span class="op" id="4027291">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027295">return</span>&nbsp;<span class="ident" id="4027302">errors</span><span class="op" id="4027308">.</span><span class="ident" id="4027309">New</span><span class="op" id="4027312">(</span><span class="ident" id="4027313">fmt</span><span class="op" id="4027316">.</span><span class="ident" id="4027317">Sprintf</span><span class="op" id="4027324">(</span><span class="string" id="4027325">&#34;Rat.GobDecode:&nbsp;encoding&nbsp;version&nbsp;%d&nbsp;not&nbsp;supported&#34;</span><span class="op" id="4027375">,</span>&nbsp;<span class="ident" id="4027377">b</span><span class="op" id="4027378">&gt;&gt;</span><span class="num" id="4027380">1</span><span class="op" id="4027381">)</span><span class="op" id="4027382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4027385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027388">const</span>&nbsp;<span class="ident" id="4027394">j</span>&nbsp;<span class="op" id="4027396">=</span>&nbsp;<span class="num" id="4027398">1</span>&nbsp;<span class="op" id="4027400">+</span>&nbsp;<span class="num" id="4027402">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4027405">i</span>&nbsp;<span class="op" id="4027407">:=</span>&nbsp;<span class="ident" id="4027410">j</span>&nbsp;<span class="op" id="4027412">+</span>&nbsp;<span class="ident" id="4027414">binary</span><span class="op" id="4027420">.</span><span class="ident" id="4027421">BigEndian</span><span class="op" id="4027430">.</span><span class="ident" id="4027431">Uint32</span><span class="op" id="4027437">(</span><span class="ident" id="4027438">buf</span><span class="op" id="4027441">[</span><span class="ident" id="4027442">j</span><span class="op" id="4027443">-</span><span class="num" id="4027444">4</span><span class="op" id="4027445">:</span><span class="ident" id="4027446">j</span><span class="op" id="4027447">]</span><span class="op" id="4027448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4027451">z</span><span class="op" id="4027452">.</span><span class="ident" id="4027453">a</span><span class="op" id="4027454">.</span><span class="ident" id="4027455">neg</span>&nbsp;<span class="op" id="4027459">=</span>&nbsp;<span class="ident" id="4027461">b</span><span class="op" id="4027462">&amp;</span><span class="num" id="4027463">1</span>&nbsp;<span class="op" id="4027465">!=</span>&nbsp;<span class="num" id="4027468">0</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4027471">z</span><span class="op" id="4027472">.</span><span class="ident" id="4027473">a</span><span class="op" id="4027474">.</span><span class="ident" id="4027475">abs</span>&nbsp;<span class="op" id="4027479">=</span>&nbsp;<span class="ident" id="4027481">z</span><span class="op" id="4027482">.</span><span class="ident" id="4027483">a</span><span class="op" id="4027484">.</span><span class="ident" id="4027485">abs</span><span class="op" id="4027488">.</span><span class="ident" id="4027489">setBytes</span><span class="op" id="4027497">(</span><span class="ident" id="4027498">buf</span><span class="op" id="4027501">[</span><span class="ident" id="4027502">j</span><span class="op" id="4027503">:</span><span class="ident" id="4027504">i</span><span class="op" id="4027505">]</span><span class="op" id="4027506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4027509">z</span><span class="op" id="4027510">.</span><span class="ident" id="4027511">b</span><span class="op" id="4027512">.</span><span class="ident" id="4027513">abs</span>&nbsp;<span class="op" id="4027517">=</span>&nbsp;<span class="ident" id="4027519">z</span><span class="op" id="4027520">.</span><span class="ident" id="4027521">b</span><span class="op" id="4027522">.</span><span class="ident" id="4027523">abs</span><span class="op" id="4027526">.</span><span class="ident" id="4027527">setBytes</span><span class="op" id="4027535">(</span><span class="ident" id="4027536">buf</span><span class="op" id="4027539">[</span><span class="ident" id="4027540">i</span><span class="op" id="4027541">:</span><span class="op" id="4027542">]</span><span class="op" id="4027543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027546">return</span>&nbsp;<span class="ident" id="4027553">nil</span><br>
<span class="lineno"></span><span class="op" id="4027557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="4027560">//&nbsp;MarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextMarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4027624">func</span>&nbsp;<span class="op" id="4027629">(</span><span class="ident" id="4027630">r</span>&nbsp;<span class="op" id="4027632">*</span><span class="ident" id="4027633">Rat</span><span class="op" id="4027636">)</span>&nbsp;<span class="ident" id="4027638">MarshalText</span><span class="op" id="4027649">(</span><span class="op" id="4027650">)</span>&nbsp;<span class="op" id="4027652">(</span><span class="ident" id="4027653">text</span>&nbsp;<span class="op" id="4027658">[</span><span class="op" id="4027659">]</span><span class="builtintype" id="4027660">byte</span><span class="op" id="4027664">,</span>&nbsp;<span class="ident" id="4027666">err</span>&nbsp;<span class="builtintype" id="4027670">error</span><span class="op" id="4027675">)</span>&nbsp;<span class="op" id="4027677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027680">return</span>&nbsp;<span class="op" id="4027687">[</span><span class="op" id="4027688">]</span><span class="builtintype" id="4027689">byte</span><span class="op" id="4027693">(</span><span class="ident" id="4027694">r</span><span class="op" id="4027695">.</span><span class="ident" id="4027696">RatString</span><span class="op" id="4027705">(</span><span class="op" id="4027706">)</span><span class="op" id="4027707">)</span><span class="op" id="4027708">,</span>&nbsp;<span class="ident" id="4027710">nil</span><br>
<span class="lineno"></span><span class="op" id="4027714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span><span class="comment" id="4027717">//&nbsp;UnmarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextUnmarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="4027785">func</span>&nbsp;<span class="op" id="4027790">(</span><span class="ident" id="4027791">r</span>&nbsp;<span class="op" id="4027793">*</span><span class="ident" id="4027794">Rat</span><span class="op" id="4027797">)</span>&nbsp;<span class="ident" id="4027799">UnmarshalText</span><span class="op" id="4027812">(</span><span class="ident" id="4027813">text</span>&nbsp;<span class="op" id="4027818">[</span><span class="op" id="4027819">]</span><span class="builtintype" id="4027820">byte</span><span class="op" id="4027824">)</span>&nbsp;<span class="builtintype" id="4027826">error</span>&nbsp;<span class="op" id="4027832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027835">if</span>&nbsp;<span class="ident" id="4027838">_</span><span class="op" id="4027839">,</span>&nbsp;<span class="ident" id="4027841">ok</span>&nbsp;<span class="op" id="4027844">:=</span>&nbsp;<span class="ident" id="4027847">r</span><span class="op" id="4027848">.</span><span class="ident" id="4027849">SetString</span><span class="op" id="4027858">(</span><span class="builtintype" id="4027859">string</span><span class="op" id="4027865">(</span><span class="ident" id="4027866">text</span><span class="op" id="4027870">)</span><span class="op" id="4027871">)</span><span class="op" id="4027872">;</span>&nbsp;<span class="op" id="4027874">!</span><span class="ident" id="4027875">ok</span>&nbsp;<span class="op" id="4027878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027882">return</span>&nbsp;<span class="ident" id="4027889">fmt</span><span class="op" id="4027892">.</span><span class="ident" id="4027893">Errorf</span><span class="op" id="4027899">(</span><span class="string" id="4027900">&#34;math/big:&nbsp;cannot&nbsp;unmarshal&nbsp;%q&nbsp;into&nbsp;a&nbsp;*big.Rat&#34;</span><span class="op" id="4027947">,</span>&nbsp;<span class="ident" id="4027949">text</span><span class="op" id="4027953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4027956">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027959">return</span>&nbsp;<span class="ident" id="4027966">nil</span><br>
<span class="lineno"></span><span class="op" id="4027970">}</span>
</div>
</body>
</html>
