<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html" class="current">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4692630">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4692685">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4692739">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4692790">//&nbsp;+build&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4692853">package</span>&nbsp;<span class="ident" id="4692861">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4692867">import</span>&nbsp;<span class="string" id="4692874">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4692887">//&nbsp;Possible&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;finding&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4692942">var</span>&nbsp;<span class="ident" id="4692946">certFiles</span>&nbsp;<span class="op" id="4692956">=</span>&nbsp;<span class="op" id="4692958">[</span><span class="op" id="4692959">]</span><span class="builtintype" id="4692960">string</span><span class="op" id="4692966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4692969">&#34;/etc/ssl/certs/ca-certificates.crt&#34;</span><span class="op" id="4693005">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4693011">//&nbsp;Debian/Ubuntu/Gentoo&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4693041">&#34;/etc/pki/tls/certs/ca-bundle.crt&#34;</span><span class="op" id="4693075">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4693083">//&nbsp;Fedora/RHEL</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4693099">&#34;/etc/ssl/ca-bundle.pem&#34;</span><span class="op" id="4693123">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4693141">//&nbsp;OpenSUSE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4693154">&#34;/etc/ssl/cert.pem&#34;</span><span class="op" id="4693173">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4693196">//&nbsp;OpenBSD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4693208">&#34;/usr/local/share/certs/ca-root-nss.crt&#34;</span><span class="op" id="4693248">,</span>&nbsp;<span class="comment" id="4693250">//&nbsp;FreeBSD/DragonFly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4693272">&#34;/etc/pki/tls/cacert.pem&#34;</span><span class="op" id="4693297">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4693314">//&nbsp;OpenELEC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4693327">&#34;/etc/certs/ca-certificates.crt&#34;</span><span class="op" id="4693359">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4693369">//&nbsp;Solaris&nbsp;11.2+</span><br>
<span class="lineno">20</span><span class="op" id="4693386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4693389">//&nbsp;Possible&nbsp;directories&nbsp;with&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;successfully</span><br>
<span class="lineno"></span><span class="comment" id="4693461">//&nbsp;reading&nbsp;at&nbsp;least&nbsp;one&nbsp;file&nbsp;from&nbsp;a&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="4693508">var</span>&nbsp;<span class="ident" id="4693512">certDirectories</span>&nbsp;<span class="op" id="4693528">=</span>&nbsp;<span class="op" id="4693530">[</span><span class="op" id="4693531">]</span><span class="builtintype" id="4693532">string</span><span class="op" id="4693538">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4693541">&#34;/system/etc/security/cacerts&#34;</span><span class="op" id="4693571">,</span>&nbsp;<span class="comment" id="4693573">//&nbsp;Android</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="4693585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4693588">func</span>&nbsp;<span class="op" id="4693593">(</span><span class="ident" id="4693594">c</span>&nbsp;<span class="op" id="4693596">*</span><span class="ident" id="4693597">Certificate</span><span class="op" id="4693608">)</span>&nbsp;<span class="ident" id="4693610">systemVerify</span><span class="op" id="4693622">(</span><span class="ident" id="4693623">opts</span>&nbsp;<span class="op" id="4693628">*</span><span class="ident" id="4693629">VerifyOptions</span><span class="op" id="4693642">)</span>&nbsp;<span class="op" id="4693644">(</span><span class="ident" id="4693645">chains</span>&nbsp;<span class="op" id="4693652">[</span><span class="op" id="4693653">]</span><span class="op" id="4693654">[</span><span class="op" id="4693655">]</span><span class="op" id="4693656">*</span><span class="ident" id="4693657">Certificate</span><span class="op" id="4693668">,</span>&nbsp;<span class="ident" id="4693670">err</span>&nbsp;<span class="builtintype" id="4693674">error</span><span class="op" id="4693679">)</span>&nbsp;<span class="op" id="4693681">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693684">return</span>&nbsp;<span class="ident" id="4693691">nil</span><span class="op" id="4693694">,</span>&nbsp;<span class="ident" id="4693696">nil</span><br>
<span class="lineno"></span><span class="op" id="4693700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4693703">func</span>&nbsp;<span class="ident" id="4693708">initSystemRoots</span><span class="op" id="4693723">(</span><span class="op" id="4693724">)</span>&nbsp;<span class="op" id="4693726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693729">roots</span>&nbsp;<span class="op" id="4693735">:=</span>&nbsp;<span class="ident" id="4693738">NewCertPool</span><span class="op" id="4693749">(</span><span class="op" id="4693750">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693753">for</span>&nbsp;<span class="ident" id="4693757">_</span><span class="op" id="4693758">,</span>&nbsp;<span class="ident" id="4693760">file</span>&nbsp;<span class="op" id="4693765">:=</span>&nbsp;<span class="keyword" id="4693768">range</span>&nbsp;<span class="ident" id="4693774">certFiles</span>&nbsp;<span class="op" id="4693784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693788">data</span><span class="op" id="4693792">,</span>&nbsp;<span class="ident" id="4693794">err</span>&nbsp;<span class="op" id="4693798">:=</span>&nbsp;<span class="ident" id="4693801">ioutil</span><span class="op" id="4693807">.</span><span class="ident" id="4693808">ReadFile</span><span class="op" id="4693816">(</span><span class="ident" id="4693817">file</span><span class="op" id="4693821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693825">if</span>&nbsp;<span class="ident" id="4693828">err</span>&nbsp;<span class="op" id="4693832">==</span>&nbsp;<span class="ident" id="4693835">nil</span>&nbsp;<span class="op" id="4693839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693844">roots</span><span class="op" id="4693849">.</span><span class="ident" id="4693850">AppendCertsFromPEM</span><span class="op" id="4693868">(</span><span class="ident" id="4693869">data</span><span class="op" id="4693873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693878">systemRoots</span>&nbsp;<span class="op" id="4693890">=</span>&nbsp;<span class="ident" id="4693892">roots</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693901">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4693910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4693913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4693917">for</span>&nbsp;<span class="ident" id="4693921">_</span><span class="op" id="4693922">,</span>&nbsp;<span class="ident" id="4693924">directory</span>&nbsp;<span class="op" id="4693934">:=</span>&nbsp;<span class="keyword" id="4693937">range</span>&nbsp;<span class="ident" id="4693943">certDirectories</span>&nbsp;<span class="op" id="4693959">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4693963">fis</span><span class="op" id="4693966">,</span>&nbsp;<span class="ident" id="4693968">err</span>&nbsp;<span class="op" id="4693972">:=</span>&nbsp;<span class="ident" id="4693975">ioutil</span><span class="op" id="4693981">.</span><span class="ident" id="4693982">ReadDir</span><span class="op" id="4693989">(</span><span class="ident" id="4693990">directory</span><span class="op" id="4693999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694003">if</span>&nbsp;<span class="ident" id="4694006">err</span>&nbsp;<span class="op" id="4694010">!=</span>&nbsp;<span class="ident" id="4694013">nil</span>&nbsp;<span class="op" id="4694017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694022">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694037">rootsAdded</span>&nbsp;<span class="op" id="4694048">:=</span>&nbsp;<span class="builtintype" id="4694051">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694059">for</span>&nbsp;<span class="ident" id="4694063">_</span><span class="op" id="4694064">,</span>&nbsp;<span class="ident" id="4694066">fi</span>&nbsp;<span class="op" id="4694069">:=</span>&nbsp;<span class="keyword" id="4694072">range</span>&nbsp;<span class="ident" id="4694078">fis</span>&nbsp;<span class="op" id="4694082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694087">data</span><span class="op" id="4694091">,</span>&nbsp;<span class="ident" id="4694093">err</span>&nbsp;<span class="op" id="4694097">:=</span>&nbsp;<span class="ident" id="4694100">ioutil</span><span class="op" id="4694106">.</span><span class="ident" id="4694107">ReadFile</span><span class="op" id="4694115">(</span><span class="ident" id="4694116">directory</span>&nbsp;<span class="op" id="4694126">+</span>&nbsp;<span class="string" id="4694128">&#34;/&#34;</span>&nbsp;<span class="op" id="4694132">+</span>&nbsp;<span class="ident" id="4694134">fi</span><span class="op" id="4694136">.</span><span class="ident" id="4694137">Name</span><span class="op" id="4694141">(</span><span class="op" id="4694142">)</span><span class="op" id="4694143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694148">if</span>&nbsp;<span class="ident" id="4694151">err</span>&nbsp;<span class="op" id="4694155">==</span>&nbsp;<span class="ident" id="4694158">nil</span>&nbsp;<span class="op" id="4694162">&amp;&amp;</span>&nbsp;<span class="ident" id="4694165">roots</span><span class="op" id="4694170">.</span><span class="ident" id="4694171">AppendCertsFromPEM</span><span class="op" id="4694189">(</span><span class="ident" id="4694190">data</span><span class="op" id="4694194">)</span>&nbsp;<span class="op" id="4694196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694202">rootsAdded</span>&nbsp;<span class="op" id="4694213">=</span>&nbsp;<span class="builtintype" id="4694215">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694223">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694231">if</span>&nbsp;<span class="ident" id="4694234">rootsAdded</span>&nbsp;<span class="op" id="4694245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4694250">systemRoots</span>&nbsp;<span class="op" id="4694262">=</span>&nbsp;<span class="ident" id="4694264">roots</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4694273">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694282">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4694285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4694289">//&nbsp;All&nbsp;of&nbsp;the&nbsp;files&nbsp;failed&nbsp;to&nbsp;load.&nbsp;systemRoots&nbsp;will&nbsp;be&nbsp;nil&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4694361">//&nbsp;trigger&nbsp;a&nbsp;specific&nbsp;error&nbsp;at&nbsp;verification&nbsp;time.</span><br>
<span class="lineno"></span><span class="op" id="4694411">}</span>
</div>
</body>
</html>
