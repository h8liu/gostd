<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>path/filepath</h2>
<ul>
<li><a href="/gostd/path/filepath/example_unix_test.go.html">example_unix_test.go</a></li>
<li><a href="/gostd/path/filepath/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/path/filepath/match.go.html">match.go</a></li>
<li><a href="/gostd/path/filepath/match_test.go.html">match_test.go</a></li>
<li><a href="/gostd/path/filepath/path.go.html" class="current">path.go</a></li>
<li><a href="/gostd/path/filepath/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/path/filepath/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/path/filepath/symlink.go.html">symlink.go</a></li>
<li><a href="/gostd/path/filepath/symlink_unix.go.html">symlink_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2979910">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2979965">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2980019">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2980070">//&nbsp;Package&nbsp;filepath&nbsp;implements&nbsp;utility&nbsp;routines&nbsp;for&nbsp;manipulating&nbsp;filename&nbsp;paths</span><br>
<span class="lineno"></span><span class="comment" id="2980150">//&nbsp;in&nbsp;a&nbsp;way&nbsp;compatible&nbsp;with&nbsp;the&nbsp;target&nbsp;operating&nbsp;system-defined&nbsp;file&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="2980226">package</span>&nbsp;<span class="ident" id="2980234">filepath</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2980244">import</span>&nbsp;<span class="op" id="2980251">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2980254">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2980264">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2980270">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2980278">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="2980288">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2980291">//&nbsp;A&nbsp;lazybuf&nbsp;is&nbsp;a&nbsp;lazily&nbsp;constructed&nbsp;path&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="2980341">//&nbsp;It&nbsp;supports&nbsp;append,&nbsp;reading&nbsp;previously&nbsp;appended&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="2980399">//&nbsp;and&nbsp;retrieving&nbsp;the&nbsp;final&nbsp;string.&nbsp;It&nbsp;does&nbsp;not&nbsp;allocate&nbsp;a&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="2980465">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;output&nbsp;until&nbsp;that&nbsp;output&nbsp;diverges&nbsp;from&nbsp;s.</span><br>
<span class="lineno">20</span><span class="keyword" id="2980522">type</span>&nbsp;<span class="ident" id="2980527">lazybuf</span>&nbsp;<span class="keyword" id="2980535">struct</span>&nbsp;<span class="op" id="2980542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2980545">path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2980556">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2980564">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2980575">[</span><span class="op" id="2980576">]</span><span class="builtintype" id="2980577">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2980583">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2980594">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2980599">volAndPath</span>&nbsp;<span class="builtintype" id="2980610">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2980618">volLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2980629">int</span><br>
<span class="lineno"></span><span class="op" id="2980633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2980636">func</span>&nbsp;<span class="op" id="2980641">(</span><span class="ident" id="2980642">b</span>&nbsp;<span class="op" id="2980644">*</span><span class="ident" id="2980645">lazybuf</span><span class="op" id="2980652">)</span>&nbsp;<span class="ident" id="2980654">index</span><span class="op" id="2980659">(</span><span class="ident" id="2980660">i</span>&nbsp;<span class="builtintype" id="2980662">int</span><span class="op" id="2980665">)</span>&nbsp;<span class="builtintype" id="2980667">byte</span>&nbsp;<span class="op" id="2980672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2980675">if</span>&nbsp;<span class="ident" id="2980678">b</span><span class="op" id="2980679">.</span><span class="ident" id="2980680">buf</span>&nbsp;<span class="op" id="2980684">!=</span>&nbsp;<span class="ident" id="2980687">nil</span>&nbsp;<span class="op" id="2980691">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2980695">return</span>&nbsp;<span class="ident" id="2980702">b</span><span class="op" id="2980703">.</span><span class="ident" id="2980704">buf</span><span class="op" id="2980707">[</span><span class="ident" id="2980708">i</span><span class="op" id="2980709">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2980712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2980715">return</span>&nbsp;<span class="ident" id="2980722">b</span><span class="op" id="2980723">.</span><span class="ident" id="2980724">path</span><span class="op" id="2980728">[</span><span class="ident" id="2980729">i</span><span class="op" id="2980730">]</span><br>
<span class="lineno"></span><span class="op" id="2980732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="2980735">func</span>&nbsp;<span class="op" id="2980740">(</span><span class="ident" id="2980741">b</span>&nbsp;<span class="op" id="2980743">*</span><span class="ident" id="2980744">lazybuf</span><span class="op" id="2980751">)</span>&nbsp;<span class="builtinfunc" id="2980753">append</span><span class="op" id="2980759">(</span><span class="ident" id="2980760">c</span>&nbsp;<span class="builtintype" id="2980762">byte</span><span class="op" id="2980766">)</span>&nbsp;<span class="op" id="2980768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2980771">if</span>&nbsp;<span class="ident" id="2980774">b</span><span class="op" id="2980775">.</span><span class="ident" id="2980776">buf</span>&nbsp;<span class="op" id="2980780">==</span>&nbsp;<span class="ident" id="2980783">nil</span>&nbsp;<span class="op" id="2980787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2980791">if</span>&nbsp;<span class="ident" id="2980794">b</span><span class="op" id="2980795">.</span><span class="ident" id="2980796">w</span>&nbsp;<span class="op" id="2980798">&lt;</span>&nbsp;<span class="builtinfunc" id="2980800">len</span><span class="op" id="2980803">(</span><span class="ident" id="2980804">b</span><span class="op" id="2980805">.</span><span class="ident" id="2980806">path</span><span class="op" id="2980810">)</span>&nbsp;<span class="op" id="2980812">&amp;&amp;</span>&nbsp;<span class="ident" id="2980815">b</span><span class="op" id="2980816">.</span><span class="ident" id="2980817">path</span><span class="op" id="2980821">[</span><span class="ident" id="2980822">b</span><span class="op" id="2980823">.</span><span class="ident" id="2980824">w</span><span class="op" id="2980825">]</span>&nbsp;<span class="op" id="2980827">==</span>&nbsp;<span class="ident" id="2980830">c</span>&nbsp;<span class="op" id="2980832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2980837">b</span><span class="op" id="2980838">.</span><span class="ident" id="2980839">w</span><span class="op" id="2980840">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2980846">return</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2980855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2980859">b</span><span class="op" id="2980860">.</span><span class="ident" id="2980861">buf</span>&nbsp;<span class="op" id="2980865">=</span>&nbsp;<span class="builtinfunc" id="2980867">make</span><span class="op" id="2980871">(</span><span class="op" id="2980872">[</span><span class="op" id="2980873">]</span><span class="builtintype" id="2980874">byte</span><span class="op" id="2980878">,</span>&nbsp;<span class="builtinfunc" id="2980880">len</span><span class="op" id="2980883">(</span><span class="ident" id="2980884">b</span><span class="op" id="2980885">.</span><span class="ident" id="2980886">path</span><span class="op" id="2980890">)</span><span class="op" id="2980891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2980895">copy</span><span class="op" id="2980899">(</span><span class="ident" id="2980900">b</span><span class="op" id="2980901">.</span><span class="ident" id="2980902">buf</span><span class="op" id="2980905">,</span>&nbsp;<span class="ident" id="2980907">b</span><span class="op" id="2980908">.</span><span class="ident" id="2980909">path</span><span class="op" id="2980913">[</span><span class="op" id="2980914">:</span><span class="ident" id="2980915">b</span><span class="op" id="2980916">.</span><span class="ident" id="2980917">w</span><span class="op" id="2980918">]</span><span class="op" id="2980919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2980922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2980925">b</span><span class="op" id="2980926">.</span><span class="ident" id="2980927">buf</span><span class="op" id="2980930">[</span><span class="ident" id="2980931">b</span><span class="op" id="2980932">.</span><span class="ident" id="2980933">w</span><span class="op" id="2980934">]</span>&nbsp;<span class="op" id="2980936">=</span>&nbsp;<span class="ident" id="2980938">c</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2980941">b</span><span class="op" id="2980942">.</span><span class="ident" id="2980943">w</span><span class="op" id="2980944">++</span><br>
<span class="lineno"></span><span class="op" id="2980947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2980950">func</span>&nbsp;<span class="op" id="2980955">(</span><span class="ident" id="2980956">b</span>&nbsp;<span class="op" id="2980958">*</span><span class="ident" id="2980959">lazybuf</span><span class="op" id="2980966">)</span>&nbsp;<span class="builtintype" id="2980968">string</span><span class="op" id="2980974">(</span><span class="op" id="2980975">)</span>&nbsp;<span class="builtintype" id="2980977">string</span>&nbsp;<span class="op" id="2980984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2980987">if</span>&nbsp;<span class="ident" id="2980990">b</span><span class="op" id="2980991">.</span><span class="ident" id="2980992">buf</span>&nbsp;<span class="op" id="2980996">==</span>&nbsp;<span class="ident" id="2980999">nil</span>&nbsp;<span class="op" id="2981003">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2981007">return</span>&nbsp;<span class="ident" id="2981014">b</span><span class="op" id="2981015">.</span><span class="ident" id="2981016">volAndPath</span><span class="op" id="2981026">[</span><span class="op" id="2981027">:</span><span class="ident" id="2981028">b</span><span class="op" id="2981029">.</span><span class="ident" id="2981030">volLen</span><span class="op" id="2981036">+</span><span class="ident" id="2981037">b</span><span class="op" id="2981038">.</span><span class="ident" id="2981039">w</span><span class="op" id="2981040">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2981043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2981046">return</span>&nbsp;<span class="ident" id="2981053">b</span><span class="op" id="2981054">.</span><span class="ident" id="2981055">volAndPath</span><span class="op" id="2981065">[</span><span class="op" id="2981066">:</span><span class="ident" id="2981067">b</span><span class="op" id="2981068">.</span><span class="ident" id="2981069">volLen</span><span class="op" id="2981075">]</span>&nbsp;<span class="op" id="2981077">+</span>&nbsp;<span class="builtintype" id="2981079">string</span><span class="op" id="2981085">(</span><span class="ident" id="2981086">b</span><span class="op" id="2981087">.</span><span class="ident" id="2981088">buf</span><span class="op" id="2981091">[</span><span class="op" id="2981092">:</span><span class="ident" id="2981093">b</span><span class="op" id="2981094">.</span><span class="ident" id="2981095">w</span><span class="op" id="2981096">]</span><span class="op" id="2981097">)</span><br>
<span class="lineno"></span><span class="op" id="2981099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="2981102">const</span>&nbsp;<span class="op" id="2981108">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981111">Separator</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2981125">=</span>&nbsp;<span class="ident" id="2981127">os</span><span class="op" id="2981129">.</span><span class="ident" id="2981130">PathSeparator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981145">ListSeparator</span>&nbsp;<span class="op" id="2981159">=</span>&nbsp;<span class="ident" id="2981161">os</span><span class="op" id="2981163">.</span><span class="ident" id="2981164">PathListSeparator</span><br>
<span class="lineno"></span><span class="op" id="2981182">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="2981185">//&nbsp;Clean&nbsp;returns&nbsp;the&nbsp;shortest&nbsp;path&nbsp;name&nbsp;equivalent&nbsp;to&nbsp;path</span><br>
<span class="lineno"></span><span class="comment" id="2981244">//&nbsp;by&nbsp;purely&nbsp;lexical&nbsp;processing.&nbsp;&nbsp;It&nbsp;applies&nbsp;the&nbsp;following&nbsp;rules</span><br>
<span class="lineno"></span><span class="comment" id="2981309">//&nbsp;iteratively&nbsp;until&nbsp;no&nbsp;further&nbsp;processing&nbsp;can&nbsp;be&nbsp;done:</span><br>
<span class="lineno"></span><span class="comment" id="2981365">//</span><br>
<span class="lineno"></span><span class="comment" id="2981368">//&nbsp;&nbsp;&nbsp;&nbsp1.&nbsp;Replace&nbsp;multiple&nbsp;Separator&nbsp;elements&nbsp;with&nbsp;a&nbsp;single&nbsp;one.</span><br>
<span class="lineno">65</span><span class="comment" id="2981429">//&nbsp;&nbsp;&nbsp;&nbsp2.&nbsp;Eliminate&nbsp;each&nbsp;.&nbsp;path&nbsp;name&nbsp;element&nbsp;(the&nbsp;current&nbsp;directory).</span><br>
<span class="lineno"></span><span class="comment" id="2981495">//&nbsp;&nbsp;&nbsp;&nbsp3.&nbsp;Eliminate&nbsp;each&nbsp;inner&nbsp;..&nbsp;path&nbsp;name&nbsp;element&nbsp;(the&nbsp;parent&nbsp;directory)</span><br>
<span class="lineno"></span><span class="comment" id="2981566">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;along&nbsp;with&nbsp;the&nbsp;non-..&nbsp;element&nbsp;that&nbsp;precedes&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="2981620">//&nbsp;&nbsp;&nbsp;&nbsp4.&nbsp;Eliminate&nbsp;..&nbsp;elements&nbsp;that&nbsp;begin&nbsp;a&nbsp;rooted&nbsp;path:</span><br>
<span class="lineno"></span><span class="comment" id="2981674">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;that&nbsp;is,&nbsp;replace&nbsp;&#34;/..&#34;&nbsp;by&nbsp;&#34;/&#34;&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;a&nbsp;path,</span><br>
<span class="lineno">70</span><span class="comment" id="2981738">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;assuming&nbsp;Separator&nbsp;is&nbsp;&#39;/&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="2981771">//</span><br>
<span class="lineno"></span><span class="comment" id="2981774">//&nbsp;The&nbsp;returned&nbsp;path&nbsp;ends&nbsp;in&nbsp;a&nbsp;slash&nbsp;only&nbsp;if&nbsp;it&nbsp;represents&nbsp;a&nbsp;root&nbsp;directory,</span><br>
<span class="lineno"></span><span class="comment" id="2981851">//&nbsp;such&nbsp;as&nbsp;&#34;/&#34;&nbsp;on&nbsp;Unix&nbsp;or&nbsp;`C:\`&nbsp;on&nbsp;Windows.</span><br>
<span class="lineno"></span><span class="comment" id="2981895">//</span><br>
<span class="lineno">75</span><span class="comment" id="2981898">//&nbsp;If&nbsp;the&nbsp;result&nbsp;of&nbsp;this&nbsp;process&nbsp;is&nbsp;an&nbsp;empty&nbsp;string,&nbsp;Clean</span><br>
<span class="lineno"></span><span class="comment" id="2981957">//&nbsp;returns&nbsp;the&nbsp;string&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2981984">//</span><br>
<span class="lineno"></span><span class="comment" id="2981987">//&nbsp;See&nbsp;also&nbsp;Rob&nbsp;Pike,&nbsp;``Lexical&nbsp;File&nbsp;Names&nbsp;in&nbsp;Plan&nbsp;9&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2982043">//&nbsp;Getting&nbsp;Dot-Dot&nbsp;Right,&#39;&#39;</span><br>
<span class="lineno">80</span><span class="comment" id="2982071">//&nbsp;http://plan9.bell-labs.com/sys/doc/lexnames.html</span><br>
<span class="lineno"></span><span class="keyword" id="2982123">func</span>&nbsp;<span class="ident" id="2982128">Clean</span><span class="op" id="2982133">(</span><span class="ident" id="2982134">path</span>&nbsp;<span class="builtintype" id="2982139">string</span><span class="op" id="2982145">)</span>&nbsp;<span class="builtintype" id="2982147">string</span>&nbsp;<span class="op" id="2982154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982157">originalPath</span>&nbsp;<span class="op" id="2982170">:=</span>&nbsp;<span class="ident" id="2982173">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982179">volLen</span>&nbsp;<span class="op" id="2982186">:=</span>&nbsp;<span class="ident" id="2982189">volumeNameLen</span><span class="op" id="2982202">(</span><span class="ident" id="2982203">path</span><span class="op" id="2982207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982210">path</span>&nbsp;<span class="op" id="2982215">=</span>&nbsp;<span class="ident" id="2982217">path</span><span class="op" id="2982221">[</span><span class="ident" id="2982222">volLen</span><span class="op" id="2982228">:</span><span class="op" id="2982229">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982232">if</span>&nbsp;<span class="ident" id="2982235">path</span>&nbsp;<span class="op" id="2982240">==</span>&nbsp;<span class="string" id="2982243">&#34;&#34;</span>&nbsp;<span class="op" id="2982246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982250">if</span>&nbsp;<span class="ident" id="2982253">volLen</span>&nbsp;<span class="op" id="2982260">&gt;</span>&nbsp;<span class="num" id="2982262">1</span>&nbsp;<span class="op" id="2982264">&amp;&amp;</span>&nbsp;<span class="ident" id="2982267">originalPath</span><span class="op" id="2982279">[</span><span class="num" id="2982280">1</span><span class="op" id="2982281">]</span>&nbsp;<span class="op" id="2982283">!=</span>&nbsp;<span class="string" id="2982286">&#39;:&#39;</span>&nbsp;<span class="op" id="2982290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2982295">//&nbsp;should&nbsp;be&nbsp;UNC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982315">return</span>&nbsp;<span class="ident" id="2982322">FromSlash</span><span class="op" id="2982331">(</span><span class="ident" id="2982332">originalPath</span><span class="op" id="2982344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2982348">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982352">return</span>&nbsp;<span class="ident" id="2982359">originalPath</span>&nbsp;<span class="op" id="2982372">+</span>&nbsp;<span class="string" id="2982374">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2982379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982382">rooted</span>&nbsp;<span class="op" id="2982389">:=</span>&nbsp;<span class="ident" id="2982392">os</span><span class="op" id="2982394">.</span><span class="ident" id="2982395">IsPathSeparator</span><span class="op" id="2982410">(</span><span class="ident" id="2982411">path</span><span class="op" id="2982415">[</span><span class="num" id="2982416">0</span><span class="op" id="2982417">]</span><span class="op" id="2982418">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2982422">//&nbsp;Invariants:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2982438">//&nbsp;&nbsp;&nbsp;&nbspreading&nbsp;from&nbsp;path;&nbsp;r&nbsp;is&nbsp;index&nbsp;of&nbsp;next&nbsp;byte&nbsp;to&nbsp;process.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2982497">//&nbsp;&nbsp;&nbsp;&nbspwriting&nbsp;to&nbsp;buf;&nbsp;w&nbsp;is&nbsp;index&nbsp;of&nbsp;next&nbsp;byte&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2982551">//&nbsp;&nbsp;&nbsp;&nbspdotdot&nbsp;is&nbsp;index&nbsp;in&nbsp;buf&nbsp;where&nbsp;..&nbsp;must&nbsp;stop,&nbsp;either&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2982613">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspit&nbsp;is&nbsp;the&nbsp;leading&nbsp;slash&nbsp;or&nbsp;it&nbsp;is&nbsp;a&nbsp;leading&nbsp;../../..&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982678">n</span>&nbsp;<span class="op" id="2982680">:=</span>&nbsp;<span class="builtinfunc" id="2982683">len</span><span class="op" id="2982686">(</span><span class="ident" id="2982687">path</span><span class="op" id="2982691">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982694">out</span>&nbsp;<span class="op" id="2982698">:=</span>&nbsp;<span class="ident" id="2982701">lazybuf</span><span class="op" id="2982708">{</span><span class="ident" id="2982709">path</span><span class="op" id="2982713">:</span>&nbsp;<span class="ident" id="2982715">path</span><span class="op" id="2982719">,</span>&nbsp;<span class="ident" id="2982721">volAndPath</span><span class="op" id="2982731">:</span>&nbsp;<span class="ident" id="2982733">originalPath</span><span class="op" id="2982745">,</span>&nbsp;<span class="ident" id="2982747">volLen</span><span class="op" id="2982753">:</span>&nbsp;<span class="ident" id="2982755">volLen</span><span class="op" id="2982761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982764">r</span><span class="op" id="2982765">,</span>&nbsp;<span class="ident" id="2982767">dotdot</span>&nbsp;<span class="op" id="2982774">:=</span>&nbsp;<span class="num" id="2982777">0</span><span class="op" id="2982778">,</span>&nbsp;<span class="num" id="2982780">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982783">if</span>&nbsp;<span class="ident" id="2982786">rooted</span>&nbsp;<span class="op" id="2982793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982797">out</span><span class="op" id="2982800">.</span><span class="builtinfunc" id="2982801">append</span><span class="op" id="2982807">(</span><span class="ident" id="2982808">Separator</span><span class="op" id="2982817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982821">r</span><span class="op" id="2982822">,</span>&nbsp;<span class="ident" id="2982824">dotdot</span>&nbsp;<span class="op" id="2982831">=</span>&nbsp;<span class="num" id="2982833">1</span><span class="op" id="2982834">,</span>&nbsp;<span class="num" id="2982836">1</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2982839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982843">for</span>&nbsp;<span class="ident" id="2982847">r</span>&nbsp;<span class="op" id="2982849">&lt;</span>&nbsp;<span class="ident" id="2982851">n</span>&nbsp;<span class="op" id="2982853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982857">switch</span>&nbsp;<span class="op" id="2982864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982868">case</span>&nbsp;<span class="ident" id="2982873">os</span><span class="op" id="2982875">.</span><span class="ident" id="2982876">IsPathSeparator</span><span class="op" id="2982891">(</span><span class="ident" id="2982892">path</span><span class="op" id="2982896">[</span><span class="ident" id="2982897">r</span><span class="op" id="2982898">]</span><span class="op" id="2982899">)</span><span class="op" id="2982900">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2982905">//&nbsp;empty&nbsp;path&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982930">r</span><span class="op" id="2982931">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982936">case</span>&nbsp;<span class="ident" id="2982941">path</span><span class="op" id="2982945">[</span><span class="ident" id="2982946">r</span><span class="op" id="2982947">]</span>&nbsp;<span class="op" id="2982949">==</span>&nbsp;<span class="string" id="2982952">&#39;.&#39;</span>&nbsp;<span class="op" id="2982956">&amp;&amp;</span>&nbsp;<span class="op" id="2982959">(</span><span class="ident" id="2982960">r</span><span class="op" id="2982961">+</span><span class="num" id="2982962">1</span>&nbsp;<span class="op" id="2982964">==</span>&nbsp;<span class="ident" id="2982967">n</span>&nbsp;<span class="op" id="2982969">||</span>&nbsp;<span class="ident" id="2982972">os</span><span class="op" id="2982974">.</span><span class="ident" id="2982975">IsPathSeparator</span><span class="op" id="2982990">(</span><span class="ident" id="2982991">path</span><span class="op" id="2982995">[</span><span class="ident" id="2982996">r</span><span class="op" id="2982997">+</span><span class="num" id="2982998">1</span><span class="op" id="2982999">]</span><span class="op" id="2983000">)</span><span class="op" id="2983001">)</span><span class="op" id="2983002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2983007">//&nbsp;.&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983023">r</span><span class="op" id="2983024">++</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983029">case</span>&nbsp;<span class="ident" id="2983034">path</span><span class="op" id="2983038">[</span><span class="ident" id="2983039">r</span><span class="op" id="2983040">]</span>&nbsp;<span class="op" id="2983042">==</span>&nbsp;<span class="string" id="2983045">&#39;.&#39;</span>&nbsp;<span class="op" id="2983049">&amp;&amp;</span>&nbsp;<span class="ident" id="2983052">path</span><span class="op" id="2983056">[</span><span class="ident" id="2983057">r</span><span class="op" id="2983058">+</span><span class="num" id="2983059">1</span><span class="op" id="2983060">]</span>&nbsp;<span class="op" id="2983062">==</span>&nbsp;<span class="string" id="2983065">&#39;.&#39;</span>&nbsp;<span class="op" id="2983069">&amp;&amp;</span>&nbsp;<span class="op" id="2983072">(</span><span class="ident" id="2983073">r</span><span class="op" id="2983074">+</span><span class="num" id="2983075">2</span>&nbsp;<span class="op" id="2983077">==</span>&nbsp;<span class="ident" id="2983080">n</span>&nbsp;<span class="op" id="2983082">||</span>&nbsp;<span class="ident" id="2983085">os</span><span class="op" id="2983087">.</span><span class="ident" id="2983088">IsPathSeparator</span><span class="op" id="2983103">(</span><span class="ident" id="2983104">path</span><span class="op" id="2983108">[</span><span class="ident" id="2983109">r</span><span class="op" id="2983110">+</span><span class="num" id="2983111">2</span><span class="op" id="2983112">]</span><span class="op" id="2983113">)</span><span class="op" id="2983114">)</span><span class="op" id="2983115">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2983120">//&nbsp;..&nbsp;element:&nbsp;remove&nbsp;to&nbsp;last&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983163">r</span>&nbsp;<span class="op" id="2983165">+=</span>&nbsp;<span class="num" id="2983168">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983173">switch</span>&nbsp;<span class="op" id="2983180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983185">case</span>&nbsp;<span class="ident" id="2983190">out</span><span class="op" id="2983193">.</span><span class="ident" id="2983194">w</span>&nbsp;<span class="op" id="2983196">&gt;</span>&nbsp;<span class="ident" id="2983198">dotdot</span><span class="op" id="2983204">:</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2983210">//&nbsp;can&nbsp;backtrack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983231">out</span><span class="op" id="2983234">.</span><span class="ident" id="2983235">w</span><span class="op" id="2983236">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983243">for</span>&nbsp;<span class="ident" id="2983247">out</span><span class="op" id="2983250">.</span><span class="ident" id="2983251">w</span>&nbsp;<span class="op" id="2983253">&gt;</span>&nbsp;<span class="ident" id="2983255">dotdot</span>&nbsp;<span class="op" id="2983262">&amp;&amp;</span>&nbsp;<span class="op" id="2983265">!</span><span class="ident" id="2983266">os</span><span class="op" id="2983268">.</span><span class="ident" id="2983269">IsPathSeparator</span><span class="op" id="2983284">(</span><span class="ident" id="2983285">out</span><span class="op" id="2983288">.</span><span class="ident" id="2983289">index</span><span class="op" id="2983294">(</span><span class="ident" id="2983295">out</span><span class="op" id="2983298">.</span><span class="ident" id="2983299">w</span><span class="op" id="2983300">)</span><span class="op" id="2983301">)</span>&nbsp;<span class="op" id="2983303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983310">out</span><span class="op" id="2983313">.</span><span class="ident" id="2983314">w</span><span class="op" id="2983315">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983322">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983327">case</span>&nbsp;<span class="op" id="2983332">!</span><span class="ident" id="2983333">rooted</span><span class="op" id="2983339">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2983345">//&nbsp;cannot&nbsp;backtrack,&nbsp;but&nbsp;not&nbsp;rooted,&nbsp;so&nbsp;append&nbsp;..&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983408">if</span>&nbsp;<span class="ident" id="2983411">out</span><span class="op" id="2983414">.</span><span class="ident" id="2983415">w</span>&nbsp;<span class="op" id="2983417">&gt;</span>&nbsp;<span class="num" id="2983419">0</span>&nbsp;<span class="op" id="2983421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983428">out</span><span class="op" id="2983431">.</span><span class="builtinfunc" id="2983432">append</span><span class="op" id="2983438">(</span><span class="ident" id="2983439">Separator</span><span class="op" id="2983448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983454">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983460">out</span><span class="op" id="2983463">.</span><span class="builtinfunc" id="2983464">append</span><span class="op" id="2983470">(</span><span class="string" id="2983471">&#39;.&#39;</span><span class="op" id="2983474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983480">out</span><span class="op" id="2983483">.</span><span class="builtinfunc" id="2983484">append</span><span class="op" id="2983490">(</span><span class="string" id="2983491">&#39;.&#39;</span><span class="op" id="2983494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983500">dotdot</span>&nbsp;<span class="op" id="2983507">=</span>&nbsp;<span class="ident" id="2983509">out</span><span class="op" id="2983512">.</span><span class="ident" id="2983513">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983522">default</span><span class="op" id="2983529">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2983534">//&nbsp;real&nbsp;path&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2983559">//&nbsp;add&nbsp;slash&nbsp;if&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983585">if</span>&nbsp;<span class="ident" id="2983588">rooted</span>&nbsp;<span class="op" id="2983595">&amp;&amp;</span>&nbsp;<span class="ident" id="2983598">out</span><span class="op" id="2983601">.</span><span class="ident" id="2983602">w</span>&nbsp;<span class="op" id="2983604">!=</span>&nbsp;<span class="num" id="2983607">1</span>&nbsp;<span class="op" id="2983609">||</span>&nbsp;<span class="op" id="2983612">!</span><span class="ident" id="2983613">rooted</span>&nbsp;<span class="op" id="2983620">&amp;&amp;</span>&nbsp;<span class="ident" id="2983623">out</span><span class="op" id="2983626">.</span><span class="ident" id="2983627">w</span>&nbsp;<span class="op" id="2983629">!=</span>&nbsp;<span class="num" id="2983632">0</span>&nbsp;<span class="op" id="2983634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983640">out</span><span class="op" id="2983643">.</span><span class="builtinfunc" id="2983644">append</span><span class="op" id="2983650">(</span><span class="ident" id="2983651">Separator</span><span class="op" id="2983660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983665">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2983670">//&nbsp;copy&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983689">for</span>&nbsp;<span class="op" id="2983693">;</span>&nbsp;<span class="ident" id="2983695">r</span>&nbsp;<span class="op" id="2983697">&lt;</span>&nbsp;<span class="ident" id="2983699">n</span>&nbsp;<span class="op" id="2983701">&amp;&amp;</span>&nbsp;<span class="op" id="2983704">!</span><span class="ident" id="2983705">os</span><span class="op" id="2983707">.</span><span class="ident" id="2983708">IsPathSeparator</span><span class="op" id="2983723">(</span><span class="ident" id="2983724">path</span><span class="op" id="2983728">[</span><span class="ident" id="2983729">r</span><span class="op" id="2983730">]</span><span class="op" id="2983731">)</span><span class="op" id="2983732">;</span>&nbsp;<span class="ident" id="2983734">r</span><span class="op" id="2983735">++</span>&nbsp;<span class="op" id="2983738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983744">out</span><span class="op" id="2983747">.</span><span class="builtinfunc" id="2983748">append</span><span class="op" id="2983754">(</span><span class="ident" id="2983755">path</span><span class="op" id="2983759">[</span><span class="ident" id="2983760">r</span><span class="op" id="2983761">]</span><span class="op" id="2983762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983771">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2983778">//&nbsp;Turn&nbsp;empty&nbsp;string&nbsp;into&nbsp;&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983809">if</span>&nbsp;<span class="ident" id="2983812">out</span><span class="op" id="2983815">.</span><span class="ident" id="2983816">w</span>&nbsp;<span class="op" id="2983818">==</span>&nbsp;<span class="num" id="2983821">0</span>&nbsp;<span class="op" id="2983823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983827">out</span><span class="op" id="2983830">.</span><span class="builtinfunc" id="2983831">append</span><span class="op" id="2983837">(</span><span class="string" id="2983838">&#39;.&#39;</span><span class="op" id="2983841">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983848">return</span>&nbsp;<span class="ident" id="2983855">FromSlash</span><span class="op" id="2983864">(</span><span class="ident" id="2983865">out</span><span class="op" id="2983868">.</span><span class="builtintype" id="2983869">string</span><span class="op" id="2983875">(</span><span class="op" id="2983876">)</span><span class="op" id="2983877">)</span><br>
<span class="lineno"></span><span class="op" id="2983879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="2983882">//&nbsp;ToSlash&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;replacing&nbsp;each&nbsp;separator&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="2983950">//&nbsp;in&nbsp;path&nbsp;with&nbsp;a&nbsp;slash&nbsp;(&#39;/&#39;)&nbsp;character.&nbsp;Multiple&nbsp;separators&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="2984015">//&nbsp;replaced&nbsp;by&nbsp;multiple&nbsp;slashes.</span><br>
<span class="lineno"></span><span class="keyword" id="2984048">func</span>&nbsp;<span class="ident" id="2984053">ToSlash</span><span class="op" id="2984060">(</span><span class="ident" id="2984061">path</span>&nbsp;<span class="builtintype" id="2984066">string</span><span class="op" id="2984072">)</span>&nbsp;<span class="builtintype" id="2984074">string</span>&nbsp;<span class="op" id="2984081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2984084">if</span>&nbsp;<span class="ident" id="2984087">Separator</span>&nbsp;<span class="op" id="2984097">==</span>&nbsp;<span class="string" id="2984100">&#39;/&#39;</span>&nbsp;<span class="op" id="2984104">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2984108">return</span>&nbsp;<span class="ident" id="2984115">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2984121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2984124">return</span>&nbsp;<span class="ident" id="2984131">strings</span><span class="op" id="2984138">.</span><span class="ident" id="2984139">Replace</span><span class="op" id="2984146">(</span><span class="ident" id="2984147">path</span><span class="op" id="2984151">,</span>&nbsp;<span class="builtintype" id="2984153">string</span><span class="op" id="2984159">(</span><span class="ident" id="2984160">Separator</span><span class="op" id="2984169">)</span><span class="op" id="2984170">,</span>&nbsp;<span class="string" id="2984172">&#34;/&#34;</span><span class="op" id="2984175">,</span>&nbsp;<span class="op" id="2984177">-</span><span class="num" id="2984178">1</span><span class="op" id="2984179">)</span><br>
<span class="lineno"></span><span class="op" id="2984181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="2984184">//&nbsp;FromSlash&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;replacing&nbsp;each&nbsp;slash&nbsp;(&#39;/&#39;)&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="2984256">//&nbsp;in&nbsp;path&nbsp;with&nbsp;a&nbsp;separator&nbsp;character.&nbsp;Multiple&nbsp;slashes&nbsp;are&nbsp;replaced</span><br>
<span class="lineno"></span><span class="comment" id="2984325">//&nbsp;by&nbsp;multiple&nbsp;separators.</span><br>
<span class="lineno"></span><span class="keyword" id="2984352">func</span>&nbsp;<span class="ident" id="2984357">FromSlash</span><span class="op" id="2984366">(</span><span class="ident" id="2984367">path</span>&nbsp;<span class="builtintype" id="2984372">string</span><span class="op" id="2984378">)</span>&nbsp;<span class="builtintype" id="2984380">string</span>&nbsp;<span class="op" id="2984387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2984390">if</span>&nbsp;<span class="ident" id="2984393">Separator</span>&nbsp;<span class="op" id="2984403">==</span>&nbsp;<span class="string" id="2984406">&#39;/&#39;</span>&nbsp;<span class="op" id="2984410">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2984414">return</span>&nbsp;<span class="ident" id="2984421">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2984427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2984430">return</span>&nbsp;<span class="ident" id="2984437">strings</span><span class="op" id="2984444">.</span><span class="ident" id="2984445">Replace</span><span class="op" id="2984452">(</span><span class="ident" id="2984453">path</span><span class="op" id="2984457">,</span>&nbsp;<span class="string" id="2984459">&#34;/&#34;</span><span class="op" id="2984462">,</span>&nbsp;<span class="builtintype" id="2984464">string</span><span class="op" id="2984470">(</span><span class="ident" id="2984471">Separator</span><span class="op" id="2984480">)</span><span class="op" id="2984481">,</span>&nbsp;<span class="op" id="2984483">-</span><span class="num" id="2984484">1</span><span class="op" id="2984485">)</span><br>
<span class="lineno"></span><span class="op" id="2984487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="2984490">//&nbsp;SplitList&nbsp;splits&nbsp;a&nbsp;list&nbsp;of&nbsp;paths&nbsp;joined&nbsp;by&nbsp;the&nbsp;OS-specific&nbsp;ListSeparator,</span><br>
<span class="lineno"></span><span class="comment" id="2984567">//&nbsp;usually&nbsp;found&nbsp;in&nbsp;PATH&nbsp;or&nbsp;GOPATH&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><span class="comment" id="2984625">//&nbsp;Unlike&nbsp;strings.Split,&nbsp;SplitList&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;when&nbsp;passed&nbsp;an&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2984712">func</span>&nbsp;<span class="ident" id="2984717">SplitList</span><span class="op" id="2984726">(</span><span class="ident" id="2984727">path</span>&nbsp;<span class="builtintype" id="2984732">string</span><span class="op" id="2984738">)</span>&nbsp;<span class="op" id="2984740">[</span><span class="op" id="2984741">]</span><span class="builtintype" id="2984742">string</span>&nbsp;<span class="op" id="2984749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2984752">return</span>&nbsp;<span class="ident" id="2984759">splitList</span><span class="op" id="2984768">(</span><span class="ident" id="2984769">path</span><span class="op" id="2984773">)</span><br>
<span class="lineno">180</span><span class="op" id="2984775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2984778">//&nbsp;Split&nbsp;splits&nbsp;path&nbsp;immediately&nbsp;following&nbsp;the&nbsp;final&nbsp;Separator,</span><br>
<span class="lineno"></span><span class="comment" id="2984842">//&nbsp;separating&nbsp;it&nbsp;into&nbsp;a&nbsp;directory&nbsp;and&nbsp;file&nbsp;name&nbsp;component.</span><br>
<span class="lineno"></span><span class="comment" id="2984901">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;Separator&nbsp;in&nbsp;path,&nbsp;Split&nbsp;returns&nbsp;an&nbsp;empty&nbsp;dir</span><br>
<span class="lineno">185</span><span class="comment" id="2984965">//&nbsp;and&nbsp;file&nbsp;set&nbsp;to&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="2984990">//&nbsp;The&nbsp;returned&nbsp;values&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;path&nbsp;=&nbsp;dir+file.</span><br>
<span class="lineno"></span><span class="keyword" id="2985053">func</span>&nbsp;<span class="ident" id="2985058">Split</span><span class="op" id="2985063">(</span><span class="ident" id="2985064">path</span>&nbsp;<span class="builtintype" id="2985069">string</span><span class="op" id="2985075">)</span>&nbsp;<span class="op" id="2985077">(</span><span class="ident" id="2985078">dir</span><span class="op" id="2985081">,</span>&nbsp;<span class="ident" id="2985083">file</span>&nbsp;<span class="builtintype" id="2985088">string</span><span class="op" id="2985094">)</span>&nbsp;<span class="op" id="2985096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2985099">vol</span>&nbsp;<span class="op" id="2985103">:=</span>&nbsp;<span class="ident" id="2985106">VolumeName</span><span class="op" id="2985116">(</span><span class="ident" id="2985117">path</span><span class="op" id="2985121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2985124">i</span>&nbsp;<span class="op" id="2985126">:=</span>&nbsp;<span class="builtinfunc" id="2985129">len</span><span class="op" id="2985132">(</span><span class="ident" id="2985133">path</span><span class="op" id="2985137">)</span>&nbsp;<span class="op" id="2985139">-</span>&nbsp;<span class="num" id="2985141">1</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985144">for</span>&nbsp;<span class="ident" id="2985148">i</span>&nbsp;<span class="op" id="2985150">&gt;=</span>&nbsp;<span class="builtinfunc" id="2985153">len</span><span class="op" id="2985156">(</span><span class="ident" id="2985157">vol</span><span class="op" id="2985160">)</span>&nbsp;<span class="op" id="2985162">&amp;&amp;</span>&nbsp;<span class="op" id="2985165">!</span><span class="ident" id="2985166">os</span><span class="op" id="2985168">.</span><span class="ident" id="2985169">IsPathSeparator</span><span class="op" id="2985184">(</span><span class="ident" id="2985185">path</span><span class="op" id="2985189">[</span><span class="ident" id="2985190">i</span><span class="op" id="2985191">]</span><span class="op" id="2985192">)</span>&nbsp;<span class="op" id="2985194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2985198">i</span><span class="op" id="2985199">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2985203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985206">return</span>&nbsp;<span class="ident" id="2985213">path</span><span class="op" id="2985217">[</span><span class="op" id="2985218">:</span><span class="ident" id="2985219">i</span><span class="op" id="2985220">+</span><span class="num" id="2985221">1</span><span class="op" id="2985222">]</span><span class="op" id="2985223">,</span>&nbsp;<span class="ident" id="2985225">path</span><span class="op" id="2985229">[</span><span class="ident" id="2985230">i</span><span class="op" id="2985231">+</span><span class="num" id="2985232">1</span><span class="op" id="2985233">:</span><span class="op" id="2985234">]</span><br>
<span class="lineno"></span><span class="op" id="2985236">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="2985239">//&nbsp;Join&nbsp;joins&nbsp;any&nbsp;number&nbsp;of&nbsp;path&nbsp;elements&nbsp;into&nbsp;a&nbsp;single&nbsp;path,&nbsp;adding</span><br>
<span class="lineno"></span><span class="comment" id="2985308">//&nbsp;a&nbsp;Separator&nbsp;if&nbsp;necessary.&nbsp;The&nbsp;result&nbsp;is&nbsp;Cleaned,&nbsp;in&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="2985374">//&nbsp;all&nbsp;empty&nbsp;strings&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="2985408">func</span>&nbsp;<span class="ident" id="2985413">Join</span><span class="op" id="2985417">(</span><span class="ident" id="2985418">elem</span>&nbsp;<span class="op" id="2985423">...</span><span class="builtintype" id="2985426">string</span><span class="op" id="2985432">)</span>&nbsp;<span class="builtintype" id="2985434">string</span>&nbsp;<span class="op" id="2985441">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985444">for</span>&nbsp;<span class="ident" id="2985448">i</span><span class="op" id="2985449">,</span>&nbsp;<span class="ident" id="2985451">e</span>&nbsp;<span class="op" id="2985453">:=</span>&nbsp;<span class="keyword" id="2985456">range</span>&nbsp;<span class="ident" id="2985462">elem</span>&nbsp;<span class="op" id="2985467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985471">if</span>&nbsp;<span class="ident" id="2985474">e</span>&nbsp;<span class="op" id="2985476">!=</span>&nbsp;<span class="string" id="2985479">&#34;&#34;</span>&nbsp;<span class="op" id="2985482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985487">return</span>&nbsp;<span class="ident" id="2985494">Clean</span><span class="op" id="2985499">(</span><span class="ident" id="2985500">strings</span><span class="op" id="2985507">.</span><span class="ident" id="2985508">Join</span><span class="op" id="2985512">(</span><span class="ident" id="2985513">elem</span><span class="op" id="2985517">[</span><span class="ident" id="2985518">i</span><span class="op" id="2985519">:</span><span class="op" id="2985520">]</span><span class="op" id="2985521">,</span>&nbsp;<span class="builtintype" id="2985523">string</span><span class="op" id="2985529">(</span><span class="ident" id="2985530">Separator</span><span class="op" id="2985539">)</span><span class="op" id="2985540">)</span><span class="op" id="2985541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2985545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2985548">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985551">return</span>&nbsp;<span class="string" id="2985558">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="2985561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2985564">//&nbsp;Ext&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;extension&nbsp;used&nbsp;by&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="2985617">//&nbsp;The&nbsp;extension&nbsp;is&nbsp;the&nbsp;suffix&nbsp;beginning&nbsp;at&nbsp;the&nbsp;final&nbsp;dot</span><br>
<span class="lineno">210</span><span class="comment" id="2985675">//&nbsp;in&nbsp;the&nbsp;final&nbsp;element&nbsp;of&nbsp;path;&nbsp;it&nbsp;is&nbsp;empty&nbsp;if&nbsp;there&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2985732">//&nbsp;no&nbsp;dot.</span><br>
<span class="lineno"></span><span class="keyword" id="2985743">func</span>&nbsp;<span class="ident" id="2985748">Ext</span><span class="op" id="2985751">(</span><span class="ident" id="2985752">path</span>&nbsp;<span class="builtintype" id="2985757">string</span><span class="op" id="2985763">)</span>&nbsp;<span class="builtintype" id="2985765">string</span>&nbsp;<span class="op" id="2985772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985775">for</span>&nbsp;<span class="ident" id="2985779">i</span>&nbsp;<span class="op" id="2985781">:=</span>&nbsp;<span class="builtinfunc" id="2985784">len</span><span class="op" id="2985787">(</span><span class="ident" id="2985788">path</span><span class="op" id="2985792">)</span>&nbsp;<span class="op" id="2985794">-</span>&nbsp;<span class="num" id="2985796">1</span><span class="op" id="2985797">;</span>&nbsp;<span class="ident" id="2985799">i</span>&nbsp;<span class="op" id="2985801">&gt;=</span>&nbsp;<span class="num" id="2985804">0</span>&nbsp;<span class="op" id="2985806">&amp;&amp;</span>&nbsp;<span class="op" id="2985809">!</span><span class="ident" id="2985810">os</span><span class="op" id="2985812">.</span><span class="ident" id="2985813">IsPathSeparator</span><span class="op" id="2985828">(</span><span class="ident" id="2985829">path</span><span class="op" id="2985833">[</span><span class="ident" id="2985834">i</span><span class="op" id="2985835">]</span><span class="op" id="2985836">)</span><span class="op" id="2985837">;</span>&nbsp;<span class="ident" id="2985839">i</span><span class="op" id="2985840">--</span>&nbsp;<span class="op" id="2985843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985847">if</span>&nbsp;<span class="ident" id="2985850">path</span><span class="op" id="2985854">[</span><span class="ident" id="2985855">i</span><span class="op" id="2985856">]</span>&nbsp;<span class="op" id="2985858">==</span>&nbsp;<span class="string" id="2985861">&#39;.&#39;</span>&nbsp;<span class="op" id="2985865">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985870">return</span>&nbsp;<span class="ident" id="2985877">path</span><span class="op" id="2985881">[</span><span class="ident" id="2985882">i</span><span class="op" id="2985883">:</span><span class="op" id="2985884">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2985888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2985891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985894">return</span>&nbsp;<span class="string" id="2985901">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="2985904">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="2985907">//&nbsp;EvalSymlinks&nbsp;returns&nbsp;the&nbsp;path&nbsp;name&nbsp;after&nbsp;the&nbsp;evaluation&nbsp;of&nbsp;any&nbsp;symbolic</span><br>
<span class="lineno"></span><span class="comment" id="2985982">//&nbsp;links.</span><br>
<span class="lineno"></span><span class="comment" id="2985992">//&nbsp;If&nbsp;path&nbsp;is&nbsp;relative&nbsp;the&nbsp;result&nbsp;will&nbsp;be&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;directory,</span><br>
<span class="lineno"></span><span class="comment" id="2986069">//&nbsp;unless&nbsp;one&nbsp;of&nbsp;the&nbsp;components&nbsp;is&nbsp;an&nbsp;absolute&nbsp;symbolic&nbsp;link.</span><br>
<span class="lineno">225</span><span class="keyword" id="2986131">func</span>&nbsp;<span class="ident" id="2986136">EvalSymlinks</span><span class="op" id="2986148">(</span><span class="ident" id="2986149">path</span>&nbsp;<span class="builtintype" id="2986154">string</span><span class="op" id="2986160">)</span>&nbsp;<span class="op" id="2986162">(</span><span class="builtintype" id="2986163">string</span><span class="op" id="2986169">,</span>&nbsp;<span class="builtintype" id="2986171">error</span><span class="op" id="2986176">)</span>&nbsp;<span class="op" id="2986178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986181">return</span>&nbsp;<span class="ident" id="2986188">evalSymlinks</span><span class="op" id="2986200">(</span><span class="ident" id="2986201">path</span><span class="op" id="2986205">)</span><br>
<span class="lineno"></span><span class="op" id="2986207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2986210">//&nbsp;Abs&nbsp;returns&nbsp;an&nbsp;absolute&nbsp;representation&nbsp;of&nbsp;path.</span><br>
<span class="lineno">230</span><span class="comment" id="2986261">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;not&nbsp;absolute&nbsp;it&nbsp;will&nbsp;be&nbsp;joined&nbsp;with&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="2986327">//&nbsp;working&nbsp;directory&nbsp;to&nbsp;turn&nbsp;it&nbsp;into&nbsp;an&nbsp;absolute&nbsp;path.&nbsp;&nbsp;The&nbsp;absolute</span><br>
<span class="lineno"></span><span class="comment" id="2986396">//&nbsp;path&nbsp;name&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span><span class="keyword" id="2986458">func</span>&nbsp;<span class="ident" id="2986463">Abs</span><span class="op" id="2986466">(</span><span class="ident" id="2986467">path</span>&nbsp;<span class="builtintype" id="2986472">string</span><span class="op" id="2986478">)</span>&nbsp;<span class="op" id="2986480">(</span><span class="builtintype" id="2986481">string</span><span class="op" id="2986487">,</span>&nbsp;<span class="builtintype" id="2986489">error</span><span class="op" id="2986494">)</span>&nbsp;<span class="op" id="2986496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986499">return</span>&nbsp;<span class="ident" id="2986506">abs</span><span class="op" id="2986509">(</span><span class="ident" id="2986510">path</span><span class="op" id="2986514">)</span><br>
<span class="lineno">235</span><span class="op" id="2986516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2986519">func</span>&nbsp;<span class="ident" id="2986524">unixAbs</span><span class="op" id="2986531">(</span><span class="ident" id="2986532">path</span>&nbsp;<span class="builtintype" id="2986537">string</span><span class="op" id="2986543">)</span>&nbsp;<span class="op" id="2986545">(</span><span class="builtintype" id="2986546">string</span><span class="op" id="2986552">,</span>&nbsp;<span class="builtintype" id="2986554">error</span><span class="op" id="2986559">)</span>&nbsp;<span class="op" id="2986561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986564">if</span>&nbsp;<span class="ident" id="2986567">IsAbs</span><span class="op" id="2986572">(</span><span class="ident" id="2986573">path</span><span class="op" id="2986577">)</span>&nbsp;<span class="op" id="2986579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986583">return</span>&nbsp;<span class="ident" id="2986590">Clean</span><span class="op" id="2986595">(</span><span class="ident" id="2986596">path</span><span class="op" id="2986600">)</span><span class="op" id="2986601">,</span>&nbsp;<span class="ident" id="2986603">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2986608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2986611">wd</span><span class="op" id="2986613">,</span>&nbsp;<span class="ident" id="2986615">err</span>&nbsp;<span class="op" id="2986619">:=</span>&nbsp;<span class="ident" id="2986622">os</span><span class="op" id="2986624">.</span><span class="ident" id="2986625">Getwd</span><span class="op" id="2986630">(</span><span class="op" id="2986631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986634">if</span>&nbsp;<span class="ident" id="2986637">err</span>&nbsp;<span class="op" id="2986641">!=</span>&nbsp;<span class="ident" id="2986644">nil</span>&nbsp;<span class="op" id="2986648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986652">return</span>&nbsp;<span class="string" id="2986659">&#34;&#34;</span><span class="op" id="2986661">,</span>&nbsp;<span class="ident" id="2986663">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2986668">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986671">return</span>&nbsp;<span class="ident" id="2986678">Join</span><span class="op" id="2986682">(</span><span class="ident" id="2986683">wd</span><span class="op" id="2986685">,</span>&nbsp;<span class="ident" id="2986687">path</span><span class="op" id="2986691">)</span><span class="op" id="2986692">,</span>&nbsp;<span class="ident" id="2986694">nil</span><br>
<span class="lineno"></span><span class="op" id="2986698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2986701">//&nbsp;Rel&nbsp;returns&nbsp;a&nbsp;relative&nbsp;path&nbsp;that&nbsp;is&nbsp;lexically&nbsp;equivalent&nbsp;to&nbsp;targpath&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="2986778">//&nbsp;joined&nbsp;to&nbsp;basepath&nbsp;with&nbsp;an&nbsp;intervening&nbsp;separator.&nbsp;That&nbsp;is,</span><br>
<span class="lineno">250</span><span class="comment" id="2986840">//&nbsp;Join(basepath,&nbsp;Rel(basepath,&nbsp;targpath))&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;targpath&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="2986917">//&nbsp;On&nbsp;success,&nbsp;the&nbsp;returned&nbsp;path&nbsp;will&nbsp;always&nbsp;be&nbsp;relative&nbsp;to&nbsp;basepath,</span><br>
<span class="lineno"></span><span class="comment" id="2986987">//&nbsp;even&nbsp;if&nbsp;basepath&nbsp;and&nbsp;targpath&nbsp;share&nbsp;no&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="2987039">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;targpath&nbsp;can&#39;t&nbsp;be&nbsp;made&nbsp;relative&nbsp;to&nbsp;basepath&nbsp;or&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2987116">//&nbsp;knowing&nbsp;the&nbsp;current&nbsp;working&nbsp;directory&nbsp;would&nbsp;be&nbsp;necessary&nbsp;to&nbsp;compute&nbsp;it.</span><br>
<span class="lineno">255</span><span class="keyword" id="2987191">func</span>&nbsp;<span class="ident" id="2987196">Rel</span><span class="op" id="2987199">(</span><span class="ident" id="2987200">basepath</span><span class="op" id="2987208">,</span>&nbsp;<span class="ident" id="2987210">targpath</span>&nbsp;<span class="builtintype" id="2987219">string</span><span class="op" id="2987225">)</span>&nbsp;<span class="op" id="2987227">(</span><span class="builtintype" id="2987228">string</span><span class="op" id="2987234">,</span>&nbsp;<span class="builtintype" id="2987236">error</span><span class="op" id="2987241">)</span>&nbsp;<span class="op" id="2987243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987246">baseVol</span>&nbsp;<span class="op" id="2987254">:=</span>&nbsp;<span class="ident" id="2987257">VolumeName</span><span class="op" id="2987267">(</span><span class="ident" id="2987268">basepath</span><span class="op" id="2987276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987279">targVol</span>&nbsp;<span class="op" id="2987287">:=</span>&nbsp;<span class="ident" id="2987290">VolumeName</span><span class="op" id="2987300">(</span><span class="ident" id="2987301">targpath</span><span class="op" id="2987309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987312">base</span>&nbsp;<span class="op" id="2987317">:=</span>&nbsp;<span class="ident" id="2987320">Clean</span><span class="op" id="2987325">(</span><span class="ident" id="2987326">basepath</span><span class="op" id="2987334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987337">targ</span>&nbsp;<span class="op" id="2987342">:=</span>&nbsp;<span class="ident" id="2987345">Clean</span><span class="op" id="2987350">(</span><span class="ident" id="2987351">targpath</span><span class="op" id="2987359">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987362">if</span>&nbsp;<span class="ident" id="2987365">targ</span>&nbsp;<span class="op" id="2987370">==</span>&nbsp;<span class="ident" id="2987373">base</span>&nbsp;<span class="op" id="2987378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987382">return</span>&nbsp;<span class="string" id="2987389">&#34;.&#34;</span><span class="op" id="2987392">,</span>&nbsp;<span class="ident" id="2987394">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2987399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987402">base</span>&nbsp;<span class="op" id="2987407">=</span>&nbsp;<span class="ident" id="2987409">base</span><span class="op" id="2987413">[</span><span class="builtinfunc" id="2987414">len</span><span class="op" id="2987417">(</span><span class="ident" id="2987418">baseVol</span><span class="op" id="2987425">)</span><span class="op" id="2987426">:</span><span class="op" id="2987427">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987430">targ</span>&nbsp;<span class="op" id="2987435">=</span>&nbsp;<span class="ident" id="2987437">targ</span><span class="op" id="2987441">[</span><span class="builtinfunc" id="2987442">len</span><span class="op" id="2987445">(</span><span class="ident" id="2987446">targVol</span><span class="op" id="2987453">)</span><span class="op" id="2987454">:</span><span class="op" id="2987455">]</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987458">if</span>&nbsp;<span class="ident" id="2987461">base</span>&nbsp;<span class="op" id="2987466">==</span>&nbsp;<span class="string" id="2987469">&#34;.&#34;</span>&nbsp;<span class="op" id="2987473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987477">base</span>&nbsp;<span class="op" id="2987482">=</span>&nbsp;<span class="string" id="2987484">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2987488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2987491">//&nbsp;Can&#39;t&nbsp;use&nbsp;IsAbs&nbsp;-&nbsp;`\a`&nbsp;and&nbsp;`a`&nbsp;are&nbsp;both&nbsp;relative&nbsp;in&nbsp;Windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987556">baseSlashed</span>&nbsp;<span class="op" id="2987568">:=</span>&nbsp;<span class="builtinfunc" id="2987571">len</span><span class="op" id="2987574">(</span><span class="ident" id="2987575">base</span><span class="op" id="2987579">)</span>&nbsp;<span class="op" id="2987581">&gt;</span>&nbsp;<span class="num" id="2987583">0</span>&nbsp;<span class="op" id="2987585">&amp;&amp;</span>&nbsp;<span class="ident" id="2987588">base</span><span class="op" id="2987592">[</span><span class="num" id="2987593">0</span><span class="op" id="2987594">]</span>&nbsp;<span class="op" id="2987596">==</span>&nbsp;<span class="ident" id="2987599">Separator</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987610">targSlashed</span>&nbsp;<span class="op" id="2987622">:=</span>&nbsp;<span class="builtinfunc" id="2987625">len</span><span class="op" id="2987628">(</span><span class="ident" id="2987629">targ</span><span class="op" id="2987633">)</span>&nbsp;<span class="op" id="2987635">&gt;</span>&nbsp;<span class="num" id="2987637">0</span>&nbsp;<span class="op" id="2987639">&amp;&amp;</span>&nbsp;<span class="ident" id="2987642">targ</span><span class="op" id="2987646">[</span><span class="num" id="2987647">0</span><span class="op" id="2987648">]</span>&nbsp;<span class="op" id="2987650">==</span>&nbsp;<span class="ident" id="2987653">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987664">if</span>&nbsp;<span class="ident" id="2987667">baseSlashed</span>&nbsp;<span class="op" id="2987679">!=</span>&nbsp;<span class="ident" id="2987682">targSlashed</span>&nbsp;<span class="op" id="2987694">||</span>&nbsp;<span class="ident" id="2987697">baseVol</span>&nbsp;<span class="op" id="2987705">!=</span>&nbsp;<span class="ident" id="2987708">targVol</span>&nbsp;<span class="op" id="2987716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987720">return</span>&nbsp;<span class="string" id="2987727">&#34;&#34;</span><span class="op" id="2987729">,</span>&nbsp;<span class="ident" id="2987731">errors</span><span class="op" id="2987737">.</span><span class="ident" id="2987738">New</span><span class="op" id="2987741">(</span><span class="string" id="2987742">&#34;Rel:&nbsp;can&#39;t&nbsp;make&nbsp;&#34;</span>&nbsp;<span class="op" id="2987761">+</span>&nbsp;<span class="ident" id="2987763">targ</span>&nbsp;<span class="op" id="2987768">+</span>&nbsp;<span class="string" id="2987770">&#34;&nbsp;relative&nbsp;to&nbsp;&#34;</span>&nbsp;<span class="op" id="2987786">+</span>&nbsp;<span class="ident" id="2987788">base</span><span class="op" id="2987792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2987795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2987798">//&nbsp;Position&nbsp;base[b0:bi]&nbsp;and&nbsp;targ[t0:ti]&nbsp;at&nbsp;the&nbsp;first&nbsp;differing&nbsp;elements.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987872">bl</span>&nbsp;<span class="op" id="2987875">:=</span>&nbsp;<span class="builtinfunc" id="2987878">len</span><span class="op" id="2987881">(</span><span class="ident" id="2987882">base</span><span class="op" id="2987886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987889">tl</span>&nbsp;<span class="op" id="2987892">:=</span>&nbsp;<span class="builtinfunc" id="2987895">len</span><span class="op" id="2987898">(</span><span class="ident" id="2987899">targ</span><span class="op" id="2987903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987906">var</span>&nbsp;<span class="ident" id="2987910">b0</span><span class="op" id="2987912">,</span>&nbsp;<span class="ident" id="2987914">bi</span><span class="op" id="2987916">,</span>&nbsp;<span class="ident" id="2987918">t0</span><span class="op" id="2987920">,</span>&nbsp;<span class="ident" id="2987922">ti</span>&nbsp;<span class="builtintype" id="2987925">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987930">for</span>&nbsp;<span class="op" id="2987934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987938">for</span>&nbsp;<span class="ident" id="2987942">bi</span>&nbsp;<span class="op" id="2987945">&lt;</span>&nbsp;<span class="ident" id="2987947">bl</span>&nbsp;<span class="op" id="2987950">&amp;&amp;</span>&nbsp;<span class="ident" id="2987953">base</span><span class="op" id="2987957">[</span><span class="ident" id="2987958">bi</span><span class="op" id="2987960">]</span>&nbsp;<span class="op" id="2987962">!=</span>&nbsp;<span class="ident" id="2987965">Separator</span>&nbsp;<span class="op" id="2987975">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987980">bi</span><span class="op" id="2987982">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2987987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987991">for</span>&nbsp;<span class="ident" id="2987995">ti</span>&nbsp;<span class="op" id="2987998">&lt;</span>&nbsp;<span class="ident" id="2988000">tl</span>&nbsp;<span class="op" id="2988003">&amp;&amp;</span>&nbsp;<span class="ident" id="2988006">targ</span><span class="op" id="2988010">[</span><span class="ident" id="2988011">ti</span><span class="op" id="2988013">]</span>&nbsp;<span class="op" id="2988015">!=</span>&nbsp;<span class="ident" id="2988018">Separator</span>&nbsp;<span class="op" id="2988028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2988033">ti</span><span class="op" id="2988035">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2988040">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988044">if</span>&nbsp;<span class="ident" id="2988047">targ</span><span class="op" id="2988051">[</span><span class="ident" id="2988052">t0</span><span class="op" id="2988054">:</span><span class="ident" id="2988055">ti</span><span class="op" id="2988057">]</span>&nbsp;<span class="op" id="2988059">!=</span>&nbsp;<span class="ident" id="2988062">base</span><span class="op" id="2988066">[</span><span class="ident" id="2988067">b0</span><span class="op" id="2988069">:</span><span class="ident" id="2988070">bi</span><span class="op" id="2988072">]</span>&nbsp;<span class="op" id="2988074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988079">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2988087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988091">if</span>&nbsp;<span class="ident" id="2988094">bi</span>&nbsp;<span class="op" id="2988097">&lt;</span>&nbsp;<span class="ident" id="2988099">bl</span>&nbsp;<span class="op" id="2988102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2988107">bi</span><span class="op" id="2988109">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2988114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988118">if</span>&nbsp;<span class="ident" id="2988121">ti</span>&nbsp;<span class="op" id="2988124">&lt;</span>&nbsp;<span class="ident" id="2988126">tl</span>&nbsp;<span class="op" id="2988129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2988134">ti</span><span class="op" id="2988136">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2988141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2988145">b0</span>&nbsp;<span class="op" id="2988148">=</span>&nbsp;<span class="ident" id="2988150">bi</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2988155">t0</span>&nbsp;<span class="op" id="2988158">=</span>&nbsp;<span class="ident" id="2988160">ti</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2988164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988167">if</span>&nbsp;<span class="ident" id="2988170">base</span><span class="op" id="2988174">[</span><span class="ident" id="2988175">b0</span><span class="op" id="2988177">:</span><span class="ident" id="2988178">bi</span><span class="op" id="2988180">]</span>&nbsp;<span class="op" id="2988182">==</span>&nbsp;<span class="string" id="2988185">&#34;..&#34;</span>&nbsp;<span class="op" id="2988190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988194">return</span>&nbsp;<span class="string" id="2988201">&#34;&#34;</span><span class="op" id="2988203">,</span>&nbsp;<span class="ident" id="2988205">errors</span><span class="op" id="2988211">.</span><span class="ident" id="2988212">New</span><span class="op" id="2988215">(</span><span class="string" id="2988216">&#34;Rel:&nbsp;can&#39;t&nbsp;make&nbsp;&#34;</span>&nbsp;<span class="op" id="2988235">+</span>&nbsp;<span class="ident" id="2988237">targ</span>&nbsp;<span class="op" id="2988242">+</span>&nbsp;<span class="string" id="2988244">&#34;&nbsp;relative&nbsp;to&nbsp;&#34;</span>&nbsp;<span class="op" id="2988260">+</span>&nbsp;<span class="ident" id="2988262">base</span><span class="op" id="2988266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2988269">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988272">if</span>&nbsp;<span class="ident" id="2988275">b0</span>&nbsp;<span class="op" id="2988278">!=</span>&nbsp;<span class="ident" id="2988281">bl</span>&nbsp;<span class="op" id="2988284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2988288">//&nbsp;Base&nbsp;elements&nbsp;left.&nbsp;Must&nbsp;go&nbsp;up&nbsp;before&nbsp;going&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2988343">seps</span>&nbsp;<span class="op" id="2988348">:=</span>&nbsp;<span class="ident" id="2988351">strings</span><span class="op" id="2988358">.</span><span class="ident" id="2988359">Count</span><span class="op" id="2988364">(</span><span class="ident" id="2988365">base</span><span class="op" id="2988369">[</span><span class="ident" id="2988370">b0</span><span class="op" id="2988372">:</span><span class="ident" id="2988373">bl</span><span class="op" id="2988375">]</span><span class="op" id="2988376">,</span>&nbsp;<span class="builtintype" id="2988378">string</span><span class="op" id="2988384">(</span><span class="ident" id="2988385">Separator</span><span class="op" id="2988394">)</span><span class="op" id="2988395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2988399">size</span>&nbsp;<span class="op" id="2988404">:=</span>&nbsp;<span class="num" id="2988407">2</span>&nbsp;<span class="op" id="2988409">+</span>&nbsp;<span class="ident" id="2988411">seps</span><span class="op" id="2988415">*</span><span class="num" id="2988416">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988420">if</span>&nbsp;<span class="ident" id="2988423">tl</span>&nbsp;<span class="op" id="2988426">!=</span>&nbsp;<span class="ident" id="2988429">t0</span>&nbsp;<span class="op" id="2988432">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2988437">size</span>&nbsp;<span class="op" id="2988442">+=</span>&nbsp;<span class="num" id="2988445">1</span>&nbsp;<span class="op" id="2988447">+</span>&nbsp;<span class="ident" id="2988449">tl</span>&nbsp;<span class="op" id="2988452">-</span>&nbsp;<span class="ident" id="2988454">t0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2988459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2988463">buf</span>&nbsp;<span class="op" id="2988467">:=</span>&nbsp;<span class="builtinfunc" id="2988470">make</span><span class="op" id="2988474">(</span><span class="op" id="2988475">[</span><span class="op" id="2988476">]</span><span class="builtintype" id="2988477">byte</span><span class="op" id="2988481">,</span>&nbsp;<span class="ident" id="2988483">size</span><span class="op" id="2988487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2988491">n</span>&nbsp;<span class="op" id="2988493">:=</span>&nbsp;<span class="builtinfunc" id="2988496">copy</span><span class="op" id="2988500">(</span><span class="ident" id="2988501">buf</span><span class="op" id="2988504">,</span>&nbsp;<span class="string" id="2988506">&#34;..&#34;</span><span class="op" id="2988510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988514">for</span>&nbsp;<span class="ident" id="2988518">i</span>&nbsp;<span class="op" id="2988520">:=</span>&nbsp;<span class="num" id="2988523">0</span><span class="op" id="2988524">;</span>&nbsp;<span class="ident" id="2988526">i</span>&nbsp;<span class="op" id="2988528">&lt;</span>&nbsp;<span class="ident" id="2988530">seps</span><span class="op" id="2988534">;</span>&nbsp;<span class="ident" id="2988536">i</span><span class="op" id="2988537">++</span>&nbsp;<span class="op" id="2988540">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2988545">buf</span><span class="op" id="2988548">[</span><span class="ident" id="2988549">n</span><span class="op" id="2988550">]</span>&nbsp;<span class="op" id="2988552">=</span>&nbsp;<span class="ident" id="2988554">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2988567">copy</span><span class="op" id="2988571">(</span><span class="ident" id="2988572">buf</span><span class="op" id="2988575">[</span><span class="ident" id="2988576">n</span><span class="op" id="2988577">+</span><span class="num" id="2988578">1</span><span class="op" id="2988579">:</span><span class="op" id="2988580">]</span><span class="op" id="2988581">,</span>&nbsp;<span class="string" id="2988583">&#34;..&#34;</span><span class="op" id="2988587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2988592">n</span>&nbsp;<span class="op" id="2988594">+=</span>&nbsp;<span class="num" id="2988597">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2988601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988605">if</span>&nbsp;<span class="ident" id="2988608">t0</span>&nbsp;<span class="op" id="2988611">!=</span>&nbsp;<span class="ident" id="2988614">tl</span>&nbsp;<span class="op" id="2988617">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2988622">buf</span><span class="op" id="2988625">[</span><span class="ident" id="2988626">n</span><span class="op" id="2988627">]</span>&nbsp;<span class="op" id="2988629">=</span>&nbsp;<span class="ident" id="2988631">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2988644">copy</span><span class="op" id="2988648">(</span><span class="ident" id="2988649">buf</span><span class="op" id="2988652">[</span><span class="ident" id="2988653">n</span><span class="op" id="2988654">+</span><span class="num" id="2988655">1</span><span class="op" id="2988656">:</span><span class="op" id="2988657">]</span><span class="op" id="2988658">,</span>&nbsp;<span class="ident" id="2988660">targ</span><span class="op" id="2988664">[</span><span class="ident" id="2988665">t0</span><span class="op" id="2988667">:</span><span class="op" id="2988668">]</span><span class="op" id="2988669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2988673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988677">return</span>&nbsp;<span class="builtintype" id="2988684">string</span><span class="op" id="2988690">(</span><span class="ident" id="2988691">buf</span><span class="op" id="2988694">)</span><span class="op" id="2988695">,</span>&nbsp;<span class="ident" id="2988697">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2988702">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988705">return</span>&nbsp;<span class="ident" id="2988712">targ</span><span class="op" id="2988716">[</span><span class="ident" id="2988717">t0</span><span class="op" id="2988719">:</span><span class="op" id="2988720">]</span><span class="op" id="2988721">,</span>&nbsp;<span class="ident" id="2988723">nil</span><br>
<span class="lineno"></span><span class="op" id="2988727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2988730">//&nbsp;SkipDir&nbsp;is&nbsp;used&nbsp;as&nbsp;a&nbsp;return&nbsp;value&nbsp;from&nbsp;WalkFuncs&nbsp;to&nbsp;indicate&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2988799">//&nbsp;the&nbsp;directory&nbsp;named&nbsp;in&nbsp;the&nbsp;call&nbsp;is&nbsp;to&nbsp;be&nbsp;skipped.&nbsp;It&nbsp;is&nbsp;not&nbsp;returned</span><br>
<span class="lineno">325</span><span class="comment" id="2988871">//&nbsp;as&nbsp;an&nbsp;error&nbsp;by&nbsp;any&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="2988903">var</span>&nbsp;<span class="ident" id="2988907">SkipDir</span>&nbsp;<span class="op" id="2988915">=</span>&nbsp;<span class="ident" id="2988917">errors</span><span class="op" id="2988923">.</span><span class="ident" id="2988924">New</span><span class="op" id="2988927">(</span><span class="string" id="2988928">&#34;skip&nbsp;this&nbsp;directory&#34;</span><span class="op" id="2988949">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2988952">//&nbsp;WalkFunc&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;the&nbsp;function&nbsp;called&nbsp;for&nbsp;each&nbsp;file&nbsp;or&nbsp;directory</span><br>
<span class="lineno"></span><span class="comment" id="2989026">//&nbsp;visited&nbsp;by&nbsp;Walk.&nbsp;The&nbsp;path&nbsp;argument&nbsp;contains&nbsp;the&nbsp;argument&nbsp;to&nbsp;Walk&nbsp;as&nbsp;a</span><br>
<span class="lineno">330</span><span class="comment" id="2989099">//&nbsp;prefix;&nbsp;that&nbsp;is,&nbsp;if&nbsp;Walk&nbsp;is&nbsp;called&nbsp;with&nbsp;&#34;dir&#34;,&nbsp;which&nbsp;is&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="comment" id="2989170">//&nbsp;containing&nbsp;the&nbsp;file&nbsp;&#34;a&#34;,&nbsp;the&nbsp;walk&nbsp;function&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;argument</span><br>
<span class="lineno"></span><span class="comment" id="2989245">//&nbsp;&#34;dir/a&#34;.&nbsp;The&nbsp;info&nbsp;argument&nbsp;is&nbsp;the&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;named&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="2989314">//</span><br>
<span class="lineno"></span><span class="comment" id="2989317">//&nbsp;If&nbsp;there&nbsp;was&nbsp;a&nbsp;problem&nbsp;walking&nbsp;to&nbsp;the&nbsp;file&nbsp;or&nbsp;directory&nbsp;named&nbsp;by&nbsp;path,&nbsp;the</span><br>
<span class="lineno">335</span><span class="comment" id="2989395">//&nbsp;incoming&nbsp;error&nbsp;will&nbsp;describe&nbsp;the&nbsp;problem&nbsp;and&nbsp;the&nbsp;function&nbsp;can&nbsp;decide&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="2989471">//&nbsp;to&nbsp;handle&nbsp;that&nbsp;error&nbsp;(and&nbsp;Walk&nbsp;will&nbsp;not&nbsp;descend&nbsp;into&nbsp;that&nbsp;directory).&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="2989547">//&nbsp;an&nbsp;error&nbsp;is&nbsp;returned,&nbsp;processing&nbsp;stops.&nbsp;The&nbsp;sole&nbsp;exception&nbsp;is&nbsp;that&nbsp;if&nbsp;path</span><br>
<span class="lineno"></span><span class="comment" id="2989625">//&nbsp;is&nbsp;a&nbsp;directory&nbsp;and&nbsp;the&nbsp;function&nbsp;returns&nbsp;the&nbsp;special&nbsp;value&nbsp;SkipDir,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2989699">//&nbsp;contents&nbsp;of&nbsp;the&nbsp;directory&nbsp;are&nbsp;skipped&nbsp;and&nbsp;processing&nbsp;continues&nbsp;as&nbsp;usual&nbsp;on</span><br>
<span class="lineno">340</span><span class="comment" id="2989777">//&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="2989795">type</span>&nbsp;<span class="ident" id="2989800">WalkFunc</span>&nbsp;<span class="keyword" id="2989809">func</span><span class="op" id="2989813">(</span><span class="ident" id="2989814">path</span>&nbsp;<span class="builtintype" id="2989819">string</span><span class="op" id="2989825">,</span>&nbsp;<span class="ident" id="2989827">info</span>&nbsp;<span class="ident" id="2989832">os</span><span class="op" id="2989834">.</span><span class="ident" id="2989835">FileInfo</span><span class="op" id="2989843">,</span>&nbsp;<span class="ident" id="2989845">err</span>&nbsp;<span class="builtintype" id="2989849">error</span><span class="op" id="2989854">)</span>&nbsp;<span class="builtintype" id="2989856">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2989863">var</span>&nbsp;<span class="ident" id="2989867">lstat</span>&nbsp;<span class="op" id="2989873">=</span>&nbsp;<span class="ident" id="2989875">os</span><span class="op" id="2989877">.</span><span class="ident" id="2989878">Lstat</span>&nbsp;<span class="comment" id="2989884">//&nbsp;for&nbsp;testing</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="2989900">//&nbsp;walk&nbsp;recursively&nbsp;descends&nbsp;path,&nbsp;calling&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="2989946">func</span>&nbsp;<span class="ident" id="2989951">walk</span><span class="op" id="2989955">(</span><span class="ident" id="2989956">path</span>&nbsp;<span class="builtintype" id="2989961">string</span><span class="op" id="2989967">,</span>&nbsp;<span class="ident" id="2989969">info</span>&nbsp;<span class="ident" id="2989974">os</span><span class="op" id="2989976">.</span><span class="ident" id="2989977">FileInfo</span><span class="op" id="2989985">,</span>&nbsp;<span class="ident" id="2989987">walkFn</span>&nbsp;<span class="ident" id="2989994">WalkFunc</span><span class="op" id="2990002">)</span>&nbsp;<span class="builtintype" id="2990004">error</span>&nbsp;<span class="op" id="2990010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2990013">err</span>&nbsp;<span class="op" id="2990017">:=</span>&nbsp;<span class="ident" id="2990020">walkFn</span><span class="op" id="2990026">(</span><span class="ident" id="2990027">path</span><span class="op" id="2990031">,</span>&nbsp;<span class="ident" id="2990033">info</span><span class="op" id="2990037">,</span>&nbsp;<span class="ident" id="2990039">nil</span><span class="op" id="2990042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990045">if</span>&nbsp;<span class="ident" id="2990048">err</span>&nbsp;<span class="op" id="2990052">!=</span>&nbsp;<span class="ident" id="2990055">nil</span>&nbsp;<span class="op" id="2990059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990063">if</span>&nbsp;<span class="ident" id="2990066">info</span><span class="op" id="2990070">.</span><span class="ident" id="2990071">IsDir</span><span class="op" id="2990076">(</span><span class="op" id="2990077">)</span>&nbsp;<span class="op" id="2990079">&amp;&amp;</span>&nbsp;<span class="ident" id="2990082">err</span>&nbsp;<span class="op" id="2990086">==</span>&nbsp;<span class="ident" id="2990089">SkipDir</span>&nbsp;<span class="op" id="2990097">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990102">return</span>&nbsp;<span class="ident" id="2990109">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2990115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990119">return</span>&nbsp;<span class="ident" id="2990126">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2990131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990135">if</span>&nbsp;<span class="op" id="2990138">!</span><span class="ident" id="2990139">info</span><span class="op" id="2990143">.</span><span class="ident" id="2990144">IsDir</span><span class="op" id="2990149">(</span><span class="op" id="2990150">)</span>&nbsp;<span class="op" id="2990152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990156">return</span>&nbsp;<span class="ident" id="2990163">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2990168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2990172">names</span><span class="op" id="2990177">,</span>&nbsp;<span class="ident" id="2990179">err</span>&nbsp;<span class="op" id="2990183">:=</span>&nbsp;<span class="ident" id="2990186">readDirNames</span><span class="op" id="2990198">(</span><span class="ident" id="2990199">path</span><span class="op" id="2990203">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990206">if</span>&nbsp;<span class="ident" id="2990209">err</span>&nbsp;<span class="op" id="2990213">!=</span>&nbsp;<span class="ident" id="2990216">nil</span>&nbsp;<span class="op" id="2990220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990224">return</span>&nbsp;<span class="ident" id="2990231">walkFn</span><span class="op" id="2990237">(</span><span class="ident" id="2990238">path</span><span class="op" id="2990242">,</span>&nbsp;<span class="ident" id="2990244">info</span><span class="op" id="2990248">,</span>&nbsp;<span class="ident" id="2990250">err</span><span class="op" id="2990253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2990256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990260">for</span>&nbsp;<span class="ident" id="2990264">_</span><span class="op" id="2990265">,</span>&nbsp;<span class="ident" id="2990267">name</span>&nbsp;<span class="op" id="2990272">:=</span>&nbsp;<span class="keyword" id="2990275">range</span>&nbsp;<span class="ident" id="2990281">names</span>&nbsp;<span class="op" id="2990287">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2990291">filename</span>&nbsp;<span class="op" id="2990300">:=</span>&nbsp;<span class="ident" id="2990303">Join</span><span class="op" id="2990307">(</span><span class="ident" id="2990308">path</span><span class="op" id="2990312">,</span>&nbsp;<span class="ident" id="2990314">name</span><span class="op" id="2990318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2990322">fileInfo</span><span class="op" id="2990330">,</span>&nbsp;<span class="ident" id="2990332">err</span>&nbsp;<span class="op" id="2990336">:=</span>&nbsp;<span class="ident" id="2990339">lstat</span><span class="op" id="2990344">(</span><span class="ident" id="2990345">filename</span><span class="op" id="2990353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990357">if</span>&nbsp;<span class="ident" id="2990360">err</span>&nbsp;<span class="op" id="2990364">!=</span>&nbsp;<span class="ident" id="2990367">nil</span>&nbsp;<span class="op" id="2990371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990376">if</span>&nbsp;<span class="ident" id="2990379">err</span>&nbsp;<span class="op" id="2990383">:=</span>&nbsp;<span class="ident" id="2990386">walkFn</span><span class="op" id="2990392">(</span><span class="ident" id="2990393">filename</span><span class="op" id="2990401">,</span>&nbsp;<span class="ident" id="2990403">fileInfo</span><span class="op" id="2990411">,</span>&nbsp;<span class="ident" id="2990413">err</span><span class="op" id="2990416">)</span><span class="op" id="2990417">;</span>&nbsp;<span class="ident" id="2990419">err</span>&nbsp;<span class="op" id="2990423">!=</span>&nbsp;<span class="ident" id="2990426">nil</span>&nbsp;<span class="op" id="2990430">&amp;&amp;</span>&nbsp;<span class="ident" id="2990433">err</span>&nbsp;<span class="op" id="2990437">!=</span>&nbsp;<span class="ident" id="2990440">SkipDir</span>&nbsp;<span class="op" id="2990448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990454">return</span>&nbsp;<span class="ident" id="2990461">err</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2990468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2990472">}</span>&nbsp;<span class="keyword" id="2990474">else</span>&nbsp;<span class="op" id="2990479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2990484">err</span>&nbsp;<span class="op" id="2990488">=</span>&nbsp;<span class="ident" id="2990490">walk</span><span class="op" id="2990494">(</span><span class="ident" id="2990495">filename</span><span class="op" id="2990503">,</span>&nbsp;<span class="ident" id="2990505">fileInfo</span><span class="op" id="2990513">,</span>&nbsp;<span class="ident" id="2990515">walkFn</span><span class="op" id="2990521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990526">if</span>&nbsp;<span class="ident" id="2990529">err</span>&nbsp;<span class="op" id="2990533">!=</span>&nbsp;<span class="ident" id="2990536">nil</span>&nbsp;<span class="op" id="2990540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990546">if</span>&nbsp;<span class="op" id="2990549">!</span><span class="ident" id="2990550">fileInfo</span><span class="op" id="2990558">.</span><span class="ident" id="2990559">IsDir</span><span class="op" id="2990564">(</span><span class="op" id="2990565">)</span>&nbsp;<span class="op" id="2990567">||</span>&nbsp;<span class="ident" id="2990570">err</span>&nbsp;<span class="op" id="2990574">!=</span>&nbsp;<span class="ident" id="2990577">SkipDir</span>&nbsp;<span class="op" id="2990585">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990592">return</span>&nbsp;<span class="ident" id="2990599">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2990607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2990612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2990616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2990619">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2990622">return</span>&nbsp;<span class="ident" id="2990629">nil</span><br>
<span class="lineno"></span><span class="op" id="2990633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2990636">//&nbsp;Walk&nbsp;walks&nbsp;the&nbsp;file&nbsp;tree&nbsp;rooted&nbsp;at&nbsp;root,&nbsp;calling&nbsp;walkFn&nbsp;for&nbsp;each&nbsp;file&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2990712">//&nbsp;directory&nbsp;in&nbsp;the&nbsp;tree,&nbsp;including&nbsp;root.&nbsp;All&nbsp;errors&nbsp;that&nbsp;arise&nbsp;visiting&nbsp;files</span><br>
<span class="lineno">385</span><span class="comment" id="2990791">//&nbsp;and&nbsp;directories&nbsp;are&nbsp;filtered&nbsp;by&nbsp;walkFn.&nbsp;The&nbsp;files&nbsp;are&nbsp;walked&nbsp;in&nbsp;lexical</span><br>
<span class="lineno"></span><span class="comment" id="2990866">//&nbsp;order,&nbsp;which&nbsp;makes&nbsp;the&nbsp;output&nbsp;deterministic&nbsp;but&nbsp;means&nbsp;that&nbsp;for&nbsp;very</span><br>
<span class="lineno"></span><span class="comment" id="2990937">//&nbsp;large&nbsp;directories&nbsp;Walk&nbsp;can&nbsp;be&nbsp;inefficient.</span><br>
<span class="lineno"></span><span class="comment" id="2990983">//&nbsp;Walk&nbsp;does&nbsp;not&nbsp;follow&nbsp;symbolic&nbsp;links.</span><br>
<span class="lineno"></span><span class="keyword" id="2991023">func</span>&nbsp;<span class="ident" id="2991028">Walk</span><span class="op" id="2991032">(</span><span class="ident" id="2991033">root</span>&nbsp;<span class="builtintype" id="2991038">string</span><span class="op" id="2991044">,</span>&nbsp;<span class="ident" id="2991046">walkFn</span>&nbsp;<span class="ident" id="2991053">WalkFunc</span><span class="op" id="2991061">)</span>&nbsp;<span class="builtintype" id="2991063">error</span>&nbsp;<span class="op" id="2991069">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2991072">info</span><span class="op" id="2991076">,</span>&nbsp;<span class="ident" id="2991078">err</span>&nbsp;<span class="op" id="2991082">:=</span>&nbsp;<span class="ident" id="2991085">os</span><span class="op" id="2991087">.</span><span class="ident" id="2991088">Lstat</span><span class="op" id="2991093">(</span><span class="ident" id="2991094">root</span><span class="op" id="2991098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991101">if</span>&nbsp;<span class="ident" id="2991104">err</span>&nbsp;<span class="op" id="2991108">!=</span>&nbsp;<span class="ident" id="2991111">nil</span>&nbsp;<span class="op" id="2991115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991119">return</span>&nbsp;<span class="ident" id="2991126">walkFn</span><span class="op" id="2991132">(</span><span class="ident" id="2991133">root</span><span class="op" id="2991137">,</span>&nbsp;<span class="ident" id="2991139">nil</span><span class="op" id="2991142">,</span>&nbsp;<span class="ident" id="2991144">err</span><span class="op" id="2991147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2991150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991153">return</span>&nbsp;<span class="ident" id="2991160">walk</span><span class="op" id="2991164">(</span><span class="ident" id="2991165">root</span><span class="op" id="2991169">,</span>&nbsp;<span class="ident" id="2991171">info</span><span class="op" id="2991175">,</span>&nbsp;<span class="ident" id="2991177">walkFn</span><span class="op" id="2991183">)</span><br>
<span class="lineno">395</span><span class="op" id="2991185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2991188">//&nbsp;readDirNames&nbsp;reads&nbsp;the&nbsp;directory&nbsp;named&nbsp;by&nbsp;dirname&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="2991253">//&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="2991292">func</span>&nbsp;<span class="ident" id="2991297">readDirNames</span><span class="op" id="2991309">(</span><span class="ident" id="2991310">dirname</span>&nbsp;<span class="builtintype" id="2991318">string</span><span class="op" id="2991324">)</span>&nbsp;<span class="op" id="2991326">(</span><span class="op" id="2991327">[</span><span class="op" id="2991328">]</span><span class="builtintype" id="2991329">string</span><span class="op" id="2991335">,</span>&nbsp;<span class="builtintype" id="2991337">error</span><span class="op" id="2991342">)</span>&nbsp;<span class="op" id="2991344">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2991347">f</span><span class="op" id="2991348">,</span>&nbsp;<span class="ident" id="2991350">err</span>&nbsp;<span class="op" id="2991354">:=</span>&nbsp;<span class="ident" id="2991357">os</span><span class="op" id="2991359">.</span><span class="ident" id="2991360">Open</span><span class="op" id="2991364">(</span><span class="ident" id="2991365">dirname</span><span class="op" id="2991372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991375">if</span>&nbsp;<span class="ident" id="2991378">err</span>&nbsp;<span class="op" id="2991382">!=</span>&nbsp;<span class="ident" id="2991385">nil</span>&nbsp;<span class="op" id="2991389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991393">return</span>&nbsp;<span class="ident" id="2991400">nil</span><span class="op" id="2991403">,</span>&nbsp;<span class="ident" id="2991405">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2991410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2991413">names</span><span class="op" id="2991418">,</span>&nbsp;<span class="ident" id="2991420">err</span>&nbsp;<span class="op" id="2991424">:=</span>&nbsp;<span class="ident" id="2991427">f</span><span class="op" id="2991428">.</span><span class="ident" id="2991429">Readdirnames</span><span class="op" id="2991441">(</span><span class="op" id="2991442">-</span><span class="num" id="2991443">1</span><span class="op" id="2991444">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2991447">f</span><span class="op" id="2991448">.</span><span class="ident" id="2991449">Close</span><span class="op" id="2991454">(</span><span class="op" id="2991455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991458">if</span>&nbsp;<span class="ident" id="2991461">err</span>&nbsp;<span class="op" id="2991465">!=</span>&nbsp;<span class="ident" id="2991468">nil</span>&nbsp;<span class="op" id="2991472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991476">return</span>&nbsp;<span class="ident" id="2991483">nil</span><span class="op" id="2991486">,</span>&nbsp;<span class="ident" id="2991488">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2991493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2991496">sort</span><span class="op" id="2991500">.</span><span class="ident" id="2991501">Strings</span><span class="op" id="2991508">(</span><span class="ident" id="2991509">names</span><span class="op" id="2991514">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991517">return</span>&nbsp;<span class="ident" id="2991524">names</span><span class="op" id="2991529">,</span>&nbsp;<span class="ident" id="2991531">nil</span><br>
<span class="lineno"></span><span class="op" id="2991535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2991538">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="2991580">//&nbsp;Trailing&nbsp;path&nbsp;separators&nbsp;are&nbsp;removed&nbsp;before&nbsp;extracting&nbsp;the&nbsp;last&nbsp;element.</span><br>
<span class="lineno">415</span><span class="comment" id="2991656">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;empty,&nbsp;Base&nbsp;returns&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2991699">//&nbsp;If&nbsp;the&nbsp;path&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;separators,&nbsp;Base&nbsp;returns&nbsp;a&nbsp;single&nbsp;separator.</span><br>
<span class="lineno"></span><span class="keyword" id="2991780">func</span>&nbsp;<span class="ident" id="2991785">Base</span><span class="op" id="2991789">(</span><span class="ident" id="2991790">path</span>&nbsp;<span class="builtintype" id="2991795">string</span><span class="op" id="2991801">)</span>&nbsp;<span class="builtintype" id="2991803">string</span>&nbsp;<span class="op" id="2991810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991813">if</span>&nbsp;<span class="ident" id="2991816">path</span>&nbsp;<span class="op" id="2991821">==</span>&nbsp;<span class="string" id="2991824">&#34;&#34;</span>&nbsp;<span class="op" id="2991827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991831">return</span>&nbsp;<span class="string" id="2991838">&#34;.&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2991843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2991846">//&nbsp;Strip&nbsp;trailing&nbsp;slashes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2991874">for</span>&nbsp;<span class="builtinfunc" id="2991878">len</span><span class="op" id="2991881">(</span><span class="ident" id="2991882">path</span><span class="op" id="2991886">)</span>&nbsp;<span class="op" id="2991888">&gt;</span>&nbsp;<span class="num" id="2991890">0</span>&nbsp;<span class="op" id="2991892">&amp;&amp;</span>&nbsp;<span class="ident" id="2991895">os</span><span class="op" id="2991897">.</span><span class="ident" id="2991898">IsPathSeparator</span><span class="op" id="2991913">(</span><span class="ident" id="2991914">path</span><span class="op" id="2991918">[</span><span class="builtinfunc" id="2991919">len</span><span class="op" id="2991922">(</span><span class="ident" id="2991923">path</span><span class="op" id="2991927">)</span><span class="op" id="2991928">-</span><span class="num" id="2991929">1</span><span class="op" id="2991930">]</span><span class="op" id="2991931">)</span>&nbsp;<span class="op" id="2991933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2991937">path</span>&nbsp;<span class="op" id="2991942">=</span>&nbsp;<span class="ident" id="2991944">path</span><span class="op" id="2991948">[</span><span class="num" id="2991949">0</span>&nbsp;<span class="op" id="2991951">:</span>&nbsp;<span class="builtinfunc" id="2991953">len</span><span class="op" id="2991956">(</span><span class="ident" id="2991957">path</span><span class="op" id="2991961">)</span><span class="op" id="2991962">-</span><span class="num" id="2991963">1</span><span class="op" id="2991964">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2991967">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2991970">//&nbsp;Throw&nbsp;away&nbsp;volume&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2991997">path</span>&nbsp;<span class="op" id="2992002">=</span>&nbsp;<span class="ident" id="2992004">path</span><span class="op" id="2992008">[</span><span class="builtinfunc" id="2992009">len</span><span class="op" id="2992012">(</span><span class="ident" id="2992013">VolumeName</span><span class="op" id="2992023">(</span><span class="ident" id="2992024">path</span><span class="op" id="2992028">)</span><span class="op" id="2992029">)</span><span class="op" id="2992030">:</span><span class="op" id="2992031">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2992034">//&nbsp;Find&nbsp;the&nbsp;last&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2992060">i</span>&nbsp;<span class="op" id="2992062">:=</span>&nbsp;<span class="builtinfunc" id="2992065">len</span><span class="op" id="2992068">(</span><span class="ident" id="2992069">path</span><span class="op" id="2992073">)</span>&nbsp;<span class="op" id="2992075">-</span>&nbsp;<span class="num" id="2992077">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2992080">for</span>&nbsp;<span class="ident" id="2992084">i</span>&nbsp;<span class="op" id="2992086">&gt;=</span>&nbsp;<span class="num" id="2992089">0</span>&nbsp;<span class="op" id="2992091">&amp;&amp;</span>&nbsp;<span class="op" id="2992094">!</span><span class="ident" id="2992095">os</span><span class="op" id="2992097">.</span><span class="ident" id="2992098">IsPathSeparator</span><span class="op" id="2992113">(</span><span class="ident" id="2992114">path</span><span class="op" id="2992118">[</span><span class="ident" id="2992119">i</span><span class="op" id="2992120">]</span><span class="op" id="2992121">)</span>&nbsp;<span class="op" id="2992123">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2992127">i</span><span class="op" id="2992128">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2992132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2992135">if</span>&nbsp;<span class="ident" id="2992138">i</span>&nbsp;<span class="op" id="2992140">&gt;=</span>&nbsp;<span class="num" id="2992143">0</span>&nbsp;<span class="op" id="2992145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2992149">path</span>&nbsp;<span class="op" id="2992154">=</span>&nbsp;<span class="ident" id="2992156">path</span><span class="op" id="2992160">[</span><span class="ident" id="2992161">i</span><span class="op" id="2992162">+</span><span class="num" id="2992163">1</span><span class="op" id="2992164">:</span><span class="op" id="2992165">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2992168">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2992171">//&nbsp;If&nbsp;empty&nbsp;now,&nbsp;it&nbsp;had&nbsp;only&nbsp;slashes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2992210">if</span>&nbsp;<span class="ident" id="2992213">path</span>&nbsp;<span class="op" id="2992218">==</span>&nbsp;<span class="string" id="2992221">&#34;&#34;</span>&nbsp;<span class="op" id="2992224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2992228">return</span>&nbsp;<span class="builtintype" id="2992235">string</span><span class="op" id="2992241">(</span><span class="ident" id="2992242">Separator</span><span class="op" id="2992251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2992254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2992257">return</span>&nbsp;<span class="ident" id="2992264">path</span><br>
<span class="lineno">440</span><span class="op" id="2992269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2992272">//&nbsp;Dir&nbsp;returns&nbsp;all&nbsp;but&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;path,&nbsp;typically&nbsp;the&nbsp;path&#39;s&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="2992353">//&nbsp;After&nbsp;dropping&nbsp;the&nbsp;final&nbsp;element,&nbsp;the&nbsp;path&nbsp;is&nbsp;Cleaned&nbsp;and&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2992423">//&nbsp;slashes&nbsp;are&nbsp;removed.</span><br>
<span class="lineno">445</span><span class="comment" id="2992447">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;empty,&nbsp;Dir&nbsp;returns&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2992489">//&nbsp;If&nbsp;the&nbsp;path&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;separators,&nbsp;Dir&nbsp;returns&nbsp;a&nbsp;single&nbsp;separator.</span><br>
<span class="lineno"></span><span class="comment" id="2992569">//&nbsp;The&nbsp;returned&nbsp;path&nbsp;does&nbsp;not&nbsp;end&nbsp;in&nbsp;a&nbsp;separator&nbsp;unless&nbsp;it&nbsp;is&nbsp;the&nbsp;root&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="2992651">func</span>&nbsp;<span class="ident" id="2992656">Dir</span><span class="op" id="2992659">(</span><span class="ident" id="2992660">path</span>&nbsp;<span class="builtintype" id="2992665">string</span><span class="op" id="2992671">)</span>&nbsp;<span class="builtintype" id="2992673">string</span>&nbsp;<span class="op" id="2992680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2992683">vol</span>&nbsp;<span class="op" id="2992687">:=</span>&nbsp;<span class="ident" id="2992690">VolumeName</span><span class="op" id="2992700">(</span><span class="ident" id="2992701">path</span><span class="op" id="2992705">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2992708">i</span>&nbsp;<span class="op" id="2992710">:=</span>&nbsp;<span class="builtinfunc" id="2992713">len</span><span class="op" id="2992716">(</span><span class="ident" id="2992717">path</span><span class="op" id="2992721">)</span>&nbsp;<span class="op" id="2992723">-</span>&nbsp;<span class="num" id="2992725">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2992728">for</span>&nbsp;<span class="ident" id="2992732">i</span>&nbsp;<span class="op" id="2992734">&gt;=</span>&nbsp;<span class="builtinfunc" id="2992737">len</span><span class="op" id="2992740">(</span><span class="ident" id="2992741">vol</span><span class="op" id="2992744">)</span>&nbsp;<span class="op" id="2992746">&amp;&amp;</span>&nbsp;<span class="op" id="2992749">!</span><span class="ident" id="2992750">os</span><span class="op" id="2992752">.</span><span class="ident" id="2992753">IsPathSeparator</span><span class="op" id="2992768">(</span><span class="ident" id="2992769">path</span><span class="op" id="2992773">[</span><span class="ident" id="2992774">i</span><span class="op" id="2992775">]</span><span class="op" id="2992776">)</span>&nbsp;<span class="op" id="2992778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2992782">i</span><span class="op" id="2992783">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2992787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2992790">dir</span>&nbsp;<span class="op" id="2992794">:=</span>&nbsp;<span class="ident" id="2992797">Clean</span><span class="op" id="2992802">(</span><span class="ident" id="2992803">path</span><span class="op" id="2992807">[</span><span class="builtinfunc" id="2992808">len</span><span class="op" id="2992811">(</span><span class="ident" id="2992812">vol</span><span class="op" id="2992815">)</span>&nbsp;<span class="op" id="2992817">:</span>&nbsp;<span class="ident" id="2992819">i</span><span class="op" id="2992820">+</span><span class="num" id="2992821">1</span><span class="op" id="2992822">]</span><span class="op" id="2992823">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2992826">return</span>&nbsp;<span class="ident" id="2992833">vol</span>&nbsp;<span class="op" id="2992837">+</span>&nbsp;<span class="ident" id="2992839">dir</span><br>
<span class="lineno"></span><span class="op" id="2992843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2992846">//&nbsp;VolumeName&nbsp;returns&nbsp;leading&nbsp;volume&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="2992889">//&nbsp;Given&nbsp;&#34;C:\foo\bar&#34;&nbsp;it&nbsp;returns&nbsp;&#34;C:&#34;&nbsp;under&nbsp;windows.</span><br>
<span class="lineno">460</span><span class="comment" id="2992942">//&nbsp;Given&nbsp;&#34;\\host\share\foo&#34;&nbsp;it&nbsp;returns&nbsp;&#34;\\host\share&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2992997">//&nbsp;On&nbsp;other&nbsp;platforms&nbsp;it&nbsp;returns&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="2993034">func</span>&nbsp;<span class="ident" id="2993039">VolumeName</span><span class="op" id="2993049">(</span><span class="ident" id="2993050">path</span>&nbsp;<span class="builtintype" id="2993055">string</span><span class="op" id="2993061">)</span>&nbsp;<span class="op" id="2993063">(</span><span class="ident" id="2993064">v</span>&nbsp;<span class="builtintype" id="2993066">string</span><span class="op" id="2993072">)</span>&nbsp;<span class="op" id="2993074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2993077">return</span>&nbsp;<span class="ident" id="2993084">path</span><span class="op" id="2993088">[</span><span class="op" id="2993089">:</span><span class="ident" id="2993090">volumeNameLen</span><span class="op" id="2993103">(</span><span class="ident" id="2993104">path</span><span class="op" id="2993108">)</span><span class="op" id="2993109">]</span><br>
<span class="lineno"></span><span class="op" id="2993111">}</span>
</div>
</body>
</html>
