<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html" class="current">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6621779">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6621834">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6621888">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6621939">package</span>&nbsp;<span class="ident" id="6621947">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6621952">import</span>&nbsp;<span class="op" id="6621959">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6621962">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6621971">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6621978">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6621984">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6621991">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6622002">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6622013">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6622020">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6622023">var</span>&nbsp;<span class="ident" id="6622027">rsaCertPEM</span>&nbsp;<span class="op" id="6622038">=</span>&nbsp;<span class="string" id="6622040">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB0zCCAX2gAwIBAgIJAI/M7BYjwB+uMA0GCSqGSIb3DQEBBQUAMEUxCzAJBgNV<br>
<span class="lineno"></span>BAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRlcm5ldCBX<br>
<span class="lineno">20</span>aWRnaXRzIFB0eSBMdGQwHhcNMTIwOTEyMjE1MjAyWhcNMTUwOTEyMjE1MjAyWjBF<br>
<span class="lineno"></span>MQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UECgwYSW50<br>
<span class="lineno"></span>ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBANLJ<br>
<span class="lineno"></span>hPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wok/4xIA+ui35/MmNa<br>
<span class="lineno"></span>rtNuC+BdZ1tMuVCPFZcCAwEAAaNQME4wHQYDVR0OBBYEFJvKs8RfJaXTH08W+SGv<br>
<span class="lineno">25</span>zQyKn0H8MB8GA1UdIwQYMBaAFJvKs8RfJaXTH08W+SGvzQyKn0H8MAwGA1UdEwQF<br>
<span class="lineno"></span>MAMBAf8wDQYJKoZIhvcNAQEFBQADQQBJlffJHybjDGxRMqaRmDhX0+6v02TUKZsW<br>
<span class="lineno"></span>r5QuVbpQhH6u+0UgcW0jp9QwpxoPTLTWGXEWBBBurxFwiCBhkQ+V<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="6622736">var</span>&nbsp;<span class="ident" id="6622740">rsaKeyPEM</span>&nbsp;<span class="op" id="6622750">=</span>&nbsp;<span class="string" id="6622752">`-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno">35</span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno"></span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">40</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6623253">//&nbsp;keyPEM&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;rsaKeyPEM,&nbsp;but&nbsp;declares&nbsp;itself&nbsp;as&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="6623317">//&nbsp;&#34;PRIVATE&nbsp;KEY&#34;,&nbsp;not&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;.&nbsp;&nbsp;http://golang.org/issue/4477</span><br>
<span class="lineno"></span><span class="keyword" id="6623388">var</span>&nbsp;<span class="ident" id="6623392">keyPEM</span>&nbsp;<span class="op" id="6623399">=</span>&nbsp;<span class="string" id="6623401">`-----BEGIN&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">45</span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno"></span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno">50</span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6623894">var</span>&nbsp;<span class="ident" id="6623898">ecdsaCertPEM</span>&nbsp;<span class="op" id="6623911">=</span>&nbsp;<span class="string" id="6623913">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/jCCAWICCQDscdUxw16XFDAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTI0MDQ4WhcNMTUxMTE0MTI0MDQ4WjBFMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTETMBEGA1UECBMKU29tZS1TdGF0ZTEhMB8GA1UEChMYSW50ZXJuZXQgV2lk<br>
<span class="lineno">60</span>Z2l0cyBQdHkgTHRkMIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQBY9+my9OoeSUR<br>
<span class="lineno"></span>lDQdV/x8LsOuLilthhiS1Tz4aGDHIPwC1mlvnf7fg5lecYpMCrLLhauAc1UJXcgl<br>
<span class="lineno"></span>01xoLuzgtAEAgv2P/jgytzRSpUYvgLBt1UA0leLYBy6mQQbrNEuqT3INapKIcUv8<br>
<span class="lineno"></span>XxYP0xMEUksLPq6Ca+CRSqTtrd/23uTnapkwCQYHKoZIzj0EAQOBigAwgYYCQXJo<br>
<span class="lineno"></span>A7Sl2nLVf+4Iu/tAX/IF4MavARKC4PPHK3zfuGfPR3oCCcsAoz3kAzOeijvd0iXb<br>
<span class="lineno">65</span>H5jBImIxPL4WxQNiBTexAkF8D1EtpYuWdlVQ80/h/f4pBcGiXPqX5h2PQSQY7hP1<br>
<span class="lineno"></span>+jwM1FGS4fREIOvlBYr/SzzQRtwrvrzGYxDEDbsC0ZGRnA==<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="6624670">var</span>&nbsp;<span class="ident" id="6624674">ecdsaKeyPEM</span>&nbsp;<span class="op" id="6624686">=</span>&nbsp;<span class="string" id="6624688">`-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBrsoKp0oqcv6/JovJJDoDVSGWdirrkgCWxrprGlzB9o0X8fV675X0<br>
<span class="lineno">75</span>NwuBenXFfeZvVcwluO7/Q9wkYoPd/t3jGImgBwYFK4EEACOhgYkDgYYABAFj36bL<br>
<span class="lineno"></span>06h5JRGUNB1X/Hwuw64uKW2GGJLVPPhoYMcg/ALWaW+d/t+DmV5xikwKssuFq4Bz<br>
<span class="lineno"></span>VQldyCXTXGgu7OC0AQCC/Y/+ODK3NFKlRi+AsG3VQDSV4tgHLqZBBus0S6pPcg1q<br>
<span class="lineno"></span>kohxS/xfFg/TEwRSSws+roJr4JFKpO2t3/be5OdqmQ==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">80</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6625128">var</span>&nbsp;<span class="ident" id="6625132">keyPairTests</span>&nbsp;<span class="op" id="6625145">=</span>&nbsp;<span class="op" id="6625147">[</span><span class="op" id="6625148">]</span><span class="keyword" id="6625149">struct</span>&nbsp;<span class="op" id="6625156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625159">algo</span>&nbsp;<span class="builtintype" id="6625164">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625172">cert</span>&nbsp;<span class="builtintype" id="6625177">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625185">key</span>&nbsp;&nbsp;<span class="builtintype" id="6625190">string</span><br>
<span class="lineno"></span><span class="op" id="6625197">}</span><span class="op" id="6625198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625201">{</span><span class="string" id="6625202">&#34;ECDSA&#34;</span><span class="op" id="6625209">,</span>&nbsp;<span class="ident" id="6625211">ecdsaCertPEM</span><span class="op" id="6625223">,</span>&nbsp;<span class="ident" id="6625225">ecdsaKeyPEM</span><span class="op" id="6625236">}</span><span class="op" id="6625237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625240">{</span><span class="string" id="6625241">&#34;RSA&#34;</span><span class="op" id="6625246">,</span>&nbsp;<span class="ident" id="6625248">rsaCertPEM</span><span class="op" id="6625258">,</span>&nbsp;<span class="ident" id="6625260">rsaKeyPEM</span><span class="op" id="6625269">}</span><span class="op" id="6625270">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625273">{</span><span class="string" id="6625274">&#34;RSA-untyped&#34;</span><span class="op" id="6625287">,</span>&nbsp;<span class="ident" id="6625289">rsaCertPEM</span><span class="op" id="6625299">,</span>&nbsp;<span class="ident" id="6625301">keyPEM</span><span class="op" id="6625307">}</span><span class="op" id="6625308">,</span>&nbsp;<span class="comment" id="6625310">//&nbsp;golang.org/issue/4477</span><br>
<span class="lineno">90</span><span class="op" id="6625335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6625338">func</span>&nbsp;<span class="ident" id="6625343">TestX509KeyPair</span><span class="op" id="6625358">(</span><span class="ident" id="6625359">t</span>&nbsp;<span class="op" id="6625361">*</span><span class="ident" id="6625362">testing</span><span class="op" id="6625369">.</span><span class="ident" id="6625370">T</span><span class="op" id="6625371">)</span>&nbsp;<span class="op" id="6625373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6625376">var</span>&nbsp;<span class="ident" id="6625380">pem</span>&nbsp;<span class="op" id="6625384">[</span><span class="op" id="6625385">]</span><span class="builtintype" id="6625386">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6625392">for</span>&nbsp;<span class="ident" id="6625396">_</span><span class="op" id="6625397">,</span>&nbsp;<span class="ident" id="6625399">test</span>&nbsp;<span class="op" id="6625404">:=</span>&nbsp;<span class="keyword" id="6625407">range</span>&nbsp;<span class="ident" id="6625413">keyPairTests</span>&nbsp;<span class="op" id="6625426">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625430">pem</span>&nbsp;<span class="op" id="6625434">=</span>&nbsp;<span class="op" id="6625436">[</span><span class="op" id="6625437">]</span><span class="builtintype" id="6625438">byte</span><span class="op" id="6625442">(</span><span class="ident" id="6625443">test</span><span class="op" id="6625447">.</span><span class="ident" id="6625448">cert</span>&nbsp;<span class="op" id="6625453">+</span>&nbsp;<span class="ident" id="6625455">test</span><span class="op" id="6625459">.</span><span class="ident" id="6625460">key</span><span class="op" id="6625463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6625467">if</span>&nbsp;<span class="ident" id="6625470">_</span><span class="op" id="6625471">,</span>&nbsp;<span class="ident" id="6625473">err</span>&nbsp;<span class="op" id="6625477">:=</span>&nbsp;<span class="ident" id="6625480">X509KeyPair</span><span class="op" id="6625491">(</span><span class="ident" id="6625492">pem</span><span class="op" id="6625495">,</span>&nbsp;<span class="ident" id="6625497">pem</span><span class="op" id="6625500">)</span><span class="op" id="6625501">;</span>&nbsp;<span class="ident" id="6625503">err</span>&nbsp;<span class="op" id="6625507">!=</span>&nbsp;<span class="builtintype" id="6625510">nil</span>&nbsp;<span class="op" id="6625514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625519">t</span><span class="op" id="6625520">.</span><span class="ident" id="6625521">Errorf</span><span class="op" id="6625527">(</span><span class="string" id="6625528">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;cert&nbsp;followed&nbsp;by&nbsp;%s&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="6625575">,</span>&nbsp;<span class="ident" id="6625577">test</span><span class="op" id="6625581">.</span><span class="ident" id="6625582">algo</span><span class="op" id="6625586">,</span>&nbsp;<span class="ident" id="6625588">test</span><span class="op" id="6625592">.</span><span class="ident" id="6625593">algo</span><span class="op" id="6625597">,</span>&nbsp;<span class="ident" id="6625599">err</span><span class="op" id="6625602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625610">pem</span>&nbsp;<span class="op" id="6625614">=</span>&nbsp;<span class="op" id="6625616">[</span><span class="op" id="6625617">]</span><span class="builtintype" id="6625618">byte</span><span class="op" id="6625622">(</span><span class="ident" id="6625623">test</span><span class="op" id="6625627">.</span><span class="ident" id="6625628">key</span>&nbsp;<span class="op" id="6625632">+</span>&nbsp;<span class="ident" id="6625634">test</span><span class="op" id="6625638">.</span><span class="ident" id="6625639">cert</span><span class="op" id="6625643">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6625647">if</span>&nbsp;<span class="ident" id="6625650">_</span><span class="op" id="6625651">,</span>&nbsp;<span class="ident" id="6625653">err</span>&nbsp;<span class="op" id="6625657">:=</span>&nbsp;<span class="ident" id="6625660">X509KeyPair</span><span class="op" id="6625671">(</span><span class="ident" id="6625672">pem</span><span class="op" id="6625675">,</span>&nbsp;<span class="ident" id="6625677">pem</span><span class="op" id="6625680">)</span><span class="op" id="6625681">;</span>&nbsp;<span class="ident" id="6625683">err</span>&nbsp;<span class="op" id="6625687">!=</span>&nbsp;<span class="builtintype" id="6625690">nil</span>&nbsp;<span class="op" id="6625694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625699">t</span><span class="op" id="6625700">.</span><span class="ident" id="6625701">Errorf</span><span class="op" id="6625707">(</span><span class="string" id="6625708">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;key&nbsp;followed&nbsp;by&nbsp;%s&nbsp;cert:&nbsp;%s&#34;</span><span class="op" id="6625755">,</span>&nbsp;<span class="ident" id="6625757">test</span><span class="op" id="6625761">.</span><span class="ident" id="6625762">algo</span><span class="op" id="6625766">,</span>&nbsp;<span class="ident" id="6625768">test</span><span class="op" id="6625772">.</span><span class="ident" id="6625773">algo</span><span class="op" id="6625777">,</span>&nbsp;<span class="ident" id="6625779">err</span><span class="op" id="6625782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625789">}</span><br>
<span class="lineno"></span><span class="op" id="6625791">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6625794">func</span>&nbsp;<span class="ident" id="6625799">TestX509MixedKeyPair</span><span class="op" id="6625819">(</span><span class="ident" id="6625820">t</span>&nbsp;<span class="op" id="6625822">*</span><span class="ident" id="6625823">testing</span><span class="op" id="6625830">.</span><span class="ident" id="6625831">T</span><span class="op" id="6625832">)</span>&nbsp;<span class="op" id="6625834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6625837">if</span>&nbsp;<span class="ident" id="6625840">_</span><span class="op" id="6625841">,</span>&nbsp;<span class="ident" id="6625843">err</span>&nbsp;<span class="op" id="6625847">:=</span>&nbsp;<span class="ident" id="6625850">X509KeyPair</span><span class="op" id="6625861">(</span><span class="op" id="6625862">[</span><span class="op" id="6625863">]</span><span class="builtintype" id="6625864">byte</span><span class="op" id="6625868">(</span><span class="ident" id="6625869">rsaCertPEM</span><span class="op" id="6625879">)</span><span class="op" id="6625880">,</span>&nbsp;<span class="op" id="6625882">[</span><span class="op" id="6625883">]</span><span class="builtintype" id="6625884">byte</span><span class="op" id="6625888">(</span><span class="ident" id="6625889">ecdsaKeyPEM</span><span class="op" id="6625900">)</span><span class="op" id="6625901">)</span><span class="op" id="6625902">;</span>&nbsp;<span class="ident" id="6625904">err</span>&nbsp;<span class="op" id="6625908">==</span>&nbsp;<span class="builtintype" id="6625911">nil</span>&nbsp;<span class="op" id="6625915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6625919">t</span><span class="op" id="6625920">.</span><span class="ident" id="6625921">Error</span><span class="op" id="6625926">(</span><span class="string" id="6625927">&#34;Load&nbsp;of&nbsp;RSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;ECDSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="6625985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6625988">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6625991">if</span>&nbsp;<span class="ident" id="6625994">_</span><span class="op" id="6625995">,</span>&nbsp;<span class="ident" id="6625997">err</span>&nbsp;<span class="op" id="6626001">:=</span>&nbsp;<span class="ident" id="6626004">X509KeyPair</span><span class="op" id="6626015">(</span><span class="op" id="6626016">[</span><span class="op" id="6626017">]</span><span class="builtintype" id="6626018">byte</span><span class="op" id="6626022">(</span><span class="ident" id="6626023">ecdsaCertPEM</span><span class="op" id="6626035">)</span><span class="op" id="6626036">,</span>&nbsp;<span class="op" id="6626038">[</span><span class="op" id="6626039">]</span><span class="builtintype" id="6626040">byte</span><span class="op" id="6626044">(</span><span class="ident" id="6626045">rsaKeyPEM</span><span class="op" id="6626054">)</span><span class="op" id="6626055">)</span><span class="op" id="6626056">;</span>&nbsp;<span class="ident" id="6626058">err</span>&nbsp;<span class="op" id="6626062">==</span>&nbsp;<span class="builtintype" id="6626065">nil</span>&nbsp;<span class="op" id="6626069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626073">t</span><span class="op" id="6626074">.</span><span class="ident" id="6626075">Error</span><span class="op" id="6626080">(</span><span class="string" id="6626081">&#34;Load&nbsp;of&nbsp;ECDSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;RSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="6626139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626142">}</span><br>
<span class="lineno"></span><span class="op" id="6626144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="6626147">func</span>&nbsp;<span class="ident" id="6626152">newLocalListener</span><span class="op" id="6626168">(</span><span class="ident" id="6626169">t</span>&nbsp;<span class="op" id="6626171">*</span><span class="ident" id="6626172">testing</span><span class="op" id="6626179">.</span><span class="ident" id="6626180">T</span><span class="op" id="6626181">)</span>&nbsp;<span class="ident" id="6626183">net</span><span class="op" id="6626186">.</span><span class="ident" id="6626187">Listener</span>&nbsp;<span class="op" id="6626196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626199">ln</span><span class="op" id="6626201">,</span>&nbsp;<span class="ident" id="6626203">err</span>&nbsp;<span class="op" id="6626207">:=</span>&nbsp;<span class="ident" id="6626210">net</span><span class="op" id="6626213">.</span><span class="ident" id="6626214">Listen</span><span class="op" id="6626220">(</span><span class="string" id="6626221">&#34;tcp&#34;</span><span class="op" id="6626226">,</span>&nbsp;<span class="string" id="6626228">&#34;127.0.0.1:0&#34;</span><span class="op" id="6626241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626244">if</span>&nbsp;<span class="ident" id="6626247">err</span>&nbsp;<span class="op" id="6626251">!=</span>&nbsp;<span class="builtintype" id="6626254">nil</span>&nbsp;<span class="op" id="6626258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626262">ln</span><span class="op" id="6626264">,</span>&nbsp;<span class="ident" id="6626266">err</span>&nbsp;<span class="op" id="6626270">=</span>&nbsp;<span class="ident" id="6626272">net</span><span class="op" id="6626275">.</span><span class="ident" id="6626276">Listen</span><span class="op" id="6626282">(</span><span class="string" id="6626283">&#34;tcp6&#34;</span><span class="op" id="6626289">,</span>&nbsp;<span class="string" id="6626291">&#34;[::1]:0&#34;</span><span class="op" id="6626300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626303">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626306">if</span>&nbsp;<span class="ident" id="6626309">err</span>&nbsp;<span class="op" id="6626313">!=</span>&nbsp;<span class="builtintype" id="6626316">nil</span>&nbsp;<span class="op" id="6626320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626324">t</span><span class="op" id="6626325">.</span><span class="ident" id="6626326">Fatal</span><span class="op" id="6626331">(</span><span class="ident" id="6626332">err</span><span class="op" id="6626335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626341">return</span>&nbsp;<span class="ident" id="6626348">ln</span><br>
<span class="lineno"></span><span class="op" id="6626351">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="6626354">func</span>&nbsp;<span class="ident" id="6626359">TestDialTimeout</span><span class="op" id="6626374">(</span><span class="ident" id="6626375">t</span>&nbsp;<span class="op" id="6626377">*</span><span class="ident" id="6626378">testing</span><span class="op" id="6626385">.</span><span class="ident" id="6626386">T</span><span class="op" id="6626387">)</span>&nbsp;<span class="op" id="6626389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626392">if</span>&nbsp;<span class="ident" id="6626395">testing</span><span class="op" id="6626402">.</span><span class="ident" id="6626403">Short</span><span class="op" id="6626408">(</span><span class="op" id="6626409">)</span>&nbsp;<span class="op" id="6626411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626415">t</span><span class="op" id="6626416">.</span><span class="ident" id="6626417">Skip</span><span class="op" id="6626421">(</span><span class="string" id="6626422">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6626446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626449">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626452">listener</span>&nbsp;<span class="op" id="6626461">:=</span>&nbsp;<span class="ident" id="6626464">newLocalListener</span><span class="op" id="6626480">(</span><span class="ident" id="6626481">t</span><span class="op" id="6626482">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626486">addr</span>&nbsp;<span class="op" id="6626491">:=</span>&nbsp;<span class="ident" id="6626494">listener</span><span class="op" id="6626502">.</span><span class="ident" id="6626503">Addr</span><span class="op" id="6626507">(</span><span class="op" id="6626508">)</span><span class="op" id="6626509">.</span><span class="ident" id="6626510">String</span><span class="op" id="6626516">(</span><span class="op" id="6626517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626520">defer</span>&nbsp;<span class="ident" id="6626526">listener</span><span class="op" id="6626534">.</span><span class="ident" id="6626535">Close</span><span class="op" id="6626540">(</span><span class="op" id="6626541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626545">complete</span>&nbsp;<span class="op" id="6626554">:=</span>&nbsp;<span class="builtinfunc" id="6626557">make</span><span class="op" id="6626561">(</span><span class="keyword" id="6626562">chan</span>&nbsp;<span class="builtintype" id="6626567">bool</span><span class="op" id="6626571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626574">defer</span>&nbsp;<span class="builtinfunc" id="6626580">close</span><span class="op" id="6626585">(</span><span class="ident" id="6626586">complete</span><span class="op" id="6626594">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626598">go</span>&nbsp;<span class="keyword" id="6626601">func</span><span class="op" id="6626605">(</span><span class="op" id="6626606">)</span>&nbsp;<span class="op" id="6626608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626612">conn</span><span class="op" id="6626616">,</span>&nbsp;<span class="ident" id="6626618">err</span>&nbsp;<span class="op" id="6626622">:=</span>&nbsp;<span class="ident" id="6626625">listener</span><span class="op" id="6626633">.</span><span class="ident" id="6626634">Accept</span><span class="op" id="6626640">(</span><span class="op" id="6626641">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626645">if</span>&nbsp;<span class="ident" id="6626648">err</span>&nbsp;<span class="op" id="6626652">!=</span>&nbsp;<span class="builtintype" id="6626655">nil</span>&nbsp;<span class="op" id="6626659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626664">t</span><span class="op" id="6626665">.</span><span class="ident" id="6626666">Error</span><span class="op" id="6626671">(</span><span class="ident" id="6626672">err</span><span class="op" id="6626675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626680">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626693">&lt;-</span><span class="ident" id="6626695">complete</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626706">conn</span><span class="op" id="6626710">.</span><span class="ident" id="6626711">Close</span><span class="op" id="6626716">(</span><span class="op" id="6626717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626720">}</span><span class="op" id="6626721">(</span><span class="op" id="6626722">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626726">dialer</span>&nbsp;<span class="op" id="6626733">:=</span>&nbsp;<span class="op" id="6626736">&amp;</span><span class="ident" id="6626737">net</span><span class="op" id="6626740">.</span><span class="ident" id="6626741">Dialer</span><span class="op" id="6626747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626751">Timeout</span><span class="op" id="6626758">:</span>&nbsp;<span class="num" id="6626760">10</span>&nbsp;<span class="op" id="6626763">*</span>&nbsp;<span class="ident" id="6626765">time</span><span class="op" id="6626769">.</span><span class="ident" id="6626770">Millisecond</span><span class="op" id="6626781">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626788">var</span>&nbsp;<span class="ident" id="6626792">err</span>&nbsp;<span class="builtintype" id="6626796">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626803">if</span>&nbsp;<span class="ident" id="6626806">_</span><span class="op" id="6626807">,</span>&nbsp;<span class="ident" id="6626809">err</span>&nbsp;<span class="op" id="6626813">=</span>&nbsp;<span class="ident" id="6626815">DialWithDialer</span><span class="op" id="6626829">(</span><span class="ident" id="6626830">dialer</span><span class="op" id="6626836">,</span>&nbsp;<span class="string" id="6626838">&#34;tcp&#34;</span><span class="op" id="6626843">,</span>&nbsp;<span class="ident" id="6626845">addr</span><span class="op" id="6626849">,</span>&nbsp;<span class="builtintype" id="6626851">nil</span><span class="op" id="6626854">)</span><span class="op" id="6626855">;</span>&nbsp;<span class="ident" id="6626857">err</span>&nbsp;<span class="op" id="6626861">==</span>&nbsp;<span class="builtintype" id="6626864">nil</span>&nbsp;<span class="op" id="6626868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626872">t</span><span class="op" id="6626873">.</span><span class="ident" id="6626874">Fatal</span><span class="op" id="6626879">(</span><span class="string" id="6626880">&#34;DialWithTimeout&nbsp;completed&nbsp;successfully&#34;</span><span class="op" id="6626920">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6626923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6626927">if</span>&nbsp;<span class="op" id="6626930">!</span><span class="ident" id="6626931">strings</span><span class="op" id="6626938">.</span><span class="ident" id="6626939">Contains</span><span class="op" id="6626947">(</span><span class="ident" id="6626948">err</span><span class="op" id="6626951">.</span><span class="ident" id="6626952">Error</span><span class="op" id="6626957">(</span><span class="op" id="6626958">)</span><span class="op" id="6626959">,</span>&nbsp;<span class="string" id="6626961">&#34;timed&nbsp;out&#34;</span><span class="op" id="6626972">)</span>&nbsp;<span class="op" id="6626974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6626978">t</span><span class="op" id="6626979">.</span><span class="ident" id="6626980">Errorf</span><span class="op" id="6626986">(</span><span class="string" id="6626987">&#34;resulting&nbsp;error&nbsp;not&nbsp;a&nbsp;timeout:&nbsp;%s&#34;</span><span class="op" id="6627022">,</span>&nbsp;<span class="ident" id="6627024">err</span><span class="op" id="6627027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6627030">}</span><br>
<span class="lineno">160</span><span class="op" id="6627032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6627035">//&nbsp;tests&nbsp;that&nbsp;Conn.Read&nbsp;returns&nbsp;(non-zero,&nbsp;io.EOF)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6627097">//&nbsp;(non-zero,&nbsp;nil)&nbsp;when&nbsp;a&nbsp;Close&nbsp;(alertCloseNotify)&nbsp;is&nbsp;sitting&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="6627165">//&nbsp;behind&nbsp;the&nbsp;application&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">165</span><span class="keyword" id="6627211">func</span>&nbsp;<span class="ident" id="6627216">TestConnReadNonzeroAndEOF</span><span class="op" id="6627241">(</span><span class="ident" id="6627242">t</span>&nbsp;<span class="op" id="6627244">*</span><span class="ident" id="6627245">testing</span><span class="op" id="6627252">.</span><span class="ident" id="6627253">T</span><span class="op" id="6627254">)</span>&nbsp;<span class="op" id="6627256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6627259">//&nbsp;This&nbsp;test&nbsp;is&nbsp;racy:&nbsp;it&nbsp;assumes&nbsp;that&nbsp;after&nbsp;a&nbsp;write&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6627317">//&nbsp;localhost&nbsp;TCP&nbsp;connection,&nbsp;the&nbsp;peer&nbsp;TCP&nbsp;connection&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6627375">//&nbsp;immediately&nbsp;read&nbsp;it.&nbsp;&nbsp;Because&nbsp;it&#39;s&nbsp;racy,&nbsp;we&nbsp;skip&nbsp;this&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6627438">//&nbsp;in&nbsp;short&nbsp;mode,&nbsp;and&nbsp;then&nbsp;retry&nbsp;it&nbsp;several&nbsp;times&nbsp;with&nbsp;an</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6627497">//&nbsp;increasing&nbsp;sleep&nbsp;in&nbsp;between&nbsp;our&nbsp;final&nbsp;write&nbsp;(via&nbsp;srv.Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6627560">//&nbsp;below)&nbsp;and&nbsp;the&nbsp;following&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627595">if</span>&nbsp;<span class="ident" id="6627598">testing</span><span class="op" id="6627605">.</span><span class="ident" id="6627606">Short</span><span class="op" id="6627611">(</span><span class="op" id="6627612">)</span>&nbsp;<span class="op" id="6627614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627618">t</span><span class="op" id="6627619">.</span><span class="ident" id="6627620">Skip</span><span class="op" id="6627624">(</span><span class="string" id="6627625">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6627649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6627652">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627655">var</span>&nbsp;<span class="ident" id="6627659">err</span>&nbsp;<span class="builtintype" id="6627663">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627670">for</span>&nbsp;<span class="ident" id="6627674">delay</span>&nbsp;<span class="op" id="6627680">:=</span>&nbsp;<span class="ident" id="6627683">time</span><span class="op" id="6627687">.</span><span class="ident" id="6627688">Millisecond</span><span class="op" id="6627699">;</span>&nbsp;<span class="ident" id="6627701">delay</span>&nbsp;<span class="op" id="6627707">&lt;=</span>&nbsp;<span class="num" id="6627710">64</span><span class="op" id="6627712">*</span><span class="ident" id="6627713">time</span><span class="op" id="6627717">.</span><span class="ident" id="6627718">Millisecond</span><span class="op" id="6627729">;</span>&nbsp;<span class="ident" id="6627731">delay</span>&nbsp;<span class="op" id="6627737">*=</span>&nbsp;<span class="num" id="6627740">2</span>&nbsp;<span class="op" id="6627742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627746">if</span>&nbsp;<span class="ident" id="6627749">err</span>&nbsp;<span class="op" id="6627753">=</span>&nbsp;<span class="ident" id="6627755">testConnReadNonzeroAndEOF</span><span class="op" id="6627780">(</span><span class="ident" id="6627781">t</span><span class="op" id="6627782">,</span>&nbsp;<span class="ident" id="6627784">delay</span><span class="op" id="6627789">)</span><span class="op" id="6627790">;</span>&nbsp;<span class="ident" id="6627792">err</span>&nbsp;<span class="op" id="6627796">==</span>&nbsp;<span class="builtintype" id="6627799">nil</span>&nbsp;<span class="op" id="6627803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627808">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6627817">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6627820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627823">t</span><span class="op" id="6627824">.</span><span class="ident" id="6627825">Error</span><span class="op" id="6627830">(</span><span class="ident" id="6627831">err</span><span class="op" id="6627834">)</span><br>
<span class="lineno"></span><span class="op" id="6627836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6627839">func</span>&nbsp;<span class="ident" id="6627844">testConnReadNonzeroAndEOF</span><span class="op" id="6627869">(</span><span class="ident" id="6627870">t</span>&nbsp;<span class="op" id="6627872">*</span><span class="ident" id="6627873">testing</span><span class="op" id="6627880">.</span><span class="ident" id="6627881">T</span><span class="op" id="6627882">,</span>&nbsp;<span class="ident" id="6627884">delay</span>&nbsp;<span class="ident" id="6627890">time</span><span class="op" id="6627894">.</span><span class="ident" id="6627895">Duration</span><span class="op" id="6627903">)</span>&nbsp;<span class="builtintype" id="6627905">error</span>&nbsp;<span class="op" id="6627911">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627914">ln</span>&nbsp;<span class="op" id="6627917">:=</span>&nbsp;<span class="ident" id="6627920">newLocalListener</span><span class="op" id="6627936">(</span><span class="ident" id="6627937">t</span><span class="op" id="6627938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627941">defer</span>&nbsp;<span class="ident" id="6627947">ln</span><span class="op" id="6627949">.</span><span class="ident" id="6627950">Close</span><span class="op" id="6627955">(</span><span class="op" id="6627956">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6627960">srvCh</span>&nbsp;<span class="op" id="6627966">:=</span>&nbsp;<span class="builtinfunc" id="6627969">make</span><span class="op" id="6627973">(</span><span class="keyword" id="6627974">chan</span>&nbsp;<span class="op" id="6627979">*</span><span class="ident" id="6627980">Conn</span><span class="op" id="6627984">,</span>&nbsp;<span class="num" id="6627986">1</span><span class="op" id="6627987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6627990">var</span>&nbsp;<span class="ident" id="6627994">serr</span>&nbsp;<span class="builtintype" id="6627999">error</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628006">go</span>&nbsp;<span class="keyword" id="6628009">func</span><span class="op" id="6628013">(</span><span class="op" id="6628014">)</span>&nbsp;<span class="op" id="6628016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628020">sconn</span><span class="op" id="6628025">,</span>&nbsp;<span class="ident" id="6628027">err</span>&nbsp;<span class="op" id="6628031">:=</span>&nbsp;<span class="ident" id="6628034">ln</span><span class="op" id="6628036">.</span><span class="ident" id="6628037">Accept</span><span class="op" id="6628043">(</span><span class="op" id="6628044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628048">if</span>&nbsp;<span class="ident" id="6628051">err</span>&nbsp;<span class="op" id="6628055">!=</span>&nbsp;<span class="builtintype" id="6628058">nil</span>&nbsp;<span class="op" id="6628062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628067">serr</span>&nbsp;<span class="op" id="6628072">=</span>&nbsp;<span class="ident" id="6628074">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628081">srvCh</span>&nbsp;<span class="op" id="6628087">&lt;-</span>&nbsp;<span class="builtintype" id="6628090">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628097">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628110">serverConfig</span>&nbsp;<span class="op" id="6628123">:=</span>&nbsp;<span class="op" id="6628126">*</span><span class="ident" id="6628127">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628140">srv</span>&nbsp;<span class="op" id="6628144">:=</span>&nbsp;<span class="ident" id="6628147">Server</span><span class="op" id="6628153">(</span><span class="ident" id="6628154">sconn</span><span class="op" id="6628159">,</span>&nbsp;<span class="op" id="6628161">&amp;</span><span class="ident" id="6628162">serverConfig</span><span class="op" id="6628174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628178">if</span>&nbsp;<span class="ident" id="6628181">err</span>&nbsp;<span class="op" id="6628185">:=</span>&nbsp;<span class="ident" id="6628188">srv</span><span class="op" id="6628191">.</span><span class="ident" id="6628192">Handshake</span><span class="op" id="6628201">(</span><span class="op" id="6628202">)</span><span class="op" id="6628203">;</span>&nbsp;<span class="ident" id="6628205">err</span>&nbsp;<span class="op" id="6628209">!=</span>&nbsp;<span class="builtintype" id="6628212">nil</span>&nbsp;<span class="op" id="6628216">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628221">serr</span>&nbsp;<span class="op" id="6628226">=</span>&nbsp;<span class="ident" id="6628228">fmt</span><span class="op" id="6628231">.</span><span class="ident" id="6628232">Errorf</span><span class="op" id="6628238">(</span><span class="string" id="6628239">&#34;handshake:&nbsp;%v&#34;</span><span class="op" id="6628254">,</span>&nbsp;<span class="ident" id="6628256">err</span><span class="op" id="6628259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628264">srvCh</span>&nbsp;<span class="op" id="6628270">&lt;-</span>&nbsp;<span class="builtintype" id="6628273">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628280">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628293">srvCh</span>&nbsp;<span class="op" id="6628299">&lt;-</span>&nbsp;<span class="ident" id="6628302">srv</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628307">}</span><span class="op" id="6628308">(</span><span class="op" id="6628309">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628313">clientConfig</span>&nbsp;<span class="op" id="6628326">:=</span>&nbsp;<span class="op" id="6628329">*</span><span class="ident" id="6628330">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628342">conn</span><span class="op" id="6628346">,</span>&nbsp;<span class="ident" id="6628348">err</span>&nbsp;<span class="op" id="6628352">:=</span>&nbsp;<span class="ident" id="6628355">Dial</span><span class="op" id="6628359">(</span><span class="string" id="6628360">&#34;tcp&#34;</span><span class="op" id="6628365">,</span>&nbsp;<span class="ident" id="6628367">ln</span><span class="op" id="6628369">.</span><span class="ident" id="6628370">Addr</span><span class="op" id="6628374">(</span><span class="op" id="6628375">)</span><span class="op" id="6628376">.</span><span class="ident" id="6628377">String</span><span class="op" id="6628383">(</span><span class="op" id="6628384">)</span><span class="op" id="6628385">,</span>&nbsp;<span class="op" id="6628387">&amp;</span><span class="ident" id="6628388">clientConfig</span><span class="op" id="6628400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628403">if</span>&nbsp;<span class="ident" id="6628406">err</span>&nbsp;<span class="op" id="6628410">!=</span>&nbsp;<span class="builtintype" id="6628413">nil</span>&nbsp;<span class="op" id="6628417">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628421">t</span><span class="op" id="6628422">.</span><span class="ident" id="6628423">Fatal</span><span class="op" id="6628428">(</span><span class="ident" id="6628429">err</span><span class="op" id="6628432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628438">defer</span>&nbsp;<span class="ident" id="6628444">conn</span><span class="op" id="6628448">.</span><span class="ident" id="6628449">Close</span><span class="op" id="6628454">(</span><span class="op" id="6628455">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628459">srv</span>&nbsp;<span class="op" id="6628463">:=</span>&nbsp;<span class="op" id="6628466">&lt;-</span><span class="ident" id="6628468">srvCh</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628475">if</span>&nbsp;<span class="ident" id="6628478">srv</span>&nbsp;<span class="op" id="6628482">==</span>&nbsp;<span class="builtintype" id="6628485">nil</span>&nbsp;<span class="op" id="6628489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628493">return</span>&nbsp;<span class="ident" id="6628500">serr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628510">buf</span>&nbsp;<span class="op" id="6628514">:=</span>&nbsp;<span class="builtinfunc" id="6628517">make</span><span class="op" id="6628521">(</span><span class="op" id="6628522">[</span><span class="op" id="6628523">]</span><span class="builtintype" id="6628524">byte</span><span class="op" id="6628528">,</span>&nbsp;<span class="num" id="6628530">6</span><span class="op" id="6628531">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628535">srv</span><span class="op" id="6628538">.</span><span class="ident" id="6628539">Write</span><span class="op" id="6628544">(</span><span class="op" id="6628545">[</span><span class="op" id="6628546">]</span><span class="builtintype" id="6628547">byte</span><span class="op" id="6628551">(</span><span class="string" id="6628552">&#34;foobar&#34;</span><span class="op" id="6628560">)</span><span class="op" id="6628561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628564">n</span><span class="op" id="6628565">,</span>&nbsp;<span class="ident" id="6628567">err</span>&nbsp;<span class="op" id="6628571">:=</span>&nbsp;<span class="ident" id="6628574">conn</span><span class="op" id="6628578">.</span><span class="ident" id="6628579">Read</span><span class="op" id="6628583">(</span><span class="ident" id="6628584">buf</span><span class="op" id="6628587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628590">if</span>&nbsp;<span class="ident" id="6628593">n</span>&nbsp;<span class="op" id="6628595">!=</span>&nbsp;<span class="num" id="6628598">6</span>&nbsp;<span class="op" id="6628600">||</span>&nbsp;<span class="ident" id="6628603">err</span>&nbsp;<span class="op" id="6628607">!=</span>&nbsp;<span class="builtintype" id="6628610">nil</span>&nbsp;<span class="op" id="6628614">||</span>&nbsp;<span class="builtintype" id="6628617">string</span><span class="op" id="6628623">(</span><span class="ident" id="6628624">buf</span><span class="op" id="6628627">)</span>&nbsp;<span class="op" id="6628629">!=</span>&nbsp;<span class="string" id="6628632">&#34;foobar&#34;</span>&nbsp;<span class="op" id="6628641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628645">return</span>&nbsp;<span class="ident" id="6628652">fmt</span><span class="op" id="6628655">.</span><span class="ident" id="6628656">Errorf</span><span class="op" id="6628662">(</span><span class="string" id="6628663">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;data&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;nil,&nbsp;foobar&#34;</span><span class="op" id="6628708">,</span>&nbsp;<span class="ident" id="6628710">n</span><span class="op" id="6628711">,</span>&nbsp;<span class="ident" id="6628713">err</span><span class="op" id="6628716">,</span>&nbsp;<span class="ident" id="6628718">buf</span><span class="op" id="6628721">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628728">srv</span><span class="op" id="6628731">.</span><span class="ident" id="6628732">Write</span><span class="op" id="6628737">(</span><span class="op" id="6628738">[</span><span class="op" id="6628739">]</span><span class="builtintype" id="6628740">byte</span><span class="op" id="6628744">(</span><span class="string" id="6628745">&#34;abcdef&#34;</span><span class="op" id="6628753">)</span><span class="op" id="6628754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628757">srv</span><span class="op" id="6628760">.</span><span class="ident" id="6628761">Close</span><span class="op" id="6628766">(</span><span class="op" id="6628767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628770">time</span><span class="op" id="6628774">.</span><span class="ident" id="6628775">Sleep</span><span class="op" id="6628780">(</span><span class="ident" id="6628781">delay</span><span class="op" id="6628786">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6628789">n</span><span class="op" id="6628790">,</span>&nbsp;<span class="ident" id="6628792">err</span>&nbsp;<span class="op" id="6628796">=</span>&nbsp;<span class="ident" id="6628798">conn</span><span class="op" id="6628802">.</span><span class="ident" id="6628803">Read</span><span class="op" id="6628807">(</span><span class="ident" id="6628808">buf</span><span class="op" id="6628811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628814">if</span>&nbsp;<span class="ident" id="6628817">n</span>&nbsp;<span class="op" id="6628819">!=</span>&nbsp;<span class="num" id="6628822">6</span>&nbsp;<span class="op" id="6628824">||</span>&nbsp;<span class="builtintype" id="6628827">string</span><span class="op" id="6628833">(</span><span class="ident" id="6628834">buf</span><span class="op" id="6628837">)</span>&nbsp;<span class="op" id="6628839">!=</span>&nbsp;<span class="string" id="6628842">&#34;abcdef&#34;</span>&nbsp;<span class="op" id="6628851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628855">return</span>&nbsp;<span class="ident" id="6628862">fmt</span><span class="op" id="6628865">.</span><span class="ident" id="6628866">Errorf</span><span class="op" id="6628872">(</span><span class="string" id="6628873">&#34;Read&nbsp;=&nbsp;%d,&nbsp;buf=&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;abcdef&#34;</span><span class="op" id="6628909">,</span>&nbsp;<span class="ident" id="6628911">n</span><span class="op" id="6628912">,</span>&nbsp;<span class="ident" id="6628914">buf</span><span class="op" id="6628917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6628920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628923">if</span>&nbsp;<span class="ident" id="6628926">err</span>&nbsp;<span class="op" id="6628930">!=</span>&nbsp;<span class="ident" id="6628933">io</span><span class="op" id="6628935">.</span><span class="ident" id="6628936">EOF</span>&nbsp;<span class="op" id="6628940">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6628944">return</span>&nbsp;<span class="ident" id="6628951">fmt</span><span class="op" id="6628954">.</span><span class="ident" id="6628955">Errorf</span><span class="op" id="6628961">(</span><span class="string" id="6628962">&#34;Second&nbsp;Read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="6628999">,</span>&nbsp;<span class="ident" id="6629001">err</span><span class="op" id="6629004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629010">return</span>&nbsp;<span class="builtintype" id="6629017">nil</span><br>
<span class="lineno"></span><span class="op" id="6629021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="6629024">func</span>&nbsp;<span class="ident" id="6629029">TestTLSUniqueMatches</span><span class="op" id="6629049">(</span><span class="ident" id="6629050">t</span>&nbsp;<span class="op" id="6629052">*</span><span class="ident" id="6629053">testing</span><span class="op" id="6629060">.</span><span class="ident" id="6629061">T</span><span class="op" id="6629062">)</span>&nbsp;<span class="op" id="6629064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629067">ln</span>&nbsp;<span class="op" id="6629070">:=</span>&nbsp;<span class="ident" id="6629073">newLocalListener</span><span class="op" id="6629089">(</span><span class="ident" id="6629090">t</span><span class="op" id="6629091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629094">defer</span>&nbsp;<span class="ident" id="6629100">ln</span><span class="op" id="6629102">.</span><span class="ident" id="6629103">Close</span><span class="op" id="6629108">(</span><span class="op" id="6629109">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629113">serverTLSUniques</span>&nbsp;<span class="op" id="6629130">:=</span>&nbsp;<span class="builtinfunc" id="6629133">make</span><span class="op" id="6629137">(</span><span class="keyword" id="6629138">chan</span>&nbsp;<span class="op" id="6629143">[</span><span class="op" id="6629144">]</span><span class="builtintype" id="6629145">byte</span><span class="op" id="6629149">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629152">go</span>&nbsp;<span class="keyword" id="6629155">func</span><span class="op" id="6629159">(</span><span class="op" id="6629160">)</span>&nbsp;<span class="op" id="6629162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629166">for</span>&nbsp;<span class="ident" id="6629170">i</span>&nbsp;<span class="op" id="6629172">:=</span>&nbsp;<span class="num" id="6629175">0</span><span class="op" id="6629176">;</span>&nbsp;<span class="ident" id="6629178">i</span>&nbsp;<span class="op" id="6629180">&lt;</span>&nbsp;<span class="num" id="6629182">2</span><span class="op" id="6629183">;</span>&nbsp;<span class="ident" id="6629185">i</span><span class="op" id="6629186">++</span>&nbsp;<span class="op" id="6629189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629194">sconn</span><span class="op" id="6629199">,</span>&nbsp;<span class="ident" id="6629201">err</span>&nbsp;<span class="op" id="6629205">:=</span>&nbsp;<span class="ident" id="6629208">ln</span><span class="op" id="6629210">.</span><span class="ident" id="6629211">Accept</span><span class="op" id="6629217">(</span><span class="op" id="6629218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629223">if</span>&nbsp;<span class="ident" id="6629226">err</span>&nbsp;<span class="op" id="6629230">!=</span>&nbsp;<span class="builtintype" id="6629233">nil</span>&nbsp;<span class="op" id="6629237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629243">t</span><span class="op" id="6629244">.</span><span class="ident" id="6629245">Fatal</span><span class="op" id="6629250">(</span><span class="ident" id="6629251">err</span><span class="op" id="6629254">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629264">serverConfig</span>&nbsp;<span class="op" id="6629277">:=</span>&nbsp;<span class="op" id="6629280">*</span><span class="ident" id="6629281">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629295">srv</span>&nbsp;<span class="op" id="6629299">:=</span>&nbsp;<span class="ident" id="6629302">Server</span><span class="op" id="6629308">(</span><span class="ident" id="6629309">sconn</span><span class="op" id="6629314">,</span>&nbsp;<span class="op" id="6629316">&amp;</span><span class="ident" id="6629317">serverConfig</span><span class="op" id="6629329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629334">if</span>&nbsp;<span class="ident" id="6629337">err</span>&nbsp;<span class="op" id="6629341">:=</span>&nbsp;<span class="ident" id="6629344">srv</span><span class="op" id="6629347">.</span><span class="ident" id="6629348">Handshake</span><span class="op" id="6629357">(</span><span class="op" id="6629358">)</span><span class="op" id="6629359">;</span>&nbsp;<span class="ident" id="6629361">err</span>&nbsp;<span class="op" id="6629365">!=</span>&nbsp;<span class="builtintype" id="6629368">nil</span>&nbsp;<span class="op" id="6629372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629378">t</span><span class="op" id="6629379">.</span><span class="ident" id="6629380">Fatal</span><span class="op" id="6629385">(</span><span class="ident" id="6629386">err</span><span class="op" id="6629389">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629399">serverTLSUniques</span>&nbsp;<span class="op" id="6629416">&lt;-</span>&nbsp;<span class="ident" id="6629419">srv</span><span class="op" id="6629422">.</span><span class="ident" id="6629423">ConnectionState</span><span class="op" id="6629438">(</span><span class="op" id="6629439">)</span><span class="op" id="6629440">.</span><span class="ident" id="6629441">TLSUnique</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629456">}</span><span class="op" id="6629457">(</span><span class="op" id="6629458">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629462">clientConfig</span>&nbsp;<span class="op" id="6629475">:=</span>&nbsp;<span class="op" id="6629478">*</span><span class="ident" id="6629479">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629491">clientConfig</span><span class="op" id="6629503">.</span><span class="ident" id="6629504">ClientSessionCache</span>&nbsp;<span class="op" id="6629523">=</span>&nbsp;<span class="ident" id="6629525">NewLRUClientSessionCache</span><span class="op" id="6629549">(</span><span class="num" id="6629550">1</span><span class="op" id="6629551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629554">conn</span><span class="op" id="6629558">,</span>&nbsp;<span class="ident" id="6629560">err</span>&nbsp;<span class="op" id="6629564">:=</span>&nbsp;<span class="ident" id="6629567">Dial</span><span class="op" id="6629571">(</span><span class="string" id="6629572">&#34;tcp&#34;</span><span class="op" id="6629577">,</span>&nbsp;<span class="ident" id="6629579">ln</span><span class="op" id="6629581">.</span><span class="ident" id="6629582">Addr</span><span class="op" id="6629586">(</span><span class="op" id="6629587">)</span><span class="op" id="6629588">.</span><span class="ident" id="6629589">String</span><span class="op" id="6629595">(</span><span class="op" id="6629596">)</span><span class="op" id="6629597">,</span>&nbsp;<span class="op" id="6629599">&amp;</span><span class="ident" id="6629600">clientConfig</span><span class="op" id="6629612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629615">if</span>&nbsp;<span class="ident" id="6629618">err</span>&nbsp;<span class="op" id="6629622">!=</span>&nbsp;<span class="builtintype" id="6629625">nil</span>&nbsp;<span class="op" id="6629629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629633">t</span><span class="op" id="6629634">.</span><span class="ident" id="6629635">Fatal</span><span class="op" id="6629640">(</span><span class="ident" id="6629641">err</span><span class="op" id="6629644">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629650">if</span>&nbsp;<span class="op" id="6629653">!</span><span class="ident" id="6629654">bytes</span><span class="op" id="6629659">.</span><span class="ident" id="6629660">Equal</span><span class="op" id="6629665">(</span><span class="ident" id="6629666">conn</span><span class="op" id="6629670">.</span><span class="ident" id="6629671">ConnectionState</span><span class="op" id="6629686">(</span><span class="op" id="6629687">)</span><span class="op" id="6629688">.</span><span class="ident" id="6629689">TLSUnique</span><span class="op" id="6629698">,</span>&nbsp;<span class="op" id="6629700">&lt;-</span><span class="ident" id="6629702">serverTLSUniques</span><span class="op" id="6629718">)</span>&nbsp;<span class="op" id="6629720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629724">t</span><span class="op" id="6629725">.</span><span class="ident" id="6629726">Error</span><span class="op" id="6629731">(</span><span class="string" id="6629732">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&#34;</span><span class="op" id="6629775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629781">conn</span><span class="op" id="6629785">.</span><span class="ident" id="6629786">Close</span><span class="op" id="6629791">(</span><span class="op" id="6629792">)</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629796">conn</span><span class="op" id="6629800">,</span>&nbsp;<span class="ident" id="6629802">err</span>&nbsp;<span class="op" id="6629806">=</span>&nbsp;<span class="ident" id="6629808">Dial</span><span class="op" id="6629812">(</span><span class="string" id="6629813">&#34;tcp&#34;</span><span class="op" id="6629818">,</span>&nbsp;<span class="ident" id="6629820">ln</span><span class="op" id="6629822">.</span><span class="ident" id="6629823">Addr</span><span class="op" id="6629827">(</span><span class="op" id="6629828">)</span><span class="op" id="6629829">.</span><span class="ident" id="6629830">String</span><span class="op" id="6629836">(</span><span class="op" id="6629837">)</span><span class="op" id="6629838">,</span>&nbsp;<span class="op" id="6629840">&amp;</span><span class="ident" id="6629841">clientConfig</span><span class="op" id="6629853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629856">if</span>&nbsp;<span class="ident" id="6629859">err</span>&nbsp;<span class="op" id="6629863">!=</span>&nbsp;<span class="builtintype" id="6629866">nil</span>&nbsp;<span class="op" id="6629870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629874">t</span><span class="op" id="6629875">.</span><span class="ident" id="6629876">Fatal</span><span class="op" id="6629881">(</span><span class="ident" id="6629882">err</span><span class="op" id="6629885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6629888">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629891">defer</span>&nbsp;<span class="ident" id="6629897">conn</span><span class="op" id="6629901">.</span><span class="ident" id="6629902">Close</span><span class="op" id="6629907">(</span><span class="op" id="6629908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6629911">if</span>&nbsp;<span class="op" id="6629914">!</span><span class="ident" id="6629915">conn</span><span class="op" id="6629919">.</span><span class="ident" id="6629920">ConnectionState</span><span class="op" id="6629935">(</span><span class="op" id="6629936">)</span><span class="op" id="6629937">.</span><span class="ident" id="6629938">DidResume</span>&nbsp;<span class="op" id="6629948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6629952">t</span><span class="op" id="6629953">.</span><span class="ident" id="6629954">Error</span><span class="op" id="6629959">(</span><span class="string" id="6629960">&#34;second&nbsp;session&nbsp;did&nbsp;not&nbsp;use&nbsp;resumption&#34;</span><span class="op" id="6629999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6630005">if</span>&nbsp;<span class="op" id="6630008">!</span><span class="ident" id="6630009">bytes</span><span class="op" id="6630014">.</span><span class="ident" id="6630015">Equal</span><span class="op" id="6630020">(</span><span class="ident" id="6630021">conn</span><span class="op" id="6630025">.</span><span class="ident" id="6630026">ConnectionState</span><span class="op" id="6630041">(</span><span class="op" id="6630042">)</span><span class="op" id="6630043">.</span><span class="ident" id="6630044">TLSUnique</span><span class="op" id="6630053">,</span>&nbsp;<span class="op" id="6630055">&lt;-</span><span class="ident" id="6630057">serverTLSUniques</span><span class="op" id="6630073">)</span>&nbsp;<span class="op" id="6630075">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6630079">t</span><span class="op" id="6630080">.</span><span class="ident" id="6630081">Error</span><span class="op" id="6630086">(</span><span class="string" id="6630087">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&nbsp;when&nbsp;session&nbsp;resumption&nbsp;is&nbsp;used&#34;</span><span class="op" id="6630162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6630165">}</span><br>
<span class="lineno"></span><span class="op" id="6630167">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
