<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync/atomic</h2>
<ul>
<li><a href="/gostd/sync/atomic/atomic_test.go.html">atomic_test.go</a></li>
<li><a href="/gostd/sync/atomic/doc.go.html" class="current">doc.go</a></li>
<li><a href="/gostd/sync/atomic/value.go.html">value.go</a></li>
<li><a href="/gostd/sync/atomic/value_test.go.html">value_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1375920">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1375976">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1376030">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1376081">//&nbsp;Package&nbsp;atomic&nbsp;provides&nbsp;low-level&nbsp;atomic&nbsp;memory&nbsp;primitives</span><br>
<span class="lineno"></span><span class="comment" id="1376143">//&nbsp;useful&nbsp;for&nbsp;implementing&nbsp;synchronization&nbsp;algorithms.</span><br>
<span class="lineno"></span><span class="comment" id="1376198">//</span><br>
<span class="lineno"></span><span class="comment" id="1376201">//&nbsp;These&nbsp;functions&nbsp;require&nbsp;great&nbsp;care&nbsp;to&nbsp;be&nbsp;used&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="comment" id="1376261">//&nbsp;Except&nbsp;for&nbsp;special,&nbsp;low-level&nbsp;applications,&nbsp;synchronization&nbsp;is&nbsp;better</span><br>
<span class="lineno">10</span><span class="comment" id="1376334">//&nbsp;done&nbsp;with&nbsp;channels&nbsp;or&nbsp;the&nbsp;facilities&nbsp;of&nbsp;the&nbsp;sync&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="1376395">//&nbsp;Share&nbsp;memory&nbsp;by&nbsp;communicating;</span><br>
<span class="lineno"></span><span class="comment" id="1376429">//&nbsp;don&#39;t&nbsp;communicate&nbsp;by&nbsp;sharing&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1376469">//</span><br>
<span class="lineno"></span><span class="comment" id="1376472">//&nbsp;The&nbsp;swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;SwapT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno">15</span><span class="comment" id="1376545">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1376563">//</span><br>
<span class="lineno"></span><span class="comment" id="1376566">//&nbsp;&nbsp;&nbsp;&nbsp;old&nbsp;=&nbsp;*addr</span><br>
<span class="lineno"></span><span class="comment" id="1376581">//&nbsp;&nbsp;&nbsp;&nbsp;*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1376596">//&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;old</span><br>
<span class="lineno">20</span><span class="comment" id="1376610">//</span><br>
<span class="lineno"></span><span class="comment" id="1376613">//&nbsp;The&nbsp;compare-and-swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;CompareAndSwapT</span><br>
<span class="lineno"></span><span class="comment" id="1376683">//&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1376726">//</span><br>
<span class="lineno"></span><span class="comment" id="1376729">//&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;*addr&nbsp;==&nbsp;old&nbsp;{</span><br>
<span class="lineno">25</span><span class="comment" id="1376750">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1376766">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="1376782">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="1376787">//&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false</span><br>
<span class="lineno"></span><span class="comment" id="1376803">//</span><br>
<span class="lineno">30</span><span class="comment" id="1376806">//&nbsp;The&nbsp;add&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;AddT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno"></span><span class="comment" id="1376877">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1376895">//</span><br>
<span class="lineno"></span><span class="comment" id="1376898">//&nbsp;&nbsp;&nbsp;&nbsp;*addr&nbsp;+=&nbsp;delta</span><br>
<span class="lineno"></span><span class="comment" id="1376916">//&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;*addr</span><br>
<span class="lineno">35</span><span class="comment" id="1376932">//</span><br>
<span class="lineno"></span><span class="comment" id="1376935">//&nbsp;The&nbsp;load&nbsp;and&nbsp;store&nbsp;operations,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;LoadT&nbsp;and&nbsp;StoreT</span><br>
<span class="lineno"></span><span class="comment" id="1377005">//&nbsp;functions,&nbsp;are&nbsp;the&nbsp;atomic&nbsp;equivalents&nbsp;of&nbsp;&#34;return&nbsp;*addr&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1377068">//&nbsp;&#34;*addr&nbsp;=&nbsp;val&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1377086">//</span><br>
<span class="lineno">40</span><span class="keyword" id="1377089">package</span>&nbsp;<span class="ident" id="1377097">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1377105">import</span>&nbsp;<span class="op" id="1377112">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1377115">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1377124">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1377127">//&nbsp;BUG(rsc):&nbsp;On&nbsp;x86-32,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;Pentium&nbsp;MMX.</span><br>
<span class="lineno"></span><span class="comment" id="1377225">//</span><br>
<span class="lineno"></span><span class="comment" id="1377228">//&nbsp;On&nbsp;non-Linux&nbsp;ARM,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;ARMv6k&nbsp;core.</span><br>
<span class="lineno"></span><span class="comment" id="1377323">//</span><br>
<span class="lineno">50</span><span class="comment" id="1377326">//&nbsp;On&nbsp;both&nbsp;ARM&nbsp;and&nbsp;x86-32,&nbsp;it&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;arrange&nbsp;for&nbsp;64-bit</span><br>
<span class="lineno"></span><span class="comment" id="1377409">//&nbsp;alignment&nbsp;of&nbsp;64-bit&nbsp;words&nbsp;accessed&nbsp;atomically.&nbsp;The&nbsp;first&nbsp;word&nbsp;in&nbsp;a&nbsp;global</span><br>
<span class="lineno"></span><span class="comment" id="1377486">//&nbsp;variable&nbsp;or&nbsp;in&nbsp;an&nbsp;allocated&nbsp;struct&nbsp;or&nbsp;slice&nbsp;can&nbsp;be&nbsp;relied&nbsp;upon&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1377558">//&nbsp;64-bit&nbsp;aligned.</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1377578">//&nbsp;SwapInt32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1377662">func</span>&nbsp;<span class="ident" id="1377667">SwapInt32</span><span class="op" id="1377676">(</span><span class="ident" id="1377677">addr</span>&nbsp;<span class="op" id="1377682">*</span><span class="builtintype" id="1377683">int32</span><span class="op" id="1377688">,</span>&nbsp;<span class="builtinfunc" id="1377690">new</span>&nbsp;<span class="builtintype" id="1377694">int32</span><span class="op" id="1377699">)</span>&nbsp;<span class="op" id="1377701">(</span><span class="ident" id="1377702">old</span>&nbsp;<span class="builtintype" id="1377706">int32</span><span class="op" id="1377711">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1377714">//&nbsp;SwapInt64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1377798">func</span>&nbsp;<span class="ident" id="1377803">SwapInt64</span><span class="op" id="1377812">(</span><span class="ident" id="1377813">addr</span>&nbsp;<span class="op" id="1377818">*</span><span class="builtintype" id="1377819">int64</span><span class="op" id="1377824">,</span>&nbsp;<span class="builtinfunc" id="1377826">new</span>&nbsp;<span class="builtintype" id="1377830">int64</span><span class="op" id="1377835">)</span>&nbsp;<span class="op" id="1377837">(</span><span class="ident" id="1377838">old</span>&nbsp;<span class="builtintype" id="1377842">int64</span><span class="op" id="1377847">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="1377850">//&nbsp;SwapUint32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1377935">func</span>&nbsp;<span class="ident" id="1377940">SwapUint32</span><span class="op" id="1377950">(</span><span class="ident" id="1377951">addr</span>&nbsp;<span class="op" id="1377956">*</span><span class="builtintype" id="1377957">uint32</span><span class="op" id="1377963">,</span>&nbsp;<span class="builtinfunc" id="1377965">new</span>&nbsp;<span class="builtintype" id="1377969">uint32</span><span class="op" id="1377975">)</span>&nbsp;<span class="op" id="1377977">(</span><span class="ident" id="1377978">old</span>&nbsp;<span class="builtintype" id="1377982">uint32</span><span class="op" id="1377988">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1377991">//&nbsp;SwapUint64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno">65</span><span class="keyword" id="1378076">func</span>&nbsp;<span class="ident" id="1378081">SwapUint64</span><span class="op" id="1378091">(</span><span class="ident" id="1378092">addr</span>&nbsp;<span class="op" id="1378097">*</span><span class="builtintype" id="1378098">uint64</span><span class="op" id="1378104">,</span>&nbsp;<span class="builtinfunc" id="1378106">new</span>&nbsp;<span class="builtintype" id="1378110">uint64</span><span class="op" id="1378116">)</span>&nbsp;<span class="op" id="1378118">(</span><span class="ident" id="1378119">old</span>&nbsp;<span class="builtintype" id="1378123">uint64</span><span class="op" id="1378129">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1378132">//&nbsp;SwapUintptr&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1378218">func</span>&nbsp;<span class="ident" id="1378223">SwapUintptr</span><span class="op" id="1378234">(</span><span class="ident" id="1378235">addr</span>&nbsp;<span class="op" id="1378240">*</span><span class="builtintype" id="1378241">uintptr</span><span class="op" id="1378248">,</span>&nbsp;<span class="builtinfunc" id="1378250">new</span>&nbsp;<span class="builtintype" id="1378254">uintptr</span><span class="op" id="1378261">)</span>&nbsp;<span class="op" id="1378263">(</span><span class="ident" id="1378264">old</span>&nbsp;<span class="builtintype" id="1378268">uintptr</span><span class="op" id="1378275">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="1378278">//&nbsp;SwapPointer&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1378364">func</span>&nbsp;<span class="ident" id="1378369">SwapPointer</span><span class="op" id="1378380">(</span><span class="ident" id="1378381">addr</span>&nbsp;<span class="op" id="1378386">*</span><span class="ident" id="1378387">unsafe</span><span class="op" id="1378393">.</span><span class="ident" id="1378394">Pointer</span><span class="op" id="1378401">,</span>&nbsp;<span class="builtinfunc" id="1378403">new</span>&nbsp;<span class="ident" id="1378407">unsafe</span><span class="op" id="1378413">.</span><span class="ident" id="1378414">Pointer</span><span class="op" id="1378421">)</span>&nbsp;<span class="op" id="1378423">(</span><span class="ident" id="1378424">old</span>&nbsp;<span class="ident" id="1378428">unsafe</span><span class="op" id="1378434">.</span><span class="ident" id="1378435">Pointer</span><span class="op" id="1378442">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1378445">//&nbsp;CompareAndSwapInt32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int32&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1378528">func</span>&nbsp;<span class="ident" id="1378533">CompareAndSwapInt32</span><span class="op" id="1378552">(</span><span class="ident" id="1378553">addr</span>&nbsp;<span class="op" id="1378558">*</span><span class="builtintype" id="1378559">int32</span><span class="op" id="1378564">,</span>&nbsp;<span class="ident" id="1378566">old</span><span class="op" id="1378569">,</span>&nbsp;<span class="builtinfunc" id="1378571">new</span>&nbsp;<span class="builtintype" id="1378575">int32</span><span class="op" id="1378580">)</span>&nbsp;<span class="op" id="1378582">(</span><span class="ident" id="1378583">swapped</span>&nbsp;<span class="builtintype" id="1378591">bool</span><span class="op" id="1378595">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="1378598">//&nbsp;CompareAndSwapInt64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1378681">func</span>&nbsp;<span class="ident" id="1378686">CompareAndSwapInt64</span><span class="op" id="1378705">(</span><span class="ident" id="1378706">addr</span>&nbsp;<span class="op" id="1378711">*</span><span class="builtintype" id="1378712">int64</span><span class="op" id="1378717">,</span>&nbsp;<span class="ident" id="1378719">old</span><span class="op" id="1378722">,</span>&nbsp;<span class="builtinfunc" id="1378724">new</span>&nbsp;<span class="builtintype" id="1378728">int64</span><span class="op" id="1378733">)</span>&nbsp;<span class="op" id="1378735">(</span><span class="ident" id="1378736">swapped</span>&nbsp;<span class="builtintype" id="1378744">bool</span><span class="op" id="1378748">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1378751">//&nbsp;CompareAndSwapUint32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint32&nbsp;value.</span><br>
<span class="lineno">80</span><span class="keyword" id="1378835">func</span>&nbsp;<span class="ident" id="1378840">CompareAndSwapUint32</span><span class="op" id="1378860">(</span><span class="ident" id="1378861">addr</span>&nbsp;<span class="op" id="1378866">*</span><span class="builtintype" id="1378867">uint32</span><span class="op" id="1378873">,</span>&nbsp;<span class="ident" id="1378875">old</span><span class="op" id="1378878">,</span>&nbsp;<span class="builtinfunc" id="1378880">new</span>&nbsp;<span class="builtintype" id="1378884">uint32</span><span class="op" id="1378890">)</span>&nbsp;<span class="op" id="1378892">(</span><span class="ident" id="1378893">swapped</span>&nbsp;<span class="builtintype" id="1378901">bool</span><span class="op" id="1378905">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1378908">//&nbsp;CompareAndSwapUint64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1378992">func</span>&nbsp;<span class="ident" id="1378997">CompareAndSwapUint64</span><span class="op" id="1379017">(</span><span class="ident" id="1379018">addr</span>&nbsp;<span class="op" id="1379023">*</span><span class="builtintype" id="1379024">uint64</span><span class="op" id="1379030">,</span>&nbsp;<span class="ident" id="1379032">old</span><span class="op" id="1379035">,</span>&nbsp;<span class="builtinfunc" id="1379037">new</span>&nbsp;<span class="builtintype" id="1379041">uint64</span><span class="op" id="1379047">)</span>&nbsp;<span class="op" id="1379049">(</span><span class="ident" id="1379050">swapped</span>&nbsp;<span class="builtintype" id="1379058">bool</span><span class="op" id="1379062">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1379065">//&nbsp;CompareAndSwapUintptr&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uintptr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1379151">func</span>&nbsp;<span class="ident" id="1379156">CompareAndSwapUintptr</span><span class="op" id="1379177">(</span><span class="ident" id="1379178">addr</span>&nbsp;<span class="op" id="1379183">*</span><span class="builtintype" id="1379184">uintptr</span><span class="op" id="1379191">,</span>&nbsp;<span class="ident" id="1379193">old</span><span class="op" id="1379196">,</span>&nbsp;<span class="builtinfunc" id="1379198">new</span>&nbsp;<span class="builtintype" id="1379202">uintptr</span><span class="op" id="1379209">)</span>&nbsp;<span class="op" id="1379211">(</span><span class="ident" id="1379212">swapped</span>&nbsp;<span class="builtintype" id="1379220">bool</span><span class="op" id="1379224">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1379227">//&nbsp;CompareAndSwapPointer&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;unsafe.Pointer&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1379320">func</span>&nbsp;<span class="ident" id="1379325">CompareAndSwapPointer</span><span class="op" id="1379346">(</span><span class="ident" id="1379347">addr</span>&nbsp;<span class="op" id="1379352">*</span><span class="ident" id="1379353">unsafe</span><span class="op" id="1379359">.</span><span class="ident" id="1379360">Pointer</span><span class="op" id="1379367">,</span>&nbsp;<span class="ident" id="1379369">old</span><span class="op" id="1379372">,</span>&nbsp;<span class="builtinfunc" id="1379374">new</span>&nbsp;<span class="ident" id="1379378">unsafe</span><span class="op" id="1379384">.</span><span class="ident" id="1379385">Pointer</span><span class="op" id="1379392">)</span>&nbsp;<span class="op" id="1379394">(</span><span class="ident" id="1379395">swapped</span>&nbsp;<span class="builtintype" id="1379403">bool</span><span class="op" id="1379407">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="1379410">//&nbsp;AddInt32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1379480">func</span>&nbsp;<span class="ident" id="1379485">AddInt32</span><span class="op" id="1379493">(</span><span class="ident" id="1379494">addr</span>&nbsp;<span class="op" id="1379499">*</span><span class="builtintype" id="1379500">int32</span><span class="op" id="1379505">,</span>&nbsp;<span class="ident" id="1379507">delta</span>&nbsp;<span class="builtintype" id="1379513">int32</span><span class="op" id="1379518">)</span>&nbsp;<span class="op" id="1379520">(</span><span class="builtinfunc" id="1379521">new</span>&nbsp;<span class="builtintype" id="1379525">int32</span><span class="op" id="1379530">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1379533">//&nbsp;AddUint32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">95</span><span class="comment" id="1379604">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1379694">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(0)).</span><br>
<span class="lineno"></span><span class="keyword" id="1379758">func</span>&nbsp;<span class="ident" id="1379763">AddUint32</span><span class="op" id="1379772">(</span><span class="ident" id="1379773">addr</span>&nbsp;<span class="op" id="1379778">*</span><span class="builtintype" id="1379779">uint32</span><span class="op" id="1379785">,</span>&nbsp;<span class="ident" id="1379787">delta</span>&nbsp;<span class="builtintype" id="1379793">uint32</span><span class="op" id="1379799">)</span>&nbsp;<span class="op" id="1379801">(</span><span class="builtinfunc" id="1379802">new</span>&nbsp;<span class="builtintype" id="1379806">uint32</span><span class="op" id="1379812">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1379815">//&nbsp;AddInt64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">100</span><span class="keyword" id="1379885">func</span>&nbsp;<span class="ident" id="1379890">AddInt64</span><span class="op" id="1379898">(</span><span class="ident" id="1379899">addr</span>&nbsp;<span class="op" id="1379904">*</span><span class="builtintype" id="1379905">int64</span><span class="op" id="1379910">,</span>&nbsp;<span class="ident" id="1379912">delta</span>&nbsp;<span class="builtintype" id="1379918">int64</span><span class="op" id="1379923">)</span>&nbsp;<span class="op" id="1379925">(</span><span class="builtinfunc" id="1379926">new</span>&nbsp;<span class="builtintype" id="1379930">int64</span><span class="op" id="1379935">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1379938">//&nbsp;AddUint64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1380009">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1380099">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(0)).</span><br>
<span class="lineno">105</span><span class="keyword" id="1380163">func</span>&nbsp;<span class="ident" id="1380168">AddUint64</span><span class="op" id="1380177">(</span><span class="ident" id="1380178">addr</span>&nbsp;<span class="op" id="1380183">*</span><span class="builtintype" id="1380184">uint64</span><span class="op" id="1380190">,</span>&nbsp;<span class="ident" id="1380192">delta</span>&nbsp;<span class="builtintype" id="1380198">uint64</span><span class="op" id="1380204">)</span>&nbsp;<span class="op" id="1380206">(</span><span class="builtinfunc" id="1380207">new</span>&nbsp;<span class="builtintype" id="1380211">uint64</span><span class="op" id="1380217">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1380220">//&nbsp;AddUintptr&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1380292">func</span>&nbsp;<span class="ident" id="1380297">AddUintptr</span><span class="op" id="1380307">(</span><span class="ident" id="1380308">addr</span>&nbsp;<span class="op" id="1380313">*</span><span class="builtintype" id="1380314">uintptr</span><span class="op" id="1380321">,</span>&nbsp;<span class="ident" id="1380323">delta</span>&nbsp;<span class="builtintype" id="1380329">uintptr</span><span class="op" id="1380336">)</span>&nbsp;<span class="op" id="1380338">(</span><span class="builtinfunc" id="1380339">new</span>&nbsp;<span class="builtintype" id="1380343">uintptr</span><span class="op" id="1380350">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1380353">//&nbsp;LoadInt32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1380390">func</span>&nbsp;<span class="ident" id="1380395">LoadInt32</span><span class="op" id="1380404">(</span><span class="ident" id="1380405">addr</span>&nbsp;<span class="op" id="1380410">*</span><span class="builtintype" id="1380411">int32</span><span class="op" id="1380416">)</span>&nbsp;<span class="op" id="1380418">(</span><span class="ident" id="1380419">val</span>&nbsp;<span class="builtintype" id="1380423">int32</span><span class="op" id="1380428">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1380431">//&nbsp;LoadInt64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1380468">func</span>&nbsp;<span class="ident" id="1380473">LoadInt64</span><span class="op" id="1380482">(</span><span class="ident" id="1380483">addr</span>&nbsp;<span class="op" id="1380488">*</span><span class="builtintype" id="1380489">int64</span><span class="op" id="1380494">)</span>&nbsp;<span class="op" id="1380496">(</span><span class="ident" id="1380497">val</span>&nbsp;<span class="builtintype" id="1380501">int64</span><span class="op" id="1380506">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1380509">//&nbsp;LoadUint32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1380547">func</span>&nbsp;<span class="ident" id="1380552">LoadUint32</span><span class="op" id="1380562">(</span><span class="ident" id="1380563">addr</span>&nbsp;<span class="op" id="1380568">*</span><span class="builtintype" id="1380569">uint32</span><span class="op" id="1380575">)</span>&nbsp;<span class="op" id="1380577">(</span><span class="ident" id="1380578">val</span>&nbsp;<span class="builtintype" id="1380582">uint32</span><span class="op" id="1380588">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1380591">//&nbsp;LoadUint64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno">120</span><span class="keyword" id="1380629">func</span>&nbsp;<span class="ident" id="1380634">LoadUint64</span><span class="op" id="1380644">(</span><span class="ident" id="1380645">addr</span>&nbsp;<span class="op" id="1380650">*</span><span class="builtintype" id="1380651">uint64</span><span class="op" id="1380657">)</span>&nbsp;<span class="op" id="1380659">(</span><span class="ident" id="1380660">val</span>&nbsp;<span class="builtintype" id="1380664">uint64</span><span class="op" id="1380670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1380673">//&nbsp;LoadUintptr&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1380712">func</span>&nbsp;<span class="ident" id="1380717">LoadUintptr</span><span class="op" id="1380728">(</span><span class="ident" id="1380729">addr</span>&nbsp;<span class="op" id="1380734">*</span><span class="builtintype" id="1380735">uintptr</span><span class="op" id="1380742">)</span>&nbsp;<span class="op" id="1380744">(</span><span class="ident" id="1380745">val</span>&nbsp;<span class="builtintype" id="1380749">uintptr</span><span class="op" id="1380756">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="1380759">//&nbsp;LoadPointer&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1380798">func</span>&nbsp;<span class="ident" id="1380803">LoadPointer</span><span class="op" id="1380814">(</span><span class="ident" id="1380815">addr</span>&nbsp;<span class="op" id="1380820">*</span><span class="ident" id="1380821">unsafe</span><span class="op" id="1380827">.</span><span class="ident" id="1380828">Pointer</span><span class="op" id="1380835">)</span>&nbsp;<span class="op" id="1380837">(</span><span class="ident" id="1380838">val</span>&nbsp;<span class="ident" id="1380842">unsafe</span><span class="op" id="1380848">.</span><span class="ident" id="1380849">Pointer</span><span class="op" id="1380856">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1380859">//&nbsp;StoreInt32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1380907">func</span>&nbsp;<span class="ident" id="1380912">StoreInt32</span><span class="op" id="1380922">(</span><span class="ident" id="1380923">addr</span>&nbsp;<span class="op" id="1380928">*</span><span class="builtintype" id="1380929">int32</span><span class="op" id="1380934">,</span>&nbsp;<span class="ident" id="1380936">val</span>&nbsp;<span class="builtintype" id="1380940">int32</span><span class="op" id="1380945">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1380948">//&nbsp;StoreInt64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1380996">func</span>&nbsp;<span class="ident" id="1381001">StoreInt64</span><span class="op" id="1381011">(</span><span class="ident" id="1381012">addr</span>&nbsp;<span class="op" id="1381017">*</span><span class="builtintype" id="1381018">int64</span><span class="op" id="1381023">,</span>&nbsp;<span class="ident" id="1381025">val</span>&nbsp;<span class="builtintype" id="1381029">int64</span><span class="op" id="1381034">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1381037">//&nbsp;StoreUint32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno">135</span><span class="keyword" id="1381086">func</span>&nbsp;<span class="ident" id="1381091">StoreUint32</span><span class="op" id="1381102">(</span><span class="ident" id="1381103">addr</span>&nbsp;<span class="op" id="1381108">*</span><span class="builtintype" id="1381109">uint32</span><span class="op" id="1381115">,</span>&nbsp;<span class="ident" id="1381117">val</span>&nbsp;<span class="builtintype" id="1381121">uint32</span><span class="op" id="1381127">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1381130">//&nbsp;StoreUint64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1381179">func</span>&nbsp;<span class="ident" id="1381184">StoreUint64</span><span class="op" id="1381195">(</span><span class="ident" id="1381196">addr</span>&nbsp;<span class="op" id="1381201">*</span><span class="builtintype" id="1381202">uint64</span><span class="op" id="1381208">,</span>&nbsp;<span class="ident" id="1381210">val</span>&nbsp;<span class="builtintype" id="1381214">uint64</span><span class="op" id="1381220">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1381223">//&nbsp;StoreUintptr&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1381273">func</span>&nbsp;<span class="ident" id="1381278">StoreUintptr</span><span class="op" id="1381290">(</span><span class="ident" id="1381291">addr</span>&nbsp;<span class="op" id="1381296">*</span><span class="builtintype" id="1381297">uintptr</span><span class="op" id="1381304">,</span>&nbsp;<span class="ident" id="1381306">val</span>&nbsp;<span class="builtintype" id="1381310">uintptr</span><span class="op" id="1381317">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1381320">//&nbsp;StorePointer&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1381370">func</span>&nbsp;<span class="ident" id="1381375">StorePointer</span><span class="op" id="1381387">(</span><span class="ident" id="1381388">addr</span>&nbsp;<span class="op" id="1381393">*</span><span class="ident" id="1381394">unsafe</span><span class="op" id="1381400">.</span><span class="ident" id="1381401">Pointer</span><span class="op" id="1381408">,</span>&nbsp;<span class="ident" id="1381410">val</span>&nbsp;<span class="ident" id="1381414">unsafe</span><span class="op" id="1381420">.</span><span class="ident" id="1381421">Pointer</span><span class="op" id="1381428">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1381431">//&nbsp;Helper&nbsp;for&nbsp;ARM.&nbsp;&nbsp;Linker&nbsp;will&nbsp;discard&nbsp;on&nbsp;other&nbsp;systems</span><br>
<span class="lineno"></span><span class="keyword" id="1381488">func</span>&nbsp;<span class="ident" id="1381493">panic64</span><span class="op" id="1381500">(</span><span class="op" id="1381501">)</span>&nbsp;<span class="op" id="1381503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1381506">panic</span><span class="op" id="1381511">(</span><span class="string" id="1381512">&#34;sync/atomic:&nbsp;broken&nbsp;64-bit&nbsp;atomic&nbsp;operations&nbsp;(buggy&nbsp;QEMU)&#34;</span><span class="op" id="1381571">)</span><br>
<span class="lineno"></span><span class="op" id="1381573">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
