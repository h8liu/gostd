<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html" class="current">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6297073">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6297128">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6297182">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6297233">package</span>&nbsp;<span class="ident" id="6297241">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6297246">import</span>&nbsp;<span class="op" id="6297253">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6297256">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6297274">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6297284">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6297290">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6297303">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6297310">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6297313">//&nbsp;A&nbsp;Compressor&nbsp;returns&nbsp;a&nbsp;compressing&nbsp;writer,&nbsp;writing&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6297374">//&nbsp;provided&nbsp;writer.&nbsp;On&nbsp;Close,&nbsp;any&nbsp;pending&nbsp;data&nbsp;should&nbsp;be&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="6297440">type</span>&nbsp;<span class="ident" id="6297445">Compressor</span>&nbsp;<span class="keyword" id="6297456">func</span><span class="op" id="6297460">(</span><span class="ident" id="6297461">io</span><span class="op" id="6297463">.</span><span class="ident" id="6297464">Writer</span><span class="op" id="6297470">)</span>&nbsp;<span class="op" id="6297472">(</span><span class="ident" id="6297473">io</span><span class="op" id="6297475">.</span><span class="ident" id="6297476">WriteCloser</span><span class="op" id="6297487">,</span>&nbsp;<span class="builtintype" id="6297489">error</span><span class="op" id="6297494">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6297497">//&nbsp;Decompressor&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;wraps&nbsp;a&nbsp;Reader&nbsp;with&nbsp;a&nbsp;decompressing&nbsp;Reader.</span><br>
<span class="lineno">20</span><span class="comment" id="6297576">//&nbsp;The&nbsp;decompressed&nbsp;ReadCloser&nbsp;is&nbsp;returned&nbsp;to&nbsp;callers&nbsp;who&nbsp;open&nbsp;files&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="6297650">//&nbsp;within&nbsp;the&nbsp;archive.&nbsp;&nbsp;These&nbsp;callers&nbsp;are&nbsp;responsible&nbsp;for&nbsp;closing&nbsp;this&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="6297728">//&nbsp;when&nbsp;they&#39;re&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="keyword" id="6297762">type</span>&nbsp;<span class="ident" id="6297767">Decompressor</span>&nbsp;<span class="keyword" id="6297780">func</span><span class="op" id="6297784">(</span><span class="ident" id="6297785">io</span><span class="op" id="6297787">.</span><span class="ident" id="6297788">Reader</span><span class="op" id="6297794">)</span>&nbsp;<span class="ident" id="6297796">io</span><span class="op" id="6297798">.</span><span class="ident" id="6297799">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6297811">var</span>&nbsp;<span class="ident" id="6297815">flateWriterPool</span>&nbsp;<span class="ident" id="6297831">sync</span><span class="op" id="6297835">.</span><span class="ident" id="6297836">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6297842">func</span>&nbsp;<span class="ident" id="6297847">newFlateWriter</span><span class="op" id="6297861">(</span><span class="ident" id="6297862">w</span>&nbsp;<span class="ident" id="6297864">io</span><span class="op" id="6297866">.</span><span class="ident" id="6297867">Writer</span><span class="op" id="6297873">)</span>&nbsp;<span class="ident" id="6297875">io</span><span class="op" id="6297877">.</span><span class="ident" id="6297878">WriteCloser</span>&nbsp;<span class="op" id="6297890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297893">fw</span><span class="op" id="6297895">,</span>&nbsp;<span class="ident" id="6297897">ok</span>&nbsp;<span class="op" id="6297900">:=</span>&nbsp;<span class="ident" id="6297903">flateWriterPool</span><span class="op" id="6297918">.</span><span class="ident" id="6297919">Get</span><span class="op" id="6297922">(</span><span class="op" id="6297923">)</span><span class="op" id="6297924">.</span><span class="op" id="6297925">(</span><span class="op" id="6297926">*</span><span class="ident" id="6297927">flate</span><span class="op" id="6297932">.</span><span class="ident" id="6297933">Writer</span><span class="op" id="6297939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297942">if</span>&nbsp;<span class="ident" id="6297945">ok</span>&nbsp;<span class="op" id="6297948">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297952">fw</span><span class="op" id="6297954">.</span><span class="ident" id="6297955">Reset</span><span class="op" id="6297960">(</span><span class="ident" id="6297961">w</span><span class="op" id="6297962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297965">}</span>&nbsp;<span class="keyword" id="6297967">else</span>&nbsp;<span class="op" id="6297972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297976">fw</span><span class="op" id="6297978">,</span>&nbsp;<span class="ident" id="6297980">_</span>&nbsp;<span class="op" id="6297982">=</span>&nbsp;<span class="ident" id="6297984">flate</span><span class="op" id="6297989">.</span><span class="ident" id="6297990">NewWriter</span><span class="op" id="6297999">(</span><span class="ident" id="6298000">w</span><span class="op" id="6298001">,</span>&nbsp;<span class="num" id="6298003">5</span><span class="op" id="6298004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298010">return</span>&nbsp;<span class="op" id="6298017">&amp;</span><span class="ident" id="6298018">pooledFlateWriter</span><span class="op" id="6298035">{</span><span class="ident" id="6298036">fw</span><span class="op" id="6298038">:</span>&nbsp;<span class="ident" id="6298040">fw</span><span class="op" id="6298042">}</span><br>
<span class="lineno">35</span><span class="op" id="6298044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6298047">type</span>&nbsp;<span class="ident" id="6298052">pooledFlateWriter</span>&nbsp;<span class="keyword" id="6298070">struct</span>&nbsp;<span class="op" id="6298077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298080">mu</span>&nbsp;<span class="ident" id="6298083">sync</span><span class="op" id="6298087">.</span><span class="ident" id="6298088">Mutex</span>&nbsp;<span class="comment" id="6298094">//&nbsp;guards&nbsp;Close&nbsp;and&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298121">fw</span>&nbsp;<span class="op" id="6298124">*</span><span class="ident" id="6298125">flate</span><span class="op" id="6298130">.</span><span class="ident" id="6298131">Writer</span><br>
<span class="lineno">40</span><span class="op" id="6298138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6298141">func</span>&nbsp;<span class="op" id="6298146">(</span><span class="ident" id="6298147">w</span>&nbsp;<span class="op" id="6298149">*</span><span class="ident" id="6298150">pooledFlateWriter</span><span class="op" id="6298167">)</span>&nbsp;<span class="ident" id="6298169">Write</span><span class="op" id="6298174">(</span><span class="ident" id="6298175">p</span>&nbsp;<span class="op" id="6298177">[</span><span class="op" id="6298178">]</span><span class="builtintype" id="6298179">byte</span><span class="op" id="6298183">)</span>&nbsp;<span class="op" id="6298185">(</span><span class="ident" id="6298186">n</span>&nbsp;<span class="builtintype" id="6298188">int</span><span class="op" id="6298191">,</span>&nbsp;<span class="ident" id="6298193">err</span>&nbsp;<span class="builtintype" id="6298197">error</span><span class="op" id="6298202">)</span>&nbsp;<span class="op" id="6298204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298207">w</span><span class="op" id="6298208">.</span><span class="ident" id="6298209">mu</span><span class="op" id="6298211">.</span><span class="ident" id="6298212">Lock</span><span class="op" id="6298216">(</span><span class="op" id="6298217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298220">defer</span>&nbsp;<span class="ident" id="6298226">w</span><span class="op" id="6298227">.</span><span class="ident" id="6298228">mu</span><span class="op" id="6298230">.</span><span class="ident" id="6298231">Unlock</span><span class="op" id="6298237">(</span><span class="op" id="6298238">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298241">if</span>&nbsp;<span class="ident" id="6298244">w</span><span class="op" id="6298245">.</span><span class="ident" id="6298246">fw</span>&nbsp;<span class="op" id="6298249">==</span>&nbsp;<span class="ident" id="6298252">nil</span>&nbsp;<span class="op" id="6298256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298260">return</span>&nbsp;<span class="num" id="6298267">0</span><span class="op" id="6298268">,</span>&nbsp;<span class="ident" id="6298270">errors</span><span class="op" id="6298276">.</span><span class="ident" id="6298277">New</span><span class="op" id="6298280">(</span><span class="string" id="6298281">&#34;Write&nbsp;after&nbsp;Close&#34;</span><span class="op" id="6298300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298306">return</span>&nbsp;<span class="ident" id="6298313">w</span><span class="op" id="6298314">.</span><span class="ident" id="6298315">fw</span><span class="op" id="6298317">.</span><span class="ident" id="6298318">Write</span><span class="op" id="6298323">(</span><span class="ident" id="6298324">p</span><span class="op" id="6298325">)</span><br>
<span class="lineno"></span><span class="op" id="6298327">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6298330">func</span>&nbsp;<span class="op" id="6298335">(</span><span class="ident" id="6298336">w</span>&nbsp;<span class="op" id="6298338">*</span><span class="ident" id="6298339">pooledFlateWriter</span><span class="op" id="6298356">)</span>&nbsp;<span class="ident" id="6298358">Close</span><span class="op" id="6298363">(</span><span class="op" id="6298364">)</span>&nbsp;<span class="builtintype" id="6298366">error</span>&nbsp;<span class="op" id="6298372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298375">w</span><span class="op" id="6298376">.</span><span class="ident" id="6298377">mu</span><span class="op" id="6298379">.</span><span class="ident" id="6298380">Lock</span><span class="op" id="6298384">(</span><span class="op" id="6298385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298388">defer</span>&nbsp;<span class="ident" id="6298394">w</span><span class="op" id="6298395">.</span><span class="ident" id="6298396">mu</span><span class="op" id="6298398">.</span><span class="ident" id="6298399">Unlock</span><span class="op" id="6298405">(</span><span class="op" id="6298406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298409">var</span>&nbsp;<span class="ident" id="6298413">err</span>&nbsp;<span class="builtintype" id="6298417">error</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298424">if</span>&nbsp;<span class="ident" id="6298427">w</span><span class="op" id="6298428">.</span><span class="ident" id="6298429">fw</span>&nbsp;<span class="op" id="6298432">!=</span>&nbsp;<span class="ident" id="6298435">nil</span>&nbsp;<span class="op" id="6298439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298443">err</span>&nbsp;<span class="op" id="6298447">=</span>&nbsp;<span class="ident" id="6298449">w</span><span class="op" id="6298450">.</span><span class="ident" id="6298451">fw</span><span class="op" id="6298453">.</span><span class="ident" id="6298454">Close</span><span class="op" id="6298459">(</span><span class="op" id="6298460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298464">flateWriterPool</span><span class="op" id="6298479">.</span><span class="ident" id="6298480">Put</span><span class="op" id="6298483">(</span><span class="ident" id="6298484">w</span><span class="op" id="6298485">.</span><span class="ident" id="6298486">fw</span><span class="op" id="6298488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298492">w</span><span class="op" id="6298493">.</span><span class="ident" id="6298494">fw</span>&nbsp;<span class="op" id="6298497">=</span>&nbsp;<span class="ident" id="6298499">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298504">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298507">return</span>&nbsp;<span class="ident" id="6298514">err</span><br>
<span class="lineno"></span><span class="op" id="6298518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6298521">var</span>&nbsp;<span class="op" id="6298525">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298528">mu</span>&nbsp;<span class="ident" id="6298531">sync</span><span class="op" id="6298535">.</span><span class="ident" id="6298536">RWMutex</span>&nbsp;<span class="comment" id="6298544">//&nbsp;guards&nbsp;compressor&nbsp;and&nbsp;decompressor&nbsp;maps</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298589">compressors</span>&nbsp;<span class="op" id="6298601">=</span>&nbsp;<span class="keyword" id="6298603">map</span><span class="op" id="6298606">[</span><span class="builtintype" id="6298607">uint16</span><span class="op" id="6298613">]</span><span class="ident" id="6298614">Compressor</span><span class="op" id="6298624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298628">Store</span><span class="op" id="6298633">:</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6298637">func</span><span class="op" id="6298641">(</span><span class="ident" id="6298642">w</span>&nbsp;<span class="ident" id="6298644">io</span><span class="op" id="6298646">.</span><span class="ident" id="6298647">Writer</span><span class="op" id="6298653">)</span>&nbsp;<span class="op" id="6298655">(</span><span class="ident" id="6298656">io</span><span class="op" id="6298658">.</span><span class="ident" id="6298659">WriteCloser</span><span class="op" id="6298670">,</span>&nbsp;<span class="builtintype" id="6298672">error</span><span class="op" id="6298677">)</span>&nbsp;<span class="op" id="6298679">{</span>&nbsp;<span class="keyword" id="6298681">return</span>&nbsp;<span class="op" id="6298688">&amp;</span><span class="ident" id="6298689">nopCloser</span><span class="op" id="6298698">{</span><span class="ident" id="6298699">w</span><span class="op" id="6298700">}</span><span class="op" id="6298701">,</span>&nbsp;<span class="ident" id="6298703">nil</span>&nbsp;<span class="op" id="6298707">}</span><span class="op" id="6298708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298712">Deflate</span><span class="op" id="6298719">:</span>&nbsp;<span class="keyword" id="6298721">func</span><span class="op" id="6298725">(</span><span class="ident" id="6298726">w</span>&nbsp;<span class="ident" id="6298728">io</span><span class="op" id="6298730">.</span><span class="ident" id="6298731">Writer</span><span class="op" id="6298737">)</span>&nbsp;<span class="op" id="6298739">(</span><span class="ident" id="6298740">io</span><span class="op" id="6298742">.</span><span class="ident" id="6298743">WriteCloser</span><span class="op" id="6298754">,</span>&nbsp;<span class="builtintype" id="6298756">error</span><span class="op" id="6298761">)</span>&nbsp;<span class="op" id="6298763">{</span>&nbsp;<span class="keyword" id="6298765">return</span>&nbsp;<span class="ident" id="6298772">newFlateWriter</span><span class="op" id="6298786">(</span><span class="ident" id="6298787">w</span><span class="op" id="6298788">)</span><span class="op" id="6298789">,</span>&nbsp;<span class="ident" id="6298791">nil</span>&nbsp;<span class="op" id="6298795">}</span><span class="op" id="6298796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298799">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298803">decompressors</span>&nbsp;<span class="op" id="6298817">=</span>&nbsp;<span class="keyword" id="6298819">map</span><span class="op" id="6298822">[</span><span class="builtintype" id="6298823">uint16</span><span class="op" id="6298829">]</span><span class="ident" id="6298830">Decompressor</span><span class="op" id="6298842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298846">Store</span><span class="op" id="6298851">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6298855">ioutil</span><span class="op" id="6298861">.</span><span class="ident" id="6298862">NopCloser</span><span class="op" id="6298871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298875">Deflate</span><span class="op" id="6298882">:</span>&nbsp;<span class="ident" id="6298884">flate</span><span class="op" id="6298889">.</span><span class="ident" id="6298890">NewReader</span><span class="op" id="6298899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298902">}</span><br>
<span class="lineno">75</span><span class="op" id="6298904">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6298907">//&nbsp;RegisterDecompressor&nbsp;allows&nbsp;custom&nbsp;decompressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="keyword" id="6298986">func</span>&nbsp;<span class="ident" id="6298991">RegisterDecompressor</span><span class="op" id="6299011">(</span><span class="ident" id="6299012">method</span>&nbsp;<span class="builtintype" id="6299019">uint16</span><span class="op" id="6299025">,</span>&nbsp;<span class="ident" id="6299027">d</span>&nbsp;<span class="ident" id="6299029">Decompressor</span><span class="op" id="6299041">)</span>&nbsp;<span class="op" id="6299043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299046">mu</span><span class="op" id="6299048">.</span><span class="ident" id="6299049">Lock</span><span class="op" id="6299053">(</span><span class="op" id="6299054">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299057">defer</span>&nbsp;<span class="ident" id="6299063">mu</span><span class="op" id="6299065">.</span><span class="ident" id="6299066">Unlock</span><span class="op" id="6299072">(</span><span class="op" id="6299073">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299077">if</span>&nbsp;<span class="ident" id="6299080">_</span><span class="op" id="6299081">,</span>&nbsp;<span class="ident" id="6299083">ok</span>&nbsp;<span class="op" id="6299086">:=</span>&nbsp;<span class="ident" id="6299089">decompressors</span><span class="op" id="6299102">[</span><span class="ident" id="6299103">method</span><span class="op" id="6299109">]</span><span class="op" id="6299110">;</span>&nbsp;<span class="ident" id="6299112">ok</span>&nbsp;<span class="op" id="6299115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6299119">panic</span><span class="op" id="6299124">(</span><span class="string" id="6299125">&#34;decompressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="6299158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299161">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299164">decompressors</span><span class="op" id="6299177">[</span><span class="ident" id="6299178">method</span><span class="op" id="6299184">]</span>&nbsp;<span class="op" id="6299186">=</span>&nbsp;<span class="ident" id="6299188">d</span><br>
<span class="lineno"></span><span class="op" id="6299190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6299193">//&nbsp;RegisterCompressor&nbsp;registers&nbsp;custom&nbsp;compressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="comment" id="6299271">//&nbsp;The&nbsp;common&nbsp;methods&nbsp;Store&nbsp;and&nbsp;Deflate&nbsp;are&nbsp;built&nbsp;in.</span><br>
<span class="lineno">90</span><span class="keyword" id="6299325">func</span>&nbsp;<span class="ident" id="6299330">RegisterCompressor</span><span class="op" id="6299348">(</span><span class="ident" id="6299349">method</span>&nbsp;<span class="builtintype" id="6299356">uint16</span><span class="op" id="6299362">,</span>&nbsp;<span class="ident" id="6299364">comp</span>&nbsp;<span class="ident" id="6299369">Compressor</span><span class="op" id="6299379">)</span>&nbsp;<span class="op" id="6299381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299384">mu</span><span class="op" id="6299386">.</span><span class="ident" id="6299387">Lock</span><span class="op" id="6299391">(</span><span class="op" id="6299392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299395">defer</span>&nbsp;<span class="ident" id="6299401">mu</span><span class="op" id="6299403">.</span><span class="ident" id="6299404">Unlock</span><span class="op" id="6299410">(</span><span class="op" id="6299411">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299415">if</span>&nbsp;<span class="ident" id="6299418">_</span><span class="op" id="6299419">,</span>&nbsp;<span class="ident" id="6299421">ok</span>&nbsp;<span class="op" id="6299424">:=</span>&nbsp;<span class="ident" id="6299427">compressors</span><span class="op" id="6299438">[</span><span class="ident" id="6299439">method</span><span class="op" id="6299445">]</span><span class="op" id="6299446">;</span>&nbsp;<span class="ident" id="6299448">ok</span>&nbsp;<span class="op" id="6299451">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6299455">panic</span><span class="op" id="6299460">(</span><span class="string" id="6299461">&#34;compressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="6299492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299498">compressors</span><span class="op" id="6299509">[</span><span class="ident" id="6299510">method</span><span class="op" id="6299516">]</span>&nbsp;<span class="op" id="6299518">=</span>&nbsp;<span class="ident" id="6299520">comp</span><br>
<span class="lineno"></span><span class="op" id="6299525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="6299528">func</span>&nbsp;<span class="ident" id="6299533">compressor</span><span class="op" id="6299543">(</span><span class="ident" id="6299544">method</span>&nbsp;<span class="builtintype" id="6299551">uint16</span><span class="op" id="6299557">)</span>&nbsp;<span class="ident" id="6299559">Compressor</span>&nbsp;<span class="op" id="6299570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299573">mu</span><span class="op" id="6299575">.</span><span class="ident" id="6299576">RLock</span><span class="op" id="6299581">(</span><span class="op" id="6299582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299585">defer</span>&nbsp;<span class="ident" id="6299591">mu</span><span class="op" id="6299593">.</span><span class="ident" id="6299594">RUnlock</span><span class="op" id="6299601">(</span><span class="op" id="6299602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299605">return</span>&nbsp;<span class="ident" id="6299612">compressors</span><span class="op" id="6299623">[</span><span class="ident" id="6299624">method</span><span class="op" id="6299630">]</span><br>
<span class="lineno"></span><span class="op" id="6299632">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6299635">func</span>&nbsp;<span class="ident" id="6299640">decompressor</span><span class="op" id="6299652">(</span><span class="ident" id="6299653">method</span>&nbsp;<span class="builtintype" id="6299660">uint16</span><span class="op" id="6299666">)</span>&nbsp;<span class="ident" id="6299668">Decompressor</span>&nbsp;<span class="op" id="6299681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299684">mu</span><span class="op" id="6299686">.</span><span class="ident" id="6299687">RLock</span><span class="op" id="6299692">(</span><span class="op" id="6299693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299696">defer</span>&nbsp;<span class="ident" id="6299702">mu</span><span class="op" id="6299704">.</span><span class="ident" id="6299705">RUnlock</span><span class="op" id="6299712">(</span><span class="op" id="6299713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299716">return</span>&nbsp;<span class="ident" id="6299723">decompressors</span><span class="op" id="6299736">[</span><span class="ident" id="6299737">method</span><span class="op" id="6299743">]</span><br>
<span class="lineno">110</span><span class="op" id="6299745">}</span>
</div>
</body>
</html>
