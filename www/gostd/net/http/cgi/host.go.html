<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html" class="current">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5510445">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5510500">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5510554">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5510605">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;host&nbsp;side&nbsp;of&nbsp;CGI&nbsp;(being&nbsp;the&nbsp;webserver</span><br>
<span class="lineno"></span><span class="comment" id="5510671">//&nbsp;parent&nbsp;process).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5510692">//&nbsp;Package&nbsp;cgi&nbsp;implements&nbsp;CGI&nbsp;(Common&nbsp;Gateway&nbsp;Interface)&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="5510762">//&nbsp;in&nbsp;RFC&nbsp;3875.</span><br>
<span class="lineno">10</span><span class="comment" id="5510778">//</span><br>
<span class="lineno"></span><span class="comment" id="5510781">//&nbsp;Note&nbsp;that&nbsp;using&nbsp;CGI&nbsp;means&nbsp;starting&nbsp;a&nbsp;new&nbsp;process&nbsp;to&nbsp;handle&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="5510848">//&nbsp;request,&nbsp;which&nbsp;is&nbsp;typically&nbsp;less&nbsp;efficient&nbsp;than&nbsp;using&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5510907">//&nbsp;long-running&nbsp;server.&nbsp;&nbsp;This&nbsp;package&nbsp;is&nbsp;intended&nbsp;primarily&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5510971">//&nbsp;compatibility&nbsp;with&nbsp;existing&nbsp;systems.</span><br>
<span class="lineno">15</span><span class="keyword" id="5511011">package</span>&nbsp;<span class="ident" id="5511019">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5511024">import</span>&nbsp;<span class="op" id="5511031">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511034">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511043">&#34;fmt&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511050">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511056">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511063">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511075">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511081">&#34;os/exec&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511092">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511109">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511119">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511130">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511141">&#34;strings&#34;</span><br>
<span class="lineno">30</span><span class="op" id="5511151">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5511154">var</span>&nbsp;<span class="ident" id="5511158">trailingPort</span>&nbsp;<span class="op" id="5511171">=</span>&nbsp;<span class="ident" id="5511173">regexp</span><span class="op" id="5511179">.</span><span class="ident" id="5511180">MustCompile</span><span class="op" id="5511191">(</span><span class="string" id="5511192">`:([0-9]+)$`</span><span class="op" id="5511204">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5511207">var</span>&nbsp;<span class="ident" id="5511211">osDefaultInheritEnv</span>&nbsp;<span class="op" id="5511231">=</span>&nbsp;<span class="keyword" id="5511233">map</span><span class="op" id="5511236">[</span><span class="builtintype" id="5511237">string</span><span class="op" id="5511243">]</span><span class="op" id="5511244">[</span><span class="op" id="5511245">]</span><span class="builtintype" id="5511246">string</span><span class="op" id="5511252">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511255">&#34;darwin&#34;</span><span class="op" id="5511263">:</span>&nbsp;&nbsp;<span class="op" id="5511266">{</span><span class="string" id="5511267">&#34;DYLD_LIBRARY_PATH&#34;</span><span class="op" id="5511286">}</span><span class="op" id="5511287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511290">&#34;freebsd&#34;</span><span class="op" id="5511299">:</span>&nbsp;<span class="op" id="5511301">{</span><span class="string" id="5511302">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5511319">}</span><span class="op" id="5511320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511323">&#34;hpux&#34;</span><span class="op" id="5511329">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5511334">{</span><span class="string" id="5511335">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5511352">,</span>&nbsp;<span class="string" id="5511354">&#34;SHLIB_PATH&#34;</span><span class="op" id="5511366">}</span><span class="op" id="5511367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511370">&#34;irix&#34;</span><span class="op" id="5511376">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5511381">{</span><span class="string" id="5511382">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5511399">,</span>&nbsp;<span class="string" id="5511401">&#34;LD_LIBRARYN32_PATH&#34;</span><span class="op" id="5511421">,</span>&nbsp;<span class="string" id="5511423">&#34;LD_LIBRARY64_PATH&#34;</span><span class="op" id="5511442">}</span><span class="op" id="5511443">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511446">&#34;linux&#34;</span><span class="op" id="5511453">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5511457">{</span><span class="string" id="5511458">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5511475">}</span><span class="op" id="5511476">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511479">&#34;openbsd&#34;</span><span class="op" id="5511488">:</span>&nbsp;<span class="op" id="5511490">{</span><span class="string" id="5511491">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5511508">}</span><span class="op" id="5511509">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511512">&#34;solaris&#34;</span><span class="op" id="5511521">:</span>&nbsp;<span class="op" id="5511523">{</span><span class="string" id="5511524">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5511541">,</span>&nbsp;<span class="string" id="5511543">&#34;LD_LIBRARY_PATH_32&#34;</span><span class="op" id="5511563">,</span>&nbsp;<span class="string" id="5511565">&#34;LD_LIBRARY_PATH_64&#34;</span><span class="op" id="5511585">}</span><span class="op" id="5511586">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5511589">&#34;windows&#34;</span><span class="op" id="5511598">:</span>&nbsp;<span class="op" id="5511600">{</span><span class="string" id="5511601">&#34;SystemRoot&#34;</span><span class="op" id="5511613">,</span>&nbsp;<span class="string" id="5511615">&#34;COMSPEC&#34;</span><span class="op" id="5511624">,</span>&nbsp;<span class="string" id="5511626">&#34;PATHEXT&#34;</span><span class="op" id="5511635">,</span>&nbsp;<span class="string" id="5511637">&#34;WINDIR&#34;</span><span class="op" id="5511645">}</span><span class="op" id="5511646">,</span><br>
<span class="lineno"></span><span class="op" id="5511648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5511651">//&nbsp;Handler&nbsp;runs&nbsp;an&nbsp;executable&nbsp;in&nbsp;a&nbsp;subprocess&nbsp;with&nbsp;a&nbsp;CGI&nbsp;environment.</span><br>
<span class="lineno"></span><span class="keyword" id="5511721">type</span>&nbsp;<span class="ident" id="5511726">Handler</span>&nbsp;<span class="keyword" id="5511734">struct</span>&nbsp;<span class="op" id="5511741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511744">Path</span>&nbsp;<span class="builtintype" id="5511749">string</span>&nbsp;<span class="comment" id="5511756">//&nbsp;path&nbsp;to&nbsp;the&nbsp;CGI&nbsp;executable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511787">Root</span>&nbsp;<span class="builtintype" id="5511792">string</span>&nbsp;<span class="comment" id="5511799">//&nbsp;root&nbsp;URI&nbsp;prefix&nbsp;of&nbsp;handler&nbsp;or&nbsp;empty&nbsp;for&nbsp;&#34;/&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5511848">//&nbsp;Dir&nbsp;specifies&nbsp;the&nbsp;CGI&nbsp;executable&#39;s&nbsp;working&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5511906">//&nbsp;If&nbsp;Dir&nbsp;is&nbsp;empty,&nbsp;the&nbsp;base&nbsp;directory&nbsp;of&nbsp;Path&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5511963">//&nbsp;If&nbsp;Path&nbsp;has&nbsp;no&nbsp;base&nbsp;directory,&nbsp;the&nbsp;current&nbsp;working</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512018">//&nbsp;directory&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512041">Dir</span>&nbsp;<span class="builtintype" id="5512045">string</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512054">Env</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5512065">[</span><span class="op" id="5512066">]</span><span class="builtintype" id="5512067">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512077">//&nbsp;extra&nbsp;environment&nbsp;variables&nbsp;to&nbsp;set,&nbsp;if&nbsp;any,&nbsp;as&nbsp;&#34;key=value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512140">InheritEnv</span>&nbsp;<span class="op" id="5512151">[</span><span class="op" id="5512152">]</span><span class="builtintype" id="5512153">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512163">//&nbsp;environment&nbsp;variables&nbsp;to&nbsp;inherit&nbsp;from&nbsp;host,&nbsp;as&nbsp;&#34;key&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512220">Logger</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5512231">*</span><span class="ident" id="5512232">log</span><span class="op" id="5512235">.</span><span class="ident" id="5512236">Logger</span>&nbsp;<span class="comment" id="5512243">//&nbsp;optional&nbsp;log&nbsp;for&nbsp;errors&nbsp;or&nbsp;nil&nbsp;to&nbsp;use&nbsp;log.Print</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512295">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5512306">[</span><span class="op" id="5512307">]</span><span class="builtintype" id="5512308">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512318">//&nbsp;optional&nbsp;arguments&nbsp;to&nbsp;pass&nbsp;to&nbsp;child&nbsp;process</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512367">//&nbsp;PathLocationHandler&nbsp;specifies&nbsp;the&nbsp;root&nbsp;http&nbsp;Handler&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512428">//&nbsp;should&nbsp;handle&nbsp;internal&nbsp;redirects&nbsp;when&nbsp;the&nbsp;CGI&nbsp;process</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512486">//&nbsp;returns&nbsp;a&nbsp;Location&nbsp;header&nbsp;value&nbsp;starting&nbsp;with&nbsp;a&nbsp;&#34;/&#34;,&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512546">//&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;3875&nbsp;§&nbsp;6.3.2.&nbsp;This&nbsp;will&nbsp;likely&nbsp;be</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512602">//&nbsp;http.DefaultServeMux.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512628">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512632">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;CGI&nbsp;response&nbsp;with&nbsp;a&nbsp;local&nbsp;URI&nbsp;path&nbsp;is&nbsp;instead&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512697">//&nbsp;back&nbsp;to&nbsp;the&nbsp;client&nbsp;and&nbsp;not&nbsp;redirected&nbsp;internally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512751">PathLocationHandler</span>&nbsp;<span class="ident" id="5512771">http</span><span class="op" id="5512775">.</span><span class="ident" id="5512776">Handler</span><br>
<span class="lineno">70</span><span class="op" id="5512784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5512787">//&nbsp;removeLeadingDuplicates&nbsp;remove&nbsp;leading&nbsp;duplicate&nbsp;in&nbsp;environments.</span><br>
<span class="lineno"></span><span class="comment" id="5512856">//&nbsp;It&#39;s&nbsp;possible&nbsp;to&nbsp;override&nbsp;environment&nbsp;like&nbsp;following.</span><br>
<span class="lineno"></span><span class="comment" id="5512913">//&nbsp;&nbsp;&nbsp;&nbsp;cgi.Handler{</span><br>
<span class="lineno">75</span><span class="comment" id="5512932">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="5512944">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Env:&nbsp;[]string{&#34;SCRIPT_FILENAME=foo.php&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="5512994">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="keyword" id="5513002">func</span>&nbsp;<span class="ident" id="5513007">removeLeadingDuplicates</span><span class="op" id="5513030">(</span><span class="ident" id="5513031">env</span>&nbsp;<span class="op" id="5513035">[</span><span class="op" id="5513036">]</span><span class="builtintype" id="5513037">string</span><span class="op" id="5513043">)</span>&nbsp;<span class="op" id="5513045">(</span><span class="ident" id="5513046">ret</span>&nbsp;<span class="op" id="5513050">[</span><span class="op" id="5513051">]</span><span class="builtintype" id="5513052">string</span><span class="op" id="5513058">)</span>&nbsp;<span class="op" id="5513060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513063">n</span>&nbsp;<span class="op" id="5513065">:=</span>&nbsp;<span class="builtinfunc" id="5513068">len</span><span class="op" id="5513071">(</span><span class="ident" id="5513072">env</span><span class="op" id="5513075">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513078">for</span>&nbsp;<span class="ident" id="5513082">i</span>&nbsp;<span class="op" id="5513084">:=</span>&nbsp;<span class="num" id="5513087">0</span><span class="op" id="5513088">;</span>&nbsp;<span class="ident" id="5513090">i</span>&nbsp;<span class="op" id="5513092">&lt;</span>&nbsp;<span class="ident" id="5513094">n</span><span class="op" id="5513095">;</span>&nbsp;<span class="ident" id="5513097">i</span><span class="op" id="5513098">++</span>&nbsp;<span class="op" id="5513101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513105">e</span>&nbsp;<span class="op" id="5513107">:=</span>&nbsp;<span class="ident" id="5513110">env</span><span class="op" id="5513113">[</span><span class="ident" id="5513114">i</span><span class="op" id="5513115">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513119">s</span>&nbsp;<span class="op" id="5513121">:=</span>&nbsp;<span class="ident" id="5513124">strings</span><span class="op" id="5513131">.</span><span class="ident" id="5513132">SplitN</span><span class="op" id="5513138">(</span><span class="ident" id="5513139">e</span><span class="op" id="5513140">,</span>&nbsp;<span class="string" id="5513142">&#34;=&#34;</span><span class="op" id="5513145">,</span>&nbsp;<span class="num" id="5513147">2</span><span class="op" id="5513148">)</span><span class="op" id="5513149">[</span><span class="num" id="5513150">0</span><span class="op" id="5513151">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513155">found</span>&nbsp;<span class="op" id="5513161">:=</span>&nbsp;<span class="builtintype" id="5513164">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513172">for</span>&nbsp;<span class="ident" id="5513176">j</span>&nbsp;<span class="op" id="5513178">:=</span>&nbsp;<span class="ident" id="5513181">i</span>&nbsp;<span class="op" id="5513183">+</span>&nbsp;<span class="num" id="5513185">1</span><span class="op" id="5513186">;</span>&nbsp;<span class="ident" id="5513188">j</span>&nbsp;<span class="op" id="5513190">&lt;</span>&nbsp;<span class="ident" id="5513192">n</span><span class="op" id="5513193">;</span>&nbsp;<span class="ident" id="5513195">j</span><span class="op" id="5513196">++</span>&nbsp;<span class="op" id="5513199">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513204">if</span>&nbsp;<span class="ident" id="5513207">s</span>&nbsp;<span class="op" id="5513209">==</span>&nbsp;<span class="ident" id="5513212">strings</span><span class="op" id="5513219">.</span><span class="ident" id="5513220">SplitN</span><span class="op" id="5513226">(</span><span class="ident" id="5513227">env</span><span class="op" id="5513230">[</span><span class="ident" id="5513231">j</span><span class="op" id="5513232">]</span><span class="op" id="5513233">,</span>&nbsp;<span class="string" id="5513235">&#34;=&#34;</span><span class="op" id="5513238">,</span>&nbsp;<span class="num" id="5513240">2</span><span class="op" id="5513241">)</span><span class="op" id="5513242">[</span><span class="num" id="5513243">0</span><span class="op" id="5513244">]</span>&nbsp;<span class="op" id="5513246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513252">found</span>&nbsp;<span class="op" id="5513258">=</span>&nbsp;<span class="builtintype" id="5513260">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513269">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513282">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513286">if</span>&nbsp;<span class="op" id="5513289">!</span><span class="ident" id="5513290">found</span>&nbsp;<span class="op" id="5513296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513301">ret</span>&nbsp;<span class="op" id="5513305">=</span>&nbsp;<span class="builtinfunc" id="5513307">append</span><span class="op" id="5513313">(</span><span class="ident" id="5513314">ret</span><span class="op" id="5513317">,</span>&nbsp;<span class="ident" id="5513319">e</span><span class="op" id="5513320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513330">return</span><br>
<span class="lineno">95</span><span class="op" id="5513337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5513340">func</span>&nbsp;<span class="op" id="5513345">(</span><span class="ident" id="5513346">h</span>&nbsp;<span class="op" id="5513348">*</span><span class="ident" id="5513349">Handler</span><span class="op" id="5513356">)</span>&nbsp;<span class="ident" id="5513358">ServeHTTP</span><span class="op" id="5513367">(</span><span class="ident" id="5513368">rw</span>&nbsp;<span class="ident" id="5513371">http</span><span class="op" id="5513375">.</span><span class="ident" id="5513376">ResponseWriter</span><span class="op" id="5513390">,</span>&nbsp;<span class="ident" id="5513392">req</span>&nbsp;<span class="op" id="5513396">*</span><span class="ident" id="5513397">http</span><span class="op" id="5513401">.</span><span class="ident" id="5513402">Request</span><span class="op" id="5513409">)</span>&nbsp;<span class="op" id="5513411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513414">root</span>&nbsp;<span class="op" id="5513419">:=</span>&nbsp;<span class="ident" id="5513422">h</span><span class="op" id="5513423">.</span><span class="ident" id="5513424">Root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513430">if</span>&nbsp;<span class="ident" id="5513433">root</span>&nbsp;<span class="op" id="5513438">==</span>&nbsp;<span class="string" id="5513441">&#34;&#34;</span>&nbsp;<span class="op" id="5513444">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513448">root</span>&nbsp;<span class="op" id="5513453">=</span>&nbsp;<span class="string" id="5513455">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513464">if</span>&nbsp;<span class="builtinfunc" id="5513467">len</span><span class="op" id="5513470">(</span><span class="ident" id="5513471">req</span><span class="op" id="5513474">.</span><span class="ident" id="5513475">TransferEncoding</span><span class="op" id="5513491">)</span>&nbsp;<span class="op" id="5513493">&gt;</span>&nbsp;<span class="num" id="5513495">0</span>&nbsp;<span class="op" id="5513497">&amp;&amp;</span>&nbsp;<span class="ident" id="5513500">req</span><span class="op" id="5513503">.</span><span class="ident" id="5513504">TransferEncoding</span><span class="op" id="5513520">[</span><span class="num" id="5513521">0</span><span class="op" id="5513522">]</span>&nbsp;<span class="op" id="5513524">==</span>&nbsp;<span class="string" id="5513527">&#34;chunked&#34;</span>&nbsp;<span class="op" id="5513537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513541">rw</span><span class="op" id="5513543">.</span><span class="ident" id="5513544">WriteHeader</span><span class="op" id="5513555">(</span><span class="ident" id="5513556">http</span><span class="op" id="5513560">.</span><span class="ident" id="5513561">StatusBadRequest</span><span class="op" id="5513577">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513581">rw</span><span class="op" id="5513583">.</span><span class="ident" id="5513584">Write</span><span class="op" id="5513589">(</span><span class="op" id="5513590">[</span><span class="op" id="5513591">]</span><span class="builtintype" id="5513592">byte</span><span class="op" id="5513596">(</span><span class="string" id="5513597">&#34;Chunked&nbsp;request&nbsp;bodies&nbsp;are&nbsp;not&nbsp;supported&nbsp;by&nbsp;CGI.&#34;</span><span class="op" id="5513647">)</span><span class="op" id="5513648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513652">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513664">pathInfo</span>&nbsp;<span class="op" id="5513673">:=</span>&nbsp;<span class="ident" id="5513676">req</span><span class="op" id="5513679">.</span><span class="ident" id="5513680">URL</span><span class="op" id="5513683">.</span><span class="ident" id="5513684">Path</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513690">if</span>&nbsp;<span class="ident" id="5513693">root</span>&nbsp;<span class="op" id="5513698">!=</span>&nbsp;<span class="string" id="5513701">&#34;/&#34;</span>&nbsp;<span class="op" id="5513705">&amp;&amp;</span>&nbsp;<span class="ident" id="5513708">strings</span><span class="op" id="5513715">.</span><span class="ident" id="5513716">HasPrefix</span><span class="op" id="5513725">(</span><span class="ident" id="5513726">pathInfo</span><span class="op" id="5513734">,</span>&nbsp;<span class="ident" id="5513736">root</span><span class="op" id="5513740">)</span>&nbsp;<span class="op" id="5513742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513746">pathInfo</span>&nbsp;<span class="op" id="5513755">=</span>&nbsp;<span class="ident" id="5513757">pathInfo</span><span class="op" id="5513765">[</span><span class="builtinfunc" id="5513766">len</span><span class="op" id="5513769">(</span><span class="ident" id="5513770">root</span><span class="op" id="5513774">)</span><span class="op" id="5513775">:</span><span class="op" id="5513776">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513783">port</span>&nbsp;<span class="op" id="5513788">:=</span>&nbsp;<span class="string" id="5513791">&#34;80&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513797">if</span>&nbsp;<span class="ident" id="5513800">matches</span>&nbsp;<span class="op" id="5513808">:=</span>&nbsp;<span class="ident" id="5513811">trailingPort</span><span class="op" id="5513823">.</span><span class="ident" id="5513824">FindStringSubmatch</span><span class="op" id="5513842">(</span><span class="ident" id="5513843">req</span><span class="op" id="5513846">.</span><span class="ident" id="5513847">Host</span><span class="op" id="5513851">)</span><span class="op" id="5513852">;</span>&nbsp;<span class="builtinfunc" id="5513854">len</span><span class="op" id="5513857">(</span><span class="ident" id="5513858">matches</span><span class="op" id="5513865">)</span>&nbsp;<span class="op" id="5513867">!=</span>&nbsp;<span class="num" id="5513870">0</span>&nbsp;<span class="op" id="5513872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513876">port</span>&nbsp;<span class="op" id="5513881">=</span>&nbsp;<span class="ident" id="5513883">matches</span><span class="op" id="5513890">[</span><span class="num" id="5513891">1</span><span class="op" id="5513892">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513899">env</span>&nbsp;<span class="op" id="5513903">:=</span>&nbsp;<span class="op" id="5513906">[</span><span class="op" id="5513907">]</span><span class="builtintype" id="5513908">string</span><span class="op" id="5513914">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5513918">&#34;SERVER_SOFTWARE=go&#34;</span><span class="op" id="5513938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5513942">&#34;SERVER_NAME=&#34;</span>&nbsp;<span class="op" id="5513957">+</span>&nbsp;<span class="ident" id="5513959">req</span><span class="op" id="5513962">.</span><span class="ident" id="5513963">Host</span><span class="op" id="5513967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5513971">&#34;SERVER_PROTOCOL=HTTP/1.1&#34;</span><span class="op" id="5513997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5514001">&#34;HTTP_HOST=&#34;</span>&nbsp;<span class="op" id="5514014">+</span>&nbsp;<span class="ident" id="5514016">req</span><span class="op" id="5514019">.</span><span class="ident" id="5514020">Host</span><span class="op" id="5514024">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5514028">&#34;GATEWAY_INTERFACE=CGI/1.1&#34;</span><span class="op" id="5514055">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5514059">&#34;REQUEST_METHOD=&#34;</span>&nbsp;<span class="op" id="5514077">+</span>&nbsp;<span class="ident" id="5514079">req</span><span class="op" id="5514082">.</span><span class="ident" id="5514083">Method</span><span class="op" id="5514089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5514093">&#34;QUERY_STRING=&#34;</span>&nbsp;<span class="op" id="5514109">+</span>&nbsp;<span class="ident" id="5514111">req</span><span class="op" id="5514114">.</span><span class="ident" id="5514115">URL</span><span class="op" id="5514118">.</span><span class="ident" id="5514119">RawQuery</span><span class="op" id="5514127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5514131">&#34;REQUEST_URI=&#34;</span>&nbsp;<span class="op" id="5514146">+</span>&nbsp;<span class="ident" id="5514148">req</span><span class="op" id="5514151">.</span><span class="ident" id="5514152">URL</span><span class="op" id="5514155">.</span><span class="ident" id="5514156">RequestURI</span><span class="op" id="5514166">(</span><span class="op" id="5514167">)</span><span class="op" id="5514168">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5514172">&#34;PATH_INFO=&#34;</span>&nbsp;<span class="op" id="5514185">+</span>&nbsp;<span class="ident" id="5514187">pathInfo</span><span class="op" id="5514195">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5514199">&#34;SCRIPT_NAME=&#34;</span>&nbsp;<span class="op" id="5514214">+</span>&nbsp;<span class="ident" id="5514216">root</span><span class="op" id="5514220">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5514224">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="5514243">+</span>&nbsp;<span class="ident" id="5514245">h</span><span class="op" id="5514246">.</span><span class="ident" id="5514247">Path</span><span class="op" id="5514251">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5514255">&#34;REMOTE_ADDR=&#34;</span>&nbsp;<span class="op" id="5514270">+</span>&nbsp;<span class="ident" id="5514272">req</span><span class="op" id="5514275">.</span><span class="ident" id="5514276">RemoteAddr</span><span class="op" id="5514286">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5514290">&#34;REMOTE_HOST=&#34;</span>&nbsp;<span class="op" id="5514305">+</span>&nbsp;<span class="ident" id="5514307">req</span><span class="op" id="5514310">.</span><span class="ident" id="5514311">RemoteAddr</span><span class="op" id="5514321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5514325">&#34;SERVER_PORT=&#34;</span>&nbsp;<span class="op" id="5514340">+</span>&nbsp;<span class="ident" id="5514342">port</span><span class="op" id="5514346">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5514349">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5514353">if</span>&nbsp;<span class="ident" id="5514356">req</span><span class="op" id="5514359">.</span><span class="ident" id="5514360">TLS</span>&nbsp;<span class="op" id="5514364">!=</span>&nbsp;<span class="builtintype" id="5514367">nil</span>&nbsp;<span class="op" id="5514371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514375">env</span>&nbsp;<span class="op" id="5514379">=</span>&nbsp;<span class="builtinfunc" id="5514381">append</span><span class="op" id="5514387">(</span><span class="ident" id="5514388">env</span><span class="op" id="5514391">,</span>&nbsp;<span class="string" id="5514393">&#34;HTTPS=on&#34;</span><span class="op" id="5514403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5514406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5514410">for</span>&nbsp;<span class="ident" id="5514414">k</span><span class="op" id="5514415">,</span>&nbsp;<span class="ident" id="5514417">v</span>&nbsp;<span class="op" id="5514419">:=</span>&nbsp;<span class="keyword" id="5514422">range</span>&nbsp;<span class="ident" id="5514428">req</span><span class="op" id="5514431">.</span><span class="ident" id="5514432">Header</span>&nbsp;<span class="op" id="5514439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514443">k</span>&nbsp;<span class="op" id="5514445">=</span>&nbsp;<span class="ident" id="5514447">strings</span><span class="op" id="5514454">.</span><span class="ident" id="5514455">Map</span><span class="op" id="5514458">(</span><span class="ident" id="5514459">upperCaseAndUnderscore</span><span class="op" id="5514481">,</span>&nbsp;<span class="ident" id="5514483">k</span><span class="op" id="5514484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514488">joinStr</span>&nbsp;<span class="op" id="5514496">:=</span>&nbsp;<span class="string" id="5514499">&#34;,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5514506">if</span>&nbsp;<span class="ident" id="5514509">k</span>&nbsp;<span class="op" id="5514511">==</span>&nbsp;<span class="string" id="5514514">&#34;COOKIE&#34;</span>&nbsp;<span class="op" id="5514523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514528">joinStr</span>&nbsp;<span class="op" id="5514536">=</span>&nbsp;<span class="string" id="5514538">&#34;;&nbsp;&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5514545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514549">env</span>&nbsp;<span class="op" id="5514553">=</span>&nbsp;<span class="builtinfunc" id="5514555">append</span><span class="op" id="5514561">(</span><span class="ident" id="5514562">env</span><span class="op" id="5514565">,</span>&nbsp;<span class="string" id="5514567">&#34;HTTP_&#34;</span><span class="op" id="5514574">+</span><span class="ident" id="5514575">k</span><span class="op" id="5514576">+</span><span class="string" id="5514577">&#34;=&#34;</span><span class="op" id="5514580">+</span><span class="ident" id="5514581">strings</span><span class="op" id="5514588">.</span><span class="ident" id="5514589">Join</span><span class="op" id="5514593">(</span><span class="ident" id="5514594">v</span><span class="op" id="5514595">,</span>&nbsp;<span class="ident" id="5514597">joinStr</span><span class="op" id="5514604">)</span><span class="op" id="5514605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5514608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5514612">if</span>&nbsp;<span class="ident" id="5514615">req</span><span class="op" id="5514618">.</span><span class="ident" id="5514619">ContentLength</span>&nbsp;<span class="op" id="5514633">&gt;</span>&nbsp;<span class="num" id="5514635">0</span>&nbsp;<span class="op" id="5514637">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514641">env</span>&nbsp;<span class="op" id="5514645">=</span>&nbsp;<span class="builtinfunc" id="5514647">append</span><span class="op" id="5514653">(</span><span class="ident" id="5514654">env</span><span class="op" id="5514657">,</span>&nbsp;<span class="ident" id="5514659">fmt</span><span class="op" id="5514662">.</span><span class="ident" id="5514663">Sprintf</span><span class="op" id="5514670">(</span><span class="string" id="5514671">&#34;CONTENT_LENGTH=%d&#34;</span><span class="op" id="5514690">,</span>&nbsp;<span class="ident" id="5514692">req</span><span class="op" id="5514695">.</span><span class="ident" id="5514696">ContentLength</span><span class="op" id="5514709">)</span><span class="op" id="5514710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5514713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5514716">if</span>&nbsp;<span class="ident" id="5514719">ctype</span>&nbsp;<span class="op" id="5514725">:=</span>&nbsp;<span class="ident" id="5514728">req</span><span class="op" id="5514731">.</span><span class="ident" id="5514732">Header</span><span class="op" id="5514738">.</span><span class="ident" id="5514739">Get</span><span class="op" id="5514742">(</span><span class="string" id="5514743">&#34;Content-Type&#34;</span><span class="op" id="5514757">)</span><span class="op" id="5514758">;</span>&nbsp;<span class="ident" id="5514760">ctype</span>&nbsp;<span class="op" id="5514766">!=</span>&nbsp;<span class="string" id="5514769">&#34;&#34;</span>&nbsp;<span class="op" id="5514772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514776">env</span>&nbsp;<span class="op" id="5514780">=</span>&nbsp;<span class="builtinfunc" id="5514782">append</span><span class="op" id="5514788">(</span><span class="ident" id="5514789">env</span><span class="op" id="5514792">,</span>&nbsp;<span class="string" id="5514794">&#34;CONTENT_TYPE=&#34;</span><span class="op" id="5514809">+</span><span class="ident" id="5514810">ctype</span><span class="op" id="5514815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5514818">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5514822">if</span>&nbsp;<span class="ident" id="5514825">h</span><span class="op" id="5514826">.</span><span class="ident" id="5514827">Env</span>&nbsp;<span class="op" id="5514831">!=</span>&nbsp;<span class="builtintype" id="5514834">nil</span>&nbsp;<span class="op" id="5514838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514842">env</span>&nbsp;<span class="op" id="5514846">=</span>&nbsp;<span class="builtinfunc" id="5514848">append</span><span class="op" id="5514854">(</span><span class="ident" id="5514855">env</span><span class="op" id="5514858">,</span>&nbsp;<span class="ident" id="5514860">h</span><span class="op" id="5514861">.</span><span class="ident" id="5514862">Env</span><span class="op" id="5514865">...</span><span class="op" id="5514868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5514871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514875">envPath</span>&nbsp;<span class="op" id="5514883">:=</span>&nbsp;<span class="ident" id="5514886">os</span><span class="op" id="5514888">.</span><span class="ident" id="5514889">Getenv</span><span class="op" id="5514895">(</span><span class="string" id="5514896">&#34;PATH&#34;</span><span class="op" id="5514902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5514905">if</span>&nbsp;<span class="ident" id="5514908">envPath</span>&nbsp;<span class="op" id="5514916">==</span>&nbsp;<span class="string" id="5514919">&#34;&#34;</span>&nbsp;<span class="op" id="5514922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514926">envPath</span>&nbsp;<span class="op" id="5514934">=</span>&nbsp;<span class="string" id="5514936">&#34;/bin:/usr/bin:/usr/ucb:/usr/bsd:/usr/local/bin&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5514986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514989">env</span>&nbsp;<span class="op" id="5514993">=</span>&nbsp;<span class="builtinfunc" id="5514995">append</span><span class="op" id="5515001">(</span><span class="ident" id="5515002">env</span><span class="op" id="5515005">,</span>&nbsp;<span class="string" id="5515007">&#34;PATH=&#34;</span><span class="op" id="5515014">+</span><span class="ident" id="5515015">envPath</span><span class="op" id="5515022">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515026">for</span>&nbsp;<span class="ident" id="5515030">_</span><span class="op" id="5515031">,</span>&nbsp;<span class="ident" id="5515033">e</span>&nbsp;<span class="op" id="5515035">:=</span>&nbsp;<span class="keyword" id="5515038">range</span>&nbsp;<span class="ident" id="5515044">h</span><span class="op" id="5515045">.</span><span class="ident" id="5515046">InheritEnv</span>&nbsp;<span class="op" id="5515057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515061">if</span>&nbsp;<span class="ident" id="5515064">v</span>&nbsp;<span class="op" id="5515066">:=</span>&nbsp;<span class="ident" id="5515069">os</span><span class="op" id="5515071">.</span><span class="ident" id="5515072">Getenv</span><span class="op" id="5515078">(</span><span class="ident" id="5515079">e</span><span class="op" id="5515080">)</span><span class="op" id="5515081">;</span>&nbsp;<span class="ident" id="5515083">v</span>&nbsp;<span class="op" id="5515085">!=</span>&nbsp;<span class="string" id="5515088">&#34;&#34;</span>&nbsp;<span class="op" id="5515091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515096">env</span>&nbsp;<span class="op" id="5515100">=</span>&nbsp;<span class="builtinfunc" id="5515102">append</span><span class="op" id="5515108">(</span><span class="ident" id="5515109">env</span><span class="op" id="5515112">,</span>&nbsp;<span class="ident" id="5515114">e</span><span class="op" id="5515115">+</span><span class="string" id="5515116">&#34;=&#34;</span><span class="op" id="5515119">+</span><span class="ident" id="5515120">v</span><span class="op" id="5515121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515125">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515132">for</span>&nbsp;<span class="ident" id="5515136">_</span><span class="op" id="5515137">,</span>&nbsp;<span class="ident" id="5515139">e</span>&nbsp;<span class="op" id="5515141">:=</span>&nbsp;<span class="keyword" id="5515144">range</span>&nbsp;<span class="ident" id="5515150">osDefaultInheritEnv</span><span class="op" id="5515169">[</span><span class="ident" id="5515170">runtime</span><span class="op" id="5515177">.</span><span class="ident" id="5515178">GOOS</span><span class="op" id="5515182">]</span>&nbsp;<span class="op" id="5515184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515188">if</span>&nbsp;<span class="ident" id="5515191">v</span>&nbsp;<span class="op" id="5515193">:=</span>&nbsp;<span class="ident" id="5515196">os</span><span class="op" id="5515198">.</span><span class="ident" id="5515199">Getenv</span><span class="op" id="5515205">(</span><span class="ident" id="5515206">e</span><span class="op" id="5515207">)</span><span class="op" id="5515208">;</span>&nbsp;<span class="ident" id="5515210">v</span>&nbsp;<span class="op" id="5515212">!=</span>&nbsp;<span class="string" id="5515215">&#34;&#34;</span>&nbsp;<span class="op" id="5515218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515223">env</span>&nbsp;<span class="op" id="5515227">=</span>&nbsp;<span class="builtinfunc" id="5515229">append</span><span class="op" id="5515235">(</span><span class="ident" id="5515236">env</span><span class="op" id="5515239">,</span>&nbsp;<span class="ident" id="5515241">e</span><span class="op" id="5515242">+</span><span class="string" id="5515243">&#34;=&#34;</span><span class="op" id="5515246">+</span><span class="ident" id="5515247">v</span><span class="op" id="5515248">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515259">env</span>&nbsp;<span class="op" id="5515263">=</span>&nbsp;<span class="ident" id="5515265">removeLeadingDuplicates</span><span class="op" id="5515288">(</span><span class="ident" id="5515289">env</span><span class="op" id="5515292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515296">var</span>&nbsp;<span class="ident" id="5515300">cwd</span><span class="op" id="5515303">,</span>&nbsp;<span class="ident" id="5515305">path</span>&nbsp;<span class="builtintype" id="5515310">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515318">if</span>&nbsp;<span class="ident" id="5515321">h</span><span class="op" id="5515322">.</span><span class="ident" id="5515323">Dir</span>&nbsp;<span class="op" id="5515327">!=</span>&nbsp;<span class="string" id="5515330">&#34;&#34;</span>&nbsp;<span class="op" id="5515333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515337">path</span>&nbsp;<span class="op" id="5515342">=</span>&nbsp;<span class="ident" id="5515344">h</span><span class="op" id="5515345">.</span><span class="ident" id="5515346">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515353">cwd</span>&nbsp;<span class="op" id="5515357">=</span>&nbsp;<span class="ident" id="5515359">h</span><span class="op" id="5515360">.</span><span class="ident" id="5515361">Dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515366">}</span>&nbsp;<span class="keyword" id="5515368">else</span>&nbsp;<span class="op" id="5515373">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515377">cwd</span><span class="op" id="5515380">,</span>&nbsp;<span class="ident" id="5515382">path</span>&nbsp;<span class="op" id="5515387">=</span>&nbsp;<span class="ident" id="5515389">filepath</span><span class="op" id="5515397">.</span><span class="ident" id="5515398">Split</span><span class="op" id="5515403">(</span><span class="ident" id="5515404">h</span><span class="op" id="5515405">.</span><span class="ident" id="5515406">Path</span><span class="op" id="5515410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515416">if</span>&nbsp;<span class="ident" id="5515419">cwd</span>&nbsp;<span class="op" id="5515423">==</span>&nbsp;<span class="string" id="5515426">&#34;&#34;</span>&nbsp;<span class="op" id="5515429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515433">cwd</span>&nbsp;<span class="op" id="5515437">=</span>&nbsp;<span class="string" id="5515439">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515444">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515448">internalError</span>&nbsp;<span class="op" id="5515462">:=</span>&nbsp;<span class="keyword" id="5515465">func</span><span class="op" id="5515469">(</span><span class="ident" id="5515470">err</span>&nbsp;<span class="builtintype" id="5515474">error</span><span class="op" id="5515479">)</span>&nbsp;<span class="op" id="5515481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515485">rw</span><span class="op" id="5515487">.</span><span class="ident" id="5515488">WriteHeader</span><span class="op" id="5515499">(</span><span class="ident" id="5515500">http</span><span class="op" id="5515504">.</span><span class="ident" id="5515505">StatusInternalServerError</span><span class="op" id="5515530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515534">h</span><span class="op" id="5515535">.</span><span class="ident" id="5515536">printf</span><span class="op" id="5515542">(</span><span class="string" id="5515543">&#34;CGI&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="5515558">,</span>&nbsp;<span class="ident" id="5515560">err</span><span class="op" id="5515563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515566">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515570">cmd</span>&nbsp;<span class="op" id="5515574">:=</span>&nbsp;<span class="op" id="5515577">&amp;</span><span class="ident" id="5515578">exec</span><span class="op" id="5515582">.</span><span class="ident" id="5515583">Cmd</span><span class="op" id="5515586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515590">Path</span><span class="op" id="5515594">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5515598">path</span><span class="op" id="5515602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515606">Args</span><span class="op" id="5515610">:</span>&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5515614">append</span><span class="op" id="5515620">(</span><span class="op" id="5515621">[</span><span class="op" id="5515622">]</span><span class="builtintype" id="5515623">string</span><span class="op" id="5515629">{</span><span class="ident" id="5515630">h</span><span class="op" id="5515631">.</span><span class="ident" id="5515632">Path</span><span class="op" id="5515636">}</span><span class="op" id="5515637">,</span>&nbsp;<span class="ident" id="5515639">h</span><span class="op" id="5515640">.</span><span class="ident" id="5515641">Args</span><span class="op" id="5515645">...</span><span class="op" id="5515648">)</span><span class="op" id="5515649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515653">Dir</span><span class="op" id="5515656">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515661">cwd</span><span class="op" id="5515664">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515668">Env</span><span class="op" id="5515671">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515676">env</span><span class="op" id="5515679">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515683">Stderr</span><span class="op" id="5515689">:</span>&nbsp;<span class="ident" id="5515691">os</span><span class="op" id="5515693">.</span><span class="ident" id="5515694">Stderr</span><span class="op" id="5515700">,</span>&nbsp;<span class="comment" id="5515702">//&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515717">if</span>&nbsp;<span class="ident" id="5515720">req</span><span class="op" id="5515723">.</span><span class="ident" id="5515724">ContentLength</span>&nbsp;<span class="op" id="5515738">!=</span>&nbsp;<span class="num" id="5515741">0</span>&nbsp;<span class="op" id="5515743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515747">cmd</span><span class="op" id="5515750">.</span><span class="ident" id="5515751">Stdin</span>&nbsp;<span class="op" id="5515757">=</span>&nbsp;<span class="ident" id="5515759">req</span><span class="op" id="5515762">.</span><span class="ident" id="5515763">Body</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515772">stdoutRead</span><span class="op" id="5515782">,</span>&nbsp;<span class="ident" id="5515784">err</span>&nbsp;<span class="op" id="5515788">:=</span>&nbsp;<span class="ident" id="5515791">cmd</span><span class="op" id="5515794">.</span><span class="ident" id="5515795">StdoutPipe</span><span class="op" id="5515805">(</span><span class="op" id="5515806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515809">if</span>&nbsp;<span class="ident" id="5515812">err</span>&nbsp;<span class="op" id="5515816">!=</span>&nbsp;<span class="builtintype" id="5515819">nil</span>&nbsp;<span class="op" id="5515823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515827">internalError</span><span class="op" id="5515840">(</span><span class="ident" id="5515841">err</span><span class="op" id="5515844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515848">return</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515860">err</span>&nbsp;<span class="op" id="5515864">=</span>&nbsp;<span class="ident" id="5515866">cmd</span><span class="op" id="5515869">.</span><span class="ident" id="5515870">Start</span><span class="op" id="5515875">(</span><span class="op" id="5515876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515879">if</span>&nbsp;<span class="ident" id="5515882">err</span>&nbsp;<span class="op" id="5515886">!=</span>&nbsp;<span class="builtintype" id="5515889">nil</span>&nbsp;<span class="op" id="5515893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515897">internalError</span><span class="op" id="5515910">(</span><span class="ident" id="5515911">err</span><span class="op" id="5515914">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515918">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515929">if</span>&nbsp;<span class="ident" id="5515932">hook</span>&nbsp;<span class="op" id="5515937">:=</span>&nbsp;<span class="ident" id="5515940">testHookStartProcess</span><span class="op" id="5515960">;</span>&nbsp;<span class="ident" id="5515962">hook</span>&nbsp;<span class="op" id="5515967">!=</span>&nbsp;<span class="builtintype" id="5515970">nil</span>&nbsp;<span class="op" id="5515974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515978">hook</span><span class="op" id="5515982">(</span><span class="ident" id="5515983">cmd</span><span class="op" id="5515986">.</span><span class="ident" id="5515987">Process</span><span class="op" id="5515994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515997">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516000">defer</span>&nbsp;<span class="ident" id="5516006">cmd</span><span class="op" id="5516009">.</span><span class="ident" id="5516010">Wait</span><span class="op" id="5516014">(</span><span class="op" id="5516015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516018">defer</span>&nbsp;<span class="ident" id="5516024">stdoutRead</span><span class="op" id="5516034">.</span><span class="ident" id="5516035">Close</span><span class="op" id="5516040">(</span><span class="op" id="5516041">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516045">linebody</span>&nbsp;<span class="op" id="5516054">:=</span>&nbsp;<span class="ident" id="5516057">bufio</span><span class="op" id="5516062">.</span><span class="ident" id="5516063">NewReaderSize</span><span class="op" id="5516076">(</span><span class="ident" id="5516077">stdoutRead</span><span class="op" id="5516087">,</span>&nbsp;<span class="num" id="5516089">1024</span><span class="op" id="5516093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516096">headers</span>&nbsp;<span class="op" id="5516104">:=</span>&nbsp;<span class="builtinfunc" id="5516107">make</span><span class="op" id="5516111">(</span><span class="ident" id="5516112">http</span><span class="op" id="5516116">.</span><span class="ident" id="5516117">Header</span><span class="op" id="5516123">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516126">statusCode</span>&nbsp;<span class="op" id="5516137">:=</span>&nbsp;<span class="num" id="5516140">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516143">headerLines</span>&nbsp;<span class="op" id="5516155">:=</span>&nbsp;<span class="num" id="5516158">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516161">sawBlankLine</span>&nbsp;<span class="op" id="5516174">:=</span>&nbsp;<span class="builtintype" id="5516177">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516184">for</span>&nbsp;<span class="op" id="5516188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516192">line</span><span class="op" id="5516196">,</span>&nbsp;<span class="ident" id="5516198">isPrefix</span><span class="op" id="5516206">,</span>&nbsp;<span class="ident" id="5516208">err</span>&nbsp;<span class="op" id="5516212">:=</span>&nbsp;<span class="ident" id="5516215">linebody</span><span class="op" id="5516223">.</span><span class="ident" id="5516224">ReadLine</span><span class="op" id="5516232">(</span><span class="op" id="5516233">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516237">if</span>&nbsp;<span class="ident" id="5516240">isPrefix</span>&nbsp;<span class="op" id="5516249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516254">rw</span><span class="op" id="5516256">.</span><span class="ident" id="5516257">WriteHeader</span><span class="op" id="5516268">(</span><span class="ident" id="5516269">http</span><span class="op" id="5516273">.</span><span class="ident" id="5516274">StatusInternalServerError</span><span class="op" id="5516299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516304">h</span><span class="op" id="5516305">.</span><span class="ident" id="5516306">printf</span><span class="op" id="5516312">(</span><span class="string" id="5516313">&#34;cgi:&nbsp;long&nbsp;header&nbsp;line&nbsp;from&nbsp;subprocess.&#34;</span><span class="op" id="5516353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516358">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5516367">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516371">if</span>&nbsp;<span class="ident" id="5516374">err</span>&nbsp;<span class="op" id="5516378">==</span>&nbsp;<span class="ident" id="5516381">io</span><span class="op" id="5516383">.</span><span class="ident" id="5516384">EOF</span>&nbsp;<span class="op" id="5516388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516393">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5516401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516405">if</span>&nbsp;<span class="ident" id="5516408">err</span>&nbsp;<span class="op" id="5516412">!=</span>&nbsp;<span class="builtintype" id="5516415">nil</span>&nbsp;<span class="op" id="5516419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516424">rw</span><span class="op" id="5516426">.</span><span class="ident" id="5516427">WriteHeader</span><span class="op" id="5516438">(</span><span class="ident" id="5516439">http</span><span class="op" id="5516443">.</span><span class="ident" id="5516444">StatusInternalServerError</span><span class="op" id="5516469">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516474">h</span><span class="op" id="5516475">.</span><span class="ident" id="5516476">printf</span><span class="op" id="5516482">(</span><span class="string" id="5516483">&#34;cgi:&nbsp;error&nbsp;reading&nbsp;headers:&nbsp;%v&#34;</span><span class="op" id="5516515">,</span>&nbsp;<span class="ident" id="5516517">err</span><span class="op" id="5516520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516525">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5516534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516538">if</span>&nbsp;<span class="builtinfunc" id="5516541">len</span><span class="op" id="5516544">(</span><span class="ident" id="5516545">line</span><span class="op" id="5516549">)</span>&nbsp;<span class="op" id="5516551">==</span>&nbsp;<span class="num" id="5516554">0</span>&nbsp;<span class="op" id="5516556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516561">sawBlankLine</span>&nbsp;<span class="op" id="5516574">=</span>&nbsp;<span class="builtintype" id="5516576">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516584">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5516592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516596">headerLines</span><span class="op" id="5516607">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516612">parts</span>&nbsp;<span class="op" id="5516618">:=</span>&nbsp;<span class="ident" id="5516621">strings</span><span class="op" id="5516628">.</span><span class="ident" id="5516629">SplitN</span><span class="op" id="5516635">(</span><span class="builtintype" id="5516636">string</span><span class="op" id="5516642">(</span><span class="ident" id="5516643">line</span><span class="op" id="5516647">)</span><span class="op" id="5516648">,</span>&nbsp;<span class="string" id="5516650">&#34;:&#34;</span><span class="op" id="5516653">,</span>&nbsp;<span class="num" id="5516655">2</span><span class="op" id="5516656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516660">if</span>&nbsp;<span class="builtinfunc" id="5516663">len</span><span class="op" id="5516666">(</span><span class="ident" id="5516667">parts</span><span class="op" id="5516672">)</span>&nbsp;<span class="op" id="5516674">&lt;</span>&nbsp;<span class="num" id="5516676">2</span>&nbsp;<span class="op" id="5516678">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516683">h</span><span class="op" id="5516684">.</span><span class="ident" id="5516685">printf</span><span class="op" id="5516691">(</span><span class="string" id="5516692">&#34;cgi:&nbsp;bogus&nbsp;header&nbsp;line:&nbsp;%s&#34;</span><span class="op" id="5516720">,</span>&nbsp;<span class="builtintype" id="5516722">string</span><span class="op" id="5516728">(</span><span class="ident" id="5516729">line</span><span class="op" id="5516733">)</span><span class="op" id="5516734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516739">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5516750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516754">header</span><span class="op" id="5516760">,</span>&nbsp;<span class="ident" id="5516762">val</span>&nbsp;<span class="op" id="5516766">:=</span>&nbsp;<span class="ident" id="5516769">parts</span><span class="op" id="5516774">[</span><span class="num" id="5516775">0</span><span class="op" id="5516776">]</span><span class="op" id="5516777">,</span>&nbsp;<span class="ident" id="5516779">parts</span><span class="op" id="5516784">[</span><span class="num" id="5516785">1</span><span class="op" id="5516786">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516790">header</span>&nbsp;<span class="op" id="5516797">=</span>&nbsp;<span class="ident" id="5516799">strings</span><span class="op" id="5516806">.</span><span class="ident" id="5516807">TrimSpace</span><span class="op" id="5516816">(</span><span class="ident" id="5516817">header</span><span class="op" id="5516823">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516827">val</span>&nbsp;<span class="op" id="5516831">=</span>&nbsp;<span class="ident" id="5516833">strings</span><span class="op" id="5516840">.</span><span class="ident" id="5516841">TrimSpace</span><span class="op" id="5516850">(</span><span class="ident" id="5516851">val</span><span class="op" id="5516854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516858">switch</span>&nbsp;<span class="op" id="5516865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516869">case</span>&nbsp;<span class="ident" id="5516874">header</span>&nbsp;<span class="op" id="5516881">==</span>&nbsp;<span class="string" id="5516884">&#34;Status&#34;</span><span class="op" id="5516892">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516897">if</span>&nbsp;<span class="builtinfunc" id="5516900">len</span><span class="op" id="5516903">(</span><span class="ident" id="5516904">val</span><span class="op" id="5516907">)</span>&nbsp;<span class="op" id="5516909">&lt;</span>&nbsp;<span class="num" id="5516911">3</span>&nbsp;<span class="op" id="5516913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516919">h</span><span class="op" id="5516920">.</span><span class="ident" id="5516921">printf</span><span class="op" id="5516927">(</span><span class="string" id="5516928">&#34;cgi:&nbsp;bogus&nbsp;status&nbsp;(short):&nbsp;%q&#34;</span><span class="op" id="5516959">,</span>&nbsp;<span class="ident" id="5516961">val</span><span class="op" id="5516964">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516970">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5516980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516985">code</span><span class="op" id="5516989">,</span>&nbsp;<span class="ident" id="5516991">err</span>&nbsp;<span class="op" id="5516995">:=</span>&nbsp;<span class="ident" id="5516998">strconv</span><span class="op" id="5517005">.</span><span class="ident" id="5517006">Atoi</span><span class="op" id="5517010">(</span><span class="ident" id="5517011">val</span><span class="op" id="5517014">[</span><span class="num" id="5517015">0</span><span class="op" id="5517016">:</span><span class="num" id="5517017">3</span><span class="op" id="5517018">]</span><span class="op" id="5517019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517024">if</span>&nbsp;<span class="ident" id="5517027">err</span>&nbsp;<span class="op" id="5517031">!=</span>&nbsp;<span class="builtintype" id="5517034">nil</span>&nbsp;<span class="op" id="5517038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517044">h</span><span class="op" id="5517045">.</span><span class="ident" id="5517046">printf</span><span class="op" id="5517052">(</span><span class="string" id="5517053">&#34;cgi:&nbsp;bogus&nbsp;status:&nbsp;%q&#34;</span><span class="op" id="5517076">,</span>&nbsp;<span class="ident" id="5517078">val</span><span class="op" id="5517081">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517087">h</span><span class="op" id="5517088">.</span><span class="ident" id="5517089">printf</span><span class="op" id="5517095">(</span><span class="string" id="5517096">&#34;cgi:&nbsp;line&nbsp;was&nbsp;%q&#34;</span><span class="op" id="5517114">,</span>&nbsp;<span class="ident" id="5517116">line</span><span class="op" id="5517120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517126">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517141">statusCode</span>&nbsp;<span class="op" id="5517152">=</span>&nbsp;<span class="ident" id="5517154">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517161">default</span><span class="op" id="5517168">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517173">headers</span><span class="op" id="5517180">.</span><span class="ident" id="5517181">Add</span><span class="op" id="5517184">(</span><span class="ident" id="5517185">header</span><span class="op" id="5517191">,</span>&nbsp;<span class="ident" id="5517193">val</span><span class="op" id="5517196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517206">if</span>&nbsp;<span class="ident" id="5517209">headerLines</span>&nbsp;<span class="op" id="5517221">==</span>&nbsp;<span class="num" id="5517224">0</span>&nbsp;<span class="op" id="5517226">||</span>&nbsp;<span class="op" id="5517229">!</span><span class="ident" id="5517230">sawBlankLine</span>&nbsp;<span class="op" id="5517243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517247">rw</span><span class="op" id="5517249">.</span><span class="ident" id="5517250">WriteHeader</span><span class="op" id="5517261">(</span><span class="ident" id="5517262">http</span><span class="op" id="5517266">.</span><span class="ident" id="5517267">StatusInternalServerError</span><span class="op" id="5517292">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517296">h</span><span class="op" id="5517297">.</span><span class="ident" id="5517298">printf</span><span class="op" id="5517304">(</span><span class="string" id="5517305">&#34;cgi:&nbsp;no&nbsp;headers&#34;</span><span class="op" id="5517322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517326">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517338">if</span>&nbsp;<span class="ident" id="5517341">loc</span>&nbsp;<span class="op" id="5517345">:=</span>&nbsp;<span class="ident" id="5517348">headers</span><span class="op" id="5517355">.</span><span class="ident" id="5517356">Get</span><span class="op" id="5517359">(</span><span class="string" id="5517360">&#34;Location&#34;</span><span class="op" id="5517370">)</span><span class="op" id="5517371">;</span>&nbsp;<span class="ident" id="5517373">loc</span>&nbsp;<span class="op" id="5517377">!=</span>&nbsp;<span class="string" id="5517380">&#34;&#34;</span>&nbsp;<span class="op" id="5517383">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517387">if</span>&nbsp;<span class="ident" id="5517390">strings</span><span class="op" id="5517397">.</span><span class="ident" id="5517398">HasPrefix</span><span class="op" id="5517407">(</span><span class="ident" id="5517408">loc</span><span class="op" id="5517411">,</span>&nbsp;<span class="string" id="5517413">&#34;/&#34;</span><span class="op" id="5517416">)</span>&nbsp;<span class="op" id="5517418">&amp;&amp;</span>&nbsp;<span class="ident" id="5517421">h</span><span class="op" id="5517422">.</span><span class="ident" id="5517423">PathLocationHandler</span>&nbsp;<span class="op" id="5517443">!=</span>&nbsp;<span class="builtintype" id="5517446">nil</span>&nbsp;<span class="op" id="5517450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517455">h</span><span class="op" id="5517456">.</span><span class="ident" id="5517457">handleInternalRedirect</span><span class="op" id="5517479">(</span><span class="ident" id="5517480">rw</span><span class="op" id="5517482">,</span>&nbsp;<span class="ident" id="5517484">req</span><span class="op" id="5517487">,</span>&nbsp;<span class="ident" id="5517489">loc</span><span class="op" id="5517492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517497">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517510">if</span>&nbsp;<span class="ident" id="5517513">statusCode</span>&nbsp;<span class="op" id="5517524">==</span>&nbsp;<span class="num" id="5517527">0</span>&nbsp;<span class="op" id="5517529">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517534">statusCode</span>&nbsp;<span class="op" id="5517545">=</span>&nbsp;<span class="ident" id="5517547">http</span><span class="op" id="5517551">.</span><span class="ident" id="5517552">StatusFound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517573">if</span>&nbsp;<span class="ident" id="5517576">statusCode</span>&nbsp;<span class="op" id="5517587">==</span>&nbsp;<span class="num" id="5517590">0</span>&nbsp;<span class="op" id="5517592">&amp;&amp;</span>&nbsp;<span class="ident" id="5517595">headers</span><span class="op" id="5517602">.</span><span class="ident" id="5517603">Get</span><span class="op" id="5517606">(</span><span class="string" id="5517607">&#34;Content-Type&#34;</span><span class="op" id="5517621">)</span>&nbsp;<span class="op" id="5517623">==</span>&nbsp;<span class="string" id="5517626">&#34;&#34;</span>&nbsp;<span class="op" id="5517629">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517633">rw</span><span class="op" id="5517635">.</span><span class="ident" id="5517636">WriteHeader</span><span class="op" id="5517647">(</span><span class="ident" id="5517648">http</span><span class="op" id="5517652">.</span><span class="ident" id="5517653">StatusInternalServerError</span><span class="op" id="5517678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517682">h</span><span class="op" id="5517683">.</span><span class="ident" id="5517684">printf</span><span class="op" id="5517690">(</span><span class="string" id="5517691">&#34;cgi:&nbsp;missing&nbsp;required&nbsp;Content-Type&nbsp;in&nbsp;headers&#34;</span><span class="op" id="5517738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517742">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517754">if</span>&nbsp;<span class="ident" id="5517757">statusCode</span>&nbsp;<span class="op" id="5517768">==</span>&nbsp;<span class="num" id="5517771">0</span>&nbsp;<span class="op" id="5517773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517777">statusCode</span>&nbsp;<span class="op" id="5517788">=</span>&nbsp;<span class="ident" id="5517790">http</span><span class="op" id="5517794">.</span><span class="ident" id="5517795">StatusOK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5517809">//&nbsp;Copy&nbsp;headers&nbsp;to&nbsp;rw&#39;s&nbsp;headers,&nbsp;after&nbsp;we&#39;ve&nbsp;decided&nbsp;not&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5517870">//&nbsp;go&nbsp;into&nbsp;handleInternalRedirect,&nbsp;which&nbsp;won&#39;t&nbsp;want&nbsp;its&nbsp;rw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5517930">//&nbsp;headers&nbsp;to&nbsp;have&nbsp;been&nbsp;touched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517964">for</span>&nbsp;<span class="ident" id="5517968">k</span><span class="op" id="5517969">,</span>&nbsp;<span class="ident" id="5517971">vv</span>&nbsp;<span class="op" id="5517974">:=</span>&nbsp;<span class="keyword" id="5517977">range</span>&nbsp;<span class="ident" id="5517983">headers</span>&nbsp;<span class="op" id="5517991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517995">for</span>&nbsp;<span class="ident" id="5517999">_</span><span class="op" id="5518000">,</span>&nbsp;<span class="ident" id="5518002">v</span>&nbsp;<span class="op" id="5518004">:=</span>&nbsp;<span class="keyword" id="5518007">range</span>&nbsp;<span class="ident" id="5518013">vv</span>&nbsp;<span class="op" id="5518016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518021">rw</span><span class="op" id="5518023">.</span><span class="ident" id="5518024">Header</span><span class="op" id="5518030">(</span><span class="op" id="5518031">)</span><span class="op" id="5518032">.</span><span class="ident" id="5518033">Add</span><span class="op" id="5518036">(</span><span class="ident" id="5518037">k</span><span class="op" id="5518038">,</span>&nbsp;<span class="ident" id="5518040">v</span><span class="op" id="5518041">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518052">rw</span><span class="op" id="5518054">.</span><span class="ident" id="5518055">WriteHeader</span><span class="op" id="5518066">(</span><span class="ident" id="5518067">statusCode</span><span class="op" id="5518077">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518081">_</span><span class="op" id="5518082">,</span>&nbsp;<span class="ident" id="5518084">err</span>&nbsp;<span class="op" id="5518088">=</span>&nbsp;<span class="ident" id="5518090">io</span><span class="op" id="5518092">.</span><span class="ident" id="5518093">Copy</span><span class="op" id="5518097">(</span><span class="ident" id="5518098">rw</span><span class="op" id="5518100">,</span>&nbsp;<span class="ident" id="5518102">linebody</span><span class="op" id="5518110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518113">if</span>&nbsp;<span class="ident" id="5518116">err</span>&nbsp;<span class="op" id="5518120">!=</span>&nbsp;<span class="builtintype" id="5518123">nil</span>&nbsp;<span class="op" id="5518127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518131">h</span><span class="op" id="5518132">.</span><span class="ident" id="5518133">printf</span><span class="op" id="5518139">(</span><span class="string" id="5518140">&#34;cgi:&nbsp;copy&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="5518161">,</span>&nbsp;<span class="ident" id="5518163">err</span><span class="op" id="5518166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518170">//&nbsp;And&nbsp;kill&nbsp;the&nbsp;child&nbsp;CGI&nbsp;process&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;hang&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518226">//&nbsp;the&nbsp;deferred&nbsp;cmd.Wait&nbsp;above&nbsp;if&nbsp;the&nbsp;error&nbsp;was&nbsp;just</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518281">//&nbsp;the&nbsp;client&nbsp;(rw)&nbsp;going&nbsp;away.&nbsp;If&nbsp;it&nbsp;was&nbsp;a&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518337">//&nbsp;(because&nbsp;the&nbsp;child&nbsp;died&nbsp;itself),&nbsp;then&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518390">//&nbsp;kill&nbsp;of&nbsp;an&nbsp;already-dead&nbsp;process&nbsp;is&nbsp;harmless&nbsp;(the&nbsp;PID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518448">//&nbsp;won&#39;t&nbsp;be&nbsp;reused&nbsp;until&nbsp;the&nbsp;Wait&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518492">cmd</span><span class="op" id="5518495">.</span><span class="ident" id="5518496">Process</span><span class="op" id="5518503">.</span><span class="ident" id="5518504">Kill</span><span class="op" id="5518508">(</span><span class="op" id="5518509">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518512">}</span><br>
<span class="lineno"></span><span class="op" id="5518514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5518517">func</span>&nbsp;<span class="op" id="5518522">(</span><span class="ident" id="5518523">h</span>&nbsp;<span class="op" id="5518525">*</span><span class="ident" id="5518526">Handler</span><span class="op" id="5518533">)</span>&nbsp;<span class="ident" id="5518535">printf</span><span class="op" id="5518541">(</span><span class="ident" id="5518542">format</span>&nbsp;<span class="builtintype" id="5518549">string</span><span class="op" id="5518555">,</span>&nbsp;<span class="ident" id="5518557">v</span>&nbsp;<span class="op" id="5518559">...</span><span class="keyword" id="5518562">interface</span><span class="op" id="5518571">{</span><span class="op" id="5518572">}</span><span class="op" id="5518573">)</span>&nbsp;<span class="op" id="5518575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518578">if</span>&nbsp;<span class="ident" id="5518581">h</span><span class="op" id="5518582">.</span><span class="ident" id="5518583">Logger</span>&nbsp;<span class="op" id="5518590">!=</span>&nbsp;<span class="builtintype" id="5518593">nil</span>&nbsp;<span class="op" id="5518597">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518601">h</span><span class="op" id="5518602">.</span><span class="ident" id="5518603">Logger</span><span class="op" id="5518609">.</span><span class="ident" id="5518610">Printf</span><span class="op" id="5518616">(</span><span class="ident" id="5518617">format</span><span class="op" id="5518623">,</span>&nbsp;<span class="ident" id="5518625">v</span><span class="op" id="5518626">...</span><span class="op" id="5518629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518632">}</span>&nbsp;<span class="keyword" id="5518634">else</span>&nbsp;<span class="op" id="5518639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518643">log</span><span class="op" id="5518646">.</span><span class="ident" id="5518647">Printf</span><span class="op" id="5518653">(</span><span class="ident" id="5518654">format</span><span class="op" id="5518660">,</span>&nbsp;<span class="ident" id="5518662">v</span><span class="op" id="5518663">...</span><span class="op" id="5518666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518669">}</span><br>
<span class="lineno"></span><span class="op" id="5518671">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="5518674">func</span>&nbsp;<span class="op" id="5518679">(</span><span class="ident" id="5518680">h</span>&nbsp;<span class="op" id="5518682">*</span><span class="ident" id="5518683">Handler</span><span class="op" id="5518690">)</span>&nbsp;<span class="ident" id="5518692">handleInternalRedirect</span><span class="op" id="5518714">(</span><span class="ident" id="5518715">rw</span>&nbsp;<span class="ident" id="5518718">http</span><span class="op" id="5518722">.</span><span class="ident" id="5518723">ResponseWriter</span><span class="op" id="5518737">,</span>&nbsp;<span class="ident" id="5518739">req</span>&nbsp;<span class="op" id="5518743">*</span><span class="ident" id="5518744">http</span><span class="op" id="5518748">.</span><span class="ident" id="5518749">Request</span><span class="op" id="5518756">,</span>&nbsp;<span class="ident" id="5518758">path</span>&nbsp;<span class="builtintype" id="5518763">string</span><span class="op" id="5518769">)</span>&nbsp;<span class="op" id="5518771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518774">url</span><span class="op" id="5518777">,</span>&nbsp;<span class="ident" id="5518779">err</span>&nbsp;<span class="op" id="5518783">:=</span>&nbsp;<span class="ident" id="5518786">req</span><span class="op" id="5518789">.</span><span class="ident" id="5518790">URL</span><span class="op" id="5518793">.</span><span class="ident" id="5518794">Parse</span><span class="op" id="5518799">(</span><span class="ident" id="5518800">path</span><span class="op" id="5518804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518807">if</span>&nbsp;<span class="ident" id="5518810">err</span>&nbsp;<span class="op" id="5518814">!=</span>&nbsp;<span class="builtintype" id="5518817">nil</span>&nbsp;<span class="op" id="5518821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518825">rw</span><span class="op" id="5518827">.</span><span class="ident" id="5518828">WriteHeader</span><span class="op" id="5518839">(</span><span class="ident" id="5518840">http</span><span class="op" id="5518844">.</span><span class="ident" id="5518845">StatusInternalServerError</span><span class="op" id="5518870">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518874">h</span><span class="op" id="5518875">.</span><span class="ident" id="5518876">printf</span><span class="op" id="5518882">(</span><span class="string" id="5518883">&#34;cgi:&nbsp;error&nbsp;resolving&nbsp;local&nbsp;URI&nbsp;path&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="5518927">,</span>&nbsp;<span class="ident" id="5518929">path</span><span class="op" id="5518933">,</span>&nbsp;<span class="ident" id="5518935">err</span><span class="op" id="5518938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518942">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518953">//&nbsp;TODO:&nbsp;RFC&nbsp;3875&nbsp;isn&#39;t&nbsp;clear&nbsp;if&nbsp;only&nbsp;GET&nbsp;is&nbsp;supported,&nbsp;but&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5519017">//&nbsp;suggests&nbsp;so:&nbsp;&#34;Note&nbsp;that&nbsp;any&nbsp;message-body&nbsp;attached&nbsp;to&nbsp;the</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5519078">//&nbsp;request&nbsp;(such&nbsp;as&nbsp;for&nbsp;a&nbsp;POST&nbsp;request)&nbsp;may&nbsp;not&nbsp;be&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5519140">//&nbsp;to&nbsp;the&nbsp;resource&nbsp;that&nbsp;is&nbsp;the&nbsp;target&nbsp;of&nbsp;the&nbsp;redirect.&#34;&nbsp;&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5519201">//&nbsp;should&nbsp;do&nbsp;some&nbsp;tests&nbsp;against&nbsp;Apache&nbsp;to&nbsp;see&nbsp;how&nbsp;it&nbsp;handles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5519263">//&nbsp;POST,&nbsp;HEAD,&nbsp;etc.&nbsp;Does&nbsp;the&nbsp;internal&nbsp;redirect&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5519324">//&nbsp;method&nbsp;or&nbsp;just&nbsp;GET?&nbsp;What&nbsp;about&nbsp;incoming&nbsp;headers?</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5519377">//&nbsp;(e.g.&nbsp;Cookies)&nbsp;Which&nbsp;headers,&nbsp;if&nbsp;any,&nbsp;are&nbsp;copied&nbsp;into&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5519439">//&nbsp;second&nbsp;request?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519459">newReq</span>&nbsp;<span class="op" id="5519466">:=</span>&nbsp;<span class="op" id="5519469">&amp;</span><span class="ident" id="5519470">http</span><span class="op" id="5519474">.</span><span class="ident" id="5519475">Request</span><span class="op" id="5519482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519486">Method</span><span class="op" id="5519492">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5519498">&#34;GET&#34;</span><span class="op" id="5519503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519507">URL</span><span class="op" id="5519510">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519519">url</span><span class="op" id="5519522">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519526">Proto</span><span class="op" id="5519531">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5519538">&#34;HTTP/1.1&#34;</span><span class="op" id="5519548">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519552">ProtoMajor</span><span class="op" id="5519562">:</span>&nbsp;<span class="num" id="5519564">1</span><span class="op" id="5519565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519569">ProtoMinor</span><span class="op" id="5519579">:</span>&nbsp;<span class="num" id="5519581">1</span><span class="op" id="5519582">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519586">Header</span><span class="op" id="5519592">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5519598">make</span><span class="op" id="5519602">(</span><span class="ident" id="5519603">http</span><span class="op" id="5519607">.</span><span class="ident" id="5519608">Header</span><span class="op" id="5519614">)</span><span class="op" id="5519615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519619">Host</span><span class="op" id="5519623">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519631">url</span><span class="op" id="5519634">.</span><span class="ident" id="5519635">Host</span><span class="op" id="5519639">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519643">RemoteAddr</span><span class="op" id="5519653">:</span>&nbsp;<span class="ident" id="5519655">req</span><span class="op" id="5519658">.</span><span class="ident" id="5519659">RemoteAddr</span><span class="op" id="5519669">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519673">TLS</span><span class="op" id="5519676">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519685">req</span><span class="op" id="5519688">.</span><span class="ident" id="5519689">TLS</span><span class="op" id="5519692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5519695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519698">h</span><span class="op" id="5519699">.</span><span class="ident" id="5519700">PathLocationHandler</span><span class="op" id="5519719">.</span><span class="ident" id="5519720">ServeHTTP</span><span class="op" id="5519729">(</span><span class="ident" id="5519730">rw</span><span class="op" id="5519732">,</span>&nbsp;<span class="ident" id="5519734">newReq</span><span class="op" id="5519740">)</span><br>
<span class="lineno"></span><span class="op" id="5519742">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="5519745">func</span>&nbsp;<span class="ident" id="5519750">upperCaseAndUnderscore</span><span class="op" id="5519772">(</span><span class="ident" id="5519773">r</span>&nbsp;<span class="builtintype" id="5519775">rune</span><span class="op" id="5519779">)</span>&nbsp;<span class="builtintype" id="5519781">rune</span>&nbsp;<span class="op" id="5519786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5519789">switch</span>&nbsp;<span class="op" id="5519796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5519799">case</span>&nbsp;<span class="ident" id="5519804">r</span>&nbsp;<span class="op" id="5519806">&gt;=</span>&nbsp;<span class="string" id="5519809">&#39;a&#39;</span>&nbsp;<span class="op" id="5519813">&amp;&amp;</span>&nbsp;<span class="ident" id="5519816">r</span>&nbsp;<span class="op" id="5519818">&lt;=</span>&nbsp;<span class="string" id="5519821">&#39;z&#39;</span><span class="op" id="5519824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5519828">return</span>&nbsp;<span class="ident" id="5519835">r</span>&nbsp;<span class="op" id="5519837">-</span>&nbsp;<span class="op" id="5519839">(</span><span class="string" id="5519840">&#39;a&#39;</span>&nbsp;<span class="op" id="5519844">-</span>&nbsp;<span class="string" id="5519846">&#39;A&#39;</span><span class="op" id="5519849">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5519852">case</span>&nbsp;<span class="ident" id="5519857">r</span>&nbsp;<span class="op" id="5519859">==</span>&nbsp;<span class="string" id="5519862">&#39;-&#39;</span><span class="op" id="5519865">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5519869">return</span>&nbsp;<span class="string" id="5519876">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5519881">case</span>&nbsp;<span class="ident" id="5519886">r</span>&nbsp;<span class="op" id="5519888">==</span>&nbsp;<span class="string" id="5519891">&#39;=&#39;</span><span class="op" id="5519894">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5519898">//&nbsp;Maybe&nbsp;not&nbsp;part&nbsp;of&nbsp;the&nbsp;CGI&nbsp;&#39;spec&#39;&nbsp;but&nbsp;would&nbsp;mess&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5519954">//&nbsp;the&nbsp;environment&nbsp;in&nbsp;any&nbsp;case,&nbsp;as&nbsp;Go&nbsp;represents&nbsp;the</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520009">//&nbsp;environment&nbsp;as&nbsp;a&nbsp;slice&nbsp;of&nbsp;&#34;key=value&#34;&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5520061">return</span>&nbsp;<span class="string" id="5520068">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5520073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520076">//&nbsp;TODO:&nbsp;other&nbsp;transformations&nbsp;in&nbsp;spec&nbsp;or&nbsp;practice?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5520129">return</span>&nbsp;<span class="ident" id="5520136">r</span><br>
<span class="lineno">375</span><span class="op" id="5520138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5520141">var</span>&nbsp;<span class="ident" id="5520145">testHookStartProcess</span>&nbsp;<span class="keyword" id="5520166">func</span><span class="op" id="5520170">(</span><span class="op" id="5520171">*</span><span class="ident" id="5520172">os</span><span class="op" id="5520174">.</span><span class="ident" id="5520175">Process</span><span class="op" id="5520182">)</span>&nbsp;<span class="comment" id="5520184">//&nbsp;nil&nbsp;except&nbsp;for&nbsp;some&nbsp;tests</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
