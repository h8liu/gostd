<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5129843">package</span>&nbsp;<span class="ident" id="5129851">link8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5129858">import</span>&nbsp;<span class="op" id="5129865">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5129868">&#34;fmt&#34;</span><br>
<span class="lineno">5</span><span class="op" id="5129874">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5129877">//&nbsp;LinkMain&nbsp;produces&nbsp;a&nbsp;image&nbsp;for&nbsp;a&nbsp;main()&nbsp;in&nbsp;a&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="5129933">func</span>&nbsp;<span class="ident" id="5129938">LinkMain</span><span class="op" id="5129946">(</span><span class="ident" id="5129947">main</span>&nbsp;<span class="op" id="5129952">*</span><span class="ident" id="5129953">Package</span><span class="op" id="5129960">)</span>&nbsp;<span class="op" id="5129962">(</span><span class="op" id="5129963">[</span><span class="op" id="5129964">]</span><span class="builtintype" id="5129965">byte</span><span class="op" id="5129969">,</span>&nbsp;<span class="builtintype" id="5129971">error</span><span class="op" id="5129976">)</span>&nbsp;<span class="op" id="5129978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5129981">lnk</span>&nbsp;<span class="op" id="5129985">:=</span>&nbsp;<span class="ident" id="5129988">NewLinker</span><span class="op" id="5129997">(</span><span class="op" id="5129998">)</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130001">lnk</span><span class="op" id="5130004">.</span><span class="ident" id="5130005">AddPkgs</span><span class="op" id="5130012">(</span><span class="ident" id="5130013">main</span><span class="op" id="5130017">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130021">funcMain</span><span class="op" id="5130029">,</span>&nbsp;<span class="ident" id="5130031">index</span>&nbsp;<span class="op" id="5130037">:=</span>&nbsp;<span class="ident" id="5130040">main</span><span class="op" id="5130044">.</span><span class="ident" id="5130045">Query</span><span class="op" id="5130050">(</span><span class="string" id="5130051">&#34;main&#34;</span><span class="op" id="5130057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130060">if</span>&nbsp;<span class="ident" id="5130063">funcMain</span>&nbsp;<span class="op" id="5130072">==</span>&nbsp;<span class="ident" id="5130075">nil</span>&nbsp;<span class="op" id="5130079">||</span>&nbsp;<span class="ident" id="5130082">funcMain</span><span class="op" id="5130090">.</span><span class="ident" id="5130091">Type</span>&nbsp;<span class="op" id="5130096">!=</span>&nbsp;<span class="ident" id="5130099">SymFunc</span>&nbsp;<span class="op" id="5130107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130111">return</span>&nbsp;<span class="ident" id="5130118">nil</span><span class="op" id="5130121">,</span>&nbsp;<span class="ident" id="5130123">fmt</span><span class="op" id="5130126">.</span><span class="ident" id="5130127">Errorf</span><span class="op" id="5130133">(</span><span class="string" id="5130134">&#34;main&nbsp;function&nbsp;missing&#34;</span><span class="op" id="5130157">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5130160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130164">used</span>&nbsp;<span class="op" id="5130169">:=</span>&nbsp;<span class="ident" id="5130172">traceUsed</span><span class="op" id="5130181">(</span><span class="ident" id="5130182">lnk</span><span class="op" id="5130185">,</span>&nbsp;<span class="ident" id="5130187">main</span><span class="op" id="5130191">,</span>&nbsp;<span class="ident" id="5130193">index</span><span class="op" id="5130198">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130202">funcs</span><span class="op" id="5130207">,</span>&nbsp;<span class="ident" id="5130209">vars</span><span class="op" id="5130213">,</span>&nbsp;<span class="ident" id="5130215">e</span>&nbsp;<span class="op" id="5130217">:=</span>&nbsp;<span class="ident" id="5130220">layout</span><span class="op" id="5130226">(</span><span class="ident" id="5130227">used</span><span class="op" id="5130231">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130234">if</span>&nbsp;<span class="ident" id="5130237">e</span>&nbsp;<span class="op" id="5130239">!=</span>&nbsp;<span class="ident" id="5130242">nil</span>&nbsp;<span class="op" id="5130246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130250">return</span>&nbsp;<span class="ident" id="5130257">nil</span><span class="op" id="5130260">,</span>&nbsp;<span class="ident" id="5130262">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5130265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130269">w</span>&nbsp;<span class="op" id="5130271">:=</span>&nbsp;<span class="ident" id="5130274">newWriter</span><span class="op" id="5130283">(</span><span class="op" id="5130284">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130287">for</span>&nbsp;<span class="ident" id="5130291">_</span><span class="op" id="5130292">,</span>&nbsp;<span class="ident" id="5130294">f</span>&nbsp;<span class="op" id="5130296">:=</span>&nbsp;<span class="keyword" id="5130299">range</span>&nbsp;<span class="ident" id="5130305">funcs</span>&nbsp;<span class="op" id="5130311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130315">writeFunc</span><span class="op" id="5130324">(</span><span class="ident" id="5130325">w</span><span class="op" id="5130326">,</span>&nbsp;<span class="ident" id="5130328">f</span><span class="op" id="5130329">.</span><span class="ident" id="5130330">pkg</span><span class="op" id="5130333">,</span>&nbsp;<span class="ident" id="5130335">f</span><span class="op" id="5130336">.</span><span class="ident" id="5130337">Func</span><span class="op" id="5130341">(</span><span class="op" id="5130342">)</span><span class="op" id="5130343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5130346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130350">for</span>&nbsp;<span class="ident" id="5130354">_</span><span class="op" id="5130355">,</span>&nbsp;<span class="ident" id="5130357">v</span>&nbsp;<span class="op" id="5130359">:=</span>&nbsp;<span class="keyword" id="5130362">range</span>&nbsp;<span class="ident" id="5130368">vars</span>&nbsp;<span class="op" id="5130373">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130377">writeVar</span><span class="op" id="5130385">(</span><span class="ident" id="5130386">w</span><span class="op" id="5130387">,</span>&nbsp;<span class="ident" id="5130389">v</span><span class="op" id="5130390">.</span><span class="ident" id="5130391">Var</span><span class="op" id="5130394">(</span><span class="op" id="5130395">)</span><span class="op" id="5130396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5130399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130403">return</span>&nbsp;<span class="ident" id="5130410">w</span><span class="op" id="5130411">.</span><span class="ident" id="5130412">bytes</span><span class="op" id="5130417">(</span><span class="op" id="5130418">)</span><span class="op" id="5130419">,</span>&nbsp;<span class="ident" id="5130421">nil</span><br>
<span class="lineno"></span><span class="op" id="5130425">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="5130428">//&nbsp;LinkBareFunc&nbsp;produces&nbsp;a&nbsp;image&nbsp;of&nbsp;a&nbsp;single&nbsp;function&nbsp;that&nbsp;has&nbsp;no&nbsp;links.</span><br>
<span class="lineno"></span><span class="keyword" id="5130501">func</span>&nbsp;<span class="ident" id="5130506">LinkBareFunc</span><span class="op" id="5130518">(</span><span class="ident" id="5130519">f</span>&nbsp;<span class="op" id="5130521">*</span><span class="ident" id="5130522">Func</span><span class="op" id="5130526">)</span>&nbsp;<span class="op" id="5130528">(</span><span class="op" id="5130529">[</span><span class="op" id="5130530">]</span><span class="builtintype" id="5130531">byte</span><span class="op" id="5130535">,</span>&nbsp;<span class="builtintype" id="5130537">error</span><span class="op" id="5130542">)</span>&nbsp;<span class="op" id="5130544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130547">if</span>&nbsp;<span class="ident" id="5130550">f</span><span class="op" id="5130551">.</span><span class="ident" id="5130552">TooLarge</span><span class="op" id="5130560">(</span><span class="op" id="5130561">)</span>&nbsp;<span class="op" id="5130563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130567">return</span>&nbsp;<span class="ident" id="5130574">nil</span><span class="op" id="5130577">,</span>&nbsp;<span class="ident" id="5130579">fmt</span><span class="op" id="5130582">.</span><span class="ident" id="5130583">Errorf</span><span class="op" id="5130589">(</span><span class="string" id="5130590">&#34;code&nbsp;section&nbsp;too&nbsp;large&#34;</span><span class="op" id="5130614">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5130617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130621">w</span>&nbsp;<span class="op" id="5130623">:=</span>&nbsp;<span class="ident" id="5130626">newWriter</span><span class="op" id="5130635">(</span><span class="op" id="5130636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130639">w</span><span class="op" id="5130640">.</span><span class="ident" id="5130641">writeBareFunc</span><span class="op" id="5130654">(</span><span class="ident" id="5130655">f</span><span class="op" id="5130656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130659">return</span>&nbsp;<span class="ident" id="5130666">w</span><span class="op" id="5130667">.</span><span class="ident" id="5130668">bytes</span><span class="op" id="5130673">(</span><span class="op" id="5130674">)</span><span class="op" id="5130675">,</span>&nbsp;<span class="ident" id="5130677">nil</span><br>
<span class="lineno">45</span><span class="op" id="5130681">}</span>
</div>
</body>
</html>
