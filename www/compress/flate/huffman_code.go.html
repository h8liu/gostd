<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4331959">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4332014">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4332068">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4332119">package</span>&nbsp;<span class="ident" id="4332127">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4332134">import</span>&nbsp;<span class="op" id="4332141">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4332144">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4332152">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4332159">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4332162">type</span>&nbsp;<span class="ident" id="4332167">huffmanEncoder</span>&nbsp;<span class="keyword" id="4332182">struct</span>&nbsp;<span class="op" id="4332189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4332192">codeBits</span>&nbsp;<span class="op" id="4332201">[</span><span class="op" id="4332202">]</span><span class="builtintype" id="4332203">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4332210">code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4332219">[</span><span class="op" id="4332220">]</span><span class="builtintype" id="4332221">uint16</span><br>
<span class="lineno">15</span><span class="op" id="4332228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4332231">type</span>&nbsp;<span class="ident" id="4332236">literalNode</span>&nbsp;<span class="keyword" id="4332248">struct</span>&nbsp;<span class="op" id="4332255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4332258">literal</span>&nbsp;<span class="builtintype" id="4332266">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4332274">freq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4332282">int32</span><br>
<span class="lineno">20</span><span class="op" id="4332288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4332291">//&nbsp;A&nbsp;levelInfo&nbsp;describes&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;constructed&nbsp;tree&nbsp;for&nbsp;a&nbsp;given&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="4332369">type</span>&nbsp;<span class="ident" id="4332374">levelInfo</span>&nbsp;<span class="keyword" id="4332384">struct</span>&nbsp;<span class="op" id="4332391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4332394">//&nbsp;Our&nbsp;level.&nbsp;&nbsp;for&nbsp;better&nbsp;printing</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4332430">level</span>&nbsp;<span class="builtintype" id="4332436">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4332444">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;last&nbsp;node&nbsp;at&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4332493">lastFreq</span>&nbsp;<span class="builtintype" id="4332502">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4332510">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;character&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4332571">nextCharFreq</span>&nbsp;<span class="builtintype" id="4332584">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4332592">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;pair&nbsp;(from&nbsp;level&nbsp;below)&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4332668">//&nbsp;Only&nbsp;valid&nbsp;if&nbsp;the&nbsp;&#34;needed&#34;&nbsp;value&nbsp;of&nbsp;the&nbsp;next&nbsp;lower&nbsp;level&nbsp;is&nbsp;0.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4332735">nextPairFreq</span>&nbsp;<span class="builtintype" id="4332748">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4332756">//&nbsp;The&nbsp;number&nbsp;of&nbsp;chains&nbsp;remaining&nbsp;to&nbsp;generate&nbsp;for&nbsp;this&nbsp;level&nbsp;before&nbsp;moving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4332832">//&nbsp;up&nbsp;to&nbsp;the&nbsp;next&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4332857">needed</span>&nbsp;<span class="builtintype" id="4332864">int32</span><br>
<span class="lineno">40</span><span class="op" id="4332870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4332873">func</span>&nbsp;<span class="ident" id="4332878">maxNode</span><span class="op" id="4332885">(</span><span class="op" id="4332886">)</span>&nbsp;<span class="ident" id="4332888">literalNode</span>&nbsp;<span class="op" id="4332900">{</span>&nbsp;<span class="keyword" id="4332902">return</span>&nbsp;<span class="ident" id="4332909">literalNode</span><span class="op" id="4332920">{</span><span class="ident" id="4332921">math</span><span class="op" id="4332925">.</span><span class="ident" id="4332926">MaxUint16</span><span class="op" id="4332935">,</span>&nbsp;<span class="ident" id="4332937">math</span><span class="op" id="4332941">.</span><span class="ident" id="4332942">MaxInt32</span><span class="op" id="4332950">}</span>&nbsp;<span class="op" id="4332952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4332955">func</span>&nbsp;<span class="ident" id="4332960">newHuffmanEncoder</span><span class="op" id="4332977">(</span><span class="ident" id="4332978">size</span>&nbsp;<span class="builtintype" id="4332983">int</span><span class="op" id="4332986">)</span>&nbsp;<span class="op" id="4332988">*</span><span class="ident" id="4332989">huffmanEncoder</span>&nbsp;<span class="op" id="4333004">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4333007">return</span>&nbsp;<span class="op" id="4333014">&amp;</span><span class="ident" id="4333015">huffmanEncoder</span><span class="op" id="4333029">{</span><span class="builtinfunc" id="4333030">make</span><span class="op" id="4333034">(</span><span class="op" id="4333035">[</span><span class="op" id="4333036">]</span><span class="builtintype" id="4333037">uint8</span><span class="op" id="4333042">,</span>&nbsp;<span class="ident" id="4333044">size</span><span class="op" id="4333048">)</span><span class="op" id="4333049">,</span>&nbsp;<span class="builtinfunc" id="4333051">make</span><span class="op" id="4333055">(</span><span class="op" id="4333056">[</span><span class="op" id="4333057">]</span><span class="builtintype" id="4333058">uint16</span><span class="op" id="4333064">,</span>&nbsp;<span class="ident" id="4333066">size</span><span class="op" id="4333070">)</span><span class="op" id="4333071">}</span><br>
<span class="lineno"></span><span class="op" id="4333073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4333076">//&nbsp;Generates&nbsp;a&nbsp;HuffmanCode&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;fixed&nbsp;literal&nbsp;table</span><br>
<span class="lineno"></span><span class="keyword" id="4333144">func</span>&nbsp;<span class="ident" id="4333149">generateFixedLiteralEncoding</span><span class="op" id="4333177">(</span><span class="op" id="4333178">)</span>&nbsp;<span class="op" id="4333180">*</span><span class="ident" id="4333181">huffmanEncoder</span>&nbsp;<span class="op" id="4333196">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333199">h</span>&nbsp;<span class="op" id="4333201">:=</span>&nbsp;<span class="ident" id="4333204">newHuffmanEncoder</span><span class="op" id="4333221">(</span><span class="ident" id="4333222">maxLit</span><span class="op" id="4333228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333231">codeBits</span>&nbsp;<span class="op" id="4333240">:=</span>&nbsp;<span class="ident" id="4333243">h</span><span class="op" id="4333244">.</span><span class="ident" id="4333245">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333255">code</span>&nbsp;<span class="op" id="4333260">:=</span>&nbsp;<span class="ident" id="4333263">h</span><span class="op" id="4333264">.</span><span class="ident" id="4333265">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4333271">var</span>&nbsp;<span class="ident" id="4333275">ch</span>&nbsp;<span class="builtintype" id="4333278">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4333286">for</span>&nbsp;<span class="ident" id="4333290">ch</span>&nbsp;<span class="op" id="4333293">=</span>&nbsp;<span class="num" id="4333295">0</span><span class="op" id="4333296">;</span>&nbsp;<span class="ident" id="4333298">ch</span>&nbsp;<span class="op" id="4333301">&lt;</span>&nbsp;<span class="ident" id="4333303">maxLit</span><span class="op" id="4333309">;</span>&nbsp;<span class="ident" id="4333311">ch</span><span class="op" id="4333313">++</span>&nbsp;<span class="op" id="4333316">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4333320">var</span>&nbsp;<span class="ident" id="4333324">bits</span>&nbsp;<span class="builtintype" id="4333329">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4333338">var</span>&nbsp;<span class="ident" id="4333342">size</span>&nbsp;<span class="builtintype" id="4333347">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4333355">switch</span>&nbsp;<span class="op" id="4333362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4333366">case</span>&nbsp;<span class="ident" id="4333371">ch</span>&nbsp;<span class="op" id="4333374">&lt;</span>&nbsp;<span class="num" id="4333376">144</span><span class="op" id="4333379">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4333384">//&nbsp;size&nbsp;8,&nbsp;000110000&nbsp;&nbsp;..&nbsp;10111111</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333421">bits</span>&nbsp;<span class="op" id="4333426">=</span>&nbsp;<span class="ident" id="4333428">ch</span>&nbsp;<span class="op" id="4333431">+</span>&nbsp;<span class="num" id="4333433">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333439">size</span>&nbsp;<span class="op" id="4333444">=</span>&nbsp;<span class="num" id="4333446">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4333451">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4333459">case</span>&nbsp;<span class="ident" id="4333464">ch</span>&nbsp;<span class="op" id="4333467">&lt;</span>&nbsp;<span class="num" id="4333469">256</span><span class="op" id="4333472">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4333477">//&nbsp;size&nbsp;9,&nbsp;110010000&nbsp;..&nbsp;111111111</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333514">bits</span>&nbsp;<span class="op" id="4333519">=</span>&nbsp;<span class="ident" id="4333521">ch</span>&nbsp;<span class="op" id="4333524">+</span>&nbsp;<span class="num" id="4333526">400</span>&nbsp;<span class="op" id="4333530">-</span>&nbsp;<span class="num" id="4333532">144</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333539">size</span>&nbsp;<span class="op" id="4333544">=</span>&nbsp;<span class="num" id="4333546">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4333551">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4333559">case</span>&nbsp;<span class="ident" id="4333564">ch</span>&nbsp;<span class="op" id="4333567">&lt;</span>&nbsp;<span class="num" id="4333569">280</span><span class="op" id="4333572">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4333577">//&nbsp;size&nbsp;7,&nbsp;0000000&nbsp;..&nbsp;0010111</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333610">bits</span>&nbsp;<span class="op" id="4333615">=</span>&nbsp;<span class="ident" id="4333617">ch</span>&nbsp;<span class="op" id="4333620">-</span>&nbsp;<span class="num" id="4333622">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333629">size</span>&nbsp;<span class="op" id="4333634">=</span>&nbsp;<span class="num" id="4333636">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4333641">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4333649">default</span><span class="op" id="4333656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4333661">//&nbsp;size&nbsp;8,&nbsp;11000000&nbsp;..&nbsp;11000111</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333696">bits</span>&nbsp;<span class="op" id="4333701">=</span>&nbsp;<span class="ident" id="4333703">ch</span>&nbsp;<span class="op" id="4333706">+</span>&nbsp;<span class="num" id="4333708">192</span>&nbsp;<span class="op" id="4333712">-</span>&nbsp;<span class="num" id="4333714">280</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333721">size</span>&nbsp;<span class="op" id="4333726">=</span>&nbsp;<span class="num" id="4333728">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4333732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333736">codeBits</span><span class="op" id="4333744">[</span><span class="ident" id="4333745">ch</span><span class="op" id="4333747">]</span>&nbsp;<span class="op" id="4333749">=</span>&nbsp;<span class="ident" id="4333751">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333758">code</span><span class="op" id="4333762">[</span><span class="ident" id="4333763">ch</span><span class="op" id="4333765">]</span>&nbsp;<span class="op" id="4333767">=</span>&nbsp;<span class="ident" id="4333769">reverseBits</span><span class="op" id="4333780">(</span><span class="ident" id="4333781">bits</span><span class="op" id="4333785">,</span>&nbsp;<span class="ident" id="4333787">size</span><span class="op" id="4333791">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4333794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4333797">return</span>&nbsp;<span class="ident" id="4333804">h</span><br>
<span class="lineno"></span><span class="op" id="4333806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4333809">func</span>&nbsp;<span class="ident" id="4333814">generateFixedOffsetEncoding</span><span class="op" id="4333841">(</span><span class="op" id="4333842">)</span>&nbsp;<span class="op" id="4333844">*</span><span class="ident" id="4333845">huffmanEncoder</span>&nbsp;<span class="op" id="4333860">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333863">h</span>&nbsp;<span class="op" id="4333865">:=</span>&nbsp;<span class="ident" id="4333868">newHuffmanEncoder</span><span class="op" id="4333885">(</span><span class="num" id="4333886">30</span><span class="op" id="4333888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333891">codeBits</span>&nbsp;<span class="op" id="4333900">:=</span>&nbsp;<span class="ident" id="4333903">h</span><span class="op" id="4333904">.</span><span class="ident" id="4333905">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333915">code</span>&nbsp;<span class="op" id="4333920">:=</span>&nbsp;<span class="ident" id="4333923">h</span><span class="op" id="4333924">.</span><span class="ident" id="4333925">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4333931">for</span>&nbsp;<span class="ident" id="4333935">ch</span>&nbsp;<span class="op" id="4333938">:=</span>&nbsp;<span class="builtintype" id="4333941">uint16</span><span class="op" id="4333947">(</span><span class="num" id="4333948">0</span><span class="op" id="4333949">)</span><span class="op" id="4333950">;</span>&nbsp;<span class="ident" id="4333952">ch</span>&nbsp;<span class="op" id="4333955">&lt;</span>&nbsp;<span class="num" id="4333957">30</span><span class="op" id="4333959">;</span>&nbsp;<span class="ident" id="4333961">ch</span><span class="op" id="4333963">++</span>&nbsp;<span class="op" id="4333966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333970">codeBits</span><span class="op" id="4333978">[</span><span class="ident" id="4333979">ch</span><span class="op" id="4333981">]</span>&nbsp;<span class="op" id="4333983">=</span>&nbsp;<span class="num" id="4333985">5</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4333989">code</span><span class="op" id="4333993">[</span><span class="ident" id="4333994">ch</span><span class="op" id="4333996">]</span>&nbsp;<span class="op" id="4333998">=</span>&nbsp;<span class="ident" id="4334000">reverseBits</span><span class="op" id="4334011">(</span><span class="ident" id="4334012">ch</span><span class="op" id="4334014">,</span>&nbsp;<span class="num" id="4334016">5</span><span class="op" id="4334017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4334020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4334023">return</span>&nbsp;<span class="ident" id="4334030">h</span><br>
<span class="lineno"></span><span class="op" id="4334032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4334035">var</span>&nbsp;<span class="ident" id="4334039">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4334060">*</span><span class="ident" id="4334061">huffmanEncoder</span>&nbsp;<span class="op" id="4334076">=</span>&nbsp;<span class="ident" id="4334078">generateFixedLiteralEncoding</span><span class="op" id="4334106">(</span><span class="op" id="4334107">)</span><br>
<span class="lineno"></span><span class="keyword" id="4334109">var</span>&nbsp;<span class="ident" id="4334113">fixedOffsetEncoding</span>&nbsp;<span class="op" id="4334133">*</span><span class="ident" id="4334134">huffmanEncoder</span>&nbsp;<span class="op" id="4334149">=</span>&nbsp;<span class="ident" id="4334151">generateFixedOffsetEncoding</span><span class="op" id="4334178">(</span><span class="op" id="4334179">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4334182">func</span>&nbsp;<span class="op" id="4334187">(</span><span class="ident" id="4334188">h</span>&nbsp;<span class="op" id="4334190">*</span><span class="ident" id="4334191">huffmanEncoder</span><span class="op" id="4334205">)</span>&nbsp;<span class="ident" id="4334207">bitLength</span><span class="op" id="4334216">(</span><span class="ident" id="4334217">freq</span>&nbsp;<span class="op" id="4334222">[</span><span class="op" id="4334223">]</span><span class="builtintype" id="4334224">int32</span><span class="op" id="4334229">)</span>&nbsp;<span class="ident" id="4334231">int64</span>&nbsp;<span class="op" id="4334237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4334240">var</span>&nbsp;<span class="ident" id="4334244">total</span>&nbsp;<span class="ident" id="4334250">int64</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4334257">for</span>&nbsp;<span class="ident" id="4334261">i</span><span class="op" id="4334262">,</span>&nbsp;<span class="ident" id="4334264">f</span>&nbsp;<span class="op" id="4334266">:=</span>&nbsp;<span class="keyword" id="4334269">range</span>&nbsp;<span class="ident" id="4334275">freq</span>&nbsp;<span class="op" id="4334280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4334284">if</span>&nbsp;<span class="ident" id="4334287">f</span>&nbsp;<span class="op" id="4334289">!=</span>&nbsp;<span class="num" id="4334292">0</span>&nbsp;<span class="op" id="4334294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4334299">total</span>&nbsp;<span class="op" id="4334305">+=</span>&nbsp;<span class="ident" id="4334308">int64</span><span class="op" id="4334313">(</span><span class="ident" id="4334314">f</span><span class="op" id="4334315">)</span>&nbsp;<span class="op" id="4334317">*</span>&nbsp;<span class="ident" id="4334319">int64</span><span class="op" id="4334324">(</span><span class="ident" id="4334325">h</span><span class="op" id="4334326">.</span><span class="ident" id="4334327">codeBits</span><span class="op" id="4334335">[</span><span class="ident" id="4334336">i</span><span class="op" id="4334337">]</span><span class="op" id="4334338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4334342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4334345">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4334348">return</span>&nbsp;<span class="ident" id="4334355">total</span><br>
<span class="lineno"></span><span class="op" id="4334361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4334364">const</span>&nbsp;<span class="ident" id="4334370">maxBitsLimit</span>&nbsp;<span class="op" id="4334383">=</span>&nbsp;<span class="num" id="4334385">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="4334389">//&nbsp;Return&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;assigned&nbsp;to&nbsp;each&nbsp;bit&nbsp;size&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="4334472">//</span><br>
<span class="lineno"></span><span class="comment" id="4334475">//&nbsp;This&nbsp;method&nbsp;is&nbsp;only&nbsp;called&nbsp;when&nbsp;list.length&nbsp;&gt;=&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="4334527">//&nbsp;The&nbsp;cases&nbsp;of&nbsp;0,&nbsp;1,&nbsp;and&nbsp;2&nbsp;literals&nbsp;are&nbsp;handled&nbsp;by&nbsp;special&nbsp;case&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4334598">//</span><br>
<span class="lineno">115</span><span class="comment" id="4334601">//&nbsp;list&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;the&nbsp;literals&nbsp;with&nbsp;non-zero&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4334661">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;their&nbsp;associated&nbsp;frequencies.&nbsp;&nbsp;The&nbsp;array&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing</span><br>
<span class="lineno"></span><span class="comment" id="4334747">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frequency,&nbsp;and&nbsp;has&nbsp;as&nbsp;its&nbsp;last&nbsp;element&nbsp;a&nbsp;special&nbsp;element&nbsp;with&nbsp;frequency</span><br>
<span class="lineno"></span><span class="comment" id="4334834">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MaxInt32</span><br>
<span class="lineno"></span><span class="comment" id="4334858">//&nbsp;maxBits&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;that&nbsp;should&nbsp;be&nbsp;used&nbsp;to&nbsp;encode&nbsp;any&nbsp;literal.</span><br>
<span class="lineno">120</span><span class="comment" id="4334943">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Must&nbsp;be&nbsp;less&nbsp;than&nbsp;16.</span><br>
<span class="lineno"></span><span class="comment" id="4334980">//&nbsp;return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;An&nbsp;integer&nbsp;array&nbsp;in&nbsp;which&nbsp;array[i]&nbsp;indicates&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span><span class="comment" id="4335063">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;should&nbsp;be&nbsp;encoded&nbsp;in&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4335112">func</span>&nbsp;<span class="op" id="4335117">(</span><span class="ident" id="4335118">h</span>&nbsp;<span class="op" id="4335120">*</span><span class="ident" id="4335121">huffmanEncoder</span><span class="op" id="4335135">)</span>&nbsp;<span class="ident" id="4335137">bitCounts</span><span class="op" id="4335146">(</span><span class="ident" id="4335147">list</span>&nbsp;<span class="op" id="4335152">[</span><span class="op" id="4335153">]</span><span class="ident" id="4335154">literalNode</span><span class="op" id="4335165">,</span>&nbsp;<span class="ident" id="4335167">maxBits</span>&nbsp;<span class="builtintype" id="4335175">int32</span><span class="op" id="4335180">)</span>&nbsp;<span class="op" id="4335182">[</span><span class="op" id="4335183">]</span><span class="builtintype" id="4335184">int32</span>&nbsp;<span class="op" id="4335190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4335193">if</span>&nbsp;<span class="ident" id="4335196">maxBits</span>&nbsp;<span class="op" id="4335204">&gt;=</span>&nbsp;<span class="ident" id="4335207">maxBitsLimit</span>&nbsp;<span class="op" id="4335220">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4335224">panic</span><span class="op" id="4335229">(</span><span class="string" id="4335230">&#34;flate:&nbsp;maxBits&nbsp;too&nbsp;large&#34;</span><span class="op" id="4335256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4335259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4335262">n</span>&nbsp;<span class="op" id="4335264">:=</span>&nbsp;<span class="builtintype" id="4335267">int32</span><span class="op" id="4335272">(</span><span class="builtinfunc" id="4335273">len</span><span class="op" id="4335276">(</span><span class="ident" id="4335277">list</span><span class="op" id="4335281">)</span><span class="op" id="4335282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4335285">list</span>&nbsp;<span class="op" id="4335290">=</span>&nbsp;<span class="ident" id="4335292">list</span><span class="op" id="4335296">[</span><span class="num" id="4335297">0</span>&nbsp;<span class="op" id="4335299">:</span>&nbsp;<span class="ident" id="4335301">n</span><span class="op" id="4335302">+</span><span class="num" id="4335303">1</span><span class="op" id="4335304">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4335307">list</span><span class="op" id="4335311">[</span><span class="ident" id="4335312">n</span><span class="op" id="4335313">]</span>&nbsp;<span class="op" id="4335315">=</span>&nbsp;<span class="ident" id="4335317">maxNode</span><span class="op" id="4335324">(</span><span class="op" id="4335325">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4335329">//&nbsp;The&nbsp;tree&nbsp;can&#39;t&nbsp;have&nbsp;greater&nbsp;depth&nbsp;than&nbsp;n&nbsp;-&nbsp;1,&nbsp;no&nbsp;matter&nbsp;what.&nbsp;&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4335401">//&nbsp;saves&nbsp;a&nbsp;little&nbsp;bit&nbsp;of&nbsp;work&nbsp;in&nbsp;some&nbsp;small&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4335452">if</span>&nbsp;<span class="ident" id="4335455">maxBits</span>&nbsp;<span class="op" id="4335463">&gt;</span>&nbsp;<span class="ident" id="4335465">n</span><span class="op" id="4335466">-</span><span class="num" id="4335467">1</span>&nbsp;<span class="op" id="4335469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4335473">maxBits</span>&nbsp;<span class="op" id="4335481">=</span>&nbsp;<span class="ident" id="4335483">n</span>&nbsp;<span class="op" id="4335485">-</span>&nbsp;<span class="num" id="4335487">1</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4335490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4335494">//&nbsp;Create&nbsp;information&nbsp;about&nbsp;each&nbsp;of&nbsp;the&nbsp;levels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4335543">//&nbsp;A&nbsp;bogus&nbsp;&#34;Level&nbsp;0&#34;&nbsp;whose&nbsp;sole&nbsp;purpose&nbsp;is&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4335595">//&nbsp;level1.prev.needed==0.&nbsp;&nbsp;This&nbsp;makes&nbsp;level1.nextPairFreq</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4335654">//&nbsp;be&nbsp;a&nbsp;legitimate&nbsp;value&nbsp;that&nbsp;never&nbsp;gets&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4335704">var</span>&nbsp;<span class="ident" id="4335708">levels</span>&nbsp;<span class="op" id="4335715">[</span><span class="ident" id="4335716">maxBitsLimit</span><span class="op" id="4335728">]</span><span class="ident" id="4335729">levelInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4335740">//&nbsp;leafCounts[i]&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4335800">//&nbsp;of&nbsp;ancestors&nbsp;of&nbsp;the&nbsp;rightmost&nbsp;node&nbsp;at&nbsp;level&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4335851">//&nbsp;leafCounts[i][j]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4335910">//&nbsp;of&nbsp;the&nbsp;level&nbsp;j&nbsp;ancestor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4335939">var</span>&nbsp;<span class="ident" id="4335943">leafCounts</span>&nbsp;<span class="op" id="4335954">[</span><span class="ident" id="4335955">maxBitsLimit</span><span class="op" id="4335967">]</span><span class="op" id="4335968">[</span><span class="ident" id="4335969">maxBitsLimit</span><span class="op" id="4335981">]</span><span class="builtintype" id="4335982">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4335990">for</span>&nbsp;<span class="ident" id="4335994">level</span>&nbsp;<span class="op" id="4336000">:=</span>&nbsp;<span class="builtintype" id="4336003">int32</span><span class="op" id="4336008">(</span><span class="num" id="4336009">1</span><span class="op" id="4336010">)</span><span class="op" id="4336011">;</span>&nbsp;<span class="ident" id="4336013">level</span>&nbsp;<span class="op" id="4336019">&lt;=</span>&nbsp;<span class="ident" id="4336022">maxBits</span><span class="op" id="4336029">;</span>&nbsp;<span class="ident" id="4336031">level</span><span class="op" id="4336036">++</span>&nbsp;<span class="op" id="4336039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4336043">//&nbsp;For&nbsp;every&nbsp;level,&nbsp;the&nbsp;first&nbsp;two&nbsp;items&nbsp;are&nbsp;the&nbsp;first&nbsp;two&nbsp;characters.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4336115">//&nbsp;We&nbsp;initialize&nbsp;the&nbsp;levels&nbsp;as&nbsp;if&nbsp;we&nbsp;had&nbsp;already&nbsp;figured&nbsp;this&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336184">levels</span><span class="op" id="4336190">[</span><span class="ident" id="4336191">level</span><span class="op" id="4336196">]</span>&nbsp;<span class="op" id="4336198">=</span>&nbsp;<span class="ident" id="4336200">levelInfo</span><span class="op" id="4336209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336214">level</span><span class="op" id="4336219">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336228">level</span><span class="op" id="4336233">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336238">lastFreq</span><span class="op" id="4336246">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336252">list</span><span class="op" id="4336256">[</span><span class="num" id="4336257">1</span><span class="op" id="4336258">]</span><span class="op" id="4336259">.</span><span class="ident" id="4336260">freq</span><span class="op" id="4336264">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336269">nextCharFreq</span><span class="op" id="4336281">:</span>&nbsp;<span class="ident" id="4336283">list</span><span class="op" id="4336287">[</span><span class="num" id="4336288">2</span><span class="op" id="4336289">]</span><span class="op" id="4336290">.</span><span class="ident" id="4336291">freq</span><span class="op" id="4336295">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336300">nextPairFreq</span><span class="op" id="4336312">:</span>&nbsp;<span class="ident" id="4336314">list</span><span class="op" id="4336318">[</span><span class="num" id="4336319">0</span><span class="op" id="4336320">]</span><span class="op" id="4336321">.</span><span class="ident" id="4336322">freq</span>&nbsp;<span class="op" id="4336327">+</span>&nbsp;<span class="ident" id="4336329">list</span><span class="op" id="4336333">[</span><span class="num" id="4336334">1</span><span class="op" id="4336335">]</span><span class="op" id="4336336">.</span><span class="ident" id="4336337">freq</span><span class="op" id="4336341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4336345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336349">leafCounts</span><span class="op" id="4336359">[</span><span class="ident" id="4336360">level</span><span class="op" id="4336365">]</span><span class="op" id="4336366">[</span><span class="ident" id="4336367">level</span><span class="op" id="4336372">]</span>&nbsp;<span class="op" id="4336374">=</span>&nbsp;<span class="num" id="4336376">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4336380">if</span>&nbsp;<span class="ident" id="4336383">level</span>&nbsp;<span class="op" id="4336389">==</span>&nbsp;<span class="num" id="4336392">1</span>&nbsp;<span class="op" id="4336394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336399">levels</span><span class="op" id="4336405">[</span><span class="ident" id="4336406">level</span><span class="op" id="4336411">]</span><span class="op" id="4336412">.</span><span class="ident" id="4336413">nextPairFreq</span>&nbsp;<span class="op" id="4336426">=</span>&nbsp;<span class="ident" id="4336428">math</span><span class="op" id="4336432">.</span><span class="ident" id="4336433">MaxInt32</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4336444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4336447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4336451">//&nbsp;We&nbsp;need&nbsp;a&nbsp;total&nbsp;of&nbsp;2*n&nbsp;-&nbsp;2&nbsp;items&nbsp;at&nbsp;top&nbsp;level&nbsp;and&nbsp;have&nbsp;already&nbsp;generated&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336531">levels</span><span class="op" id="4336537">[</span><span class="ident" id="4336538">maxBits</span><span class="op" id="4336545">]</span><span class="op" id="4336546">.</span><span class="ident" id="4336547">needed</span>&nbsp;<span class="op" id="4336554">=</span>&nbsp;<span class="num" id="4336556">2</span><span class="op" id="4336557">*</span><span class="ident" id="4336558">n</span>&nbsp;<span class="op" id="4336560">-</span>&nbsp;<span class="num" id="4336562">4</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336566">level</span>&nbsp;<span class="op" id="4336572">:=</span>&nbsp;<span class="ident" id="4336575">maxBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4336584">for</span>&nbsp;<span class="op" id="4336588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336592">l</span>&nbsp;<span class="op" id="4336594">:=</span>&nbsp;<span class="op" id="4336597">&amp;</span><span class="ident" id="4336598">levels</span><span class="op" id="4336604">[</span><span class="ident" id="4336605">level</span><span class="op" id="4336610">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4336614">if</span>&nbsp;<span class="ident" id="4336617">l</span><span class="op" id="4336618">.</span><span class="ident" id="4336619">nextPairFreq</span>&nbsp;<span class="op" id="4336632">==</span>&nbsp;<span class="ident" id="4336635">math</span><span class="op" id="4336639">.</span><span class="ident" id="4336640">MaxInt32</span>&nbsp;<span class="op" id="4336649">&amp;&amp;</span>&nbsp;<span class="ident" id="4336652">l</span><span class="op" id="4336653">.</span><span class="ident" id="4336654">nextCharFreq</span>&nbsp;<span class="op" id="4336667">==</span>&nbsp;<span class="ident" id="4336670">math</span><span class="op" id="4336674">.</span><span class="ident" id="4336675">MaxInt32</span>&nbsp;<span class="op" id="4336684">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4336689">//&nbsp;We&#39;ve&nbsp;run&nbsp;out&nbsp;of&nbsp;both&nbsp;leafs&nbsp;and&nbsp;pairs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4336734">//&nbsp;End&nbsp;all&nbsp;calculations&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4336777">//&nbsp;To&nbsp;make&nbsp;sure&nbsp;we&nbsp;never&nbsp;come&nbsp;back&nbsp;to&nbsp;this&nbsp;level&nbsp;or&nbsp;any&nbsp;lower&nbsp;level,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4336849">//&nbsp;set&nbsp;nextPairFreq&nbsp;impossibly&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336890">l</span><span class="op" id="4336891">.</span><span class="ident" id="4336892">needed</span>&nbsp;<span class="op" id="4336899">=</span>&nbsp;<span class="num" id="4336901">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336906">levels</span><span class="op" id="4336912">[</span><span class="ident" id="4336913">level</span><span class="op" id="4336918">+</span><span class="num" id="4336919">1</span><span class="op" id="4336920">]</span><span class="op" id="4336921">.</span><span class="ident" id="4336922">nextPairFreq</span>&nbsp;<span class="op" id="4336935">=</span>&nbsp;<span class="ident" id="4336937">math</span><span class="op" id="4336941">.</span><span class="ident" id="4336942">MaxInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336954">level</span><span class="op" id="4336959">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4336965">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4336976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4336981">prevFreq</span>&nbsp;<span class="op" id="4336990">:=</span>&nbsp;<span class="ident" id="4336993">l</span><span class="op" id="4336994">.</span><span class="ident" id="4336995">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4337006">if</span>&nbsp;<span class="ident" id="4337009">l</span><span class="op" id="4337010">.</span><span class="ident" id="4337011">nextCharFreq</span>&nbsp;<span class="op" id="4337024">&lt;</span>&nbsp;<span class="ident" id="4337026">l</span><span class="op" id="4337027">.</span><span class="ident" id="4337028">nextPairFreq</span>&nbsp;<span class="op" id="4337041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4337046">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;leaf&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337094">n</span>&nbsp;<span class="op" id="4337096">:=</span>&nbsp;<span class="ident" id="4337099">leafCounts</span><span class="op" id="4337109">[</span><span class="ident" id="4337110">level</span><span class="op" id="4337115">]</span><span class="op" id="4337116">[</span><span class="ident" id="4337117">level</span><span class="op" id="4337122">]</span>&nbsp;<span class="op" id="4337124">+</span>&nbsp;<span class="num" id="4337126">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337131">l</span><span class="op" id="4337132">.</span><span class="ident" id="4337133">lastFreq</span>&nbsp;<span class="op" id="4337142">=</span>&nbsp;<span class="ident" id="4337144">l</span><span class="op" id="4337145">.</span><span class="ident" id="4337146">nextCharFreq</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4337162">//&nbsp;Lower&nbsp;leafCounts&nbsp;are&nbsp;the&nbsp;same&nbsp;of&nbsp;the&nbsp;previous&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337220">leafCounts</span><span class="op" id="4337230">[</span><span class="ident" id="4337231">level</span><span class="op" id="4337236">]</span><span class="op" id="4337237">[</span><span class="ident" id="4337238">level</span><span class="op" id="4337243">]</span>&nbsp;<span class="op" id="4337245">=</span>&nbsp;<span class="ident" id="4337247">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337252">l</span><span class="op" id="4337253">.</span><span class="ident" id="4337254">nextCharFreq</span>&nbsp;<span class="op" id="4337267">=</span>&nbsp;<span class="ident" id="4337269">list</span><span class="op" id="4337273">[</span><span class="ident" id="4337274">n</span><span class="op" id="4337275">]</span><span class="op" id="4337276">.</span><span class="ident" id="4337277">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4337284">}</span>&nbsp;<span class="keyword" id="4337286">else</span>&nbsp;<span class="op" id="4337291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4337296">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;pair&nbsp;from&nbsp;the&nbsp;previous&nbsp;row.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4337361">//&nbsp;nextPairFreq&nbsp;isn&#39;t&nbsp;valid&nbsp;until&nbsp;we&nbsp;generate&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4337414">//&nbsp;more&nbsp;values&nbsp;in&nbsp;the&nbsp;level&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337451">l</span><span class="op" id="4337452">.</span><span class="ident" id="4337453">lastFreq</span>&nbsp;<span class="op" id="4337462">=</span>&nbsp;<span class="ident" id="4337464">l</span><span class="op" id="4337465">.</span><span class="ident" id="4337466">nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4337482">//&nbsp;Take&nbsp;leaf&nbsp;counts&nbsp;from&nbsp;the&nbsp;lower&nbsp;level,&nbsp;except&nbsp;counts[level]&nbsp;remains&nbsp;the&nbsp;same.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4337566">copy</span><span class="op" id="4337570">(</span><span class="ident" id="4337571">leafCounts</span><span class="op" id="4337581">[</span><span class="ident" id="4337582">level</span><span class="op" id="4337587">]</span><span class="op" id="4337588">[</span><span class="op" id="4337589">:</span><span class="ident" id="4337590">level</span><span class="op" id="4337595">]</span><span class="op" id="4337596">,</span>&nbsp;<span class="ident" id="4337598">leafCounts</span><span class="op" id="4337608">[</span><span class="ident" id="4337609">level</span><span class="op" id="4337614">-</span><span class="num" id="4337615">1</span><span class="op" id="4337616">]</span><span class="op" id="4337617">[</span><span class="op" id="4337618">:</span><span class="ident" id="4337619">level</span><span class="op" id="4337624">]</span><span class="op" id="4337625">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337630">levels</span><span class="op" id="4337636">[</span><span class="ident" id="4337637">l</span><span class="op" id="4337638">.</span><span class="ident" id="4337639">level</span><span class="op" id="4337644">-</span><span class="num" id="4337645">1</span><span class="op" id="4337646">]</span><span class="op" id="4337647">.</span><span class="ident" id="4337648">needed</span>&nbsp;<span class="op" id="4337655">=</span>&nbsp;<span class="num" id="4337657">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4337661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4337666">if</span>&nbsp;<span class="ident" id="4337669">l</span><span class="op" id="4337670">.</span><span class="ident" id="4337671">needed</span><span class="op" id="4337677">--</span><span class="op" id="4337679">;</span>&nbsp;<span class="ident" id="4337681">l</span><span class="op" id="4337682">.</span><span class="ident" id="4337683">needed</span>&nbsp;<span class="op" id="4337690">==</span>&nbsp;<span class="num" id="4337693">0</span>&nbsp;<span class="op" id="4337695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4337700">//&nbsp;We&#39;ve&nbsp;done&nbsp;everything&nbsp;we&nbsp;need&nbsp;to&nbsp;do&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4337758">//&nbsp;Continue&nbsp;calculating&nbsp;one&nbsp;level&nbsp;up.&nbsp;&nbsp;Fill&nbsp;in&nbsp;nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4337821">//&nbsp;of&nbsp;that&nbsp;level&nbsp;with&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;two&nbsp;nodes&nbsp;we&#39;ve&nbsp;just&nbsp;calculated&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4337896">//&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4337914">if</span>&nbsp;<span class="ident" id="4337917">l</span><span class="op" id="4337918">.</span><span class="ident" id="4337919">level</span>&nbsp;<span class="op" id="4337925">==</span>&nbsp;<span class="ident" id="4337928">maxBits</span>&nbsp;<span class="op" id="4337936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4337942">//&nbsp;All&nbsp;done!</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4337959">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4337968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4337973">levels</span><span class="op" id="4337979">[</span><span class="ident" id="4337980">l</span><span class="op" id="4337981">.</span><span class="ident" id="4337982">level</span><span class="op" id="4337987">+</span><span class="num" id="4337988">1</span><span class="op" id="4337989">]</span><span class="op" id="4337990">.</span><span class="ident" id="4337991">nextPairFreq</span>&nbsp;<span class="op" id="4338004">=</span>&nbsp;<span class="ident" id="4338006">prevFreq</span>&nbsp;<span class="op" id="4338015">+</span>&nbsp;<span class="ident" id="4338017">l</span><span class="op" id="4338018">.</span><span class="ident" id="4338019">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4338031">level</span><span class="op" id="4338036">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4338041">}</span>&nbsp;<span class="keyword" id="4338043">else</span>&nbsp;<span class="op" id="4338048">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4338053">//&nbsp;If&nbsp;we&nbsp;stole&nbsp;from&nbsp;below,&nbsp;move&nbsp;down&nbsp;temporarily&nbsp;to&nbsp;replenish&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4338122">for</span>&nbsp;<span class="ident" id="4338126">levels</span><span class="op" id="4338132">[</span><span class="ident" id="4338133">level</span><span class="op" id="4338138">-</span><span class="num" id="4338139">1</span><span class="op" id="4338140">]</span><span class="op" id="4338141">.</span><span class="ident" id="4338142">needed</span>&nbsp;<span class="op" id="4338149">&gt;</span>&nbsp;<span class="num" id="4338151">0</span>&nbsp;<span class="op" id="4338153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4338159">level</span><span class="op" id="4338164">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4338170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4338174">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4338177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4338181">//&nbsp;Somethings&nbsp;is&nbsp;wrong&nbsp;if&nbsp;at&nbsp;the&nbsp;end,&nbsp;the&nbsp;top&nbsp;level&nbsp;is&nbsp;null&nbsp;or&nbsp;hasn&#39;t&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4338257">//&nbsp;all&nbsp;of&nbsp;the&nbsp;leaves.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4338280">if</span>&nbsp;<span class="ident" id="4338283">leafCounts</span><span class="op" id="4338293">[</span><span class="ident" id="4338294">maxBits</span><span class="op" id="4338301">]</span><span class="op" id="4338302">[</span><span class="ident" id="4338303">maxBits</span><span class="op" id="4338310">]</span>&nbsp;<span class="op" id="4338312">!=</span>&nbsp;<span class="ident" id="4338315">n</span>&nbsp;<span class="op" id="4338317">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4338321">panic</span><span class="op" id="4338326">(</span><span class="string" id="4338327">&#34;leafCounts[maxBits][maxBits]&nbsp;!=&nbsp;n&#34;</span><span class="op" id="4338362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4338365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4338369">bitCount</span>&nbsp;<span class="op" id="4338378">:=</span>&nbsp;<span class="builtinfunc" id="4338381">make</span><span class="op" id="4338385">(</span><span class="op" id="4338386">[</span><span class="op" id="4338387">]</span><span class="builtintype" id="4338388">int32</span><span class="op" id="4338393">,</span>&nbsp;<span class="ident" id="4338395">maxBits</span><span class="op" id="4338402">+</span><span class="num" id="4338403">1</span><span class="op" id="4338404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4338407">bits</span>&nbsp;<span class="op" id="4338412">:=</span>&nbsp;<span class="num" id="4338415">1</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4338418">counts</span>&nbsp;<span class="op" id="4338425">:=</span>&nbsp;<span class="op" id="4338428">&amp;</span><span class="ident" id="4338429">leafCounts</span><span class="op" id="4338439">[</span><span class="ident" id="4338440">maxBits</span><span class="op" id="4338447">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4338450">for</span>&nbsp;<span class="ident" id="4338454">level</span>&nbsp;<span class="op" id="4338460">:=</span>&nbsp;<span class="ident" id="4338463">maxBits</span><span class="op" id="4338470">;</span>&nbsp;<span class="ident" id="4338472">level</span>&nbsp;<span class="op" id="4338478">&gt;</span>&nbsp;<span class="num" id="4338480">0</span><span class="op" id="4338481">;</span>&nbsp;<span class="ident" id="4338483">level</span><span class="op" id="4338488">--</span>&nbsp;<span class="op" id="4338491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4338495">//&nbsp;chain.leafCount&nbsp;gives&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;requiring&nbsp;at&nbsp;least&nbsp;&#34;bits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4338571">//&nbsp;bits&nbsp;to&nbsp;encode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4338592">bitCount</span><span class="op" id="4338600">[</span><span class="ident" id="4338601">bits</span><span class="op" id="4338605">]</span>&nbsp;<span class="op" id="4338607">=</span>&nbsp;<span class="ident" id="4338609">counts</span><span class="op" id="4338615">[</span><span class="ident" id="4338616">level</span><span class="op" id="4338621">]</span>&nbsp;<span class="op" id="4338623">-</span>&nbsp;<span class="ident" id="4338625">counts</span><span class="op" id="4338631">[</span><span class="ident" id="4338632">level</span><span class="op" id="4338637">-</span><span class="num" id="4338638">1</span><span class="op" id="4338639">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4338643">bits</span><span class="op" id="4338647">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4338651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4338654">return</span>&nbsp;<span class="ident" id="4338661">bitCount</span><br>
<span class="lineno"></span><span class="op" id="4338670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="4338673">//&nbsp;Look&nbsp;at&nbsp;the&nbsp;leaves&nbsp;and&nbsp;assign&nbsp;them&nbsp;a&nbsp;bit&nbsp;count&nbsp;and&nbsp;an&nbsp;encoding&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="4338752">//&nbsp;in&nbsp;RFC&nbsp;1951&nbsp;3.2.2</span><br>
<span class="lineno"></span><span class="keyword" id="4338773">func</span>&nbsp;<span class="op" id="4338778">(</span><span class="ident" id="4338779">h</span>&nbsp;<span class="op" id="4338781">*</span><span class="ident" id="4338782">huffmanEncoder</span><span class="op" id="4338796">)</span>&nbsp;<span class="ident" id="4338798">assignEncodingAndSize</span><span class="op" id="4338819">(</span><span class="ident" id="4338820">bitCount</span>&nbsp;<span class="op" id="4338829">[</span><span class="op" id="4338830">]</span><span class="builtintype" id="4338831">int32</span><span class="op" id="4338836">,</span>&nbsp;<span class="ident" id="4338838">list</span>&nbsp;<span class="op" id="4338843">[</span><span class="op" id="4338844">]</span><span class="ident" id="4338845">literalNode</span><span class="op" id="4338856">)</span>&nbsp;<span class="op" id="4338858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4338861">code</span>&nbsp;<span class="op" id="4338866">:=</span>&nbsp;<span class="builtintype" id="4338869">uint16</span><span class="op" id="4338875">(</span><span class="num" id="4338876">0</span><span class="op" id="4338877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4338880">for</span>&nbsp;<span class="ident" id="4338884">n</span><span class="op" id="4338885">,</span>&nbsp;<span class="ident" id="4338887">bits</span>&nbsp;<span class="op" id="4338892">:=</span>&nbsp;<span class="keyword" id="4338895">range</span>&nbsp;<span class="ident" id="4338901">bitCount</span>&nbsp;<span class="op" id="4338910">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4338914">code</span>&nbsp;<span class="op" id="4338919">&lt;&lt;=</span>&nbsp;<span class="num" id="4338923">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4338927">if</span>&nbsp;<span class="ident" id="4338930">n</span>&nbsp;<span class="op" id="4338932">==</span>&nbsp;<span class="num" id="4338935">0</span>&nbsp;<span class="op" id="4338937">||</span>&nbsp;<span class="ident" id="4338940">bits</span>&nbsp;<span class="op" id="4338945">==</span>&nbsp;<span class="num" id="4338948">0</span>&nbsp;<span class="op" id="4338950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4338955">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4338966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4338970">//&nbsp;The&nbsp;literals&nbsp;list[len(list)-bits]&nbsp;..&nbsp;list[len(list)-bits]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4339033">//&nbsp;are&nbsp;encoded&nbsp;using&nbsp;&#34;bits&#34;&nbsp;bits,&nbsp;and&nbsp;get&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4339088">//&nbsp;code,&nbsp;code&nbsp;+&nbsp;1,&nbsp;....&nbsp;&nbsp;The&nbsp;code&nbsp;values&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4339135">//&nbsp;assigned&nbsp;in&nbsp;literal&nbsp;order&nbsp;(not&nbsp;frequency&nbsp;order).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339189">chunk</span>&nbsp;<span class="op" id="4339195">:=</span>&nbsp;<span class="ident" id="4339198">list</span><span class="op" id="4339202">[</span><span class="builtinfunc" id="4339203">len</span><span class="op" id="4339206">(</span><span class="ident" id="4339207">list</span><span class="op" id="4339211">)</span><span class="op" id="4339212">-</span><span class="builtintype" id="4339213">int</span><span class="op" id="4339216">(</span><span class="ident" id="4339217">bits</span><span class="op" id="4339221">)</span><span class="op" id="4339222">:</span><span class="op" id="4339223">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339227">sortByLiteral</span><span class="op" id="4339240">(</span><span class="ident" id="4339241">chunk</span><span class="op" id="4339246">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4339250">for</span>&nbsp;<span class="ident" id="4339254">_</span><span class="op" id="4339255">,</span>&nbsp;<span class="ident" id="4339257">node</span>&nbsp;<span class="op" id="4339262">:=</span>&nbsp;<span class="keyword" id="4339265">range</span>&nbsp;<span class="ident" id="4339271">chunk</span>&nbsp;<span class="op" id="4339277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339282">h</span><span class="op" id="4339283">.</span><span class="ident" id="4339284">codeBits</span><span class="op" id="4339292">[</span><span class="ident" id="4339293">node</span><span class="op" id="4339297">.</span><span class="ident" id="4339298">literal</span><span class="op" id="4339305">]</span>&nbsp;<span class="op" id="4339307">=</span>&nbsp;<span class="builtintype" id="4339309">uint8</span><span class="op" id="4339314">(</span><span class="ident" id="4339315">n</span><span class="op" id="4339316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339321">h</span><span class="op" id="4339322">.</span><span class="ident" id="4339323">code</span><span class="op" id="4339327">[</span><span class="ident" id="4339328">node</span><span class="op" id="4339332">.</span><span class="ident" id="4339333">literal</span><span class="op" id="4339340">]</span>&nbsp;<span class="op" id="4339342">=</span>&nbsp;<span class="ident" id="4339344">reverseBits</span><span class="op" id="4339355">(</span><span class="ident" id="4339356">code</span><span class="op" id="4339360">,</span>&nbsp;<span class="builtintype" id="4339362">uint8</span><span class="op" id="4339367">(</span><span class="ident" id="4339368">n</span><span class="op" id="4339369">)</span><span class="op" id="4339370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339375">code</span><span class="op" id="4339379">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4339384">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339388">list</span>&nbsp;<span class="op" id="4339393">=</span>&nbsp;<span class="ident" id="4339395">list</span><span class="op" id="4339399">[</span><span class="num" id="4339400">0</span>&nbsp;<span class="op" id="4339402">:</span>&nbsp;<span class="builtinfunc" id="4339404">len</span><span class="op" id="4339407">(</span><span class="ident" id="4339408">list</span><span class="op" id="4339412">)</span><span class="op" id="4339413">-</span><span class="builtintype" id="4339414">int</span><span class="op" id="4339417">(</span><span class="ident" id="4339418">bits</span><span class="op" id="4339422">)</span><span class="op" id="4339423">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4339426">}</span><br>
<span class="lineno"></span><span class="op" id="4339428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4339431">//&nbsp;Update&nbsp;this&nbsp;Huffman&nbsp;Code&nbsp;object&nbsp;to&nbsp;be&nbsp;the&nbsp;minimum&nbsp;code&nbsp;for&nbsp;the&nbsp;specified&nbsp;frequency&nbsp;count.</span><br>
<span class="lineno">260</span><span class="comment" id="4339524">//</span><br>
<span class="lineno"></span><span class="comment" id="4339527">//&nbsp;freq&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;frequencies,&nbsp;in&nbsp;which&nbsp;frequency[i]&nbsp;gives&nbsp;the&nbsp;frequency&nbsp;of&nbsp;literal&nbsp;i.</span><br>
<span class="lineno"></span><span class="comment" id="4339617">//&nbsp;maxBits&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;any&nbsp;literal.</span><br>
<span class="lineno"></span><span class="keyword" id="4339680">func</span>&nbsp;<span class="op" id="4339685">(</span><span class="ident" id="4339686">h</span>&nbsp;<span class="op" id="4339688">*</span><span class="ident" id="4339689">huffmanEncoder</span><span class="op" id="4339703">)</span>&nbsp;<span class="ident" id="4339705">generate</span><span class="op" id="4339713">(</span><span class="ident" id="4339714">freq</span>&nbsp;<span class="op" id="4339719">[</span><span class="op" id="4339720">]</span><span class="builtintype" id="4339721">int32</span><span class="op" id="4339726">,</span>&nbsp;<span class="ident" id="4339728">maxBits</span>&nbsp;<span class="builtintype" id="4339736">int32</span><span class="op" id="4339741">)</span>&nbsp;<span class="op" id="4339743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339746">list</span>&nbsp;<span class="op" id="4339751">:=</span>&nbsp;<span class="builtinfunc" id="4339754">make</span><span class="op" id="4339758">(</span><span class="op" id="4339759">[</span><span class="op" id="4339760">]</span><span class="ident" id="4339761">literalNode</span><span class="op" id="4339772">,</span>&nbsp;<span class="builtinfunc" id="4339774">len</span><span class="op" id="4339777">(</span><span class="ident" id="4339778">freq</span><span class="op" id="4339782">)</span><span class="op" id="4339783">+</span><span class="num" id="4339784">1</span><span class="op" id="4339785">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4339788">//&nbsp;Number&nbsp;of&nbsp;non-zero&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339820">count</span>&nbsp;<span class="op" id="4339826">:=</span>&nbsp;<span class="num" id="4339829">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4339832">//&nbsp;Set&nbsp;list&nbsp;to&nbsp;be&nbsp;the&nbsp;set&nbsp;of&nbsp;all&nbsp;non-zero&nbsp;literals&nbsp;and&nbsp;their&nbsp;frequencies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4339906">for</span>&nbsp;<span class="ident" id="4339910">i</span><span class="op" id="4339911">,</span>&nbsp;<span class="ident" id="4339913">f</span>&nbsp;<span class="op" id="4339915">:=</span>&nbsp;<span class="keyword" id="4339918">range</span>&nbsp;<span class="ident" id="4339924">freq</span>&nbsp;<span class="op" id="4339929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4339933">if</span>&nbsp;<span class="ident" id="4339936">f</span>&nbsp;<span class="op" id="4339938">!=</span>&nbsp;<span class="num" id="4339941">0</span>&nbsp;<span class="op" id="4339943">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339948">list</span><span class="op" id="4339952">[</span><span class="ident" id="4339953">count</span><span class="op" id="4339958">]</span>&nbsp;<span class="op" id="4339960">=</span>&nbsp;<span class="ident" id="4339962">literalNode</span><span class="op" id="4339973">{</span><span class="builtintype" id="4339974">uint16</span><span class="op" id="4339980">(</span><span class="ident" id="4339981">i</span><span class="op" id="4339982">)</span><span class="op" id="4339983">,</span>&nbsp;<span class="ident" id="4339985">f</span><span class="op" id="4339986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4339991">count</span><span class="op" id="4339996">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4340001">}</span>&nbsp;<span class="keyword" id="4340003">else</span>&nbsp;<span class="op" id="4340008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340013">h</span><span class="op" id="4340014">.</span><span class="ident" id="4340015">codeBits</span><span class="op" id="4340023">[</span><span class="ident" id="4340024">i</span><span class="op" id="4340025">]</span>&nbsp;<span class="op" id="4340027">=</span>&nbsp;<span class="num" id="4340029">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4340033">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4340036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4340039">//&nbsp;If&nbsp;freq[]&nbsp;is&nbsp;shorter&nbsp;than&nbsp;codeBits[],&nbsp;fill&nbsp;rest&nbsp;of&nbsp;codeBits[]&nbsp;with&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340116">h</span><span class="op" id="4340117">.</span><span class="ident" id="4340118">codeBits</span>&nbsp;<span class="op" id="4340127">=</span>&nbsp;<span class="ident" id="4340129">h</span><span class="op" id="4340130">.</span><span class="ident" id="4340131">codeBits</span><span class="op" id="4340139">[</span><span class="num" id="4340140">0</span><span class="op" id="4340141">:</span><span class="builtinfunc" id="4340142">len</span><span class="op" id="4340145">(</span><span class="ident" id="4340146">freq</span><span class="op" id="4340150">)</span><span class="op" id="4340151">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340154">list</span>&nbsp;<span class="op" id="4340159">=</span>&nbsp;<span class="ident" id="4340161">list</span><span class="op" id="4340165">[</span><span class="num" id="4340166">0</span><span class="op" id="4340167">:</span><span class="ident" id="4340168">count</span><span class="op" id="4340173">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4340176">if</span>&nbsp;<span class="ident" id="4340179">count</span>&nbsp;<span class="op" id="4340185">&lt;=</span>&nbsp;<span class="num" id="4340188">2</span>&nbsp;<span class="op" id="4340190">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4340194">//&nbsp;Handle&nbsp;the&nbsp;small&nbsp;cases&nbsp;here,&nbsp;because&nbsp;they&nbsp;are&nbsp;awkward&nbsp;for&nbsp;the&nbsp;general&nbsp;case&nbsp;code.&nbsp;&nbsp;With</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4340286">//&nbsp;two&nbsp;or&nbsp;fewer&nbsp;literals,&nbsp;everything&nbsp;has&nbsp;bit&nbsp;length&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4340343">for</span>&nbsp;<span class="ident" id="4340347">i</span><span class="op" id="4340348">,</span>&nbsp;<span class="ident" id="4340350">node</span>&nbsp;<span class="op" id="4340355">:=</span>&nbsp;<span class="keyword" id="4340358">range</span>&nbsp;<span class="ident" id="4340364">list</span>&nbsp;<span class="op" id="4340369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4340374">//&nbsp;&#34;list&#34;&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing&nbsp;literal&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340428">h</span><span class="op" id="4340429">.</span><span class="ident" id="4340430">codeBits</span><span class="op" id="4340438">[</span><span class="ident" id="4340439">node</span><span class="op" id="4340443">.</span><span class="ident" id="4340444">literal</span><span class="op" id="4340451">]</span>&nbsp;<span class="op" id="4340453">=</span>&nbsp;<span class="num" id="4340455">1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340460">h</span><span class="op" id="4340461">.</span><span class="ident" id="4340462">code</span><span class="op" id="4340466">[</span><span class="ident" id="4340467">node</span><span class="op" id="4340471">.</span><span class="ident" id="4340472">literal</span><span class="op" id="4340479">]</span>&nbsp;<span class="op" id="4340481">=</span>&nbsp;<span class="builtintype" id="4340483">uint16</span><span class="op" id="4340489">(</span><span class="ident" id="4340490">i</span><span class="op" id="4340491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4340495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4340499">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4340507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340510">sortByFreq</span><span class="op" id="4340520">(</span><span class="ident" id="4340521">list</span><span class="op" id="4340525">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4340529">//&nbsp;Get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;for&nbsp;each&nbsp;bit&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340579">bitCount</span>&nbsp;<span class="op" id="4340588">:=</span>&nbsp;<span class="ident" id="4340591">h</span><span class="op" id="4340592">.</span><span class="ident" id="4340593">bitCounts</span><span class="op" id="4340602">(</span><span class="ident" id="4340603">list</span><span class="op" id="4340607">,</span>&nbsp;<span class="ident" id="4340609">maxBits</span><span class="op" id="4340616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4340619">//&nbsp;And&nbsp;do&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340645">h</span><span class="op" id="4340646">.</span><span class="ident" id="4340647">assignEncodingAndSize</span><span class="op" id="4340668">(</span><span class="ident" id="4340669">bitCount</span><span class="op" id="4340677">,</span>&nbsp;<span class="ident" id="4340679">list</span><span class="op" id="4340683">)</span><br>
<span class="lineno">295</span><span class="op" id="4340685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4340688">type</span>&nbsp;<span class="ident" id="4340693">literalNodeSorter</span>&nbsp;<span class="keyword" id="4340711">struct</span>&nbsp;<span class="op" id="4340718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340721">a</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4340726">[</span><span class="op" id="4340727">]</span><span class="ident" id="4340728">literalNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4340741">less</span>&nbsp;<span class="keyword" id="4340746">func</span><span class="op" id="4340750">(</span><span class="ident" id="4340751">i</span><span class="op" id="4340752">,</span>&nbsp;<span class="ident" id="4340754">j</span>&nbsp;<span class="builtintype" id="4340756">int</span><span class="op" id="4340759">)</span>&nbsp;<span class="builtintype" id="4340761">bool</span><br>
<span class="lineno">300</span><span class="op" id="4340766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4340769">func</span>&nbsp;<span class="op" id="4340774">(</span><span class="ident" id="4340775">s</span>&nbsp;<span class="ident" id="4340777">literalNodeSorter</span><span class="op" id="4340794">)</span>&nbsp;<span class="ident" id="4340796">Len</span><span class="op" id="4340799">(</span><span class="op" id="4340800">)</span>&nbsp;<span class="builtintype" id="4340802">int</span>&nbsp;<span class="op" id="4340806">{</span>&nbsp;<span class="keyword" id="4340808">return</span>&nbsp;<span class="builtinfunc" id="4340815">len</span><span class="op" id="4340818">(</span><span class="ident" id="4340819">s</span><span class="op" id="4340820">.</span><span class="ident" id="4340821">a</span><span class="op" id="4340822">)</span>&nbsp;<span class="op" id="4340824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4340827">func</span>&nbsp;<span class="op" id="4340832">(</span><span class="ident" id="4340833">s</span>&nbsp;<span class="ident" id="4340835">literalNodeSorter</span><span class="op" id="4340852">)</span>&nbsp;<span class="ident" id="4340854">Less</span><span class="op" id="4340858">(</span><span class="ident" id="4340859">i</span><span class="op" id="4340860">,</span>&nbsp;<span class="ident" id="4340862">j</span>&nbsp;<span class="builtintype" id="4340864">int</span><span class="op" id="4340867">)</span>&nbsp;<span class="builtintype" id="4340869">bool</span>&nbsp;<span class="op" id="4340874">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4340877">return</span>&nbsp;<span class="ident" id="4340884">s</span><span class="op" id="4340885">.</span><span class="ident" id="4340886">less</span><span class="op" id="4340890">(</span><span class="ident" id="4340891">i</span><span class="op" id="4340892">,</span>&nbsp;<span class="ident" id="4340894">j</span><span class="op" id="4340895">)</span><br>
<span class="lineno"></span><span class="op" id="4340897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4340900">func</span>&nbsp;<span class="op" id="4340905">(</span><span class="ident" id="4340906">s</span>&nbsp;<span class="ident" id="4340908">literalNodeSorter</span><span class="op" id="4340925">)</span>&nbsp;<span class="ident" id="4340927">Swap</span><span class="op" id="4340931">(</span><span class="ident" id="4340932">i</span><span class="op" id="4340933">,</span>&nbsp;<span class="ident" id="4340935">j</span>&nbsp;<span class="builtintype" id="4340937">int</span><span class="op" id="4340940">)</span>&nbsp;<span class="op" id="4340942">{</span>&nbsp;<span class="ident" id="4340944">s</span><span class="op" id="4340945">.</span><span class="ident" id="4340946">a</span><span class="op" id="4340947">[</span><span class="ident" id="4340948">i</span><span class="op" id="4340949">]</span><span class="op" id="4340950">,</span>&nbsp;<span class="ident" id="4340952">s</span><span class="op" id="4340953">.</span><span class="ident" id="4340954">a</span><span class="op" id="4340955">[</span><span class="ident" id="4340956">j</span><span class="op" id="4340957">]</span>&nbsp;<span class="op" id="4340959">=</span>&nbsp;<span class="ident" id="4340961">s</span><span class="op" id="4340962">.</span><span class="ident" id="4340963">a</span><span class="op" id="4340964">[</span><span class="ident" id="4340965">j</span><span class="op" id="4340966">]</span><span class="op" id="4340967">,</span>&nbsp;<span class="ident" id="4340969">s</span><span class="op" id="4340970">.</span><span class="ident" id="4340971">a</span><span class="op" id="4340972">[</span><span class="ident" id="4340973">i</span><span class="op" id="4340974">]</span>&nbsp;<span class="op" id="4340976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="keyword" id="4340979">func</span>&nbsp;<span class="ident" id="4340984">sortByFreq</span><span class="op" id="4340994">(</span><span class="ident" id="4340995">a</span>&nbsp;<span class="op" id="4340997">[</span><span class="op" id="4340998">]</span><span class="ident" id="4340999">literalNode</span><span class="op" id="4341010">)</span>&nbsp;<span class="op" id="4341012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341015">s</span>&nbsp;<span class="op" id="4341017">:=</span>&nbsp;<span class="op" id="4341020">&amp;</span><span class="ident" id="4341021">literalNodeSorter</span><span class="op" id="4341038">{</span><span class="ident" id="4341039">a</span><span class="op" id="4341040">,</span>&nbsp;<span class="keyword" id="4341042">func</span><span class="op" id="4341046">(</span><span class="ident" id="4341047">i</span><span class="op" id="4341048">,</span>&nbsp;<span class="ident" id="4341050">j</span>&nbsp;<span class="builtintype" id="4341052">int</span><span class="op" id="4341055">)</span>&nbsp;<span class="builtintype" id="4341057">bool</span>&nbsp;<span class="op" id="4341062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4341066">if</span>&nbsp;<span class="ident" id="4341069">a</span><span class="op" id="4341070">[</span><span class="ident" id="4341071">i</span><span class="op" id="4341072">]</span><span class="op" id="4341073">.</span><span class="ident" id="4341074">freq</span>&nbsp;<span class="op" id="4341079">==</span>&nbsp;<span class="ident" id="4341082">a</span><span class="op" id="4341083">[</span><span class="ident" id="4341084">j</span><span class="op" id="4341085">]</span><span class="op" id="4341086">.</span><span class="ident" id="4341087">freq</span>&nbsp;<span class="op" id="4341092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4341097">return</span>&nbsp;<span class="ident" id="4341104">a</span><span class="op" id="4341105">[</span><span class="ident" id="4341106">i</span><span class="op" id="4341107">]</span><span class="op" id="4341108">.</span><span class="ident" id="4341109">literal</span>&nbsp;<span class="op" id="4341117">&lt;</span>&nbsp;<span class="ident" id="4341119">a</span><span class="op" id="4341120">[</span><span class="ident" id="4341121">j</span><span class="op" id="4341122">]</span><span class="op" id="4341123">.</span><span class="ident" id="4341124">literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4341134">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4341138">return</span>&nbsp;<span class="ident" id="4341145">a</span><span class="op" id="4341146">[</span><span class="ident" id="4341147">i</span><span class="op" id="4341148">]</span><span class="op" id="4341149">.</span><span class="ident" id="4341150">freq</span>&nbsp;<span class="op" id="4341155">&lt;</span>&nbsp;<span class="ident" id="4341157">a</span><span class="op" id="4341158">[</span><span class="ident" id="4341159">j</span><span class="op" id="4341160">]</span><span class="op" id="4341161">.</span><span class="ident" id="4341162">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4341168">}</span><span class="op" id="4341169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341172">sort</span><span class="op" id="4341176">.</span><span class="ident" id="4341177">Sort</span><span class="op" id="4341181">(</span><span class="ident" id="4341182">s</span><span class="op" id="4341183">)</span><br>
<span class="lineno"></span><span class="op" id="4341185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="keyword" id="4341188">func</span>&nbsp;<span class="ident" id="4341193">sortByLiteral</span><span class="op" id="4341206">(</span><span class="ident" id="4341207">a</span>&nbsp;<span class="op" id="4341209">[</span><span class="op" id="4341210">]</span><span class="ident" id="4341211">literalNode</span><span class="op" id="4341222">)</span>&nbsp;<span class="op" id="4341224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341227">s</span>&nbsp;<span class="op" id="4341229">:=</span>&nbsp;<span class="op" id="4341232">&amp;</span><span class="ident" id="4341233">literalNodeSorter</span><span class="op" id="4341250">{</span><span class="ident" id="4341251">a</span><span class="op" id="4341252">,</span>&nbsp;<span class="keyword" id="4341254">func</span><span class="op" id="4341258">(</span><span class="ident" id="4341259">i</span><span class="op" id="4341260">,</span>&nbsp;<span class="ident" id="4341262">j</span>&nbsp;<span class="builtintype" id="4341264">int</span><span class="op" id="4341267">)</span>&nbsp;<span class="builtintype" id="4341269">bool</span>&nbsp;<span class="op" id="4341274">{</span>&nbsp;<span class="keyword" id="4341276">return</span>&nbsp;<span class="ident" id="4341283">a</span><span class="op" id="4341284">[</span><span class="ident" id="4341285">i</span><span class="op" id="4341286">]</span><span class="op" id="4341287">.</span><span class="ident" id="4341288">literal</span>&nbsp;<span class="op" id="4341296">&lt;</span>&nbsp;<span class="ident" id="4341298">a</span><span class="op" id="4341299">[</span><span class="ident" id="4341300">j</span><span class="op" id="4341301">]</span><span class="op" id="4341302">.</span><span class="ident" id="4341303">literal</span>&nbsp;<span class="op" id="4341311">}</span><span class="op" id="4341312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341315">sort</span><span class="op" id="4341319">.</span><span class="ident" id="4341320">Sort</span><span class="op" id="4341324">(</span><span class="ident" id="4341325">s</span><span class="op" id="4341326">)</span><br>
<span class="lineno"></span><span class="op" id="4341328">}</span>
</div>
</body>
</html>
