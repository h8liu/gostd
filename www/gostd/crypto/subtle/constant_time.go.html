<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html" class="current">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4385986">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4386041">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4386095">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4386146">//&nbsp;Package&nbsp;subtle&nbsp;implements&nbsp;functions&nbsp;that&nbsp;are&nbsp;often&nbsp;useful&nbsp;in&nbsp;cryptographic</span><br>
<span class="lineno"></span><span class="comment" id="4386224">//&nbsp;code&nbsp;but&nbsp;require&nbsp;careful&nbsp;thought&nbsp;to&nbsp;use&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="keyword" id="4386278">package</span>&nbsp;<span class="ident" id="4386286">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4386294">//&nbsp;ConstantTimeCompare&nbsp;returns&nbsp;1&nbsp;iff&nbsp;the&nbsp;two&nbsp;slices,&nbsp;x</span><br>
<span class="lineno">10</span><span class="comment" id="4386349">//&nbsp;and&nbsp;y,&nbsp;have&nbsp;equal&nbsp;contents.&nbsp;The&nbsp;time&nbsp;taken&nbsp;is&nbsp;a&nbsp;function&nbsp;of&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4386426">//&nbsp;the&nbsp;slices&nbsp;and&nbsp;is&nbsp;independent&nbsp;of&nbsp;the&nbsp;contents.</span><br>
<span class="lineno"></span><span class="keyword" id="4386476">func</span>&nbsp;<span class="ident" id="4386481">ConstantTimeCompare</span><span class="op" id="4386500">(</span><span class="ident" id="4386501">x</span><span class="op" id="4386502">,</span>&nbsp;<span class="ident" id="4386504">y</span>&nbsp;<span class="op" id="4386506">[</span><span class="op" id="4386507">]</span><span class="builtintype" id="4386508">byte</span><span class="op" id="4386512">)</span>&nbsp;<span class="builtintype" id="4386514">int</span>&nbsp;<span class="op" id="4386518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4386521">if</span>&nbsp;<span class="builtinfunc" id="4386524">len</span><span class="op" id="4386527">(</span><span class="ident" id="4386528">x</span><span class="op" id="4386529">)</span>&nbsp;<span class="op" id="4386531">!=</span>&nbsp;<span class="builtinfunc" id="4386534">len</span><span class="op" id="4386537">(</span><span class="ident" id="4386538">y</span><span class="op" id="4386539">)</span>&nbsp;<span class="op" id="4386541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4386545">return</span>&nbsp;<span class="num" id="4386552">0</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4386555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4386559">var</span>&nbsp;<span class="ident" id="4386563">v</span>&nbsp;<span class="builtintype" id="4386565">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4386572">for</span>&nbsp;<span class="ident" id="4386576">i</span>&nbsp;<span class="op" id="4386578">:=</span>&nbsp;<span class="num" id="4386581">0</span><span class="op" id="4386582">;</span>&nbsp;<span class="ident" id="4386584">i</span>&nbsp;<span class="op" id="4386586">&lt;</span>&nbsp;<span class="builtinfunc" id="4386588">len</span><span class="op" id="4386591">(</span><span class="ident" id="4386592">x</span><span class="op" id="4386593">)</span><span class="op" id="4386594">;</span>&nbsp;<span class="ident" id="4386596">i</span><span class="op" id="4386597">++</span>&nbsp;<span class="op" id="4386600">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4386604">v</span>&nbsp;<span class="op" id="4386606">|=</span>&nbsp;<span class="ident" id="4386609">x</span><span class="op" id="4386610">[</span><span class="ident" id="4386611">i</span><span class="op" id="4386612">]</span>&nbsp;<span class="op" id="4386614">^</span>&nbsp;<span class="ident" id="4386616">y</span><span class="op" id="4386617">[</span><span class="ident" id="4386618">i</span><span class="op" id="4386619">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4386622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4386626">return</span>&nbsp;<span class="ident" id="4386633">ConstantTimeByteEq</span><span class="op" id="4386651">(</span><span class="ident" id="4386652">v</span><span class="op" id="4386653">,</span>&nbsp;<span class="num" id="4386655">0</span><span class="op" id="4386656">)</span><br>
<span class="lineno"></span><span class="op" id="4386658">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4386661">//&nbsp;ConstantTimeSelect&nbsp;returns&nbsp;x&nbsp;if&nbsp;v&nbsp;is&nbsp;1&nbsp;and&nbsp;y&nbsp;if&nbsp;v&nbsp;is&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="4386720">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4386777">func</span>&nbsp;<span class="ident" id="4386782">ConstantTimeSelect</span><span class="op" id="4386800">(</span><span class="ident" id="4386801">v</span><span class="op" id="4386802">,</span>&nbsp;<span class="ident" id="4386804">x</span><span class="op" id="4386805">,</span>&nbsp;<span class="ident" id="4386807">y</span>&nbsp;<span class="builtintype" id="4386809">int</span><span class="op" id="4386812">)</span>&nbsp;<span class="builtintype" id="4386814">int</span>&nbsp;<span class="op" id="4386818">{</span>&nbsp;<span class="keyword" id="4386820">return</span>&nbsp;<span class="op" id="4386827">^</span><span class="op" id="4386828">(</span><span class="ident" id="4386829">v</span><span class="op" id="4386830">-</span><span class="num" id="4386831">1</span><span class="op" id="4386832">)</span><span class="op" id="4386833">&amp;</span><span class="ident" id="4386834">x</span>&nbsp;<span class="op" id="4386836">|</span>&nbsp;<span class="op" id="4386838">(</span><span class="ident" id="4386839">v</span><span class="op" id="4386840">-</span><span class="num" id="4386841">1</span><span class="op" id="4386842">)</span><span class="op" id="4386843">&amp;</span><span class="ident" id="4386844">y</span>&nbsp;<span class="op" id="4386846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="4386849">//&nbsp;ConstantTimeByteEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="4386908">func</span>&nbsp;<span class="ident" id="4386913">ConstantTimeByteEq</span><span class="op" id="4386931">(</span><span class="ident" id="4386932">x</span><span class="op" id="4386933">,</span>&nbsp;<span class="ident" id="4386935">y</span>&nbsp;<span class="builtintype" id="4386937">uint8</span><span class="op" id="4386942">)</span>&nbsp;<span class="builtintype" id="4386944">int</span>&nbsp;<span class="op" id="4386948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4386951">z</span>&nbsp;<span class="op" id="4386953">:=</span>&nbsp;<span class="op" id="4386956">^</span><span class="op" id="4386957">(</span><span class="ident" id="4386958">x</span>&nbsp;<span class="op" id="4386960">^</span>&nbsp;<span class="ident" id="4386962">y</span><span class="op" id="4386963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4386966">z</span>&nbsp;<span class="op" id="4386968">&amp;=</span>&nbsp;<span class="ident" id="4386971">z</span>&nbsp;<span class="op" id="4386973">&gt;&gt;</span>&nbsp;<span class="num" id="4386976">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4386979">z</span>&nbsp;<span class="op" id="4386981">&amp;=</span>&nbsp;<span class="ident" id="4386984">z</span>&nbsp;<span class="op" id="4386986">&gt;&gt;</span>&nbsp;<span class="num" id="4386989">2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4386992">z</span>&nbsp;<span class="op" id="4386994">&amp;=</span>&nbsp;<span class="ident" id="4386997">z</span>&nbsp;<span class="op" id="4386999">&gt;&gt;</span>&nbsp;<span class="num" id="4387002">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4387006">return</span>&nbsp;<span class="builtintype" id="4387013">int</span><span class="op" id="4387016">(</span><span class="ident" id="4387017">z</span><span class="op" id="4387018">)</span><br>
<span class="lineno"></span><span class="op" id="4387020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="4387023">//&nbsp;ConstantTimeEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="4387078">func</span>&nbsp;<span class="ident" id="4387083">ConstantTimeEq</span><span class="op" id="4387097">(</span><span class="ident" id="4387098">x</span><span class="op" id="4387099">,</span>&nbsp;<span class="ident" id="4387101">y</span>&nbsp;<span class="builtintype" id="4387103">int32</span><span class="op" id="4387108">)</span>&nbsp;<span class="builtintype" id="4387110">int</span>&nbsp;<span class="op" id="4387114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387117">z</span>&nbsp;<span class="op" id="4387119">:=</span>&nbsp;<span class="op" id="4387122">^</span><span class="op" id="4387123">(</span><span class="ident" id="4387124">x</span>&nbsp;<span class="op" id="4387126">^</span>&nbsp;<span class="ident" id="4387128">y</span><span class="op" id="4387129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387132">z</span>&nbsp;<span class="op" id="4387134">&amp;=</span>&nbsp;<span class="ident" id="4387137">z</span>&nbsp;<span class="op" id="4387139">&gt;&gt;</span>&nbsp;<span class="num" id="4387142">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387146">z</span>&nbsp;<span class="op" id="4387148">&amp;=</span>&nbsp;<span class="ident" id="4387151">z</span>&nbsp;<span class="op" id="4387153">&gt;&gt;</span>&nbsp;<span class="num" id="4387156">8</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387159">z</span>&nbsp;<span class="op" id="4387161">&amp;=</span>&nbsp;<span class="ident" id="4387164">z</span>&nbsp;<span class="op" id="4387166">&gt;&gt;</span>&nbsp;<span class="num" id="4387169">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387172">z</span>&nbsp;<span class="op" id="4387174">&amp;=</span>&nbsp;<span class="ident" id="4387177">z</span>&nbsp;<span class="op" id="4387179">&gt;&gt;</span>&nbsp;<span class="num" id="4387182">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387185">z</span>&nbsp;<span class="op" id="4387187">&amp;=</span>&nbsp;<span class="ident" id="4387190">z</span>&nbsp;<span class="op" id="4387192">&gt;&gt;</span>&nbsp;<span class="num" id="4387195">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4387199">return</span>&nbsp;<span class="builtintype" id="4387206">int</span><span class="op" id="4387209">(</span><span class="ident" id="4387210">z</span>&nbsp;<span class="op" id="4387212">&amp;</span>&nbsp;<span class="num" id="4387214">1</span><span class="op" id="4387215">)</span><br>
<span class="lineno">50</span><span class="op" id="4387217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4387220">//&nbsp;ConstantTimeCopy&nbsp;copies&nbsp;the&nbsp;contents&nbsp;of&nbsp;y&nbsp;into&nbsp;x&nbsp;(a&nbsp;slice&nbsp;of&nbsp;equal&nbsp;length)</span><br>
<span class="lineno"></span><span class="comment" id="4387298">//&nbsp;if&nbsp;v&nbsp;==&nbsp;1.&nbsp;If&nbsp;v&nbsp;==&nbsp;0,&nbsp;x&nbsp;is&nbsp;left&nbsp;unchanged.&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v</span><br>
<span class="lineno"></span><span class="comment" id="4387375">//&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno">55</span><span class="keyword" id="4387401">func</span>&nbsp;<span class="ident" id="4387406">ConstantTimeCopy</span><span class="op" id="4387422">(</span><span class="ident" id="4387423">v</span>&nbsp;<span class="builtintype" id="4387425">int</span><span class="op" id="4387428">,</span>&nbsp;<span class="ident" id="4387430">x</span><span class="op" id="4387431">,</span>&nbsp;<span class="ident" id="4387433">y</span>&nbsp;<span class="op" id="4387435">[</span><span class="op" id="4387436">]</span><span class="builtintype" id="4387437">byte</span><span class="op" id="4387441">)</span>&nbsp;<span class="op" id="4387443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4387446">if</span>&nbsp;<span class="builtinfunc" id="4387449">len</span><span class="op" id="4387452">(</span><span class="ident" id="4387453">x</span><span class="op" id="4387454">)</span>&nbsp;<span class="op" id="4387456">!=</span>&nbsp;<span class="builtinfunc" id="4387459">len</span><span class="op" id="4387462">(</span><span class="ident" id="4387463">y</span><span class="op" id="4387464">)</span>&nbsp;<span class="op" id="4387466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4387470">panic</span><span class="op" id="4387475">(</span><span class="string" id="4387476">&#34;subtle:&nbsp;slices&nbsp;have&nbsp;different&nbsp;lengths&#34;</span><span class="op" id="4387515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4387518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387522">xmask</span>&nbsp;<span class="op" id="4387528">:=</span>&nbsp;<span class="builtintype" id="4387531">byte</span><span class="op" id="4387535">(</span><span class="ident" id="4387536">v</span>&nbsp;<span class="op" id="4387538">-</span>&nbsp;<span class="num" id="4387540">1</span><span class="op" id="4387541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387544">ymask</span>&nbsp;<span class="op" id="4387550">:=</span>&nbsp;<span class="builtintype" id="4387553">byte</span><span class="op" id="4387557">(</span><span class="op" id="4387558">^</span><span class="op" id="4387559">(</span><span class="ident" id="4387560">v</span>&nbsp;<span class="op" id="4387562">-</span>&nbsp;<span class="num" id="4387564">1</span><span class="op" id="4387565">)</span><span class="op" id="4387566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4387569">for</span>&nbsp;<span class="ident" id="4387573">i</span>&nbsp;<span class="op" id="4387575">:=</span>&nbsp;<span class="num" id="4387578">0</span><span class="op" id="4387579">;</span>&nbsp;<span class="ident" id="4387581">i</span>&nbsp;<span class="op" id="4387583">&lt;</span>&nbsp;<span class="builtinfunc" id="4387585">len</span><span class="op" id="4387588">(</span><span class="ident" id="4387589">x</span><span class="op" id="4387590">)</span><span class="op" id="4387591">;</span>&nbsp;<span class="ident" id="4387593">i</span><span class="op" id="4387594">++</span>&nbsp;<span class="op" id="4387597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387601">x</span><span class="op" id="4387602">[</span><span class="ident" id="4387603">i</span><span class="op" id="4387604">]</span>&nbsp;<span class="op" id="4387606">=</span>&nbsp;<span class="ident" id="4387608">x</span><span class="op" id="4387609">[</span><span class="ident" id="4387610">i</span><span class="op" id="4387611">]</span><span class="op" id="4387612">&amp;</span><span class="ident" id="4387613">xmask</span>&nbsp;<span class="op" id="4387619">|</span>&nbsp;<span class="ident" id="4387621">y</span><span class="op" id="4387622">[</span><span class="ident" id="4387623">i</span><span class="op" id="4387624">]</span><span class="op" id="4387625">&amp;</span><span class="ident" id="4387626">ymask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4387633">}</span><br>
<span class="lineno">65</span><span class="op" id="4387635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4387638">//&nbsp;ConstantTimeLessOrEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;&lt;=&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="4387699">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;x&nbsp;or&nbsp;y&nbsp;are&nbsp;negative&nbsp;or&nbsp;&gt;&nbsp;2**31&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="4387767">func</span>&nbsp;<span class="ident" id="4387772">ConstantTimeLessOrEq</span><span class="op" id="4387792">(</span><span class="ident" id="4387793">x</span><span class="op" id="4387794">,</span>&nbsp;<span class="ident" id="4387796">y</span>&nbsp;<span class="builtintype" id="4387798">int</span><span class="op" id="4387801">)</span>&nbsp;<span class="builtintype" id="4387803">int</span>&nbsp;<span class="op" id="4387807">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387810">x32</span>&nbsp;<span class="op" id="4387814">:=</span>&nbsp;<span class="builtintype" id="4387817">int32</span><span class="op" id="4387822">(</span><span class="ident" id="4387823">x</span><span class="op" id="4387824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4387827">y32</span>&nbsp;<span class="op" id="4387831">:=</span>&nbsp;<span class="builtintype" id="4387834">int32</span><span class="op" id="4387839">(</span><span class="ident" id="4387840">y</span><span class="op" id="4387841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4387844">return</span>&nbsp;<span class="builtintype" id="4387851">int</span><span class="op" id="4387854">(</span><span class="op" id="4387855">(</span><span class="op" id="4387856">(</span><span class="ident" id="4387857">x32</span>&nbsp;<span class="op" id="4387861">-</span>&nbsp;<span class="ident" id="4387863">y32</span>&nbsp;<span class="op" id="4387867">-</span>&nbsp;<span class="num" id="4387869">1</span><span class="op" id="4387870">)</span>&nbsp;<span class="op" id="4387872">&gt;&gt;</span>&nbsp;<span class="num" id="4387875">31</span><span class="op" id="4387877">)</span>&nbsp;<span class="op" id="4387879">&amp;</span>&nbsp;<span class="num" id="4387881">1</span><span class="op" id="4387882">)</span><br>
<span class="lineno"></span><span class="op" id="4387884">}</span>
</div>
</body>
</html>
