<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7965285">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7965340">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7965394">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7965445">package</span>&nbsp;<span class="ident" id="7965453">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7965458">import</span>&nbsp;<span class="op" id="7965465">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7965468">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7965477">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7965484">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7965490">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7965497">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7965508">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7965519">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7965526">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7965529">var</span>&nbsp;<span class="ident" id="7965533">rsaCertPEM</span>&nbsp;<span class="op" id="7965544">=</span>&nbsp;<span class="string" id="7965546">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB0zCCAX2gAwIBAgIJAI/M7BYjwB+uMA0GCSqGSIb3DQEBBQUAMEUxCzAJBgNV<br>
<span class="lineno"></span>BAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRlcm5ldCBX<br>
<span class="lineno">20</span>aWRnaXRzIFB0eSBMdGQwHhcNMTIwOTEyMjE1MjAyWhcNMTUwOTEyMjE1MjAyWjBF<br>
<span class="lineno"></span>MQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UECgwYSW50<br>
<span class="lineno"></span>ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBANLJ<br>
<span class="lineno"></span>hPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wok/4xIA+ui35/MmNa<br>
<span class="lineno"></span>rtNuC+BdZ1tMuVCPFZcCAwEAAaNQME4wHQYDVR0OBBYEFJvKs8RfJaXTH08W+SGv<br>
<span class="lineno">25</span>zQyKn0H8MB8GA1UdIwQYMBaAFJvKs8RfJaXTH08W+SGvzQyKn0H8MAwGA1UdEwQF<br>
<span class="lineno"></span>MAMBAf8wDQYJKoZIhvcNAQEFBQADQQBJlffJHybjDGxRMqaRmDhX0+6v02TUKZsW<br>
<span class="lineno"></span>r5QuVbpQhH6u+0UgcW0jp9QwpxoPTLTWGXEWBBBurxFwiCBhkQ+V<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="7966242">var</span>&nbsp;<span class="ident" id="7966246">rsaKeyPEM</span>&nbsp;<span class="op" id="7966256">=</span>&nbsp;<span class="string" id="7966258">`-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno">35</span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno"></span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">40</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7966759">//&nbsp;keyPEM&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;rsaKeyPEM,&nbsp;but&nbsp;declares&nbsp;itself&nbsp;as&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="7966823">//&nbsp;&#34;PRIVATE&nbsp;KEY&#34;,&nbsp;not&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;.&nbsp;&nbsp;http://golang.org/issue/4477</span><br>
<span class="lineno"></span><span class="keyword" id="7966894">var</span>&nbsp;<span class="ident" id="7966898">keyPEM</span>&nbsp;<span class="op" id="7966905">=</span>&nbsp;<span class="string" id="7966907">`-----BEGIN&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">45</span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno"></span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno">50</span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7967400">var</span>&nbsp;<span class="ident" id="7967404">ecdsaCertPEM</span>&nbsp;<span class="op" id="7967417">=</span>&nbsp;<span class="string" id="7967419">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/jCCAWICCQDscdUxw16XFDAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTI0MDQ4WhcNMTUxMTE0MTI0MDQ4WjBFMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTETMBEGA1UECBMKU29tZS1TdGF0ZTEhMB8GA1UEChMYSW50ZXJuZXQgV2lk<br>
<span class="lineno">60</span>Z2l0cyBQdHkgTHRkMIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQBY9+my9OoeSUR<br>
<span class="lineno"></span>lDQdV/x8LsOuLilthhiS1Tz4aGDHIPwC1mlvnf7fg5lecYpMCrLLhauAc1UJXcgl<br>
<span class="lineno"></span>01xoLuzgtAEAgv2P/jgytzRSpUYvgLBt1UA0leLYBy6mQQbrNEuqT3INapKIcUv8<br>
<span class="lineno"></span>XxYP0xMEUksLPq6Ca+CRSqTtrd/23uTnapkwCQYHKoZIzj0EAQOBigAwgYYCQXJo<br>
<span class="lineno"></span>A7Sl2nLVf+4Iu/tAX/IF4MavARKC4PPHK3zfuGfPR3oCCcsAoz3kAzOeijvd0iXb<br>
<span class="lineno">65</span>H5jBImIxPL4WxQNiBTexAkF8D1EtpYuWdlVQ80/h/f4pBcGiXPqX5h2PQSQY7hP1<br>
<span class="lineno"></span>+jwM1FGS4fREIOvlBYr/SzzQRtwrvrzGYxDEDbsC0ZGRnA==<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="7968176">var</span>&nbsp;<span class="ident" id="7968180">ecdsaKeyPEM</span>&nbsp;<span class="op" id="7968192">=</span>&nbsp;<span class="string" id="7968194">`-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBrsoKp0oqcv6/JovJJDoDVSGWdirrkgCWxrprGlzB9o0X8fV675X0<br>
<span class="lineno">75</span>NwuBenXFfeZvVcwluO7/Q9wkYoPd/t3jGImgBwYFK4EEACOhgYkDgYYABAFj36bL<br>
<span class="lineno"></span>06h5JRGUNB1X/Hwuw64uKW2GGJLVPPhoYMcg/ALWaW+d/t+DmV5xikwKssuFq4Bz<br>
<span class="lineno"></span>VQldyCXTXGgu7OC0AQCC/Y/+ODK3NFKlRi+AsG3VQDSV4tgHLqZBBus0S6pPcg1q<br>
<span class="lineno"></span>kohxS/xfFg/TEwRSSws+roJr4JFKpO2t3/be5OdqmQ==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">80</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7968634">var</span>&nbsp;<span class="ident" id="7968638">keyPairTests</span>&nbsp;<span class="op" id="7968651">=</span>&nbsp;<span class="op" id="7968653">[</span><span class="op" id="7968654">]</span><span class="keyword" id="7968655">struct</span>&nbsp;<span class="op" id="7968662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7968665">algo</span>&nbsp;<span class="builtintype" id="7968670">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7968678">cert</span>&nbsp;<span class="builtintype" id="7968683">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7968691">key</span>&nbsp;&nbsp;<span class="builtintype" id="7968696">string</span><br>
<span class="lineno"></span><span class="op" id="7968703">}</span><span class="op" id="7968704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7968707">{</span><span class="string" id="7968708">&#34;ECDSA&#34;</span><span class="op" id="7968715">,</span>&nbsp;<span class="ident" id="7968717">ecdsaCertPEM</span><span class="op" id="7968729">,</span>&nbsp;<span class="ident" id="7968731">ecdsaKeyPEM</span><span class="op" id="7968742">}</span><span class="op" id="7968743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7968746">{</span><span class="string" id="7968747">&#34;RSA&#34;</span><span class="op" id="7968752">,</span>&nbsp;<span class="ident" id="7968754">rsaCertPEM</span><span class="op" id="7968764">,</span>&nbsp;<span class="ident" id="7968766">rsaKeyPEM</span><span class="op" id="7968775">}</span><span class="op" id="7968776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7968779">{</span><span class="string" id="7968780">&#34;RSA-untyped&#34;</span><span class="op" id="7968793">,</span>&nbsp;<span class="ident" id="7968795">rsaCertPEM</span><span class="op" id="7968805">,</span>&nbsp;<span class="ident" id="7968807">keyPEM</span><span class="op" id="7968813">}</span><span class="op" id="7968814">,</span>&nbsp;<span class="comment" id="7968816">//&nbsp;golang.org/issue/4477</span><br>
<span class="lineno">90</span><span class="op" id="7968841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7968844">func</span>&nbsp;<span class="ident" id="7968849">TestX509KeyPair</span><span class="op" id="7968864">(</span><span class="ident" id="7968865">t</span>&nbsp;<span class="op" id="7968867">*</span><span class="ident" id="7968868">testing</span><span class="op" id="7968875">.</span><span class="ident" id="7968876">T</span><span class="op" id="7968877">)</span>&nbsp;<span class="op" id="7968879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7968882">var</span>&nbsp;<span class="ident" id="7968886">pem</span>&nbsp;<span class="op" id="7968890">[</span><span class="op" id="7968891">]</span><span class="builtintype" id="7968892">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7968898">for</span>&nbsp;<span class="ident" id="7968902">_</span><span class="op" id="7968903">,</span>&nbsp;<span class="ident" id="7968905">test</span>&nbsp;<span class="op" id="7968910">:=</span>&nbsp;<span class="keyword" id="7968913">range</span>&nbsp;<span class="ident" id="7968919">keyPairTests</span>&nbsp;<span class="op" id="7968932">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7968936">pem</span>&nbsp;<span class="op" id="7968940">=</span>&nbsp;<span class="op" id="7968942">[</span><span class="op" id="7968943">]</span><span class="builtintype" id="7968944">byte</span><span class="op" id="7968948">(</span><span class="ident" id="7968949">test</span><span class="op" id="7968953">.</span><span class="ident" id="7968954">cert</span>&nbsp;<span class="op" id="7968959">+</span>&nbsp;<span class="ident" id="7968961">test</span><span class="op" id="7968965">.</span><span class="ident" id="7968966">key</span><span class="op" id="7968969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7968973">if</span>&nbsp;<span class="ident" id="7968976">_</span><span class="op" id="7968977">,</span>&nbsp;<span class="ident" id="7968979">err</span>&nbsp;<span class="op" id="7968983">:=</span>&nbsp;<span class="ident" id="7968986">X509KeyPair</span><span class="op" id="7968997">(</span><span class="ident" id="7968998">pem</span><span class="op" id="7969001">,</span>&nbsp;<span class="ident" id="7969003">pem</span><span class="op" id="7969006">)</span><span class="op" id="7969007">;</span>&nbsp;<span class="ident" id="7969009">err</span>&nbsp;<span class="op" id="7969013">!=</span>&nbsp;<span class="ident" id="7969016">nil</span>&nbsp;<span class="op" id="7969020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969025">t</span><span class="op" id="7969026">.</span><span class="ident" id="7969027">Errorf</span><span class="op" id="7969033">(</span><span class="string" id="7969034">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;cert&nbsp;followed&nbsp;by&nbsp;%s&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="7969081">,</span>&nbsp;<span class="ident" id="7969083">test</span><span class="op" id="7969087">.</span><span class="ident" id="7969088">algo</span><span class="op" id="7969092">,</span>&nbsp;<span class="ident" id="7969094">test</span><span class="op" id="7969098">.</span><span class="ident" id="7969099">algo</span><span class="op" id="7969103">,</span>&nbsp;<span class="ident" id="7969105">err</span><span class="op" id="7969108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7969112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969116">pem</span>&nbsp;<span class="op" id="7969120">=</span>&nbsp;<span class="op" id="7969122">[</span><span class="op" id="7969123">]</span><span class="builtintype" id="7969124">byte</span><span class="op" id="7969128">(</span><span class="ident" id="7969129">test</span><span class="op" id="7969133">.</span><span class="ident" id="7969134">key</span>&nbsp;<span class="op" id="7969138">+</span>&nbsp;<span class="ident" id="7969140">test</span><span class="op" id="7969144">.</span><span class="ident" id="7969145">cert</span><span class="op" id="7969149">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7969153">if</span>&nbsp;<span class="ident" id="7969156">_</span><span class="op" id="7969157">,</span>&nbsp;<span class="ident" id="7969159">err</span>&nbsp;<span class="op" id="7969163">:=</span>&nbsp;<span class="ident" id="7969166">X509KeyPair</span><span class="op" id="7969177">(</span><span class="ident" id="7969178">pem</span><span class="op" id="7969181">,</span>&nbsp;<span class="ident" id="7969183">pem</span><span class="op" id="7969186">)</span><span class="op" id="7969187">;</span>&nbsp;<span class="ident" id="7969189">err</span>&nbsp;<span class="op" id="7969193">!=</span>&nbsp;<span class="ident" id="7969196">nil</span>&nbsp;<span class="op" id="7969200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969205">t</span><span class="op" id="7969206">.</span><span class="ident" id="7969207">Errorf</span><span class="op" id="7969213">(</span><span class="string" id="7969214">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;key&nbsp;followed&nbsp;by&nbsp;%s&nbsp;cert:&nbsp;%s&#34;</span><span class="op" id="7969261">,</span>&nbsp;<span class="ident" id="7969263">test</span><span class="op" id="7969267">.</span><span class="ident" id="7969268">algo</span><span class="op" id="7969272">,</span>&nbsp;<span class="ident" id="7969274">test</span><span class="op" id="7969278">.</span><span class="ident" id="7969279">algo</span><span class="op" id="7969283">,</span>&nbsp;<span class="ident" id="7969285">err</span><span class="op" id="7969288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7969292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7969295">}</span><br>
<span class="lineno"></span><span class="op" id="7969297">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7969300">func</span>&nbsp;<span class="ident" id="7969305">TestX509MixedKeyPair</span><span class="op" id="7969325">(</span><span class="ident" id="7969326">t</span>&nbsp;<span class="op" id="7969328">*</span><span class="ident" id="7969329">testing</span><span class="op" id="7969336">.</span><span class="ident" id="7969337">T</span><span class="op" id="7969338">)</span>&nbsp;<span class="op" id="7969340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7969343">if</span>&nbsp;<span class="ident" id="7969346">_</span><span class="op" id="7969347">,</span>&nbsp;<span class="ident" id="7969349">err</span>&nbsp;<span class="op" id="7969353">:=</span>&nbsp;<span class="ident" id="7969356">X509KeyPair</span><span class="op" id="7969367">(</span><span class="op" id="7969368">[</span><span class="op" id="7969369">]</span><span class="builtintype" id="7969370">byte</span><span class="op" id="7969374">(</span><span class="ident" id="7969375">rsaCertPEM</span><span class="op" id="7969385">)</span><span class="op" id="7969386">,</span>&nbsp;<span class="op" id="7969388">[</span><span class="op" id="7969389">]</span><span class="builtintype" id="7969390">byte</span><span class="op" id="7969394">(</span><span class="ident" id="7969395">ecdsaKeyPEM</span><span class="op" id="7969406">)</span><span class="op" id="7969407">)</span><span class="op" id="7969408">;</span>&nbsp;<span class="ident" id="7969410">err</span>&nbsp;<span class="op" id="7969414">==</span>&nbsp;<span class="ident" id="7969417">nil</span>&nbsp;<span class="op" id="7969421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969425">t</span><span class="op" id="7969426">.</span><span class="ident" id="7969427">Error</span><span class="op" id="7969432">(</span><span class="string" id="7969433">&#34;Load&nbsp;of&nbsp;RSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;ECDSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="7969491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7969494">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7969497">if</span>&nbsp;<span class="ident" id="7969500">_</span><span class="op" id="7969501">,</span>&nbsp;<span class="ident" id="7969503">err</span>&nbsp;<span class="op" id="7969507">:=</span>&nbsp;<span class="ident" id="7969510">X509KeyPair</span><span class="op" id="7969521">(</span><span class="op" id="7969522">[</span><span class="op" id="7969523">]</span><span class="builtintype" id="7969524">byte</span><span class="op" id="7969528">(</span><span class="ident" id="7969529">ecdsaCertPEM</span><span class="op" id="7969541">)</span><span class="op" id="7969542">,</span>&nbsp;<span class="op" id="7969544">[</span><span class="op" id="7969545">]</span><span class="builtintype" id="7969546">byte</span><span class="op" id="7969550">(</span><span class="ident" id="7969551">rsaKeyPEM</span><span class="op" id="7969560">)</span><span class="op" id="7969561">)</span><span class="op" id="7969562">;</span>&nbsp;<span class="ident" id="7969564">err</span>&nbsp;<span class="op" id="7969568">==</span>&nbsp;<span class="ident" id="7969571">nil</span>&nbsp;<span class="op" id="7969575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969579">t</span><span class="op" id="7969580">.</span><span class="ident" id="7969581">Error</span><span class="op" id="7969586">(</span><span class="string" id="7969587">&#34;Load&nbsp;of&nbsp;ECDSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;RSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="7969645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7969648">}</span><br>
<span class="lineno"></span><span class="op" id="7969650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="7969653">func</span>&nbsp;<span class="ident" id="7969658">newLocalListener</span><span class="op" id="7969674">(</span><span class="ident" id="7969675">t</span>&nbsp;<span class="op" id="7969677">*</span><span class="ident" id="7969678">testing</span><span class="op" id="7969685">.</span><span class="ident" id="7969686">T</span><span class="op" id="7969687">)</span>&nbsp;<span class="ident" id="7969689">net</span><span class="op" id="7969692">.</span><span class="ident" id="7969693">Listener</span>&nbsp;<span class="op" id="7969702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969705">ln</span><span class="op" id="7969707">,</span>&nbsp;<span class="ident" id="7969709">err</span>&nbsp;<span class="op" id="7969713">:=</span>&nbsp;<span class="ident" id="7969716">net</span><span class="op" id="7969719">.</span><span class="ident" id="7969720">Listen</span><span class="op" id="7969726">(</span><span class="string" id="7969727">&#34;tcp&#34;</span><span class="op" id="7969732">,</span>&nbsp;<span class="string" id="7969734">&#34;127.0.0.1:0&#34;</span><span class="op" id="7969747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7969750">if</span>&nbsp;<span class="ident" id="7969753">err</span>&nbsp;<span class="op" id="7969757">!=</span>&nbsp;<span class="ident" id="7969760">nil</span>&nbsp;<span class="op" id="7969764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969768">ln</span><span class="op" id="7969770">,</span>&nbsp;<span class="ident" id="7969772">err</span>&nbsp;<span class="op" id="7969776">=</span>&nbsp;<span class="ident" id="7969778">net</span><span class="op" id="7969781">.</span><span class="ident" id="7969782">Listen</span><span class="op" id="7969788">(</span><span class="string" id="7969789">&#34;tcp6&#34;</span><span class="op" id="7969795">,</span>&nbsp;<span class="string" id="7969797">&#34;[::1]:0&#34;</span><span class="op" id="7969806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7969809">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7969812">if</span>&nbsp;<span class="ident" id="7969815">err</span>&nbsp;<span class="op" id="7969819">!=</span>&nbsp;<span class="ident" id="7969822">nil</span>&nbsp;<span class="op" id="7969826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969830">t</span><span class="op" id="7969831">.</span><span class="ident" id="7969832">Fatal</span><span class="op" id="7969837">(</span><span class="ident" id="7969838">err</span><span class="op" id="7969841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7969844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7969847">return</span>&nbsp;<span class="ident" id="7969854">ln</span><br>
<span class="lineno"></span><span class="op" id="7969857">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7969860">func</span>&nbsp;<span class="ident" id="7969865">TestDialTimeout</span><span class="op" id="7969880">(</span><span class="ident" id="7969881">t</span>&nbsp;<span class="op" id="7969883">*</span><span class="ident" id="7969884">testing</span><span class="op" id="7969891">.</span><span class="ident" id="7969892">T</span><span class="op" id="7969893">)</span>&nbsp;<span class="op" id="7969895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7969898">if</span>&nbsp;<span class="ident" id="7969901">testing</span><span class="op" id="7969908">.</span><span class="ident" id="7969909">Short</span><span class="op" id="7969914">(</span><span class="op" id="7969915">)</span>&nbsp;<span class="op" id="7969917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969921">t</span><span class="op" id="7969922">.</span><span class="ident" id="7969923">Skip</span><span class="op" id="7969927">(</span><span class="string" id="7969928">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7969952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7969955">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969958">listener</span>&nbsp;<span class="op" id="7969967">:=</span>&nbsp;<span class="ident" id="7969970">newLocalListener</span><span class="op" id="7969986">(</span><span class="ident" id="7969987">t</span><span class="op" id="7969988">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969992">addr</span>&nbsp;<span class="op" id="7969997">:=</span>&nbsp;<span class="ident" id="7970000">listener</span><span class="op" id="7970008">.</span><span class="ident" id="7970009">Addr</span><span class="op" id="7970013">(</span><span class="op" id="7970014">)</span><span class="op" id="7970015">.</span><span class="ident" id="7970016">String</span><span class="op" id="7970022">(</span><span class="op" id="7970023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970026">defer</span>&nbsp;<span class="ident" id="7970032">listener</span><span class="op" id="7970040">.</span><span class="ident" id="7970041">Close</span><span class="op" id="7970046">(</span><span class="op" id="7970047">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970051">complete</span>&nbsp;<span class="op" id="7970060">:=</span>&nbsp;<span class="builtinfunc" id="7970063">make</span><span class="op" id="7970067">(</span><span class="keyword" id="7970068">chan</span>&nbsp;<span class="builtintype" id="7970073">bool</span><span class="op" id="7970077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970080">defer</span>&nbsp;<span class="builtinfunc" id="7970086">close</span><span class="op" id="7970091">(</span><span class="ident" id="7970092">complete</span><span class="op" id="7970100">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970104">go</span>&nbsp;<span class="keyword" id="7970107">func</span><span class="op" id="7970111">(</span><span class="op" id="7970112">)</span>&nbsp;<span class="op" id="7970114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970118">conn</span><span class="op" id="7970122">,</span>&nbsp;<span class="ident" id="7970124">err</span>&nbsp;<span class="op" id="7970128">:=</span>&nbsp;<span class="ident" id="7970131">listener</span><span class="op" id="7970139">.</span><span class="ident" id="7970140">Accept</span><span class="op" id="7970146">(</span><span class="op" id="7970147">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970151">if</span>&nbsp;<span class="ident" id="7970154">err</span>&nbsp;<span class="op" id="7970158">!=</span>&nbsp;<span class="ident" id="7970161">nil</span>&nbsp;<span class="op" id="7970165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970170">t</span><span class="op" id="7970171">.</span><span class="ident" id="7970172">Error</span><span class="op" id="7970177">(</span><span class="ident" id="7970178">err</span><span class="op" id="7970181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970186">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970199">&lt;-</span><span class="ident" id="7970201">complete</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970212">conn</span><span class="op" id="7970216">.</span><span class="ident" id="7970217">Close</span><span class="op" id="7970222">(</span><span class="op" id="7970223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970226">}</span><span class="op" id="7970227">(</span><span class="op" id="7970228">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970232">dialer</span>&nbsp;<span class="op" id="7970239">:=</span>&nbsp;<span class="op" id="7970242">&amp;</span><span class="ident" id="7970243">net</span><span class="op" id="7970246">.</span><span class="ident" id="7970247">Dialer</span><span class="op" id="7970253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970257">Timeout</span><span class="op" id="7970264">:</span>&nbsp;<span class="num" id="7970266">10</span>&nbsp;<span class="op" id="7970269">*</span>&nbsp;<span class="ident" id="7970271">time</span><span class="op" id="7970275">.</span><span class="ident" id="7970276">Millisecond</span><span class="op" id="7970287">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970294">var</span>&nbsp;<span class="ident" id="7970298">err</span>&nbsp;<span class="builtintype" id="7970302">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970309">if</span>&nbsp;<span class="ident" id="7970312">_</span><span class="op" id="7970313">,</span>&nbsp;<span class="ident" id="7970315">err</span>&nbsp;<span class="op" id="7970319">=</span>&nbsp;<span class="ident" id="7970321">DialWithDialer</span><span class="op" id="7970335">(</span><span class="ident" id="7970336">dialer</span><span class="op" id="7970342">,</span>&nbsp;<span class="string" id="7970344">&#34;tcp&#34;</span><span class="op" id="7970349">,</span>&nbsp;<span class="ident" id="7970351">addr</span><span class="op" id="7970355">,</span>&nbsp;<span class="ident" id="7970357">nil</span><span class="op" id="7970360">)</span><span class="op" id="7970361">;</span>&nbsp;<span class="ident" id="7970363">err</span>&nbsp;<span class="op" id="7970367">==</span>&nbsp;<span class="ident" id="7970370">nil</span>&nbsp;<span class="op" id="7970374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970378">t</span><span class="op" id="7970379">.</span><span class="ident" id="7970380">Fatal</span><span class="op" id="7970385">(</span><span class="string" id="7970386">&#34;DialWithTimeout&nbsp;completed&nbsp;successfully&#34;</span><span class="op" id="7970426">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970433">if</span>&nbsp;<span class="op" id="7970436">!</span><span class="ident" id="7970437">strings</span><span class="op" id="7970444">.</span><span class="ident" id="7970445">Contains</span><span class="op" id="7970453">(</span><span class="ident" id="7970454">err</span><span class="op" id="7970457">.</span><span class="ident" id="7970458">Error</span><span class="op" id="7970463">(</span><span class="op" id="7970464">)</span><span class="op" id="7970465">,</span>&nbsp;<span class="string" id="7970467">&#34;timed&nbsp;out&#34;</span><span class="op" id="7970478">)</span>&nbsp;<span class="op" id="7970480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970484">t</span><span class="op" id="7970485">.</span><span class="ident" id="7970486">Errorf</span><span class="op" id="7970492">(</span><span class="string" id="7970493">&#34;resulting&nbsp;error&nbsp;not&nbsp;a&nbsp;timeout:&nbsp;%s&#34;</span><span class="op" id="7970528">,</span>&nbsp;<span class="ident" id="7970530">err</span><span class="op" id="7970533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970536">}</span><br>
<span class="lineno">160</span><span class="op" id="7970538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7970541">//&nbsp;tests&nbsp;that&nbsp;Conn.Read&nbsp;returns&nbsp;(non-zero,&nbsp;io.EOF)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="7970603">//&nbsp;(non-zero,&nbsp;nil)&nbsp;when&nbsp;a&nbsp;Close&nbsp;(alertCloseNotify)&nbsp;is&nbsp;sitting&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="7970671">//&nbsp;behind&nbsp;the&nbsp;application&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">165</span><span class="keyword" id="7970717">func</span>&nbsp;<span class="ident" id="7970722">TestConnReadNonzeroAndEOF</span><span class="op" id="7970747">(</span><span class="ident" id="7970748">t</span>&nbsp;<span class="op" id="7970750">*</span><span class="ident" id="7970751">testing</span><span class="op" id="7970758">.</span><span class="ident" id="7970759">T</span><span class="op" id="7970760">)</span>&nbsp;<span class="op" id="7970762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7970765">//&nbsp;This&nbsp;test&nbsp;is&nbsp;racy:&nbsp;it&nbsp;assumes&nbsp;that&nbsp;after&nbsp;a&nbsp;write&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7970823">//&nbsp;localhost&nbsp;TCP&nbsp;connection,&nbsp;the&nbsp;peer&nbsp;TCP&nbsp;connection&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7970881">//&nbsp;immediately&nbsp;read&nbsp;it.&nbsp;&nbsp;Because&nbsp;it&#39;s&nbsp;racy,&nbsp;we&nbsp;skip&nbsp;this&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7970944">//&nbsp;in&nbsp;short&nbsp;mode,&nbsp;and&nbsp;then&nbsp;retry&nbsp;it&nbsp;several&nbsp;times&nbsp;with&nbsp;an</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7971003">//&nbsp;increasing&nbsp;sleep&nbsp;in&nbsp;between&nbsp;our&nbsp;final&nbsp;write&nbsp;(via&nbsp;srv.Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7971066">//&nbsp;below)&nbsp;and&nbsp;the&nbsp;following&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971101">if</span>&nbsp;<span class="ident" id="7971104">testing</span><span class="op" id="7971111">.</span><span class="ident" id="7971112">Short</span><span class="op" id="7971117">(</span><span class="op" id="7971118">)</span>&nbsp;<span class="op" id="7971120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971124">t</span><span class="op" id="7971125">.</span><span class="ident" id="7971126">Skip</span><span class="op" id="7971130">(</span><span class="string" id="7971131">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7971155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971158">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971161">var</span>&nbsp;<span class="ident" id="7971165">err</span>&nbsp;<span class="builtintype" id="7971169">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971176">for</span>&nbsp;<span class="ident" id="7971180">delay</span>&nbsp;<span class="op" id="7971186">:=</span>&nbsp;<span class="ident" id="7971189">time</span><span class="op" id="7971193">.</span><span class="ident" id="7971194">Millisecond</span><span class="op" id="7971205">;</span>&nbsp;<span class="ident" id="7971207">delay</span>&nbsp;<span class="op" id="7971213">&lt;=</span>&nbsp;<span class="num" id="7971216">64</span><span class="op" id="7971218">*</span><span class="ident" id="7971219">time</span><span class="op" id="7971223">.</span><span class="ident" id="7971224">Millisecond</span><span class="op" id="7971235">;</span>&nbsp;<span class="ident" id="7971237">delay</span>&nbsp;<span class="op" id="7971243">*=</span>&nbsp;<span class="num" id="7971246">2</span>&nbsp;<span class="op" id="7971248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971252">if</span>&nbsp;<span class="ident" id="7971255">err</span>&nbsp;<span class="op" id="7971259">=</span>&nbsp;<span class="ident" id="7971261">testConnReadNonzeroAndEOF</span><span class="op" id="7971286">(</span><span class="ident" id="7971287">t</span><span class="op" id="7971288">,</span>&nbsp;<span class="ident" id="7971290">delay</span><span class="op" id="7971295">)</span><span class="op" id="7971296">;</span>&nbsp;<span class="ident" id="7971298">err</span>&nbsp;<span class="op" id="7971302">==</span>&nbsp;<span class="ident" id="7971305">nil</span>&nbsp;<span class="op" id="7971309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971314">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971323">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971329">t</span><span class="op" id="7971330">.</span><span class="ident" id="7971331">Error</span><span class="op" id="7971336">(</span><span class="ident" id="7971337">err</span><span class="op" id="7971340">)</span><br>
<span class="lineno"></span><span class="op" id="7971342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7971345">func</span>&nbsp;<span class="ident" id="7971350">testConnReadNonzeroAndEOF</span><span class="op" id="7971375">(</span><span class="ident" id="7971376">t</span>&nbsp;<span class="op" id="7971378">*</span><span class="ident" id="7971379">testing</span><span class="op" id="7971386">.</span><span class="ident" id="7971387">T</span><span class="op" id="7971388">,</span>&nbsp;<span class="ident" id="7971390">delay</span>&nbsp;<span class="ident" id="7971396">time</span><span class="op" id="7971400">.</span><span class="ident" id="7971401">Duration</span><span class="op" id="7971409">)</span>&nbsp;<span class="builtintype" id="7971411">error</span>&nbsp;<span class="op" id="7971417">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971420">ln</span>&nbsp;<span class="op" id="7971423">:=</span>&nbsp;<span class="ident" id="7971426">newLocalListener</span><span class="op" id="7971442">(</span><span class="ident" id="7971443">t</span><span class="op" id="7971444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971447">defer</span>&nbsp;<span class="ident" id="7971453">ln</span><span class="op" id="7971455">.</span><span class="ident" id="7971456">Close</span><span class="op" id="7971461">(</span><span class="op" id="7971462">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971466">srvCh</span>&nbsp;<span class="op" id="7971472">:=</span>&nbsp;<span class="builtinfunc" id="7971475">make</span><span class="op" id="7971479">(</span><span class="keyword" id="7971480">chan</span>&nbsp;<span class="op" id="7971485">*</span><span class="ident" id="7971486">Conn</span><span class="op" id="7971490">,</span>&nbsp;<span class="num" id="7971492">1</span><span class="op" id="7971493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971496">var</span>&nbsp;<span class="ident" id="7971500">serr</span>&nbsp;<span class="builtintype" id="7971505">error</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971512">go</span>&nbsp;<span class="keyword" id="7971515">func</span><span class="op" id="7971519">(</span><span class="op" id="7971520">)</span>&nbsp;<span class="op" id="7971522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971526">sconn</span><span class="op" id="7971531">,</span>&nbsp;<span class="ident" id="7971533">err</span>&nbsp;<span class="op" id="7971537">:=</span>&nbsp;<span class="ident" id="7971540">ln</span><span class="op" id="7971542">.</span><span class="ident" id="7971543">Accept</span><span class="op" id="7971549">(</span><span class="op" id="7971550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971554">if</span>&nbsp;<span class="ident" id="7971557">err</span>&nbsp;<span class="op" id="7971561">!=</span>&nbsp;<span class="ident" id="7971564">nil</span>&nbsp;<span class="op" id="7971568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971573">serr</span>&nbsp;<span class="op" id="7971578">=</span>&nbsp;<span class="ident" id="7971580">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971587">srvCh</span>&nbsp;<span class="op" id="7971593">&lt;-</span>&nbsp;<span class="ident" id="7971596">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971603">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971616">serverConfig</span>&nbsp;<span class="op" id="7971629">:=</span>&nbsp;<span class="op" id="7971632">*</span><span class="ident" id="7971633">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971646">srv</span>&nbsp;<span class="op" id="7971650">:=</span>&nbsp;<span class="ident" id="7971653">Server</span><span class="op" id="7971659">(</span><span class="ident" id="7971660">sconn</span><span class="op" id="7971665">,</span>&nbsp;<span class="op" id="7971667">&amp;</span><span class="ident" id="7971668">serverConfig</span><span class="op" id="7971680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971684">if</span>&nbsp;<span class="ident" id="7971687">err</span>&nbsp;<span class="op" id="7971691">:=</span>&nbsp;<span class="ident" id="7971694">srv</span><span class="op" id="7971697">.</span><span class="ident" id="7971698">Handshake</span><span class="op" id="7971707">(</span><span class="op" id="7971708">)</span><span class="op" id="7971709">;</span>&nbsp;<span class="ident" id="7971711">err</span>&nbsp;<span class="op" id="7971715">!=</span>&nbsp;<span class="ident" id="7971718">nil</span>&nbsp;<span class="op" id="7971722">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971727">serr</span>&nbsp;<span class="op" id="7971732">=</span>&nbsp;<span class="ident" id="7971734">fmt</span><span class="op" id="7971737">.</span><span class="ident" id="7971738">Errorf</span><span class="op" id="7971744">(</span><span class="string" id="7971745">&#34;handshake:&nbsp;%v&#34;</span><span class="op" id="7971760">,</span>&nbsp;<span class="ident" id="7971762">err</span><span class="op" id="7971765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971770">srvCh</span>&nbsp;<span class="op" id="7971776">&lt;-</span>&nbsp;<span class="ident" id="7971779">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971786">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971799">srvCh</span>&nbsp;<span class="op" id="7971805">&lt;-</span>&nbsp;<span class="ident" id="7971808">srv</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971813">}</span><span class="op" id="7971814">(</span><span class="op" id="7971815">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971819">clientConfig</span>&nbsp;<span class="op" id="7971832">:=</span>&nbsp;<span class="op" id="7971835">*</span><span class="ident" id="7971836">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971848">conn</span><span class="op" id="7971852">,</span>&nbsp;<span class="ident" id="7971854">err</span>&nbsp;<span class="op" id="7971858">:=</span>&nbsp;<span class="ident" id="7971861">Dial</span><span class="op" id="7971865">(</span><span class="string" id="7971866">&#34;tcp&#34;</span><span class="op" id="7971871">,</span>&nbsp;<span class="ident" id="7971873">ln</span><span class="op" id="7971875">.</span><span class="ident" id="7971876">Addr</span><span class="op" id="7971880">(</span><span class="op" id="7971881">)</span><span class="op" id="7971882">.</span><span class="ident" id="7971883">String</span><span class="op" id="7971889">(</span><span class="op" id="7971890">)</span><span class="op" id="7971891">,</span>&nbsp;<span class="op" id="7971893">&amp;</span><span class="ident" id="7971894">clientConfig</span><span class="op" id="7971906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971909">if</span>&nbsp;<span class="ident" id="7971912">err</span>&nbsp;<span class="op" id="7971916">!=</span>&nbsp;<span class="ident" id="7971919">nil</span>&nbsp;<span class="op" id="7971923">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971927">t</span><span class="op" id="7971928">.</span><span class="ident" id="7971929">Fatal</span><span class="op" id="7971934">(</span><span class="ident" id="7971935">err</span><span class="op" id="7971938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971944">defer</span>&nbsp;<span class="ident" id="7971950">conn</span><span class="op" id="7971954">.</span><span class="ident" id="7971955">Close</span><span class="op" id="7971960">(</span><span class="op" id="7971961">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971965">srv</span>&nbsp;<span class="op" id="7971969">:=</span>&nbsp;<span class="op" id="7971972">&lt;-</span><span class="ident" id="7971974">srvCh</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971981">if</span>&nbsp;<span class="ident" id="7971984">srv</span>&nbsp;<span class="op" id="7971988">==</span>&nbsp;<span class="ident" id="7971991">nil</span>&nbsp;<span class="op" id="7971995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971999">return</span>&nbsp;<span class="ident" id="7972006">serr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972016">buf</span>&nbsp;<span class="op" id="7972020">:=</span>&nbsp;<span class="builtinfunc" id="7972023">make</span><span class="op" id="7972027">(</span><span class="op" id="7972028">[</span><span class="op" id="7972029">]</span><span class="builtintype" id="7972030">byte</span><span class="op" id="7972034">,</span>&nbsp;<span class="num" id="7972036">6</span><span class="op" id="7972037">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972041">srv</span><span class="op" id="7972044">.</span><span class="ident" id="7972045">Write</span><span class="op" id="7972050">(</span><span class="op" id="7972051">[</span><span class="op" id="7972052">]</span><span class="builtintype" id="7972053">byte</span><span class="op" id="7972057">(</span><span class="string" id="7972058">&#34;foobar&#34;</span><span class="op" id="7972066">)</span><span class="op" id="7972067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972070">n</span><span class="op" id="7972071">,</span>&nbsp;<span class="ident" id="7972073">err</span>&nbsp;<span class="op" id="7972077">:=</span>&nbsp;<span class="ident" id="7972080">conn</span><span class="op" id="7972084">.</span><span class="ident" id="7972085">Read</span><span class="op" id="7972089">(</span><span class="ident" id="7972090">buf</span><span class="op" id="7972093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972096">if</span>&nbsp;<span class="ident" id="7972099">n</span>&nbsp;<span class="op" id="7972101">!=</span>&nbsp;<span class="num" id="7972104">6</span>&nbsp;<span class="op" id="7972106">||</span>&nbsp;<span class="ident" id="7972109">err</span>&nbsp;<span class="op" id="7972113">!=</span>&nbsp;<span class="ident" id="7972116">nil</span>&nbsp;<span class="op" id="7972120">||</span>&nbsp;<span class="builtintype" id="7972123">string</span><span class="op" id="7972129">(</span><span class="ident" id="7972130">buf</span><span class="op" id="7972133">)</span>&nbsp;<span class="op" id="7972135">!=</span>&nbsp;<span class="string" id="7972138">&#34;foobar&#34;</span>&nbsp;<span class="op" id="7972147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972151">return</span>&nbsp;<span class="ident" id="7972158">fmt</span><span class="op" id="7972161">.</span><span class="ident" id="7972162">Errorf</span><span class="op" id="7972168">(</span><span class="string" id="7972169">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;data&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;nil,&nbsp;foobar&#34;</span><span class="op" id="7972214">,</span>&nbsp;<span class="ident" id="7972216">n</span><span class="op" id="7972217">,</span>&nbsp;<span class="ident" id="7972219">err</span><span class="op" id="7972222">,</span>&nbsp;<span class="ident" id="7972224">buf</span><span class="op" id="7972227">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972234">srv</span><span class="op" id="7972237">.</span><span class="ident" id="7972238">Write</span><span class="op" id="7972243">(</span><span class="op" id="7972244">[</span><span class="op" id="7972245">]</span><span class="builtintype" id="7972246">byte</span><span class="op" id="7972250">(</span><span class="string" id="7972251">&#34;abcdef&#34;</span><span class="op" id="7972259">)</span><span class="op" id="7972260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972263">srv</span><span class="op" id="7972266">.</span><span class="ident" id="7972267">Close</span><span class="op" id="7972272">(</span><span class="op" id="7972273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972276">time</span><span class="op" id="7972280">.</span><span class="ident" id="7972281">Sleep</span><span class="op" id="7972286">(</span><span class="ident" id="7972287">delay</span><span class="op" id="7972292">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972295">n</span><span class="op" id="7972296">,</span>&nbsp;<span class="ident" id="7972298">err</span>&nbsp;<span class="op" id="7972302">=</span>&nbsp;<span class="ident" id="7972304">conn</span><span class="op" id="7972308">.</span><span class="ident" id="7972309">Read</span><span class="op" id="7972313">(</span><span class="ident" id="7972314">buf</span><span class="op" id="7972317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972320">if</span>&nbsp;<span class="ident" id="7972323">n</span>&nbsp;<span class="op" id="7972325">!=</span>&nbsp;<span class="num" id="7972328">6</span>&nbsp;<span class="op" id="7972330">||</span>&nbsp;<span class="builtintype" id="7972333">string</span><span class="op" id="7972339">(</span><span class="ident" id="7972340">buf</span><span class="op" id="7972343">)</span>&nbsp;<span class="op" id="7972345">!=</span>&nbsp;<span class="string" id="7972348">&#34;abcdef&#34;</span>&nbsp;<span class="op" id="7972357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972361">return</span>&nbsp;<span class="ident" id="7972368">fmt</span><span class="op" id="7972371">.</span><span class="ident" id="7972372">Errorf</span><span class="op" id="7972378">(</span><span class="string" id="7972379">&#34;Read&nbsp;=&nbsp;%d,&nbsp;buf=&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;abcdef&#34;</span><span class="op" id="7972415">,</span>&nbsp;<span class="ident" id="7972417">n</span><span class="op" id="7972418">,</span>&nbsp;<span class="ident" id="7972420">buf</span><span class="op" id="7972423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972429">if</span>&nbsp;<span class="ident" id="7972432">err</span>&nbsp;<span class="op" id="7972436">!=</span>&nbsp;<span class="ident" id="7972439">io</span><span class="op" id="7972441">.</span><span class="ident" id="7972442">EOF</span>&nbsp;<span class="op" id="7972446">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972450">return</span>&nbsp;<span class="ident" id="7972457">fmt</span><span class="op" id="7972460">.</span><span class="ident" id="7972461">Errorf</span><span class="op" id="7972467">(</span><span class="string" id="7972468">&#34;Second&nbsp;Read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="7972505">,</span>&nbsp;<span class="ident" id="7972507">err</span><span class="op" id="7972510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972516">return</span>&nbsp;<span class="ident" id="7972523">nil</span><br>
<span class="lineno"></span><span class="op" id="7972527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7972530">func</span>&nbsp;<span class="ident" id="7972535">TestTLSUniqueMatches</span><span class="op" id="7972555">(</span><span class="ident" id="7972556">t</span>&nbsp;<span class="op" id="7972558">*</span><span class="ident" id="7972559">testing</span><span class="op" id="7972566">.</span><span class="ident" id="7972567">T</span><span class="op" id="7972568">)</span>&nbsp;<span class="op" id="7972570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972573">ln</span>&nbsp;<span class="op" id="7972576">:=</span>&nbsp;<span class="ident" id="7972579">newLocalListener</span><span class="op" id="7972595">(</span><span class="ident" id="7972596">t</span><span class="op" id="7972597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972600">defer</span>&nbsp;<span class="ident" id="7972606">ln</span><span class="op" id="7972608">.</span><span class="ident" id="7972609">Close</span><span class="op" id="7972614">(</span><span class="op" id="7972615">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972619">serverTLSUniques</span>&nbsp;<span class="op" id="7972636">:=</span>&nbsp;<span class="builtinfunc" id="7972639">make</span><span class="op" id="7972643">(</span><span class="keyword" id="7972644">chan</span>&nbsp;<span class="op" id="7972649">[</span><span class="op" id="7972650">]</span><span class="builtintype" id="7972651">byte</span><span class="op" id="7972655">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972658">go</span>&nbsp;<span class="keyword" id="7972661">func</span><span class="op" id="7972665">(</span><span class="op" id="7972666">)</span>&nbsp;<span class="op" id="7972668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972672">for</span>&nbsp;<span class="ident" id="7972676">i</span>&nbsp;<span class="op" id="7972678">:=</span>&nbsp;<span class="num" id="7972681">0</span><span class="op" id="7972682">;</span>&nbsp;<span class="ident" id="7972684">i</span>&nbsp;<span class="op" id="7972686">&lt;</span>&nbsp;<span class="num" id="7972688">2</span><span class="op" id="7972689">;</span>&nbsp;<span class="ident" id="7972691">i</span><span class="op" id="7972692">++</span>&nbsp;<span class="op" id="7972695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972700">sconn</span><span class="op" id="7972705">,</span>&nbsp;<span class="ident" id="7972707">err</span>&nbsp;<span class="op" id="7972711">:=</span>&nbsp;<span class="ident" id="7972714">ln</span><span class="op" id="7972716">.</span><span class="ident" id="7972717">Accept</span><span class="op" id="7972723">(</span><span class="op" id="7972724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972729">if</span>&nbsp;<span class="ident" id="7972732">err</span>&nbsp;<span class="op" id="7972736">!=</span>&nbsp;<span class="ident" id="7972739">nil</span>&nbsp;<span class="op" id="7972743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972749">t</span><span class="op" id="7972750">.</span><span class="ident" id="7972751">Fatal</span><span class="op" id="7972756">(</span><span class="ident" id="7972757">err</span><span class="op" id="7972760">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972770">serverConfig</span>&nbsp;<span class="op" id="7972783">:=</span>&nbsp;<span class="op" id="7972786">*</span><span class="ident" id="7972787">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972801">srv</span>&nbsp;<span class="op" id="7972805">:=</span>&nbsp;<span class="ident" id="7972808">Server</span><span class="op" id="7972814">(</span><span class="ident" id="7972815">sconn</span><span class="op" id="7972820">,</span>&nbsp;<span class="op" id="7972822">&amp;</span><span class="ident" id="7972823">serverConfig</span><span class="op" id="7972835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972840">if</span>&nbsp;<span class="ident" id="7972843">err</span>&nbsp;<span class="op" id="7972847">:=</span>&nbsp;<span class="ident" id="7972850">srv</span><span class="op" id="7972853">.</span><span class="ident" id="7972854">Handshake</span><span class="op" id="7972863">(</span><span class="op" id="7972864">)</span><span class="op" id="7972865">;</span>&nbsp;<span class="ident" id="7972867">err</span>&nbsp;<span class="op" id="7972871">!=</span>&nbsp;<span class="ident" id="7972874">nil</span>&nbsp;<span class="op" id="7972878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972884">t</span><span class="op" id="7972885">.</span><span class="ident" id="7972886">Fatal</span><span class="op" id="7972891">(</span><span class="ident" id="7972892">err</span><span class="op" id="7972895">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972905">serverTLSUniques</span>&nbsp;<span class="op" id="7972922">&lt;-</span>&nbsp;<span class="ident" id="7972925">srv</span><span class="op" id="7972928">.</span><span class="ident" id="7972929">ConnectionState</span><span class="op" id="7972944">(</span><span class="op" id="7972945">)</span><span class="op" id="7972946">.</span><span class="ident" id="7972947">TLSUnique</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972962">}</span><span class="op" id="7972963">(</span><span class="op" id="7972964">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972968">clientConfig</span>&nbsp;<span class="op" id="7972981">:=</span>&nbsp;<span class="op" id="7972984">*</span><span class="ident" id="7972985">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972997">clientConfig</span><span class="op" id="7973009">.</span><span class="ident" id="7973010">ClientSessionCache</span>&nbsp;<span class="op" id="7973029">=</span>&nbsp;<span class="ident" id="7973031">NewLRUClientSessionCache</span><span class="op" id="7973055">(</span><span class="num" id="7973056">1</span><span class="op" id="7973057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973060">conn</span><span class="op" id="7973064">,</span>&nbsp;<span class="ident" id="7973066">err</span>&nbsp;<span class="op" id="7973070">:=</span>&nbsp;<span class="ident" id="7973073">Dial</span><span class="op" id="7973077">(</span><span class="string" id="7973078">&#34;tcp&#34;</span><span class="op" id="7973083">,</span>&nbsp;<span class="ident" id="7973085">ln</span><span class="op" id="7973087">.</span><span class="ident" id="7973088">Addr</span><span class="op" id="7973092">(</span><span class="op" id="7973093">)</span><span class="op" id="7973094">.</span><span class="ident" id="7973095">String</span><span class="op" id="7973101">(</span><span class="op" id="7973102">)</span><span class="op" id="7973103">,</span>&nbsp;<span class="op" id="7973105">&amp;</span><span class="ident" id="7973106">clientConfig</span><span class="op" id="7973118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973121">if</span>&nbsp;<span class="ident" id="7973124">err</span>&nbsp;<span class="op" id="7973128">!=</span>&nbsp;<span class="ident" id="7973131">nil</span>&nbsp;<span class="op" id="7973135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973139">t</span><span class="op" id="7973140">.</span><span class="ident" id="7973141">Fatal</span><span class="op" id="7973146">(</span><span class="ident" id="7973147">err</span><span class="op" id="7973150">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7973153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973156">if</span>&nbsp;<span class="op" id="7973159">!</span><span class="ident" id="7973160">bytes</span><span class="op" id="7973165">.</span><span class="ident" id="7973166">Equal</span><span class="op" id="7973171">(</span><span class="ident" id="7973172">conn</span><span class="op" id="7973176">.</span><span class="ident" id="7973177">ConnectionState</span><span class="op" id="7973192">(</span><span class="op" id="7973193">)</span><span class="op" id="7973194">.</span><span class="ident" id="7973195">TLSUnique</span><span class="op" id="7973204">,</span>&nbsp;<span class="op" id="7973206">&lt;-</span><span class="ident" id="7973208">serverTLSUniques</span><span class="op" id="7973224">)</span>&nbsp;<span class="op" id="7973226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973230">t</span><span class="op" id="7973231">.</span><span class="ident" id="7973232">Error</span><span class="op" id="7973237">(</span><span class="string" id="7973238">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&#34;</span><span class="op" id="7973281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7973284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973287">conn</span><span class="op" id="7973291">.</span><span class="ident" id="7973292">Close</span><span class="op" id="7973297">(</span><span class="op" id="7973298">)</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973302">conn</span><span class="op" id="7973306">,</span>&nbsp;<span class="ident" id="7973308">err</span>&nbsp;<span class="op" id="7973312">=</span>&nbsp;<span class="ident" id="7973314">Dial</span><span class="op" id="7973318">(</span><span class="string" id="7973319">&#34;tcp&#34;</span><span class="op" id="7973324">,</span>&nbsp;<span class="ident" id="7973326">ln</span><span class="op" id="7973328">.</span><span class="ident" id="7973329">Addr</span><span class="op" id="7973333">(</span><span class="op" id="7973334">)</span><span class="op" id="7973335">.</span><span class="ident" id="7973336">String</span><span class="op" id="7973342">(</span><span class="op" id="7973343">)</span><span class="op" id="7973344">,</span>&nbsp;<span class="op" id="7973346">&amp;</span><span class="ident" id="7973347">clientConfig</span><span class="op" id="7973359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973362">if</span>&nbsp;<span class="ident" id="7973365">err</span>&nbsp;<span class="op" id="7973369">!=</span>&nbsp;<span class="ident" id="7973372">nil</span>&nbsp;<span class="op" id="7973376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973380">t</span><span class="op" id="7973381">.</span><span class="ident" id="7973382">Fatal</span><span class="op" id="7973387">(</span><span class="ident" id="7973388">err</span><span class="op" id="7973391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7973394">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973397">defer</span>&nbsp;<span class="ident" id="7973403">conn</span><span class="op" id="7973407">.</span><span class="ident" id="7973408">Close</span><span class="op" id="7973413">(</span><span class="op" id="7973414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973417">if</span>&nbsp;<span class="op" id="7973420">!</span><span class="ident" id="7973421">conn</span><span class="op" id="7973425">.</span><span class="ident" id="7973426">ConnectionState</span><span class="op" id="7973441">(</span><span class="op" id="7973442">)</span><span class="op" id="7973443">.</span><span class="ident" id="7973444">DidResume</span>&nbsp;<span class="op" id="7973454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973458">t</span><span class="op" id="7973459">.</span><span class="ident" id="7973460">Error</span><span class="op" id="7973465">(</span><span class="string" id="7973466">&#34;second&nbsp;session&nbsp;did&nbsp;not&nbsp;use&nbsp;resumption&#34;</span><span class="op" id="7973505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7973508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973511">if</span>&nbsp;<span class="op" id="7973514">!</span><span class="ident" id="7973515">bytes</span><span class="op" id="7973520">.</span><span class="ident" id="7973521">Equal</span><span class="op" id="7973526">(</span><span class="ident" id="7973527">conn</span><span class="op" id="7973531">.</span><span class="ident" id="7973532">ConnectionState</span><span class="op" id="7973547">(</span><span class="op" id="7973548">)</span><span class="op" id="7973549">.</span><span class="ident" id="7973550">TLSUnique</span><span class="op" id="7973559">,</span>&nbsp;<span class="op" id="7973561">&lt;-</span><span class="ident" id="7973563">serverTLSUniques</span><span class="op" id="7973579">)</span>&nbsp;<span class="op" id="7973581">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973585">t</span><span class="op" id="7973586">.</span><span class="ident" id="7973587">Error</span><span class="op" id="7973592">(</span><span class="string" id="7973593">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&nbsp;when&nbsp;session&nbsp;resumption&nbsp;is&nbsp;used&#34;</span><span class="op" id="7973668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7973671">}</span><br>
<span class="lineno"></span><span class="op" id="7973673">}</span>
</div>
</body>
</html>
