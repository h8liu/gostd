<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2998287">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2998342">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2998396">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2998447">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;windows&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2998520">package</span>&nbsp;<span class="ident" id="2998528">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2998533">import</span>&nbsp;<span class="op" id="2998540">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2998543">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2998551">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2998562">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="2998569">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2998572">//&nbsp;runtimeNano&nbsp;returns&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;runtime&nbsp;clock&nbsp;in&nbsp;nanoseconds.</span><br>
<span class="lineno"></span><span class="keyword" id="2998650">func</span>&nbsp;<span class="ident" id="2998655">runtimeNano</span><span class="op" id="2998666">(</span><span class="op" id="2998667">)</span>&nbsp;<span class="ident" id="2998669">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2998676">func</span>&nbsp;<span class="ident" id="2998681">runtime_pollServerInit</span><span class="op" id="2998703">(</span><span class="op" id="2998704">)</span><br>
<span class="lineno"></span><span class="keyword" id="2998706">func</span>&nbsp;<span class="ident" id="2998711">runtime_pollOpen</span><span class="op" id="2998727">(</span><span class="ident" id="2998728">fd</span>&nbsp;<span class="builtintype" id="2998731">uintptr</span><span class="op" id="2998738">)</span>&nbsp;<span class="op" id="2998740">(</span><span class="builtintype" id="2998741">uintptr</span><span class="op" id="2998748">,</span>&nbsp;<span class="builtintype" id="2998750">int</span><span class="op" id="2998753">)</span><br>
<span class="lineno">20</span><span class="keyword" id="2998755">func</span>&nbsp;<span class="ident" id="2998760">runtime_pollClose</span><span class="op" id="2998777">(</span><span class="ident" id="2998778">ctx</span>&nbsp;<span class="builtintype" id="2998782">uintptr</span><span class="op" id="2998789">)</span><br>
<span class="lineno"></span><span class="keyword" id="2998791">func</span>&nbsp;<span class="ident" id="2998796">runtime_pollWait</span><span class="op" id="2998812">(</span><span class="ident" id="2998813">ctx</span>&nbsp;<span class="builtintype" id="2998817">uintptr</span><span class="op" id="2998824">,</span>&nbsp;<span class="ident" id="2998826">mode</span>&nbsp;<span class="builtintype" id="2998831">int</span><span class="op" id="2998834">)</span>&nbsp;<span class="builtintype" id="2998836">int</span><br>
<span class="lineno"></span><span class="keyword" id="2998840">func</span>&nbsp;<span class="ident" id="2998845">runtime_pollWaitCanceled</span><span class="op" id="2998869">(</span><span class="ident" id="2998870">ctx</span>&nbsp;<span class="builtintype" id="2998874">uintptr</span><span class="op" id="2998881">,</span>&nbsp;<span class="ident" id="2998883">mode</span>&nbsp;<span class="builtintype" id="2998888">int</span><span class="op" id="2998891">)</span>&nbsp;<span class="builtintype" id="2998893">int</span><br>
<span class="lineno"></span><span class="keyword" id="2998897">func</span>&nbsp;<span class="ident" id="2998902">runtime_pollReset</span><span class="op" id="2998919">(</span><span class="ident" id="2998920">ctx</span>&nbsp;<span class="builtintype" id="2998924">uintptr</span><span class="op" id="2998931">,</span>&nbsp;<span class="ident" id="2998933">mode</span>&nbsp;<span class="builtintype" id="2998938">int</span><span class="op" id="2998941">)</span>&nbsp;<span class="builtintype" id="2998943">int</span><br>
<span class="lineno"></span><span class="keyword" id="2998947">func</span>&nbsp;<span class="ident" id="2998952">runtime_pollSetDeadline</span><span class="op" id="2998975">(</span><span class="ident" id="2998976">ctx</span>&nbsp;<span class="builtintype" id="2998980">uintptr</span><span class="op" id="2998987">,</span>&nbsp;<span class="ident" id="2998989">d</span>&nbsp;<span class="ident" id="2998991">int64</span><span class="op" id="2998996">,</span>&nbsp;<span class="ident" id="2998998">mode</span>&nbsp;<span class="builtintype" id="2999003">int</span><span class="op" id="2999006">)</span><br>
<span class="lineno">25</span><span class="keyword" id="2999008">func</span>&nbsp;<span class="ident" id="2999013">runtime_pollUnblock</span><span class="op" id="2999032">(</span><span class="ident" id="2999033">ctx</span>&nbsp;<span class="builtintype" id="2999037">uintptr</span><span class="op" id="2999044">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2999047">type</span>&nbsp;<span class="ident" id="2999052">pollDesc</span>&nbsp;<span class="keyword" id="2999061">struct</span>&nbsp;<span class="op" id="2999068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999071">runtimeCtx</span>&nbsp;<span class="builtintype" id="2999082">uintptr</span><br>
<span class="lineno"></span><span class="op" id="2999090">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="2999093">var</span>&nbsp;<span class="ident" id="2999097">serverInit</span>&nbsp;<span class="ident" id="2999108">sync</span><span class="op" id="2999112">.</span><span class="ident" id="2999113">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2999119">func</span>&nbsp;<span class="op" id="2999124">(</span><span class="ident" id="2999125">pd</span>&nbsp;<span class="op" id="2999128">*</span><span class="ident" id="2999129">pollDesc</span><span class="op" id="2999137">)</span>&nbsp;<span class="ident" id="2999139">Init</span><span class="op" id="2999143">(</span><span class="ident" id="2999144">fd</span>&nbsp;<span class="op" id="2999147">*</span><span class="ident" id="2999148">netFD</span><span class="op" id="2999153">)</span>&nbsp;<span class="builtintype" id="2999155">error</span>&nbsp;<span class="op" id="2999161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999164">serverInit</span><span class="op" id="2999174">.</span><span class="ident" id="2999175">Do</span><span class="op" id="2999177">(</span><span class="ident" id="2999178">runtime_pollServerInit</span><span class="op" id="2999200">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999203">ctx</span><span class="op" id="2999206">,</span>&nbsp;<span class="ident" id="2999208">errno</span>&nbsp;<span class="op" id="2999214">:=</span>&nbsp;<span class="ident" id="2999217">runtime_pollOpen</span><span class="op" id="2999233">(</span><span class="builtintype" id="2999234">uintptr</span><span class="op" id="2999241">(</span><span class="ident" id="2999242">fd</span><span class="op" id="2999244">.</span><span class="ident" id="2999245">sysfd</span><span class="op" id="2999250">)</span><span class="op" id="2999251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999254">if</span>&nbsp;<span class="ident" id="2999257">errno</span>&nbsp;<span class="op" id="2999263">!=</span>&nbsp;<span class="num" id="2999266">0</span>&nbsp;<span class="op" id="2999268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999272">return</span>&nbsp;<span class="ident" id="2999279">syscall</span><span class="op" id="2999286">.</span><span class="ident" id="2999287">Errno</span><span class="op" id="2999292">(</span><span class="ident" id="2999293">errno</span><span class="op" id="2999298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2999301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999304">pd</span><span class="op" id="2999306">.</span><span class="ident" id="2999307">runtimeCtx</span>&nbsp;<span class="op" id="2999318">=</span>&nbsp;<span class="ident" id="2999320">ctx</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999325">return</span>&nbsp;<span class="ident" id="2999332">nil</span><br>
<span class="lineno"></span><span class="op" id="2999336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2999339">func</span>&nbsp;<span class="op" id="2999344">(</span><span class="ident" id="2999345">pd</span>&nbsp;<span class="op" id="2999348">*</span><span class="ident" id="2999349">pollDesc</span><span class="op" id="2999357">)</span>&nbsp;<span class="ident" id="2999359">Close</span><span class="op" id="2999364">(</span><span class="op" id="2999365">)</span>&nbsp;<span class="op" id="2999367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999370">if</span>&nbsp;<span class="ident" id="2999373">pd</span><span class="op" id="2999375">.</span><span class="ident" id="2999376">runtimeCtx</span>&nbsp;<span class="op" id="2999387">==</span>&nbsp;<span class="num" id="2999390">0</span>&nbsp;<span class="op" id="2999392">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999396">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2999404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999407">runtime_pollClose</span><span class="op" id="2999424">(</span><span class="ident" id="2999425">pd</span><span class="op" id="2999427">.</span><span class="ident" id="2999428">runtimeCtx</span><span class="op" id="2999438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999441">pd</span><span class="op" id="2999443">.</span><span class="ident" id="2999444">runtimeCtx</span>&nbsp;<span class="op" id="2999455">=</span>&nbsp;<span class="num" id="2999457">0</span><br>
<span class="lineno"></span><span class="op" id="2999459">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="2999462">func</span>&nbsp;<span class="op" id="2999467">(</span><span class="ident" id="2999468">pd</span>&nbsp;<span class="op" id="2999471">*</span><span class="ident" id="2999472">pollDesc</span><span class="op" id="2999480">)</span>&nbsp;<span class="ident" id="2999482">Lock</span><span class="op" id="2999486">(</span><span class="op" id="2999487">)</span>&nbsp;<span class="op" id="2999489">{</span><br>
<span class="lineno"></span><span class="op" id="2999491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2999494">func</span>&nbsp;<span class="op" id="2999499">(</span><span class="ident" id="2999500">pd</span>&nbsp;<span class="op" id="2999503">*</span><span class="ident" id="2999504">pollDesc</span><span class="op" id="2999512">)</span>&nbsp;<span class="ident" id="2999514">Unlock</span><span class="op" id="2999520">(</span><span class="op" id="2999521">)</span>&nbsp;<span class="op" id="2999523">{</span><br>
<span class="lineno">55</span><span class="op" id="2999525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2999528">func</span>&nbsp;<span class="op" id="2999533">(</span><span class="ident" id="2999534">pd</span>&nbsp;<span class="op" id="2999537">*</span><span class="ident" id="2999538">pollDesc</span><span class="op" id="2999546">)</span>&nbsp;<span class="ident" id="2999548">Wakeup</span><span class="op" id="2999554">(</span><span class="op" id="2999555">)</span>&nbsp;<span class="op" id="2999557">{</span><br>
<span class="lineno"></span><span class="op" id="2999559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="2999562">//&nbsp;Evict&nbsp;evicts&nbsp;fd&nbsp;from&nbsp;the&nbsp;pending&nbsp;list,&nbsp;unblocking&nbsp;any&nbsp;I/O&nbsp;running&nbsp;on&nbsp;fd.</span><br>
<span class="lineno"></span><span class="comment" id="2999638">//&nbsp;Return&nbsp;value&nbsp;is&nbsp;whether&nbsp;the&nbsp;pollServer&nbsp;should&nbsp;be&nbsp;woken&nbsp;up.</span><br>
<span class="lineno"></span><span class="keyword" id="2999700">func</span>&nbsp;<span class="op" id="2999705">(</span><span class="ident" id="2999706">pd</span>&nbsp;<span class="op" id="2999709">*</span><span class="ident" id="2999710">pollDesc</span><span class="op" id="2999718">)</span>&nbsp;<span class="ident" id="2999720">Evict</span><span class="op" id="2999725">(</span><span class="op" id="2999726">)</span>&nbsp;<span class="builtintype" id="2999728">bool</span>&nbsp;<span class="op" id="2999733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999736">if</span>&nbsp;<span class="ident" id="2999739">pd</span><span class="op" id="2999741">.</span><span class="ident" id="2999742">runtimeCtx</span>&nbsp;<span class="op" id="2999753">==</span>&nbsp;<span class="num" id="2999756">0</span>&nbsp;<span class="op" id="2999758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999762">return</span>&nbsp;<span class="builtintype" id="2999769">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2999776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999779">runtime_pollUnblock</span><span class="op" id="2999798">(</span><span class="ident" id="2999799">pd</span><span class="op" id="2999801">.</span><span class="ident" id="2999802">runtimeCtx</span><span class="op" id="2999812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999815">return</span>&nbsp;<span class="builtintype" id="2999822">false</span><br>
<span class="lineno"></span><span class="op" id="2999828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="2999831">func</span>&nbsp;<span class="op" id="2999836">(</span><span class="ident" id="2999837">pd</span>&nbsp;<span class="op" id="2999840">*</span><span class="ident" id="2999841">pollDesc</span><span class="op" id="2999849">)</span>&nbsp;<span class="ident" id="2999851">Prepare</span><span class="op" id="2999858">(</span><span class="ident" id="2999859">mode</span>&nbsp;<span class="builtintype" id="2999864">int</span><span class="op" id="2999867">)</span>&nbsp;<span class="builtintype" id="2999869">error</span>&nbsp;<span class="op" id="2999875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2999878">res</span>&nbsp;<span class="op" id="2999882">:=</span>&nbsp;<span class="ident" id="2999885">runtime_pollReset</span><span class="op" id="2999902">(</span><span class="ident" id="2999903">pd</span><span class="op" id="2999905">.</span><span class="ident" id="2999906">runtimeCtx</span><span class="op" id="2999916">,</span>&nbsp;<span class="ident" id="2999918">mode</span><span class="op" id="2999922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999925">return</span>&nbsp;<span class="ident" id="2999932">convertErr</span><span class="op" id="2999942">(</span><span class="ident" id="2999943">res</span><span class="op" id="2999946">)</span><br>
<span class="lineno"></span><span class="op" id="2999948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="2999951">func</span>&nbsp;<span class="op" id="2999956">(</span><span class="ident" id="2999957">pd</span>&nbsp;<span class="op" id="2999960">*</span><span class="ident" id="2999961">pollDesc</span><span class="op" id="2999969">)</span>&nbsp;<span class="ident" id="2999971">PrepareRead</span><span class="op" id="2999982">(</span><span class="op" id="2999983">)</span>&nbsp;<span class="builtintype" id="2999985">error</span>&nbsp;<span class="op" id="2999991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2999994">return</span>&nbsp;<span class="ident" id="3000001">pd</span><span class="op" id="3000003">.</span><span class="ident" id="3000004">Prepare</span><span class="op" id="3000011">(</span><span class="string" id="3000012">&#39;r&#39;</span><span class="op" id="3000015">)</span><br>
<span class="lineno"></span><span class="op" id="3000017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3000020">func</span>&nbsp;<span class="op" id="3000025">(</span><span class="ident" id="3000026">pd</span>&nbsp;<span class="op" id="3000029">*</span><span class="ident" id="3000030">pollDesc</span><span class="op" id="3000038">)</span>&nbsp;<span class="ident" id="3000040">PrepareWrite</span><span class="op" id="3000052">(</span><span class="op" id="3000053">)</span>&nbsp;<span class="builtintype" id="3000055">error</span>&nbsp;<span class="op" id="3000061">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000064">return</span>&nbsp;<span class="ident" id="3000071">pd</span><span class="op" id="3000073">.</span><span class="ident" id="3000074">Prepare</span><span class="op" id="3000081">(</span><span class="string" id="3000082">&#39;w&#39;</span><span class="op" id="3000085">)</span><br>
<span class="lineno"></span><span class="op" id="3000087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3000090">func</span>&nbsp;<span class="op" id="3000095">(</span><span class="ident" id="3000096">pd</span>&nbsp;<span class="op" id="3000099">*</span><span class="ident" id="3000100">pollDesc</span><span class="op" id="3000108">)</span>&nbsp;<span class="ident" id="3000110">Wait</span><span class="op" id="3000114">(</span><span class="ident" id="3000115">mode</span>&nbsp;<span class="builtintype" id="3000120">int</span><span class="op" id="3000123">)</span>&nbsp;<span class="builtintype" id="3000125">error</span>&nbsp;<span class="op" id="3000131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000134">res</span>&nbsp;<span class="op" id="3000138">:=</span>&nbsp;<span class="ident" id="3000141">runtime_pollWait</span><span class="op" id="3000157">(</span><span class="ident" id="3000158">pd</span><span class="op" id="3000160">.</span><span class="ident" id="3000161">runtimeCtx</span><span class="op" id="3000171">,</span>&nbsp;<span class="ident" id="3000173">mode</span><span class="op" id="3000177">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000180">return</span>&nbsp;<span class="ident" id="3000187">convertErr</span><span class="op" id="3000197">(</span><span class="ident" id="3000198">res</span><span class="op" id="3000201">)</span><br>
<span class="lineno"></span><span class="op" id="3000203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3000206">func</span>&nbsp;<span class="op" id="3000211">(</span><span class="ident" id="3000212">pd</span>&nbsp;<span class="op" id="3000215">*</span><span class="ident" id="3000216">pollDesc</span><span class="op" id="3000224">)</span>&nbsp;<span class="ident" id="3000226">WaitRead</span><span class="op" id="3000234">(</span><span class="op" id="3000235">)</span>&nbsp;<span class="builtintype" id="3000237">error</span>&nbsp;<span class="op" id="3000243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000246">return</span>&nbsp;<span class="ident" id="3000253">pd</span><span class="op" id="3000255">.</span><span class="ident" id="3000256">Wait</span><span class="op" id="3000260">(</span><span class="string" id="3000261">&#39;r&#39;</span><span class="op" id="3000264">)</span><br>
<span class="lineno">90</span><span class="op" id="3000266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3000269">func</span>&nbsp;<span class="op" id="3000274">(</span><span class="ident" id="3000275">pd</span>&nbsp;<span class="op" id="3000278">*</span><span class="ident" id="3000279">pollDesc</span><span class="op" id="3000287">)</span>&nbsp;<span class="ident" id="3000289">WaitWrite</span><span class="op" id="3000298">(</span><span class="op" id="3000299">)</span>&nbsp;<span class="builtintype" id="3000301">error</span>&nbsp;<span class="op" id="3000307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000310">return</span>&nbsp;<span class="ident" id="3000317">pd</span><span class="op" id="3000319">.</span><span class="ident" id="3000320">Wait</span><span class="op" id="3000324">(</span><span class="string" id="3000325">&#39;w&#39;</span><span class="op" id="3000328">)</span><br>
<span class="lineno"></span><span class="op" id="3000330">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="3000333">func</span>&nbsp;<span class="op" id="3000338">(</span><span class="ident" id="3000339">pd</span>&nbsp;<span class="op" id="3000342">*</span><span class="ident" id="3000343">pollDesc</span><span class="op" id="3000351">)</span>&nbsp;<span class="ident" id="3000353">WaitCanceled</span><span class="op" id="3000365">(</span><span class="ident" id="3000366">mode</span>&nbsp;<span class="builtintype" id="3000371">int</span><span class="op" id="3000374">)</span>&nbsp;<span class="op" id="3000376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000379">runtime_pollWaitCanceled</span><span class="op" id="3000403">(</span><span class="ident" id="3000404">pd</span><span class="op" id="3000406">.</span><span class="ident" id="3000407">runtimeCtx</span><span class="op" id="3000417">,</span>&nbsp;<span class="ident" id="3000419">mode</span><span class="op" id="3000423">)</span><br>
<span class="lineno"></span><span class="op" id="3000425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="3000428">func</span>&nbsp;<span class="op" id="3000433">(</span><span class="ident" id="3000434">pd</span>&nbsp;<span class="op" id="3000437">*</span><span class="ident" id="3000438">pollDesc</span><span class="op" id="3000446">)</span>&nbsp;<span class="ident" id="3000448">WaitCanceledRead</span><span class="op" id="3000464">(</span><span class="op" id="3000465">)</span>&nbsp;<span class="op" id="3000467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000470">pd</span><span class="op" id="3000472">.</span><span class="ident" id="3000473">WaitCanceled</span><span class="op" id="3000485">(</span><span class="string" id="3000486">&#39;r&#39;</span><span class="op" id="3000489">)</span><br>
<span class="lineno"></span><span class="op" id="3000491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3000494">func</span>&nbsp;<span class="op" id="3000499">(</span><span class="ident" id="3000500">pd</span>&nbsp;<span class="op" id="3000503">*</span><span class="ident" id="3000504">pollDesc</span><span class="op" id="3000512">)</span>&nbsp;<span class="ident" id="3000514">WaitCanceledWrite</span><span class="op" id="3000531">(</span><span class="op" id="3000532">)</span>&nbsp;<span class="op" id="3000534">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3000537">pd</span><span class="op" id="3000539">.</span><span class="ident" id="3000540">WaitCanceled</span><span class="op" id="3000552">(</span><span class="string" id="3000553">&#39;w&#39;</span><span class="op" id="3000556">)</span><br>
<span class="lineno"></span><span class="op" id="3000558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3000561">func</span>&nbsp;<span class="ident" id="3000566">convertErr</span><span class="op" id="3000576">(</span><span class="ident" id="3000577">res</span>&nbsp;<span class="builtintype" id="3000581">int</span><span class="op" id="3000584">)</span>&nbsp;<span class="builtintype" id="3000586">error</span>&nbsp;<span class="op" id="3000592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000595">switch</span>&nbsp;<span class="ident" id="3000602">res</span>&nbsp;<span class="op" id="3000606">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000609">case</span>&nbsp;<span class="num" id="3000614">0</span><span class="op" id="3000615">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000619">return</span>&nbsp;<span class="ident" id="3000626">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000631">case</span>&nbsp;<span class="num" id="3000636">1</span><span class="op" id="3000637">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000641">return</span>&nbsp;<span class="ident" id="3000648">errClosing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000660">case</span>&nbsp;<span class="num" id="3000665">2</span><span class="op" id="3000666">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000670">return</span>&nbsp;<span class="ident" id="3000677">errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3000689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3000692">println</span><span class="op" id="3000699">(</span><span class="string" id="3000700">&#34;unreachable:&nbsp;&#34;</span><span class="op" id="3000715">,</span>&nbsp;<span class="ident" id="3000717">res</span><span class="op" id="3000720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3000723">panic</span><span class="op" id="3000728">(</span><span class="string" id="3000729">&#34;unreachable&#34;</span><span class="op" id="3000742">)</span><br>
<span class="lineno"></span><span class="op" id="3000744">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="3000747">func</span>&nbsp;<span class="op" id="3000752">(</span><span class="ident" id="3000753">fd</span>&nbsp;<span class="op" id="3000756">*</span><span class="ident" id="3000757">netFD</span><span class="op" id="3000762">)</span>&nbsp;<span class="ident" id="3000764">setDeadline</span><span class="op" id="3000775">(</span><span class="ident" id="3000776">t</span>&nbsp;<span class="ident" id="3000778">time</span><span class="op" id="3000782">.</span><span class="ident" id="3000783">Time</span><span class="op" id="3000787">)</span>&nbsp;<span class="builtintype" id="3000789">error</span>&nbsp;<span class="op" id="3000795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000798">return</span>&nbsp;<span class="ident" id="3000805">setDeadlineImpl</span><span class="op" id="3000820">(</span><span class="ident" id="3000821">fd</span><span class="op" id="3000823">,</span>&nbsp;<span class="ident" id="3000825">t</span><span class="op" id="3000826">,</span>&nbsp;<span class="string" id="3000828">&#39;r&#39;</span><span class="op" id="3000831">+</span><span class="string" id="3000832">&#39;w&#39;</span><span class="op" id="3000835">)</span><br>
<span class="lineno"></span><span class="op" id="3000837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="3000840">func</span>&nbsp;<span class="op" id="3000845">(</span><span class="ident" id="3000846">fd</span>&nbsp;<span class="op" id="3000849">*</span><span class="ident" id="3000850">netFD</span><span class="op" id="3000855">)</span>&nbsp;<span class="ident" id="3000857">setReadDeadline</span><span class="op" id="3000872">(</span><span class="ident" id="3000873">t</span>&nbsp;<span class="ident" id="3000875">time</span><span class="op" id="3000879">.</span><span class="ident" id="3000880">Time</span><span class="op" id="3000884">)</span>&nbsp;<span class="builtintype" id="3000886">error</span>&nbsp;<span class="op" id="3000892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000895">return</span>&nbsp;<span class="ident" id="3000902">setDeadlineImpl</span><span class="op" id="3000917">(</span><span class="ident" id="3000918">fd</span><span class="op" id="3000920">,</span>&nbsp;<span class="ident" id="3000922">t</span><span class="op" id="3000923">,</span>&nbsp;<span class="string" id="3000925">&#39;r&#39;</span><span class="op" id="3000928">)</span><br>
<span class="lineno"></span><span class="op" id="3000930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3000933">func</span>&nbsp;<span class="op" id="3000938">(</span><span class="ident" id="3000939">fd</span>&nbsp;<span class="op" id="3000942">*</span><span class="ident" id="3000943">netFD</span><span class="op" id="3000948">)</span>&nbsp;<span class="ident" id="3000950">setWriteDeadline</span><span class="op" id="3000966">(</span><span class="ident" id="3000967">t</span>&nbsp;<span class="ident" id="3000969">time</span><span class="op" id="3000973">.</span><span class="ident" id="3000974">Time</span><span class="op" id="3000978">)</span>&nbsp;<span class="builtintype" id="3000980">error</span>&nbsp;<span class="op" id="3000986">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3000989">return</span>&nbsp;<span class="ident" id="3000996">setDeadlineImpl</span><span class="op" id="3001011">(</span><span class="ident" id="3001012">fd</span><span class="op" id="3001014">,</span>&nbsp;<span class="ident" id="3001016">t</span><span class="op" id="3001017">,</span>&nbsp;<span class="string" id="3001019">&#39;w&#39;</span><span class="op" id="3001022">)</span><br>
<span class="lineno"></span><span class="op" id="3001024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3001027">func</span>&nbsp;<span class="ident" id="3001032">setDeadlineImpl</span><span class="op" id="3001047">(</span><span class="ident" id="3001048">fd</span>&nbsp;<span class="op" id="3001051">*</span><span class="ident" id="3001052">netFD</span><span class="op" id="3001057">,</span>&nbsp;<span class="ident" id="3001059">t</span>&nbsp;<span class="ident" id="3001061">time</span><span class="op" id="3001065">.</span><span class="ident" id="3001066">Time</span><span class="op" id="3001070">,</span>&nbsp;<span class="ident" id="3001072">mode</span>&nbsp;<span class="builtintype" id="3001077">int</span><span class="op" id="3001080">)</span>&nbsp;<span class="builtintype" id="3001082">error</span>&nbsp;<span class="op" id="3001088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001091">d</span>&nbsp;<span class="op" id="3001093">:=</span>&nbsp;<span class="ident" id="3001096">runtimeNano</span><span class="op" id="3001107">(</span><span class="op" id="3001108">)</span>&nbsp;<span class="op" id="3001110">+</span>&nbsp;<span class="ident" id="3001112">int64</span><span class="op" id="3001117">(</span><span class="ident" id="3001118">t</span><span class="op" id="3001119">.</span><span class="ident" id="3001120">Sub</span><span class="op" id="3001123">(</span><span class="ident" id="3001124">time</span><span class="op" id="3001128">.</span><span class="ident" id="3001129">Now</span><span class="op" id="3001132">(</span><span class="op" id="3001133">)</span><span class="op" id="3001134">)</span><span class="op" id="3001135">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001138">if</span>&nbsp;<span class="ident" id="3001141">t</span><span class="op" id="3001142">.</span><span class="ident" id="3001143">IsZero</span><span class="op" id="3001149">(</span><span class="op" id="3001150">)</span>&nbsp;<span class="op" id="3001152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001156">d</span>&nbsp;<span class="op" id="3001158">=</span>&nbsp;<span class="num" id="3001160">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001166">if</span>&nbsp;<span class="ident" id="3001169">err</span>&nbsp;<span class="op" id="3001173">:=</span>&nbsp;<span class="ident" id="3001176">fd</span><span class="op" id="3001178">.</span><span class="ident" id="3001179">incref</span><span class="op" id="3001185">(</span><span class="op" id="3001186">)</span><span class="op" id="3001187">;</span>&nbsp;<span class="ident" id="3001189">err</span>&nbsp;<span class="op" id="3001193">!=</span>&nbsp;<span class="ident" id="3001196">nil</span>&nbsp;<span class="op" id="3001200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001204">return</span>&nbsp;<span class="ident" id="3001211">err</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3001216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001219">runtime_pollSetDeadline</span><span class="op" id="3001242">(</span><span class="ident" id="3001243">fd</span><span class="op" id="3001245">.</span><span class="ident" id="3001246">pd</span><span class="op" id="3001248">.</span><span class="ident" id="3001249">runtimeCtx</span><span class="op" id="3001259">,</span>&nbsp;<span class="ident" id="3001261">d</span><span class="op" id="3001262">,</span>&nbsp;<span class="ident" id="3001264">mode</span><span class="op" id="3001268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3001271">fd</span><span class="op" id="3001273">.</span><span class="ident" id="3001274">decref</span><span class="op" id="3001280">(</span><span class="op" id="3001281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3001284">return</span>&nbsp;<span class="ident" id="3001291">nil</span><br>
<span class="lineno"></span><span class="op" id="3001295">}</span>
</div>
</body>
</html>
