<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1874887">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1874943">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1874997">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1875048">//&nbsp;Cgo&nbsp;call&nbsp;and&nbsp;callback&nbsp;support.</span><br>
<span class="lineno"></span><span class="comment" id="1875082">//</span><br>
<span class="lineno"></span><span class="comment" id="1875085">//&nbsp;To&nbsp;call&nbsp;into&nbsp;the&nbsp;C&nbsp;function&nbsp;f&nbsp;from&nbsp;Go,&nbsp;the&nbsp;cgo-generated&nbsp;code&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1875156">//&nbsp;runtime.cgocall(_cgo_Cfunc_f,&nbsp;frame),&nbsp;where&nbsp;_cgo_Cfunc_f&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1875221">//&nbsp;gcc-compiled&nbsp;function&nbsp;written&nbsp;by&nbsp;cgo.</span><br>
<span class="lineno">10</span><span class="comment" id="1875262">//</span><br>
<span class="lineno"></span><span class="comment" id="1875265">//&nbsp;runtime.cgocall&nbsp;(below)&nbsp;locks&nbsp;g&nbsp;to&nbsp;m,&nbsp;calls&nbsp;entersyscall</span><br>
<span class="lineno"></span><span class="comment" id="1875325">//&nbsp;so&nbsp;as&nbsp;not&nbsp;to&nbsp;block&nbsp;other&nbsp;goroutines&nbsp;or&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span><span class="comment" id="1875390">//&nbsp;and&nbsp;then&nbsp;calls&nbsp;runtime.asmcgocall(_cgo_Cfunc_f,&nbsp;frame).</span><br>
<span class="lineno"></span><span class="comment" id="1875449">//</span><br>
<span class="lineno">15</span><span class="comment" id="1875452">//&nbsp;runtime.asmcgocall&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;to&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1875521">//&nbsp;(assumed&nbsp;to&nbsp;be&nbsp;an&nbsp;operating&nbsp;system-allocated&nbsp;stack,&nbsp;so&nbsp;safe&nbsp;to&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="1875591">//&nbsp;gcc-compiled&nbsp;code&nbsp;on)&nbsp;and&nbsp;calls&nbsp;_cgo_Cfunc_f(frame).</span><br>
<span class="lineno"></span><span class="comment" id="1875647">//</span><br>
<span class="lineno"></span><span class="comment" id="1875650">//&nbsp;_cgo_Cfunc_f&nbsp;invokes&nbsp;the&nbsp;actual&nbsp;C&nbsp;function&nbsp;f&nbsp;with&nbsp;arguments</span><br>
<span class="lineno">20</span><span class="comment" id="1875713">//&nbsp;taken&nbsp;from&nbsp;the&nbsp;frame&nbsp;structure,&nbsp;records&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;frame,</span><br>
<span class="lineno"></span><span class="comment" id="1875782">//&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.asmcgocall.</span><br>
<span class="lineno"></span><span class="comment" id="1875820">//</span><br>
<span class="lineno"></span><span class="comment" id="1875823">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.asmcgocall&nbsp;switches&nbsp;back&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1875892">//&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocall.</span><br>
<span class="lineno">25</span><span class="comment" id="1875956">//</span><br>
<span class="lineno"></span><span class="comment" id="1875959">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocall&nbsp;calls&nbsp;exitsyscall,&nbsp;which&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="1876036">//&nbsp;until&nbsp;this&nbsp;m&nbsp;can&nbsp;run&nbsp;Go&nbsp;code&nbsp;without&nbsp;violating&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit,</span><br>
<span class="lineno"></span><span class="comment" id="1876109">//&nbsp;and&nbsp;then&nbsp;unlocks&nbsp;g&nbsp;from&nbsp;m.</span><br>
<span class="lineno"></span><span class="comment" id="1876139">//</span><br>
<span class="lineno">30</span><span class="comment" id="1876142">//&nbsp;The&nbsp;above&nbsp;description&nbsp;skipped&nbsp;over&nbsp;the&nbsp;possibility&nbsp;of&nbsp;the&nbsp;gcc-compiled</span><br>
<span class="lineno"></span><span class="comment" id="1876216">//&nbsp;function&nbsp;f&nbsp;calling&nbsp;back&nbsp;into&nbsp;Go.&nbsp;&nbsp;If&nbsp;that&nbsp;happens,&nbsp;we&nbsp;continue&nbsp;down</span><br>
<span class="lineno"></span><span class="comment" id="1876287">//&nbsp;the&nbsp;rabbit&nbsp;hole&nbsp;during&nbsp;the&nbsp;execution&nbsp;of&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="1876333">//</span><br>
<span class="lineno"></span><span class="comment" id="1876336">//&nbsp;To&nbsp;make&nbsp;it&nbsp;possible&nbsp;for&nbsp;gcc-compiled&nbsp;C&nbsp;code&nbsp;to&nbsp;call&nbsp;a&nbsp;Go&nbsp;function&nbsp;p.GoF,</span><br>
<span class="lineno">35</span><span class="comment" id="1876412">//&nbsp;cgo&nbsp;writes&nbsp;a&nbsp;gcc-compiled&nbsp;function&nbsp;named&nbsp;GoF&nbsp;(not&nbsp;p.GoF,&nbsp;since&nbsp;gcc&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="1876490">//&nbsp;know&nbsp;about&nbsp;packages).&nbsp;&nbsp;The&nbsp;gcc-compiled&nbsp;C&nbsp;function&nbsp;f&nbsp;calls&nbsp;GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1876557">//</span><br>
<span class="lineno"></span><span class="comment" id="1876560">//&nbsp;GoF&nbsp;calls&nbsp;crosscall2(_cgoexp_GoF,&nbsp;frame,&nbsp;framesize).&nbsp;&nbsp;Crosscall2</span><br>
<span class="lineno"></span><span class="comment" id="1876628">//&nbsp;(in&nbsp;cgo/gcc_$GOARCH.S,&nbsp;a&nbsp;gcc-compiled&nbsp;assembly&nbsp;file)&nbsp;is&nbsp;a&nbsp;two-argument</span><br>
<span class="lineno">40</span><span class="comment" id="1876702">//&nbsp;adapter&nbsp;from&nbsp;the&nbsp;gcc&nbsp;function&nbsp;call&nbsp;ABI&nbsp;to&nbsp;the&nbsp;6c&nbsp;function&nbsp;call&nbsp;ABI.</span><br>
<span class="lineno"></span><span class="comment" id="1876773">//&nbsp;It&nbsp;is&nbsp;called&nbsp;from&nbsp;gcc&nbsp;to&nbsp;call&nbsp;6c&nbsp;functions.&nbsp;&nbsp;In&nbsp;this&nbsp;case&nbsp;it&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1876843">//&nbsp;_cgoexp_GoF(frame,&nbsp;framesize),&nbsp;still&nbsp;running&nbsp;on&nbsp;m-&gt;g0&#39;s&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1876908">//&nbsp;and&nbsp;outside&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit.&nbsp;&nbsp;Thus,&nbsp;this&nbsp;code&nbsp;cannot&nbsp;yet</span><br>
<span class="lineno"></span><span class="comment" id="1876974">//&nbsp;call&nbsp;arbitrary&nbsp;Go&nbsp;code&nbsp;directly&nbsp;and&nbsp;must&nbsp;be&nbsp;careful&nbsp;not&nbsp;to&nbsp;allocate</span><br>
<span class="lineno">45</span><span class="comment" id="1877045">//&nbsp;memory&nbsp;or&nbsp;use&nbsp;up&nbsp;m-&gt;g0&#39;s&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="1877080">//</span><br>
<span class="lineno"></span><span class="comment" id="1877083">//&nbsp;_cgoexp_GoF&nbsp;calls&nbsp;runtime.cgocallback(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1877150">//&nbsp;(The&nbsp;reason&nbsp;for&nbsp;having&nbsp;_cgoexp_GoF&nbsp;instead&nbsp;of&nbsp;writing&nbsp;a&nbsp;crosscall3</span><br>
<span class="lineno"></span><span class="comment" id="1877220">//&nbsp;to&nbsp;make&nbsp;this&nbsp;call&nbsp;directly&nbsp;is&nbsp;that&nbsp;_cgoexp_GoF,&nbsp;because&nbsp;it&nbsp;is&nbsp;compiled</span><br>
<span class="lineno">50</span><span class="comment" id="1877294">//&nbsp;with&nbsp;6c&nbsp;instead&nbsp;of&nbsp;gcc,&nbsp;can&nbsp;refer&nbsp;to&nbsp;dotted&nbsp;names&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="1877352">//&nbsp;runtime.cgocallback&nbsp;and&nbsp;p.GoF.)</span><br>
<span class="lineno"></span><span class="comment" id="1877387">//</span><br>
<span class="lineno"></span><span class="comment" id="1877390">//&nbsp;runtime.cgocallback&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;from&nbsp;m-&gt;g0&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1877454">//&nbsp;stack&nbsp;to&nbsp;the&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack,&nbsp;on&nbsp;which&nbsp;it&nbsp;calls</span><br>
<span class="lineno">55</span><span class="comment" id="1877518">//&nbsp;runtime.cgocallbackg(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1877568">//&nbsp;As&nbsp;part&nbsp;of&nbsp;the&nbsp;stack&nbsp;switch,&nbsp;runtime.cgocallback&nbsp;saves&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="1877638">//&nbsp;SP&nbsp;as&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;so&nbsp;that&nbsp;any&nbsp;use&nbsp;of&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1877708">//&nbsp;execution&nbsp;of&nbsp;the&nbsp;callback&nbsp;will&nbsp;be&nbsp;done&nbsp;below&nbsp;the&nbsp;existing&nbsp;stack&nbsp;frames.</span><br>
<span class="lineno"></span><span class="comment" id="1877783">//&nbsp;Before&nbsp;overwriting&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;it&nbsp;pushes&nbsp;the&nbsp;old&nbsp;value&nbsp;on&nbsp;the</span><br>
<span class="lineno">60</span><span class="comment" id="1877853">//&nbsp;m-&gt;g0&nbsp;stack,&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;restored&nbsp;later.</span><br>
<span class="lineno"></span><span class="comment" id="1877903">//</span><br>
<span class="lineno"></span><span class="comment" id="1877906">//&nbsp;runtime.cgocallbackg&nbsp;(below)&nbsp;is&nbsp;now&nbsp;running&nbsp;on&nbsp;a&nbsp;real&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1877973">//&nbsp;stack&nbsp;(not&nbsp;an&nbsp;m-&gt;g0&nbsp;stack).&nbsp;&nbsp;First&nbsp;it&nbsp;calls&nbsp;runtime.exitsyscall,&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="1878052">//&nbsp;block&nbsp;until&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit&nbsp;allows&nbsp;running&nbsp;this&nbsp;goroutine.</span><br>
<span class="lineno">65</span><span class="comment" id="1878120">//&nbsp;Once&nbsp;exitsyscall&nbsp;has&nbsp;returned,&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;do&nbsp;things&nbsp;like&nbsp;call&nbsp;the&nbsp;memory</span><br>
<span class="lineno"></span><span class="comment" id="1878199">//&nbsp;allocator&nbsp;or&nbsp;invoke&nbsp;the&nbsp;Go&nbsp;callback&nbsp;function&nbsp;p.GoF.&nbsp;&nbsp;runtime.cgocallbackg</span><br>
<span class="lineno"></span><span class="comment" id="1878276">//&nbsp;first&nbsp;defers&nbsp;a&nbsp;function&nbsp;to&nbsp;unwind&nbsp;m-&gt;g0.sched.sp,&nbsp;so&nbsp;that&nbsp;if&nbsp;p.GoF</span><br>
<span class="lineno"></span><span class="comment" id="1878346">//&nbsp;panics,&nbsp;m-&gt;g0.sched.sp&nbsp;will&nbsp;be&nbsp;restored&nbsp;to&nbsp;its&nbsp;old&nbsp;value:&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1878423">//&nbsp;and&nbsp;the&nbsp;m-&gt;curg&nbsp;stack&nbsp;will&nbsp;be&nbsp;unwound&nbsp;in&nbsp;lock&nbsp;step.</span><br>
<span class="lineno">70</span><span class="comment" id="1878478">//&nbsp;Then&nbsp;it&nbsp;calls&nbsp;p.GoF.&nbsp;&nbsp;Finally&nbsp;it&nbsp;pops&nbsp;but&nbsp;does&nbsp;not&nbsp;execute&nbsp;the&nbsp;deferred</span><br>
<span class="lineno"></span><span class="comment" id="1878553">//&nbsp;function,&nbsp;calls&nbsp;runtime.entersyscall,&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocallback.</span><br>
<span class="lineno"></span><span class="comment" id="1878630">//</span><br>
<span class="lineno"></span><span class="comment" id="1878633">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocallback&nbsp;switches&nbsp;back&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1878699">//&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;(the&nbsp;pointer&nbsp;is&nbsp;still&nbsp;in&nbsp;m-&gt;g0.sched.sp),&nbsp;restores&nbsp;the&nbsp;old</span><br>
<span class="lineno">75</span><span class="comment" id="1878775">//&nbsp;m-&gt;g0.sched.sp&nbsp;value&nbsp;from&nbsp;the&nbsp;stack,&nbsp;and&nbsp;returns&nbsp;to&nbsp;_cgoexp_GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1878843">//</span><br>
<span class="lineno"></span><span class="comment" id="1878846">//&nbsp;_cgoexp_GoF&nbsp;immediately&nbsp;returns&nbsp;to&nbsp;crosscall2,&nbsp;which&nbsp;restores&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1878915">//&nbsp;callee-save&nbsp;registers&nbsp;for&nbsp;gcc&nbsp;and&nbsp;returns&nbsp;to&nbsp;GoF,&nbsp;which&nbsp;returns&nbsp;to&nbsp;f.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="1878989">package</span>&nbsp;<span class="ident" id="1878997">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1879006">import</span>&nbsp;<span class="string" id="1879013">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1879023">//&nbsp;Call&nbsp;from&nbsp;Go&nbsp;to&nbsp;C.</span><br>
<span class="lineno">85</span><span class="comment" id="1879045">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1879058">func</span>&nbsp;<span class="ident" id="1879063">cgocall</span><span class="op" id="1879070">(</span><span class="ident" id="1879071">fn</span><span class="op" id="1879073">,</span>&nbsp;<span class="ident" id="1879075">arg</span>&nbsp;<span class="ident" id="1879079"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1879085">.</span><span class="ident" id="1879086">Pointer</span><span class="op" id="1879093">)</span>&nbsp;<span class="op" id="1879095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1879098"><a href="/runtime/cgocall.go.html#1879142">cgocall_errno</a></span><span class="op" id="1879111">(</span><span class="ident" id="1879112"><a href="/runtime/cgocall.go.html#1879071">fn</a></span><span class="op" id="1879114">,</span>&nbsp;<span class="ident" id="1879116"><a href="/runtime/cgocall.go.html#1879075">arg</a></span><span class="op" id="1879119">)</span><br>
<span class="lineno"></span><span class="op" id="1879121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="1879124">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1879137">func</span>&nbsp;<span class="ident" id="1879142">cgocall_errno</span><span class="op" id="1879155">(</span><span class="ident" id="1879156">fn</span><span class="op" id="1879158">,</span>&nbsp;<span class="ident" id="1879160">arg</span>&nbsp;<span class="ident" id="1879164"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1879170">.</span><span class="ident" id="1879171">Pointer</span><span class="op" id="1879178">)</span>&nbsp;<span class="builtintype" id="1879180">int32</span>&nbsp;<span class="op" id="1879186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1879189">if</span>&nbsp;<span class="op" id="1879192">!</span><span class="ident" id="1879193"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184467">iscgo</a></span>&nbsp;<span class="op" id="1879199">&amp;&amp;</span>&nbsp;<span class="ident" id="1879202"><a href="/runtime/extern.go.html#1926775">GOOS</a></span>&nbsp;<span class="op" id="1879207">!=</span>&nbsp;<span class="string" id="1879210">&#34;solaris&#34;</span>&nbsp;<span class="op" id="1879220">&amp;&amp;</span>&nbsp;<span class="ident" id="1879223"><a href="/runtime/extern.go.html#1926775">GOOS</a></span>&nbsp;<span class="op" id="1879228">!=</span>&nbsp;<span class="string" id="1879231">&#34;windows&#34;</span>&nbsp;<span class="op" id="1879241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1879245"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1879252">(</span><span class="string" id="1879253">&#34;cgocall&nbsp;unavailable&#34;</span><span class="op" id="1879274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1879277">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1879281">if</span>&nbsp;<span class="ident" id="1879284"><a href="/runtime/cgocall.go.html#1879156">fn</a></span>&nbsp;<span class="op" id="1879287">==</span>&nbsp;<span class="ident" id="1879290">nil</span>&nbsp;<span class="op" id="1879294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1879298"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1879305">(</span><span class="string" id="1879306">&#34;cgocall&nbsp;nil&#34;</span><span class="op" id="1879319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1879322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1879326">if</span>&nbsp;<span class="ident" id="1879329"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="1879341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1879345"><a href="/runtime/race0.go.html#2070966">racereleasemerge</a></span><span class="op" id="1879361">(</span><span class="ident" id="1879362"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1879368">.</span><span class="ident" id="1879369">Pointer</span><span class="op" id="1879376">(</span><span class="op" id="1879377">&amp;</span><span class="ident" id="1879378"><a href="/runtime/cgocall.go.html#1883564">racecgosync</a></span><span class="op" id="1879389">)</span><span class="op" id="1879390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1879393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1879397">//&nbsp;Create&nbsp;an&nbsp;extra&nbsp;M&nbsp;for&nbsp;callbacks&nbsp;on&nbsp;threads&nbsp;not&nbsp;created&nbsp;by&nbsp;Go&nbsp;on&nbsp;first&nbsp;cgo&nbsp;call.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1879481">if</span>&nbsp;<span class="ident" id="1879484"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184394">needextram</a></span>&nbsp;<span class="op" id="1879495">==</span>&nbsp;<span class="num" id="1879498">1</span>&nbsp;<span class="op" id="1879500">&amp;&amp;</span>&nbsp;<span class="ident" id="1879503"><a href="/runtime/stubs.go.html#2137846">cas</a></span><span class="op" id="1879506">(</span><span class="op" id="1879507">&amp;</span><span class="ident" id="1879508"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184394">needextram</a></span><span class="op" id="1879518">,</span>&nbsp;<span class="num" id="1879520">1</span><span class="op" id="1879521">,</span>&nbsp;<span class="num" id="1879523">0</span><span class="op" id="1879524">)</span>&nbsp;<span class="op" id="1879526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1879530"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="1879533">(</span><span class="ident" id="1879534"><a href="/runtime/stubs.go.html#2135916">newextram</a></span><span class="op" id="1879543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1879546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1879550">/*<br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Lock&nbsp;g&nbsp;to&nbsp;m&nbsp;to&nbsp;ensure&nbsp;we&nbsp;stay&nbsp;on&nbsp;the&nbsp;same&nbsp;stack&nbsp;if&nbsp;we&nbsp;do&nbsp;a<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;cgo&nbsp;callback.&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1879683"><a href="/runtime/stubs.go.html#2135933">lockOSThread</a></span><span class="op" id="1879695">(</span><span class="op" id="1879696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1879699">mp</span>&nbsp;<span class="op" id="1879702">:=</span>&nbsp;<span class="ident" id="1879705"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="1879709">(</span><span class="op" id="1879710">)</span><span class="op" id="1879711">.</span><span class="ident" id="1879712">m</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1879715"><a href="/runtime/cgocall.go.html#1879699">mp</a></span><span class="op" id="1879717">.</span><span class="ident" id="1879718">ncgocall</span><span class="op" id="1879726">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1879730"><a href="/runtime/cgocall.go.html#1879699">mp</a></span><span class="op" id="1879732">.</span><span class="ident" id="1879733">ncgo</span><span class="op" id="1879737">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1879741">defer</span>&nbsp;<span class="ident" id="1879747"><a href="/runtime/cgocall.go.html#1880220">endcgo</a></span><span class="op" id="1879753">(</span><span class="ident" id="1879754"><a href="/runtime/cgocall.go.html#1879699">mp</a></span><span class="op" id="1879756">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1879760">/*<br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Announce&nbsp;we&nbsp;are&nbsp;entering&nbsp;a&nbsp;system&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;so&nbsp;that&nbsp;the&nbsp;scheduler&nbsp;knows&nbsp;to&nbsp;create&nbsp;another<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;M&nbsp;to&nbsp;run&nbsp;goroutines&nbsp;while&nbsp;we&nbsp;are&nbsp;in&nbsp;the<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;foreign&nbsp;code.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;The&nbsp;call&nbsp;to&nbsp;asmcgocall&nbsp;is&nbsp;guaranteed&nbsp;not&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;split&nbsp;the&nbsp;stack&nbsp;and&nbsp;does&nbsp;not&nbsp;allocate&nbsp;memory,<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;so&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;while&nbsp;&#34;in&nbsp;a&nbsp;system&nbsp;call&#34;,&nbsp;outside<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;the&nbsp;$GOMAXPROCS&nbsp;accounting.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880118"><a href="/runtime/stubs.go.html#2136521">entersyscall</a></span><span class="op" id="1880130">(</span><span class="op" id="1880131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880134">errno</span>&nbsp;<span class="op" id="1880140">:=</span>&nbsp;<span class="ident" id="1880143"><a href="/runtime/stubs.go.html#2139676">asmcgocall_errno</a></span><span class="op" id="1880159">(</span><span class="ident" id="1880160"><a href="/runtime/cgocall.go.html#1879156">fn</a></span><span class="op" id="1880162">,</span>&nbsp;<span class="ident" id="1880164"><a href="/runtime/cgocall.go.html#1879160">arg</a></span><span class="op" id="1880167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880170"><a href="/runtime/stubs.go.html#2136617">exitsyscall</a></span><span class="op" id="1880181">(</span><span class="op" id="1880182">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880186">return</span>&nbsp;<span class="ident" id="1880193"><a href="/runtime/cgocall.go.html#1880134">errno</a></span><br>
<span class="lineno">135</span><span class="op" id="1880199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1880202">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1880215">func</span>&nbsp;<span class="ident" id="1880220">endcgo</span><span class="op" id="1880226">(</span><span class="ident" id="1880227">mp</span>&nbsp;<span class="op" id="1880230">*</span><span class="ident" id="1880231"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180912">m</a></span><span class="op" id="1880232">)</span>&nbsp;<span class="op" id="1880234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880237"><a href="/runtime/cgocall.go.html#1880227">mp</a></span><span class="op" id="1880239">.</span><span class="ident" id="1880240">ncgo</span><span class="op" id="1880244">--</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880248">if</span>&nbsp;<span class="ident" id="1880251"><a href="/runtime/cgocall.go.html#1880227">mp</a></span><span class="op" id="1880253">.</span><span class="ident" id="1880254">ncgo</span>&nbsp;<span class="op" id="1880259">==</span>&nbsp;<span class="num" id="1880262">0</span>&nbsp;<span class="op" id="1880264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1880268">//&nbsp;We&nbsp;are&nbsp;going&nbsp;back&nbsp;to&nbsp;Go&nbsp;and&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;recursive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1880324">//&nbsp;call.&nbsp;&nbsp;Let&nbsp;the&nbsp;GC&nbsp;collect&nbsp;any&nbsp;memory&nbsp;allocated&nbsp;via</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1880380">//&nbsp;_cgo_allocate&nbsp;that&nbsp;is&nbsp;no&nbsp;longer&nbsp;referenced.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880429"><a href="/runtime/cgocall.go.html#1880227">mp</a></span><span class="op" id="1880431">.</span><span class="ident" id="1880432">cgomal</span>&nbsp;<span class="op" id="1880439">=</span>&nbsp;<span class="ident" id="1880441">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1880446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880450">if</span>&nbsp;<span class="ident" id="1880453"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="1880465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880469"><a href="/runtime/race0.go.html#2070582">raceacquire</a></span><span class="op" id="1880480">(</span><span class="ident" id="1880481"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1880487">.</span><span class="ident" id="1880488">Pointer</span><span class="op" id="1880495">(</span><span class="op" id="1880496">&amp;</span><span class="ident" id="1880497"><a href="/runtime/cgocall.go.html#1883564">racecgosync</a></span><span class="op" id="1880508">)</span><span class="op" id="1880509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1880512">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880516"><a href="/runtime/stubs.go.html#2135953">unlockOSThread</a></span><span class="op" id="1880530">(</span><span class="op" id="1880531">)</span>&nbsp;<span class="comment" id="1880533">//&nbsp;invalidates&nbsp;mp</span><br>
<span class="lineno"></span><span class="op" id="1880551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1880554">//&nbsp;Helper&nbsp;functions&nbsp;for&nbsp;cgo&nbsp;code.</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="1880589">//&nbsp;Filled&nbsp;by&nbsp;schedinit&nbsp;from&nbsp;corresponding&nbsp;C&nbsp;variables,</span><br>
<span class="lineno"></span><span class="comment" id="1880644">//&nbsp;which&nbsp;are&nbsp;in&nbsp;turn&nbsp;filled&nbsp;in&nbsp;by&nbsp;dynamic&nbsp;linker&nbsp;when&nbsp;Cgo&nbsp;is&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="1880716">var</span>&nbsp;<span class="ident" id="1880720">cgoMalloc</span><span class="op" id="1880729">,</span>&nbsp;<span class="ident" id="1880731">cgoFree</span>&nbsp;<span class="ident" id="1880739"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1880745">.</span><span class="ident" id="1880746">Pointer</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="keyword" id="1880755">func</span>&nbsp;<span class="ident" id="1880760">cmalloc</span><span class="op" id="1880767">(</span><span class="ident" id="1880768">n</span>&nbsp;<span class="builtintype" id="1880770">uintptr</span><span class="op" id="1880777">)</span>&nbsp;<span class="ident" id="1880779"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1880785">.</span><span class="ident" id="1880786">Pointer</span>&nbsp;<span class="op" id="1880794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880797">var</span>&nbsp;<span class="ident" id="1880801">args</span>&nbsp;<span class="keyword" id="1880806">struct</span>&nbsp;<span class="op" id="1880813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880817">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1880821">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880830">ret</span>&nbsp;<span class="ident" id="1880834"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1880840">.</span><span class="ident" id="1880841">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1880850">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880853"><a href="/runtime/cgocall.go.html#1880801">args</a></span><span class="op" id="1880857">.</span><span class="ident" id="1880858">n</span>&nbsp;<span class="op" id="1880860">=</span>&nbsp;<span class="ident" id="1880862">uint64</span><span class="op" id="1880868">(</span><span class="ident" id="1880869"><a href="/runtime/cgocall.go.html#1880768">n</a></span><span class="op" id="1880870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880873"><a href="/runtime/cgocall.go.html#1879063">cgocall</a></span><span class="op" id="1880880">(</span><span class="ident" id="1880881"><a href="/runtime/cgocall.go.html#1880720">cgoMalloc</a></span><span class="op" id="1880890">,</span>&nbsp;<span class="ident" id="1880892"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1880898">.</span><span class="ident" id="1880899">Pointer</span><span class="op" id="1880906">(</span><span class="op" id="1880907">&amp;</span><span class="ident" id="1880908"><a href="/runtime/cgocall.go.html#1880801">args</a></span><span class="op" id="1880912">)</span><span class="op" id="1880913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880916">if</span>&nbsp;<span class="ident" id="1880919"><a href="/runtime/cgocall.go.html#1880801">args</a></span><span class="op" id="1880923">.</span><span class="ident" id="1880924">ret</span>&nbsp;<span class="op" id="1880928">==</span>&nbsp;<span class="ident" id="1880931">nil</span>&nbsp;<span class="op" id="1880935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1880939"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1880946">(</span><span class="string" id="1880947">&#34;C&nbsp;malloc&nbsp;failed&#34;</span><span class="op" id="1880964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1880967">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1880970">return</span>&nbsp;<span class="ident" id="1880977"><a href="/runtime/cgocall.go.html#1880801">args</a></span><span class="op" id="1880981">.</span><span class="ident" id="1880982">ret</span><br>
<span class="lineno"></span><span class="op" id="1880986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1880989">func</span>&nbsp;<span class="ident" id="1880994">cfree</span><span class="op" id="1880999">(</span><span class="ident" id="1881000">p</span>&nbsp;<span class="ident" id="1881002"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1881008">.</span><span class="ident" id="1881009">Pointer</span><span class="op" id="1881016">)</span>&nbsp;<span class="op" id="1881018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1881021"><a href="/runtime/cgocall.go.html#1879063">cgocall</a></span><span class="op" id="1881028">(</span><span class="ident" id="1881029"><a href="/runtime/cgocall.go.html#1880731">cgoFree</a></span><span class="op" id="1881036">,</span>&nbsp;<span class="ident" id="1881038"><a href="/runtime/cgocall.go.html#1881000">p</a></span><span class="op" id="1881039">)</span><br>
<span class="lineno">175</span><span class="op" id="1881041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1881044">//&nbsp;Call&nbsp;from&nbsp;C&nbsp;back&nbsp;to&nbsp;Go.</span><br>
<span class="lineno"></span><span class="comment" id="1881071">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1881084">func</span>&nbsp;<span class="ident" id="1881089">cgocallbackg</span><span class="op" id="1881101">(</span><span class="op" id="1881102">)</span>&nbsp;<span class="op" id="1881104">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1881107">gp</span>&nbsp;<span class="op" id="1881110">:=</span>&nbsp;<span class="ident" id="1881113"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="1881117">(</span><span class="op" id="1881118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1881121">if</span>&nbsp;<span class="ident" id="1881124"><a href="/runtime/cgocall.go.html#1881107">gp</a></span>&nbsp;<span class="op" id="1881127">!=</span>&nbsp;<span class="ident" id="1881130"><a href="/runtime/cgocall.go.html#1881107">gp</a></span><span class="op" id="1881132">.</span><span class="ident" id="1881133">m</span><span class="op" id="1881134">.</span><span class="ident" id="1881135">curg</span>&nbsp;<span class="op" id="1881140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1881144">println</span><span class="op" id="1881151">(</span><span class="string" id="1881152">&#34;runtime:&nbsp;bad&nbsp;g&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1881183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1881187"><a href="/runtime/stubs.go.html#2136998">exit</a></span><span class="op" id="1881191">(</span><span class="num" id="1881192">2</span><span class="op" id="1881193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1881196">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1881200">//&nbsp;entersyscall&nbsp;saves&nbsp;the&nbsp;caller&#39;s&nbsp;SP&nbsp;to&nbsp;allow&nbsp;the&nbsp;GC&nbsp;to&nbsp;trace&nbsp;the&nbsp;Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1881271">//&nbsp;stack.&nbsp;However,&nbsp;since&nbsp;we&#39;re&nbsp;returning&nbsp;to&nbsp;an&nbsp;earlier&nbsp;stack&nbsp;frame&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1881343">//&nbsp;need&nbsp;to&nbsp;pair&nbsp;with&nbsp;the&nbsp;entersyscall()&nbsp;call&nbsp;made&nbsp;by&nbsp;cgocall,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1881414">//&nbsp;save&nbsp;syscall*&nbsp;and&nbsp;let&nbsp;reentersyscall&nbsp;restore&nbsp;them.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1881469">savedsp</span>&nbsp;<span class="op" id="1881477">:=</span>&nbsp;<span class="ident" id="1881480"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1881486">.</span><span class="ident" id="1881487">Pointer</span><span class="op" id="1881494">(</span><span class="ident" id="1881495"><a href="/runtime/cgocall.go.html#1881107">gp</a></span><span class="op" id="1881497">.</span><span class="ident" id="1881498">syscallsp</span><span class="op" id="1881507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1881510">savedpc</span>&nbsp;<span class="op" id="1881518">:=</span>&nbsp;<span class="ident" id="1881521"><a href="/runtime/cgocall.go.html#1881107">gp</a></span><span class="op" id="1881523">.</span><span class="ident" id="1881524">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1881535"><a href="/runtime/stubs.go.html#2136617">exitsyscall</a></span><span class="op" id="1881546">(</span><span class="op" id="1881547">)</span>&nbsp;<span class="comment" id="1881549">//&nbsp;coming&nbsp;out&nbsp;of&nbsp;cgo&nbsp;call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1881576"><a href="/runtime/cgocall.go.html#1881661">cgocallbackg1</a></span><span class="op" id="1881589">(</span><span class="op" id="1881590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1881593">//&nbsp;going&nbsp;back&nbsp;to&nbsp;cgo&nbsp;call</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1881620"><a href="/runtime/stubs.go.html#2136541">reentersyscall</a></span><span class="op" id="1881634">(</span><span class="ident" id="1881635"><a href="/runtime/cgocall.go.html#1881510">savedpc</a></span><span class="op" id="1881642">,</span>&nbsp;<span class="ident" id="1881644"><a href="/runtime/cgocall.go.html#1881469">savedsp</a></span><span class="op" id="1881651">)</span><br>
<span class="lineno"></span><span class="op" id="1881653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1881656">func</span>&nbsp;<span class="ident" id="1881661">cgocallbackg1</span><span class="op" id="1881674">(</span><span class="op" id="1881675">)</span>&nbsp;<span class="op" id="1881677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1881680">gp</span>&nbsp;<span class="op" id="1881683">:=</span>&nbsp;<span class="ident" id="1881686"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="1881690">(</span><span class="op" id="1881691">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1881694">if</span>&nbsp;<span class="ident" id="1881697"><a href="/runtime/cgocall.go.html#1881680">gp</a></span><span class="op" id="1881699">.</span><span class="ident" id="1881700">m</span><span class="op" id="1881701">.</span><span class="ident" id="1881702">needextram</span>&nbsp;<span class="op" id="1881713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1881717"><a href="/runtime/cgocall.go.html#1881680">gp</a></span><span class="op" id="1881719">.</span><span class="ident" id="1881720">m</span><span class="op" id="1881721">.</span><span class="ident" id="1881722">needextram</span>&nbsp;<span class="op" id="1881733">=</span>&nbsp;<span class="builtintype" id="1881735">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1881743"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="1881746">(</span><span class="ident" id="1881747"><a href="/runtime/stubs.go.html#2135916">newextram</a></span><span class="op" id="1881756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1881759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1881763">//&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1881810">restore</span>&nbsp;<span class="op" id="1881818">:=</span>&nbsp;<span class="builtintype" id="1881821">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1881827">defer</span>&nbsp;<span class="ident" id="1881833"><a href="/runtime/cgocall.go.html#1882958">unwindm</a></span><span class="op" id="1881840">(</span><span class="op" id="1881841">&amp;</span><span class="ident" id="1881842"><a href="/runtime/cgocall.go.html#1881810">restore</a></span><span class="op" id="1881849">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1881853">if</span>&nbsp;<span class="ident" id="1881856"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="1881868">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1881872"><a href="/runtime/race0.go.html#2070582">raceacquire</a></span><span class="op" id="1881883">(</span><span class="ident" id="1881884"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1881890">.</span><span class="ident" id="1881891">Pointer</span><span class="op" id="1881898">(</span><span class="op" id="1881899">&amp;</span><span class="ident" id="1881900"><a href="/runtime/cgocall.go.html#1883564">racecgosync</a></span><span class="op" id="1881911">)</span><span class="op" id="1881912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1881915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1881919">type</span>&nbsp;<span class="ident" id="1881924">args</span>&nbsp;<span class="keyword" id="1881929">struct</span>&nbsp;<span class="op" id="1881936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1881940">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1881948">*</span><span class="ident" id="1881949"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179426">funcval</a></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1881959">arg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1881967"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1881973">.</span><span class="ident" id="1881974">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1881984">argsize</span>&nbsp;<span class="builtintype" id="1881992">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1882001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1882004">var</span>&nbsp;<span class="ident" id="1882008">cb</span>&nbsp;<span class="op" id="1882011">*</span><span class="ident" id="1882012"><a href="/runtime/cgocall.go.html#1881924">args</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1882019">//&nbsp;Location&nbsp;of&nbsp;callback&nbsp;arguments&nbsp;depends&nbsp;on&nbsp;stack&nbsp;frame&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1882084">//&nbsp;and&nbsp;size&nbsp;of&nbsp;stack&nbsp;frame&nbsp;of&nbsp;cgocallback_gofunc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1882135">sp</span>&nbsp;<span class="op" id="1882138">:=</span>&nbsp;<span class="ident" id="1882141"><a href="/runtime/cgocall.go.html#1881680">gp</a></span><span class="op" id="1882143">.</span><span class="ident" id="1882144">m</span><span class="op" id="1882145">.</span><span class="ident" id="1882146">g0</span><span class="op" id="1882148">.</span><span class="ident" id="1882149">sched</span><span class="op" id="1882154">.</span><span class="ident" id="1882155">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1882159">switch</span>&nbsp;<span class="ident" id="1882166"><a href="/runtime/extern.go.html#1926883">GOARCH</a></span>&nbsp;<span class="op" id="1882173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1882176">default</span><span class="op" id="1882183">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1882187"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1882194">(</span><span class="string" id="1882195">&#34;cgocallbackg&nbsp;is&nbsp;unimplemented&nbsp;on&nbsp;arch&#34;</span><span class="op" id="1882234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1882237">case</span>&nbsp;<span class="string" id="1882242">&#34;arm&#34;</span><span class="op" id="1882247">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1882251">//&nbsp;On&nbsp;arm,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;two&nbsp;words&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;saved&nbsp;LR&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1882320">//&nbsp;SP&nbsp;and&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;between&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;the&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1882395"><a href="/runtime/cgocall.go.html#1882008">cb</a></span>&nbsp;<span class="op" id="1882398">=</span>&nbsp;<span class="op" id="1882400">(</span><span class="op" id="1882401">*</span><span class="ident" id="1882402"><a href="/runtime/cgocall.go.html#1881924">args</a></span><span class="op" id="1882406">)</span><span class="op" id="1882407">(</span><span class="ident" id="1882408"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1882414">.</span><span class="ident" id="1882415">Pointer</span><span class="op" id="1882422">(</span><span class="ident" id="1882423"><a href="/runtime/cgocall.go.html#1882135">sp</a></span>&nbsp;<span class="op" id="1882426">+</span>&nbsp;<span class="num" id="1882428">4</span><span class="op" id="1882429">*</span><span class="ident" id="1882430"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span><span class="op" id="1882437">)</span><span class="op" id="1882438">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1882441">case</span>&nbsp;<span class="string" id="1882446">&#34;amd64&#34;</span><span class="op" id="1882453">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1882457">//&nbsp;On&nbsp;amd64,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;one&nbsp;word,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1882513"><a href="/runtime/cgocall.go.html#1882008">cb</a></span>&nbsp;<span class="op" id="1882516">=</span>&nbsp;<span class="op" id="1882518">(</span><span class="op" id="1882519">*</span><span class="ident" id="1882520"><a href="/runtime/cgocall.go.html#1881924">args</a></span><span class="op" id="1882524">)</span><span class="op" id="1882525">(</span><span class="ident" id="1882526"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1882532">.</span><span class="ident" id="1882533">Pointer</span><span class="op" id="1882540">(</span><span class="ident" id="1882541"><a href="/runtime/cgocall.go.html#1882135">sp</a></span>&nbsp;<span class="op" id="1882544">+</span>&nbsp;<span class="num" id="1882546">2</span><span class="op" id="1882547">*</span><span class="ident" id="1882548"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span><span class="op" id="1882555">)</span><span class="op" id="1882556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1882559">case</span>&nbsp;<span class="string" id="1882564">&#34;386&#34;</span><span class="op" id="1882569">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1882573">//&nbsp;On&nbsp;386,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;three&nbsp;words,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1882630"><a href="/runtime/cgocall.go.html#1882008">cb</a></span>&nbsp;<span class="op" id="1882633">=</span>&nbsp;<span class="op" id="1882635">(</span><span class="op" id="1882636">*</span><span class="ident" id="1882637"><a href="/runtime/cgocall.go.html#1881924">args</a></span><span class="op" id="1882641">)</span><span class="op" id="1882642">(</span><span class="ident" id="1882643"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1882649">.</span><span class="ident" id="1882650">Pointer</span><span class="op" id="1882657">(</span><span class="ident" id="1882658"><a href="/runtime/cgocall.go.html#1882135">sp</a></span>&nbsp;<span class="op" id="1882661">+</span>&nbsp;<span class="num" id="1882663">4</span><span class="op" id="1882664">*</span><span class="ident" id="1882665"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span><span class="op" id="1882672">)</span><span class="op" id="1882673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1882676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1882680">//&nbsp;Invoke&nbsp;callback.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1882701"><a href="/runtime/stubs.go.html#2137463">reflectcall</a></span><span class="op" id="1882712">(</span><span class="ident" id="1882713"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1882719">.</span><span class="ident" id="1882720">Pointer</span><span class="op" id="1882727">(</span><span class="ident" id="1882728"><a href="/runtime/cgocall.go.html#1882008">cb</a></span><span class="op" id="1882730">.</span><span class="ident" id="1882731">fn</span><span class="op" id="1882733">)</span><span class="op" id="1882734">,</span>&nbsp;<span class="ident" id="1882736"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1882742">.</span><span class="ident" id="1882743">Pointer</span><span class="op" id="1882750">(</span><span class="ident" id="1882751"><a href="/runtime/cgocall.go.html#1882008">cb</a></span><span class="op" id="1882753">.</span><span class="ident" id="1882754">arg</span><span class="op" id="1882757">)</span><span class="op" id="1882758">,</span>&nbsp;<span class="builtintype" id="1882760">uint32</span><span class="op" id="1882766">(</span><span class="ident" id="1882767"><a href="/runtime/cgocall.go.html#1882008">cb</a></span><span class="op" id="1882769">.</span><span class="ident" id="1882770">argsize</span><span class="op" id="1882777">)</span><span class="op" id="1882778">,</span>&nbsp;<span class="num" id="1882780">0</span><span class="op" id="1882781">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1882785">if</span>&nbsp;<span class="ident" id="1882788"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="1882800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1882804"><a href="/runtime/race0.go.html#2070966">racereleasemerge</a></span><span class="op" id="1882820">(</span><span class="ident" id="1882821"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1882827">.</span><span class="ident" id="1882828">Pointer</span><span class="op" id="1882835">(</span><span class="op" id="1882836">&amp;</span><span class="ident" id="1882837"><a href="/runtime/cgocall.go.html#1883564">racecgosync</a></span><span class="op" id="1882848">)</span><span class="op" id="1882849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1882852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1882856">//&nbsp;Do&nbsp;not&nbsp;unwind&nbsp;m-&gt;g0-&gt;sched.sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1882891">//&nbsp;Our&nbsp;caller,&nbsp;cgocallback,&nbsp;will&nbsp;do&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1882934"><a href="/runtime/cgocall.go.html#1881810">restore</a></span>&nbsp;<span class="op" id="1882942">=</span>&nbsp;<span class="builtintype" id="1882944">false</span><br>
<span class="lineno"></span><span class="op" id="1882950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="1882953">func</span>&nbsp;<span class="ident" id="1882958">unwindm</span><span class="op" id="1882965">(</span><span class="ident" id="1882966">restore</span>&nbsp;<span class="op" id="1882974">*</span><span class="builtintype" id="1882975">bool</span><span class="op" id="1882979">)</span>&nbsp;<span class="op" id="1882981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1882984">if</span>&nbsp;<span class="op" id="1882987">!</span><span class="op" id="1882988">*</span><span class="ident" id="1882989"><a href="/runtime/cgocall.go.html#1882966">restore</a></span>&nbsp;<span class="op" id="1882997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1883001">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1883009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1883012">//&nbsp;Restore&nbsp;sp&nbsp;saved&nbsp;by&nbsp;cgocallback&nbsp;during</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1883055">//&nbsp;unwind&nbsp;of&nbsp;g&#39;s&nbsp;stack&nbsp;(see&nbsp;comment&nbsp;at&nbsp;top&nbsp;of&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1883109">mp</span>&nbsp;<span class="op" id="1883112">:=</span>&nbsp;<span class="ident" id="1883115"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="1883123">(</span><span class="op" id="1883124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1883127">sched</span>&nbsp;<span class="op" id="1883133">:=</span>&nbsp;<span class="op" id="1883136">&amp;</span><span class="ident" id="1883137"><a href="/runtime/cgocall.go.html#1883109">mp</a></span><span class="op" id="1883139">.</span><span class="ident" id="1883140">g0</span><span class="op" id="1883142">.</span><span class="ident" id="1883143">sched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1883150">switch</span>&nbsp;<span class="ident" id="1883157"><a href="/runtime/extern.go.html#1926883">GOARCH</a></span>&nbsp;<span class="op" id="1883164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1883167">default</span><span class="op" id="1883174">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1883178"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1883185">(</span><span class="string" id="1883186">&#34;unwindm&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1883211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1883214">case</span>&nbsp;<span class="string" id="1883219">&#34;386&#34;</span><span class="op" id="1883224">,</span>&nbsp;<span class="string" id="1883226">&#34;amd64&#34;</span><span class="op" id="1883233">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1883237"><a href="/runtime/cgocall.go.html#1883127">sched</a></span><span class="op" id="1883242">.</span><span class="ident" id="1883243">sp</span>&nbsp;<span class="op" id="1883246">=</span>&nbsp;<span class="op" id="1883248">*</span><span class="op" id="1883249">(</span><span class="op" id="1883250">*</span><span class="builtintype" id="1883251">uintptr</span><span class="op" id="1883258">)</span><span class="op" id="1883259">(</span><span class="ident" id="1883260"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1883266">.</span><span class="ident" id="1883267">Pointer</span><span class="op" id="1883274">(</span><span class="ident" id="1883275"><a href="/runtime/cgocall.go.html#1883127">sched</a></span><span class="op" id="1883280">.</span><span class="ident" id="1883281">sp</span><span class="op" id="1883283">)</span><span class="op" id="1883284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1883287">case</span>&nbsp;<span class="string" id="1883292">&#34;arm&#34;</span><span class="op" id="1883297">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1883301"><a href="/runtime/cgocall.go.html#1883127">sched</a></span><span class="op" id="1883306">.</span><span class="ident" id="1883307">sp</span>&nbsp;<span class="op" id="1883310">=</span>&nbsp;<span class="op" id="1883312">*</span><span class="op" id="1883313">(</span><span class="op" id="1883314">*</span><span class="builtintype" id="1883315">uintptr</span><span class="op" id="1883322">)</span><span class="op" id="1883323">(</span><span class="ident" id="1883324"><a href="/runtime/cgocall.go.html#1879013">unsafe</a></span><span class="op" id="1883330">.</span><span class="ident" id="1883331">Pointer</span><span class="op" id="1883338">(</span><span class="ident" id="1883339"><a href="/runtime/cgocall.go.html#1883127">sched</a></span><span class="op" id="1883344">.</span><span class="ident" id="1883345">sp</span>&nbsp;<span class="op" id="1883348">+</span>&nbsp;<span class="num" id="1883350">4</span><span class="op" id="1883351">)</span><span class="op" id="1883352">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1883355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1883358"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="1883366">(</span><span class="ident" id="1883367"><a href="/runtime/cgocall.go.html#1883109">mp</a></span><span class="op" id="1883369">)</span><br>
<span class="lineno"></span><span class="op" id="1883371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1883374">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno">270</span><span class="keyword" id="1883398">func</span>&nbsp;<span class="ident" id="1883403">badcgocallback</span><span class="op" id="1883417">(</span><span class="op" id="1883418">)</span>&nbsp;<span class="op" id="1883420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1883423"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1883430">(</span><span class="string" id="1883431">&#34;misaligned&nbsp;stack&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1883464">)</span><br>
<span class="lineno"></span><span class="op" id="1883466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1883469">//&nbsp;called&nbsp;from&nbsp;(incomplete)&nbsp;assembly</span><br>
<span class="lineno">275</span><span class="keyword" id="1883506">func</span>&nbsp;<span class="ident" id="1883511">cgounimpl</span><span class="op" id="1883520">(</span><span class="op" id="1883521">)</span>&nbsp;<span class="op" id="1883523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1883526"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="1883533">(</span><span class="string" id="1883534">&#34;cgo&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1883555">)</span><br>
<span class="lineno"></span><span class="op" id="1883557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1883560">var</span>&nbsp;<span class="ident" id="1883564">racecgosync</span>&nbsp;<span class="ident" id="1883576">uint64</span>&nbsp;<span class="comment" id="1883583">//&nbsp;represents&nbsp;possible&nbsp;synchronization&nbsp;in&nbsp;C&nbsp;code</span>
</div>
</body>
</html>
