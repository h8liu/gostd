<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html" class="current">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4496091">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4496146">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4496200">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4496251">package</span>&nbsp;<span class="ident" id="4496259">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4496265">import</span>&nbsp;<span class="op" id="4496272">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4496275">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span><span class="op" id="4496290">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4496293">//&nbsp;CertPool&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;certificates.</span><br>
<span class="lineno"></span><span class="keyword" id="4496331">type</span>&nbsp;<span class="ident" id="4496336">CertPool</span>&nbsp;<span class="keyword" id="4496345">struct</span>&nbsp;<span class="op" id="4496352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496355">bySubjectKeyId</span>&nbsp;<span class="keyword" id="4496370">map</span><span class="op" id="4496373">[</span><span class="builtintype" id="4496374">string</span><span class="op" id="4496380">]</span><span class="op" id="4496381">[</span><span class="op" id="4496382">]</span><span class="builtintype" id="4496383">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496388">byName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496403">map</span><span class="op" id="4496406">[</span><span class="builtintype" id="4496407">string</span><span class="op" id="4496413">]</span><span class="op" id="4496414">[</span><span class="op" id="4496415">]</span><span class="builtintype" id="4496416">int</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4496421">certs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4496436">[</span><span class="op" id="4496437">]</span><span class="op" id="4496438">*</span><span class="ident" id="4496439">Certificate</span><br>
<span class="lineno"></span><span class="op" id="4496451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4496454">//&nbsp;NewCertPool&nbsp;returns&nbsp;a&nbsp;new,&nbsp;empty&nbsp;CertPool.</span><br>
<span class="lineno"></span><span class="keyword" id="4496500">func</span>&nbsp;<span class="ident" id="4496505">NewCertPool</span><span class="op" id="4496516">(</span><span class="op" id="4496517">)</span>&nbsp;<span class="op" id="4496519">*</span><span class="ident" id="4496520">CertPool</span>&nbsp;<span class="op" id="4496529">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496532">return</span>&nbsp;<span class="op" id="4496539">&amp;</span><span class="ident" id="4496540">CertPool</span><span class="op" id="4496548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4496552">make</span><span class="op" id="4496556">(</span><span class="keyword" id="4496557">map</span><span class="op" id="4496560">[</span><span class="builtintype" id="4496561">string</span><span class="op" id="4496567">]</span><span class="op" id="4496568">[</span><span class="op" id="4496569">]</span><span class="builtintype" id="4496570">int</span><span class="op" id="4496573">)</span><span class="op" id="4496574">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4496578">make</span><span class="op" id="4496582">(</span><span class="keyword" id="4496583">map</span><span class="op" id="4496586">[</span><span class="builtintype" id="4496587">string</span><span class="op" id="4496593">]</span><span class="op" id="4496594">[</span><span class="op" id="4496595">]</span><span class="builtintype" id="4496596">int</span><span class="op" id="4496599">)</span><span class="op" id="4496600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4496604">nil</span><span class="op" id="4496607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4496610">}</span><br>
<span class="lineno">25</span><span class="op" id="4496612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4496615">//&nbsp;findVerifiedParents&nbsp;attempts&nbsp;to&nbsp;find&nbsp;certificates&nbsp;in&nbsp;s&nbsp;which&nbsp;have&nbsp;signed&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4496695">//&nbsp;given&nbsp;certificate.&nbsp;If&nbsp;any&nbsp;candidates&nbsp;were&nbsp;rejected&nbsp;then&nbsp;errCert&nbsp;will&nbsp;be&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="4496774">//&nbsp;to&nbsp;one&nbsp;of&nbsp;them,&nbsp;arbitrarily,&nbsp;and&nbsp;err&nbsp;will&nbsp;contain&nbsp;the&nbsp;reason&nbsp;that&nbsp;it&nbsp;was</span><br>
<span class="lineno">30</span><span class="comment" id="4496850">//&nbsp;rejected.</span><br>
<span class="lineno"></span><span class="keyword" id="4496863">func</span>&nbsp;<span class="op" id="4496868">(</span><span class="ident" id="4496869">s</span>&nbsp;<span class="op" id="4496871">*</span><span class="ident" id="4496872">CertPool</span><span class="op" id="4496880">)</span>&nbsp;<span class="ident" id="4496882">findVerifiedParents</span><span class="op" id="4496901">(</span><span class="ident" id="4496902">cert</span>&nbsp;<span class="op" id="4496907">*</span><span class="ident" id="4496908">Certificate</span><span class="op" id="4496919">)</span>&nbsp;<span class="op" id="4496921">(</span><span class="ident" id="4496922">parents</span>&nbsp;<span class="op" id="4496930">[</span><span class="op" id="4496931">]</span><span class="builtintype" id="4496932">int</span><span class="op" id="4496935">,</span>&nbsp;<span class="ident" id="4496937">errCert</span>&nbsp;<span class="op" id="4496945">*</span><span class="ident" id="4496946">Certificate</span><span class="op" id="4496957">,</span>&nbsp;<span class="ident" id="4496959">err</span>&nbsp;<span class="builtintype" id="4496963">error</span><span class="op" id="4496968">)</span>&nbsp;<span class="op" id="4496970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496973">if</span>&nbsp;<span class="ident" id="4496976">s</span>&nbsp;<span class="op" id="4496978">==</span>&nbsp;<span class="builtintype" id="4496981">nil</span>&nbsp;<span class="op" id="4496985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4496989">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4496997">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497000">var</span>&nbsp;<span class="ident" id="4497004">candidates</span>&nbsp;<span class="op" id="4497015">[</span><span class="op" id="4497016">]</span><span class="builtintype" id="4497017">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497023">if</span>&nbsp;<span class="builtinfunc" id="4497026">len</span><span class="op" id="4497029">(</span><span class="ident" id="4497030">cert</span><span class="op" id="4497034">.</span><span class="ident" id="4497035">AuthorityKeyId</span><span class="op" id="4497049">)</span>&nbsp;<span class="op" id="4497051">&gt;</span>&nbsp;<span class="num" id="4497053">0</span>&nbsp;<span class="op" id="4497055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497059">candidates</span>&nbsp;<span class="op" id="4497070">=</span>&nbsp;<span class="ident" id="4497072">s</span><span class="op" id="4497073">.</span><span class="ident" id="4497074">bySubjectKeyId</span><span class="op" id="4497088">[</span><span class="builtintype" id="4497089">string</span><span class="op" id="4497095">(</span><span class="ident" id="4497096">cert</span><span class="op" id="4497100">.</span><span class="ident" id="4497101">AuthorityKeyId</span><span class="op" id="4497115">)</span><span class="op" id="4497116">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497119">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497122">if</span>&nbsp;<span class="builtinfunc" id="4497125">len</span><span class="op" id="4497128">(</span><span class="ident" id="4497129">candidates</span><span class="op" id="4497139">)</span>&nbsp;<span class="op" id="4497141">==</span>&nbsp;<span class="num" id="4497144">0</span>&nbsp;<span class="op" id="4497146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497150">candidates</span>&nbsp;<span class="op" id="4497161">=</span>&nbsp;<span class="ident" id="4497163">s</span><span class="op" id="4497164">.</span><span class="ident" id="4497165">byName</span><span class="op" id="4497171">[</span><span class="builtintype" id="4497172">string</span><span class="op" id="4497178">(</span><span class="ident" id="4497179">cert</span><span class="op" id="4497183">.</span><span class="ident" id="4497184">RawIssuer</span><span class="op" id="4497193">)</span><span class="op" id="4497194">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497201">for</span>&nbsp;<span class="ident" id="4497205">_</span><span class="op" id="4497206">,</span>&nbsp;<span class="ident" id="4497208">c</span>&nbsp;<span class="op" id="4497210">:=</span>&nbsp;<span class="keyword" id="4497213">range</span>&nbsp;<span class="ident" id="4497219">candidates</span>&nbsp;<span class="op" id="4497230">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497234">if</span>&nbsp;<span class="ident" id="4497237">err</span>&nbsp;<span class="op" id="4497241">=</span>&nbsp;<span class="ident" id="4497243">cert</span><span class="op" id="4497247">.</span><span class="ident" id="4497248">CheckSignatureFrom</span><span class="op" id="4497266">(</span><span class="ident" id="4497267">s</span><span class="op" id="4497268">.</span><span class="ident" id="4497269">certs</span><span class="op" id="4497274">[</span><span class="ident" id="4497275">c</span><span class="op" id="4497276">]</span><span class="op" id="4497277">)</span><span class="op" id="4497278">;</span>&nbsp;<span class="ident" id="4497280">err</span>&nbsp;<span class="op" id="4497284">==</span>&nbsp;<span class="builtintype" id="4497287">nil</span>&nbsp;<span class="op" id="4497291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497296">parents</span>&nbsp;<span class="op" id="4497304">=</span>&nbsp;<span class="builtinfunc" id="4497306">append</span><span class="op" id="4497312">(</span><span class="ident" id="4497313">parents</span><span class="op" id="4497320">,</span>&nbsp;<span class="ident" id="4497322">c</span><span class="op" id="4497323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497327">}</span>&nbsp;<span class="keyword" id="4497329">else</span>&nbsp;<span class="op" id="4497334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497339">errCert</span>&nbsp;<span class="op" id="4497347">=</span>&nbsp;<span class="ident" id="4497349">s</span><span class="op" id="4497350">.</span><span class="ident" id="4497351">certs</span><span class="op" id="4497356">[</span><span class="ident" id="4497357">c</span><span class="op" id="4497358">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497362">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497369">return</span><br>
<span class="lineno"></span><span class="op" id="4497376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="4497379">//&nbsp;AddCert&nbsp;adds&nbsp;a&nbsp;certificate&nbsp;to&nbsp;a&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="4497420">func</span>&nbsp;<span class="op" id="4497425">(</span><span class="ident" id="4497426">s</span>&nbsp;<span class="op" id="4497428">*</span><span class="ident" id="4497429">CertPool</span><span class="op" id="4497437">)</span>&nbsp;<span class="ident" id="4497439">AddCert</span><span class="op" id="4497446">(</span><span class="ident" id="4497447">cert</span>&nbsp;<span class="op" id="4497452">*</span><span class="ident" id="4497453">Certificate</span><span class="op" id="4497464">)</span>&nbsp;<span class="op" id="4497466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497469">if</span>&nbsp;<span class="ident" id="4497472">cert</span>&nbsp;<span class="op" id="4497477">==</span>&nbsp;<span class="builtintype" id="4497480">nil</span>&nbsp;<span class="op" id="4497484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4497488">panic</span><span class="op" id="4497493">(</span><span class="string" id="4497494">&#34;adding&nbsp;nil&nbsp;Certificate&nbsp;to&nbsp;CertPool&#34;</span><span class="op" id="4497530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497533">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4497537">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;certificate&nbsp;isn&#39;t&nbsp;being&nbsp;added&nbsp;twice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497593">for</span>&nbsp;<span class="ident" id="4497597">_</span><span class="op" id="4497598">,</span>&nbsp;<span class="ident" id="4497600">c</span>&nbsp;<span class="op" id="4497602">:=</span>&nbsp;<span class="keyword" id="4497605">range</span>&nbsp;<span class="ident" id="4497611">s</span><span class="op" id="4497612">.</span><span class="ident" id="4497613">certs</span>&nbsp;<span class="op" id="4497619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497623">if</span>&nbsp;<span class="ident" id="4497626">c</span><span class="op" id="4497627">.</span><span class="ident" id="4497628">Equal</span><span class="op" id="4497633">(</span><span class="ident" id="4497634">cert</span><span class="op" id="4497638">)</span>&nbsp;<span class="op" id="4497640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497645">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497661">n</span>&nbsp;<span class="op" id="4497663">:=</span>&nbsp;<span class="builtinfunc" id="4497666">len</span><span class="op" id="4497669">(</span><span class="ident" id="4497670">s</span><span class="op" id="4497671">.</span><span class="ident" id="4497672">certs</span><span class="op" id="4497677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497680">s</span><span class="op" id="4497681">.</span><span class="ident" id="4497682">certs</span>&nbsp;<span class="op" id="4497688">=</span>&nbsp;<span class="builtinfunc" id="4497690">append</span><span class="op" id="4497696">(</span><span class="ident" id="4497697">s</span><span class="op" id="4497698">.</span><span class="ident" id="4497699">certs</span><span class="op" id="4497704">,</span>&nbsp;<span class="ident" id="4497706">cert</span><span class="op" id="4497710">)</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4497714">if</span>&nbsp;<span class="builtinfunc" id="4497717">len</span><span class="op" id="4497720">(</span><span class="ident" id="4497721">cert</span><span class="op" id="4497725">.</span><span class="ident" id="4497726">SubjectKeyId</span><span class="op" id="4497738">)</span>&nbsp;<span class="op" id="4497740">&gt;</span>&nbsp;<span class="num" id="4497742">0</span>&nbsp;<span class="op" id="4497744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497748">keyId</span>&nbsp;<span class="op" id="4497754">:=</span>&nbsp;<span class="builtintype" id="4497757">string</span><span class="op" id="4497763">(</span><span class="ident" id="4497764">cert</span><span class="op" id="4497768">.</span><span class="ident" id="4497769">SubjectKeyId</span><span class="op" id="4497781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497785">s</span><span class="op" id="4497786">.</span><span class="ident" id="4497787">bySubjectKeyId</span><span class="op" id="4497801">[</span><span class="ident" id="4497802">keyId</span><span class="op" id="4497807">]</span>&nbsp;<span class="op" id="4497809">=</span>&nbsp;<span class="builtinfunc" id="4497811">append</span><span class="op" id="4497817">(</span><span class="ident" id="4497818">s</span><span class="op" id="4497819">.</span><span class="ident" id="4497820">bySubjectKeyId</span><span class="op" id="4497834">[</span><span class="ident" id="4497835">keyId</span><span class="op" id="4497840">]</span><span class="op" id="4497841">,</span>&nbsp;<span class="ident" id="4497843">n</span><span class="op" id="4497844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4497847">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497850">name</span>&nbsp;<span class="op" id="4497855">:=</span>&nbsp;<span class="builtintype" id="4497858">string</span><span class="op" id="4497864">(</span><span class="ident" id="4497865">cert</span><span class="op" id="4497869">.</span><span class="ident" id="4497870">RawSubject</span><span class="op" id="4497880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4497883">s</span><span class="op" id="4497884">.</span><span class="ident" id="4497885">byName</span><span class="op" id="4497891">[</span><span class="ident" id="4497892">name</span><span class="op" id="4497896">]</span>&nbsp;<span class="op" id="4497898">=</span>&nbsp;<span class="builtinfunc" id="4497900">append</span><span class="op" id="4497906">(</span><span class="ident" id="4497907">s</span><span class="op" id="4497908">.</span><span class="ident" id="4497909">byName</span><span class="op" id="4497915">[</span><span class="ident" id="4497916">name</span><span class="op" id="4497920">]</span><span class="op" id="4497921">,</span>&nbsp;<span class="ident" id="4497923">n</span><span class="op" id="4497924">)</span><br>
<span class="lineno"></span><span class="op" id="4497926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4497929">//&nbsp;AppendCertsFromPEM&nbsp;attempts&nbsp;to&nbsp;parse&nbsp;a&nbsp;series&nbsp;of&nbsp;PEM&nbsp;encoded&nbsp;certificates.</span><br>
<span class="lineno">80</span><span class="comment" id="4498007">//&nbsp;It&nbsp;appends&nbsp;any&nbsp;certificates&nbsp;found&nbsp;to&nbsp;s&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;certificates</span><br>
<span class="lineno"></span><span class="comment" id="4498086">//&nbsp;were&nbsp;successfully&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="4498115">//</span><br>
<span class="lineno"></span><span class="comment" id="4498118">//&nbsp;On&nbsp;many&nbsp;Linux&nbsp;systems,&nbsp;/etc/ssl/cert.pem&nbsp;will&nbsp;contain&nbsp;the&nbsp;system&nbsp;wide&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="4498195">//&nbsp;of&nbsp;root&nbsp;CAs&nbsp;in&nbsp;a&nbsp;format&nbsp;suitable&nbsp;for&nbsp;this&nbsp;function.</span><br>
<span class="lineno">85</span><span class="keyword" id="4498250">func</span>&nbsp;<span class="op" id="4498255">(</span><span class="ident" id="4498256">s</span>&nbsp;<span class="op" id="4498258">*</span><span class="ident" id="4498259">CertPool</span><span class="op" id="4498267">)</span>&nbsp;<span class="ident" id="4498269">AppendCertsFromPEM</span><span class="op" id="4498287">(</span><span class="ident" id="4498288">pemCerts</span>&nbsp;<span class="op" id="4498297">[</span><span class="op" id="4498298">]</span><span class="builtintype" id="4498299">byte</span><span class="op" id="4498303">)</span>&nbsp;<span class="op" id="4498305">(</span><span class="ident" id="4498306">ok</span>&nbsp;<span class="builtintype" id="4498309">bool</span><span class="op" id="4498313">)</span>&nbsp;<span class="op" id="4498315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498318">for</span>&nbsp;<span class="builtinfunc" id="4498322">len</span><span class="op" id="4498325">(</span><span class="ident" id="4498326">pemCerts</span><span class="op" id="4498334">)</span>&nbsp;<span class="op" id="4498336">&gt;</span>&nbsp;<span class="num" id="4498338">0</span>&nbsp;<span class="op" id="4498340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498344">var</span>&nbsp;<span class="ident" id="4498348">block</span>&nbsp;<span class="op" id="4498354">*</span><span class="ident" id="4498355">pem</span><span class="op" id="4498358">.</span><span class="ident" id="4498359">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4498367">block</span><span class="op" id="4498372">,</span>&nbsp;<span class="ident" id="4498374">pemCerts</span>&nbsp;<span class="op" id="4498383">=</span>&nbsp;<span class="ident" id="4498385">pem</span><span class="op" id="4498388">.</span><span class="ident" id="4498389">Decode</span><span class="op" id="4498395">(</span><span class="ident" id="4498396">pemCerts</span><span class="op" id="4498404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498408">if</span>&nbsp;<span class="ident" id="4498411">block</span>&nbsp;<span class="op" id="4498417">==</span>&nbsp;<span class="builtintype" id="4498420">nil</span>&nbsp;<span class="op" id="4498424">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498429">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4498437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498441">if</span>&nbsp;<span class="ident" id="4498444">block</span><span class="op" id="4498449">.</span><span class="ident" id="4498450">Type</span>&nbsp;<span class="op" id="4498455">!=</span>&nbsp;<span class="string" id="4498458">&#34;CERTIFICATE&#34;</span>&nbsp;<span class="op" id="4498472">||</span>&nbsp;<span class="builtinfunc" id="4498475">len</span><span class="op" id="4498478">(</span><span class="ident" id="4498479">block</span><span class="op" id="4498484">.</span><span class="ident" id="4498485">Headers</span><span class="op" id="4498492">)</span>&nbsp;<span class="op" id="4498494">!=</span>&nbsp;<span class="num" id="4498497">0</span>&nbsp;<span class="op" id="4498499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498504">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4498515">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4498520">cert</span><span class="op" id="4498524">,</span>&nbsp;<span class="ident" id="4498526">err</span>&nbsp;<span class="op" id="4498530">:=</span>&nbsp;<span class="ident" id="4498533">ParseCertificate</span><span class="op" id="4498549">(</span><span class="ident" id="4498550">block</span><span class="op" id="4498555">.</span><span class="ident" id="4498556">Bytes</span><span class="op" id="4498561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498565">if</span>&nbsp;<span class="ident" id="4498568">err</span>&nbsp;<span class="op" id="4498572">!=</span>&nbsp;<span class="builtintype" id="4498575">nil</span>&nbsp;<span class="op" id="4498579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498584">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4498595">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4498600">s</span><span class="op" id="4498601">.</span><span class="ident" id="4498602">AddCert</span><span class="op" id="4498609">(</span><span class="ident" id="4498610">cert</span><span class="op" id="4498614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4498618">ok</span>&nbsp;<span class="op" id="4498621">=</span>&nbsp;<span class="builtintype" id="4498623">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4498629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498633">return</span><br>
<span class="lineno"></span><span class="op" id="4498640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4498643">//&nbsp;Subjects&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;the&nbsp;DER-encoded&nbsp;subjects&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4498701">//&nbsp;all&nbsp;of&nbsp;the&nbsp;certificates&nbsp;in&nbsp;the&nbsp;pool.</span><br>
<span class="lineno">110</span><span class="keyword" id="4498741">func</span>&nbsp;<span class="op" id="4498746">(</span><span class="ident" id="4498747">s</span>&nbsp;<span class="op" id="4498749">*</span><span class="ident" id="4498750">CertPool</span><span class="op" id="4498758">)</span>&nbsp;<span class="ident" id="4498760">Subjects</span><span class="op" id="4498768">(</span><span class="op" id="4498769">)</span>&nbsp;<span class="op" id="4498771">(</span><span class="ident" id="4498772">res</span>&nbsp;<span class="op" id="4498776">[</span><span class="op" id="4498777">]</span><span class="op" id="4498778">[</span><span class="op" id="4498779">]</span><span class="builtintype" id="4498780">byte</span><span class="op" id="4498784">)</span>&nbsp;<span class="op" id="4498786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4498789">res</span>&nbsp;<span class="op" id="4498793">=</span>&nbsp;<span class="builtinfunc" id="4498795">make</span><span class="op" id="4498799">(</span><span class="op" id="4498800">[</span><span class="op" id="4498801">]</span><span class="op" id="4498802">[</span><span class="op" id="4498803">]</span><span class="builtintype" id="4498804">byte</span><span class="op" id="4498808">,</span>&nbsp;<span class="builtinfunc" id="4498810">len</span><span class="op" id="4498813">(</span><span class="ident" id="4498814">s</span><span class="op" id="4498815">.</span><span class="ident" id="4498816">certs</span><span class="op" id="4498821">)</span><span class="op" id="4498822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498825">for</span>&nbsp;<span class="ident" id="4498829">i</span><span class="op" id="4498830">,</span>&nbsp;<span class="ident" id="4498832">c</span>&nbsp;<span class="op" id="4498834">:=</span>&nbsp;<span class="keyword" id="4498837">range</span>&nbsp;<span class="ident" id="4498843">s</span><span class="op" id="4498844">.</span><span class="ident" id="4498845">certs</span>&nbsp;<span class="op" id="4498851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4498855">res</span><span class="op" id="4498858">[</span><span class="ident" id="4498859">i</span><span class="op" id="4498860">]</span>&nbsp;<span class="op" id="4498862">=</span>&nbsp;<span class="ident" id="4498864">c</span><span class="op" id="4498865">.</span><span class="ident" id="4498866">RawSubject</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4498878">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4498881">return</span><br>
<span class="lineno"></span><span class="op" id="4498888">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
