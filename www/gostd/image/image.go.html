<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5395319">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5395374">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5395428">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5395479">//&nbsp;Package&nbsp;image&nbsp;implements&nbsp;a&nbsp;basic&nbsp;2-D&nbsp;image&nbsp;library.</span><br>
<span class="lineno"></span><span class="comment" id="5395534">//</span><br>
<span class="lineno"></span><span class="comment" id="5395537">//&nbsp;The&nbsp;fundamental&nbsp;interface&nbsp;is&nbsp;called&nbsp;Image.&nbsp;An&nbsp;Image&nbsp;contains&nbsp;colors,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="5395615">//&nbsp;are&nbsp;described&nbsp;in&nbsp;the&nbsp;image/color&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="5395660">//</span><br>
<span class="lineno">10</span><span class="comment" id="5395663">//&nbsp;Values&nbsp;of&nbsp;the&nbsp;Image&nbsp;interface&nbsp;are&nbsp;created&nbsp;either&nbsp;by&nbsp;calling&nbsp;functions&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="5395741">//&nbsp;as&nbsp;NewRGBA&nbsp;and&nbsp;NewPaletted,&nbsp;or&nbsp;by&nbsp;calling&nbsp;Decode&nbsp;on&nbsp;an&nbsp;io.Reader&nbsp;containing</span><br>
<span class="lineno"></span><span class="comment" id="5395820">//&nbsp;image&nbsp;data&nbsp;in&nbsp;a&nbsp;format&nbsp;such&nbsp;as&nbsp;GIF,&nbsp;JPEG&nbsp;or&nbsp;PNG.&nbsp;Decoding&nbsp;any&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="5395896">//&nbsp;image&nbsp;format&nbsp;requires&nbsp;the&nbsp;prior&nbsp;registration&nbsp;of&nbsp;a&nbsp;decoder&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5395967">//&nbsp;Registration&nbsp;is&nbsp;typically&nbsp;automatic&nbsp;as&nbsp;a&nbsp;side&nbsp;effect&nbsp;of&nbsp;initializing&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="5396044">//&nbsp;format&#39;s&nbsp;package&nbsp;so&nbsp;that,&nbsp;to&nbsp;decode&nbsp;a&nbsp;PNG&nbsp;image,&nbsp;it&nbsp;suffices&nbsp;to&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="5396116">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;image/png&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5396140">//&nbsp;in&nbsp;a&nbsp;program&#39;s&nbsp;main&nbsp;package.&nbsp;The&nbsp;_&nbsp;means&nbsp;to&nbsp;import&nbsp;a&nbsp;package&nbsp;purely&nbsp;for&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5396219">//&nbsp;initialization&nbsp;side&nbsp;effects.</span><br>
<span class="lineno"></span><span class="comment" id="5396251">//</span><br>
<span class="lineno">20</span><span class="comment" id="5396254">//&nbsp;See&nbsp;&#34;The&nbsp;Go&nbsp;image&nbsp;package&#34;&nbsp;for&nbsp;more&nbsp;details:</span><br>
<span class="lineno"></span><span class="comment" id="5396302">//&nbsp;http://golang.org/doc/articles/image_package.html</span><br>
<span class="lineno"></span><span class="keyword" id="5396355">package</span>&nbsp;<span class="ident" id="5396363">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5396370">import</span>&nbsp;<span class="op" id="5396377">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5396380">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="5396394">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5396397">//&nbsp;Config&nbsp;holds&nbsp;an&nbsp;image&#39;s&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions.</span><br>
<span class="lineno"></span><span class="keyword" id="5396452">type</span>&nbsp;<span class="ident" id="5396457">Config</span>&nbsp;<span class="keyword" id="5396464">struct</span>&nbsp;<span class="op" id="5396471">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396474">ColorModel</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5396488">color</span><span class="op" id="5396493">.</span><span class="ident" id="5396494">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396501">Width</span><span class="op" id="5396506">,</span>&nbsp;<span class="ident" id="5396508">Height</span>&nbsp;<span class="builtintype" id="5396515">int</span><br>
<span class="lineno"></span><span class="op" id="5396519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5396522">//&nbsp;Image&nbsp;is&nbsp;a&nbsp;finite&nbsp;rectangular&nbsp;grid&nbsp;of&nbsp;color.Color&nbsp;values&nbsp;taken&nbsp;from&nbsp;a&nbsp;color</span><br>
<span class="lineno">35</span><span class="comment" id="5396601">//&nbsp;model.</span><br>
<span class="lineno"></span><span class="keyword" id="5396611">type</span>&nbsp;<span class="ident" id="5396616">Image</span>&nbsp;<span class="keyword" id="5396622">interface</span>&nbsp;<span class="op" id="5396632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5396635">//&nbsp;ColorModel&nbsp;returns&nbsp;the&nbsp;Image&#39;s&nbsp;color&nbsp;model.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396683">ColorModel</span><span class="op" id="5396693">(</span><span class="op" id="5396694">)</span>&nbsp;<span class="ident" id="5396696">color</span><span class="op" id="5396701">.</span><span class="ident" id="5396702">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5396709">//&nbsp;Bounds&nbsp;returns&nbsp;the&nbsp;domain&nbsp;for&nbsp;which&nbsp;At&nbsp;can&nbsp;return&nbsp;non-zero&nbsp;color.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5396779">//&nbsp;The&nbsp;bounds&nbsp;do&nbsp;not&nbsp;necessarily&nbsp;contain&nbsp;the&nbsp;point&nbsp;(0,&nbsp;0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396839">Bounds</span><span class="op" id="5396845">(</span><span class="op" id="5396846">)</span>&nbsp;<span class="ident" id="5396848">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5396859">//&nbsp;At&nbsp;returns&nbsp;the&nbsp;color&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5396908">//&nbsp;At(Bounds().Min.X,&nbsp;Bounds().Min.Y)&nbsp;returns&nbsp;the&nbsp;upper-left&nbsp;pixel&nbsp;of&nbsp;the&nbsp;grid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5396989">//&nbsp;At(Bounds().Max.X-1,&nbsp;Bounds().Max.Y-1)&nbsp;returns&nbsp;the&nbsp;lower-right&nbsp;one.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397061">At</span><span class="op" id="5397063">(</span><span class="ident" id="5397064">x</span><span class="op" id="5397065">,</span>&nbsp;<span class="ident" id="5397067">y</span>&nbsp;<span class="builtintype" id="5397069">int</span><span class="op" id="5397072">)</span>&nbsp;<span class="ident" id="5397074">color</span><span class="op" id="5397079">.</span><span class="ident" id="5397080">Color</span><br>
<span class="lineno"></span><span class="op" id="5397086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5397089">//&nbsp;PalettedImage&nbsp;is&nbsp;an&nbsp;image&nbsp;whose&nbsp;colors&nbsp;may&nbsp;come&nbsp;from&nbsp;a&nbsp;limited&nbsp;palette.</span><br>
<span class="lineno"></span><span class="comment" id="5397164">//&nbsp;If&nbsp;m&nbsp;is&nbsp;a&nbsp;PalettedImage&nbsp;and&nbsp;m.ColorModel()&nbsp;returns&nbsp;a&nbsp;PalettedColorModel&nbsp;p,</span><br>
<span class="lineno">50</span><span class="comment" id="5397242">//&nbsp;then&nbsp;m.At(x,&nbsp;y)&nbsp;should&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;p[m.ColorIndexAt(x,&nbsp;y)].&nbsp;If&nbsp;m&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5397317">//&nbsp;color&nbsp;model&nbsp;is&nbsp;not&nbsp;a&nbsp;PalettedColorModel,&nbsp;then&nbsp;ColorIndexAt&#39;s&nbsp;behavior&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5397393">//&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="keyword" id="5397407">type</span>&nbsp;<span class="ident" id="5397412">PalettedImage</span>&nbsp;<span class="keyword" id="5397426">interface</span>&nbsp;<span class="op" id="5397436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397439">//&nbsp;ColorIndexAt&nbsp;returns&nbsp;the&nbsp;palette&nbsp;index&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397506">ColorIndexAt</span><span class="op" id="5397518">(</span><span class="ident" id="5397519">x</span><span class="op" id="5397520">,</span>&nbsp;<span class="ident" id="5397522">y</span>&nbsp;<span class="builtintype" id="5397524">int</span><span class="op" id="5397527">)</span>&nbsp;<span class="builtintype" id="5397529">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397536">Image</span><br>
<span class="lineno"></span><span class="op" id="5397542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5397545">//&nbsp;RGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA&nbsp;values.</span><br>
<span class="lineno">60</span><span class="keyword" id="5397618">type</span>&nbsp;<span class="ident" id="5397623">RGBA</span>&nbsp;<span class="keyword" id="5397628">struct</span>&nbsp;<span class="op" id="5397635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397638">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397706">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397774">Pix</span>&nbsp;<span class="op" id="5397778">[</span><span class="op" id="5397779">]</span><span class="builtintype" id="5397780">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397787">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397863">Stride</span>&nbsp;<span class="builtintype" id="5397870">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397875">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397907">Rect</span>&nbsp;<span class="ident" id="5397912">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5397922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="5397925">func</span>&nbsp;<span class="op" id="5397930">(</span><span class="ident" id="5397931">p</span>&nbsp;<span class="op" id="5397933">*</span><span class="ident" id="5397934">RGBA</span><span class="op" id="5397938">)</span>&nbsp;<span class="ident" id="5397940">ColorModel</span><span class="op" id="5397950">(</span><span class="op" id="5397951">)</span>&nbsp;<span class="ident" id="5397953">color</span><span class="op" id="5397958">.</span><span class="ident" id="5397959">Model</span>&nbsp;<span class="op" id="5397965">{</span>&nbsp;<span class="keyword" id="5397967">return</span>&nbsp;<span class="ident" id="5397974">color</span><span class="op" id="5397979">.</span><span class="ident" id="5397980">RGBAModel</span>&nbsp;<span class="op" id="5397990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5397993">func</span>&nbsp;<span class="op" id="5397998">(</span><span class="ident" id="5397999">p</span>&nbsp;<span class="op" id="5398001">*</span><span class="ident" id="5398002">RGBA</span><span class="op" id="5398006">)</span>&nbsp;<span class="ident" id="5398008">Bounds</span><span class="op" id="5398014">(</span><span class="op" id="5398015">)</span>&nbsp;<span class="ident" id="5398017">Rectangle</span>&nbsp;<span class="op" id="5398027">{</span>&nbsp;<span class="keyword" id="5398029">return</span>&nbsp;<span class="ident" id="5398036">p</span><span class="op" id="5398037">.</span><span class="ident" id="5398038">Rect</span>&nbsp;<span class="op" id="5398043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5398046">func</span>&nbsp;<span class="op" id="5398051">(</span><span class="ident" id="5398052">p</span>&nbsp;<span class="op" id="5398054">*</span><span class="ident" id="5398055">RGBA</span><span class="op" id="5398059">)</span>&nbsp;<span class="ident" id="5398061">At</span><span class="op" id="5398063">(</span><span class="ident" id="5398064">x</span><span class="op" id="5398065">,</span>&nbsp;<span class="ident" id="5398067">y</span>&nbsp;<span class="builtintype" id="5398069">int</span><span class="op" id="5398072">)</span>&nbsp;<span class="ident" id="5398074">color</span><span class="op" id="5398079">.</span><span class="ident" id="5398080">Color</span>&nbsp;<span class="op" id="5398086">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398089">return</span>&nbsp;<span class="ident" id="5398096">p</span><span class="op" id="5398097">.</span><span class="ident" id="5398098">RGBAAt</span><span class="op" id="5398104">(</span><span class="ident" id="5398105">x</span><span class="op" id="5398106">,</span>&nbsp;<span class="ident" id="5398108">y</span><span class="op" id="5398109">)</span><br>
<span class="lineno"></span><span class="op" id="5398111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5398114">func</span>&nbsp;<span class="op" id="5398119">(</span><span class="ident" id="5398120">p</span>&nbsp;<span class="op" id="5398122">*</span><span class="ident" id="5398123">RGBA</span><span class="op" id="5398127">)</span>&nbsp;<span class="ident" id="5398129">RGBAAt</span><span class="op" id="5398135">(</span><span class="ident" id="5398136">x</span><span class="op" id="5398137">,</span>&nbsp;<span class="ident" id="5398139">y</span>&nbsp;<span class="builtintype" id="5398141">int</span><span class="op" id="5398144">)</span>&nbsp;<span class="ident" id="5398146">color</span><span class="op" id="5398151">.</span><span class="ident" id="5398152">RGBA</span>&nbsp;<span class="op" id="5398157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398160">if</span>&nbsp;<span class="op" id="5398163">!</span><span class="op" id="5398164">(</span><span class="ident" id="5398165">Point</span><span class="op" id="5398170">{</span><span class="ident" id="5398171">x</span><span class="op" id="5398172">,</span>&nbsp;<span class="ident" id="5398174">y</span><span class="op" id="5398175">}</span><span class="op" id="5398176">.</span><span class="ident" id="5398177">In</span><span class="op" id="5398179">(</span><span class="ident" id="5398180">p</span><span class="op" id="5398181">.</span><span class="ident" id="5398182">Rect</span><span class="op" id="5398186">)</span><span class="op" id="5398187">)</span>&nbsp;<span class="op" id="5398189">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398193">return</span>&nbsp;<span class="ident" id="5398200">color</span><span class="op" id="5398205">.</span><span class="ident" id="5398206">RGBA</span><span class="op" id="5398210">{</span><span class="op" id="5398211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398217">i</span>&nbsp;<span class="op" id="5398219">:=</span>&nbsp;<span class="ident" id="5398222">p</span><span class="op" id="5398223">.</span><span class="ident" id="5398224">PixOffset</span><span class="op" id="5398233">(</span><span class="ident" id="5398234">x</span><span class="op" id="5398235">,</span>&nbsp;<span class="ident" id="5398237">y</span><span class="op" id="5398238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398241">return</span>&nbsp;<span class="ident" id="5398248">color</span><span class="op" id="5398253">.</span><span class="ident" id="5398254">RGBA</span><span class="op" id="5398258">{</span><span class="ident" id="5398259">p</span><span class="op" id="5398260">.</span><span class="ident" id="5398261">Pix</span><span class="op" id="5398264">[</span><span class="ident" id="5398265">i</span><span class="op" id="5398266">+</span><span class="num" id="5398267">0</span><span class="op" id="5398268">]</span><span class="op" id="5398269">,</span>&nbsp;<span class="ident" id="5398271">p</span><span class="op" id="5398272">.</span><span class="ident" id="5398273">Pix</span><span class="op" id="5398276">[</span><span class="ident" id="5398277">i</span><span class="op" id="5398278">+</span><span class="num" id="5398279">1</span><span class="op" id="5398280">]</span><span class="op" id="5398281">,</span>&nbsp;<span class="ident" id="5398283">p</span><span class="op" id="5398284">.</span><span class="ident" id="5398285">Pix</span><span class="op" id="5398288">[</span><span class="ident" id="5398289">i</span><span class="op" id="5398290">+</span><span class="num" id="5398291">2</span><span class="op" id="5398292">]</span><span class="op" id="5398293">,</span>&nbsp;<span class="ident" id="5398295">p</span><span class="op" id="5398296">.</span><span class="ident" id="5398297">Pix</span><span class="op" id="5398300">[</span><span class="ident" id="5398301">i</span><span class="op" id="5398302">+</span><span class="num" id="5398303">3</span><span class="op" id="5398304">]</span><span class="op" id="5398305">}</span><br>
<span class="lineno"></span><span class="op" id="5398307">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="5398310">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5398389">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5398413">func</span>&nbsp;<span class="op" id="5398418">(</span><span class="ident" id="5398419">p</span>&nbsp;<span class="op" id="5398421">*</span><span class="ident" id="5398422">RGBA</span><span class="op" id="5398426">)</span>&nbsp;<span class="ident" id="5398428">PixOffset</span><span class="op" id="5398437">(</span><span class="ident" id="5398438">x</span><span class="op" id="5398439">,</span>&nbsp;<span class="ident" id="5398441">y</span>&nbsp;<span class="builtintype" id="5398443">int</span><span class="op" id="5398446">)</span>&nbsp;<span class="builtintype" id="5398448">int</span>&nbsp;<span class="op" id="5398452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398455">return</span>&nbsp;<span class="op" id="5398462">(</span><span class="ident" id="5398463">y</span><span class="op" id="5398464">-</span><span class="ident" id="5398465">p</span><span class="op" id="5398466">.</span><span class="ident" id="5398467">Rect</span><span class="op" id="5398471">.</span><span class="ident" id="5398472">Min</span><span class="op" id="5398475">.</span><span class="ident" id="5398476">Y</span><span class="op" id="5398477">)</span><span class="op" id="5398478">*</span><span class="ident" id="5398479">p</span><span class="op" id="5398480">.</span><span class="ident" id="5398481">Stride</span>&nbsp;<span class="op" id="5398488">+</span>&nbsp;<span class="op" id="5398490">(</span><span class="ident" id="5398491">x</span><span class="op" id="5398492">-</span><span class="ident" id="5398493">p</span><span class="op" id="5398494">.</span><span class="ident" id="5398495">Rect</span><span class="op" id="5398499">.</span><span class="ident" id="5398500">Min</span><span class="op" id="5398503">.</span><span class="ident" id="5398504">X</span><span class="op" id="5398505">)</span><span class="op" id="5398506">*</span><span class="num" id="5398507">4</span><br>
<span class="lineno">90</span><span class="op" id="5398509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5398512">func</span>&nbsp;<span class="op" id="5398517">(</span><span class="ident" id="5398518">p</span>&nbsp;<span class="op" id="5398520">*</span><span class="ident" id="5398521">RGBA</span><span class="op" id="5398525">)</span>&nbsp;<span class="ident" id="5398527">Set</span><span class="op" id="5398530">(</span><span class="ident" id="5398531">x</span><span class="op" id="5398532">,</span>&nbsp;<span class="ident" id="5398534">y</span>&nbsp;<span class="builtintype" id="5398536">int</span><span class="op" id="5398539">,</span>&nbsp;<span class="ident" id="5398541">c</span>&nbsp;<span class="ident" id="5398543">color</span><span class="op" id="5398548">.</span><span class="ident" id="5398549">Color</span><span class="op" id="5398554">)</span>&nbsp;<span class="op" id="5398556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398559">if</span>&nbsp;<span class="op" id="5398562">!</span><span class="op" id="5398563">(</span><span class="ident" id="5398564">Point</span><span class="op" id="5398569">{</span><span class="ident" id="5398570">x</span><span class="op" id="5398571">,</span>&nbsp;<span class="ident" id="5398573">y</span><span class="op" id="5398574">}</span><span class="op" id="5398575">.</span><span class="ident" id="5398576">In</span><span class="op" id="5398578">(</span><span class="ident" id="5398579">p</span><span class="op" id="5398580">.</span><span class="ident" id="5398581">Rect</span><span class="op" id="5398585">)</span><span class="op" id="5398586">)</span>&nbsp;<span class="op" id="5398588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398592">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398603">i</span>&nbsp;<span class="op" id="5398605">:=</span>&nbsp;<span class="ident" id="5398608">p</span><span class="op" id="5398609">.</span><span class="ident" id="5398610">PixOffset</span><span class="op" id="5398619">(</span><span class="ident" id="5398620">x</span><span class="op" id="5398621">,</span>&nbsp;<span class="ident" id="5398623">y</span><span class="op" id="5398624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398627">c1</span>&nbsp;<span class="op" id="5398630">:=</span>&nbsp;<span class="ident" id="5398633">color</span><span class="op" id="5398638">.</span><span class="ident" id="5398639">RGBAModel</span><span class="op" id="5398648">.</span><span class="ident" id="5398649">Convert</span><span class="op" id="5398656">(</span><span class="ident" id="5398657">c</span><span class="op" id="5398658">)</span><span class="op" id="5398659">.</span><span class="op" id="5398660">(</span><span class="ident" id="5398661">color</span><span class="op" id="5398666">.</span><span class="ident" id="5398667">RGBA</span><span class="op" id="5398671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398674">p</span><span class="op" id="5398675">.</span><span class="ident" id="5398676">Pix</span><span class="op" id="5398679">[</span><span class="ident" id="5398680">i</span><span class="op" id="5398681">+</span><span class="num" id="5398682">0</span><span class="op" id="5398683">]</span>&nbsp;<span class="op" id="5398685">=</span>&nbsp;<span class="ident" id="5398687">c1</span><span class="op" id="5398689">.</span><span class="ident" id="5398690">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398693">p</span><span class="op" id="5398694">.</span><span class="ident" id="5398695">Pix</span><span class="op" id="5398698">[</span><span class="ident" id="5398699">i</span><span class="op" id="5398700">+</span><span class="num" id="5398701">1</span><span class="op" id="5398702">]</span>&nbsp;<span class="op" id="5398704">=</span>&nbsp;<span class="ident" id="5398706">c1</span><span class="op" id="5398708">.</span><span class="ident" id="5398709">G</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398712">p</span><span class="op" id="5398713">.</span><span class="ident" id="5398714">Pix</span><span class="op" id="5398717">[</span><span class="ident" id="5398718">i</span><span class="op" id="5398719">+</span><span class="num" id="5398720">2</span><span class="op" id="5398721">]</span>&nbsp;<span class="op" id="5398723">=</span>&nbsp;<span class="ident" id="5398725">c1</span><span class="op" id="5398727">.</span><span class="ident" id="5398728">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398731">p</span><span class="op" id="5398732">.</span><span class="ident" id="5398733">Pix</span><span class="op" id="5398736">[</span><span class="ident" id="5398737">i</span><span class="op" id="5398738">+</span><span class="num" id="5398739">3</span><span class="op" id="5398740">]</span>&nbsp;<span class="op" id="5398742">=</span>&nbsp;<span class="ident" id="5398744">c1</span><span class="op" id="5398746">.</span><span class="ident" id="5398747">A</span><br>
<span class="lineno"></span><span class="op" id="5398749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5398752">func</span>&nbsp;<span class="op" id="5398757">(</span><span class="ident" id="5398758">p</span>&nbsp;<span class="op" id="5398760">*</span><span class="ident" id="5398761">RGBA</span><span class="op" id="5398765">)</span>&nbsp;<span class="ident" id="5398767">SetRGBA</span><span class="op" id="5398774">(</span><span class="ident" id="5398775">x</span><span class="op" id="5398776">,</span>&nbsp;<span class="ident" id="5398778">y</span>&nbsp;<span class="builtintype" id="5398780">int</span><span class="op" id="5398783">,</span>&nbsp;<span class="ident" id="5398785">c</span>&nbsp;<span class="ident" id="5398787">color</span><span class="op" id="5398792">.</span><span class="ident" id="5398793">RGBA</span><span class="op" id="5398797">)</span>&nbsp;<span class="op" id="5398799">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398802">if</span>&nbsp;<span class="op" id="5398805">!</span><span class="op" id="5398806">(</span><span class="ident" id="5398807">Point</span><span class="op" id="5398812">{</span><span class="ident" id="5398813">x</span><span class="op" id="5398814">,</span>&nbsp;<span class="ident" id="5398816">y</span><span class="op" id="5398817">}</span><span class="op" id="5398818">.</span><span class="ident" id="5398819">In</span><span class="op" id="5398821">(</span><span class="ident" id="5398822">p</span><span class="op" id="5398823">.</span><span class="ident" id="5398824">Rect</span><span class="op" id="5398828">)</span><span class="op" id="5398829">)</span>&nbsp;<span class="op" id="5398831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398835">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398846">i</span>&nbsp;<span class="op" id="5398848">:=</span>&nbsp;<span class="ident" id="5398851">p</span><span class="op" id="5398852">.</span><span class="ident" id="5398853">PixOffset</span><span class="op" id="5398862">(</span><span class="ident" id="5398863">x</span><span class="op" id="5398864">,</span>&nbsp;<span class="ident" id="5398866">y</span><span class="op" id="5398867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398870">p</span><span class="op" id="5398871">.</span><span class="ident" id="5398872">Pix</span><span class="op" id="5398875">[</span><span class="ident" id="5398876">i</span><span class="op" id="5398877">+</span><span class="num" id="5398878">0</span><span class="op" id="5398879">]</span>&nbsp;<span class="op" id="5398881">=</span>&nbsp;<span class="ident" id="5398883">c</span><span class="op" id="5398884">.</span><span class="ident" id="5398885">R</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398888">p</span><span class="op" id="5398889">.</span><span class="ident" id="5398890">Pix</span><span class="op" id="5398893">[</span><span class="ident" id="5398894">i</span><span class="op" id="5398895">+</span><span class="num" id="5398896">1</span><span class="op" id="5398897">]</span>&nbsp;<span class="op" id="5398899">=</span>&nbsp;<span class="ident" id="5398901">c</span><span class="op" id="5398902">.</span><span class="ident" id="5398903">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398906">p</span><span class="op" id="5398907">.</span><span class="ident" id="5398908">Pix</span><span class="op" id="5398911">[</span><span class="ident" id="5398912">i</span><span class="op" id="5398913">+</span><span class="num" id="5398914">2</span><span class="op" id="5398915">]</span>&nbsp;<span class="op" id="5398917">=</span>&nbsp;<span class="ident" id="5398919">c</span><span class="op" id="5398920">.</span><span class="ident" id="5398921">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398924">p</span><span class="op" id="5398925">.</span><span class="ident" id="5398926">Pix</span><span class="op" id="5398929">[</span><span class="ident" id="5398930">i</span><span class="op" id="5398931">+</span><span class="num" id="5398932">3</span><span class="op" id="5398933">]</span>&nbsp;<span class="op" id="5398935">=</span>&nbsp;<span class="ident" id="5398937">c</span><span class="op" id="5398938">.</span><span class="ident" id="5398939">A</span><br>
<span class="lineno"></span><span class="op" id="5398941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5398944">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5399021">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5399093">func</span>&nbsp;<span class="op" id="5399098">(</span><span class="ident" id="5399099">p</span>&nbsp;<span class="op" id="5399101">*</span><span class="ident" id="5399102">RGBA</span><span class="op" id="5399106">)</span>&nbsp;<span class="ident" id="5399108">SubImage</span><span class="op" id="5399116">(</span><span class="ident" id="5399117">r</span>&nbsp;<span class="ident" id="5399119">Rectangle</span><span class="op" id="5399128">)</span>&nbsp;<span class="ident" id="5399130">Image</span>&nbsp;<span class="op" id="5399136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399139">r</span>&nbsp;<span class="op" id="5399141">=</span>&nbsp;<span class="ident" id="5399143">r</span><span class="op" id="5399144">.</span><span class="ident" id="5399145">Intersect</span><span class="op" id="5399154">(</span><span class="ident" id="5399155">p</span><span class="op" id="5399156">.</span><span class="ident" id="5399157">Rect</span><span class="op" id="5399161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5399164">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5399245">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5399327">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399377">if</span>&nbsp;<span class="ident" id="5399380">r</span><span class="op" id="5399381">.</span><span class="ident" id="5399382">Empty</span><span class="op" id="5399387">(</span><span class="op" id="5399388">)</span>&nbsp;<span class="op" id="5399390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399394">return</span>&nbsp;<span class="op" id="5399401">&amp;</span><span class="ident" id="5399402">RGBA</span><span class="op" id="5399406">{</span><span class="op" id="5399407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5399410">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399413">i</span>&nbsp;<span class="op" id="5399415">:=</span>&nbsp;<span class="ident" id="5399418">p</span><span class="op" id="5399419">.</span><span class="ident" id="5399420">PixOffset</span><span class="op" id="5399429">(</span><span class="ident" id="5399430">r</span><span class="op" id="5399431">.</span><span class="ident" id="5399432">Min</span><span class="op" id="5399435">.</span><span class="ident" id="5399436">X</span><span class="op" id="5399437">,</span>&nbsp;<span class="ident" id="5399439">r</span><span class="op" id="5399440">.</span><span class="ident" id="5399441">Min</span><span class="op" id="5399444">.</span><span class="ident" id="5399445">Y</span><span class="op" id="5399446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399449">return</span>&nbsp;<span class="op" id="5399456">&amp;</span><span class="ident" id="5399457">RGBA</span><span class="op" id="5399461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399465">Pix</span><span class="op" id="5399468">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5399473">p</span><span class="op" id="5399474">.</span><span class="ident" id="5399475">Pix</span><span class="op" id="5399478">[</span><span class="ident" id="5399479">i</span><span class="op" id="5399480">:</span><span class="op" id="5399481">]</span><span class="op" id="5399482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399486">Stride</span><span class="op" id="5399492">:</span>&nbsp;<span class="ident" id="5399494">p</span><span class="op" id="5399495">.</span><span class="ident" id="5399496">Stride</span><span class="op" id="5399502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399506">Rect</span><span class="op" id="5399510">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5399514">r</span><span class="op" id="5399515">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5399518">}</span><br>
<span class="lineno"></span><span class="op" id="5399520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5399523">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5399596">func</span>&nbsp;<span class="op" id="5399601">(</span><span class="ident" id="5399602">p</span>&nbsp;<span class="op" id="5399604">*</span><span class="ident" id="5399605">RGBA</span><span class="op" id="5399609">)</span>&nbsp;<span class="ident" id="5399611">Opaque</span><span class="op" id="5399617">(</span><span class="op" id="5399618">)</span>&nbsp;<span class="builtintype" id="5399620">bool</span>&nbsp;<span class="op" id="5399625">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399628">if</span>&nbsp;<span class="ident" id="5399631">p</span><span class="op" id="5399632">.</span><span class="ident" id="5399633">Rect</span><span class="op" id="5399637">.</span><span class="ident" id="5399638">Empty</span><span class="op" id="5399643">(</span><span class="op" id="5399644">)</span>&nbsp;<span class="op" id="5399646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399650">return</span>&nbsp;<span class="builtintype" id="5399657">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5399663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399666">i0</span><span class="op" id="5399668">,</span>&nbsp;<span class="ident" id="5399670">i1</span>&nbsp;<span class="op" id="5399673">:=</span>&nbsp;<span class="num" id="5399676">3</span><span class="op" id="5399677">,</span>&nbsp;<span class="ident" id="5399679">p</span><span class="op" id="5399680">.</span><span class="ident" id="5399681">Rect</span><span class="op" id="5399685">.</span><span class="ident" id="5399686">Dx</span><span class="op" id="5399688">(</span><span class="op" id="5399689">)</span><span class="op" id="5399690">*</span><span class="num" id="5399691">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399694">for</span>&nbsp;<span class="ident" id="5399698">y</span>&nbsp;<span class="op" id="5399700">:=</span>&nbsp;<span class="ident" id="5399703">p</span><span class="op" id="5399704">.</span><span class="ident" id="5399705">Rect</span><span class="op" id="5399709">.</span><span class="ident" id="5399710">Min</span><span class="op" id="5399713">.</span><span class="ident" id="5399714">Y</span><span class="op" id="5399715">;</span>&nbsp;<span class="ident" id="5399717">y</span>&nbsp;<span class="op" id="5399719">&lt;</span>&nbsp;<span class="ident" id="5399721">p</span><span class="op" id="5399722">.</span><span class="ident" id="5399723">Rect</span><span class="op" id="5399727">.</span><span class="ident" id="5399728">Max</span><span class="op" id="5399731">.</span><span class="ident" id="5399732">Y</span><span class="op" id="5399733">;</span>&nbsp;<span class="ident" id="5399735">y</span><span class="op" id="5399736">++</span>&nbsp;<span class="op" id="5399739">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399743">for</span>&nbsp;<span class="ident" id="5399747">i</span>&nbsp;<span class="op" id="5399749">:=</span>&nbsp;<span class="ident" id="5399752">i0</span><span class="op" id="5399754">;</span>&nbsp;<span class="ident" id="5399756">i</span>&nbsp;<span class="op" id="5399758">&lt;</span>&nbsp;<span class="ident" id="5399760">i1</span><span class="op" id="5399762">;</span>&nbsp;<span class="ident" id="5399764">i</span>&nbsp;<span class="op" id="5399766">+=</span>&nbsp;<span class="num" id="5399769">4</span>&nbsp;<span class="op" id="5399771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399776">if</span>&nbsp;<span class="ident" id="5399779">p</span><span class="op" id="5399780">.</span><span class="ident" id="5399781">Pix</span><span class="op" id="5399784">[</span><span class="ident" id="5399785">i</span><span class="op" id="5399786">]</span>&nbsp;<span class="op" id="5399788">!=</span>&nbsp;<span class="num" id="5399791">0xff</span>&nbsp;<span class="op" id="5399796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399802">return</span>&nbsp;<span class="builtintype" id="5399809">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5399818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5399822">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399826">i0</span>&nbsp;<span class="op" id="5399829">+=</span>&nbsp;<span class="ident" id="5399832">p</span><span class="op" id="5399833">.</span><span class="ident" id="5399834">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399843">i1</span>&nbsp;<span class="op" id="5399846">+=</span>&nbsp;<span class="ident" id="5399849">p</span><span class="op" id="5399850">.</span><span class="ident" id="5399851">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5399859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399862">return</span>&nbsp;<span class="builtintype" id="5399869">true</span><br>
<span class="lineno"></span><span class="op" id="5399874">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="5399877">//&nbsp;NewRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5399930">func</span>&nbsp;<span class="ident" id="5399935">NewRGBA</span><span class="op" id="5399942">(</span><span class="ident" id="5399943">r</span>&nbsp;<span class="ident" id="5399945">Rectangle</span><span class="op" id="5399954">)</span>&nbsp;<span class="op" id="5399956">*</span><span class="ident" id="5399957">RGBA</span>&nbsp;<span class="op" id="5399962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399965">w</span><span class="op" id="5399966">,</span>&nbsp;<span class="ident" id="5399968">h</span>&nbsp;<span class="op" id="5399970">:=</span>&nbsp;<span class="ident" id="5399973">r</span><span class="op" id="5399974">.</span><span class="ident" id="5399975">Dx</span><span class="op" id="5399977">(</span><span class="op" id="5399978">)</span><span class="op" id="5399979">,</span>&nbsp;<span class="ident" id="5399981">r</span><span class="op" id="5399982">.</span><span class="ident" id="5399983">Dy</span><span class="op" id="5399985">(</span><span class="op" id="5399986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399989">buf</span>&nbsp;<span class="op" id="5399993">:=</span>&nbsp;<span class="builtinfunc" id="5399996">make</span><span class="op" id="5400000">(</span><span class="op" id="5400001">[</span><span class="op" id="5400002">]</span><span class="builtintype" id="5400003">uint8</span><span class="op" id="5400008">,</span>&nbsp;<span class="num" id="5400010">4</span><span class="op" id="5400011">*</span><span class="ident" id="5400012">w</span><span class="op" id="5400013">*</span><span class="ident" id="5400014">h</span><span class="op" id="5400015">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400018">return</span>&nbsp;<span class="op" id="5400025">&amp;</span><span class="ident" id="5400026">RGBA</span><span class="op" id="5400030">{</span><span class="ident" id="5400031">buf</span><span class="op" id="5400034">,</span>&nbsp;<span class="num" id="5400036">4</span>&nbsp;<span class="op" id="5400038">*</span>&nbsp;<span class="ident" id="5400040">w</span><span class="op" id="5400041">,</span>&nbsp;<span class="ident" id="5400043">r</span><span class="op" id="5400044">}</span><br>
<span class="lineno"></span><span class="op" id="5400046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5400049">//&nbsp;RGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5400126">type</span>&nbsp;<span class="ident" id="5400131">RGBA64</span>&nbsp;<span class="keyword" id="5400138">struct</span>&nbsp;<span class="op" id="5400145">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5400148">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5400238">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400306">Pix</span>&nbsp;<span class="op" id="5400310">[</span><span class="op" id="5400311">]</span><span class="builtintype" id="5400312">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5400319">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400395">Stride</span>&nbsp;<span class="builtintype" id="5400402">int</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5400407">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400439">Rect</span>&nbsp;<span class="ident" id="5400444">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5400454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5400457">func</span>&nbsp;<span class="op" id="5400462">(</span><span class="ident" id="5400463">p</span>&nbsp;<span class="op" id="5400465">*</span><span class="ident" id="5400466">RGBA64</span><span class="op" id="5400472">)</span>&nbsp;<span class="ident" id="5400474">ColorModel</span><span class="op" id="5400484">(</span><span class="op" id="5400485">)</span>&nbsp;<span class="ident" id="5400487">color</span><span class="op" id="5400492">.</span><span class="ident" id="5400493">Model</span>&nbsp;<span class="op" id="5400499">{</span>&nbsp;<span class="keyword" id="5400501">return</span>&nbsp;<span class="ident" id="5400508">color</span><span class="op" id="5400513">.</span><span class="ident" id="5400514">RGBA64Model</span>&nbsp;<span class="op" id="5400526">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5400529">func</span>&nbsp;<span class="op" id="5400534">(</span><span class="ident" id="5400535">p</span>&nbsp;<span class="op" id="5400537">*</span><span class="ident" id="5400538">RGBA64</span><span class="op" id="5400544">)</span>&nbsp;<span class="ident" id="5400546">Bounds</span><span class="op" id="5400552">(</span><span class="op" id="5400553">)</span>&nbsp;<span class="ident" id="5400555">Rectangle</span>&nbsp;<span class="op" id="5400565">{</span>&nbsp;<span class="keyword" id="5400567">return</span>&nbsp;<span class="ident" id="5400574">p</span><span class="op" id="5400575">.</span><span class="ident" id="5400576">Rect</span>&nbsp;<span class="op" id="5400581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5400584">func</span>&nbsp;<span class="op" id="5400589">(</span><span class="ident" id="5400590">p</span>&nbsp;<span class="op" id="5400592">*</span><span class="ident" id="5400593">RGBA64</span><span class="op" id="5400599">)</span>&nbsp;<span class="ident" id="5400601">At</span><span class="op" id="5400603">(</span><span class="ident" id="5400604">x</span><span class="op" id="5400605">,</span>&nbsp;<span class="ident" id="5400607">y</span>&nbsp;<span class="builtintype" id="5400609">int</span><span class="op" id="5400612">)</span>&nbsp;<span class="ident" id="5400614">color</span><span class="op" id="5400619">.</span><span class="ident" id="5400620">Color</span>&nbsp;<span class="op" id="5400626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400629">return</span>&nbsp;<span class="ident" id="5400636">p</span><span class="op" id="5400637">.</span><span class="ident" id="5400638">RGBA64At</span><span class="op" id="5400646">(</span><span class="ident" id="5400647">x</span><span class="op" id="5400648">,</span>&nbsp;<span class="ident" id="5400650">y</span><span class="op" id="5400651">)</span><br>
<span class="lineno">175</span><span class="op" id="5400653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5400656">func</span>&nbsp;<span class="op" id="5400661">(</span><span class="ident" id="5400662">p</span>&nbsp;<span class="op" id="5400664">*</span><span class="ident" id="5400665">RGBA64</span><span class="op" id="5400671">)</span>&nbsp;<span class="ident" id="5400673">RGBA64At</span><span class="op" id="5400681">(</span><span class="ident" id="5400682">x</span><span class="op" id="5400683">,</span>&nbsp;<span class="ident" id="5400685">y</span>&nbsp;<span class="builtintype" id="5400687">int</span><span class="op" id="5400690">)</span>&nbsp;<span class="ident" id="5400692">color</span><span class="op" id="5400697">.</span><span class="ident" id="5400698">RGBA64</span>&nbsp;<span class="op" id="5400705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400708">if</span>&nbsp;<span class="op" id="5400711">!</span><span class="op" id="5400712">(</span><span class="ident" id="5400713">Point</span><span class="op" id="5400718">{</span><span class="ident" id="5400719">x</span><span class="op" id="5400720">,</span>&nbsp;<span class="ident" id="5400722">y</span><span class="op" id="5400723">}</span><span class="op" id="5400724">.</span><span class="ident" id="5400725">In</span><span class="op" id="5400727">(</span><span class="ident" id="5400728">p</span><span class="op" id="5400729">.</span><span class="ident" id="5400730">Rect</span><span class="op" id="5400734">)</span><span class="op" id="5400735">)</span>&nbsp;<span class="op" id="5400737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400741">return</span>&nbsp;<span class="ident" id="5400748">color</span><span class="op" id="5400753">.</span><span class="ident" id="5400754">RGBA64</span><span class="op" id="5400760">{</span><span class="op" id="5400761">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5400764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400767">i</span>&nbsp;<span class="op" id="5400769">:=</span>&nbsp;<span class="ident" id="5400772">p</span><span class="op" id="5400773">.</span><span class="ident" id="5400774">PixOffset</span><span class="op" id="5400783">(</span><span class="ident" id="5400784">x</span><span class="op" id="5400785">,</span>&nbsp;<span class="ident" id="5400787">y</span><span class="op" id="5400788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400791">return</span>&nbsp;<span class="ident" id="5400798">color</span><span class="op" id="5400803">.</span><span class="ident" id="5400804">RGBA64</span><span class="op" id="5400810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5400814">uint16</span><span class="op" id="5400820">(</span><span class="ident" id="5400821">p</span><span class="op" id="5400822">.</span><span class="ident" id="5400823">Pix</span><span class="op" id="5400826">[</span><span class="ident" id="5400827">i</span><span class="op" id="5400828">+</span><span class="num" id="5400829">0</span><span class="op" id="5400830">]</span><span class="op" id="5400831">)</span><span class="op" id="5400832">&lt;&lt;</span><span class="num" id="5400834">8</span>&nbsp;<span class="op" id="5400836">|</span>&nbsp;<span class="builtintype" id="5400838">uint16</span><span class="op" id="5400844">(</span><span class="ident" id="5400845">p</span><span class="op" id="5400846">.</span><span class="ident" id="5400847">Pix</span><span class="op" id="5400850">[</span><span class="ident" id="5400851">i</span><span class="op" id="5400852">+</span><span class="num" id="5400853">1</span><span class="op" id="5400854">]</span><span class="op" id="5400855">)</span><span class="op" id="5400856">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5400860">uint16</span><span class="op" id="5400866">(</span><span class="ident" id="5400867">p</span><span class="op" id="5400868">.</span><span class="ident" id="5400869">Pix</span><span class="op" id="5400872">[</span><span class="ident" id="5400873">i</span><span class="op" id="5400874">+</span><span class="num" id="5400875">2</span><span class="op" id="5400876">]</span><span class="op" id="5400877">)</span><span class="op" id="5400878">&lt;&lt;</span><span class="num" id="5400880">8</span>&nbsp;<span class="op" id="5400882">|</span>&nbsp;<span class="builtintype" id="5400884">uint16</span><span class="op" id="5400890">(</span><span class="ident" id="5400891">p</span><span class="op" id="5400892">.</span><span class="ident" id="5400893">Pix</span><span class="op" id="5400896">[</span><span class="ident" id="5400897">i</span><span class="op" id="5400898">+</span><span class="num" id="5400899">3</span><span class="op" id="5400900">]</span><span class="op" id="5400901">)</span><span class="op" id="5400902">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5400906">uint16</span><span class="op" id="5400912">(</span><span class="ident" id="5400913">p</span><span class="op" id="5400914">.</span><span class="ident" id="5400915">Pix</span><span class="op" id="5400918">[</span><span class="ident" id="5400919">i</span><span class="op" id="5400920">+</span><span class="num" id="5400921">4</span><span class="op" id="5400922">]</span><span class="op" id="5400923">)</span><span class="op" id="5400924">&lt;&lt;</span><span class="num" id="5400926">8</span>&nbsp;<span class="op" id="5400928">|</span>&nbsp;<span class="builtintype" id="5400930">uint16</span><span class="op" id="5400936">(</span><span class="ident" id="5400937">p</span><span class="op" id="5400938">.</span><span class="ident" id="5400939">Pix</span><span class="op" id="5400942">[</span><span class="ident" id="5400943">i</span><span class="op" id="5400944">+</span><span class="num" id="5400945">5</span><span class="op" id="5400946">]</span><span class="op" id="5400947">)</span><span class="op" id="5400948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5400952">uint16</span><span class="op" id="5400958">(</span><span class="ident" id="5400959">p</span><span class="op" id="5400960">.</span><span class="ident" id="5400961">Pix</span><span class="op" id="5400964">[</span><span class="ident" id="5400965">i</span><span class="op" id="5400966">+</span><span class="num" id="5400967">6</span><span class="op" id="5400968">]</span><span class="op" id="5400969">)</span><span class="op" id="5400970">&lt;&lt;</span><span class="num" id="5400972">8</span>&nbsp;<span class="op" id="5400974">|</span>&nbsp;<span class="builtintype" id="5400976">uint16</span><span class="op" id="5400982">(</span><span class="ident" id="5400983">p</span><span class="op" id="5400984">.</span><span class="ident" id="5400985">Pix</span><span class="op" id="5400988">[</span><span class="ident" id="5400989">i</span><span class="op" id="5400990">+</span><span class="num" id="5400991">7</span><span class="op" id="5400992">]</span><span class="op" id="5400993">)</span><span class="op" id="5400994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5400997">}</span><br>
<span class="lineno"></span><span class="op" id="5400999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="5401002">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5401081">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5401105">func</span>&nbsp;<span class="op" id="5401110">(</span><span class="ident" id="5401111">p</span>&nbsp;<span class="op" id="5401113">*</span><span class="ident" id="5401114">RGBA64</span><span class="op" id="5401120">)</span>&nbsp;<span class="ident" id="5401122">PixOffset</span><span class="op" id="5401131">(</span><span class="ident" id="5401132">x</span><span class="op" id="5401133">,</span>&nbsp;<span class="ident" id="5401135">y</span>&nbsp;<span class="builtintype" id="5401137">int</span><span class="op" id="5401140">)</span>&nbsp;<span class="builtintype" id="5401142">int</span>&nbsp;<span class="op" id="5401146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401149">return</span>&nbsp;<span class="op" id="5401156">(</span><span class="ident" id="5401157">y</span><span class="op" id="5401158">-</span><span class="ident" id="5401159">p</span><span class="op" id="5401160">.</span><span class="ident" id="5401161">Rect</span><span class="op" id="5401165">.</span><span class="ident" id="5401166">Min</span><span class="op" id="5401169">.</span><span class="ident" id="5401170">Y</span><span class="op" id="5401171">)</span><span class="op" id="5401172">*</span><span class="ident" id="5401173">p</span><span class="op" id="5401174">.</span><span class="ident" id="5401175">Stride</span>&nbsp;<span class="op" id="5401182">+</span>&nbsp;<span class="op" id="5401184">(</span><span class="ident" id="5401185">x</span><span class="op" id="5401186">-</span><span class="ident" id="5401187">p</span><span class="op" id="5401188">.</span><span class="ident" id="5401189">Rect</span><span class="op" id="5401193">.</span><span class="ident" id="5401194">Min</span><span class="op" id="5401197">.</span><span class="ident" id="5401198">X</span><span class="op" id="5401199">)</span><span class="op" id="5401200">*</span><span class="num" id="5401201">8</span><br>
<span class="lineno"></span><span class="op" id="5401203">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="5401206">func</span>&nbsp;<span class="op" id="5401211">(</span><span class="ident" id="5401212">p</span>&nbsp;<span class="op" id="5401214">*</span><span class="ident" id="5401215">RGBA64</span><span class="op" id="5401221">)</span>&nbsp;<span class="ident" id="5401223">Set</span><span class="op" id="5401226">(</span><span class="ident" id="5401227">x</span><span class="op" id="5401228">,</span>&nbsp;<span class="ident" id="5401230">y</span>&nbsp;<span class="builtintype" id="5401232">int</span><span class="op" id="5401235">,</span>&nbsp;<span class="ident" id="5401237">c</span>&nbsp;<span class="ident" id="5401239">color</span><span class="op" id="5401244">.</span><span class="ident" id="5401245">Color</span><span class="op" id="5401250">)</span>&nbsp;<span class="op" id="5401252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401255">if</span>&nbsp;<span class="op" id="5401258">!</span><span class="op" id="5401259">(</span><span class="ident" id="5401260">Point</span><span class="op" id="5401265">{</span><span class="ident" id="5401266">x</span><span class="op" id="5401267">,</span>&nbsp;<span class="ident" id="5401269">y</span><span class="op" id="5401270">}</span><span class="op" id="5401271">.</span><span class="ident" id="5401272">In</span><span class="op" id="5401274">(</span><span class="ident" id="5401275">p</span><span class="op" id="5401276">.</span><span class="ident" id="5401277">Rect</span><span class="op" id="5401281">)</span><span class="op" id="5401282">)</span>&nbsp;<span class="op" id="5401284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401288">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5401296">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401299">i</span>&nbsp;<span class="op" id="5401301">:=</span>&nbsp;<span class="ident" id="5401304">p</span><span class="op" id="5401305">.</span><span class="ident" id="5401306">PixOffset</span><span class="op" id="5401315">(</span><span class="ident" id="5401316">x</span><span class="op" id="5401317">,</span>&nbsp;<span class="ident" id="5401319">y</span><span class="op" id="5401320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401323">c1</span>&nbsp;<span class="op" id="5401326">:=</span>&nbsp;<span class="ident" id="5401329">color</span><span class="op" id="5401334">.</span><span class="ident" id="5401335">RGBA64Model</span><span class="op" id="5401346">.</span><span class="ident" id="5401347">Convert</span><span class="op" id="5401354">(</span><span class="ident" id="5401355">c</span><span class="op" id="5401356">)</span><span class="op" id="5401357">.</span><span class="op" id="5401358">(</span><span class="ident" id="5401359">color</span><span class="op" id="5401364">.</span><span class="ident" id="5401365">RGBA64</span><span class="op" id="5401371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401374">p</span><span class="op" id="5401375">.</span><span class="ident" id="5401376">Pix</span><span class="op" id="5401379">[</span><span class="ident" id="5401380">i</span><span class="op" id="5401381">+</span><span class="num" id="5401382">0</span><span class="op" id="5401383">]</span>&nbsp;<span class="op" id="5401385">=</span>&nbsp;<span class="builtintype" id="5401387">uint8</span><span class="op" id="5401392">(</span><span class="ident" id="5401393">c1</span><span class="op" id="5401395">.</span><span class="ident" id="5401396">R</span>&nbsp;<span class="op" id="5401398">&gt;&gt;</span>&nbsp;<span class="num" id="5401401">8</span><span class="op" id="5401402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401405">p</span><span class="op" id="5401406">.</span><span class="ident" id="5401407">Pix</span><span class="op" id="5401410">[</span><span class="ident" id="5401411">i</span><span class="op" id="5401412">+</span><span class="num" id="5401413">1</span><span class="op" id="5401414">]</span>&nbsp;<span class="op" id="5401416">=</span>&nbsp;<span class="builtintype" id="5401418">uint8</span><span class="op" id="5401423">(</span><span class="ident" id="5401424">c1</span><span class="op" id="5401426">.</span><span class="ident" id="5401427">R</span><span class="op" id="5401428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401431">p</span><span class="op" id="5401432">.</span><span class="ident" id="5401433">Pix</span><span class="op" id="5401436">[</span><span class="ident" id="5401437">i</span><span class="op" id="5401438">+</span><span class="num" id="5401439">2</span><span class="op" id="5401440">]</span>&nbsp;<span class="op" id="5401442">=</span>&nbsp;<span class="builtintype" id="5401444">uint8</span><span class="op" id="5401449">(</span><span class="ident" id="5401450">c1</span><span class="op" id="5401452">.</span><span class="ident" id="5401453">G</span>&nbsp;<span class="op" id="5401455">&gt;&gt;</span>&nbsp;<span class="num" id="5401458">8</span><span class="op" id="5401459">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401462">p</span><span class="op" id="5401463">.</span><span class="ident" id="5401464">Pix</span><span class="op" id="5401467">[</span><span class="ident" id="5401468">i</span><span class="op" id="5401469">+</span><span class="num" id="5401470">3</span><span class="op" id="5401471">]</span>&nbsp;<span class="op" id="5401473">=</span>&nbsp;<span class="builtintype" id="5401475">uint8</span><span class="op" id="5401480">(</span><span class="ident" id="5401481">c1</span><span class="op" id="5401483">.</span><span class="ident" id="5401484">G</span><span class="op" id="5401485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401488">p</span><span class="op" id="5401489">.</span><span class="ident" id="5401490">Pix</span><span class="op" id="5401493">[</span><span class="ident" id="5401494">i</span><span class="op" id="5401495">+</span><span class="num" id="5401496">4</span><span class="op" id="5401497">]</span>&nbsp;<span class="op" id="5401499">=</span>&nbsp;<span class="builtintype" id="5401501">uint8</span><span class="op" id="5401506">(</span><span class="ident" id="5401507">c1</span><span class="op" id="5401509">.</span><span class="ident" id="5401510">B</span>&nbsp;<span class="op" id="5401512">&gt;&gt;</span>&nbsp;<span class="num" id="5401515">8</span><span class="op" id="5401516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401519">p</span><span class="op" id="5401520">.</span><span class="ident" id="5401521">Pix</span><span class="op" id="5401524">[</span><span class="ident" id="5401525">i</span><span class="op" id="5401526">+</span><span class="num" id="5401527">5</span><span class="op" id="5401528">]</span>&nbsp;<span class="op" id="5401530">=</span>&nbsp;<span class="builtintype" id="5401532">uint8</span><span class="op" id="5401537">(</span><span class="ident" id="5401538">c1</span><span class="op" id="5401540">.</span><span class="ident" id="5401541">B</span><span class="op" id="5401542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401545">p</span><span class="op" id="5401546">.</span><span class="ident" id="5401547">Pix</span><span class="op" id="5401550">[</span><span class="ident" id="5401551">i</span><span class="op" id="5401552">+</span><span class="num" id="5401553">6</span><span class="op" id="5401554">]</span>&nbsp;<span class="op" id="5401556">=</span>&nbsp;<span class="builtintype" id="5401558">uint8</span><span class="op" id="5401563">(</span><span class="ident" id="5401564">c1</span><span class="op" id="5401566">.</span><span class="ident" id="5401567">A</span>&nbsp;<span class="op" id="5401569">&gt;&gt;</span>&nbsp;<span class="num" id="5401572">8</span><span class="op" id="5401573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401576">p</span><span class="op" id="5401577">.</span><span class="ident" id="5401578">Pix</span><span class="op" id="5401581">[</span><span class="ident" id="5401582">i</span><span class="op" id="5401583">+</span><span class="num" id="5401584">7</span><span class="op" id="5401585">]</span>&nbsp;<span class="op" id="5401587">=</span>&nbsp;<span class="builtintype" id="5401589">uint8</span><span class="op" id="5401594">(</span><span class="ident" id="5401595">c1</span><span class="op" id="5401597">.</span><span class="ident" id="5401598">A</span><span class="op" id="5401599">)</span><br>
<span class="lineno">210</span><span class="op" id="5401601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5401604">func</span>&nbsp;<span class="op" id="5401609">(</span><span class="ident" id="5401610">p</span>&nbsp;<span class="op" id="5401612">*</span><span class="ident" id="5401613">RGBA64</span><span class="op" id="5401619">)</span>&nbsp;<span class="ident" id="5401621">SetRGBA64</span><span class="op" id="5401630">(</span><span class="ident" id="5401631">x</span><span class="op" id="5401632">,</span>&nbsp;<span class="ident" id="5401634">y</span>&nbsp;<span class="builtintype" id="5401636">int</span><span class="op" id="5401639">,</span>&nbsp;<span class="ident" id="5401641">c</span>&nbsp;<span class="ident" id="5401643">color</span><span class="op" id="5401648">.</span><span class="ident" id="5401649">RGBA64</span><span class="op" id="5401655">)</span>&nbsp;<span class="op" id="5401657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401660">if</span>&nbsp;<span class="op" id="5401663">!</span><span class="op" id="5401664">(</span><span class="ident" id="5401665">Point</span><span class="op" id="5401670">{</span><span class="ident" id="5401671">x</span><span class="op" id="5401672">,</span>&nbsp;<span class="ident" id="5401674">y</span><span class="op" id="5401675">}</span><span class="op" id="5401676">.</span><span class="ident" id="5401677">In</span><span class="op" id="5401679">(</span><span class="ident" id="5401680">p</span><span class="op" id="5401681">.</span><span class="ident" id="5401682">Rect</span><span class="op" id="5401686">)</span><span class="op" id="5401687">)</span>&nbsp;<span class="op" id="5401689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401693">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5401701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401704">i</span>&nbsp;<span class="op" id="5401706">:=</span>&nbsp;<span class="ident" id="5401709">p</span><span class="op" id="5401710">.</span><span class="ident" id="5401711">PixOffset</span><span class="op" id="5401720">(</span><span class="ident" id="5401721">x</span><span class="op" id="5401722">,</span>&nbsp;<span class="ident" id="5401724">y</span><span class="op" id="5401725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401728">p</span><span class="op" id="5401729">.</span><span class="ident" id="5401730">Pix</span><span class="op" id="5401733">[</span><span class="ident" id="5401734">i</span><span class="op" id="5401735">+</span><span class="num" id="5401736">0</span><span class="op" id="5401737">]</span>&nbsp;<span class="op" id="5401739">=</span>&nbsp;<span class="builtintype" id="5401741">uint8</span><span class="op" id="5401746">(</span><span class="ident" id="5401747">c</span><span class="op" id="5401748">.</span><span class="ident" id="5401749">R</span>&nbsp;<span class="op" id="5401751">&gt;&gt;</span>&nbsp;<span class="num" id="5401754">8</span><span class="op" id="5401755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401758">p</span><span class="op" id="5401759">.</span><span class="ident" id="5401760">Pix</span><span class="op" id="5401763">[</span><span class="ident" id="5401764">i</span><span class="op" id="5401765">+</span><span class="num" id="5401766">1</span><span class="op" id="5401767">]</span>&nbsp;<span class="op" id="5401769">=</span>&nbsp;<span class="builtintype" id="5401771">uint8</span><span class="op" id="5401776">(</span><span class="ident" id="5401777">c</span><span class="op" id="5401778">.</span><span class="ident" id="5401779">R</span><span class="op" id="5401780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401783">p</span><span class="op" id="5401784">.</span><span class="ident" id="5401785">Pix</span><span class="op" id="5401788">[</span><span class="ident" id="5401789">i</span><span class="op" id="5401790">+</span><span class="num" id="5401791">2</span><span class="op" id="5401792">]</span>&nbsp;<span class="op" id="5401794">=</span>&nbsp;<span class="builtintype" id="5401796">uint8</span><span class="op" id="5401801">(</span><span class="ident" id="5401802">c</span><span class="op" id="5401803">.</span><span class="ident" id="5401804">G</span>&nbsp;<span class="op" id="5401806">&gt;&gt;</span>&nbsp;<span class="num" id="5401809">8</span><span class="op" id="5401810">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401813">p</span><span class="op" id="5401814">.</span><span class="ident" id="5401815">Pix</span><span class="op" id="5401818">[</span><span class="ident" id="5401819">i</span><span class="op" id="5401820">+</span><span class="num" id="5401821">3</span><span class="op" id="5401822">]</span>&nbsp;<span class="op" id="5401824">=</span>&nbsp;<span class="builtintype" id="5401826">uint8</span><span class="op" id="5401831">(</span><span class="ident" id="5401832">c</span><span class="op" id="5401833">.</span><span class="ident" id="5401834">G</span><span class="op" id="5401835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401838">p</span><span class="op" id="5401839">.</span><span class="ident" id="5401840">Pix</span><span class="op" id="5401843">[</span><span class="ident" id="5401844">i</span><span class="op" id="5401845">+</span><span class="num" id="5401846">4</span><span class="op" id="5401847">]</span>&nbsp;<span class="op" id="5401849">=</span>&nbsp;<span class="builtintype" id="5401851">uint8</span><span class="op" id="5401856">(</span><span class="ident" id="5401857">c</span><span class="op" id="5401858">.</span><span class="ident" id="5401859">B</span>&nbsp;<span class="op" id="5401861">&gt;&gt;</span>&nbsp;<span class="num" id="5401864">8</span><span class="op" id="5401865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401868">p</span><span class="op" id="5401869">.</span><span class="ident" id="5401870">Pix</span><span class="op" id="5401873">[</span><span class="ident" id="5401874">i</span><span class="op" id="5401875">+</span><span class="num" id="5401876">5</span><span class="op" id="5401877">]</span>&nbsp;<span class="op" id="5401879">=</span>&nbsp;<span class="builtintype" id="5401881">uint8</span><span class="op" id="5401886">(</span><span class="ident" id="5401887">c</span><span class="op" id="5401888">.</span><span class="ident" id="5401889">B</span><span class="op" id="5401890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401893">p</span><span class="op" id="5401894">.</span><span class="ident" id="5401895">Pix</span><span class="op" id="5401898">[</span><span class="ident" id="5401899">i</span><span class="op" id="5401900">+</span><span class="num" id="5401901">6</span><span class="op" id="5401902">]</span>&nbsp;<span class="op" id="5401904">=</span>&nbsp;<span class="builtintype" id="5401906">uint8</span><span class="op" id="5401911">(</span><span class="ident" id="5401912">c</span><span class="op" id="5401913">.</span><span class="ident" id="5401914">A</span>&nbsp;<span class="op" id="5401916">&gt;&gt;</span>&nbsp;<span class="num" id="5401919">8</span><span class="op" id="5401920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401923">p</span><span class="op" id="5401924">.</span><span class="ident" id="5401925">Pix</span><span class="op" id="5401928">[</span><span class="ident" id="5401929">i</span><span class="op" id="5401930">+</span><span class="num" id="5401931">7</span><span class="op" id="5401932">]</span>&nbsp;<span class="op" id="5401934">=</span>&nbsp;<span class="builtintype" id="5401936">uint8</span><span class="op" id="5401941">(</span><span class="ident" id="5401942">c</span><span class="op" id="5401943">.</span><span class="ident" id="5401944">A</span><span class="op" id="5401945">)</span><br>
<span class="lineno">225</span><span class="op" id="5401947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5401950">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5402027">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5402099">func</span>&nbsp;<span class="op" id="5402104">(</span><span class="ident" id="5402105">p</span>&nbsp;<span class="op" id="5402107">*</span><span class="ident" id="5402108">RGBA64</span><span class="op" id="5402114">)</span>&nbsp;<span class="ident" id="5402116">SubImage</span><span class="op" id="5402124">(</span><span class="ident" id="5402125">r</span>&nbsp;<span class="ident" id="5402127">Rectangle</span><span class="op" id="5402136">)</span>&nbsp;<span class="ident" id="5402138">Image</span>&nbsp;<span class="op" id="5402144">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402147">r</span>&nbsp;<span class="op" id="5402149">=</span>&nbsp;<span class="ident" id="5402151">r</span><span class="op" id="5402152">.</span><span class="ident" id="5402153">Intersect</span><span class="op" id="5402162">(</span><span class="ident" id="5402163">p</span><span class="op" id="5402164">.</span><span class="ident" id="5402165">Rect</span><span class="op" id="5402169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5402172">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5402253">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5402335">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402385">if</span>&nbsp;<span class="ident" id="5402388">r</span><span class="op" id="5402389">.</span><span class="ident" id="5402390">Empty</span><span class="op" id="5402395">(</span><span class="op" id="5402396">)</span>&nbsp;<span class="op" id="5402398">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402402">return</span>&nbsp;<span class="op" id="5402409">&amp;</span><span class="ident" id="5402410">RGBA64</span><span class="op" id="5402416">{</span><span class="op" id="5402417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5402420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402423">i</span>&nbsp;<span class="op" id="5402425">:=</span>&nbsp;<span class="ident" id="5402428">p</span><span class="op" id="5402429">.</span><span class="ident" id="5402430">PixOffset</span><span class="op" id="5402439">(</span><span class="ident" id="5402440">r</span><span class="op" id="5402441">.</span><span class="ident" id="5402442">Min</span><span class="op" id="5402445">.</span><span class="ident" id="5402446">X</span><span class="op" id="5402447">,</span>&nbsp;<span class="ident" id="5402449">r</span><span class="op" id="5402450">.</span><span class="ident" id="5402451">Min</span><span class="op" id="5402454">.</span><span class="ident" id="5402455">Y</span><span class="op" id="5402456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402459">return</span>&nbsp;<span class="op" id="5402466">&amp;</span><span class="ident" id="5402467">RGBA64</span><span class="op" id="5402473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402477">Pix</span><span class="op" id="5402480">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5402485">p</span><span class="op" id="5402486">.</span><span class="ident" id="5402487">Pix</span><span class="op" id="5402490">[</span><span class="ident" id="5402491">i</span><span class="op" id="5402492">:</span><span class="op" id="5402493">]</span><span class="op" id="5402494">,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402498">Stride</span><span class="op" id="5402504">:</span>&nbsp;<span class="ident" id="5402506">p</span><span class="op" id="5402507">.</span><span class="ident" id="5402508">Stride</span><span class="op" id="5402514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402518">Rect</span><span class="op" id="5402522">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5402526">r</span><span class="op" id="5402527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5402530">}</span><br>
<span class="lineno"></span><span class="op" id="5402532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="5402535">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5402608">func</span>&nbsp;<span class="op" id="5402613">(</span><span class="ident" id="5402614">p</span>&nbsp;<span class="op" id="5402616">*</span><span class="ident" id="5402617">RGBA64</span><span class="op" id="5402623">)</span>&nbsp;<span class="ident" id="5402625">Opaque</span><span class="op" id="5402631">(</span><span class="op" id="5402632">)</span>&nbsp;<span class="builtintype" id="5402634">bool</span>&nbsp;<span class="op" id="5402639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402642">if</span>&nbsp;<span class="ident" id="5402645">p</span><span class="op" id="5402646">.</span><span class="ident" id="5402647">Rect</span><span class="op" id="5402651">.</span><span class="ident" id="5402652">Empty</span><span class="op" id="5402657">(</span><span class="op" id="5402658">)</span>&nbsp;<span class="op" id="5402660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402664">return</span>&nbsp;<span class="builtintype" id="5402671">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5402677">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402680">i0</span><span class="op" id="5402682">,</span>&nbsp;<span class="ident" id="5402684">i1</span>&nbsp;<span class="op" id="5402687">:=</span>&nbsp;<span class="num" id="5402690">6</span><span class="op" id="5402691">,</span>&nbsp;<span class="ident" id="5402693">p</span><span class="op" id="5402694">.</span><span class="ident" id="5402695">Rect</span><span class="op" id="5402699">.</span><span class="ident" id="5402700">Dx</span><span class="op" id="5402702">(</span><span class="op" id="5402703">)</span><span class="op" id="5402704">*</span><span class="num" id="5402705">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402708">for</span>&nbsp;<span class="ident" id="5402712">y</span>&nbsp;<span class="op" id="5402714">:=</span>&nbsp;<span class="ident" id="5402717">p</span><span class="op" id="5402718">.</span><span class="ident" id="5402719">Rect</span><span class="op" id="5402723">.</span><span class="ident" id="5402724">Min</span><span class="op" id="5402727">.</span><span class="ident" id="5402728">Y</span><span class="op" id="5402729">;</span>&nbsp;<span class="ident" id="5402731">y</span>&nbsp;<span class="op" id="5402733">&lt;</span>&nbsp;<span class="ident" id="5402735">p</span><span class="op" id="5402736">.</span><span class="ident" id="5402737">Rect</span><span class="op" id="5402741">.</span><span class="ident" id="5402742">Max</span><span class="op" id="5402745">.</span><span class="ident" id="5402746">Y</span><span class="op" id="5402747">;</span>&nbsp;<span class="ident" id="5402749">y</span><span class="op" id="5402750">++</span>&nbsp;<span class="op" id="5402753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402757">for</span>&nbsp;<span class="ident" id="5402761">i</span>&nbsp;<span class="op" id="5402763">:=</span>&nbsp;<span class="ident" id="5402766">i0</span><span class="op" id="5402768">;</span>&nbsp;<span class="ident" id="5402770">i</span>&nbsp;<span class="op" id="5402772">&lt;</span>&nbsp;<span class="ident" id="5402774">i1</span><span class="op" id="5402776">;</span>&nbsp;<span class="ident" id="5402778">i</span>&nbsp;<span class="op" id="5402780">+=</span>&nbsp;<span class="num" id="5402783">8</span>&nbsp;<span class="op" id="5402785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402790">if</span>&nbsp;<span class="ident" id="5402793">p</span><span class="op" id="5402794">.</span><span class="ident" id="5402795">Pix</span><span class="op" id="5402798">[</span><span class="ident" id="5402799">i</span><span class="op" id="5402800">+</span><span class="num" id="5402801">0</span><span class="op" id="5402802">]</span>&nbsp;<span class="op" id="5402804">!=</span>&nbsp;<span class="num" id="5402807">0xff</span>&nbsp;<span class="op" id="5402812">||</span>&nbsp;<span class="ident" id="5402815">p</span><span class="op" id="5402816">.</span><span class="ident" id="5402817">Pix</span><span class="op" id="5402820">[</span><span class="ident" id="5402821">i</span><span class="op" id="5402822">+</span><span class="num" id="5402823">1</span><span class="op" id="5402824">]</span>&nbsp;<span class="op" id="5402826">!=</span>&nbsp;<span class="num" id="5402829">0xff</span>&nbsp;<span class="op" id="5402834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402840">return</span>&nbsp;<span class="builtintype" id="5402847">false</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5402856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5402860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402864">i0</span>&nbsp;<span class="op" id="5402867">+=</span>&nbsp;<span class="ident" id="5402870">p</span><span class="op" id="5402871">.</span><span class="ident" id="5402872">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402881">i1</span>&nbsp;<span class="op" id="5402884">+=</span>&nbsp;<span class="ident" id="5402887">p</span><span class="op" id="5402888">.</span><span class="ident" id="5402889">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5402897">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402900">return</span>&nbsp;<span class="builtintype" id="5402907">true</span><br>
<span class="lineno"></span><span class="op" id="5402912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5402915">//&nbsp;NewRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5402972">func</span>&nbsp;<span class="ident" id="5402977">NewRGBA64</span><span class="op" id="5402986">(</span><span class="ident" id="5402987">r</span>&nbsp;<span class="ident" id="5402989">Rectangle</span><span class="op" id="5402998">)</span>&nbsp;<span class="op" id="5403000">*</span><span class="ident" id="5403001">RGBA64</span>&nbsp;<span class="op" id="5403008">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403011">w</span><span class="op" id="5403012">,</span>&nbsp;<span class="ident" id="5403014">h</span>&nbsp;<span class="op" id="5403016">:=</span>&nbsp;<span class="ident" id="5403019">r</span><span class="op" id="5403020">.</span><span class="ident" id="5403021">Dx</span><span class="op" id="5403023">(</span><span class="op" id="5403024">)</span><span class="op" id="5403025">,</span>&nbsp;<span class="ident" id="5403027">r</span><span class="op" id="5403028">.</span><span class="ident" id="5403029">Dy</span><span class="op" id="5403031">(</span><span class="op" id="5403032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403035">pix</span>&nbsp;<span class="op" id="5403039">:=</span>&nbsp;<span class="builtinfunc" id="5403042">make</span><span class="op" id="5403046">(</span><span class="op" id="5403047">[</span><span class="op" id="5403048">]</span><span class="builtintype" id="5403049">uint8</span><span class="op" id="5403054">,</span>&nbsp;<span class="num" id="5403056">8</span><span class="op" id="5403057">*</span><span class="ident" id="5403058">w</span><span class="op" id="5403059">*</span><span class="ident" id="5403060">h</span><span class="op" id="5403061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5403064">return</span>&nbsp;<span class="op" id="5403071">&amp;</span><span class="ident" id="5403072">RGBA64</span><span class="op" id="5403078">{</span><span class="ident" id="5403079">pix</span><span class="op" id="5403082">,</span>&nbsp;<span class="num" id="5403084">8</span>&nbsp;<span class="op" id="5403086">*</span>&nbsp;<span class="ident" id="5403088">w</span><span class="op" id="5403089">,</span>&nbsp;<span class="ident" id="5403091">r</span><span class="op" id="5403092">}</span><br>
<span class="lineno"></span><span class="op" id="5403094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5403097">//&nbsp;NRGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5403172">type</span>&nbsp;<span class="ident" id="5403177">NRGBA</span>&nbsp;<span class="keyword" id="5403183">struct</span>&nbsp;<span class="op" id="5403190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5403193">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5403261">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403329">Pix</span>&nbsp;<span class="op" id="5403333">[</span><span class="op" id="5403334">]</span><span class="builtintype" id="5403335">uint8</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5403342">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403418">Stride</span>&nbsp;<span class="builtintype" id="5403425">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5403430">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403462">Rect</span>&nbsp;<span class="ident" id="5403467">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5403477">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="5403480">func</span>&nbsp;<span class="op" id="5403485">(</span><span class="ident" id="5403486">p</span>&nbsp;<span class="op" id="5403488">*</span><span class="ident" id="5403489">NRGBA</span><span class="op" id="5403494">)</span>&nbsp;<span class="ident" id="5403496">ColorModel</span><span class="op" id="5403506">(</span><span class="op" id="5403507">)</span>&nbsp;<span class="ident" id="5403509">color</span><span class="op" id="5403514">.</span><span class="ident" id="5403515">Model</span>&nbsp;<span class="op" id="5403521">{</span>&nbsp;<span class="keyword" id="5403523">return</span>&nbsp;<span class="ident" id="5403530">color</span><span class="op" id="5403535">.</span><span class="ident" id="5403536">NRGBAModel</span>&nbsp;<span class="op" id="5403547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5403550">func</span>&nbsp;<span class="op" id="5403555">(</span><span class="ident" id="5403556">p</span>&nbsp;<span class="op" id="5403558">*</span><span class="ident" id="5403559">NRGBA</span><span class="op" id="5403564">)</span>&nbsp;<span class="ident" id="5403566">Bounds</span><span class="op" id="5403572">(</span><span class="op" id="5403573">)</span>&nbsp;<span class="ident" id="5403575">Rectangle</span>&nbsp;<span class="op" id="5403585">{</span>&nbsp;<span class="keyword" id="5403587">return</span>&nbsp;<span class="ident" id="5403594">p</span><span class="op" id="5403595">.</span><span class="ident" id="5403596">Rect</span>&nbsp;<span class="op" id="5403601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5403604">func</span>&nbsp;<span class="op" id="5403609">(</span><span class="ident" id="5403610">p</span>&nbsp;<span class="op" id="5403612">*</span><span class="ident" id="5403613">NRGBA</span><span class="op" id="5403618">)</span>&nbsp;<span class="ident" id="5403620">At</span><span class="op" id="5403622">(</span><span class="ident" id="5403623">x</span><span class="op" id="5403624">,</span>&nbsp;<span class="ident" id="5403626">y</span>&nbsp;<span class="builtintype" id="5403628">int</span><span class="op" id="5403631">)</span>&nbsp;<span class="ident" id="5403633">color</span><span class="op" id="5403638">.</span><span class="ident" id="5403639">Color</span>&nbsp;<span class="op" id="5403645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5403648">return</span>&nbsp;<span class="ident" id="5403655">p</span><span class="op" id="5403656">.</span><span class="ident" id="5403657">NRGBAAt</span><span class="op" id="5403664">(</span><span class="ident" id="5403665">x</span><span class="op" id="5403666">,</span>&nbsp;<span class="ident" id="5403668">y</span><span class="op" id="5403669">)</span><br>
<span class="lineno"></span><span class="op" id="5403671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5403674">func</span>&nbsp;<span class="op" id="5403679">(</span><span class="ident" id="5403680">p</span>&nbsp;<span class="op" id="5403682">*</span><span class="ident" id="5403683">NRGBA</span><span class="op" id="5403688">)</span>&nbsp;<span class="ident" id="5403690">NRGBAAt</span><span class="op" id="5403697">(</span><span class="ident" id="5403698">x</span><span class="op" id="5403699">,</span>&nbsp;<span class="ident" id="5403701">y</span>&nbsp;<span class="builtintype" id="5403703">int</span><span class="op" id="5403706">)</span>&nbsp;<span class="ident" id="5403708">color</span><span class="op" id="5403713">.</span><span class="ident" id="5403714">NRGBA</span>&nbsp;<span class="op" id="5403720">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5403723">if</span>&nbsp;<span class="op" id="5403726">!</span><span class="op" id="5403727">(</span><span class="ident" id="5403728">Point</span><span class="op" id="5403733">{</span><span class="ident" id="5403734">x</span><span class="op" id="5403735">,</span>&nbsp;<span class="ident" id="5403737">y</span><span class="op" id="5403738">}</span><span class="op" id="5403739">.</span><span class="ident" id="5403740">In</span><span class="op" id="5403742">(</span><span class="ident" id="5403743">p</span><span class="op" id="5403744">.</span><span class="ident" id="5403745">Rect</span><span class="op" id="5403749">)</span><span class="op" id="5403750">)</span>&nbsp;<span class="op" id="5403752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5403756">return</span>&nbsp;<span class="ident" id="5403763">color</span><span class="op" id="5403768">.</span><span class="ident" id="5403769">NRGBA</span><span class="op" id="5403774">{</span><span class="op" id="5403775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5403778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403781">i</span>&nbsp;<span class="op" id="5403783">:=</span>&nbsp;<span class="ident" id="5403786">p</span><span class="op" id="5403787">.</span><span class="ident" id="5403788">PixOffset</span><span class="op" id="5403797">(</span><span class="ident" id="5403798">x</span><span class="op" id="5403799">,</span>&nbsp;<span class="ident" id="5403801">y</span><span class="op" id="5403802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5403805">return</span>&nbsp;<span class="ident" id="5403812">color</span><span class="op" id="5403817">.</span><span class="ident" id="5403818">NRGBA</span><span class="op" id="5403823">{</span><span class="ident" id="5403824">p</span><span class="op" id="5403825">.</span><span class="ident" id="5403826">Pix</span><span class="op" id="5403829">[</span><span class="ident" id="5403830">i</span><span class="op" id="5403831">+</span><span class="num" id="5403832">0</span><span class="op" id="5403833">]</span><span class="op" id="5403834">,</span>&nbsp;<span class="ident" id="5403836">p</span><span class="op" id="5403837">.</span><span class="ident" id="5403838">Pix</span><span class="op" id="5403841">[</span><span class="ident" id="5403842">i</span><span class="op" id="5403843">+</span><span class="num" id="5403844">1</span><span class="op" id="5403845">]</span><span class="op" id="5403846">,</span>&nbsp;<span class="ident" id="5403848">p</span><span class="op" id="5403849">.</span><span class="ident" id="5403850">Pix</span><span class="op" id="5403853">[</span><span class="ident" id="5403854">i</span><span class="op" id="5403855">+</span><span class="num" id="5403856">2</span><span class="op" id="5403857">]</span><span class="op" id="5403858">,</span>&nbsp;<span class="ident" id="5403860">p</span><span class="op" id="5403861">.</span><span class="ident" id="5403862">Pix</span><span class="op" id="5403865">[</span><span class="ident" id="5403866">i</span><span class="op" id="5403867">+</span><span class="num" id="5403868">3</span><span class="op" id="5403869">]</span><span class="op" id="5403870">}</span><br>
<span class="lineno">295</span><span class="op" id="5403872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5403875">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5403954">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5403978">func</span>&nbsp;<span class="op" id="5403983">(</span><span class="ident" id="5403984">p</span>&nbsp;<span class="op" id="5403986">*</span><span class="ident" id="5403987">NRGBA</span><span class="op" id="5403992">)</span>&nbsp;<span class="ident" id="5403994">PixOffset</span><span class="op" id="5404003">(</span><span class="ident" id="5404004">x</span><span class="op" id="5404005">,</span>&nbsp;<span class="ident" id="5404007">y</span>&nbsp;<span class="builtintype" id="5404009">int</span><span class="op" id="5404012">)</span>&nbsp;<span class="builtintype" id="5404014">int</span>&nbsp;<span class="op" id="5404018">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404021">return</span>&nbsp;<span class="op" id="5404028">(</span><span class="ident" id="5404029">y</span><span class="op" id="5404030">-</span><span class="ident" id="5404031">p</span><span class="op" id="5404032">.</span><span class="ident" id="5404033">Rect</span><span class="op" id="5404037">.</span><span class="ident" id="5404038">Min</span><span class="op" id="5404041">.</span><span class="ident" id="5404042">Y</span><span class="op" id="5404043">)</span><span class="op" id="5404044">*</span><span class="ident" id="5404045">p</span><span class="op" id="5404046">.</span><span class="ident" id="5404047">Stride</span>&nbsp;<span class="op" id="5404054">+</span>&nbsp;<span class="op" id="5404056">(</span><span class="ident" id="5404057">x</span><span class="op" id="5404058">-</span><span class="ident" id="5404059">p</span><span class="op" id="5404060">.</span><span class="ident" id="5404061">Rect</span><span class="op" id="5404065">.</span><span class="ident" id="5404066">Min</span><span class="op" id="5404069">.</span><span class="ident" id="5404070">X</span><span class="op" id="5404071">)</span><span class="op" id="5404072">*</span><span class="num" id="5404073">4</span><br>
<span class="lineno"></span><span class="op" id="5404075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5404078">func</span>&nbsp;<span class="op" id="5404083">(</span><span class="ident" id="5404084">p</span>&nbsp;<span class="op" id="5404086">*</span><span class="ident" id="5404087">NRGBA</span><span class="op" id="5404092">)</span>&nbsp;<span class="ident" id="5404094">Set</span><span class="op" id="5404097">(</span><span class="ident" id="5404098">x</span><span class="op" id="5404099">,</span>&nbsp;<span class="ident" id="5404101">y</span>&nbsp;<span class="builtintype" id="5404103">int</span><span class="op" id="5404106">,</span>&nbsp;<span class="ident" id="5404108">c</span>&nbsp;<span class="ident" id="5404110">color</span><span class="op" id="5404115">.</span><span class="ident" id="5404116">Color</span><span class="op" id="5404121">)</span>&nbsp;<span class="op" id="5404123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404126">if</span>&nbsp;<span class="op" id="5404129">!</span><span class="op" id="5404130">(</span><span class="ident" id="5404131">Point</span><span class="op" id="5404136">{</span><span class="ident" id="5404137">x</span><span class="op" id="5404138">,</span>&nbsp;<span class="ident" id="5404140">y</span><span class="op" id="5404141">}</span><span class="op" id="5404142">.</span><span class="ident" id="5404143">In</span><span class="op" id="5404145">(</span><span class="ident" id="5404146">p</span><span class="op" id="5404147">.</span><span class="ident" id="5404148">Rect</span><span class="op" id="5404152">)</span><span class="op" id="5404153">)</span>&nbsp;<span class="op" id="5404155">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404159">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5404167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404170">i</span>&nbsp;<span class="op" id="5404172">:=</span>&nbsp;<span class="ident" id="5404175">p</span><span class="op" id="5404176">.</span><span class="ident" id="5404177">PixOffset</span><span class="op" id="5404186">(</span><span class="ident" id="5404187">x</span><span class="op" id="5404188">,</span>&nbsp;<span class="ident" id="5404190">y</span><span class="op" id="5404191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404194">c1</span>&nbsp;<span class="op" id="5404197">:=</span>&nbsp;<span class="ident" id="5404200">color</span><span class="op" id="5404205">.</span><span class="ident" id="5404206">NRGBAModel</span><span class="op" id="5404216">.</span><span class="ident" id="5404217">Convert</span><span class="op" id="5404224">(</span><span class="ident" id="5404225">c</span><span class="op" id="5404226">)</span><span class="op" id="5404227">.</span><span class="op" id="5404228">(</span><span class="ident" id="5404229">color</span><span class="op" id="5404234">.</span><span class="ident" id="5404235">NRGBA</span><span class="op" id="5404240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404243">p</span><span class="op" id="5404244">.</span><span class="ident" id="5404245">Pix</span><span class="op" id="5404248">[</span><span class="ident" id="5404249">i</span><span class="op" id="5404250">+</span><span class="num" id="5404251">0</span><span class="op" id="5404252">]</span>&nbsp;<span class="op" id="5404254">=</span>&nbsp;<span class="ident" id="5404256">c1</span><span class="op" id="5404258">.</span><span class="ident" id="5404259">R</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404262">p</span><span class="op" id="5404263">.</span><span class="ident" id="5404264">Pix</span><span class="op" id="5404267">[</span><span class="ident" id="5404268">i</span><span class="op" id="5404269">+</span><span class="num" id="5404270">1</span><span class="op" id="5404271">]</span>&nbsp;<span class="op" id="5404273">=</span>&nbsp;<span class="ident" id="5404275">c1</span><span class="op" id="5404277">.</span><span class="ident" id="5404278">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404281">p</span><span class="op" id="5404282">.</span><span class="ident" id="5404283">Pix</span><span class="op" id="5404286">[</span><span class="ident" id="5404287">i</span><span class="op" id="5404288">+</span><span class="num" id="5404289">2</span><span class="op" id="5404290">]</span>&nbsp;<span class="op" id="5404292">=</span>&nbsp;<span class="ident" id="5404294">c1</span><span class="op" id="5404296">.</span><span class="ident" id="5404297">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404300">p</span><span class="op" id="5404301">.</span><span class="ident" id="5404302">Pix</span><span class="op" id="5404305">[</span><span class="ident" id="5404306">i</span><span class="op" id="5404307">+</span><span class="num" id="5404308">3</span><span class="op" id="5404309">]</span>&nbsp;<span class="op" id="5404311">=</span>&nbsp;<span class="ident" id="5404313">c1</span><span class="op" id="5404315">.</span><span class="ident" id="5404316">A</span><br>
<span class="lineno"></span><span class="op" id="5404318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="5404321">func</span>&nbsp;<span class="op" id="5404326">(</span><span class="ident" id="5404327">p</span>&nbsp;<span class="op" id="5404329">*</span><span class="ident" id="5404330">NRGBA</span><span class="op" id="5404335">)</span>&nbsp;<span class="ident" id="5404337">SetNRGBA</span><span class="op" id="5404345">(</span><span class="ident" id="5404346">x</span><span class="op" id="5404347">,</span>&nbsp;<span class="ident" id="5404349">y</span>&nbsp;<span class="builtintype" id="5404351">int</span><span class="op" id="5404354">,</span>&nbsp;<span class="ident" id="5404356">c</span>&nbsp;<span class="ident" id="5404358">color</span><span class="op" id="5404363">.</span><span class="ident" id="5404364">NRGBA</span><span class="op" id="5404369">)</span>&nbsp;<span class="op" id="5404371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404374">if</span>&nbsp;<span class="op" id="5404377">!</span><span class="op" id="5404378">(</span><span class="ident" id="5404379">Point</span><span class="op" id="5404384">{</span><span class="ident" id="5404385">x</span><span class="op" id="5404386">,</span>&nbsp;<span class="ident" id="5404388">y</span><span class="op" id="5404389">}</span><span class="op" id="5404390">.</span><span class="ident" id="5404391">In</span><span class="op" id="5404393">(</span><span class="ident" id="5404394">p</span><span class="op" id="5404395">.</span><span class="ident" id="5404396">Rect</span><span class="op" id="5404400">)</span><span class="op" id="5404401">)</span>&nbsp;<span class="op" id="5404403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404407">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5404415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404418">i</span>&nbsp;<span class="op" id="5404420">:=</span>&nbsp;<span class="ident" id="5404423">p</span><span class="op" id="5404424">.</span><span class="ident" id="5404425">PixOffset</span><span class="op" id="5404434">(</span><span class="ident" id="5404435">x</span><span class="op" id="5404436">,</span>&nbsp;<span class="ident" id="5404438">y</span><span class="op" id="5404439">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404442">p</span><span class="op" id="5404443">.</span><span class="ident" id="5404444">Pix</span><span class="op" id="5404447">[</span><span class="ident" id="5404448">i</span><span class="op" id="5404449">+</span><span class="num" id="5404450">0</span><span class="op" id="5404451">]</span>&nbsp;<span class="op" id="5404453">=</span>&nbsp;<span class="ident" id="5404455">c</span><span class="op" id="5404456">.</span><span class="ident" id="5404457">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404460">p</span><span class="op" id="5404461">.</span><span class="ident" id="5404462">Pix</span><span class="op" id="5404465">[</span><span class="ident" id="5404466">i</span><span class="op" id="5404467">+</span><span class="num" id="5404468">1</span><span class="op" id="5404469">]</span>&nbsp;<span class="op" id="5404471">=</span>&nbsp;<span class="ident" id="5404473">c</span><span class="op" id="5404474">.</span><span class="ident" id="5404475">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404478">p</span><span class="op" id="5404479">.</span><span class="ident" id="5404480">Pix</span><span class="op" id="5404483">[</span><span class="ident" id="5404484">i</span><span class="op" id="5404485">+</span><span class="num" id="5404486">2</span><span class="op" id="5404487">]</span>&nbsp;<span class="op" id="5404489">=</span>&nbsp;<span class="ident" id="5404491">c</span><span class="op" id="5404492">.</span><span class="ident" id="5404493">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404496">p</span><span class="op" id="5404497">.</span><span class="ident" id="5404498">Pix</span><span class="op" id="5404501">[</span><span class="ident" id="5404502">i</span><span class="op" id="5404503">+</span><span class="num" id="5404504">3</span><span class="op" id="5404505">]</span>&nbsp;<span class="op" id="5404507">=</span>&nbsp;<span class="ident" id="5404509">c</span><span class="op" id="5404510">.</span><span class="ident" id="5404511">A</span><br>
<span class="lineno"></span><span class="op" id="5404513">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="5404516">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5404593">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5404665">func</span>&nbsp;<span class="op" id="5404670">(</span><span class="ident" id="5404671">p</span>&nbsp;<span class="op" id="5404673">*</span><span class="ident" id="5404674">NRGBA</span><span class="op" id="5404679">)</span>&nbsp;<span class="ident" id="5404681">SubImage</span><span class="op" id="5404689">(</span><span class="ident" id="5404690">r</span>&nbsp;<span class="ident" id="5404692">Rectangle</span><span class="op" id="5404701">)</span>&nbsp;<span class="ident" id="5404703">Image</span>&nbsp;<span class="op" id="5404709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404712">r</span>&nbsp;<span class="op" id="5404714">=</span>&nbsp;<span class="ident" id="5404716">r</span><span class="op" id="5404717">.</span><span class="ident" id="5404718">Intersect</span><span class="op" id="5404727">(</span><span class="ident" id="5404728">p</span><span class="op" id="5404729">.</span><span class="ident" id="5404730">Rect</span><span class="op" id="5404734">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404737">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404818">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404900">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404950">if</span>&nbsp;<span class="ident" id="5404953">r</span><span class="op" id="5404954">.</span><span class="ident" id="5404955">Empty</span><span class="op" id="5404960">(</span><span class="op" id="5404961">)</span>&nbsp;<span class="op" id="5404963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404967">return</span>&nbsp;<span class="op" id="5404974">&amp;</span><span class="ident" id="5404975">NRGBA</span><span class="op" id="5404980">{</span><span class="op" id="5404981">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5404984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404987">i</span>&nbsp;<span class="op" id="5404989">:=</span>&nbsp;<span class="ident" id="5404992">p</span><span class="op" id="5404993">.</span><span class="ident" id="5404994">PixOffset</span><span class="op" id="5405003">(</span><span class="ident" id="5405004">r</span><span class="op" id="5405005">.</span><span class="ident" id="5405006">Min</span><span class="op" id="5405009">.</span><span class="ident" id="5405010">X</span><span class="op" id="5405011">,</span>&nbsp;<span class="ident" id="5405013">r</span><span class="op" id="5405014">.</span><span class="ident" id="5405015">Min</span><span class="op" id="5405018">.</span><span class="ident" id="5405019">Y</span><span class="op" id="5405020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405023">return</span>&nbsp;<span class="op" id="5405030">&amp;</span><span class="ident" id="5405031">NRGBA</span><span class="op" id="5405036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405040">Pix</span><span class="op" id="5405043">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5405048">p</span><span class="op" id="5405049">.</span><span class="ident" id="5405050">Pix</span><span class="op" id="5405053">[</span><span class="ident" id="5405054">i</span><span class="op" id="5405055">:</span><span class="op" id="5405056">]</span><span class="op" id="5405057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405061">Stride</span><span class="op" id="5405067">:</span>&nbsp;<span class="ident" id="5405069">p</span><span class="op" id="5405070">.</span><span class="ident" id="5405071">Stride</span><span class="op" id="5405077">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405081">Rect</span><span class="op" id="5405085">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5405089">r</span><span class="op" id="5405090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5405093">}</span><br>
<span class="lineno"></span><span class="op" id="5405095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5405098">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno">345</span><span class="keyword" id="5405171">func</span>&nbsp;<span class="op" id="5405176">(</span><span class="ident" id="5405177">p</span>&nbsp;<span class="op" id="5405179">*</span><span class="ident" id="5405180">NRGBA</span><span class="op" id="5405185">)</span>&nbsp;<span class="ident" id="5405187">Opaque</span><span class="op" id="5405193">(</span><span class="op" id="5405194">)</span>&nbsp;<span class="builtintype" id="5405196">bool</span>&nbsp;<span class="op" id="5405201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405204">if</span>&nbsp;<span class="ident" id="5405207">p</span><span class="op" id="5405208">.</span><span class="ident" id="5405209">Rect</span><span class="op" id="5405213">.</span><span class="ident" id="5405214">Empty</span><span class="op" id="5405219">(</span><span class="op" id="5405220">)</span>&nbsp;<span class="op" id="5405222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405226">return</span>&nbsp;<span class="builtintype" id="5405233">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5405239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405242">i0</span><span class="op" id="5405244">,</span>&nbsp;<span class="ident" id="5405246">i1</span>&nbsp;<span class="op" id="5405249">:=</span>&nbsp;<span class="num" id="5405252">3</span><span class="op" id="5405253">,</span>&nbsp;<span class="ident" id="5405255">p</span><span class="op" id="5405256">.</span><span class="ident" id="5405257">Rect</span><span class="op" id="5405261">.</span><span class="ident" id="5405262">Dx</span><span class="op" id="5405264">(</span><span class="op" id="5405265">)</span><span class="op" id="5405266">*</span><span class="num" id="5405267">4</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405270">for</span>&nbsp;<span class="ident" id="5405274">y</span>&nbsp;<span class="op" id="5405276">:=</span>&nbsp;<span class="ident" id="5405279">p</span><span class="op" id="5405280">.</span><span class="ident" id="5405281">Rect</span><span class="op" id="5405285">.</span><span class="ident" id="5405286">Min</span><span class="op" id="5405289">.</span><span class="ident" id="5405290">Y</span><span class="op" id="5405291">;</span>&nbsp;<span class="ident" id="5405293">y</span>&nbsp;<span class="op" id="5405295">&lt;</span>&nbsp;<span class="ident" id="5405297">p</span><span class="op" id="5405298">.</span><span class="ident" id="5405299">Rect</span><span class="op" id="5405303">.</span><span class="ident" id="5405304">Max</span><span class="op" id="5405307">.</span><span class="ident" id="5405308">Y</span><span class="op" id="5405309">;</span>&nbsp;<span class="ident" id="5405311">y</span><span class="op" id="5405312">++</span>&nbsp;<span class="op" id="5405315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405319">for</span>&nbsp;<span class="ident" id="5405323">i</span>&nbsp;<span class="op" id="5405325">:=</span>&nbsp;<span class="ident" id="5405328">i0</span><span class="op" id="5405330">;</span>&nbsp;<span class="ident" id="5405332">i</span>&nbsp;<span class="op" id="5405334">&lt;</span>&nbsp;<span class="ident" id="5405336">i1</span><span class="op" id="5405338">;</span>&nbsp;<span class="ident" id="5405340">i</span>&nbsp;<span class="op" id="5405342">+=</span>&nbsp;<span class="num" id="5405345">4</span>&nbsp;<span class="op" id="5405347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405352">if</span>&nbsp;<span class="ident" id="5405355">p</span><span class="op" id="5405356">.</span><span class="ident" id="5405357">Pix</span><span class="op" id="5405360">[</span><span class="ident" id="5405361">i</span><span class="op" id="5405362">]</span>&nbsp;<span class="op" id="5405364">!=</span>&nbsp;<span class="num" id="5405367">0xff</span>&nbsp;<span class="op" id="5405372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405378">return</span>&nbsp;<span class="builtintype" id="5405385">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5405394">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5405398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405402">i0</span>&nbsp;<span class="op" id="5405405">+=</span>&nbsp;<span class="ident" id="5405408">p</span><span class="op" id="5405409">.</span><span class="ident" id="5405410">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405419">i1</span>&nbsp;<span class="op" id="5405422">+=</span>&nbsp;<span class="ident" id="5405425">p</span><span class="op" id="5405426">.</span><span class="ident" id="5405427">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5405435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405438">return</span>&nbsp;<span class="builtintype" id="5405445">true</span><br>
<span class="lineno">360</span><span class="op" id="5405450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5405453">//&nbsp;NewNRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5405508">func</span>&nbsp;<span class="ident" id="5405513">NewNRGBA</span><span class="op" id="5405521">(</span><span class="ident" id="5405522">r</span>&nbsp;<span class="ident" id="5405524">Rectangle</span><span class="op" id="5405533">)</span>&nbsp;<span class="op" id="5405535">*</span><span class="ident" id="5405536">NRGBA</span>&nbsp;<span class="op" id="5405542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405545">w</span><span class="op" id="5405546">,</span>&nbsp;<span class="ident" id="5405548">h</span>&nbsp;<span class="op" id="5405550">:=</span>&nbsp;<span class="ident" id="5405553">r</span><span class="op" id="5405554">.</span><span class="ident" id="5405555">Dx</span><span class="op" id="5405557">(</span><span class="op" id="5405558">)</span><span class="op" id="5405559">,</span>&nbsp;<span class="ident" id="5405561">r</span><span class="op" id="5405562">.</span><span class="ident" id="5405563">Dy</span><span class="op" id="5405565">(</span><span class="op" id="5405566">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405569">pix</span>&nbsp;<span class="op" id="5405573">:=</span>&nbsp;<span class="builtinfunc" id="5405576">make</span><span class="op" id="5405580">(</span><span class="op" id="5405581">[</span><span class="op" id="5405582">]</span><span class="builtintype" id="5405583">uint8</span><span class="op" id="5405588">,</span>&nbsp;<span class="num" id="5405590">4</span><span class="op" id="5405591">*</span><span class="ident" id="5405592">w</span><span class="op" id="5405593">*</span><span class="ident" id="5405594">h</span><span class="op" id="5405595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405598">return</span>&nbsp;<span class="op" id="5405605">&amp;</span><span class="ident" id="5405606">NRGBA</span><span class="op" id="5405611">{</span><span class="ident" id="5405612">pix</span><span class="op" id="5405615">,</span>&nbsp;<span class="num" id="5405617">4</span>&nbsp;<span class="op" id="5405619">*</span>&nbsp;<span class="ident" id="5405621">w</span><span class="op" id="5405622">,</span>&nbsp;<span class="ident" id="5405624">r</span><span class="op" id="5405625">}</span><br>
<span class="lineno"></span><span class="op" id="5405627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5405630">//&nbsp;NRGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA64&nbsp;values.</span><br>
<span class="lineno">370</span><span class="keyword" id="5405709">type</span>&nbsp;<span class="ident" id="5405714">NRGBA64</span>&nbsp;<span class="keyword" id="5405722">struct</span>&nbsp;<span class="op" id="5405729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405732">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405822">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405890">Pix</span>&nbsp;<span class="op" id="5405894">[</span><span class="op" id="5405895">]</span><span class="builtintype" id="5405896">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405903">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405979">Stride</span>&nbsp;<span class="builtintype" id="5405986">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405991">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406023">Rect</span>&nbsp;<span class="ident" id="5406028">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5406038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="5406041">func</span>&nbsp;<span class="op" id="5406046">(</span><span class="ident" id="5406047">p</span>&nbsp;<span class="op" id="5406049">*</span><span class="ident" id="5406050">NRGBA64</span><span class="op" id="5406057">)</span>&nbsp;<span class="ident" id="5406059">ColorModel</span><span class="op" id="5406069">(</span><span class="op" id="5406070">)</span>&nbsp;<span class="ident" id="5406072">color</span><span class="op" id="5406077">.</span><span class="ident" id="5406078">Model</span>&nbsp;<span class="op" id="5406084">{</span>&nbsp;<span class="keyword" id="5406086">return</span>&nbsp;<span class="ident" id="5406093">color</span><span class="op" id="5406098">.</span><span class="ident" id="5406099">NRGBA64Model</span>&nbsp;<span class="op" id="5406112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5406115">func</span>&nbsp;<span class="op" id="5406120">(</span><span class="ident" id="5406121">p</span>&nbsp;<span class="op" id="5406123">*</span><span class="ident" id="5406124">NRGBA64</span><span class="op" id="5406131">)</span>&nbsp;<span class="ident" id="5406133">Bounds</span><span class="op" id="5406139">(</span><span class="op" id="5406140">)</span>&nbsp;<span class="ident" id="5406142">Rectangle</span>&nbsp;<span class="op" id="5406152">{</span>&nbsp;<span class="keyword" id="5406154">return</span>&nbsp;<span class="ident" id="5406161">p</span><span class="op" id="5406162">.</span><span class="ident" id="5406163">Rect</span>&nbsp;<span class="op" id="5406168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5406171">func</span>&nbsp;<span class="op" id="5406176">(</span><span class="ident" id="5406177">p</span>&nbsp;<span class="op" id="5406179">*</span><span class="ident" id="5406180">NRGBA64</span><span class="op" id="5406187">)</span>&nbsp;<span class="ident" id="5406189">At</span><span class="op" id="5406191">(</span><span class="ident" id="5406192">x</span><span class="op" id="5406193">,</span>&nbsp;<span class="ident" id="5406195">y</span>&nbsp;<span class="builtintype" id="5406197">int</span><span class="op" id="5406200">)</span>&nbsp;<span class="ident" id="5406202">color</span><span class="op" id="5406207">.</span><span class="ident" id="5406208">Color</span>&nbsp;<span class="op" id="5406214">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406217">return</span>&nbsp;<span class="ident" id="5406224">p</span><span class="op" id="5406225">.</span><span class="ident" id="5406226">NRGBA64At</span><span class="op" id="5406235">(</span><span class="ident" id="5406236">x</span><span class="op" id="5406237">,</span>&nbsp;<span class="ident" id="5406239">y</span><span class="op" id="5406240">)</span><br>
<span class="lineno"></span><span class="op" id="5406242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5406245">func</span>&nbsp;<span class="op" id="5406250">(</span><span class="ident" id="5406251">p</span>&nbsp;<span class="op" id="5406253">*</span><span class="ident" id="5406254">NRGBA64</span><span class="op" id="5406261">)</span>&nbsp;<span class="ident" id="5406263">NRGBA64At</span><span class="op" id="5406272">(</span><span class="ident" id="5406273">x</span><span class="op" id="5406274">,</span>&nbsp;<span class="ident" id="5406276">y</span>&nbsp;<span class="builtintype" id="5406278">int</span><span class="op" id="5406281">)</span>&nbsp;<span class="ident" id="5406283">color</span><span class="op" id="5406288">.</span><span class="ident" id="5406289">NRGBA64</span>&nbsp;<span class="op" id="5406297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406300">if</span>&nbsp;<span class="op" id="5406303">!</span><span class="op" id="5406304">(</span><span class="ident" id="5406305">Point</span><span class="op" id="5406310">{</span><span class="ident" id="5406311">x</span><span class="op" id="5406312">,</span>&nbsp;<span class="ident" id="5406314">y</span><span class="op" id="5406315">}</span><span class="op" id="5406316">.</span><span class="ident" id="5406317">In</span><span class="op" id="5406319">(</span><span class="ident" id="5406320">p</span><span class="op" id="5406321">.</span><span class="ident" id="5406322">Rect</span><span class="op" id="5406326">)</span><span class="op" id="5406327">)</span>&nbsp;<span class="op" id="5406329">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406333">return</span>&nbsp;<span class="ident" id="5406340">color</span><span class="op" id="5406345">.</span><span class="ident" id="5406346">NRGBA64</span><span class="op" id="5406353">{</span><span class="op" id="5406354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406360">i</span>&nbsp;<span class="op" id="5406362">:=</span>&nbsp;<span class="ident" id="5406365">p</span><span class="op" id="5406366">.</span><span class="ident" id="5406367">PixOffset</span><span class="op" id="5406376">(</span><span class="ident" id="5406377">x</span><span class="op" id="5406378">,</span>&nbsp;<span class="ident" id="5406380">y</span><span class="op" id="5406381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406384">return</span>&nbsp;<span class="ident" id="5406391">color</span><span class="op" id="5406396">.</span><span class="ident" id="5406397">NRGBA64</span><span class="op" id="5406404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5406408">uint16</span><span class="op" id="5406414">(</span><span class="ident" id="5406415">p</span><span class="op" id="5406416">.</span><span class="ident" id="5406417">Pix</span><span class="op" id="5406420">[</span><span class="ident" id="5406421">i</span><span class="op" id="5406422">+</span><span class="num" id="5406423">0</span><span class="op" id="5406424">]</span><span class="op" id="5406425">)</span><span class="op" id="5406426">&lt;&lt;</span><span class="num" id="5406428">8</span>&nbsp;<span class="op" id="5406430">|</span>&nbsp;<span class="builtintype" id="5406432">uint16</span><span class="op" id="5406438">(</span><span class="ident" id="5406439">p</span><span class="op" id="5406440">.</span><span class="ident" id="5406441">Pix</span><span class="op" id="5406444">[</span><span class="ident" id="5406445">i</span><span class="op" id="5406446">+</span><span class="num" id="5406447">1</span><span class="op" id="5406448">]</span><span class="op" id="5406449">)</span><span class="op" id="5406450">,</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5406454">uint16</span><span class="op" id="5406460">(</span><span class="ident" id="5406461">p</span><span class="op" id="5406462">.</span><span class="ident" id="5406463">Pix</span><span class="op" id="5406466">[</span><span class="ident" id="5406467">i</span><span class="op" id="5406468">+</span><span class="num" id="5406469">2</span><span class="op" id="5406470">]</span><span class="op" id="5406471">)</span><span class="op" id="5406472">&lt;&lt;</span><span class="num" id="5406474">8</span>&nbsp;<span class="op" id="5406476">|</span>&nbsp;<span class="builtintype" id="5406478">uint16</span><span class="op" id="5406484">(</span><span class="ident" id="5406485">p</span><span class="op" id="5406486">.</span><span class="ident" id="5406487">Pix</span><span class="op" id="5406490">[</span><span class="ident" id="5406491">i</span><span class="op" id="5406492">+</span><span class="num" id="5406493">3</span><span class="op" id="5406494">]</span><span class="op" id="5406495">)</span><span class="op" id="5406496">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5406500">uint16</span><span class="op" id="5406506">(</span><span class="ident" id="5406507">p</span><span class="op" id="5406508">.</span><span class="ident" id="5406509">Pix</span><span class="op" id="5406512">[</span><span class="ident" id="5406513">i</span><span class="op" id="5406514">+</span><span class="num" id="5406515">4</span><span class="op" id="5406516">]</span><span class="op" id="5406517">)</span><span class="op" id="5406518">&lt;&lt;</span><span class="num" id="5406520">8</span>&nbsp;<span class="op" id="5406522">|</span>&nbsp;<span class="builtintype" id="5406524">uint16</span><span class="op" id="5406530">(</span><span class="ident" id="5406531">p</span><span class="op" id="5406532">.</span><span class="ident" id="5406533">Pix</span><span class="op" id="5406536">[</span><span class="ident" id="5406537">i</span><span class="op" id="5406538">+</span><span class="num" id="5406539">5</span><span class="op" id="5406540">]</span><span class="op" id="5406541">)</span><span class="op" id="5406542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5406546">uint16</span><span class="op" id="5406552">(</span><span class="ident" id="5406553">p</span><span class="op" id="5406554">.</span><span class="ident" id="5406555">Pix</span><span class="op" id="5406558">[</span><span class="ident" id="5406559">i</span><span class="op" id="5406560">+</span><span class="num" id="5406561">6</span><span class="op" id="5406562">]</span><span class="op" id="5406563">)</span><span class="op" id="5406564">&lt;&lt;</span><span class="num" id="5406566">8</span>&nbsp;<span class="op" id="5406568">|</span>&nbsp;<span class="builtintype" id="5406570">uint16</span><span class="op" id="5406576">(</span><span class="ident" id="5406577">p</span><span class="op" id="5406578">.</span><span class="ident" id="5406579">Pix</span><span class="op" id="5406582">[</span><span class="ident" id="5406583">i</span><span class="op" id="5406584">+</span><span class="num" id="5406585">7</span><span class="op" id="5406586">]</span><span class="op" id="5406587">)</span><span class="op" id="5406588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406591">}</span><br>
<span class="lineno"></span><span class="op" id="5406593">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="comment" id="5406596">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5406675">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5406699">func</span>&nbsp;<span class="op" id="5406704">(</span><span class="ident" id="5406705">p</span>&nbsp;<span class="op" id="5406707">*</span><span class="ident" id="5406708">NRGBA64</span><span class="op" id="5406715">)</span>&nbsp;<span class="ident" id="5406717">PixOffset</span><span class="op" id="5406726">(</span><span class="ident" id="5406727">x</span><span class="op" id="5406728">,</span>&nbsp;<span class="ident" id="5406730">y</span>&nbsp;<span class="builtintype" id="5406732">int</span><span class="op" id="5406735">)</span>&nbsp;<span class="builtintype" id="5406737">int</span>&nbsp;<span class="op" id="5406741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406744">return</span>&nbsp;<span class="op" id="5406751">(</span><span class="ident" id="5406752">y</span><span class="op" id="5406753">-</span><span class="ident" id="5406754">p</span><span class="op" id="5406755">.</span><span class="ident" id="5406756">Rect</span><span class="op" id="5406760">.</span><span class="ident" id="5406761">Min</span><span class="op" id="5406764">.</span><span class="ident" id="5406765">Y</span><span class="op" id="5406766">)</span><span class="op" id="5406767">*</span><span class="ident" id="5406768">p</span><span class="op" id="5406769">.</span><span class="ident" id="5406770">Stride</span>&nbsp;<span class="op" id="5406777">+</span>&nbsp;<span class="op" id="5406779">(</span><span class="ident" id="5406780">x</span><span class="op" id="5406781">-</span><span class="ident" id="5406782">p</span><span class="op" id="5406783">.</span><span class="ident" id="5406784">Rect</span><span class="op" id="5406788">.</span><span class="ident" id="5406789">Min</span><span class="op" id="5406792">.</span><span class="ident" id="5406793">X</span><span class="op" id="5406794">)</span><span class="op" id="5406795">*</span><span class="num" id="5406796">8</span><br>
<span class="lineno">405</span><span class="op" id="5406798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5406801">func</span>&nbsp;<span class="op" id="5406806">(</span><span class="ident" id="5406807">p</span>&nbsp;<span class="op" id="5406809">*</span><span class="ident" id="5406810">NRGBA64</span><span class="op" id="5406817">)</span>&nbsp;<span class="ident" id="5406819">Set</span><span class="op" id="5406822">(</span><span class="ident" id="5406823">x</span><span class="op" id="5406824">,</span>&nbsp;<span class="ident" id="5406826">y</span>&nbsp;<span class="builtintype" id="5406828">int</span><span class="op" id="5406831">,</span>&nbsp;<span class="ident" id="5406833">c</span>&nbsp;<span class="ident" id="5406835">color</span><span class="op" id="5406840">.</span><span class="ident" id="5406841">Color</span><span class="op" id="5406846">)</span>&nbsp;<span class="op" id="5406848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406851">if</span>&nbsp;<span class="op" id="5406854">!</span><span class="op" id="5406855">(</span><span class="ident" id="5406856">Point</span><span class="op" id="5406861">{</span><span class="ident" id="5406862">x</span><span class="op" id="5406863">,</span>&nbsp;<span class="ident" id="5406865">y</span><span class="op" id="5406866">}</span><span class="op" id="5406867">.</span><span class="ident" id="5406868">In</span><span class="op" id="5406870">(</span><span class="ident" id="5406871">p</span><span class="op" id="5406872">.</span><span class="ident" id="5406873">Rect</span><span class="op" id="5406877">)</span><span class="op" id="5406878">)</span>&nbsp;<span class="op" id="5406880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406884">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406895">i</span>&nbsp;<span class="op" id="5406897">:=</span>&nbsp;<span class="ident" id="5406900">p</span><span class="op" id="5406901">.</span><span class="ident" id="5406902">PixOffset</span><span class="op" id="5406911">(</span><span class="ident" id="5406912">x</span><span class="op" id="5406913">,</span>&nbsp;<span class="ident" id="5406915">y</span><span class="op" id="5406916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406919">c1</span>&nbsp;<span class="op" id="5406922">:=</span>&nbsp;<span class="ident" id="5406925">color</span><span class="op" id="5406930">.</span><span class="ident" id="5406931">NRGBA64Model</span><span class="op" id="5406943">.</span><span class="ident" id="5406944">Convert</span><span class="op" id="5406951">(</span><span class="ident" id="5406952">c</span><span class="op" id="5406953">)</span><span class="op" id="5406954">.</span><span class="op" id="5406955">(</span><span class="ident" id="5406956">color</span><span class="op" id="5406961">.</span><span class="ident" id="5406962">NRGBA64</span><span class="op" id="5406969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406972">p</span><span class="op" id="5406973">.</span><span class="ident" id="5406974">Pix</span><span class="op" id="5406977">[</span><span class="ident" id="5406978">i</span><span class="op" id="5406979">+</span><span class="num" id="5406980">0</span><span class="op" id="5406981">]</span>&nbsp;<span class="op" id="5406983">=</span>&nbsp;<span class="builtintype" id="5406985">uint8</span><span class="op" id="5406990">(</span><span class="ident" id="5406991">c1</span><span class="op" id="5406993">.</span><span class="ident" id="5406994">R</span>&nbsp;<span class="op" id="5406996">&gt;&gt;</span>&nbsp;<span class="num" id="5406999">8</span><span class="op" id="5407000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407003">p</span><span class="op" id="5407004">.</span><span class="ident" id="5407005">Pix</span><span class="op" id="5407008">[</span><span class="ident" id="5407009">i</span><span class="op" id="5407010">+</span><span class="num" id="5407011">1</span><span class="op" id="5407012">]</span>&nbsp;<span class="op" id="5407014">=</span>&nbsp;<span class="builtintype" id="5407016">uint8</span><span class="op" id="5407021">(</span><span class="ident" id="5407022">c1</span><span class="op" id="5407024">.</span><span class="ident" id="5407025">R</span><span class="op" id="5407026">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407029">p</span><span class="op" id="5407030">.</span><span class="ident" id="5407031">Pix</span><span class="op" id="5407034">[</span><span class="ident" id="5407035">i</span><span class="op" id="5407036">+</span><span class="num" id="5407037">2</span><span class="op" id="5407038">]</span>&nbsp;<span class="op" id="5407040">=</span>&nbsp;<span class="builtintype" id="5407042">uint8</span><span class="op" id="5407047">(</span><span class="ident" id="5407048">c1</span><span class="op" id="5407050">.</span><span class="ident" id="5407051">G</span>&nbsp;<span class="op" id="5407053">&gt;&gt;</span>&nbsp;<span class="num" id="5407056">8</span><span class="op" id="5407057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407060">p</span><span class="op" id="5407061">.</span><span class="ident" id="5407062">Pix</span><span class="op" id="5407065">[</span><span class="ident" id="5407066">i</span><span class="op" id="5407067">+</span><span class="num" id="5407068">3</span><span class="op" id="5407069">]</span>&nbsp;<span class="op" id="5407071">=</span>&nbsp;<span class="builtintype" id="5407073">uint8</span><span class="op" id="5407078">(</span><span class="ident" id="5407079">c1</span><span class="op" id="5407081">.</span><span class="ident" id="5407082">G</span><span class="op" id="5407083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407086">p</span><span class="op" id="5407087">.</span><span class="ident" id="5407088">Pix</span><span class="op" id="5407091">[</span><span class="ident" id="5407092">i</span><span class="op" id="5407093">+</span><span class="num" id="5407094">4</span><span class="op" id="5407095">]</span>&nbsp;<span class="op" id="5407097">=</span>&nbsp;<span class="builtintype" id="5407099">uint8</span><span class="op" id="5407104">(</span><span class="ident" id="5407105">c1</span><span class="op" id="5407107">.</span><span class="ident" id="5407108">B</span>&nbsp;<span class="op" id="5407110">&gt;&gt;</span>&nbsp;<span class="num" id="5407113">8</span><span class="op" id="5407114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407117">p</span><span class="op" id="5407118">.</span><span class="ident" id="5407119">Pix</span><span class="op" id="5407122">[</span><span class="ident" id="5407123">i</span><span class="op" id="5407124">+</span><span class="num" id="5407125">5</span><span class="op" id="5407126">]</span>&nbsp;<span class="op" id="5407128">=</span>&nbsp;<span class="builtintype" id="5407130">uint8</span><span class="op" id="5407135">(</span><span class="ident" id="5407136">c1</span><span class="op" id="5407138">.</span><span class="ident" id="5407139">B</span><span class="op" id="5407140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407143">p</span><span class="op" id="5407144">.</span><span class="ident" id="5407145">Pix</span><span class="op" id="5407148">[</span><span class="ident" id="5407149">i</span><span class="op" id="5407150">+</span><span class="num" id="5407151">6</span><span class="op" id="5407152">]</span>&nbsp;<span class="op" id="5407154">=</span>&nbsp;<span class="builtintype" id="5407156">uint8</span><span class="op" id="5407161">(</span><span class="ident" id="5407162">c1</span><span class="op" id="5407164">.</span><span class="ident" id="5407165">A</span>&nbsp;<span class="op" id="5407167">&gt;&gt;</span>&nbsp;<span class="num" id="5407170">8</span><span class="op" id="5407171">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407174">p</span><span class="op" id="5407175">.</span><span class="ident" id="5407176">Pix</span><span class="op" id="5407179">[</span><span class="ident" id="5407180">i</span><span class="op" id="5407181">+</span><span class="num" id="5407182">7</span><span class="op" id="5407183">]</span>&nbsp;<span class="op" id="5407185">=</span>&nbsp;<span class="builtintype" id="5407187">uint8</span><span class="op" id="5407192">(</span><span class="ident" id="5407193">c1</span><span class="op" id="5407195">.</span><span class="ident" id="5407196">A</span><span class="op" id="5407197">)</span><br>
<span class="lineno"></span><span class="op" id="5407199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5407202">func</span>&nbsp;<span class="op" id="5407207">(</span><span class="ident" id="5407208">p</span>&nbsp;<span class="op" id="5407210">*</span><span class="ident" id="5407211">NRGBA64</span><span class="op" id="5407218">)</span>&nbsp;<span class="ident" id="5407220">SetNRGBA64</span><span class="op" id="5407230">(</span><span class="ident" id="5407231">x</span><span class="op" id="5407232">,</span>&nbsp;<span class="ident" id="5407234">y</span>&nbsp;<span class="builtintype" id="5407236">int</span><span class="op" id="5407239">,</span>&nbsp;<span class="ident" id="5407241">c</span>&nbsp;<span class="ident" id="5407243">color</span><span class="op" id="5407248">.</span><span class="ident" id="5407249">NRGBA64</span><span class="op" id="5407256">)</span>&nbsp;<span class="op" id="5407258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407261">if</span>&nbsp;<span class="op" id="5407264">!</span><span class="op" id="5407265">(</span><span class="ident" id="5407266">Point</span><span class="op" id="5407271">{</span><span class="ident" id="5407272">x</span><span class="op" id="5407273">,</span>&nbsp;<span class="ident" id="5407275">y</span><span class="op" id="5407276">}</span><span class="op" id="5407277">.</span><span class="ident" id="5407278">In</span><span class="op" id="5407280">(</span><span class="ident" id="5407281">p</span><span class="op" id="5407282">.</span><span class="ident" id="5407283">Rect</span><span class="op" id="5407287">)</span><span class="op" id="5407288">)</span>&nbsp;<span class="op" id="5407290">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407294">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5407302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407305">i</span>&nbsp;<span class="op" id="5407307">:=</span>&nbsp;<span class="ident" id="5407310">p</span><span class="op" id="5407311">.</span><span class="ident" id="5407312">PixOffset</span><span class="op" id="5407321">(</span><span class="ident" id="5407322">x</span><span class="op" id="5407323">,</span>&nbsp;<span class="ident" id="5407325">y</span><span class="op" id="5407326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407329">p</span><span class="op" id="5407330">.</span><span class="ident" id="5407331">Pix</span><span class="op" id="5407334">[</span><span class="ident" id="5407335">i</span><span class="op" id="5407336">+</span><span class="num" id="5407337">0</span><span class="op" id="5407338">]</span>&nbsp;<span class="op" id="5407340">=</span>&nbsp;<span class="builtintype" id="5407342">uint8</span><span class="op" id="5407347">(</span><span class="ident" id="5407348">c</span><span class="op" id="5407349">.</span><span class="ident" id="5407350">R</span>&nbsp;<span class="op" id="5407352">&gt;&gt;</span>&nbsp;<span class="num" id="5407355">8</span><span class="op" id="5407356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407359">p</span><span class="op" id="5407360">.</span><span class="ident" id="5407361">Pix</span><span class="op" id="5407364">[</span><span class="ident" id="5407365">i</span><span class="op" id="5407366">+</span><span class="num" id="5407367">1</span><span class="op" id="5407368">]</span>&nbsp;<span class="op" id="5407370">=</span>&nbsp;<span class="builtintype" id="5407372">uint8</span><span class="op" id="5407377">(</span><span class="ident" id="5407378">c</span><span class="op" id="5407379">.</span><span class="ident" id="5407380">R</span><span class="op" id="5407381">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407384">p</span><span class="op" id="5407385">.</span><span class="ident" id="5407386">Pix</span><span class="op" id="5407389">[</span><span class="ident" id="5407390">i</span><span class="op" id="5407391">+</span><span class="num" id="5407392">2</span><span class="op" id="5407393">]</span>&nbsp;<span class="op" id="5407395">=</span>&nbsp;<span class="builtintype" id="5407397">uint8</span><span class="op" id="5407402">(</span><span class="ident" id="5407403">c</span><span class="op" id="5407404">.</span><span class="ident" id="5407405">G</span>&nbsp;<span class="op" id="5407407">&gt;&gt;</span>&nbsp;<span class="num" id="5407410">8</span><span class="op" id="5407411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407414">p</span><span class="op" id="5407415">.</span><span class="ident" id="5407416">Pix</span><span class="op" id="5407419">[</span><span class="ident" id="5407420">i</span><span class="op" id="5407421">+</span><span class="num" id="5407422">3</span><span class="op" id="5407423">]</span>&nbsp;<span class="op" id="5407425">=</span>&nbsp;<span class="builtintype" id="5407427">uint8</span><span class="op" id="5407432">(</span><span class="ident" id="5407433">c</span><span class="op" id="5407434">.</span><span class="ident" id="5407435">G</span><span class="op" id="5407436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407439">p</span><span class="op" id="5407440">.</span><span class="ident" id="5407441">Pix</span><span class="op" id="5407444">[</span><span class="ident" id="5407445">i</span><span class="op" id="5407446">+</span><span class="num" id="5407447">4</span><span class="op" id="5407448">]</span>&nbsp;<span class="op" id="5407450">=</span>&nbsp;<span class="builtintype" id="5407452">uint8</span><span class="op" id="5407457">(</span><span class="ident" id="5407458">c</span><span class="op" id="5407459">.</span><span class="ident" id="5407460">B</span>&nbsp;<span class="op" id="5407462">&gt;&gt;</span>&nbsp;<span class="num" id="5407465">8</span><span class="op" id="5407466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407469">p</span><span class="op" id="5407470">.</span><span class="ident" id="5407471">Pix</span><span class="op" id="5407474">[</span><span class="ident" id="5407475">i</span><span class="op" id="5407476">+</span><span class="num" id="5407477">5</span><span class="op" id="5407478">]</span>&nbsp;<span class="op" id="5407480">=</span>&nbsp;<span class="builtintype" id="5407482">uint8</span><span class="op" id="5407487">(</span><span class="ident" id="5407488">c</span><span class="op" id="5407489">.</span><span class="ident" id="5407490">B</span><span class="op" id="5407491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407494">p</span><span class="op" id="5407495">.</span><span class="ident" id="5407496">Pix</span><span class="op" id="5407499">[</span><span class="ident" id="5407500">i</span><span class="op" id="5407501">+</span><span class="num" id="5407502">6</span><span class="op" id="5407503">]</span>&nbsp;<span class="op" id="5407505">=</span>&nbsp;<span class="builtintype" id="5407507">uint8</span><span class="op" id="5407512">(</span><span class="ident" id="5407513">c</span><span class="op" id="5407514">.</span><span class="ident" id="5407515">A</span>&nbsp;<span class="op" id="5407517">&gt;&gt;</span>&nbsp;<span class="num" id="5407520">8</span><span class="op" id="5407521">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407524">p</span><span class="op" id="5407525">.</span><span class="ident" id="5407526">Pix</span><span class="op" id="5407529">[</span><span class="ident" id="5407530">i</span><span class="op" id="5407531">+</span><span class="num" id="5407532">7</span><span class="op" id="5407533">]</span>&nbsp;<span class="op" id="5407535">=</span>&nbsp;<span class="builtintype" id="5407537">uint8</span><span class="op" id="5407542">(</span><span class="ident" id="5407543">c</span><span class="op" id="5407544">.</span><span class="ident" id="5407545">A</span><span class="op" id="5407546">)</span><br>
<span class="lineno"></span><span class="op" id="5407548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5407551">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5407628">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno">440</span><span class="keyword" id="5407700">func</span>&nbsp;<span class="op" id="5407705">(</span><span class="ident" id="5407706">p</span>&nbsp;<span class="op" id="5407708">*</span><span class="ident" id="5407709">NRGBA64</span><span class="op" id="5407716">)</span>&nbsp;<span class="ident" id="5407718">SubImage</span><span class="op" id="5407726">(</span><span class="ident" id="5407727">r</span>&nbsp;<span class="ident" id="5407729">Rectangle</span><span class="op" id="5407738">)</span>&nbsp;<span class="ident" id="5407740">Image</span>&nbsp;<span class="op" id="5407746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407749">r</span>&nbsp;<span class="op" id="5407751">=</span>&nbsp;<span class="ident" id="5407753">r</span><span class="op" id="5407754">.</span><span class="ident" id="5407755">Intersect</span><span class="op" id="5407764">(</span><span class="ident" id="5407765">p</span><span class="op" id="5407766">.</span><span class="ident" id="5407767">Rect</span><span class="op" id="5407771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5407774">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5407855">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5407937">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407987">if</span>&nbsp;<span class="ident" id="5407990">r</span><span class="op" id="5407991">.</span><span class="ident" id="5407992">Empty</span><span class="op" id="5407997">(</span><span class="op" id="5407998">)</span>&nbsp;<span class="op" id="5408000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408004">return</span>&nbsp;<span class="op" id="5408011">&amp;</span><span class="ident" id="5408012">NRGBA64</span><span class="op" id="5408019">{</span><span class="op" id="5408020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408026">i</span>&nbsp;<span class="op" id="5408028">:=</span>&nbsp;<span class="ident" id="5408031">p</span><span class="op" id="5408032">.</span><span class="ident" id="5408033">PixOffset</span><span class="op" id="5408042">(</span><span class="ident" id="5408043">r</span><span class="op" id="5408044">.</span><span class="ident" id="5408045">Min</span><span class="op" id="5408048">.</span><span class="ident" id="5408049">X</span><span class="op" id="5408050">,</span>&nbsp;<span class="ident" id="5408052">r</span><span class="op" id="5408053">.</span><span class="ident" id="5408054">Min</span><span class="op" id="5408057">.</span><span class="ident" id="5408058">Y</span><span class="op" id="5408059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408062">return</span>&nbsp;<span class="op" id="5408069">&amp;</span><span class="ident" id="5408070">NRGBA64</span><span class="op" id="5408077">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408081">Pix</span><span class="op" id="5408084">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408089">p</span><span class="op" id="5408090">.</span><span class="ident" id="5408091">Pix</span><span class="op" id="5408094">[</span><span class="ident" id="5408095">i</span><span class="op" id="5408096">:</span><span class="op" id="5408097">]</span><span class="op" id="5408098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408102">Stride</span><span class="op" id="5408108">:</span>&nbsp;<span class="ident" id="5408110">p</span><span class="op" id="5408111">.</span><span class="ident" id="5408112">Stride</span><span class="op" id="5408118">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408122">Rect</span><span class="op" id="5408126">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5408130">r</span><span class="op" id="5408131">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408134">}</span><br>
<span class="lineno"></span><span class="op" id="5408136">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="5408139">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5408212">func</span>&nbsp;<span class="op" id="5408217">(</span><span class="ident" id="5408218">p</span>&nbsp;<span class="op" id="5408220">*</span><span class="ident" id="5408221">NRGBA64</span><span class="op" id="5408228">)</span>&nbsp;<span class="ident" id="5408230">Opaque</span><span class="op" id="5408236">(</span><span class="op" id="5408237">)</span>&nbsp;<span class="builtintype" id="5408239">bool</span>&nbsp;<span class="op" id="5408244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408247">if</span>&nbsp;<span class="ident" id="5408250">p</span><span class="op" id="5408251">.</span><span class="ident" id="5408252">Rect</span><span class="op" id="5408256">.</span><span class="ident" id="5408257">Empty</span><span class="op" id="5408262">(</span><span class="op" id="5408263">)</span>&nbsp;<span class="op" id="5408265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408269">return</span>&nbsp;<span class="builtintype" id="5408276">true</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408285">i0</span><span class="op" id="5408287">,</span>&nbsp;<span class="ident" id="5408289">i1</span>&nbsp;<span class="op" id="5408292">:=</span>&nbsp;<span class="num" id="5408295">6</span><span class="op" id="5408296">,</span>&nbsp;<span class="ident" id="5408298">p</span><span class="op" id="5408299">.</span><span class="ident" id="5408300">Rect</span><span class="op" id="5408304">.</span><span class="ident" id="5408305">Dx</span><span class="op" id="5408307">(</span><span class="op" id="5408308">)</span><span class="op" id="5408309">*</span><span class="num" id="5408310">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408313">for</span>&nbsp;<span class="ident" id="5408317">y</span>&nbsp;<span class="op" id="5408319">:=</span>&nbsp;<span class="ident" id="5408322">p</span><span class="op" id="5408323">.</span><span class="ident" id="5408324">Rect</span><span class="op" id="5408328">.</span><span class="ident" id="5408329">Min</span><span class="op" id="5408332">.</span><span class="ident" id="5408333">Y</span><span class="op" id="5408334">;</span>&nbsp;<span class="ident" id="5408336">y</span>&nbsp;<span class="op" id="5408338">&lt;</span>&nbsp;<span class="ident" id="5408340">p</span><span class="op" id="5408341">.</span><span class="ident" id="5408342">Rect</span><span class="op" id="5408346">.</span><span class="ident" id="5408347">Max</span><span class="op" id="5408350">.</span><span class="ident" id="5408351">Y</span><span class="op" id="5408352">;</span>&nbsp;<span class="ident" id="5408354">y</span><span class="op" id="5408355">++</span>&nbsp;<span class="op" id="5408358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408362">for</span>&nbsp;<span class="ident" id="5408366">i</span>&nbsp;<span class="op" id="5408368">:=</span>&nbsp;<span class="ident" id="5408371">i0</span><span class="op" id="5408373">;</span>&nbsp;<span class="ident" id="5408375">i</span>&nbsp;<span class="op" id="5408377">&lt;</span>&nbsp;<span class="ident" id="5408379">i1</span><span class="op" id="5408381">;</span>&nbsp;<span class="ident" id="5408383">i</span>&nbsp;<span class="op" id="5408385">+=</span>&nbsp;<span class="num" id="5408388">8</span>&nbsp;<span class="op" id="5408390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408395">if</span>&nbsp;<span class="ident" id="5408398">p</span><span class="op" id="5408399">.</span><span class="ident" id="5408400">Pix</span><span class="op" id="5408403">[</span><span class="ident" id="5408404">i</span><span class="op" id="5408405">+</span><span class="num" id="5408406">0</span><span class="op" id="5408407">]</span>&nbsp;<span class="op" id="5408409">!=</span>&nbsp;<span class="num" id="5408412">0xff</span>&nbsp;<span class="op" id="5408417">||</span>&nbsp;<span class="ident" id="5408420">p</span><span class="op" id="5408421">.</span><span class="ident" id="5408422">Pix</span><span class="op" id="5408425">[</span><span class="ident" id="5408426">i</span><span class="op" id="5408427">+</span><span class="num" id="5408428">1</span><span class="op" id="5408429">]</span>&nbsp;<span class="op" id="5408431">!=</span>&nbsp;<span class="num" id="5408434">0xff</span>&nbsp;<span class="op" id="5408439">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408445">return</span>&nbsp;<span class="builtintype" id="5408452">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408469">i0</span>&nbsp;<span class="op" id="5408472">+=</span>&nbsp;<span class="ident" id="5408475">p</span><span class="op" id="5408476">.</span><span class="ident" id="5408477">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408486">i1</span>&nbsp;<span class="op" id="5408489">+=</span>&nbsp;<span class="ident" id="5408492">p</span><span class="op" id="5408493">.</span><span class="ident" id="5408494">Stride</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408505">return</span>&nbsp;<span class="builtintype" id="5408512">true</span><br>
<span class="lineno"></span><span class="op" id="5408517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5408520">//&nbsp;NewNRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno">475</span><span class="keyword" id="5408579">func</span>&nbsp;<span class="ident" id="5408584">NewNRGBA64</span><span class="op" id="5408594">(</span><span class="ident" id="5408595">r</span>&nbsp;<span class="ident" id="5408597">Rectangle</span><span class="op" id="5408606">)</span>&nbsp;<span class="op" id="5408608">*</span><span class="ident" id="5408609">NRGBA64</span>&nbsp;<span class="op" id="5408617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408620">w</span><span class="op" id="5408621">,</span>&nbsp;<span class="ident" id="5408623">h</span>&nbsp;<span class="op" id="5408625">:=</span>&nbsp;<span class="ident" id="5408628">r</span><span class="op" id="5408629">.</span><span class="ident" id="5408630">Dx</span><span class="op" id="5408632">(</span><span class="op" id="5408633">)</span><span class="op" id="5408634">,</span>&nbsp;<span class="ident" id="5408636">r</span><span class="op" id="5408637">.</span><span class="ident" id="5408638">Dy</span><span class="op" id="5408640">(</span><span class="op" id="5408641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408644">pix</span>&nbsp;<span class="op" id="5408648">:=</span>&nbsp;<span class="builtinfunc" id="5408651">make</span><span class="op" id="5408655">(</span><span class="op" id="5408656">[</span><span class="op" id="5408657">]</span><span class="builtintype" id="5408658">uint8</span><span class="op" id="5408663">,</span>&nbsp;<span class="num" id="5408665">8</span><span class="op" id="5408666">*</span><span class="ident" id="5408667">w</span><span class="op" id="5408668">*</span><span class="ident" id="5408669">h</span><span class="op" id="5408670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408673">return</span>&nbsp;<span class="op" id="5408680">&amp;</span><span class="ident" id="5408681">NRGBA64</span><span class="op" id="5408688">{</span><span class="ident" id="5408689">pix</span><span class="op" id="5408692">,</span>&nbsp;<span class="num" id="5408694">8</span>&nbsp;<span class="op" id="5408696">*</span>&nbsp;<span class="ident" id="5408698">w</span><span class="op" id="5408699">,</span>&nbsp;<span class="ident" id="5408701">r</span><span class="op" id="5408702">}</span><br>
<span class="lineno"></span><span class="op" id="5408704">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="5408707">//&nbsp;Alpha&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5408782">type</span>&nbsp;<span class="ident" id="5408787">Alpha</span>&nbsp;<span class="keyword" id="5408793">struct</span>&nbsp;<span class="op" id="5408800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5408803">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5408867">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408935">Pix</span>&nbsp;<span class="op" id="5408939">[</span><span class="op" id="5408940">]</span><span class="builtintype" id="5408941">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5408948">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409024">Stride</span>&nbsp;<span class="builtintype" id="5409031">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409036">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409068">Rect</span>&nbsp;<span class="ident" id="5409073">Rectangle</span><br>
<span class="lineno">490</span><span class="op" id="5409083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5409086">func</span>&nbsp;<span class="op" id="5409091">(</span><span class="ident" id="5409092">p</span>&nbsp;<span class="op" id="5409094">*</span><span class="ident" id="5409095">Alpha</span><span class="op" id="5409100">)</span>&nbsp;<span class="ident" id="5409102">ColorModel</span><span class="op" id="5409112">(</span><span class="op" id="5409113">)</span>&nbsp;<span class="ident" id="5409115">color</span><span class="op" id="5409120">.</span><span class="ident" id="5409121">Model</span>&nbsp;<span class="op" id="5409127">{</span>&nbsp;<span class="keyword" id="5409129">return</span>&nbsp;<span class="ident" id="5409136">color</span><span class="op" id="5409141">.</span><span class="ident" id="5409142">AlphaModel</span>&nbsp;<span class="op" id="5409153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5409156">func</span>&nbsp;<span class="op" id="5409161">(</span><span class="ident" id="5409162">p</span>&nbsp;<span class="op" id="5409164">*</span><span class="ident" id="5409165">Alpha</span><span class="op" id="5409170">)</span>&nbsp;<span class="ident" id="5409172">Bounds</span><span class="op" id="5409178">(</span><span class="op" id="5409179">)</span>&nbsp;<span class="ident" id="5409181">Rectangle</span>&nbsp;<span class="op" id="5409191">{</span>&nbsp;<span class="keyword" id="5409193">return</span>&nbsp;<span class="ident" id="5409200">p</span><span class="op" id="5409201">.</span><span class="ident" id="5409202">Rect</span>&nbsp;<span class="op" id="5409207">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="5409210">func</span>&nbsp;<span class="op" id="5409215">(</span><span class="ident" id="5409216">p</span>&nbsp;<span class="op" id="5409218">*</span><span class="ident" id="5409219">Alpha</span><span class="op" id="5409224">)</span>&nbsp;<span class="ident" id="5409226">At</span><span class="op" id="5409228">(</span><span class="ident" id="5409229">x</span><span class="op" id="5409230">,</span>&nbsp;<span class="ident" id="5409232">y</span>&nbsp;<span class="builtintype" id="5409234">int</span><span class="op" id="5409237">)</span>&nbsp;<span class="ident" id="5409239">color</span><span class="op" id="5409244">.</span><span class="ident" id="5409245">Color</span>&nbsp;<span class="op" id="5409251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409254">return</span>&nbsp;<span class="ident" id="5409261">p</span><span class="op" id="5409262">.</span><span class="ident" id="5409263">AlphaAt</span><span class="op" id="5409270">(</span><span class="ident" id="5409271">x</span><span class="op" id="5409272">,</span>&nbsp;<span class="ident" id="5409274">y</span><span class="op" id="5409275">)</span><br>
<span class="lineno"></span><span class="op" id="5409277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="5409280">func</span>&nbsp;<span class="op" id="5409285">(</span><span class="ident" id="5409286">p</span>&nbsp;<span class="op" id="5409288">*</span><span class="ident" id="5409289">Alpha</span><span class="op" id="5409294">)</span>&nbsp;<span class="ident" id="5409296">AlphaAt</span><span class="op" id="5409303">(</span><span class="ident" id="5409304">x</span><span class="op" id="5409305">,</span>&nbsp;<span class="ident" id="5409307">y</span>&nbsp;<span class="builtintype" id="5409309">int</span><span class="op" id="5409312">)</span>&nbsp;<span class="ident" id="5409314">color</span><span class="op" id="5409319">.</span><span class="ident" id="5409320">Alpha</span>&nbsp;<span class="op" id="5409326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409329">if</span>&nbsp;<span class="op" id="5409332">!</span><span class="op" id="5409333">(</span><span class="ident" id="5409334">Point</span><span class="op" id="5409339">{</span><span class="ident" id="5409340">x</span><span class="op" id="5409341">,</span>&nbsp;<span class="ident" id="5409343">y</span><span class="op" id="5409344">}</span><span class="op" id="5409345">.</span><span class="ident" id="5409346">In</span><span class="op" id="5409348">(</span><span class="ident" id="5409349">p</span><span class="op" id="5409350">.</span><span class="ident" id="5409351">Rect</span><span class="op" id="5409355">)</span><span class="op" id="5409356">)</span>&nbsp;<span class="op" id="5409358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409362">return</span>&nbsp;<span class="ident" id="5409369">color</span><span class="op" id="5409374">.</span><span class="ident" id="5409375">Alpha</span><span class="op" id="5409380">{</span><span class="op" id="5409381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409387">i</span>&nbsp;<span class="op" id="5409389">:=</span>&nbsp;<span class="ident" id="5409392">p</span><span class="op" id="5409393">.</span><span class="ident" id="5409394">PixOffset</span><span class="op" id="5409403">(</span><span class="ident" id="5409404">x</span><span class="op" id="5409405">,</span>&nbsp;<span class="ident" id="5409407">y</span><span class="op" id="5409408">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409411">return</span>&nbsp;<span class="ident" id="5409418">color</span><span class="op" id="5409423">.</span><span class="ident" id="5409424">Alpha</span><span class="op" id="5409429">{</span><span class="ident" id="5409430">p</span><span class="op" id="5409431">.</span><span class="ident" id="5409432">Pix</span><span class="op" id="5409435">[</span><span class="ident" id="5409436">i</span><span class="op" id="5409437">]</span><span class="op" id="5409438">}</span><br>
<span class="lineno"></span><span class="op" id="5409440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5409443">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5409522">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">510</span><span class="keyword" id="5409546">func</span>&nbsp;<span class="op" id="5409551">(</span><span class="ident" id="5409552">p</span>&nbsp;<span class="op" id="5409554">*</span><span class="ident" id="5409555">Alpha</span><span class="op" id="5409560">)</span>&nbsp;<span class="ident" id="5409562">PixOffset</span><span class="op" id="5409571">(</span><span class="ident" id="5409572">x</span><span class="op" id="5409573">,</span>&nbsp;<span class="ident" id="5409575">y</span>&nbsp;<span class="builtintype" id="5409577">int</span><span class="op" id="5409580">)</span>&nbsp;<span class="builtintype" id="5409582">int</span>&nbsp;<span class="op" id="5409586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409589">return</span>&nbsp;<span class="op" id="5409596">(</span><span class="ident" id="5409597">y</span><span class="op" id="5409598">-</span><span class="ident" id="5409599">p</span><span class="op" id="5409600">.</span><span class="ident" id="5409601">Rect</span><span class="op" id="5409605">.</span><span class="ident" id="5409606">Min</span><span class="op" id="5409609">.</span><span class="ident" id="5409610">Y</span><span class="op" id="5409611">)</span><span class="op" id="5409612">*</span><span class="ident" id="5409613">p</span><span class="op" id="5409614">.</span><span class="ident" id="5409615">Stride</span>&nbsp;<span class="op" id="5409622">+</span>&nbsp;<span class="op" id="5409624">(</span><span class="ident" id="5409625">x</span><span class="op" id="5409626">-</span><span class="ident" id="5409627">p</span><span class="op" id="5409628">.</span><span class="ident" id="5409629">Rect</span><span class="op" id="5409633">.</span><span class="ident" id="5409634">Min</span><span class="op" id="5409637">.</span><span class="ident" id="5409638">X</span><span class="op" id="5409639">)</span><span class="op" id="5409640">*</span><span class="num" id="5409641">1</span><br>
<span class="lineno"></span><span class="op" id="5409643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5409646">func</span>&nbsp;<span class="op" id="5409651">(</span><span class="ident" id="5409652">p</span>&nbsp;<span class="op" id="5409654">*</span><span class="ident" id="5409655">Alpha</span><span class="op" id="5409660">)</span>&nbsp;<span class="ident" id="5409662">Set</span><span class="op" id="5409665">(</span><span class="ident" id="5409666">x</span><span class="op" id="5409667">,</span>&nbsp;<span class="ident" id="5409669">y</span>&nbsp;<span class="builtintype" id="5409671">int</span><span class="op" id="5409674">,</span>&nbsp;<span class="ident" id="5409676">c</span>&nbsp;<span class="ident" id="5409678">color</span><span class="op" id="5409683">.</span><span class="ident" id="5409684">Color</span><span class="op" id="5409689">)</span>&nbsp;<span class="op" id="5409691">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409694">if</span>&nbsp;<span class="op" id="5409697">!</span><span class="op" id="5409698">(</span><span class="ident" id="5409699">Point</span><span class="op" id="5409704">{</span><span class="ident" id="5409705">x</span><span class="op" id="5409706">,</span>&nbsp;<span class="ident" id="5409708">y</span><span class="op" id="5409709">}</span><span class="op" id="5409710">.</span><span class="ident" id="5409711">In</span><span class="op" id="5409713">(</span><span class="ident" id="5409714">p</span><span class="op" id="5409715">.</span><span class="ident" id="5409716">Rect</span><span class="op" id="5409720">)</span><span class="op" id="5409721">)</span>&nbsp;<span class="op" id="5409723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409727">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409738">i</span>&nbsp;<span class="op" id="5409740">:=</span>&nbsp;<span class="ident" id="5409743">p</span><span class="op" id="5409744">.</span><span class="ident" id="5409745">PixOffset</span><span class="op" id="5409754">(</span><span class="ident" id="5409755">x</span><span class="op" id="5409756">,</span>&nbsp;<span class="ident" id="5409758">y</span><span class="op" id="5409759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409762">p</span><span class="op" id="5409763">.</span><span class="ident" id="5409764">Pix</span><span class="op" id="5409767">[</span><span class="ident" id="5409768">i</span><span class="op" id="5409769">]</span>&nbsp;<span class="op" id="5409771">=</span>&nbsp;<span class="ident" id="5409773">color</span><span class="op" id="5409778">.</span><span class="ident" id="5409779">AlphaModel</span><span class="op" id="5409789">.</span><span class="ident" id="5409790">Convert</span><span class="op" id="5409797">(</span><span class="ident" id="5409798">c</span><span class="op" id="5409799">)</span><span class="op" id="5409800">.</span><span class="op" id="5409801">(</span><span class="ident" id="5409802">color</span><span class="op" id="5409807">.</span><span class="ident" id="5409808">Alpha</span><span class="op" id="5409813">)</span><span class="op" id="5409814">.</span><span class="ident" id="5409815">A</span><br>
<span class="lineno">520</span><span class="op" id="5409817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5409820">func</span>&nbsp;<span class="op" id="5409825">(</span><span class="ident" id="5409826">p</span>&nbsp;<span class="op" id="5409828">*</span><span class="ident" id="5409829">Alpha</span><span class="op" id="5409834">)</span>&nbsp;<span class="ident" id="5409836">SetAlpha</span><span class="op" id="5409844">(</span><span class="ident" id="5409845">x</span><span class="op" id="5409846">,</span>&nbsp;<span class="ident" id="5409848">y</span>&nbsp;<span class="builtintype" id="5409850">int</span><span class="op" id="5409853">,</span>&nbsp;<span class="ident" id="5409855">c</span>&nbsp;<span class="ident" id="5409857">color</span><span class="op" id="5409862">.</span><span class="ident" id="5409863">Alpha</span><span class="op" id="5409868">)</span>&nbsp;<span class="op" id="5409870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409873">if</span>&nbsp;<span class="op" id="5409876">!</span><span class="op" id="5409877">(</span><span class="ident" id="5409878">Point</span><span class="op" id="5409883">{</span><span class="ident" id="5409884">x</span><span class="op" id="5409885">,</span>&nbsp;<span class="ident" id="5409887">y</span><span class="op" id="5409888">}</span><span class="op" id="5409889">.</span><span class="ident" id="5409890">In</span><span class="op" id="5409892">(</span><span class="ident" id="5409893">p</span><span class="op" id="5409894">.</span><span class="ident" id="5409895">Rect</span><span class="op" id="5409899">)</span><span class="op" id="5409900">)</span>&nbsp;<span class="op" id="5409902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409906">return</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409917">i</span>&nbsp;<span class="op" id="5409919">:=</span>&nbsp;<span class="ident" id="5409922">p</span><span class="op" id="5409923">.</span><span class="ident" id="5409924">PixOffset</span><span class="op" id="5409933">(</span><span class="ident" id="5409934">x</span><span class="op" id="5409935">,</span>&nbsp;<span class="ident" id="5409937">y</span><span class="op" id="5409938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409941">p</span><span class="op" id="5409942">.</span><span class="ident" id="5409943">Pix</span><span class="op" id="5409946">[</span><span class="ident" id="5409947">i</span><span class="op" id="5409948">]</span>&nbsp;<span class="op" id="5409950">=</span>&nbsp;<span class="ident" id="5409952">c</span><span class="op" id="5409953">.</span><span class="ident" id="5409954">A</span><br>
<span class="lineno"></span><span class="op" id="5409956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="5409959">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5410036">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5410108">func</span>&nbsp;<span class="op" id="5410113">(</span><span class="ident" id="5410114">p</span>&nbsp;<span class="op" id="5410116">*</span><span class="ident" id="5410117">Alpha</span><span class="op" id="5410122">)</span>&nbsp;<span class="ident" id="5410124">SubImage</span><span class="op" id="5410132">(</span><span class="ident" id="5410133">r</span>&nbsp;<span class="ident" id="5410135">Rectangle</span><span class="op" id="5410144">)</span>&nbsp;<span class="ident" id="5410146">Image</span>&nbsp;<span class="op" id="5410152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410155">r</span>&nbsp;<span class="op" id="5410157">=</span>&nbsp;<span class="ident" id="5410159">r</span><span class="op" id="5410160">.</span><span class="ident" id="5410161">Intersect</span><span class="op" id="5410170">(</span><span class="ident" id="5410171">p</span><span class="op" id="5410172">.</span><span class="ident" id="5410173">Rect</span><span class="op" id="5410177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5410180">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5410261">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5410343">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410393">if</span>&nbsp;<span class="ident" id="5410396">r</span><span class="op" id="5410397">.</span><span class="ident" id="5410398">Empty</span><span class="op" id="5410403">(</span><span class="op" id="5410404">)</span>&nbsp;<span class="op" id="5410406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410410">return</span>&nbsp;<span class="op" id="5410417">&amp;</span><span class="ident" id="5410418">Alpha</span><span class="op" id="5410423">{</span><span class="op" id="5410424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410427">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410430">i</span>&nbsp;<span class="op" id="5410432">:=</span>&nbsp;<span class="ident" id="5410435">p</span><span class="op" id="5410436">.</span><span class="ident" id="5410437">PixOffset</span><span class="op" id="5410446">(</span><span class="ident" id="5410447">r</span><span class="op" id="5410448">.</span><span class="ident" id="5410449">Min</span><span class="op" id="5410452">.</span><span class="ident" id="5410453">X</span><span class="op" id="5410454">,</span>&nbsp;<span class="ident" id="5410456">r</span><span class="op" id="5410457">.</span><span class="ident" id="5410458">Min</span><span class="op" id="5410461">.</span><span class="ident" id="5410462">Y</span><span class="op" id="5410463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410466">return</span>&nbsp;<span class="op" id="5410473">&amp;</span><span class="ident" id="5410474">Alpha</span><span class="op" id="5410479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410483">Pix</span><span class="op" id="5410486">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5410491">p</span><span class="op" id="5410492">.</span><span class="ident" id="5410493">Pix</span><span class="op" id="5410496">[</span><span class="ident" id="5410497">i</span><span class="op" id="5410498">:</span><span class="op" id="5410499">]</span><span class="op" id="5410500">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410504">Stride</span><span class="op" id="5410510">:</span>&nbsp;<span class="ident" id="5410512">p</span><span class="op" id="5410513">.</span><span class="ident" id="5410514">Stride</span><span class="op" id="5410520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410524">Rect</span><span class="op" id="5410528">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5410532">r</span><span class="op" id="5410533">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410536">}</span><br>
<span class="lineno"></span><span class="op" id="5410538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5410541">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5410614">func</span>&nbsp;<span class="op" id="5410619">(</span><span class="ident" id="5410620">p</span>&nbsp;<span class="op" id="5410622">*</span><span class="ident" id="5410623">Alpha</span><span class="op" id="5410628">)</span>&nbsp;<span class="ident" id="5410630">Opaque</span><span class="op" id="5410636">(</span><span class="op" id="5410637">)</span>&nbsp;<span class="builtintype" id="5410639">bool</span>&nbsp;<span class="op" id="5410644">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410647">if</span>&nbsp;<span class="ident" id="5410650">p</span><span class="op" id="5410651">.</span><span class="ident" id="5410652">Rect</span><span class="op" id="5410656">.</span><span class="ident" id="5410657">Empty</span><span class="op" id="5410662">(</span><span class="op" id="5410663">)</span>&nbsp;<span class="op" id="5410665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410669">return</span>&nbsp;<span class="builtintype" id="5410676">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410685">i0</span><span class="op" id="5410687">,</span>&nbsp;<span class="ident" id="5410689">i1</span>&nbsp;<span class="op" id="5410692">:=</span>&nbsp;<span class="num" id="5410695">0</span><span class="op" id="5410696">,</span>&nbsp;<span class="ident" id="5410698">p</span><span class="op" id="5410699">.</span><span class="ident" id="5410700">Rect</span><span class="op" id="5410704">.</span><span class="ident" id="5410705">Dx</span><span class="op" id="5410707">(</span><span class="op" id="5410708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410711">for</span>&nbsp;<span class="ident" id="5410715">y</span>&nbsp;<span class="op" id="5410717">:=</span>&nbsp;<span class="ident" id="5410720">p</span><span class="op" id="5410721">.</span><span class="ident" id="5410722">Rect</span><span class="op" id="5410726">.</span><span class="ident" id="5410727">Min</span><span class="op" id="5410730">.</span><span class="ident" id="5410731">Y</span><span class="op" id="5410732">;</span>&nbsp;<span class="ident" id="5410734">y</span>&nbsp;<span class="op" id="5410736">&lt;</span>&nbsp;<span class="ident" id="5410738">p</span><span class="op" id="5410739">.</span><span class="ident" id="5410740">Rect</span><span class="op" id="5410744">.</span><span class="ident" id="5410745">Max</span><span class="op" id="5410748">.</span><span class="ident" id="5410749">Y</span><span class="op" id="5410750">;</span>&nbsp;<span class="ident" id="5410752">y</span><span class="op" id="5410753">++</span>&nbsp;<span class="op" id="5410756">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410760">for</span>&nbsp;<span class="ident" id="5410764">i</span>&nbsp;<span class="op" id="5410766">:=</span>&nbsp;<span class="ident" id="5410769">i0</span><span class="op" id="5410771">;</span>&nbsp;<span class="ident" id="5410773">i</span>&nbsp;<span class="op" id="5410775">&lt;</span>&nbsp;<span class="ident" id="5410777">i1</span><span class="op" id="5410779">;</span>&nbsp;<span class="ident" id="5410781">i</span><span class="op" id="5410782">++</span>&nbsp;<span class="op" id="5410785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410790">if</span>&nbsp;<span class="ident" id="5410793">p</span><span class="op" id="5410794">.</span><span class="ident" id="5410795">Pix</span><span class="op" id="5410798">[</span><span class="ident" id="5410799">i</span><span class="op" id="5410800">]</span>&nbsp;<span class="op" id="5410802">!=</span>&nbsp;<span class="num" id="5410805">0xff</span>&nbsp;<span class="op" id="5410810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410816">return</span>&nbsp;<span class="builtintype" id="5410823">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410836">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410840">i0</span>&nbsp;<span class="op" id="5410843">+=</span>&nbsp;<span class="ident" id="5410846">p</span><span class="op" id="5410847">.</span><span class="ident" id="5410848">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410857">i1</span>&nbsp;<span class="op" id="5410860">+=</span>&nbsp;<span class="ident" id="5410863">p</span><span class="op" id="5410864">.</span><span class="ident" id="5410865">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410876">return</span>&nbsp;<span class="builtintype" id="5410883">true</span><br>
<span class="lineno"></span><span class="op" id="5410888">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="5410891">//&nbsp;NewAlpha&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5410946">func</span>&nbsp;<span class="ident" id="5410951">NewAlpha</span><span class="op" id="5410959">(</span><span class="ident" id="5410960">r</span>&nbsp;<span class="ident" id="5410962">Rectangle</span><span class="op" id="5410971">)</span>&nbsp;<span class="op" id="5410973">*</span><span class="ident" id="5410974">Alpha</span>&nbsp;<span class="op" id="5410980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410983">w</span><span class="op" id="5410984">,</span>&nbsp;<span class="ident" id="5410986">h</span>&nbsp;<span class="op" id="5410988">:=</span>&nbsp;<span class="ident" id="5410991">r</span><span class="op" id="5410992">.</span><span class="ident" id="5410993">Dx</span><span class="op" id="5410995">(</span><span class="op" id="5410996">)</span><span class="op" id="5410997">,</span>&nbsp;<span class="ident" id="5410999">r</span><span class="op" id="5411000">.</span><span class="ident" id="5411001">Dy</span><span class="op" id="5411003">(</span><span class="op" id="5411004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411007">pix</span>&nbsp;<span class="op" id="5411011">:=</span>&nbsp;<span class="builtinfunc" id="5411014">make</span><span class="op" id="5411018">(</span><span class="op" id="5411019">[</span><span class="op" id="5411020">]</span><span class="builtintype" id="5411021">uint8</span><span class="op" id="5411026">,</span>&nbsp;<span class="num" id="5411028">1</span><span class="op" id="5411029">*</span><span class="ident" id="5411030">w</span><span class="op" id="5411031">*</span><span class="ident" id="5411032">h</span><span class="op" id="5411033">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411036">return</span>&nbsp;<span class="op" id="5411043">&amp;</span><span class="ident" id="5411044">Alpha</span><span class="op" id="5411049">{</span><span class="ident" id="5411050">pix</span><span class="op" id="5411053">,</span>&nbsp;<span class="num" id="5411055">1</span>&nbsp;<span class="op" id="5411057">*</span>&nbsp;<span class="ident" id="5411059">w</span><span class="op" id="5411060">,</span>&nbsp;<span class="ident" id="5411062">r</span><span class="op" id="5411063">}</span><br>
<span class="lineno"></span><span class="op" id="5411065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5411068">//&nbsp;Alpha16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5411147">type</span>&nbsp;<span class="ident" id="5411152">Alpha16</span>&nbsp;<span class="keyword" id="5411160">struct</span>&nbsp;<span class="op" id="5411167">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411170">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411255">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411323">Pix</span>&nbsp;<span class="op" id="5411327">[</span><span class="op" id="5411328">]</span><span class="builtintype" id="5411329">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411336">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411412">Stride</span>&nbsp;<span class="builtintype" id="5411419">int</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411424">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411456">Rect</span>&nbsp;<span class="ident" id="5411461">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5411471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5411474">func</span>&nbsp;<span class="op" id="5411479">(</span><span class="ident" id="5411480">p</span>&nbsp;<span class="op" id="5411482">*</span><span class="ident" id="5411483">Alpha16</span><span class="op" id="5411490">)</span>&nbsp;<span class="ident" id="5411492">ColorModel</span><span class="op" id="5411502">(</span><span class="op" id="5411503">)</span>&nbsp;<span class="ident" id="5411505">color</span><span class="op" id="5411510">.</span><span class="ident" id="5411511">Model</span>&nbsp;<span class="op" id="5411517">{</span>&nbsp;<span class="keyword" id="5411519">return</span>&nbsp;<span class="ident" id="5411526">color</span><span class="op" id="5411531">.</span><span class="ident" id="5411532">Alpha16Model</span>&nbsp;<span class="op" id="5411545">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="keyword" id="5411548">func</span>&nbsp;<span class="op" id="5411553">(</span><span class="ident" id="5411554">p</span>&nbsp;<span class="op" id="5411556">*</span><span class="ident" id="5411557">Alpha16</span><span class="op" id="5411564">)</span>&nbsp;<span class="ident" id="5411566">Bounds</span><span class="op" id="5411572">(</span><span class="op" id="5411573">)</span>&nbsp;<span class="ident" id="5411575">Rectangle</span>&nbsp;<span class="op" id="5411585">{</span>&nbsp;<span class="keyword" id="5411587">return</span>&nbsp;<span class="ident" id="5411594">p</span><span class="op" id="5411595">.</span><span class="ident" id="5411596">Rect</span>&nbsp;<span class="op" id="5411601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5411604">func</span>&nbsp;<span class="op" id="5411609">(</span><span class="ident" id="5411610">p</span>&nbsp;<span class="op" id="5411612">*</span><span class="ident" id="5411613">Alpha16</span><span class="op" id="5411620">)</span>&nbsp;<span class="ident" id="5411622">At</span><span class="op" id="5411624">(</span><span class="ident" id="5411625">x</span><span class="op" id="5411626">,</span>&nbsp;<span class="ident" id="5411628">y</span>&nbsp;<span class="builtintype" id="5411630">int</span><span class="op" id="5411633">)</span>&nbsp;<span class="ident" id="5411635">color</span><span class="op" id="5411640">.</span><span class="ident" id="5411641">Color</span>&nbsp;<span class="op" id="5411647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411650">return</span>&nbsp;<span class="ident" id="5411657">p</span><span class="op" id="5411658">.</span><span class="ident" id="5411659">Alpha16At</span><span class="op" id="5411668">(</span><span class="ident" id="5411669">x</span><span class="op" id="5411670">,</span>&nbsp;<span class="ident" id="5411672">y</span><span class="op" id="5411673">)</span><br>
<span class="lineno">590</span><span class="op" id="5411675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5411678">func</span>&nbsp;<span class="op" id="5411683">(</span><span class="ident" id="5411684">p</span>&nbsp;<span class="op" id="5411686">*</span><span class="ident" id="5411687">Alpha16</span><span class="op" id="5411694">)</span>&nbsp;<span class="ident" id="5411696">Alpha16At</span><span class="op" id="5411705">(</span><span class="ident" id="5411706">x</span><span class="op" id="5411707">,</span>&nbsp;<span class="ident" id="5411709">y</span>&nbsp;<span class="builtintype" id="5411711">int</span><span class="op" id="5411714">)</span>&nbsp;<span class="ident" id="5411716">color</span><span class="op" id="5411721">.</span><span class="ident" id="5411722">Alpha16</span>&nbsp;<span class="op" id="5411730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411733">if</span>&nbsp;<span class="op" id="5411736">!</span><span class="op" id="5411737">(</span><span class="ident" id="5411738">Point</span><span class="op" id="5411743">{</span><span class="ident" id="5411744">x</span><span class="op" id="5411745">,</span>&nbsp;<span class="ident" id="5411747">y</span><span class="op" id="5411748">}</span><span class="op" id="5411749">.</span><span class="ident" id="5411750">In</span><span class="op" id="5411752">(</span><span class="ident" id="5411753">p</span><span class="op" id="5411754">.</span><span class="ident" id="5411755">Rect</span><span class="op" id="5411759">)</span><span class="op" id="5411760">)</span>&nbsp;<span class="op" id="5411762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411766">return</span>&nbsp;<span class="ident" id="5411773">color</span><span class="op" id="5411778">.</span><span class="ident" id="5411779">Alpha16</span><span class="op" id="5411786">{</span><span class="op" id="5411787">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411793">i</span>&nbsp;<span class="op" id="5411795">:=</span>&nbsp;<span class="ident" id="5411798">p</span><span class="op" id="5411799">.</span><span class="ident" id="5411800">PixOffset</span><span class="op" id="5411809">(</span><span class="ident" id="5411810">x</span><span class="op" id="5411811">,</span>&nbsp;<span class="ident" id="5411813">y</span><span class="op" id="5411814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411817">return</span>&nbsp;<span class="ident" id="5411824">color</span><span class="op" id="5411829">.</span><span class="ident" id="5411830">Alpha16</span><span class="op" id="5411837">{</span><span class="builtintype" id="5411838">uint16</span><span class="op" id="5411844">(</span><span class="ident" id="5411845">p</span><span class="op" id="5411846">.</span><span class="ident" id="5411847">Pix</span><span class="op" id="5411850">[</span><span class="ident" id="5411851">i</span><span class="op" id="5411852">+</span><span class="num" id="5411853">0</span><span class="op" id="5411854">]</span><span class="op" id="5411855">)</span><span class="op" id="5411856">&lt;&lt;</span><span class="num" id="5411858">8</span>&nbsp;<span class="op" id="5411860">|</span>&nbsp;<span class="builtintype" id="5411862">uint16</span><span class="op" id="5411868">(</span><span class="ident" id="5411869">p</span><span class="op" id="5411870">.</span><span class="ident" id="5411871">Pix</span><span class="op" id="5411874">[</span><span class="ident" id="5411875">i</span><span class="op" id="5411876">+</span><span class="num" id="5411877">1</span><span class="op" id="5411878">]</span><span class="op" id="5411879">)</span><span class="op" id="5411880">}</span><br>
<span class="lineno"></span><span class="op" id="5411882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="5411885">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5411964">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5411988">func</span>&nbsp;<span class="op" id="5411993">(</span><span class="ident" id="5411994">p</span>&nbsp;<span class="op" id="5411996">*</span><span class="ident" id="5411997">Alpha16</span><span class="op" id="5412004">)</span>&nbsp;<span class="ident" id="5412006">PixOffset</span><span class="op" id="5412015">(</span><span class="ident" id="5412016">x</span><span class="op" id="5412017">,</span>&nbsp;<span class="ident" id="5412019">y</span>&nbsp;<span class="builtintype" id="5412021">int</span><span class="op" id="5412024">)</span>&nbsp;<span class="builtintype" id="5412026">int</span>&nbsp;<span class="op" id="5412030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412033">return</span>&nbsp;<span class="op" id="5412040">(</span><span class="ident" id="5412041">y</span><span class="op" id="5412042">-</span><span class="ident" id="5412043">p</span><span class="op" id="5412044">.</span><span class="ident" id="5412045">Rect</span><span class="op" id="5412049">.</span><span class="ident" id="5412050">Min</span><span class="op" id="5412053">.</span><span class="ident" id="5412054">Y</span><span class="op" id="5412055">)</span><span class="op" id="5412056">*</span><span class="ident" id="5412057">p</span><span class="op" id="5412058">.</span><span class="ident" id="5412059">Stride</span>&nbsp;<span class="op" id="5412066">+</span>&nbsp;<span class="op" id="5412068">(</span><span class="ident" id="5412069">x</span><span class="op" id="5412070">-</span><span class="ident" id="5412071">p</span><span class="op" id="5412072">.</span><span class="ident" id="5412073">Rect</span><span class="op" id="5412077">.</span><span class="ident" id="5412078">Min</span><span class="op" id="5412081">.</span><span class="ident" id="5412082">X</span><span class="op" id="5412083">)</span><span class="op" id="5412084">*</span><span class="num" id="5412085">2</span><br>
<span class="lineno"></span><span class="op" id="5412087">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="keyword" id="5412090">func</span>&nbsp;<span class="op" id="5412095">(</span><span class="ident" id="5412096">p</span>&nbsp;<span class="op" id="5412098">*</span><span class="ident" id="5412099">Alpha16</span><span class="op" id="5412106">)</span>&nbsp;<span class="ident" id="5412108">Set</span><span class="op" id="5412111">(</span><span class="ident" id="5412112">x</span><span class="op" id="5412113">,</span>&nbsp;<span class="ident" id="5412115">y</span>&nbsp;<span class="builtintype" id="5412117">int</span><span class="op" id="5412120">,</span>&nbsp;<span class="ident" id="5412122">c</span>&nbsp;<span class="ident" id="5412124">color</span><span class="op" id="5412129">.</span><span class="ident" id="5412130">Color</span><span class="op" id="5412135">)</span>&nbsp;<span class="op" id="5412137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412140">if</span>&nbsp;<span class="op" id="5412143">!</span><span class="op" id="5412144">(</span><span class="ident" id="5412145">Point</span><span class="op" id="5412150">{</span><span class="ident" id="5412151">x</span><span class="op" id="5412152">,</span>&nbsp;<span class="ident" id="5412154">y</span><span class="op" id="5412155">}</span><span class="op" id="5412156">.</span><span class="ident" id="5412157">In</span><span class="op" id="5412159">(</span><span class="ident" id="5412160">p</span><span class="op" id="5412161">.</span><span class="ident" id="5412162">Rect</span><span class="op" id="5412166">)</span><span class="op" id="5412167">)</span>&nbsp;<span class="op" id="5412169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412173">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412181">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412184">i</span>&nbsp;<span class="op" id="5412186">:=</span>&nbsp;<span class="ident" id="5412189">p</span><span class="op" id="5412190">.</span><span class="ident" id="5412191">PixOffset</span><span class="op" id="5412200">(</span><span class="ident" id="5412201">x</span><span class="op" id="5412202">,</span>&nbsp;<span class="ident" id="5412204">y</span><span class="op" id="5412205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412208">c1</span>&nbsp;<span class="op" id="5412211">:=</span>&nbsp;<span class="ident" id="5412214">color</span><span class="op" id="5412219">.</span><span class="ident" id="5412220">Alpha16Model</span><span class="op" id="5412232">.</span><span class="ident" id="5412233">Convert</span><span class="op" id="5412240">(</span><span class="ident" id="5412241">c</span><span class="op" id="5412242">)</span><span class="op" id="5412243">.</span><span class="op" id="5412244">(</span><span class="ident" id="5412245">color</span><span class="op" id="5412250">.</span><span class="ident" id="5412251">Alpha16</span><span class="op" id="5412258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412261">p</span><span class="op" id="5412262">.</span><span class="ident" id="5412263">Pix</span><span class="op" id="5412266">[</span><span class="ident" id="5412267">i</span><span class="op" id="5412268">+</span><span class="num" id="5412269">0</span><span class="op" id="5412270">]</span>&nbsp;<span class="op" id="5412272">=</span>&nbsp;<span class="builtintype" id="5412274">uint8</span><span class="op" id="5412279">(</span><span class="ident" id="5412280">c1</span><span class="op" id="5412282">.</span><span class="ident" id="5412283">A</span>&nbsp;<span class="op" id="5412285">&gt;&gt;</span>&nbsp;<span class="num" id="5412288">8</span><span class="op" id="5412289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412292">p</span><span class="op" id="5412293">.</span><span class="ident" id="5412294">Pix</span><span class="op" id="5412297">[</span><span class="ident" id="5412298">i</span><span class="op" id="5412299">+</span><span class="num" id="5412300">1</span><span class="op" id="5412301">]</span>&nbsp;<span class="op" id="5412303">=</span>&nbsp;<span class="builtintype" id="5412305">uint8</span><span class="op" id="5412310">(</span><span class="ident" id="5412311">c1</span><span class="op" id="5412313">.</span><span class="ident" id="5412314">A</span><span class="op" id="5412315">)</span><br>
<span class="lineno"></span><span class="op" id="5412317">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="5412320">func</span>&nbsp;<span class="op" id="5412325">(</span><span class="ident" id="5412326">p</span>&nbsp;<span class="op" id="5412328">*</span><span class="ident" id="5412329">Alpha16</span><span class="op" id="5412336">)</span>&nbsp;<span class="ident" id="5412338">SetAlpha16</span><span class="op" id="5412348">(</span><span class="ident" id="5412349">x</span><span class="op" id="5412350">,</span>&nbsp;<span class="ident" id="5412352">y</span>&nbsp;<span class="builtintype" id="5412354">int</span><span class="op" id="5412357">,</span>&nbsp;<span class="ident" id="5412359">c</span>&nbsp;<span class="ident" id="5412361">color</span><span class="op" id="5412366">.</span><span class="ident" id="5412367">Alpha16</span><span class="op" id="5412374">)</span>&nbsp;<span class="op" id="5412376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412379">if</span>&nbsp;<span class="op" id="5412382">!</span><span class="op" id="5412383">(</span><span class="ident" id="5412384">Point</span><span class="op" id="5412389">{</span><span class="ident" id="5412390">x</span><span class="op" id="5412391">,</span>&nbsp;<span class="ident" id="5412393">y</span><span class="op" id="5412394">}</span><span class="op" id="5412395">.</span><span class="ident" id="5412396">In</span><span class="op" id="5412398">(</span><span class="ident" id="5412399">p</span><span class="op" id="5412400">.</span><span class="ident" id="5412401">Rect</span><span class="op" id="5412405">)</span><span class="op" id="5412406">)</span>&nbsp;<span class="op" id="5412408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412412">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412420">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412423">i</span>&nbsp;<span class="op" id="5412425">:=</span>&nbsp;<span class="ident" id="5412428">p</span><span class="op" id="5412429">.</span><span class="ident" id="5412430">PixOffset</span><span class="op" id="5412439">(</span><span class="ident" id="5412440">x</span><span class="op" id="5412441">,</span>&nbsp;<span class="ident" id="5412443">y</span><span class="op" id="5412444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412447">p</span><span class="op" id="5412448">.</span><span class="ident" id="5412449">Pix</span><span class="op" id="5412452">[</span><span class="ident" id="5412453">i</span><span class="op" id="5412454">+</span><span class="num" id="5412455">0</span><span class="op" id="5412456">]</span>&nbsp;<span class="op" id="5412458">=</span>&nbsp;<span class="builtintype" id="5412460">uint8</span><span class="op" id="5412465">(</span><span class="ident" id="5412466">c</span><span class="op" id="5412467">.</span><span class="ident" id="5412468">A</span>&nbsp;<span class="op" id="5412470">&gt;&gt;</span>&nbsp;<span class="num" id="5412473">8</span><span class="op" id="5412474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412477">p</span><span class="op" id="5412478">.</span><span class="ident" id="5412479">Pix</span><span class="op" id="5412482">[</span><span class="ident" id="5412483">i</span><span class="op" id="5412484">+</span><span class="num" id="5412485">1</span><span class="op" id="5412486">]</span>&nbsp;<span class="op" id="5412488">=</span>&nbsp;<span class="builtintype" id="5412490">uint8</span><span class="op" id="5412495">(</span><span class="ident" id="5412496">c</span><span class="op" id="5412497">.</span><span class="ident" id="5412498">A</span><span class="op" id="5412499">)</span><br>
<span class="lineno"></span><span class="op" id="5412501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="5412504">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5412581">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5412653">func</span>&nbsp;<span class="op" id="5412658">(</span><span class="ident" id="5412659">p</span>&nbsp;<span class="op" id="5412661">*</span><span class="ident" id="5412662">Alpha16</span><span class="op" id="5412669">)</span>&nbsp;<span class="ident" id="5412671">SubImage</span><span class="op" id="5412679">(</span><span class="ident" id="5412680">r</span>&nbsp;<span class="ident" id="5412682">Rectangle</span><span class="op" id="5412691">)</span>&nbsp;<span class="ident" id="5412693">Image</span>&nbsp;<span class="op" id="5412699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412702">r</span>&nbsp;<span class="op" id="5412704">=</span>&nbsp;<span class="ident" id="5412706">r</span><span class="op" id="5412707">.</span><span class="ident" id="5412708">Intersect</span><span class="op" id="5412717">(</span><span class="ident" id="5412718">p</span><span class="op" id="5412719">.</span><span class="ident" id="5412720">Rect</span><span class="op" id="5412724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5412727">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5412808">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5412890">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412940">if</span>&nbsp;<span class="ident" id="5412943">r</span><span class="op" id="5412944">.</span><span class="ident" id="5412945">Empty</span><span class="op" id="5412950">(</span><span class="op" id="5412951">)</span>&nbsp;<span class="op" id="5412953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412957">return</span>&nbsp;<span class="op" id="5412964">&amp;</span><span class="ident" id="5412965">Alpha16</span><span class="op" id="5412972">{</span><span class="op" id="5412973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412976">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412979">i</span>&nbsp;<span class="op" id="5412981">:=</span>&nbsp;<span class="ident" id="5412984">p</span><span class="op" id="5412985">.</span><span class="ident" id="5412986">PixOffset</span><span class="op" id="5412995">(</span><span class="ident" id="5412996">r</span><span class="op" id="5412997">.</span><span class="ident" id="5412998">Min</span><span class="op" id="5413001">.</span><span class="ident" id="5413002">X</span><span class="op" id="5413003">,</span>&nbsp;<span class="ident" id="5413005">r</span><span class="op" id="5413006">.</span><span class="ident" id="5413007">Min</span><span class="op" id="5413010">.</span><span class="ident" id="5413011">Y</span><span class="op" id="5413012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413015">return</span>&nbsp;<span class="op" id="5413022">&amp;</span><span class="ident" id="5413023">Alpha16</span><span class="op" id="5413030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413034">Pix</span><span class="op" id="5413037">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413042">p</span><span class="op" id="5413043">.</span><span class="ident" id="5413044">Pix</span><span class="op" id="5413047">[</span><span class="ident" id="5413048">i</span><span class="op" id="5413049">:</span><span class="op" id="5413050">]</span><span class="op" id="5413051">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413055">Stride</span><span class="op" id="5413061">:</span>&nbsp;<span class="ident" id="5413063">p</span><span class="op" id="5413064">.</span><span class="ident" id="5413065">Stride</span><span class="op" id="5413071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413075">Rect</span><span class="op" id="5413079">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5413083">r</span><span class="op" id="5413084">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5413087">}</span><br>
<span class="lineno"></span><span class="op" id="5413089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5413092">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5413165">func</span>&nbsp;<span class="op" id="5413170">(</span><span class="ident" id="5413171">p</span>&nbsp;<span class="op" id="5413173">*</span><span class="ident" id="5413174">Alpha16</span><span class="op" id="5413181">)</span>&nbsp;<span class="ident" id="5413183">Opaque</span><span class="op" id="5413189">(</span><span class="op" id="5413190">)</span>&nbsp;<span class="builtintype" id="5413192">bool</span>&nbsp;<span class="op" id="5413197">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413200">if</span>&nbsp;<span class="ident" id="5413203">p</span><span class="op" id="5413204">.</span><span class="ident" id="5413205">Rect</span><span class="op" id="5413209">.</span><span class="ident" id="5413210">Empty</span><span class="op" id="5413215">(</span><span class="op" id="5413216">)</span>&nbsp;<span class="op" id="5413218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413222">return</span>&nbsp;<span class="builtintype" id="5413229">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5413235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413238">i0</span><span class="op" id="5413240">,</span>&nbsp;<span class="ident" id="5413242">i1</span>&nbsp;<span class="op" id="5413245">:=</span>&nbsp;<span class="num" id="5413248">0</span><span class="op" id="5413249">,</span>&nbsp;<span class="ident" id="5413251">p</span><span class="op" id="5413252">.</span><span class="ident" id="5413253">Rect</span><span class="op" id="5413257">.</span><span class="ident" id="5413258">Dx</span><span class="op" id="5413260">(</span><span class="op" id="5413261">)</span><span class="op" id="5413262">*</span><span class="num" id="5413263">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413266">for</span>&nbsp;<span class="ident" id="5413270">y</span>&nbsp;<span class="op" id="5413272">:=</span>&nbsp;<span class="ident" id="5413275">p</span><span class="op" id="5413276">.</span><span class="ident" id="5413277">Rect</span><span class="op" id="5413281">.</span><span class="ident" id="5413282">Min</span><span class="op" id="5413285">.</span><span class="ident" id="5413286">Y</span><span class="op" id="5413287">;</span>&nbsp;<span class="ident" id="5413289">y</span>&nbsp;<span class="op" id="5413291">&lt;</span>&nbsp;<span class="ident" id="5413293">p</span><span class="op" id="5413294">.</span><span class="ident" id="5413295">Rect</span><span class="op" id="5413299">.</span><span class="ident" id="5413300">Max</span><span class="op" id="5413303">.</span><span class="ident" id="5413304">Y</span><span class="op" id="5413305">;</span>&nbsp;<span class="ident" id="5413307">y</span><span class="op" id="5413308">++</span>&nbsp;<span class="op" id="5413311">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413315">for</span>&nbsp;<span class="ident" id="5413319">i</span>&nbsp;<span class="op" id="5413321">:=</span>&nbsp;<span class="ident" id="5413324">i0</span><span class="op" id="5413326">;</span>&nbsp;<span class="ident" id="5413328">i</span>&nbsp;<span class="op" id="5413330">&lt;</span>&nbsp;<span class="ident" id="5413332">i1</span><span class="op" id="5413334">;</span>&nbsp;<span class="ident" id="5413336">i</span>&nbsp;<span class="op" id="5413338">+=</span>&nbsp;<span class="num" id="5413341">2</span>&nbsp;<span class="op" id="5413343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413348">if</span>&nbsp;<span class="ident" id="5413351">p</span><span class="op" id="5413352">.</span><span class="ident" id="5413353">Pix</span><span class="op" id="5413356">[</span><span class="ident" id="5413357">i</span><span class="op" id="5413358">+</span><span class="num" id="5413359">0</span><span class="op" id="5413360">]</span>&nbsp;<span class="op" id="5413362">!=</span>&nbsp;<span class="num" id="5413365">0xff</span>&nbsp;<span class="op" id="5413370">||</span>&nbsp;<span class="ident" id="5413373">p</span><span class="op" id="5413374">.</span><span class="ident" id="5413375">Pix</span><span class="op" id="5413378">[</span><span class="ident" id="5413379">i</span><span class="op" id="5413380">+</span><span class="num" id="5413381">1</span><span class="op" id="5413382">]</span>&nbsp;<span class="op" id="5413384">!=</span>&nbsp;<span class="num" id="5413387">0xff</span>&nbsp;<span class="op" id="5413392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413398">return</span>&nbsp;<span class="builtintype" id="5413405">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5413414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5413418">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413422">i0</span>&nbsp;<span class="op" id="5413425">+=</span>&nbsp;<span class="ident" id="5413428">p</span><span class="op" id="5413429">.</span><span class="ident" id="5413430">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413439">i1</span>&nbsp;<span class="op" id="5413442">+=</span>&nbsp;<span class="ident" id="5413445">p</span><span class="op" id="5413446">.</span><span class="ident" id="5413447">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5413455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413458">return</span>&nbsp;<span class="builtintype" id="5413465">true</span><br>
<span class="lineno"></span><span class="op" id="5413470">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="5413473">//&nbsp;NewAlpha16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5413532">func</span>&nbsp;<span class="ident" id="5413537">NewAlpha16</span><span class="op" id="5413547">(</span><span class="ident" id="5413548">r</span>&nbsp;<span class="ident" id="5413550">Rectangle</span><span class="op" id="5413559">)</span>&nbsp;<span class="op" id="5413561">*</span><span class="ident" id="5413562">Alpha16</span>&nbsp;<span class="op" id="5413570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413573">w</span><span class="op" id="5413574">,</span>&nbsp;<span class="ident" id="5413576">h</span>&nbsp;<span class="op" id="5413578">:=</span>&nbsp;<span class="ident" id="5413581">r</span><span class="op" id="5413582">.</span><span class="ident" id="5413583">Dx</span><span class="op" id="5413585">(</span><span class="op" id="5413586">)</span><span class="op" id="5413587">,</span>&nbsp;<span class="ident" id="5413589">r</span><span class="op" id="5413590">.</span><span class="ident" id="5413591">Dy</span><span class="op" id="5413593">(</span><span class="op" id="5413594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413597">pix</span>&nbsp;<span class="op" id="5413601">:=</span>&nbsp;<span class="builtinfunc" id="5413604">make</span><span class="op" id="5413608">(</span><span class="op" id="5413609">[</span><span class="op" id="5413610">]</span><span class="builtintype" id="5413611">uint8</span><span class="op" id="5413616">,</span>&nbsp;<span class="num" id="5413618">2</span><span class="op" id="5413619">*</span><span class="ident" id="5413620">w</span><span class="op" id="5413621">*</span><span class="ident" id="5413622">h</span><span class="op" id="5413623">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413626">return</span>&nbsp;<span class="op" id="5413633">&amp;</span><span class="ident" id="5413634">Alpha16</span><span class="op" id="5413641">{</span><span class="ident" id="5413642">pix</span><span class="op" id="5413645">,</span>&nbsp;<span class="num" id="5413647">2</span>&nbsp;<span class="op" id="5413649">*</span>&nbsp;<span class="ident" id="5413651">w</span><span class="op" id="5413652">,</span>&nbsp;<span class="ident" id="5413654">r</span><span class="op" id="5413655">}</span><br>
<span class="lineno"></span><span class="op" id="5413657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5413660">//&nbsp;Gray&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5413733">type</span>&nbsp;<span class="ident" id="5413738">Gray</span>&nbsp;<span class="keyword" id="5413743">struct</span>&nbsp;<span class="op" id="5413750">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413753">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413816">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413884">Pix</span>&nbsp;<span class="op" id="5413888">[</span><span class="op" id="5413889">]</span><span class="builtintype" id="5413890">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413897">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413973">Stride</span>&nbsp;<span class="builtintype" id="5413980">int</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413985">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414017">Rect</span>&nbsp;<span class="ident" id="5414022">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5414032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5414035">func</span>&nbsp;<span class="op" id="5414040">(</span><span class="ident" id="5414041">p</span>&nbsp;<span class="op" id="5414043">*</span><span class="ident" id="5414044">Gray</span><span class="op" id="5414048">)</span>&nbsp;<span class="ident" id="5414050">ColorModel</span><span class="op" id="5414060">(</span><span class="op" id="5414061">)</span>&nbsp;<span class="ident" id="5414063">color</span><span class="op" id="5414068">.</span><span class="ident" id="5414069">Model</span>&nbsp;<span class="op" id="5414075">{</span>&nbsp;<span class="keyword" id="5414077">return</span>&nbsp;<span class="ident" id="5414084">color</span><span class="op" id="5414089">.</span><span class="ident" id="5414090">GrayModel</span>&nbsp;<span class="op" id="5414100">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="5414103">func</span>&nbsp;<span class="op" id="5414108">(</span><span class="ident" id="5414109">p</span>&nbsp;<span class="op" id="5414111">*</span><span class="ident" id="5414112">Gray</span><span class="op" id="5414116">)</span>&nbsp;<span class="ident" id="5414118">Bounds</span><span class="op" id="5414124">(</span><span class="op" id="5414125">)</span>&nbsp;<span class="ident" id="5414127">Rectangle</span>&nbsp;<span class="op" id="5414137">{</span>&nbsp;<span class="keyword" id="5414139">return</span>&nbsp;<span class="ident" id="5414146">p</span><span class="op" id="5414147">.</span><span class="ident" id="5414148">Rect</span>&nbsp;<span class="op" id="5414153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5414156">func</span>&nbsp;<span class="op" id="5414161">(</span><span class="ident" id="5414162">p</span>&nbsp;<span class="op" id="5414164">*</span><span class="ident" id="5414165">Gray</span><span class="op" id="5414169">)</span>&nbsp;<span class="ident" id="5414171">At</span><span class="op" id="5414173">(</span><span class="ident" id="5414174">x</span><span class="op" id="5414175">,</span>&nbsp;<span class="ident" id="5414177">y</span>&nbsp;<span class="builtintype" id="5414179">int</span><span class="op" id="5414182">)</span>&nbsp;<span class="ident" id="5414184">color</span><span class="op" id="5414189">.</span><span class="ident" id="5414190">Color</span>&nbsp;<span class="op" id="5414196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414199">return</span>&nbsp;<span class="ident" id="5414206">p</span><span class="op" id="5414207">.</span><span class="ident" id="5414208">GrayAt</span><span class="op" id="5414214">(</span><span class="ident" id="5414215">x</span><span class="op" id="5414216">,</span>&nbsp;<span class="ident" id="5414218">y</span><span class="op" id="5414219">)</span><br>
<span class="lineno">685</span><span class="op" id="5414221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5414224">func</span>&nbsp;<span class="op" id="5414229">(</span><span class="ident" id="5414230">p</span>&nbsp;<span class="op" id="5414232">*</span><span class="ident" id="5414233">Gray</span><span class="op" id="5414237">)</span>&nbsp;<span class="ident" id="5414239">GrayAt</span><span class="op" id="5414245">(</span><span class="ident" id="5414246">x</span><span class="op" id="5414247">,</span>&nbsp;<span class="ident" id="5414249">y</span>&nbsp;<span class="builtintype" id="5414251">int</span><span class="op" id="5414254">)</span>&nbsp;<span class="ident" id="5414256">color</span><span class="op" id="5414261">.</span><span class="ident" id="5414262">Gray</span>&nbsp;<span class="op" id="5414267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414270">if</span>&nbsp;<span class="op" id="5414273">!</span><span class="op" id="5414274">(</span><span class="ident" id="5414275">Point</span><span class="op" id="5414280">{</span><span class="ident" id="5414281">x</span><span class="op" id="5414282">,</span>&nbsp;<span class="ident" id="5414284">y</span><span class="op" id="5414285">}</span><span class="op" id="5414286">.</span><span class="ident" id="5414287">In</span><span class="op" id="5414289">(</span><span class="ident" id="5414290">p</span><span class="op" id="5414291">.</span><span class="ident" id="5414292">Rect</span><span class="op" id="5414296">)</span><span class="op" id="5414297">)</span>&nbsp;<span class="op" id="5414299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414303">return</span>&nbsp;<span class="ident" id="5414310">color</span><span class="op" id="5414315">.</span><span class="ident" id="5414316">Gray</span><span class="op" id="5414320">{</span><span class="op" id="5414321">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5414324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414327">i</span>&nbsp;<span class="op" id="5414329">:=</span>&nbsp;<span class="ident" id="5414332">p</span><span class="op" id="5414333">.</span><span class="ident" id="5414334">PixOffset</span><span class="op" id="5414343">(</span><span class="ident" id="5414344">x</span><span class="op" id="5414345">,</span>&nbsp;<span class="ident" id="5414347">y</span><span class="op" id="5414348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414351">return</span>&nbsp;<span class="ident" id="5414358">color</span><span class="op" id="5414363">.</span><span class="ident" id="5414364">Gray</span><span class="op" id="5414368">{</span><span class="ident" id="5414369">p</span><span class="op" id="5414370">.</span><span class="ident" id="5414371">Pix</span><span class="op" id="5414374">[</span><span class="ident" id="5414375">i</span><span class="op" id="5414376">]</span><span class="op" id="5414377">}</span><br>
<span class="lineno"></span><span class="op" id="5414379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="5414382">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5414461">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5414485">func</span>&nbsp;<span class="op" id="5414490">(</span><span class="ident" id="5414491">p</span>&nbsp;<span class="op" id="5414493">*</span><span class="ident" id="5414494">Gray</span><span class="op" id="5414498">)</span>&nbsp;<span class="ident" id="5414500">PixOffset</span><span class="op" id="5414509">(</span><span class="ident" id="5414510">x</span><span class="op" id="5414511">,</span>&nbsp;<span class="ident" id="5414513">y</span>&nbsp;<span class="builtintype" id="5414515">int</span><span class="op" id="5414518">)</span>&nbsp;<span class="builtintype" id="5414520">int</span>&nbsp;<span class="op" id="5414524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414527">return</span>&nbsp;<span class="op" id="5414534">(</span><span class="ident" id="5414535">y</span><span class="op" id="5414536">-</span><span class="ident" id="5414537">p</span><span class="op" id="5414538">.</span><span class="ident" id="5414539">Rect</span><span class="op" id="5414543">.</span><span class="ident" id="5414544">Min</span><span class="op" id="5414547">.</span><span class="ident" id="5414548">Y</span><span class="op" id="5414549">)</span><span class="op" id="5414550">*</span><span class="ident" id="5414551">p</span><span class="op" id="5414552">.</span><span class="ident" id="5414553">Stride</span>&nbsp;<span class="op" id="5414560">+</span>&nbsp;<span class="op" id="5414562">(</span><span class="ident" id="5414563">x</span><span class="op" id="5414564">-</span><span class="ident" id="5414565">p</span><span class="op" id="5414566">.</span><span class="ident" id="5414567">Rect</span><span class="op" id="5414571">.</span><span class="ident" id="5414572">Min</span><span class="op" id="5414575">.</span><span class="ident" id="5414576">X</span><span class="op" id="5414577">)</span><span class="op" id="5414578">*</span><span class="num" id="5414579">1</span><br>
<span class="lineno"></span><span class="op" id="5414581">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="5414584">func</span>&nbsp;<span class="op" id="5414589">(</span><span class="ident" id="5414590">p</span>&nbsp;<span class="op" id="5414592">*</span><span class="ident" id="5414593">Gray</span><span class="op" id="5414597">)</span>&nbsp;<span class="ident" id="5414599">Set</span><span class="op" id="5414602">(</span><span class="ident" id="5414603">x</span><span class="op" id="5414604">,</span>&nbsp;<span class="ident" id="5414606">y</span>&nbsp;<span class="builtintype" id="5414608">int</span><span class="op" id="5414611">,</span>&nbsp;<span class="ident" id="5414613">c</span>&nbsp;<span class="ident" id="5414615">color</span><span class="op" id="5414620">.</span><span class="ident" id="5414621">Color</span><span class="op" id="5414626">)</span>&nbsp;<span class="op" id="5414628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414631">if</span>&nbsp;<span class="op" id="5414634">!</span><span class="op" id="5414635">(</span><span class="ident" id="5414636">Point</span><span class="op" id="5414641">{</span><span class="ident" id="5414642">x</span><span class="op" id="5414643">,</span>&nbsp;<span class="ident" id="5414645">y</span><span class="op" id="5414646">}</span><span class="op" id="5414647">.</span><span class="ident" id="5414648">In</span><span class="op" id="5414650">(</span><span class="ident" id="5414651">p</span><span class="op" id="5414652">.</span><span class="ident" id="5414653">Rect</span><span class="op" id="5414657">)</span><span class="op" id="5414658">)</span>&nbsp;<span class="op" id="5414660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414664">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5414672">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414675">i</span>&nbsp;<span class="op" id="5414677">:=</span>&nbsp;<span class="ident" id="5414680">p</span><span class="op" id="5414681">.</span><span class="ident" id="5414682">PixOffset</span><span class="op" id="5414691">(</span><span class="ident" id="5414692">x</span><span class="op" id="5414693">,</span>&nbsp;<span class="ident" id="5414695">y</span><span class="op" id="5414696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414699">p</span><span class="op" id="5414700">.</span><span class="ident" id="5414701">Pix</span><span class="op" id="5414704">[</span><span class="ident" id="5414705">i</span><span class="op" id="5414706">]</span>&nbsp;<span class="op" id="5414708">=</span>&nbsp;<span class="ident" id="5414710">color</span><span class="op" id="5414715">.</span><span class="ident" id="5414716">GrayModel</span><span class="op" id="5414725">.</span><span class="ident" id="5414726">Convert</span><span class="op" id="5414733">(</span><span class="ident" id="5414734">c</span><span class="op" id="5414735">)</span><span class="op" id="5414736">.</span><span class="op" id="5414737">(</span><span class="ident" id="5414738">color</span><span class="op" id="5414743">.</span><span class="ident" id="5414744">Gray</span><span class="op" id="5414748">)</span><span class="op" id="5414749">.</span><span class="ident" id="5414750">Y</span><br>
<span class="lineno"></span><span class="op" id="5414752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5414755">func</span>&nbsp;<span class="op" id="5414760">(</span><span class="ident" id="5414761">p</span>&nbsp;<span class="op" id="5414763">*</span><span class="ident" id="5414764">Gray</span><span class="op" id="5414768">)</span>&nbsp;<span class="ident" id="5414770">SetGray</span><span class="op" id="5414777">(</span><span class="ident" id="5414778">x</span><span class="op" id="5414779">,</span>&nbsp;<span class="ident" id="5414781">y</span>&nbsp;<span class="builtintype" id="5414783">int</span><span class="op" id="5414786">,</span>&nbsp;<span class="ident" id="5414788">c</span>&nbsp;<span class="ident" id="5414790">color</span><span class="op" id="5414795">.</span><span class="ident" id="5414796">Gray</span><span class="op" id="5414800">)</span>&nbsp;<span class="op" id="5414802">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414805">if</span>&nbsp;<span class="op" id="5414808">!</span><span class="op" id="5414809">(</span><span class="ident" id="5414810">Point</span><span class="op" id="5414815">{</span><span class="ident" id="5414816">x</span><span class="op" id="5414817">,</span>&nbsp;<span class="ident" id="5414819">y</span><span class="op" id="5414820">}</span><span class="op" id="5414821">.</span><span class="ident" id="5414822">In</span><span class="op" id="5414824">(</span><span class="ident" id="5414825">p</span><span class="op" id="5414826">.</span><span class="ident" id="5414827">Rect</span><span class="op" id="5414831">)</span><span class="op" id="5414832">)</span>&nbsp;<span class="op" id="5414834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414838">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5414846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414849">i</span>&nbsp;<span class="op" id="5414851">:=</span>&nbsp;<span class="ident" id="5414854">p</span><span class="op" id="5414855">.</span><span class="ident" id="5414856">PixOffset</span><span class="op" id="5414865">(</span><span class="ident" id="5414866">x</span><span class="op" id="5414867">,</span>&nbsp;<span class="ident" id="5414869">y</span><span class="op" id="5414870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414873">p</span><span class="op" id="5414874">.</span><span class="ident" id="5414875">Pix</span><span class="op" id="5414878">[</span><span class="ident" id="5414879">i</span><span class="op" id="5414880">]</span>&nbsp;<span class="op" id="5414882">=</span>&nbsp;<span class="ident" id="5414884">c</span><span class="op" id="5414885">.</span><span class="ident" id="5414886">Y</span><br>
<span class="lineno">715</span><span class="op" id="5414888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5414891">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5414968">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5415040">func</span>&nbsp;<span class="op" id="5415045">(</span><span class="ident" id="5415046">p</span>&nbsp;<span class="op" id="5415048">*</span><span class="ident" id="5415049">Gray</span><span class="op" id="5415053">)</span>&nbsp;<span class="ident" id="5415055">SubImage</span><span class="op" id="5415063">(</span><span class="ident" id="5415064">r</span>&nbsp;<span class="ident" id="5415066">Rectangle</span><span class="op" id="5415075">)</span>&nbsp;<span class="ident" id="5415077">Image</span>&nbsp;<span class="op" id="5415083">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5415086">r</span>&nbsp;<span class="op" id="5415088">=</span>&nbsp;<span class="ident" id="5415090">r</span><span class="op" id="5415091">.</span><span class="ident" id="5415092">Intersect</span><span class="op" id="5415101">(</span><span class="ident" id="5415102">p</span><span class="op" id="5415103">.</span><span class="ident" id="5415104">Rect</span><span class="op" id="5415108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5415111">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5415192">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5415274">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415324">if</span>&nbsp;<span class="ident" id="5415327">r</span><span class="op" id="5415328">.</span><span class="ident" id="5415329">Empty</span><span class="op" id="5415334">(</span><span class="op" id="5415335">)</span>&nbsp;<span class="op" id="5415337">{</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415341">return</span>&nbsp;<span class="op" id="5415348">&amp;</span><span class="ident" id="5415349">Gray</span><span class="op" id="5415353">{</span><span class="op" id="5415354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5415357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5415360">i</span>&nbsp;<span class="op" id="5415362">:=</span>&nbsp;<span class="ident" id="5415365">p</span><span class="op" id="5415366">.</span><span class="ident" id="5415367">PixOffset</span><span class="op" id="5415376">(</span><span class="ident" id="5415377">r</span><span class="op" id="5415378">.</span><span class="ident" id="5415379">Min</span><span class="op" id="5415382">.</span><span class="ident" id="5415383">X</span><span class="op" id="5415384">,</span>&nbsp;<span class="ident" id="5415386">r</span><span class="op" id="5415387">.</span><span class="ident" id="5415388">Min</span><span class="op" id="5415391">.</span><span class="ident" id="5415392">Y</span><span class="op" id="5415393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415396">return</span>&nbsp;<span class="op" id="5415403">&amp;</span><span class="ident" id="5415404">Gray</span><span class="op" id="5415408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5415412">Pix</span><span class="op" id="5415415">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5415420">p</span><span class="op" id="5415421">.</span><span class="ident" id="5415422">Pix</span><span class="op" id="5415425">[</span><span class="ident" id="5415426">i</span><span class="op" id="5415427">:</span><span class="op" id="5415428">]</span><span class="op" id="5415429">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5415433">Stride</span><span class="op" id="5415439">:</span>&nbsp;<span class="ident" id="5415441">p</span><span class="op" id="5415442">.</span><span class="ident" id="5415443">Stride</span><span class="op" id="5415449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5415453">Rect</span><span class="op" id="5415457">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5415461">r</span><span class="op" id="5415462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5415465">}</span><br>
<span class="lineno"></span><span class="op" id="5415467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span><span class="comment" id="5415470">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5415543">func</span>&nbsp;<span class="op" id="5415548">(</span><span class="ident" id="5415549">p</span>&nbsp;<span class="op" id="5415551">*</span><span class="ident" id="5415552">Gray</span><span class="op" id="5415556">)</span>&nbsp;<span class="ident" id="5415558">Opaque</span><span class="op" id="5415564">(</span><span class="op" id="5415565">)</span>&nbsp;<span class="builtintype" id="5415567">bool</span>&nbsp;<span class="op" id="5415572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415575">return</span>&nbsp;<span class="builtintype" id="5415582">true</span><br>
<span class="lineno"></span><span class="op" id="5415587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="5415590">//&nbsp;NewGray&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5415643">func</span>&nbsp;<span class="ident" id="5415648">NewGray</span><span class="op" id="5415655">(</span><span class="ident" id="5415656">r</span>&nbsp;<span class="ident" id="5415658">Rectangle</span><span class="op" id="5415667">)</span>&nbsp;<span class="op" id="5415669">*</span><span class="ident" id="5415670">Gray</span>&nbsp;<span class="op" id="5415675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5415678">w</span><span class="op" id="5415679">,</span>&nbsp;<span class="ident" id="5415681">h</span>&nbsp;<span class="op" id="5415683">:=</span>&nbsp;<span class="ident" id="5415686">r</span><span class="op" id="5415687">.</span><span class="ident" id="5415688">Dx</span><span class="op" id="5415690">(</span><span class="op" id="5415691">)</span><span class="op" id="5415692">,</span>&nbsp;<span class="ident" id="5415694">r</span><span class="op" id="5415695">.</span><span class="ident" id="5415696">Dy</span><span class="op" id="5415698">(</span><span class="op" id="5415699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5415702">pix</span>&nbsp;<span class="op" id="5415706">:=</span>&nbsp;<span class="builtinfunc" id="5415709">make</span><span class="op" id="5415713">(</span><span class="op" id="5415714">[</span><span class="op" id="5415715">]</span><span class="builtintype" id="5415716">uint8</span><span class="op" id="5415721">,</span>&nbsp;<span class="num" id="5415723">1</span><span class="op" id="5415724">*</span><span class="ident" id="5415725">w</span><span class="op" id="5415726">*</span><span class="ident" id="5415727">h</span><span class="op" id="5415728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415731">return</span>&nbsp;<span class="op" id="5415738">&amp;</span><span class="ident" id="5415739">Gray</span><span class="op" id="5415743">{</span><span class="ident" id="5415744">pix</span><span class="op" id="5415747">,</span>&nbsp;<span class="num" id="5415749">1</span>&nbsp;<span class="op" id="5415751">*</span>&nbsp;<span class="ident" id="5415753">w</span><span class="op" id="5415754">,</span>&nbsp;<span class="ident" id="5415756">r</span><span class="op" id="5415757">}</span><br>
<span class="lineno">745</span><span class="op" id="5415759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5415762">//&nbsp;Gray16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray16&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5415839">type</span>&nbsp;<span class="ident" id="5415844">Gray16</span>&nbsp;<span class="keyword" id="5415851">struct</span>&nbsp;<span class="op" id="5415858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5415861">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5415945">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416013">Pix</span>&nbsp;<span class="op" id="5416017">[</span><span class="op" id="5416018">]</span><span class="builtintype" id="5416019">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5416026">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416102">Stride</span>&nbsp;<span class="builtintype" id="5416109">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5416114">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416146">Rect</span>&nbsp;<span class="ident" id="5416151">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5416161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5416164">func</span>&nbsp;<span class="op" id="5416169">(</span><span class="ident" id="5416170">p</span>&nbsp;<span class="op" id="5416172">*</span><span class="ident" id="5416173">Gray16</span><span class="op" id="5416179">)</span>&nbsp;<span class="ident" id="5416181">ColorModel</span><span class="op" id="5416191">(</span><span class="op" id="5416192">)</span>&nbsp;<span class="ident" id="5416194">color</span><span class="op" id="5416199">.</span><span class="ident" id="5416200">Model</span>&nbsp;<span class="op" id="5416206">{</span>&nbsp;<span class="keyword" id="5416208">return</span>&nbsp;<span class="ident" id="5416215">color</span><span class="op" id="5416220">.</span><span class="ident" id="5416221">Gray16Model</span>&nbsp;<span class="op" id="5416233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span><span class="keyword" id="5416236">func</span>&nbsp;<span class="op" id="5416241">(</span><span class="ident" id="5416242">p</span>&nbsp;<span class="op" id="5416244">*</span><span class="ident" id="5416245">Gray16</span><span class="op" id="5416251">)</span>&nbsp;<span class="ident" id="5416253">Bounds</span><span class="op" id="5416259">(</span><span class="op" id="5416260">)</span>&nbsp;<span class="ident" id="5416262">Rectangle</span>&nbsp;<span class="op" id="5416272">{</span>&nbsp;<span class="keyword" id="5416274">return</span>&nbsp;<span class="ident" id="5416281">p</span><span class="op" id="5416282">.</span><span class="ident" id="5416283">Rect</span>&nbsp;<span class="op" id="5416288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5416291">func</span>&nbsp;<span class="op" id="5416296">(</span><span class="ident" id="5416297">p</span>&nbsp;<span class="op" id="5416299">*</span><span class="ident" id="5416300">Gray16</span><span class="op" id="5416306">)</span>&nbsp;<span class="ident" id="5416308">At</span><span class="op" id="5416310">(</span><span class="ident" id="5416311">x</span><span class="op" id="5416312">,</span>&nbsp;<span class="ident" id="5416314">y</span>&nbsp;<span class="builtintype" id="5416316">int</span><span class="op" id="5416319">)</span>&nbsp;<span class="ident" id="5416321">color</span><span class="op" id="5416326">.</span><span class="ident" id="5416327">Color</span>&nbsp;<span class="op" id="5416333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416336">return</span>&nbsp;<span class="ident" id="5416343">p</span><span class="op" id="5416344">.</span><span class="ident" id="5416345">Gray16At</span><span class="op" id="5416353">(</span><span class="ident" id="5416354">x</span><span class="op" id="5416355">,</span>&nbsp;<span class="ident" id="5416357">y</span><span class="op" id="5416358">)</span><br>
<span class="lineno"></span><span class="op" id="5416360">}</span><br>
<span class="lineno">765</span><br>
<span class="lineno"></span><span class="keyword" id="5416363">func</span>&nbsp;<span class="op" id="5416368">(</span><span class="ident" id="5416369">p</span>&nbsp;<span class="op" id="5416371">*</span><span class="ident" id="5416372">Gray16</span><span class="op" id="5416378">)</span>&nbsp;<span class="ident" id="5416380">Gray16At</span><span class="op" id="5416388">(</span><span class="ident" id="5416389">x</span><span class="op" id="5416390">,</span>&nbsp;<span class="ident" id="5416392">y</span>&nbsp;<span class="builtintype" id="5416394">int</span><span class="op" id="5416397">)</span>&nbsp;<span class="ident" id="5416399">color</span><span class="op" id="5416404">.</span><span class="ident" id="5416405">Gray16</span>&nbsp;<span class="op" id="5416412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416415">if</span>&nbsp;<span class="op" id="5416418">!</span><span class="op" id="5416419">(</span><span class="ident" id="5416420">Point</span><span class="op" id="5416425">{</span><span class="ident" id="5416426">x</span><span class="op" id="5416427">,</span>&nbsp;<span class="ident" id="5416429">y</span><span class="op" id="5416430">}</span><span class="op" id="5416431">.</span><span class="ident" id="5416432">In</span><span class="op" id="5416434">(</span><span class="ident" id="5416435">p</span><span class="op" id="5416436">.</span><span class="ident" id="5416437">Rect</span><span class="op" id="5416441">)</span><span class="op" id="5416442">)</span>&nbsp;<span class="op" id="5416444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416448">return</span>&nbsp;<span class="ident" id="5416455">color</span><span class="op" id="5416460">.</span><span class="ident" id="5416461">Gray16</span><span class="op" id="5416467">{</span><span class="op" id="5416468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5416471">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416474">i</span>&nbsp;<span class="op" id="5416476">:=</span>&nbsp;<span class="ident" id="5416479">p</span><span class="op" id="5416480">.</span><span class="ident" id="5416481">PixOffset</span><span class="op" id="5416490">(</span><span class="ident" id="5416491">x</span><span class="op" id="5416492">,</span>&nbsp;<span class="ident" id="5416494">y</span><span class="op" id="5416495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416498">return</span>&nbsp;<span class="ident" id="5416505">color</span><span class="op" id="5416510">.</span><span class="ident" id="5416511">Gray16</span><span class="op" id="5416517">{</span><span class="builtintype" id="5416518">uint16</span><span class="op" id="5416524">(</span><span class="ident" id="5416525">p</span><span class="op" id="5416526">.</span><span class="ident" id="5416527">Pix</span><span class="op" id="5416530">[</span><span class="ident" id="5416531">i</span><span class="op" id="5416532">+</span><span class="num" id="5416533">0</span><span class="op" id="5416534">]</span><span class="op" id="5416535">)</span><span class="op" id="5416536">&lt;&lt;</span><span class="num" id="5416538">8</span>&nbsp;<span class="op" id="5416540">|</span>&nbsp;<span class="builtintype" id="5416542">uint16</span><span class="op" id="5416548">(</span><span class="ident" id="5416549">p</span><span class="op" id="5416550">.</span><span class="ident" id="5416551">Pix</span><span class="op" id="5416554">[</span><span class="ident" id="5416555">i</span><span class="op" id="5416556">+</span><span class="num" id="5416557">1</span><span class="op" id="5416558">]</span><span class="op" id="5416559">)</span><span class="op" id="5416560">}</span><br>
<span class="lineno"></span><span class="op" id="5416562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5416565">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">775</span><span class="comment" id="5416644">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5416668">func</span>&nbsp;<span class="op" id="5416673">(</span><span class="ident" id="5416674">p</span>&nbsp;<span class="op" id="5416676">*</span><span class="ident" id="5416677">Gray16</span><span class="op" id="5416683">)</span>&nbsp;<span class="ident" id="5416685">PixOffset</span><span class="op" id="5416694">(</span><span class="ident" id="5416695">x</span><span class="op" id="5416696">,</span>&nbsp;<span class="ident" id="5416698">y</span>&nbsp;<span class="builtintype" id="5416700">int</span><span class="op" id="5416703">)</span>&nbsp;<span class="builtintype" id="5416705">int</span>&nbsp;<span class="op" id="5416709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416712">return</span>&nbsp;<span class="op" id="5416719">(</span><span class="ident" id="5416720">y</span><span class="op" id="5416721">-</span><span class="ident" id="5416722">p</span><span class="op" id="5416723">.</span><span class="ident" id="5416724">Rect</span><span class="op" id="5416728">.</span><span class="ident" id="5416729">Min</span><span class="op" id="5416732">.</span><span class="ident" id="5416733">Y</span><span class="op" id="5416734">)</span><span class="op" id="5416735">*</span><span class="ident" id="5416736">p</span><span class="op" id="5416737">.</span><span class="ident" id="5416738">Stride</span>&nbsp;<span class="op" id="5416745">+</span>&nbsp;<span class="op" id="5416747">(</span><span class="ident" id="5416748">x</span><span class="op" id="5416749">-</span><span class="ident" id="5416750">p</span><span class="op" id="5416751">.</span><span class="ident" id="5416752">Rect</span><span class="op" id="5416756">.</span><span class="ident" id="5416757">Min</span><span class="op" id="5416760">.</span><span class="ident" id="5416761">X</span><span class="op" id="5416762">)</span><span class="op" id="5416763">*</span><span class="num" id="5416764">2</span><br>
<span class="lineno"></span><span class="op" id="5416766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">780</span><span class="keyword" id="5416769">func</span>&nbsp;<span class="op" id="5416774">(</span><span class="ident" id="5416775">p</span>&nbsp;<span class="op" id="5416777">*</span><span class="ident" id="5416778">Gray16</span><span class="op" id="5416784">)</span>&nbsp;<span class="ident" id="5416786">Set</span><span class="op" id="5416789">(</span><span class="ident" id="5416790">x</span><span class="op" id="5416791">,</span>&nbsp;<span class="ident" id="5416793">y</span>&nbsp;<span class="builtintype" id="5416795">int</span><span class="op" id="5416798">,</span>&nbsp;<span class="ident" id="5416800">c</span>&nbsp;<span class="ident" id="5416802">color</span><span class="op" id="5416807">.</span><span class="ident" id="5416808">Color</span><span class="op" id="5416813">)</span>&nbsp;<span class="op" id="5416815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416818">if</span>&nbsp;<span class="op" id="5416821">!</span><span class="op" id="5416822">(</span><span class="ident" id="5416823">Point</span><span class="op" id="5416828">{</span><span class="ident" id="5416829">x</span><span class="op" id="5416830">,</span>&nbsp;<span class="ident" id="5416832">y</span><span class="op" id="5416833">}</span><span class="op" id="5416834">.</span><span class="ident" id="5416835">In</span><span class="op" id="5416837">(</span><span class="ident" id="5416838">p</span><span class="op" id="5416839">.</span><span class="ident" id="5416840">Rect</span><span class="op" id="5416844">)</span><span class="op" id="5416845">)</span>&nbsp;<span class="op" id="5416847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416851">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5416859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416862">i</span>&nbsp;<span class="op" id="5416864">:=</span>&nbsp;<span class="ident" id="5416867">p</span><span class="op" id="5416868">.</span><span class="ident" id="5416869">PixOffset</span><span class="op" id="5416878">(</span><span class="ident" id="5416879">x</span><span class="op" id="5416880">,</span>&nbsp;<span class="ident" id="5416882">y</span><span class="op" id="5416883">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416886">c1</span>&nbsp;<span class="op" id="5416889">:=</span>&nbsp;<span class="ident" id="5416892">color</span><span class="op" id="5416897">.</span><span class="ident" id="5416898">Gray16Model</span><span class="op" id="5416909">.</span><span class="ident" id="5416910">Convert</span><span class="op" id="5416917">(</span><span class="ident" id="5416918">c</span><span class="op" id="5416919">)</span><span class="op" id="5416920">.</span><span class="op" id="5416921">(</span><span class="ident" id="5416922">color</span><span class="op" id="5416927">.</span><span class="ident" id="5416928">Gray16</span><span class="op" id="5416934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416937">p</span><span class="op" id="5416938">.</span><span class="ident" id="5416939">Pix</span><span class="op" id="5416942">[</span><span class="ident" id="5416943">i</span><span class="op" id="5416944">+</span><span class="num" id="5416945">0</span><span class="op" id="5416946">]</span>&nbsp;<span class="op" id="5416948">=</span>&nbsp;<span class="builtintype" id="5416950">uint8</span><span class="op" id="5416955">(</span><span class="ident" id="5416956">c1</span><span class="op" id="5416958">.</span><span class="ident" id="5416959">Y</span>&nbsp;<span class="op" id="5416961">&gt;&gt;</span>&nbsp;<span class="num" id="5416964">8</span><span class="op" id="5416965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416968">p</span><span class="op" id="5416969">.</span><span class="ident" id="5416970">Pix</span><span class="op" id="5416973">[</span><span class="ident" id="5416974">i</span><span class="op" id="5416975">+</span><span class="num" id="5416976">1</span><span class="op" id="5416977">]</span>&nbsp;<span class="op" id="5416979">=</span>&nbsp;<span class="builtintype" id="5416981">uint8</span><span class="op" id="5416986">(</span><span class="ident" id="5416987">c1</span><span class="op" id="5416989">.</span><span class="ident" id="5416990">Y</span><span class="op" id="5416991">)</span><br>
<span class="lineno"></span><span class="op" id="5416993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span><span class="keyword" id="5416996">func</span>&nbsp;<span class="op" id="5417001">(</span><span class="ident" id="5417002">p</span>&nbsp;<span class="op" id="5417004">*</span><span class="ident" id="5417005">Gray16</span><span class="op" id="5417011">)</span>&nbsp;<span class="ident" id="5417013">SetGray16</span><span class="op" id="5417022">(</span><span class="ident" id="5417023">x</span><span class="op" id="5417024">,</span>&nbsp;<span class="ident" id="5417026">y</span>&nbsp;<span class="builtintype" id="5417028">int</span><span class="op" id="5417031">,</span>&nbsp;<span class="ident" id="5417033">c</span>&nbsp;<span class="ident" id="5417035">color</span><span class="op" id="5417040">.</span><span class="ident" id="5417041">Gray16</span><span class="op" id="5417047">)</span>&nbsp;<span class="op" id="5417049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417052">if</span>&nbsp;<span class="op" id="5417055">!</span><span class="op" id="5417056">(</span><span class="ident" id="5417057">Point</span><span class="op" id="5417062">{</span><span class="ident" id="5417063">x</span><span class="op" id="5417064">,</span>&nbsp;<span class="ident" id="5417066">y</span><span class="op" id="5417067">}</span><span class="op" id="5417068">.</span><span class="ident" id="5417069">In</span><span class="op" id="5417071">(</span><span class="ident" id="5417072">p</span><span class="op" id="5417073">.</span><span class="ident" id="5417074">Rect</span><span class="op" id="5417078">)</span><span class="op" id="5417079">)</span>&nbsp;<span class="op" id="5417081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417085">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5417093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417096">i</span>&nbsp;<span class="op" id="5417098">:=</span>&nbsp;<span class="ident" id="5417101">p</span><span class="op" id="5417102">.</span><span class="ident" id="5417103">PixOffset</span><span class="op" id="5417112">(</span><span class="ident" id="5417113">x</span><span class="op" id="5417114">,</span>&nbsp;<span class="ident" id="5417116">y</span><span class="op" id="5417117">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417120">p</span><span class="op" id="5417121">.</span><span class="ident" id="5417122">Pix</span><span class="op" id="5417125">[</span><span class="ident" id="5417126">i</span><span class="op" id="5417127">+</span><span class="num" id="5417128">0</span><span class="op" id="5417129">]</span>&nbsp;<span class="op" id="5417131">=</span>&nbsp;<span class="builtintype" id="5417133">uint8</span><span class="op" id="5417138">(</span><span class="ident" id="5417139">c</span><span class="op" id="5417140">.</span><span class="ident" id="5417141">Y</span>&nbsp;<span class="op" id="5417143">&gt;&gt;</span>&nbsp;<span class="num" id="5417146">8</span><span class="op" id="5417147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417150">p</span><span class="op" id="5417151">.</span><span class="ident" id="5417152">Pix</span><span class="op" id="5417155">[</span><span class="ident" id="5417156">i</span><span class="op" id="5417157">+</span><span class="num" id="5417158">1</span><span class="op" id="5417159">]</span>&nbsp;<span class="op" id="5417161">=</span>&nbsp;<span class="builtintype" id="5417163">uint8</span><span class="op" id="5417168">(</span><span class="ident" id="5417169">c</span><span class="op" id="5417170">.</span><span class="ident" id="5417171">Y</span><span class="op" id="5417172">)</span><br>
<span class="lineno"></span><span class="op" id="5417174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5417177">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno">800</span><span class="comment" id="5417254">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5417326">func</span>&nbsp;<span class="op" id="5417331">(</span><span class="ident" id="5417332">p</span>&nbsp;<span class="op" id="5417334">*</span><span class="ident" id="5417335">Gray16</span><span class="op" id="5417341">)</span>&nbsp;<span class="ident" id="5417343">SubImage</span><span class="op" id="5417351">(</span><span class="ident" id="5417352">r</span>&nbsp;<span class="ident" id="5417354">Rectangle</span><span class="op" id="5417363">)</span>&nbsp;<span class="ident" id="5417365">Image</span>&nbsp;<span class="op" id="5417371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417374">r</span>&nbsp;<span class="op" id="5417376">=</span>&nbsp;<span class="ident" id="5417378">r</span><span class="op" id="5417379">.</span><span class="ident" id="5417380">Intersect</span><span class="op" id="5417389">(</span><span class="ident" id="5417390">p</span><span class="op" id="5417391">.</span><span class="ident" id="5417392">Rect</span><span class="op" id="5417396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5417399">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5417480">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5417562">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417612">if</span>&nbsp;<span class="ident" id="5417615">r</span><span class="op" id="5417616">.</span><span class="ident" id="5417617">Empty</span><span class="op" id="5417622">(</span><span class="op" id="5417623">)</span>&nbsp;<span class="op" id="5417625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417629">return</span>&nbsp;<span class="op" id="5417636">&amp;</span><span class="ident" id="5417637">Gray16</span><span class="op" id="5417643">{</span><span class="op" id="5417644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5417647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417650">i</span>&nbsp;<span class="op" id="5417652">:=</span>&nbsp;<span class="ident" id="5417655">p</span><span class="op" id="5417656">.</span><span class="ident" id="5417657">PixOffset</span><span class="op" id="5417666">(</span><span class="ident" id="5417667">r</span><span class="op" id="5417668">.</span><span class="ident" id="5417669">Min</span><span class="op" id="5417672">.</span><span class="ident" id="5417673">X</span><span class="op" id="5417674">,</span>&nbsp;<span class="ident" id="5417676">r</span><span class="op" id="5417677">.</span><span class="ident" id="5417678">Min</span><span class="op" id="5417681">.</span><span class="ident" id="5417682">Y</span><span class="op" id="5417683">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417686">return</span>&nbsp;<span class="op" id="5417693">&amp;</span><span class="ident" id="5417694">Gray16</span><span class="op" id="5417700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417704">Pix</span><span class="op" id="5417707">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417712">p</span><span class="op" id="5417713">.</span><span class="ident" id="5417714">Pix</span><span class="op" id="5417717">[</span><span class="ident" id="5417718">i</span><span class="op" id="5417719">:</span><span class="op" id="5417720">]</span><span class="op" id="5417721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417725">Stride</span><span class="op" id="5417731">:</span>&nbsp;<span class="ident" id="5417733">p</span><span class="op" id="5417734">.</span><span class="ident" id="5417735">Stride</span><span class="op" id="5417741">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417745">Rect</span><span class="op" id="5417749">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5417753">r</span><span class="op" id="5417754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5417757">}</span><br>
<span class="lineno">815</span><span class="op" id="5417759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5417762">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5417835">func</span>&nbsp;<span class="op" id="5417840">(</span><span class="ident" id="5417841">p</span>&nbsp;<span class="op" id="5417843">*</span><span class="ident" id="5417844">Gray16</span><span class="op" id="5417850">)</span>&nbsp;<span class="ident" id="5417852">Opaque</span><span class="op" id="5417858">(</span><span class="op" id="5417859">)</span>&nbsp;<span class="builtintype" id="5417861">bool</span>&nbsp;<span class="op" id="5417866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417869">return</span>&nbsp;<span class="builtintype" id="5417876">true</span><br>
<span class="lineno">820</span><span class="op" id="5417881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5417884">//&nbsp;NewGray16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5417941">func</span>&nbsp;<span class="ident" id="5417946">NewGray16</span><span class="op" id="5417955">(</span><span class="ident" id="5417956">r</span>&nbsp;<span class="ident" id="5417958">Rectangle</span><span class="op" id="5417967">)</span>&nbsp;<span class="op" id="5417969">*</span><span class="ident" id="5417970">Gray16</span>&nbsp;<span class="op" id="5417977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417980">w</span><span class="op" id="5417981">,</span>&nbsp;<span class="ident" id="5417983">h</span>&nbsp;<span class="op" id="5417985">:=</span>&nbsp;<span class="ident" id="5417988">r</span><span class="op" id="5417989">.</span><span class="ident" id="5417990">Dx</span><span class="op" id="5417992">(</span><span class="op" id="5417993">)</span><span class="op" id="5417994">,</span>&nbsp;<span class="ident" id="5417996">r</span><span class="op" id="5417997">.</span><span class="ident" id="5417998">Dy</span><span class="op" id="5418000">(</span><span class="op" id="5418001">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418004">pix</span>&nbsp;<span class="op" id="5418008">:=</span>&nbsp;<span class="builtinfunc" id="5418011">make</span><span class="op" id="5418015">(</span><span class="op" id="5418016">[</span><span class="op" id="5418017">]</span><span class="builtintype" id="5418018">uint8</span><span class="op" id="5418023">,</span>&nbsp;<span class="num" id="5418025">2</span><span class="op" id="5418026">*</span><span class="ident" id="5418027">w</span><span class="op" id="5418028">*</span><span class="ident" id="5418029">h</span><span class="op" id="5418030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418033">return</span>&nbsp;<span class="op" id="5418040">&amp;</span><span class="ident" id="5418041">Gray16</span><span class="op" id="5418047">{</span><span class="ident" id="5418048">pix</span><span class="op" id="5418051">,</span>&nbsp;<span class="num" id="5418053">2</span>&nbsp;<span class="op" id="5418055">*</span>&nbsp;<span class="ident" id="5418057">w</span><span class="op" id="5418058">,</span>&nbsp;<span class="ident" id="5418060">r</span><span class="op" id="5418061">}</span><br>
<span class="lineno"></span><span class="op" id="5418063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5418066">//&nbsp;Paletted&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;uint8&nbsp;indices&nbsp;into&nbsp;a&nbsp;given&nbsp;palette.</span><br>
<span class="lineno">830</span><span class="keyword" id="5418139">type</span>&nbsp;<span class="ident" id="5418144">Paletted</span>&nbsp;<span class="keyword" id="5418153">struct</span>&nbsp;<span class="op" id="5418160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5418163">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;palette&nbsp;indices.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5418230">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418298">Pix</span>&nbsp;<span class="op" id="5418302">[</span><span class="op" id="5418303">]</span><span class="builtintype" id="5418304">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5418311">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418387">Stride</span>&nbsp;<span class="builtintype" id="5418394">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5418399">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418431">Rect</span>&nbsp;<span class="ident" id="5418436">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5418447">//&nbsp;Palette&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418483">Palette</span>&nbsp;<span class="ident" id="5418491">color</span><span class="op" id="5418496">.</span><span class="ident" id="5418497">Palette</span><br>
<span class="lineno">840</span><span class="op" id="5418505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5418508">func</span>&nbsp;<span class="op" id="5418513">(</span><span class="ident" id="5418514">p</span>&nbsp;<span class="op" id="5418516">*</span><span class="ident" id="5418517">Paletted</span><span class="op" id="5418525">)</span>&nbsp;<span class="ident" id="5418527">ColorModel</span><span class="op" id="5418537">(</span><span class="op" id="5418538">)</span>&nbsp;<span class="ident" id="5418540">color</span><span class="op" id="5418545">.</span><span class="ident" id="5418546">Model</span>&nbsp;<span class="op" id="5418552">{</span>&nbsp;<span class="keyword" id="5418554">return</span>&nbsp;<span class="ident" id="5418561">p</span><span class="op" id="5418562">.</span><span class="ident" id="5418563">Palette</span>&nbsp;<span class="op" id="5418571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5418574">func</span>&nbsp;<span class="op" id="5418579">(</span><span class="ident" id="5418580">p</span>&nbsp;<span class="op" id="5418582">*</span><span class="ident" id="5418583">Paletted</span><span class="op" id="5418591">)</span>&nbsp;<span class="ident" id="5418593">Bounds</span><span class="op" id="5418599">(</span><span class="op" id="5418600">)</span>&nbsp;<span class="ident" id="5418602">Rectangle</span>&nbsp;<span class="op" id="5418612">{</span>&nbsp;<span class="keyword" id="5418614">return</span>&nbsp;<span class="ident" id="5418621">p</span><span class="op" id="5418622">.</span><span class="ident" id="5418623">Rect</span>&nbsp;<span class="op" id="5418628">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="5418631">func</span>&nbsp;<span class="op" id="5418636">(</span><span class="ident" id="5418637">p</span>&nbsp;<span class="op" id="5418639">*</span><span class="ident" id="5418640">Paletted</span><span class="op" id="5418648">)</span>&nbsp;<span class="ident" id="5418650">At</span><span class="op" id="5418652">(</span><span class="ident" id="5418653">x</span><span class="op" id="5418654">,</span>&nbsp;<span class="ident" id="5418656">y</span>&nbsp;<span class="builtintype" id="5418658">int</span><span class="op" id="5418661">)</span>&nbsp;<span class="ident" id="5418663">color</span><span class="op" id="5418668">.</span><span class="ident" id="5418669">Color</span>&nbsp;<span class="op" id="5418675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418678">if</span>&nbsp;<span class="builtinfunc" id="5418681">len</span><span class="op" id="5418684">(</span><span class="ident" id="5418685">p</span><span class="op" id="5418686">.</span><span class="ident" id="5418687">Palette</span><span class="op" id="5418694">)</span>&nbsp;<span class="op" id="5418696">==</span>&nbsp;<span class="num" id="5418699">0</span>&nbsp;<span class="op" id="5418701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418705">return</span>&nbsp;<span class="ident" id="5418712">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5418717">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418720">if</span>&nbsp;<span class="op" id="5418723">!</span><span class="op" id="5418724">(</span><span class="ident" id="5418725">Point</span><span class="op" id="5418730">{</span><span class="ident" id="5418731">x</span><span class="op" id="5418732">,</span>&nbsp;<span class="ident" id="5418734">y</span><span class="op" id="5418735">}</span><span class="op" id="5418736">.</span><span class="ident" id="5418737">In</span><span class="op" id="5418739">(</span><span class="ident" id="5418740">p</span><span class="op" id="5418741">.</span><span class="ident" id="5418742">Rect</span><span class="op" id="5418746">)</span><span class="op" id="5418747">)</span>&nbsp;<span class="op" id="5418749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418753">return</span>&nbsp;<span class="ident" id="5418760">p</span><span class="op" id="5418761">.</span><span class="ident" id="5418762">Palette</span><span class="op" id="5418769">[</span><span class="num" id="5418770">0</span><span class="op" id="5418771">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5418774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418777">i</span>&nbsp;<span class="op" id="5418779">:=</span>&nbsp;<span class="ident" id="5418782">p</span><span class="op" id="5418783">.</span><span class="ident" id="5418784">PixOffset</span><span class="op" id="5418793">(</span><span class="ident" id="5418794">x</span><span class="op" id="5418795">,</span>&nbsp;<span class="ident" id="5418797">y</span><span class="op" id="5418798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418801">return</span>&nbsp;<span class="ident" id="5418808">p</span><span class="op" id="5418809">.</span><span class="ident" id="5418810">Palette</span><span class="op" id="5418817">[</span><span class="ident" id="5418818">p</span><span class="op" id="5418819">.</span><span class="ident" id="5418820">Pix</span><span class="op" id="5418823">[</span><span class="ident" id="5418824">i</span><span class="op" id="5418825">]</span><span class="op" id="5418826">]</span><br>
<span class="lineno">855</span><span class="op" id="5418828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5418831">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5418910">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5418934">func</span>&nbsp;<span class="op" id="5418939">(</span><span class="ident" id="5418940">p</span>&nbsp;<span class="op" id="5418942">*</span><span class="ident" id="5418943">Paletted</span><span class="op" id="5418951">)</span>&nbsp;<span class="ident" id="5418953">PixOffset</span><span class="op" id="5418962">(</span><span class="ident" id="5418963">x</span><span class="op" id="5418964">,</span>&nbsp;<span class="ident" id="5418966">y</span>&nbsp;<span class="builtintype" id="5418968">int</span><span class="op" id="5418971">)</span>&nbsp;<span class="builtintype" id="5418973">int</span>&nbsp;<span class="op" id="5418977">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418980">return</span>&nbsp;<span class="op" id="5418987">(</span><span class="ident" id="5418988">y</span><span class="op" id="5418989">-</span><span class="ident" id="5418990">p</span><span class="op" id="5418991">.</span><span class="ident" id="5418992">Rect</span><span class="op" id="5418996">.</span><span class="ident" id="5418997">Min</span><span class="op" id="5419000">.</span><span class="ident" id="5419001">Y</span><span class="op" id="5419002">)</span><span class="op" id="5419003">*</span><span class="ident" id="5419004">p</span><span class="op" id="5419005">.</span><span class="ident" id="5419006">Stride</span>&nbsp;<span class="op" id="5419013">+</span>&nbsp;<span class="op" id="5419015">(</span><span class="ident" id="5419016">x</span><span class="op" id="5419017">-</span><span class="ident" id="5419018">p</span><span class="op" id="5419019">.</span><span class="ident" id="5419020">Rect</span><span class="op" id="5419024">.</span><span class="ident" id="5419025">Min</span><span class="op" id="5419028">.</span><span class="ident" id="5419029">X</span><span class="op" id="5419030">)</span><span class="op" id="5419031">*</span><span class="num" id="5419032">1</span><br>
<span class="lineno"></span><span class="op" id="5419034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5419037">func</span>&nbsp;<span class="op" id="5419042">(</span><span class="ident" id="5419043">p</span>&nbsp;<span class="op" id="5419045">*</span><span class="ident" id="5419046">Paletted</span><span class="op" id="5419054">)</span>&nbsp;<span class="ident" id="5419056">Set</span><span class="op" id="5419059">(</span><span class="ident" id="5419060">x</span><span class="op" id="5419061">,</span>&nbsp;<span class="ident" id="5419063">y</span>&nbsp;<span class="builtintype" id="5419065">int</span><span class="op" id="5419068">,</span>&nbsp;<span class="ident" id="5419070">c</span>&nbsp;<span class="ident" id="5419072">color</span><span class="op" id="5419077">.</span><span class="ident" id="5419078">Color</span><span class="op" id="5419083">)</span>&nbsp;<span class="op" id="5419085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5419088">if</span>&nbsp;<span class="op" id="5419091">!</span><span class="op" id="5419092">(</span><span class="ident" id="5419093">Point</span><span class="op" id="5419098">{</span><span class="ident" id="5419099">x</span><span class="op" id="5419100">,</span>&nbsp;<span class="ident" id="5419102">y</span><span class="op" id="5419103">}</span><span class="op" id="5419104">.</span><span class="ident" id="5419105">In</span><span class="op" id="5419107">(</span><span class="ident" id="5419108">p</span><span class="op" id="5419109">.</span><span class="ident" id="5419110">Rect</span><span class="op" id="5419114">)</span><span class="op" id="5419115">)</span>&nbsp;<span class="op" id="5419117">{</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5419121">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5419129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5419132">i</span>&nbsp;<span class="op" id="5419134">:=</span>&nbsp;<span class="ident" id="5419137">p</span><span class="op" id="5419138">.</span><span class="ident" id="5419139">PixOffset</span><span class="op" id="5419148">(</span><span class="ident" id="5419149">x</span><span class="op" id="5419150">,</span>&nbsp;<span class="ident" id="5419152">y</span><span class="op" id="5419153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5419156">p</span><span class="op" id="5419157">.</span><span class="ident" id="5419158">Pix</span><span class="op" id="5419161">[</span><span class="ident" id="5419162">i</span><span class="op" id="5419163">]</span>&nbsp;<span class="op" id="5419165">=</span>&nbsp;<span class="builtintype" id="5419167">uint8</span><span class="op" id="5419172">(</span><span class="ident" id="5419173">p</span><span class="op" id="5419174">.</span><span class="ident" id="5419175">Palette</span><span class="op" id="5419182">.</span><span class="ident" id="5419183">Index</span><span class="op" id="5419188">(</span><span class="ident" id="5419189">c</span><span class="op" id="5419190">)</span><span class="op" id="5419191">)</span><br>
<span class="lineno"></span><span class="op" id="5419193">}</span><br>
<span class="lineno">870</span><br>
<span class="lineno"></span><span class="keyword" id="5419196">func</span>&nbsp;<span class="op" id="5419201">(</span><span class="ident" id="5419202">p</span>&nbsp;<span class="op" id="5419204">*</span><span class="ident" id="5419205">Paletted</span><span class="op" id="5419213">)</span>&nbsp;<span class="ident" id="5419215">ColorIndexAt</span><span class="op" id="5419227">(</span><span class="ident" id="5419228">x</span><span class="op" id="5419229">,</span>&nbsp;<span class="ident" id="5419231">y</span>&nbsp;<span class="builtintype" id="5419233">int</span><span class="op" id="5419236">)</span>&nbsp;<span class="builtintype" id="5419238">uint8</span>&nbsp;<span class="op" id="5419244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5419247">if</span>&nbsp;<span class="op" id="5419250">!</span><span class="op" id="5419251">(</span><span class="ident" id="5419252">Point</span><span class="op" id="5419257">{</span><span class="ident" id="5419258">x</span><span class="op" id="5419259">,</span>&nbsp;<span class="ident" id="5419261">y</span><span class="op" id="5419262">}</span><span class="op" id="5419263">.</span><span class="ident" id="5419264">In</span><span class="op" id="5419266">(</span><span class="ident" id="5419267">p</span><span class="op" id="5419268">.</span><span class="ident" id="5419269">Rect</span><span class="op" id="5419273">)</span><span class="op" id="5419274">)</span>&nbsp;<span class="op" id="5419276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5419280">return</span>&nbsp;<span class="num" id="5419287">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5419290">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5419293">i</span>&nbsp;<span class="op" id="5419295">:=</span>&nbsp;<span class="ident" id="5419298">p</span><span class="op" id="5419299">.</span><span class="ident" id="5419300">PixOffset</span><span class="op" id="5419309">(</span><span class="ident" id="5419310">x</span><span class="op" id="5419311">,</span>&nbsp;<span class="ident" id="5419313">y</span><span class="op" id="5419314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5419317">return</span>&nbsp;<span class="ident" id="5419324">p</span><span class="op" id="5419325">.</span><span class="ident" id="5419326">Pix</span><span class="op" id="5419329">[</span><span class="ident" id="5419330">i</span><span class="op" id="5419331">]</span><br>
<span class="lineno"></span><span class="op" id="5419333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5419336">func</span>&nbsp;<span class="op" id="5419341">(</span><span class="ident" id="5419342">p</span>&nbsp;<span class="op" id="5419344">*</span><span class="ident" id="5419345">Paletted</span><span class="op" id="5419353">)</span>&nbsp;<span class="ident" id="5419355">SetColorIndex</span><span class="op" id="5419368">(</span><span class="ident" id="5419369">x</span><span class="op" id="5419370">,</span>&nbsp;<span class="ident" id="5419372">y</span>&nbsp;<span class="builtintype" id="5419374">int</span><span class="op" id="5419377">,</span>&nbsp;<span class="ident" id="5419379">index</span>&nbsp;<span class="builtintype" id="5419385">uint8</span><span class="op" id="5419390">)</span>&nbsp;<span class="op" id="5419392">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5419395">if</span>&nbsp;<span class="op" id="5419398">!</span><span class="op" id="5419399">(</span><span class="ident" id="5419400">Point</span><span class="op" id="5419405">{</span><span class="ident" id="5419406">x</span><span class="op" id="5419407">,</span>&nbsp;<span class="ident" id="5419409">y</span><span class="op" id="5419410">}</span><span class="op" id="5419411">.</span><span class="ident" id="5419412">In</span><span class="op" id="5419414">(</span><span class="ident" id="5419415">p</span><span class="op" id="5419416">.</span><span class="ident" id="5419417">Rect</span><span class="op" id="5419421">)</span><span class="op" id="5419422">)</span>&nbsp;<span class="op" id="5419424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5419428">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5419436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5419439">i</span>&nbsp;<span class="op" id="5419441">:=</span>&nbsp;<span class="ident" id="5419444">p</span><span class="op" id="5419445">.</span><span class="ident" id="5419446">PixOffset</span><span class="op" id="5419455">(</span><span class="ident" id="5419456">x</span><span class="op" id="5419457">,</span>&nbsp;<span class="ident" id="5419459">y</span><span class="op" id="5419460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5419463">p</span><span class="op" id="5419464">.</span><span class="ident" id="5419465">Pix</span><span class="op" id="5419468">[</span><span class="ident" id="5419469">i</span><span class="op" id="5419470">]</span>&nbsp;<span class="op" id="5419472">=</span>&nbsp;<span class="ident" id="5419474">index</span><br>
<span class="lineno">885</span><span class="op" id="5419480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5419483">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5419560">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5419632">func</span>&nbsp;<span class="op" id="5419637">(</span><span class="ident" id="5419638">p</span>&nbsp;<span class="op" id="5419640">*</span><span class="ident" id="5419641">Paletted</span><span class="op" id="5419649">)</span>&nbsp;<span class="ident" id="5419651">SubImage</span><span class="op" id="5419659">(</span><span class="ident" id="5419660">r</span>&nbsp;<span class="ident" id="5419662">Rectangle</span><span class="op" id="5419671">)</span>&nbsp;<span class="ident" id="5419673">Image</span>&nbsp;<span class="op" id="5419679">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5419682">r</span>&nbsp;<span class="op" id="5419684">=</span>&nbsp;<span class="ident" id="5419686">r</span><span class="op" id="5419687">.</span><span class="ident" id="5419688">Intersect</span><span class="op" id="5419697">(</span><span class="ident" id="5419698">p</span><span class="op" id="5419699">.</span><span class="ident" id="5419700">Rect</span><span class="op" id="5419704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5419707">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5419788">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5419870">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5419920">if</span>&nbsp;<span class="ident" id="5419923">r</span><span class="op" id="5419924">.</span><span class="ident" id="5419925">Empty</span><span class="op" id="5419930">(</span><span class="op" id="5419931">)</span>&nbsp;<span class="op" id="5419933">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5419937">return</span>&nbsp;<span class="op" id="5419944">&amp;</span><span class="ident" id="5419945">Paletted</span><span class="op" id="5419953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5419958">Palette</span><span class="op" id="5419965">:</span>&nbsp;<span class="ident" id="5419967">p</span><span class="op" id="5419968">.</span><span class="ident" id="5419969">Palette</span><span class="op" id="5419976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5419980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5419983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5419986">i</span>&nbsp;<span class="op" id="5419988">:=</span>&nbsp;<span class="ident" id="5419991">p</span><span class="op" id="5419992">.</span><span class="ident" id="5419993">PixOffset</span><span class="op" id="5420002">(</span><span class="ident" id="5420003">r</span><span class="op" id="5420004">.</span><span class="ident" id="5420005">Min</span><span class="op" id="5420008">.</span><span class="ident" id="5420009">X</span><span class="op" id="5420010">,</span>&nbsp;<span class="ident" id="5420012">r</span><span class="op" id="5420013">.</span><span class="ident" id="5420014">Min</span><span class="op" id="5420017">.</span><span class="ident" id="5420018">Y</span><span class="op" id="5420019">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5420022">return</span>&nbsp;<span class="op" id="5420029">&amp;</span><span class="ident" id="5420030">Paletted</span><span class="op" id="5420038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420042">Pix</span><span class="op" id="5420045">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420051">p</span><span class="op" id="5420052">.</span><span class="ident" id="5420053">Pix</span><span class="op" id="5420056">[</span><span class="ident" id="5420057">i</span><span class="op" id="5420058">:</span><span class="op" id="5420059">]</span><span class="op" id="5420060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420064">Stride</span><span class="op" id="5420070">:</span>&nbsp;&nbsp;<span class="ident" id="5420073">p</span><span class="op" id="5420074">.</span><span class="ident" id="5420075">Stride</span><span class="op" id="5420081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420085">Rect</span><span class="op" id="5420089">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420094">p</span><span class="op" id="5420095">.</span><span class="ident" id="5420096">Rect</span><span class="op" id="5420100">.</span><span class="ident" id="5420101">Intersect</span><span class="op" id="5420110">(</span><span class="ident" id="5420111">r</span><span class="op" id="5420112">)</span><span class="op" id="5420113">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420117">Palette</span><span class="op" id="5420124">:</span>&nbsp;<span class="ident" id="5420126">p</span><span class="op" id="5420127">.</span><span class="ident" id="5420128">Palette</span><span class="op" id="5420135">,</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5420138">}</span><br>
<span class="lineno"></span><span class="op" id="5420140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5420143">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5420216">func</span>&nbsp;<span class="op" id="5420221">(</span><span class="ident" id="5420222">p</span>&nbsp;<span class="op" id="5420224">*</span><span class="ident" id="5420225">Paletted</span><span class="op" id="5420233">)</span>&nbsp;<span class="ident" id="5420235">Opaque</span><span class="op" id="5420241">(</span><span class="op" id="5420242">)</span>&nbsp;<span class="builtintype" id="5420244">bool</span>&nbsp;<span class="op" id="5420249">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5420252">var</span>&nbsp;<span class="ident" id="5420256">present</span>&nbsp;<span class="op" id="5420264">[</span><span class="num" id="5420265">256</span><span class="op" id="5420268">]</span><span class="builtintype" id="5420269">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420275">i0</span><span class="op" id="5420277">,</span>&nbsp;<span class="ident" id="5420279">i1</span>&nbsp;<span class="op" id="5420282">:=</span>&nbsp;<span class="num" id="5420285">0</span><span class="op" id="5420286">,</span>&nbsp;<span class="ident" id="5420288">p</span><span class="op" id="5420289">.</span><span class="ident" id="5420290">Rect</span><span class="op" id="5420294">.</span><span class="ident" id="5420295">Dx</span><span class="op" id="5420297">(</span><span class="op" id="5420298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5420301">for</span>&nbsp;<span class="ident" id="5420305">y</span>&nbsp;<span class="op" id="5420307">:=</span>&nbsp;<span class="ident" id="5420310">p</span><span class="op" id="5420311">.</span><span class="ident" id="5420312">Rect</span><span class="op" id="5420316">.</span><span class="ident" id="5420317">Min</span><span class="op" id="5420320">.</span><span class="ident" id="5420321">Y</span><span class="op" id="5420322">;</span>&nbsp;<span class="ident" id="5420324">y</span>&nbsp;<span class="op" id="5420326">&lt;</span>&nbsp;<span class="ident" id="5420328">p</span><span class="op" id="5420329">.</span><span class="ident" id="5420330">Rect</span><span class="op" id="5420334">.</span><span class="ident" id="5420335">Max</span><span class="op" id="5420338">.</span><span class="ident" id="5420339">Y</span><span class="op" id="5420340">;</span>&nbsp;<span class="ident" id="5420342">y</span><span class="op" id="5420343">++</span>&nbsp;<span class="op" id="5420346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5420350">for</span>&nbsp;<span class="ident" id="5420354">_</span><span class="op" id="5420355">,</span>&nbsp;<span class="ident" id="5420357">c</span>&nbsp;<span class="op" id="5420359">:=</span>&nbsp;<span class="keyword" id="5420362">range</span>&nbsp;<span class="ident" id="5420368">p</span><span class="op" id="5420369">.</span><span class="ident" id="5420370">Pix</span><span class="op" id="5420373">[</span><span class="ident" id="5420374">i0</span><span class="op" id="5420376">:</span><span class="ident" id="5420377">i1</span><span class="op" id="5420379">]</span>&nbsp;<span class="op" id="5420381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420386">present</span><span class="op" id="5420393">[</span><span class="ident" id="5420394">c</span><span class="op" id="5420395">]</span>&nbsp;<span class="op" id="5420397">=</span>&nbsp;<span class="builtintype" id="5420399">true</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5420406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420410">i0</span>&nbsp;<span class="op" id="5420413">+=</span>&nbsp;<span class="ident" id="5420416">p</span><span class="op" id="5420417">.</span><span class="ident" id="5420418">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420427">i1</span>&nbsp;<span class="op" id="5420430">+=</span>&nbsp;<span class="ident" id="5420433">p</span><span class="op" id="5420434">.</span><span class="ident" id="5420435">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5420443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5420446">for</span>&nbsp;<span class="ident" id="5420450">i</span><span class="op" id="5420451">,</span>&nbsp;<span class="ident" id="5420453">c</span>&nbsp;<span class="op" id="5420455">:=</span>&nbsp;<span class="keyword" id="5420458">range</span>&nbsp;<span class="ident" id="5420464">p</span><span class="op" id="5420465">.</span><span class="ident" id="5420466">Palette</span>&nbsp;<span class="op" id="5420474">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5420478">if</span>&nbsp;<span class="op" id="5420481">!</span><span class="ident" id="5420482">present</span><span class="op" id="5420489">[</span><span class="ident" id="5420490">i</span><span class="op" id="5420491">]</span>&nbsp;<span class="op" id="5420493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5420498">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5420509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420513">_</span><span class="op" id="5420514">,</span>&nbsp;<span class="ident" id="5420516">_</span><span class="op" id="5420517">,</span>&nbsp;<span class="ident" id="5420519">_</span><span class="op" id="5420520">,</span>&nbsp;<span class="ident" id="5420522">a</span>&nbsp;<span class="op" id="5420524">:=</span>&nbsp;<span class="ident" id="5420527">c</span><span class="op" id="5420528">.</span><span class="ident" id="5420529">RGBA</span><span class="op" id="5420533">(</span><span class="op" id="5420534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5420538">if</span>&nbsp;<span class="ident" id="5420541">a</span>&nbsp;<span class="op" id="5420543">!=</span>&nbsp;<span class="num" id="5420546">0xffff</span>&nbsp;<span class="op" id="5420553">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5420558">return</span>&nbsp;<span class="builtintype" id="5420565">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5420573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5420576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5420579">return</span>&nbsp;<span class="builtintype" id="5420586">true</span><br>
<span class="lineno"></span><span class="op" id="5420591">}</span><br>
<span class="lineno">930</span><br>
<span class="lineno"></span><span class="comment" id="5420594">//&nbsp;NewPaletted&nbsp;returns&nbsp;a&nbsp;new&nbsp;Paletted&nbsp;with&nbsp;the&nbsp;given&nbsp;width,&nbsp;height&nbsp;and&nbsp;palette.</span><br>
<span class="lineno"></span><span class="keyword" id="5420674">func</span>&nbsp;<span class="ident" id="5420679">NewPaletted</span><span class="op" id="5420690">(</span><span class="ident" id="5420691">r</span>&nbsp;<span class="ident" id="5420693">Rectangle</span><span class="op" id="5420702">,</span>&nbsp;<span class="ident" id="5420704">p</span>&nbsp;<span class="ident" id="5420706">color</span><span class="op" id="5420711">.</span><span class="ident" id="5420712">Palette</span><span class="op" id="5420719">)</span>&nbsp;<span class="op" id="5420721">*</span><span class="ident" id="5420722">Paletted</span>&nbsp;<span class="op" id="5420731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420734">w</span><span class="op" id="5420735">,</span>&nbsp;<span class="ident" id="5420737">h</span>&nbsp;<span class="op" id="5420739">:=</span>&nbsp;<span class="ident" id="5420742">r</span><span class="op" id="5420743">.</span><span class="ident" id="5420744">Dx</span><span class="op" id="5420746">(</span><span class="op" id="5420747">)</span><span class="op" id="5420748">,</span>&nbsp;<span class="ident" id="5420750">r</span><span class="op" id="5420751">.</span><span class="ident" id="5420752">Dy</span><span class="op" id="5420754">(</span><span class="op" id="5420755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420758">pix</span>&nbsp;<span class="op" id="5420762">:=</span>&nbsp;<span class="builtinfunc" id="5420765">make</span><span class="op" id="5420769">(</span><span class="op" id="5420770">[</span><span class="op" id="5420771">]</span><span class="builtintype" id="5420772">uint8</span><span class="op" id="5420777">,</span>&nbsp;<span class="num" id="5420779">1</span><span class="op" id="5420780">*</span><span class="ident" id="5420781">w</span><span class="op" id="5420782">*</span><span class="ident" id="5420783">h</span><span class="op" id="5420784">)</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5420787">return</span>&nbsp;<span class="op" id="5420794">&amp;</span><span class="ident" id="5420795">Paletted</span><span class="op" id="5420803">{</span><span class="ident" id="5420804">pix</span><span class="op" id="5420807">,</span>&nbsp;<span class="num" id="5420809">1</span>&nbsp;<span class="op" id="5420811">*</span>&nbsp;<span class="ident" id="5420813">w</span><span class="op" id="5420814">,</span>&nbsp;<span class="ident" id="5420816">r</span><span class="op" id="5420817">,</span>&nbsp;<span class="ident" id="5420819">p</span><span class="op" id="5420820">}</span><br>
<span class="lineno"></span><span class="op" id="5420822">}</span>
</div>
</body>
</html>
