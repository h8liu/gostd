<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/template</h2>
<ul>
<li><a href="/gostd/text/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/text/template/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/template/examplefiles_test.go.html">examplefiles_test.go</a></li>
<li><a href="/gostd/text/template/examplefunc_test.go.html">examplefunc_test.go</a></li>
<li><a href="/gostd/text/template/exec.go.html">exec.go</a></li>
<li><a href="/gostd/text/template/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/text/template/funcs.go.html">funcs.go</a></li>
<li><a href="/gostd/text/template/helper.go.html">helper.go</a></li>
<li><a href="/gostd/text/template/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/text/template/template.go.html">template.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5732459">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5732514">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5732568">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5732619">package</span>&nbsp;<span class="ident" id="5732627">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5732637">import</span>&nbsp;<span class="op" id="5732644">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5732647">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5732654">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5732665">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="5732687">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5732690">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;information&nbsp;shared&nbsp;by&nbsp;related&nbsp;templates.</span><br>
<span class="lineno"></span><span class="keyword" id="5732751">type</span>&nbsp;<span class="ident" id="5732756">common</span>&nbsp;<span class="keyword" id="5732763">struct</span>&nbsp;<span class="op" id="5732770">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5732773">tmpl</span>&nbsp;<span class="keyword" id="5732778">map</span><span class="op" id="5732781">[</span><span class="builtintype" id="5732782">string</span><span class="op" id="5732788">]</span><span class="op" id="5732789">*</span><span class="ident" id="5732790">Template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5732800">//&nbsp;We&nbsp;use&nbsp;two&nbsp;maps,&nbsp;one&nbsp;for&nbsp;parsing&nbsp;and&nbsp;one&nbsp;for&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5732860">//&nbsp;This&nbsp;separation&nbsp;makes&nbsp;the&nbsp;API&nbsp;cleaner&nbsp;since&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5732919">//&nbsp;expose&nbsp;reflection&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5732956">parseFuncs</span>&nbsp;<span class="ident" id="5732967">FuncMap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5732976">execFuncs</span>&nbsp;&nbsp;<span class="keyword" id="5732987">map</span><span class="op" id="5732990">[</span><span class="builtintype" id="5732991">string</span><span class="op" id="5732997">]</span><span class="ident" id="5732998">reflect</span><span class="op" id="5733005">.</span><span class="ident" id="5733006">Value</span><br>
<span class="lineno"></span><span class="op" id="5733012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5733015">//&nbsp;Template&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;parsed&nbsp;template.&nbsp;The&nbsp;*parse.Tree</span><br>
<span class="lineno"></span><span class="comment" id="5733087">//&nbsp;field&nbsp;is&nbsp;exported&nbsp;only&nbsp;for&nbsp;use&nbsp;by&nbsp;html/template&nbsp;and&nbsp;should&nbsp;be&nbsp;treated</span><br>
<span class="lineno">25</span><span class="comment" id="5733160">//&nbsp;as&nbsp;unexported&nbsp;by&nbsp;all&nbsp;other&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="5733199">type</span>&nbsp;<span class="ident" id="5733204">Template</span>&nbsp;<span class="keyword" id="5733213">struct</span>&nbsp;<span class="op" id="5733220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733223">name</span>&nbsp;<span class="builtintype" id="5733228">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5733236">*</span><span class="ident" id="5733237">parse</span><span class="op" id="5733242">.</span><span class="ident" id="5733243">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5733249">*</span><span class="ident" id="5733250">common</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733258">leftDelim</span>&nbsp;&nbsp;<span class="builtintype" id="5733269">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733277">rightDelim</span>&nbsp;<span class="builtintype" id="5733288">string</span><br>
<span class="lineno"></span><span class="op" id="5733295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5733298">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno">35</span><span class="keyword" id="5733351">func</span>&nbsp;<span class="ident" id="5733356">New</span><span class="op" id="5733359">(</span><span class="ident" id="5733360">name</span>&nbsp;<span class="builtintype" id="5733365">string</span><span class="op" id="5733371">)</span>&nbsp;<span class="op" id="5733373">*</span><span class="ident" id="5733374">Template</span>&nbsp;<span class="op" id="5733383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5733386">return</span>&nbsp;<span class="op" id="5733393">&amp;</span><span class="ident" id="5733394">Template</span><span class="op" id="5733402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733406">name</span><span class="op" id="5733410">:</span>&nbsp;<span class="ident" id="5733412">name</span><span class="op" id="5733416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5733419">}</span><br>
<span class="lineno"></span><span class="op" id="5733421">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="5733424">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="5733466">func</span>&nbsp;<span class="op" id="5733471">(</span><span class="ident" id="5733472">t</span>&nbsp;<span class="op" id="5733474">*</span><span class="ident" id="5733475">Template</span><span class="op" id="5733483">)</span>&nbsp;<span class="ident" id="5733485">Name</span><span class="op" id="5733489">(</span><span class="op" id="5733490">)</span>&nbsp;<span class="builtintype" id="5733492">string</span>&nbsp;<span class="op" id="5733499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5733502">return</span>&nbsp;<span class="ident" id="5733509">t</span><span class="op" id="5733510">.</span><span class="ident" id="5733511">name</span><br>
<span class="lineno"></span><span class="op" id="5733516">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5733519">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;one&nbsp;and&nbsp;with&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="5733599">//&nbsp;delimiters.&nbsp;The&nbsp;association,&nbsp;which&nbsp;is&nbsp;transitive,&nbsp;allows&nbsp;one&nbsp;template&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5733675">//&nbsp;invoke&nbsp;another&nbsp;with&nbsp;a&nbsp;{{template}}&nbsp;action.</span><br>
<span class="lineno"></span><span class="keyword" id="5733721">func</span>&nbsp;<span class="op" id="5733726">(</span><span class="ident" id="5733727">t</span>&nbsp;<span class="op" id="5733729">*</span><span class="ident" id="5733730">Template</span><span class="op" id="5733738">)</span>&nbsp;<span class="ident" id="5733740">New</span><span class="op" id="5733743">(</span><span class="ident" id="5733744">name</span>&nbsp;<span class="builtintype" id="5733749">string</span><span class="op" id="5733755">)</span>&nbsp;<span class="op" id="5733757">*</span><span class="ident" id="5733758">Template</span>&nbsp;<span class="op" id="5733767">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733770">t</span><span class="op" id="5733771">.</span><span class="ident" id="5733772">init</span><span class="op" id="5733776">(</span><span class="op" id="5733777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5733780">return</span>&nbsp;<span class="op" id="5733787">&amp;</span><span class="ident" id="5733788">Template</span><span class="op" id="5733796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733800">name</span><span class="op" id="5733804">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733812">name</span><span class="op" id="5733816">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733820">common</span><span class="op" id="5733826">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733832">t</span><span class="op" id="5733833">.</span><span class="ident" id="5733834">common</span><span class="op" id="5733840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733844">leftDelim</span><span class="op" id="5733853">:</span>&nbsp;&nbsp;<span class="ident" id="5733856">t</span><span class="op" id="5733857">.</span><span class="ident" id="5733858">leftDelim</span><span class="op" id="5733867">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733871">rightDelim</span><span class="op" id="5733881">:</span>&nbsp;<span class="ident" id="5733883">t</span><span class="op" id="5733884">.</span><span class="ident" id="5733885">rightDelim</span><span class="op" id="5733895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5733898">}</span><br>
<span class="lineno"></span><span class="op" id="5733900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5733903">func</span>&nbsp;<span class="op" id="5733908">(</span><span class="ident" id="5733909">t</span>&nbsp;<span class="op" id="5733911">*</span><span class="ident" id="5733912">Template</span><span class="op" id="5733920">)</span>&nbsp;<span class="ident" id="5733922">init</span><span class="op" id="5733926">(</span><span class="op" id="5733927">)</span>&nbsp;<span class="op" id="5733929">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5733932">if</span>&nbsp;<span class="ident" id="5733935">t</span><span class="op" id="5733936">.</span><span class="ident" id="5733937">common</span>&nbsp;<span class="op" id="5733944">==</span>&nbsp;<span class="ident" id="5733947">nil</span>&nbsp;<span class="op" id="5733951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733955">t</span><span class="op" id="5733956">.</span><span class="ident" id="5733957">common</span>&nbsp;<span class="op" id="5733964">=</span>&nbsp;<span class="builtinfunc" id="5733966">new</span><span class="op" id="5733969">(</span><span class="ident" id="5733970">common</span><span class="op" id="5733976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5733980">t</span><span class="op" id="5733981">.</span><span class="ident" id="5733982">tmpl</span>&nbsp;<span class="op" id="5733987">=</span>&nbsp;<span class="builtinfunc" id="5733989">make</span><span class="op" id="5733993">(</span><span class="keyword" id="5733994">map</span><span class="op" id="5733997">[</span><span class="builtintype" id="5733998">string</span><span class="op" id="5734004">]</span><span class="op" id="5734005">*</span><span class="ident" id="5734006">Template</span><span class="op" id="5734014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5734018">t</span><span class="op" id="5734019">.</span><span class="ident" id="5734020">parseFuncs</span>&nbsp;<span class="op" id="5734031">=</span>&nbsp;<span class="builtinfunc" id="5734033">make</span><span class="op" id="5734037">(</span><span class="ident" id="5734038">FuncMap</span><span class="op" id="5734045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5734049">t</span><span class="op" id="5734050">.</span><span class="ident" id="5734051">execFuncs</span>&nbsp;<span class="op" id="5734061">=</span>&nbsp;<span class="builtinfunc" id="5734063">make</span><span class="op" id="5734067">(</span><span class="keyword" id="5734068">map</span><span class="op" id="5734071">[</span><span class="builtintype" id="5734072">string</span><span class="op" id="5734078">]</span><span class="ident" id="5734079">reflect</span><span class="op" id="5734086">.</span><span class="ident" id="5734087">Value</span><span class="op" id="5734092">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5734095">}</span><br>
<span class="lineno"></span><span class="op" id="5734097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5734100">//&nbsp;Clone&nbsp;returns&nbsp;a&nbsp;duplicate&nbsp;of&nbsp;the&nbsp;template,&nbsp;including&nbsp;all&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="5734171">//&nbsp;templates.&nbsp;The&nbsp;actual&nbsp;representation&nbsp;is&nbsp;not&nbsp;copied,&nbsp;but&nbsp;the&nbsp;name&nbsp;space&nbsp;of</span><br>
<span class="lineno">70</span><span class="comment" id="5734248">//&nbsp;associated&nbsp;templates&nbsp;is,&nbsp;so&nbsp;further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add</span><br>
<span class="lineno"></span><span class="comment" id="5734323">//&nbsp;templates&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&nbsp;Clone&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;prepare</span><br>
<span class="lineno"></span><span class="comment" id="5734402">//&nbsp;common&nbsp;templates&nbsp;and&nbsp;use&nbsp;them&nbsp;with&nbsp;variant&nbsp;definitions&nbsp;for&nbsp;other&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="5734480">//&nbsp;by&nbsp;adding&nbsp;the&nbsp;variants&nbsp;after&nbsp;the&nbsp;clone&nbsp;is&nbsp;made.</span><br>
<span class="lineno"></span><span class="keyword" id="5734531">func</span>&nbsp;<span class="op" id="5734536">(</span><span class="ident" id="5734537">t</span>&nbsp;<span class="op" id="5734539">*</span><span class="ident" id="5734540">Template</span><span class="op" id="5734548">)</span>&nbsp;<span class="ident" id="5734550">Clone</span><span class="op" id="5734555">(</span><span class="op" id="5734556">)</span>&nbsp;<span class="op" id="5734558">(</span><span class="op" id="5734559">*</span><span class="ident" id="5734560">Template</span><span class="op" id="5734568">,</span>&nbsp;<span class="builtintype" id="5734570">error</span><span class="op" id="5734575">)</span>&nbsp;<span class="op" id="5734577">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5734580">nt</span>&nbsp;<span class="op" id="5734583">:=</span>&nbsp;<span class="ident" id="5734586">t</span><span class="op" id="5734587">.</span><span class="builtinfunc" id="5734588">copy</span><span class="op" id="5734592">(</span><span class="ident" id="5734593">nil</span><span class="op" id="5734596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5734599">nt</span><span class="op" id="5734601">.</span><span class="ident" id="5734602">init</span><span class="op" id="5734606">(</span><span class="op" id="5734607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5734610">nt</span><span class="op" id="5734612">.</span><span class="ident" id="5734613">tmpl</span><span class="op" id="5734617">[</span><span class="ident" id="5734618">t</span><span class="op" id="5734619">.</span><span class="ident" id="5734620">name</span><span class="op" id="5734624">]</span>&nbsp;<span class="op" id="5734626">=</span>&nbsp;<span class="ident" id="5734628">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5734632">for</span>&nbsp;<span class="ident" id="5734636">k</span><span class="op" id="5734637">,</span>&nbsp;<span class="ident" id="5734639">v</span>&nbsp;<span class="op" id="5734641">:=</span>&nbsp;<span class="keyword" id="5734644">range</span>&nbsp;<span class="ident" id="5734650">t</span><span class="op" id="5734651">.</span><span class="ident" id="5734652">tmpl</span>&nbsp;<span class="op" id="5734657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5734661">if</span>&nbsp;<span class="ident" id="5734664">k</span>&nbsp;<span class="op" id="5734666">==</span>&nbsp;<span class="ident" id="5734669">t</span><span class="op" id="5734670">.</span><span class="ident" id="5734671">name</span>&nbsp;<span class="op" id="5734676">{</span>&nbsp;<span class="comment" id="5734678">//&nbsp;Already&nbsp;installed.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5734703">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5734714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5734718">//&nbsp;The&nbsp;associated&nbsp;templates&nbsp;share&nbsp;nt&#39;s&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5734777">tmpl</span>&nbsp;<span class="op" id="5734782">:=</span>&nbsp;<span class="ident" id="5734785">v</span><span class="op" id="5734786">.</span><span class="builtinfunc" id="5734787">copy</span><span class="op" id="5734791">(</span><span class="ident" id="5734792">nt</span><span class="op" id="5734794">.</span><span class="ident" id="5734795">common</span><span class="op" id="5734801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5734805">nt</span><span class="op" id="5734807">.</span><span class="ident" id="5734808">tmpl</span><span class="op" id="5734812">[</span><span class="ident" id="5734813">k</span><span class="op" id="5734814">]</span>&nbsp;<span class="op" id="5734816">=</span>&nbsp;<span class="ident" id="5734818">tmpl</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5734824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5734827">for</span>&nbsp;<span class="ident" id="5734831">k</span><span class="op" id="5734832">,</span>&nbsp;<span class="ident" id="5734834">v</span>&nbsp;<span class="op" id="5734836">:=</span>&nbsp;<span class="keyword" id="5734839">range</span>&nbsp;<span class="ident" id="5734845">t</span><span class="op" id="5734846">.</span><span class="ident" id="5734847">parseFuncs</span>&nbsp;<span class="op" id="5734858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5734862">nt</span><span class="op" id="5734864">.</span><span class="ident" id="5734865">parseFuncs</span><span class="op" id="5734875">[</span><span class="ident" id="5734876">k</span><span class="op" id="5734877">]</span>&nbsp;<span class="op" id="5734879">=</span>&nbsp;<span class="ident" id="5734881">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5734884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5734887">for</span>&nbsp;<span class="ident" id="5734891">k</span><span class="op" id="5734892">,</span>&nbsp;<span class="ident" id="5734894">v</span>&nbsp;<span class="op" id="5734896">:=</span>&nbsp;<span class="keyword" id="5734899">range</span>&nbsp;<span class="ident" id="5734905">t</span><span class="op" id="5734906">.</span><span class="ident" id="5734907">execFuncs</span>&nbsp;<span class="op" id="5734917">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5734921">nt</span><span class="op" id="5734923">.</span><span class="ident" id="5734924">execFuncs</span><span class="op" id="5734933">[</span><span class="ident" id="5734934">k</span><span class="op" id="5734935">]</span>&nbsp;<span class="op" id="5734937">=</span>&nbsp;<span class="ident" id="5734939">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5734942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5734945">return</span>&nbsp;<span class="ident" id="5734952">nt</span><span class="op" id="5734954">,</span>&nbsp;<span class="ident" id="5734956">nil</span><br>
<span class="lineno"></span><span class="op" id="5734960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="5734963">//&nbsp;copy&nbsp;returns&nbsp;a&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;t,&nbsp;with&nbsp;common&nbsp;set&nbsp;to&nbsp;the&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="5735033">func</span>&nbsp;<span class="op" id="5735038">(</span><span class="ident" id="5735039">t</span>&nbsp;<span class="op" id="5735041">*</span><span class="ident" id="5735042">Template</span><span class="op" id="5735050">)</span>&nbsp;<span class="builtinfunc" id="5735052">copy</span><span class="op" id="5735056">(</span><span class="ident" id="5735057">c</span>&nbsp;<span class="op" id="5735059">*</span><span class="ident" id="5735060">common</span><span class="op" id="5735066">)</span>&nbsp;<span class="op" id="5735068">*</span><span class="ident" id="5735069">Template</span>&nbsp;<span class="op" id="5735078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735081">nt</span>&nbsp;<span class="op" id="5735084">:=</span>&nbsp;<span class="ident" id="5735087">New</span><span class="op" id="5735090">(</span><span class="ident" id="5735091">t</span><span class="op" id="5735092">.</span><span class="ident" id="5735093">name</span><span class="op" id="5735097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735100">nt</span><span class="op" id="5735102">.</span><span class="ident" id="5735103">Tree</span>&nbsp;<span class="op" id="5735108">=</span>&nbsp;<span class="ident" id="5735110">t</span><span class="op" id="5735111">.</span><span class="ident" id="5735112">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735118">nt</span><span class="op" id="5735120">.</span><span class="ident" id="5735121">common</span>&nbsp;<span class="op" id="5735128">=</span>&nbsp;<span class="ident" id="5735130">c</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735133">nt</span><span class="op" id="5735135">.</span><span class="ident" id="5735136">leftDelim</span>&nbsp;<span class="op" id="5735146">=</span>&nbsp;<span class="ident" id="5735148">t</span><span class="op" id="5735149">.</span><span class="ident" id="5735150">leftDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735161">nt</span><span class="op" id="5735163">.</span><span class="ident" id="5735164">rightDelim</span>&nbsp;<span class="op" id="5735175">=</span>&nbsp;<span class="ident" id="5735177">t</span><span class="op" id="5735178">.</span><span class="ident" id="5735179">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5735191">return</span>&nbsp;<span class="ident" id="5735198">nt</span><br>
<span class="lineno"></span><span class="op" id="5735201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5735204">//&nbsp;AddParseTree&nbsp;creates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;name&nbsp;and&nbsp;parse&nbsp;tree</span><br>
<span class="lineno"></span><span class="comment" id="5735272">//&nbsp;and&nbsp;associates&nbsp;it&nbsp;with&nbsp;t.</span><br>
<span class="lineno"></span><span class="keyword" id="5735301">func</span>&nbsp;<span class="op" id="5735306">(</span><span class="ident" id="5735307">t</span>&nbsp;<span class="op" id="5735309">*</span><span class="ident" id="5735310">Template</span><span class="op" id="5735318">)</span>&nbsp;<span class="ident" id="5735320">AddParseTree</span><span class="op" id="5735332">(</span><span class="ident" id="5735333">name</span>&nbsp;<span class="builtintype" id="5735338">string</span><span class="op" id="5735344">,</span>&nbsp;<span class="ident" id="5735346">tree</span>&nbsp;<span class="op" id="5735351">*</span><span class="ident" id="5735352">parse</span><span class="op" id="5735357">.</span><span class="ident" id="5735358">Tree</span><span class="op" id="5735362">)</span>&nbsp;<span class="op" id="5735364">(</span><span class="op" id="5735365">*</span><span class="ident" id="5735366">Template</span><span class="op" id="5735374">,</span>&nbsp;<span class="builtintype" id="5735376">error</span><span class="op" id="5735381">)</span>&nbsp;<span class="op" id="5735383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5735386">if</span>&nbsp;<span class="ident" id="5735389">t</span><span class="op" id="5735390">.</span><span class="ident" id="5735391">common</span>&nbsp;<span class="op" id="5735398">!=</span>&nbsp;<span class="ident" id="5735401">nil</span>&nbsp;<span class="op" id="5735405">&amp;&amp;</span>&nbsp;<span class="ident" id="5735408">t</span><span class="op" id="5735409">.</span><span class="ident" id="5735410">tmpl</span><span class="op" id="5735414">[</span><span class="ident" id="5735415">name</span><span class="op" id="5735419">]</span>&nbsp;<span class="op" id="5735421">!=</span>&nbsp;<span class="ident" id="5735424">nil</span>&nbsp;<span class="op" id="5735428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5735432">return</span>&nbsp;<span class="ident" id="5735439">nil</span><span class="op" id="5735442">,</span>&nbsp;<span class="ident" id="5735444">fmt</span><span class="op" id="5735447">.</span><span class="ident" id="5735448">Errorf</span><span class="op" id="5735454">(</span><span class="string" id="5735455">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="5735494">,</span>&nbsp;<span class="ident" id="5735496">name</span><span class="op" id="5735500">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5735503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735506">nt</span>&nbsp;<span class="op" id="5735509">:=</span>&nbsp;<span class="ident" id="5735512">t</span><span class="op" id="5735513">.</span><span class="ident" id="5735514">New</span><span class="op" id="5735517">(</span><span class="ident" id="5735518">name</span><span class="op" id="5735522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735525">nt</span><span class="op" id="5735527">.</span><span class="ident" id="5735528">Tree</span>&nbsp;<span class="op" id="5735533">=</span>&nbsp;<span class="ident" id="5735535">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735541">t</span><span class="op" id="5735542">.</span><span class="ident" id="5735543">tmpl</span><span class="op" id="5735547">[</span><span class="ident" id="5735548">name</span><span class="op" id="5735552">]</span>&nbsp;<span class="op" id="5735554">=</span>&nbsp;<span class="ident" id="5735556">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5735560">return</span>&nbsp;<span class="ident" id="5735567">nt</span><span class="op" id="5735569">,</span>&nbsp;<span class="ident" id="5735571">nil</span><br>
<span class="lineno">115</span><span class="op" id="5735575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5735578">//&nbsp;Templates&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;templates&nbsp;associated&nbsp;with&nbsp;t,&nbsp;including&nbsp;t</span><br>
<span class="lineno"></span><span class="comment" id="5735655">//&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="5735666">func</span>&nbsp;<span class="op" id="5735671">(</span><span class="ident" id="5735672">t</span>&nbsp;<span class="op" id="5735674">*</span><span class="ident" id="5735675">Template</span><span class="op" id="5735683">)</span>&nbsp;<span class="ident" id="5735685">Templates</span><span class="op" id="5735694">(</span><span class="op" id="5735695">)</span>&nbsp;<span class="op" id="5735697">[</span><span class="op" id="5735698">]</span><span class="op" id="5735699">*</span><span class="ident" id="5735700">Template</span>&nbsp;<span class="op" id="5735709">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5735712">if</span>&nbsp;<span class="ident" id="5735715">t</span><span class="op" id="5735716">.</span><span class="ident" id="5735717">common</span>&nbsp;<span class="op" id="5735724">==</span>&nbsp;<span class="ident" id="5735727">nil</span>&nbsp;<span class="op" id="5735731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5735735">return</span>&nbsp;<span class="ident" id="5735742">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5735747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5735750">//&nbsp;Return&nbsp;a&nbsp;slice&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;expose&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735797">m</span>&nbsp;<span class="op" id="5735799">:=</span>&nbsp;<span class="builtinfunc" id="5735802">make</span><span class="op" id="5735806">(</span><span class="op" id="5735807">[</span><span class="op" id="5735808">]</span><span class="op" id="5735809">*</span><span class="ident" id="5735810">Template</span><span class="op" id="5735818">,</span>&nbsp;<span class="num" id="5735820">0</span><span class="op" id="5735821">,</span>&nbsp;<span class="builtinfunc" id="5735823">len</span><span class="op" id="5735826">(</span><span class="ident" id="5735827">t</span><span class="op" id="5735828">.</span><span class="ident" id="5735829">tmpl</span><span class="op" id="5735833">)</span><span class="op" id="5735834">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5735837">for</span>&nbsp;<span class="ident" id="5735841">_</span><span class="op" id="5735842">,</span>&nbsp;<span class="ident" id="5735844">v</span>&nbsp;<span class="op" id="5735846">:=</span>&nbsp;<span class="keyword" id="5735849">range</span>&nbsp;<span class="ident" id="5735855">t</span><span class="op" id="5735856">.</span><span class="ident" id="5735857">tmpl</span>&nbsp;<span class="op" id="5735862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5735866">m</span>&nbsp;<span class="op" id="5735868">=</span>&nbsp;<span class="builtinfunc" id="5735870">append</span><span class="op" id="5735876">(</span><span class="ident" id="5735877">m</span><span class="op" id="5735878">,</span>&nbsp;<span class="ident" id="5735880">v</span><span class="op" id="5735881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5735884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5735887">return</span>&nbsp;<span class="ident" id="5735894">m</span><br>
<span class="lineno"></span><span class="op" id="5735896">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="5735899">//&nbsp;Delims&nbsp;sets&nbsp;the&nbsp;action&nbsp;delimiters&nbsp;to&nbsp;the&nbsp;specified&nbsp;strings,&nbsp;to&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5735976">//&nbsp;subsequent&nbsp;calls&nbsp;to&nbsp;Parse,&nbsp;ParseFiles,&nbsp;or&nbsp;ParseGlob.&nbsp;Nested&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="5736048">//&nbsp;definitions&nbsp;will&nbsp;inherit&nbsp;the&nbsp;settings.&nbsp;An&nbsp;empty&nbsp;delimiter&nbsp;stands&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5736124">//&nbsp;corresponding&nbsp;default:&nbsp;{{&nbsp;or&nbsp;}}.</span><br>
<span class="lineno">135</span><span class="comment" id="5736160">//&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="5736222">func</span>&nbsp;<span class="op" id="5736227">(</span><span class="ident" id="5736228">t</span>&nbsp;<span class="op" id="5736230">*</span><span class="ident" id="5736231">Template</span><span class="op" id="5736239">)</span>&nbsp;<span class="ident" id="5736241">Delims</span><span class="op" id="5736247">(</span><span class="ident" id="5736248">left</span><span class="op" id="5736252">,</span>&nbsp;<span class="ident" id="5736254">right</span>&nbsp;<span class="builtintype" id="5736260">string</span><span class="op" id="5736266">)</span>&nbsp;<span class="op" id="5736268">*</span><span class="ident" id="5736269">Template</span>&nbsp;<span class="op" id="5736278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5736281">t</span><span class="op" id="5736282">.</span><span class="ident" id="5736283">leftDelim</span>&nbsp;<span class="op" id="5736293">=</span>&nbsp;<span class="ident" id="5736295">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5736301">t</span><span class="op" id="5736302">.</span><span class="ident" id="5736303">rightDelim</span>&nbsp;<span class="op" id="5736314">=</span>&nbsp;<span class="ident" id="5736316">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5736323">return</span>&nbsp;<span class="ident" id="5736330">t</span><br>
<span class="lineno">140</span><span class="op" id="5736332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5736335">//&nbsp;Funcs&nbsp;adds&nbsp;the&nbsp;elements&nbsp;of&nbsp;the&nbsp;argument&nbsp;map&nbsp;to&nbsp;the&nbsp;template&#39;s&nbsp;function&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="5736414">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;a&nbsp;value&nbsp;in&nbsp;the&nbsp;map&nbsp;is&nbsp;not&nbsp;a&nbsp;function&nbsp;with&nbsp;appropriate&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5736491">//&nbsp;type.&nbsp;However,&nbsp;it&nbsp;is&nbsp;legal&nbsp;to&nbsp;overwrite&nbsp;elements&nbsp;of&nbsp;the&nbsp;map.&nbsp;The&nbsp;return</span><br>
<span class="lineno">145</span><span class="comment" id="5736566">//&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="5736617">func</span>&nbsp;<span class="op" id="5736622">(</span><span class="ident" id="5736623">t</span>&nbsp;<span class="op" id="5736625">*</span><span class="ident" id="5736626">Template</span><span class="op" id="5736634">)</span>&nbsp;<span class="ident" id="5736636">Funcs</span><span class="op" id="5736641">(</span><span class="ident" id="5736642">funcMap</span>&nbsp;<span class="ident" id="5736650">FuncMap</span><span class="op" id="5736657">)</span>&nbsp;<span class="op" id="5736659">*</span><span class="ident" id="5736660">Template</span>&nbsp;<span class="op" id="5736669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5736672">t</span><span class="op" id="5736673">.</span><span class="ident" id="5736674">init</span><span class="op" id="5736678">(</span><span class="op" id="5736679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5736682">addValueFuncs</span><span class="op" id="5736695">(</span><span class="ident" id="5736696">t</span><span class="op" id="5736697">.</span><span class="ident" id="5736698">execFuncs</span><span class="op" id="5736707">,</span>&nbsp;<span class="ident" id="5736709">funcMap</span><span class="op" id="5736716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5736719">addFuncs</span><span class="op" id="5736727">(</span><span class="ident" id="5736728">t</span><span class="op" id="5736729">.</span><span class="ident" id="5736730">parseFuncs</span><span class="op" id="5736740">,</span>&nbsp;<span class="ident" id="5736742">funcMap</span><span class="op" id="5736749">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5736752">return</span>&nbsp;<span class="ident" id="5736759">t</span><br>
<span class="lineno"></span><span class="op" id="5736761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5736764">//&nbsp;Lookup&nbsp;returns&nbsp;the&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name&nbsp;that&nbsp;is&nbsp;associated&nbsp;with&nbsp;t,</span><br>
<span class="lineno"></span><span class="comment" id="5736842">//&nbsp;or&nbsp;nil&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;such&nbsp;template.</span><br>
<span class="lineno">155</span><span class="keyword" id="5736882">func</span>&nbsp;<span class="op" id="5736887">(</span><span class="ident" id="5736888">t</span>&nbsp;<span class="op" id="5736890">*</span><span class="ident" id="5736891">Template</span><span class="op" id="5736899">)</span>&nbsp;<span class="ident" id="5736901">Lookup</span><span class="op" id="5736907">(</span><span class="ident" id="5736908">name</span>&nbsp;<span class="builtintype" id="5736913">string</span><span class="op" id="5736919">)</span>&nbsp;<span class="op" id="5736921">*</span><span class="ident" id="5736922">Template</span>&nbsp;<span class="op" id="5736931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5736934">if</span>&nbsp;<span class="ident" id="5736937">t</span><span class="op" id="5736938">.</span><span class="ident" id="5736939">common</span>&nbsp;<span class="op" id="5736946">==</span>&nbsp;<span class="ident" id="5736949">nil</span>&nbsp;<span class="op" id="5736953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5736957">return</span>&nbsp;<span class="ident" id="5736964">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5736969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5736972">return</span>&nbsp;<span class="ident" id="5736979">t</span><span class="op" id="5736980">.</span><span class="ident" id="5736981">tmpl</span><span class="op" id="5736985">[</span><span class="ident" id="5736986">name</span><span class="op" id="5736990">]</span><br>
<span class="lineno">160</span><span class="op" id="5736992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5736995">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;string&nbsp;into&nbsp;a&nbsp;template.&nbsp;Nested&nbsp;template&nbsp;definitions&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5737073">//&nbsp;associated&nbsp;with&nbsp;the&nbsp;top-level&nbsp;template&nbsp;t.&nbsp;Parse&nbsp;may&nbsp;be&nbsp;called&nbsp;multiple&nbsp;times</span><br>
<span class="lineno"></span><span class="comment" id="5737153">//&nbsp;to&nbsp;parse&nbsp;definitions&nbsp;of&nbsp;templates&nbsp;to&nbsp;associate&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;if&nbsp;a</span><br>
<span class="lineno">165</span><span class="comment" id="5737231">//&nbsp;resulting&nbsp;template&nbsp;is&nbsp;non-empty&nbsp;(contains&nbsp;content&nbsp;other&nbsp;than&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="5737304">//&nbsp;definitions)&nbsp;and&nbsp;would&nbsp;replace&nbsp;a&nbsp;non-empty&nbsp;template&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="5737379">//&nbsp;(In&nbsp;multiple&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;with&nbsp;the&nbsp;same&nbsp;receiver&nbsp;template,&nbsp;only&nbsp;one&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="5737457">//&nbsp;can&nbsp;contain&nbsp;text&nbsp;other&nbsp;than&nbsp;space,&nbsp;comments,&nbsp;and&nbsp;template&nbsp;definitions.)</span><br>
<span class="lineno"></span><span class="keyword" id="5737532">func</span>&nbsp;<span class="op" id="5737537">(</span><span class="ident" id="5737538">t</span>&nbsp;<span class="op" id="5737540">*</span><span class="ident" id="5737541">Template</span><span class="op" id="5737549">)</span>&nbsp;<span class="ident" id="5737551">Parse</span><span class="op" id="5737556">(</span><span class="ident" id="5737557">text</span>&nbsp;<span class="builtintype" id="5737562">string</span><span class="op" id="5737568">)</span>&nbsp;<span class="op" id="5737570">(</span><span class="op" id="5737571">*</span><span class="ident" id="5737572">Template</span><span class="op" id="5737580">,</span>&nbsp;<span class="builtintype" id="5737582">error</span><span class="op" id="5737587">)</span>&nbsp;<span class="op" id="5737589">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5737592">t</span><span class="op" id="5737593">.</span><span class="ident" id="5737594">init</span><span class="op" id="5737598">(</span><span class="op" id="5737599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5737602">trees</span><span class="op" id="5737607">,</span>&nbsp;<span class="ident" id="5737609">err</span>&nbsp;<span class="op" id="5737613">:=</span>&nbsp;<span class="ident" id="5737616">parse</span><span class="op" id="5737621">.</span><span class="ident" id="5737622">Parse</span><span class="op" id="5737627">(</span><span class="ident" id="5737628">t</span><span class="op" id="5737629">.</span><span class="ident" id="5737630">name</span><span class="op" id="5737634">,</span>&nbsp;<span class="ident" id="5737636">text</span><span class="op" id="5737640">,</span>&nbsp;<span class="ident" id="5737642">t</span><span class="op" id="5737643">.</span><span class="ident" id="5737644">leftDelim</span><span class="op" id="5737653">,</span>&nbsp;<span class="ident" id="5737655">t</span><span class="op" id="5737656">.</span><span class="ident" id="5737657">rightDelim</span><span class="op" id="5737667">,</span>&nbsp;<span class="ident" id="5737669">t</span><span class="op" id="5737670">.</span><span class="ident" id="5737671">parseFuncs</span><span class="op" id="5737681">,</span>&nbsp;<span class="ident" id="5737683">builtins</span><span class="op" id="5737691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5737694">if</span>&nbsp;<span class="ident" id="5737697">err</span>&nbsp;<span class="op" id="5737701">!=</span>&nbsp;<span class="ident" id="5737704">nil</span>&nbsp;<span class="op" id="5737708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5737712">return</span>&nbsp;<span class="ident" id="5737719">nil</span><span class="op" id="5737722">,</span>&nbsp;<span class="ident" id="5737724">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5737729">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5737732">//&nbsp;Add&nbsp;the&nbsp;newly&nbsp;parsed&nbsp;trees,&nbsp;including&nbsp;the&nbsp;one&nbsp;for&nbsp;t,&nbsp;into&nbsp;our&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5737816">for</span>&nbsp;<span class="ident" id="5737820">name</span><span class="op" id="5737824">,</span>&nbsp;<span class="ident" id="5737826">tree</span>&nbsp;<span class="op" id="5737831">:=</span>&nbsp;<span class="keyword" id="5737834">range</span>&nbsp;<span class="ident" id="5737840">trees</span>&nbsp;<span class="op" id="5737846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5737850">//&nbsp;If&nbsp;the&nbsp;name&nbsp;we&nbsp;parsed&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;this&nbsp;template,&nbsp;overwrite&nbsp;this&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5737932">//&nbsp;The&nbsp;associate&nbsp;method&nbsp;checks&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;redefinition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5737990">tmpl</span>&nbsp;<span class="op" id="5737995">:=</span>&nbsp;<span class="ident" id="5737998">t</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5738002">if</span>&nbsp;<span class="ident" id="5738005">name</span>&nbsp;<span class="op" id="5738010">!=</span>&nbsp;<span class="ident" id="5738013">t</span><span class="op" id="5738014">.</span><span class="ident" id="5738015">name</span>&nbsp;<span class="op" id="5738020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5738025">tmpl</span>&nbsp;<span class="op" id="5738030">=</span>&nbsp;<span class="ident" id="5738032">t</span><span class="op" id="5738033">.</span><span class="ident" id="5738034">New</span><span class="op" id="5738037">(</span><span class="ident" id="5738038">name</span><span class="op" id="5738042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5738046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5738050">//&nbsp;Even&nbsp;if&nbsp;t&nbsp;==&nbsp;tmpl,&nbsp;we&nbsp;need&nbsp;to&nbsp;install&nbsp;it&nbsp;in&nbsp;the&nbsp;common.tmpl&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5738120">if</span>&nbsp;<span class="ident" id="5738123">replace</span><span class="op" id="5738130">,</span>&nbsp;<span class="ident" id="5738132">err</span>&nbsp;<span class="op" id="5738136">:=</span>&nbsp;<span class="ident" id="5738139">t</span><span class="op" id="5738140">.</span><span class="ident" id="5738141">associate</span><span class="op" id="5738150">(</span><span class="ident" id="5738151">tmpl</span><span class="op" id="5738155">,</span>&nbsp;<span class="ident" id="5738157">tree</span><span class="op" id="5738161">)</span><span class="op" id="5738162">;</span>&nbsp;<span class="ident" id="5738164">err</span>&nbsp;<span class="op" id="5738168">!=</span>&nbsp;<span class="ident" id="5738171">nil</span>&nbsp;<span class="op" id="5738175">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5738180">return</span>&nbsp;<span class="ident" id="5738187">nil</span><span class="op" id="5738190">,</span>&nbsp;<span class="ident" id="5738192">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5738198">}</span>&nbsp;<span class="keyword" id="5738200">else</span>&nbsp;<span class="keyword" id="5738205">if</span>&nbsp;<span class="ident" id="5738208">replace</span>&nbsp;<span class="op" id="5738216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5738221">tmpl</span><span class="op" id="5738225">.</span><span class="ident" id="5738226">Tree</span>&nbsp;<span class="op" id="5738231">=</span>&nbsp;<span class="ident" id="5738233">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5738240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5738244">tmpl</span><span class="op" id="5738248">.</span><span class="ident" id="5738249">leftDelim</span>&nbsp;<span class="op" id="5738259">=</span>&nbsp;<span class="ident" id="5738261">t</span><span class="op" id="5738262">.</span><span class="ident" id="5738263">leftDelim</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5738275">tmpl</span><span class="op" id="5738279">.</span><span class="ident" id="5738280">rightDelim</span>&nbsp;<span class="op" id="5738291">=</span>&nbsp;<span class="ident" id="5738293">t</span><span class="op" id="5738294">.</span><span class="ident" id="5738295">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5738307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5738310">return</span>&nbsp;<span class="ident" id="5738317">t</span><span class="op" id="5738318">,</span>&nbsp;<span class="ident" id="5738320">nil</span><br>
<span class="lineno"></span><span class="op" id="5738324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="5738327">//&nbsp;associate&nbsp;installs&nbsp;the&nbsp;new&nbsp;template&nbsp;into&nbsp;the&nbsp;group&nbsp;of&nbsp;templates&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="5738405">//&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;reuse&nbsp;a&nbsp;name&nbsp;except&nbsp;to&nbsp;overwrite&nbsp;an&nbsp;empty</span><br>
<span class="lineno"></span><span class="comment" id="5738476">//&nbsp;template.&nbsp;The&nbsp;two&nbsp;are&nbsp;already&nbsp;known&nbsp;to&nbsp;share&nbsp;the&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="5738546">//&nbsp;The&nbsp;boolean&nbsp;return&nbsp;value&nbsp;reports&nbsp;wither&nbsp;to&nbsp;store&nbsp;this&nbsp;tree&nbsp;as&nbsp;t.Tree.</span><br>
<span class="lineno"></span><span class="keyword" id="5738619">func</span>&nbsp;<span class="op" id="5738624">(</span><span class="ident" id="5738625">t</span>&nbsp;<span class="op" id="5738627">*</span><span class="ident" id="5738628">Template</span><span class="op" id="5738636">)</span>&nbsp;<span class="ident" id="5738638">associate</span><span class="op" id="5738647">(</span><span class="builtinfunc" id="5738648">new</span>&nbsp;<span class="op" id="5738652">*</span><span class="ident" id="5738653">Template</span><span class="op" id="5738661">,</span>&nbsp;<span class="ident" id="5738663">tree</span>&nbsp;<span class="op" id="5738668">*</span><span class="ident" id="5738669">parse</span><span class="op" id="5738674">.</span><span class="ident" id="5738675">Tree</span><span class="op" id="5738679">)</span>&nbsp;<span class="op" id="5738681">(</span><span class="builtintype" id="5738682">bool</span><span class="op" id="5738686">,</span>&nbsp;<span class="builtintype" id="5738688">error</span><span class="op" id="5738693">)</span>&nbsp;<span class="op" id="5738695">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5738698">if</span>&nbsp;<span class="builtinfunc" id="5738701">new</span><span class="op" id="5738704">.</span><span class="ident" id="5738705">common</span>&nbsp;<span class="op" id="5738712">!=</span>&nbsp;<span class="ident" id="5738715">t</span><span class="op" id="5738716">.</span><span class="ident" id="5738717">common</span>&nbsp;<span class="op" id="5738724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5738728">panic</span><span class="op" id="5738733">(</span><span class="string" id="5738734">&#34;internal&nbsp;error:&nbsp;associate&nbsp;not&nbsp;common&#34;</span><span class="op" id="5738772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5738775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5738778">name</span>&nbsp;<span class="op" id="5738783">:=</span>&nbsp;<span class="builtinfunc" id="5738786">new</span><span class="op" id="5738789">.</span><span class="ident" id="5738790">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5738796">if</span>&nbsp;<span class="ident" id="5738799">old</span>&nbsp;<span class="op" id="5738803">:=</span>&nbsp;<span class="ident" id="5738806">t</span><span class="op" id="5738807">.</span><span class="ident" id="5738808">tmpl</span><span class="op" id="5738812">[</span><span class="ident" id="5738813">name</span><span class="op" id="5738817">]</span><span class="op" id="5738818">;</span>&nbsp;<span class="ident" id="5738820">old</span>&nbsp;<span class="op" id="5738824">!=</span>&nbsp;<span class="ident" id="5738827">nil</span>&nbsp;<span class="op" id="5738831">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5738835">oldIsEmpty</span>&nbsp;<span class="op" id="5738846">:=</span>&nbsp;<span class="ident" id="5738849">parse</span><span class="op" id="5738854">.</span><span class="ident" id="5738855">IsEmptyTree</span><span class="op" id="5738866">(</span><span class="ident" id="5738867">old</span><span class="op" id="5738870">.</span><span class="ident" id="5738871">Root</span><span class="op" id="5738875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5738879">newIsEmpty</span>&nbsp;<span class="op" id="5738890">:=</span>&nbsp;<span class="ident" id="5738893">parse</span><span class="op" id="5738898">.</span><span class="ident" id="5738899">IsEmptyTree</span><span class="op" id="5738910">(</span><span class="ident" id="5738911">tree</span><span class="op" id="5738915">.</span><span class="ident" id="5738916">Root</span><span class="op" id="5738920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5738924">if</span>&nbsp;<span class="ident" id="5738927">newIsEmpty</span>&nbsp;<span class="op" id="5738938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5738943">//&nbsp;Whether&nbsp;old&nbsp;is&nbsp;empty&nbsp;or&nbsp;not,&nbsp;new&nbsp;is&nbsp;empty;&nbsp;no&nbsp;reason&nbsp;to&nbsp;replace&nbsp;old.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5739018">return</span>&nbsp;<span class="builtintype" id="5739025">false</span><span class="op" id="5739030">,</span>&nbsp;<span class="ident" id="5739032">nil</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5739038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5739042">if</span>&nbsp;<span class="op" id="5739045">!</span><span class="ident" id="5739046">oldIsEmpty</span>&nbsp;<span class="op" id="5739057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5739062">return</span>&nbsp;<span class="builtintype" id="5739069">false</span><span class="op" id="5739074">,</span>&nbsp;<span class="ident" id="5739076">fmt</span><span class="op" id="5739079">.</span><span class="ident" id="5739080">Errorf</span><span class="op" id="5739086">(</span><span class="string" id="5739087">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="5739126">,</span>&nbsp;<span class="ident" id="5739128">name</span><span class="op" id="5739132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5739136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5739139">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5739142">t</span><span class="op" id="5739143">.</span><span class="ident" id="5739144">tmpl</span><span class="op" id="5739148">[</span><span class="ident" id="5739149">name</span><span class="op" id="5739153">]</span>&nbsp;<span class="op" id="5739155">=</span>&nbsp;<span class="builtinfunc" id="5739157">new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5739162">return</span>&nbsp;<span class="builtintype" id="5739169">true</span><span class="op" id="5739173">,</span>&nbsp;<span class="ident" id="5739175">nil</span><br>
<span class="lineno"></span><span class="op" id="5739179">}</span>
</div>
</body>
</html>
