<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>unicode/utf8</h2>
<ul>
<li><a href="/gostd/unicode/utf8/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/unicode/utf8/utf8.go.html">utf8.go</a></li>
<li><a href="/gostd/unicode/utf8/utf8_test.go.html">utf8_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1760821">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1760876">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1760930">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1760981">//&nbsp;Package&nbsp;utf8&nbsp;implements&nbsp;functions&nbsp;and&nbsp;constants&nbsp;to&nbsp;support&nbsp;text&nbsp;encoded&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1761059">//&nbsp;UTF-8.&nbsp;It&nbsp;includes&nbsp;functions&nbsp;to&nbsp;translate&nbsp;between&nbsp;runes&nbsp;and&nbsp;UTF-8&nbsp;byte&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="keyword" id="1761144">package</span>&nbsp;<span class="ident" id="1761152">utf8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1761158">//&nbsp;The&nbsp;conditions&nbsp;RuneError==unicode.ReplacementChar&nbsp;and</span><br>
<span class="lineno">10</span><span class="comment" id="1761215">//&nbsp;MaxRune==unicode.MaxRune&nbsp;are&nbsp;verified&nbsp;in&nbsp;the&nbsp;tests.</span><br>
<span class="lineno"></span><span class="comment" id="1761270">//&nbsp;Defining&nbsp;them&nbsp;locally&nbsp;avoids&nbsp;this&nbsp;package&nbsp;depending&nbsp;on&nbsp;package&nbsp;unicode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1761346">//&nbsp;Numbers&nbsp;fundamental&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="1761386">const</span>&nbsp;<span class="op" id="1761392">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761395">RuneError</span>&nbsp;<span class="op" id="1761405">=</span>&nbsp;<span class="string" id="1761407">&#39;\uFFFD&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1761420">//&nbsp;the&nbsp;&#34;error&#34;&nbsp;Rune&nbsp;or&nbsp;&#34;Unicode&nbsp;replacement&nbsp;character&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761476">RuneSelf</span>&nbsp;&nbsp;<span class="op" id="1761486">=</span>&nbsp;<span class="num" id="1761488">0x80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1761501">//&nbsp;characters&nbsp;below&nbsp;Runeself&nbsp;are&nbsp;represented&nbsp;as&nbsp;themselves&nbsp;in&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761579">MaxRune</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1761589">=</span>&nbsp;<span class="string" id="1761591">&#39;\U0010FFFF&#39;</span>&nbsp;<span class="comment" id="1761604">//&nbsp;Maximum&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761642">UTFMax</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1761652">=</span>&nbsp;<span class="num" id="1761654">4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1761667">//&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;a&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character.</span><br>
<span class="lineno"></span><span class="op" id="1761732">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="1761735">//&nbsp;Code&nbsp;points&nbsp;in&nbsp;the&nbsp;surrogate&nbsp;range&nbsp;are&nbsp;not&nbsp;valid&nbsp;for&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="1761798">const</span>&nbsp;<span class="op" id="1761804">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761807">surrogateMin</span>&nbsp;<span class="op" id="1761820">=</span>&nbsp;<span class="num" id="1761822">0xD800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761830">surrogateMax</span>&nbsp;<span class="op" id="1761843">=</span>&nbsp;<span class="num" id="1761845">0xDFFF</span><br>
<span class="lineno">25</span><span class="op" id="1761852">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1761855">const</span>&nbsp;<span class="op" id="1761861">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761864">t1</span>&nbsp;<span class="op" id="1761867">=</span>&nbsp;<span class="num" id="1761869">0x00</span>&nbsp;<span class="comment" id="1761874">//&nbsp;0000&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761888">tx</span>&nbsp;<span class="op" id="1761891">=</span>&nbsp;<span class="num" id="1761893">0x80</span>&nbsp;<span class="comment" id="1761898">//&nbsp;1000&nbsp;0000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761912">t2</span>&nbsp;<span class="op" id="1761915">=</span>&nbsp;<span class="num" id="1761917">0xC0</span>&nbsp;<span class="comment" id="1761922">//&nbsp;1100&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761936">t3</span>&nbsp;<span class="op" id="1761939">=</span>&nbsp;<span class="num" id="1761941">0xE0</span>&nbsp;<span class="comment" id="1761946">//&nbsp;1110&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761960">t4</span>&nbsp;<span class="op" id="1761963">=</span>&nbsp;<span class="num" id="1761965">0xF0</span>&nbsp;<span class="comment" id="1761970">//&nbsp;1111&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761984">t5</span>&nbsp;<span class="op" id="1761987">=</span>&nbsp;<span class="num" id="1761989">0xF8</span>&nbsp;<span class="comment" id="1761994">//&nbsp;1111&nbsp;1000</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762009">maskx</span>&nbsp;<span class="op" id="1762015">=</span>&nbsp;<span class="num" id="1762017">0x3F</span>&nbsp;<span class="comment" id="1762022">//&nbsp;0011&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762036">mask2</span>&nbsp;<span class="op" id="1762042">=</span>&nbsp;<span class="num" id="1762044">0x1F</span>&nbsp;<span class="comment" id="1762049">//&nbsp;0001&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762063">mask3</span>&nbsp;<span class="op" id="1762069">=</span>&nbsp;<span class="num" id="1762071">0x0F</span>&nbsp;<span class="comment" id="1762076">//&nbsp;0000&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762090">mask4</span>&nbsp;<span class="op" id="1762096">=</span>&nbsp;<span class="num" id="1762098">0x07</span>&nbsp;<span class="comment" id="1762103">//&nbsp;0000&nbsp;0111</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762118">rune1Max</span>&nbsp;<span class="op" id="1762127">=</span>&nbsp;<span class="num" id="1762129">1</span><span class="op" id="1762130">&lt;&lt;</span><span class="num" id="1762132">7</span>&nbsp;<span class="op" id="1762134">-</span>&nbsp;<span class="num" id="1762136">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762139">rune2Max</span>&nbsp;<span class="op" id="1762148">=</span>&nbsp;<span class="num" id="1762150">1</span><span class="op" id="1762151">&lt;&lt;</span><span class="num" id="1762153">11</span>&nbsp;<span class="op" id="1762156">-</span>&nbsp;<span class="num" id="1762158">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762161">rune3Max</span>&nbsp;<span class="op" id="1762170">=</span>&nbsp;<span class="num" id="1762172">1</span><span class="op" id="1762173">&lt;&lt;</span><span class="num" id="1762175">16</span>&nbsp;<span class="op" id="1762178">-</span>&nbsp;<span class="num" id="1762180">1</span><br>
<span class="lineno"></span><span class="op" id="1762182">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="1762185">func</span>&nbsp;<span class="ident" id="1762190">decodeRuneInternal</span><span class="op" id="1762208">(</span><span class="ident" id="1762209">p</span>&nbsp;<span class="op" id="1762211">[</span><span class="op" id="1762212">]</span><span class="builtintype" id="1762213">byte</span><span class="op" id="1762217">)</span>&nbsp;<span class="op" id="1762219">(</span><span class="ident" id="1762220">r</span>&nbsp;<span class="builtintype" id="1762222">rune</span><span class="op" id="1762226">,</span>&nbsp;<span class="ident" id="1762228">size</span>&nbsp;<span class="builtintype" id="1762233">int</span><span class="op" id="1762236">,</span>&nbsp;<span class="ident" id="1762238">short</span>&nbsp;<span class="builtintype" id="1762244">bool</span><span class="op" id="1762248">)</span>&nbsp;<span class="op" id="1762250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762253">n</span>&nbsp;<span class="op" id="1762255">:=</span>&nbsp;<span class="builtinfunc" id="1762258">len</span><span class="op" id="1762261">(</span><span class="ident" id="1762262">p</span><span class="op" id="1762263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762266">if</span>&nbsp;<span class="ident" id="1762269">n</span>&nbsp;<span class="op" id="1762271">&lt;</span>&nbsp;<span class="num" id="1762273">1</span>&nbsp;<span class="op" id="1762275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762279">return</span>&nbsp;<span class="ident" id="1762286">RuneError</span><span class="op" id="1762295">,</span>&nbsp;<span class="num" id="1762297">0</span><span class="op" id="1762298">,</span>&nbsp;<span class="builtintype" id="1762300">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762306">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762309">c0</span>&nbsp;<span class="op" id="1762312">:=</span>&nbsp;<span class="ident" id="1762315">p</span><span class="op" id="1762316">[</span><span class="num" id="1762317">0</span><span class="op" id="1762318">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762322">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762350">if</span>&nbsp;<span class="ident" id="1762353">c0</span>&nbsp;<span class="op" id="1762356">&lt;</span>&nbsp;<span class="ident" id="1762358">tx</span>&nbsp;<span class="op" id="1762361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762365">return</span>&nbsp;<span class="builtintype" id="1762372">rune</span><span class="op" id="1762376">(</span><span class="ident" id="1762377">c0</span><span class="op" id="1762379">)</span><span class="op" id="1762380">,</span>&nbsp;<span class="num" id="1762382">1</span><span class="op" id="1762383">,</span>&nbsp;<span class="builtintype" id="1762385">false</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762396">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762430">if</span>&nbsp;<span class="ident" id="1762433">c0</span>&nbsp;<span class="op" id="1762436">&lt;</span>&nbsp;<span class="ident" id="1762438">t2</span>&nbsp;<span class="op" id="1762441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762445">return</span>&nbsp;<span class="ident" id="1762452">RuneError</span><span class="op" id="1762461">,</span>&nbsp;<span class="num" id="1762463">1</span><span class="op" id="1762464">,</span>&nbsp;<span class="builtintype" id="1762466">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762477">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762510">if</span>&nbsp;<span class="ident" id="1762513">n</span>&nbsp;<span class="op" id="1762515">&lt;</span>&nbsp;<span class="num" id="1762517">2</span>&nbsp;<span class="op" id="1762519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762523">return</span>&nbsp;<span class="ident" id="1762530">RuneError</span><span class="op" id="1762539">,</span>&nbsp;<span class="num" id="1762541">1</span><span class="op" id="1762542">,</span>&nbsp;<span class="builtintype" id="1762544">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762553">c1</span>&nbsp;<span class="op" id="1762556">:=</span>&nbsp;<span class="ident" id="1762559">p</span><span class="op" id="1762560">[</span><span class="num" id="1762561">1</span><span class="op" id="1762562">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762565">if</span>&nbsp;<span class="ident" id="1762568">c1</span>&nbsp;<span class="op" id="1762571">&lt;</span>&nbsp;<span class="ident" id="1762573">tx</span>&nbsp;<span class="op" id="1762576">||</span>&nbsp;<span class="ident" id="1762579">t2</span>&nbsp;<span class="op" id="1762582">&lt;=</span>&nbsp;<span class="ident" id="1762585">c1</span>&nbsp;<span class="op" id="1762588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762592">return</span>&nbsp;<span class="ident" id="1762599">RuneError</span><span class="op" id="1762608">,</span>&nbsp;<span class="num" id="1762610">1</span><span class="op" id="1762611">,</span>&nbsp;<span class="builtintype" id="1762613">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762620">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762624">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762653">if</span>&nbsp;<span class="ident" id="1762656">c0</span>&nbsp;<span class="op" id="1762659">&lt;</span>&nbsp;<span class="ident" id="1762661">t3</span>&nbsp;<span class="op" id="1762664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762668">r</span>&nbsp;<span class="op" id="1762670">=</span>&nbsp;<span class="builtintype" id="1762672">rune</span><span class="op" id="1762676">(</span><span class="ident" id="1762677">c0</span><span class="op" id="1762679">&amp;</span><span class="ident" id="1762680">mask2</span><span class="op" id="1762685">)</span><span class="op" id="1762686">&lt;&lt;</span><span class="num" id="1762688">6</span>&nbsp;<span class="op" id="1762690">|</span>&nbsp;<span class="builtintype" id="1762692">rune</span><span class="op" id="1762696">(</span><span class="ident" id="1762697">c1</span><span class="op" id="1762699">&amp;</span><span class="ident" id="1762700">maskx</span><span class="op" id="1762705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762709">if</span>&nbsp;<span class="ident" id="1762712">r</span>&nbsp;<span class="op" id="1762714">&lt;=</span>&nbsp;<span class="ident" id="1762717">rune1Max</span>&nbsp;<span class="op" id="1762726">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762731">return</span>&nbsp;<span class="ident" id="1762738">RuneError</span><span class="op" id="1762747">,</span>&nbsp;<span class="num" id="1762749">1</span><span class="op" id="1762750">,</span>&nbsp;<span class="builtintype" id="1762752">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762764">return</span>&nbsp;<span class="ident" id="1762771">r</span><span class="op" id="1762772">,</span>&nbsp;<span class="num" id="1762774">2</span><span class="op" id="1762775">,</span>&nbsp;<span class="builtintype" id="1762777">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762788">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762822">if</span>&nbsp;<span class="ident" id="1762825">n</span>&nbsp;<span class="op" id="1762827">&lt;</span>&nbsp;<span class="num" id="1762829">3</span>&nbsp;<span class="op" id="1762831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762835">return</span>&nbsp;<span class="ident" id="1762842">RuneError</span><span class="op" id="1762851">,</span>&nbsp;<span class="num" id="1762853">1</span><span class="op" id="1762854">,</span>&nbsp;<span class="builtintype" id="1762856">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762865">c2</span>&nbsp;<span class="op" id="1762868">:=</span>&nbsp;<span class="ident" id="1762871">p</span><span class="op" id="1762872">[</span><span class="num" id="1762873">2</span><span class="op" id="1762874">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762877">if</span>&nbsp;<span class="ident" id="1762880">c2</span>&nbsp;<span class="op" id="1762883">&lt;</span>&nbsp;<span class="ident" id="1762885">tx</span>&nbsp;<span class="op" id="1762888">||</span>&nbsp;<span class="ident" id="1762891">t2</span>&nbsp;<span class="op" id="1762894">&lt;=</span>&nbsp;<span class="ident" id="1762897">c2</span>&nbsp;<span class="op" id="1762900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762904">return</span>&nbsp;<span class="ident" id="1762911">RuneError</span><span class="op" id="1762920">,</span>&nbsp;<span class="num" id="1762922">1</span><span class="op" id="1762923">,</span>&nbsp;<span class="builtintype" id="1762925">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762936">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762965">if</span>&nbsp;<span class="ident" id="1762968">c0</span>&nbsp;<span class="op" id="1762971">&lt;</span>&nbsp;<span class="ident" id="1762973">t4</span>&nbsp;<span class="op" id="1762976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762980">r</span>&nbsp;<span class="op" id="1762982">=</span>&nbsp;<span class="builtintype" id="1762984">rune</span><span class="op" id="1762988">(</span><span class="ident" id="1762989">c0</span><span class="op" id="1762991">&amp;</span><span class="ident" id="1762992">mask3</span><span class="op" id="1762997">)</span><span class="op" id="1762998">&lt;&lt;</span><span class="num" id="1763000">12</span>&nbsp;<span class="op" id="1763003">|</span>&nbsp;<span class="builtintype" id="1763005">rune</span><span class="op" id="1763009">(</span><span class="ident" id="1763010">c1</span><span class="op" id="1763012">&amp;</span><span class="ident" id="1763013">maskx</span><span class="op" id="1763018">)</span><span class="op" id="1763019">&lt;&lt;</span><span class="num" id="1763021">6</span>&nbsp;<span class="op" id="1763023">|</span>&nbsp;<span class="builtintype" id="1763025">rune</span><span class="op" id="1763029">(</span><span class="ident" id="1763030">c2</span><span class="op" id="1763032">&amp;</span><span class="ident" id="1763033">maskx</span><span class="op" id="1763038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763042">if</span>&nbsp;<span class="ident" id="1763045">r</span>&nbsp;<span class="op" id="1763047">&lt;=</span>&nbsp;<span class="ident" id="1763050">rune2Max</span>&nbsp;<span class="op" id="1763059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763064">return</span>&nbsp;<span class="ident" id="1763071">RuneError</span><span class="op" id="1763080">,</span>&nbsp;<span class="num" id="1763082">1</span><span class="op" id="1763083">,</span>&nbsp;<span class="builtintype" id="1763085">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763093">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763097">if</span>&nbsp;<span class="ident" id="1763100">surrogateMin</span>&nbsp;<span class="op" id="1763113">&lt;=</span>&nbsp;<span class="ident" id="1763116">r</span>&nbsp;<span class="op" id="1763118">&amp;&amp;</span>&nbsp;<span class="ident" id="1763121">r</span>&nbsp;<span class="op" id="1763123">&lt;=</span>&nbsp;<span class="ident" id="1763126">surrogateMax</span>&nbsp;<span class="op" id="1763139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763144">return</span>&nbsp;<span class="ident" id="1763151">RuneError</span><span class="op" id="1763160">,</span>&nbsp;<span class="num" id="1763162">1</span><span class="op" id="1763163">,</span>&nbsp;<span class="builtintype" id="1763165">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763177">return</span>&nbsp;<span class="ident" id="1763184">r</span><span class="op" id="1763185">,</span>&nbsp;<span class="num" id="1763187">3</span><span class="op" id="1763188">,</span>&nbsp;<span class="builtintype" id="1763190">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763197">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763201">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763234">if</span>&nbsp;<span class="ident" id="1763237">n</span>&nbsp;<span class="op" id="1763239">&lt;</span>&nbsp;<span class="num" id="1763241">4</span>&nbsp;<span class="op" id="1763243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763247">return</span>&nbsp;<span class="ident" id="1763254">RuneError</span><span class="op" id="1763263">,</span>&nbsp;<span class="num" id="1763265">1</span><span class="op" id="1763266">,</span>&nbsp;<span class="builtintype" id="1763268">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763274">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1763277">c3</span>&nbsp;<span class="op" id="1763280">:=</span>&nbsp;<span class="ident" id="1763283">p</span><span class="op" id="1763284">[</span><span class="num" id="1763285">3</span><span class="op" id="1763286">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763289">if</span>&nbsp;<span class="ident" id="1763292">c3</span>&nbsp;<span class="op" id="1763295">&lt;</span>&nbsp;<span class="ident" id="1763297">tx</span>&nbsp;<span class="op" id="1763300">||</span>&nbsp;<span class="ident" id="1763303">t2</span>&nbsp;<span class="op" id="1763306">&lt;=</span>&nbsp;<span class="ident" id="1763309">c3</span>&nbsp;<span class="op" id="1763312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763316">return</span>&nbsp;<span class="ident" id="1763323">RuneError</span><span class="op" id="1763332">,</span>&nbsp;<span class="num" id="1763334">1</span><span class="op" id="1763335">,</span>&nbsp;<span class="builtintype" id="1763337">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763348">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763377">if</span>&nbsp;<span class="ident" id="1763380">c0</span>&nbsp;<span class="op" id="1763383">&lt;</span>&nbsp;<span class="ident" id="1763385">t5</span>&nbsp;<span class="op" id="1763388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1763392">r</span>&nbsp;<span class="op" id="1763394">=</span>&nbsp;<span class="builtintype" id="1763396">rune</span><span class="op" id="1763400">(</span><span class="ident" id="1763401">c0</span><span class="op" id="1763403">&amp;</span><span class="ident" id="1763404">mask4</span><span class="op" id="1763409">)</span><span class="op" id="1763410">&lt;&lt;</span><span class="num" id="1763412">18</span>&nbsp;<span class="op" id="1763415">|</span>&nbsp;<span class="builtintype" id="1763417">rune</span><span class="op" id="1763421">(</span><span class="ident" id="1763422">c1</span><span class="op" id="1763424">&amp;</span><span class="ident" id="1763425">maskx</span><span class="op" id="1763430">)</span><span class="op" id="1763431">&lt;&lt;</span><span class="num" id="1763433">12</span>&nbsp;<span class="op" id="1763436">|</span>&nbsp;<span class="builtintype" id="1763438">rune</span><span class="op" id="1763442">(</span><span class="ident" id="1763443">c2</span><span class="op" id="1763445">&amp;</span><span class="ident" id="1763446">maskx</span><span class="op" id="1763451">)</span><span class="op" id="1763452">&lt;&lt;</span><span class="num" id="1763454">6</span>&nbsp;<span class="op" id="1763456">|</span>&nbsp;<span class="builtintype" id="1763458">rune</span><span class="op" id="1763462">(</span><span class="ident" id="1763463">c3</span><span class="op" id="1763465">&amp;</span><span class="ident" id="1763466">maskx</span><span class="op" id="1763471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763475">if</span>&nbsp;<span class="ident" id="1763478">r</span>&nbsp;<span class="op" id="1763480">&lt;=</span>&nbsp;<span class="ident" id="1763483">rune3Max</span>&nbsp;<span class="op" id="1763492">||</span>&nbsp;<span class="ident" id="1763495">MaxRune</span>&nbsp;<span class="op" id="1763503">&lt;</span>&nbsp;<span class="ident" id="1763505">r</span>&nbsp;<span class="op" id="1763507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763512">return</span>&nbsp;<span class="ident" id="1763519">RuneError</span><span class="op" id="1763528">,</span>&nbsp;<span class="num" id="1763530">1</span><span class="op" id="1763531">,</span>&nbsp;<span class="builtintype" id="1763533">false</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763545">return</span>&nbsp;<span class="ident" id="1763552">r</span><span class="op" id="1763553">,</span>&nbsp;<span class="num" id="1763555">4</span><span class="op" id="1763556">,</span>&nbsp;<span class="builtintype" id="1763558">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763569">//&nbsp;error</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763579">return</span>&nbsp;<span class="ident" id="1763586">RuneError</span><span class="op" id="1763595">,</span>&nbsp;<span class="num" id="1763597">1</span><span class="op" id="1763598">,</span>&nbsp;<span class="builtintype" id="1763600">false</span><br>
<span class="lineno"></span><span class="op" id="1763606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1763609">func</span>&nbsp;<span class="ident" id="1763614">decodeRuneInStringInternal</span><span class="op" id="1763640">(</span><span class="ident" id="1763641">s</span>&nbsp;<span class="builtintype" id="1763643">string</span><span class="op" id="1763649">)</span>&nbsp;<span class="op" id="1763651">(</span><span class="ident" id="1763652">r</span>&nbsp;<span class="builtintype" id="1763654">rune</span><span class="op" id="1763658">,</span>&nbsp;<span class="ident" id="1763660">size</span>&nbsp;<span class="builtintype" id="1763665">int</span><span class="op" id="1763668">,</span>&nbsp;<span class="ident" id="1763670">short</span>&nbsp;<span class="builtintype" id="1763676">bool</span><span class="op" id="1763680">)</span>&nbsp;<span class="op" id="1763682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1763685">n</span>&nbsp;<span class="op" id="1763687">:=</span>&nbsp;<span class="builtinfunc" id="1763690">len</span><span class="op" id="1763693">(</span><span class="ident" id="1763694">s</span><span class="op" id="1763695">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763698">if</span>&nbsp;<span class="ident" id="1763701">n</span>&nbsp;<span class="op" id="1763703">&lt;</span>&nbsp;<span class="num" id="1763705">1</span>&nbsp;<span class="op" id="1763707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763711">return</span>&nbsp;<span class="ident" id="1763718">RuneError</span><span class="op" id="1763727">,</span>&nbsp;<span class="num" id="1763729">0</span><span class="op" id="1763730">,</span>&nbsp;<span class="builtintype" id="1763732">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1763741">c0</span>&nbsp;<span class="op" id="1763744">:=</span>&nbsp;<span class="ident" id="1763747">s</span><span class="op" id="1763748">[</span><span class="num" id="1763749">0</span><span class="op" id="1763750">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763754">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763782">if</span>&nbsp;<span class="ident" id="1763785">c0</span>&nbsp;<span class="op" id="1763788">&lt;</span>&nbsp;<span class="ident" id="1763790">tx</span>&nbsp;<span class="op" id="1763793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763797">return</span>&nbsp;<span class="builtintype" id="1763804">rune</span><span class="op" id="1763808">(</span><span class="ident" id="1763809">c0</span><span class="op" id="1763811">)</span><span class="op" id="1763812">,</span>&nbsp;<span class="num" id="1763814">1</span><span class="op" id="1763815">,</span>&nbsp;<span class="builtintype" id="1763817">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763828">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763862">if</span>&nbsp;<span class="ident" id="1763865">c0</span>&nbsp;<span class="op" id="1763868">&lt;</span>&nbsp;<span class="ident" id="1763870">t2</span>&nbsp;<span class="op" id="1763873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763877">return</span>&nbsp;<span class="ident" id="1763884">RuneError</span><span class="op" id="1763893">,</span>&nbsp;<span class="num" id="1763895">1</span><span class="op" id="1763896">,</span>&nbsp;<span class="builtintype" id="1763898">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763909">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763942">if</span>&nbsp;<span class="ident" id="1763945">n</span>&nbsp;<span class="op" id="1763947">&lt;</span>&nbsp;<span class="num" id="1763949">2</span>&nbsp;<span class="op" id="1763951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763955">return</span>&nbsp;<span class="ident" id="1763962">RuneError</span><span class="op" id="1763971">,</span>&nbsp;<span class="num" id="1763973">1</span><span class="op" id="1763974">,</span>&nbsp;<span class="builtintype" id="1763976">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1763985">c1</span>&nbsp;<span class="op" id="1763988">:=</span>&nbsp;<span class="ident" id="1763991">s</span><span class="op" id="1763992">[</span><span class="num" id="1763993">1</span><span class="op" id="1763994">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763997">if</span>&nbsp;<span class="ident" id="1764000">c1</span>&nbsp;<span class="op" id="1764003">&lt;</span>&nbsp;<span class="ident" id="1764005">tx</span>&nbsp;<span class="op" id="1764008">||</span>&nbsp;<span class="ident" id="1764011">t2</span>&nbsp;<span class="op" id="1764014">&lt;=</span>&nbsp;<span class="ident" id="1764017">c1</span>&nbsp;<span class="op" id="1764020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764024">return</span>&nbsp;<span class="ident" id="1764031">RuneError</span><span class="op" id="1764040">,</span>&nbsp;<span class="num" id="1764042">1</span><span class="op" id="1764043">,</span>&nbsp;<span class="builtintype" id="1764045">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764056">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764085">if</span>&nbsp;<span class="ident" id="1764088">c0</span>&nbsp;<span class="op" id="1764091">&lt;</span>&nbsp;<span class="ident" id="1764093">t3</span>&nbsp;<span class="op" id="1764096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764100">r</span>&nbsp;<span class="op" id="1764102">=</span>&nbsp;<span class="builtintype" id="1764104">rune</span><span class="op" id="1764108">(</span><span class="ident" id="1764109">c0</span><span class="op" id="1764111">&amp;</span><span class="ident" id="1764112">mask2</span><span class="op" id="1764117">)</span><span class="op" id="1764118">&lt;&lt;</span><span class="num" id="1764120">6</span>&nbsp;<span class="op" id="1764122">|</span>&nbsp;<span class="builtintype" id="1764124">rune</span><span class="op" id="1764128">(</span><span class="ident" id="1764129">c1</span><span class="op" id="1764131">&amp;</span><span class="ident" id="1764132">maskx</span><span class="op" id="1764137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764141">if</span>&nbsp;<span class="ident" id="1764144">r</span>&nbsp;<span class="op" id="1764146">&lt;=</span>&nbsp;<span class="ident" id="1764149">rune1Max</span>&nbsp;<span class="op" id="1764158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764163">return</span>&nbsp;<span class="ident" id="1764170">RuneError</span><span class="op" id="1764179">,</span>&nbsp;<span class="num" id="1764181">1</span><span class="op" id="1764182">,</span>&nbsp;<span class="builtintype" id="1764184">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764192">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764196">return</span>&nbsp;<span class="ident" id="1764203">r</span><span class="op" id="1764204">,</span>&nbsp;<span class="num" id="1764206">2</span><span class="op" id="1764207">,</span>&nbsp;<span class="builtintype" id="1764209">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764220">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764254">if</span>&nbsp;<span class="ident" id="1764257">n</span>&nbsp;<span class="op" id="1764259">&lt;</span>&nbsp;<span class="num" id="1764261">3</span>&nbsp;<span class="op" id="1764263">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764267">return</span>&nbsp;<span class="ident" id="1764274">RuneError</span><span class="op" id="1764283">,</span>&nbsp;<span class="num" id="1764285">1</span><span class="op" id="1764286">,</span>&nbsp;<span class="builtintype" id="1764288">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764297">c2</span>&nbsp;<span class="op" id="1764300">:=</span>&nbsp;<span class="ident" id="1764303">s</span><span class="op" id="1764304">[</span><span class="num" id="1764305">2</span><span class="op" id="1764306">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764309">if</span>&nbsp;<span class="ident" id="1764312">c2</span>&nbsp;<span class="op" id="1764315">&lt;</span>&nbsp;<span class="ident" id="1764317">tx</span>&nbsp;<span class="op" id="1764320">||</span>&nbsp;<span class="ident" id="1764323">t2</span>&nbsp;<span class="op" id="1764326">&lt;=</span>&nbsp;<span class="ident" id="1764329">c2</span>&nbsp;<span class="op" id="1764332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764336">return</span>&nbsp;<span class="ident" id="1764343">RuneError</span><span class="op" id="1764352">,</span>&nbsp;<span class="num" id="1764354">1</span><span class="op" id="1764355">,</span>&nbsp;<span class="builtintype" id="1764357">false</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764368">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764397">if</span>&nbsp;<span class="ident" id="1764400">c0</span>&nbsp;<span class="op" id="1764403">&lt;</span>&nbsp;<span class="ident" id="1764405">t4</span>&nbsp;<span class="op" id="1764408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764412">r</span>&nbsp;<span class="op" id="1764414">=</span>&nbsp;<span class="builtintype" id="1764416">rune</span><span class="op" id="1764420">(</span><span class="ident" id="1764421">c0</span><span class="op" id="1764423">&amp;</span><span class="ident" id="1764424">mask3</span><span class="op" id="1764429">)</span><span class="op" id="1764430">&lt;&lt;</span><span class="num" id="1764432">12</span>&nbsp;<span class="op" id="1764435">|</span>&nbsp;<span class="builtintype" id="1764437">rune</span><span class="op" id="1764441">(</span><span class="ident" id="1764442">c1</span><span class="op" id="1764444">&amp;</span><span class="ident" id="1764445">maskx</span><span class="op" id="1764450">)</span><span class="op" id="1764451">&lt;&lt;</span><span class="num" id="1764453">6</span>&nbsp;<span class="op" id="1764455">|</span>&nbsp;<span class="builtintype" id="1764457">rune</span><span class="op" id="1764461">(</span><span class="ident" id="1764462">c2</span><span class="op" id="1764464">&amp;</span><span class="ident" id="1764465">maskx</span><span class="op" id="1764470">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764474">if</span>&nbsp;<span class="ident" id="1764477">r</span>&nbsp;<span class="op" id="1764479">&lt;=</span>&nbsp;<span class="ident" id="1764482">rune2Max</span>&nbsp;<span class="op" id="1764491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764496">return</span>&nbsp;<span class="ident" id="1764503">RuneError</span><span class="op" id="1764512">,</span>&nbsp;<span class="num" id="1764514">1</span><span class="op" id="1764515">,</span>&nbsp;<span class="builtintype" id="1764517">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764529">if</span>&nbsp;<span class="ident" id="1764532">surrogateMin</span>&nbsp;<span class="op" id="1764545">&lt;=</span>&nbsp;<span class="ident" id="1764548">r</span>&nbsp;<span class="op" id="1764550">&amp;&amp;</span>&nbsp;<span class="ident" id="1764553">r</span>&nbsp;<span class="op" id="1764555">&lt;=</span>&nbsp;<span class="ident" id="1764558">surrogateMax</span>&nbsp;<span class="op" id="1764571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764576">return</span>&nbsp;<span class="ident" id="1764583">RuneError</span><span class="op" id="1764592">,</span>&nbsp;<span class="num" id="1764594">1</span><span class="op" id="1764595">,</span>&nbsp;<span class="builtintype" id="1764597">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764609">return</span>&nbsp;<span class="ident" id="1764616">r</span><span class="op" id="1764617">,</span>&nbsp;<span class="num" id="1764619">3</span><span class="op" id="1764620">,</span>&nbsp;<span class="builtintype" id="1764622">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764633">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764666">if</span>&nbsp;<span class="ident" id="1764669">n</span>&nbsp;<span class="op" id="1764671">&lt;</span>&nbsp;<span class="num" id="1764673">4</span>&nbsp;<span class="op" id="1764675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764679">return</span>&nbsp;<span class="ident" id="1764686">RuneError</span><span class="op" id="1764695">,</span>&nbsp;<span class="num" id="1764697">1</span><span class="op" id="1764698">,</span>&nbsp;<span class="builtintype" id="1764700">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764709">c3</span>&nbsp;<span class="op" id="1764712">:=</span>&nbsp;<span class="ident" id="1764715">s</span><span class="op" id="1764716">[</span><span class="num" id="1764717">3</span><span class="op" id="1764718">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764721">if</span>&nbsp;<span class="ident" id="1764724">c3</span>&nbsp;<span class="op" id="1764727">&lt;</span>&nbsp;<span class="ident" id="1764729">tx</span>&nbsp;<span class="op" id="1764732">||</span>&nbsp;<span class="ident" id="1764735">t2</span>&nbsp;<span class="op" id="1764738">&lt;=</span>&nbsp;<span class="ident" id="1764741">c3</span>&nbsp;<span class="op" id="1764744">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764748">return</span>&nbsp;<span class="ident" id="1764755">RuneError</span><span class="op" id="1764764">,</span>&nbsp;<span class="num" id="1764766">1</span><span class="op" id="1764767">,</span>&nbsp;<span class="builtintype" id="1764769">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764780">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764809">if</span>&nbsp;<span class="ident" id="1764812">c0</span>&nbsp;<span class="op" id="1764815">&lt;</span>&nbsp;<span class="ident" id="1764817">t5</span>&nbsp;<span class="op" id="1764820">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764824">r</span>&nbsp;<span class="op" id="1764826">=</span>&nbsp;<span class="builtintype" id="1764828">rune</span><span class="op" id="1764832">(</span><span class="ident" id="1764833">c0</span><span class="op" id="1764835">&amp;</span><span class="ident" id="1764836">mask4</span><span class="op" id="1764841">)</span><span class="op" id="1764842">&lt;&lt;</span><span class="num" id="1764844">18</span>&nbsp;<span class="op" id="1764847">|</span>&nbsp;<span class="builtintype" id="1764849">rune</span><span class="op" id="1764853">(</span><span class="ident" id="1764854">c1</span><span class="op" id="1764856">&amp;</span><span class="ident" id="1764857">maskx</span><span class="op" id="1764862">)</span><span class="op" id="1764863">&lt;&lt;</span><span class="num" id="1764865">12</span>&nbsp;<span class="op" id="1764868">|</span>&nbsp;<span class="builtintype" id="1764870">rune</span><span class="op" id="1764874">(</span><span class="ident" id="1764875">c2</span><span class="op" id="1764877">&amp;</span><span class="ident" id="1764878">maskx</span><span class="op" id="1764883">)</span><span class="op" id="1764884">&lt;&lt;</span><span class="num" id="1764886">6</span>&nbsp;<span class="op" id="1764888">|</span>&nbsp;<span class="builtintype" id="1764890">rune</span><span class="op" id="1764894">(</span><span class="ident" id="1764895">c3</span><span class="op" id="1764897">&amp;</span><span class="ident" id="1764898">maskx</span><span class="op" id="1764903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764907">if</span>&nbsp;<span class="ident" id="1764910">r</span>&nbsp;<span class="op" id="1764912">&lt;=</span>&nbsp;<span class="ident" id="1764915">rune3Max</span>&nbsp;<span class="op" id="1764924">||</span>&nbsp;<span class="ident" id="1764927">MaxRune</span>&nbsp;<span class="op" id="1764935">&lt;</span>&nbsp;<span class="ident" id="1764937">r</span>&nbsp;<span class="op" id="1764939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764944">return</span>&nbsp;<span class="ident" id="1764951">RuneError</span><span class="op" id="1764960">,</span>&nbsp;<span class="num" id="1764962">1</span><span class="op" id="1764963">,</span>&nbsp;<span class="builtintype" id="1764965">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764977">return</span>&nbsp;<span class="ident" id="1764984">r</span><span class="op" id="1764985">,</span>&nbsp;<span class="num" id="1764987">4</span><span class="op" id="1764988">,</span>&nbsp;<span class="builtintype" id="1764990">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765001">//&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1765011">return</span>&nbsp;<span class="ident" id="1765018">RuneError</span><span class="op" id="1765027">,</span>&nbsp;<span class="num" id="1765029">1</span><span class="op" id="1765030">,</span>&nbsp;<span class="builtintype" id="1765032">false</span><br>
<span class="lineno"></span><span class="op" id="1765038">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="1765041">//&nbsp;FullRune&nbsp;reports&nbsp;whether&nbsp;the&nbsp;bytes&nbsp;in&nbsp;p&nbsp;begin&nbsp;with&nbsp;a&nbsp;full&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;a&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1765128">//&nbsp;An&nbsp;invalid&nbsp;encoding&nbsp;is&nbsp;considered&nbsp;a&nbsp;full&nbsp;Rune&nbsp;since&nbsp;it&nbsp;will&nbsp;convert&nbsp;as&nbsp;a&nbsp;width-1&nbsp;error&nbsp;rune.</span><br>
<span class="lineno"></span><span class="keyword" id="1765224">func</span>&nbsp;<span class="ident" id="1765229">FullRune</span><span class="op" id="1765237">(</span><span class="ident" id="1765238">p</span>&nbsp;<span class="op" id="1765240">[</span><span class="op" id="1765241">]</span><span class="builtintype" id="1765242">byte</span><span class="op" id="1765246">)</span>&nbsp;<span class="builtintype" id="1765248">bool</span>&nbsp;<span class="op" id="1765253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765256">_</span><span class="op" id="1765257">,</span>&nbsp;<span class="ident" id="1765259">_</span><span class="op" id="1765260">,</span>&nbsp;<span class="ident" id="1765262">short</span>&nbsp;<span class="op" id="1765268">:=</span>&nbsp;<span class="ident" id="1765271">decodeRuneInternal</span><span class="op" id="1765289">(</span><span class="ident" id="1765290">p</span><span class="op" id="1765291">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1765294">return</span>&nbsp;<span class="op" id="1765301">!</span><span class="ident" id="1765302">short</span><br>
<span class="lineno"></span><span class="op" id="1765308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1765311">//&nbsp;FullRuneInString&nbsp;is&nbsp;like&nbsp;FullRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1765375">func</span>&nbsp;<span class="ident" id="1765380">FullRuneInString</span><span class="op" id="1765396">(</span><span class="ident" id="1765397">s</span>&nbsp;<span class="builtintype" id="1765399">string</span><span class="op" id="1765405">)</span>&nbsp;<span class="builtintype" id="1765407">bool</span>&nbsp;<span class="op" id="1765412">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765415">_</span><span class="op" id="1765416">,</span>&nbsp;<span class="ident" id="1765418">_</span><span class="op" id="1765419">,</span>&nbsp;<span class="ident" id="1765421">short</span>&nbsp;<span class="op" id="1765427">:=</span>&nbsp;<span class="ident" id="1765430">decodeRuneInStringInternal</span><span class="op" id="1765456">(</span><span class="ident" id="1765457">s</span><span class="op" id="1765458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1765461">return</span>&nbsp;<span class="op" id="1765468">!</span><span class="ident" id="1765469">short</span><br>
<span class="lineno"></span><span class="op" id="1765475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1765478">//&nbsp;DecodeRune&nbsp;unpacks&nbsp;the&nbsp;first&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">215</span><span class="comment" id="1765555">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1765633">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1765708">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1765738">//</span><br>
<span class="lineno"></span><span class="comment" id="1765741">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">220</span><span class="comment" id="1765816">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1765888">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1765932">func</span>&nbsp;<span class="ident" id="1765937">DecodeRune</span><span class="op" id="1765947">(</span><span class="ident" id="1765948">p</span>&nbsp;<span class="op" id="1765950">[</span><span class="op" id="1765951">]</span><span class="builtintype" id="1765952">byte</span><span class="op" id="1765956">)</span>&nbsp;<span class="op" id="1765958">(</span><span class="ident" id="1765959">r</span>&nbsp;<span class="builtintype" id="1765961">rune</span><span class="op" id="1765965">,</span>&nbsp;<span class="ident" id="1765967">size</span>&nbsp;<span class="builtintype" id="1765972">int</span><span class="op" id="1765975">)</span>&nbsp;<span class="op" id="1765977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1765980">r</span><span class="op" id="1765981">,</span>&nbsp;<span class="ident" id="1765983">size</span><span class="op" id="1765987">,</span>&nbsp;<span class="ident" id="1765989">_</span>&nbsp;<span class="op" id="1765991">=</span>&nbsp;<span class="ident" id="1765993">decodeRuneInternal</span><span class="op" id="1766011">(</span><span class="ident" id="1766012">p</span><span class="op" id="1766013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1766016">return</span><br>
<span class="lineno">225</span><span class="op" id="1766023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1766026">//&nbsp;DecodeRuneInString&nbsp;is&nbsp;like&nbsp;DecodeRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If&nbsp;s&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1766102">//&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1766180">//&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno">230</span><span class="comment" id="1766254">//</span><br>
<span class="lineno"></span><span class="comment" id="1766257">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1766332">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1766404">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1766448">func</span>&nbsp;<span class="ident" id="1766453">DecodeRuneInString</span><span class="op" id="1766471">(</span><span class="ident" id="1766472">s</span>&nbsp;<span class="builtintype" id="1766474">string</span><span class="op" id="1766480">)</span>&nbsp;<span class="op" id="1766482">(</span><span class="ident" id="1766483">r</span>&nbsp;<span class="builtintype" id="1766485">rune</span><span class="op" id="1766489">,</span>&nbsp;<span class="ident" id="1766491">size</span>&nbsp;<span class="builtintype" id="1766496">int</span><span class="op" id="1766499">)</span>&nbsp;<span class="op" id="1766501">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1766504">r</span><span class="op" id="1766505">,</span>&nbsp;<span class="ident" id="1766507">size</span><span class="op" id="1766511">,</span>&nbsp;<span class="ident" id="1766513">_</span>&nbsp;<span class="op" id="1766515">=</span>&nbsp;<span class="ident" id="1766517">decodeRuneInStringInternal</span><span class="op" id="1766543">(</span><span class="ident" id="1766544">s</span><span class="op" id="1766545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1766548">return</span><br>
<span class="lineno"></span><span class="op" id="1766555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1766558">//&nbsp;DecodeLastRune&nbsp;unpacks&nbsp;the&nbsp;last&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">240</span><span class="comment" id="1766638">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1766716">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1766791">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1766821">//</span><br>
<span class="lineno"></span><span class="comment" id="1766824">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">245</span><span class="comment" id="1766899">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1766971">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1767015">func</span>&nbsp;<span class="ident" id="1767020">DecodeLastRune</span><span class="op" id="1767034">(</span><span class="ident" id="1767035">p</span>&nbsp;<span class="op" id="1767037">[</span><span class="op" id="1767038">]</span><span class="builtintype" id="1767039">byte</span><span class="op" id="1767043">)</span>&nbsp;<span class="op" id="1767045">(</span><span class="ident" id="1767046">r</span>&nbsp;<span class="builtintype" id="1767048">rune</span><span class="op" id="1767052">,</span>&nbsp;<span class="ident" id="1767054">size</span>&nbsp;<span class="builtintype" id="1767059">int</span><span class="op" id="1767062">)</span>&nbsp;<span class="op" id="1767064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767067">end</span>&nbsp;<span class="op" id="1767071">:=</span>&nbsp;<span class="builtinfunc" id="1767074">len</span><span class="op" id="1767077">(</span><span class="ident" id="1767078">p</span><span class="op" id="1767079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767082">if</span>&nbsp;<span class="ident" id="1767085">end</span>&nbsp;<span class="op" id="1767089">==</span>&nbsp;<span class="num" id="1767092">0</span>&nbsp;<span class="op" id="1767094">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767098">return</span>&nbsp;<span class="ident" id="1767105">RuneError</span><span class="op" id="1767114">,</span>&nbsp;<span class="num" id="1767116">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767122">start</span>&nbsp;<span class="op" id="1767128">:=</span>&nbsp;<span class="ident" id="1767131">end</span>&nbsp;<span class="op" id="1767135">-</span>&nbsp;<span class="num" id="1767137">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767140">r</span>&nbsp;<span class="op" id="1767142">=</span>&nbsp;<span class="builtintype" id="1767144">rune</span><span class="op" id="1767148">(</span><span class="ident" id="1767149">p</span><span class="op" id="1767150">[</span><span class="ident" id="1767151">start</span><span class="op" id="1767156">]</span><span class="op" id="1767157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767160">if</span>&nbsp;<span class="ident" id="1767163">r</span>&nbsp;<span class="op" id="1767165">&lt;</span>&nbsp;<span class="ident" id="1767167">RuneSelf</span>&nbsp;<span class="op" id="1767176">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767180">return</span>&nbsp;<span class="ident" id="1767187">r</span><span class="op" id="1767188">,</span>&nbsp;<span class="num" id="1767190">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767196">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767246">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767299">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767318">lim</span>&nbsp;<span class="op" id="1767322">:=</span>&nbsp;<span class="ident" id="1767325">end</span>&nbsp;<span class="op" id="1767329">-</span>&nbsp;<span class="ident" id="1767331">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767339">if</span>&nbsp;<span class="ident" id="1767342">lim</span>&nbsp;<span class="op" id="1767346">&lt;</span>&nbsp;<span class="num" id="1767348">0</span>&nbsp;<span class="op" id="1767350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767354">lim</span>&nbsp;<span class="op" id="1767358">=</span>&nbsp;<span class="num" id="1767360">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767366">for</span>&nbsp;<span class="ident" id="1767370">start</span><span class="op" id="1767375">--</span><span class="op" id="1767377">;</span>&nbsp;<span class="ident" id="1767379">start</span>&nbsp;<span class="op" id="1767385">&gt;=</span>&nbsp;<span class="ident" id="1767388">lim</span><span class="op" id="1767391">;</span>&nbsp;<span class="ident" id="1767393">start</span><span class="op" id="1767398">--</span>&nbsp;<span class="op" id="1767401">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767405">if</span>&nbsp;<span class="ident" id="1767408">RuneStart</span><span class="op" id="1767417">(</span><span class="ident" id="1767418">p</span><span class="op" id="1767419">[</span><span class="ident" id="1767420">start</span><span class="op" id="1767425">]</span><span class="op" id="1767426">)</span>&nbsp;<span class="op" id="1767428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767433">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767447">if</span>&nbsp;<span class="ident" id="1767450">start</span>&nbsp;<span class="op" id="1767456">&lt;</span>&nbsp;<span class="num" id="1767458">0</span>&nbsp;<span class="op" id="1767460">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767464">start</span>&nbsp;<span class="op" id="1767470">=</span>&nbsp;<span class="num" id="1767472">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767478">r</span><span class="op" id="1767479">,</span>&nbsp;<span class="ident" id="1767481">size</span>&nbsp;<span class="op" id="1767486">=</span>&nbsp;<span class="ident" id="1767488">DecodeRune</span><span class="op" id="1767498">(</span><span class="ident" id="1767499">p</span><span class="op" id="1767500">[</span><span class="ident" id="1767501">start</span><span class="op" id="1767506">:</span><span class="ident" id="1767507">end</span><span class="op" id="1767510">]</span><span class="op" id="1767511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767514">if</span>&nbsp;<span class="ident" id="1767517">start</span><span class="op" id="1767522">+</span><span class="ident" id="1767523">size</span>&nbsp;<span class="op" id="1767528">!=</span>&nbsp;<span class="ident" id="1767531">end</span>&nbsp;<span class="op" id="1767535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767539">return</span>&nbsp;<span class="ident" id="1767546">RuneError</span><span class="op" id="1767555">,</span>&nbsp;<span class="num" id="1767557">1</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767563">return</span>&nbsp;<span class="ident" id="1767570">r</span><span class="op" id="1767571">,</span>&nbsp;<span class="ident" id="1767573">size</span><br>
<span class="lineno"></span><span class="op" id="1767578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1767581">//&nbsp;DecodeLastRuneInString&nbsp;is&nbsp;like&nbsp;DecodeLastRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If</span><br>
<span class="lineno">280</span><span class="comment" id="1767660">//&nbsp;s&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,</span><br>
<span class="lineno"></span><span class="comment" id="1767740">//&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1767817">//</span><br>
<span class="lineno"></span><span class="comment" id="1767820">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1767895">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno">285</span><span class="comment" id="1767967">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1768011">func</span>&nbsp;<span class="ident" id="1768016">DecodeLastRuneInString</span><span class="op" id="1768038">(</span><span class="ident" id="1768039">s</span>&nbsp;<span class="builtintype" id="1768041">string</span><span class="op" id="1768047">)</span>&nbsp;<span class="op" id="1768049">(</span><span class="ident" id="1768050">r</span>&nbsp;<span class="builtintype" id="1768052">rune</span><span class="op" id="1768056">,</span>&nbsp;<span class="ident" id="1768058">size</span>&nbsp;<span class="builtintype" id="1768063">int</span><span class="op" id="1768066">)</span>&nbsp;<span class="op" id="1768068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768071">end</span>&nbsp;<span class="op" id="1768075">:=</span>&nbsp;<span class="builtinfunc" id="1768078">len</span><span class="op" id="1768081">(</span><span class="ident" id="1768082">s</span><span class="op" id="1768083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768086">if</span>&nbsp;<span class="ident" id="1768089">end</span>&nbsp;<span class="op" id="1768093">==</span>&nbsp;<span class="num" id="1768096">0</span>&nbsp;<span class="op" id="1768098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768102">return</span>&nbsp;<span class="ident" id="1768109">RuneError</span><span class="op" id="1768118">,</span>&nbsp;<span class="num" id="1768120">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768126">start</span>&nbsp;<span class="op" id="1768132">:=</span>&nbsp;<span class="ident" id="1768135">end</span>&nbsp;<span class="op" id="1768139">-</span>&nbsp;<span class="num" id="1768141">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768144">r</span>&nbsp;<span class="op" id="1768146">=</span>&nbsp;<span class="builtintype" id="1768148">rune</span><span class="op" id="1768152">(</span><span class="ident" id="1768153">s</span><span class="op" id="1768154">[</span><span class="ident" id="1768155">start</span><span class="op" id="1768160">]</span><span class="op" id="1768161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768164">if</span>&nbsp;<span class="ident" id="1768167">r</span>&nbsp;<span class="op" id="1768169">&lt;</span>&nbsp;<span class="ident" id="1768171">RuneSelf</span>&nbsp;<span class="op" id="1768180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768184">return</span>&nbsp;<span class="ident" id="1768191">r</span><span class="op" id="1768192">,</span>&nbsp;<span class="num" id="1768194">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768200">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768250">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768303">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768322">lim</span>&nbsp;<span class="op" id="1768326">:=</span>&nbsp;<span class="ident" id="1768329">end</span>&nbsp;<span class="op" id="1768333">-</span>&nbsp;<span class="ident" id="1768335">UTFMax</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768343">if</span>&nbsp;<span class="ident" id="1768346">lim</span>&nbsp;<span class="op" id="1768350">&lt;</span>&nbsp;<span class="num" id="1768352">0</span>&nbsp;<span class="op" id="1768354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768358">lim</span>&nbsp;<span class="op" id="1768362">=</span>&nbsp;<span class="num" id="1768364">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768370">for</span>&nbsp;<span class="ident" id="1768374">start</span><span class="op" id="1768379">--</span><span class="op" id="1768381">;</span>&nbsp;<span class="ident" id="1768383">start</span>&nbsp;<span class="op" id="1768389">&gt;=</span>&nbsp;<span class="ident" id="1768392">lim</span><span class="op" id="1768395">;</span>&nbsp;<span class="ident" id="1768397">start</span><span class="op" id="1768402">--</span>&nbsp;<span class="op" id="1768405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768409">if</span>&nbsp;<span class="ident" id="1768412">RuneStart</span><span class="op" id="1768421">(</span><span class="ident" id="1768422">s</span><span class="op" id="1768423">[</span><span class="ident" id="1768424">start</span><span class="op" id="1768429">]</span><span class="op" id="1768430">)</span>&nbsp;<span class="op" id="1768432">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768437">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768451">if</span>&nbsp;<span class="ident" id="1768454">start</span>&nbsp;<span class="op" id="1768460">&lt;</span>&nbsp;<span class="num" id="1768462">0</span>&nbsp;<span class="op" id="1768464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768468">start</span>&nbsp;<span class="op" id="1768474">=</span>&nbsp;<span class="num" id="1768476">0</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768482">r</span><span class="op" id="1768483">,</span>&nbsp;<span class="ident" id="1768485">size</span>&nbsp;<span class="op" id="1768490">=</span>&nbsp;<span class="ident" id="1768492">DecodeRuneInString</span><span class="op" id="1768510">(</span><span class="ident" id="1768511">s</span><span class="op" id="1768512">[</span><span class="ident" id="1768513">start</span><span class="op" id="1768518">:</span><span class="ident" id="1768519">end</span><span class="op" id="1768522">]</span><span class="op" id="1768523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768526">if</span>&nbsp;<span class="ident" id="1768529">start</span><span class="op" id="1768534">+</span><span class="ident" id="1768535">size</span>&nbsp;<span class="op" id="1768540">!=</span>&nbsp;<span class="ident" id="1768543">end</span>&nbsp;<span class="op" id="1768547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768551">return</span>&nbsp;<span class="ident" id="1768558">RuneError</span><span class="op" id="1768567">,</span>&nbsp;<span class="num" id="1768569">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768572">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768575">return</span>&nbsp;<span class="ident" id="1768582">r</span><span class="op" id="1768583">,</span>&nbsp;<span class="ident" id="1768585">size</span><br>
<span class="lineno"></span><span class="op" id="1768590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1768593">//&nbsp;RuneLen&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;required&nbsp;to&nbsp;encode&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1768661">//&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;the&nbsp;rune&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;value&nbsp;to&nbsp;encode&nbsp;in&nbsp;UTF-8.</span><br>
<span class="lineno">320</span><span class="keyword" id="1768731">func</span>&nbsp;<span class="ident" id="1768736">RuneLen</span><span class="op" id="1768743">(</span><span class="ident" id="1768744">r</span>&nbsp;<span class="builtintype" id="1768746">rune</span><span class="op" id="1768750">)</span>&nbsp;<span class="builtintype" id="1768752">int</span>&nbsp;<span class="op" id="1768756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768759">switch</span>&nbsp;<span class="op" id="1768766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768769">case</span>&nbsp;<span class="ident" id="1768774">r</span>&nbsp;<span class="op" id="1768776">&lt;</span>&nbsp;<span class="num" id="1768778">0</span><span class="op" id="1768779">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768783">return</span>&nbsp;<span class="op" id="1768790">-</span><span class="num" id="1768791">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768794">case</span>&nbsp;<span class="ident" id="1768799">r</span>&nbsp;<span class="op" id="1768801">&lt;=</span>&nbsp;<span class="ident" id="1768804">rune1Max</span><span class="op" id="1768812">:</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768816">return</span>&nbsp;<span class="num" id="1768823">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768826">case</span>&nbsp;<span class="ident" id="1768831">r</span>&nbsp;<span class="op" id="1768833">&lt;=</span>&nbsp;<span class="ident" id="1768836">rune2Max</span><span class="op" id="1768844">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768848">return</span>&nbsp;<span class="num" id="1768855">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768858">case</span>&nbsp;<span class="ident" id="1768863">surrogateMin</span>&nbsp;<span class="op" id="1768876">&lt;=</span>&nbsp;<span class="ident" id="1768879">r</span>&nbsp;<span class="op" id="1768881">&amp;&amp;</span>&nbsp;<span class="ident" id="1768884">r</span>&nbsp;<span class="op" id="1768886">&lt;=</span>&nbsp;<span class="ident" id="1768889">surrogateMax</span><span class="op" id="1768901">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768905">return</span>&nbsp;<span class="op" id="1768912">-</span><span class="num" id="1768913">1</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768916">case</span>&nbsp;<span class="ident" id="1768921">r</span>&nbsp;<span class="op" id="1768923">&lt;=</span>&nbsp;<span class="ident" id="1768926">rune3Max</span><span class="op" id="1768934">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768938">return</span>&nbsp;<span class="num" id="1768945">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768948">case</span>&nbsp;<span class="ident" id="1768953">r</span>&nbsp;<span class="op" id="1768955">&lt;=</span>&nbsp;<span class="ident" id="1768958">MaxRune</span><span class="op" id="1768965">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768969">return</span>&nbsp;<span class="num" id="1768976">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768979">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768982">return</span>&nbsp;<span class="op" id="1768989">-</span><span class="num" id="1768990">1</span><br>
<span class="lineno"></span><span class="op" id="1768992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1768995">//&nbsp;EncodeRune&nbsp;writes&nbsp;into&nbsp;p&nbsp;(which&nbsp;must&nbsp;be&nbsp;large&nbsp;enough)&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1769084">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">340</span><span class="keyword" id="1769127">func</span>&nbsp;<span class="ident" id="1769132">EncodeRune</span><span class="op" id="1769142">(</span><span class="ident" id="1769143">p</span>&nbsp;<span class="op" id="1769145">[</span><span class="op" id="1769146">]</span><span class="builtintype" id="1769147">byte</span><span class="op" id="1769151">,</span>&nbsp;<span class="ident" id="1769153">r</span>&nbsp;<span class="builtintype" id="1769155">rune</span><span class="op" id="1769159">)</span>&nbsp;<span class="builtintype" id="1769161">int</span>&nbsp;<span class="op" id="1769165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1769168">//&nbsp;Negative&nbsp;values&nbsp;are&nbsp;erroneous.&nbsp;&nbsp;Making&nbsp;it&nbsp;unsigned&nbsp;addresses&nbsp;the&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769246">switch</span>&nbsp;<span class="ident" id="1769253">i</span>&nbsp;<span class="op" id="1769255">:=</span>&nbsp;<span class="builtintype" id="1769258">uint32</span><span class="op" id="1769264">(</span><span class="ident" id="1769265">r</span><span class="op" id="1769266">)</span><span class="op" id="1769267">;</span>&nbsp;<span class="op" id="1769269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769272">case</span>&nbsp;<span class="ident" id="1769277">i</span>&nbsp;<span class="op" id="1769279">&lt;=</span>&nbsp;<span class="ident" id="1769282">rune1Max</span><span class="op" id="1769290">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769294">p</span><span class="op" id="1769295">[</span><span class="num" id="1769296">0</span><span class="op" id="1769297">]</span>&nbsp;<span class="op" id="1769299">=</span>&nbsp;<span class="builtintype" id="1769301">byte</span><span class="op" id="1769305">(</span><span class="ident" id="1769306">r</span><span class="op" id="1769307">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769311">return</span>&nbsp;<span class="num" id="1769318">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769321">case</span>&nbsp;<span class="ident" id="1769326">i</span>&nbsp;<span class="op" id="1769328">&lt;=</span>&nbsp;<span class="ident" id="1769331">rune2Max</span><span class="op" id="1769339">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769343">p</span><span class="op" id="1769344">[</span><span class="num" id="1769345">0</span><span class="op" id="1769346">]</span>&nbsp;<span class="op" id="1769348">=</span>&nbsp;<span class="ident" id="1769350">t2</span>&nbsp;<span class="op" id="1769353">|</span>&nbsp;<span class="builtintype" id="1769355">byte</span><span class="op" id="1769359">(</span><span class="ident" id="1769360">r</span><span class="op" id="1769361">&gt;&gt;</span><span class="num" id="1769363">6</span><span class="op" id="1769364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769368">p</span><span class="op" id="1769369">[</span><span class="num" id="1769370">1</span><span class="op" id="1769371">]</span>&nbsp;<span class="op" id="1769373">=</span>&nbsp;<span class="ident" id="1769375">tx</span>&nbsp;<span class="op" id="1769378">|</span>&nbsp;<span class="builtintype" id="1769380">byte</span><span class="op" id="1769384">(</span><span class="ident" id="1769385">r</span><span class="op" id="1769386">)</span><span class="op" id="1769387">&amp;</span><span class="ident" id="1769388">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769396">return</span>&nbsp;<span class="num" id="1769403">2</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769406">case</span>&nbsp;<span class="ident" id="1769411">i</span>&nbsp;<span class="op" id="1769413">&gt;</span>&nbsp;<span class="ident" id="1769415">MaxRune</span><span class="op" id="1769422">,</span>&nbsp;<span class="ident" id="1769424">surrogateMin</span>&nbsp;<span class="op" id="1769437">&lt;=</span>&nbsp;<span class="ident" id="1769440">i</span>&nbsp;<span class="op" id="1769442">&amp;&amp;</span>&nbsp;<span class="ident" id="1769445">i</span>&nbsp;<span class="op" id="1769447">&lt;=</span>&nbsp;<span class="ident" id="1769450">surrogateMax</span><span class="op" id="1769462">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769466">r</span>&nbsp;<span class="op" id="1769468">=</span>&nbsp;<span class="ident" id="1769470">RuneError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769482">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769495">case</span>&nbsp;<span class="ident" id="1769500">i</span>&nbsp;<span class="op" id="1769502">&lt;=</span>&nbsp;<span class="ident" id="1769505">rune3Max</span><span class="op" id="1769513">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769517">p</span><span class="op" id="1769518">[</span><span class="num" id="1769519">0</span><span class="op" id="1769520">]</span>&nbsp;<span class="op" id="1769522">=</span>&nbsp;<span class="ident" id="1769524">t3</span>&nbsp;<span class="op" id="1769527">|</span>&nbsp;<span class="builtintype" id="1769529">byte</span><span class="op" id="1769533">(</span><span class="ident" id="1769534">r</span><span class="op" id="1769535">&gt;&gt;</span><span class="num" id="1769537">12</span><span class="op" id="1769539">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769543">p</span><span class="op" id="1769544">[</span><span class="num" id="1769545">1</span><span class="op" id="1769546">]</span>&nbsp;<span class="op" id="1769548">=</span>&nbsp;<span class="ident" id="1769550">tx</span>&nbsp;<span class="op" id="1769553">|</span>&nbsp;<span class="builtintype" id="1769555">byte</span><span class="op" id="1769559">(</span><span class="ident" id="1769560">r</span><span class="op" id="1769561">&gt;&gt;</span><span class="num" id="1769563">6</span><span class="op" id="1769564">)</span><span class="op" id="1769565">&amp;</span><span class="ident" id="1769566">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769574">p</span><span class="op" id="1769575">[</span><span class="num" id="1769576">2</span><span class="op" id="1769577">]</span>&nbsp;<span class="op" id="1769579">=</span>&nbsp;<span class="ident" id="1769581">tx</span>&nbsp;<span class="op" id="1769584">|</span>&nbsp;<span class="builtintype" id="1769586">byte</span><span class="op" id="1769590">(</span><span class="ident" id="1769591">r</span><span class="op" id="1769592">)</span><span class="op" id="1769593">&amp;</span><span class="ident" id="1769594">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769602">return</span>&nbsp;<span class="num" id="1769609">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769612">default</span><span class="op" id="1769619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769623">p</span><span class="op" id="1769624">[</span><span class="num" id="1769625">0</span><span class="op" id="1769626">]</span>&nbsp;<span class="op" id="1769628">=</span>&nbsp;<span class="ident" id="1769630">t4</span>&nbsp;<span class="op" id="1769633">|</span>&nbsp;<span class="builtintype" id="1769635">byte</span><span class="op" id="1769639">(</span><span class="ident" id="1769640">r</span><span class="op" id="1769641">&gt;&gt;</span><span class="num" id="1769643">18</span><span class="op" id="1769645">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769649">p</span><span class="op" id="1769650">[</span><span class="num" id="1769651">1</span><span class="op" id="1769652">]</span>&nbsp;<span class="op" id="1769654">=</span>&nbsp;<span class="ident" id="1769656">tx</span>&nbsp;<span class="op" id="1769659">|</span>&nbsp;<span class="builtintype" id="1769661">byte</span><span class="op" id="1769665">(</span><span class="ident" id="1769666">r</span><span class="op" id="1769667">&gt;&gt;</span><span class="num" id="1769669">12</span><span class="op" id="1769671">)</span><span class="op" id="1769672">&amp;</span><span class="ident" id="1769673">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769681">p</span><span class="op" id="1769682">[</span><span class="num" id="1769683">2</span><span class="op" id="1769684">]</span>&nbsp;<span class="op" id="1769686">=</span>&nbsp;<span class="ident" id="1769688">tx</span>&nbsp;<span class="op" id="1769691">|</span>&nbsp;<span class="builtintype" id="1769693">byte</span><span class="op" id="1769697">(</span><span class="ident" id="1769698">r</span><span class="op" id="1769699">&gt;&gt;</span><span class="num" id="1769701">6</span><span class="op" id="1769702">)</span><span class="op" id="1769703">&amp;</span><span class="ident" id="1769704">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769712">p</span><span class="op" id="1769713">[</span><span class="num" id="1769714">3</span><span class="op" id="1769715">]</span>&nbsp;<span class="op" id="1769717">=</span>&nbsp;<span class="ident" id="1769719">tx</span>&nbsp;<span class="op" id="1769722">|</span>&nbsp;<span class="builtintype" id="1769724">byte</span><span class="op" id="1769728">(</span><span class="ident" id="1769729">r</span><span class="op" id="1769730">)</span><span class="op" id="1769731">&amp;</span><span class="ident" id="1769732">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769740">return</span>&nbsp;<span class="num" id="1769747">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769750">}</span><br>
<span class="lineno">365</span><span class="op" id="1769752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1769755">//&nbsp;RuneCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;runes&nbsp;in&nbsp;p.&nbsp;&nbsp;Erroneous&nbsp;and&nbsp;short</span><br>
<span class="lineno"></span><span class="comment" id="1769823">//&nbsp;encodings&nbsp;are&nbsp;treated&nbsp;as&nbsp;single&nbsp;runes&nbsp;of&nbsp;width&nbsp;1&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="1769881">func</span>&nbsp;<span class="ident" id="1769886">RuneCount</span><span class="op" id="1769895">(</span><span class="ident" id="1769896">p</span>&nbsp;<span class="op" id="1769898">[</span><span class="op" id="1769899">]</span><span class="builtintype" id="1769900">byte</span><span class="op" id="1769904">)</span>&nbsp;<span class="builtintype" id="1769906">int</span>&nbsp;<span class="op" id="1769910">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769913">i</span>&nbsp;<span class="op" id="1769915">:=</span>&nbsp;<span class="num" id="1769918">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769921">var</span>&nbsp;<span class="ident" id="1769925">n</span>&nbsp;<span class="builtintype" id="1769927">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769932">for</span>&nbsp;<span class="ident" id="1769936">n</span>&nbsp;<span class="op" id="1769938">=</span>&nbsp;<span class="num" id="1769940">0</span><span class="op" id="1769941">;</span>&nbsp;<span class="ident" id="1769943">i</span>&nbsp;<span class="op" id="1769945">&lt;</span>&nbsp;<span class="builtinfunc" id="1769947">len</span><span class="op" id="1769950">(</span><span class="ident" id="1769951">p</span><span class="op" id="1769952">)</span><span class="op" id="1769953">;</span>&nbsp;<span class="ident" id="1769955">n</span><span class="op" id="1769956">++</span>&nbsp;<span class="op" id="1769959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769963">if</span>&nbsp;<span class="ident" id="1769966">p</span><span class="op" id="1769967">[</span><span class="ident" id="1769968">i</span><span class="op" id="1769969">]</span>&nbsp;<span class="op" id="1769971">&lt;</span>&nbsp;<span class="ident" id="1769973">RuneSelf</span>&nbsp;<span class="op" id="1769982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769987">i</span><span class="op" id="1769988">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769993">}</span>&nbsp;<span class="keyword" id="1769995">else</span>&nbsp;<span class="op" id="1770000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770005">_</span><span class="op" id="1770006">,</span>&nbsp;<span class="ident" id="1770008">size</span>&nbsp;<span class="op" id="1770013">:=</span>&nbsp;<span class="ident" id="1770016">DecodeRune</span><span class="op" id="1770026">(</span><span class="ident" id="1770027">p</span><span class="op" id="1770028">[</span><span class="ident" id="1770029">i</span><span class="op" id="1770030">:</span><span class="op" id="1770031">]</span><span class="op" id="1770032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770037">i</span>&nbsp;<span class="op" id="1770039">+=</span>&nbsp;<span class="ident" id="1770042">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770052">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770055">return</span>&nbsp;<span class="ident" id="1770062">n</span><br>
<span class="lineno"></span><span class="op" id="1770064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1770067">//&nbsp;RuneCountInString&nbsp;is&nbsp;like&nbsp;RuneCount&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1770133">func</span>&nbsp;<span class="ident" id="1770138">RuneCountInString</span><span class="op" id="1770155">(</span><span class="ident" id="1770156">s</span>&nbsp;<span class="builtintype" id="1770158">string</span><span class="op" id="1770164">)</span>&nbsp;<span class="op" id="1770166">(</span><span class="ident" id="1770167">n</span>&nbsp;<span class="builtintype" id="1770169">int</span><span class="op" id="1770172">)</span>&nbsp;<span class="op" id="1770174">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770177">for</span>&nbsp;<span class="keyword" id="1770181">range</span>&nbsp;<span class="ident" id="1770187">s</span>&nbsp;<span class="op" id="1770189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770193">n</span><span class="op" id="1770194">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770201">return</span><br>
<span class="lineno"></span><span class="op" id="1770208">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="1770211">//&nbsp;RuneStart&nbsp;reports&nbsp;whether&nbsp;the&nbsp;byte&nbsp;could&nbsp;be&nbsp;the&nbsp;first&nbsp;byte&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1770276">//&nbsp;an&nbsp;encoded&nbsp;rune.&nbsp;&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;bytes&nbsp;always&nbsp;have&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span><span class="comment" id="1770345">//&nbsp;two&nbsp;bits&nbsp;set&nbsp;to&nbsp;10.</span><br>
<span class="lineno"></span><span class="keyword" id="1770368">func</span>&nbsp;<span class="ident" id="1770373">RuneStart</span><span class="op" id="1770382">(</span><span class="ident" id="1770383">b</span>&nbsp;<span class="builtintype" id="1770385">byte</span><span class="op" id="1770389">)</span>&nbsp;<span class="builtintype" id="1770391">bool</span>&nbsp;<span class="op" id="1770396">{</span>&nbsp;<span class="keyword" id="1770398">return</span>&nbsp;<span class="ident" id="1770405">b</span><span class="op" id="1770406">&amp;</span><span class="num" id="1770407">0xC0</span>&nbsp;<span class="op" id="1770412">!=</span>&nbsp;<span class="num" id="1770415">0x80</span>&nbsp;<span class="op" id="1770420">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="1770423">//&nbsp;Valid&nbsp;reports&nbsp;whether&nbsp;p&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1770498">func</span>&nbsp;<span class="ident" id="1770503">Valid</span><span class="op" id="1770508">(</span><span class="ident" id="1770509">p</span>&nbsp;<span class="op" id="1770511">[</span><span class="op" id="1770512">]</span><span class="builtintype" id="1770513">byte</span><span class="op" id="1770517">)</span>&nbsp;<span class="builtintype" id="1770519">bool</span>&nbsp;<span class="op" id="1770524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770527">i</span>&nbsp;<span class="op" id="1770529">:=</span>&nbsp;<span class="num" id="1770532">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770535">for</span>&nbsp;<span class="ident" id="1770539">i</span>&nbsp;<span class="op" id="1770541">&lt;</span>&nbsp;<span class="builtinfunc" id="1770543">len</span><span class="op" id="1770546">(</span><span class="ident" id="1770547">p</span><span class="op" id="1770548">)</span>&nbsp;<span class="op" id="1770550">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770554">if</span>&nbsp;<span class="ident" id="1770557">p</span><span class="op" id="1770558">[</span><span class="ident" id="1770559">i</span><span class="op" id="1770560">]</span>&nbsp;<span class="op" id="1770562">&lt;</span>&nbsp;<span class="ident" id="1770564">RuneSelf</span>&nbsp;<span class="op" id="1770573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770578">i</span><span class="op" id="1770579">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770584">}</span>&nbsp;<span class="keyword" id="1770586">else</span>&nbsp;<span class="op" id="1770591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770596">_</span><span class="op" id="1770597">,</span>&nbsp;<span class="ident" id="1770599">size</span>&nbsp;<span class="op" id="1770604">:=</span>&nbsp;<span class="ident" id="1770607">DecodeRune</span><span class="op" id="1770617">(</span><span class="ident" id="1770618">p</span><span class="op" id="1770619">[</span><span class="ident" id="1770620">i</span><span class="op" id="1770621">:</span><span class="op" id="1770622">]</span><span class="op" id="1770623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770628">if</span>&nbsp;<span class="ident" id="1770631">size</span>&nbsp;<span class="op" id="1770636">==</span>&nbsp;<span class="num" id="1770639">1</span>&nbsp;<span class="op" id="1770641">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1770647">//&nbsp;All&nbsp;valid&nbsp;runes&nbsp;of&nbsp;size&nbsp;1&nbsp;(those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1770687">//&nbsp;below&nbsp;RuneSelf)&nbsp;were&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1770730">//&nbsp;This&nbsp;must&nbsp;be&nbsp;a&nbsp;RuneError.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770763">return</span>&nbsp;<span class="builtintype" id="1770770">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770779">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770784">i</span>&nbsp;<span class="op" id="1770786">+=</span>&nbsp;<span class="ident" id="1770789">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770802">return</span>&nbsp;<span class="builtintype" id="1770809">true</span><br>
<span class="lineno"></span><span class="op" id="1770814">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="1770817">//&nbsp;ValidString&nbsp;reports&nbsp;whether&nbsp;s&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1770898">func</span>&nbsp;<span class="ident" id="1770903">ValidString</span><span class="op" id="1770914">(</span><span class="ident" id="1770915">s</span>&nbsp;<span class="builtintype" id="1770917">string</span><span class="op" id="1770923">)</span>&nbsp;<span class="builtintype" id="1770925">bool</span>&nbsp;<span class="op" id="1770930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770933">for</span>&nbsp;<span class="ident" id="1770937">i</span><span class="op" id="1770938">,</span>&nbsp;<span class="ident" id="1770940">r</span>&nbsp;<span class="op" id="1770942">:=</span>&nbsp;<span class="keyword" id="1770945">range</span>&nbsp;<span class="ident" id="1770951">s</span>&nbsp;<span class="op" id="1770953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770957">if</span>&nbsp;<span class="ident" id="1770960">r</span>&nbsp;<span class="op" id="1770962">==</span>&nbsp;<span class="ident" id="1770965">RuneError</span>&nbsp;<span class="op" id="1770975">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1770980">//&nbsp;The&nbsp;RuneError&nbsp;value&nbsp;can&nbsp;be&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1771022">//&nbsp;sentinel&nbsp;value&nbsp;(if&nbsp;it&#39;s&nbsp;size&nbsp;1)&nbsp;or&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1771072">//&nbsp;value&nbsp;encoded&nbsp;properly.&nbsp;Decode&nbsp;it&nbsp;to&nbsp;see&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1771122">//&nbsp;it&#39;s&nbsp;the&nbsp;1&nbsp;byte&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771160">_</span><span class="op" id="1771161">,</span>&nbsp;<span class="ident" id="1771163">size</span>&nbsp;<span class="op" id="1771168">:=</span>&nbsp;<span class="ident" id="1771171">DecodeRuneInString</span><span class="op" id="1771189">(</span><span class="ident" id="1771190">s</span><span class="op" id="1771191">[</span><span class="ident" id="1771192">i</span><span class="op" id="1771193">:</span><span class="op" id="1771194">]</span><span class="op" id="1771195">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771200">if</span>&nbsp;<span class="ident" id="1771203">size</span>&nbsp;<span class="op" id="1771208">==</span>&nbsp;<span class="num" id="1771211">1</span>&nbsp;<span class="op" id="1771213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771219">return</span>&nbsp;<span class="builtintype" id="1771226">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1771235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1771239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1771242">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771245">return</span>&nbsp;<span class="builtintype" id="1771252">true</span><br>
<span class="lineno"></span><span class="op" id="1771257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1771260">//&nbsp;ValidRune&nbsp;reports&nbsp;whether&nbsp;r&nbsp;can&nbsp;be&nbsp;legally&nbsp;encoded&nbsp;as&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1771324">//&nbsp;Code&nbsp;points&nbsp;that&nbsp;are&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;a&nbsp;surrogate&nbsp;half&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno">435</span><span class="keyword" id="1771394">func</span>&nbsp;<span class="ident" id="1771399">ValidRune</span><span class="op" id="1771408">(</span><span class="ident" id="1771409">r</span>&nbsp;<span class="builtintype" id="1771411">rune</span><span class="op" id="1771415">)</span>&nbsp;<span class="builtintype" id="1771417">bool</span>&nbsp;<span class="op" id="1771422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771425">switch</span>&nbsp;<span class="op" id="1771432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771435">case</span>&nbsp;<span class="ident" id="1771440">r</span>&nbsp;<span class="op" id="1771442">&lt;</span>&nbsp;<span class="num" id="1771444">0</span><span class="op" id="1771445">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771449">return</span>&nbsp;<span class="builtintype" id="1771456">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771463">case</span>&nbsp;<span class="ident" id="1771468">surrogateMin</span>&nbsp;<span class="op" id="1771481">&lt;=</span>&nbsp;<span class="ident" id="1771484">r</span>&nbsp;<span class="op" id="1771486">&amp;&amp;</span>&nbsp;<span class="ident" id="1771489">r</span>&nbsp;<span class="op" id="1771491">&lt;=</span>&nbsp;<span class="ident" id="1771494">surrogateMax</span><span class="op" id="1771506">:</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771510">return</span>&nbsp;<span class="builtintype" id="1771517">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771524">case</span>&nbsp;<span class="ident" id="1771529">r</span>&nbsp;<span class="op" id="1771531">&gt;</span>&nbsp;<span class="ident" id="1771533">MaxRune</span><span class="op" id="1771540">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771544">return</span>&nbsp;<span class="builtintype" id="1771551">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1771558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771561">return</span>&nbsp;<span class="builtintype" id="1771568">true</span><br>
<span class="lineno">445</span><span class="op" id="1771573">}</span>
</div>
</body>
</html>
