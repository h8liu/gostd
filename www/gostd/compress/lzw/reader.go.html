<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5338881">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5338936">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5338990">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5339041">//&nbsp;Package&nbsp;lzw&nbsp;implements&nbsp;the&nbsp;Lempel-Ziv-Welch&nbsp;compressed&nbsp;data&nbsp;format,</span><br>
<span class="lineno"></span><span class="comment" id="5339112">//&nbsp;described&nbsp;in&nbsp;T.&nbsp;A.&nbsp;Welch,&nbsp;``A&nbsp;Technique&nbsp;for&nbsp;High-Performance&nbsp;Data</span><br>
<span class="lineno"></span><span class="comment" id="5339181">//&nbsp;Compression&#39;&#39;,&nbsp;Computer,&nbsp;17(6)&nbsp;(June&nbsp;1984),&nbsp;pp&nbsp;8-19.</span><br>
<span class="lineno"></span><span class="comment" id="5339237">//</span><br>
<span class="lineno"></span><span class="comment" id="5339240">//&nbsp;In&nbsp;particular,&nbsp;it&nbsp;implements&nbsp;LZW&nbsp;as&nbsp;used&nbsp;by&nbsp;the&nbsp;GIF&nbsp;and&nbsp;PDF&nbsp;file</span><br>
<span class="lineno">10</span><span class="comment" id="5339308">//&nbsp;formats,&nbsp;which&nbsp;means&nbsp;variable-width&nbsp;codes&nbsp;up&nbsp;to&nbsp;12&nbsp;bits&nbsp;and&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="5339381">//&nbsp;two&nbsp;non-literal&nbsp;codes&nbsp;are&nbsp;a&nbsp;clear&nbsp;code&nbsp;and&nbsp;an&nbsp;EOF&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="5339440">//</span><br>
<span class="lineno"></span><span class="comment" id="5339443">//&nbsp;The&nbsp;TIFF&nbsp;file&nbsp;format&nbsp;uses&nbsp;a&nbsp;similar&nbsp;but&nbsp;incompatible&nbsp;version&nbsp;of&nbsp;the&nbsp;LZW</span><br>
<span class="lineno"></span><span class="comment" id="5339518">//&nbsp;algorithm.&nbsp;See&nbsp;the&nbsp;golang.org/x/image/tiff/lzw&nbsp;package&nbsp;for&nbsp;an</span><br>
<span class="lineno">15</span><span class="comment" id="5339583">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="5339602">package</span>&nbsp;<span class="ident" id="5339610">lzw</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5339615">//&nbsp;TODO(nigeltao):&nbsp;check&nbsp;that&nbsp;PDF&nbsp;uses&nbsp;LZW&nbsp;in&nbsp;the&nbsp;same&nbsp;way&nbsp;as&nbsp;GIF,</span><br>
<span class="lineno"></span><span class="comment" id="5339682">//&nbsp;modulo&nbsp;LSB/MSB&nbsp;packing&nbsp;order.</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5339716">import</span>&nbsp;<span class="op" id="5339723">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5339726">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5339735">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5339745">&#34;fmt&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5339752">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5339757">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5339760">//&nbsp;Order&nbsp;specifies&nbsp;the&nbsp;bit&nbsp;ordering&nbsp;in&nbsp;an&nbsp;LZW&nbsp;data&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5339819">type</span>&nbsp;<span class="ident" id="5339824">Order</span>&nbsp;<span class="builtintype" id="5339830">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="5339835">const</span>&nbsp;<span class="op" id="5339841">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5339844">//&nbsp;LSB&nbsp;means&nbsp;Least&nbsp;Significant&nbsp;Bits&nbsp;first,&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;GIF&nbsp;file&nbsp;format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5339920">LSB</span>&nbsp;<span class="ident" id="5339924">Order</span>&nbsp;<span class="op" id="5339930">=</span>&nbsp;<span class="ident" id="5339932">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5339938">//&nbsp;MSB&nbsp;means&nbsp;Most&nbsp;Significant&nbsp;Bits&nbsp;first,&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;TIFF&nbsp;and&nbsp;PDF</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5340009">//&nbsp;file&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340027">MSB</span><br>
<span class="lineno"></span><span class="op" id="5340031">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5340034">const</span>&nbsp;<span class="op" id="5340040">(</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340043">maxWidth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5340062">=</span>&nbsp;<span class="num" id="5340064">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340068">decoderInvalidCode</span>&nbsp;<span class="op" id="5340087">=</span>&nbsp;<span class="num" id="5340089">0xffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340097">flushBuffer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5340116">=</span>&nbsp;<span class="num" id="5340118">1</span>&nbsp;<span class="op" id="5340120">&lt;&lt;</span>&nbsp;<span class="ident" id="5340123">maxWidth</span><br>
<span class="lineno"></span><span class="op" id="5340132">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5340135">//&nbsp;decoder&nbsp;is&nbsp;the&nbsp;state&nbsp;from&nbsp;which&nbsp;the&nbsp;readXxx&nbsp;method&nbsp;converts&nbsp;a&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="5340205">//&nbsp;stream&nbsp;into&nbsp;a&nbsp;code&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5340235">type</span>&nbsp;<span class="ident" id="5340240">decoder</span>&nbsp;<span class="keyword" id="5340248">struct</span>&nbsp;<span class="op" id="5340255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340258">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340267">io</span><span class="op" id="5340269">.</span><span class="ident" id="5340270">ByteReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340282">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5340291">uint32</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340299">nBits</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5340308">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340314">width</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5340323">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340329">read</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5340338">func</span><span class="op" id="5340342">(</span><span class="op" id="5340343">*</span><span class="ident" id="5340344">decoder</span><span class="op" id="5340351">)</span>&nbsp;<span class="op" id="5340353">(</span><span class="builtintype" id="5340354">uint16</span><span class="op" id="5340360">,</span>&nbsp;<span class="builtintype" id="5340362">error</span><span class="op" id="5340367">)</span>&nbsp;<span class="comment" id="5340369">//&nbsp;readLSB&nbsp;or&nbsp;readMSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340392">litWidth</span>&nbsp;<span class="builtintype" id="5340401">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5340432">//&nbsp;width&nbsp;in&nbsp;bits&nbsp;of&nbsp;literal&nbsp;codes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340467">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5340476">error</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5340484">//&nbsp;The&nbsp;first&nbsp;1&lt;&lt;litWidth&nbsp;codes&nbsp;are&nbsp;literal&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5340535">//&nbsp;The&nbsp;next&nbsp;two&nbsp;codes&nbsp;mean&nbsp;clear&nbsp;and&nbsp;EOF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5340578">//&nbsp;Other&nbsp;valid&nbsp;codes&nbsp;are&nbsp;in&nbsp;the&nbsp;range&nbsp;[lo,&nbsp;hi]&nbsp;where&nbsp;lo&nbsp;:=&nbsp;clear&nbsp;+&nbsp;2,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5340649">//&nbsp;with&nbsp;the&nbsp;upper&nbsp;bound&nbsp;incrementing&nbsp;on&nbsp;each&nbsp;code&nbsp;seen.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5340706">//&nbsp;overflow&nbsp;is&nbsp;the&nbsp;code&nbsp;at&nbsp;which&nbsp;hi&nbsp;overflows&nbsp;the&nbsp;code&nbsp;width.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5340769">//&nbsp;last&nbsp;is&nbsp;the&nbsp;most&nbsp;recently&nbsp;seen&nbsp;code,&nbsp;or&nbsp;decoderInvalidCode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5340833">clear</span><span class="op" id="5340838">,</span>&nbsp;<span class="ident" id="5340840">eof</span><span class="op" id="5340843">,</span>&nbsp;<span class="ident" id="5340845">hi</span><span class="op" id="5340847">,</span>&nbsp;<span class="ident" id="5340849">overflow</span><span class="op" id="5340857">,</span>&nbsp;<span class="ident" id="5340859">last</span>&nbsp;<span class="builtintype" id="5340864">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5340873">//&nbsp;Each&nbsp;code&nbsp;c&nbsp;in&nbsp;[lo,&nbsp;hi]&nbsp;expands&nbsp;to&nbsp;two&nbsp;or&nbsp;more&nbsp;bytes.&nbsp;For&nbsp;c&nbsp;!=&nbsp;hi:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5340944">//&nbsp;&nbsp;&nbsp;suffix[c]&nbsp;is&nbsp;the&nbsp;last&nbsp;of&nbsp;these&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5340988">//&nbsp;&nbsp;&nbsp;prefix[c]&nbsp;is&nbsp;the&nbsp;code&nbsp;for&nbsp;all&nbsp;but&nbsp;the&nbsp;last&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5341043">//&nbsp;&nbsp;&nbsp;This&nbsp;code&nbsp;can&nbsp;either&nbsp;be&nbsp;a&nbsp;literal&nbsp;code&nbsp;or&nbsp;another&nbsp;code&nbsp;in&nbsp;[lo,&nbsp;c).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5341116">//&nbsp;The&nbsp;c&nbsp;==&nbsp;hi&nbsp;case&nbsp;is&nbsp;a&nbsp;special&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341156">suffix</span>&nbsp;<span class="op" id="5341163">[</span><span class="num" id="5341164">1</span>&nbsp;<span class="op" id="5341166">&lt;&lt;</span>&nbsp;<span class="ident" id="5341169">maxWidth</span><span class="op" id="5341177">]</span><span class="builtintype" id="5341178">uint8</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341185">prefix</span>&nbsp;<span class="op" id="5341192">[</span><span class="num" id="5341193">1</span>&nbsp;<span class="op" id="5341195">&lt;&lt;</span>&nbsp;<span class="ident" id="5341198">maxWidth</span><span class="op" id="5341206">]</span><span class="builtintype" id="5341207">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5341216">//&nbsp;output&nbsp;is&nbsp;the&nbsp;temporary&nbsp;output&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5341259">//&nbsp;Literal&nbsp;codes&nbsp;are&nbsp;accumulated&nbsp;from&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5341323">//&nbsp;Non-literal&nbsp;codes&nbsp;decode&nbsp;to&nbsp;a&nbsp;sequence&nbsp;of&nbsp;suffixes&nbsp;that&nbsp;are&nbsp;first</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5341393">//&nbsp;written&nbsp;right-to-left&nbsp;from&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;buffer&nbsp;before&nbsp;being&nbsp;copied</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5341466">//&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5341498">//&nbsp;It&nbsp;is&nbsp;flushed&nbsp;when&nbsp;it&nbsp;contains&nbsp;&gt;=&nbsp;1&lt;&lt;maxWidth&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5341555">//&nbsp;so&nbsp;that&nbsp;there&nbsp;is&nbsp;always&nbsp;room&nbsp;to&nbsp;decode&nbsp;an&nbsp;entire&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341614">output</span>&nbsp;<span class="op" id="5341621">[</span><span class="num" id="5341622">2</span>&nbsp;<span class="op" id="5341624">*</span>&nbsp;<span class="num" id="5341626">1</span>&nbsp;<span class="op" id="5341628">&lt;&lt;</span>&nbsp;<span class="ident" id="5341631">maxWidth</span><span class="op" id="5341639">]</span><span class="builtintype" id="5341640">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341646">o</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5341653">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5341660">//&nbsp;write&nbsp;index&nbsp;into&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341688">toRead</span>&nbsp;<span class="op" id="5341695">[</span><span class="op" id="5341696">]</span><span class="builtintype" id="5341697">byte</span>&nbsp;<span class="comment" id="5341702">//&nbsp;bytes&nbsp;to&nbsp;return&nbsp;from&nbsp;Read</span><br>
<span class="lineno"></span><span class="op" id="5341731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5341734">//&nbsp;readLSB&nbsp;returns&nbsp;the&nbsp;next&nbsp;code&nbsp;for&nbsp;&#34;Least&nbsp;Significant&nbsp;Bits&nbsp;first&#34;&nbsp;data.</span><br>
<span class="lineno">85</span><span class="keyword" id="5341808">func</span>&nbsp;<span class="op" id="5341813">(</span><span class="ident" id="5341814">d</span>&nbsp;<span class="op" id="5341816">*</span><span class="ident" id="5341817">decoder</span><span class="op" id="5341824">)</span>&nbsp;<span class="ident" id="5341826">readLSB</span><span class="op" id="5341833">(</span><span class="op" id="5341834">)</span>&nbsp;<span class="op" id="5341836">(</span><span class="builtintype" id="5341837">uint16</span><span class="op" id="5341843">,</span>&nbsp;<span class="builtintype" id="5341845">error</span><span class="op" id="5341850">)</span>&nbsp;<span class="op" id="5341852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5341855">for</span>&nbsp;<span class="ident" id="5341859">d</span><span class="op" id="5341860">.</span><span class="ident" id="5341861">nBits</span>&nbsp;<span class="op" id="5341867">&lt;</span>&nbsp;<span class="ident" id="5341869">d</span><span class="op" id="5341870">.</span><span class="ident" id="5341871">width</span>&nbsp;<span class="op" id="5341877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341881">x</span><span class="op" id="5341882">,</span>&nbsp;<span class="ident" id="5341884">err</span>&nbsp;<span class="op" id="5341888">:=</span>&nbsp;<span class="ident" id="5341891">d</span><span class="op" id="5341892">.</span><span class="ident" id="5341893">r</span><span class="op" id="5341894">.</span><span class="ident" id="5341895">ReadByte</span><span class="op" id="5341903">(</span><span class="op" id="5341904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5341908">if</span>&nbsp;<span class="ident" id="5341911">err</span>&nbsp;<span class="op" id="5341915">!=</span>&nbsp;<span class="ident" id="5341918">nil</span>&nbsp;<span class="op" id="5341922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5341927">return</span>&nbsp;<span class="num" id="5341934">0</span><span class="op" id="5341935">,</span>&nbsp;<span class="ident" id="5341937">err</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5341943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341947">d</span><span class="op" id="5341948">.</span><span class="ident" id="5341949">bits</span>&nbsp;<span class="op" id="5341954">|=</span>&nbsp;<span class="builtintype" id="5341957">uint32</span><span class="op" id="5341963">(</span><span class="ident" id="5341964">x</span><span class="op" id="5341965">)</span>&nbsp;<span class="op" id="5341967">&lt;&lt;</span>&nbsp;<span class="ident" id="5341970">d</span><span class="op" id="5341971">.</span><span class="ident" id="5341972">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341980">d</span><span class="op" id="5341981">.</span><span class="ident" id="5341982">nBits</span>&nbsp;<span class="op" id="5341988">+=</span>&nbsp;<span class="num" id="5341991">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5341994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5341997">code</span>&nbsp;<span class="op" id="5342002">:=</span>&nbsp;<span class="builtintype" id="5342005">uint16</span><span class="op" id="5342011">(</span><span class="ident" id="5342012">d</span><span class="op" id="5342013">.</span><span class="ident" id="5342014">bits</span>&nbsp;<span class="op" id="5342019">&amp;</span>&nbsp;<span class="op" id="5342021">(</span><span class="num" id="5342022">1</span><span class="op" id="5342023">&lt;&lt;</span><span class="ident" id="5342025">d</span><span class="op" id="5342026">.</span><span class="ident" id="5342027">width</span>&nbsp;<span class="op" id="5342033">-</span>&nbsp;<span class="num" id="5342035">1</span><span class="op" id="5342036">)</span><span class="op" id="5342037">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342040">d</span><span class="op" id="5342041">.</span><span class="ident" id="5342042">bits</span>&nbsp;<span class="op" id="5342047">&gt;&gt;=</span>&nbsp;<span class="ident" id="5342051">d</span><span class="op" id="5342052">.</span><span class="ident" id="5342053">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342060">d</span><span class="op" id="5342061">.</span><span class="ident" id="5342062">nBits</span>&nbsp;<span class="op" id="5342068">-=</span>&nbsp;<span class="ident" id="5342071">d</span><span class="op" id="5342072">.</span><span class="ident" id="5342073">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342080">return</span>&nbsp;<span class="ident" id="5342087">code</span><span class="op" id="5342091">,</span>&nbsp;<span class="ident" id="5342093">nil</span><br>
<span class="lineno"></span><span class="op" id="5342097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="5342100">//&nbsp;readMSB&nbsp;returns&nbsp;the&nbsp;next&nbsp;code&nbsp;for&nbsp;&#34;Most&nbsp;Significant&nbsp;Bits&nbsp;first&#34;&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5342173">func</span>&nbsp;<span class="op" id="5342178">(</span><span class="ident" id="5342179">d</span>&nbsp;<span class="op" id="5342181">*</span><span class="ident" id="5342182">decoder</span><span class="op" id="5342189">)</span>&nbsp;<span class="ident" id="5342191">readMSB</span><span class="op" id="5342198">(</span><span class="op" id="5342199">)</span>&nbsp;<span class="op" id="5342201">(</span><span class="builtintype" id="5342202">uint16</span><span class="op" id="5342208">,</span>&nbsp;<span class="builtintype" id="5342210">error</span><span class="op" id="5342215">)</span>&nbsp;<span class="op" id="5342217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342220">for</span>&nbsp;<span class="ident" id="5342224">d</span><span class="op" id="5342225">.</span><span class="ident" id="5342226">nBits</span>&nbsp;<span class="op" id="5342232">&lt;</span>&nbsp;<span class="ident" id="5342234">d</span><span class="op" id="5342235">.</span><span class="ident" id="5342236">width</span>&nbsp;<span class="op" id="5342242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342246">x</span><span class="op" id="5342247">,</span>&nbsp;<span class="ident" id="5342249">err</span>&nbsp;<span class="op" id="5342253">:=</span>&nbsp;<span class="ident" id="5342256">d</span><span class="op" id="5342257">.</span><span class="ident" id="5342258">r</span><span class="op" id="5342259">.</span><span class="ident" id="5342260">ReadByte</span><span class="op" id="5342268">(</span><span class="op" id="5342269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342273">if</span>&nbsp;<span class="ident" id="5342276">err</span>&nbsp;<span class="op" id="5342280">!=</span>&nbsp;<span class="ident" id="5342283">nil</span>&nbsp;<span class="op" id="5342287">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342292">return</span>&nbsp;<span class="num" id="5342299">0</span><span class="op" id="5342300">,</span>&nbsp;<span class="ident" id="5342302">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5342308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342312">d</span><span class="op" id="5342313">.</span><span class="ident" id="5342314">bits</span>&nbsp;<span class="op" id="5342319">|=</span>&nbsp;<span class="builtintype" id="5342322">uint32</span><span class="op" id="5342328">(</span><span class="ident" id="5342329">x</span><span class="op" id="5342330">)</span>&nbsp;<span class="op" id="5342332">&lt;&lt;</span>&nbsp;<span class="op" id="5342335">(</span><span class="num" id="5342336">24</span>&nbsp;<span class="op" id="5342339">-</span>&nbsp;<span class="ident" id="5342341">d</span><span class="op" id="5342342">.</span><span class="ident" id="5342343">nBits</span><span class="op" id="5342348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342352">d</span><span class="op" id="5342353">.</span><span class="ident" id="5342354">nBits</span>&nbsp;<span class="op" id="5342360">+=</span>&nbsp;<span class="num" id="5342363">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5342366">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342369">code</span>&nbsp;<span class="op" id="5342374">:=</span>&nbsp;<span class="builtintype" id="5342377">uint16</span><span class="op" id="5342383">(</span><span class="ident" id="5342384">d</span><span class="op" id="5342385">.</span><span class="ident" id="5342386">bits</span>&nbsp;<span class="op" id="5342391">&gt;&gt;</span>&nbsp;<span class="op" id="5342394">(</span><span class="num" id="5342395">32</span>&nbsp;<span class="op" id="5342398">-</span>&nbsp;<span class="ident" id="5342400">d</span><span class="op" id="5342401">.</span><span class="ident" id="5342402">width</span><span class="op" id="5342407">)</span><span class="op" id="5342408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342411">d</span><span class="op" id="5342412">.</span><span class="ident" id="5342413">bits</span>&nbsp;<span class="op" id="5342418">&lt;&lt;=</span>&nbsp;<span class="ident" id="5342422">d</span><span class="op" id="5342423">.</span><span class="ident" id="5342424">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342431">d</span><span class="op" id="5342432">.</span><span class="ident" id="5342433">nBits</span>&nbsp;<span class="op" id="5342439">-=</span>&nbsp;<span class="ident" id="5342442">d</span><span class="op" id="5342443">.</span><span class="ident" id="5342444">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342451">return</span>&nbsp;<span class="ident" id="5342458">code</span><span class="op" id="5342462">,</span>&nbsp;<span class="ident" id="5342464">nil</span><br>
<span class="lineno"></span><span class="op" id="5342468">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="5342471">func</span>&nbsp;<span class="op" id="5342476">(</span><span class="ident" id="5342477">d</span>&nbsp;<span class="op" id="5342479">*</span><span class="ident" id="5342480">decoder</span><span class="op" id="5342487">)</span>&nbsp;<span class="ident" id="5342489">Read</span><span class="op" id="5342493">(</span><span class="ident" id="5342494">b</span>&nbsp;<span class="op" id="5342496">[</span><span class="op" id="5342497">]</span><span class="builtintype" id="5342498">byte</span><span class="op" id="5342502">)</span>&nbsp;<span class="op" id="5342504">(</span><span class="builtintype" id="5342505">int</span><span class="op" id="5342508">,</span>&nbsp;<span class="builtintype" id="5342510">error</span><span class="op" id="5342515">)</span>&nbsp;<span class="op" id="5342517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342520">for</span>&nbsp;<span class="op" id="5342524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342528">if</span>&nbsp;<span class="builtinfunc" id="5342531">len</span><span class="op" id="5342534">(</span><span class="ident" id="5342535">d</span><span class="op" id="5342536">.</span><span class="ident" id="5342537">toRead</span><span class="op" id="5342543">)</span>&nbsp;<span class="op" id="5342545">&gt;</span>&nbsp;<span class="num" id="5342547">0</span>&nbsp;<span class="op" id="5342549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342554">n</span>&nbsp;<span class="op" id="5342556">:=</span>&nbsp;<span class="builtinfunc" id="5342559">copy</span><span class="op" id="5342563">(</span><span class="ident" id="5342564">b</span><span class="op" id="5342565">,</span>&nbsp;<span class="ident" id="5342567">d</span><span class="op" id="5342568">.</span><span class="ident" id="5342569">toRead</span><span class="op" id="5342575">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342580">d</span><span class="op" id="5342581">.</span><span class="ident" id="5342582">toRead</span>&nbsp;<span class="op" id="5342589">=</span>&nbsp;<span class="ident" id="5342591">d</span><span class="op" id="5342592">.</span><span class="ident" id="5342593">toRead</span><span class="op" id="5342599">[</span><span class="ident" id="5342600">n</span><span class="op" id="5342601">:</span><span class="op" id="5342602">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342607">return</span>&nbsp;<span class="ident" id="5342614">n</span><span class="op" id="5342615">,</span>&nbsp;<span class="ident" id="5342617">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5342623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342627">if</span>&nbsp;<span class="ident" id="5342630">d</span><span class="op" id="5342631">.</span><span class="ident" id="5342632">err</span>&nbsp;<span class="op" id="5342636">!=</span>&nbsp;<span class="ident" id="5342639">nil</span>&nbsp;<span class="op" id="5342643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342648">return</span>&nbsp;<span class="num" id="5342655">0</span><span class="op" id="5342656">,</span>&nbsp;<span class="ident" id="5342658">d</span><span class="op" id="5342659">.</span><span class="ident" id="5342660">err</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5342666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342670">d</span><span class="op" id="5342671">.</span><span class="ident" id="5342672">decode</span><span class="op" id="5342678">(</span><span class="op" id="5342679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5342682">}</span><br>
<span class="lineno"></span><span class="op" id="5342684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5342687">//&nbsp;decode&nbsp;decompresses&nbsp;bytes&nbsp;from&nbsp;r&nbsp;and&nbsp;leaves&nbsp;them&nbsp;in&nbsp;d.toRead.</span><br>
<span class="lineno"></span><span class="comment" id="5342752">//&nbsp;read&nbsp;specifies&nbsp;how&nbsp;to&nbsp;decode&nbsp;bytes&nbsp;into&nbsp;codes.</span><br>
<span class="lineno"></span><span class="comment" id="5342802">//&nbsp;litWidth&nbsp;is&nbsp;the&nbsp;width&nbsp;in&nbsp;bits&nbsp;of&nbsp;literal&nbsp;codes.</span><br>
<span class="lineno"></span><span class="keyword" id="5342853">func</span>&nbsp;<span class="op" id="5342858">(</span><span class="ident" id="5342859">d</span>&nbsp;<span class="op" id="5342861">*</span><span class="ident" id="5342862">decoder</span><span class="op" id="5342869">)</span>&nbsp;<span class="ident" id="5342871">decode</span><span class="op" id="5342877">(</span><span class="op" id="5342878">)</span>&nbsp;<span class="op" id="5342880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5342883">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;code&nbsp;stream,&nbsp;converting&nbsp;codes&nbsp;into&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342956">for</span>&nbsp;<span class="op" id="5342960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5342964">code</span><span class="op" id="5342968">,</span>&nbsp;<span class="ident" id="5342970">err</span>&nbsp;<span class="op" id="5342974">:=</span>&nbsp;<span class="ident" id="5342977">d</span><span class="op" id="5342978">.</span><span class="ident" id="5342979">read</span><span class="op" id="5342983">(</span><span class="ident" id="5342984">d</span><span class="op" id="5342985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5342989">if</span>&nbsp;<span class="ident" id="5342992">err</span>&nbsp;<span class="op" id="5342996">!=</span>&nbsp;<span class="ident" id="5342999">nil</span>&nbsp;<span class="op" id="5343003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343008">if</span>&nbsp;<span class="ident" id="5343011">err</span>&nbsp;<span class="op" id="5343015">==</span>&nbsp;<span class="ident" id="5343018">io</span><span class="op" id="5343020">.</span><span class="ident" id="5343021">EOF</span>&nbsp;<span class="op" id="5343025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343031">err</span>&nbsp;<span class="op" id="5343035">=</span>&nbsp;<span class="ident" id="5343037">io</span><span class="op" id="5343039">.</span><span class="ident" id="5343040">ErrUnexpectedEOF</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5343060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343065">d</span><span class="op" id="5343066">.</span><span class="ident" id="5343067">err</span>&nbsp;<span class="op" id="5343071">=</span>&nbsp;<span class="ident" id="5343073">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343080">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5343089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343093">switch</span>&nbsp;<span class="op" id="5343100">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343104">case</span>&nbsp;<span class="ident" id="5343109">code</span>&nbsp;<span class="op" id="5343114">&lt;</span>&nbsp;<span class="ident" id="5343116">d</span><span class="op" id="5343117">.</span><span class="ident" id="5343118">clear</span><span class="op" id="5343123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5343128">//&nbsp;We&nbsp;have&nbsp;a&nbsp;literal&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343158">d</span><span class="op" id="5343159">.</span><span class="ident" id="5343160">output</span><span class="op" id="5343166">[</span><span class="ident" id="5343167">d</span><span class="op" id="5343168">.</span><span class="ident" id="5343169">o</span><span class="op" id="5343170">]</span>&nbsp;<span class="op" id="5343172">=</span>&nbsp;<span class="builtintype" id="5343174">uint8</span><span class="op" id="5343179">(</span><span class="ident" id="5343180">code</span><span class="op" id="5343184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343189">d</span><span class="op" id="5343190">.</span><span class="ident" id="5343191">o</span><span class="op" id="5343192">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343198">if</span>&nbsp;<span class="ident" id="5343201">d</span><span class="op" id="5343202">.</span><span class="ident" id="5343203">last</span>&nbsp;<span class="op" id="5343208">!=</span>&nbsp;<span class="ident" id="5343211">decoderInvalidCode</span>&nbsp;<span class="op" id="5343230">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5343236">//&nbsp;Save&nbsp;what&nbsp;the&nbsp;hi&nbsp;code&nbsp;expands&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343277">d</span><span class="op" id="5343278">.</span><span class="ident" id="5343279">suffix</span><span class="op" id="5343285">[</span><span class="ident" id="5343286">d</span><span class="op" id="5343287">.</span><span class="ident" id="5343288">hi</span><span class="op" id="5343290">]</span>&nbsp;<span class="op" id="5343292">=</span>&nbsp;<span class="builtintype" id="5343294">uint8</span><span class="op" id="5343299">(</span><span class="ident" id="5343300">code</span><span class="op" id="5343304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343310">d</span><span class="op" id="5343311">.</span><span class="ident" id="5343312">prefix</span><span class="op" id="5343318">[</span><span class="ident" id="5343319">d</span><span class="op" id="5343320">.</span><span class="ident" id="5343321">hi</span><span class="op" id="5343323">]</span>&nbsp;<span class="op" id="5343325">=</span>&nbsp;<span class="ident" id="5343327">d</span><span class="op" id="5343328">.</span><span class="ident" id="5343329">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5343337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343341">case</span>&nbsp;<span class="ident" id="5343346">code</span>&nbsp;<span class="op" id="5343351">==</span>&nbsp;<span class="ident" id="5343354">d</span><span class="op" id="5343355">.</span><span class="ident" id="5343356">clear</span><span class="op" id="5343361">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343366">d</span><span class="op" id="5343367">.</span><span class="ident" id="5343368">width</span>&nbsp;<span class="op" id="5343374">=</span>&nbsp;<span class="num" id="5343376">1</span>&nbsp;<span class="op" id="5343378">+</span>&nbsp;<span class="builtintype" id="5343380">uint</span><span class="op" id="5343384">(</span><span class="ident" id="5343385">d</span><span class="op" id="5343386">.</span><span class="ident" id="5343387">litWidth</span><span class="op" id="5343395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343400">d</span><span class="op" id="5343401">.</span><span class="ident" id="5343402">hi</span>&nbsp;<span class="op" id="5343405">=</span>&nbsp;<span class="ident" id="5343407">d</span><span class="op" id="5343408">.</span><span class="ident" id="5343409">eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343416">d</span><span class="op" id="5343417">.</span><span class="ident" id="5343418">overflow</span>&nbsp;<span class="op" id="5343427">=</span>&nbsp;<span class="num" id="5343429">1</span>&nbsp;<span class="op" id="5343431">&lt;&lt;</span>&nbsp;<span class="ident" id="5343434">d</span><span class="op" id="5343435">.</span><span class="ident" id="5343436">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343445">d</span><span class="op" id="5343446">.</span><span class="ident" id="5343447">last</span>&nbsp;<span class="op" id="5343452">=</span>&nbsp;<span class="ident" id="5343454">decoderInvalidCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343476">continue</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343487">case</span>&nbsp;<span class="ident" id="5343492">code</span>&nbsp;<span class="op" id="5343497">==</span>&nbsp;<span class="ident" id="5343500">d</span><span class="op" id="5343501">.</span><span class="ident" id="5343502">eof</span><span class="op" id="5343505">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343510">d</span><span class="op" id="5343511">.</span><span class="ident" id="5343512">flush</span><span class="op" id="5343517">(</span><span class="op" id="5343518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343523">d</span><span class="op" id="5343524">.</span><span class="ident" id="5343525">err</span>&nbsp;<span class="op" id="5343529">=</span>&nbsp;<span class="ident" id="5343531">io</span><span class="op" id="5343533">.</span><span class="ident" id="5343534">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343541">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343550">case</span>&nbsp;<span class="ident" id="5343555">code</span>&nbsp;<span class="op" id="5343560">&lt;=</span>&nbsp;<span class="ident" id="5343563">d</span><span class="op" id="5343564">.</span><span class="ident" id="5343565">hi</span><span class="op" id="5343567">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343572">c</span><span class="op" id="5343573">,</span>&nbsp;<span class="ident" id="5343575">i</span>&nbsp;<span class="op" id="5343577">:=</span>&nbsp;<span class="ident" id="5343580">code</span><span class="op" id="5343584">,</span>&nbsp;<span class="builtinfunc" id="5343586">len</span><span class="op" id="5343589">(</span><span class="ident" id="5343590">d</span><span class="op" id="5343591">.</span><span class="ident" id="5343592">output</span><span class="op" id="5343598">)</span><span class="op" id="5343599">-</span><span class="num" id="5343600">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343605">if</span>&nbsp;<span class="ident" id="5343608">code</span>&nbsp;<span class="op" id="5343613">==</span>&nbsp;<span class="ident" id="5343616">d</span><span class="op" id="5343617">.</span><span class="ident" id="5343618">hi</span>&nbsp;<span class="op" id="5343621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5343627">//&nbsp;code&nbsp;==&nbsp;hi&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;which&nbsp;expands&nbsp;to&nbsp;the&nbsp;last&nbsp;expansion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5343699">//&nbsp;followed&nbsp;by&nbsp;the&nbsp;head&nbsp;of&nbsp;the&nbsp;last&nbsp;expansion.&nbsp;To&nbsp;find&nbsp;the&nbsp;head,&nbsp;we&nbsp;walk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5343776">//&nbsp;the&nbsp;prefix&nbsp;chain&nbsp;until&nbsp;we&nbsp;find&nbsp;a&nbsp;literal&nbsp;code.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343830">c</span>&nbsp;<span class="op" id="5343832">=</span>&nbsp;<span class="ident" id="5343834">d</span><span class="op" id="5343835">.</span><span class="ident" id="5343836">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5343845">for</span>&nbsp;<span class="ident" id="5343849">c</span>&nbsp;<span class="op" id="5343851">&gt;=</span>&nbsp;<span class="ident" id="5343854">d</span><span class="op" id="5343855">.</span><span class="ident" id="5343856">clear</span>&nbsp;<span class="op" id="5343862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343869">c</span>&nbsp;<span class="op" id="5343871">=</span>&nbsp;<span class="ident" id="5343873">d</span><span class="op" id="5343874">.</span><span class="ident" id="5343875">prefix</span><span class="op" id="5343881">[</span><span class="ident" id="5343882">c</span><span class="op" id="5343883">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5343889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343895">d</span><span class="op" id="5343896">.</span><span class="ident" id="5343897">output</span><span class="op" id="5343903">[</span><span class="ident" id="5343904">i</span><span class="op" id="5343905">]</span>&nbsp;<span class="op" id="5343907">=</span>&nbsp;<span class="builtintype" id="5343909">uint8</span><span class="op" id="5343914">(</span><span class="ident" id="5343915">c</span><span class="op" id="5343916">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343922">i</span><span class="op" id="5343923">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5343930">c</span>&nbsp;<span class="op" id="5343932">=</span>&nbsp;<span class="ident" id="5343934">d</span><span class="op" id="5343935">.</span><span class="ident" id="5343936">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5343944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5343949">//&nbsp;Copy&nbsp;the&nbsp;suffix&nbsp;chain&nbsp;into&nbsp;output&nbsp;and&nbsp;then&nbsp;write&nbsp;that&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5344015">for</span>&nbsp;<span class="ident" id="5344019">c</span>&nbsp;<span class="op" id="5344021">&gt;=</span>&nbsp;<span class="ident" id="5344024">d</span><span class="op" id="5344025">.</span><span class="ident" id="5344026">clear</span>&nbsp;<span class="op" id="5344032">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5344038">d</span><span class="op" id="5344039">.</span><span class="ident" id="5344040">output</span><span class="op" id="5344046">[</span><span class="ident" id="5344047">i</span><span class="op" id="5344048">]</span>&nbsp;<span class="op" id="5344050">=</span>&nbsp;<span class="ident" id="5344052">d</span><span class="op" id="5344053">.</span><span class="ident" id="5344054">suffix</span><span class="op" id="5344060">[</span><span class="ident" id="5344061">c</span><span class="op" id="5344062">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5344068">i</span><span class="op" id="5344069">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5344076">c</span>&nbsp;<span class="op" id="5344078">=</span>&nbsp;<span class="ident" id="5344080">d</span><span class="op" id="5344081">.</span><span class="ident" id="5344082">prefix</span><span class="op" id="5344088">[</span><span class="ident" id="5344089">c</span><span class="op" id="5344090">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5344095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5344100">d</span><span class="op" id="5344101">.</span><span class="ident" id="5344102">output</span><span class="op" id="5344108">[</span><span class="ident" id="5344109">i</span><span class="op" id="5344110">]</span>&nbsp;<span class="op" id="5344112">=</span>&nbsp;<span class="builtintype" id="5344114">uint8</span><span class="op" id="5344119">(</span><span class="ident" id="5344120">c</span><span class="op" id="5344121">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5344126">d</span><span class="op" id="5344127">.</span><span class="ident" id="5344128">o</span>&nbsp;<span class="op" id="5344130">+=</span>&nbsp;<span class="builtinfunc" id="5344133">copy</span><span class="op" id="5344137">(</span><span class="ident" id="5344138">d</span><span class="op" id="5344139">.</span><span class="ident" id="5344140">output</span><span class="op" id="5344146">[</span><span class="ident" id="5344147">d</span><span class="op" id="5344148">.</span><span class="ident" id="5344149">o</span><span class="op" id="5344150">:</span><span class="op" id="5344151">]</span><span class="op" id="5344152">,</span>&nbsp;<span class="ident" id="5344154">d</span><span class="op" id="5344155">.</span><span class="ident" id="5344156">output</span><span class="op" id="5344162">[</span><span class="ident" id="5344163">i</span><span class="op" id="5344164">:</span><span class="op" id="5344165">]</span><span class="op" id="5344166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5344171">if</span>&nbsp;<span class="ident" id="5344174">d</span><span class="op" id="5344175">.</span><span class="ident" id="5344176">last</span>&nbsp;<span class="op" id="5344181">!=</span>&nbsp;<span class="ident" id="5344184">decoderInvalidCode</span>&nbsp;<span class="op" id="5344203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5344209">//&nbsp;Save&nbsp;what&nbsp;the&nbsp;hi&nbsp;code&nbsp;expands&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5344250">d</span><span class="op" id="5344251">.</span><span class="ident" id="5344252">suffix</span><span class="op" id="5344258">[</span><span class="ident" id="5344259">d</span><span class="op" id="5344260">.</span><span class="ident" id="5344261">hi</span><span class="op" id="5344263">]</span>&nbsp;<span class="op" id="5344265">=</span>&nbsp;<span class="builtintype" id="5344267">uint8</span><span class="op" id="5344272">(</span><span class="ident" id="5344273">c</span><span class="op" id="5344274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5344280">d</span><span class="op" id="5344281">.</span><span class="ident" id="5344282">prefix</span><span class="op" id="5344288">[</span><span class="ident" id="5344289">d</span><span class="op" id="5344290">.</span><span class="ident" id="5344291">hi</span><span class="op" id="5344293">]</span>&nbsp;<span class="op" id="5344295">=</span>&nbsp;<span class="ident" id="5344297">d</span><span class="op" id="5344298">.</span><span class="ident" id="5344299">last</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5344307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5344311">default</span><span class="op" id="5344318">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5344323">d</span><span class="op" id="5344324">.</span><span class="ident" id="5344325">err</span>&nbsp;<span class="op" id="5344329">=</span>&nbsp;<span class="ident" id="5344331">errors</span><span class="op" id="5344337">.</span><span class="ident" id="5344338">New</span><span class="op" id="5344341">(</span><span class="string" id="5344342">&#34;lzw:&nbsp;invalid&nbsp;code&#34;</span><span class="op" id="5344361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5344366">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5344375">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5344379">d</span><span class="op" id="5344380">.</span><span class="ident" id="5344381">last</span><span class="op" id="5344385">,</span>&nbsp;<span class="ident" id="5344387">d</span><span class="op" id="5344388">.</span><span class="ident" id="5344389">hi</span>&nbsp;<span class="op" id="5344392">=</span>&nbsp;<span class="ident" id="5344394">code</span><span class="op" id="5344398">,</span>&nbsp;<span class="ident" id="5344400">d</span><span class="op" id="5344401">.</span><span class="ident" id="5344402">hi</span><span class="op" id="5344404">+</span><span class="num" id="5344405">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5344409">if</span>&nbsp;<span class="ident" id="5344412">d</span><span class="op" id="5344413">.</span><span class="ident" id="5344414">hi</span>&nbsp;<span class="op" id="5344417">&gt;=</span>&nbsp;<span class="ident" id="5344420">d</span><span class="op" id="5344421">.</span><span class="ident" id="5344422">overflow</span>&nbsp;<span class="op" id="5344431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5344436">if</span>&nbsp;<span class="ident" id="5344439">d</span><span class="op" id="5344440">.</span><span class="ident" id="5344441">width</span>&nbsp;<span class="op" id="5344447">==</span>&nbsp;<span class="ident" id="5344450">maxWidth</span>&nbsp;<span class="op" id="5344459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5344465">d</span><span class="op" id="5344466">.</span><span class="ident" id="5344467">last</span>&nbsp;<span class="op" id="5344472">=</span>&nbsp;<span class="ident" id="5344474">decoderInvalidCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5344496">}</span>&nbsp;<span class="keyword" id="5344498">else</span>&nbsp;<span class="op" id="5344503">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5344509">d</span><span class="op" id="5344510">.</span><span class="ident" id="5344511">width</span><span class="op" id="5344516">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5344523">d</span><span class="op" id="5344524">.</span><span class="ident" id="5344525">overflow</span>&nbsp;<span class="op" id="5344534">&lt;&lt;=</span>&nbsp;<span class="num" id="5344538">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5344543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5344547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5344551">if</span>&nbsp;<span class="ident" id="5344554">d</span><span class="op" id="5344555">.</span><span class="ident" id="5344556">o</span>&nbsp;<span class="op" id="5344558">&gt;=</span>&nbsp;<span class="ident" id="5344561">flushBuffer</span>&nbsp;<span class="op" id="5344573">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5344578">d</span><span class="op" id="5344579">.</span><span class="ident" id="5344580">flush</span><span class="op" id="5344585">(</span><span class="op" id="5344586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5344591">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5344600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5344603">}</span><br>
<span class="lineno"></span><span class="op" id="5344605">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="5344608">func</span>&nbsp;<span class="op" id="5344613">(</span><span class="ident" id="5344614">d</span>&nbsp;<span class="op" id="5344616">*</span><span class="ident" id="5344617">decoder</span><span class="op" id="5344624">)</span>&nbsp;<span class="ident" id="5344626">flush</span><span class="op" id="5344631">(</span><span class="op" id="5344632">)</span>&nbsp;<span class="op" id="5344634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5344637">d</span><span class="op" id="5344638">.</span><span class="ident" id="5344639">toRead</span>&nbsp;<span class="op" id="5344646">=</span>&nbsp;<span class="ident" id="5344648">d</span><span class="op" id="5344649">.</span><span class="ident" id="5344650">output</span><span class="op" id="5344656">[</span><span class="op" id="5344657">:</span><span class="ident" id="5344658">d</span><span class="op" id="5344659">.</span><span class="ident" id="5344660">o</span><span class="op" id="5344661">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5344664">d</span><span class="op" id="5344665">.</span><span class="ident" id="5344666">o</span>&nbsp;<span class="op" id="5344668">=</span>&nbsp;<span class="num" id="5344670">0</span><br>
<span class="lineno"></span><span class="op" id="5344672">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="5344675">var</span>&nbsp;<span class="ident" id="5344679">errClosed</span>&nbsp;<span class="op" id="5344689">=</span>&nbsp;<span class="ident" id="5344691">errors</span><span class="op" id="5344697">.</span><span class="ident" id="5344698">New</span><span class="op" id="5344701">(</span><span class="string" id="5344702">&#34;compress/lzw:&nbsp;reader/writer&nbsp;is&nbsp;closed&#34;</span><span class="op" id="5344741">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5344744">func</span>&nbsp;<span class="op" id="5344749">(</span><span class="ident" id="5344750">d</span>&nbsp;<span class="op" id="5344752">*</span><span class="ident" id="5344753">decoder</span><span class="op" id="5344760">)</span>&nbsp;<span class="ident" id="5344762">Close</span><span class="op" id="5344767">(</span><span class="op" id="5344768">)</span>&nbsp;<span class="builtintype" id="5344770">error</span>&nbsp;<span class="op" id="5344776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5344779">d</span><span class="op" id="5344780">.</span><span class="ident" id="5344781">err</span>&nbsp;<span class="op" id="5344785">=</span>&nbsp;<span class="ident" id="5344787">errClosed</span>&nbsp;<span class="comment" id="5344797">//&nbsp;in&nbsp;case&nbsp;any&nbsp;Reads&nbsp;come&nbsp;along</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5344830">return</span>&nbsp;<span class="ident" id="5344837">nil</span><br>
<span class="lineno"></span><span class="op" id="5344841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5344844">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;io.ReadCloser.</span><br>
<span class="lineno"></span><span class="comment" id="5344886">//&nbsp;Reads&nbsp;from&nbsp;the&nbsp;returned&nbsp;io.ReadCloser&nbsp;read&nbsp;and&nbsp;decompress&nbsp;data&nbsp;from&nbsp;r.</span><br>
<span class="lineno">225</span><span class="comment" id="5344960">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="5345007">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5345069">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;ReadCloser&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="5345143">//&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="5345164">//&nbsp;The&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;literal&nbsp;codes,&nbsp;litWidth,&nbsp;must&nbsp;be&nbsp;in&nbsp;the</span><br>
<span class="lineno">230</span><span class="comment" id="5345237">//&nbsp;range&nbsp;[2,8]&nbsp;and&nbsp;is&nbsp;typically&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="5345272">func</span>&nbsp;<span class="ident" id="5345277">NewReader</span><span class="op" id="5345286">(</span><span class="ident" id="5345287">r</span>&nbsp;<span class="ident" id="5345289">io</span><span class="op" id="5345291">.</span><span class="ident" id="5345292">Reader</span><span class="op" id="5345298">,</span>&nbsp;<span class="ident" id="5345300">order</span>&nbsp;<span class="ident" id="5345306">Order</span><span class="op" id="5345311">,</span>&nbsp;<span class="ident" id="5345313">litWidth</span>&nbsp;<span class="builtintype" id="5345322">int</span><span class="op" id="5345325">)</span>&nbsp;<span class="ident" id="5345327">io</span><span class="op" id="5345329">.</span><span class="ident" id="5345330">ReadCloser</span>&nbsp;<span class="op" id="5345341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5345344">d</span>&nbsp;<span class="op" id="5345346">:=</span>&nbsp;<span class="builtinfunc" id="5345349">new</span><span class="op" id="5345352">(</span><span class="ident" id="5345353">decoder</span><span class="op" id="5345360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5345363">switch</span>&nbsp;<span class="ident" id="5345370">order</span>&nbsp;<span class="op" id="5345376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5345379">case</span>&nbsp;<span class="ident" id="5345384">LSB</span><span class="op" id="5345387">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5345391">d</span><span class="op" id="5345392">.</span><span class="ident" id="5345393">read</span>&nbsp;<span class="op" id="5345398">=</span>&nbsp;<span class="op" id="5345400">(</span><span class="op" id="5345401">*</span><span class="ident" id="5345402">decoder</span><span class="op" id="5345409">)</span><span class="op" id="5345410">.</span><span class="ident" id="5345411">readLSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5345420">case</span>&nbsp;<span class="ident" id="5345425">MSB</span><span class="op" id="5345428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5345432">d</span><span class="op" id="5345433">.</span><span class="ident" id="5345434">read</span>&nbsp;<span class="op" id="5345439">=</span>&nbsp;<span class="op" id="5345441">(</span><span class="op" id="5345442">*</span><span class="ident" id="5345443">decoder</span><span class="op" id="5345450">)</span><span class="op" id="5345451">.</span><span class="ident" id="5345452">readMSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5345461">default</span><span class="op" id="5345468">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5345472">d</span><span class="op" id="5345473">.</span><span class="ident" id="5345474">err</span>&nbsp;<span class="op" id="5345478">=</span>&nbsp;<span class="ident" id="5345480">errors</span><span class="op" id="5345486">.</span><span class="ident" id="5345487">New</span><span class="op" id="5345490">(</span><span class="string" id="5345491">&#34;lzw:&nbsp;unknown&nbsp;order&#34;</span><span class="op" id="5345511">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5345515">return</span>&nbsp;<span class="ident" id="5345522">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5345525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5345528">if</span>&nbsp;<span class="ident" id="5345531">litWidth</span>&nbsp;<span class="op" id="5345540">&lt;</span>&nbsp;<span class="num" id="5345542">2</span>&nbsp;<span class="op" id="5345544">||</span>&nbsp;<span class="num" id="5345547">8</span>&nbsp;<span class="op" id="5345549">&lt;</span>&nbsp;<span class="ident" id="5345551">litWidth</span>&nbsp;<span class="op" id="5345560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5345564">d</span><span class="op" id="5345565">.</span><span class="ident" id="5345566">err</span>&nbsp;<span class="op" id="5345570">=</span>&nbsp;<span class="ident" id="5345572">fmt</span><span class="op" id="5345575">.</span><span class="ident" id="5345576">Errorf</span><span class="op" id="5345582">(</span><span class="string" id="5345583">&#34;lzw:&nbsp;litWidth&nbsp;%d&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="5345614">,</span>&nbsp;<span class="ident" id="5345616">litWidth</span><span class="op" id="5345624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5345628">return</span>&nbsp;<span class="ident" id="5345635">d</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5345638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5345641">if</span>&nbsp;<span class="ident" id="5345644">br</span><span class="op" id="5345646">,</span>&nbsp;<span class="ident" id="5345648">ok</span>&nbsp;<span class="op" id="5345651">:=</span>&nbsp;<span class="ident" id="5345654">r</span><span class="op" id="5345655">.</span><span class="op" id="5345656">(</span><span class="ident" id="5345657">io</span><span class="op" id="5345659">.</span><span class="ident" id="5345660">ByteReader</span><span class="op" id="5345670">)</span><span class="op" id="5345671">;</span>&nbsp;<span class="ident" id="5345673">ok</span>&nbsp;<span class="op" id="5345676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5345680">d</span><span class="op" id="5345681">.</span><span class="ident" id="5345682">r</span>&nbsp;<span class="op" id="5345684">=</span>&nbsp;<span class="ident" id="5345686">br</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5345690">}</span>&nbsp;<span class="keyword" id="5345692">else</span>&nbsp;<span class="op" id="5345697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5345701">d</span><span class="op" id="5345702">.</span><span class="ident" id="5345703">r</span>&nbsp;<span class="op" id="5345705">=</span>&nbsp;<span class="ident" id="5345707">bufio</span><span class="op" id="5345712">.</span><span class="ident" id="5345713">NewReader</span><span class="op" id="5345722">(</span><span class="ident" id="5345723">r</span><span class="op" id="5345724">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5345727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5345730">d</span><span class="op" id="5345731">.</span><span class="ident" id="5345732">litWidth</span>&nbsp;<span class="op" id="5345741">=</span>&nbsp;<span class="ident" id="5345743">litWidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5345753">d</span><span class="op" id="5345754">.</span><span class="ident" id="5345755">width</span>&nbsp;<span class="op" id="5345761">=</span>&nbsp;<span class="num" id="5345763">1</span>&nbsp;<span class="op" id="5345765">+</span>&nbsp;<span class="builtintype" id="5345767">uint</span><span class="op" id="5345771">(</span><span class="ident" id="5345772">litWidth</span><span class="op" id="5345780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5345783">d</span><span class="op" id="5345784">.</span><span class="ident" id="5345785">clear</span>&nbsp;<span class="op" id="5345791">=</span>&nbsp;<span class="builtintype" id="5345793">uint16</span><span class="op" id="5345799">(</span><span class="num" id="5345800">1</span><span class="op" id="5345801">)</span>&nbsp;<span class="op" id="5345803">&lt;&lt;</span>&nbsp;<span class="builtintype" id="5345806">uint</span><span class="op" id="5345810">(</span><span class="ident" id="5345811">litWidth</span><span class="op" id="5345819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5345822">d</span><span class="op" id="5345823">.</span><span class="ident" id="5345824">eof</span><span class="op" id="5345827">,</span>&nbsp;<span class="ident" id="5345829">d</span><span class="op" id="5345830">.</span><span class="ident" id="5345831">hi</span>&nbsp;<span class="op" id="5345834">=</span>&nbsp;<span class="ident" id="5345836">d</span><span class="op" id="5345837">.</span><span class="ident" id="5345838">clear</span><span class="op" id="5345843">+</span><span class="num" id="5345844">1</span><span class="op" id="5345845">,</span>&nbsp;<span class="ident" id="5345847">d</span><span class="op" id="5345848">.</span><span class="ident" id="5345849">clear</span><span class="op" id="5345854">+</span><span class="num" id="5345855">1</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5345858">d</span><span class="op" id="5345859">.</span><span class="ident" id="5345860">overflow</span>&nbsp;<span class="op" id="5345869">=</span>&nbsp;<span class="builtintype" id="5345871">uint16</span><span class="op" id="5345877">(</span><span class="num" id="5345878">1</span><span class="op" id="5345879">)</span>&nbsp;<span class="op" id="5345881">&lt;&lt;</span>&nbsp;<span class="ident" id="5345884">d</span><span class="op" id="5345885">.</span><span class="ident" id="5345886">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5345893">d</span><span class="op" id="5345894">.</span><span class="ident" id="5345895">last</span>&nbsp;<span class="op" id="5345900">=</span>&nbsp;<span class="ident" id="5345902">decoderInvalidCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5345923">return</span>&nbsp;<span class="ident" id="5345930">d</span><br>
<span class="lineno"></span><span class="op" id="5345932">}</span>
</div>
</body>
</html>
