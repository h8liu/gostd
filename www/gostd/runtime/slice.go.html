<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1702977">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1703032">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1703086">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1703137">package</span>&nbsp;<span class="ident" id="1703145">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1703154">import</span>&nbsp;<span class="op" id="1703161">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1703164">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1703173">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1703176">type</span>&nbsp;<span class="ident" id="1703181">sliceStruct</span>&nbsp;<span class="keyword" id="1703193">struct</span>&nbsp;<span class="op" id="1703200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703203">array</span>&nbsp;<span class="ident" id="1703209">unsafe</span><span class="op" id="1703215">.</span><span class="ident" id="1703216">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1703225">len</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1703231">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1703236">cap</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1703242">int</span><br>
<span class="lineno">15</span><span class="op" id="1703246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1703249">//&nbsp;TODO:&nbsp;take&nbsp;uintptrs&nbsp;instead&nbsp;of&nbsp;int64s?</span><br>
<span class="lineno"></span><span class="keyword" id="1703291">func</span>&nbsp;<span class="ident" id="1703296">makeslice</span><span class="op" id="1703305">(</span><span class="ident" id="1703306">t</span>&nbsp;<span class="op" id="1703308">*</span><span class="ident" id="1703309">slicetype</span><span class="op" id="1703318">,</span>&nbsp;<span class="ident" id="1703320">len64</span>&nbsp;<span class="ident" id="1703326">int64</span><span class="op" id="1703331">,</span>&nbsp;<span class="ident" id="1703333">cap64</span>&nbsp;<span class="ident" id="1703339">int64</span><span class="op" id="1703344">)</span>&nbsp;<span class="ident" id="1703346">sliceStruct</span>&nbsp;<span class="op" id="1703358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1703361">//&nbsp;NOTE:&nbsp;The&nbsp;len&nbsp;&gt;&nbsp;MaxMem/elemsize&nbsp;check&nbsp;here&nbsp;is&nbsp;not&nbsp;strictly&nbsp;necessary,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1703435">//&nbsp;but&nbsp;it&nbsp;produces&nbsp;a&nbsp;&#39;len&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error&nbsp;instead&nbsp;of&nbsp;a&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1703520">//&nbsp;when&nbsp;someone&nbsp;does&nbsp;make([]T,&nbsp;bignumber).&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;is&nbsp;true&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1703596">//&nbsp;but&nbsp;since&nbsp;the&nbsp;cap&nbsp;is&nbsp;only&nbsp;being&nbsp;supplied&nbsp;implicitly,&nbsp;saying&nbsp;len&nbsp;is&nbsp;clearer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1703676">//&nbsp;See&nbsp;issue&nbsp;4085.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1703696">len</span>&nbsp;<span class="op" id="1703700">:=</span>&nbsp;<span class="builtintype" id="1703703">int</span><span class="op" id="1703706">(</span><span class="ident" id="1703707">len64</span><span class="op" id="1703712">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1703715">if</span>&nbsp;<span class="ident" id="1703718">len64</span>&nbsp;<span class="op" id="1703724">&lt;</span>&nbsp;<span class="num" id="1703726">0</span>&nbsp;<span class="op" id="1703728">||</span>&nbsp;<span class="ident" id="1703731">int64</span><span class="op" id="1703736">(</span><span class="builtinfunc" id="1703737">len</span><span class="op" id="1703740">)</span>&nbsp;<span class="op" id="1703742">!=</span>&nbsp;<span class="ident" id="1703745">len64</span>&nbsp;<span class="op" id="1703751">||</span>&nbsp;<span class="ident" id="1703754">t</span><span class="op" id="1703755">.</span><span class="ident" id="1703756">elem</span><span class="op" id="1703760">.</span><span class="ident" id="1703761">size</span>&nbsp;<span class="op" id="1703766">&gt;</span>&nbsp;<span class="num" id="1703768">0</span>&nbsp;<span class="op" id="1703770">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1703773">uintptr</span><span class="op" id="1703780">(</span><span class="builtinfunc" id="1703781">len</span><span class="op" id="1703784">)</span>&nbsp;<span class="op" id="1703786">&gt;</span>&nbsp;<span class="ident" id="1703788">maxmem</span><span class="op" id="1703794">/</span><span class="builtintype" id="1703795">uintptr</span><span class="op" id="1703802">(</span><span class="ident" id="1703803">t</span><span class="op" id="1703804">.</span><span class="ident" id="1703805">elem</span><span class="op" id="1703809">.</span><span class="ident" id="1703810">size</span><span class="op" id="1703814">)</span>&nbsp;<span class="op" id="1703816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1703820">panic</span><span class="op" id="1703825">(</span><span class="ident" id="1703826">errorString</span><span class="op" id="1703837">(</span><span class="string" id="1703838">&#34;makeslice:&nbsp;len&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1703867">)</span><span class="op" id="1703868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1703871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1703874">cap</span>&nbsp;<span class="op" id="1703878">:=</span>&nbsp;<span class="builtintype" id="1703881">int</span><span class="op" id="1703884">(</span><span class="ident" id="1703885">cap64</span><span class="op" id="1703890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1703893">if</span>&nbsp;<span class="builtinfunc" id="1703896">cap</span>&nbsp;<span class="op" id="1703900">&lt;</span>&nbsp;<span class="builtinfunc" id="1703902">len</span>&nbsp;<span class="op" id="1703906">||</span>&nbsp;<span class="ident" id="1703909">int64</span><span class="op" id="1703914">(</span><span class="builtinfunc" id="1703915">cap</span><span class="op" id="1703918">)</span>&nbsp;<span class="op" id="1703920">!=</span>&nbsp;<span class="ident" id="1703923">cap64</span>&nbsp;<span class="op" id="1703929">||</span>&nbsp;<span class="ident" id="1703932">t</span><span class="op" id="1703933">.</span><span class="ident" id="1703934">elem</span><span class="op" id="1703938">.</span><span class="ident" id="1703939">size</span>&nbsp;<span class="op" id="1703944">&gt;</span>&nbsp;<span class="num" id="1703946">0</span>&nbsp;<span class="op" id="1703948">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1703951">uintptr</span><span class="op" id="1703958">(</span><span class="builtinfunc" id="1703959">cap</span><span class="op" id="1703962">)</span>&nbsp;<span class="op" id="1703964">&gt;</span>&nbsp;<span class="ident" id="1703966">maxmem</span><span class="op" id="1703972">/</span><span class="builtintype" id="1703973">uintptr</span><span class="op" id="1703980">(</span><span class="ident" id="1703981">t</span><span class="op" id="1703982">.</span><span class="ident" id="1703983">elem</span><span class="op" id="1703987">.</span><span class="ident" id="1703988">size</span><span class="op" id="1703992">)</span>&nbsp;<span class="op" id="1703994">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1703998">panic</span><span class="op" id="1704003">(</span><span class="ident" id="1704004">errorString</span><span class="op" id="1704015">(</span><span class="string" id="1704016">&#34;makeslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1704045">)</span><span class="op" id="1704046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1704049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704052">p</span>&nbsp;<span class="op" id="1704054">:=</span>&nbsp;<span class="ident" id="1704057">newarray</span><span class="op" id="1704065">(</span><span class="ident" id="1704066">t</span><span class="op" id="1704067">.</span><span class="ident" id="1704068">elem</span><span class="op" id="1704072">,</span>&nbsp;<span class="builtintype" id="1704074">uintptr</span><span class="op" id="1704081">(</span><span class="builtinfunc" id="1704082">cap</span><span class="op" id="1704085">)</span><span class="op" id="1704086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704089">return</span>&nbsp;<span class="ident" id="1704096">sliceStruct</span><span class="op" id="1704107">{</span><span class="ident" id="1704108">p</span><span class="op" id="1704109">,</span>&nbsp;<span class="builtinfunc" id="1704111">len</span><span class="op" id="1704114">,</span>&nbsp;<span class="builtinfunc" id="1704116">cap</span><span class="op" id="1704119">}</span><br>
<span class="lineno"></span><span class="op" id="1704121">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1704124">//&nbsp;TODO:&nbsp;take&nbsp;uintptr&nbsp;instead&nbsp;of&nbsp;int64?</span><br>
<span class="lineno"></span><span class="keyword" id="1704164">func</span>&nbsp;<span class="ident" id="1704169">growslice</span><span class="op" id="1704178">(</span><span class="ident" id="1704179">t</span>&nbsp;<span class="op" id="1704181">*</span><span class="ident" id="1704182">slicetype</span><span class="op" id="1704191">,</span>&nbsp;<span class="ident" id="1704193">old</span>&nbsp;<span class="ident" id="1704197">sliceStruct</span><span class="op" id="1704208">,</span>&nbsp;<span class="ident" id="1704210">n</span>&nbsp;<span class="ident" id="1704212">int64</span><span class="op" id="1704217">)</span>&nbsp;<span class="ident" id="1704219">sliceStruct</span>&nbsp;<span class="op" id="1704231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704234">if</span>&nbsp;<span class="ident" id="1704237">n</span>&nbsp;<span class="op" id="1704239">&lt;</span>&nbsp;<span class="num" id="1704241">1</span>&nbsp;<span class="op" id="1704243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1704247">panic</span><span class="op" id="1704252">(</span><span class="ident" id="1704253">errorString</span><span class="op" id="1704264">(</span><span class="string" id="1704265">&#34;growslice:&nbsp;invalid&nbsp;n&#34;</span><span class="op" id="1704287">)</span><span class="op" id="1704288">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1704291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704295">cap64</span>&nbsp;<span class="op" id="1704301">:=</span>&nbsp;<span class="ident" id="1704304">int64</span><span class="op" id="1704309">(</span><span class="ident" id="1704310">old</span><span class="op" id="1704313">.</span><span class="builtinfunc" id="1704314">cap</span><span class="op" id="1704317">)</span>&nbsp;<span class="op" id="1704319">+</span>&nbsp;<span class="ident" id="1704321">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1704324">cap</span>&nbsp;<span class="op" id="1704328">:=</span>&nbsp;<span class="builtintype" id="1704331">int</span><span class="op" id="1704334">(</span><span class="ident" id="1704335">cap64</span><span class="op" id="1704340">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704344">if</span>&nbsp;<span class="ident" id="1704347">int64</span><span class="op" id="1704352">(</span><span class="builtinfunc" id="1704353">cap</span><span class="op" id="1704356">)</span>&nbsp;<span class="op" id="1704358">!=</span>&nbsp;<span class="ident" id="1704361">cap64</span>&nbsp;<span class="op" id="1704367">||</span>&nbsp;<span class="builtinfunc" id="1704370">cap</span>&nbsp;<span class="op" id="1704374">&lt;</span>&nbsp;<span class="ident" id="1704376">old</span><span class="op" id="1704379">.</span><span class="builtinfunc" id="1704380">cap</span>&nbsp;<span class="op" id="1704384">||</span>&nbsp;<span class="ident" id="1704387">t</span><span class="op" id="1704388">.</span><span class="ident" id="1704389">elem</span><span class="op" id="1704393">.</span><span class="ident" id="1704394">size</span>&nbsp;<span class="op" id="1704399">&gt;</span>&nbsp;<span class="num" id="1704401">0</span>&nbsp;<span class="op" id="1704403">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1704406">uintptr</span><span class="op" id="1704413">(</span><span class="builtinfunc" id="1704414">cap</span><span class="op" id="1704417">)</span>&nbsp;<span class="op" id="1704419">&gt;</span>&nbsp;<span class="ident" id="1704421">maxmem</span><span class="op" id="1704427">/</span><span class="builtintype" id="1704428">uintptr</span><span class="op" id="1704435">(</span><span class="ident" id="1704436">t</span><span class="op" id="1704437">.</span><span class="ident" id="1704438">elem</span><span class="op" id="1704442">.</span><span class="ident" id="1704443">size</span><span class="op" id="1704447">)</span>&nbsp;<span class="op" id="1704449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1704453">panic</span><span class="op" id="1704458">(</span><span class="ident" id="1704459">errorString</span><span class="op" id="1704470">(</span><span class="string" id="1704471">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1704500">)</span><span class="op" id="1704501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1704504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704508">if</span>&nbsp;<span class="ident" id="1704511">raceenabled</span>&nbsp;<span class="op" id="1704523">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704527">callerpc</span>&nbsp;<span class="op" id="1704536">:=</span>&nbsp;<span class="ident" id="1704539">getcallerpc</span><span class="op" id="1704550">(</span><span class="ident" id="1704551">unsafe</span><span class="op" id="1704557">.</span><span class="ident" id="1704558">Pointer</span><span class="op" id="1704565">(</span><span class="op" id="1704566">&amp;</span><span class="ident" id="1704567">t</span><span class="op" id="1704568">)</span><span class="op" id="1704569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704573">racereadrangepc</span><span class="op" id="1704588">(</span><span class="ident" id="1704589">old</span><span class="op" id="1704592">.</span><span class="ident" id="1704593">array</span><span class="op" id="1704598">,</span>&nbsp;<span class="builtintype" id="1704600">uintptr</span><span class="op" id="1704607">(</span><span class="ident" id="1704608">old</span><span class="op" id="1704611">.</span><span class="builtinfunc" id="1704612">len</span><span class="op" id="1704615">*</span><span class="builtintype" id="1704616">int</span><span class="op" id="1704619">(</span><span class="ident" id="1704620">t</span><span class="op" id="1704621">.</span><span class="ident" id="1704622">elem</span><span class="op" id="1704626">.</span><span class="ident" id="1704627">size</span><span class="op" id="1704631">)</span><span class="op" id="1704632">)</span><span class="op" id="1704633">,</span>&nbsp;<span class="ident" id="1704635">callerpc</span><span class="op" id="1704643">,</span>&nbsp;<span class="ident" id="1704645">funcPC</span><span class="op" id="1704651">(</span><span class="ident" id="1704652">growslice</span><span class="op" id="1704661">)</span><span class="op" id="1704662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1704665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704669">et</span>&nbsp;<span class="op" id="1704672">:=</span>&nbsp;<span class="ident" id="1704675">t</span><span class="op" id="1704676">.</span><span class="ident" id="1704677">elem</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704683">if</span>&nbsp;<span class="ident" id="1704686">et</span><span class="op" id="1704688">.</span><span class="ident" id="1704689">size</span>&nbsp;<span class="op" id="1704694">==</span>&nbsp;<span class="num" id="1704697">0</span>&nbsp;<span class="op" id="1704699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704703">return</span>&nbsp;<span class="ident" id="1704710">sliceStruct</span><span class="op" id="1704721">{</span><span class="ident" id="1704722">old</span><span class="op" id="1704725">.</span><span class="ident" id="1704726">array</span><span class="op" id="1704731">,</span>&nbsp;<span class="ident" id="1704733">old</span><span class="op" id="1704736">.</span><span class="builtinfunc" id="1704737">len</span><span class="op" id="1704740">,</span>&nbsp;<span class="builtinfunc" id="1704742">cap</span><span class="op" id="1704745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1704748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704752">newcap</span>&nbsp;<span class="op" id="1704759">:=</span>&nbsp;<span class="ident" id="1704762">old</span><span class="op" id="1704765">.</span><span class="builtinfunc" id="1704766">cap</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704771">if</span>&nbsp;<span class="ident" id="1704774">newcap</span><span class="op" id="1704780">+</span><span class="ident" id="1704781">newcap</span>&nbsp;<span class="op" id="1704788">&lt;</span>&nbsp;<span class="builtinfunc" id="1704790">cap</span>&nbsp;<span class="op" id="1704794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704798">newcap</span>&nbsp;<span class="op" id="1704805">=</span>&nbsp;<span class="builtinfunc" id="1704807">cap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1704812">}</span>&nbsp;<span class="keyword" id="1704814">else</span>&nbsp;<span class="op" id="1704819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704823">for</span>&nbsp;<span class="op" id="1704827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704832">if</span>&nbsp;<span class="ident" id="1704835">old</span><span class="op" id="1704838">.</span><span class="builtinfunc" id="1704839">len</span>&nbsp;<span class="op" id="1704843">&lt;</span>&nbsp;<span class="num" id="1704845">1024</span>&nbsp;<span class="op" id="1704850">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704856">newcap</span>&nbsp;<span class="op" id="1704863">+=</span>&nbsp;<span class="ident" id="1704866">newcap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1704876">}</span>&nbsp;<span class="keyword" id="1704878">else</span>&nbsp;<span class="op" id="1704883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704889">newcap</span>&nbsp;<span class="op" id="1704896">+=</span>&nbsp;<span class="ident" id="1704899">newcap</span>&nbsp;<span class="op" id="1704906">/</span>&nbsp;<span class="num" id="1704908">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1704913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704918">if</span>&nbsp;<span class="ident" id="1704921">newcap</span>&nbsp;<span class="op" id="1704928">&gt;=</span>&nbsp;<span class="builtinfunc" id="1704931">cap</span>&nbsp;<span class="op" id="1704935">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704941">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1704950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1704954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1704957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704961">if</span>&nbsp;<span class="builtintype" id="1704964">uintptr</span><span class="op" id="1704971">(</span><span class="ident" id="1704972">newcap</span><span class="op" id="1704978">)</span>&nbsp;<span class="op" id="1704980">&gt;=</span>&nbsp;<span class="ident" id="1704983">maxmem</span><span class="op" id="1704989">/</span><span class="builtintype" id="1704990">uintptr</span><span class="op" id="1704997">(</span><span class="ident" id="1704998">et</span><span class="op" id="1705000">.</span><span class="ident" id="1705001">size</span><span class="op" id="1705005">)</span>&nbsp;<span class="op" id="1705007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1705011">panic</span><span class="op" id="1705016">(</span><span class="ident" id="1705017">errorString</span><span class="op" id="1705028">(</span><span class="string" id="1705029">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1705058">)</span><span class="op" id="1705059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1705062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705065">lenmem</span>&nbsp;<span class="op" id="1705072">:=</span>&nbsp;<span class="builtintype" id="1705075">uintptr</span><span class="op" id="1705082">(</span><span class="ident" id="1705083">old</span><span class="op" id="1705086">.</span><span class="builtinfunc" id="1705087">len</span><span class="op" id="1705090">)</span>&nbsp;<span class="op" id="1705092">*</span>&nbsp;<span class="builtintype" id="1705094">uintptr</span><span class="op" id="1705101">(</span><span class="ident" id="1705102">et</span><span class="op" id="1705104">.</span><span class="ident" id="1705105">size</span><span class="op" id="1705109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705112">capmem</span>&nbsp;<span class="op" id="1705119">:=</span>&nbsp;<span class="ident" id="1705122">goroundupsize</span><span class="op" id="1705135">(</span><span class="builtintype" id="1705136">uintptr</span><span class="op" id="1705143">(</span><span class="ident" id="1705144">newcap</span><span class="op" id="1705150">)</span>&nbsp;<span class="op" id="1705152">*</span>&nbsp;<span class="builtintype" id="1705154">uintptr</span><span class="op" id="1705161">(</span><span class="ident" id="1705162">et</span><span class="op" id="1705164">.</span><span class="ident" id="1705165">size</span><span class="op" id="1705169">)</span><span class="op" id="1705170">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705173">newcap</span>&nbsp;<span class="op" id="1705180">=</span>&nbsp;<span class="builtintype" id="1705182">int</span><span class="op" id="1705185">(</span><span class="ident" id="1705186">capmem</span>&nbsp;<span class="op" id="1705193">/</span>&nbsp;<span class="builtintype" id="1705195">uintptr</span><span class="op" id="1705202">(</span><span class="ident" id="1705203">et</span><span class="op" id="1705205">.</span><span class="ident" id="1705206">size</span><span class="op" id="1705210">)</span><span class="op" id="1705211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1705214">var</span>&nbsp;<span class="ident" id="1705218">p</span>&nbsp;<span class="ident" id="1705220">unsafe</span><span class="op" id="1705226">.</span><span class="ident" id="1705227">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1705236">if</span>&nbsp;<span class="ident" id="1705239">et</span><span class="op" id="1705241">.</span><span class="ident" id="1705242">kind</span><span class="op" id="1705246">&amp;</span><span class="ident" id="1705247">kindNoPointers</span>&nbsp;<span class="op" id="1705262">!=</span>&nbsp;<span class="num" id="1705265">0</span>&nbsp;<span class="op" id="1705267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705271">p</span>&nbsp;<span class="op" id="1705273">=</span>&nbsp;<span class="ident" id="1705275">rawmem</span><span class="op" id="1705281">(</span><span class="ident" id="1705282">capmem</span><span class="op" id="1705288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705292">memclr</span><span class="op" id="1705298">(</span><span class="ident" id="1705299">add</span><span class="op" id="1705302">(</span><span class="ident" id="1705303">p</span><span class="op" id="1705304">,</span>&nbsp;<span class="ident" id="1705306">lenmem</span><span class="op" id="1705312">)</span><span class="op" id="1705313">,</span>&nbsp;<span class="ident" id="1705315">capmem</span><span class="op" id="1705321">-</span><span class="ident" id="1705322">lenmem</span><span class="op" id="1705328">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1705331">}</span>&nbsp;<span class="keyword" id="1705333">else</span>&nbsp;<span class="op" id="1705338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1705342">//&nbsp;Note:&nbsp;can&#39;t&nbsp;use&nbsp;rawmem&nbsp;(which&nbsp;avoids&nbsp;zeroing&nbsp;of&nbsp;memory),&nbsp;because&nbsp;then&nbsp;GC&nbsp;can&nbsp;scan&nbsp;unitialized&nbsp;memory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705448">p</span>&nbsp;<span class="op" id="1705450">=</span>&nbsp;<span class="ident" id="1705452">newarray</span><span class="op" id="1705460">(</span><span class="ident" id="1705461">et</span><span class="op" id="1705463">,</span>&nbsp;<span class="builtintype" id="1705465">uintptr</span><span class="op" id="1705472">(</span><span class="ident" id="1705473">newcap</span><span class="op" id="1705479">)</span><span class="op" id="1705480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1705483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705486">memmove</span><span class="op" id="1705493">(</span><span class="ident" id="1705494">p</span><span class="op" id="1705495">,</span>&nbsp;<span class="ident" id="1705497">old</span><span class="op" id="1705500">.</span><span class="ident" id="1705501">array</span><span class="op" id="1705506">,</span>&nbsp;<span class="ident" id="1705508">lenmem</span><span class="op" id="1705514">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1705518">return</span>&nbsp;<span class="ident" id="1705525">sliceStruct</span><span class="op" id="1705536">{</span><span class="ident" id="1705537">p</span><span class="op" id="1705538">,</span>&nbsp;<span class="ident" id="1705540">old</span><span class="op" id="1705543">.</span><span class="builtinfunc" id="1705544">len</span><span class="op" id="1705547">,</span>&nbsp;<span class="ident" id="1705549">newcap</span><span class="op" id="1705555">}</span><br>
<span class="lineno"></span><span class="op" id="1705557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1705560">func</span>&nbsp;<span class="ident" id="1705565">slicecopy</span><span class="op" id="1705574">(</span><span class="ident" id="1705575">to</span>&nbsp;<span class="ident" id="1705578">sliceStruct</span><span class="op" id="1705589">,</span>&nbsp;<span class="ident" id="1705591">fm</span>&nbsp;<span class="ident" id="1705594">sliceStruct</span><span class="op" id="1705605">,</span>&nbsp;<span class="ident" id="1705607">width</span>&nbsp;<span class="builtintype" id="1705613">uintptr</span><span class="op" id="1705620">)</span>&nbsp;<span class="builtintype" id="1705622">int</span>&nbsp;<span class="op" id="1705626">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1705629">if</span>&nbsp;<span class="ident" id="1705632">fm</span><span class="op" id="1705634">.</span><span class="builtinfunc" id="1705635">len</span>&nbsp;<span class="op" id="1705639">==</span>&nbsp;<span class="num" id="1705642">0</span>&nbsp;<span class="op" id="1705644">||</span>&nbsp;<span class="ident" id="1705647">to</span><span class="op" id="1705649">.</span><span class="builtinfunc" id="1705650">len</span>&nbsp;<span class="op" id="1705654">==</span>&nbsp;<span class="num" id="1705657">0</span>&nbsp;<span class="op" id="1705659">||</span>&nbsp;<span class="ident" id="1705662">width</span>&nbsp;<span class="op" id="1705668">==</span>&nbsp;<span class="num" id="1705671">0</span>&nbsp;<span class="op" id="1705673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1705677">return</span>&nbsp;<span class="num" id="1705684">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1705687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705691">n</span>&nbsp;<span class="op" id="1705693">:=</span>&nbsp;<span class="ident" id="1705696">fm</span><span class="op" id="1705698">.</span><span class="builtinfunc" id="1705699">len</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1705704">if</span>&nbsp;<span class="ident" id="1705707">to</span><span class="op" id="1705709">.</span><span class="builtinfunc" id="1705710">len</span>&nbsp;<span class="op" id="1705714">&lt;</span>&nbsp;<span class="ident" id="1705716">n</span>&nbsp;<span class="op" id="1705718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705722">n</span>&nbsp;<span class="op" id="1705724">=</span>&nbsp;<span class="ident" id="1705726">to</span><span class="op" id="1705728">.</span><span class="builtinfunc" id="1705729">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1705734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1705738">if</span>&nbsp;<span class="ident" id="1705741">raceenabled</span>&nbsp;<span class="op" id="1705753">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705757">callerpc</span>&nbsp;<span class="op" id="1705766">:=</span>&nbsp;<span class="ident" id="1705769">getcallerpc</span><span class="op" id="1705780">(</span><span class="ident" id="1705781">unsafe</span><span class="op" id="1705787">.</span><span class="ident" id="1705788">Pointer</span><span class="op" id="1705795">(</span><span class="op" id="1705796">&amp;</span><span class="ident" id="1705797">to</span><span class="op" id="1705799">)</span><span class="op" id="1705800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705804">pc</span>&nbsp;<span class="op" id="1705807">:=</span>&nbsp;<span class="ident" id="1705810">funcPC</span><span class="op" id="1705816">(</span><span class="ident" id="1705817">slicecopy</span><span class="op" id="1705826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705830">racewriterangepc</span><span class="op" id="1705846">(</span><span class="ident" id="1705847">to</span><span class="op" id="1705849">.</span><span class="ident" id="1705850">array</span><span class="op" id="1705855">,</span>&nbsp;<span class="builtintype" id="1705857">uintptr</span><span class="op" id="1705864">(</span><span class="ident" id="1705865">n</span><span class="op" id="1705866">*</span><span class="builtintype" id="1705867">int</span><span class="op" id="1705870">(</span><span class="ident" id="1705871">width</span><span class="op" id="1705876">)</span><span class="op" id="1705877">)</span><span class="op" id="1705878">,</span>&nbsp;<span class="ident" id="1705880">callerpc</span><span class="op" id="1705888">,</span>&nbsp;<span class="ident" id="1705890">pc</span><span class="op" id="1705892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705896">racereadrangepc</span><span class="op" id="1705911">(</span><span class="ident" id="1705912">fm</span><span class="op" id="1705914">.</span><span class="ident" id="1705915">array</span><span class="op" id="1705920">,</span>&nbsp;<span class="builtintype" id="1705922">uintptr</span><span class="op" id="1705929">(</span><span class="ident" id="1705930">n</span><span class="op" id="1705931">*</span><span class="builtintype" id="1705932">int</span><span class="op" id="1705935">(</span><span class="ident" id="1705936">width</span><span class="op" id="1705941">)</span><span class="op" id="1705942">)</span><span class="op" id="1705943">,</span>&nbsp;<span class="ident" id="1705945">callerpc</span><span class="op" id="1705953">,</span>&nbsp;<span class="ident" id="1705955">pc</span><span class="op" id="1705957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1705960">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1705964">size</span>&nbsp;<span class="op" id="1705969">:=</span>&nbsp;<span class="builtintype" id="1705972">uintptr</span><span class="op" id="1705979">(</span><span class="ident" id="1705980">n</span><span class="op" id="1705981">)</span>&nbsp;<span class="op" id="1705983">*</span>&nbsp;<span class="ident" id="1705985">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1705992">if</span>&nbsp;<span class="ident" id="1705995">size</span>&nbsp;<span class="op" id="1706000">==</span>&nbsp;<span class="num" id="1706003">1</span>&nbsp;<span class="op" id="1706005">{</span>&nbsp;<span class="comment" id="1706007">//&nbsp;common&nbsp;case&nbsp;worth&nbsp;about&nbsp;2x&nbsp;to&nbsp;do&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1706050">//&nbsp;TODO:&nbsp;is&nbsp;this&nbsp;still&nbsp;worth&nbsp;it&nbsp;with&nbsp;new&nbsp;memmove&nbsp;impl?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1706107">*</span><span class="op" id="1706108">(</span><span class="op" id="1706109">*</span><span class="builtintype" id="1706110">byte</span><span class="op" id="1706114">)</span><span class="op" id="1706115">(</span><span class="ident" id="1706116">to</span><span class="op" id="1706118">.</span><span class="ident" id="1706119">array</span><span class="op" id="1706124">)</span>&nbsp;<span class="op" id="1706126">=</span>&nbsp;<span class="op" id="1706128">*</span><span class="op" id="1706129">(</span><span class="op" id="1706130">*</span><span class="builtintype" id="1706131">byte</span><span class="op" id="1706135">)</span><span class="op" id="1706136">(</span><span class="ident" id="1706137">fm</span><span class="op" id="1706139">.</span><span class="ident" id="1706140">array</span><span class="op" id="1706145">)</span>&nbsp;<span class="comment" id="1706147">//&nbsp;known&nbsp;to&nbsp;be&nbsp;a&nbsp;byte&nbsp;pointer</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1706178">}</span>&nbsp;<span class="keyword" id="1706180">else</span>&nbsp;<span class="op" id="1706185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706189">memmove</span><span class="op" id="1706196">(</span><span class="ident" id="1706197">to</span><span class="op" id="1706199">.</span><span class="ident" id="1706200">array</span><span class="op" id="1706205">,</span>&nbsp;<span class="ident" id="1706207">fm</span><span class="op" id="1706209">.</span><span class="ident" id="1706210">array</span><span class="op" id="1706215">,</span>&nbsp;<span class="ident" id="1706217">size</span><span class="op" id="1706221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1706224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706227">return</span>&nbsp;<span class="builtintype" id="1706234">int</span><span class="op" id="1706237">(</span><span class="ident" id="1706238">n</span><span class="op" id="1706239">)</span><br>
<span class="lineno"></span><span class="op" id="1706241">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="1706244">func</span>&nbsp;<span class="ident" id="1706249">slicestringcopy</span><span class="op" id="1706264">(</span><span class="ident" id="1706265">to</span>&nbsp;<span class="op" id="1706268">[</span><span class="op" id="1706269">]</span><span class="builtintype" id="1706270">byte</span><span class="op" id="1706274">,</span>&nbsp;<span class="ident" id="1706276">fm</span>&nbsp;<span class="builtintype" id="1706279">string</span><span class="op" id="1706285">)</span>&nbsp;<span class="builtintype" id="1706287">int</span>&nbsp;<span class="op" id="1706291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706294">if</span>&nbsp;<span class="builtinfunc" id="1706297">len</span><span class="op" id="1706300">(</span><span class="ident" id="1706301">fm</span><span class="op" id="1706303">)</span>&nbsp;<span class="op" id="1706305">==</span>&nbsp;<span class="num" id="1706308">0</span>&nbsp;<span class="op" id="1706310">||</span>&nbsp;<span class="builtinfunc" id="1706313">len</span><span class="op" id="1706316">(</span><span class="ident" id="1706317">to</span><span class="op" id="1706319">)</span>&nbsp;<span class="op" id="1706321">==</span>&nbsp;<span class="num" id="1706324">0</span>&nbsp;<span class="op" id="1706326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706330">return</span>&nbsp;<span class="num" id="1706337">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1706340">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706344">n</span>&nbsp;<span class="op" id="1706346">:=</span>&nbsp;<span class="builtinfunc" id="1706349">len</span><span class="op" id="1706352">(</span><span class="ident" id="1706353">fm</span><span class="op" id="1706355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706358">if</span>&nbsp;<span class="builtinfunc" id="1706361">len</span><span class="op" id="1706364">(</span><span class="ident" id="1706365">to</span><span class="op" id="1706367">)</span>&nbsp;<span class="op" id="1706369">&lt;</span>&nbsp;<span class="ident" id="1706371">n</span>&nbsp;<span class="op" id="1706373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706377">n</span>&nbsp;<span class="op" id="1706379">=</span>&nbsp;<span class="builtinfunc" id="1706381">len</span><span class="op" id="1706384">(</span><span class="ident" id="1706385">to</span><span class="op" id="1706387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1706390">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706394">if</span>&nbsp;<span class="ident" id="1706397">raceenabled</span>&nbsp;<span class="op" id="1706409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706413">callerpc</span>&nbsp;<span class="op" id="1706422">:=</span>&nbsp;<span class="ident" id="1706425">getcallerpc</span><span class="op" id="1706436">(</span><span class="ident" id="1706437">unsafe</span><span class="op" id="1706443">.</span><span class="ident" id="1706444">Pointer</span><span class="op" id="1706451">(</span><span class="op" id="1706452">&amp;</span><span class="ident" id="1706453">to</span><span class="op" id="1706455">)</span><span class="op" id="1706456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706460">pc</span>&nbsp;<span class="op" id="1706463">:=</span>&nbsp;<span class="ident" id="1706466">funcPC</span><span class="op" id="1706472">(</span><span class="ident" id="1706473">slicestringcopy</span><span class="op" id="1706488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706492">racewriterangepc</span><span class="op" id="1706508">(</span><span class="ident" id="1706509">unsafe</span><span class="op" id="1706515">.</span><span class="ident" id="1706516">Pointer</span><span class="op" id="1706523">(</span><span class="op" id="1706524">&amp;</span><span class="ident" id="1706525">to</span><span class="op" id="1706527">[</span><span class="num" id="1706528">0</span><span class="op" id="1706529">]</span><span class="op" id="1706530">)</span><span class="op" id="1706531">,</span>&nbsp;<span class="builtintype" id="1706533">uintptr</span><span class="op" id="1706540">(</span><span class="ident" id="1706541">n</span><span class="op" id="1706542">)</span><span class="op" id="1706543">,</span>&nbsp;<span class="ident" id="1706545">callerpc</span><span class="op" id="1706553">,</span>&nbsp;<span class="ident" id="1706555">pc</span><span class="op" id="1706557">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1706560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706564">memmove</span><span class="op" id="1706571">(</span><span class="ident" id="1706572">unsafe</span><span class="op" id="1706578">.</span><span class="ident" id="1706579">Pointer</span><span class="op" id="1706586">(</span><span class="op" id="1706587">&amp;</span><span class="ident" id="1706588">to</span><span class="op" id="1706590">[</span><span class="num" id="1706591">0</span><span class="op" id="1706592">]</span><span class="op" id="1706593">)</span><span class="op" id="1706594">,</span>&nbsp;<span class="ident" id="1706596">unsafe</span><span class="op" id="1706602">.</span><span class="ident" id="1706603">Pointer</span><span class="op" id="1706610">(</span><span class="op" id="1706611">(</span><span class="op" id="1706612">*</span><span class="ident" id="1706613">stringStruct</span><span class="op" id="1706625">)</span><span class="op" id="1706626">(</span><span class="ident" id="1706627">unsafe</span><span class="op" id="1706633">.</span><span class="ident" id="1706634">Pointer</span><span class="op" id="1706641">(</span><span class="op" id="1706642">&amp;</span><span class="ident" id="1706643">fm</span><span class="op" id="1706645">)</span><span class="op" id="1706646">)</span><span class="op" id="1706647">.</span><span class="ident" id="1706648">str</span><span class="op" id="1706651">)</span><span class="op" id="1706652">,</span>&nbsp;<span class="builtintype" id="1706654">uintptr</span><span class="op" id="1706661">(</span><span class="ident" id="1706662">n</span><span class="op" id="1706663">)</span><span class="op" id="1706664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706667">return</span>&nbsp;<span class="ident" id="1706674">n</span><br>
<span class="lineno"></span><span class="op" id="1706676">}</span>
</div>
</body>
</html>
