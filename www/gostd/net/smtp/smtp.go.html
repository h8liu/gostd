<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html" class="current">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6093022">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6093077">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6093131">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6093182">//&nbsp;Package&nbsp;smtp&nbsp;implements&nbsp;the&nbsp;Simple&nbsp;Mail&nbsp;Transfer&nbsp;Protocol&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5321.</span><br>
<span class="lineno"></span><span class="comment" id="6093267">//&nbsp;It&nbsp;also&nbsp;implements&nbsp;the&nbsp;following&nbsp;extensions:</span><br>
<span class="lineno"></span><span class="comment" id="6093315">//&nbsp;&nbsp;&nbsp;&nbsp8BITMIME&nbsp;&nbsp;RFC&nbsp;1652</span><br>
<span class="lineno"></span><span class="comment" id="6093337">//&nbsp;&nbsp;&nbsp;&nbspAUTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RFC&nbsp;2554</span><br>
<span class="lineno"></span><span class="comment" id="6093359">//&nbsp;&nbsp;&nbsp;&nbspSTARTTLS&nbsp;&nbsp;RFC&nbsp;3207</span><br>
<span class="lineno">10</span><span class="comment" id="6093381">//&nbsp;Additional&nbsp;extensions&nbsp;may&nbsp;be&nbsp;handled&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="6093433">package</span>&nbsp;<span class="ident" id="6093441">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6093447">import</span>&nbsp;<span class="op" id="6093454">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6093457">&#34;crypto/tls&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6093471">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6093490">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6093500">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6093506">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6093513">&#34;net/textproto&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6093530">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="6093540">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6093543">//&nbsp;A&nbsp;Client&nbsp;represents&nbsp;a&nbsp;client&nbsp;connection&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6093605">type</span>&nbsp;<span class="ident" id="6093610">Client</span>&nbsp;<span class="keyword" id="6093617">struct</span>&nbsp;<span class="op" id="6093624">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6093627">//&nbsp;Text&nbsp;is&nbsp;the&nbsp;textproto.Conn&nbsp;used&nbsp;by&nbsp;the&nbsp;Client.&nbsp;It&nbsp;is&nbsp;exported&nbsp;to&nbsp;allow&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6093706">//&nbsp;clients&nbsp;to&nbsp;add&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093737">Text</span>&nbsp;<span class="op" id="6093742">*</span><span class="ident" id="6093743">textproto</span><span class="op" id="6093752">.</span><span class="ident" id="6093753">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6093759">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;connection&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;a&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6093832">//&nbsp;connection&nbsp;later</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093853">conn</span>&nbsp;<span class="ident" id="6093858">net</span><span class="op" id="6093861">.</span><span class="ident" id="6093862">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6093868">//&nbsp;whether&nbsp;the&nbsp;Client&nbsp;is&nbsp;using&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093904">tls</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6093915">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093921">serverName</span>&nbsp;<span class="builtintype" id="6093932">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6093940">//&nbsp;map&nbsp;of&nbsp;supported&nbsp;extensions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6093972">ext</span>&nbsp;<span class="keyword" id="6093976">map</span><span class="op" id="6093979">[</span><span class="builtintype" id="6093980">string</span><span class="op" id="6093986">]</span><span class="builtintype" id="6093987">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6093995">//&nbsp;supported&nbsp;auth&nbsp;mechanisms</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094025">auth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6094036">[</span><span class="op" id="6094037">]</span><span class="builtintype" id="6094038">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094046">localName</span>&nbsp;&nbsp;<span class="builtintype" id="6094057">string</span>&nbsp;<span class="comment" id="6094064">//&nbsp;the&nbsp;name&nbsp;to&nbsp;use&nbsp;in&nbsp;HELO/EHLO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094097">didHello</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6094108">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6094115">//&nbsp;whether&nbsp;we&#39;ve&nbsp;said&nbsp;HELO/EHLO</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094148">helloError</span>&nbsp;<span class="builtintype" id="6094159">error</span>&nbsp;&nbsp;<span class="comment" id="6094166">//&nbsp;the&nbsp;error&nbsp;from&nbsp;the&nbsp;hello</span><br>
<span class="lineno"></span><span class="op" id="6094194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6094197">//&nbsp;Dial&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;connected&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server&nbsp;at&nbsp;addr.</span><br>
<span class="lineno"></span><span class="comment" id="6094263">//&nbsp;The&nbsp;addr&nbsp;must&nbsp;include&nbsp;a&nbsp;port&nbsp;number.</span><br>
<span class="lineno">45</span><span class="keyword" id="6094303">func</span>&nbsp;<span class="ident" id="6094308">Dial</span><span class="op" id="6094312">(</span><span class="ident" id="6094313">addr</span>&nbsp;<span class="builtintype" id="6094318">string</span><span class="op" id="6094324">)</span>&nbsp;<span class="op" id="6094326">(</span><span class="op" id="6094327">*</span><span class="ident" id="6094328">Client</span><span class="op" id="6094334">,</span>&nbsp;<span class="builtintype" id="6094336">error</span><span class="op" id="6094341">)</span>&nbsp;<span class="op" id="6094343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094346">conn</span><span class="op" id="6094350">,</span>&nbsp;<span class="ident" id="6094352">err</span>&nbsp;<span class="op" id="6094356">:=</span>&nbsp;<span class="ident" id="6094359">net</span><span class="op" id="6094362">.</span><span class="ident" id="6094363">Dial</span><span class="op" id="6094367">(</span><span class="string" id="6094368">&#34;tcp&#34;</span><span class="op" id="6094373">,</span>&nbsp;<span class="ident" id="6094375">addr</span><span class="op" id="6094379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094382">if</span>&nbsp;<span class="ident" id="6094385">err</span>&nbsp;<span class="op" id="6094389">!=</span>&nbsp;<span class="ident" id="6094392">nil</span>&nbsp;<span class="op" id="6094396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094400">return</span>&nbsp;<span class="ident" id="6094407">nil</span><span class="op" id="6094410">,</span>&nbsp;<span class="ident" id="6094412">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6094417">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094420">host</span><span class="op" id="6094424">,</span>&nbsp;<span class="ident" id="6094426">_</span><span class="op" id="6094427">,</span>&nbsp;<span class="ident" id="6094429">_</span>&nbsp;<span class="op" id="6094431">:=</span>&nbsp;<span class="ident" id="6094434">net</span><span class="op" id="6094437">.</span><span class="ident" id="6094438">SplitHostPort</span><span class="op" id="6094451">(</span><span class="ident" id="6094452">addr</span><span class="op" id="6094456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094459">return</span>&nbsp;<span class="ident" id="6094466">NewClient</span><span class="op" id="6094475">(</span><span class="ident" id="6094476">conn</span><span class="op" id="6094480">,</span>&nbsp;<span class="ident" id="6094482">host</span><span class="op" id="6094486">)</span><br>
<span class="lineno"></span><span class="op" id="6094488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6094491">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;using&nbsp;an&nbsp;existing&nbsp;connection&nbsp;and&nbsp;host&nbsp;as&nbsp;a</span><br>
<span class="lineno">55</span><span class="comment" id="6094568">//&nbsp;server&nbsp;name&nbsp;to&nbsp;be&nbsp;used&nbsp;when&nbsp;authenticating.</span><br>
<span class="lineno"></span><span class="keyword" id="6094615">func</span>&nbsp;<span class="ident" id="6094620">NewClient</span><span class="op" id="6094629">(</span><span class="ident" id="6094630">conn</span>&nbsp;<span class="ident" id="6094635">net</span><span class="op" id="6094638">.</span><span class="ident" id="6094639">Conn</span><span class="op" id="6094643">,</span>&nbsp;<span class="ident" id="6094645">host</span>&nbsp;<span class="builtintype" id="6094650">string</span><span class="op" id="6094656">)</span>&nbsp;<span class="op" id="6094658">(</span><span class="op" id="6094659">*</span><span class="ident" id="6094660">Client</span><span class="op" id="6094666">,</span>&nbsp;<span class="builtintype" id="6094668">error</span><span class="op" id="6094673">)</span>&nbsp;<span class="op" id="6094675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094678">text</span>&nbsp;<span class="op" id="6094683">:=</span>&nbsp;<span class="ident" id="6094686">textproto</span><span class="op" id="6094695">.</span><span class="ident" id="6094696">NewConn</span><span class="op" id="6094703">(</span><span class="ident" id="6094704">conn</span><span class="op" id="6094708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094711">_</span><span class="op" id="6094712">,</span>&nbsp;<span class="ident" id="6094714">_</span><span class="op" id="6094715">,</span>&nbsp;<span class="ident" id="6094717">err</span>&nbsp;<span class="op" id="6094721">:=</span>&nbsp;<span class="ident" id="6094724">text</span><span class="op" id="6094728">.</span><span class="ident" id="6094729">ReadResponse</span><span class="op" id="6094741">(</span><span class="num" id="6094742">220</span><span class="op" id="6094745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094748">if</span>&nbsp;<span class="ident" id="6094751">err</span>&nbsp;<span class="op" id="6094755">!=</span>&nbsp;<span class="ident" id="6094758">nil</span>&nbsp;<span class="op" id="6094762">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094766">text</span><span class="op" id="6094770">.</span><span class="ident" id="6094771">Close</span><span class="op" id="6094776">(</span><span class="op" id="6094777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094781">return</span>&nbsp;<span class="ident" id="6094788">nil</span><span class="op" id="6094791">,</span>&nbsp;<span class="ident" id="6094793">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6094798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6094801">c</span>&nbsp;<span class="op" id="6094803">:=</span>&nbsp;<span class="op" id="6094806">&amp;</span><span class="ident" id="6094807">Client</span><span class="op" id="6094813">{</span><span class="ident" id="6094814">Text</span><span class="op" id="6094818">:</span>&nbsp;<span class="ident" id="6094820">text</span><span class="op" id="6094824">,</span>&nbsp;<span class="ident" id="6094826">conn</span><span class="op" id="6094830">:</span>&nbsp;<span class="ident" id="6094832">conn</span><span class="op" id="6094836">,</span>&nbsp;<span class="ident" id="6094838">serverName</span><span class="op" id="6094848">:</span>&nbsp;<span class="ident" id="6094850">host</span><span class="op" id="6094854">,</span>&nbsp;<span class="ident" id="6094856">localName</span><span class="op" id="6094865">:</span>&nbsp;<span class="string" id="6094867">&#34;localhost&#34;</span><span class="op" id="6094878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094881">return</span>&nbsp;<span class="ident" id="6094888">c</span><span class="op" id="6094889">,</span>&nbsp;<span class="ident" id="6094891">nil</span><br>
<span class="lineno">65</span><span class="op" id="6094895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6094898">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6094930">func</span>&nbsp;<span class="op" id="6094935">(</span><span class="ident" id="6094936">c</span>&nbsp;<span class="op" id="6094938">*</span><span class="ident" id="6094939">Client</span><span class="op" id="6094945">)</span>&nbsp;<span class="ident" id="6094947">Close</span><span class="op" id="6094952">(</span><span class="op" id="6094953">)</span>&nbsp;<span class="builtintype" id="6094955">error</span>&nbsp;<span class="op" id="6094961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6094964">return</span>&nbsp;<span class="ident" id="6094971">c</span><span class="op" id="6094972">.</span><span class="ident" id="6094973">Text</span><span class="op" id="6094977">.</span><span class="ident" id="6094978">Close</span><span class="op" id="6094983">(</span><span class="op" id="6094984">)</span><br>
<span class="lineno">70</span><span class="op" id="6094986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6094989">//&nbsp;hello&nbsp;runs&nbsp;a&nbsp;hello&nbsp;exchange&nbsp;if&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="6095031">func</span>&nbsp;<span class="op" id="6095036">(</span><span class="ident" id="6095037">c</span>&nbsp;<span class="op" id="6095039">*</span><span class="ident" id="6095040">Client</span><span class="op" id="6095046">)</span>&nbsp;<span class="ident" id="6095048">hello</span><span class="op" id="6095053">(</span><span class="op" id="6095054">)</span>&nbsp;<span class="builtintype" id="6095056">error</span>&nbsp;<span class="op" id="6095062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095065">if</span>&nbsp;<span class="op" id="6095068">!</span><span class="ident" id="6095069">c</span><span class="op" id="6095070">.</span><span class="ident" id="6095071">didHello</span>&nbsp;<span class="op" id="6095080">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6095084">c</span><span class="op" id="6095085">.</span><span class="ident" id="6095086">didHello</span>&nbsp;<span class="op" id="6095095">=</span>&nbsp;<span class="builtintype" id="6095097">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6095104">err</span>&nbsp;<span class="op" id="6095108">:=</span>&nbsp;<span class="ident" id="6095111">c</span><span class="op" id="6095112">.</span><span class="ident" id="6095113">ehlo</span><span class="op" id="6095117">(</span><span class="op" id="6095118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095122">if</span>&nbsp;<span class="ident" id="6095125">err</span>&nbsp;<span class="op" id="6095129">!=</span>&nbsp;<span class="ident" id="6095132">nil</span>&nbsp;<span class="op" id="6095136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6095141">c</span><span class="op" id="6095142">.</span><span class="ident" id="6095143">helloError</span>&nbsp;<span class="op" id="6095154">=</span>&nbsp;<span class="ident" id="6095156">c</span><span class="op" id="6095157">.</span><span class="ident" id="6095158">helo</span><span class="op" id="6095162">(</span><span class="op" id="6095163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6095167">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6095170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095173">return</span>&nbsp;<span class="ident" id="6095180">c</span><span class="op" id="6095181">.</span><span class="ident" id="6095182">helloError</span><br>
<span class="lineno"></span><span class="op" id="6095193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6095196">//&nbsp;Hello&nbsp;sends&nbsp;a&nbsp;HELO&nbsp;or&nbsp;EHLO&nbsp;to&nbsp;the&nbsp;server&nbsp;as&nbsp;the&nbsp;given&nbsp;host&nbsp;name.</span><br>
<span class="lineno">85</span><span class="comment" id="6095264">//&nbsp;Calling&nbsp;this&nbsp;method&nbsp;is&nbsp;only&nbsp;necessary&nbsp;if&nbsp;the&nbsp;client&nbsp;needs&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="6095333">//&nbsp;over&nbsp;the&nbsp;host&nbsp;name&nbsp;used.&nbsp;&nbsp;The&nbsp;client&nbsp;will&nbsp;introduce&nbsp;itself&nbsp;as&nbsp;&#34;localhost&#34;</span><br>
<span class="lineno"></span><span class="comment" id="6095410">//&nbsp;automatically&nbsp;otherwise.&nbsp;&nbsp;If&nbsp;Hello&nbsp;is&nbsp;called,&nbsp;it&nbsp;must&nbsp;be&nbsp;called&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="6095484">//&nbsp;any&nbsp;of&nbsp;the&nbsp;other&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="6095513">func</span>&nbsp;<span class="op" id="6095518">(</span><span class="ident" id="6095519">c</span>&nbsp;<span class="op" id="6095521">*</span><span class="ident" id="6095522">Client</span><span class="op" id="6095528">)</span>&nbsp;<span class="ident" id="6095530">Hello</span><span class="op" id="6095535">(</span><span class="ident" id="6095536">localName</span>&nbsp;<span class="builtintype" id="6095546">string</span><span class="op" id="6095552">)</span>&nbsp;<span class="builtintype" id="6095554">error</span>&nbsp;<span class="op" id="6095560">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095563">if</span>&nbsp;<span class="ident" id="6095566">c</span><span class="op" id="6095567">.</span><span class="ident" id="6095568">didHello</span>&nbsp;<span class="op" id="6095577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095581">return</span>&nbsp;<span class="ident" id="6095588">errors</span><span class="op" id="6095594">.</span><span class="ident" id="6095595">New</span><span class="op" id="6095598">(</span><span class="string" id="6095599">&#34;smtp:&nbsp;Hello&nbsp;called&nbsp;after&nbsp;other&nbsp;methods&#34;</span><span class="op" id="6095639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6095642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6095645">c</span><span class="op" id="6095646">.</span><span class="ident" id="6095647">localName</span>&nbsp;<span class="op" id="6095657">=</span>&nbsp;<span class="ident" id="6095659">localName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095670">return</span>&nbsp;<span class="ident" id="6095677">c</span><span class="op" id="6095678">.</span><span class="ident" id="6095679">hello</span><span class="op" id="6095684">(</span><span class="op" id="6095685">)</span><br>
<span class="lineno">95</span><span class="op" id="6095687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6095690">//&nbsp;cmd&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;that&nbsp;sends&nbsp;a&nbsp;command&nbsp;and&nbsp;returns&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span><span class="keyword" id="6095769">func</span>&nbsp;<span class="op" id="6095774">(</span><span class="ident" id="6095775">c</span>&nbsp;<span class="op" id="6095777">*</span><span class="ident" id="6095778">Client</span><span class="op" id="6095784">)</span>&nbsp;<span class="ident" id="6095786">cmd</span><span class="op" id="6095789">(</span><span class="ident" id="6095790">expectCode</span>&nbsp;<span class="builtintype" id="6095801">int</span><span class="op" id="6095804">,</span>&nbsp;<span class="ident" id="6095806">format</span>&nbsp;<span class="builtintype" id="6095813">string</span><span class="op" id="6095819">,</span>&nbsp;<span class="ident" id="6095821">args</span>&nbsp;<span class="op" id="6095826">...</span><span class="keyword" id="6095829">interface</span><span class="op" id="6095838">{</span><span class="op" id="6095839">}</span><span class="op" id="6095840">)</span>&nbsp;<span class="op" id="6095842">(</span><span class="builtintype" id="6095843">int</span><span class="op" id="6095846">,</span>&nbsp;<span class="builtintype" id="6095848">string</span><span class="op" id="6095854">,</span>&nbsp;<span class="builtintype" id="6095856">error</span><span class="op" id="6095861">)</span>&nbsp;<span class="op" id="6095863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6095866">id</span><span class="op" id="6095868">,</span>&nbsp;<span class="ident" id="6095870">err</span>&nbsp;<span class="op" id="6095874">:=</span>&nbsp;<span class="ident" id="6095877">c</span><span class="op" id="6095878">.</span><span class="ident" id="6095879">Text</span><span class="op" id="6095883">.</span><span class="ident" id="6095884">Cmd</span><span class="op" id="6095887">(</span><span class="ident" id="6095888">format</span><span class="op" id="6095894">,</span>&nbsp;<span class="ident" id="6095896">args</span><span class="op" id="6095900">...</span><span class="op" id="6095903">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095906">if</span>&nbsp;<span class="ident" id="6095909">err</span>&nbsp;<span class="op" id="6095913">!=</span>&nbsp;<span class="ident" id="6095916">nil</span>&nbsp;<span class="op" id="6095920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095924">return</span>&nbsp;<span class="num" id="6095931">0</span><span class="op" id="6095932">,</span>&nbsp;<span class="string" id="6095934">&#34;&#34;</span><span class="op" id="6095936">,</span>&nbsp;<span class="ident" id="6095938">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6095943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6095946">c</span><span class="op" id="6095947">.</span><span class="ident" id="6095948">Text</span><span class="op" id="6095952">.</span><span class="ident" id="6095953">StartResponse</span><span class="op" id="6095966">(</span><span class="ident" id="6095967">id</span><span class="op" id="6095969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6095972">defer</span>&nbsp;<span class="ident" id="6095978">c</span><span class="op" id="6095979">.</span><span class="ident" id="6095980">Text</span><span class="op" id="6095984">.</span><span class="ident" id="6095985">EndResponse</span><span class="op" id="6095996">(</span><span class="ident" id="6095997">id</span><span class="op" id="6095999">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096002">code</span><span class="op" id="6096006">,</span>&nbsp;<span class="ident" id="6096008">msg</span><span class="op" id="6096011">,</span>&nbsp;<span class="ident" id="6096013">err</span>&nbsp;<span class="op" id="6096017">:=</span>&nbsp;<span class="ident" id="6096020">c</span><span class="op" id="6096021">.</span><span class="ident" id="6096022">Text</span><span class="op" id="6096026">.</span><span class="ident" id="6096027">ReadResponse</span><span class="op" id="6096039">(</span><span class="ident" id="6096040">expectCode</span><span class="op" id="6096050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6096053">return</span>&nbsp;<span class="ident" id="6096060">code</span><span class="op" id="6096064">,</span>&nbsp;<span class="ident" id="6096066">msg</span><span class="op" id="6096069">,</span>&nbsp;<span class="ident" id="6096071">err</span><br>
<span class="lineno"></span><span class="op" id="6096075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6096078">//&nbsp;helo&nbsp;sends&nbsp;the&nbsp;HELO&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;when&nbsp;the</span><br>
<span class="lineno">110</span><span class="comment" id="6096157">//&nbsp;server&nbsp;does&nbsp;not&nbsp;support&nbsp;ehlo.</span><br>
<span class="lineno"></span><span class="keyword" id="6096190">func</span>&nbsp;<span class="op" id="6096195">(</span><span class="ident" id="6096196">c</span>&nbsp;<span class="op" id="6096198">*</span><span class="ident" id="6096199">Client</span><span class="op" id="6096205">)</span>&nbsp;<span class="ident" id="6096207">helo</span><span class="op" id="6096211">(</span><span class="op" id="6096212">)</span>&nbsp;<span class="builtintype" id="6096214">error</span>&nbsp;<span class="op" id="6096220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096223">c</span><span class="op" id="6096224">.</span><span class="ident" id="6096225">ext</span>&nbsp;<span class="op" id="6096229">=</span>&nbsp;<span class="ident" id="6096231">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096236">_</span><span class="op" id="6096237">,</span>&nbsp;<span class="ident" id="6096239">_</span><span class="op" id="6096240">,</span>&nbsp;<span class="ident" id="6096242">err</span>&nbsp;<span class="op" id="6096246">:=</span>&nbsp;<span class="ident" id="6096249">c</span><span class="op" id="6096250">.</span><span class="ident" id="6096251">cmd</span><span class="op" id="6096254">(</span><span class="num" id="6096255">250</span><span class="op" id="6096258">,</span>&nbsp;<span class="string" id="6096260">&#34;HELO&nbsp;%s&#34;</span><span class="op" id="6096269">,</span>&nbsp;<span class="ident" id="6096271">c</span><span class="op" id="6096272">.</span><span class="ident" id="6096273">localName</span><span class="op" id="6096282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6096285">return</span>&nbsp;<span class="ident" id="6096292">err</span><br>
<span class="lineno">115</span><span class="op" id="6096296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6096299">//&nbsp;ehlo&nbsp;sends&nbsp;the&nbsp;EHLO&nbsp;(extended&nbsp;hello)&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="6096366">//&nbsp;should&nbsp;be&nbsp;the&nbsp;preferred&nbsp;greeting&nbsp;for&nbsp;servers&nbsp;that&nbsp;support&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="6096431">func</span>&nbsp;<span class="op" id="6096436">(</span><span class="ident" id="6096437">c</span>&nbsp;<span class="op" id="6096439">*</span><span class="ident" id="6096440">Client</span><span class="op" id="6096446">)</span>&nbsp;<span class="ident" id="6096448">ehlo</span><span class="op" id="6096452">(</span><span class="op" id="6096453">)</span>&nbsp;<span class="builtintype" id="6096455">error</span>&nbsp;<span class="op" id="6096461">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096464">_</span><span class="op" id="6096465">,</span>&nbsp;<span class="ident" id="6096467">msg</span><span class="op" id="6096470">,</span>&nbsp;<span class="ident" id="6096472">err</span>&nbsp;<span class="op" id="6096476">:=</span>&nbsp;<span class="ident" id="6096479">c</span><span class="op" id="6096480">.</span><span class="ident" id="6096481">cmd</span><span class="op" id="6096484">(</span><span class="num" id="6096485">250</span><span class="op" id="6096488">,</span>&nbsp;<span class="string" id="6096490">&#34;EHLO&nbsp;%s&#34;</span><span class="op" id="6096499">,</span>&nbsp;<span class="ident" id="6096501">c</span><span class="op" id="6096502">.</span><span class="ident" id="6096503">localName</span><span class="op" id="6096512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6096515">if</span>&nbsp;<span class="ident" id="6096518">err</span>&nbsp;<span class="op" id="6096522">!=</span>&nbsp;<span class="ident" id="6096525">nil</span>&nbsp;<span class="op" id="6096529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6096533">return</span>&nbsp;<span class="ident" id="6096540">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6096545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096548">ext</span>&nbsp;<span class="op" id="6096552">:=</span>&nbsp;<span class="builtinfunc" id="6096555">make</span><span class="op" id="6096559">(</span><span class="keyword" id="6096560">map</span><span class="op" id="6096563">[</span><span class="builtintype" id="6096564">string</span><span class="op" id="6096570">]</span><span class="builtintype" id="6096571">string</span><span class="op" id="6096577">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096580">extList</span>&nbsp;<span class="op" id="6096588">:=</span>&nbsp;<span class="ident" id="6096591">strings</span><span class="op" id="6096598">.</span><span class="ident" id="6096599">Split</span><span class="op" id="6096604">(</span><span class="ident" id="6096605">msg</span><span class="op" id="6096608">,</span>&nbsp;<span class="string" id="6096610">&#34;\n&#34;</span><span class="op" id="6096614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6096617">if</span>&nbsp;<span class="builtinfunc" id="6096620">len</span><span class="op" id="6096623">(</span><span class="ident" id="6096624">extList</span><span class="op" id="6096631">)</span>&nbsp;<span class="op" id="6096633">&gt;</span>&nbsp;<span class="num" id="6096635">1</span>&nbsp;<span class="op" id="6096637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096641">extList</span>&nbsp;<span class="op" id="6096649">=</span>&nbsp;<span class="ident" id="6096651">extList</span><span class="op" id="6096658">[</span><span class="num" id="6096659">1</span><span class="op" id="6096660">:</span><span class="op" id="6096661">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6096665">for</span>&nbsp;<span class="ident" id="6096669">_</span><span class="op" id="6096670">,</span>&nbsp;<span class="ident" id="6096672">line</span>&nbsp;<span class="op" id="6096677">:=</span>&nbsp;<span class="keyword" id="6096680">range</span>&nbsp;<span class="ident" id="6096686">extList</span>&nbsp;<span class="op" id="6096694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096699">args</span>&nbsp;<span class="op" id="6096704">:=</span>&nbsp;<span class="ident" id="6096707">strings</span><span class="op" id="6096714">.</span><span class="ident" id="6096715">SplitN</span><span class="op" id="6096721">(</span><span class="ident" id="6096722">line</span><span class="op" id="6096726">,</span>&nbsp;<span class="string" id="6096728">&#34;&nbsp;&#34;</span><span class="op" id="6096731">,</span>&nbsp;<span class="num" id="6096733">2</span><span class="op" id="6096734">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6096739">if</span>&nbsp;<span class="builtinfunc" id="6096742">len</span><span class="op" id="6096745">(</span><span class="ident" id="6096746">args</span><span class="op" id="6096750">)</span>&nbsp;<span class="op" id="6096752">&gt;</span>&nbsp;<span class="num" id="6096754">1</span>&nbsp;<span class="op" id="6096756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096762">ext</span><span class="op" id="6096765">[</span><span class="ident" id="6096766">args</span><span class="op" id="6096770">[</span><span class="num" id="6096771">0</span><span class="op" id="6096772">]</span><span class="op" id="6096773">]</span>&nbsp;<span class="op" id="6096775">=</span>&nbsp;<span class="ident" id="6096777">args</span><span class="op" id="6096781">[</span><span class="num" id="6096782">1</span><span class="op" id="6096783">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6096788">}</span>&nbsp;<span class="keyword" id="6096790">else</span>&nbsp;<span class="op" id="6096795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096801">ext</span><span class="op" id="6096804">[</span><span class="ident" id="6096805">args</span><span class="op" id="6096809">[</span><span class="num" id="6096810">0</span><span class="op" id="6096811">]</span><span class="op" id="6096812">]</span>&nbsp;<span class="op" id="6096814">=</span>&nbsp;<span class="string" id="6096816">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6096822">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6096826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6096829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6096832">if</span>&nbsp;<span class="ident" id="6096835">mechs</span><span class="op" id="6096840">,</span>&nbsp;<span class="ident" id="6096842">ok</span>&nbsp;<span class="op" id="6096845">:=</span>&nbsp;<span class="ident" id="6096848">ext</span><span class="op" id="6096851">[</span><span class="string" id="6096852">&#34;AUTH&#34;</span><span class="op" id="6096858">]</span><span class="op" id="6096859">;</span>&nbsp;<span class="ident" id="6096861">ok</span>&nbsp;<span class="op" id="6096864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096868">c</span><span class="op" id="6096869">.</span><span class="ident" id="6096870">auth</span>&nbsp;<span class="op" id="6096875">=</span>&nbsp;<span class="ident" id="6096877">strings</span><span class="op" id="6096884">.</span><span class="ident" id="6096885">Split</span><span class="op" id="6096890">(</span><span class="ident" id="6096891">mechs</span><span class="op" id="6096896">,</span>&nbsp;<span class="string" id="6096898">&#34;&nbsp;&#34;</span><span class="op" id="6096901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6096904">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6096907">c</span><span class="op" id="6096908">.</span><span class="ident" id="6096909">ext</span>&nbsp;<span class="op" id="6096913">=</span>&nbsp;<span class="ident" id="6096915">ext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6096920">return</span>&nbsp;<span class="ident" id="6096927">err</span><br>
<span class="lineno"></span><span class="op" id="6096931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6096934">//&nbsp;StartTLS&nbsp;sends&nbsp;the&nbsp;STARTTLS&nbsp;command&nbsp;and&nbsp;encrypts&nbsp;all&nbsp;further&nbsp;communication.</span><br>
<span class="lineno">145</span><span class="comment" id="6097013">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;STARTTLS&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="6097090">func</span>&nbsp;<span class="op" id="6097095">(</span><span class="ident" id="6097096">c</span>&nbsp;<span class="op" id="6097098">*</span><span class="ident" id="6097099">Client</span><span class="op" id="6097105">)</span>&nbsp;<span class="ident" id="6097107">StartTLS</span><span class="op" id="6097115">(</span><span class="ident" id="6097116">config</span>&nbsp;<span class="op" id="6097123">*</span><span class="ident" id="6097124">tls</span><span class="op" id="6097127">.</span><span class="ident" id="6097128">Config</span><span class="op" id="6097134">)</span>&nbsp;<span class="builtintype" id="6097136">error</span>&nbsp;<span class="op" id="6097142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097145">if</span>&nbsp;<span class="ident" id="6097148">err</span>&nbsp;<span class="op" id="6097152">:=</span>&nbsp;<span class="ident" id="6097155">c</span><span class="op" id="6097156">.</span><span class="ident" id="6097157">hello</span><span class="op" id="6097162">(</span><span class="op" id="6097163">)</span><span class="op" id="6097164">;</span>&nbsp;<span class="ident" id="6097166">err</span>&nbsp;<span class="op" id="6097170">!=</span>&nbsp;<span class="ident" id="6097173">nil</span>&nbsp;<span class="op" id="6097177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097181">return</span>&nbsp;<span class="ident" id="6097188">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6097193">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6097196">_</span><span class="op" id="6097197">,</span>&nbsp;<span class="ident" id="6097199">_</span><span class="op" id="6097200">,</span>&nbsp;<span class="ident" id="6097202">err</span>&nbsp;<span class="op" id="6097206">:=</span>&nbsp;<span class="ident" id="6097209">c</span><span class="op" id="6097210">.</span><span class="ident" id="6097211">cmd</span><span class="op" id="6097214">(</span><span class="num" id="6097215">220</span><span class="op" id="6097218">,</span>&nbsp;<span class="string" id="6097220">&#34;STARTTLS&#34;</span><span class="op" id="6097230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097233">if</span>&nbsp;<span class="ident" id="6097236">err</span>&nbsp;<span class="op" id="6097240">!=</span>&nbsp;<span class="ident" id="6097243">nil</span>&nbsp;<span class="op" id="6097247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097251">return</span>&nbsp;<span class="ident" id="6097258">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6097263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6097266">c</span><span class="op" id="6097267">.</span><span class="ident" id="6097268">conn</span>&nbsp;<span class="op" id="6097273">=</span>&nbsp;<span class="ident" id="6097275">tls</span><span class="op" id="6097278">.</span><span class="ident" id="6097279">Client</span><span class="op" id="6097285">(</span><span class="ident" id="6097286">c</span><span class="op" id="6097287">.</span><span class="ident" id="6097288">conn</span><span class="op" id="6097292">,</span>&nbsp;<span class="ident" id="6097294">config</span><span class="op" id="6097300">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6097303">c</span><span class="op" id="6097304">.</span><span class="ident" id="6097305">Text</span>&nbsp;<span class="op" id="6097310">=</span>&nbsp;<span class="ident" id="6097312">textproto</span><span class="op" id="6097321">.</span><span class="ident" id="6097322">NewConn</span><span class="op" id="6097329">(</span><span class="ident" id="6097330">c</span><span class="op" id="6097331">.</span><span class="ident" id="6097332">conn</span><span class="op" id="6097336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6097339">c</span><span class="op" id="6097340">.</span><span class="ident" id="6097341">tls</span>&nbsp;<span class="op" id="6097345">=</span>&nbsp;<span class="builtintype" id="6097347">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097353">return</span>&nbsp;<span class="ident" id="6097360">c</span><span class="op" id="6097361">.</span><span class="ident" id="6097362">ehlo</span><span class="op" id="6097366">(</span><span class="op" id="6097367">)</span><br>
<span class="lineno"></span><span class="op" id="6097369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6097372">//&nbsp;Verify&nbsp;checks&nbsp;the&nbsp;validity&nbsp;of&nbsp;an&nbsp;email&nbsp;address&nbsp;on&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6097437">//&nbsp;If&nbsp;Verify&nbsp;returns&nbsp;nil,&nbsp;the&nbsp;address&nbsp;is&nbsp;valid.&nbsp;A&nbsp;non-nil&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="6097502">//&nbsp;does&nbsp;not&nbsp;necessarily&nbsp;indicate&nbsp;an&nbsp;invalid&nbsp;address.&nbsp;Many&nbsp;servers</span><br>
<span class="lineno"></span><span class="comment" id="6097568">//&nbsp;will&nbsp;not&nbsp;verify&nbsp;addresses&nbsp;for&nbsp;security&nbsp;reasons.</span><br>
<span class="lineno"></span><span class="keyword" id="6097619">func</span>&nbsp;<span class="op" id="6097624">(</span><span class="ident" id="6097625">c</span>&nbsp;<span class="op" id="6097627">*</span><span class="ident" id="6097628">Client</span><span class="op" id="6097634">)</span>&nbsp;<span class="ident" id="6097636">Verify</span><span class="op" id="6097642">(</span><span class="ident" id="6097643">addr</span>&nbsp;<span class="builtintype" id="6097648">string</span><span class="op" id="6097654">)</span>&nbsp;<span class="builtintype" id="6097656">error</span>&nbsp;<span class="op" id="6097662">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097665">if</span>&nbsp;<span class="ident" id="6097668">err</span>&nbsp;<span class="op" id="6097672">:=</span>&nbsp;<span class="ident" id="6097675">c</span><span class="op" id="6097676">.</span><span class="ident" id="6097677">hello</span><span class="op" id="6097682">(</span><span class="op" id="6097683">)</span><span class="op" id="6097684">;</span>&nbsp;<span class="ident" id="6097686">err</span>&nbsp;<span class="op" id="6097690">!=</span>&nbsp;<span class="ident" id="6097693">nil</span>&nbsp;<span class="op" id="6097697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097701">return</span>&nbsp;<span class="ident" id="6097708">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6097713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6097716">_</span><span class="op" id="6097717">,</span>&nbsp;<span class="ident" id="6097719">_</span><span class="op" id="6097720">,</span>&nbsp;<span class="ident" id="6097722">err</span>&nbsp;<span class="op" id="6097726">:=</span>&nbsp;<span class="ident" id="6097729">c</span><span class="op" id="6097730">.</span><span class="ident" id="6097731">cmd</span><span class="op" id="6097734">(</span><span class="num" id="6097735">250</span><span class="op" id="6097738">,</span>&nbsp;<span class="string" id="6097740">&#34;VRFY&nbsp;%s&#34;</span><span class="op" id="6097749">,</span>&nbsp;<span class="ident" id="6097751">addr</span><span class="op" id="6097755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6097758">return</span>&nbsp;<span class="ident" id="6097765">err</span><br>
<span class="lineno">170</span><span class="op" id="6097769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6097772">//&nbsp;Auth&nbsp;authenticates&nbsp;a&nbsp;client&nbsp;using&nbsp;the&nbsp;provided&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="comment" id="6097848">//&nbsp;A&nbsp;failed&nbsp;authentication&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="6097898">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;AUTH&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno">175</span><span class="keyword" id="6097971">func</span>&nbsp;<span class="op" id="6097976">(</span><span class="ident" id="6097977">c</span>&nbsp;<span class="op" id="6097979">*</span><span class="ident" id="6097980">Client</span><span class="op" id="6097986">)</span>&nbsp;<span class="ident" id="6097988">Auth</span><span class="op" id="6097992">(</span><span class="ident" id="6097993">a</span>&nbsp;<span class="ident" id="6097995">Auth</span><span class="op" id="6097999">)</span>&nbsp;<span class="builtintype" id="6098001">error</span>&nbsp;<span class="op" id="6098007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098010">if</span>&nbsp;<span class="ident" id="6098013">err</span>&nbsp;<span class="op" id="6098017">:=</span>&nbsp;<span class="ident" id="6098020">c</span><span class="op" id="6098021">.</span><span class="ident" id="6098022">hello</span><span class="op" id="6098027">(</span><span class="op" id="6098028">)</span><span class="op" id="6098029">;</span>&nbsp;<span class="ident" id="6098031">err</span>&nbsp;<span class="op" id="6098035">!=</span>&nbsp;<span class="ident" id="6098038">nil</span>&nbsp;<span class="op" id="6098042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098046">return</span>&nbsp;<span class="ident" id="6098053">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6098058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098061">encoding</span>&nbsp;<span class="op" id="6098070">:=</span>&nbsp;<span class="ident" id="6098073">base64</span><span class="op" id="6098079">.</span><span class="ident" id="6098080">StdEncoding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098093">mech</span><span class="op" id="6098097">,</span>&nbsp;<span class="ident" id="6098099">resp</span><span class="op" id="6098103">,</span>&nbsp;<span class="ident" id="6098105">err</span>&nbsp;<span class="op" id="6098109">:=</span>&nbsp;<span class="ident" id="6098112">a</span><span class="op" id="6098113">.</span><span class="ident" id="6098114">Start</span><span class="op" id="6098119">(</span><span class="op" id="6098120">&amp;</span><span class="ident" id="6098121">ServerInfo</span><span class="op" id="6098131">{</span><span class="ident" id="6098132">c</span><span class="op" id="6098133">.</span><span class="ident" id="6098134">serverName</span><span class="op" id="6098144">,</span>&nbsp;<span class="ident" id="6098146">c</span><span class="op" id="6098147">.</span><span class="ident" id="6098148">tls</span><span class="op" id="6098151">,</span>&nbsp;<span class="ident" id="6098153">c</span><span class="op" id="6098154">.</span><span class="ident" id="6098155">auth</span><span class="op" id="6098159">}</span><span class="op" id="6098160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098163">if</span>&nbsp;<span class="ident" id="6098166">err</span>&nbsp;<span class="op" id="6098170">!=</span>&nbsp;<span class="ident" id="6098173">nil</span>&nbsp;<span class="op" id="6098177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098181">c</span><span class="op" id="6098182">.</span><span class="ident" id="6098183">Quit</span><span class="op" id="6098187">(</span><span class="op" id="6098188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098192">return</span>&nbsp;<span class="ident" id="6098199">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6098204">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098207">resp64</span>&nbsp;<span class="op" id="6098214">:=</span>&nbsp;<span class="builtinfunc" id="6098217">make</span><span class="op" id="6098221">(</span><span class="op" id="6098222">[</span><span class="op" id="6098223">]</span><span class="builtintype" id="6098224">byte</span><span class="op" id="6098228">,</span>&nbsp;<span class="ident" id="6098230">encoding</span><span class="op" id="6098238">.</span><span class="ident" id="6098239">EncodedLen</span><span class="op" id="6098249">(</span><span class="builtinfunc" id="6098250">len</span><span class="op" id="6098253">(</span><span class="ident" id="6098254">resp</span><span class="op" id="6098258">)</span><span class="op" id="6098259">)</span><span class="op" id="6098260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098263">encoding</span><span class="op" id="6098271">.</span><span class="ident" id="6098272">Encode</span><span class="op" id="6098278">(</span><span class="ident" id="6098279">resp64</span><span class="op" id="6098285">,</span>&nbsp;<span class="ident" id="6098287">resp</span><span class="op" id="6098291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098294">code</span><span class="op" id="6098298">,</span>&nbsp;<span class="ident" id="6098300">msg64</span><span class="op" id="6098305">,</span>&nbsp;<span class="ident" id="6098307">err</span>&nbsp;<span class="op" id="6098311">:=</span>&nbsp;<span class="ident" id="6098314">c</span><span class="op" id="6098315">.</span><span class="ident" id="6098316">cmd</span><span class="op" id="6098319">(</span><span class="num" id="6098320">0</span><span class="op" id="6098321">,</span>&nbsp;<span class="string" id="6098323">&#34;AUTH&nbsp;%s&nbsp;%s&#34;</span><span class="op" id="6098335">,</span>&nbsp;<span class="ident" id="6098337">mech</span><span class="op" id="6098341">,</span>&nbsp;<span class="ident" id="6098343">resp64</span><span class="op" id="6098349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098352">for</span>&nbsp;<span class="ident" id="6098356">err</span>&nbsp;<span class="op" id="6098360">==</span>&nbsp;<span class="ident" id="6098363">nil</span>&nbsp;<span class="op" id="6098367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098371">var</span>&nbsp;<span class="ident" id="6098375">msg</span>&nbsp;<span class="op" id="6098379">[</span><span class="op" id="6098380">]</span><span class="builtintype" id="6098381">byte</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098388">switch</span>&nbsp;<span class="ident" id="6098395">code</span>&nbsp;<span class="op" id="6098400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098404">case</span>&nbsp;<span class="num" id="6098409">334</span><span class="op" id="6098412">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098417">msg</span><span class="op" id="6098420">,</span>&nbsp;<span class="ident" id="6098422">err</span>&nbsp;<span class="op" id="6098426">=</span>&nbsp;<span class="ident" id="6098428">encoding</span><span class="op" id="6098436">.</span><span class="ident" id="6098437">DecodeString</span><span class="op" id="6098449">(</span><span class="ident" id="6098450">msg64</span><span class="op" id="6098455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098459">case</span>&nbsp;<span class="num" id="6098464">235</span><span class="op" id="6098467">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6098472">//&nbsp;the&nbsp;last&nbsp;message&nbsp;isn&#39;t&nbsp;base64&nbsp;because&nbsp;it&nbsp;isn&#39;t&nbsp;a&nbsp;challenge</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098537">msg</span>&nbsp;<span class="op" id="6098541">=</span>&nbsp;<span class="op" id="6098543">[</span><span class="op" id="6098544">]</span><span class="builtintype" id="6098545">byte</span><span class="op" id="6098549">(</span><span class="ident" id="6098550">msg64</span><span class="op" id="6098555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098559">default</span><span class="op" id="6098566">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098571">err</span>&nbsp;<span class="op" id="6098575">=</span>&nbsp;<span class="op" id="6098577">&amp;</span><span class="ident" id="6098578">textproto</span><span class="op" id="6098587">.</span><span class="ident" id="6098588">Error</span><span class="op" id="6098593">{</span><span class="ident" id="6098594">Code</span><span class="op" id="6098598">:</span>&nbsp;<span class="ident" id="6098600">code</span><span class="op" id="6098604">,</span>&nbsp;<span class="ident" id="6098606">Msg</span><span class="op" id="6098609">:</span>&nbsp;<span class="ident" id="6098611">msg64</span><span class="op" id="6098616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6098620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098624">if</span>&nbsp;<span class="ident" id="6098627">err</span>&nbsp;<span class="op" id="6098631">==</span>&nbsp;<span class="ident" id="6098634">nil</span>&nbsp;<span class="op" id="6098638">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098643">resp</span><span class="op" id="6098647">,</span>&nbsp;<span class="ident" id="6098649">err</span>&nbsp;<span class="op" id="6098653">=</span>&nbsp;<span class="ident" id="6098655">a</span><span class="op" id="6098656">.</span><span class="ident" id="6098657">Next</span><span class="op" id="6098661">(</span><span class="ident" id="6098662">msg</span><span class="op" id="6098665">,</span>&nbsp;<span class="ident" id="6098667">code</span>&nbsp;<span class="op" id="6098672">==</span>&nbsp;<span class="num" id="6098675">334</span><span class="op" id="6098678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6098682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098686">if</span>&nbsp;<span class="ident" id="6098689">err</span>&nbsp;<span class="op" id="6098693">!=</span>&nbsp;<span class="ident" id="6098696">nil</span>&nbsp;<span class="op" id="6098700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6098705">//&nbsp;abort&nbsp;the&nbsp;AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098726">c</span><span class="op" id="6098727">.</span><span class="ident" id="6098728">cmd</span><span class="op" id="6098731">(</span><span class="num" id="6098732">501</span><span class="op" id="6098735">,</span>&nbsp;<span class="string" id="6098737">&#34;*&#34;</span><span class="op" id="6098740">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098745">c</span><span class="op" id="6098746">.</span><span class="ident" id="6098747">Quit</span><span class="op" id="6098751">(</span><span class="op" id="6098752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098757">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6098765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098769">if</span>&nbsp;<span class="ident" id="6098772">resp</span>&nbsp;<span class="op" id="6098777">==</span>&nbsp;<span class="ident" id="6098780">nil</span>&nbsp;<span class="op" id="6098784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098789">break</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6098797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098801">resp64</span>&nbsp;<span class="op" id="6098808">=</span>&nbsp;<span class="builtinfunc" id="6098810">make</span><span class="op" id="6098814">(</span><span class="op" id="6098815">[</span><span class="op" id="6098816">]</span><span class="builtintype" id="6098817">byte</span><span class="op" id="6098821">,</span>&nbsp;<span class="ident" id="6098823">encoding</span><span class="op" id="6098831">.</span><span class="ident" id="6098832">EncodedLen</span><span class="op" id="6098842">(</span><span class="builtinfunc" id="6098843">len</span><span class="op" id="6098846">(</span><span class="ident" id="6098847">resp</span><span class="op" id="6098851">)</span><span class="op" id="6098852">)</span><span class="op" id="6098853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098857">encoding</span><span class="op" id="6098865">.</span><span class="ident" id="6098866">Encode</span><span class="op" id="6098872">(</span><span class="ident" id="6098873">resp64</span><span class="op" id="6098879">,</span>&nbsp;<span class="ident" id="6098881">resp</span><span class="op" id="6098885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6098889">code</span><span class="op" id="6098893">,</span>&nbsp;<span class="ident" id="6098895">msg64</span><span class="op" id="6098900">,</span>&nbsp;<span class="ident" id="6098902">err</span>&nbsp;<span class="op" id="6098906">=</span>&nbsp;<span class="ident" id="6098908">c</span><span class="op" id="6098909">.</span><span class="ident" id="6098910">cmd</span><span class="op" id="6098913">(</span><span class="num" id="6098914">0</span><span class="op" id="6098915">,</span>&nbsp;<span class="builtintype" id="6098917">string</span><span class="op" id="6098923">(</span><span class="ident" id="6098924">resp64</span><span class="op" id="6098930">)</span><span class="op" id="6098931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6098934">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6098937">return</span>&nbsp;<span class="ident" id="6098944">err</span><br>
<span class="lineno"></span><span class="op" id="6098948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6098951">//&nbsp;Mail&nbsp;issues&nbsp;a&nbsp;MAIL&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="6099029">//&nbsp;If&nbsp;the&nbsp;server&nbsp;supports&nbsp;the&nbsp;8BITMIME&nbsp;extension,&nbsp;Mail&nbsp;adds&nbsp;the&nbsp;BODY=8BITMIME</span><br>
<span class="lineno">220</span><span class="comment" id="6099107">//&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="6099121">//&nbsp;This&nbsp;initiates&nbsp;a&nbsp;mail&nbsp;transaction&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;Rcpt&nbsp;calls.</span><br>
<span class="lineno"></span><span class="keyword" id="6099201">func</span>&nbsp;<span class="op" id="6099206">(</span><span class="ident" id="6099207">c</span>&nbsp;<span class="op" id="6099209">*</span><span class="ident" id="6099210">Client</span><span class="op" id="6099216">)</span>&nbsp;<span class="ident" id="6099218">Mail</span><span class="op" id="6099222">(</span><span class="ident" id="6099223">from</span>&nbsp;<span class="builtintype" id="6099228">string</span><span class="op" id="6099234">)</span>&nbsp;<span class="builtintype" id="6099236">error</span>&nbsp;<span class="op" id="6099242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099245">if</span>&nbsp;<span class="ident" id="6099248">err</span>&nbsp;<span class="op" id="6099252">:=</span>&nbsp;<span class="ident" id="6099255">c</span><span class="op" id="6099256">.</span><span class="ident" id="6099257">hello</span><span class="op" id="6099262">(</span><span class="op" id="6099263">)</span><span class="op" id="6099264">;</span>&nbsp;<span class="ident" id="6099266">err</span>&nbsp;<span class="op" id="6099270">!=</span>&nbsp;<span class="ident" id="6099273">nil</span>&nbsp;<span class="op" id="6099277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099281">return</span>&nbsp;<span class="ident" id="6099288">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6099293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099296">cmdStr</span>&nbsp;<span class="op" id="6099303">:=</span>&nbsp;<span class="string" id="6099306">&#34;MAIL&nbsp;FROM:&lt;%s&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099324">if</span>&nbsp;<span class="ident" id="6099327">c</span><span class="op" id="6099328">.</span><span class="ident" id="6099329">ext</span>&nbsp;<span class="op" id="6099333">!=</span>&nbsp;<span class="ident" id="6099336">nil</span>&nbsp;<span class="op" id="6099340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099344">if</span>&nbsp;<span class="ident" id="6099347">_</span><span class="op" id="6099348">,</span>&nbsp;<span class="ident" id="6099350">ok</span>&nbsp;<span class="op" id="6099353">:=</span>&nbsp;<span class="ident" id="6099356">c</span><span class="op" id="6099357">.</span><span class="ident" id="6099358">ext</span><span class="op" id="6099361">[</span><span class="string" id="6099362">&#34;8BITMIME&#34;</span><span class="op" id="6099372">]</span><span class="op" id="6099373">;</span>&nbsp;<span class="ident" id="6099375">ok</span>&nbsp;<span class="op" id="6099378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099383">cmdStr</span>&nbsp;<span class="op" id="6099390">+=</span>&nbsp;<span class="string" id="6099393">&#34;&nbsp;BODY=8BITMIME&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6099412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6099415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099418">_</span><span class="op" id="6099419">,</span>&nbsp;<span class="ident" id="6099421">_</span><span class="op" id="6099422">,</span>&nbsp;<span class="ident" id="6099424">err</span>&nbsp;<span class="op" id="6099428">:=</span>&nbsp;<span class="ident" id="6099431">c</span><span class="op" id="6099432">.</span><span class="ident" id="6099433">cmd</span><span class="op" id="6099436">(</span><span class="num" id="6099437">250</span><span class="op" id="6099440">,</span>&nbsp;<span class="ident" id="6099442">cmdStr</span><span class="op" id="6099448">,</span>&nbsp;<span class="ident" id="6099450">from</span><span class="op" id="6099454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099457">return</span>&nbsp;<span class="ident" id="6099464">err</span><br>
<span class="lineno"></span><span class="op" id="6099468">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="6099471">//&nbsp;Rcpt&nbsp;issues&nbsp;a&nbsp;RCPT&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="6099549">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Rcpt&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Mail&nbsp;and&nbsp;may&nbsp;be&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6099625">//&nbsp;a&nbsp;Data&nbsp;call&nbsp;or&nbsp;another&nbsp;Rcpt&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="6099662">func</span>&nbsp;<span class="op" id="6099667">(</span><span class="ident" id="6099668">c</span>&nbsp;<span class="op" id="6099670">*</span><span class="ident" id="6099671">Client</span><span class="op" id="6099677">)</span>&nbsp;<span class="ident" id="6099679">Rcpt</span><span class="op" id="6099683">(</span><span class="ident" id="6099684">to</span>&nbsp;<span class="builtintype" id="6099687">string</span><span class="op" id="6099693">)</span>&nbsp;<span class="builtintype" id="6099695">error</span>&nbsp;<span class="op" id="6099701">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099704">_</span><span class="op" id="6099705">,</span>&nbsp;<span class="ident" id="6099707">_</span><span class="op" id="6099708">,</span>&nbsp;<span class="ident" id="6099710">err</span>&nbsp;<span class="op" id="6099714">:=</span>&nbsp;<span class="ident" id="6099717">c</span><span class="op" id="6099718">.</span><span class="ident" id="6099719">cmd</span><span class="op" id="6099722">(</span><span class="num" id="6099723">25</span><span class="op" id="6099725">,</span>&nbsp;<span class="string" id="6099727">&#34;RCPT&nbsp;TO:&lt;%s&gt;&#34;</span><span class="op" id="6099741">,</span>&nbsp;<span class="ident" id="6099743">to</span><span class="op" id="6099745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099748">return</span>&nbsp;<span class="ident" id="6099755">err</span><br>
<span class="lineno"></span><span class="op" id="6099759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6099762">type</span>&nbsp;<span class="ident" id="6099767">dataCloser</span>&nbsp;<span class="keyword" id="6099778">struct</span>&nbsp;<span class="op" id="6099785">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099788">c</span>&nbsp;<span class="op" id="6099790">*</span><span class="ident" id="6099791">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099799">io</span><span class="op" id="6099801">.</span><span class="ident" id="6099802">WriteCloser</span><br>
<span class="lineno"></span><span class="op" id="6099814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6099817">func</span>&nbsp;<span class="op" id="6099822">(</span><span class="ident" id="6099823">d</span>&nbsp;<span class="op" id="6099825">*</span><span class="ident" id="6099826">dataCloser</span><span class="op" id="6099836">)</span>&nbsp;<span class="ident" id="6099838">Close</span><span class="op" id="6099843">(</span><span class="op" id="6099844">)</span>&nbsp;<span class="builtintype" id="6099846">error</span>&nbsp;<span class="op" id="6099852">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099855">d</span><span class="op" id="6099856">.</span><span class="ident" id="6099857">WriteCloser</span><span class="op" id="6099868">.</span><span class="ident" id="6099869">Close</span><span class="op" id="6099874">(</span><span class="op" id="6099875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6099878">_</span><span class="op" id="6099879">,</span>&nbsp;<span class="ident" id="6099881">_</span><span class="op" id="6099882">,</span>&nbsp;<span class="ident" id="6099884">err</span>&nbsp;<span class="op" id="6099888">:=</span>&nbsp;<span class="ident" id="6099891">d</span><span class="op" id="6099892">.</span><span class="ident" id="6099893">c</span><span class="op" id="6099894">.</span><span class="ident" id="6099895">Text</span><span class="op" id="6099899">.</span><span class="ident" id="6099900">ReadResponse</span><span class="op" id="6099912">(</span><span class="num" id="6099913">250</span><span class="op" id="6099916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6099919">return</span>&nbsp;<span class="ident" id="6099926">err</span><br>
<span class="lineno"></span><span class="op" id="6099930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="6099933">//&nbsp;Data&nbsp;issues&nbsp;a&nbsp;DATA&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;and&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="6100003">//&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;the&nbsp;data.&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the&nbsp;writer</span><br>
<span class="lineno"></span><span class="comment" id="6100072">//&nbsp;before&nbsp;calling&nbsp;any&nbsp;more&nbsp;methods&nbsp;on&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6100113">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Data&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;calls&nbsp;to&nbsp;Rcpt.</span><br>
<span class="lineno"></span><span class="keyword" id="6100178">func</span>&nbsp;<span class="op" id="6100183">(</span><span class="ident" id="6100184">c</span>&nbsp;<span class="op" id="6100186">*</span><span class="ident" id="6100187">Client</span><span class="op" id="6100193">)</span>&nbsp;<span class="ident" id="6100195">Data</span><span class="op" id="6100199">(</span><span class="op" id="6100200">)</span>&nbsp;<span class="op" id="6100202">(</span><span class="ident" id="6100203">io</span><span class="op" id="6100205">.</span><span class="ident" id="6100206">WriteCloser</span><span class="op" id="6100217">,</span>&nbsp;<span class="builtintype" id="6100219">error</span><span class="op" id="6100224">)</span>&nbsp;<span class="op" id="6100226">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6100229">_</span><span class="op" id="6100230">,</span>&nbsp;<span class="ident" id="6100232">_</span><span class="op" id="6100233">,</span>&nbsp;<span class="ident" id="6100235">err</span>&nbsp;<span class="op" id="6100239">:=</span>&nbsp;<span class="ident" id="6100242">c</span><span class="op" id="6100243">.</span><span class="ident" id="6100244">cmd</span><span class="op" id="6100247">(</span><span class="num" id="6100248">354</span><span class="op" id="6100251">,</span>&nbsp;<span class="string" id="6100253">&#34;DATA&#34;</span><span class="op" id="6100259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6100262">if</span>&nbsp;<span class="ident" id="6100265">err</span>&nbsp;<span class="op" id="6100269">!=</span>&nbsp;<span class="ident" id="6100272">nil</span>&nbsp;<span class="op" id="6100276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6100280">return</span>&nbsp;<span class="ident" id="6100287">nil</span><span class="op" id="6100290">,</span>&nbsp;<span class="ident" id="6100292">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6100297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6100300">return</span>&nbsp;<span class="op" id="6100307">&amp;</span><span class="ident" id="6100308">dataCloser</span><span class="op" id="6100318">{</span><span class="ident" id="6100319">c</span><span class="op" id="6100320">,</span>&nbsp;<span class="ident" id="6100322">c</span><span class="op" id="6100323">.</span><span class="ident" id="6100324">Text</span><span class="op" id="6100328">.</span><span class="ident" id="6100329">DotWriter</span><span class="op" id="6100338">(</span><span class="op" id="6100339">)</span><span class="op" id="6100340">}</span><span class="op" id="6100341">,</span>&nbsp;<span class="ident" id="6100343">nil</span><br>
<span class="lineno">265</span><span class="op" id="6100347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6100350">var</span>&nbsp;<span class="ident" id="6100354">testHookStartTLS</span>&nbsp;<span class="keyword" id="6100371">func</span><span class="op" id="6100375">(</span><span class="op" id="6100376">*</span><span class="ident" id="6100377">tls</span><span class="op" id="6100380">.</span><span class="ident" id="6100381">Config</span><span class="op" id="6100387">)</span>&nbsp;<span class="comment" id="6100389">//&nbsp;nil,&nbsp;except&nbsp;for&nbsp;tests</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6100415">//&nbsp;SendMail&nbsp;connects&nbsp;to&nbsp;the&nbsp;server&nbsp;at&nbsp;addr,&nbsp;switches&nbsp;to&nbsp;TLS&nbsp;if</span><br>
<span class="lineno">270</span><span class="comment" id="6100478">//&nbsp;possible,&nbsp;authenticates&nbsp;with&nbsp;the&nbsp;optional&nbsp;mechanism&nbsp;a&nbsp;if&nbsp;possible,</span><br>
<span class="lineno"></span><span class="comment" id="6100548">//&nbsp;and&nbsp;then&nbsp;sends&nbsp;an&nbsp;email&nbsp;from&nbsp;address&nbsp;from,&nbsp;to&nbsp;addresses&nbsp;to,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6100616">//&nbsp;message&nbsp;msg.</span><br>
<span class="lineno"></span><span class="keyword" id="6100632">func</span>&nbsp;<span class="ident" id="6100637">SendMail</span><span class="op" id="6100645">(</span><span class="ident" id="6100646">addr</span>&nbsp;<span class="builtintype" id="6100651">string</span><span class="op" id="6100657">,</span>&nbsp;<span class="ident" id="6100659">a</span>&nbsp;<span class="ident" id="6100661">Auth</span><span class="op" id="6100665">,</span>&nbsp;<span class="ident" id="6100667">from</span>&nbsp;<span class="builtintype" id="6100672">string</span><span class="op" id="6100678">,</span>&nbsp;<span class="ident" id="6100680">to</span>&nbsp;<span class="op" id="6100683">[</span><span class="op" id="6100684">]</span><span class="builtintype" id="6100685">string</span><span class="op" id="6100691">,</span>&nbsp;<span class="ident" id="6100693">msg</span>&nbsp;<span class="op" id="6100697">[</span><span class="op" id="6100698">]</span><span class="builtintype" id="6100699">byte</span><span class="op" id="6100703">)</span>&nbsp;<span class="builtintype" id="6100705">error</span>&nbsp;<span class="op" id="6100711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6100714">c</span><span class="op" id="6100715">,</span>&nbsp;<span class="ident" id="6100717">err</span>&nbsp;<span class="op" id="6100721">:=</span>&nbsp;<span class="ident" id="6100724">Dial</span><span class="op" id="6100728">(</span><span class="ident" id="6100729">addr</span><span class="op" id="6100733">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6100736">if</span>&nbsp;<span class="ident" id="6100739">err</span>&nbsp;<span class="op" id="6100743">!=</span>&nbsp;<span class="ident" id="6100746">nil</span>&nbsp;<span class="op" id="6100750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6100754">return</span>&nbsp;<span class="ident" id="6100761">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6100766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6100769">defer</span>&nbsp;<span class="ident" id="6100775">c</span><span class="op" id="6100776">.</span><span class="ident" id="6100777">Close</span><span class="op" id="6100782">(</span><span class="op" id="6100783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6100786">if</span>&nbsp;<span class="ident" id="6100789">err</span>&nbsp;<span class="op" id="6100793">=</span>&nbsp;<span class="ident" id="6100795">c</span><span class="op" id="6100796">.</span><span class="ident" id="6100797">hello</span><span class="op" id="6100802">(</span><span class="op" id="6100803">)</span><span class="op" id="6100804">;</span>&nbsp;<span class="ident" id="6100806">err</span>&nbsp;<span class="op" id="6100810">!=</span>&nbsp;<span class="ident" id="6100813">nil</span>&nbsp;<span class="op" id="6100817">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6100821">return</span>&nbsp;<span class="ident" id="6100828">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6100833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6100836">if</span>&nbsp;<span class="ident" id="6100839">ok</span><span class="op" id="6100841">,</span>&nbsp;<span class="ident" id="6100843">_</span>&nbsp;<span class="op" id="6100845">:=</span>&nbsp;<span class="ident" id="6100848">c</span><span class="op" id="6100849">.</span><span class="ident" id="6100850">Extension</span><span class="op" id="6100859">(</span><span class="string" id="6100860">&#34;STARTTLS&#34;</span><span class="op" id="6100870">)</span><span class="op" id="6100871">;</span>&nbsp;<span class="ident" id="6100873">ok</span>&nbsp;<span class="op" id="6100876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6100880">config</span>&nbsp;<span class="op" id="6100887">:=</span>&nbsp;<span class="op" id="6100890">&amp;</span><span class="ident" id="6100891">tls</span><span class="op" id="6100894">.</span><span class="ident" id="6100895">Config</span><span class="op" id="6100901">{</span><span class="ident" id="6100902">ServerName</span><span class="op" id="6100912">:</span>&nbsp;<span class="ident" id="6100914">c</span><span class="op" id="6100915">.</span><span class="ident" id="6100916">serverName</span><span class="op" id="6100926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6100930">if</span>&nbsp;<span class="ident" id="6100933">testHookStartTLS</span>&nbsp;<span class="op" id="6100950">!=</span>&nbsp;<span class="ident" id="6100953">nil</span>&nbsp;<span class="op" id="6100957">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6100962">testHookStartTLS</span><span class="op" id="6100978">(</span><span class="ident" id="6100979">config</span><span class="op" id="6100985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6100989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6100993">if</span>&nbsp;<span class="ident" id="6100996">err</span>&nbsp;<span class="op" id="6101000">=</span>&nbsp;<span class="ident" id="6101002">c</span><span class="op" id="6101003">.</span><span class="ident" id="6101004">StartTLS</span><span class="op" id="6101012">(</span><span class="ident" id="6101013">config</span><span class="op" id="6101019">)</span><span class="op" id="6101020">;</span>&nbsp;<span class="ident" id="6101022">err</span>&nbsp;<span class="op" id="6101026">!=</span>&nbsp;<span class="ident" id="6101029">nil</span>&nbsp;<span class="op" id="6101033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101038">return</span>&nbsp;<span class="ident" id="6101045">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6101051">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6101054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101057">if</span>&nbsp;<span class="ident" id="6101060">a</span>&nbsp;<span class="op" id="6101062">!=</span>&nbsp;<span class="ident" id="6101065">nil</span>&nbsp;<span class="op" id="6101069">&amp;&amp;</span>&nbsp;<span class="ident" id="6101072">c</span><span class="op" id="6101073">.</span><span class="ident" id="6101074">ext</span>&nbsp;<span class="op" id="6101078">!=</span>&nbsp;<span class="ident" id="6101081">nil</span>&nbsp;<span class="op" id="6101085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101089">if</span>&nbsp;<span class="ident" id="6101092">_</span><span class="op" id="6101093">,</span>&nbsp;<span class="ident" id="6101095">ok</span>&nbsp;<span class="op" id="6101098">:=</span>&nbsp;<span class="ident" id="6101101">c</span><span class="op" id="6101102">.</span><span class="ident" id="6101103">ext</span><span class="op" id="6101106">[</span><span class="string" id="6101107">&#34;AUTH&#34;</span><span class="op" id="6101113">]</span><span class="op" id="6101114">;</span>&nbsp;<span class="ident" id="6101116">ok</span>&nbsp;<span class="op" id="6101119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101124">if</span>&nbsp;<span class="ident" id="6101127">err</span>&nbsp;<span class="op" id="6101131">=</span>&nbsp;<span class="ident" id="6101133">c</span><span class="op" id="6101134">.</span><span class="ident" id="6101135">Auth</span><span class="op" id="6101139">(</span><span class="ident" id="6101140">a</span><span class="op" id="6101141">)</span><span class="op" id="6101142">;</span>&nbsp;<span class="ident" id="6101144">err</span>&nbsp;<span class="op" id="6101148">!=</span>&nbsp;<span class="ident" id="6101151">nil</span>&nbsp;<span class="op" id="6101155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101161">return</span>&nbsp;<span class="ident" id="6101168">err</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6101175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6101179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6101182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101185">if</span>&nbsp;<span class="ident" id="6101188">err</span>&nbsp;<span class="op" id="6101192">=</span>&nbsp;<span class="ident" id="6101194">c</span><span class="op" id="6101195">.</span><span class="ident" id="6101196">Mail</span><span class="op" id="6101200">(</span><span class="ident" id="6101201">from</span><span class="op" id="6101205">)</span><span class="op" id="6101206">;</span>&nbsp;<span class="ident" id="6101208">err</span>&nbsp;<span class="op" id="6101212">!=</span>&nbsp;<span class="ident" id="6101215">nil</span>&nbsp;<span class="op" id="6101219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101223">return</span>&nbsp;<span class="ident" id="6101230">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6101235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101238">for</span>&nbsp;<span class="ident" id="6101242">_</span><span class="op" id="6101243">,</span>&nbsp;<span class="ident" id="6101245">addr</span>&nbsp;<span class="op" id="6101250">:=</span>&nbsp;<span class="keyword" id="6101253">range</span>&nbsp;<span class="ident" id="6101259">to</span>&nbsp;<span class="op" id="6101262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101266">if</span>&nbsp;<span class="ident" id="6101269">err</span>&nbsp;<span class="op" id="6101273">=</span>&nbsp;<span class="ident" id="6101275">c</span><span class="op" id="6101276">.</span><span class="ident" id="6101277">Rcpt</span><span class="op" id="6101281">(</span><span class="ident" id="6101282">addr</span><span class="op" id="6101286">)</span><span class="op" id="6101287">;</span>&nbsp;<span class="ident" id="6101289">err</span>&nbsp;<span class="op" id="6101293">!=</span>&nbsp;<span class="ident" id="6101296">nil</span>&nbsp;<span class="op" id="6101300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101305">return</span>&nbsp;<span class="ident" id="6101312">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6101318">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6101321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6101324">w</span><span class="op" id="6101325">,</span>&nbsp;<span class="ident" id="6101327">err</span>&nbsp;<span class="op" id="6101331">:=</span>&nbsp;<span class="ident" id="6101334">c</span><span class="op" id="6101335">.</span><span class="ident" id="6101336">Data</span><span class="op" id="6101340">(</span><span class="op" id="6101341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101344">if</span>&nbsp;<span class="ident" id="6101347">err</span>&nbsp;<span class="op" id="6101351">!=</span>&nbsp;<span class="ident" id="6101354">nil</span>&nbsp;<span class="op" id="6101358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101362">return</span>&nbsp;<span class="ident" id="6101369">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6101374">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6101377">_</span><span class="op" id="6101378">,</span>&nbsp;<span class="ident" id="6101380">err</span>&nbsp;<span class="op" id="6101384">=</span>&nbsp;<span class="ident" id="6101386">w</span><span class="op" id="6101387">.</span><span class="ident" id="6101388">Write</span><span class="op" id="6101393">(</span><span class="ident" id="6101394">msg</span><span class="op" id="6101397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101400">if</span>&nbsp;<span class="ident" id="6101403">err</span>&nbsp;<span class="op" id="6101407">!=</span>&nbsp;<span class="ident" id="6101410">nil</span>&nbsp;<span class="op" id="6101414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101418">return</span>&nbsp;<span class="ident" id="6101425">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6101430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6101433">err</span>&nbsp;<span class="op" id="6101437">=</span>&nbsp;<span class="ident" id="6101439">w</span><span class="op" id="6101440">.</span><span class="ident" id="6101441">Close</span><span class="op" id="6101446">(</span><span class="op" id="6101447">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101450">if</span>&nbsp;<span class="ident" id="6101453">err</span>&nbsp;<span class="op" id="6101457">!=</span>&nbsp;<span class="ident" id="6101460">nil</span>&nbsp;<span class="op" id="6101464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101468">return</span>&nbsp;<span class="ident" id="6101475">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6101480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101483">return</span>&nbsp;<span class="ident" id="6101490">c</span><span class="op" id="6101491">.</span><span class="ident" id="6101492">Quit</span><span class="op" id="6101496">(</span><span class="op" id="6101497">)</span><br>
<span class="lineno"></span><span class="op" id="6101499">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="6101502">//&nbsp;Extension&nbsp;reports&nbsp;whether&nbsp;an&nbsp;extension&nbsp;is&nbsp;support&nbsp;by&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6101570">//&nbsp;The&nbsp;extension&nbsp;name&nbsp;is&nbsp;case-insensitive.&nbsp;If&nbsp;the&nbsp;extension&nbsp;is&nbsp;supported,</span><br>
<span class="lineno"></span><span class="comment" id="6101644">//&nbsp;Extension&nbsp;also&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;contains&nbsp;any&nbsp;parameters&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6101712">//&nbsp;server&nbsp;specifies&nbsp;for&nbsp;the&nbsp;extension.</span><br>
<span class="lineno">325</span><span class="keyword" id="6101751">func</span>&nbsp;<span class="op" id="6101756">(</span><span class="ident" id="6101757">c</span>&nbsp;<span class="op" id="6101759">*</span><span class="ident" id="6101760">Client</span><span class="op" id="6101766">)</span>&nbsp;<span class="ident" id="6101768">Extension</span><span class="op" id="6101777">(</span><span class="ident" id="6101778">ext</span>&nbsp;<span class="builtintype" id="6101782">string</span><span class="op" id="6101788">)</span>&nbsp;<span class="op" id="6101790">(</span><span class="builtintype" id="6101791">bool</span><span class="op" id="6101795">,</span>&nbsp;<span class="builtintype" id="6101797">string</span><span class="op" id="6101803">)</span>&nbsp;<span class="op" id="6101805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101808">if</span>&nbsp;<span class="ident" id="6101811">err</span>&nbsp;<span class="op" id="6101815">:=</span>&nbsp;<span class="ident" id="6101818">c</span><span class="op" id="6101819">.</span><span class="ident" id="6101820">hello</span><span class="op" id="6101825">(</span><span class="op" id="6101826">)</span><span class="op" id="6101827">;</span>&nbsp;<span class="ident" id="6101829">err</span>&nbsp;<span class="op" id="6101833">!=</span>&nbsp;<span class="ident" id="6101836">nil</span>&nbsp;<span class="op" id="6101840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101844">return</span>&nbsp;<span class="builtintype" id="6101851">false</span><span class="op" id="6101856">,</span>&nbsp;<span class="string" id="6101858">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6101862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101865">if</span>&nbsp;<span class="ident" id="6101868">c</span><span class="op" id="6101869">.</span><span class="ident" id="6101870">ext</span>&nbsp;<span class="op" id="6101874">==</span>&nbsp;<span class="ident" id="6101877">nil</span>&nbsp;<span class="op" id="6101881">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101885">return</span>&nbsp;<span class="builtintype" id="6101892">false</span><span class="op" id="6101897">,</span>&nbsp;<span class="string" id="6101899">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6101903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6101906">ext</span>&nbsp;<span class="op" id="6101910">=</span>&nbsp;<span class="ident" id="6101912">strings</span><span class="op" id="6101919">.</span><span class="ident" id="6101920">ToUpper</span><span class="op" id="6101927">(</span><span class="ident" id="6101928">ext</span><span class="op" id="6101931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6101934">param</span><span class="op" id="6101939">,</span>&nbsp;<span class="ident" id="6101941">ok</span>&nbsp;<span class="op" id="6101944">:=</span>&nbsp;<span class="ident" id="6101947">c</span><span class="op" id="6101948">.</span><span class="ident" id="6101949">ext</span><span class="op" id="6101952">[</span><span class="ident" id="6101953">ext</span><span class="op" id="6101956">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6101959">return</span>&nbsp;<span class="ident" id="6101966">ok</span><span class="op" id="6101968">,</span>&nbsp;<span class="ident" id="6101970">param</span><br>
<span class="lineno">335</span><span class="op" id="6101976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6101979">//&nbsp;Reset&nbsp;sends&nbsp;the&nbsp;RSET&nbsp;command&nbsp;to&nbsp;the&nbsp;server,&nbsp;aborting&nbsp;the&nbsp;current&nbsp;mail</span><br>
<span class="lineno"></span><span class="comment" id="6102052">//&nbsp;transaction.</span><br>
<span class="lineno"></span><span class="keyword" id="6102068">func</span>&nbsp;<span class="op" id="6102073">(</span><span class="ident" id="6102074">c</span>&nbsp;<span class="op" id="6102076">*</span><span class="ident" id="6102077">Client</span><span class="op" id="6102083">)</span>&nbsp;<span class="ident" id="6102085">Reset</span><span class="op" id="6102090">(</span><span class="op" id="6102091">)</span>&nbsp;<span class="builtintype" id="6102093">error</span>&nbsp;<span class="op" id="6102099">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102102">if</span>&nbsp;<span class="ident" id="6102105">err</span>&nbsp;<span class="op" id="6102109">:=</span>&nbsp;<span class="ident" id="6102112">c</span><span class="op" id="6102113">.</span><span class="ident" id="6102114">hello</span><span class="op" id="6102119">(</span><span class="op" id="6102120">)</span><span class="op" id="6102121">;</span>&nbsp;<span class="ident" id="6102123">err</span>&nbsp;<span class="op" id="6102127">!=</span>&nbsp;<span class="ident" id="6102130">nil</span>&nbsp;<span class="op" id="6102134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102138">return</span>&nbsp;<span class="ident" id="6102145">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6102150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6102153">_</span><span class="op" id="6102154">,</span>&nbsp;<span class="ident" id="6102156">_</span><span class="op" id="6102157">,</span>&nbsp;<span class="ident" id="6102159">err</span>&nbsp;<span class="op" id="6102163">:=</span>&nbsp;<span class="ident" id="6102166">c</span><span class="op" id="6102167">.</span><span class="ident" id="6102168">cmd</span><span class="op" id="6102171">(</span><span class="num" id="6102172">250</span><span class="op" id="6102175">,</span>&nbsp;<span class="string" id="6102177">&#34;RSET&#34;</span><span class="op" id="6102183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102186">return</span>&nbsp;<span class="ident" id="6102193">err</span><br>
<span class="lineno">345</span><span class="op" id="6102197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6102200">//&nbsp;Quit&nbsp;sends&nbsp;the&nbsp;QUIT&nbsp;command&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6102272">func</span>&nbsp;<span class="op" id="6102277">(</span><span class="ident" id="6102278">c</span>&nbsp;<span class="op" id="6102280">*</span><span class="ident" id="6102281">Client</span><span class="op" id="6102287">)</span>&nbsp;<span class="ident" id="6102289">Quit</span><span class="op" id="6102293">(</span><span class="op" id="6102294">)</span>&nbsp;<span class="builtintype" id="6102296">error</span>&nbsp;<span class="op" id="6102302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102305">if</span>&nbsp;<span class="ident" id="6102308">err</span>&nbsp;<span class="op" id="6102312">:=</span>&nbsp;<span class="ident" id="6102315">c</span><span class="op" id="6102316">.</span><span class="ident" id="6102317">hello</span><span class="op" id="6102322">(</span><span class="op" id="6102323">)</span><span class="op" id="6102324">;</span>&nbsp;<span class="ident" id="6102326">err</span>&nbsp;<span class="op" id="6102330">!=</span>&nbsp;<span class="ident" id="6102333">nil</span>&nbsp;<span class="op" id="6102337">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102341">return</span>&nbsp;<span class="ident" id="6102348">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6102353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6102356">_</span><span class="op" id="6102357">,</span>&nbsp;<span class="ident" id="6102359">_</span><span class="op" id="6102360">,</span>&nbsp;<span class="ident" id="6102362">err</span>&nbsp;<span class="op" id="6102366">:=</span>&nbsp;<span class="ident" id="6102369">c</span><span class="op" id="6102370">.</span><span class="ident" id="6102371">cmd</span><span class="op" id="6102374">(</span><span class="num" id="6102375">221</span><span class="op" id="6102378">,</span>&nbsp;<span class="string" id="6102380">&#34;QUIT&#34;</span><span class="op" id="6102386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102389">if</span>&nbsp;<span class="ident" id="6102392">err</span>&nbsp;<span class="op" id="6102396">!=</span>&nbsp;<span class="ident" id="6102399">nil</span>&nbsp;<span class="op" id="6102403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102407">return</span>&nbsp;<span class="ident" id="6102414">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6102419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6102422">return</span>&nbsp;<span class="ident" id="6102429">c</span><span class="op" id="6102430">.</span><span class="ident" id="6102431">Text</span><span class="op" id="6102435">.</span><span class="ident" id="6102436">Close</span><span class="op" id="6102441">(</span><span class="op" id="6102442">)</span><br>
<span class="lineno"></span><span class="op" id="6102444">}</span>
</div>
</body>
</html>
