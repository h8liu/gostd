<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3529250">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3529305">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3529359">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3529410">//&nbsp;The&nbsp;file&nbsp;define&nbsp;a&nbsp;quoted-printable&nbsp;decoder,&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;2045.</span><br>
<span class="lineno"></span><span class="comment" id="3529483">//&nbsp;Deviations:</span><br>
<span class="lineno"></span><span class="comment" id="3529498">//&nbsp;1.&nbsp;in&nbsp;addition&nbsp;to&nbsp;&#34;=\r\n&#34;,&nbsp;&#34;=\n&#34;&nbsp;is&nbsp;also&nbsp;treated&nbsp;as&nbsp;soft&nbsp;line&nbsp;break.</span><br>
<span class="lineno"></span><span class="comment" id="3529570">//&nbsp;2.&nbsp;it&nbsp;will&nbsp;pass&nbsp;through&nbsp;a&nbsp;&#39;\r&#39;&nbsp;or&nbsp;&#39;\n&#39;&nbsp;not&nbsp;preceded&nbsp;by&nbsp;&#39;=&#39;,&nbsp;consistent</span><br>
<span class="lineno"></span><span class="comment" id="3529644">//&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;other&nbsp;broken&nbsp;QP&nbsp;encoders&nbsp;&amp;&nbsp;decoders.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="3529693">package</span>&nbsp;<span class="ident" id="3529701">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3529712">import</span>&nbsp;<span class="op" id="3529719">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3529722">&#34;bufio&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3529731">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3529740">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3529747">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3529752">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3529755">type</span>&nbsp;<span class="ident" id="3529760">qpReader</span>&nbsp;<span class="keyword" id="3529769">struct</span>&nbsp;<span class="op" id="3529776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529779">br</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3529784">*</span><span class="ident" id="3529785">bufio</span><span class="op" id="3529790">.</span><span class="ident" id="3529791">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529799">rerr</span>&nbsp;<span class="builtintype" id="3529804">error</span>&nbsp;&nbsp;<span class="comment" id="3529811">//&nbsp;last&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529831">line</span>&nbsp;<span class="op" id="3529836">[</span><span class="op" id="3529837">]</span><span class="builtintype" id="3529838">byte</span>&nbsp;<span class="comment" id="3529843">//&nbsp;to&nbsp;be&nbsp;consumed&nbsp;before&nbsp;more&nbsp;of&nbsp;br</span><br>
<span class="lineno"></span><span class="op" id="3529879">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3529882">func</span>&nbsp;<span class="ident" id="3529887">newQuotedPrintableReader</span><span class="op" id="3529911">(</span><span class="ident" id="3529912">r</span>&nbsp;<span class="ident" id="3529914">io</span><span class="op" id="3529916">.</span><span class="ident" id="3529917">Reader</span><span class="op" id="3529923">)</span>&nbsp;<span class="ident" id="3529925">io</span><span class="op" id="3529927">.</span><span class="ident" id="3529928">Reader</span>&nbsp;<span class="op" id="3529935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529938">return</span>&nbsp;<span class="op" id="3529945">&amp;</span><span class="ident" id="3529946">qpReader</span><span class="op" id="3529954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529958">br</span><span class="op" id="3529960">:</span>&nbsp;<span class="ident" id="3529962">bufio</span><span class="op" id="3529967">.</span><span class="ident" id="3529968">NewReader</span><span class="op" id="3529977">(</span><span class="ident" id="3529978">r</span><span class="op" id="3529979">)</span><span class="op" id="3529980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3529983">}</span><br>
<span class="lineno">30</span><span class="op" id="3529985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3529988">func</span>&nbsp;<span class="ident" id="3529993">fromHex</span><span class="op" id="3530000">(</span><span class="ident" id="3530001">b</span>&nbsp;<span class="builtintype" id="3530003">byte</span><span class="op" id="3530007">)</span>&nbsp;<span class="op" id="3530009">(</span><span class="builtintype" id="3530010">byte</span><span class="op" id="3530014">,</span>&nbsp;<span class="builtintype" id="3530016">error</span><span class="op" id="3530021">)</span>&nbsp;<span class="op" id="3530023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530026">switch</span>&nbsp;<span class="op" id="3530033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530036">case</span>&nbsp;<span class="ident" id="3530041">b</span>&nbsp;<span class="op" id="3530043">&gt;=</span>&nbsp;<span class="string" id="3530046">&#39;0&#39;</span>&nbsp;<span class="op" id="3530050">&amp;&amp;</span>&nbsp;<span class="ident" id="3530053">b</span>&nbsp;<span class="op" id="3530055">&lt;=</span>&nbsp;<span class="string" id="3530058">&#39;9&#39;</span><span class="op" id="3530061">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530065">return</span>&nbsp;<span class="ident" id="3530072">b</span>&nbsp;<span class="op" id="3530074">-</span>&nbsp;<span class="string" id="3530076">&#39;0&#39;</span><span class="op" id="3530079">,</span>&nbsp;<span class="ident" id="3530081">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530086">case</span>&nbsp;<span class="ident" id="3530091">b</span>&nbsp;<span class="op" id="3530093">&gt;=</span>&nbsp;<span class="string" id="3530096">&#39;A&#39;</span>&nbsp;<span class="op" id="3530100">&amp;&amp;</span>&nbsp;<span class="ident" id="3530103">b</span>&nbsp;<span class="op" id="3530105">&lt;=</span>&nbsp;<span class="string" id="3530108">&#39;F&#39;</span><span class="op" id="3530111">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530115">return</span>&nbsp;<span class="ident" id="3530122">b</span>&nbsp;<span class="op" id="3530124">-</span>&nbsp;<span class="string" id="3530126">&#39;A&#39;</span>&nbsp;<span class="op" id="3530130">+</span>&nbsp;<span class="num" id="3530132">10</span><span class="op" id="3530134">,</span>&nbsp;<span class="ident" id="3530136">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530144">return</span>&nbsp;<span class="num" id="3530151">0</span><span class="op" id="3530152">,</span>&nbsp;<span class="ident" id="3530154">fmt</span><span class="op" id="3530157">.</span><span class="ident" id="3530158">Errorf</span><span class="op" id="3530164">(</span><span class="string" id="3530165">&#34;multipart:&nbsp;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;0x%02x&#34;</span><span class="op" id="3530218">,</span>&nbsp;<span class="ident" id="3530220">b</span><span class="op" id="3530221">)</span><br>
<span class="lineno">40</span><span class="op" id="3530223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3530226">func</span>&nbsp;<span class="op" id="3530231">(</span><span class="ident" id="3530232">q</span>&nbsp;<span class="op" id="3530234">*</span><span class="ident" id="3530235">qpReader</span><span class="op" id="3530243">)</span>&nbsp;<span class="ident" id="3530245">readHexByte</span><span class="op" id="3530256">(</span><span class="ident" id="3530257">v</span>&nbsp;<span class="op" id="3530259">[</span><span class="op" id="3530260">]</span><span class="builtintype" id="3530261">byte</span><span class="op" id="3530265">)</span>&nbsp;<span class="op" id="3530267">(</span><span class="ident" id="3530268">b</span>&nbsp;<span class="builtintype" id="3530270">byte</span><span class="op" id="3530274">,</span>&nbsp;<span class="ident" id="3530276">err</span>&nbsp;<span class="builtintype" id="3530280">error</span><span class="op" id="3530285">)</span>&nbsp;<span class="op" id="3530287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530290">if</span>&nbsp;<span class="builtinfunc" id="3530293">len</span><span class="op" id="3530296">(</span><span class="ident" id="3530297">v</span><span class="op" id="3530298">)</span>&nbsp;<span class="op" id="3530300">&lt;</span>&nbsp;<span class="num" id="3530302">2</span>&nbsp;<span class="op" id="3530304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530308">return</span>&nbsp;<span class="num" id="3530315">0</span><span class="op" id="3530316">,</span>&nbsp;<span class="ident" id="3530318">io</span><span class="op" id="3530320">.</span><span class="ident" id="3530321">ErrUnexpectedEOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530342">var</span>&nbsp;<span class="ident" id="3530346">hb</span><span class="op" id="3530348">,</span>&nbsp;<span class="ident" id="3530350">lb</span>&nbsp;<span class="builtintype" id="3530353">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530359">if</span>&nbsp;<span class="ident" id="3530362">hb</span><span class="op" id="3530364">,</span>&nbsp;<span class="ident" id="3530366">err</span>&nbsp;<span class="op" id="3530370">=</span>&nbsp;<span class="ident" id="3530372">fromHex</span><span class="op" id="3530379">(</span><span class="ident" id="3530380">v</span><span class="op" id="3530381">[</span><span class="num" id="3530382">0</span><span class="op" id="3530383">]</span><span class="op" id="3530384">)</span><span class="op" id="3530385">;</span>&nbsp;<span class="ident" id="3530387">err</span>&nbsp;<span class="op" id="3530391">!=</span>&nbsp;<span class="ident" id="3530394">nil</span>&nbsp;<span class="op" id="3530398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530402">return</span>&nbsp;<span class="num" id="3530409">0</span><span class="op" id="3530410">,</span>&nbsp;<span class="ident" id="3530412">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530417">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530420">if</span>&nbsp;<span class="ident" id="3530423">lb</span><span class="op" id="3530425">,</span>&nbsp;<span class="ident" id="3530427">err</span>&nbsp;<span class="op" id="3530431">=</span>&nbsp;<span class="ident" id="3530433">fromHex</span><span class="op" id="3530440">(</span><span class="ident" id="3530441">v</span><span class="op" id="3530442">[</span><span class="num" id="3530443">1</span><span class="op" id="3530444">]</span><span class="op" id="3530445">)</span><span class="op" id="3530446">;</span>&nbsp;<span class="ident" id="3530448">err</span>&nbsp;<span class="op" id="3530452">!=</span>&nbsp;<span class="ident" id="3530455">nil</span>&nbsp;<span class="op" id="3530459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530463">return</span>&nbsp;<span class="num" id="3530470">0</span><span class="op" id="3530471">,</span>&nbsp;<span class="ident" id="3530473">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530481">return</span>&nbsp;<span class="ident" id="3530488">hb</span><span class="op" id="3530490">&lt;&lt;</span><span class="num" id="3530492">4</span>&nbsp;<span class="op" id="3530494">|</span>&nbsp;<span class="ident" id="3530496">lb</span><span class="op" id="3530498">,</span>&nbsp;<span class="ident" id="3530500">nil</span><br>
<span class="lineno"></span><span class="op" id="3530504">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="3530507">func</span>&nbsp;<span class="ident" id="3530512">isQPDiscardWhitespace</span><span class="op" id="3530533">(</span><span class="ident" id="3530534">r</span>&nbsp;<span class="builtintype" id="3530536">rune</span><span class="op" id="3530540">)</span>&nbsp;<span class="builtintype" id="3530542">bool</span>&nbsp;<span class="op" id="3530547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530550">switch</span>&nbsp;<span class="ident" id="3530557">r</span>&nbsp;<span class="op" id="3530559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530562">case</span>&nbsp;<span class="string" id="3530567">&#39;\n&#39;</span><span class="op" id="3530571">,</span>&nbsp;<span class="string" id="3530573">&#39;\r&#39;</span><span class="op" id="3530577">,</span>&nbsp;<span class="string" id="3530579">&#39;&nbsp;&#39;</span><span class="op" id="3530582">,</span>&nbsp;<span class="string" id="3530584">&#39;\t&#39;</span><span class="op" id="3530588">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530592">return</span>&nbsp;<span class="builtintype" id="3530599">true</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530608">return</span>&nbsp;<span class="builtintype" id="3530615">false</span><br>
<span class="lineno"></span><span class="op" id="3530621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3530624">var</span>&nbsp;<span class="op" id="3530628">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530631">crlf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3530642">=</span>&nbsp;<span class="op" id="3530644">[</span><span class="op" id="3530645">]</span><span class="builtintype" id="3530646">byte</span><span class="op" id="3530650">(</span><span class="string" id="3530651">&#34;\r\n&#34;</span><span class="op" id="3530657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530660">lf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3530671">=</span>&nbsp;<span class="op" id="3530673">[</span><span class="op" id="3530674">]</span><span class="builtintype" id="3530675">byte</span><span class="op" id="3530679">(</span><span class="string" id="3530680">&#34;\n&#34;</span><span class="op" id="3530684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530687">softSuffix</span>&nbsp;<span class="op" id="3530698">=</span>&nbsp;<span class="op" id="3530700">[</span><span class="op" id="3530701">]</span><span class="builtintype" id="3530702">byte</span><span class="op" id="3530706">(</span><span class="string" id="3530707">&#34;=&#34;</span><span class="op" id="3530710">)</span><br>
<span class="lineno"></span><span class="op" id="3530712">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="3530715">func</span>&nbsp;<span class="op" id="3530720">(</span><span class="ident" id="3530721">q</span>&nbsp;<span class="op" id="3530723">*</span><span class="ident" id="3530724">qpReader</span><span class="op" id="3530732">)</span>&nbsp;<span class="ident" id="3530734">Read</span><span class="op" id="3530738">(</span><span class="ident" id="3530739">p</span>&nbsp;<span class="op" id="3530741">[</span><span class="op" id="3530742">]</span><span class="builtintype" id="3530743">byte</span><span class="op" id="3530747">)</span>&nbsp;<span class="op" id="3530749">(</span><span class="ident" id="3530750">n</span>&nbsp;<span class="builtintype" id="3530752">int</span><span class="op" id="3530755">,</span>&nbsp;<span class="ident" id="3530757">err</span>&nbsp;<span class="builtintype" id="3530761">error</span><span class="op" id="3530766">)</span>&nbsp;<span class="op" id="3530768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530771">for</span>&nbsp;<span class="builtinfunc" id="3530775">len</span><span class="op" id="3530778">(</span><span class="ident" id="3530779">p</span><span class="op" id="3530780">)</span>&nbsp;<span class="op" id="3530782">&gt;</span>&nbsp;<span class="num" id="3530784">0</span>&nbsp;<span class="op" id="3530786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530790">if</span>&nbsp;<span class="builtinfunc" id="3530793">len</span><span class="op" id="3530796">(</span><span class="ident" id="3530797">q</span><span class="op" id="3530798">.</span><span class="ident" id="3530799">line</span><span class="op" id="3530803">)</span>&nbsp;<span class="op" id="3530805">==</span>&nbsp;<span class="num" id="3530808">0</span>&nbsp;<span class="op" id="3530810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530815">if</span>&nbsp;<span class="ident" id="3530818">q</span><span class="op" id="3530819">.</span><span class="ident" id="3530820">rerr</span>&nbsp;<span class="op" id="3530825">!=</span>&nbsp;<span class="ident" id="3530828">nil</span>&nbsp;<span class="op" id="3530832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530838">return</span>&nbsp;<span class="ident" id="3530845">n</span><span class="op" id="3530846">,</span>&nbsp;<span class="ident" id="3530848">q</span><span class="op" id="3530849">.</span><span class="ident" id="3530850">rerr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530863">q</span><span class="op" id="3530864">.</span><span class="ident" id="3530865">line</span><span class="op" id="3530869">,</span>&nbsp;<span class="ident" id="3530871">q</span><span class="op" id="3530872">.</span><span class="ident" id="3530873">rerr</span>&nbsp;<span class="op" id="3530878">=</span>&nbsp;<span class="ident" id="3530880">q</span><span class="op" id="3530881">.</span><span class="ident" id="3530882">br</span><span class="op" id="3530884">.</span><span class="ident" id="3530885">ReadSlice</span><span class="op" id="3530894">(</span><span class="string" id="3530895">&#39;\n&#39;</span><span class="op" id="3530899">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3530905">//&nbsp;Does&nbsp;the&nbsp;line&nbsp;end&nbsp;in&nbsp;CRLF&nbsp;instead&nbsp;of&nbsp;just&nbsp;LF?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530957">hasLF</span>&nbsp;<span class="op" id="3530963">:=</span>&nbsp;<span class="ident" id="3530966">bytes</span><span class="op" id="3530971">.</span><span class="ident" id="3530972">HasSuffix</span><span class="op" id="3530981">(</span><span class="ident" id="3530982">q</span><span class="op" id="3530983">.</span><span class="ident" id="3530984">line</span><span class="op" id="3530988">,</span>&nbsp;<span class="ident" id="3530990">lf</span><span class="op" id="3530992">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530997">hasCR</span>&nbsp;<span class="op" id="3531003">:=</span>&nbsp;<span class="ident" id="3531006">bytes</span><span class="op" id="3531011">.</span><span class="ident" id="3531012">HasSuffix</span><span class="op" id="3531021">(</span><span class="ident" id="3531022">q</span><span class="op" id="3531023">.</span><span class="ident" id="3531024">line</span><span class="op" id="3531028">,</span>&nbsp;<span class="ident" id="3531030">crlf</span><span class="op" id="3531034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3531039">wholeLine</span>&nbsp;<span class="op" id="3531049">:=</span>&nbsp;<span class="ident" id="3531052">q</span><span class="op" id="3531053">.</span><span class="ident" id="3531054">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3531062">q</span><span class="op" id="3531063">.</span><span class="ident" id="3531064">line</span>&nbsp;<span class="op" id="3531069">=</span>&nbsp;<span class="ident" id="3531071">bytes</span><span class="op" id="3531076">.</span><span class="ident" id="3531077">TrimRightFunc</span><span class="op" id="3531090">(</span><span class="ident" id="3531091">wholeLine</span><span class="op" id="3531100">,</span>&nbsp;<span class="ident" id="3531102">isQPDiscardWhitespace</span><span class="op" id="3531123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3531128">if</span>&nbsp;<span class="ident" id="3531131">bytes</span><span class="op" id="3531136">.</span><span class="ident" id="3531137">HasSuffix</span><span class="op" id="3531146">(</span><span class="ident" id="3531147">q</span><span class="op" id="3531148">.</span><span class="ident" id="3531149">line</span><span class="op" id="3531153">,</span>&nbsp;<span class="ident" id="3531155">softSuffix</span><span class="op" id="3531165">)</span>&nbsp;<span class="op" id="3531167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3531173">rightStripped</span>&nbsp;<span class="op" id="3531187">:=</span>&nbsp;<span class="ident" id="3531190">wholeLine</span><span class="op" id="3531199">[</span><span class="builtinfunc" id="3531200">len</span><span class="op" id="3531203">(</span><span class="ident" id="3531204">q</span><span class="op" id="3531205">.</span><span class="ident" id="3531206">line</span><span class="op" id="3531210">)</span><span class="op" id="3531211">:</span><span class="op" id="3531212">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3531218">q</span><span class="op" id="3531219">.</span><span class="ident" id="3531220">line</span>&nbsp;<span class="op" id="3531225">=</span>&nbsp;<span class="ident" id="3531227">q</span><span class="op" id="3531228">.</span><span class="ident" id="3531229">line</span><span class="op" id="3531233">[</span><span class="op" id="3531234">:</span><span class="builtinfunc" id="3531235">len</span><span class="op" id="3531238">(</span><span class="ident" id="3531239">q</span><span class="op" id="3531240">.</span><span class="ident" id="3531241">line</span><span class="op" id="3531245">)</span><span class="op" id="3531246">-</span><span class="num" id="3531247">1</span><span class="op" id="3531248">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3531254">if</span>&nbsp;<span class="op" id="3531257">!</span><span class="ident" id="3531258">bytes</span><span class="op" id="3531263">.</span><span class="ident" id="3531264">HasPrefix</span><span class="op" id="3531273">(</span><span class="ident" id="3531274">rightStripped</span><span class="op" id="3531287">,</span>&nbsp;<span class="ident" id="3531289">lf</span><span class="op" id="3531291">)</span>&nbsp;<span class="op" id="3531293">&amp;&amp;</span>&nbsp;<span class="op" id="3531296">!</span><span class="ident" id="3531297">bytes</span><span class="op" id="3531302">.</span><span class="ident" id="3531303">HasPrefix</span><span class="op" id="3531312">(</span><span class="ident" id="3531313">rightStripped</span><span class="op" id="3531326">,</span>&nbsp;<span class="ident" id="3531328">crlf</span><span class="op" id="3531332">)</span>&nbsp;<span class="op" id="3531334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3531341">q</span><span class="op" id="3531342">.</span><span class="ident" id="3531343">rerr</span>&nbsp;<span class="op" id="3531348">=</span>&nbsp;<span class="ident" id="3531350">fmt</span><span class="op" id="3531353">.</span><span class="ident" id="3531354">Errorf</span><span class="op" id="3531360">(</span><span class="string" id="3531361">&#34;multipart:&nbsp;invalid&nbsp;bytes&nbsp;after&nbsp;=:&nbsp;%q&#34;</span><span class="op" id="3531399">,</span>&nbsp;<span class="ident" id="3531401">rightStripped</span><span class="op" id="3531414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3531420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3531425">}</span>&nbsp;<span class="keyword" id="3531427">else</span>&nbsp;<span class="keyword" id="3531432">if</span>&nbsp;<span class="ident" id="3531435">hasLF</span>&nbsp;<span class="op" id="3531441">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3531447">if</span>&nbsp;<span class="ident" id="3531450">hasCR</span>&nbsp;<span class="op" id="3531456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3531463">q</span><span class="op" id="3531464">.</span><span class="ident" id="3531465">line</span>&nbsp;<span class="op" id="3531470">=</span>&nbsp;<span class="builtinfunc" id="3531472">append</span><span class="op" id="3531478">(</span><span class="ident" id="3531479">q</span><span class="op" id="3531480">.</span><span class="ident" id="3531481">line</span><span class="op" id="3531485">,</span>&nbsp;<span class="string" id="3531487">&#39;\r&#39;</span><span class="op" id="3531491">,</span>&nbsp;<span class="string" id="3531493">&#39;\n&#39;</span><span class="op" id="3531497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3531503">}</span>&nbsp;<span class="keyword" id="3531505">else</span>&nbsp;<span class="op" id="3531510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3531517">q</span><span class="op" id="3531518">.</span><span class="ident" id="3531519">line</span>&nbsp;<span class="op" id="3531524">=</span>&nbsp;<span class="builtinfunc" id="3531526">append</span><span class="op" id="3531532">(</span><span class="ident" id="3531533">q</span><span class="op" id="3531534">.</span><span class="ident" id="3531535">line</span><span class="op" id="3531539">,</span>&nbsp;<span class="string" id="3531541">&#39;\n&#39;</span><span class="op" id="3531545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3531551">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3531556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3531561">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3531572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3531576">b</span>&nbsp;<span class="op" id="3531578">:=</span>&nbsp;<span class="ident" id="3531581">q</span><span class="op" id="3531582">.</span><span class="ident" id="3531583">line</span><span class="op" id="3531587">[</span><span class="num" id="3531588">0</span><span class="op" id="3531589">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3531594">switch</span>&nbsp;<span class="op" id="3531601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3531605">case</span>&nbsp;<span class="ident" id="3531610">b</span>&nbsp;<span class="op" id="3531612">==</span>&nbsp;<span class="string" id="3531615">&#39;=&#39;</span><span class="op" id="3531618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3531623">b</span><span class="op" id="3531624">,</span>&nbsp;<span class="ident" id="3531626">err</span>&nbsp;<span class="op" id="3531630">=</span>&nbsp;<span class="ident" id="3531632">q</span><span class="op" id="3531633">.</span><span class="ident" id="3531634">readHexByte</span><span class="op" id="3531645">(</span><span class="ident" id="3531646">q</span><span class="op" id="3531647">.</span><span class="ident" id="3531648">line</span><span class="op" id="3531652">[</span><span class="num" id="3531653">1</span><span class="op" id="3531654">:</span><span class="op" id="3531655">]</span><span class="op" id="3531656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3531661">if</span>&nbsp;<span class="ident" id="3531664">err</span>&nbsp;<span class="op" id="3531668">!=</span>&nbsp;<span class="ident" id="3531671">nil</span>&nbsp;<span class="op" id="3531675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3531681">return</span>&nbsp;<span class="ident" id="3531688">n</span><span class="op" id="3531689">,</span>&nbsp;<span class="ident" id="3531691">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3531698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3531703">q</span><span class="op" id="3531704">.</span><span class="ident" id="3531705">line</span>&nbsp;<span class="op" id="3531710">=</span>&nbsp;<span class="ident" id="3531712">q</span><span class="op" id="3531713">.</span><span class="ident" id="3531714">line</span><span class="op" id="3531718">[</span><span class="num" id="3531719">2</span><span class="op" id="3531720">:</span><span class="op" id="3531721">]</span>&nbsp;<span class="comment" id="3531723">//&nbsp;2&nbsp;of&nbsp;the&nbsp;3;&nbsp;other&nbsp;1&nbsp;is&nbsp;done&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3531762">case</span>&nbsp;<span class="ident" id="3531767">b</span>&nbsp;<span class="op" id="3531769">==</span>&nbsp;<span class="string" id="3531772">&#39;\t&#39;</span>&nbsp;<span class="op" id="3531777">||</span>&nbsp;<span class="ident" id="3531780">b</span>&nbsp;<span class="op" id="3531782">==</span>&nbsp;<span class="string" id="3531785">&#39;\r&#39;</span>&nbsp;<span class="op" id="3531790">||</span>&nbsp;<span class="ident" id="3531793">b</span>&nbsp;<span class="op" id="3531795">==</span>&nbsp;<span class="string" id="3531798">&#39;\n&#39;</span><span class="op" id="3531802">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3531807">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3531815">case</span>&nbsp;<span class="ident" id="3531820">b</span>&nbsp;<span class="op" id="3531822">&lt;</span>&nbsp;<span class="string" id="3531824">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3531828">||</span>&nbsp;<span class="ident" id="3531831">b</span>&nbsp;<span class="op" id="3531833">&gt;</span>&nbsp;<span class="string" id="3531835">&#39;~&#39;</span><span class="op" id="3531838">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3531843">return</span>&nbsp;<span class="ident" id="3531850">n</span><span class="op" id="3531851">,</span>&nbsp;<span class="ident" id="3531853">fmt</span><span class="op" id="3531856">.</span><span class="ident" id="3531857">Errorf</span><span class="op" id="3531863">(</span><span class="string" id="3531864">&#34;multipart:&nbsp;invalid&nbsp;unescaped&nbsp;byte&nbsp;0x%02x&nbsp;in&nbsp;quoted-printable&nbsp;body&#34;</span><span class="op" id="3531931">,</span>&nbsp;<span class="ident" id="3531933">b</span><span class="op" id="3531934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3531938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3531942">p</span><span class="op" id="3531943">[</span><span class="num" id="3531944">0</span><span class="op" id="3531945">]</span>&nbsp;<span class="op" id="3531947">=</span>&nbsp;<span class="ident" id="3531949">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3531953">p</span>&nbsp;<span class="op" id="3531955">=</span>&nbsp;<span class="ident" id="3531957">p</span><span class="op" id="3531958">[</span><span class="num" id="3531959">1</span><span class="op" id="3531960">:</span><span class="op" id="3531961">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3531965">q</span><span class="op" id="3531966">.</span><span class="ident" id="3531967">line</span>&nbsp;<span class="op" id="3531972">=</span>&nbsp;<span class="ident" id="3531974">q</span><span class="op" id="3531975">.</span><span class="ident" id="3531976">line</span><span class="op" id="3531980">[</span><span class="num" id="3531981">1</span><span class="op" id="3531982">:</span><span class="op" id="3531983">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3531987">n</span><span class="op" id="3531988">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3531992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3531995">return</span>&nbsp;<span class="ident" id="3532002">n</span><span class="op" id="3532003">,</span>&nbsp;<span class="ident" id="3532005">nil</span><br>
<span class="lineno"></span><span class="op" id="3532009">}</span>
</div>
</body>
</html>
