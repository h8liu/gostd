<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1641273">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1641328">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1641382">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1641433">package</span>&nbsp;<span class="ident" id="1641441">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1641450">import</span>&nbsp;<span class="string" id="1641457">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1641467">var</span>&nbsp;<span class="ident" id="1641471">indexError</span>&nbsp;<span class="op" id="1641482">=</span>&nbsp;<span class="builtintype" id="1641484">error</span><span class="op" id="1641489">(</span><span class="ident" id="1641490">errorString</span><span class="op" id="1641501">(</span><span class="string" id="1641502">&#34;index&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1641522">)</span><span class="op" id="1641523">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1641526">func</span>&nbsp;<span class="ident" id="1641531">panicindex</span><span class="op" id="1641541">(</span><span class="op" id="1641542">)</span>&nbsp;<span class="op" id="1641544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1641547">panic</span><span class="op" id="1641552">(</span><span class="ident" id="1641553">indexError</span><span class="op" id="1641563">)</span><br>
<span class="lineno"></span><span class="op" id="1641565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="1641568">var</span>&nbsp;<span class="ident" id="1641572">sliceError</span>&nbsp;<span class="op" id="1641583">=</span>&nbsp;<span class="builtintype" id="1641585">error</span><span class="op" id="1641590">(</span><span class="ident" id="1641591">errorString</span><span class="op" id="1641602">(</span><span class="string" id="1641603">&#34;slice&nbsp;bounds&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1641630">)</span><span class="op" id="1641631">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1641634">func</span>&nbsp;<span class="ident" id="1641639">panicslice</span><span class="op" id="1641649">(</span><span class="op" id="1641650">)</span>&nbsp;<span class="op" id="1641652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1641655">panic</span><span class="op" id="1641660">(</span><span class="ident" id="1641661">sliceError</span><span class="op" id="1641671">)</span><br>
<span class="lineno"></span><span class="op" id="1641673">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1641676">var</span>&nbsp;<span class="ident" id="1641680">divideError</span>&nbsp;<span class="op" id="1641692">=</span>&nbsp;<span class="builtintype" id="1641694">error</span><span class="op" id="1641699">(</span><span class="ident" id="1641700">errorString</span><span class="op" id="1641711">(</span><span class="string" id="1641712">&#34;integer&nbsp;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="1641736">)</span><span class="op" id="1641737">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1641740">func</span>&nbsp;<span class="ident" id="1641745">panicdivide</span><span class="op" id="1641756">(</span><span class="op" id="1641757">)</span>&nbsp;<span class="op" id="1641759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1641762">panic</span><span class="op" id="1641767">(</span><span class="ident" id="1641768">divideError</span><span class="op" id="1641779">)</span><br>
<span class="lineno">25</span><span class="op" id="1641781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1641784">var</span>&nbsp;<span class="ident" id="1641788">overflowError</span>&nbsp;<span class="op" id="1641802">=</span>&nbsp;<span class="builtintype" id="1641804">error</span><span class="op" id="1641809">(</span><span class="ident" id="1641810">errorString</span><span class="op" id="1641821">(</span><span class="string" id="1641822">&#34;integer&nbsp;overflow&#34;</span><span class="op" id="1641840">)</span><span class="op" id="1641841">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1641844">func</span>&nbsp;<span class="ident" id="1641849">panicoverflow</span><span class="op" id="1641862">(</span><span class="op" id="1641863">)</span>&nbsp;<span class="op" id="1641865">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1641868">panic</span><span class="op" id="1641873">(</span><span class="ident" id="1641874">overflowError</span><span class="op" id="1641887">)</span><br>
<span class="lineno"></span><span class="op" id="1641889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1641892">var</span>&nbsp;<span class="ident" id="1641896">floatError</span>&nbsp;<span class="op" id="1641907">=</span>&nbsp;<span class="builtintype" id="1641909">error</span><span class="op" id="1641914">(</span><span class="ident" id="1641915">errorString</span><span class="op" id="1641926">(</span><span class="string" id="1641927">&#34;floating&nbsp;point&nbsp;error&#34;</span><span class="op" id="1641949">)</span><span class="op" id="1641950">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="1641953">func</span>&nbsp;<span class="ident" id="1641958">panicfloat</span><span class="op" id="1641968">(</span><span class="op" id="1641969">)</span>&nbsp;<span class="op" id="1641971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1641974">panic</span><span class="op" id="1641979">(</span><span class="ident" id="1641980">floatError</span><span class="op" id="1641990">)</span><br>
<span class="lineno"></span><span class="op" id="1641992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1641995">var</span>&nbsp;<span class="ident" id="1641999">memoryError</span>&nbsp;<span class="op" id="1642011">=</span>&nbsp;<span class="builtintype" id="1642013">error</span><span class="op" id="1642018">(</span><span class="ident" id="1642019">errorString</span><span class="op" id="1642030">(</span><span class="string" id="1642031">&#34;invalid&nbsp;memory&nbsp;address&nbsp;or&nbsp;nil&nbsp;pointer&nbsp;dereference&#34;</span><span class="op" id="1642082">)</span><span class="op" id="1642083">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1642086">func</span>&nbsp;<span class="ident" id="1642091">panicmem</span><span class="op" id="1642099">(</span><span class="op" id="1642100">)</span>&nbsp;<span class="op" id="1642102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1642105">panic</span><span class="op" id="1642110">(</span><span class="ident" id="1642111">memoryError</span><span class="op" id="1642122">)</span><br>
<span class="lineno"></span><span class="op" id="1642124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="1642127">func</span>&nbsp;<span class="ident" id="1642132">throwreturn</span><span class="op" id="1642143">(</span><span class="op" id="1642144">)</span>&nbsp;<span class="op" id="1642146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1642149">gothrow</span><span class="op" id="1642156">(</span><span class="string" id="1642157">&#34;no&nbsp;return&nbsp;at&nbsp;end&nbsp;of&nbsp;a&nbsp;typed&nbsp;function&nbsp;-&nbsp;compiler&nbsp;is&nbsp;broken&#34;</span><span class="op" id="1642216">)</span><br>
<span class="lineno"></span><span class="op" id="1642218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1642221">func</span>&nbsp;<span class="ident" id="1642226">throwinit</span><span class="op" id="1642235">(</span><span class="op" id="1642236">)</span>&nbsp;<span class="op" id="1642238">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1642241">gothrow</span><span class="op" id="1642248">(</span><span class="string" id="1642249">&#34;recursive&nbsp;call&nbsp;during&nbsp;initialization&nbsp;-&nbsp;linker&nbsp;skew&#34;</span><span class="op" id="1642301">)</span><br>
<span class="lineno"></span><span class="op" id="1642303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1642306">//&nbsp;Create&nbsp;a&nbsp;new&nbsp;deferred&nbsp;function&nbsp;fn&nbsp;with&nbsp;siz&nbsp;bytes&nbsp;of&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="1642372">//&nbsp;The&nbsp;compiler&nbsp;turns&nbsp;a&nbsp;defer&nbsp;statement&nbsp;into&nbsp;a&nbsp;call&nbsp;to&nbsp;this.</span><br>
<span class="lineno">55</span><span class="comment" id="1642433">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1642446">func</span>&nbsp;<span class="ident" id="1642451">deferproc</span><span class="op" id="1642460">(</span><span class="ident" id="1642461">siz</span>&nbsp;<span class="builtintype" id="1642465">int32</span><span class="op" id="1642470">,</span>&nbsp;<span class="ident" id="1642472">fn</span>&nbsp;<span class="op" id="1642475">*</span><span class="ident" id="1642476">funcval</span><span class="op" id="1642483">)</span>&nbsp;<span class="op" id="1642485">{</span>&nbsp;<span class="comment" id="1642487">//&nbsp;arguments&nbsp;of&nbsp;fn&nbsp;follow&nbsp;fn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1642517">//&nbsp;the&nbsp;arguments&nbsp;of&nbsp;fn&nbsp;are&nbsp;in&nbsp;a&nbsp;perilous&nbsp;state.&nbsp;&nbsp;The&nbsp;stack&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1642581">//&nbsp;for&nbsp;deferproc&nbsp;does&nbsp;not&nbsp;describe&nbsp;them.&nbsp;&nbsp;So&nbsp;we&nbsp;can&#39;t&nbsp;let&nbsp;garbage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1642648">//&nbsp;collection&nbsp;or&nbsp;stack&nbsp;copying&nbsp;trigger&nbsp;until&nbsp;we&#39;ve&nbsp;copied&nbsp;them&nbsp;out</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1642716">//&nbsp;to&nbsp;somewhere&nbsp;safe.&nbsp;&nbsp;deferproc_m&nbsp;does&nbsp;that.&nbsp;&nbsp;Until&nbsp;deferproc_m,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1642783">//&nbsp;we&nbsp;can&nbsp;only&nbsp;call&nbsp;nosplit&nbsp;routines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1642822">argp</span>&nbsp;<span class="op" id="1642827">:=</span>&nbsp;<span class="builtintype" id="1642830">uintptr</span><span class="op" id="1642837">(</span><span class="ident" id="1642838">unsafe</span><span class="op" id="1642844">.</span><span class="ident" id="1642845">Pointer</span><span class="op" id="1642852">(</span><span class="op" id="1642853">&amp;</span><span class="ident" id="1642854">fn</span><span class="op" id="1642856">)</span><span class="op" id="1642857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1642860">argp</span>&nbsp;<span class="op" id="1642865">+=</span>&nbsp;<span class="ident" id="1642868">unsafe</span><span class="op" id="1642874">.</span><span class="ident" id="1642875">Sizeof</span><span class="op" id="1642881">(</span><span class="ident" id="1642882">fn</span><span class="op" id="1642884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1642887">if</span>&nbsp;<span class="ident" id="1642890">GOARCH</span>&nbsp;<span class="op" id="1642897">==</span>&nbsp;<span class="string" id="1642900">&#34;arm&#34;</span>&nbsp;<span class="op" id="1642906">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1642910">argp</span>&nbsp;<span class="op" id="1642915">+=</span>&nbsp;<span class="ident" id="1642918">ptrSize</span>&nbsp;<span class="comment" id="1642926">//&nbsp;skip&nbsp;caller&#39;s&nbsp;saved&nbsp;link&nbsp;register</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1642964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1642967">mp</span>&nbsp;<span class="op" id="1642970">:=</span>&nbsp;<span class="ident" id="1642973">acquirem</span><span class="op" id="1642981">(</span><span class="op" id="1642982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1642985">mp</span><span class="op" id="1642987">.</span><span class="ident" id="1642988">scalararg</span><span class="op" id="1642997">[</span><span class="num" id="1642998">0</span><span class="op" id="1642999">]</span>&nbsp;<span class="op" id="1643001">=</span>&nbsp;<span class="builtintype" id="1643003">uintptr</span><span class="op" id="1643010">(</span><span class="ident" id="1643011">siz</span><span class="op" id="1643014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1643017">mp</span><span class="op" id="1643019">.</span><span class="ident" id="1643020">ptrarg</span><span class="op" id="1643026">[</span><span class="num" id="1643027">0</span><span class="op" id="1643028">]</span>&nbsp;<span class="op" id="1643030">=</span>&nbsp;<span class="ident" id="1643032">unsafe</span><span class="op" id="1643038">.</span><span class="ident" id="1643039">Pointer</span><span class="op" id="1643046">(</span><span class="ident" id="1643047">fn</span><span class="op" id="1643049">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1643052">mp</span><span class="op" id="1643054">.</span><span class="ident" id="1643055">scalararg</span><span class="op" id="1643064">[</span><span class="num" id="1643065">1</span><span class="op" id="1643066">]</span>&nbsp;<span class="op" id="1643068">=</span>&nbsp;<span class="ident" id="1643070">argp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1643076">mp</span><span class="op" id="1643078">.</span><span class="ident" id="1643079">scalararg</span><span class="op" id="1643088">[</span><span class="num" id="1643089">2</span><span class="op" id="1643090">]</span>&nbsp;<span class="op" id="1643092">=</span>&nbsp;<span class="ident" id="1643094">getcallerpc</span><span class="op" id="1643105">(</span><span class="ident" id="1643106">unsafe</span><span class="op" id="1643112">.</span><span class="ident" id="1643113">Pointer</span><span class="op" id="1643120">(</span><span class="op" id="1643121">&amp;</span><span class="ident" id="1643122">siz</span><span class="op" id="1643125">)</span><span class="op" id="1643126">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1643130">if</span>&nbsp;<span class="ident" id="1643133">mp</span><span class="op" id="1643135">.</span><span class="ident" id="1643136">curg</span>&nbsp;<span class="op" id="1643141">!=</span>&nbsp;<span class="ident" id="1643144">getg</span><span class="op" id="1643148">(</span><span class="op" id="1643149">)</span>&nbsp;<span class="op" id="1643151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1643155">//&nbsp;go&nbsp;code&nbsp;on&nbsp;the&nbsp;m&nbsp;stack&nbsp;can&#39;t&nbsp;defer</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1643195">gothrow</span><span class="op" id="1643202">(</span><span class="string" id="1643203">&#34;defer&nbsp;on&nbsp;m&#34;</span><span class="op" id="1643215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1643218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1643222">onM</span><span class="op" id="1643225">(</span><span class="ident" id="1643226">deferproc_m</span><span class="op" id="1643237">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1643241">releasem</span><span class="op" id="1643249">(</span><span class="ident" id="1643250">mp</span><span class="op" id="1643252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1643256">//&nbsp;deferproc&nbsp;returns&nbsp;0&nbsp;normally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1643290">//&nbsp;a&nbsp;deferred&nbsp;func&nbsp;that&nbsp;stops&nbsp;a&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1643329">//&nbsp;makes&nbsp;the&nbsp;deferproc&nbsp;return&nbsp;1.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1643363">//&nbsp;the&nbsp;code&nbsp;the&nbsp;compiler&nbsp;generates&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1643406">//&nbsp;checks&nbsp;the&nbsp;return&nbsp;value&nbsp;and&nbsp;jumps&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1643451">//&nbsp;end&nbsp;of&nbsp;the&nbsp;function&nbsp;if&nbsp;deferproc&nbsp;returns&nbsp;!=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1643502">return0</span><span class="op" id="1643509">(</span><span class="op" id="1643510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1643513">//&nbsp;No&nbsp;code&nbsp;can&nbsp;go&nbsp;here&nbsp;-&nbsp;the&nbsp;C&nbsp;return&nbsp;register&nbsp;has</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1643565">//&nbsp;been&nbsp;set&nbsp;and&nbsp;must&nbsp;not&nbsp;be&nbsp;clobbered.</span><br>
<span class="lineno"></span><span class="op" id="1643604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1643607">//&nbsp;Small&nbsp;malloc&nbsp;size&nbsp;classes&nbsp;&gt;=&nbsp;16&nbsp;are&nbsp;the&nbsp;multiples&nbsp;of&nbsp;16:&nbsp;16,&nbsp;32,&nbsp;48,&nbsp;64,&nbsp;80,&nbsp;96,&nbsp;112,&nbsp;128,&nbsp;144,&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="1643710">//&nbsp;Each&nbsp;P&nbsp;holds&nbsp;a&nbsp;pool&nbsp;for&nbsp;defers&nbsp;with&nbsp;small&nbsp;arg&nbsp;sizes.</span><br>
<span class="lineno">95</span><span class="comment" id="1643766">//&nbsp;Assign&nbsp;defer&nbsp;allocations&nbsp;to&nbsp;pools&nbsp;by&nbsp;rounding&nbsp;to&nbsp;16,&nbsp;to&nbsp;match&nbsp;malloc&nbsp;size&nbsp;classes.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1643853">const</span>&nbsp;<span class="op" id="1643859">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1643862">deferHeaderSize</span>&nbsp;<span class="op" id="1643878">=</span>&nbsp;<span class="ident" id="1643880">unsafe</span><span class="op" id="1643886">.</span><span class="ident" id="1643887">Sizeof</span><span class="op" id="1643893">(</span><span class="ident" id="1643894">_defer</span><span class="op" id="1643900">{</span><span class="op" id="1643901">}</span><span class="op" id="1643902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1643905">minDeferAlloc</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1643921">=</span>&nbsp;<span class="op" id="1643923">(</span><span class="ident" id="1643924">deferHeaderSize</span>&nbsp;<span class="op" id="1643940">+</span>&nbsp;<span class="num" id="1643942">15</span><span class="op" id="1643944">)</span>&nbsp;<span class="op" id="1643946">&amp;^</span>&nbsp;<span class="num" id="1643949">15</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1643953">minDeferArgs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1643969">=</span>&nbsp;<span class="ident" id="1643971">minDeferAlloc</span>&nbsp;<span class="op" id="1643985">-</span>&nbsp;<span class="ident" id="1643987">deferHeaderSize</span><br>
<span class="lineno"></span><span class="op" id="1644003">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1644006">//&nbsp;defer&nbsp;size&nbsp;class&nbsp;for&nbsp;arg&nbsp;size&nbsp;sz</span><br>
<span class="lineno"></span><span class="comment" id="1644042">//go:nosplit</span><br>
<span class="lineno">105</span><span class="keyword" id="1644055">func</span>&nbsp;<span class="ident" id="1644060">deferclass</span><span class="op" id="1644070">(</span><span class="ident" id="1644071">siz</span>&nbsp;<span class="builtintype" id="1644075">uintptr</span><span class="op" id="1644082">)</span>&nbsp;<span class="builtintype" id="1644084">uintptr</span>&nbsp;<span class="op" id="1644092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644095">if</span>&nbsp;<span class="ident" id="1644098">siz</span>&nbsp;<span class="op" id="1644102">&lt;=</span>&nbsp;<span class="ident" id="1644105">minDeferArgs</span>&nbsp;<span class="op" id="1644118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644122">return</span>&nbsp;<span class="num" id="1644129">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1644132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644135">return</span>&nbsp;<span class="op" id="1644142">(</span><span class="ident" id="1644143">siz</span>&nbsp;<span class="op" id="1644147">-</span>&nbsp;<span class="ident" id="1644149">minDeferArgs</span>&nbsp;<span class="op" id="1644162">+</span>&nbsp;<span class="num" id="1644164">15</span><span class="op" id="1644166">)</span>&nbsp;<span class="op" id="1644168">/</span>&nbsp;<span class="num" id="1644170">16</span><br>
<span class="lineno">110</span><span class="op" id="1644173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1644176">//&nbsp;total&nbsp;size&nbsp;of&nbsp;memory&nbsp;block&nbsp;for&nbsp;defer&nbsp;with&nbsp;arg&nbsp;size&nbsp;sz</span><br>
<span class="lineno"></span><span class="keyword" id="1644233">func</span>&nbsp;<span class="ident" id="1644238">totaldefersize</span><span class="op" id="1644252">(</span><span class="ident" id="1644253">siz</span>&nbsp;<span class="builtintype" id="1644257">uintptr</span><span class="op" id="1644264">)</span>&nbsp;<span class="builtintype" id="1644266">uintptr</span>&nbsp;<span class="op" id="1644274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644277">if</span>&nbsp;<span class="ident" id="1644280">siz</span>&nbsp;<span class="op" id="1644284">&lt;=</span>&nbsp;<span class="ident" id="1644287">minDeferArgs</span>&nbsp;<span class="op" id="1644300">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644304">return</span>&nbsp;<span class="ident" id="1644311">minDeferAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1644326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644329">return</span>&nbsp;<span class="ident" id="1644336">deferHeaderSize</span>&nbsp;<span class="op" id="1644352">+</span>&nbsp;<span class="ident" id="1644354">siz</span><br>
<span class="lineno"></span><span class="op" id="1644358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="1644361">//&nbsp;Ensure&nbsp;that&nbsp;defer&nbsp;arg&nbsp;sizes&nbsp;that&nbsp;map&nbsp;to&nbsp;the&nbsp;same&nbsp;defer&nbsp;size&nbsp;class</span><br>
<span class="lineno"></span><span class="comment" id="1644430">//&nbsp;also&nbsp;map&nbsp;to&nbsp;the&nbsp;same&nbsp;malloc&nbsp;size&nbsp;class.</span><br>
<span class="lineno"></span><span class="keyword" id="1644473">func</span>&nbsp;<span class="ident" id="1644478">testdefersizes</span><span class="op" id="1644492">(</span><span class="op" id="1644493">)</span>&nbsp;<span class="op" id="1644495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644498">var</span>&nbsp;<span class="ident" id="1644502">m</span>&nbsp;<span class="op" id="1644504">[</span><span class="builtinfunc" id="1644505">len</span><span class="op" id="1644508">(</span><span class="ident" id="1644509">p</span><span class="op" id="1644510">{</span><span class="op" id="1644511">}</span><span class="op" id="1644512">.</span><span class="ident" id="1644513">deferpool</span><span class="op" id="1644522">)</span><span class="op" id="1644523">]</span><span class="builtintype" id="1644524">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644532">for</span>&nbsp;<span class="ident" id="1644536">i</span>&nbsp;<span class="op" id="1644538">:=</span>&nbsp;<span class="keyword" id="1644541">range</span>&nbsp;<span class="ident" id="1644547">m</span>&nbsp;<span class="op" id="1644549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1644553">m</span><span class="op" id="1644554">[</span><span class="ident" id="1644555">i</span><span class="op" id="1644556">]</span>&nbsp;<span class="op" id="1644558">=</span>&nbsp;<span class="op" id="1644560">-</span><span class="num" id="1644561">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1644564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644567">for</span>&nbsp;<span class="ident" id="1644571">i</span>&nbsp;<span class="op" id="1644573">:=</span>&nbsp;<span class="builtintype" id="1644576">uintptr</span><span class="op" id="1644583">(</span><span class="num" id="1644584">0</span><span class="op" id="1644585">)</span><span class="op" id="1644586">;</span>&nbsp;<span class="op" id="1644588">;</span>&nbsp;<span class="ident" id="1644590">i</span><span class="op" id="1644591">++</span>&nbsp;<span class="op" id="1644594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1644598">defersc</span>&nbsp;<span class="op" id="1644606">:=</span>&nbsp;<span class="ident" id="1644609">deferclass</span><span class="op" id="1644619">(</span><span class="ident" id="1644620">i</span><span class="op" id="1644621">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644625">if</span>&nbsp;<span class="ident" id="1644628">defersc</span>&nbsp;<span class="op" id="1644636">&gt;=</span>&nbsp;<span class="builtintype" id="1644639">uintptr</span><span class="op" id="1644646">(</span><span class="builtinfunc" id="1644647">len</span><span class="op" id="1644650">(</span><span class="ident" id="1644651">m</span><span class="op" id="1644652">)</span><span class="op" id="1644653">)</span>&nbsp;<span class="op" id="1644655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644660">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1644668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1644672">siz</span>&nbsp;<span class="op" id="1644676">:=</span>&nbsp;<span class="ident" id="1644679">goroundupsize</span><span class="op" id="1644692">(</span><span class="ident" id="1644693">totaldefersize</span><span class="op" id="1644707">(</span><span class="ident" id="1644708">i</span><span class="op" id="1644709">)</span><span class="op" id="1644710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644714">if</span>&nbsp;<span class="ident" id="1644717">m</span><span class="op" id="1644718">[</span><span class="ident" id="1644719">defersc</span><span class="op" id="1644726">]</span>&nbsp;<span class="op" id="1644728">&lt;</span>&nbsp;<span class="num" id="1644730">0</span>&nbsp;<span class="op" id="1644732">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1644737">m</span><span class="op" id="1644738">[</span><span class="ident" id="1644739">defersc</span><span class="op" id="1644746">]</span>&nbsp;<span class="op" id="1644748">=</span>&nbsp;<span class="builtintype" id="1644750">int32</span><span class="op" id="1644755">(</span><span class="ident" id="1644756">siz</span><span class="op" id="1644759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644764">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1644775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1644779">if</span>&nbsp;<span class="ident" id="1644782">m</span><span class="op" id="1644783">[</span><span class="ident" id="1644784">defersc</span><span class="op" id="1644791">]</span>&nbsp;<span class="op" id="1644793">!=</span>&nbsp;<span class="builtintype" id="1644796">int32</span><span class="op" id="1644801">(</span><span class="ident" id="1644802">siz</span><span class="op" id="1644805">)</span>&nbsp;<span class="op" id="1644807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1644812">print</span><span class="op" id="1644817">(</span><span class="string" id="1644818">&#34;bad&nbsp;defer&nbsp;size&nbsp;class:&nbsp;i=&#34;</span><span class="op" id="1644844">,</span>&nbsp;<span class="ident" id="1644846">i</span><span class="op" id="1644847">,</span>&nbsp;<span class="string" id="1644849">&#34;&nbsp;siz=&#34;</span><span class="op" id="1644856">,</span>&nbsp;<span class="ident" id="1644858">siz</span><span class="op" id="1644861">,</span>&nbsp;<span class="string" id="1644863">&#34;&nbsp;defersc=&#34;</span><span class="op" id="1644874">,</span>&nbsp;<span class="ident" id="1644876">defersc</span><span class="op" id="1644883">,</span>&nbsp;<span class="string" id="1644885">&#34;\n&#34;</span><span class="op" id="1644889">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1644894">gothrow</span><span class="op" id="1644901">(</span><span class="string" id="1644902">&#34;bad&nbsp;defer&nbsp;size&nbsp;class&#34;</span><span class="op" id="1644924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1644928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1644931">}</span><br>
<span class="lineno"></span><span class="op" id="1644933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="1644936">//&nbsp;The&nbsp;arguments&nbsp;associated&nbsp;with&nbsp;a&nbsp;deferred&nbsp;call&nbsp;are&nbsp;stored</span><br>
<span class="lineno"></span><span class="comment" id="1644996">//&nbsp;immediately&nbsp;after&nbsp;the&nbsp;_defer&nbsp;header&nbsp;in&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1645046">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1645059">func</span>&nbsp;<span class="ident" id="1645064">deferArgs</span><span class="op" id="1645073">(</span><span class="ident" id="1645074">d</span>&nbsp;<span class="op" id="1645076">*</span><span class="ident" id="1645077">_defer</span><span class="op" id="1645083">)</span>&nbsp;<span class="ident" id="1645085">unsafe</span><span class="op" id="1645091">.</span><span class="ident" id="1645092">Pointer</span>&nbsp;<span class="op" id="1645100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1645103">return</span>&nbsp;<span class="ident" id="1645110">add</span><span class="op" id="1645113">(</span><span class="ident" id="1645114">unsafe</span><span class="op" id="1645120">.</span><span class="ident" id="1645121">Pointer</span><span class="op" id="1645128">(</span><span class="ident" id="1645129">d</span><span class="op" id="1645130">)</span><span class="op" id="1645131">,</span>&nbsp;<span class="ident" id="1645133">unsafe</span><span class="op" id="1645139">.</span><span class="ident" id="1645140">Sizeof</span><span class="op" id="1645146">(</span><span class="op" id="1645147">*</span><span class="ident" id="1645148">d</span><span class="op" id="1645149">)</span><span class="op" id="1645150">)</span><br>
<span class="lineno">150</span><span class="op" id="1645152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1645155">var</span>&nbsp;<span class="ident" id="1645159">deferType</span>&nbsp;<span class="op" id="1645169">*</span><span class="ident" id="1645170">_type</span>&nbsp;<span class="comment" id="1645176">//&nbsp;type&nbsp;of&nbsp;_defer&nbsp;struct</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1645202">func</span>&nbsp;<span class="ident" id="1645207">init</span><span class="op" id="1645211">(</span><span class="op" id="1645212">)</span>&nbsp;<span class="op" id="1645214">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1645217">var</span>&nbsp;<span class="ident" id="1645221">x</span>&nbsp;<span class="keyword" id="1645223">interface</span><span class="op" id="1645232">{</span><span class="op" id="1645233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645236">x</span>&nbsp;<span class="op" id="1645238">=</span>&nbsp;<span class="op" id="1645240">(</span><span class="op" id="1645241">*</span><span class="ident" id="1645242">_defer</span><span class="op" id="1645248">)</span><span class="op" id="1645249">(</span><span class="ident" id="1645250">nil</span><span class="op" id="1645253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645256">deferType</span>&nbsp;<span class="op" id="1645266">=</span>&nbsp;<span class="op" id="1645268">(</span><span class="op" id="1645269">*</span><span class="op" id="1645270">(</span><span class="op" id="1645271">*</span><span class="op" id="1645272">*</span><span class="ident" id="1645273">ptrtype</span><span class="op" id="1645280">)</span><span class="op" id="1645281">(</span><span class="ident" id="1645282">unsafe</span><span class="op" id="1645288">.</span><span class="ident" id="1645289">Pointer</span><span class="op" id="1645296">(</span><span class="op" id="1645297">&amp;</span><span class="ident" id="1645298">x</span><span class="op" id="1645299">)</span><span class="op" id="1645300">)</span><span class="op" id="1645301">)</span><span class="op" id="1645302">.</span><span class="ident" id="1645303">elem</span><br>
<span class="lineno"></span><span class="op" id="1645308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="1645311">//&nbsp;Allocate&nbsp;a&nbsp;Defer,&nbsp;usually&nbsp;using&nbsp;per-P&nbsp;pool.</span><br>
<span class="lineno"></span><span class="comment" id="1645358">//&nbsp;Each&nbsp;defer&nbsp;must&nbsp;be&nbsp;released&nbsp;with&nbsp;freedefer.</span><br>
<span class="lineno"></span><span class="comment" id="1645405">//&nbsp;Note:&nbsp;runs&nbsp;on&nbsp;M&nbsp;stack</span><br>
<span class="lineno"></span><span class="keyword" id="1645430">func</span>&nbsp;<span class="ident" id="1645435">newdefer</span><span class="op" id="1645443">(</span><span class="ident" id="1645444">siz</span>&nbsp;<span class="builtintype" id="1645448">int32</span><span class="op" id="1645453">)</span>&nbsp;<span class="op" id="1645455">*</span><span class="ident" id="1645456">_defer</span>&nbsp;<span class="op" id="1645463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1645466">var</span>&nbsp;<span class="ident" id="1645470">d</span>&nbsp;<span class="op" id="1645472">*</span><span class="ident" id="1645473">_defer</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645481">sc</span>&nbsp;<span class="op" id="1645484">:=</span>&nbsp;<span class="ident" id="1645487">deferclass</span><span class="op" id="1645497">(</span><span class="builtintype" id="1645498">uintptr</span><span class="op" id="1645505">(</span><span class="ident" id="1645506">siz</span><span class="op" id="1645509">)</span><span class="op" id="1645510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645513">mp</span>&nbsp;<span class="op" id="1645516">:=</span>&nbsp;<span class="ident" id="1645519">acquirem</span><span class="op" id="1645527">(</span><span class="op" id="1645528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1645531">if</span>&nbsp;<span class="ident" id="1645534">sc</span>&nbsp;<span class="op" id="1645537">&lt;</span>&nbsp;<span class="builtintype" id="1645539">uintptr</span><span class="op" id="1645546">(</span><span class="builtinfunc" id="1645547">len</span><span class="op" id="1645550">(</span><span class="ident" id="1645551">p</span><span class="op" id="1645552">{</span><span class="op" id="1645553">}</span><span class="op" id="1645554">.</span><span class="ident" id="1645555">deferpool</span><span class="op" id="1645564">)</span><span class="op" id="1645565">)</span>&nbsp;<span class="op" id="1645567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645571">pp</span>&nbsp;<span class="op" id="1645574">:=</span>&nbsp;<span class="ident" id="1645577">mp</span><span class="op" id="1645579">.</span><span class="ident" id="1645580">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645584">d</span>&nbsp;<span class="op" id="1645586">=</span>&nbsp;<span class="ident" id="1645588">pp</span><span class="op" id="1645590">.</span><span class="ident" id="1645591">deferpool</span><span class="op" id="1645600">[</span><span class="ident" id="1645601">sc</span><span class="op" id="1645603">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1645607">if</span>&nbsp;<span class="ident" id="1645610">d</span>&nbsp;<span class="op" id="1645612">!=</span>&nbsp;<span class="ident" id="1645615">nil</span>&nbsp;<span class="op" id="1645619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645624">pp</span><span class="op" id="1645626">.</span><span class="ident" id="1645627">deferpool</span><span class="op" id="1645636">[</span><span class="ident" id="1645637">sc</span><span class="op" id="1645639">]</span>&nbsp;<span class="op" id="1645641">=</span>&nbsp;<span class="ident" id="1645643">d</span><span class="op" id="1645644">.</span><span class="ident" id="1645645">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1645652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1645655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1645658">if</span>&nbsp;<span class="ident" id="1645661">d</span>&nbsp;<span class="op" id="1645663">==</span>&nbsp;<span class="ident" id="1645666">nil</span>&nbsp;<span class="op" id="1645670">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1645674">//&nbsp;Allocate&nbsp;new&nbsp;defer+args.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645704">total</span>&nbsp;<span class="op" id="1645710">:=</span>&nbsp;<span class="ident" id="1645713">goroundupsize</span><span class="op" id="1645726">(</span><span class="ident" id="1645727">totaldefersize</span><span class="op" id="1645741">(</span><span class="builtintype" id="1645742">uintptr</span><span class="op" id="1645749">(</span><span class="ident" id="1645750">siz</span><span class="op" id="1645753">)</span><span class="op" id="1645754">)</span><span class="op" id="1645755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645759">d</span>&nbsp;<span class="op" id="1645761">=</span>&nbsp;<span class="op" id="1645763">(</span><span class="op" id="1645764">*</span><span class="ident" id="1645765">_defer</span><span class="op" id="1645771">)</span><span class="op" id="1645772">(</span><span class="ident" id="1645773">mallocgc</span><span class="op" id="1645781">(</span><span class="ident" id="1645782">total</span><span class="op" id="1645787">,</span>&nbsp;<span class="ident" id="1645789">deferType</span><span class="op" id="1645798">,</span>&nbsp;<span class="num" id="1645800">0</span><span class="op" id="1645801">)</span><span class="op" id="1645802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1645805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645808">d</span><span class="op" id="1645809">.</span><span class="ident" id="1645810">siz</span>&nbsp;<span class="op" id="1645814">=</span>&nbsp;<span class="ident" id="1645816">siz</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645821">gp</span>&nbsp;<span class="op" id="1645824">:=</span>&nbsp;<span class="ident" id="1645827">mp</span><span class="op" id="1645829">.</span><span class="ident" id="1645830">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645836">d</span><span class="op" id="1645837">.</span><span class="ident" id="1645838">link</span>&nbsp;<span class="op" id="1645843">=</span>&nbsp;<span class="ident" id="1645845">gp</span><span class="op" id="1645847">.</span><span class="ident" id="1645848">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645856">gp</span><span class="op" id="1645858">.</span><span class="ident" id="1645859">_defer</span>&nbsp;<span class="op" id="1645866">=</span>&nbsp;<span class="ident" id="1645868">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1645871">releasem</span><span class="op" id="1645879">(</span><span class="ident" id="1645880">mp</span><span class="op" id="1645882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1645885">return</span>&nbsp;<span class="ident" id="1645892">d</span><br>
<span class="lineno">185</span><span class="op" id="1645894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1645897">//&nbsp;Free&nbsp;the&nbsp;given&nbsp;defer.</span><br>
<span class="lineno"></span><span class="comment" id="1645922">//&nbsp;The&nbsp;defer&nbsp;cannot&nbsp;be&nbsp;used&nbsp;after&nbsp;this&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="1645967">//go:nosplit</span><br>
<span class="lineno">190</span><span class="keyword" id="1645980">func</span>&nbsp;<span class="ident" id="1645985">freedefer</span><span class="op" id="1645994">(</span><span class="ident" id="1645995">d</span>&nbsp;<span class="op" id="1645997">*</span><span class="ident" id="1645998">_defer</span><span class="op" id="1646004">)</span>&nbsp;<span class="op" id="1646006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1646009">if</span>&nbsp;<span class="ident" id="1646012">d</span><span class="op" id="1646013">.</span><span class="ident" id="1646014">_panic</span>&nbsp;<span class="op" id="1646021">!=</span>&nbsp;<span class="ident" id="1646024">nil</span>&nbsp;<span class="op" id="1646028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1646032">freedeferpanic</span><span class="op" id="1646046">(</span><span class="op" id="1646047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1646050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1646053">if</span>&nbsp;<span class="ident" id="1646056">d</span><span class="op" id="1646057">.</span><span class="ident" id="1646058">fn</span>&nbsp;<span class="op" id="1646061">!=</span>&nbsp;<span class="ident" id="1646064">nil</span>&nbsp;<span class="op" id="1646068">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1646072">freedeferfn</span><span class="op" id="1646083">(</span><span class="op" id="1646084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1646087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1646090">sc</span>&nbsp;<span class="op" id="1646093">:=</span>&nbsp;<span class="ident" id="1646096">deferclass</span><span class="op" id="1646106">(</span><span class="builtintype" id="1646107">uintptr</span><span class="op" id="1646114">(</span><span class="ident" id="1646115">d</span><span class="op" id="1646116">.</span><span class="ident" id="1646117">siz</span><span class="op" id="1646120">)</span><span class="op" id="1646121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1646124">if</span>&nbsp;<span class="ident" id="1646127">sc</span>&nbsp;<span class="op" id="1646130">&lt;</span>&nbsp;<span class="builtintype" id="1646132">uintptr</span><span class="op" id="1646139">(</span><span class="builtinfunc" id="1646140">len</span><span class="op" id="1646143">(</span><span class="ident" id="1646144">p</span><span class="op" id="1646145">{</span><span class="op" id="1646146">}</span><span class="op" id="1646147">.</span><span class="ident" id="1646148">deferpool</span><span class="op" id="1646157">)</span><span class="op" id="1646158">)</span>&nbsp;<span class="op" id="1646160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1646164">mp</span>&nbsp;<span class="op" id="1646167">:=</span>&nbsp;<span class="ident" id="1646170">acquirem</span><span class="op" id="1646178">(</span><span class="op" id="1646179">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1646183">pp</span>&nbsp;<span class="op" id="1646186">:=</span>&nbsp;<span class="ident" id="1646189">mp</span><span class="op" id="1646191">.</span><span class="ident" id="1646192">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1646196">*</span><span class="ident" id="1646197">d</span>&nbsp;<span class="op" id="1646199">=</span>&nbsp;<span class="ident" id="1646201">_defer</span><span class="op" id="1646207">{</span><span class="op" id="1646208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1646212">d</span><span class="op" id="1646213">.</span><span class="ident" id="1646214">link</span>&nbsp;<span class="op" id="1646219">=</span>&nbsp;<span class="ident" id="1646221">pp</span><span class="op" id="1646223">.</span><span class="ident" id="1646224">deferpool</span><span class="op" id="1646233">[</span><span class="ident" id="1646234">sc</span><span class="op" id="1646236">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1646240">pp</span><span class="op" id="1646242">.</span><span class="ident" id="1646243">deferpool</span><span class="op" id="1646252">[</span><span class="ident" id="1646253">sc</span><span class="op" id="1646255">]</span>&nbsp;<span class="op" id="1646257">=</span>&nbsp;<span class="ident" id="1646259">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1646263">releasem</span><span class="op" id="1646271">(</span><span class="ident" id="1646272">mp</span><span class="op" id="1646274">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1646277">}</span><br>
<span class="lineno"></span><span class="op" id="1646279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1646282">//&nbsp;Separate&nbsp;function&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;split&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="1646331">//&nbsp;Windows&nbsp;otherwise&nbsp;runs&nbsp;out&nbsp;of&nbsp;stack&nbsp;space.</span><br>
<span class="lineno">210</span><span class="keyword" id="1646377">func</span>&nbsp;<span class="ident" id="1646382">freedeferpanic</span><span class="op" id="1646396">(</span><span class="op" id="1646397">)</span>&nbsp;<span class="op" id="1646399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1646402">//&nbsp;_panic&nbsp;must&nbsp;be&nbsp;cleared&nbsp;before&nbsp;d&nbsp;is&nbsp;unlinked&nbsp;from&nbsp;gp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1646459">gothrow</span><span class="op" id="1646466">(</span><span class="string" id="1646467">&#34;freedefer&nbsp;with&nbsp;d._panic&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="1646499">)</span><br>
<span class="lineno"></span><span class="op" id="1646501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="1646504">func</span>&nbsp;<span class="ident" id="1646509">freedeferfn</span><span class="op" id="1646520">(</span><span class="op" id="1646521">)</span>&nbsp;<span class="op" id="1646523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1646526">//&nbsp;fn&nbsp;must&nbsp;be&nbsp;cleared&nbsp;before&nbsp;d&nbsp;is&nbsp;unlinked&nbsp;from&nbsp;gp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1646579">gothrow</span><span class="op" id="1646586">(</span><span class="string" id="1646587">&#34;freedefer&nbsp;with&nbsp;d.fn&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="1646615">)</span><br>
<span class="lineno"></span><span class="op" id="1646617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="1646620">//&nbsp;Run&nbsp;a&nbsp;deferred&nbsp;function&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno"></span><span class="comment" id="1646664">//&nbsp;The&nbsp;compiler&nbsp;inserts&nbsp;a&nbsp;call&nbsp;to&nbsp;this&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="1646721">//&nbsp;function&nbsp;which&nbsp;calls&nbsp;defer.</span><br>
<span class="lineno"></span><span class="comment" id="1646752">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;deferred&nbsp;function,&nbsp;this&nbsp;will&nbsp;call&nbsp;runtime·jmpdefer,</span><br>
<span class="lineno"></span><span class="comment" id="1646822">//&nbsp;which&nbsp;will&nbsp;jump&nbsp;to&nbsp;the&nbsp;deferred&nbsp;function&nbsp;such&nbsp;that&nbsp;it&nbsp;appears</span><br>
<span class="lineno">225</span><span class="comment" id="1646887">//&nbsp;to&nbsp;have&nbsp;been&nbsp;called&nbsp;by&nbsp;the&nbsp;caller&nbsp;of&nbsp;deferreturn&nbsp;at&nbsp;the&nbsp;point</span><br>
<span class="lineno"></span><span class="comment" id="1646952">//&nbsp;just&nbsp;before&nbsp;deferreturn&nbsp;was&nbsp;called.&nbsp;&nbsp;The&nbsp;effect&nbsp;is&nbsp;that&nbsp;deferreturn</span><br>
<span class="lineno"></span><span class="comment" id="1647023">//&nbsp;is&nbsp;called&nbsp;again&nbsp;and&nbsp;again&nbsp;until&nbsp;there&nbsp;are&nbsp;no&nbsp;more&nbsp;deferred&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="1647096">//&nbsp;Cannot&nbsp;split&nbsp;the&nbsp;stack&nbsp;because&nbsp;we&nbsp;reuse&nbsp;the&nbsp;caller&#39;s&nbsp;frame&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1647161">//&nbsp;call&nbsp;the&nbsp;deferred&nbsp;function.</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="1647193">//&nbsp;The&nbsp;single&nbsp;argument&nbsp;isn&#39;t&nbsp;actually&nbsp;used&nbsp;-&nbsp;it&nbsp;just&nbsp;has&nbsp;its&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="1647262">//&nbsp;taken&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;matched&nbsp;against&nbsp;pending&nbsp;defers.</span><br>
<span class="lineno"></span><span class="comment" id="1647316">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1647329">func</span>&nbsp;<span class="ident" id="1647334">deferreturn</span><span class="op" id="1647345">(</span><span class="ident" id="1647346">arg0</span>&nbsp;<span class="builtintype" id="1647351">uintptr</span><span class="op" id="1647358">)</span>&nbsp;<span class="op" id="1647360">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647363">gp</span>&nbsp;<span class="op" id="1647366">:=</span>&nbsp;<span class="ident" id="1647369">getg</span><span class="op" id="1647373">(</span><span class="op" id="1647374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647377">d</span>&nbsp;<span class="op" id="1647379">:=</span>&nbsp;<span class="ident" id="1647382">gp</span><span class="op" id="1647384">.</span><span class="ident" id="1647385">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647393">if</span>&nbsp;<span class="ident" id="1647396">d</span>&nbsp;<span class="op" id="1647398">==</span>&nbsp;<span class="ident" id="1647401">nil</span>&nbsp;<span class="op" id="1647405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647409">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1647417">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647420">argp</span>&nbsp;<span class="op" id="1647425">:=</span>&nbsp;<span class="builtintype" id="1647428">uintptr</span><span class="op" id="1647435">(</span><span class="ident" id="1647436">unsafe</span><span class="op" id="1647442">.</span><span class="ident" id="1647443">Pointer</span><span class="op" id="1647450">(</span><span class="op" id="1647451">&amp;</span><span class="ident" id="1647452">arg0</span><span class="op" id="1647456">)</span><span class="op" id="1647457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647460">if</span>&nbsp;<span class="ident" id="1647463">d</span><span class="op" id="1647464">.</span><span class="ident" id="1647465">argp</span>&nbsp;<span class="op" id="1647470">!=</span>&nbsp;<span class="ident" id="1647473">argp</span>&nbsp;<span class="op" id="1647478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647482">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1647490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1647494">//&nbsp;Moving&nbsp;arguments&nbsp;around.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1647523">//&nbsp;Do&nbsp;not&nbsp;allow&nbsp;preemption&nbsp;here,&nbsp;because&nbsp;the&nbsp;garbage&nbsp;collector</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1647587">//&nbsp;won&#39;t&nbsp;know&nbsp;the&nbsp;form&nbsp;of&nbsp;the&nbsp;arguments&nbsp;until&nbsp;the&nbsp;jmpdefer&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1647651">//&nbsp;flip&nbsp;the&nbsp;PC&nbsp;over&nbsp;to&nbsp;fn.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647679">mp</span>&nbsp;<span class="op" id="1647682">:=</span>&nbsp;<span class="ident" id="1647685">acquirem</span><span class="op" id="1647693">(</span><span class="op" id="1647694">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647697">memmove</span><span class="op" id="1647704">(</span><span class="ident" id="1647705">unsafe</span><span class="op" id="1647711">.</span><span class="ident" id="1647712">Pointer</span><span class="op" id="1647719">(</span><span class="ident" id="1647720">argp</span><span class="op" id="1647724">)</span><span class="op" id="1647725">,</span>&nbsp;<span class="ident" id="1647727">deferArgs</span><span class="op" id="1647736">(</span><span class="ident" id="1647737">d</span><span class="op" id="1647738">)</span><span class="op" id="1647739">,</span>&nbsp;<span class="builtintype" id="1647741">uintptr</span><span class="op" id="1647748">(</span><span class="ident" id="1647749">d</span><span class="op" id="1647750">.</span><span class="ident" id="1647751">siz</span><span class="op" id="1647754">)</span><span class="op" id="1647755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647758">fn</span>&nbsp;<span class="op" id="1647761">:=</span>&nbsp;<span class="ident" id="1647764">d</span><span class="op" id="1647765">.</span><span class="ident" id="1647766">fn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647770">d</span><span class="op" id="1647771">.</span><span class="ident" id="1647772">fn</span>&nbsp;<span class="op" id="1647775">=</span>&nbsp;<span class="ident" id="1647777">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647782">gp</span><span class="op" id="1647784">.</span><span class="ident" id="1647785">_defer</span>&nbsp;<span class="op" id="1647792">=</span>&nbsp;<span class="ident" id="1647794">d</span><span class="op" id="1647795">.</span><span class="ident" id="1647796">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647802">freedefer</span><span class="op" id="1647811">(</span><span class="ident" id="1647812">d</span><span class="op" id="1647813">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647816">releasem</span><span class="op" id="1647824">(</span><span class="ident" id="1647825">mp</span><span class="op" id="1647827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647830">jmpdefer</span><span class="op" id="1647838">(</span><span class="ident" id="1647839">fn</span><span class="op" id="1647841">,</span>&nbsp;<span class="ident" id="1647843">argp</span><span class="op" id="1647847">)</span><br>
<span class="lineno"></span><span class="op" id="1647849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1647852">//&nbsp;Goexit&nbsp;terminates&nbsp;the&nbsp;goroutine&nbsp;that&nbsp;calls&nbsp;it.&nbsp;&nbsp;No&nbsp;other&nbsp;goroutine&nbsp;is&nbsp;affected.</span><br>
<span class="lineno">260</span><span class="comment" id="1647935">//&nbsp;Goexit&nbsp;runs&nbsp;all&nbsp;deferred&nbsp;calls&nbsp;before&nbsp;terminating&nbsp;the&nbsp;goroutine.&nbsp;&nbsp;Because&nbsp;Goexit</span><br>
<span class="lineno"></span><span class="comment" id="1648019">//&nbsp;is&nbsp;not&nbsp;panic,&nbsp;however,&nbsp;any&nbsp;recover&nbsp;calls&nbsp;in&nbsp;those&nbsp;deferred&nbsp;functions&nbsp;will&nbsp;return&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="1648108">//</span><br>
<span class="lineno"></span><span class="comment" id="1648111">//&nbsp;Calling&nbsp;Goexit&nbsp;from&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;terminates&nbsp;that&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1648179">//&nbsp;without&nbsp;func&nbsp;main&nbsp;returning.&nbsp;Since&nbsp;func&nbsp;main&nbsp;has&nbsp;not&nbsp;returned,</span><br>
<span class="lineno">265</span><span class="comment" id="1648245">//&nbsp;the&nbsp;program&nbsp;continues&nbsp;execution&nbsp;of&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="1648301">//&nbsp;If&nbsp;all&nbsp;other&nbsp;goroutines&nbsp;exit,&nbsp;the&nbsp;program&nbsp;crashes.</span><br>
<span class="lineno"></span><span class="keyword" id="1648355">func</span>&nbsp;<span class="ident" id="1648360">Goexit</span><span class="op" id="1648366">(</span><span class="op" id="1648367">)</span>&nbsp;<span class="op" id="1648369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1648372">//&nbsp;Run&nbsp;all&nbsp;deferred&nbsp;functions&nbsp;for&nbsp;the&nbsp;current&nbsp;goroutine.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1648430">//&nbsp;This&nbsp;code&nbsp;is&nbsp;similar&nbsp;to&nbsp;gopanic,&nbsp;see&nbsp;that&nbsp;implementation</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1648491">//&nbsp;for&nbsp;detailed&nbsp;comments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648518">gp</span>&nbsp;<span class="op" id="1648521">:=</span>&nbsp;<span class="ident" id="1648524">getg</span><span class="op" id="1648528">(</span><span class="op" id="1648529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1648532">for</span>&nbsp;<span class="op" id="1648536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648540">d</span>&nbsp;<span class="op" id="1648542">:=</span>&nbsp;<span class="ident" id="1648545">gp</span><span class="op" id="1648547">.</span><span class="ident" id="1648548">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1648557">if</span>&nbsp;<span class="ident" id="1648560">d</span>&nbsp;<span class="op" id="1648562">==</span>&nbsp;<span class="ident" id="1648565">nil</span>&nbsp;<span class="op" id="1648569">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1648574">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1648582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1648586">if</span>&nbsp;<span class="ident" id="1648589">d</span><span class="op" id="1648590">.</span><span class="ident" id="1648591">started</span>&nbsp;<span class="op" id="1648599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1648604">if</span>&nbsp;<span class="ident" id="1648607">d</span><span class="op" id="1648608">.</span><span class="ident" id="1648609">_panic</span>&nbsp;<span class="op" id="1648616">!=</span>&nbsp;<span class="ident" id="1648619">nil</span>&nbsp;<span class="op" id="1648623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648629">d</span><span class="op" id="1648630">.</span><span class="ident" id="1648631">_panic</span><span class="op" id="1648637">.</span><span class="ident" id="1648638">aborted</span>&nbsp;<span class="op" id="1648646">=</span>&nbsp;<span class="builtintype" id="1648648">true</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648657">d</span><span class="op" id="1648658">.</span><span class="ident" id="1648659">_panic</span>&nbsp;<span class="op" id="1648666">=</span>&nbsp;<span class="ident" id="1648668">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1648675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648680">d</span><span class="op" id="1648681">.</span><span class="ident" id="1648682">fn</span>&nbsp;<span class="op" id="1648685">=</span>&nbsp;<span class="ident" id="1648687">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648694">gp</span><span class="op" id="1648696">.</span><span class="ident" id="1648697">_defer</span>&nbsp;<span class="op" id="1648704">=</span>&nbsp;<span class="ident" id="1648706">d</span><span class="op" id="1648707">.</span><span class="ident" id="1648708">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648716">freedefer</span><span class="op" id="1648725">(</span><span class="ident" id="1648726">d</span><span class="op" id="1648727">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1648732">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1648743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648747">d</span><span class="op" id="1648748">.</span><span class="ident" id="1648749">started</span>&nbsp;<span class="op" id="1648757">=</span>&nbsp;<span class="builtintype" id="1648759">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648766">reflectcall</span><span class="op" id="1648777">(</span><span class="ident" id="1648778">unsafe</span><span class="op" id="1648784">.</span><span class="ident" id="1648785">Pointer</span><span class="op" id="1648792">(</span><span class="ident" id="1648793">d</span><span class="op" id="1648794">.</span><span class="ident" id="1648795">fn</span><span class="op" id="1648797">)</span><span class="op" id="1648798">,</span>&nbsp;<span class="ident" id="1648800">deferArgs</span><span class="op" id="1648809">(</span><span class="ident" id="1648810">d</span><span class="op" id="1648811">)</span><span class="op" id="1648812">,</span>&nbsp;<span class="builtintype" id="1648814">uint32</span><span class="op" id="1648820">(</span><span class="ident" id="1648821">d</span><span class="op" id="1648822">.</span><span class="ident" id="1648823">siz</span><span class="op" id="1648826">)</span><span class="op" id="1648827">,</span>&nbsp;<span class="builtintype" id="1648829">uint32</span><span class="op" id="1648835">(</span><span class="ident" id="1648836">d</span><span class="op" id="1648837">.</span><span class="ident" id="1648838">siz</span><span class="op" id="1648841">)</span><span class="op" id="1648842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1648846">if</span>&nbsp;<span class="ident" id="1648849">gp</span><span class="op" id="1648851">.</span><span class="ident" id="1648852">_defer</span>&nbsp;<span class="op" id="1648859">!=</span>&nbsp;<span class="ident" id="1648862">d</span>&nbsp;<span class="op" id="1648864">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648869">gothrow</span><span class="op" id="1648876">(</span><span class="string" id="1648877">&#34;bad&nbsp;defer&nbsp;entry&nbsp;in&nbsp;Goexit&#34;</span><span class="op" id="1648904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1648908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648912">d</span><span class="op" id="1648913">.</span><span class="ident" id="1648914">_panic</span>&nbsp;<span class="op" id="1648921">=</span>&nbsp;<span class="ident" id="1648923">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648929">d</span><span class="op" id="1648930">.</span><span class="ident" id="1648931">fn</span>&nbsp;<span class="op" id="1648934">=</span>&nbsp;<span class="ident" id="1648936">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648942">gp</span><span class="op" id="1648944">.</span><span class="ident" id="1648945">_defer</span>&nbsp;<span class="op" id="1648952">=</span>&nbsp;<span class="ident" id="1648954">d</span><span class="op" id="1648955">.</span><span class="ident" id="1648956">link</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648963">freedefer</span><span class="op" id="1648972">(</span><span class="ident" id="1648973">d</span><span class="op" id="1648974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1648978">//&nbsp;Note:&nbsp;we&nbsp;ignore&nbsp;recovers&nbsp;here&nbsp;because&nbsp;Goexit&nbsp;isn&#39;t&nbsp;a&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1649041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649044">goexit</span><span class="op" id="1649050">(</span><span class="op" id="1649051">)</span><br>
<span class="lineno"></span><span class="op" id="1649053">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="keyword" id="1649056">func</span>&nbsp;<span class="ident" id="1649061">canpanic</span><span class="op" id="1649069">(</span><span class="op" id="1649070">*</span><span class="ident" id="1649071">g</span><span class="op" id="1649072">)</span>&nbsp;<span class="builtintype" id="1649074">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1649080">//&nbsp;Print&nbsp;all&nbsp;currently&nbsp;active&nbsp;panics.&nbsp;&nbsp;Used&nbsp;when&nbsp;crashing.</span><br>
<span class="lineno"></span><span class="keyword" id="1649139">func</span>&nbsp;<span class="ident" id="1649144">printpanics</span><span class="op" id="1649155">(</span><span class="ident" id="1649156">p</span>&nbsp;<span class="op" id="1649158">*</span><span class="ident" id="1649159">_panic</span><span class="op" id="1649165">)</span>&nbsp;<span class="op" id="1649167">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649170">if</span>&nbsp;<span class="ident" id="1649173">p</span><span class="op" id="1649174">.</span><span class="ident" id="1649175">link</span>&nbsp;<span class="op" id="1649180">!=</span>&nbsp;<span class="ident" id="1649183">nil</span>&nbsp;<span class="op" id="1649187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649191">printpanics</span><span class="op" id="1649202">(</span><span class="ident" id="1649203">p</span><span class="op" id="1649204">.</span><span class="ident" id="1649205">link</span><span class="op" id="1649209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1649213">print</span><span class="op" id="1649218">(</span><span class="string" id="1649219">&#34;\t&#34;</span><span class="op" id="1649223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1649226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1649229">print</span><span class="op" id="1649234">(</span><span class="string" id="1649235">&#34;panic:&nbsp;&#34;</span><span class="op" id="1649244">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649247">printany</span><span class="op" id="1649255">(</span><span class="ident" id="1649256">p</span><span class="op" id="1649257">.</span><span class="ident" id="1649258">arg</span><span class="op" id="1649261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649264">if</span>&nbsp;<span class="ident" id="1649267">p</span><span class="op" id="1649268">.</span><span class="ident" id="1649269">recovered</span>&nbsp;<span class="op" id="1649279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1649283">print</span><span class="op" id="1649288">(</span><span class="string" id="1649289">&#34;&nbsp;[recovered]&#34;</span><span class="op" id="1649303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1649306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1649309">print</span><span class="op" id="1649314">(</span><span class="string" id="1649315">&#34;\n&#34;</span><span class="op" id="1649319">)</span><br>
<span class="lineno">315</span><span class="op" id="1649321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1649324">//&nbsp;The&nbsp;implementation&nbsp;of&nbsp;the&nbsp;predeclared&nbsp;function&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="1649381">func</span>&nbsp;<span class="ident" id="1649386">gopanic</span><span class="op" id="1649393">(</span><span class="ident" id="1649394">e</span>&nbsp;<span class="keyword" id="1649396">interface</span><span class="op" id="1649405">{</span><span class="op" id="1649406">}</span><span class="op" id="1649407">)</span>&nbsp;<span class="op" id="1649409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649412">gp</span>&nbsp;<span class="op" id="1649415">:=</span>&nbsp;<span class="ident" id="1649418">getg</span><span class="op" id="1649422">(</span><span class="op" id="1649423">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649426">if</span>&nbsp;<span class="ident" id="1649429">gp</span><span class="op" id="1649431">.</span><span class="ident" id="1649432">m</span><span class="op" id="1649433">.</span><span class="ident" id="1649434">curg</span>&nbsp;<span class="op" id="1649439">!=</span>&nbsp;<span class="ident" id="1649442">gp</span>&nbsp;<span class="op" id="1649445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649449">gothrow</span><span class="op" id="1649456">(</span><span class="string" id="1649457">&#34;panic&nbsp;on&nbsp;m&nbsp;stack&#34;</span><span class="op" id="1649475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1649478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1649482">//&nbsp;m.softfloat&nbsp;is&nbsp;set&nbsp;during&nbsp;software&nbsp;floating&nbsp;point.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1649537">//&nbsp;It&nbsp;increments&nbsp;m.locks&nbsp;to&nbsp;avoid&nbsp;preemption.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1649584">//&nbsp;We&nbsp;moved&nbsp;the&nbsp;memory&nbsp;loads&nbsp;out,&nbsp;so&nbsp;there&nbsp;shouldn&#39;t&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1649641">//&nbsp;any&nbsp;reason&nbsp;for&nbsp;it&nbsp;to&nbsp;panic&nbsp;anymore.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649681">if</span>&nbsp;<span class="ident" id="1649684">gp</span><span class="op" id="1649686">.</span><span class="ident" id="1649687">m</span><span class="op" id="1649688">.</span><span class="ident" id="1649689">softfloat</span>&nbsp;<span class="op" id="1649699">!=</span>&nbsp;<span class="num" id="1649702">0</span>&nbsp;<span class="op" id="1649704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649708">gp</span><span class="op" id="1649710">.</span><span class="ident" id="1649711">m</span><span class="op" id="1649712">.</span><span class="ident" id="1649713">locks</span><span class="op" id="1649718">--</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649723">gp</span><span class="op" id="1649725">.</span><span class="ident" id="1649726">m</span><span class="op" id="1649727">.</span><span class="ident" id="1649728">softfloat</span>&nbsp;<span class="op" id="1649738">=</span>&nbsp;<span class="num" id="1649740">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649744">gothrow</span><span class="op" id="1649751">(</span><span class="string" id="1649752">&#34;panic&nbsp;during&nbsp;softfloat&#34;</span><span class="op" id="1649776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1649779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649782">if</span>&nbsp;<span class="ident" id="1649785">gp</span><span class="op" id="1649787">.</span><span class="ident" id="1649788">m</span><span class="op" id="1649789">.</span><span class="ident" id="1649790">mallocing</span>&nbsp;<span class="op" id="1649800">!=</span>&nbsp;<span class="num" id="1649803">0</span>&nbsp;<span class="op" id="1649805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1649809">print</span><span class="op" id="1649814">(</span><span class="string" id="1649815">&#34;panic:&nbsp;&#34;</span><span class="op" id="1649824">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649828">printany</span><span class="op" id="1649836">(</span><span class="ident" id="1649837">e</span><span class="op" id="1649838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1649842">print</span><span class="op" id="1649847">(</span><span class="string" id="1649848">&#34;\n&#34;</span><span class="op" id="1649852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649856">gothrow</span><span class="op" id="1649863">(</span><span class="string" id="1649864">&#34;panic&nbsp;during&nbsp;malloc&#34;</span><span class="op" id="1649885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1649888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649891">if</span>&nbsp;<span class="ident" id="1649894">gp</span><span class="op" id="1649896">.</span><span class="ident" id="1649897">m</span><span class="op" id="1649898">.</span><span class="ident" id="1649899">gcing</span>&nbsp;<span class="op" id="1649905">!=</span>&nbsp;<span class="num" id="1649908">0</span>&nbsp;<span class="op" id="1649910">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1649914">print</span><span class="op" id="1649919">(</span><span class="string" id="1649920">&#34;panic:&nbsp;&#34;</span><span class="op" id="1649929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649933">printany</span><span class="op" id="1649941">(</span><span class="ident" id="1649942">e</span><span class="op" id="1649943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1649947">print</span><span class="op" id="1649952">(</span><span class="string" id="1649953">&#34;\n&#34;</span><span class="op" id="1649957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649961">gothrow</span><span class="op" id="1649968">(</span><span class="string" id="1649969">&#34;panic&nbsp;during&nbsp;gc&#34;</span><span class="op" id="1649986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1649989">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649992">if</span>&nbsp;<span class="ident" id="1649995">gp</span><span class="op" id="1649997">.</span><span class="ident" id="1649998">m</span><span class="op" id="1649999">.</span><span class="ident" id="1650000">locks</span>&nbsp;<span class="op" id="1650006">!=</span>&nbsp;<span class="num" id="1650009">0</span>&nbsp;<span class="op" id="1650011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1650015">print</span><span class="op" id="1650020">(</span><span class="string" id="1650021">&#34;panic:&nbsp;&#34;</span><span class="op" id="1650030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650034">printany</span><span class="op" id="1650042">(</span><span class="ident" id="1650043">e</span><span class="op" id="1650044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1650048">print</span><span class="op" id="1650053">(</span><span class="string" id="1650054">&#34;\n&#34;</span><span class="op" id="1650058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650062">gothrow</span><span class="op" id="1650069">(</span><span class="string" id="1650070">&#34;panic&nbsp;holding&nbsp;locks&#34;</span><span class="op" id="1650091">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1650094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650098">var</span>&nbsp;<span class="ident" id="1650102">p</span>&nbsp;<span class="ident" id="1650104">_panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650112">p</span><span class="op" id="1650113">.</span><span class="ident" id="1650114">arg</span>&nbsp;<span class="op" id="1650118">=</span>&nbsp;<span class="ident" id="1650120">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650123">p</span><span class="op" id="1650124">.</span><span class="ident" id="1650125">link</span>&nbsp;<span class="op" id="1650130">=</span>&nbsp;<span class="ident" id="1650132">gp</span><span class="op" id="1650134">.</span><span class="ident" id="1650135">_panic</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650143">gp</span><span class="op" id="1650145">.</span><span class="ident" id="1650146">_panic</span>&nbsp;<span class="op" id="1650153">=</span>&nbsp;<span class="op" id="1650155">(</span><span class="op" id="1650156">*</span><span class="ident" id="1650157">_panic</span><span class="op" id="1650163">)</span><span class="op" id="1650164">(</span><span class="ident" id="1650165">noescape</span><span class="op" id="1650173">(</span><span class="ident" id="1650174">unsafe</span><span class="op" id="1650180">.</span><span class="ident" id="1650181">Pointer</span><span class="op" id="1650188">(</span><span class="op" id="1650189">&amp;</span><span class="ident" id="1650190">p</span><span class="op" id="1650191">)</span><span class="op" id="1650192">)</span><span class="op" id="1650193">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650197">for</span>&nbsp;<span class="op" id="1650201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650205">d</span>&nbsp;<span class="op" id="1650207">:=</span>&nbsp;<span class="ident" id="1650210">gp</span><span class="op" id="1650212">.</span><span class="ident" id="1650213">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650222">if</span>&nbsp;<span class="ident" id="1650225">d</span>&nbsp;<span class="op" id="1650227">==</span>&nbsp;<span class="ident" id="1650230">nil</span>&nbsp;<span class="op" id="1650234">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650239">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1650247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650252">//&nbsp;If&nbsp;defer&nbsp;was&nbsp;started&nbsp;by&nbsp;earlier&nbsp;panic&nbsp;or&nbsp;Goexit&nbsp;(and,&nbsp;since&nbsp;we&#39;re&nbsp;back&nbsp;here,&nbsp;that&nbsp;triggered&nbsp;a&nbsp;new&nbsp;panic),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650363">//&nbsp;take&nbsp;defer&nbsp;off&nbsp;list.&nbsp;The&nbsp;earlier&nbsp;panic&nbsp;or&nbsp;Goexit&nbsp;will&nbsp;not&nbsp;continue&nbsp;running.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650444">if</span>&nbsp;<span class="ident" id="1650447">d</span><span class="op" id="1650448">.</span><span class="ident" id="1650449">started</span>&nbsp;<span class="op" id="1650457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650462">if</span>&nbsp;<span class="ident" id="1650465">d</span><span class="op" id="1650466">.</span><span class="ident" id="1650467">_panic</span>&nbsp;<span class="op" id="1650474">!=</span>&nbsp;<span class="ident" id="1650477">nil</span>&nbsp;<span class="op" id="1650481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650487">d</span><span class="op" id="1650488">.</span><span class="ident" id="1650489">_panic</span><span class="op" id="1650495">.</span><span class="ident" id="1650496">aborted</span>&nbsp;<span class="op" id="1650504">=</span>&nbsp;<span class="builtintype" id="1650506">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1650514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650519">d</span><span class="op" id="1650520">.</span><span class="ident" id="1650521">_panic</span>&nbsp;<span class="op" id="1650528">=</span>&nbsp;<span class="ident" id="1650530">nil</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650537">d</span><span class="op" id="1650538">.</span><span class="ident" id="1650539">fn</span>&nbsp;<span class="op" id="1650542">=</span>&nbsp;<span class="ident" id="1650544">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650551">gp</span><span class="op" id="1650553">.</span><span class="ident" id="1650554">_defer</span>&nbsp;<span class="op" id="1650561">=</span>&nbsp;<span class="ident" id="1650563">d</span><span class="op" id="1650564">.</span><span class="ident" id="1650565">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650573">freedefer</span><span class="op" id="1650582">(</span><span class="ident" id="1650583">d</span><span class="op" id="1650584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650589">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1650600">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650605">//&nbsp;Mark&nbsp;defer&nbsp;as&nbsp;started,&nbsp;but&nbsp;keep&nbsp;on&nbsp;list,&nbsp;so&nbsp;that&nbsp;traceback</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650669">//&nbsp;can&nbsp;find&nbsp;and&nbsp;update&nbsp;the&nbsp;defer&#39;s&nbsp;argument&nbsp;frame&nbsp;if&nbsp;stack&nbsp;growth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650737">//&nbsp;or&nbsp;a&nbsp;garbage&nbsp;collection&nbsp;hapens&nbsp;before&nbsp;reflectcall&nbsp;starts&nbsp;executing&nbsp;d.fn.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650815">d</span><span class="op" id="1650816">.</span><span class="ident" id="1650817">started</span>&nbsp;<span class="op" id="1650825">=</span>&nbsp;<span class="builtintype" id="1650827">true</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650835">//&nbsp;Record&nbsp;the&nbsp;panic&nbsp;that&nbsp;is&nbsp;running&nbsp;the&nbsp;defer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650884">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;new&nbsp;panic&nbsp;during&nbsp;the&nbsp;deferred&nbsp;call,&nbsp;that&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650950">//&nbsp;will&nbsp;find&nbsp;d&nbsp;in&nbsp;the&nbsp;list&nbsp;and&nbsp;will&nbsp;mark&nbsp;d._panic&nbsp;(this&nbsp;panic)&nbsp;aborted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651024">d</span><span class="op" id="1651025">.</span><span class="ident" id="1651026">_panic</span>&nbsp;<span class="op" id="1651033">=</span>&nbsp;<span class="op" id="1651035">(</span><span class="op" id="1651036">*</span><span class="ident" id="1651037">_panic</span><span class="op" id="1651043">)</span><span class="op" id="1651044">(</span><span class="ident" id="1651045">noescape</span><span class="op" id="1651053">(</span><span class="op" id="1651054">(</span><span class="ident" id="1651055">unsafe</span><span class="op" id="1651061">.</span><span class="ident" id="1651062">Pointer</span><span class="op" id="1651069">)</span><span class="op" id="1651070">(</span><span class="op" id="1651071">&amp;</span><span class="ident" id="1651072">p</span><span class="op" id="1651073">)</span><span class="op" id="1651074">)</span><span class="op" id="1651075">)</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651080">p</span><span class="op" id="1651081">.</span><span class="ident" id="1651082">argp</span>&nbsp;<span class="op" id="1651087">=</span>&nbsp;<span class="ident" id="1651089">unsafe</span><span class="op" id="1651095">.</span><span class="ident" id="1651096">Pointer</span><span class="op" id="1651103">(</span><span class="ident" id="1651104">getargp</span><span class="op" id="1651111">(</span><span class="num" id="1651112">0</span><span class="op" id="1651113">)</span><span class="op" id="1651114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651118">reflectcall</span><span class="op" id="1651129">(</span><span class="ident" id="1651130">unsafe</span><span class="op" id="1651136">.</span><span class="ident" id="1651137">Pointer</span><span class="op" id="1651144">(</span><span class="ident" id="1651145">d</span><span class="op" id="1651146">.</span><span class="ident" id="1651147">fn</span><span class="op" id="1651149">)</span><span class="op" id="1651150">,</span>&nbsp;<span class="ident" id="1651152">deferArgs</span><span class="op" id="1651161">(</span><span class="ident" id="1651162">d</span><span class="op" id="1651163">)</span><span class="op" id="1651164">,</span>&nbsp;<span class="builtintype" id="1651166">uint32</span><span class="op" id="1651172">(</span><span class="ident" id="1651173">d</span><span class="op" id="1651174">.</span><span class="ident" id="1651175">siz</span><span class="op" id="1651178">)</span><span class="op" id="1651179">,</span>&nbsp;<span class="builtintype" id="1651181">uint32</span><span class="op" id="1651187">(</span><span class="ident" id="1651188">d</span><span class="op" id="1651189">.</span><span class="ident" id="1651190">siz</span><span class="op" id="1651193">)</span><span class="op" id="1651194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651198">p</span><span class="op" id="1651199">.</span><span class="ident" id="1651200">argp</span>&nbsp;<span class="op" id="1651205">=</span>&nbsp;<span class="ident" id="1651207">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1651214">//&nbsp;reflectcall&nbsp;did&nbsp;not&nbsp;panic.&nbsp;Remove&nbsp;d.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651256">if</span>&nbsp;<span class="ident" id="1651259">gp</span><span class="op" id="1651261">.</span><span class="ident" id="1651262">_defer</span>&nbsp;<span class="op" id="1651269">!=</span>&nbsp;<span class="ident" id="1651272">d</span>&nbsp;<span class="op" id="1651274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651279">gothrow</span><span class="op" id="1651286">(</span><span class="string" id="1651287">&#34;bad&nbsp;defer&nbsp;entry&nbsp;in&nbsp;panic&#34;</span><span class="op" id="1651313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1651317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651321">d</span><span class="op" id="1651322">.</span><span class="ident" id="1651323">_panic</span>&nbsp;<span class="op" id="1651330">=</span>&nbsp;<span class="ident" id="1651332">nil</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651338">d</span><span class="op" id="1651339">.</span><span class="ident" id="1651340">fn</span>&nbsp;<span class="op" id="1651343">=</span>&nbsp;<span class="ident" id="1651345">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651351">gp</span><span class="op" id="1651353">.</span><span class="ident" id="1651354">_defer</span>&nbsp;<span class="op" id="1651361">=</span>&nbsp;<span class="ident" id="1651363">d</span><span class="op" id="1651364">.</span><span class="ident" id="1651365">link</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1651373">//&nbsp;trigger&nbsp;shrinkage&nbsp;to&nbsp;test&nbsp;stack&nbsp;copy.&nbsp;&nbsp;See&nbsp;stack_test.go:TestStackPanic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1651450">//GC()</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651460">pc</span>&nbsp;<span class="op" id="1651463">:=</span>&nbsp;<span class="ident" id="1651466">d</span><span class="op" id="1651467">.</span><span class="ident" id="1651468">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651473">argp</span>&nbsp;<span class="op" id="1651478">:=</span>&nbsp;<span class="ident" id="1651481">unsafe</span><span class="op" id="1651487">.</span><span class="ident" id="1651488">Pointer</span><span class="op" id="1651495">(</span><span class="ident" id="1651496">d</span><span class="op" id="1651497">.</span><span class="ident" id="1651498">argp</span><span class="op" id="1651502">)</span>&nbsp;<span class="comment" id="1651504">//&nbsp;must&nbsp;be&nbsp;pointer&nbsp;so&nbsp;it&nbsp;gets&nbsp;adjusted&nbsp;during&nbsp;stack&nbsp;copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651563">freedefer</span><span class="op" id="1651572">(</span><span class="ident" id="1651573">d</span><span class="op" id="1651574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651578">if</span>&nbsp;<span class="ident" id="1651581">p</span><span class="op" id="1651582">.</span><span class="ident" id="1651583">recovered</span>&nbsp;<span class="op" id="1651593">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651598">gp</span><span class="op" id="1651600">.</span><span class="ident" id="1651601">_panic</span>&nbsp;<span class="op" id="1651608">=</span>&nbsp;<span class="ident" id="1651610">p</span><span class="op" id="1651611">.</span><span class="ident" id="1651612">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1651620">//&nbsp;Aborted&nbsp;panics&nbsp;are&nbsp;marked&nbsp;but&nbsp;remain&nbsp;on&nbsp;the&nbsp;g.panic&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1651684">//&nbsp;Remove&nbsp;them&nbsp;from&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651717">for</span>&nbsp;<span class="ident" id="1651721">gp</span><span class="op" id="1651723">.</span><span class="ident" id="1651724">_panic</span>&nbsp;<span class="op" id="1651731">!=</span>&nbsp;<span class="ident" id="1651734">nil</span>&nbsp;<span class="op" id="1651738">&amp;&amp;</span>&nbsp;<span class="ident" id="1651741">gp</span><span class="op" id="1651743">.</span><span class="ident" id="1651744">_panic</span><span class="op" id="1651750">.</span><span class="ident" id="1651751">aborted</span>&nbsp;<span class="op" id="1651759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651765">gp</span><span class="op" id="1651767">.</span><span class="ident" id="1651768">_panic</span>&nbsp;<span class="op" id="1651775">=</span>&nbsp;<span class="ident" id="1651777">gp</span><span class="op" id="1651779">.</span><span class="ident" id="1651780">_panic</span><span class="op" id="1651786">.</span><span class="ident" id="1651787">link</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1651795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651800">if</span>&nbsp;<span class="ident" id="1651803">gp</span><span class="op" id="1651805">.</span><span class="ident" id="1651806">_panic</span>&nbsp;<span class="op" id="1651813">==</span>&nbsp;<span class="ident" id="1651816">nil</span>&nbsp;<span class="op" id="1651820">{</span>&nbsp;<span class="comment" id="1651822">//&nbsp;must&nbsp;be&nbsp;done&nbsp;with&nbsp;signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651854">gp</span><span class="op" id="1651856">.</span><span class="ident" id="1651857">sig</span>&nbsp;<span class="op" id="1651861">=</span>&nbsp;<span class="num" id="1651863">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1651868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1651873">//&nbsp;Pass&nbsp;information&nbsp;about&nbsp;recovering&nbsp;frame&nbsp;to&nbsp;recovery.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651932">gp</span><span class="op" id="1651934">.</span><span class="ident" id="1651935">sigcode0</span>&nbsp;<span class="op" id="1651944">=</span>&nbsp;<span class="builtintype" id="1651946">uintptr</span><span class="op" id="1651953">(</span><span class="ident" id="1651954">argp</span><span class="op" id="1651958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651963">gp</span><span class="op" id="1651965">.</span><span class="ident" id="1651966">sigcode1</span>&nbsp;<span class="op" id="1651975">=</span>&nbsp;<span class="ident" id="1651977">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651983">mcall</span><span class="op" id="1651988">(</span><span class="ident" id="1651989">recovery_m</span><span class="op" id="1651999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652004">gothrow</span><span class="op" id="1652011">(</span><span class="string" id="1652012">&#34;recovery&nbsp;failed&#34;</span><span class="op" id="1652029">)</span>&nbsp;<span class="comment" id="1652031">//&nbsp;mcall&nbsp;should&nbsp;not&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1652060">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1652063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1652067">//&nbsp;ran&nbsp;out&nbsp;of&nbsp;deferred&nbsp;calls&nbsp;-&nbsp;old-school&nbsp;panic&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652120">startpanic</span><span class="op" id="1652130">(</span><span class="op" id="1652131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652134">printpanics</span><span class="op" id="1652145">(</span><span class="ident" id="1652146">gp</span><span class="op" id="1652148">.</span><span class="ident" id="1652149">_panic</span><span class="op" id="1652155">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1652158">dopanic</span><span class="op" id="1652165">(</span><span class="num" id="1652166">0</span><span class="op" id="1652167">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1652175">//&nbsp;should&nbsp;not&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1652197">*</span><span class="op" id="1652198">(</span><span class="op" id="1652199">*</span><span class="builtintype" id="1652200">int</span><span class="op" id="1652203">)</span><span class="op" id="1652204">(</span><span class="ident" id="1652205">nil</span><span class="op" id="1652208">)</span>&nbsp;<span class="op" id="1652210">=</span>&nbsp;<span class="num" id="1652212">0</span>&nbsp;<span class="comment" id="1652214">//&nbsp;not&nbsp;reached</span><br>
<span class="lineno"></span><span class="op" id="1652229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1652232">//&nbsp;getargp&nbsp;returns&nbsp;the&nbsp;location&nbsp;where&nbsp;the&nbsp;caller</span><br>
<span class="lineno">430</span><span class="comment" id="1652281">//&nbsp;writes&nbsp;outgoing&nbsp;function&nbsp;call&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="1652325">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1652338">func</span>&nbsp;<span class="ident" id="1652343">getargp</span><span class="op" id="1652350">(</span><span class="ident" id="1652351">x</span>&nbsp;<span class="builtintype" id="1652353">int</span><span class="op" id="1652356">)</span>&nbsp;<span class="builtintype" id="1652358">uintptr</span>&nbsp;<span class="op" id="1652366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1652369">//&nbsp;x&nbsp;is&nbsp;an&nbsp;argument&nbsp;mainly&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;return&nbsp;its&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1652432">//&nbsp;However,&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;the&nbsp;function&nbsp;complex&nbsp;enough</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1652489">//&nbsp;that&nbsp;it&nbsp;won&#39;t&nbsp;be&nbsp;inlined.&nbsp;We&nbsp;always&nbsp;pass&nbsp;x&nbsp;=&nbsp;0,&nbsp;so&nbsp;this&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1652554">//&nbsp;does&nbsp;nothing&nbsp;other&nbsp;than&nbsp;keep&nbsp;the&nbsp;compiler&nbsp;from&nbsp;thinking</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1652614">//&nbsp;the&nbsp;function&nbsp;is&nbsp;simple&nbsp;enough&nbsp;to&nbsp;inline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1652659">if</span>&nbsp;<span class="ident" id="1652662">x</span>&nbsp;<span class="op" id="1652664">&gt;</span>&nbsp;<span class="num" id="1652666">0</span>&nbsp;<span class="op" id="1652668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1652672">return</span>&nbsp;<span class="ident" id="1652679">getcallersp</span><span class="op" id="1652690">(</span><span class="ident" id="1652691">unsafe</span><span class="op" id="1652697">.</span><span class="ident" id="1652698">Pointer</span><span class="op" id="1652705">(</span><span class="op" id="1652706">&amp;</span><span class="ident" id="1652707">x</span><span class="op" id="1652708">)</span><span class="op" id="1652709">)</span>&nbsp;<span class="op" id="1652711">*</span>&nbsp;<span class="num" id="1652713">0</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1652716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1652719">return</span>&nbsp;<span class="builtintype" id="1652726">uintptr</span><span class="op" id="1652733">(</span><span class="ident" id="1652734">noescape</span><span class="op" id="1652742">(</span><span class="ident" id="1652743">unsafe</span><span class="op" id="1652749">.</span><span class="ident" id="1652750">Pointer</span><span class="op" id="1652757">(</span><span class="op" id="1652758">&amp;</span><span class="ident" id="1652759">x</span><span class="op" id="1652760">)</span><span class="op" id="1652761">)</span><span class="op" id="1652762">)</span><br>
<span class="lineno"></span><span class="op" id="1652764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1652767">//&nbsp;The&nbsp;implementation&nbsp;of&nbsp;the&nbsp;predeclared&nbsp;function&nbsp;recover.</span><br>
<span class="lineno">445</span><span class="comment" id="1652826">//&nbsp;Cannot&nbsp;split&nbsp;the&nbsp;stack&nbsp;because&nbsp;it&nbsp;needs&nbsp;to&nbsp;reliably</span><br>
<span class="lineno"></span><span class="comment" id="1652881">//&nbsp;find&nbsp;the&nbsp;stack&nbsp;segment&nbsp;of&nbsp;its&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="1652922">//</span><br>
<span class="lineno"></span><span class="comment" id="1652925">//&nbsp;TODO(rsc):&nbsp;Once&nbsp;we&nbsp;commit&nbsp;to&nbsp;CopyStackAlways,</span><br>
<span class="lineno"></span><span class="comment" id="1652974">//&nbsp;this&nbsp;doesn&#39;t&nbsp;need&nbsp;to&nbsp;be&nbsp;nosplit.</span><br>
<span class="lineno">450</span><span class="comment" id="1653010">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1653023">func</span>&nbsp;<span class="ident" id="1653028">gorecover</span><span class="op" id="1653037">(</span><span class="ident" id="1653038">argp</span>&nbsp;<span class="builtintype" id="1653043">uintptr</span><span class="op" id="1653050">)</span>&nbsp;<span class="keyword" id="1653052">interface</span><span class="op" id="1653061">{</span><span class="op" id="1653062">}</span>&nbsp;<span class="op" id="1653064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1653067">//&nbsp;Must&nbsp;be&nbsp;in&nbsp;a&nbsp;function&nbsp;running&nbsp;as&nbsp;part&nbsp;of&nbsp;a&nbsp;deferred&nbsp;call&nbsp;during&nbsp;the&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1653146">//&nbsp;Must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;topmost&nbsp;function&nbsp;of&nbsp;the&nbsp;call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1653203">//&nbsp;(the&nbsp;function&nbsp;used&nbsp;in&nbsp;the&nbsp;defer&nbsp;statement).</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1653251">//&nbsp;p.argp&nbsp;is&nbsp;the&nbsp;argument&nbsp;pointer&nbsp;of&nbsp;that&nbsp;topmost&nbsp;deferred&nbsp;function&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1653326">//&nbsp;Compare&nbsp;against&nbsp;argp&nbsp;reported&nbsp;by&nbsp;caller.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1653371">//&nbsp;If&nbsp;they&nbsp;match,&nbsp;the&nbsp;caller&nbsp;is&nbsp;the&nbsp;one&nbsp;who&nbsp;can&nbsp;recover.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653429">gp</span>&nbsp;<span class="op" id="1653432">:=</span>&nbsp;<span class="ident" id="1653435">getg</span><span class="op" id="1653439">(</span><span class="op" id="1653440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653443">p</span>&nbsp;<span class="op" id="1653445">:=</span>&nbsp;<span class="ident" id="1653448">gp</span><span class="op" id="1653450">.</span><span class="ident" id="1653451">_panic</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1653459">if</span>&nbsp;<span class="ident" id="1653462">p</span>&nbsp;<span class="op" id="1653464">!=</span>&nbsp;<span class="ident" id="1653467">nil</span>&nbsp;<span class="op" id="1653471">&amp;&amp;</span>&nbsp;<span class="op" id="1653474">!</span><span class="ident" id="1653475">p</span><span class="op" id="1653476">.</span><span class="ident" id="1653477">recovered</span>&nbsp;<span class="op" id="1653487">&amp;&amp;</span>&nbsp;<span class="ident" id="1653490">argp</span>&nbsp;<span class="op" id="1653495">==</span>&nbsp;<span class="builtintype" id="1653498">uintptr</span><span class="op" id="1653505">(</span><span class="ident" id="1653506">p</span><span class="op" id="1653507">.</span><span class="ident" id="1653508">argp</span><span class="op" id="1653512">)</span>&nbsp;<span class="op" id="1653514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653518">p</span><span class="op" id="1653519">.</span><span class="ident" id="1653520">recovered</span>&nbsp;<span class="op" id="1653530">=</span>&nbsp;<span class="builtintype" id="1653532">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1653539">return</span>&nbsp;<span class="ident" id="1653546">p</span><span class="op" id="1653547">.</span><span class="ident" id="1653548">arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1653553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1653556">return</span>&nbsp;<span class="ident" id="1653563">nil</span><br>
<span class="lineno">465</span><span class="op" id="1653567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1653570">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1653583">func</span>&nbsp;<span class="ident" id="1653588">startpanic</span><span class="op" id="1653598">(</span><span class="op" id="1653599">)</span>&nbsp;<span class="op" id="1653601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653604">onM_signalok</span><span class="op" id="1653616">(</span><span class="ident" id="1653617">startpanic_m</span><span class="op" id="1653629">)</span><br>
<span class="lineno">470</span><span class="op" id="1653631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1653634">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1653647">func</span>&nbsp;<span class="ident" id="1653652">dopanic</span><span class="op" id="1653659">(</span><span class="ident" id="1653660">unused</span>&nbsp;<span class="builtintype" id="1653667">int</span><span class="op" id="1653670">)</span>&nbsp;<span class="op" id="1653672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653675">gp</span>&nbsp;<span class="op" id="1653678">:=</span>&nbsp;<span class="ident" id="1653681">getg</span><span class="op" id="1653685">(</span><span class="op" id="1653686">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653689">mp</span>&nbsp;<span class="op" id="1653692">:=</span>&nbsp;<span class="ident" id="1653695">acquirem</span><span class="op" id="1653703">(</span><span class="op" id="1653704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653707">mp</span><span class="op" id="1653709">.</span><span class="ident" id="1653710">ptrarg</span><span class="op" id="1653716">[</span><span class="num" id="1653717">0</span><span class="op" id="1653718">]</span>&nbsp;<span class="op" id="1653720">=</span>&nbsp;<span class="ident" id="1653722">unsafe</span><span class="op" id="1653728">.</span><span class="ident" id="1653729">Pointer</span><span class="op" id="1653736">(</span><span class="ident" id="1653737">gp</span><span class="op" id="1653739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653742">mp</span><span class="op" id="1653744">.</span><span class="ident" id="1653745">scalararg</span><span class="op" id="1653754">[</span><span class="num" id="1653755">0</span><span class="op" id="1653756">]</span>&nbsp;<span class="op" id="1653758">=</span>&nbsp;<span class="ident" id="1653760">getcallerpc</span><span class="op" id="1653771">(</span><span class="op" id="1653772">(</span><span class="ident" id="1653773">unsafe</span><span class="op" id="1653779">.</span><span class="ident" id="1653780">Pointer</span><span class="op" id="1653787">)</span><span class="op" id="1653788">(</span><span class="op" id="1653789">&amp;</span><span class="ident" id="1653790">unused</span><span class="op" id="1653796">)</span><span class="op" id="1653797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653800">mp</span><span class="op" id="1653802">.</span><span class="ident" id="1653803">scalararg</span><span class="op" id="1653812">[</span><span class="num" id="1653813">1</span><span class="op" id="1653814">]</span>&nbsp;<span class="op" id="1653816">=</span>&nbsp;<span class="ident" id="1653818">getcallersp</span><span class="op" id="1653829">(</span><span class="op" id="1653830">(</span><span class="ident" id="1653831">unsafe</span><span class="op" id="1653837">.</span><span class="ident" id="1653838">Pointer</span><span class="op" id="1653845">)</span><span class="op" id="1653846">(</span><span class="op" id="1653847">&amp;</span><span class="ident" id="1653848">unused</span><span class="op" id="1653854">)</span><span class="op" id="1653855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653858">onM_signalok</span><span class="op" id="1653870">(</span><span class="ident" id="1653871">dopanic_m</span><span class="op" id="1653880">)</span>&nbsp;<span class="comment" id="1653882">//&nbsp;should&nbsp;never&nbsp;return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1653906">*</span><span class="op" id="1653907">(</span><span class="op" id="1653908">*</span><span class="builtintype" id="1653909">int</span><span class="op" id="1653912">)</span><span class="op" id="1653913">(</span><span class="ident" id="1653914">nil</span><span class="op" id="1653917">)</span>&nbsp;<span class="op" id="1653919">=</span>&nbsp;<span class="num" id="1653921">0</span><br>
<span class="lineno"></span><span class="op" id="1653923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1653926">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1653939">func</span>&nbsp;<span class="ident" id="1653944">throw</span><span class="op" id="1653949">(</span><span class="ident" id="1653950">s</span>&nbsp;<span class="op" id="1653952">*</span><span class="builtintype" id="1653953">byte</span><span class="op" id="1653957">)</span>&nbsp;<span class="op" id="1653959">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1653962">gp</span>&nbsp;<span class="op" id="1653965">:=</span>&nbsp;<span class="ident" id="1653968">getg</span><span class="op" id="1653972">(</span><span class="op" id="1653973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1653976">if</span>&nbsp;<span class="ident" id="1653979">gp</span><span class="op" id="1653981">.</span><span class="ident" id="1653982">m</span><span class="op" id="1653983">.</span><span class="ident" id="1653984">throwing</span>&nbsp;<span class="op" id="1653993">==</span>&nbsp;<span class="num" id="1653996">0</span>&nbsp;<span class="op" id="1653998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1654002">gp</span><span class="op" id="1654004">.</span><span class="ident" id="1654005">m</span><span class="op" id="1654006">.</span><span class="ident" id="1654007">throwing</span>&nbsp;<span class="op" id="1654016">=</span>&nbsp;<span class="num" id="1654018">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1654021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1654024">startpanic</span><span class="op" id="1654034">(</span><span class="op" id="1654035">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1654038">print</span><span class="op" id="1654043">(</span><span class="string" id="1654044">&#34;fatal&nbsp;error:&nbsp;&#34;</span><span class="op" id="1654059">,</span>&nbsp;<span class="ident" id="1654061">gostringnocopy</span><span class="op" id="1654075">(</span><span class="ident" id="1654076">s</span><span class="op" id="1654077">)</span><span class="op" id="1654078">,</span>&nbsp;<span class="string" id="1654080">&#34;\n&#34;</span><span class="op" id="1654084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1654087">dopanic</span><span class="op" id="1654094">(</span><span class="num" id="1654095">0</span><span class="op" id="1654096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1654099">*</span><span class="op" id="1654100">(</span><span class="op" id="1654101">*</span><span class="builtintype" id="1654102">int</span><span class="op" id="1654105">)</span><span class="op" id="1654106">(</span><span class="ident" id="1654107">nil</span><span class="op" id="1654110">)</span>&nbsp;<span class="op" id="1654112">=</span>&nbsp;<span class="num" id="1654114">0</span>&nbsp;<span class="comment" id="1654116">//&nbsp;not&nbsp;reached</span><br>
<span class="lineno"></span><span class="op" id="1654131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="1654134">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1654147">func</span>&nbsp;<span class="ident" id="1654152">gothrow</span><span class="op" id="1654159">(</span><span class="ident" id="1654160">s</span>&nbsp;<span class="builtintype" id="1654162">string</span><span class="op" id="1654168">)</span>&nbsp;<span class="op" id="1654170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1654173">gp</span>&nbsp;<span class="op" id="1654176">:=</span>&nbsp;<span class="ident" id="1654179">getg</span><span class="op" id="1654183">(</span><span class="op" id="1654184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1654187">if</span>&nbsp;<span class="ident" id="1654190">gp</span><span class="op" id="1654192">.</span><span class="ident" id="1654193">m</span><span class="op" id="1654194">.</span><span class="ident" id="1654195">throwing</span>&nbsp;<span class="op" id="1654204">==</span>&nbsp;<span class="num" id="1654207">0</span>&nbsp;<span class="op" id="1654209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1654213">gp</span><span class="op" id="1654215">.</span><span class="ident" id="1654216">m</span><span class="op" id="1654217">.</span><span class="ident" id="1654218">throwing</span>&nbsp;<span class="op" id="1654227">=</span>&nbsp;<span class="num" id="1654229">1</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1654232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1654235">startpanic</span><span class="op" id="1654245">(</span><span class="op" id="1654246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1654249">print</span><span class="op" id="1654254">(</span><span class="string" id="1654255">&#34;fatal&nbsp;error:&nbsp;&#34;</span><span class="op" id="1654270">,</span>&nbsp;<span class="ident" id="1654272">s</span><span class="op" id="1654273">,</span>&nbsp;<span class="string" id="1654275">&#34;\n&#34;</span><span class="op" id="1654279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1654282">dopanic</span><span class="op" id="1654289">(</span><span class="num" id="1654290">0</span><span class="op" id="1654291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1654294">*</span><span class="op" id="1654295">(</span><span class="op" id="1654296">*</span><span class="builtintype" id="1654297">int</span><span class="op" id="1654300">)</span><span class="op" id="1654301">(</span><span class="ident" id="1654302">nil</span><span class="op" id="1654305">)</span>&nbsp;<span class="op" id="1654307">=</span>&nbsp;<span class="num" id="1654309">0</span>&nbsp;<span class="comment" id="1654311">//&nbsp;not&nbsp;reached</span><br>
<span class="lineno">505</span><span class="op" id="1654326">}</span>
</div>
</body>
</html>
