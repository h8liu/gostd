<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html" class="current">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3992452">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3992507">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3992561">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3992612">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;sysSocket&nbsp;and&nbsp;accept&nbsp;for&nbsp;platforms&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3992676">//&nbsp;provide&nbsp;a&nbsp;fast&nbsp;path&nbsp;for&nbsp;setting&nbsp;SetNonblock&nbsp;and&nbsp;CloseOnExec.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3992741">//&nbsp;+build&nbsp;freebsd&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3992766">package</span>&nbsp;<span class="ident" id="3992774">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3992779">import</span>&nbsp;<span class="string" id="3992786">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3992797">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;socket&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">15</span><span class="comment" id="3992867">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="3992915">func</span>&nbsp;<span class="ident" id="3992920">sysSocket</span><span class="op" id="3992929">(</span><span class="ident" id="3992930">family</span><span class="op" id="3992936">,</span>&nbsp;<span class="ident" id="3992938">sotype</span><span class="op" id="3992944">,</span>&nbsp;<span class="ident" id="3992946">proto</span>&nbsp;<span class="builtintype" id="3992952">int</span><span class="op" id="3992955">)</span>&nbsp;<span class="op" id="3992957">(</span><span class="builtintype" id="3992958">int</span><span class="op" id="3992961">,</span>&nbsp;<span class="builtintype" id="3992963">error</span><span class="op" id="3992968">)</span>&nbsp;<span class="op" id="3992970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3992973">s</span><span class="op" id="3992974">,</span>&nbsp;<span class="ident" id="3992976">err</span>&nbsp;<span class="op" id="3992980">:=</span>&nbsp;<span class="ident" id="3992983">syscall</span><span class="op" id="3992990">.</span><span class="ident" id="3992991">Socket</span><span class="op" id="3992997">(</span><span class="ident" id="3992998">family</span><span class="op" id="3993004">,</span>&nbsp;<span class="ident" id="3993006">sotype</span><span class="op" id="3993012">|</span><span class="ident" id="3993013">syscall</span><span class="op" id="3993020">.</span><span class="ident" id="3993021">SOCK_NONBLOCK</span><span class="op" id="3993034">|</span><span class="ident" id="3993035">syscall</span><span class="op" id="3993042">.</span><span class="ident" id="3993043">SOCK_CLOEXEC</span><span class="op" id="3993055">,</span>&nbsp;<span class="ident" id="3993057">proto</span><span class="op" id="3993062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3993065">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;SOCK_NONBLOCK&nbsp;and&nbsp;SOCK_CLOEXEC&nbsp;flags&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3993124">//&nbsp;introduced&nbsp;in&nbsp;2.6.27&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;both&nbsp;flags&nbsp;were</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3993187">//&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we&nbsp;get&nbsp;an&nbsp;EINVAL&nbsp;error&nbsp;on&nbsp;Linux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3993251">//&nbsp;or&nbsp;EPROTONOSUPPORT&nbsp;error&nbsp;on&nbsp;FreeBSD,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3993311">//&nbsp;socket&nbsp;without&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993336">if</span>&nbsp;<span class="ident" id="3993339">err</span>&nbsp;<span class="op" id="3993343">==</span>&nbsp;<span class="builtintype" id="3993346">nil</span>&nbsp;<span class="op" id="3993350">||</span>&nbsp;<span class="op" id="3993353">(</span><span class="ident" id="3993354">err</span>&nbsp;<span class="op" id="3993358">!=</span>&nbsp;<span class="ident" id="3993361">syscall</span><span class="op" id="3993368">.</span><span class="ident" id="3993369">EPROTONOSUPPORT</span>&nbsp;<span class="op" id="3993385">&amp;&amp;</span>&nbsp;<span class="ident" id="3993388">err</span>&nbsp;<span class="op" id="3993392">!=</span>&nbsp;<span class="ident" id="3993395">syscall</span><span class="op" id="3993402">.</span><span class="ident" id="3993403">EINVAL</span><span class="op" id="3993409">)</span>&nbsp;<span class="op" id="3993411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993415">return</span>&nbsp;<span class="ident" id="3993422">s</span><span class="op" id="3993423">,</span>&nbsp;<span class="ident" id="3993425">err</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3993430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3993434">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993495">syscall</span><span class="op" id="3993502">.</span><span class="ident" id="3993503">ForkLock</span><span class="op" id="3993511">.</span><span class="ident" id="3993512">RLock</span><span class="op" id="3993517">(</span><span class="op" id="3993518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993521">s</span><span class="op" id="3993522">,</span>&nbsp;<span class="ident" id="3993524">err</span>&nbsp;<span class="op" id="3993528">=</span>&nbsp;<span class="ident" id="3993530">syscall</span><span class="op" id="3993537">.</span><span class="ident" id="3993538">Socket</span><span class="op" id="3993544">(</span><span class="ident" id="3993545">family</span><span class="op" id="3993551">,</span>&nbsp;<span class="ident" id="3993553">sotype</span><span class="op" id="3993559">,</span>&nbsp;<span class="ident" id="3993561">proto</span><span class="op" id="3993566">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993569">if</span>&nbsp;<span class="ident" id="3993572">err</span>&nbsp;<span class="op" id="3993576">==</span>&nbsp;<span class="builtintype" id="3993579">nil</span>&nbsp;<span class="op" id="3993583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993587">syscall</span><span class="op" id="3993594">.</span><span class="ident" id="3993595">CloseOnExec</span><span class="op" id="3993606">(</span><span class="ident" id="3993607">s</span><span class="op" id="3993608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3993611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993614">syscall</span><span class="op" id="3993621">.</span><span class="ident" id="3993622">ForkLock</span><span class="op" id="3993630">.</span><span class="ident" id="3993631">RUnlock</span><span class="op" id="3993638">(</span><span class="op" id="3993639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993642">if</span>&nbsp;<span class="ident" id="3993645">err</span>&nbsp;<span class="op" id="3993649">!=</span>&nbsp;<span class="builtintype" id="3993652">nil</span>&nbsp;<span class="op" id="3993656">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993660">return</span>&nbsp;<span class="op" id="3993667">-</span><span class="num" id="3993668">1</span><span class="op" id="3993669">,</span>&nbsp;<span class="ident" id="3993671">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3993676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993679">if</span>&nbsp;<span class="ident" id="3993682">err</span>&nbsp;<span class="op" id="3993686">=</span>&nbsp;<span class="ident" id="3993688">syscall</span><span class="op" id="3993695">.</span><span class="ident" id="3993696">SetNonblock</span><span class="op" id="3993707">(</span><span class="ident" id="3993708">s</span><span class="op" id="3993709">,</span>&nbsp;<span class="builtintype" id="3993711">true</span><span class="op" id="3993715">)</span><span class="op" id="3993716">;</span>&nbsp;<span class="ident" id="3993718">err</span>&nbsp;<span class="op" id="3993722">!=</span>&nbsp;<span class="builtintype" id="3993725">nil</span>&nbsp;<span class="op" id="3993729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993733">syscall</span><span class="op" id="3993740">.</span><span class="ident" id="3993741">Close</span><span class="op" id="3993746">(</span><span class="ident" id="3993747">s</span><span class="op" id="3993748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993752">return</span>&nbsp;<span class="op" id="3993759">-</span><span class="num" id="3993760">1</span><span class="op" id="3993761">,</span>&nbsp;<span class="ident" id="3993763">err</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3993768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993771">return</span>&nbsp;<span class="ident" id="3993778">s</span><span class="op" id="3993779">,</span>&nbsp;<span class="builtintype" id="3993781">nil</span><br>
<span class="lineno"></span><span class="op" id="3993785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3993788">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;accept&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">45</span><span class="comment" id="3993858">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="3993906">func</span>&nbsp;<span class="ident" id="3993911">accept</span><span class="op" id="3993917">(</span><span class="ident" id="3993918">s</span>&nbsp;<span class="builtintype" id="3993920">int</span><span class="op" id="3993923">)</span>&nbsp;<span class="op" id="3993925">(</span><span class="builtintype" id="3993926">int</span><span class="op" id="3993929">,</span>&nbsp;<span class="ident" id="3993931">syscall</span><span class="op" id="3993938">.</span><span class="ident" id="3993939">Sockaddr</span><span class="op" id="3993947">,</span>&nbsp;<span class="builtintype" id="3993949">error</span><span class="op" id="3993954">)</span>&nbsp;<span class="op" id="3993956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993959">ns</span><span class="op" id="3993961">,</span>&nbsp;<span class="ident" id="3993963">sa</span><span class="op" id="3993965">,</span>&nbsp;<span class="ident" id="3993967">err</span>&nbsp;<span class="op" id="3993971">:=</span>&nbsp;<span class="ident" id="3993974">syscall</span><span class="op" id="3993981">.</span><span class="ident" id="3993982">Accept4</span><span class="op" id="3993989">(</span><span class="ident" id="3993990">s</span><span class="op" id="3993991">,</span>&nbsp;<span class="ident" id="3993993">syscall</span><span class="op" id="3994000">.</span><span class="ident" id="3994001">SOCK_NONBLOCK</span><span class="op" id="3994014">|</span><span class="ident" id="3994015">syscall</span><span class="op" id="3994022">.</span><span class="ident" id="3994023">SOCK_CLOEXEC</span><span class="op" id="3994035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3994038">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;accept4&nbsp;system&nbsp;call&nbsp;was&nbsp;introduced&nbsp;in&nbsp;2.6.28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3994100">//&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;it&nbsp;was&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3994164">//&nbsp;get&nbsp;an&nbsp;ENOSYS&nbsp;error&nbsp;on&nbsp;both&nbsp;Linux&nbsp;and&nbsp;FreeBSD,&nbsp;or&nbsp;EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3994225">//&nbsp;error&nbsp;on&nbsp;Linux,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using&nbsp;accept.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994272">switch</span>&nbsp;<span class="ident" id="3994279">err</span>&nbsp;<span class="op" id="3994283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994286">default</span><span class="op" id="3994293">:</span>&nbsp;<span class="comment" id="3994295">//&nbsp;nil&nbsp;and&nbsp;errors&nbsp;other&nbsp;than&nbsp;the&nbsp;ones&nbsp;listed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994342">return</span>&nbsp;<span class="ident" id="3994349">ns</span><span class="op" id="3994351">,</span>&nbsp;<span class="ident" id="3994353">sa</span><span class="op" id="3994355">,</span>&nbsp;<span class="ident" id="3994357">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994362">case</span>&nbsp;<span class="ident" id="3994367">syscall</span><span class="op" id="3994374">.</span><span class="ident" id="3994375">ENOSYS</span><span class="op" id="3994381">:</span>&nbsp;<span class="comment" id="3994383">//&nbsp;syscall&nbsp;missing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994403">case</span>&nbsp;<span class="ident" id="3994408">syscall</span><span class="op" id="3994415">.</span><span class="ident" id="3994416">EINVAL</span><span class="op" id="3994422">:</span>&nbsp;<span class="comment" id="3994424">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994466">case</span>&nbsp;<span class="ident" id="3994471">syscall</span><span class="op" id="3994478">.</span><span class="ident" id="3994479">EACCES</span><span class="op" id="3994485">:</span>&nbsp;<span class="comment" id="3994487">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994529">case</span>&nbsp;<span class="ident" id="3994534">syscall</span><span class="op" id="3994541">.</span><span class="ident" id="3994542">EFAULT</span><span class="op" id="3994548">:</span>&nbsp;<span class="comment" id="3994550">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3994592">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3994596">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3994657">//&nbsp;It&nbsp;is&nbsp;probably&nbsp;okay&nbsp;to&nbsp;hold&nbsp;the&nbsp;lock&nbsp;across&nbsp;syscall.Accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3994720">//&nbsp;because&nbsp;we&nbsp;have&nbsp;put&nbsp;fd.sysfd&nbsp;into&nbsp;non-blocking&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3994777">//&nbsp;However,&nbsp;a&nbsp;call&nbsp;to&nbsp;the&nbsp;File&nbsp;method&nbsp;will&nbsp;put&nbsp;it&nbsp;back&nbsp;into</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3994838">//&nbsp;blocking&nbsp;mode.&nbsp;We&nbsp;can&#39;t&nbsp;take&nbsp;that&nbsp;risk,&nbsp;so&nbsp;no&nbsp;use&nbsp;of&nbsp;ForkLock&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3994910">ns</span><span class="op" id="3994912">,</span>&nbsp;<span class="ident" id="3994914">sa</span><span class="op" id="3994916">,</span>&nbsp;<span class="ident" id="3994918">err</span>&nbsp;<span class="op" id="3994922">=</span>&nbsp;<span class="ident" id="3994924">syscall</span><span class="op" id="3994931">.</span><span class="ident" id="3994932">Accept</span><span class="op" id="3994938">(</span><span class="ident" id="3994939">s</span><span class="op" id="3994940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994943">if</span>&nbsp;<span class="ident" id="3994946">err</span>&nbsp;<span class="op" id="3994950">==</span>&nbsp;<span class="builtintype" id="3994953">nil</span>&nbsp;<span class="op" id="3994957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3994961">syscall</span><span class="op" id="3994968">.</span><span class="ident" id="3994969">CloseOnExec</span><span class="op" id="3994980">(</span><span class="ident" id="3994981">ns</span><span class="op" id="3994983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3994986">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994989">if</span>&nbsp;<span class="ident" id="3994992">err</span>&nbsp;<span class="op" id="3994996">!=</span>&nbsp;<span class="builtintype" id="3994999">nil</span>&nbsp;<span class="op" id="3995003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3995007">return</span>&nbsp;<span class="op" id="3995014">-</span><span class="num" id="3995015">1</span><span class="op" id="3995016">,</span>&nbsp;<span class="builtintype" id="3995018">nil</span><span class="op" id="3995021">,</span>&nbsp;<span class="ident" id="3995023">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3995028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3995031">if</span>&nbsp;<span class="ident" id="3995034">err</span>&nbsp;<span class="op" id="3995038">=</span>&nbsp;<span class="ident" id="3995040">syscall</span><span class="op" id="3995047">.</span><span class="ident" id="3995048">SetNonblock</span><span class="op" id="3995059">(</span><span class="ident" id="3995060">ns</span><span class="op" id="3995062">,</span>&nbsp;<span class="builtintype" id="3995064">true</span><span class="op" id="3995068">)</span><span class="op" id="3995069">;</span>&nbsp;<span class="ident" id="3995071">err</span>&nbsp;<span class="op" id="3995075">!=</span>&nbsp;<span class="builtintype" id="3995078">nil</span>&nbsp;<span class="op" id="3995082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995086">syscall</span><span class="op" id="3995093">.</span><span class="ident" id="3995094">Close</span><span class="op" id="3995099">(</span><span class="ident" id="3995100">ns</span><span class="op" id="3995102">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3995106">return</span>&nbsp;<span class="op" id="3995113">-</span><span class="num" id="3995114">1</span><span class="op" id="3995115">,</span>&nbsp;<span class="builtintype" id="3995117">nil</span><span class="op" id="3995120">,</span>&nbsp;<span class="ident" id="3995122">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3995127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3995130">return</span>&nbsp;<span class="ident" id="3995137">ns</span><span class="op" id="3995139">,</span>&nbsp;<span class="ident" id="3995141">sa</span><span class="op" id="3995143">,</span>&nbsp;<span class="builtintype" id="3995145">nil</span><br>
<span class="lineno"></span><span class="op" id="3995149">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
