<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6385243">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6385298">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6385352">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6385403">package</span>&nbsp;<span class="ident" id="6385411">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6385416">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="6385435">//&nbsp;-&nbsp;catch&nbsp;more&nbsp;errors&nbsp;(no&nbsp;first&nbsp;header,&nbsp;etc.)</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6385483">import</span>&nbsp;<span class="op" id="6385490">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6385493">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6385502">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6385512">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6385519">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6385525">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6385531">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6385539">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6385550">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6385561">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="6385568">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6385571">var</span>&nbsp;<span class="op" id="6385575">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6385578">ErrWriteTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6385597">=</span>&nbsp;<span class="ident" id="6385599">errors</span><span class="op" id="6385605">.</span><span class="ident" id="6385606">New</span><span class="op" id="6385609">(</span><span class="string" id="6385610">&#34;archive/tar:&nbsp;write&nbsp;too&nbsp;long&#34;</span><span class="op" id="6385639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6385642">ErrFieldTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6385661">=</span>&nbsp;<span class="ident" id="6385663">errors</span><span class="op" id="6385669">.</span><span class="ident" id="6385670">New</span><span class="op" id="6385673">(</span><span class="string" id="6385674">&#34;archive/tar:&nbsp;header&nbsp;field&nbsp;too&nbsp;long&#34;</span><span class="op" id="6385710">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6385713">ErrWriteAfterClose</span>&nbsp;<span class="op" id="6385732">=</span>&nbsp;<span class="ident" id="6385734">errors</span><span class="op" id="6385740">.</span><span class="ident" id="6385741">New</span><span class="op" id="6385744">(</span><span class="string" id="6385745">&#34;archive/tar:&nbsp;write&nbsp;after&nbsp;close&#34;</span><span class="op" id="6385777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6385780">errNameTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6385799">=</span>&nbsp;<span class="ident" id="6385801">errors</span><span class="op" id="6385807">.</span><span class="ident" id="6385808">New</span><span class="op" id="6385811">(</span><span class="string" id="6385812">&#34;archive/tar:&nbsp;name&nbsp;too&nbsp;long&#34;</span><span class="op" id="6385840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6385843">errInvalidHeader</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6385862">=</span>&nbsp;<span class="ident" id="6385864">errors</span><span class="op" id="6385870">.</span><span class="ident" id="6385871">New</span><span class="op" id="6385874">(</span><span class="string" id="6385875">&#34;archive/tar:&nbsp;header&nbsp;field&nbsp;too&nbsp;long&nbsp;or&nbsp;contains&nbsp;invalid&nbsp;values&#34;</span><span class="op" id="6385938">)</span><br>
<span class="lineno"></span><span class="op" id="6385940">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="6385943">//&nbsp;A&nbsp;Writer&nbsp;provides&nbsp;sequential&nbsp;writing&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive&nbsp;in&nbsp;POSIX.1&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="6386019">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="6386069">//&nbsp;Call&nbsp;WriteHeader&nbsp;to&nbsp;begin&nbsp;a&nbsp;new&nbsp;file,&nbsp;and&nbsp;then&nbsp;call&nbsp;Write&nbsp;to&nbsp;supply&nbsp;that&nbsp;file&#39;s&nbsp;data,</span><br>
<span class="lineno"></span><span class="comment" id="6386158">//&nbsp;writing&nbsp;at&nbsp;most&nbsp;hdr.Size&nbsp;bytes&nbsp;in&nbsp;total.</span><br>
<span class="lineno"></span><span class="keyword" id="6386202">type</span>&nbsp;<span class="ident" id="6386207">Writer</span>&nbsp;<span class="keyword" id="6386214">struct</span>&nbsp;<span class="op" id="6386221">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6386224">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6386235">io</span><span class="op" id="6386237">.</span><span class="ident" id="6386238">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6386246">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6386257">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6386264">nb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6386275">int64</span>&nbsp;<span class="comment" id="6386281">//&nbsp;number&nbsp;of&nbsp;unwritten&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6386334">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6386345">int64</span>&nbsp;<span class="comment" id="6386351">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;to&nbsp;write&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6386407">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6386418">bool</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6386424">usedBinary</span>&nbsp;<span class="builtintype" id="6386435">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6386451">//&nbsp;whether&nbsp;the&nbsp;binary&nbsp;numeric&nbsp;field&nbsp;extension&nbsp;was&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6386507">preferPax</span>&nbsp;&nbsp;<span class="builtintype" id="6386518">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6386534">//&nbsp;use&nbsp;pax&nbsp;header&nbsp;instead&nbsp;of&nbsp;binary&nbsp;numeric&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6386586">hdrBuff</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6386597">[</span><span class="ident" id="6386598">blockSize</span><span class="op" id="6386607">]</span><span class="builtintype" id="6386608">byte</span>&nbsp;<span class="comment" id="6386613">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;writeHeader&nbsp;when&nbsp;writing&nbsp;a&nbsp;regular&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6386676">paxHdrBuff</span>&nbsp;<span class="op" id="6386687">[</span><span class="ident" id="6386688">blockSize</span><span class="op" id="6386697">]</span><span class="builtintype" id="6386698">byte</span>&nbsp;<span class="comment" id="6386703">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;writeHeader&nbsp;when&nbsp;writing&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span><span class="op" id="6386761">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6386764">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6386812">func</span>&nbsp;<span class="ident" id="6386817">NewWriter</span><span class="op" id="6386826">(</span><span class="ident" id="6386827">w</span>&nbsp;<span class="ident" id="6386829">io</span><span class="op" id="6386831">.</span><span class="ident" id="6386832">Writer</span><span class="op" id="6386838">)</span>&nbsp;<span class="op" id="6386840">*</span><span class="ident" id="6386841">Writer</span>&nbsp;<span class="op" id="6386848">{</span>&nbsp;<span class="keyword" id="6386850">return</span>&nbsp;<span class="op" id="6386857">&amp;</span><span class="ident" id="6386858">Writer</span><span class="op" id="6386864">{</span><span class="ident" id="6386865">w</span><span class="op" id="6386866">:</span>&nbsp;<span class="ident" id="6386868">w</span><span class="op" id="6386869">}</span>&nbsp;<span class="op" id="6386871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6386874">//&nbsp;Flush&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;current&nbsp;file&nbsp;(optional).</span><br>
<span class="lineno">50</span><span class="keyword" id="6386929">func</span>&nbsp;<span class="op" id="6386934">(</span><span class="ident" id="6386935">tw</span>&nbsp;<span class="op" id="6386938">*</span><span class="ident" id="6386939">Writer</span><span class="op" id="6386945">)</span>&nbsp;<span class="ident" id="6386947">Flush</span><span class="op" id="6386952">(</span><span class="op" id="6386953">)</span>&nbsp;<span class="builtintype" id="6386955">error</span>&nbsp;<span class="op" id="6386961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6386964">if</span>&nbsp;<span class="ident" id="6386967">tw</span><span class="op" id="6386969">.</span><span class="ident" id="6386970">nb</span>&nbsp;<span class="op" id="6386973">&gt;</span>&nbsp;<span class="num" id="6386975">0</span>&nbsp;<span class="op" id="6386977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6386981">tw</span><span class="op" id="6386983">.</span><span class="ident" id="6386984">err</span>&nbsp;<span class="op" id="6386988">=</span>&nbsp;<span class="ident" id="6386990">fmt</span><span class="op" id="6386993">.</span><span class="ident" id="6386994">Errorf</span><span class="op" id="6387000">(</span><span class="string" id="6387001">&#34;archive/tar:&nbsp;missed&nbsp;writing&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="6387039">,</span>&nbsp;<span class="ident" id="6387041">tw</span><span class="op" id="6387043">.</span><span class="ident" id="6387044">nb</span><span class="op" id="6387046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6387050">return</span>&nbsp;<span class="ident" id="6387057">tw</span><span class="op" id="6387059">.</span><span class="ident" id="6387060">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6387065">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387069">n</span>&nbsp;<span class="op" id="6387071">:=</span>&nbsp;<span class="ident" id="6387074">tw</span><span class="op" id="6387076">.</span><span class="ident" id="6387077">nb</span>&nbsp;<span class="op" id="6387080">+</span>&nbsp;<span class="ident" id="6387082">tw</span><span class="op" id="6387084">.</span><span class="ident" id="6387085">pad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6387090">for</span>&nbsp;<span class="ident" id="6387094">n</span>&nbsp;<span class="op" id="6387096">&gt;</span>&nbsp;<span class="num" id="6387098">0</span>&nbsp;<span class="op" id="6387100">&amp;&amp;</span>&nbsp;<span class="ident" id="6387103">tw</span><span class="op" id="6387105">.</span><span class="ident" id="6387106">err</span>&nbsp;<span class="op" id="6387110">==</span>&nbsp;<span class="builtintype" id="6387113">nil</span>&nbsp;<span class="op" id="6387117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387121">nr</span>&nbsp;<span class="op" id="6387124">:=</span>&nbsp;<span class="ident" id="6387127">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6387131">if</span>&nbsp;<span class="ident" id="6387134">nr</span>&nbsp;<span class="op" id="6387137">&gt;</span>&nbsp;<span class="ident" id="6387139">blockSize</span>&nbsp;<span class="op" id="6387149">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387154">nr</span>&nbsp;<span class="op" id="6387157">=</span>&nbsp;<span class="ident" id="6387159">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6387171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6387175">var</span>&nbsp;<span class="ident" id="6387179">nw</span>&nbsp;<span class="builtintype" id="6387182">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387188">nw</span><span class="op" id="6387190">,</span>&nbsp;<span class="ident" id="6387192">tw</span><span class="op" id="6387194">.</span><span class="ident" id="6387195">err</span>&nbsp;<span class="op" id="6387199">=</span>&nbsp;<span class="ident" id="6387201">tw</span><span class="op" id="6387203">.</span><span class="ident" id="6387204">w</span><span class="op" id="6387205">.</span><span class="ident" id="6387206">Write</span><span class="op" id="6387211">(</span><span class="ident" id="6387212">zeroBlock</span><span class="op" id="6387221">[</span><span class="num" id="6387222">0</span><span class="op" id="6387223">:</span><span class="ident" id="6387224">nr</span><span class="op" id="6387226">]</span><span class="op" id="6387227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387231">n</span>&nbsp;<span class="op" id="6387233">-=</span>&nbsp;<span class="ident" id="6387236">int64</span><span class="op" id="6387241">(</span><span class="ident" id="6387242">nw</span><span class="op" id="6387244">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6387247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387250">tw</span><span class="op" id="6387252">.</span><span class="ident" id="6387253">nb</span>&nbsp;<span class="op" id="6387256">=</span>&nbsp;<span class="num" id="6387258">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387261">tw</span><span class="op" id="6387263">.</span><span class="ident" id="6387264">pad</span>&nbsp;<span class="op" id="6387268">=</span>&nbsp;<span class="num" id="6387270">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6387273">return</span>&nbsp;<span class="ident" id="6387280">tw</span><span class="op" id="6387282">.</span><span class="ident" id="6387283">err</span><br>
<span class="lineno"></span><span class="op" id="6387287">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="6387290">//&nbsp;Write&nbsp;s&nbsp;into&nbsp;b,&nbsp;terminating&nbsp;it&nbsp;with&nbsp;a&nbsp;NUL&nbsp;if&nbsp;there&nbsp;is&nbsp;room.</span><br>
<span class="lineno"></span><span class="comment" id="6387353">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;field&nbsp;and&nbsp;allowPax&nbsp;is&nbsp;true&nbsp;add&nbsp;a&nbsp;paxheader&nbsp;record&nbsp;instead</span><br>
<span class="lineno"></span><span class="keyword" id="6387447">func</span>&nbsp;<span class="op" id="6387452">(</span><span class="ident" id="6387453">tw</span>&nbsp;<span class="op" id="6387456">*</span><span class="ident" id="6387457">Writer</span><span class="op" id="6387463">)</span>&nbsp;<span class="ident" id="6387465">cString</span><span class="op" id="6387472">(</span><span class="ident" id="6387473">b</span>&nbsp;<span class="op" id="6387475">[</span><span class="op" id="6387476">]</span><span class="builtintype" id="6387477">byte</span><span class="op" id="6387481">,</span>&nbsp;<span class="ident" id="6387483">s</span>&nbsp;<span class="builtintype" id="6387485">string</span><span class="op" id="6387491">,</span>&nbsp;<span class="ident" id="6387493">allowPax</span>&nbsp;<span class="builtintype" id="6387502">bool</span><span class="op" id="6387506">,</span>&nbsp;<span class="ident" id="6387508">paxKeyword</span>&nbsp;<span class="builtintype" id="6387519">string</span><span class="op" id="6387525">,</span>&nbsp;<span class="ident" id="6387527">paxHeaders</span>&nbsp;<span class="keyword" id="6387538">map</span><span class="op" id="6387541">[</span><span class="builtintype" id="6387542">string</span><span class="op" id="6387548">]</span><span class="builtintype" id="6387549">string</span><span class="op" id="6387555">)</span>&nbsp;<span class="op" id="6387557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387560">needsPaxHeader</span>&nbsp;<span class="op" id="6387575">:=</span>&nbsp;<span class="ident" id="6387578">allowPax</span>&nbsp;<span class="op" id="6387587">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6387590">len</span><span class="op" id="6387593">(</span><span class="ident" id="6387594">s</span><span class="op" id="6387595">)</span>&nbsp;<span class="op" id="6387597">&gt;</span>&nbsp;<span class="builtinfunc" id="6387599">len</span><span class="op" id="6387602">(</span><span class="ident" id="6387603">b</span><span class="op" id="6387604">)</span>&nbsp;<span class="op" id="6387606">||</span>&nbsp;<span class="op" id="6387609">!</span><span class="ident" id="6387610">isASCII</span><span class="op" id="6387617">(</span><span class="ident" id="6387618">s</span><span class="op" id="6387619">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6387622">if</span>&nbsp;<span class="ident" id="6387625">needsPaxHeader</span>&nbsp;<span class="op" id="6387640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387644">paxHeaders</span><span class="op" id="6387654">[</span><span class="ident" id="6387655">paxKeyword</span><span class="op" id="6387665">]</span>&nbsp;<span class="op" id="6387667">=</span>&nbsp;<span class="ident" id="6387669">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6387673">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6387681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6387684">if</span>&nbsp;<span class="builtinfunc" id="6387687">len</span><span class="op" id="6387690">(</span><span class="ident" id="6387691">s</span><span class="op" id="6387692">)</span>&nbsp;<span class="op" id="6387694">&gt;</span>&nbsp;<span class="builtinfunc" id="6387696">len</span><span class="op" id="6387699">(</span><span class="ident" id="6387700">b</span><span class="op" id="6387701">)</span>&nbsp;<span class="op" id="6387703">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6387707">if</span>&nbsp;<span class="ident" id="6387710">tw</span><span class="op" id="6387712">.</span><span class="ident" id="6387713">err</span>&nbsp;<span class="op" id="6387717">==</span>&nbsp;<span class="builtintype" id="6387720">nil</span>&nbsp;<span class="op" id="6387724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387729">tw</span><span class="op" id="6387731">.</span><span class="ident" id="6387732">err</span>&nbsp;<span class="op" id="6387736">=</span>&nbsp;<span class="ident" id="6387738">ErrFieldTooLong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6387756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6387760">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6387768">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387771">ascii</span>&nbsp;<span class="op" id="6387777">:=</span>&nbsp;<span class="ident" id="6387780">toASCII</span><span class="op" id="6387787">(</span><span class="ident" id="6387788">s</span><span class="op" id="6387789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6387792">copy</span><span class="op" id="6387796">(</span><span class="ident" id="6387797">b</span><span class="op" id="6387798">,</span>&nbsp;<span class="ident" id="6387800">ascii</span><span class="op" id="6387805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6387808">if</span>&nbsp;<span class="builtinfunc" id="6387811">len</span><span class="op" id="6387814">(</span><span class="ident" id="6387815">ascii</span><span class="op" id="6387820">)</span>&nbsp;<span class="op" id="6387822">&lt;</span>&nbsp;<span class="builtinfunc" id="6387824">len</span><span class="op" id="6387827">(</span><span class="ident" id="6387828">b</span><span class="op" id="6387829">)</span>&nbsp;<span class="op" id="6387831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387835">b</span><span class="op" id="6387836">[</span><span class="builtinfunc" id="6387837">len</span><span class="op" id="6387840">(</span><span class="ident" id="6387841">ascii</span><span class="op" id="6387846">)</span><span class="op" id="6387847">]</span>&nbsp;<span class="op" id="6387849">=</span>&nbsp;<span class="num" id="6387851">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6387854">}</span><br>
<span class="lineno">90</span><span class="op" id="6387856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6387859">//&nbsp;Encode&nbsp;x&nbsp;as&nbsp;an&nbsp;octal&nbsp;ASCII&nbsp;string&nbsp;and&nbsp;write&nbsp;it&nbsp;into&nbsp;b&nbsp;with&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span><span class="keyword" id="6387936">func</span>&nbsp;<span class="op" id="6387941">(</span><span class="ident" id="6387942">tw</span>&nbsp;<span class="op" id="6387945">*</span><span class="ident" id="6387946">Writer</span><span class="op" id="6387952">)</span>&nbsp;<span class="ident" id="6387954">octal</span><span class="op" id="6387959">(</span><span class="ident" id="6387960">b</span>&nbsp;<span class="op" id="6387962">[</span><span class="op" id="6387963">]</span><span class="builtintype" id="6387964">byte</span><span class="op" id="6387968">,</span>&nbsp;<span class="ident" id="6387970">x</span>&nbsp;<span class="ident" id="6387972">int64</span><span class="op" id="6387977">)</span>&nbsp;<span class="op" id="6387979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387982">s</span>&nbsp;<span class="op" id="6387984">:=</span>&nbsp;<span class="ident" id="6387987">strconv</span><span class="op" id="6387994">.</span><span class="ident" id="6387995">FormatInt</span><span class="op" id="6388004">(</span><span class="ident" id="6388005">x</span><span class="op" id="6388006">,</span>&nbsp;<span class="num" id="6388008">8</span><span class="op" id="6388009">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6388012">//&nbsp;leading&nbsp;zeros,&nbsp;but&nbsp;leave&nbsp;room&nbsp;for&nbsp;a&nbsp;NUL.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6388057">for</span>&nbsp;<span class="builtinfunc" id="6388061">len</span><span class="op" id="6388064">(</span><span class="ident" id="6388065">s</span><span class="op" id="6388066">)</span><span class="op" id="6388067">+</span><span class="num" id="6388068">1</span>&nbsp;<span class="op" id="6388070">&lt;</span>&nbsp;<span class="builtinfunc" id="6388072">len</span><span class="op" id="6388075">(</span><span class="ident" id="6388076">b</span><span class="op" id="6388077">)</span>&nbsp;<span class="op" id="6388079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388083">s</span>&nbsp;<span class="op" id="6388085">=</span>&nbsp;<span class="string" id="6388087">&#34;0&#34;</span>&nbsp;<span class="op" id="6388091">+</span>&nbsp;<span class="ident" id="6388093">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6388096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388099">tw</span><span class="op" id="6388101">.</span><span class="ident" id="6388102">cString</span><span class="op" id="6388109">(</span><span class="ident" id="6388110">b</span><span class="op" id="6388111">,</span>&nbsp;<span class="ident" id="6388113">s</span><span class="op" id="6388114">,</span>&nbsp;<span class="builtintype" id="6388116">false</span><span class="op" id="6388121">,</span>&nbsp;<span class="ident" id="6388123">paxNone</span><span class="op" id="6388130">,</span>&nbsp;<span class="builtintype" id="6388132">nil</span><span class="op" id="6388135">)</span><br>
<span class="lineno">100</span><span class="op" id="6388137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6388140">//&nbsp;Write&nbsp;x&nbsp;into&nbsp;b,&nbsp;either&nbsp;as&nbsp;octal&nbsp;or&nbsp;as&nbsp;binary&nbsp;(GNUtar/star&nbsp;extension).</span><br>
<span class="lineno"></span><span class="comment" id="6388213">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;field&nbsp;and&nbsp;writingPax&nbsp;is&nbsp;enabled&nbsp;both&nbsp;for&nbsp;the&nbsp;field&nbsp;and&nbsp;the&nbsp;add&nbsp;a&nbsp;paxheader&nbsp;record&nbsp;instead</span><br>
<span class="lineno"></span><span class="keyword" id="6388339">func</span>&nbsp;<span class="op" id="6388344">(</span><span class="ident" id="6388345">tw</span>&nbsp;<span class="op" id="6388348">*</span><span class="ident" id="6388349">Writer</span><span class="op" id="6388355">)</span>&nbsp;<span class="ident" id="6388357">numeric</span><span class="op" id="6388364">(</span><span class="ident" id="6388365">b</span>&nbsp;<span class="op" id="6388367">[</span><span class="op" id="6388368">]</span><span class="builtintype" id="6388369">byte</span><span class="op" id="6388373">,</span>&nbsp;<span class="ident" id="6388375">x</span>&nbsp;<span class="ident" id="6388377">int64</span><span class="op" id="6388382">,</span>&nbsp;<span class="ident" id="6388384">allowPax</span>&nbsp;<span class="builtintype" id="6388393">bool</span><span class="op" id="6388397">,</span>&nbsp;<span class="ident" id="6388399">paxKeyword</span>&nbsp;<span class="builtintype" id="6388410">string</span><span class="op" id="6388416">,</span>&nbsp;<span class="ident" id="6388418">paxHeaders</span>&nbsp;<span class="keyword" id="6388429">map</span><span class="op" id="6388432">[</span><span class="builtintype" id="6388433">string</span><span class="op" id="6388439">]</span><span class="builtintype" id="6388440">string</span><span class="op" id="6388446">)</span>&nbsp;<span class="op" id="6388448">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6388451">//&nbsp;Try&nbsp;octal&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388472">s</span>&nbsp;<span class="op" id="6388474">:=</span>&nbsp;<span class="ident" id="6388477">strconv</span><span class="op" id="6388484">.</span><span class="ident" id="6388485">FormatInt</span><span class="op" id="6388494">(</span><span class="ident" id="6388495">x</span><span class="op" id="6388496">,</span>&nbsp;<span class="num" id="6388498">8</span><span class="op" id="6388499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6388502">if</span>&nbsp;<span class="builtinfunc" id="6388505">len</span><span class="op" id="6388508">(</span><span class="ident" id="6388509">s</span><span class="op" id="6388510">)</span>&nbsp;<span class="op" id="6388512">&lt;</span>&nbsp;<span class="builtinfunc" id="6388514">len</span><span class="op" id="6388517">(</span><span class="ident" id="6388518">b</span><span class="op" id="6388519">)</span>&nbsp;<span class="op" id="6388521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388525">tw</span><span class="op" id="6388527">.</span><span class="ident" id="6388528">octal</span><span class="op" id="6388533">(</span><span class="ident" id="6388534">b</span><span class="op" id="6388535">,</span>&nbsp;<span class="ident" id="6388537">x</span><span class="op" id="6388538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6388542">return</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6388550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6388554">//&nbsp;If&nbsp;it&nbsp;is&nbsp;too&nbsp;long&nbsp;for&nbsp;octal,&nbsp;and&nbsp;pax&nbsp;is&nbsp;preferred,&nbsp;use&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6388626">if</span>&nbsp;<span class="ident" id="6388629">allowPax</span>&nbsp;<span class="op" id="6388638">&amp;&amp;</span>&nbsp;<span class="ident" id="6388641">tw</span><span class="op" id="6388643">.</span><span class="ident" id="6388644">preferPax</span>&nbsp;<span class="op" id="6388654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388658">tw</span><span class="op" id="6388660">.</span><span class="ident" id="6388661">octal</span><span class="op" id="6388666">(</span><span class="ident" id="6388667">b</span><span class="op" id="6388668">,</span>&nbsp;<span class="num" id="6388670">0</span><span class="op" id="6388671">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388675">s</span>&nbsp;<span class="op" id="6388677">:=</span>&nbsp;<span class="ident" id="6388680">strconv</span><span class="op" id="6388687">.</span><span class="ident" id="6388688">FormatInt</span><span class="op" id="6388697">(</span><span class="ident" id="6388698">x</span><span class="op" id="6388699">,</span>&nbsp;<span class="num" id="6388701">10</span><span class="op" id="6388703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388707">paxHeaders</span><span class="op" id="6388717">[</span><span class="ident" id="6388718">paxKeyword</span><span class="op" id="6388728">]</span>&nbsp;<span class="op" id="6388730">=</span>&nbsp;<span class="ident" id="6388732">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6388736">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6388744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6388748">//&nbsp;Too&nbsp;big:&nbsp;use&nbsp;binary&nbsp;(big-endian).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388786">tw</span><span class="op" id="6388788">.</span><span class="ident" id="6388789">usedBinary</span>&nbsp;<span class="op" id="6388800">=</span>&nbsp;<span class="builtintype" id="6388802">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6388808">for</span>&nbsp;<span class="ident" id="6388812">i</span>&nbsp;<span class="op" id="6388814">:=</span>&nbsp;<span class="builtinfunc" id="6388817">len</span><span class="op" id="6388820">(</span><span class="ident" id="6388821">b</span><span class="op" id="6388822">)</span>&nbsp;<span class="op" id="6388824">-</span>&nbsp;<span class="num" id="6388826">1</span><span class="op" id="6388827">;</span>&nbsp;<span class="ident" id="6388829">x</span>&nbsp;<span class="op" id="6388831">&gt;</span>&nbsp;<span class="num" id="6388833">0</span>&nbsp;<span class="op" id="6388835">&amp;&amp;</span>&nbsp;<span class="ident" id="6388838">i</span>&nbsp;<span class="op" id="6388840">&gt;=</span>&nbsp;<span class="num" id="6388843">0</span><span class="op" id="6388844">;</span>&nbsp;<span class="ident" id="6388846">i</span><span class="op" id="6388847">--</span>&nbsp;<span class="op" id="6388850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388854">b</span><span class="op" id="6388855">[</span><span class="ident" id="6388856">i</span><span class="op" id="6388857">]</span>&nbsp;<span class="op" id="6388859">=</span>&nbsp;<span class="builtintype" id="6388861">byte</span><span class="op" id="6388865">(</span><span class="ident" id="6388866">x</span><span class="op" id="6388867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388871">x</span>&nbsp;<span class="op" id="6388873">&gt;&gt;=</span>&nbsp;<span class="num" id="6388877">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6388880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388883">b</span><span class="op" id="6388884">[</span><span class="num" id="6388885">0</span><span class="op" id="6388886">]</span>&nbsp;<span class="op" id="6388888">|=</span>&nbsp;<span class="num" id="6388891">0x80</span>&nbsp;<span class="comment" id="6388896">//&nbsp;highest&nbsp;bit&nbsp;indicates&nbsp;binary&nbsp;format</span><br>
<span class="lineno"></span><span class="op" id="6388935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6388938">var</span>&nbsp;<span class="op" id="6388942">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388945">minTime</span>&nbsp;<span class="op" id="6388953">=</span>&nbsp;<span class="ident" id="6388955">time</span><span class="op" id="6388959">.</span><span class="ident" id="6388960">Unix</span><span class="op" id="6388964">(</span><span class="num" id="6388965">0</span><span class="op" id="6388966">,</span>&nbsp;<span class="num" id="6388968">0</span><span class="op" id="6388969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6388972">//&nbsp;There&nbsp;is&nbsp;room&nbsp;for&nbsp;11&nbsp;octal&nbsp;digits&nbsp;(33&nbsp;bits)&nbsp;of&nbsp;mtime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389030">maxTime</span>&nbsp;<span class="op" id="6389038">=</span>&nbsp;<span class="ident" id="6389040">minTime</span><span class="op" id="6389047">.</span><span class="ident" id="6389048">Add</span><span class="op" id="6389051">(</span><span class="op" id="6389052">(</span><span class="num" id="6389053">1</span><span class="op" id="6389054">&lt;&lt;</span><span class="num" id="6389056">33</span>&nbsp;<span class="op" id="6389059">-</span>&nbsp;<span class="num" id="6389061">1</span><span class="op" id="6389062">)</span>&nbsp;<span class="op" id="6389064">*</span>&nbsp;<span class="ident" id="6389066">time</span><span class="op" id="6389070">.</span><span class="ident" id="6389071">Second</span><span class="op" id="6389077">)</span><br>
<span class="lineno"></span><span class="op" id="6389079">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="6389082">//&nbsp;WriteHeader&nbsp;writes&nbsp;hdr&nbsp;and&nbsp;prepares&nbsp;to&nbsp;accept&nbsp;the&nbsp;file&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="6389152">//&nbsp;WriteHeader&nbsp;calls&nbsp;Flush&nbsp;if&nbsp;it&nbsp;is&nbsp;not&nbsp;the&nbsp;first&nbsp;header.</span><br>
<span class="lineno"></span><span class="comment" id="6389210">//&nbsp;Calling&nbsp;after&nbsp;a&nbsp;Close&nbsp;will&nbsp;return&nbsp;ErrWriteAfterClose.</span><br>
<span class="lineno"></span><span class="keyword" id="6389267">func</span>&nbsp;<span class="op" id="6389272">(</span><span class="ident" id="6389273">tw</span>&nbsp;<span class="op" id="6389276">*</span><span class="ident" id="6389277">Writer</span><span class="op" id="6389283">)</span>&nbsp;<span class="ident" id="6389285">WriteHeader</span><span class="op" id="6389296">(</span><span class="ident" id="6389297">hdr</span>&nbsp;<span class="op" id="6389301">*</span><span class="ident" id="6389302">Header</span><span class="op" id="6389308">)</span>&nbsp;<span class="builtintype" id="6389310">error</span>&nbsp;<span class="op" id="6389316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6389319">return</span>&nbsp;<span class="ident" id="6389326">tw</span><span class="op" id="6389328">.</span><span class="ident" id="6389329">writeHeader</span><span class="op" id="6389340">(</span><span class="ident" id="6389341">hdr</span><span class="op" id="6389344">,</span>&nbsp;<span class="builtintype" id="6389346">true</span><span class="op" id="6389350">)</span><br>
<span class="lineno">140</span><span class="op" id="6389352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6389355">//&nbsp;WriteHeader&nbsp;writes&nbsp;hdr&nbsp;and&nbsp;prepares&nbsp;to&nbsp;accept&nbsp;the&nbsp;file&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="6389425">//&nbsp;WriteHeader&nbsp;calls&nbsp;Flush&nbsp;if&nbsp;it&nbsp;is&nbsp;not&nbsp;the&nbsp;first&nbsp;header.</span><br>
<span class="lineno"></span><span class="comment" id="6389483">//&nbsp;Calling&nbsp;after&nbsp;a&nbsp;Close&nbsp;will&nbsp;return&nbsp;ErrWriteAfterClose.</span><br>
<span class="lineno">145</span><span class="comment" id="6389540">//&nbsp;As&nbsp;this&nbsp;method&nbsp;is&nbsp;called&nbsp;internally&nbsp;by&nbsp;writePax&nbsp;header&nbsp;to&nbsp;allow&nbsp;it&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6389613">//&nbsp;suppress&nbsp;writing&nbsp;the&nbsp;pax&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="6389649">func</span>&nbsp;<span class="op" id="6389654">(</span><span class="ident" id="6389655">tw</span>&nbsp;<span class="op" id="6389658">*</span><span class="ident" id="6389659">Writer</span><span class="op" id="6389665">)</span>&nbsp;<span class="ident" id="6389667">writeHeader</span><span class="op" id="6389678">(</span><span class="ident" id="6389679">hdr</span>&nbsp;<span class="op" id="6389683">*</span><span class="ident" id="6389684">Header</span><span class="op" id="6389690">,</span>&nbsp;<span class="ident" id="6389692">allowPax</span>&nbsp;<span class="builtintype" id="6389701">bool</span><span class="op" id="6389705">)</span>&nbsp;<span class="builtintype" id="6389707">error</span>&nbsp;<span class="op" id="6389713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6389716">if</span>&nbsp;<span class="ident" id="6389719">tw</span><span class="op" id="6389721">.</span><span class="ident" id="6389722">closed</span>&nbsp;<span class="op" id="6389729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6389733">return</span>&nbsp;<span class="ident" id="6389740">ErrWriteAfterClose</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6389760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6389763">if</span>&nbsp;<span class="ident" id="6389766">tw</span><span class="op" id="6389768">.</span><span class="ident" id="6389769">err</span>&nbsp;<span class="op" id="6389773">==</span>&nbsp;<span class="builtintype" id="6389776">nil</span>&nbsp;<span class="op" id="6389780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389784">tw</span><span class="op" id="6389786">.</span><span class="ident" id="6389787">Flush</span><span class="op" id="6389792">(</span><span class="op" id="6389793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6389796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6389799">if</span>&nbsp;<span class="ident" id="6389802">tw</span><span class="op" id="6389804">.</span><span class="ident" id="6389805">err</span>&nbsp;<span class="op" id="6389809">!=</span>&nbsp;<span class="builtintype" id="6389812">nil</span>&nbsp;<span class="op" id="6389816">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6389820">return</span>&nbsp;<span class="ident" id="6389827">tw</span><span class="op" id="6389829">.</span><span class="ident" id="6389830">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6389835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6389839">//&nbsp;a&nbsp;map&nbsp;to&nbsp;hold&nbsp;pax&nbsp;header&nbsp;records,&nbsp;if&nbsp;any&nbsp;are&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6389895">paxHeaders</span>&nbsp;<span class="op" id="6389906">:=</span>&nbsp;<span class="builtinfunc" id="6389909">make</span><span class="op" id="6389913">(</span><span class="keyword" id="6389914">map</span><span class="op" id="6389917">[</span><span class="builtintype" id="6389918">string</span><span class="op" id="6389924">]</span><span class="builtintype" id="6389925">string</span><span class="op" id="6389931">)</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6389935">//&nbsp;TODO(shanemhansen):&nbsp;we&nbsp;might&nbsp;want&nbsp;to&nbsp;use&nbsp;PAX&nbsp;headers&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6389996">//&nbsp;subsecond&nbsp;time&nbsp;resolution,&nbsp;but&nbsp;for&nbsp;now&nbsp;let&#39;s&nbsp;just&nbsp;capture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6390058">//&nbsp;too&nbsp;long&nbsp;fields&nbsp;or&nbsp;non&nbsp;ascii&nbsp;characters</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6390103">var</span>&nbsp;<span class="ident" id="6390107">header</span>&nbsp;<span class="op" id="6390114">[</span><span class="op" id="6390115">]</span><span class="builtintype" id="6390116">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6390123">//&nbsp;We&nbsp;need&nbsp;to&nbsp;select&nbsp;which&nbsp;scratch&nbsp;buffer&nbsp;to&nbsp;use&nbsp;carefully,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6390184">//&nbsp;since&nbsp;this&nbsp;method&nbsp;is&nbsp;called&nbsp;recursively&nbsp;to&nbsp;write&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6390250">//&nbsp;If&nbsp;allowPax&nbsp;is&nbsp;true,&nbsp;this&nbsp;is&nbsp;the&nbsp;non-recursive&nbsp;call,&nbsp;and&nbsp;we&nbsp;will&nbsp;use&nbsp;hdrBuff.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6390332">//&nbsp;If&nbsp;allowPax&nbsp;is&nbsp;false,&nbsp;we&nbsp;are&nbsp;being&nbsp;called&nbsp;by&nbsp;writePAXHeader,&nbsp;and&nbsp;hdrBuff&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6390412">//&nbsp;already&nbsp;being&nbsp;used&nbsp;by&nbsp;the&nbsp;non-recursive&nbsp;call,&nbsp;so&nbsp;we&nbsp;must&nbsp;use&nbsp;paxHdrBuff.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390489">header</span>&nbsp;<span class="op" id="6390496">=</span>&nbsp;<span class="ident" id="6390498">tw</span><span class="op" id="6390500">.</span><span class="ident" id="6390501">hdrBuff</span><span class="op" id="6390508">[</span><span class="op" id="6390509">:</span><span class="op" id="6390510">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6390513">if</span>&nbsp;<span class="op" id="6390516">!</span><span class="ident" id="6390517">allowPax</span>&nbsp;<span class="op" id="6390526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390530">header</span>&nbsp;<span class="op" id="6390537">=</span>&nbsp;<span class="ident" id="6390539">tw</span><span class="op" id="6390541">.</span><span class="ident" id="6390542">paxHdrBuff</span><span class="op" id="6390552">[</span><span class="op" id="6390553">:</span><span class="op" id="6390554">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6390557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6390560">copy</span><span class="op" id="6390564">(</span><span class="ident" id="6390565">header</span><span class="op" id="6390571">,</span>&nbsp;<span class="ident" id="6390573">zeroBlock</span><span class="op" id="6390582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390585">s</span>&nbsp;<span class="op" id="6390587">:=</span>&nbsp;<span class="ident" id="6390590">slicer</span><span class="op" id="6390596">(</span><span class="ident" id="6390597">header</span><span class="op" id="6390603">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6390607">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;filename&nbsp;to&nbsp;allow&nbsp;to&nbsp;overwrite&nbsp;it&nbsp;later&nbsp;if&nbsp;we&nbsp;detect&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;ustar&nbsp;longnames&nbsp;instead&nbsp;of&nbsp;pax</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390735">pathHeaderBytes</span>&nbsp;<span class="op" id="6390751">:=</span>&nbsp;<span class="ident" id="6390754">s</span><span class="op" id="6390755">.</span><span class="ident" id="6390756">next</span><span class="op" id="6390760">(</span><span class="ident" id="6390761">fileNameSize</span><span class="op" id="6390773">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390777">tw</span><span class="op" id="6390779">.</span><span class="ident" id="6390780">cString</span><span class="op" id="6390787">(</span><span class="ident" id="6390788">pathHeaderBytes</span><span class="op" id="6390803">,</span>&nbsp;<span class="ident" id="6390805">hdr</span><span class="op" id="6390808">.</span><span class="ident" id="6390809">Name</span><span class="op" id="6390813">,</span>&nbsp;<span class="builtintype" id="6390815">true</span><span class="op" id="6390819">,</span>&nbsp;<span class="ident" id="6390821">paxPath</span><span class="op" id="6390828">,</span>&nbsp;<span class="ident" id="6390830">paxHeaders</span><span class="op" id="6390840">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6390844">//&nbsp;Handle&nbsp;out&nbsp;of&nbsp;range&nbsp;ModTime&nbsp;carefully.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6390887">var</span>&nbsp;<span class="ident" id="6390891">modTime</span>&nbsp;<span class="ident" id="6390899">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6390906">if</span>&nbsp;<span class="op" id="6390909">!</span><span class="ident" id="6390910">hdr</span><span class="op" id="6390913">.</span><span class="ident" id="6390914">ModTime</span><span class="op" id="6390921">.</span><span class="ident" id="6390922">Before</span><span class="op" id="6390928">(</span><span class="ident" id="6390929">minTime</span><span class="op" id="6390936">)</span>&nbsp;<span class="op" id="6390938">&amp;&amp;</span>&nbsp;<span class="op" id="6390941">!</span><span class="ident" id="6390942">hdr</span><span class="op" id="6390945">.</span><span class="ident" id="6390946">ModTime</span><span class="op" id="6390953">.</span><span class="ident" id="6390954">After</span><span class="op" id="6390959">(</span><span class="ident" id="6390960">maxTime</span><span class="op" id="6390967">)</span>&nbsp;<span class="op" id="6390969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6390973">modTime</span>&nbsp;<span class="op" id="6390981">=</span>&nbsp;<span class="ident" id="6390983">hdr</span><span class="op" id="6390986">.</span><span class="ident" id="6390987">ModTime</span><span class="op" id="6390994">.</span><span class="ident" id="6390995">Unix</span><span class="op" id="6390999">(</span><span class="op" id="6391000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6391003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391007">tw</span><span class="op" id="6391009">.</span><span class="ident" id="6391010">octal</span><span class="op" id="6391015">(</span><span class="ident" id="6391016">s</span><span class="op" id="6391017">.</span><span class="ident" id="6391018">next</span><span class="op" id="6391022">(</span><span class="num" id="6391023">8</span><span class="op" id="6391024">)</span><span class="op" id="6391025">,</span>&nbsp;<span class="ident" id="6391027">hdr</span><span class="op" id="6391030">.</span><span class="ident" id="6391031">Mode</span><span class="op" id="6391035">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6391071">//&nbsp;100:108</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391083">tw</span><span class="op" id="6391085">.</span><span class="ident" id="6391086">numeric</span><span class="op" id="6391093">(</span><span class="ident" id="6391094">s</span><span class="op" id="6391095">.</span><span class="ident" id="6391096">next</span><span class="op" id="6391100">(</span><span class="num" id="6391101">8</span><span class="op" id="6391102">)</span><span class="op" id="6391103">,</span>&nbsp;<span class="ident" id="6391105">int64</span><span class="op" id="6391110">(</span><span class="ident" id="6391111">hdr</span><span class="op" id="6391114">.</span><span class="ident" id="6391115">Uid</span><span class="op" id="6391118">)</span><span class="op" id="6391119">,</span>&nbsp;<span class="builtintype" id="6391121">true</span><span class="op" id="6391125">,</span>&nbsp;<span class="ident" id="6391127">paxUid</span><span class="op" id="6391133">,</span>&nbsp;<span class="ident" id="6391135">paxHeaders</span><span class="op" id="6391145">)</span>&nbsp;<span class="comment" id="6391147">//&nbsp;108:116</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391159">tw</span><span class="op" id="6391161">.</span><span class="ident" id="6391162">numeric</span><span class="op" id="6391169">(</span><span class="ident" id="6391170">s</span><span class="op" id="6391171">.</span><span class="ident" id="6391172">next</span><span class="op" id="6391176">(</span><span class="num" id="6391177">8</span><span class="op" id="6391178">)</span><span class="op" id="6391179">,</span>&nbsp;<span class="ident" id="6391181">int64</span><span class="op" id="6391186">(</span><span class="ident" id="6391187">hdr</span><span class="op" id="6391190">.</span><span class="ident" id="6391191">Gid</span><span class="op" id="6391194">)</span><span class="op" id="6391195">,</span>&nbsp;<span class="builtintype" id="6391197">true</span><span class="op" id="6391201">,</span>&nbsp;<span class="ident" id="6391203">paxGid</span><span class="op" id="6391209">,</span>&nbsp;<span class="ident" id="6391211">paxHeaders</span><span class="op" id="6391221">)</span>&nbsp;<span class="comment" id="6391223">//&nbsp;116:124</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391235">tw</span><span class="op" id="6391237">.</span><span class="ident" id="6391238">numeric</span><span class="op" id="6391245">(</span><span class="ident" id="6391246">s</span><span class="op" id="6391247">.</span><span class="ident" id="6391248">next</span><span class="op" id="6391252">(</span><span class="num" id="6391253">12</span><span class="op" id="6391255">)</span><span class="op" id="6391256">,</span>&nbsp;<span class="ident" id="6391258">hdr</span><span class="op" id="6391261">.</span><span class="ident" id="6391262">Size</span><span class="op" id="6391266">,</span>&nbsp;<span class="builtintype" id="6391268">true</span><span class="op" id="6391272">,</span>&nbsp;<span class="ident" id="6391274">paxSize</span><span class="op" id="6391281">,</span>&nbsp;<span class="ident" id="6391283">paxHeaders</span><span class="op" id="6391293">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6391299">//&nbsp;124:136</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391311">tw</span><span class="op" id="6391313">.</span><span class="ident" id="6391314">numeric</span><span class="op" id="6391321">(</span><span class="ident" id="6391322">s</span><span class="op" id="6391323">.</span><span class="ident" id="6391324">next</span><span class="op" id="6391328">(</span><span class="num" id="6391329">12</span><span class="op" id="6391331">)</span><span class="op" id="6391332">,</span>&nbsp;<span class="ident" id="6391334">modTime</span><span class="op" id="6391341">,</span>&nbsp;<span class="builtintype" id="6391343">false</span><span class="op" id="6391348">,</span>&nbsp;<span class="ident" id="6391350">paxNone</span><span class="op" id="6391357">,</span>&nbsp;<span class="builtintype" id="6391359">nil</span><span class="op" id="6391362">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6391375">//&nbsp;136:148&nbsp;---&nbsp;consider&nbsp;using&nbsp;pax&nbsp;for&nbsp;finer&nbsp;granularity</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391432">s</span><span class="op" id="6391433">.</span><span class="ident" id="6391434">next</span><span class="op" id="6391438">(</span><span class="num" id="6391439">8</span><span class="op" id="6391440">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6391496">//&nbsp;chksum&nbsp;(148:156)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391517">s</span><span class="op" id="6391518">.</span><span class="ident" id="6391519">next</span><span class="op" id="6391523">(</span><span class="num" id="6391524">1</span><span class="op" id="6391525">)</span><span class="op" id="6391526">[</span><span class="num" id="6391527">0</span><span class="op" id="6391528">]</span>&nbsp;<span class="op" id="6391530">=</span>&nbsp;<span class="ident" id="6391532">hdr</span><span class="op" id="6391535">.</span><span class="ident" id="6391536">Typeflag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6391581">//&nbsp;156:157</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391594">tw</span><span class="op" id="6391596">.</span><span class="ident" id="6391597">cString</span><span class="op" id="6391604">(</span><span class="ident" id="6391605">s</span><span class="op" id="6391606">.</span><span class="ident" id="6391607">next</span><span class="op" id="6391611">(</span><span class="num" id="6391612">100</span><span class="op" id="6391615">)</span><span class="op" id="6391616">,</span>&nbsp;<span class="ident" id="6391618">hdr</span><span class="op" id="6391621">.</span><span class="ident" id="6391622">Linkname</span><span class="op" id="6391630">,</span>&nbsp;<span class="builtintype" id="6391632">true</span><span class="op" id="6391636">,</span>&nbsp;<span class="ident" id="6391638">paxLinkpath</span><span class="op" id="6391649">,</span>&nbsp;<span class="ident" id="6391651">paxHeaders</span><span class="op" id="6391661">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6391665">copy</span><span class="op" id="6391669">(</span><span class="ident" id="6391670">s</span><span class="op" id="6391671">.</span><span class="ident" id="6391672">next</span><span class="op" id="6391676">(</span><span class="num" id="6391677">8</span><span class="op" id="6391678">)</span><span class="op" id="6391679">,</span>&nbsp;<span class="op" id="6391681">[</span><span class="op" id="6391682">]</span><span class="builtintype" id="6391683">byte</span><span class="op" id="6391687">(</span><span class="string" id="6391688">&#34;ustar\x0000&#34;</span><span class="op" id="6391701">)</span><span class="op" id="6391702">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6391727">//&nbsp;257:265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391739">tw</span><span class="op" id="6391741">.</span><span class="ident" id="6391742">cString</span><span class="op" id="6391749">(</span><span class="ident" id="6391750">s</span><span class="op" id="6391751">.</span><span class="ident" id="6391752">next</span><span class="op" id="6391756">(</span><span class="num" id="6391757">32</span><span class="op" id="6391759">)</span><span class="op" id="6391760">,</span>&nbsp;<span class="ident" id="6391762">hdr</span><span class="op" id="6391765">.</span><span class="ident" id="6391766">Uname</span><span class="op" id="6391771">,</span>&nbsp;<span class="builtintype" id="6391773">true</span><span class="op" id="6391777">,</span>&nbsp;<span class="ident" id="6391779">paxUname</span><span class="op" id="6391787">,</span>&nbsp;<span class="ident" id="6391789">paxHeaders</span><span class="op" id="6391799">)</span>&nbsp;<span class="comment" id="6391801">//&nbsp;265:297</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391813">tw</span><span class="op" id="6391815">.</span><span class="ident" id="6391816">cString</span><span class="op" id="6391823">(</span><span class="ident" id="6391824">s</span><span class="op" id="6391825">.</span><span class="ident" id="6391826">next</span><span class="op" id="6391830">(</span><span class="num" id="6391831">32</span><span class="op" id="6391833">)</span><span class="op" id="6391834">,</span>&nbsp;<span class="ident" id="6391836">hdr</span><span class="op" id="6391839">.</span><span class="ident" id="6391840">Gname</span><span class="op" id="6391845">,</span>&nbsp;<span class="builtintype" id="6391847">true</span><span class="op" id="6391851">,</span>&nbsp;<span class="ident" id="6391853">paxGname</span><span class="op" id="6391861">,</span>&nbsp;<span class="ident" id="6391863">paxHeaders</span><span class="op" id="6391873">)</span>&nbsp;<span class="comment" id="6391875">//&nbsp;297:329</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391887">tw</span><span class="op" id="6391889">.</span><span class="ident" id="6391890">numeric</span><span class="op" id="6391897">(</span><span class="ident" id="6391898">s</span><span class="op" id="6391899">.</span><span class="ident" id="6391900">next</span><span class="op" id="6391904">(</span><span class="num" id="6391905">8</span><span class="op" id="6391906">)</span><span class="op" id="6391907">,</span>&nbsp;<span class="ident" id="6391909">hdr</span><span class="op" id="6391912">.</span><span class="ident" id="6391913">Devmajor</span><span class="op" id="6391921">,</span>&nbsp;<span class="builtintype" id="6391923">false</span><span class="op" id="6391928">,</span>&nbsp;<span class="ident" id="6391930">paxNone</span><span class="op" id="6391937">,</span>&nbsp;<span class="builtintype" id="6391939">nil</span><span class="op" id="6391942">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6391949">//&nbsp;329:337</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6391961">tw</span><span class="op" id="6391963">.</span><span class="ident" id="6391964">numeric</span><span class="op" id="6391971">(</span><span class="ident" id="6391972">s</span><span class="op" id="6391973">.</span><span class="ident" id="6391974">next</span><span class="op" id="6391978">(</span><span class="num" id="6391979">8</span><span class="op" id="6391980">)</span><span class="op" id="6391981">,</span>&nbsp;<span class="ident" id="6391983">hdr</span><span class="op" id="6391986">.</span><span class="ident" id="6391987">Devminor</span><span class="op" id="6391995">,</span>&nbsp;<span class="builtintype" id="6391997">false</span><span class="op" id="6392002">,</span>&nbsp;<span class="ident" id="6392004">paxNone</span><span class="op" id="6392011">,</span>&nbsp;<span class="builtintype" id="6392013">nil</span><span class="op" id="6392016">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6392023">//&nbsp;337:345</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6392036">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;prefix&nbsp;to&nbsp;allow&nbsp;to&nbsp;overwrite&nbsp;it&nbsp;later&nbsp;if&nbsp;we&nbsp;detect&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;ustar&nbsp;longnames&nbsp;instead&nbsp;of&nbsp;pax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392162">prefixHeaderBytes</span>&nbsp;<span class="op" id="6392180">:=</span>&nbsp;<span class="ident" id="6392183">s</span><span class="op" id="6392184">.</span><span class="ident" id="6392185">next</span><span class="op" id="6392189">(</span><span class="num" id="6392190">155</span><span class="op" id="6392193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392196">tw</span><span class="op" id="6392198">.</span><span class="ident" id="6392199">cString</span><span class="op" id="6392206">(</span><span class="ident" id="6392207">prefixHeaderBytes</span><span class="op" id="6392224">,</span>&nbsp;<span class="string" id="6392226">&#34;&#34;</span><span class="op" id="6392228">,</span>&nbsp;<span class="builtintype" id="6392230">false</span><span class="op" id="6392235">,</span>&nbsp;<span class="ident" id="6392237">paxNone</span><span class="op" id="6392244">,</span>&nbsp;<span class="builtintype" id="6392246">nil</span><span class="op" id="6392249">)</span>&nbsp;<span class="comment" id="6392251">//&nbsp;345:500&nbsp;&nbsp;prefix</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6392272">//&nbsp;Use&nbsp;the&nbsp;GNU&nbsp;magic&nbsp;instead&nbsp;of&nbsp;POSIX&nbsp;magic&nbsp;if&nbsp;we&nbsp;used&nbsp;any&nbsp;GNU&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6392348">if</span>&nbsp;<span class="ident" id="6392351">tw</span><span class="op" id="6392353">.</span><span class="ident" id="6392354">usedBinary</span>&nbsp;<span class="op" id="6392365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6392369">copy</span><span class="op" id="6392373">(</span><span class="ident" id="6392374">header</span><span class="op" id="6392380">[</span><span class="num" id="6392381">257</span><span class="op" id="6392384">:</span><span class="num" id="6392385">265</span><span class="op" id="6392388">]</span><span class="op" id="6392389">,</span>&nbsp;<span class="op" id="6392391">[</span><span class="op" id="6392392">]</span><span class="builtintype" id="6392393">byte</span><span class="op" id="6392397">(</span><span class="string" id="6392398">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="6392411">)</span><span class="op" id="6392412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6392415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392419">_</span><span class="op" id="6392420">,</span>&nbsp;<span class="ident" id="6392422">paxPathUsed</span>&nbsp;<span class="op" id="6392434">:=</span>&nbsp;<span class="ident" id="6392437">paxHeaders</span><span class="op" id="6392447">[</span><span class="ident" id="6392448">paxPath</span><span class="op" id="6392455">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6392458">//&nbsp;try&nbsp;to&nbsp;use&nbsp;a&nbsp;ustar&nbsp;header&nbsp;when&nbsp;only&nbsp;the&nbsp;name&nbsp;is&nbsp;too&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6392519">if</span>&nbsp;<span class="op" id="6392522">!</span><span class="ident" id="6392523">tw</span><span class="op" id="6392525">.</span><span class="ident" id="6392526">preferPax</span>&nbsp;<span class="op" id="6392536">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6392539">len</span><span class="op" id="6392542">(</span><span class="ident" id="6392543">paxHeaders</span><span class="op" id="6392553">)</span>&nbsp;<span class="op" id="6392555">==</span>&nbsp;<span class="num" id="6392558">1</span>&nbsp;<span class="op" id="6392560">&amp;&amp;</span>&nbsp;<span class="ident" id="6392563">paxPathUsed</span>&nbsp;<span class="op" id="6392575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392579">suffix</span>&nbsp;<span class="op" id="6392586">:=</span>&nbsp;<span class="ident" id="6392589">hdr</span><span class="op" id="6392592">.</span><span class="ident" id="6392593">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392600">prefix</span>&nbsp;<span class="op" id="6392607">:=</span>&nbsp;<span class="string" id="6392610">&#34;&#34;</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6392615">if</span>&nbsp;<span class="builtinfunc" id="6392618">len</span><span class="op" id="6392621">(</span><span class="ident" id="6392622">hdr</span><span class="op" id="6392625">.</span><span class="ident" id="6392626">Name</span><span class="op" id="6392630">)</span>&nbsp;<span class="op" id="6392632">&gt;</span>&nbsp;<span class="ident" id="6392634">fileNameSize</span>&nbsp;<span class="op" id="6392647">&amp;&amp;</span>&nbsp;<span class="ident" id="6392650">isASCII</span><span class="op" id="6392657">(</span><span class="ident" id="6392658">hdr</span><span class="op" id="6392661">.</span><span class="ident" id="6392662">Name</span><span class="op" id="6392666">)</span>&nbsp;<span class="op" id="6392668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6392673">var</span>&nbsp;<span class="ident" id="6392677">err</span>&nbsp;<span class="builtintype" id="6392681">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392690">prefix</span><span class="op" id="6392696">,</span>&nbsp;<span class="ident" id="6392698">suffix</span><span class="op" id="6392704">,</span>&nbsp;<span class="ident" id="6392706">err</span>&nbsp;<span class="op" id="6392710">=</span>&nbsp;<span class="ident" id="6392712">tw</span><span class="op" id="6392714">.</span><span class="ident" id="6392715">splitUSTARLongName</span><span class="op" id="6392733">(</span><span class="ident" id="6392734">hdr</span><span class="op" id="6392737">.</span><span class="ident" id="6392738">Name</span><span class="op" id="6392742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6392747">if</span>&nbsp;<span class="ident" id="6392750">err</span>&nbsp;<span class="op" id="6392754">==</span>&nbsp;<span class="builtintype" id="6392757">nil</span>&nbsp;<span class="op" id="6392761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6392767">//&nbsp;ok&nbsp;we&nbsp;can&nbsp;use&nbsp;a&nbsp;ustar&nbsp;long&nbsp;name&nbsp;instead&nbsp;of&nbsp;pax,&nbsp;now&nbsp;correct&nbsp;the&nbsp;fields</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6392846">//&nbsp;remove&nbsp;the&nbsp;path&nbsp;field&nbsp;from&nbsp;the&nbsp;pax&nbsp;header.&nbsp;this&nbsp;will&nbsp;suppress&nbsp;the&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6392930">delete</span><span class="op" id="6392936">(</span><span class="ident" id="6392937">paxHeaders</span><span class="op" id="6392947">,</span>&nbsp;<span class="ident" id="6392949">paxPath</span><span class="op" id="6392956">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6392963">//&nbsp;update&nbsp;the&nbsp;path&nbsp;fields</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392993">tw</span><span class="op" id="6392995">.</span><span class="ident" id="6392996">cString</span><span class="op" id="6393003">(</span><span class="ident" id="6393004">pathHeaderBytes</span><span class="op" id="6393019">,</span>&nbsp;<span class="ident" id="6393021">suffix</span><span class="op" id="6393027">,</span>&nbsp;<span class="builtintype" id="6393029">false</span><span class="op" id="6393034">,</span>&nbsp;<span class="ident" id="6393036">paxNone</span><span class="op" id="6393043">,</span>&nbsp;<span class="builtintype" id="6393045">nil</span><span class="op" id="6393048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6393054">tw</span><span class="op" id="6393056">.</span><span class="ident" id="6393057">cString</span><span class="op" id="6393064">(</span><span class="ident" id="6393065">prefixHeaderBytes</span><span class="op" id="6393082">,</span>&nbsp;<span class="ident" id="6393084">prefix</span><span class="op" id="6393090">,</span>&nbsp;<span class="builtintype" id="6393092">false</span><span class="op" id="6393097">,</span>&nbsp;<span class="ident" id="6393099">paxNone</span><span class="op" id="6393106">,</span>&nbsp;<span class="builtintype" id="6393108">nil</span><span class="op" id="6393111">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6393118">//&nbsp;Use&nbsp;the&nbsp;ustar&nbsp;magic&nbsp;if&nbsp;we&nbsp;used&nbsp;ustar&nbsp;long&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393174">if</span>&nbsp;<span class="builtinfunc" id="6393177">len</span><span class="op" id="6393180">(</span><span class="ident" id="6393181">prefix</span><span class="op" id="6393187">)</span>&nbsp;<span class="op" id="6393189">&gt;</span>&nbsp;<span class="num" id="6393191">0</span>&nbsp;<span class="op" id="6393193">&amp;&amp;</span>&nbsp;<span class="op" id="6393196">!</span><span class="ident" id="6393197">tw</span><span class="op" id="6393199">.</span><span class="ident" id="6393200">usedBinary</span>&nbsp;<span class="op" id="6393211">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6393218">copy</span><span class="op" id="6393222">(</span><span class="ident" id="6393223">header</span><span class="op" id="6393229">[</span><span class="num" id="6393230">257</span><span class="op" id="6393233">:</span><span class="num" id="6393234">265</span><span class="op" id="6393237">]</span><span class="op" id="6393238">,</span>&nbsp;<span class="op" id="6393240">[</span><span class="op" id="6393241">]</span><span class="builtintype" id="6393242">byte</span><span class="op" id="6393246">(</span><span class="string" id="6393247">&#34;ustar\x00&#34;</span><span class="op" id="6393258">)</span><span class="op" id="6393259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6393265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6393270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6393274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6393277">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6393281">//&nbsp;The&nbsp;chksum&nbsp;field&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;NUL&nbsp;and&nbsp;a&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6393338">//&nbsp;This&nbsp;is&nbsp;different&nbsp;from&nbsp;the&nbsp;other&nbsp;octal&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6393389">chksum</span><span class="op" id="6393395">,</span>&nbsp;<span class="ident" id="6393397">_</span>&nbsp;<span class="op" id="6393399">:=</span>&nbsp;<span class="ident" id="6393402">checksum</span><span class="op" id="6393410">(</span><span class="ident" id="6393411">header</span><span class="op" id="6393417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6393420">tw</span><span class="op" id="6393422">.</span><span class="ident" id="6393423">octal</span><span class="op" id="6393428">(</span><span class="ident" id="6393429">header</span><span class="op" id="6393435">[</span><span class="num" id="6393436">148</span><span class="op" id="6393439">:</span><span class="num" id="6393440">155</span><span class="op" id="6393443">]</span><span class="op" id="6393444">,</span>&nbsp;<span class="ident" id="6393446">chksum</span><span class="op" id="6393452">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6393455">header</span><span class="op" id="6393461">[</span><span class="num" id="6393462">155</span><span class="op" id="6393465">]</span>&nbsp;<span class="op" id="6393467">=</span>&nbsp;<span class="string" id="6393469">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393475">if</span>&nbsp;<span class="ident" id="6393478">tw</span><span class="op" id="6393480">.</span><span class="ident" id="6393481">err</span>&nbsp;<span class="op" id="6393485">!=</span>&nbsp;<span class="builtintype" id="6393488">nil</span>&nbsp;<span class="op" id="6393492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6393496">//&nbsp;problem&nbsp;with&nbsp;header;&nbsp;probably&nbsp;integer&nbsp;too&nbsp;big&nbsp;for&nbsp;a&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393560">return</span>&nbsp;<span class="ident" id="6393567">tw</span><span class="op" id="6393569">.</span><span class="ident" id="6393570">err</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6393575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393579">if</span>&nbsp;<span class="ident" id="6393582">allowPax</span>&nbsp;<span class="op" id="6393591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393595">for</span>&nbsp;<span class="ident" id="6393599">k</span><span class="op" id="6393600">,</span>&nbsp;<span class="ident" id="6393602">v</span>&nbsp;<span class="op" id="6393604">:=</span>&nbsp;<span class="keyword" id="6393607">range</span>&nbsp;<span class="ident" id="6393613">hdr</span><span class="op" id="6393616">.</span><span class="ident" id="6393617">Xattrs</span>&nbsp;<span class="op" id="6393624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6393629">paxHeaders</span><span class="op" id="6393639">[</span><span class="ident" id="6393640">paxXattr</span><span class="op" id="6393648">+</span><span class="ident" id="6393649">k</span><span class="op" id="6393650">]</span>&nbsp;<span class="op" id="6393652">=</span>&nbsp;<span class="ident" id="6393654">v</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6393658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6393661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393665">if</span>&nbsp;<span class="builtinfunc" id="6393668">len</span><span class="op" id="6393671">(</span><span class="ident" id="6393672">paxHeaders</span><span class="op" id="6393682">)</span>&nbsp;<span class="op" id="6393684">&gt;</span>&nbsp;<span class="num" id="6393686">0</span>&nbsp;<span class="op" id="6393688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393692">if</span>&nbsp;<span class="op" id="6393695">!</span><span class="ident" id="6393696">allowPax</span>&nbsp;<span class="op" id="6393705">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393710">return</span>&nbsp;<span class="ident" id="6393717">errInvalidHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6393736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393740">if</span>&nbsp;<span class="ident" id="6393743">err</span>&nbsp;<span class="op" id="6393747">:=</span>&nbsp;<span class="ident" id="6393750">tw</span><span class="op" id="6393752">.</span><span class="ident" id="6393753">writePAXHeader</span><span class="op" id="6393767">(</span><span class="ident" id="6393768">hdr</span><span class="op" id="6393771">,</span>&nbsp;<span class="ident" id="6393773">paxHeaders</span><span class="op" id="6393783">)</span><span class="op" id="6393784">;</span>&nbsp;<span class="ident" id="6393786">err</span>&nbsp;<span class="op" id="6393790">!=</span>&nbsp;<span class="builtintype" id="6393793">nil</span>&nbsp;<span class="op" id="6393797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393802">return</span>&nbsp;<span class="ident" id="6393809">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6393815">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6393818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6393821">tw</span><span class="op" id="6393823">.</span><span class="ident" id="6393824">nb</span>&nbsp;<span class="op" id="6393827">=</span>&nbsp;<span class="ident" id="6393829">int64</span><span class="op" id="6393834">(</span><span class="ident" id="6393835">hdr</span><span class="op" id="6393838">.</span><span class="ident" id="6393839">Size</span><span class="op" id="6393843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6393846">tw</span><span class="op" id="6393848">.</span><span class="ident" id="6393849">pad</span>&nbsp;<span class="op" id="6393853">=</span>&nbsp;<span class="op" id="6393855">(</span><span class="ident" id="6393856">blockSize</span>&nbsp;<span class="op" id="6393866">-</span>&nbsp;<span class="op" id="6393868">(</span><span class="ident" id="6393869">tw</span><span class="op" id="6393871">.</span><span class="ident" id="6393872">nb</span>&nbsp;<span class="op" id="6393875">%</span>&nbsp;<span class="ident" id="6393877">blockSize</span><span class="op" id="6393886">)</span><span class="op" id="6393887">)</span>&nbsp;<span class="op" id="6393889">%</span>&nbsp;<span class="ident" id="6393891">blockSize</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6393903">_</span><span class="op" id="6393904">,</span>&nbsp;<span class="ident" id="6393906">tw</span><span class="op" id="6393908">.</span><span class="ident" id="6393909">err</span>&nbsp;<span class="op" id="6393913">=</span>&nbsp;<span class="ident" id="6393915">tw</span><span class="op" id="6393917">.</span><span class="ident" id="6393918">w</span><span class="op" id="6393919">.</span><span class="ident" id="6393920">Write</span><span class="op" id="6393925">(</span><span class="ident" id="6393926">header</span><span class="op" id="6393932">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6393935">return</span>&nbsp;<span class="ident" id="6393942">tw</span><span class="op" id="6393944">.</span><span class="ident" id="6393945">err</span><br>
<span class="lineno"></span><span class="op" id="6393949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6393952">//&nbsp;writeUSTARLongName&nbsp;splits&nbsp;a&nbsp;USTAR&nbsp;long&nbsp;name&nbsp;hdr.Name.</span><br>
<span class="lineno"></span><span class="comment" id="6394009">//&nbsp;name&nbsp;must&nbsp;be&nbsp;&lt;&nbsp;256&nbsp;characters.&nbsp;errNameTooLong&nbsp;is&nbsp;returned</span><br>
<span class="lineno">275</span><span class="comment" id="6394070">//&nbsp;if&nbsp;hdr.Name&nbsp;can&#39;t&nbsp;be&nbsp;split.&nbsp;The&nbsp;splitting&nbsp;heuristic</span><br>
<span class="lineno"></span><span class="comment" id="6394125">//&nbsp;is&nbsp;compatible&nbsp;with&nbsp;gnu&nbsp;tar.</span><br>
<span class="lineno"></span><span class="keyword" id="6394156">func</span>&nbsp;<span class="op" id="6394161">(</span><span class="ident" id="6394162">tw</span>&nbsp;<span class="op" id="6394165">*</span><span class="ident" id="6394166">Writer</span><span class="op" id="6394172">)</span>&nbsp;<span class="ident" id="6394174">splitUSTARLongName</span><span class="op" id="6394192">(</span><span class="ident" id="6394193">name</span>&nbsp;<span class="builtintype" id="6394198">string</span><span class="op" id="6394204">)</span>&nbsp;<span class="op" id="6394206">(</span><span class="ident" id="6394207">prefix</span><span class="op" id="6394213">,</span>&nbsp;<span class="ident" id="6394215">suffix</span>&nbsp;<span class="builtintype" id="6394222">string</span><span class="op" id="6394228">,</span>&nbsp;<span class="ident" id="6394230">err</span>&nbsp;<span class="builtintype" id="6394234">error</span><span class="op" id="6394239">)</span>&nbsp;<span class="op" id="6394241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394244">length</span>&nbsp;<span class="op" id="6394251">:=</span>&nbsp;<span class="builtinfunc" id="6394254">len</span><span class="op" id="6394257">(</span><span class="ident" id="6394258">name</span><span class="op" id="6394262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6394265">if</span>&nbsp;<span class="ident" id="6394268">length</span>&nbsp;<span class="op" id="6394275">&gt;</span>&nbsp;<span class="ident" id="6394277">fileNamePrefixSize</span><span class="op" id="6394295">+</span><span class="num" id="6394296">1</span>&nbsp;<span class="op" id="6394298">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394302">length</span>&nbsp;<span class="op" id="6394309">=</span>&nbsp;<span class="ident" id="6394311">fileNamePrefixSize</span>&nbsp;<span class="op" id="6394330">+</span>&nbsp;<span class="num" id="6394332">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6394335">}</span>&nbsp;<span class="keyword" id="6394337">else</span>&nbsp;<span class="keyword" id="6394342">if</span>&nbsp;<span class="ident" id="6394345">name</span><span class="op" id="6394349">[</span><span class="ident" id="6394350">length</span><span class="op" id="6394356">-</span><span class="num" id="6394357">1</span><span class="op" id="6394358">]</span>&nbsp;<span class="op" id="6394360">==</span>&nbsp;<span class="string" id="6394363">&#39;/&#39;</span>&nbsp;<span class="op" id="6394367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394371">length</span><span class="op" id="6394377">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6394381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394384">i</span>&nbsp;<span class="op" id="6394386">:=</span>&nbsp;<span class="ident" id="6394389">strings</span><span class="op" id="6394396">.</span><span class="ident" id="6394397">LastIndex</span><span class="op" id="6394406">(</span><span class="ident" id="6394407">name</span><span class="op" id="6394411">[</span><span class="op" id="6394412">:</span><span class="ident" id="6394413">length</span><span class="op" id="6394419">]</span><span class="op" id="6394420">,</span>&nbsp;<span class="string" id="6394422">&#34;/&#34;</span><span class="op" id="6394425">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6394428">//&nbsp;nlen&nbsp;contains&nbsp;the&nbsp;resulting&nbsp;length&nbsp;in&nbsp;the&nbsp;name&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6394486">//&nbsp;plen&nbsp;contains&nbsp;the&nbsp;resulting&nbsp;length&nbsp;in&nbsp;the&nbsp;prefix&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394546">nlen</span>&nbsp;<span class="op" id="6394551">:=</span>&nbsp;<span class="builtinfunc" id="6394554">len</span><span class="op" id="6394557">(</span><span class="ident" id="6394558">name</span><span class="op" id="6394562">)</span>&nbsp;<span class="op" id="6394564">-</span>&nbsp;<span class="ident" id="6394566">i</span>&nbsp;<span class="op" id="6394568">-</span>&nbsp;<span class="num" id="6394570">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394573">plen</span>&nbsp;<span class="op" id="6394578">:=</span>&nbsp;<span class="ident" id="6394581">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6394584">if</span>&nbsp;<span class="ident" id="6394587">i</span>&nbsp;<span class="op" id="6394589">&lt;=</span>&nbsp;<span class="num" id="6394592">0</span>&nbsp;<span class="op" id="6394594">||</span>&nbsp;<span class="ident" id="6394597">nlen</span>&nbsp;<span class="op" id="6394602">&gt;</span>&nbsp;<span class="ident" id="6394604">fileNameSize</span>&nbsp;<span class="op" id="6394617">||</span>&nbsp;<span class="ident" id="6394620">nlen</span>&nbsp;<span class="op" id="6394625">==</span>&nbsp;<span class="num" id="6394628">0</span>&nbsp;<span class="op" id="6394630">||</span>&nbsp;<span class="ident" id="6394633">plen</span>&nbsp;<span class="op" id="6394638">&gt;</span>&nbsp;<span class="ident" id="6394640">fileNamePrefixSize</span>&nbsp;<span class="op" id="6394659">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394663">err</span>&nbsp;<span class="op" id="6394667">=</span>&nbsp;<span class="ident" id="6394669">errNameTooLong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6394686">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6394694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394697">prefix</span><span class="op" id="6394703">,</span>&nbsp;<span class="ident" id="6394705">suffix</span>&nbsp;<span class="op" id="6394712">=</span>&nbsp;<span class="ident" id="6394714">name</span><span class="op" id="6394718">[</span><span class="op" id="6394719">:</span><span class="ident" id="6394720">i</span><span class="op" id="6394721">]</span><span class="op" id="6394722">,</span>&nbsp;<span class="ident" id="6394724">name</span><span class="op" id="6394728">[</span><span class="ident" id="6394729">i</span><span class="op" id="6394730">+</span><span class="num" id="6394731">1</span><span class="op" id="6394732">:</span><span class="op" id="6394733">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6394736">return</span><br>
<span class="lineno">295</span><span class="op" id="6394743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6394746">//&nbsp;writePaxHeader&nbsp;writes&nbsp;an&nbsp;extended&nbsp;pax&nbsp;header&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6394801">//&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6394813">func</span>&nbsp;<span class="op" id="6394818">(</span><span class="ident" id="6394819">tw</span>&nbsp;<span class="op" id="6394822">*</span><span class="ident" id="6394823">Writer</span><span class="op" id="6394829">)</span>&nbsp;<span class="ident" id="6394831">writePAXHeader</span><span class="op" id="6394845">(</span><span class="ident" id="6394846">hdr</span>&nbsp;<span class="op" id="6394850">*</span><span class="ident" id="6394851">Header</span><span class="op" id="6394857">,</span>&nbsp;<span class="ident" id="6394859">paxHeaders</span>&nbsp;<span class="keyword" id="6394870">map</span><span class="op" id="6394873">[</span><span class="builtintype" id="6394874">string</span><span class="op" id="6394880">]</span><span class="builtintype" id="6394881">string</span><span class="op" id="6394887">)</span>&nbsp;<span class="builtintype" id="6394889">error</span>&nbsp;<span class="op" id="6394895">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6394898">//&nbsp;Prepare&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394926">ext</span>&nbsp;<span class="op" id="6394930">:=</span>&nbsp;<span class="builtinfunc" id="6394933">new</span><span class="op" id="6394936">(</span><span class="ident" id="6394937">Header</span><span class="op" id="6394943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394946">ext</span><span class="op" id="6394949">.</span><span class="ident" id="6394950">Typeflag</span>&nbsp;<span class="op" id="6394959">=</span>&nbsp;<span class="ident" id="6394961">TypeXHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6394974">//&nbsp;Setting&nbsp;ModTime&nbsp;is&nbsp;required&nbsp;for&nbsp;reader&nbsp;parsing&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6395028">//&nbsp;succeed,&nbsp;and&nbsp;seems&nbsp;harmless&nbsp;enough.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395068">ext</span><span class="op" id="6395071">.</span><span class="ident" id="6395072">ModTime</span>&nbsp;<span class="op" id="6395080">=</span>&nbsp;<span class="ident" id="6395082">hdr</span><span class="op" id="6395085">.</span><span class="ident" id="6395086">ModTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6395095">//&nbsp;The&nbsp;spec&nbsp;asks&nbsp;that&nbsp;we&nbsp;namespace&nbsp;our&nbsp;pseudo&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6395148">//&nbsp;with&nbsp;the&nbsp;current&nbsp;pid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395174">pid</span>&nbsp;<span class="op" id="6395178">:=</span>&nbsp;<span class="ident" id="6395181">os</span><span class="op" id="6395183">.</span><span class="ident" id="6395184">Getpid</span><span class="op" id="6395190">(</span><span class="op" id="6395191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395194">dir</span><span class="op" id="6395197">,</span>&nbsp;<span class="ident" id="6395199">file</span>&nbsp;<span class="op" id="6395204">:=</span>&nbsp;<span class="ident" id="6395207">path</span><span class="op" id="6395211">.</span><span class="ident" id="6395212">Split</span><span class="op" id="6395217">(</span><span class="ident" id="6395218">hdr</span><span class="op" id="6395221">.</span><span class="ident" id="6395222">Name</span><span class="op" id="6395226">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395229">fullName</span>&nbsp;<span class="op" id="6395238">:=</span>&nbsp;<span class="ident" id="6395241">path</span><span class="op" id="6395245">.</span><span class="ident" id="6395246">Join</span><span class="op" id="6395250">(</span><span class="ident" id="6395251">dir</span><span class="op" id="6395254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395258">fmt</span><span class="op" id="6395261">.</span><span class="ident" id="6395262">Sprintf</span><span class="op" id="6395269">(</span><span class="string" id="6395270">&#34;PaxHeaders.%d&#34;</span><span class="op" id="6395285">,</span>&nbsp;<span class="ident" id="6395287">pid</span><span class="op" id="6395290">)</span><span class="op" id="6395291">,</span>&nbsp;<span class="ident" id="6395293">file</span><span class="op" id="6395297">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395301">ascii</span>&nbsp;<span class="op" id="6395307">:=</span>&nbsp;<span class="ident" id="6395310">toASCII</span><span class="op" id="6395317">(</span><span class="ident" id="6395318">fullName</span><span class="op" id="6395326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6395329">if</span>&nbsp;<span class="builtinfunc" id="6395332">len</span><span class="op" id="6395335">(</span><span class="ident" id="6395336">ascii</span><span class="op" id="6395341">)</span>&nbsp;<span class="op" id="6395343">&gt;</span>&nbsp;<span class="num" id="6395345">100</span>&nbsp;<span class="op" id="6395349">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395353">ascii</span>&nbsp;<span class="op" id="6395359">=</span>&nbsp;<span class="ident" id="6395361">ascii</span><span class="op" id="6395366">[</span><span class="op" id="6395367">:</span><span class="num" id="6395368">100</span><span class="op" id="6395371">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6395374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395377">ext</span><span class="op" id="6395380">.</span><span class="ident" id="6395381">Name</span>&nbsp;<span class="op" id="6395386">=</span>&nbsp;<span class="ident" id="6395388">ascii</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6395395">//&nbsp;Construct&nbsp;the&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6395418">var</span>&nbsp;<span class="ident" id="6395422">buf</span>&nbsp;<span class="ident" id="6395426">bytes</span><span class="op" id="6395431">.</span><span class="ident" id="6395432">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6395441">for</span>&nbsp;<span class="ident" id="6395445">k</span><span class="op" id="6395446">,</span>&nbsp;<span class="ident" id="6395448">v</span>&nbsp;<span class="op" id="6395450">:=</span>&nbsp;<span class="keyword" id="6395453">range</span>&nbsp;<span class="ident" id="6395459">paxHeaders</span>&nbsp;<span class="op" id="6395470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395474">fmt</span><span class="op" id="6395477">.</span><span class="ident" id="6395478">Fprint</span><span class="op" id="6395484">(</span><span class="op" id="6395485">&amp;</span><span class="ident" id="6395486">buf</span><span class="op" id="6395489">,</span>&nbsp;<span class="ident" id="6395491">paxHeader</span><span class="op" id="6395500">(</span><span class="ident" id="6395501">k</span><span class="op" id="6395502">+</span><span class="string" id="6395503">&#34;=&#34;</span><span class="op" id="6395506">+</span><span class="ident" id="6395507">v</span><span class="op" id="6395508">)</span><span class="op" id="6395509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6395512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395516">ext</span><span class="op" id="6395519">.</span><span class="ident" id="6395520">Size</span>&nbsp;<span class="op" id="6395525">=</span>&nbsp;<span class="ident" id="6395527">int64</span><span class="op" id="6395532">(</span><span class="builtinfunc" id="6395533">len</span><span class="op" id="6395536">(</span><span class="ident" id="6395537">buf</span><span class="op" id="6395540">.</span><span class="ident" id="6395541">Bytes</span><span class="op" id="6395546">(</span><span class="op" id="6395547">)</span><span class="op" id="6395548">)</span><span class="op" id="6395549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6395552">if</span>&nbsp;<span class="ident" id="6395555">err</span>&nbsp;<span class="op" id="6395559">:=</span>&nbsp;<span class="ident" id="6395562">tw</span><span class="op" id="6395564">.</span><span class="ident" id="6395565">writeHeader</span><span class="op" id="6395576">(</span><span class="ident" id="6395577">ext</span><span class="op" id="6395580">,</span>&nbsp;<span class="builtintype" id="6395582">false</span><span class="op" id="6395587">)</span><span class="op" id="6395588">;</span>&nbsp;<span class="ident" id="6395590">err</span>&nbsp;<span class="op" id="6395594">!=</span>&nbsp;<span class="builtintype" id="6395597">nil</span>&nbsp;<span class="op" id="6395601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6395605">return</span>&nbsp;<span class="ident" id="6395612">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6395617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6395620">if</span>&nbsp;<span class="ident" id="6395623">_</span><span class="op" id="6395624">,</span>&nbsp;<span class="ident" id="6395626">err</span>&nbsp;<span class="op" id="6395630">:=</span>&nbsp;<span class="ident" id="6395633">tw</span><span class="op" id="6395635">.</span><span class="ident" id="6395636">Write</span><span class="op" id="6395641">(</span><span class="ident" id="6395642">buf</span><span class="op" id="6395645">.</span><span class="ident" id="6395646">Bytes</span><span class="op" id="6395651">(</span><span class="op" id="6395652">)</span><span class="op" id="6395653">)</span><span class="op" id="6395654">;</span>&nbsp;<span class="ident" id="6395656">err</span>&nbsp;<span class="op" id="6395660">!=</span>&nbsp;<span class="builtintype" id="6395663">nil</span>&nbsp;<span class="op" id="6395667">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6395671">return</span>&nbsp;<span class="ident" id="6395678">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6395683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6395686">if</span>&nbsp;<span class="ident" id="6395689">err</span>&nbsp;<span class="op" id="6395693">:=</span>&nbsp;<span class="ident" id="6395696">tw</span><span class="op" id="6395698">.</span><span class="ident" id="6395699">Flush</span><span class="op" id="6395704">(</span><span class="op" id="6395705">)</span><span class="op" id="6395706">;</span>&nbsp;<span class="ident" id="6395708">err</span>&nbsp;<span class="op" id="6395712">!=</span>&nbsp;<span class="builtintype" id="6395715">nil</span>&nbsp;<span class="op" id="6395719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6395723">return</span>&nbsp;<span class="ident" id="6395730">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6395735">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6395738">return</span>&nbsp;<span class="builtintype" id="6395745">nil</span><br>
<span class="lineno"></span><span class="op" id="6395749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6395752">//&nbsp;paxHeader&nbsp;formats&nbsp;a&nbsp;single&nbsp;pax&nbsp;record,&nbsp;prefixing&nbsp;it&nbsp;with&nbsp;the&nbsp;appropriate&nbsp;length</span><br>
<span class="lineno"></span><span class="keyword" id="6395835">func</span>&nbsp;<span class="ident" id="6395840">paxHeader</span><span class="op" id="6395849">(</span><span class="ident" id="6395850">msg</span>&nbsp;<span class="builtintype" id="6395854">string</span><span class="op" id="6395860">)</span>&nbsp;<span class="builtintype" id="6395862">string</span>&nbsp;<span class="op" id="6395869">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6395872">const</span>&nbsp;<span class="ident" id="6395878">padding</span>&nbsp;<span class="op" id="6395886">=</span>&nbsp;<span class="num" id="6395888">2</span>&nbsp;<span class="comment" id="6395890">//&nbsp;Extra&nbsp;padding&nbsp;for&nbsp;space&nbsp;and&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395930">size</span>&nbsp;<span class="op" id="6395935">:=</span>&nbsp;<span class="builtinfunc" id="6395938">len</span><span class="op" id="6395941">(</span><span class="ident" id="6395942">msg</span><span class="op" id="6395945">)</span>&nbsp;<span class="op" id="6395947">+</span>&nbsp;<span class="ident" id="6395949">padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395958">size</span>&nbsp;<span class="op" id="6395963">+=</span>&nbsp;<span class="builtinfunc" id="6395966">len</span><span class="op" id="6395969">(</span><span class="ident" id="6395970">strconv</span><span class="op" id="6395977">.</span><span class="ident" id="6395978">Itoa</span><span class="op" id="6395982">(</span><span class="ident" id="6395983">size</span><span class="op" id="6395987">)</span><span class="op" id="6395988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6395991">record</span>&nbsp;<span class="op" id="6395998">:=</span>&nbsp;<span class="ident" id="6396001">fmt</span><span class="op" id="6396004">.</span><span class="ident" id="6396005">Sprintf</span><span class="op" id="6396012">(</span><span class="string" id="6396013">&#34;%d&nbsp;%s\n&#34;</span><span class="op" id="6396022">,</span>&nbsp;<span class="ident" id="6396024">size</span><span class="op" id="6396028">,</span>&nbsp;<span class="ident" id="6396030">msg</span><span class="op" id="6396033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396036">if</span>&nbsp;<span class="builtinfunc" id="6396039">len</span><span class="op" id="6396042">(</span><span class="ident" id="6396043">record</span><span class="op" id="6396049">)</span>&nbsp;<span class="op" id="6396051">!=</span>&nbsp;<span class="ident" id="6396054">size</span>&nbsp;<span class="op" id="6396059">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6396063">//&nbsp;Final&nbsp;adjustment&nbsp;if&nbsp;adding&nbsp;size&nbsp;increased</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6396110">//&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;in&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396144">size</span>&nbsp;<span class="op" id="6396149">=</span>&nbsp;<span class="builtinfunc" id="6396151">len</span><span class="op" id="6396154">(</span><span class="ident" id="6396155">record</span><span class="op" id="6396161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396165">record</span>&nbsp;<span class="op" id="6396172">=</span>&nbsp;<span class="ident" id="6396174">fmt</span><span class="op" id="6396177">.</span><span class="ident" id="6396178">Sprintf</span><span class="op" id="6396185">(</span><span class="string" id="6396186">&#34;%d&nbsp;%s\n&#34;</span><span class="op" id="6396195">,</span>&nbsp;<span class="ident" id="6396197">size</span><span class="op" id="6396201">,</span>&nbsp;<span class="ident" id="6396203">msg</span><span class="op" id="6396206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6396209">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396212">return</span>&nbsp;<span class="ident" id="6396219">record</span><br>
<span class="lineno"></span><span class="op" id="6396226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6396229">//&nbsp;Write&nbsp;writes&nbsp;to&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="6396286">//&nbsp;Write&nbsp;returns&nbsp;the&nbsp;error&nbsp;ErrWriteTooLong&nbsp;if&nbsp;more&nbsp;than</span><br>
<span class="lineno">355</span><span class="comment" id="6396342">//&nbsp;hdr.Size&nbsp;bytes&nbsp;are&nbsp;written&nbsp;after&nbsp;WriteHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="6396391">func</span>&nbsp;<span class="op" id="6396396">(</span><span class="ident" id="6396397">tw</span>&nbsp;<span class="op" id="6396400">*</span><span class="ident" id="6396401">Writer</span><span class="op" id="6396407">)</span>&nbsp;<span class="ident" id="6396409">Write</span><span class="op" id="6396414">(</span><span class="ident" id="6396415">b</span>&nbsp;<span class="op" id="6396417">[</span><span class="op" id="6396418">]</span><span class="builtintype" id="6396419">byte</span><span class="op" id="6396423">)</span>&nbsp;<span class="op" id="6396425">(</span><span class="ident" id="6396426">n</span>&nbsp;<span class="builtintype" id="6396428">int</span><span class="op" id="6396431">,</span>&nbsp;<span class="ident" id="6396433">err</span>&nbsp;<span class="builtintype" id="6396437">error</span><span class="op" id="6396442">)</span>&nbsp;<span class="op" id="6396444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396447">if</span>&nbsp;<span class="ident" id="6396450">tw</span><span class="op" id="6396452">.</span><span class="ident" id="6396453">closed</span>&nbsp;<span class="op" id="6396460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396464">err</span>&nbsp;<span class="op" id="6396468">=</span>&nbsp;<span class="ident" id="6396470">ErrWriteTooLong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396488">return</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6396496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396499">overwrite</span>&nbsp;<span class="op" id="6396509">:=</span>&nbsp;<span class="builtintype" id="6396512">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396519">if</span>&nbsp;<span class="ident" id="6396522">int64</span><span class="op" id="6396527">(</span><span class="builtinfunc" id="6396528">len</span><span class="op" id="6396531">(</span><span class="ident" id="6396532">b</span><span class="op" id="6396533">)</span><span class="op" id="6396534">)</span>&nbsp;<span class="op" id="6396536">&gt;</span>&nbsp;<span class="ident" id="6396538">tw</span><span class="op" id="6396540">.</span><span class="ident" id="6396541">nb</span>&nbsp;<span class="op" id="6396544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396548">b</span>&nbsp;<span class="op" id="6396550">=</span>&nbsp;<span class="ident" id="6396552">b</span><span class="op" id="6396553">[</span><span class="num" id="6396554">0</span><span class="op" id="6396555">:</span><span class="ident" id="6396556">tw</span><span class="op" id="6396558">.</span><span class="ident" id="6396559">nb</span><span class="op" id="6396561">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396565">overwrite</span>&nbsp;<span class="op" id="6396575">=</span>&nbsp;<span class="builtintype" id="6396577">true</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6396583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396586">n</span><span class="op" id="6396587">,</span>&nbsp;<span class="ident" id="6396589">err</span>&nbsp;<span class="op" id="6396593">=</span>&nbsp;<span class="ident" id="6396595">tw</span><span class="op" id="6396597">.</span><span class="ident" id="6396598">w</span><span class="op" id="6396599">.</span><span class="ident" id="6396600">Write</span><span class="op" id="6396605">(</span><span class="ident" id="6396606">b</span><span class="op" id="6396607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396610">tw</span><span class="op" id="6396612">.</span><span class="ident" id="6396613">nb</span>&nbsp;<span class="op" id="6396616">-=</span>&nbsp;<span class="ident" id="6396619">int64</span><span class="op" id="6396624">(</span><span class="ident" id="6396625">n</span><span class="op" id="6396626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396629">if</span>&nbsp;<span class="ident" id="6396632">err</span>&nbsp;<span class="op" id="6396636">==</span>&nbsp;<span class="builtintype" id="6396639">nil</span>&nbsp;<span class="op" id="6396643">&amp;&amp;</span>&nbsp;<span class="ident" id="6396646">overwrite</span>&nbsp;<span class="op" id="6396656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396660">err</span>&nbsp;<span class="op" id="6396664">=</span>&nbsp;<span class="ident" id="6396666">ErrWriteTooLong</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396684">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6396692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396695">tw</span><span class="op" id="6396697">.</span><span class="ident" id="6396698">err</span>&nbsp;<span class="op" id="6396702">=</span>&nbsp;<span class="ident" id="6396704">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396709">return</span><br>
<span class="lineno"></span><span class="op" id="6396716">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="6396719">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;flushing&nbsp;any&nbsp;unwritten</span><br>
<span class="lineno"></span><span class="comment" id="6396775">//&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6396809">func</span>&nbsp;<span class="op" id="6396814">(</span><span class="ident" id="6396815">tw</span>&nbsp;<span class="op" id="6396818">*</span><span class="ident" id="6396819">Writer</span><span class="op" id="6396825">)</span>&nbsp;<span class="ident" id="6396827">Close</span><span class="op" id="6396832">(</span><span class="op" id="6396833">)</span>&nbsp;<span class="builtintype" id="6396835">error</span>&nbsp;<span class="op" id="6396841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396844">if</span>&nbsp;<span class="ident" id="6396847">tw</span><span class="op" id="6396849">.</span><span class="ident" id="6396850">err</span>&nbsp;<span class="op" id="6396854">!=</span>&nbsp;<span class="builtintype" id="6396857">nil</span>&nbsp;<span class="op" id="6396861">||</span>&nbsp;<span class="ident" id="6396864">tw</span><span class="op" id="6396866">.</span><span class="ident" id="6396867">closed</span>&nbsp;<span class="op" id="6396874">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396878">return</span>&nbsp;<span class="ident" id="6396885">tw</span><span class="op" id="6396887">.</span><span class="ident" id="6396888">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6396893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396896">tw</span><span class="op" id="6396898">.</span><span class="ident" id="6396899">Flush</span><span class="op" id="6396904">(</span><span class="op" id="6396905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6396908">tw</span><span class="op" id="6396910">.</span><span class="ident" id="6396911">closed</span>&nbsp;<span class="op" id="6396918">=</span>&nbsp;<span class="builtintype" id="6396920">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396926">if</span>&nbsp;<span class="ident" id="6396929">tw</span><span class="op" id="6396931">.</span><span class="ident" id="6396932">err</span>&nbsp;<span class="op" id="6396936">!=</span>&nbsp;<span class="builtintype" id="6396939">nil</span>&nbsp;<span class="op" id="6396943">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396947">return</span>&nbsp;<span class="ident" id="6396954">tw</span><span class="op" id="6396956">.</span><span class="ident" id="6396957">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6396962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6396966">//&nbsp;trailer:&nbsp;two&nbsp;zero&nbsp;blocks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6396995">for</span>&nbsp;<span class="ident" id="6396999">i</span>&nbsp;<span class="op" id="6397001">:=</span>&nbsp;<span class="num" id="6397004">0</span><span class="op" id="6397005">;</span>&nbsp;<span class="ident" id="6397007">i</span>&nbsp;<span class="op" id="6397009">&lt;</span>&nbsp;<span class="num" id="6397011">2</span><span class="op" id="6397012">;</span>&nbsp;<span class="ident" id="6397014">i</span><span class="op" id="6397015">++</span>&nbsp;<span class="op" id="6397018">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6397022">_</span><span class="op" id="6397023">,</span>&nbsp;<span class="ident" id="6397025">tw</span><span class="op" id="6397027">.</span><span class="ident" id="6397028">err</span>&nbsp;<span class="op" id="6397032">=</span>&nbsp;<span class="ident" id="6397034">tw</span><span class="op" id="6397036">.</span><span class="ident" id="6397037">w</span><span class="op" id="6397038">.</span><span class="ident" id="6397039">Write</span><span class="op" id="6397044">(</span><span class="ident" id="6397045">zeroBlock</span><span class="op" id="6397054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6397058">if</span>&nbsp;<span class="ident" id="6397061">tw</span><span class="op" id="6397063">.</span><span class="ident" id="6397064">err</span>&nbsp;<span class="op" id="6397068">!=</span>&nbsp;<span class="builtintype" id="6397071">nil</span>&nbsp;<span class="op" id="6397075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6397080">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6397088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6397091">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6397094">return</span>&nbsp;<span class="ident" id="6397101">tw</span><span class="op" id="6397103">.</span><span class="ident" id="6397104">err</span><br>
<span class="lineno"></span><span class="op" id="6397108">}</span>
</div>
</body>
</html>
