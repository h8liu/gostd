<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1570155">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1570210">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1570264">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1570315">//&nbsp;+build&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1570332">package</span>&nbsp;<span class="ident" id="1570340">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1570349">import</span>&nbsp;<span class="string" id="1570356">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1570366">func</span>&nbsp;<span class="ident" id="1570371">epollcreate</span><span class="op" id="1570382">(</span><span class="ident" id="1570383">size</span>&nbsp;<span class="builtintype" id="1570388">int32</span><span class="op" id="1570393">)</span>&nbsp;<span class="builtintype" id="1570395">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1570401">func</span>&nbsp;<span class="ident" id="1570406">epollcreate1</span><span class="op" id="1570418">(</span><span class="ident" id="1570419">flags</span>&nbsp;<span class="builtintype" id="1570425">int32</span><span class="op" id="1570430">)</span>&nbsp;<span class="builtintype" id="1570432">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1570439">//go:noescape</span><br>
<span class="lineno">15</span><span class="keyword" id="1570453">func</span>&nbsp;<span class="ident" id="1570458">epollctl</span><span class="op" id="1570466">(</span><span class="ident" id="1570467">epfd</span><span class="op" id="1570471">,</span>&nbsp;<span class="ident" id="1570473">op</span><span class="op" id="1570475">,</span>&nbsp;<span class="ident" id="1570477">fd</span>&nbsp;<span class="builtintype" id="1570480">int32</span><span class="op" id="1570485">,</span>&nbsp;<span class="ident" id="1570487">ev</span>&nbsp;<span class="op" id="1570490">*</span><span class="ident" id="1570491">epollevent</span><span class="op" id="1570501">)</span>&nbsp;<span class="builtintype" id="1570503">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1570510">//go:noescape</span><br>
<span class="lineno"></span><span class="keyword" id="1570524">func</span>&nbsp;<span class="ident" id="1570529">epollwait</span><span class="op" id="1570538">(</span><span class="ident" id="1570539">epfd</span>&nbsp;<span class="builtintype" id="1570544">int32</span><span class="op" id="1570549">,</span>&nbsp;<span class="ident" id="1570551">ev</span>&nbsp;<span class="op" id="1570554">*</span><span class="ident" id="1570555">epollevent</span><span class="op" id="1570565">,</span>&nbsp;<span class="ident" id="1570567">nev</span><span class="op" id="1570570">,</span>&nbsp;<span class="ident" id="1570572">timeout</span>&nbsp;<span class="builtintype" id="1570580">int32</span><span class="op" id="1570585">)</span>&nbsp;<span class="builtintype" id="1570587">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1570593">func</span>&nbsp;<span class="ident" id="1570598">closeonexec</span><span class="op" id="1570609">(</span><span class="ident" id="1570610">fd</span>&nbsp;<span class="builtintype" id="1570613">int32</span><span class="op" id="1570618">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1570621">var</span>&nbsp;<span class="op" id="1570625">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570628">epfd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1570643">int32</span>&nbsp;<span class="op" id="1570649">=</span>&nbsp;<span class="op" id="1570651">-</span><span class="num" id="1570652">1</span>&nbsp;<span class="comment" id="1570654">//&nbsp;epoll&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570675">netpolllasterr</span>&nbsp;<span class="builtintype" id="1570690">int32</span><br>
<span class="lineno"></span><span class="op" id="1570696">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="1570699">func</span>&nbsp;<span class="ident" id="1570704">netpollinit</span><span class="op" id="1570715">(</span><span class="op" id="1570716">)</span>&nbsp;<span class="op" id="1570718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570721">epfd</span>&nbsp;<span class="op" id="1570726">=</span>&nbsp;<span class="ident" id="1570728">epollcreate1</span><span class="op" id="1570740">(</span><span class="ident" id="1570741">_EPOLL_CLOEXEC</span><span class="op" id="1570755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570758">if</span>&nbsp;<span class="ident" id="1570761">epfd</span>&nbsp;<span class="op" id="1570766">&gt;=</span>&nbsp;<span class="num" id="1570769">0</span>&nbsp;<span class="op" id="1570771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570775">return</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1570783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570786">epfd</span>&nbsp;<span class="op" id="1570791">=</span>&nbsp;<span class="ident" id="1570793">epollcreate</span><span class="op" id="1570804">(</span><span class="num" id="1570805">1024</span><span class="op" id="1570809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570812">if</span>&nbsp;<span class="ident" id="1570815">epfd</span>&nbsp;<span class="op" id="1570820">&gt;=</span>&nbsp;<span class="num" id="1570823">0</span>&nbsp;<span class="op" id="1570825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570829">closeonexec</span><span class="op" id="1570840">(</span><span class="ident" id="1570841">epfd</span><span class="op" id="1570845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570849">return</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1570857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1570860">println</span><span class="op" id="1570867">(</span><span class="string" id="1570868">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;epoll&nbsp;descriptor&#34;</span><span class="op" id="1570916">,</span>&nbsp;<span class="op" id="1570918">-</span><span class="ident" id="1570919">epfd</span><span class="op" id="1570923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570926">gothrow</span><span class="op" id="1570933">(</span><span class="string" id="1570934">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;descriptor&#34;</span><span class="op" id="1570976">)</span><br>
<span class="lineno"></span><span class="op" id="1570978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="1570981">func</span>&nbsp;<span class="ident" id="1570986">netpollopen</span><span class="op" id="1570997">(</span><span class="ident" id="1570998">fd</span>&nbsp;<span class="builtintype" id="1571001">uintptr</span><span class="op" id="1571008">,</span>&nbsp;<span class="ident" id="1571010">pd</span>&nbsp;<span class="op" id="1571013">*</span><span class="ident" id="1571014">pollDesc</span><span class="op" id="1571022">)</span>&nbsp;<span class="builtintype" id="1571024">int32</span>&nbsp;<span class="op" id="1571030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1571033">var</span>&nbsp;<span class="ident" id="1571037">ev</span>&nbsp;<span class="ident" id="1571040">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1571052">ev</span><span class="op" id="1571054">.</span><span class="ident" id="1571055">events</span>&nbsp;<span class="op" id="1571062">=</span>&nbsp;<span class="ident" id="1571064">_EPOLLIN</span>&nbsp;<span class="op" id="1571073">|</span>&nbsp;<span class="ident" id="1571075">_EPOLLOUT</span>&nbsp;<span class="op" id="1571085">|</span>&nbsp;<span class="ident" id="1571087">_EPOLLRDHUP</span>&nbsp;<span class="op" id="1571099">|</span>&nbsp;<span class="ident" id="1571101">_EPOLLET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1571111">*</span><span class="op" id="1571112">(</span><span class="op" id="1571113">*</span><span class="op" id="1571114">*</span><span class="ident" id="1571115">pollDesc</span><span class="op" id="1571123">)</span><span class="op" id="1571124">(</span><span class="ident" id="1571125">unsafe</span><span class="op" id="1571131">.</span><span class="ident" id="1571132">Pointer</span><span class="op" id="1571139">(</span><span class="op" id="1571140">&amp;</span><span class="ident" id="1571141">ev</span><span class="op" id="1571143">.</span><span class="ident" id="1571144">data</span><span class="op" id="1571148">)</span><span class="op" id="1571149">)</span>&nbsp;<span class="op" id="1571151">=</span>&nbsp;<span class="ident" id="1571153">pd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1571157">return</span>&nbsp;<span class="op" id="1571164">-</span><span class="ident" id="1571165">epollctl</span><span class="op" id="1571173">(</span><span class="ident" id="1571174">epfd</span><span class="op" id="1571178">,</span>&nbsp;<span class="ident" id="1571180">_EPOLL_CTL_ADD</span><span class="op" id="1571194">,</span>&nbsp;<span class="builtintype" id="1571196">int32</span><span class="op" id="1571201">(</span><span class="ident" id="1571202">fd</span><span class="op" id="1571204">)</span><span class="op" id="1571205">,</span>&nbsp;<span class="op" id="1571207">&amp;</span><span class="ident" id="1571208">ev</span><span class="op" id="1571210">)</span><br>
<span class="lineno">45</span><span class="op" id="1571212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1571215">func</span>&nbsp;<span class="ident" id="1571220">netpollclose</span><span class="op" id="1571232">(</span><span class="ident" id="1571233">fd</span>&nbsp;<span class="builtintype" id="1571236">uintptr</span><span class="op" id="1571243">)</span>&nbsp;<span class="builtintype" id="1571245">int32</span>&nbsp;<span class="op" id="1571251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1571254">var</span>&nbsp;<span class="ident" id="1571258">ev</span>&nbsp;<span class="ident" id="1571261">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1571273">return</span>&nbsp;<span class="op" id="1571280">-</span><span class="ident" id="1571281">epollctl</span><span class="op" id="1571289">(</span><span class="ident" id="1571290">epfd</span><span class="op" id="1571294">,</span>&nbsp;<span class="ident" id="1571296">_EPOLL_CTL_DEL</span><span class="op" id="1571310">,</span>&nbsp;<span class="builtintype" id="1571312">int32</span><span class="op" id="1571317">(</span><span class="ident" id="1571318">fd</span><span class="op" id="1571320">)</span><span class="op" id="1571321">,</span>&nbsp;<span class="op" id="1571323">&amp;</span><span class="ident" id="1571324">ev</span><span class="op" id="1571326">)</span><br>
<span class="lineno">50</span><span class="op" id="1571328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1571331">func</span>&nbsp;<span class="ident" id="1571336">netpollarm</span><span class="op" id="1571346">(</span><span class="ident" id="1571347">pd</span>&nbsp;<span class="op" id="1571350">*</span><span class="ident" id="1571351">pollDesc</span><span class="op" id="1571359">,</span>&nbsp;<span class="ident" id="1571361">mode</span>&nbsp;<span class="builtintype" id="1571366">int</span><span class="op" id="1571369">)</span>&nbsp;<span class="op" id="1571371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1571374">gothrow</span><span class="op" id="1571381">(</span><span class="string" id="1571382">&#34;unused&#34;</span><span class="op" id="1571390">)</span><br>
<span class="lineno"></span><span class="op" id="1571392">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="1571395">//&nbsp;polls&nbsp;for&nbsp;ready&nbsp;network&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="1571434">//&nbsp;returns&nbsp;list&nbsp;of&nbsp;goroutines&nbsp;that&nbsp;become&nbsp;runnable</span><br>
<span class="lineno"></span><span class="keyword" id="1571485">func</span>&nbsp;<span class="ident" id="1571490">netpoll</span><span class="op" id="1571497">(</span><span class="ident" id="1571498">block</span>&nbsp;<span class="builtintype" id="1571504">bool</span><span class="op" id="1571508">)</span>&nbsp;<span class="op" id="1571510">(</span><span class="ident" id="1571511">gp</span>&nbsp;<span class="op" id="1571514">*</span><span class="ident" id="1571515">g</span><span class="op" id="1571516">)</span>&nbsp;<span class="op" id="1571518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1571521">if</span>&nbsp;<span class="ident" id="1571524">epfd</span>&nbsp;<span class="op" id="1571529">==</span>&nbsp;<span class="op" id="1571532">-</span><span class="num" id="1571533">1</span>&nbsp;<span class="op" id="1571535">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1571539">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1571547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1571550">waitms</span>&nbsp;<span class="op" id="1571557">:=</span>&nbsp;<span class="builtintype" id="1571560">int32</span><span class="op" id="1571565">(</span><span class="op" id="1571566">-</span><span class="num" id="1571567">1</span><span class="op" id="1571568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1571571">if</span>&nbsp;<span class="op" id="1571574">!</span><span class="ident" id="1571575">block</span>&nbsp;<span class="op" id="1571581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1571585">waitms</span>&nbsp;<span class="op" id="1571592">=</span>&nbsp;<span class="num" id="1571594">0</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1571597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1571600">var</span>&nbsp;<span class="ident" id="1571604">events</span>&nbsp;<span class="op" id="1571611">[</span><span class="num" id="1571612">128</span><span class="op" id="1571615">]</span><span class="ident" id="1571616">epollevent</span><br>
<span class="lineno"></span><span class="ident" id="1571627">retry</span><span class="op" id="1571632">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1571635">n</span>&nbsp;<span class="op" id="1571637">:=</span>&nbsp;<span class="ident" id="1571640">epollwait</span><span class="op" id="1571649">(</span><span class="ident" id="1571650">epfd</span><span class="op" id="1571654">,</span>&nbsp;<span class="op" id="1571656">&amp;</span><span class="ident" id="1571657">events</span><span class="op" id="1571663">[</span><span class="num" id="1571664">0</span><span class="op" id="1571665">]</span><span class="op" id="1571666">,</span>&nbsp;<span class="builtintype" id="1571668">int32</span><span class="op" id="1571673">(</span><span class="builtinfunc" id="1571674">len</span><span class="op" id="1571677">(</span><span class="ident" id="1571678">events</span><span class="op" id="1571684">)</span><span class="op" id="1571685">)</span><span class="op" id="1571686">,</span>&nbsp;<span class="ident" id="1571688">waitms</span><span class="op" id="1571694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1571697">if</span>&nbsp;<span class="ident" id="1571700">n</span>&nbsp;<span class="op" id="1571702">&lt;</span>&nbsp;<span class="num" id="1571704">0</span>&nbsp;<span class="op" id="1571706">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1571710">if</span>&nbsp;<span class="ident" id="1571713">n</span>&nbsp;<span class="op" id="1571715">!=</span>&nbsp;<span class="op" id="1571718">-</span><span class="ident" id="1571719">_EINTR</span>&nbsp;<span class="op" id="1571726">&amp;&amp;</span>&nbsp;<span class="ident" id="1571729">n</span>&nbsp;<span class="op" id="1571731">!=</span>&nbsp;<span class="ident" id="1571734">netpolllasterr</span>&nbsp;<span class="op" id="1571749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1571754">netpolllasterr</span>&nbsp;<span class="op" id="1571769">=</span>&nbsp;<span class="ident" id="1571771">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1571776">println</span><span class="op" id="1571783">(</span><span class="string" id="1571784">&#34;runtime:&nbsp;epollwait&nbsp;on&nbsp;fd&#34;</span><span class="op" id="1571810">,</span>&nbsp;<span class="ident" id="1571812">epfd</span><span class="op" id="1571816">,</span>&nbsp;<span class="string" id="1571818">&#34;failed&nbsp;with&#34;</span><span class="op" id="1571831">,</span>&nbsp;<span class="op" id="1571833">-</span><span class="ident" id="1571834">n</span><span class="op" id="1571835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1571839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1571843">goto</span>&nbsp;<span class="ident" id="1571848">retry</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1571855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1571858">for</span>&nbsp;<span class="ident" id="1571862">i</span>&nbsp;<span class="op" id="1571864">:=</span>&nbsp;<span class="builtintype" id="1571867">int32</span><span class="op" id="1571872">(</span><span class="num" id="1571873">0</span><span class="op" id="1571874">)</span><span class="op" id="1571875">;</span>&nbsp;<span class="ident" id="1571877">i</span>&nbsp;<span class="op" id="1571879">&lt;</span>&nbsp;<span class="ident" id="1571881">n</span><span class="op" id="1571882">;</span>&nbsp;<span class="ident" id="1571884">i</span><span class="op" id="1571885">++</span>&nbsp;<span class="op" id="1571888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1571892">ev</span>&nbsp;<span class="op" id="1571895">:=</span>&nbsp;<span class="op" id="1571898">&amp;</span><span class="ident" id="1571899">events</span><span class="op" id="1571905">[</span><span class="ident" id="1571906">i</span><span class="op" id="1571907">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1571911">if</span>&nbsp;<span class="ident" id="1571914">ev</span><span class="op" id="1571916">.</span><span class="ident" id="1571917">events</span>&nbsp;<span class="op" id="1571924">==</span>&nbsp;<span class="num" id="1571927">0</span>&nbsp;<span class="op" id="1571929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1571934">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1571945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1571949">var</span>&nbsp;<span class="ident" id="1571953">mode</span>&nbsp;<span class="builtintype" id="1571958">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1571966">if</span>&nbsp;<span class="ident" id="1571969">ev</span><span class="op" id="1571971">.</span><span class="ident" id="1571972">events</span><span class="op" id="1571978">&amp;</span><span class="op" id="1571979">(</span><span class="ident" id="1571980">_EPOLLIN</span><span class="op" id="1571988">|</span><span class="ident" id="1571989">_EPOLLRDHUP</span><span class="op" id="1572000">|</span><span class="ident" id="1572001">_EPOLLHUP</span><span class="op" id="1572010">|</span><span class="ident" id="1572011">_EPOLLERR</span><span class="op" id="1572020">)</span>&nbsp;<span class="op" id="1572022">!=</span>&nbsp;<span class="num" id="1572025">0</span>&nbsp;<span class="op" id="1572027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1572032">mode</span>&nbsp;<span class="op" id="1572037">+=</span>&nbsp;<span class="string" id="1572040">&#39;r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1572046">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1572050">if</span>&nbsp;<span class="ident" id="1572053">ev</span><span class="op" id="1572055">.</span><span class="ident" id="1572056">events</span><span class="op" id="1572062">&amp;</span><span class="op" id="1572063">(</span><span class="ident" id="1572064">_EPOLLOUT</span><span class="op" id="1572073">|</span><span class="ident" id="1572074">_EPOLLHUP</span><span class="op" id="1572083">|</span><span class="ident" id="1572084">_EPOLLERR</span><span class="op" id="1572093">)</span>&nbsp;<span class="op" id="1572095">!=</span>&nbsp;<span class="num" id="1572098">0</span>&nbsp;<span class="op" id="1572100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1572105">mode</span>&nbsp;<span class="op" id="1572110">+=</span>&nbsp;<span class="string" id="1572113">&#39;w&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1572119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1572123">if</span>&nbsp;<span class="ident" id="1572126">mode</span>&nbsp;<span class="op" id="1572131">!=</span>&nbsp;<span class="num" id="1572134">0</span>&nbsp;<span class="op" id="1572136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1572141">pd</span>&nbsp;<span class="op" id="1572144">:=</span>&nbsp;<span class="op" id="1572147">*</span><span class="op" id="1572148">(</span><span class="op" id="1572149">*</span><span class="op" id="1572150">*</span><span class="ident" id="1572151">pollDesc</span><span class="op" id="1572159">)</span><span class="op" id="1572160">(</span><span class="ident" id="1572161">unsafe</span><span class="op" id="1572167">.</span><span class="ident" id="1572168">Pointer</span><span class="op" id="1572175">(</span><span class="op" id="1572176">&amp;</span><span class="ident" id="1572177">ev</span><span class="op" id="1572179">.</span><span class="ident" id="1572180">data</span><span class="op" id="1572184">)</span><span class="op" id="1572185">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1572190">netpollready</span><span class="op" id="1572202">(</span><span class="op" id="1572203">(</span><span class="op" id="1572204">*</span><span class="op" id="1572205">*</span><span class="ident" id="1572206">g</span><span class="op" id="1572207">)</span><span class="op" id="1572208">(</span><span class="ident" id="1572209">noescape</span><span class="op" id="1572217">(</span><span class="ident" id="1572218">unsafe</span><span class="op" id="1572224">.</span><span class="ident" id="1572225">Pointer</span><span class="op" id="1572232">(</span><span class="op" id="1572233">&amp;</span><span class="ident" id="1572234">gp</span><span class="op" id="1572236">)</span><span class="op" id="1572237">)</span><span class="op" id="1572238">)</span><span class="op" id="1572239">,</span>&nbsp;<span class="ident" id="1572241">pd</span><span class="op" id="1572243">,</span>&nbsp;<span class="ident" id="1572245">mode</span><span class="op" id="1572249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1572253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1572256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1572259">if</span>&nbsp;<span class="ident" id="1572262">block</span>&nbsp;<span class="op" id="1572268">&amp;&amp;</span>&nbsp;<span class="ident" id="1572271">gp</span>&nbsp;<span class="op" id="1572274">==</span>&nbsp;<span class="ident" id="1572277">nil</span>&nbsp;<span class="op" id="1572281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1572285">goto</span>&nbsp;<span class="ident" id="1572290">retry</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1572297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1572300">return</span>&nbsp;<span class="ident" id="1572307">gp</span><br>
<span class="lineno"></span><span class="op" id="1572310">}</span>
</div>
</body>
</html>
