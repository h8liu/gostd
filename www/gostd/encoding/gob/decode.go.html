<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html" class="current">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5473558">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5473613">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5473667">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5473718">//go:generate&nbsp;go&nbsp;run&nbsp;decgen.go&nbsp;-output&nbsp;dec_helpers.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5473773">package</span>&nbsp;<span class="ident" id="5473781">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5473786">import</span>&nbsp;<span class="op" id="5473793">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5473796">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5473808">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5473818">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5473824">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5473832">&#34;reflect&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5473842">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5473845">var</span>&nbsp;<span class="op" id="5473849">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473852">errBadUint</span>&nbsp;<span class="op" id="5473863">=</span>&nbsp;<span class="ident" id="5473865">errors</span><span class="op" id="5473871">.</span><span class="ident" id="5473872">New</span><span class="op" id="5473875">(</span><span class="string" id="5473876">&#34;gob:&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="5473920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473923">errBadType</span>&nbsp;<span class="op" id="5473934">=</span>&nbsp;<span class="ident" id="5473936">errors</span><span class="op" id="5473942">.</span><span class="ident" id="5473943">New</span><span class="op" id="5473946">(</span><span class="string" id="5473947">&#34;gob:&nbsp;unknown&nbsp;type&nbsp;id&nbsp;or&nbsp;corrupted&nbsp;data&#34;</span><span class="op" id="5473987">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473990">errRange</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5474001">=</span>&nbsp;<span class="ident" id="5474003">errors</span><span class="op" id="5474009">.</span><span class="ident" id="5474010">New</span><span class="op" id="5474013">(</span><span class="string" id="5474014">&#34;gob:&nbsp;bad&nbsp;data:&nbsp;field&nbsp;numbers&nbsp;out&nbsp;of&nbsp;bounds&#34;</span><span class="op" id="5474058">)</span><br>
<span class="lineno"></span><span class="op" id="5474060">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5474063">type</span>&nbsp;<span class="ident" id="5474068">decHelper</span>&nbsp;<span class="keyword" id="5474078">func</span><span class="op" id="5474082">(</span><span class="ident" id="5474083">state</span>&nbsp;<span class="op" id="5474089">*</span><span class="ident" id="5474090">decoderState</span><span class="op" id="5474102">,</span>&nbsp;<span class="ident" id="5474104">v</span>&nbsp;<span class="ident" id="5474106">reflect</span><span class="op" id="5474113">.</span><span class="ident" id="5474114">Value</span><span class="op" id="5474119">,</span>&nbsp;<span class="ident" id="5474121">length</span>&nbsp;<span class="builtintype" id="5474128">int</span><span class="op" id="5474131">,</span>&nbsp;<span class="ident" id="5474133">ovfl</span>&nbsp;<span class="builtintype" id="5474138">error</span><span class="op" id="5474143">)</span>&nbsp;<span class="builtintype" id="5474145">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5474151">//&nbsp;decoderState&nbsp;is&nbsp;the&nbsp;execution&nbsp;state&nbsp;of&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;decoder.&nbsp;A&nbsp;new&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="5474233">//&nbsp;is&nbsp;created&nbsp;for&nbsp;nested&nbsp;objects.</span><br>
<span class="lineno"></span><span class="keyword" id="5474267">type</span>&nbsp;<span class="ident" id="5474272">decoderState</span>&nbsp;<span class="keyword" id="5474285">struct</span>&nbsp;<span class="op" id="5474292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5474295">dec</span>&nbsp;<span class="op" id="5474299">*</span><span class="ident" id="5474300">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5474309">//&nbsp;The&nbsp;buffer&nbsp;is&nbsp;stored&nbsp;with&nbsp;an&nbsp;extra&nbsp;indirection&nbsp;because&nbsp;it&nbsp;may&nbsp;be&nbsp;replaced</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5474387">//&nbsp;if&nbsp;we&nbsp;load&nbsp;a&nbsp;type&nbsp;during&nbsp;decode&nbsp;(when&nbsp;reading&nbsp;an&nbsp;interface&nbsp;value).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5474458">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5474467">*</span><span class="ident" id="5474468">decBuffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5474479">fieldnum</span>&nbsp;<span class="builtintype" id="5474488">int</span>&nbsp;<span class="comment" id="5474492">//&nbsp;the&nbsp;last&nbsp;field&nbsp;number&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5474524">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5474533">[</span><span class="op" id="5474534">]</span><span class="builtintype" id="5474535">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5474541">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5474550">*</span><span class="ident" id="5474551">decoderState</span>&nbsp;<span class="comment" id="5474564">//&nbsp;for&nbsp;free&nbsp;list</span><br>
<span class="lineno">35</span><span class="op" id="5474581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5474584">//&nbsp;decBuffer&nbsp;is&nbsp;an&nbsp;extremely&nbsp;simple,&nbsp;fast&nbsp;implementation&nbsp;of&nbsp;a&nbsp;read-only&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="5474669">//&nbsp;It&nbsp;is&nbsp;initialized&nbsp;by&nbsp;calling&nbsp;Size&nbsp;and&nbsp;then&nbsp;copying&nbsp;the&nbsp;data&nbsp;into&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;Bytes().</span><br>
<span class="lineno"></span><span class="keyword" id="5474768">type</span>&nbsp;<span class="ident" id="5474773">decBuffer</span>&nbsp;<span class="keyword" id="5474783">struct</span>&nbsp;<span class="op" id="5474790">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5474793">data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5474800">[</span><span class="op" id="5474801">]</span><span class="builtintype" id="5474802">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5474808">offset</span>&nbsp;<span class="builtintype" id="5474815">int</span>&nbsp;<span class="comment" id="5474819">//&nbsp;Read&nbsp;offset.</span><br>
<span class="lineno"></span><span class="op" id="5474835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5474838">func</span>&nbsp;<span class="op" id="5474843">(</span><span class="ident" id="5474844">d</span>&nbsp;<span class="op" id="5474846">*</span><span class="ident" id="5474847">decBuffer</span><span class="op" id="5474856">)</span>&nbsp;<span class="ident" id="5474858">Read</span><span class="op" id="5474862">(</span><span class="ident" id="5474863">p</span>&nbsp;<span class="op" id="5474865">[</span><span class="op" id="5474866">]</span><span class="builtintype" id="5474867">byte</span><span class="op" id="5474871">)</span>&nbsp;<span class="op" id="5474873">(</span><span class="builtintype" id="5474874">int</span><span class="op" id="5474877">,</span>&nbsp;<span class="builtintype" id="5474879">error</span><span class="op" id="5474884">)</span>&nbsp;<span class="op" id="5474886">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5474889">n</span>&nbsp;<span class="op" id="5474891">:=</span>&nbsp;<span class="builtinfunc" id="5474894">copy</span><span class="op" id="5474898">(</span><span class="ident" id="5474899">p</span><span class="op" id="5474900">,</span>&nbsp;<span class="ident" id="5474902">d</span><span class="op" id="5474903">.</span><span class="ident" id="5474904">data</span><span class="op" id="5474908">[</span><span class="ident" id="5474909">d</span><span class="op" id="5474910">.</span><span class="ident" id="5474911">offset</span><span class="op" id="5474917">:</span><span class="op" id="5474918">]</span><span class="op" id="5474919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5474922">if</span>&nbsp;<span class="ident" id="5474925">n</span>&nbsp;<span class="op" id="5474927">==</span>&nbsp;<span class="num" id="5474930">0</span>&nbsp;<span class="op" id="5474932">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5474935">len</span><span class="op" id="5474938">(</span><span class="ident" id="5474939">p</span><span class="op" id="5474940">)</span>&nbsp;<span class="op" id="5474942">!=</span>&nbsp;<span class="num" id="5474945">0</span>&nbsp;<span class="op" id="5474947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5474951">return</span>&nbsp;<span class="num" id="5474958">0</span><span class="op" id="5474959">,</span>&nbsp;<span class="ident" id="5474961">io</span><span class="op" id="5474963">.</span><span class="ident" id="5474964">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5474969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5474972">d</span><span class="op" id="5474973">.</span><span class="ident" id="5474974">offset</span>&nbsp;<span class="op" id="5474981">+=</span>&nbsp;<span class="ident" id="5474984">n</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5474987">return</span>&nbsp;<span class="ident" id="5474994">n</span><span class="op" id="5474995">,</span>&nbsp;<span class="builtintype" id="5474997">nil</span><br>
<span class="lineno"></span><span class="op" id="5475001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5475004">func</span>&nbsp;<span class="op" id="5475009">(</span><span class="ident" id="5475010">d</span>&nbsp;<span class="op" id="5475012">*</span><span class="ident" id="5475013">decBuffer</span><span class="op" id="5475022">)</span>&nbsp;<span class="ident" id="5475024">Drop</span><span class="op" id="5475028">(</span><span class="ident" id="5475029">n</span>&nbsp;<span class="builtintype" id="5475031">int</span><span class="op" id="5475034">)</span>&nbsp;<span class="op" id="5475036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5475039">if</span>&nbsp;<span class="ident" id="5475042">n</span>&nbsp;<span class="op" id="5475044">&gt;</span>&nbsp;<span class="ident" id="5475046">d</span><span class="op" id="5475047">.</span><span class="ident" id="5475048">Len</span><span class="op" id="5475051">(</span><span class="op" id="5475052">)</span>&nbsp;<span class="op" id="5475054">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5475058">panic</span><span class="op" id="5475063">(</span><span class="string" id="5475064">&#34;drop&#34;</span><span class="op" id="5475070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5475073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5475076">d</span><span class="op" id="5475077">.</span><span class="ident" id="5475078">offset</span>&nbsp;<span class="op" id="5475085">+=</span>&nbsp;<span class="ident" id="5475088">n</span><br>
<span class="lineno"></span><span class="op" id="5475090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5475093">//&nbsp;Size&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;exactly&nbsp;n&nbsp;bytes,&nbsp;so&nbsp;d.Bytes()&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="5475156">//&nbsp;return&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n.&nbsp;Existing&nbsp;data&nbsp;is&nbsp;first&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5475221">func</span>&nbsp;<span class="op" id="5475226">(</span><span class="ident" id="5475227">d</span>&nbsp;<span class="op" id="5475229">*</span><span class="ident" id="5475230">decBuffer</span><span class="op" id="5475239">)</span>&nbsp;<span class="ident" id="5475241">Size</span><span class="op" id="5475245">(</span><span class="ident" id="5475246">n</span>&nbsp;<span class="builtintype" id="5475248">int</span><span class="op" id="5475251">)</span>&nbsp;<span class="op" id="5475253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5475256">d</span><span class="op" id="5475257">.</span><span class="ident" id="5475258">Reset</span><span class="op" id="5475263">(</span><span class="op" id="5475264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5475267">if</span>&nbsp;<span class="builtinfunc" id="5475270">cap</span><span class="op" id="5475273">(</span><span class="ident" id="5475274">d</span><span class="op" id="5475275">.</span><span class="ident" id="5475276">data</span><span class="op" id="5475280">)</span>&nbsp;<span class="op" id="5475282">&lt;</span>&nbsp;<span class="ident" id="5475284">n</span>&nbsp;<span class="op" id="5475286">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5475290">d</span><span class="op" id="5475291">.</span><span class="ident" id="5475292">data</span>&nbsp;<span class="op" id="5475297">=</span>&nbsp;<span class="builtinfunc" id="5475299">make</span><span class="op" id="5475303">(</span><span class="op" id="5475304">[</span><span class="op" id="5475305">]</span><span class="builtintype" id="5475306">byte</span><span class="op" id="5475310">,</span>&nbsp;<span class="ident" id="5475312">n</span><span class="op" id="5475313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5475316">}</span>&nbsp;<span class="keyword" id="5475318">else</span>&nbsp;<span class="op" id="5475323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5475327">d</span><span class="op" id="5475328">.</span><span class="ident" id="5475329">data</span>&nbsp;<span class="op" id="5475334">=</span>&nbsp;<span class="ident" id="5475336">d</span><span class="op" id="5475337">.</span><span class="ident" id="5475338">data</span><span class="op" id="5475342">[</span><span class="num" id="5475343">0</span><span class="op" id="5475344">:</span><span class="ident" id="5475345">n</span><span class="op" id="5475346">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5475349">}</span><br>
<span class="lineno"></span><span class="op" id="5475351">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="5475354">func</span>&nbsp;<span class="op" id="5475359">(</span><span class="ident" id="5475360">d</span>&nbsp;<span class="op" id="5475362">*</span><span class="ident" id="5475363">decBuffer</span><span class="op" id="5475372">)</span>&nbsp;<span class="ident" id="5475374">ReadByte</span><span class="op" id="5475382">(</span><span class="op" id="5475383">)</span>&nbsp;<span class="op" id="5475385">(</span><span class="builtintype" id="5475386">byte</span><span class="op" id="5475390">,</span>&nbsp;<span class="builtintype" id="5475392">error</span><span class="op" id="5475397">)</span>&nbsp;<span class="op" id="5475399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5475402">if</span>&nbsp;<span class="ident" id="5475405">d</span><span class="op" id="5475406">.</span><span class="ident" id="5475407">offset</span>&nbsp;<span class="op" id="5475414">&gt;=</span>&nbsp;<span class="builtinfunc" id="5475417">len</span><span class="op" id="5475420">(</span><span class="ident" id="5475421">d</span><span class="op" id="5475422">.</span><span class="ident" id="5475423">data</span><span class="op" id="5475427">)</span>&nbsp;<span class="op" id="5475429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5475433">return</span>&nbsp;<span class="num" id="5475440">0</span><span class="op" id="5475441">,</span>&nbsp;<span class="ident" id="5475443">io</span><span class="op" id="5475445">.</span><span class="ident" id="5475446">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5475451">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5475454">c</span>&nbsp;<span class="op" id="5475456">:=</span>&nbsp;<span class="ident" id="5475459">d</span><span class="op" id="5475460">.</span><span class="ident" id="5475461">data</span><span class="op" id="5475465">[</span><span class="ident" id="5475466">d</span><span class="op" id="5475467">.</span><span class="ident" id="5475468">offset</span><span class="op" id="5475474">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5475477">d</span><span class="op" id="5475478">.</span><span class="ident" id="5475479">offset</span><span class="op" id="5475485">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5475489">return</span>&nbsp;<span class="ident" id="5475496">c</span><span class="op" id="5475497">,</span>&nbsp;<span class="builtintype" id="5475499">nil</span><br>
<span class="lineno"></span><span class="op" id="5475503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="5475506">func</span>&nbsp;<span class="op" id="5475511">(</span><span class="ident" id="5475512">d</span>&nbsp;<span class="op" id="5475514">*</span><span class="ident" id="5475515">decBuffer</span><span class="op" id="5475524">)</span>&nbsp;<span class="ident" id="5475526">Len</span><span class="op" id="5475529">(</span><span class="op" id="5475530">)</span>&nbsp;<span class="builtintype" id="5475532">int</span>&nbsp;<span class="op" id="5475536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5475539">return</span>&nbsp;<span class="builtinfunc" id="5475546">len</span><span class="op" id="5475549">(</span><span class="ident" id="5475550">d</span><span class="op" id="5475551">.</span><span class="ident" id="5475552">data</span><span class="op" id="5475556">)</span>&nbsp;<span class="op" id="5475558">-</span>&nbsp;<span class="ident" id="5475560">d</span><span class="op" id="5475561">.</span><span class="ident" id="5475562">offset</span><br>
<span class="lineno"></span><span class="op" id="5475569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5475572">func</span>&nbsp;<span class="op" id="5475577">(</span><span class="ident" id="5475578">d</span>&nbsp;<span class="op" id="5475580">*</span><span class="ident" id="5475581">decBuffer</span><span class="op" id="5475590">)</span>&nbsp;<span class="ident" id="5475592">Bytes</span><span class="op" id="5475597">(</span><span class="op" id="5475598">)</span>&nbsp;<span class="op" id="5475600">[</span><span class="op" id="5475601">]</span><span class="builtintype" id="5475602">byte</span>&nbsp;<span class="op" id="5475607">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5475610">return</span>&nbsp;<span class="ident" id="5475617">d</span><span class="op" id="5475618">.</span><span class="ident" id="5475619">data</span><span class="op" id="5475623">[</span><span class="ident" id="5475624">d</span><span class="op" id="5475625">.</span><span class="ident" id="5475626">offset</span><span class="op" id="5475632">:</span><span class="op" id="5475633">]</span><br>
<span class="lineno"></span><span class="op" id="5475635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5475638">func</span>&nbsp;<span class="op" id="5475643">(</span><span class="ident" id="5475644">d</span>&nbsp;<span class="op" id="5475646">*</span><span class="ident" id="5475647">decBuffer</span><span class="op" id="5475656">)</span>&nbsp;<span class="ident" id="5475658">Reset</span><span class="op" id="5475663">(</span><span class="op" id="5475664">)</span>&nbsp;<span class="op" id="5475666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5475669">d</span><span class="op" id="5475670">.</span><span class="ident" id="5475671">data</span>&nbsp;<span class="op" id="5475676">=</span>&nbsp;<span class="ident" id="5475678">d</span><span class="op" id="5475679">.</span><span class="ident" id="5475680">data</span><span class="op" id="5475684">[</span><span class="num" id="5475685">0</span><span class="op" id="5475686">:</span><span class="num" id="5475687">0</span><span class="op" id="5475688">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5475691">d</span><span class="op" id="5475692">.</span><span class="ident" id="5475693">offset</span>&nbsp;<span class="op" id="5475700">=</span>&nbsp;<span class="num" id="5475702">0</span><br>
<span class="lineno"></span><span class="op" id="5475704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5475707">//&nbsp;We&nbsp;pass&nbsp;the&nbsp;bytes.Buffer&nbsp;separately&nbsp;for&nbsp;easier&nbsp;testing&nbsp;of&nbsp;the&nbsp;infrastructure</span><br>
<span class="lineno"></span><span class="comment" id="5475787">//&nbsp;without&nbsp;requiring&nbsp;a&nbsp;full&nbsp;Decoder.</span><br>
<span class="lineno">95</span><span class="keyword" id="5475824">func</span>&nbsp;<span class="op" id="5475829">(</span><span class="ident" id="5475830">dec</span>&nbsp;<span class="op" id="5475834">*</span><span class="ident" id="5475835">Decoder</span><span class="op" id="5475842">)</span>&nbsp;<span class="ident" id="5475844">newDecoderState</span><span class="op" id="5475859">(</span><span class="ident" id="5475860">buf</span>&nbsp;<span class="op" id="5475864">*</span><span class="ident" id="5475865">decBuffer</span><span class="op" id="5475874">)</span>&nbsp;<span class="op" id="5475876">*</span><span class="ident" id="5475877">decoderState</span>&nbsp;<span class="op" id="5475890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5475893">d</span>&nbsp;<span class="op" id="5475895">:=</span>&nbsp;<span class="ident" id="5475898">dec</span><span class="op" id="5475901">.</span><span class="ident" id="5475902">freeList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5475912">if</span>&nbsp;<span class="ident" id="5475915">d</span>&nbsp;<span class="op" id="5475917">==</span>&nbsp;<span class="builtintype" id="5475920">nil</span>&nbsp;<span class="op" id="5475924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5475928">d</span>&nbsp;<span class="op" id="5475930">=</span>&nbsp;<span class="builtinfunc" id="5475932">new</span><span class="op" id="5475935">(</span><span class="ident" id="5475936">decoderState</span><span class="op" id="5475948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5475952">d</span><span class="op" id="5475953">.</span><span class="ident" id="5475954">dec</span>&nbsp;<span class="op" id="5475958">=</span>&nbsp;<span class="ident" id="5475960">dec</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5475966">d</span><span class="op" id="5475967">.</span><span class="ident" id="5475968">buf</span>&nbsp;<span class="op" id="5475972">=</span>&nbsp;<span class="builtinfunc" id="5475974">make</span><span class="op" id="5475978">(</span><span class="op" id="5475979">[</span><span class="op" id="5475980">]</span><span class="builtintype" id="5475981">byte</span><span class="op" id="5475985">,</span>&nbsp;<span class="ident" id="5475987">uint64Size</span><span class="op" id="5475997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5476000">}</span>&nbsp;<span class="keyword" id="5476002">else</span>&nbsp;<span class="op" id="5476007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5476011">dec</span><span class="op" id="5476014">.</span><span class="ident" id="5476015">freeList</span>&nbsp;<span class="op" id="5476024">=</span>&nbsp;<span class="ident" id="5476026">d</span><span class="op" id="5476027">.</span><span class="ident" id="5476028">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5476034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5476037">d</span><span class="op" id="5476038">.</span><span class="ident" id="5476039">b</span>&nbsp;<span class="op" id="5476041">=</span>&nbsp;<span class="ident" id="5476043">buf</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5476048">return</span>&nbsp;<span class="ident" id="5476055">d</span><br>
<span class="lineno"></span><span class="op" id="5476057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5476060">func</span>&nbsp;<span class="op" id="5476065">(</span><span class="ident" id="5476066">dec</span>&nbsp;<span class="op" id="5476070">*</span><span class="ident" id="5476071">Decoder</span><span class="op" id="5476078">)</span>&nbsp;<span class="ident" id="5476080">freeDecoderState</span><span class="op" id="5476096">(</span><span class="ident" id="5476097">d</span>&nbsp;<span class="op" id="5476099">*</span><span class="ident" id="5476100">decoderState</span><span class="op" id="5476112">)</span>&nbsp;<span class="op" id="5476114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5476117">d</span><span class="op" id="5476118">.</span><span class="ident" id="5476119">next</span>&nbsp;<span class="op" id="5476124">=</span>&nbsp;<span class="ident" id="5476126">dec</span><span class="op" id="5476129">.</span><span class="ident" id="5476130">freeList</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5476140">dec</span><span class="op" id="5476143">.</span><span class="ident" id="5476144">freeList</span>&nbsp;<span class="op" id="5476153">=</span>&nbsp;<span class="ident" id="5476155">d</span><br>
<span class="lineno"></span><span class="op" id="5476157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5476160">func</span>&nbsp;<span class="ident" id="5476165">overflow</span><span class="op" id="5476173">(</span><span class="ident" id="5476174">name</span>&nbsp;<span class="builtintype" id="5476179">string</span><span class="op" id="5476185">)</span>&nbsp;<span class="builtintype" id="5476187">error</span>&nbsp;<span class="op" id="5476193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5476196">return</span>&nbsp;<span class="ident" id="5476203">errors</span><span class="op" id="5476209">.</span><span class="ident" id="5476210">New</span><span class="op" id="5476213">(</span><span class="string" id="5476214">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="5476228">+</span>&nbsp;<span class="ident" id="5476230">name</span>&nbsp;<span class="op" id="5476235">+</span>&nbsp;<span class="string" id="5476237">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="5476253">)</span><br>
<span class="lineno">115</span><span class="op" id="5476255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5476258">//&nbsp;decodeUintReader&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;an&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="5476331">//&nbsp;Used&nbsp;only&nbsp;by&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;read&nbsp;the&nbsp;message&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5476387">func</span>&nbsp;<span class="ident" id="5476392">decodeUintReader</span><span class="op" id="5476408">(</span><span class="ident" id="5476409">r</span>&nbsp;<span class="ident" id="5476411">io</span><span class="op" id="5476413">.</span><span class="ident" id="5476414">Reader</span><span class="op" id="5476420">,</span>&nbsp;<span class="ident" id="5476422">buf</span>&nbsp;<span class="op" id="5476426">[</span><span class="op" id="5476427">]</span><span class="builtintype" id="5476428">byte</span><span class="op" id="5476432">)</span>&nbsp;<span class="op" id="5476434">(</span><span class="ident" id="5476435">x</span>&nbsp;<span class="ident" id="5476437">uint64</span><span class="op" id="5476443">,</span>&nbsp;<span class="ident" id="5476445">width</span>&nbsp;<span class="builtintype" id="5476451">int</span><span class="op" id="5476454">,</span>&nbsp;<span class="ident" id="5476456">err</span>&nbsp;<span class="builtintype" id="5476460">error</span><span class="op" id="5476465">)</span>&nbsp;<span class="op" id="5476467">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5476470">width</span>&nbsp;<span class="op" id="5476476">=</span>&nbsp;<span class="num" id="5476478">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5476481">n</span><span class="op" id="5476482">,</span>&nbsp;<span class="ident" id="5476484">err</span>&nbsp;<span class="op" id="5476488">:=</span>&nbsp;<span class="ident" id="5476491">io</span><span class="op" id="5476493">.</span><span class="ident" id="5476494">ReadFull</span><span class="op" id="5476502">(</span><span class="ident" id="5476503">r</span><span class="op" id="5476504">,</span>&nbsp;<span class="ident" id="5476506">buf</span><span class="op" id="5476509">[</span><span class="num" id="5476510">0</span><span class="op" id="5476511">:</span><span class="ident" id="5476512">width</span><span class="op" id="5476517">]</span><span class="op" id="5476518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5476521">if</span>&nbsp;<span class="ident" id="5476524">n</span>&nbsp;<span class="op" id="5476526">==</span>&nbsp;<span class="num" id="5476529">0</span>&nbsp;<span class="op" id="5476531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5476535">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5476543">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5476546">b</span>&nbsp;<span class="op" id="5476548">:=</span>&nbsp;<span class="ident" id="5476551">buf</span><span class="op" id="5476554">[</span><span class="num" id="5476555">0</span><span class="op" id="5476556">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5476559">if</span>&nbsp;<span class="ident" id="5476562">b</span>&nbsp;<span class="op" id="5476564">&lt;=</span>&nbsp;<span class="num" id="5476567">0x7f</span>&nbsp;<span class="op" id="5476572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5476576">return</span>&nbsp;<span class="ident" id="5476583">uint64</span><span class="op" id="5476589">(</span><span class="ident" id="5476590">b</span><span class="op" id="5476591">)</span><span class="op" id="5476592">,</span>&nbsp;<span class="ident" id="5476594">width</span><span class="op" id="5476599">,</span>&nbsp;<span class="builtintype" id="5476601">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5476606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5476609">n</span>&nbsp;<span class="op" id="5476611">=</span>&nbsp;<span class="op" id="5476613">-</span><span class="builtintype" id="5476614">int</span><span class="op" id="5476617">(</span><span class="builtintype" id="5476618">int8</span><span class="op" id="5476622">(</span><span class="ident" id="5476623">b</span><span class="op" id="5476624">)</span><span class="op" id="5476625">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5476628">if</span>&nbsp;<span class="ident" id="5476631">n</span>&nbsp;<span class="op" id="5476633">&gt;</span>&nbsp;<span class="ident" id="5476635">uint64Size</span>&nbsp;<span class="op" id="5476646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5476650">err</span>&nbsp;<span class="op" id="5476654">=</span>&nbsp;<span class="ident" id="5476656">errBadUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5476669">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5476677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5476680">width</span><span class="op" id="5476685">,</span>&nbsp;<span class="ident" id="5476687">err</span>&nbsp;<span class="op" id="5476691">=</span>&nbsp;<span class="ident" id="5476693">io</span><span class="op" id="5476695">.</span><span class="ident" id="5476696">ReadFull</span><span class="op" id="5476704">(</span><span class="ident" id="5476705">r</span><span class="op" id="5476706">,</span>&nbsp;<span class="ident" id="5476708">buf</span><span class="op" id="5476711">[</span><span class="num" id="5476712">0</span><span class="op" id="5476713">:</span><span class="ident" id="5476714">n</span><span class="op" id="5476715">]</span><span class="op" id="5476716">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5476719">if</span>&nbsp;<span class="ident" id="5476722">err</span>&nbsp;<span class="op" id="5476726">!=</span>&nbsp;<span class="builtintype" id="5476729">nil</span>&nbsp;<span class="op" id="5476733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5476737">if</span>&nbsp;<span class="ident" id="5476740">err</span>&nbsp;<span class="op" id="5476744">==</span>&nbsp;<span class="ident" id="5476747">io</span><span class="op" id="5476749">.</span><span class="ident" id="5476750">EOF</span>&nbsp;<span class="op" id="5476754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5476759">err</span>&nbsp;<span class="op" id="5476763">=</span>&nbsp;<span class="ident" id="5476765">io</span><span class="op" id="5476767">.</span><span class="ident" id="5476768">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5476787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5476791">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5476799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5476802">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5476868">for</span>&nbsp;<span class="ident" id="5476872">_</span><span class="op" id="5476873">,</span>&nbsp;<span class="ident" id="5476875">b</span>&nbsp;<span class="op" id="5476877">:=</span>&nbsp;<span class="keyword" id="5476880">range</span>&nbsp;<span class="ident" id="5476886">buf</span><span class="op" id="5476889">[</span><span class="num" id="5476890">0</span><span class="op" id="5476891">:</span><span class="ident" id="5476892">width</span><span class="op" id="5476897">]</span>&nbsp;<span class="op" id="5476899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5476903">x</span>&nbsp;<span class="op" id="5476905">=</span>&nbsp;<span class="ident" id="5476907">x</span><span class="op" id="5476908">&lt;&lt;</span><span class="num" id="5476910">8</span>&nbsp;<span class="op" id="5476912">|</span>&nbsp;<span class="ident" id="5476914">uint64</span><span class="op" id="5476920">(</span><span class="ident" id="5476921">b</span><span class="op" id="5476922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5476925">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5476928">width</span><span class="op" id="5476933">++</span>&nbsp;<span class="comment" id="5476936">//&nbsp;+1&nbsp;for&nbsp;length&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5476959">return</span><br>
<span class="lineno"></span><span class="op" id="5476966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5476969">//&nbsp;decodeUint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno">150</span><span class="comment" id="5477031">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="5477063">func</span>&nbsp;<span class="op" id="5477068">(</span><span class="ident" id="5477069">state</span>&nbsp;<span class="op" id="5477075">*</span><span class="ident" id="5477076">decoderState</span><span class="op" id="5477088">)</span>&nbsp;<span class="ident" id="5477090">decodeUint</span><span class="op" id="5477100">(</span><span class="op" id="5477101">)</span>&nbsp;<span class="op" id="5477103">(</span><span class="ident" id="5477104">x</span>&nbsp;<span class="ident" id="5477106">uint64</span><span class="op" id="5477112">)</span>&nbsp;<span class="op" id="5477114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5477117">b</span><span class="op" id="5477118">,</span>&nbsp;<span class="ident" id="5477120">err</span>&nbsp;<span class="op" id="5477124">:=</span>&nbsp;<span class="ident" id="5477127">state</span><span class="op" id="5477132">.</span><span class="ident" id="5477133">b</span><span class="op" id="5477134">.</span><span class="ident" id="5477135">ReadByte</span><span class="op" id="5477143">(</span><span class="op" id="5477144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5477147">if</span>&nbsp;<span class="ident" id="5477150">err</span>&nbsp;<span class="op" id="5477154">!=</span>&nbsp;<span class="builtintype" id="5477157">nil</span>&nbsp;<span class="op" id="5477161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5477165">error_</span><span class="op" id="5477171">(</span><span class="ident" id="5477172">err</span><span class="op" id="5477175">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5477178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5477181">if</span>&nbsp;<span class="ident" id="5477184">b</span>&nbsp;<span class="op" id="5477186">&lt;=</span>&nbsp;<span class="num" id="5477189">0x7f</span>&nbsp;<span class="op" id="5477194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5477198">return</span>&nbsp;<span class="ident" id="5477205">uint64</span><span class="op" id="5477211">(</span><span class="ident" id="5477212">b</span><span class="op" id="5477213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5477216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5477219">n</span>&nbsp;<span class="op" id="5477221">:=</span>&nbsp;<span class="op" id="5477224">-</span><span class="builtintype" id="5477225">int</span><span class="op" id="5477228">(</span><span class="builtintype" id="5477229">int8</span><span class="op" id="5477233">(</span><span class="ident" id="5477234">b</span><span class="op" id="5477235">)</span><span class="op" id="5477236">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5477239">if</span>&nbsp;<span class="ident" id="5477242">n</span>&nbsp;<span class="op" id="5477244">&gt;</span>&nbsp;<span class="ident" id="5477246">uint64Size</span>&nbsp;<span class="op" id="5477257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5477261">error_</span><span class="op" id="5477267">(</span><span class="ident" id="5477268">errBadUint</span><span class="op" id="5477278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5477281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5477284">width</span><span class="op" id="5477289">,</span>&nbsp;<span class="ident" id="5477291">err</span>&nbsp;<span class="op" id="5477295">:=</span>&nbsp;<span class="ident" id="5477298">state</span><span class="op" id="5477303">.</span><span class="ident" id="5477304">b</span><span class="op" id="5477305">.</span><span class="ident" id="5477306">Read</span><span class="op" id="5477310">(</span><span class="ident" id="5477311">state</span><span class="op" id="5477316">.</span><span class="ident" id="5477317">buf</span><span class="op" id="5477320">[</span><span class="num" id="5477321">0</span><span class="op" id="5477322">:</span><span class="ident" id="5477323">n</span><span class="op" id="5477324">]</span><span class="op" id="5477325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5477328">if</span>&nbsp;<span class="ident" id="5477331">err</span>&nbsp;<span class="op" id="5477335">!=</span>&nbsp;<span class="builtintype" id="5477338">nil</span>&nbsp;<span class="op" id="5477342">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5477346">error_</span><span class="op" id="5477352">(</span><span class="ident" id="5477353">err</span><span class="op" id="5477356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5477359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5477362">//&nbsp;Don&#39;t&nbsp;need&nbsp;to&nbsp;check&nbsp;error;&nbsp;it&#39;s&nbsp;safe&nbsp;to&nbsp;loop&nbsp;regardless.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5477423">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5477489">for</span>&nbsp;<span class="ident" id="5477493">_</span><span class="op" id="5477494">,</span>&nbsp;<span class="ident" id="5477496">b</span>&nbsp;<span class="op" id="5477498">:=</span>&nbsp;<span class="keyword" id="5477501">range</span>&nbsp;<span class="ident" id="5477507">state</span><span class="op" id="5477512">.</span><span class="ident" id="5477513">buf</span><span class="op" id="5477516">[</span><span class="num" id="5477517">0</span><span class="op" id="5477518">:</span><span class="ident" id="5477519">width</span><span class="op" id="5477524">]</span>&nbsp;<span class="op" id="5477526">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5477530">x</span>&nbsp;<span class="op" id="5477532">=</span>&nbsp;<span class="ident" id="5477534">x</span><span class="op" id="5477535">&lt;&lt;</span><span class="num" id="5477537">8</span>&nbsp;<span class="op" id="5477539">|</span>&nbsp;<span class="ident" id="5477541">uint64</span><span class="op" id="5477547">(</span><span class="ident" id="5477548">b</span><span class="op" id="5477549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5477552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5477555">return</span>&nbsp;<span class="ident" id="5477562">x</span><br>
<span class="lineno"></span><span class="op" id="5477564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5477567">//&nbsp;decodeInt&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno"></span><span class="comment" id="5477626">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="5477658">func</span>&nbsp;<span class="op" id="5477663">(</span><span class="ident" id="5477664">state</span>&nbsp;<span class="op" id="5477670">*</span><span class="ident" id="5477671">decoderState</span><span class="op" id="5477683">)</span>&nbsp;<span class="ident" id="5477685">decodeInt</span><span class="op" id="5477694">(</span><span class="op" id="5477695">)</span>&nbsp;<span class="ident" id="5477697">int64</span>&nbsp;<span class="op" id="5477703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5477706">x</span>&nbsp;<span class="op" id="5477708">:=</span>&nbsp;<span class="ident" id="5477711">state</span><span class="op" id="5477716">.</span><span class="ident" id="5477717">decodeUint</span><span class="op" id="5477727">(</span><span class="op" id="5477728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5477731">if</span>&nbsp;<span class="ident" id="5477734">x</span><span class="op" id="5477735">&amp;</span><span class="num" id="5477736">1</span>&nbsp;<span class="op" id="5477738">!=</span>&nbsp;<span class="num" id="5477741">0</span>&nbsp;<span class="op" id="5477743">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5477747">return</span>&nbsp;<span class="op" id="5477754">^</span><span class="ident" id="5477755">int64</span><span class="op" id="5477760">(</span><span class="ident" id="5477761">x</span>&nbsp;<span class="op" id="5477763">&gt;&gt;</span>&nbsp;<span class="num" id="5477766">1</span><span class="op" id="5477767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5477770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5477773">return</span>&nbsp;<span class="ident" id="5477780">int64</span><span class="op" id="5477785">(</span><span class="ident" id="5477786">x</span>&nbsp;<span class="op" id="5477788">&gt;&gt;</span>&nbsp;<span class="num" id="5477791">1</span><span class="op" id="5477792">)</span><br>
<span class="lineno"></span><span class="op" id="5477794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="5477797">//&nbsp;decOp&nbsp;is&nbsp;the&nbsp;signature&nbsp;of&nbsp;a&nbsp;decoding&nbsp;operator&nbsp;for&nbsp;a&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5477864">type</span>&nbsp;<span class="ident" id="5477869">decOp</span>&nbsp;<span class="keyword" id="5477875">func</span><span class="op" id="5477879">(</span><span class="ident" id="5477880">i</span>&nbsp;<span class="op" id="5477882">*</span><span class="ident" id="5477883">decInstr</span><span class="op" id="5477891">,</span>&nbsp;<span class="ident" id="5477893">state</span>&nbsp;<span class="op" id="5477899">*</span><span class="ident" id="5477900">decoderState</span><span class="op" id="5477912">,</span>&nbsp;<span class="ident" id="5477914">v</span>&nbsp;<span class="ident" id="5477916">reflect</span><span class="op" id="5477923">.</span><span class="ident" id="5477924">Value</span><span class="op" id="5477929">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5477932">//&nbsp;The&nbsp;&#39;instructions&#39;&nbsp;of&nbsp;the&nbsp;decoding&nbsp;machine</span><br>
<span class="lineno"></span><span class="keyword" id="5477978">type</span>&nbsp;<span class="ident" id="5477983">decInstr</span>&nbsp;<span class="keyword" id="5477992">struct</span>&nbsp;<span class="op" id="5477999">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5478002">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5478008">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5478015">field</span>&nbsp;<span class="builtintype" id="5478021">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5478027">//&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;wire&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5478061">index</span>&nbsp;<span class="op" id="5478067">[</span><span class="op" id="5478068">]</span><span class="builtintype" id="5478069">int</span>&nbsp;<span class="comment" id="5478073">//&nbsp;field&nbsp;access&nbsp;indices&nbsp;for&nbsp;destination&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5478119">ovfl</span>&nbsp;&nbsp;<span class="builtintype" id="5478125">error</span>&nbsp;<span class="comment" id="5478131">//&nbsp;error&nbsp;message&nbsp;for&nbsp;overflow/underflow&nbsp;(for&nbsp;arrays,&nbsp;of&nbsp;the&nbsp;elements)</span><br>
<span class="lineno"></span><span class="op" id="5478201">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="5478204">//&nbsp;ignoreUint&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5478261">func</span>&nbsp;<span class="ident" id="5478266">ignoreUint</span><span class="op" id="5478276">(</span><span class="ident" id="5478277">i</span>&nbsp;<span class="op" id="5478279">*</span><span class="ident" id="5478280">decInstr</span><span class="op" id="5478288">,</span>&nbsp;<span class="ident" id="5478290">state</span>&nbsp;<span class="op" id="5478296">*</span><span class="ident" id="5478297">decoderState</span><span class="op" id="5478309">,</span>&nbsp;<span class="ident" id="5478311">v</span>&nbsp;<span class="ident" id="5478313">reflect</span><span class="op" id="5478320">.</span><span class="ident" id="5478321">Value</span><span class="op" id="5478326">)</span>&nbsp;<span class="op" id="5478328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5478331">state</span><span class="op" id="5478336">.</span><span class="ident" id="5478337">decodeUint</span><span class="op" id="5478347">(</span><span class="op" id="5478348">)</span><br>
<span class="lineno"></span><span class="op" id="5478350">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="5478353">//&nbsp;ignoreTwoUints&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;to&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="5478432">//&nbsp;complex&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5478451">func</span>&nbsp;<span class="ident" id="5478456">ignoreTwoUints</span><span class="op" id="5478470">(</span><span class="ident" id="5478471">i</span>&nbsp;<span class="op" id="5478473">*</span><span class="ident" id="5478474">decInstr</span><span class="op" id="5478482">,</span>&nbsp;<span class="ident" id="5478484">state</span>&nbsp;<span class="op" id="5478490">*</span><span class="ident" id="5478491">decoderState</span><span class="op" id="5478503">,</span>&nbsp;<span class="ident" id="5478505">v</span>&nbsp;<span class="ident" id="5478507">reflect</span><span class="op" id="5478514">.</span><span class="ident" id="5478515">Value</span><span class="op" id="5478520">)</span>&nbsp;<span class="op" id="5478522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5478525">state</span><span class="op" id="5478530">.</span><span class="ident" id="5478531">decodeUint</span><span class="op" id="5478541">(</span><span class="op" id="5478542">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5478545">state</span><span class="op" id="5478550">.</span><span class="ident" id="5478551">decodeUint</span><span class="op" id="5478561">(</span><span class="op" id="5478562">)</span><br>
<span class="lineno"></span><span class="op" id="5478564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5478567">//&nbsp;Since&nbsp;the&nbsp;encoder&nbsp;writes&nbsp;no&nbsp;zeros,&nbsp;if&nbsp;we&nbsp;arrive&nbsp;at&nbsp;a&nbsp;decoder&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="5478639">//&nbsp;a&nbsp;value&nbsp;to&nbsp;extract&nbsp;and&nbsp;store.&nbsp;&nbsp;The&nbsp;field&nbsp;number&nbsp;has&nbsp;already&nbsp;been&nbsp;read</span><br>
<span class="lineno">210</span><span class="comment" id="5478712">//&nbsp;(it&#39;s&nbsp;how&nbsp;we&nbsp;knew&nbsp;to&nbsp;call&nbsp;this&nbsp;decoder).</span><br>
<span class="lineno"></span><span class="comment" id="5478756">//&nbsp;Each&nbsp;decoder&nbsp;is&nbsp;responsible&nbsp;for&nbsp;handling&nbsp;any&nbsp;indirections&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="5478828">//&nbsp;with&nbsp;the&nbsp;data&nbsp;structure.&nbsp;&nbsp;If&nbsp;any&nbsp;pointer&nbsp;so&nbsp;reached&nbsp;is&nbsp;nil,&nbsp;allocation&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5478907">//&nbsp;be&nbsp;done.</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="5478920">//&nbsp;decAlloc&nbsp;takes&nbsp;a&nbsp;value&nbsp;and&nbsp;returns&nbsp;a&nbsp;settable&nbsp;value&nbsp;that&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="5478984">//&nbsp;be&nbsp;assigned&nbsp;to.&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer,&nbsp;decAlloc&nbsp;guarantees&nbsp;it&nbsp;points&nbsp;to&nbsp;storage.</span><br>
<span class="lineno"></span><span class="comment" id="5479072">//&nbsp;The&nbsp;callers&nbsp;to&nbsp;the&nbsp;individual&nbsp;decoders&nbsp;are&nbsp;expected&nbsp;to&nbsp;have&nbsp;used&nbsp;decAlloc.</span><br>
<span class="lineno"></span><span class="comment" id="5479150">//&nbsp;The&nbsp;individual&nbsp;decoders&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5479195">func</span>&nbsp;<span class="ident" id="5479200">decAlloc</span><span class="op" id="5479208">(</span><span class="ident" id="5479209">v</span>&nbsp;<span class="ident" id="5479211">reflect</span><span class="op" id="5479218">.</span><span class="ident" id="5479219">Value</span><span class="op" id="5479224">)</span>&nbsp;<span class="ident" id="5479226">reflect</span><span class="op" id="5479233">.</span><span class="ident" id="5479234">Value</span>&nbsp;<span class="op" id="5479240">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5479243">for</span>&nbsp;<span class="ident" id="5479247">v</span><span class="op" id="5479248">.</span><span class="ident" id="5479249">Kind</span><span class="op" id="5479253">(</span><span class="op" id="5479254">)</span>&nbsp;<span class="op" id="5479256">==</span>&nbsp;<span class="ident" id="5479259">reflect</span><span class="op" id="5479266">.</span><span class="ident" id="5479267">Ptr</span>&nbsp;<span class="op" id="5479271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5479275">if</span>&nbsp;<span class="ident" id="5479278">v</span><span class="op" id="5479279">.</span><span class="ident" id="5479280">IsNil</span><span class="op" id="5479285">(</span><span class="op" id="5479286">)</span>&nbsp;<span class="op" id="5479288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5479293">v</span><span class="op" id="5479294">.</span><span class="ident" id="5479295">Set</span><span class="op" id="5479298">(</span><span class="ident" id="5479299">reflect</span><span class="op" id="5479306">.</span><span class="ident" id="5479307">New</span><span class="op" id="5479310">(</span><span class="ident" id="5479311">v</span><span class="op" id="5479312">.</span><span class="ident" id="5479313">Type</span><span class="op" id="5479317">(</span><span class="op" id="5479318">)</span><span class="op" id="5479319">.</span><span class="ident" id="5479320">Elem</span><span class="op" id="5479324">(</span><span class="op" id="5479325">)</span><span class="op" id="5479326">)</span><span class="op" id="5479327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5479331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5479335">v</span>&nbsp;<span class="op" id="5479337">=</span>&nbsp;<span class="ident" id="5479339">v</span><span class="op" id="5479340">.</span><span class="ident" id="5479341">Elem</span><span class="op" id="5479345">(</span><span class="op" id="5479346">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5479349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5479352">return</span>&nbsp;<span class="ident" id="5479359">v</span><br>
<span class="lineno"></span><span class="op" id="5479361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5479364">//&nbsp;decBool&nbsp;decodes&nbsp;a&nbsp;uint&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;boolean&nbsp;in&nbsp;value.</span><br>
<span class="lineno">230</span><span class="keyword" id="5479427">func</span>&nbsp;<span class="ident" id="5479432">decBool</span><span class="op" id="5479439">(</span><span class="ident" id="5479440">i</span>&nbsp;<span class="op" id="5479442">*</span><span class="ident" id="5479443">decInstr</span><span class="op" id="5479451">,</span>&nbsp;<span class="ident" id="5479453">state</span>&nbsp;<span class="op" id="5479459">*</span><span class="ident" id="5479460">decoderState</span><span class="op" id="5479472">,</span>&nbsp;<span class="ident" id="5479474">value</span>&nbsp;<span class="ident" id="5479480">reflect</span><span class="op" id="5479487">.</span><span class="ident" id="5479488">Value</span><span class="op" id="5479493">)</span>&nbsp;<span class="op" id="5479495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5479498">value</span><span class="op" id="5479503">.</span><span class="ident" id="5479504">SetBool</span><span class="op" id="5479511">(</span><span class="ident" id="5479512">state</span><span class="op" id="5479517">.</span><span class="ident" id="5479518">decodeUint</span><span class="op" id="5479528">(</span><span class="op" id="5479529">)</span>&nbsp;<span class="op" id="5479531">!=</span>&nbsp;<span class="num" id="5479534">0</span><span class="op" id="5479535">)</span><br>
<span class="lineno"></span><span class="op" id="5479537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5479540">//&nbsp;decInt8&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int8&nbsp;in&nbsp;value.</span><br>
<span class="lineno">235</span><span class="keyword" id="5479605">func</span>&nbsp;<span class="ident" id="5479610">decInt8</span><span class="op" id="5479617">(</span><span class="ident" id="5479618">i</span>&nbsp;<span class="op" id="5479620">*</span><span class="ident" id="5479621">decInstr</span><span class="op" id="5479629">,</span>&nbsp;<span class="ident" id="5479631">state</span>&nbsp;<span class="op" id="5479637">*</span><span class="ident" id="5479638">decoderState</span><span class="op" id="5479650">,</span>&nbsp;<span class="ident" id="5479652">value</span>&nbsp;<span class="ident" id="5479658">reflect</span><span class="op" id="5479665">.</span><span class="ident" id="5479666">Value</span><span class="op" id="5479671">)</span>&nbsp;<span class="op" id="5479673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5479676">v</span>&nbsp;<span class="op" id="5479678">:=</span>&nbsp;<span class="ident" id="5479681">state</span><span class="op" id="5479686">.</span><span class="ident" id="5479687">decodeInt</span><span class="op" id="5479696">(</span><span class="op" id="5479697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5479700">if</span>&nbsp;<span class="ident" id="5479703">v</span>&nbsp;<span class="op" id="5479705">&lt;</span>&nbsp;<span class="ident" id="5479707">math</span><span class="op" id="5479711">.</span><span class="ident" id="5479712">MinInt8</span>&nbsp;<span class="op" id="5479720">||</span>&nbsp;<span class="ident" id="5479723">math</span><span class="op" id="5479727">.</span><span class="ident" id="5479728">MaxInt8</span>&nbsp;<span class="op" id="5479736">&lt;</span>&nbsp;<span class="ident" id="5479738">v</span>&nbsp;<span class="op" id="5479740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5479744">error_</span><span class="op" id="5479750">(</span><span class="ident" id="5479751">i</span><span class="op" id="5479752">.</span><span class="ident" id="5479753">ovfl</span><span class="op" id="5479757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5479760">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5479763">value</span><span class="op" id="5479768">.</span><span class="ident" id="5479769">SetInt</span><span class="op" id="5479775">(</span><span class="ident" id="5479776">v</span><span class="op" id="5479777">)</span><br>
<span class="lineno"></span><span class="op" id="5479779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5479782">//&nbsp;decUint8&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint8&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5479857">func</span>&nbsp;<span class="ident" id="5479862">decUint8</span><span class="op" id="5479870">(</span><span class="ident" id="5479871">i</span>&nbsp;<span class="op" id="5479873">*</span><span class="ident" id="5479874">decInstr</span><span class="op" id="5479882">,</span>&nbsp;<span class="ident" id="5479884">state</span>&nbsp;<span class="op" id="5479890">*</span><span class="ident" id="5479891">decoderState</span><span class="op" id="5479903">,</span>&nbsp;<span class="ident" id="5479905">value</span>&nbsp;<span class="ident" id="5479911">reflect</span><span class="op" id="5479918">.</span><span class="ident" id="5479919">Value</span><span class="op" id="5479924">)</span>&nbsp;<span class="op" id="5479926">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5479929">v</span>&nbsp;<span class="op" id="5479931">:=</span>&nbsp;<span class="ident" id="5479934">state</span><span class="op" id="5479939">.</span><span class="ident" id="5479940">decodeUint</span><span class="op" id="5479950">(</span><span class="op" id="5479951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5479954">if</span>&nbsp;<span class="ident" id="5479957">math</span><span class="op" id="5479961">.</span><span class="ident" id="5479962">MaxUint8</span>&nbsp;<span class="op" id="5479971">&lt;</span>&nbsp;<span class="ident" id="5479973">v</span>&nbsp;<span class="op" id="5479975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5479979">error_</span><span class="op" id="5479985">(</span><span class="ident" id="5479986">i</span><span class="op" id="5479987">.</span><span class="ident" id="5479988">ovfl</span><span class="op" id="5479992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5479995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5479998">value</span><span class="op" id="5480003">.</span><span class="ident" id="5480004">SetUint</span><span class="op" id="5480011">(</span><span class="ident" id="5480012">v</span><span class="op" id="5480013">)</span><br>
<span class="lineno">250</span><span class="op" id="5480015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5480018">//&nbsp;decInt16&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5480085">func</span>&nbsp;<span class="ident" id="5480090">decInt16</span><span class="op" id="5480098">(</span><span class="ident" id="5480099">i</span>&nbsp;<span class="op" id="5480101">*</span><span class="ident" id="5480102">decInstr</span><span class="op" id="5480110">,</span>&nbsp;<span class="ident" id="5480112">state</span>&nbsp;<span class="op" id="5480118">*</span><span class="ident" id="5480119">decoderState</span><span class="op" id="5480131">,</span>&nbsp;<span class="ident" id="5480133">value</span>&nbsp;<span class="ident" id="5480139">reflect</span><span class="op" id="5480146">.</span><span class="ident" id="5480147">Value</span><span class="op" id="5480152">)</span>&nbsp;<span class="op" id="5480154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5480157">v</span>&nbsp;<span class="op" id="5480159">:=</span>&nbsp;<span class="ident" id="5480162">state</span><span class="op" id="5480167">.</span><span class="ident" id="5480168">decodeInt</span><span class="op" id="5480177">(</span><span class="op" id="5480178">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5480181">if</span>&nbsp;<span class="ident" id="5480184">v</span>&nbsp;<span class="op" id="5480186">&lt;</span>&nbsp;<span class="ident" id="5480188">math</span><span class="op" id="5480192">.</span><span class="ident" id="5480193">MinInt16</span>&nbsp;<span class="op" id="5480202">||</span>&nbsp;<span class="ident" id="5480205">math</span><span class="op" id="5480209">.</span><span class="ident" id="5480210">MaxInt16</span>&nbsp;<span class="op" id="5480219">&lt;</span>&nbsp;<span class="ident" id="5480221">v</span>&nbsp;<span class="op" id="5480223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5480227">error_</span><span class="op" id="5480233">(</span><span class="ident" id="5480234">i</span><span class="op" id="5480235">.</span><span class="ident" id="5480236">ovfl</span><span class="op" id="5480240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5480243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5480246">value</span><span class="op" id="5480251">.</span><span class="ident" id="5480252">SetInt</span><span class="op" id="5480258">(</span><span class="ident" id="5480259">v</span><span class="op" id="5480260">)</span><br>
<span class="lineno"></span><span class="op" id="5480262">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="5480265">//&nbsp;decUint16&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5480342">func</span>&nbsp;<span class="ident" id="5480347">decUint16</span><span class="op" id="5480356">(</span><span class="ident" id="5480357">i</span>&nbsp;<span class="op" id="5480359">*</span><span class="ident" id="5480360">decInstr</span><span class="op" id="5480368">,</span>&nbsp;<span class="ident" id="5480370">state</span>&nbsp;<span class="op" id="5480376">*</span><span class="ident" id="5480377">decoderState</span><span class="op" id="5480389">,</span>&nbsp;<span class="ident" id="5480391">value</span>&nbsp;<span class="ident" id="5480397">reflect</span><span class="op" id="5480404">.</span><span class="ident" id="5480405">Value</span><span class="op" id="5480410">)</span>&nbsp;<span class="op" id="5480412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5480415">v</span>&nbsp;<span class="op" id="5480417">:=</span>&nbsp;<span class="ident" id="5480420">state</span><span class="op" id="5480425">.</span><span class="ident" id="5480426">decodeUint</span><span class="op" id="5480436">(</span><span class="op" id="5480437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5480440">if</span>&nbsp;<span class="ident" id="5480443">math</span><span class="op" id="5480447">.</span><span class="ident" id="5480448">MaxUint16</span>&nbsp;<span class="op" id="5480458">&lt;</span>&nbsp;<span class="ident" id="5480460">v</span>&nbsp;<span class="op" id="5480462">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5480466">error_</span><span class="op" id="5480472">(</span><span class="ident" id="5480473">i</span><span class="op" id="5480474">.</span><span class="ident" id="5480475">ovfl</span><span class="op" id="5480479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5480482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5480485">value</span><span class="op" id="5480490">.</span><span class="ident" id="5480491">SetUint</span><span class="op" id="5480498">(</span><span class="ident" id="5480499">v</span><span class="op" id="5480500">)</span><br>
<span class="lineno"></span><span class="op" id="5480502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5480505">//&nbsp;decInt32&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int32&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5480572">func</span>&nbsp;<span class="ident" id="5480577">decInt32</span><span class="op" id="5480585">(</span><span class="ident" id="5480586">i</span>&nbsp;<span class="op" id="5480588">*</span><span class="ident" id="5480589">decInstr</span><span class="op" id="5480597">,</span>&nbsp;<span class="ident" id="5480599">state</span>&nbsp;<span class="op" id="5480605">*</span><span class="ident" id="5480606">decoderState</span><span class="op" id="5480618">,</span>&nbsp;<span class="ident" id="5480620">value</span>&nbsp;<span class="ident" id="5480626">reflect</span><span class="op" id="5480633">.</span><span class="ident" id="5480634">Value</span><span class="op" id="5480639">)</span>&nbsp;<span class="op" id="5480641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5480644">v</span>&nbsp;<span class="op" id="5480646">:=</span>&nbsp;<span class="ident" id="5480649">state</span><span class="op" id="5480654">.</span><span class="ident" id="5480655">decodeInt</span><span class="op" id="5480664">(</span><span class="op" id="5480665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5480668">if</span>&nbsp;<span class="ident" id="5480671">v</span>&nbsp;<span class="op" id="5480673">&lt;</span>&nbsp;<span class="ident" id="5480675">math</span><span class="op" id="5480679">.</span><span class="ident" id="5480680">MinInt32</span>&nbsp;<span class="op" id="5480689">||</span>&nbsp;<span class="ident" id="5480692">math</span><span class="op" id="5480696">.</span><span class="ident" id="5480697">MaxInt32</span>&nbsp;<span class="op" id="5480706">&lt;</span>&nbsp;<span class="ident" id="5480708">v</span>&nbsp;<span class="op" id="5480710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5480714">error_</span><span class="op" id="5480720">(</span><span class="ident" id="5480721">i</span><span class="op" id="5480722">.</span><span class="ident" id="5480723">ovfl</span><span class="op" id="5480727">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5480730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5480733">value</span><span class="op" id="5480738">.</span><span class="ident" id="5480739">SetInt</span><span class="op" id="5480745">(</span><span class="ident" id="5480746">v</span><span class="op" id="5480747">)</span><br>
<span class="lineno"></span><span class="op" id="5480749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5480752">//&nbsp;decUint32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint32&nbsp;in&nbsp;value.</span><br>
<span class="lineno">280</span><span class="keyword" id="5480829">func</span>&nbsp;<span class="ident" id="5480834">decUint32</span><span class="op" id="5480843">(</span><span class="ident" id="5480844">i</span>&nbsp;<span class="op" id="5480846">*</span><span class="ident" id="5480847">decInstr</span><span class="op" id="5480855">,</span>&nbsp;<span class="ident" id="5480857">state</span>&nbsp;<span class="op" id="5480863">*</span><span class="ident" id="5480864">decoderState</span><span class="op" id="5480876">,</span>&nbsp;<span class="ident" id="5480878">value</span>&nbsp;<span class="ident" id="5480884">reflect</span><span class="op" id="5480891">.</span><span class="ident" id="5480892">Value</span><span class="op" id="5480897">)</span>&nbsp;<span class="op" id="5480899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5480902">v</span>&nbsp;<span class="op" id="5480904">:=</span>&nbsp;<span class="ident" id="5480907">state</span><span class="op" id="5480912">.</span><span class="ident" id="5480913">decodeUint</span><span class="op" id="5480923">(</span><span class="op" id="5480924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5480927">if</span>&nbsp;<span class="ident" id="5480930">math</span><span class="op" id="5480934">.</span><span class="ident" id="5480935">MaxUint32</span>&nbsp;<span class="op" id="5480945">&lt;</span>&nbsp;<span class="ident" id="5480947">v</span>&nbsp;<span class="op" id="5480949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5480953">error_</span><span class="op" id="5480959">(</span><span class="ident" id="5480960">i</span><span class="op" id="5480961">.</span><span class="ident" id="5480962">ovfl</span><span class="op" id="5480966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5480969">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5480972">value</span><span class="op" id="5480977">.</span><span class="ident" id="5480978">SetUint</span><span class="op" id="5480985">(</span><span class="ident" id="5480986">v</span><span class="op" id="5480987">)</span><br>
<span class="lineno"></span><span class="op" id="5480989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5480992">//&nbsp;decInt64&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5481059">func</span>&nbsp;<span class="ident" id="5481064">decInt64</span><span class="op" id="5481072">(</span><span class="ident" id="5481073">i</span>&nbsp;<span class="op" id="5481075">*</span><span class="ident" id="5481076">decInstr</span><span class="op" id="5481084">,</span>&nbsp;<span class="ident" id="5481086">state</span>&nbsp;<span class="op" id="5481092">*</span><span class="ident" id="5481093">decoderState</span><span class="op" id="5481105">,</span>&nbsp;<span class="ident" id="5481107">value</span>&nbsp;<span class="ident" id="5481113">reflect</span><span class="op" id="5481120">.</span><span class="ident" id="5481121">Value</span><span class="op" id="5481126">)</span>&nbsp;<span class="op" id="5481128">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5481131">v</span>&nbsp;<span class="op" id="5481133">:=</span>&nbsp;<span class="ident" id="5481136">state</span><span class="op" id="5481141">.</span><span class="ident" id="5481142">decodeInt</span><span class="op" id="5481151">(</span><span class="op" id="5481152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5481155">value</span><span class="op" id="5481160">.</span><span class="ident" id="5481161">SetInt</span><span class="op" id="5481167">(</span><span class="ident" id="5481168">v</span><span class="op" id="5481169">)</span><br>
<span class="lineno"></span><span class="op" id="5481171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5481174">//&nbsp;decUint64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64&nbsp;in&nbsp;value.</span><br>
<span class="lineno">295</span><span class="keyword" id="5481251">func</span>&nbsp;<span class="ident" id="5481256">decUint64</span><span class="op" id="5481265">(</span><span class="ident" id="5481266">i</span>&nbsp;<span class="op" id="5481268">*</span><span class="ident" id="5481269">decInstr</span><span class="op" id="5481277">,</span>&nbsp;<span class="ident" id="5481279">state</span>&nbsp;<span class="op" id="5481285">*</span><span class="ident" id="5481286">decoderState</span><span class="op" id="5481298">,</span>&nbsp;<span class="ident" id="5481300">value</span>&nbsp;<span class="ident" id="5481306">reflect</span><span class="op" id="5481313">.</span><span class="ident" id="5481314">Value</span><span class="op" id="5481319">)</span>&nbsp;<span class="op" id="5481321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5481324">v</span>&nbsp;<span class="op" id="5481326">:=</span>&nbsp;<span class="ident" id="5481329">state</span><span class="op" id="5481334">.</span><span class="ident" id="5481335">decodeUint</span><span class="op" id="5481345">(</span><span class="op" id="5481346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5481349">value</span><span class="op" id="5481354">.</span><span class="ident" id="5481355">SetUint</span><span class="op" id="5481362">(</span><span class="ident" id="5481363">v</span><span class="op" id="5481364">)</span><br>
<span class="lineno"></span><span class="op" id="5481366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="5481369">//&nbsp;Floating-point&nbsp;numbers&nbsp;are&nbsp;transmitted&nbsp;as&nbsp;uint64s&nbsp;holding&nbsp;the&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="5481439">//&nbsp;of&nbsp;the&nbsp;underlying&nbsp;representation.&nbsp;&nbsp;They&nbsp;are&nbsp;sent&nbsp;byte-reversed,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5481511">//&nbsp;the&nbsp;exponent&nbsp;end&nbsp;coming&nbsp;out&nbsp;first,&nbsp;so&nbsp;integer&nbsp;floating&nbsp;point&nbsp;numbers</span><br>
<span class="lineno"></span><span class="comment" id="5481583">//&nbsp;(for&nbsp;example)&nbsp;transmit&nbsp;more&nbsp;compactly.&nbsp;&nbsp;This&nbsp;routine&nbsp;does&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5481648">//&nbsp;unswizzling.</span><br>
<span class="lineno">305</span><span class="keyword" id="5481664">func</span>&nbsp;<span class="ident" id="5481669">float64FromBits</span><span class="op" id="5481684">(</span><span class="ident" id="5481685">u</span>&nbsp;<span class="ident" id="5481687">uint64</span><span class="op" id="5481693">)</span>&nbsp;<span class="builtintype" id="5481695">float64</span>&nbsp;<span class="op" id="5481703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5481706">var</span>&nbsp;<span class="ident" id="5481710">v</span>&nbsp;<span class="ident" id="5481712">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5481720">for</span>&nbsp;<span class="ident" id="5481724">i</span>&nbsp;<span class="op" id="5481726">:=</span>&nbsp;<span class="num" id="5481729">0</span><span class="op" id="5481730">;</span>&nbsp;<span class="ident" id="5481732">i</span>&nbsp;<span class="op" id="5481734">&lt;</span>&nbsp;<span class="num" id="5481736">8</span><span class="op" id="5481737">;</span>&nbsp;<span class="ident" id="5481739">i</span><span class="op" id="5481740">++</span>&nbsp;<span class="op" id="5481743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5481747">v</span>&nbsp;<span class="op" id="5481749">&lt;&lt;=</span>&nbsp;<span class="num" id="5481753">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5481757">v</span>&nbsp;<span class="op" id="5481759">|=</span>&nbsp;<span class="ident" id="5481762">u</span>&nbsp;<span class="op" id="5481764">&amp;</span>&nbsp;<span class="num" id="5481766">0xFF</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5481773">u</span>&nbsp;<span class="op" id="5481775">&gt;&gt;=</span>&nbsp;<span class="num" id="5481779">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5481782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5481785">return</span>&nbsp;<span class="ident" id="5481792">math</span><span class="op" id="5481796">.</span><span class="ident" id="5481797">Float64frombits</span><span class="op" id="5481812">(</span><span class="ident" id="5481813">v</span><span class="op" id="5481814">)</span><br>
<span class="lineno"></span><span class="op" id="5481816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="5481819">//&nbsp;float32FromBits&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="5481904">//&nbsp;number,&nbsp;and&nbsp;returns&nbsp;it.&nbsp;It&#39;s&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;float32&nbsp;and&nbsp;complex64.</span><br>
<span class="lineno"></span><span class="comment" id="5481981">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;float64&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;reflection&nbsp;needs,&nbsp;but&nbsp;its&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5482058">//&nbsp;value&nbsp;is&nbsp;known&nbsp;to&nbsp;be&nbsp;accurately&nbsp;representable&nbsp;in&nbsp;a&nbsp;float32.</span><br>
<span class="lineno"></span><span class="keyword" id="5482121">func</span>&nbsp;<span class="ident" id="5482126">float32FromBits</span><span class="op" id="5482141">(</span><span class="ident" id="5482142">u</span>&nbsp;<span class="ident" id="5482144">uint64</span><span class="op" id="5482150">,</span>&nbsp;<span class="ident" id="5482152">ovfl</span>&nbsp;<span class="builtintype" id="5482157">error</span><span class="op" id="5482162">)</span>&nbsp;<span class="builtintype" id="5482164">float64</span>&nbsp;<span class="op" id="5482172">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5482175">v</span>&nbsp;<span class="op" id="5482177">:=</span>&nbsp;<span class="ident" id="5482180">float64FromBits</span><span class="op" id="5482195">(</span><span class="ident" id="5482196">u</span><span class="op" id="5482197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5482200">av</span>&nbsp;<span class="op" id="5482203">:=</span>&nbsp;<span class="ident" id="5482206">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5482209">if</span>&nbsp;<span class="ident" id="5482212">av</span>&nbsp;<span class="op" id="5482215">&lt;</span>&nbsp;<span class="num" id="5482217">0</span>&nbsp;<span class="op" id="5482219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5482223">av</span>&nbsp;<span class="op" id="5482226">=</span>&nbsp;<span class="op" id="5482228">-</span><span class="ident" id="5482229">av</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5482233">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5482236">//&nbsp;+Inf&nbsp;is&nbsp;OK&nbsp;in&nbsp;both&nbsp;32-&nbsp;and&nbsp;64-bit&nbsp;floats.&nbsp;&nbsp;Underflow&nbsp;is&nbsp;always&nbsp;OK.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5482307">if</span>&nbsp;<span class="ident" id="5482310">math</span><span class="op" id="5482314">.</span><span class="ident" id="5482315">MaxFloat32</span>&nbsp;<span class="op" id="5482326">&lt;</span>&nbsp;<span class="ident" id="5482328">av</span>&nbsp;<span class="op" id="5482331">&amp;&amp;</span>&nbsp;<span class="ident" id="5482334">av</span>&nbsp;<span class="op" id="5482337">&lt;=</span>&nbsp;<span class="ident" id="5482340">math</span><span class="op" id="5482344">.</span><span class="ident" id="5482345">MaxFloat64</span>&nbsp;<span class="op" id="5482356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5482360">error_</span><span class="op" id="5482366">(</span><span class="ident" id="5482367">ovfl</span><span class="op" id="5482371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5482374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5482377">return</span>&nbsp;<span class="ident" id="5482384">v</span><br>
<span class="lineno">330</span><span class="op" id="5482386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5482389">//&nbsp;decFloat32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="5482469">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5482504">func</span>&nbsp;<span class="ident" id="5482509">decFloat32</span><span class="op" id="5482519">(</span><span class="ident" id="5482520">i</span>&nbsp;<span class="op" id="5482522">*</span><span class="ident" id="5482523">decInstr</span><span class="op" id="5482531">,</span>&nbsp;<span class="ident" id="5482533">state</span>&nbsp;<span class="op" id="5482539">*</span><span class="ident" id="5482540">decoderState</span><span class="op" id="5482552">,</span>&nbsp;<span class="ident" id="5482554">value</span>&nbsp;<span class="ident" id="5482560">reflect</span><span class="op" id="5482567">.</span><span class="ident" id="5482568">Value</span><span class="op" id="5482573">)</span>&nbsp;<span class="op" id="5482575">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5482578">value</span><span class="op" id="5482583">.</span><span class="ident" id="5482584">SetFloat</span><span class="op" id="5482592">(</span><span class="ident" id="5482593">float32FromBits</span><span class="op" id="5482608">(</span><span class="ident" id="5482609">state</span><span class="op" id="5482614">.</span><span class="ident" id="5482615">decodeUint</span><span class="op" id="5482625">(</span><span class="op" id="5482626">)</span><span class="op" id="5482627">,</span>&nbsp;<span class="ident" id="5482629">i</span><span class="op" id="5482630">.</span><span class="ident" id="5482631">ovfl</span><span class="op" id="5482635">)</span><span class="op" id="5482636">)</span><br>
<span class="lineno"></span><span class="op" id="5482638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5482641">//&nbsp;decFloat64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;64-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="5482721">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">340</span><span class="keyword" id="5482756">func</span>&nbsp;<span class="ident" id="5482761">decFloat64</span><span class="op" id="5482771">(</span><span class="ident" id="5482772">i</span>&nbsp;<span class="op" id="5482774">*</span><span class="ident" id="5482775">decInstr</span><span class="op" id="5482783">,</span>&nbsp;<span class="ident" id="5482785">state</span>&nbsp;<span class="op" id="5482791">*</span><span class="ident" id="5482792">decoderState</span><span class="op" id="5482804">,</span>&nbsp;<span class="ident" id="5482806">value</span>&nbsp;<span class="ident" id="5482812">reflect</span><span class="op" id="5482819">.</span><span class="ident" id="5482820">Value</span><span class="op" id="5482825">)</span>&nbsp;<span class="op" id="5482827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5482830">value</span><span class="op" id="5482835">.</span><span class="ident" id="5482836">SetFloat</span><span class="op" id="5482844">(</span><span class="ident" id="5482845">float64FromBits</span><span class="op" id="5482860">(</span><span class="ident" id="5482861">state</span><span class="op" id="5482866">.</span><span class="ident" id="5482867">decodeUint</span><span class="op" id="5482877">(</span><span class="op" id="5482878">)</span><span class="op" id="5482879">)</span><span class="op" id="5482880">)</span><br>
<span class="lineno"></span><span class="op" id="5482882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5482885">//&nbsp;decComplex64&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno">345</span><span class="comment" id="5482955">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5483031">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="5483061">func</span>&nbsp;<span class="ident" id="5483066">decComplex64</span><span class="op" id="5483078">(</span><span class="ident" id="5483079">i</span>&nbsp;<span class="op" id="5483081">*</span><span class="ident" id="5483082">decInstr</span><span class="op" id="5483090">,</span>&nbsp;<span class="ident" id="5483092">state</span>&nbsp;<span class="op" id="5483098">*</span><span class="ident" id="5483099">decoderState</span><span class="op" id="5483111">,</span>&nbsp;<span class="ident" id="5483113">value</span>&nbsp;<span class="ident" id="5483119">reflect</span><span class="op" id="5483126">.</span><span class="ident" id="5483127">Value</span><span class="op" id="5483132">)</span>&nbsp;<span class="op" id="5483134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5483137">real</span>&nbsp;<span class="op" id="5483142">:=</span>&nbsp;<span class="ident" id="5483145">float32FromBits</span><span class="op" id="5483160">(</span><span class="ident" id="5483161">state</span><span class="op" id="5483166">.</span><span class="ident" id="5483167">decodeUint</span><span class="op" id="5483177">(</span><span class="op" id="5483178">)</span><span class="op" id="5483179">,</span>&nbsp;<span class="ident" id="5483181">i</span><span class="op" id="5483182">.</span><span class="ident" id="5483183">ovfl</span><span class="op" id="5483187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5483190">imag</span>&nbsp;<span class="op" id="5483195">:=</span>&nbsp;<span class="ident" id="5483198">float32FromBits</span><span class="op" id="5483213">(</span><span class="ident" id="5483214">state</span><span class="op" id="5483219">.</span><span class="ident" id="5483220">decodeUint</span><span class="op" id="5483230">(</span><span class="op" id="5483231">)</span><span class="op" id="5483232">,</span>&nbsp;<span class="ident" id="5483234">i</span><span class="op" id="5483235">.</span><span class="ident" id="5483236">ovfl</span><span class="op" id="5483240">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5483243">value</span><span class="op" id="5483248">.</span><span class="ident" id="5483249">SetComplex</span><span class="op" id="5483259">(</span><span class="builtinfunc" id="5483260">complex</span><span class="op" id="5483267">(</span><span class="builtinfunc" id="5483268">real</span><span class="op" id="5483272">,</span>&nbsp;<span class="builtinfunc" id="5483274">imag</span><span class="op" id="5483278">)</span><span class="op" id="5483279">)</span><br>
<span class="lineno"></span><span class="op" id="5483281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5483284">//&nbsp;decComplex128&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5483355">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex128&nbsp;in&nbsp;value.</span><br>
<span class="lineno">355</span><span class="comment" id="5483432">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="5483462">func</span>&nbsp;<span class="ident" id="5483467">decComplex128</span><span class="op" id="5483480">(</span><span class="ident" id="5483481">i</span>&nbsp;<span class="op" id="5483483">*</span><span class="ident" id="5483484">decInstr</span><span class="op" id="5483492">,</span>&nbsp;<span class="ident" id="5483494">state</span>&nbsp;<span class="op" id="5483500">*</span><span class="ident" id="5483501">decoderState</span><span class="op" id="5483513">,</span>&nbsp;<span class="ident" id="5483515">value</span>&nbsp;<span class="ident" id="5483521">reflect</span><span class="op" id="5483528">.</span><span class="ident" id="5483529">Value</span><span class="op" id="5483534">)</span>&nbsp;<span class="op" id="5483536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5483539">real</span>&nbsp;<span class="op" id="5483544">:=</span>&nbsp;<span class="ident" id="5483547">float64FromBits</span><span class="op" id="5483562">(</span><span class="ident" id="5483563">state</span><span class="op" id="5483568">.</span><span class="ident" id="5483569">decodeUint</span><span class="op" id="5483579">(</span><span class="op" id="5483580">)</span><span class="op" id="5483581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5483584">imag</span>&nbsp;<span class="op" id="5483589">:=</span>&nbsp;<span class="ident" id="5483592">float64FromBits</span><span class="op" id="5483607">(</span><span class="ident" id="5483608">state</span><span class="op" id="5483613">.</span><span class="ident" id="5483614">decodeUint</span><span class="op" id="5483624">(</span><span class="op" id="5483625">)</span><span class="op" id="5483626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5483629">value</span><span class="op" id="5483634">.</span><span class="ident" id="5483635">SetComplex</span><span class="op" id="5483645">(</span><span class="builtinfunc" id="5483646">complex</span><span class="op" id="5483653">(</span><span class="builtinfunc" id="5483654">real</span><span class="op" id="5483658">,</span>&nbsp;<span class="builtinfunc" id="5483660">imag</span><span class="op" id="5483664">)</span><span class="op" id="5483665">)</span><br>
<span class="lineno">360</span><span class="op" id="5483667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5483670">//&nbsp;decUint8Slice&nbsp;decodes&nbsp;a&nbsp;byte&nbsp;slice&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;slice&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5483743">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5483767">//&nbsp;uint8&nbsp;slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">365</span><span class="keyword" id="5483843">func</span>&nbsp;<span class="ident" id="5483848">decUint8Slice</span><span class="op" id="5483861">(</span><span class="ident" id="5483862">i</span>&nbsp;<span class="op" id="5483864">*</span><span class="ident" id="5483865">decInstr</span><span class="op" id="5483873">,</span>&nbsp;<span class="ident" id="5483875">state</span>&nbsp;<span class="op" id="5483881">*</span><span class="ident" id="5483882">decoderState</span><span class="op" id="5483894">,</span>&nbsp;<span class="ident" id="5483896">value</span>&nbsp;<span class="ident" id="5483902">reflect</span><span class="op" id="5483909">.</span><span class="ident" id="5483910">Value</span><span class="op" id="5483915">)</span>&nbsp;<span class="op" id="5483917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5483920">u</span>&nbsp;<span class="op" id="5483922">:=</span>&nbsp;<span class="ident" id="5483925">state</span><span class="op" id="5483930">.</span><span class="ident" id="5483931">decodeUint</span><span class="op" id="5483941">(</span><span class="op" id="5483942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5483945">n</span>&nbsp;<span class="op" id="5483947">:=</span>&nbsp;<span class="builtintype" id="5483950">int</span><span class="op" id="5483953">(</span><span class="ident" id="5483954">u</span><span class="op" id="5483955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5483958">if</span>&nbsp;<span class="ident" id="5483961">n</span>&nbsp;<span class="op" id="5483963">&lt;</span>&nbsp;<span class="num" id="5483965">0</span>&nbsp;<span class="op" id="5483967">||</span>&nbsp;<span class="ident" id="5483970">uint64</span><span class="op" id="5483976">(</span><span class="ident" id="5483977">n</span><span class="op" id="5483978">)</span>&nbsp;<span class="op" id="5483980">!=</span>&nbsp;<span class="ident" id="5483983">u</span>&nbsp;<span class="op" id="5483985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5483989">errorf</span><span class="op" id="5483995">(</span><span class="string" id="5483996">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="5484040">,</span>&nbsp;<span class="ident" id="5484042">value</span><span class="op" id="5484047">.</span><span class="ident" id="5484048">Type</span><span class="op" id="5484052">(</span><span class="op" id="5484053">)</span><span class="op" id="5484054">,</span>&nbsp;<span class="ident" id="5484056">u</span><span class="op" id="5484057">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5484060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5484063">if</span>&nbsp;<span class="ident" id="5484066">n</span>&nbsp;<span class="op" id="5484068">&gt;</span>&nbsp;<span class="ident" id="5484070">state</span><span class="op" id="5484075">.</span><span class="ident" id="5484076">b</span><span class="op" id="5484077">.</span><span class="ident" id="5484078">Len</span><span class="op" id="5484081">(</span><span class="op" id="5484082">)</span>&nbsp;<span class="op" id="5484084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5484088">errorf</span><span class="op" id="5484094">(</span><span class="string" id="5484095">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="5484128">,</span>&nbsp;<span class="ident" id="5484130">value</span><span class="op" id="5484135">.</span><span class="ident" id="5484136">Type</span><span class="op" id="5484140">(</span><span class="op" id="5484141">)</span><span class="op" id="5484142">,</span>&nbsp;<span class="ident" id="5484144">n</span><span class="op" id="5484145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5484148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5484151">if</span>&nbsp;<span class="ident" id="5484154">n</span>&nbsp;<span class="op" id="5484156">&gt;</span>&nbsp;<span class="ident" id="5484158">tooBig</span>&nbsp;<span class="op" id="5484165">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5484169">errorf</span><span class="op" id="5484175">(</span><span class="string" id="5484176">&#34;byte&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&#34;</span><span class="op" id="5484200">,</span>&nbsp;<span class="ident" id="5484202">n</span><span class="op" id="5484203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5484206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5484209">if</span>&nbsp;<span class="ident" id="5484212">value</span><span class="op" id="5484217">.</span><span class="ident" id="5484218">Cap</span><span class="op" id="5484221">(</span><span class="op" id="5484222">)</span>&nbsp;<span class="op" id="5484224">&lt;</span>&nbsp;<span class="ident" id="5484226">n</span>&nbsp;<span class="op" id="5484228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5484232">value</span><span class="op" id="5484237">.</span><span class="ident" id="5484238">Set</span><span class="op" id="5484241">(</span><span class="ident" id="5484242">reflect</span><span class="op" id="5484249">.</span><span class="ident" id="5484250">MakeSlice</span><span class="op" id="5484259">(</span><span class="ident" id="5484260">value</span><span class="op" id="5484265">.</span><span class="ident" id="5484266">Type</span><span class="op" id="5484270">(</span><span class="op" id="5484271">)</span><span class="op" id="5484272">,</span>&nbsp;<span class="ident" id="5484274">n</span><span class="op" id="5484275">,</span>&nbsp;<span class="ident" id="5484277">n</span><span class="op" id="5484278">)</span><span class="op" id="5484279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5484282">}</span>&nbsp;<span class="keyword" id="5484284">else</span>&nbsp;<span class="op" id="5484289">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5484293">value</span><span class="op" id="5484298">.</span><span class="ident" id="5484299">Set</span><span class="op" id="5484302">(</span><span class="ident" id="5484303">value</span><span class="op" id="5484308">.</span><span class="ident" id="5484309">Slice</span><span class="op" id="5484314">(</span><span class="num" id="5484315">0</span><span class="op" id="5484316">,</span>&nbsp;<span class="ident" id="5484318">n</span><span class="op" id="5484319">)</span><span class="op" id="5484320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5484323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5484326">if</span>&nbsp;<span class="ident" id="5484329">_</span><span class="op" id="5484330">,</span>&nbsp;<span class="ident" id="5484332">err</span>&nbsp;<span class="op" id="5484336">:=</span>&nbsp;<span class="ident" id="5484339">state</span><span class="op" id="5484344">.</span><span class="ident" id="5484345">b</span><span class="op" id="5484346">.</span><span class="ident" id="5484347">Read</span><span class="op" id="5484351">(</span><span class="ident" id="5484352">value</span><span class="op" id="5484357">.</span><span class="ident" id="5484358">Bytes</span><span class="op" id="5484363">(</span><span class="op" id="5484364">)</span><span class="op" id="5484365">)</span><span class="op" id="5484366">;</span>&nbsp;<span class="ident" id="5484368">err</span>&nbsp;<span class="op" id="5484372">!=</span>&nbsp;<span class="builtintype" id="5484375">nil</span>&nbsp;<span class="op" id="5484379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5484383">errorf</span><span class="op" id="5484389">(</span><span class="string" id="5484390">&#34;error&nbsp;decoding&nbsp;[]byte:&nbsp;%s&#34;</span><span class="op" id="5484417">,</span>&nbsp;<span class="ident" id="5484419">err</span><span class="op" id="5484422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5484425">}</span><br>
<span class="lineno">385</span><span class="op" id="5484427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5484430">//&nbsp;decString&nbsp;decodes&nbsp;byte&nbsp;array&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;string&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5484498">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5484522">//&nbsp;Strings&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">390</span><span class="keyword" id="5484593">func</span>&nbsp;<span class="ident" id="5484598">decString</span><span class="op" id="5484607">(</span><span class="ident" id="5484608">i</span>&nbsp;<span class="op" id="5484610">*</span><span class="ident" id="5484611">decInstr</span><span class="op" id="5484619">,</span>&nbsp;<span class="ident" id="5484621">state</span>&nbsp;<span class="op" id="5484627">*</span><span class="ident" id="5484628">decoderState</span><span class="op" id="5484640">,</span>&nbsp;<span class="ident" id="5484642">value</span>&nbsp;<span class="ident" id="5484648">reflect</span><span class="op" id="5484655">.</span><span class="ident" id="5484656">Value</span><span class="op" id="5484661">)</span>&nbsp;<span class="op" id="5484663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5484666">u</span>&nbsp;<span class="op" id="5484668">:=</span>&nbsp;<span class="ident" id="5484671">state</span><span class="op" id="5484676">.</span><span class="ident" id="5484677">decodeUint</span><span class="op" id="5484687">(</span><span class="op" id="5484688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5484691">n</span>&nbsp;<span class="op" id="5484693">:=</span>&nbsp;<span class="builtintype" id="5484696">int</span><span class="op" id="5484699">(</span><span class="ident" id="5484700">u</span><span class="op" id="5484701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5484704">if</span>&nbsp;<span class="ident" id="5484707">n</span>&nbsp;<span class="op" id="5484709">&lt;</span>&nbsp;<span class="num" id="5484711">0</span>&nbsp;<span class="op" id="5484713">||</span>&nbsp;<span class="ident" id="5484716">uint64</span><span class="op" id="5484722">(</span><span class="ident" id="5484723">n</span><span class="op" id="5484724">)</span>&nbsp;<span class="op" id="5484726">!=</span>&nbsp;<span class="ident" id="5484729">u</span>&nbsp;<span class="op" id="5484731">||</span>&nbsp;<span class="ident" id="5484734">n</span>&nbsp;<span class="op" id="5484736">&gt;</span>&nbsp;<span class="ident" id="5484738">state</span><span class="op" id="5484743">.</span><span class="ident" id="5484744">b</span><span class="op" id="5484745">.</span><span class="ident" id="5484746">Len</span><span class="op" id="5484749">(</span><span class="op" id="5484750">)</span>&nbsp;<span class="op" id="5484752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5484756">errorf</span><span class="op" id="5484762">(</span><span class="string" id="5484763">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="5484807">,</span>&nbsp;<span class="ident" id="5484809">value</span><span class="op" id="5484814">.</span><span class="ident" id="5484815">Type</span><span class="op" id="5484819">(</span><span class="op" id="5484820">)</span><span class="op" id="5484821">,</span>&nbsp;<span class="ident" id="5484823">u</span><span class="op" id="5484824">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5484827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5484830">if</span>&nbsp;<span class="ident" id="5484833">n</span>&nbsp;<span class="op" id="5484835">&gt;</span>&nbsp;<span class="ident" id="5484837">state</span><span class="op" id="5484842">.</span><span class="ident" id="5484843">b</span><span class="op" id="5484844">.</span><span class="ident" id="5484845">Len</span><span class="op" id="5484848">(</span><span class="op" id="5484849">)</span>&nbsp;<span class="op" id="5484851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5484855">errorf</span><span class="op" id="5484861">(</span><span class="string" id="5484862">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="5484895">,</span>&nbsp;<span class="ident" id="5484897">value</span><span class="op" id="5484902">.</span><span class="ident" id="5484903">Type</span><span class="op" id="5484907">(</span><span class="op" id="5484908">)</span><span class="op" id="5484909">,</span>&nbsp;<span class="ident" id="5484911">n</span><span class="op" id="5484912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5484915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5484918">//&nbsp;Read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5484937">data</span>&nbsp;<span class="op" id="5484942">:=</span>&nbsp;<span class="builtinfunc" id="5484945">make</span><span class="op" id="5484949">(</span><span class="op" id="5484950">[</span><span class="op" id="5484951">]</span><span class="builtintype" id="5484952">byte</span><span class="op" id="5484956">,</span>&nbsp;<span class="ident" id="5484958">n</span><span class="op" id="5484959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5484962">if</span>&nbsp;<span class="ident" id="5484965">_</span><span class="op" id="5484966">,</span>&nbsp;<span class="ident" id="5484968">err</span>&nbsp;<span class="op" id="5484972">:=</span>&nbsp;<span class="ident" id="5484975">state</span><span class="op" id="5484980">.</span><span class="ident" id="5484981">b</span><span class="op" id="5484982">.</span><span class="ident" id="5484983">Read</span><span class="op" id="5484987">(</span><span class="ident" id="5484988">data</span><span class="op" id="5484992">)</span><span class="op" id="5484993">;</span>&nbsp;<span class="ident" id="5484995">err</span>&nbsp;<span class="op" id="5484999">!=</span>&nbsp;<span class="builtintype" id="5485002">nil</span>&nbsp;<span class="op" id="5485006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5485010">errorf</span><span class="op" id="5485016">(</span><span class="string" id="5485017">&#34;error&nbsp;decoding&nbsp;string:&nbsp;%s&#34;</span><span class="op" id="5485044">,</span>&nbsp;<span class="ident" id="5485046">err</span><span class="op" id="5485049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5485052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5485055">value</span><span class="op" id="5485060">.</span><span class="ident" id="5485061">SetString</span><span class="op" id="5485070">(</span><span class="builtintype" id="5485071">string</span><span class="op" id="5485077">(</span><span class="ident" id="5485078">data</span><span class="op" id="5485082">)</span><span class="op" id="5485083">)</span><br>
<span class="lineno">405</span><span class="op" id="5485085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5485088">//&nbsp;ignoreUint8Array&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;byte&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5485172">func</span>&nbsp;<span class="ident" id="5485177">ignoreUint8Array</span><span class="op" id="5485193">(</span><span class="ident" id="5485194">i</span>&nbsp;<span class="op" id="5485196">*</span><span class="ident" id="5485197">decInstr</span><span class="op" id="5485205">,</span>&nbsp;<span class="ident" id="5485207">state</span>&nbsp;<span class="op" id="5485213">*</span><span class="ident" id="5485214">decoderState</span><span class="op" id="5485226">,</span>&nbsp;<span class="ident" id="5485228">value</span>&nbsp;<span class="ident" id="5485234">reflect</span><span class="op" id="5485241">.</span><span class="ident" id="5485242">Value</span><span class="op" id="5485247">)</span>&nbsp;<span class="op" id="5485249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5485252">b</span>&nbsp;<span class="op" id="5485254">:=</span>&nbsp;<span class="builtinfunc" id="5485257">make</span><span class="op" id="5485261">(</span><span class="op" id="5485262">[</span><span class="op" id="5485263">]</span><span class="builtintype" id="5485264">byte</span><span class="op" id="5485268">,</span>&nbsp;<span class="ident" id="5485270">state</span><span class="op" id="5485275">.</span><span class="ident" id="5485276">decodeUint</span><span class="op" id="5485286">(</span><span class="op" id="5485287">)</span><span class="op" id="5485288">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5485291">state</span><span class="op" id="5485296">.</span><span class="ident" id="5485297">b</span><span class="op" id="5485298">.</span><span class="ident" id="5485299">Read</span><span class="op" id="5485303">(</span><span class="ident" id="5485304">b</span><span class="op" id="5485305">)</span><br>
<span class="lineno"></span><span class="op" id="5485307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5485310">//&nbsp;Execution&nbsp;engine</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="5485331">//&nbsp;The&nbsp;encoder&nbsp;engine&nbsp;is&nbsp;an&nbsp;array&nbsp;of&nbsp;instructions&nbsp;indexed&nbsp;by&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="5485421">//&nbsp;decoder.&nbsp;&nbsp;It&nbsp;is&nbsp;executed&nbsp;with&nbsp;random&nbsp;access&nbsp;according&nbsp;to&nbsp;field&nbsp;number.</span><br>
<span class="lineno"></span><span class="keyword" id="5485495">type</span>&nbsp;<span class="ident" id="5485500">decEngine</span>&nbsp;<span class="keyword" id="5485510">struct</span>&nbsp;<span class="op" id="5485517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5485520">instr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5485529">[</span><span class="op" id="5485530">]</span><span class="ident" id="5485531">decInstr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5485541">numInstr</span>&nbsp;<span class="builtintype" id="5485550">int</span>&nbsp;<span class="comment" id="5485554">//&nbsp;the&nbsp;number&nbsp;of&nbsp;active&nbsp;instructions</span><br>
<span class="lineno">420</span><span class="op" id="5485591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5485594">//&nbsp;decodeSingle&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;value&nbsp;that&nbsp;is&nbsp;not&nbsp;a&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5485681">//&nbsp;Such&nbsp;values&nbsp;are&nbsp;preceded&nbsp;by&nbsp;a&nbsp;zero,&nbsp;making&nbsp;them&nbsp;have&nbsp;the&nbsp;memory&nbsp;layout&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5485760">//&nbsp;struct&nbsp;field&nbsp;(although&nbsp;with&nbsp;an&nbsp;illegal&nbsp;field&nbsp;number).</span><br>
<span class="lineno">425</span><span class="keyword" id="5485817">func</span>&nbsp;<span class="op" id="5485822">(</span><span class="ident" id="5485823">dec</span>&nbsp;<span class="op" id="5485827">*</span><span class="ident" id="5485828">Decoder</span><span class="op" id="5485835">)</span>&nbsp;<span class="ident" id="5485837">decodeSingle</span><span class="op" id="5485849">(</span><span class="ident" id="5485850">engine</span>&nbsp;<span class="op" id="5485857">*</span><span class="ident" id="5485858">decEngine</span><span class="op" id="5485867">,</span>&nbsp;<span class="ident" id="5485869">ut</span>&nbsp;<span class="op" id="5485872">*</span><span class="ident" id="5485873">userTypeInfo</span><span class="op" id="5485885">,</span>&nbsp;<span class="ident" id="5485887">value</span>&nbsp;<span class="ident" id="5485893">reflect</span><span class="op" id="5485900">.</span><span class="ident" id="5485901">Value</span><span class="op" id="5485906">)</span>&nbsp;<span class="op" id="5485908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5485911">state</span>&nbsp;<span class="op" id="5485917">:=</span>&nbsp;<span class="ident" id="5485920">dec</span><span class="op" id="5485923">.</span><span class="ident" id="5485924">newDecoderState</span><span class="op" id="5485939">(</span><span class="op" id="5485940">&amp;</span><span class="ident" id="5485941">dec</span><span class="op" id="5485944">.</span><span class="ident" id="5485945">buf</span><span class="op" id="5485948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5485951">defer</span>&nbsp;<span class="ident" id="5485957">dec</span><span class="op" id="5485960">.</span><span class="ident" id="5485961">freeDecoderState</span><span class="op" id="5485977">(</span><span class="ident" id="5485978">state</span><span class="op" id="5485983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5485986">state</span><span class="op" id="5485991">.</span><span class="ident" id="5485992">fieldnum</span>&nbsp;<span class="op" id="5486001">=</span>&nbsp;<span class="ident" id="5486003">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5486019">if</span>&nbsp;<span class="ident" id="5486022">state</span><span class="op" id="5486027">.</span><span class="ident" id="5486028">decodeUint</span><span class="op" id="5486038">(</span><span class="op" id="5486039">)</span>&nbsp;<span class="op" id="5486041">!=</span>&nbsp;<span class="num" id="5486044">0</span>&nbsp;<span class="op" id="5486046">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5486050">errorf</span><span class="op" id="5486056">(</span><span class="string" id="5486057">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="5486111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5486114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5486117">instr</span>&nbsp;<span class="op" id="5486123">:=</span>&nbsp;<span class="op" id="5486126">&amp;</span><span class="ident" id="5486127">engine</span><span class="op" id="5486133">.</span><span class="ident" id="5486134">instr</span><span class="op" id="5486139">[</span><span class="ident" id="5486140">singletonField</span><span class="op" id="5486154">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5486157">instr</span><span class="op" id="5486162">.</span><span class="ident" id="5486163">op</span><span class="op" id="5486165">(</span><span class="ident" id="5486166">instr</span><span class="op" id="5486171">,</span>&nbsp;<span class="ident" id="5486173">state</span><span class="op" id="5486178">,</span>&nbsp;<span class="ident" id="5486180">value</span><span class="op" id="5486185">)</span><br>
<span class="lineno"></span><span class="op" id="5486187">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="5486190">//&nbsp;decodeStruct&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5486257">//&nbsp;Indir&nbsp;is&nbsp;for&nbsp;the&nbsp;value,&nbsp;not&nbsp;the&nbsp;type.&nbsp;&nbsp;At&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;call&nbsp;it&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="5486330">//&nbsp;differ&nbsp;from&nbsp;ut.indir,&nbsp;which&nbsp;was&nbsp;computed&nbsp;when&nbsp;the&nbsp;engine&nbsp;was&nbsp;built.</span><br>
<span class="lineno"></span><span class="comment" id="5486401">//&nbsp;This&nbsp;state&nbsp;cannot&nbsp;arise&nbsp;for&nbsp;decodeSingle,&nbsp;which&nbsp;is&nbsp;called&nbsp;directly</span><br>
<span class="lineno">440</span><span class="comment" id="5486471">//&nbsp;from&nbsp;the&nbsp;user&#39;s&nbsp;value,&nbsp;not&nbsp;from&nbsp;the&nbsp;innards&nbsp;of&nbsp;an&nbsp;engine.</span><br>
<span class="lineno"></span><span class="keyword" id="5486532">func</span>&nbsp;<span class="op" id="5486537">(</span><span class="ident" id="5486538">dec</span>&nbsp;<span class="op" id="5486542">*</span><span class="ident" id="5486543">Decoder</span><span class="op" id="5486550">)</span>&nbsp;<span class="ident" id="5486552">decodeStruct</span><span class="op" id="5486564">(</span><span class="ident" id="5486565">engine</span>&nbsp;<span class="op" id="5486572">*</span><span class="ident" id="5486573">decEngine</span><span class="op" id="5486582">,</span>&nbsp;<span class="ident" id="5486584">ut</span>&nbsp;<span class="op" id="5486587">*</span><span class="ident" id="5486588">userTypeInfo</span><span class="op" id="5486600">,</span>&nbsp;<span class="ident" id="5486602">value</span>&nbsp;<span class="ident" id="5486608">reflect</span><span class="op" id="5486615">.</span><span class="ident" id="5486616">Value</span><span class="op" id="5486621">)</span>&nbsp;<span class="op" id="5486623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5486626">state</span>&nbsp;<span class="op" id="5486632">:=</span>&nbsp;<span class="ident" id="5486635">dec</span><span class="op" id="5486638">.</span><span class="ident" id="5486639">newDecoderState</span><span class="op" id="5486654">(</span><span class="op" id="5486655">&amp;</span><span class="ident" id="5486656">dec</span><span class="op" id="5486659">.</span><span class="ident" id="5486660">buf</span><span class="op" id="5486663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5486666">defer</span>&nbsp;<span class="ident" id="5486672">dec</span><span class="op" id="5486675">.</span><span class="ident" id="5486676">freeDecoderState</span><span class="op" id="5486692">(</span><span class="ident" id="5486693">state</span><span class="op" id="5486698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5486701">state</span><span class="op" id="5486706">.</span><span class="ident" id="5486707">fieldnum</span>&nbsp;<span class="op" id="5486716">=</span>&nbsp;<span class="op" id="5486718">-</span><span class="num" id="5486719">1</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5486722">for</span>&nbsp;<span class="ident" id="5486726">state</span><span class="op" id="5486731">.</span><span class="ident" id="5486732">b</span><span class="op" id="5486733">.</span><span class="ident" id="5486734">Len</span><span class="op" id="5486737">(</span><span class="op" id="5486738">)</span>&nbsp;<span class="op" id="5486740">&gt;</span>&nbsp;<span class="num" id="5486742">0</span>&nbsp;<span class="op" id="5486744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5486748">delta</span>&nbsp;<span class="op" id="5486754">:=</span>&nbsp;<span class="builtintype" id="5486757">int</span><span class="op" id="5486760">(</span><span class="ident" id="5486761">state</span><span class="op" id="5486766">.</span><span class="ident" id="5486767">decodeUint</span><span class="op" id="5486777">(</span><span class="op" id="5486778">)</span><span class="op" id="5486779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5486783">if</span>&nbsp;<span class="ident" id="5486786">delta</span>&nbsp;<span class="op" id="5486792">&lt;</span>&nbsp;<span class="num" id="5486794">0</span>&nbsp;<span class="op" id="5486796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5486801">errorf</span><span class="op" id="5486807">(</span><span class="string" id="5486808">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="5486848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5486852">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5486856">if</span>&nbsp;<span class="ident" id="5486859">delta</span>&nbsp;<span class="op" id="5486865">==</span>&nbsp;<span class="num" id="5486868">0</span>&nbsp;<span class="op" id="5486870">{</span>&nbsp;<span class="comment" id="5486872">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5486919">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5486927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5486931">fieldnum</span>&nbsp;<span class="op" id="5486940">:=</span>&nbsp;<span class="ident" id="5486943">state</span><span class="op" id="5486948">.</span><span class="ident" id="5486949">fieldnum</span>&nbsp;<span class="op" id="5486958">+</span>&nbsp;<span class="ident" id="5486960">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5486968">if</span>&nbsp;<span class="ident" id="5486971">fieldnum</span>&nbsp;<span class="op" id="5486980">&gt;=</span>&nbsp;<span class="builtinfunc" id="5486983">len</span><span class="op" id="5486986">(</span><span class="ident" id="5486987">engine</span><span class="op" id="5486993">.</span><span class="ident" id="5486994">instr</span><span class="op" id="5486999">)</span>&nbsp;<span class="op" id="5487001">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487006">error_</span><span class="op" id="5487012">(</span><span class="ident" id="5487013">errRange</span><span class="op" id="5487021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5487026">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5487034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487038">instr</span>&nbsp;<span class="op" id="5487044">:=</span>&nbsp;<span class="op" id="5487047">&amp;</span><span class="ident" id="5487048">engine</span><span class="op" id="5487054">.</span><span class="ident" id="5487055">instr</span><span class="op" id="5487060">[</span><span class="ident" id="5487061">fieldnum</span><span class="op" id="5487069">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5487073">var</span>&nbsp;<span class="ident" id="5487077">field</span>&nbsp;<span class="ident" id="5487083">reflect</span><span class="op" id="5487090">.</span><span class="ident" id="5487091">Value</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5487099">if</span>&nbsp;<span class="ident" id="5487102">instr</span><span class="op" id="5487107">.</span><span class="ident" id="5487108">index</span>&nbsp;<span class="op" id="5487114">!=</span>&nbsp;<span class="builtintype" id="5487117">nil</span>&nbsp;<span class="op" id="5487121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5487126">//&nbsp;Otherwise&nbsp;the&nbsp;field&nbsp;is&nbsp;unknown&nbsp;to&nbsp;us&nbsp;and&nbsp;instr.op&nbsp;is&nbsp;an&nbsp;ignore&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487199">field</span>&nbsp;<span class="op" id="5487205">=</span>&nbsp;<span class="ident" id="5487207">value</span><span class="op" id="5487212">.</span><span class="ident" id="5487213">FieldByIndex</span><span class="op" id="5487225">(</span><span class="ident" id="5487226">instr</span><span class="op" id="5487231">.</span><span class="ident" id="5487232">index</span><span class="op" id="5487237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5487242">if</span>&nbsp;<span class="ident" id="5487245">field</span><span class="op" id="5487250">.</span><span class="ident" id="5487251">Kind</span><span class="op" id="5487255">(</span><span class="op" id="5487256">)</span>&nbsp;<span class="op" id="5487258">==</span>&nbsp;<span class="ident" id="5487261">reflect</span><span class="op" id="5487268">.</span><span class="ident" id="5487269">Ptr</span>&nbsp;<span class="op" id="5487273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487279">field</span>&nbsp;<span class="op" id="5487285">=</span>&nbsp;<span class="ident" id="5487287">decAlloc</span><span class="op" id="5487295">(</span><span class="ident" id="5487296">field</span><span class="op" id="5487301">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5487306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5487310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487314">instr</span><span class="op" id="5487319">.</span><span class="ident" id="5487320">op</span><span class="op" id="5487322">(</span><span class="ident" id="5487323">instr</span><span class="op" id="5487328">,</span>&nbsp;<span class="ident" id="5487330">state</span><span class="op" id="5487335">,</span>&nbsp;<span class="ident" id="5487337">field</span><span class="op" id="5487342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487346">state</span><span class="op" id="5487351">.</span><span class="ident" id="5487352">fieldnum</span>&nbsp;<span class="op" id="5487361">=</span>&nbsp;<span class="ident" id="5487363">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5487373">}</span><br>
<span class="lineno">470</span><span class="op" id="5487375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5487378">var</span>&nbsp;<span class="ident" id="5487382">noValue</span>&nbsp;<span class="ident" id="5487390">reflect</span><span class="op" id="5487397">.</span><span class="ident" id="5487398">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5487405">//&nbsp;ignoreStruct&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;struct&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">475</span><span class="keyword" id="5487473">func</span>&nbsp;<span class="op" id="5487478">(</span><span class="ident" id="5487479">dec</span>&nbsp;<span class="op" id="5487483">*</span><span class="ident" id="5487484">Decoder</span><span class="op" id="5487491">)</span>&nbsp;<span class="ident" id="5487493">ignoreStruct</span><span class="op" id="5487505">(</span><span class="ident" id="5487506">engine</span>&nbsp;<span class="op" id="5487513">*</span><span class="ident" id="5487514">decEngine</span><span class="op" id="5487523">)</span>&nbsp;<span class="op" id="5487525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487528">state</span>&nbsp;<span class="op" id="5487534">:=</span>&nbsp;<span class="ident" id="5487537">dec</span><span class="op" id="5487540">.</span><span class="ident" id="5487541">newDecoderState</span><span class="op" id="5487556">(</span><span class="op" id="5487557">&amp;</span><span class="ident" id="5487558">dec</span><span class="op" id="5487561">.</span><span class="ident" id="5487562">buf</span><span class="op" id="5487565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5487568">defer</span>&nbsp;<span class="ident" id="5487574">dec</span><span class="op" id="5487577">.</span><span class="ident" id="5487578">freeDecoderState</span><span class="op" id="5487594">(</span><span class="ident" id="5487595">state</span><span class="op" id="5487600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487603">state</span><span class="op" id="5487608">.</span><span class="ident" id="5487609">fieldnum</span>&nbsp;<span class="op" id="5487618">=</span>&nbsp;<span class="op" id="5487620">-</span><span class="num" id="5487621">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5487624">for</span>&nbsp;<span class="ident" id="5487628">state</span><span class="op" id="5487633">.</span><span class="ident" id="5487634">b</span><span class="op" id="5487635">.</span><span class="ident" id="5487636">Len</span><span class="op" id="5487639">(</span><span class="op" id="5487640">)</span>&nbsp;<span class="op" id="5487642">&gt;</span>&nbsp;<span class="num" id="5487644">0</span>&nbsp;<span class="op" id="5487646">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487650">delta</span>&nbsp;<span class="op" id="5487656">:=</span>&nbsp;<span class="builtintype" id="5487659">int</span><span class="op" id="5487662">(</span><span class="ident" id="5487663">state</span><span class="op" id="5487668">.</span><span class="ident" id="5487669">decodeUint</span><span class="op" id="5487679">(</span><span class="op" id="5487680">)</span><span class="op" id="5487681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5487685">if</span>&nbsp;<span class="ident" id="5487688">delta</span>&nbsp;<span class="op" id="5487694">&lt;</span>&nbsp;<span class="num" id="5487696">0</span>&nbsp;<span class="op" id="5487698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487703">errorf</span><span class="op" id="5487709">(</span><span class="string" id="5487710">&#34;ignore&nbsp;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="5487757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5487761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5487765">if</span>&nbsp;<span class="ident" id="5487768">delta</span>&nbsp;<span class="op" id="5487774">==</span>&nbsp;<span class="num" id="5487777">0</span>&nbsp;<span class="op" id="5487779">{</span>&nbsp;<span class="comment" id="5487781">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5487828">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5487836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487840">fieldnum</span>&nbsp;<span class="op" id="5487849">:=</span>&nbsp;<span class="ident" id="5487852">state</span><span class="op" id="5487857">.</span><span class="ident" id="5487858">fieldnum</span>&nbsp;<span class="op" id="5487867">+</span>&nbsp;<span class="ident" id="5487869">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5487877">if</span>&nbsp;<span class="ident" id="5487880">fieldnum</span>&nbsp;<span class="op" id="5487889">&gt;=</span>&nbsp;<span class="builtinfunc" id="5487892">len</span><span class="op" id="5487895">(</span><span class="ident" id="5487896">engine</span><span class="op" id="5487902">.</span><span class="ident" id="5487903">instr</span><span class="op" id="5487908">)</span>&nbsp;<span class="op" id="5487910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487915">error_</span><span class="op" id="5487921">(</span><span class="ident" id="5487922">errRange</span><span class="op" id="5487930">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5487934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487938">instr</span>&nbsp;<span class="op" id="5487944">:=</span>&nbsp;<span class="op" id="5487947">&amp;</span><span class="ident" id="5487948">engine</span><span class="op" id="5487954">.</span><span class="ident" id="5487955">instr</span><span class="op" id="5487960">[</span><span class="ident" id="5487961">fieldnum</span><span class="op" id="5487969">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5487973">instr</span><span class="op" id="5487978">.</span><span class="ident" id="5487979">op</span><span class="op" id="5487981">(</span><span class="ident" id="5487982">instr</span><span class="op" id="5487987">,</span>&nbsp;<span class="ident" id="5487989">state</span><span class="op" id="5487994">,</span>&nbsp;<span class="ident" id="5487996">noValue</span><span class="op" id="5488003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5488007">state</span><span class="op" id="5488012">.</span><span class="ident" id="5488013">fieldnum</span>&nbsp;<span class="op" id="5488022">=</span>&nbsp;<span class="ident" id="5488024">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5488034">}</span><br>
<span class="lineno">495</span><span class="op" id="5488036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5488039">//&nbsp;ignoreSingle&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;top-level&nbsp;non-struct&nbsp;value&nbsp;with&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="5488114">//&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;when&nbsp;calling&nbsp;Decode&nbsp;with&nbsp;a&nbsp;nil&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5488178">func</span>&nbsp;<span class="op" id="5488183">(</span><span class="ident" id="5488184">dec</span>&nbsp;<span class="op" id="5488188">*</span><span class="ident" id="5488189">Decoder</span><span class="op" id="5488196">)</span>&nbsp;<span class="ident" id="5488198">ignoreSingle</span><span class="op" id="5488210">(</span><span class="ident" id="5488211">engine</span>&nbsp;<span class="op" id="5488218">*</span><span class="ident" id="5488219">decEngine</span><span class="op" id="5488228">)</span>&nbsp;<span class="op" id="5488230">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5488233">state</span>&nbsp;<span class="op" id="5488239">:=</span>&nbsp;<span class="ident" id="5488242">dec</span><span class="op" id="5488245">.</span><span class="ident" id="5488246">newDecoderState</span><span class="op" id="5488261">(</span><span class="op" id="5488262">&amp;</span><span class="ident" id="5488263">dec</span><span class="op" id="5488266">.</span><span class="ident" id="5488267">buf</span><span class="op" id="5488270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5488273">defer</span>&nbsp;<span class="ident" id="5488279">dec</span><span class="op" id="5488282">.</span><span class="ident" id="5488283">freeDecoderState</span><span class="op" id="5488299">(</span><span class="ident" id="5488300">state</span><span class="op" id="5488305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5488308">state</span><span class="op" id="5488313">.</span><span class="ident" id="5488314">fieldnum</span>&nbsp;<span class="op" id="5488323">=</span>&nbsp;<span class="ident" id="5488325">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5488341">delta</span>&nbsp;<span class="op" id="5488347">:=</span>&nbsp;<span class="builtintype" id="5488350">int</span><span class="op" id="5488353">(</span><span class="ident" id="5488354">state</span><span class="op" id="5488359">.</span><span class="ident" id="5488360">decodeUint</span><span class="op" id="5488370">(</span><span class="op" id="5488371">)</span><span class="op" id="5488372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5488375">if</span>&nbsp;<span class="ident" id="5488378">delta</span>&nbsp;<span class="op" id="5488384">!=</span>&nbsp;<span class="num" id="5488387">0</span>&nbsp;<span class="op" id="5488389">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5488393">errorf</span><span class="op" id="5488399">(</span><span class="string" id="5488400">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="5488454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5488457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5488460">instr</span>&nbsp;<span class="op" id="5488466">:=</span>&nbsp;<span class="op" id="5488469">&amp;</span><span class="ident" id="5488470">engine</span><span class="op" id="5488476">.</span><span class="ident" id="5488477">instr</span><span class="op" id="5488482">[</span><span class="ident" id="5488483">singletonField</span><span class="op" id="5488497">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5488500">instr</span><span class="op" id="5488505">.</span><span class="ident" id="5488506">op</span><span class="op" id="5488508">(</span><span class="ident" id="5488509">instr</span><span class="op" id="5488514">,</span>&nbsp;<span class="ident" id="5488516">state</span><span class="op" id="5488521">,</span>&nbsp;<span class="ident" id="5488523">noValue</span><span class="op" id="5488530">)</span><br>
<span class="lineno"></span><span class="op" id="5488532">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="comment" id="5488535">//&nbsp;decodeArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;decoding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="5488602">func</span>&nbsp;<span class="op" id="5488607">(</span><span class="ident" id="5488608">dec</span>&nbsp;<span class="op" id="5488612">*</span><span class="ident" id="5488613">Decoder</span><span class="op" id="5488620">)</span>&nbsp;<span class="ident" id="5488622">decodeArrayHelper</span><span class="op" id="5488639">(</span><span class="ident" id="5488640">state</span>&nbsp;<span class="op" id="5488646">*</span><span class="ident" id="5488647">decoderState</span><span class="op" id="5488659">,</span>&nbsp;<span class="ident" id="5488661">value</span>&nbsp;<span class="ident" id="5488667">reflect</span><span class="op" id="5488674">.</span><span class="ident" id="5488675">Value</span><span class="op" id="5488680">,</span>&nbsp;<span class="ident" id="5488682">elemOp</span>&nbsp;<span class="ident" id="5488689">decOp</span><span class="op" id="5488694">,</span>&nbsp;<span class="ident" id="5488696">length</span>&nbsp;<span class="builtintype" id="5488703">int</span><span class="op" id="5488706">,</span>&nbsp;<span class="ident" id="5488708">ovfl</span>&nbsp;<span class="builtintype" id="5488713">error</span><span class="op" id="5488718">,</span>&nbsp;<span class="ident" id="5488720">helper</span>&nbsp;<span class="ident" id="5488727">decHelper</span><span class="op" id="5488736">)</span>&nbsp;<span class="op" id="5488738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5488741">if</span>&nbsp;<span class="ident" id="5488744">helper</span>&nbsp;<span class="op" id="5488751">!=</span>&nbsp;<span class="builtintype" id="5488754">nil</span>&nbsp;<span class="op" id="5488758">&amp;&amp;</span>&nbsp;<span class="ident" id="5488761">helper</span><span class="op" id="5488767">(</span><span class="ident" id="5488768">state</span><span class="op" id="5488773">,</span>&nbsp;<span class="ident" id="5488775">value</span><span class="op" id="5488780">,</span>&nbsp;<span class="ident" id="5488782">length</span><span class="op" id="5488788">,</span>&nbsp;<span class="ident" id="5488790">ovfl</span><span class="op" id="5488794">)</span>&nbsp;<span class="op" id="5488796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5488800">return</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5488808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5488811">instr</span>&nbsp;<span class="op" id="5488817">:=</span>&nbsp;<span class="op" id="5488820">&amp;</span><span class="ident" id="5488821">decInstr</span><span class="op" id="5488829">{</span><span class="ident" id="5488830">elemOp</span><span class="op" id="5488836">,</span>&nbsp;<span class="num" id="5488838">0</span><span class="op" id="5488839">,</span>&nbsp;<span class="builtintype" id="5488841">nil</span><span class="op" id="5488844">,</span>&nbsp;<span class="ident" id="5488846">ovfl</span><span class="op" id="5488850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5488853">isPtr</span>&nbsp;<span class="op" id="5488859">:=</span>&nbsp;<span class="ident" id="5488862">value</span><span class="op" id="5488867">.</span><span class="ident" id="5488868">Type</span><span class="op" id="5488872">(</span><span class="op" id="5488873">)</span><span class="op" id="5488874">.</span><span class="ident" id="5488875">Elem</span><span class="op" id="5488879">(</span><span class="op" id="5488880">)</span><span class="op" id="5488881">.</span><span class="ident" id="5488882">Kind</span><span class="op" id="5488886">(</span><span class="op" id="5488887">)</span>&nbsp;<span class="op" id="5488889">==</span>&nbsp;<span class="ident" id="5488892">reflect</span><span class="op" id="5488899">.</span><span class="ident" id="5488900">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5488905">for</span>&nbsp;<span class="ident" id="5488909">i</span>&nbsp;<span class="op" id="5488911">:=</span>&nbsp;<span class="num" id="5488914">0</span><span class="op" id="5488915">;</span>&nbsp;<span class="ident" id="5488917">i</span>&nbsp;<span class="op" id="5488919">&lt;</span>&nbsp;<span class="ident" id="5488921">length</span><span class="op" id="5488927">;</span>&nbsp;<span class="ident" id="5488929">i</span><span class="op" id="5488930">++</span>&nbsp;<span class="op" id="5488933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5488937">if</span>&nbsp;<span class="ident" id="5488940">state</span><span class="op" id="5488945">.</span><span class="ident" id="5488946">b</span><span class="op" id="5488947">.</span><span class="ident" id="5488948">Len</span><span class="op" id="5488951">(</span><span class="op" id="5488952">)</span>&nbsp;<span class="op" id="5488954">==</span>&nbsp;<span class="num" id="5488957">0</span>&nbsp;<span class="op" id="5488959">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5488964">errorf</span><span class="op" id="5488970">(</span><span class="string" id="5488971">&#34;decoding&nbsp;array&nbsp;or&nbsp;slice:&nbsp;length&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;elements)&#34;</span><span class="op" id="5489037">,</span>&nbsp;<span class="ident" id="5489039">length</span><span class="op" id="5489045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5489049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489053">v</span>&nbsp;<span class="op" id="5489055">:=</span>&nbsp;<span class="ident" id="5489058">value</span><span class="op" id="5489063">.</span><span class="ident" id="5489064">Index</span><span class="op" id="5489069">(</span><span class="ident" id="5489070">i</span><span class="op" id="5489071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5489075">if</span>&nbsp;<span class="ident" id="5489078">isPtr</span>&nbsp;<span class="op" id="5489084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489089">v</span>&nbsp;<span class="op" id="5489091">=</span>&nbsp;<span class="ident" id="5489093">decAlloc</span><span class="op" id="5489101">(</span><span class="ident" id="5489102">v</span><span class="op" id="5489103">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5489107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489111">elemOp</span><span class="op" id="5489117">(</span><span class="ident" id="5489118">instr</span><span class="op" id="5489123">,</span>&nbsp;<span class="ident" id="5489125">state</span><span class="op" id="5489130">,</span>&nbsp;<span class="ident" id="5489132">v</span><span class="op" id="5489133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5489136">}</span><br>
<span class="lineno"></span><span class="op" id="5489138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="5489141">//&nbsp;decodeArray&nbsp;decodes&nbsp;an&nbsp;array&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5489197">//&nbsp;The&nbsp;length&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;preceding&nbsp;the&nbsp;elements.&nbsp;&nbsp;Even&nbsp;though&nbsp;the&nbsp;length&nbsp;is&nbsp;redundant</span><br>
<span class="lineno"></span><span class="comment" id="5489295">//&nbsp;(it&#39;s&nbsp;part&nbsp;of&nbsp;the&nbsp;type),&nbsp;it&#39;s&nbsp;a&nbsp;useful&nbsp;check&nbsp;and&nbsp;is&nbsp;included&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5489376">func</span>&nbsp;<span class="op" id="5489381">(</span><span class="ident" id="5489382">dec</span>&nbsp;<span class="op" id="5489386">*</span><span class="ident" id="5489387">Decoder</span><span class="op" id="5489394">)</span>&nbsp;<span class="ident" id="5489396">decodeArray</span><span class="op" id="5489407">(</span><span class="ident" id="5489408">atyp</span>&nbsp;<span class="ident" id="5489413">reflect</span><span class="op" id="5489420">.</span><span class="ident" id="5489421">Type</span><span class="op" id="5489425">,</span>&nbsp;<span class="ident" id="5489427">state</span>&nbsp;<span class="op" id="5489433">*</span><span class="ident" id="5489434">decoderState</span><span class="op" id="5489446">,</span>&nbsp;<span class="ident" id="5489448">value</span>&nbsp;<span class="ident" id="5489454">reflect</span><span class="op" id="5489461">.</span><span class="ident" id="5489462">Value</span><span class="op" id="5489467">,</span>&nbsp;<span class="ident" id="5489469">elemOp</span>&nbsp;<span class="ident" id="5489476">decOp</span><span class="op" id="5489481">,</span>&nbsp;<span class="ident" id="5489483">length</span>&nbsp;<span class="builtintype" id="5489490">int</span><span class="op" id="5489493">,</span>&nbsp;<span class="ident" id="5489495">ovfl</span>&nbsp;<span class="builtintype" id="5489500">error</span><span class="op" id="5489505">,</span>&nbsp;<span class="ident" id="5489507">helper</span>&nbsp;<span class="ident" id="5489514">decHelper</span><span class="op" id="5489523">)</span>&nbsp;<span class="op" id="5489525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5489528">if</span>&nbsp;<span class="ident" id="5489531">n</span>&nbsp;<span class="op" id="5489533">:=</span>&nbsp;<span class="ident" id="5489536">state</span><span class="op" id="5489541">.</span><span class="ident" id="5489542">decodeUint</span><span class="op" id="5489552">(</span><span class="op" id="5489553">)</span><span class="op" id="5489554">;</span>&nbsp;<span class="ident" id="5489556">n</span>&nbsp;<span class="op" id="5489558">!=</span>&nbsp;<span class="ident" id="5489561">uint64</span><span class="op" id="5489567">(</span><span class="ident" id="5489568">length</span><span class="op" id="5489574">)</span>&nbsp;<span class="op" id="5489576">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489580">errorf</span><span class="op" id="5489586">(</span><span class="string" id="5489587">&#34;length&nbsp;mismatch&nbsp;in&nbsp;decodeArray&#34;</span><span class="op" id="5489619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5489622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489625">dec</span><span class="op" id="5489628">.</span><span class="ident" id="5489629">decodeArrayHelper</span><span class="op" id="5489646">(</span><span class="ident" id="5489647">state</span><span class="op" id="5489652">,</span>&nbsp;<span class="ident" id="5489654">value</span><span class="op" id="5489659">,</span>&nbsp;<span class="ident" id="5489661">elemOp</span><span class="op" id="5489667">,</span>&nbsp;<span class="ident" id="5489669">length</span><span class="op" id="5489675">,</span>&nbsp;<span class="ident" id="5489677">ovfl</span><span class="op" id="5489681">,</span>&nbsp;<span class="ident" id="5489683">helper</span><span class="op" id="5489689">)</span><br>
<span class="lineno"></span><span class="op" id="5489691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="5489694">//&nbsp;decodeIntoValue&nbsp;is&nbsp;a&nbsp;helper&nbsp;for&nbsp;map&nbsp;decoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5489743">func</span>&nbsp;<span class="ident" id="5489748">decodeIntoValue</span><span class="op" id="5489763">(</span><span class="ident" id="5489764">state</span>&nbsp;<span class="op" id="5489770">*</span><span class="ident" id="5489771">decoderState</span><span class="op" id="5489783">,</span>&nbsp;<span class="ident" id="5489785">op</span>&nbsp;<span class="ident" id="5489788">decOp</span><span class="op" id="5489793">,</span>&nbsp;<span class="ident" id="5489795">isPtr</span>&nbsp;<span class="builtintype" id="5489801">bool</span><span class="op" id="5489805">,</span>&nbsp;<span class="ident" id="5489807">value</span>&nbsp;<span class="ident" id="5489813">reflect</span><span class="op" id="5489820">.</span><span class="ident" id="5489821">Value</span><span class="op" id="5489826">,</span>&nbsp;<span class="ident" id="5489828">ovfl</span>&nbsp;<span class="builtintype" id="5489833">error</span><span class="op" id="5489838">)</span>&nbsp;<span class="ident" id="5489840">reflect</span><span class="op" id="5489847">.</span><span class="ident" id="5489848">Value</span>&nbsp;<span class="op" id="5489854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489857">instr</span>&nbsp;<span class="op" id="5489863">:=</span>&nbsp;<span class="op" id="5489866">&amp;</span><span class="ident" id="5489867">decInstr</span><span class="op" id="5489875">{</span><span class="ident" id="5489876">op</span><span class="op" id="5489878">,</span>&nbsp;<span class="num" id="5489880">0</span><span class="op" id="5489881">,</span>&nbsp;<span class="builtintype" id="5489883">nil</span><span class="op" id="5489886">,</span>&nbsp;<span class="ident" id="5489888">ovfl</span><span class="op" id="5489892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489895">v</span>&nbsp;<span class="op" id="5489897">:=</span>&nbsp;<span class="ident" id="5489900">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5489907">if</span>&nbsp;<span class="ident" id="5489910">isPtr</span>&nbsp;<span class="op" id="5489916">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489920">v</span>&nbsp;<span class="op" id="5489922">=</span>&nbsp;<span class="ident" id="5489924">decAlloc</span><span class="op" id="5489932">(</span><span class="ident" id="5489933">value</span><span class="op" id="5489938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5489941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5489944">op</span><span class="op" id="5489946">(</span><span class="ident" id="5489947">instr</span><span class="op" id="5489952">,</span>&nbsp;<span class="ident" id="5489954">state</span><span class="op" id="5489959">,</span>&nbsp;<span class="ident" id="5489961">v</span><span class="op" id="5489962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5489965">return</span>&nbsp;<span class="ident" id="5489972">value</span><br>
<span class="lineno"></span><span class="op" id="5489978">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="5489981">//&nbsp;decodeMap&nbsp;decodes&nbsp;a&nbsp;map&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5490032">//&nbsp;Maps&nbsp;are&nbsp;encoded&nbsp;as&nbsp;a&nbsp;length&nbsp;followed&nbsp;by&nbsp;key:value&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="comment" id="5490093">//&nbsp;Because&nbsp;the&nbsp;internals&nbsp;of&nbsp;maps&nbsp;are&nbsp;not&nbsp;visible&nbsp;to&nbsp;us,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5490157">//&nbsp;use&nbsp;reflection&nbsp;rather&nbsp;than&nbsp;pointer&nbsp;magic.</span><br>
<span class="lineno">555</span><span class="keyword" id="5490202">func</span>&nbsp;<span class="op" id="5490207">(</span><span class="ident" id="5490208">dec</span>&nbsp;<span class="op" id="5490212">*</span><span class="ident" id="5490213">Decoder</span><span class="op" id="5490220">)</span>&nbsp;<span class="ident" id="5490222">decodeMap</span><span class="op" id="5490231">(</span><span class="ident" id="5490232">mtyp</span>&nbsp;<span class="ident" id="5490237">reflect</span><span class="op" id="5490244">.</span><span class="ident" id="5490245">Type</span><span class="op" id="5490249">,</span>&nbsp;<span class="ident" id="5490251">state</span>&nbsp;<span class="op" id="5490257">*</span><span class="ident" id="5490258">decoderState</span><span class="op" id="5490270">,</span>&nbsp;<span class="ident" id="5490272">value</span>&nbsp;<span class="ident" id="5490278">reflect</span><span class="op" id="5490285">.</span><span class="ident" id="5490286">Value</span><span class="op" id="5490291">,</span>&nbsp;<span class="ident" id="5490293">keyOp</span><span class="op" id="5490298">,</span>&nbsp;<span class="ident" id="5490300">elemOp</span>&nbsp;<span class="ident" id="5490307">decOp</span><span class="op" id="5490312">,</span>&nbsp;<span class="ident" id="5490314">ovfl</span>&nbsp;<span class="builtintype" id="5490319">error</span><span class="op" id="5490324">)</span>&nbsp;<span class="op" id="5490326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5490329">if</span>&nbsp;<span class="ident" id="5490332">value</span><span class="op" id="5490337">.</span><span class="ident" id="5490338">IsNil</span><span class="op" id="5490343">(</span><span class="op" id="5490344">)</span>&nbsp;<span class="op" id="5490346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5490350">//&nbsp;Allocate&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5490369">value</span><span class="op" id="5490374">.</span><span class="ident" id="5490375">Set</span><span class="op" id="5490378">(</span><span class="ident" id="5490379">reflect</span><span class="op" id="5490386">.</span><span class="ident" id="5490387">MakeMap</span><span class="op" id="5490394">(</span><span class="ident" id="5490395">mtyp</span><span class="op" id="5490399">)</span><span class="op" id="5490400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5490403">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5490406">n</span>&nbsp;<span class="op" id="5490408">:=</span>&nbsp;<span class="builtintype" id="5490411">int</span><span class="op" id="5490414">(</span><span class="ident" id="5490415">state</span><span class="op" id="5490420">.</span><span class="ident" id="5490421">decodeUint</span><span class="op" id="5490431">(</span><span class="op" id="5490432">)</span><span class="op" id="5490433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5490436">keyIsPtr</span>&nbsp;<span class="op" id="5490445">:=</span>&nbsp;<span class="ident" id="5490448">mtyp</span><span class="op" id="5490452">.</span><span class="ident" id="5490453">Key</span><span class="op" id="5490456">(</span><span class="op" id="5490457">)</span><span class="op" id="5490458">.</span><span class="ident" id="5490459">Kind</span><span class="op" id="5490463">(</span><span class="op" id="5490464">)</span>&nbsp;<span class="op" id="5490466">==</span>&nbsp;<span class="ident" id="5490469">reflect</span><span class="op" id="5490476">.</span><span class="ident" id="5490477">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5490482">elemIsPtr</span>&nbsp;<span class="op" id="5490492">:=</span>&nbsp;<span class="ident" id="5490495">mtyp</span><span class="op" id="5490499">.</span><span class="ident" id="5490500">Elem</span><span class="op" id="5490504">(</span><span class="op" id="5490505">)</span><span class="op" id="5490506">.</span><span class="ident" id="5490507">Kind</span><span class="op" id="5490511">(</span><span class="op" id="5490512">)</span>&nbsp;<span class="op" id="5490514">==</span>&nbsp;<span class="ident" id="5490517">reflect</span><span class="op" id="5490524">.</span><span class="ident" id="5490525">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5490530">for</span>&nbsp;<span class="ident" id="5490534">i</span>&nbsp;<span class="op" id="5490536">:=</span>&nbsp;<span class="num" id="5490539">0</span><span class="op" id="5490540">;</span>&nbsp;<span class="ident" id="5490542">i</span>&nbsp;<span class="op" id="5490544">&lt;</span>&nbsp;<span class="ident" id="5490546">n</span><span class="op" id="5490547">;</span>&nbsp;<span class="ident" id="5490549">i</span><span class="op" id="5490550">++</span>&nbsp;<span class="op" id="5490553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5490557">key</span>&nbsp;<span class="op" id="5490561">:=</span>&nbsp;<span class="ident" id="5490564">decodeIntoValue</span><span class="op" id="5490579">(</span><span class="ident" id="5490580">state</span><span class="op" id="5490585">,</span>&nbsp;<span class="ident" id="5490587">keyOp</span><span class="op" id="5490592">,</span>&nbsp;<span class="ident" id="5490594">keyIsPtr</span><span class="op" id="5490602">,</span>&nbsp;<span class="ident" id="5490604">allocValue</span><span class="op" id="5490614">(</span><span class="ident" id="5490615">mtyp</span><span class="op" id="5490619">.</span><span class="ident" id="5490620">Key</span><span class="op" id="5490623">(</span><span class="op" id="5490624">)</span><span class="op" id="5490625">)</span><span class="op" id="5490626">,</span>&nbsp;<span class="ident" id="5490628">ovfl</span><span class="op" id="5490632">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5490636">elem</span>&nbsp;<span class="op" id="5490641">:=</span>&nbsp;<span class="ident" id="5490644">decodeIntoValue</span><span class="op" id="5490659">(</span><span class="ident" id="5490660">state</span><span class="op" id="5490665">,</span>&nbsp;<span class="ident" id="5490667">elemOp</span><span class="op" id="5490673">,</span>&nbsp;<span class="ident" id="5490675">elemIsPtr</span><span class="op" id="5490684">,</span>&nbsp;<span class="ident" id="5490686">allocValue</span><span class="op" id="5490696">(</span><span class="ident" id="5490697">mtyp</span><span class="op" id="5490701">.</span><span class="ident" id="5490702">Elem</span><span class="op" id="5490706">(</span><span class="op" id="5490707">)</span><span class="op" id="5490708">)</span><span class="op" id="5490709">,</span>&nbsp;<span class="ident" id="5490711">ovfl</span><span class="op" id="5490715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5490719">value</span><span class="op" id="5490724">.</span><span class="ident" id="5490725">SetMapIndex</span><span class="op" id="5490736">(</span><span class="ident" id="5490737">key</span><span class="op" id="5490740">,</span>&nbsp;<span class="ident" id="5490742">elem</span><span class="op" id="5490746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5490749">}</span><br>
<span class="lineno"></span><span class="op" id="5490751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">570</span><span class="comment" id="5490754">//&nbsp;ignoreArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;discarding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="5490823">func</span>&nbsp;<span class="op" id="5490828">(</span><span class="ident" id="5490829">dec</span>&nbsp;<span class="op" id="5490833">*</span><span class="ident" id="5490834">Decoder</span><span class="op" id="5490841">)</span>&nbsp;<span class="ident" id="5490843">ignoreArrayHelper</span><span class="op" id="5490860">(</span><span class="ident" id="5490861">state</span>&nbsp;<span class="op" id="5490867">*</span><span class="ident" id="5490868">decoderState</span><span class="op" id="5490880">,</span>&nbsp;<span class="ident" id="5490882">elemOp</span>&nbsp;<span class="ident" id="5490889">decOp</span><span class="op" id="5490894">,</span>&nbsp;<span class="ident" id="5490896">length</span>&nbsp;<span class="builtintype" id="5490903">int</span><span class="op" id="5490906">)</span>&nbsp;<span class="op" id="5490908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5490911">instr</span>&nbsp;<span class="op" id="5490917">:=</span>&nbsp;<span class="op" id="5490920">&amp;</span><span class="ident" id="5490921">decInstr</span><span class="op" id="5490929">{</span><span class="ident" id="5490930">elemOp</span><span class="op" id="5490936">,</span>&nbsp;<span class="num" id="5490938">0</span><span class="op" id="5490939">,</span>&nbsp;<span class="builtintype" id="5490941">nil</span><span class="op" id="5490944">,</span>&nbsp;<span class="ident" id="5490946">errors</span><span class="op" id="5490952">.</span><span class="ident" id="5490953">New</span><span class="op" id="5490956">(</span><span class="string" id="5490957">&#34;no&nbsp;error&#34;</span><span class="op" id="5490967">)</span><span class="op" id="5490968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5490971">for</span>&nbsp;<span class="ident" id="5490975">i</span>&nbsp;<span class="op" id="5490977">:=</span>&nbsp;<span class="num" id="5490980">0</span><span class="op" id="5490981">;</span>&nbsp;<span class="ident" id="5490983">i</span>&nbsp;<span class="op" id="5490985">&lt;</span>&nbsp;<span class="ident" id="5490987">length</span><span class="op" id="5490993">;</span>&nbsp;<span class="ident" id="5490995">i</span><span class="op" id="5490996">++</span>&nbsp;<span class="op" id="5490999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491003">elemOp</span><span class="op" id="5491009">(</span><span class="ident" id="5491010">instr</span><span class="op" id="5491015">,</span>&nbsp;<span class="ident" id="5491017">state</span><span class="op" id="5491022">,</span>&nbsp;<span class="ident" id="5491024">noValue</span><span class="op" id="5491031">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5491034">}</span><br>
<span class="lineno"></span><span class="op" id="5491036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5491039">//&nbsp;ignoreArray&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;array&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5491112">func</span>&nbsp;<span class="op" id="5491117">(</span><span class="ident" id="5491118">dec</span>&nbsp;<span class="op" id="5491122">*</span><span class="ident" id="5491123">Decoder</span><span class="op" id="5491130">)</span>&nbsp;<span class="ident" id="5491132">ignoreArray</span><span class="op" id="5491143">(</span><span class="ident" id="5491144">state</span>&nbsp;<span class="op" id="5491150">*</span><span class="ident" id="5491151">decoderState</span><span class="op" id="5491163">,</span>&nbsp;<span class="ident" id="5491165">elemOp</span>&nbsp;<span class="ident" id="5491172">decOp</span><span class="op" id="5491177">,</span>&nbsp;<span class="ident" id="5491179">length</span>&nbsp;<span class="builtintype" id="5491186">int</span><span class="op" id="5491189">)</span>&nbsp;<span class="op" id="5491191">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5491194">if</span>&nbsp;<span class="ident" id="5491197">n</span>&nbsp;<span class="op" id="5491199">:=</span>&nbsp;<span class="ident" id="5491202">state</span><span class="op" id="5491207">.</span><span class="ident" id="5491208">decodeUint</span><span class="op" id="5491218">(</span><span class="op" id="5491219">)</span><span class="op" id="5491220">;</span>&nbsp;<span class="ident" id="5491222">n</span>&nbsp;<span class="op" id="5491224">!=</span>&nbsp;<span class="ident" id="5491227">uint64</span><span class="op" id="5491233">(</span><span class="ident" id="5491234">length</span><span class="op" id="5491240">)</span>&nbsp;<span class="op" id="5491242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491246">errorf</span><span class="op" id="5491252">(</span><span class="string" id="5491253">&#34;length&nbsp;mismatch&nbsp;in&nbsp;ignoreArray&#34;</span><span class="op" id="5491285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5491288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491291">dec</span><span class="op" id="5491294">.</span><span class="ident" id="5491295">ignoreArrayHelper</span><span class="op" id="5491312">(</span><span class="ident" id="5491313">state</span><span class="op" id="5491318">,</span>&nbsp;<span class="ident" id="5491320">elemOp</span><span class="op" id="5491326">,</span>&nbsp;<span class="ident" id="5491328">length</span><span class="op" id="5491334">)</span><br>
<span class="lineno"></span><span class="op" id="5491336">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="comment" id="5491339">//&nbsp;ignoreMap&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;map&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5491407">func</span>&nbsp;<span class="op" id="5491412">(</span><span class="ident" id="5491413">dec</span>&nbsp;<span class="op" id="5491417">*</span><span class="ident" id="5491418">Decoder</span><span class="op" id="5491425">)</span>&nbsp;<span class="ident" id="5491427">ignoreMap</span><span class="op" id="5491436">(</span><span class="ident" id="5491437">state</span>&nbsp;<span class="op" id="5491443">*</span><span class="ident" id="5491444">decoderState</span><span class="op" id="5491456">,</span>&nbsp;<span class="ident" id="5491458">keyOp</span><span class="op" id="5491463">,</span>&nbsp;<span class="ident" id="5491465">elemOp</span>&nbsp;<span class="ident" id="5491472">decOp</span><span class="op" id="5491477">)</span>&nbsp;<span class="op" id="5491479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491482">n</span>&nbsp;<span class="op" id="5491484">:=</span>&nbsp;<span class="builtintype" id="5491487">int</span><span class="op" id="5491490">(</span><span class="ident" id="5491491">state</span><span class="op" id="5491496">.</span><span class="ident" id="5491497">decodeUint</span><span class="op" id="5491507">(</span><span class="op" id="5491508">)</span><span class="op" id="5491509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491512">keyInstr</span>&nbsp;<span class="op" id="5491521">:=</span>&nbsp;<span class="op" id="5491524">&amp;</span><span class="ident" id="5491525">decInstr</span><span class="op" id="5491533">{</span><span class="ident" id="5491534">keyOp</span><span class="op" id="5491539">,</span>&nbsp;<span class="num" id="5491541">0</span><span class="op" id="5491542">,</span>&nbsp;<span class="builtintype" id="5491544">nil</span><span class="op" id="5491547">,</span>&nbsp;<span class="ident" id="5491549">errors</span><span class="op" id="5491555">.</span><span class="ident" id="5491556">New</span><span class="op" id="5491559">(</span><span class="string" id="5491560">&#34;no&nbsp;error&#34;</span><span class="op" id="5491570">)</span><span class="op" id="5491571">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491574">elemInstr</span>&nbsp;<span class="op" id="5491584">:=</span>&nbsp;<span class="op" id="5491587">&amp;</span><span class="ident" id="5491588">decInstr</span><span class="op" id="5491596">{</span><span class="ident" id="5491597">elemOp</span><span class="op" id="5491603">,</span>&nbsp;<span class="num" id="5491605">0</span><span class="op" id="5491606">,</span>&nbsp;<span class="builtintype" id="5491608">nil</span><span class="op" id="5491611">,</span>&nbsp;<span class="ident" id="5491613">errors</span><span class="op" id="5491619">.</span><span class="ident" id="5491620">New</span><span class="op" id="5491623">(</span><span class="string" id="5491624">&#34;no&nbsp;error&#34;</span><span class="op" id="5491634">)</span><span class="op" id="5491635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5491638">for</span>&nbsp;<span class="ident" id="5491642">i</span>&nbsp;<span class="op" id="5491644">:=</span>&nbsp;<span class="num" id="5491647">0</span><span class="op" id="5491648">;</span>&nbsp;<span class="ident" id="5491650">i</span>&nbsp;<span class="op" id="5491652">&lt;</span>&nbsp;<span class="ident" id="5491654">n</span><span class="op" id="5491655">;</span>&nbsp;<span class="ident" id="5491657">i</span><span class="op" id="5491658">++</span>&nbsp;<span class="op" id="5491661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491665">keyOp</span><span class="op" id="5491670">(</span><span class="ident" id="5491671">keyInstr</span><span class="op" id="5491679">,</span>&nbsp;<span class="ident" id="5491681">state</span><span class="op" id="5491686">,</span>&nbsp;<span class="ident" id="5491688">noValue</span><span class="op" id="5491695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491699">elemOp</span><span class="op" id="5491705">(</span><span class="ident" id="5491706">elemInstr</span><span class="op" id="5491715">,</span>&nbsp;<span class="ident" id="5491717">state</span><span class="op" id="5491722">,</span>&nbsp;<span class="ident" id="5491724">noValue</span><span class="op" id="5491731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5491734">}</span><br>
<span class="lineno">595</span><span class="op" id="5491736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5491739">//&nbsp;decodeSlice&nbsp;decodes&nbsp;a&nbsp;slice&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5491794">//&nbsp;Slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;length&nbsp;followed&nbsp;by&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="5491864">func</span>&nbsp;<span class="op" id="5491869">(</span><span class="ident" id="5491870">dec</span>&nbsp;<span class="op" id="5491874">*</span><span class="ident" id="5491875">Decoder</span><span class="op" id="5491882">)</span>&nbsp;<span class="ident" id="5491884">decodeSlice</span><span class="op" id="5491895">(</span><span class="ident" id="5491896">state</span>&nbsp;<span class="op" id="5491902">*</span><span class="ident" id="5491903">decoderState</span><span class="op" id="5491915">,</span>&nbsp;<span class="ident" id="5491917">value</span>&nbsp;<span class="ident" id="5491923">reflect</span><span class="op" id="5491930">.</span><span class="ident" id="5491931">Value</span><span class="op" id="5491936">,</span>&nbsp;<span class="ident" id="5491938">elemOp</span>&nbsp;<span class="ident" id="5491945">decOp</span><span class="op" id="5491950">,</span>&nbsp;<span class="ident" id="5491952">ovfl</span>&nbsp;<span class="builtintype" id="5491957">error</span><span class="op" id="5491962">,</span>&nbsp;<span class="ident" id="5491964">helper</span>&nbsp;<span class="ident" id="5491971">decHelper</span><span class="op" id="5491980">)</span>&nbsp;<span class="op" id="5491982">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5491985">u</span>&nbsp;<span class="op" id="5491987">:=</span>&nbsp;<span class="ident" id="5491990">state</span><span class="op" id="5491995">.</span><span class="ident" id="5491996">decodeUint</span><span class="op" id="5492006">(</span><span class="op" id="5492007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5492010">typ</span>&nbsp;<span class="op" id="5492014">:=</span>&nbsp;<span class="ident" id="5492017">value</span><span class="op" id="5492022">.</span><span class="ident" id="5492023">Type</span><span class="op" id="5492027">(</span><span class="op" id="5492028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5492031">size</span>&nbsp;<span class="op" id="5492036">:=</span>&nbsp;<span class="ident" id="5492039">uint64</span><span class="op" id="5492045">(</span><span class="ident" id="5492046">typ</span><span class="op" id="5492049">.</span><span class="ident" id="5492050">Elem</span><span class="op" id="5492054">(</span><span class="op" id="5492055">)</span><span class="op" id="5492056">.</span><span class="ident" id="5492057">Size</span><span class="op" id="5492061">(</span><span class="op" id="5492062">)</span><span class="op" id="5492063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5492066">nBytes</span>&nbsp;<span class="op" id="5492073">:=</span>&nbsp;<span class="ident" id="5492076">u</span>&nbsp;<span class="op" id="5492078">*</span>&nbsp;<span class="ident" id="5492080">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5492086">n</span>&nbsp;<span class="op" id="5492088">:=</span>&nbsp;<span class="builtintype" id="5492091">int</span><span class="op" id="5492094">(</span><span class="ident" id="5492095">u</span><span class="op" id="5492096">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5492099">//&nbsp;Take&nbsp;care&nbsp;with&nbsp;overflow&nbsp;in&nbsp;this&nbsp;calculation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5492148">if</span>&nbsp;<span class="ident" id="5492151">n</span>&nbsp;<span class="op" id="5492153">&lt;</span>&nbsp;<span class="num" id="5492155">0</span>&nbsp;<span class="op" id="5492157">||</span>&nbsp;<span class="ident" id="5492160">uint64</span><span class="op" id="5492166">(</span><span class="ident" id="5492167">n</span><span class="op" id="5492168">)</span>&nbsp;<span class="op" id="5492170">!=</span>&nbsp;<span class="ident" id="5492173">u</span>&nbsp;<span class="op" id="5492175">||</span>&nbsp;<span class="ident" id="5492178">nBytes</span>&nbsp;<span class="op" id="5492185">&gt;</span>&nbsp;<span class="ident" id="5492187">tooBig</span>&nbsp;<span class="op" id="5492194">||</span>&nbsp;<span class="op" id="5492197">(</span><span class="ident" id="5492198">size</span>&nbsp;<span class="op" id="5492203">&gt;</span>&nbsp;<span class="num" id="5492205">0</span>&nbsp;<span class="op" id="5492207">&amp;&amp;</span>&nbsp;<span class="ident" id="5492210">nBytes</span><span class="op" id="5492216">/</span><span class="ident" id="5492217">size</span>&nbsp;<span class="op" id="5492222">!=</span>&nbsp;<span class="ident" id="5492225">u</span><span class="op" id="5492226">)</span>&nbsp;<span class="op" id="5492228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5492232">//&nbsp;We&nbsp;don&#39;t&nbsp;check&nbsp;n&nbsp;against&nbsp;buffer&nbsp;length&nbsp;here&nbsp;because&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5492305">//&nbsp;of&nbsp;interfaces,&nbsp;there&nbsp;will&nbsp;be&nbsp;buffer&nbsp;reloads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5492355">errorf</span><span class="op" id="5492361">(</span><span class="string" id="5492362">&#34;%s&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&nbsp;elements&nbsp;of&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="5492405">,</span>&nbsp;<span class="ident" id="5492407">typ</span><span class="op" id="5492410">.</span><span class="ident" id="5492411">Elem</span><span class="op" id="5492415">(</span><span class="op" id="5492416">)</span><span class="op" id="5492417">,</span>&nbsp;<span class="ident" id="5492419">u</span><span class="op" id="5492420">,</span>&nbsp;<span class="ident" id="5492422">size</span><span class="op" id="5492426">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5492429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5492432">if</span>&nbsp;<span class="ident" id="5492435">value</span><span class="op" id="5492440">.</span><span class="ident" id="5492441">Cap</span><span class="op" id="5492444">(</span><span class="op" id="5492445">)</span>&nbsp;<span class="op" id="5492447">&lt;</span>&nbsp;<span class="ident" id="5492449">n</span>&nbsp;<span class="op" id="5492451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5492455">value</span><span class="op" id="5492460">.</span><span class="ident" id="5492461">Set</span><span class="op" id="5492464">(</span><span class="ident" id="5492465">reflect</span><span class="op" id="5492472">.</span><span class="ident" id="5492473">MakeSlice</span><span class="op" id="5492482">(</span><span class="ident" id="5492483">typ</span><span class="op" id="5492486">,</span>&nbsp;<span class="ident" id="5492488">n</span><span class="op" id="5492489">,</span>&nbsp;<span class="ident" id="5492491">n</span><span class="op" id="5492492">)</span><span class="op" id="5492493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5492496">}</span>&nbsp;<span class="keyword" id="5492498">else</span>&nbsp;<span class="op" id="5492503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5492507">value</span><span class="op" id="5492512">.</span><span class="ident" id="5492513">Set</span><span class="op" id="5492516">(</span><span class="ident" id="5492517">value</span><span class="op" id="5492522">.</span><span class="ident" id="5492523">Slice</span><span class="op" id="5492528">(</span><span class="num" id="5492529">0</span><span class="op" id="5492530">,</span>&nbsp;<span class="ident" id="5492532">n</span><span class="op" id="5492533">)</span><span class="op" id="5492534">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5492537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5492540">dec</span><span class="op" id="5492543">.</span><span class="ident" id="5492544">decodeArrayHelper</span><span class="op" id="5492561">(</span><span class="ident" id="5492562">state</span><span class="op" id="5492567">,</span>&nbsp;<span class="ident" id="5492569">value</span><span class="op" id="5492574">,</span>&nbsp;<span class="ident" id="5492576">elemOp</span><span class="op" id="5492582">,</span>&nbsp;<span class="ident" id="5492584">n</span><span class="op" id="5492585">,</span>&nbsp;<span class="ident" id="5492587">ovfl</span><span class="op" id="5492591">,</span>&nbsp;<span class="ident" id="5492593">helper</span><span class="op" id="5492599">)</span><br>
<span class="lineno"></span><span class="op" id="5492601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5492604">//&nbsp;ignoreSlice&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">620</span><span class="keyword" id="5492678">func</span>&nbsp;<span class="op" id="5492683">(</span><span class="ident" id="5492684">dec</span>&nbsp;<span class="op" id="5492688">*</span><span class="ident" id="5492689">Decoder</span><span class="op" id="5492696">)</span>&nbsp;<span class="ident" id="5492698">ignoreSlice</span><span class="op" id="5492709">(</span><span class="ident" id="5492710">state</span>&nbsp;<span class="op" id="5492716">*</span><span class="ident" id="5492717">decoderState</span><span class="op" id="5492729">,</span>&nbsp;<span class="ident" id="5492731">elemOp</span>&nbsp;<span class="ident" id="5492738">decOp</span><span class="op" id="5492743">)</span>&nbsp;<span class="op" id="5492745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5492748">dec</span><span class="op" id="5492751">.</span><span class="ident" id="5492752">ignoreArrayHelper</span><span class="op" id="5492769">(</span><span class="ident" id="5492770">state</span><span class="op" id="5492775">,</span>&nbsp;<span class="ident" id="5492777">elemOp</span><span class="op" id="5492783">,</span>&nbsp;<span class="builtintype" id="5492785">int</span><span class="op" id="5492788">(</span><span class="ident" id="5492789">state</span><span class="op" id="5492794">.</span><span class="ident" id="5492795">decodeUint</span><span class="op" id="5492805">(</span><span class="op" id="5492806">)</span><span class="op" id="5492807">)</span><span class="op" id="5492808">)</span><br>
<span class="lineno"></span><span class="op" id="5492810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5492813">//&nbsp;decodeInterface&nbsp;decodes&nbsp;an&nbsp;interface&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">625</span><span class="comment" id="5492883">//&nbsp;Interfaces&nbsp;are&nbsp;encoded&nbsp;as&nbsp;the&nbsp;name&nbsp;of&nbsp;a&nbsp;concrete&nbsp;type&nbsp;followed&nbsp;by&nbsp;a&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5492961">//&nbsp;If&nbsp;the&nbsp;name&nbsp;is&nbsp;empty,&nbsp;the&nbsp;value&nbsp;is&nbsp;nil&nbsp;and&nbsp;no&nbsp;value&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="5493025">func</span>&nbsp;<span class="op" id="5493030">(</span><span class="ident" id="5493031">dec</span>&nbsp;<span class="op" id="5493035">*</span><span class="ident" id="5493036">Decoder</span><span class="op" id="5493043">)</span>&nbsp;<span class="ident" id="5493045">decodeInterface</span><span class="op" id="5493060">(</span><span class="ident" id="5493061">ityp</span>&nbsp;<span class="ident" id="5493066">reflect</span><span class="op" id="5493073">.</span><span class="ident" id="5493074">Type</span><span class="op" id="5493078">,</span>&nbsp;<span class="ident" id="5493080">state</span>&nbsp;<span class="op" id="5493086">*</span><span class="ident" id="5493087">decoderState</span><span class="op" id="5493099">,</span>&nbsp;<span class="ident" id="5493101">value</span>&nbsp;<span class="ident" id="5493107">reflect</span><span class="op" id="5493114">.</span><span class="ident" id="5493115">Value</span><span class="op" id="5493120">)</span>&nbsp;<span class="op" id="5493122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5493125">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493165">nr</span>&nbsp;<span class="op" id="5493168">:=</span>&nbsp;<span class="ident" id="5493171">state</span><span class="op" id="5493176">.</span><span class="ident" id="5493177">decodeUint</span><span class="op" id="5493187">(</span><span class="op" id="5493188">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493191">if</span>&nbsp;<span class="ident" id="5493194">nr</span>&nbsp;<span class="op" id="5493197">&lt;</span>&nbsp;<span class="num" id="5493199">0</span>&nbsp;<span class="op" id="5493201">||</span>&nbsp;<span class="ident" id="5493204">nr</span>&nbsp;<span class="op" id="5493207">&gt;</span>&nbsp;<span class="num" id="5493209">1</span><span class="op" id="5493210">&lt;&lt;</span><span class="num" id="5493212">31</span>&nbsp;<span class="op" id="5493215">{</span>&nbsp;<span class="comment" id="5493217">//&nbsp;zero&nbsp;is&nbsp;permissible&nbsp;for&nbsp;anonymous&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493262">errorf</span><span class="op" id="5493268">(</span><span class="string" id="5493269">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d&#34;</span><span class="op" id="5493298">,</span>&nbsp;<span class="ident" id="5493300">nr</span><span class="op" id="5493302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493308">if</span>&nbsp;<span class="ident" id="5493311">nr</span>&nbsp;<span class="op" id="5493314">&gt;</span>&nbsp;<span class="ident" id="5493316">uint64</span><span class="op" id="5493322">(</span><span class="ident" id="5493323">state</span><span class="op" id="5493328">.</span><span class="ident" id="5493329">b</span><span class="op" id="5493330">.</span><span class="ident" id="5493331">Len</span><span class="op" id="5493334">(</span><span class="op" id="5493335">)</span><span class="op" id="5493336">)</span>&nbsp;<span class="op" id="5493338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493342">errorf</span><span class="op" id="5493348">(</span><span class="string" id="5493349">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d:&nbsp;exceeds&nbsp;input&nbsp;size&#34;</span><span class="op" id="5493398">,</span>&nbsp;<span class="ident" id="5493400">nr</span><span class="op" id="5493402">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493408">b</span>&nbsp;<span class="op" id="5493410">:=</span>&nbsp;<span class="builtinfunc" id="5493413">make</span><span class="op" id="5493417">(</span><span class="op" id="5493418">[</span><span class="op" id="5493419">]</span><span class="builtintype" id="5493420">byte</span><span class="op" id="5493424">,</span>&nbsp;<span class="ident" id="5493426">nr</span><span class="op" id="5493428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493431">state</span><span class="op" id="5493436">.</span><span class="ident" id="5493437">b</span><span class="op" id="5493438">.</span><span class="ident" id="5493439">Read</span><span class="op" id="5493443">(</span><span class="ident" id="5493444">b</span><span class="op" id="5493445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493448">name</span>&nbsp;<span class="op" id="5493453">:=</span>&nbsp;<span class="builtintype" id="5493456">string</span><span class="op" id="5493462">(</span><span class="ident" id="5493463">b</span><span class="op" id="5493464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5493467">//&nbsp;Allocate&nbsp;the&nbsp;destination&nbsp;interface&nbsp;value.</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493513">if</span>&nbsp;<span class="ident" id="5493516">name</span>&nbsp;<span class="op" id="5493521">==</span>&nbsp;<span class="string" id="5493524">&#34;&#34;</span>&nbsp;<span class="op" id="5493527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5493531">//&nbsp;Copy&nbsp;the&nbsp;nil&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493580">value</span><span class="op" id="5493585">.</span><span class="ident" id="5493586">Set</span><span class="op" id="5493589">(</span><span class="ident" id="5493590">reflect</span><span class="op" id="5493597">.</span><span class="ident" id="5493598">Zero</span><span class="op" id="5493602">(</span><span class="ident" id="5493603">value</span><span class="op" id="5493608">.</span><span class="ident" id="5493609">Type</span><span class="op" id="5493613">(</span><span class="op" id="5493614">)</span><span class="op" id="5493615">)</span><span class="op" id="5493616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493620">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493628">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493631">if</span>&nbsp;<span class="builtinfunc" id="5493634">len</span><span class="op" id="5493637">(</span><span class="ident" id="5493638">name</span><span class="op" id="5493642">)</span>&nbsp;<span class="op" id="5493644">&gt;</span>&nbsp;<span class="num" id="5493646">1024</span>&nbsp;<span class="op" id="5493651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493655">errorf</span><span class="op" id="5493661">(</span><span class="string" id="5493662">&#34;name&nbsp;too&nbsp;long&nbsp;(%d&nbsp;bytes):&nbsp;%.20q...&#34;</span><span class="op" id="5493698">,</span>&nbsp;<span class="builtinfunc" id="5493700">len</span><span class="op" id="5493703">(</span><span class="ident" id="5493704">name</span><span class="op" id="5493708">)</span><span class="op" id="5493709">,</span>&nbsp;<span class="ident" id="5493711">name</span><span class="op" id="5493715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5493721">//&nbsp;The&nbsp;concrete&nbsp;type&nbsp;must&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493763">registerLock</span><span class="op" id="5493775">.</span><span class="ident" id="5493776">RLock</span><span class="op" id="5493781">(</span><span class="op" id="5493782">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493785">typ</span><span class="op" id="5493788">,</span>&nbsp;<span class="ident" id="5493790">ok</span>&nbsp;<span class="op" id="5493793">:=</span>&nbsp;<span class="ident" id="5493796">nameToConcreteType</span><span class="op" id="5493814">[</span><span class="ident" id="5493815">name</span><span class="op" id="5493819">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493822">registerLock</span><span class="op" id="5493834">.</span><span class="ident" id="5493835">RUnlock</span><span class="op" id="5493842">(</span><span class="op" id="5493843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5493846">if</span>&nbsp;<span class="op" id="5493849">!</span><span class="ident" id="5493850">ok</span>&nbsp;<span class="op" id="5493853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493857">errorf</span><span class="op" id="5493863">(</span><span class="string" id="5493864">&#34;name&nbsp;not&nbsp;registered&nbsp;for&nbsp;interface:&nbsp;%q&#34;</span><span class="op" id="5493903">,</span>&nbsp;<span class="ident" id="5493905">name</span><span class="op" id="5493909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5493912">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5493915">//&nbsp;Read&nbsp;the&nbsp;type&nbsp;id&nbsp;of&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5493959">concreteId</span>&nbsp;<span class="op" id="5493970">:=</span>&nbsp;<span class="ident" id="5493973">dec</span><span class="op" id="5493976">.</span><span class="ident" id="5493977">decodeTypeSequence</span><span class="op" id="5493995">(</span><span class="builtintype" id="5493996">true</span><span class="op" id="5494000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494003">if</span>&nbsp;<span class="ident" id="5494006">concreteId</span>&nbsp;<span class="op" id="5494017">&lt;</span>&nbsp;<span class="num" id="5494019">0</span>&nbsp;<span class="op" id="5494021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494025">error_</span><span class="op" id="5494031">(</span><span class="ident" id="5494032">dec</span><span class="op" id="5494035">.</span><span class="ident" id="5494036">err</span><span class="op" id="5494039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5494042">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494045">//&nbsp;Byte&nbsp;count&nbsp;of&nbsp;value&nbsp;is&nbsp;next;&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;what&nbsp;it&nbsp;is&nbsp;(it&#39;s&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494115">//&nbsp;in&nbsp;case&nbsp;we&nbsp;want&nbsp;to&nbsp;ignore&nbsp;the&nbsp;value&nbsp;by&nbsp;skipping&nbsp;it&nbsp;completely).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494183">state</span><span class="op" id="5494188">.</span><span class="ident" id="5494189">decodeUint</span><span class="op" id="5494199">(</span><span class="op" id="5494200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494203">//&nbsp;Read&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494232">v</span>&nbsp;<span class="op" id="5494234">:=</span>&nbsp;<span class="ident" id="5494237">allocValue</span><span class="op" id="5494247">(</span><span class="ident" id="5494248">typ</span><span class="op" id="5494251">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494254">dec</span><span class="op" id="5494257">.</span><span class="ident" id="5494258">decodeValue</span><span class="op" id="5494269">(</span><span class="ident" id="5494270">concreteId</span><span class="op" id="5494280">,</span>&nbsp;<span class="ident" id="5494282">v</span><span class="op" id="5494283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494286">if</span>&nbsp;<span class="ident" id="5494289">dec</span><span class="op" id="5494292">.</span><span class="ident" id="5494293">err</span>&nbsp;<span class="op" id="5494297">!=</span>&nbsp;<span class="builtintype" id="5494300">nil</span>&nbsp;<span class="op" id="5494304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494308">error_</span><span class="op" id="5494314">(</span><span class="ident" id="5494315">dec</span><span class="op" id="5494318">.</span><span class="ident" id="5494319">err</span><span class="op" id="5494322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5494325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494328">//&nbsp;Assign&nbsp;the&nbsp;concrete&nbsp;value&nbsp;to&nbsp;the&nbsp;interface.</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494376">//&nbsp;Tread&nbsp;carefully;&nbsp;it&nbsp;might&nbsp;not&nbsp;satisfy&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494433">if</span>&nbsp;<span class="op" id="5494436">!</span><span class="ident" id="5494437">typ</span><span class="op" id="5494440">.</span><span class="ident" id="5494441">AssignableTo</span><span class="op" id="5494453">(</span><span class="ident" id="5494454">ityp</span><span class="op" id="5494458">)</span>&nbsp;<span class="op" id="5494460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494464">errorf</span><span class="op" id="5494470">(</span><span class="string" id="5494471">&#34;%s&nbsp;is&nbsp;not&nbsp;assignable&nbsp;to&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5494504">,</span>&nbsp;<span class="ident" id="5494506">typ</span><span class="op" id="5494509">,</span>&nbsp;<span class="ident" id="5494511">ityp</span><span class="op" id="5494515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5494518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494521">//&nbsp;Copy&nbsp;the&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494565">value</span><span class="op" id="5494570">.</span><span class="ident" id="5494571">Set</span><span class="op" id="5494574">(</span><span class="ident" id="5494575">v</span><span class="op" id="5494576">)</span><br>
<span class="lineno"></span><span class="op" id="5494578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5494581">//&nbsp;ignoreInterface&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;interface&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5494662">func</span>&nbsp;<span class="op" id="5494667">(</span><span class="ident" id="5494668">dec</span>&nbsp;<span class="op" id="5494672">*</span><span class="ident" id="5494673">Decoder</span><span class="op" id="5494680">)</span>&nbsp;<span class="ident" id="5494682">ignoreInterface</span><span class="op" id="5494697">(</span><span class="ident" id="5494698">state</span>&nbsp;<span class="op" id="5494704">*</span><span class="ident" id="5494705">decoderState</span><span class="op" id="5494717">)</span>&nbsp;<span class="op" id="5494719">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494722">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494762">b</span>&nbsp;<span class="op" id="5494764">:=</span>&nbsp;<span class="builtinfunc" id="5494767">make</span><span class="op" id="5494771">(</span><span class="op" id="5494772">[</span><span class="op" id="5494773">]</span><span class="builtintype" id="5494774">byte</span><span class="op" id="5494778">,</span>&nbsp;<span class="ident" id="5494780">state</span><span class="op" id="5494785">.</span><span class="ident" id="5494786">decodeUint</span><span class="op" id="5494796">(</span><span class="op" id="5494797">)</span><span class="op" id="5494798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494801">_</span><span class="op" id="5494802">,</span>&nbsp;<span class="ident" id="5494804">err</span>&nbsp;<span class="op" id="5494808">:=</span>&nbsp;<span class="ident" id="5494811">state</span><span class="op" id="5494816">.</span><span class="ident" id="5494817">b</span><span class="op" id="5494818">.</span><span class="ident" id="5494819">Read</span><span class="op" id="5494823">(</span><span class="ident" id="5494824">b</span><span class="op" id="5494825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494828">if</span>&nbsp;<span class="ident" id="5494831">err</span>&nbsp;<span class="op" id="5494835">!=</span>&nbsp;<span class="builtintype" id="5494838">nil</span>&nbsp;<span class="op" id="5494842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494846">error_</span><span class="op" id="5494852">(</span><span class="ident" id="5494853">err</span><span class="op" id="5494856">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5494859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494862">id</span>&nbsp;<span class="op" id="5494865">:=</span>&nbsp;<span class="ident" id="5494868">dec</span><span class="op" id="5494871">.</span><span class="ident" id="5494872">decodeTypeSequence</span><span class="op" id="5494890">(</span><span class="builtintype" id="5494891">true</span><span class="op" id="5494895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5494898">if</span>&nbsp;<span class="ident" id="5494901">id</span>&nbsp;<span class="op" id="5494904">&lt;</span>&nbsp;<span class="num" id="5494906">0</span>&nbsp;<span class="op" id="5494908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5494912">error_</span><span class="op" id="5494918">(</span><span class="ident" id="5494919">dec</span><span class="op" id="5494922">.</span><span class="ident" id="5494923">err</span><span class="op" id="5494926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5494929">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5494932">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;the&nbsp;decoder&nbsp;buffer&nbsp;contains&nbsp;a&nbsp;delimited&nbsp;value.&nbsp;Just&nbsp;toss&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495012">state</span><span class="op" id="5495017">.</span><span class="ident" id="5495018">b</span><span class="op" id="5495019">.</span><span class="ident" id="5495020">Drop</span><span class="op" id="5495024">(</span><span class="builtintype" id="5495025">int</span><span class="op" id="5495028">(</span><span class="ident" id="5495029">state</span><span class="op" id="5495034">.</span><span class="ident" id="5495035">decodeUint</span><span class="op" id="5495045">(</span><span class="op" id="5495046">)</span><span class="op" id="5495047">)</span><span class="op" id="5495048">)</span><br>
<span class="lineno"></span><span class="op" id="5495050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5495053">//&nbsp;decodeGobDecoder&nbsp;decodes&nbsp;something&nbsp;implementing&nbsp;the&nbsp;GobDecoder&nbsp;interface.</span><br>
<span class="lineno">695</span><span class="comment" id="5495130">//&nbsp;The&nbsp;data&nbsp;is&nbsp;encoded&nbsp;as&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="5495170">func</span>&nbsp;<span class="op" id="5495175">(</span><span class="ident" id="5495176">dec</span>&nbsp;<span class="op" id="5495180">*</span><span class="ident" id="5495181">Decoder</span><span class="op" id="5495188">)</span>&nbsp;<span class="ident" id="5495190">decodeGobDecoder</span><span class="op" id="5495206">(</span><span class="ident" id="5495207">ut</span>&nbsp;<span class="op" id="5495210">*</span><span class="ident" id="5495211">userTypeInfo</span><span class="op" id="5495223">,</span>&nbsp;<span class="ident" id="5495225">state</span>&nbsp;<span class="op" id="5495231">*</span><span class="ident" id="5495232">decoderState</span><span class="op" id="5495244">,</span>&nbsp;<span class="ident" id="5495246">value</span>&nbsp;<span class="ident" id="5495252">reflect</span><span class="op" id="5495259">.</span><span class="ident" id="5495260">Value</span><span class="op" id="5495265">)</span>&nbsp;<span class="op" id="5495267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5495270">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495304">b</span>&nbsp;<span class="op" id="5495306">:=</span>&nbsp;<span class="builtinfunc" id="5495309">make</span><span class="op" id="5495313">(</span><span class="op" id="5495314">[</span><span class="op" id="5495315">]</span><span class="builtintype" id="5495316">byte</span><span class="op" id="5495320">,</span>&nbsp;<span class="ident" id="5495322">state</span><span class="op" id="5495327">.</span><span class="ident" id="5495328">decodeUint</span><span class="op" id="5495338">(</span><span class="op" id="5495339">)</span><span class="op" id="5495340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495343">_</span><span class="op" id="5495344">,</span>&nbsp;<span class="ident" id="5495346">err</span>&nbsp;<span class="op" id="5495350">:=</span>&nbsp;<span class="ident" id="5495353">state</span><span class="op" id="5495358">.</span><span class="ident" id="5495359">b</span><span class="op" id="5495360">.</span><span class="ident" id="5495361">Read</span><span class="op" id="5495365">(</span><span class="ident" id="5495366">b</span><span class="op" id="5495367">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495370">if</span>&nbsp;<span class="ident" id="5495373">err</span>&nbsp;<span class="op" id="5495377">!=</span>&nbsp;<span class="builtintype" id="5495380">nil</span>&nbsp;<span class="op" id="5495384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495388">error_</span><span class="op" id="5495394">(</span><span class="ident" id="5495395">err</span><span class="op" id="5495398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5495401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5495404">//&nbsp;We&nbsp;know&nbsp;it&#39;s&nbsp;one&nbsp;of&nbsp;these.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495435">switch</span>&nbsp;<span class="ident" id="5495442">ut</span><span class="op" id="5495444">.</span><span class="ident" id="5495445">externalDec</span>&nbsp;<span class="op" id="5495457">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495460">case</span>&nbsp;<span class="ident" id="5495465">xGob</span><span class="op" id="5495469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495473">err</span>&nbsp;<span class="op" id="5495477">=</span>&nbsp;<span class="ident" id="5495479">value</span><span class="op" id="5495484">.</span><span class="ident" id="5495485">Interface</span><span class="op" id="5495494">(</span><span class="op" id="5495495">)</span><span class="op" id="5495496">.</span><span class="op" id="5495497">(</span><span class="ident" id="5495498">GobDecoder</span><span class="op" id="5495508">)</span><span class="op" id="5495509">.</span><span class="ident" id="5495510">GobDecode</span><span class="op" id="5495519">(</span><span class="ident" id="5495520">b</span><span class="op" id="5495521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495524">case</span>&nbsp;<span class="ident" id="5495529">xBinary</span><span class="op" id="5495536">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495540">err</span>&nbsp;<span class="op" id="5495544">=</span>&nbsp;<span class="ident" id="5495546">value</span><span class="op" id="5495551">.</span><span class="ident" id="5495552">Interface</span><span class="op" id="5495561">(</span><span class="op" id="5495562">)</span><span class="op" id="5495563">.</span><span class="op" id="5495564">(</span><span class="ident" id="5495565">encoding</span><span class="op" id="5495573">.</span><span class="ident" id="5495574">BinaryUnmarshaler</span><span class="op" id="5495591">)</span><span class="op" id="5495592">.</span><span class="ident" id="5495593">UnmarshalBinary</span><span class="op" id="5495608">(</span><span class="ident" id="5495609">b</span><span class="op" id="5495610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495613">case</span>&nbsp;<span class="ident" id="5495618">xText</span><span class="op" id="5495623">:</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495627">err</span>&nbsp;<span class="op" id="5495631">=</span>&nbsp;<span class="ident" id="5495633">value</span><span class="op" id="5495638">.</span><span class="ident" id="5495639">Interface</span><span class="op" id="5495648">(</span><span class="op" id="5495649">)</span><span class="op" id="5495650">.</span><span class="op" id="5495651">(</span><span class="ident" id="5495652">encoding</span><span class="op" id="5495660">.</span><span class="ident" id="5495661">TextUnmarshaler</span><span class="op" id="5495676">)</span><span class="op" id="5495677">.</span><span class="ident" id="5495678">UnmarshalText</span><span class="op" id="5495691">(</span><span class="ident" id="5495692">b</span><span class="op" id="5495693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5495696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495699">if</span>&nbsp;<span class="ident" id="5495702">err</span>&nbsp;<span class="op" id="5495706">!=</span>&nbsp;<span class="builtintype" id="5495709">nil</span>&nbsp;<span class="op" id="5495713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495717">error_</span><span class="op" id="5495723">(</span><span class="ident" id="5495724">err</span><span class="op" id="5495727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5495730">}</span><br>
<span class="lineno">715</span><span class="op" id="5495732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5495735">//&nbsp;ignoreGobDecoder&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;GobDecoder&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5495817">func</span>&nbsp;<span class="op" id="5495822">(</span><span class="ident" id="5495823">dec</span>&nbsp;<span class="op" id="5495827">*</span><span class="ident" id="5495828">Decoder</span><span class="op" id="5495835">)</span>&nbsp;<span class="ident" id="5495837">ignoreGobDecoder</span><span class="op" id="5495853">(</span><span class="ident" id="5495854">state</span>&nbsp;<span class="op" id="5495860">*</span><span class="ident" id="5495861">decoderState</span><span class="op" id="5495873">)</span>&nbsp;<span class="op" id="5495875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5495878">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495912">b</span>&nbsp;<span class="op" id="5495914">:=</span>&nbsp;<span class="builtinfunc" id="5495917">make</span><span class="op" id="5495921">(</span><span class="op" id="5495922">[</span><span class="op" id="5495923">]</span><span class="builtintype" id="5495924">byte</span><span class="op" id="5495928">,</span>&nbsp;<span class="ident" id="5495930">state</span><span class="op" id="5495935">.</span><span class="ident" id="5495936">decodeUint</span><span class="op" id="5495946">(</span><span class="op" id="5495947">)</span><span class="op" id="5495948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495951">_</span><span class="op" id="5495952">,</span>&nbsp;<span class="ident" id="5495954">err</span>&nbsp;<span class="op" id="5495958">:=</span>&nbsp;<span class="ident" id="5495961">state</span><span class="op" id="5495966">.</span><span class="ident" id="5495967">b</span><span class="op" id="5495968">.</span><span class="ident" id="5495969">Read</span><span class="op" id="5495973">(</span><span class="ident" id="5495974">b</span><span class="op" id="5495975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5495978">if</span>&nbsp;<span class="ident" id="5495981">err</span>&nbsp;<span class="op" id="5495985">!=</span>&nbsp;<span class="builtintype" id="5495988">nil</span>&nbsp;<span class="op" id="5495992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5495996">error_</span><span class="op" id="5496002">(</span><span class="ident" id="5496003">err</span><span class="op" id="5496006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5496009">}</span><br>
<span class="lineno">725</span><span class="op" id="5496011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5496014">//&nbsp;Index&nbsp;by&nbsp;Go&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="5496036">var</span>&nbsp;<span class="ident" id="5496040">decOpTable</span>&nbsp;<span class="op" id="5496051">=</span>&nbsp;<span class="op" id="5496053">[</span><span class="op" id="5496054">...</span><span class="op" id="5496057">]</span><span class="ident" id="5496058">decOp</span><span class="op" id="5496063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496066">reflect</span><span class="op" id="5496073">.</span><span class="ident" id="5496074">Bool</span><span class="op" id="5496078">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496086">decBool</span><span class="op" id="5496093">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496096">reflect</span><span class="op" id="5496103">.</span><span class="ident" id="5496104">Int8</span><span class="op" id="5496108">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496116">decInt8</span><span class="op" id="5496123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496126">reflect</span><span class="op" id="5496133">.</span><span class="ident" id="5496134">Int16</span><span class="op" id="5496139">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496146">decInt16</span><span class="op" id="5496154">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496157">reflect</span><span class="op" id="5496164">.</span><span class="ident" id="5496165">Int32</span><span class="op" id="5496170">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496177">decInt32</span><span class="op" id="5496185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496188">reflect</span><span class="op" id="5496195">.</span><span class="ident" id="5496196">Int64</span><span class="op" id="5496201">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496208">decInt64</span><span class="op" id="5496216">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496219">reflect</span><span class="op" id="5496226">.</span><span class="ident" id="5496227">Uint8</span><span class="op" id="5496232">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496239">decUint8</span><span class="op" id="5496247">,</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496250">reflect</span><span class="op" id="5496257">.</span><span class="ident" id="5496258">Uint16</span><span class="op" id="5496264">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496270">decUint16</span><span class="op" id="5496279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496282">reflect</span><span class="op" id="5496289">.</span><span class="ident" id="5496290">Uint32</span><span class="op" id="5496296">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496302">decUint32</span><span class="op" id="5496311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496314">reflect</span><span class="op" id="5496321">.</span><span class="ident" id="5496322">Uint64</span><span class="op" id="5496328">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496334">decUint64</span><span class="op" id="5496343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496346">reflect</span><span class="op" id="5496353">.</span><span class="ident" id="5496354">Float32</span><span class="op" id="5496361">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496366">decFloat32</span><span class="op" id="5496376">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496379">reflect</span><span class="op" id="5496386">.</span><span class="ident" id="5496387">Float64</span><span class="op" id="5496394">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496399">decFloat64</span><span class="op" id="5496409">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496412">reflect</span><span class="op" id="5496419">.</span><span class="ident" id="5496420">Complex64</span><span class="op" id="5496429">:</span>&nbsp;&nbsp;<span class="ident" id="5496432">decComplex64</span><span class="op" id="5496444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496447">reflect</span><span class="op" id="5496454">.</span><span class="ident" id="5496455">Complex128</span><span class="op" id="5496465">:</span>&nbsp;<span class="ident" id="5496467">decComplex128</span><span class="op" id="5496480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496483">reflect</span><span class="op" id="5496490">.</span><span class="ident" id="5496491">String</span><span class="op" id="5496497">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496503">decString</span><span class="op" id="5496512">,</span><br>
<span class="lineno"></span><span class="op" id="5496514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">745</span><span class="comment" id="5496517">//&nbsp;Indexed&nbsp;by&nbsp;gob&nbsp;types.&nbsp;&nbsp;tComplex&nbsp;will&nbsp;be&nbsp;added&nbsp;during&nbsp;type.init().</span><br>
<span class="lineno"></span><span class="keyword" id="5496586">var</span>&nbsp;<span class="ident" id="5496590">decIgnoreOpMap</span>&nbsp;<span class="op" id="5496605">=</span>&nbsp;<span class="keyword" id="5496607">map</span><span class="op" id="5496610">[</span><span class="ident" id="5496611">typeId</span><span class="op" id="5496617">]</span><span class="ident" id="5496618">decOp</span><span class="op" id="5496623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496626">tBool</span><span class="op" id="5496631">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496636">ignoreUint</span><span class="op" id="5496646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496649">tInt</span><span class="op" id="5496653">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496659">ignoreUint</span><span class="op" id="5496669">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496672">tUint</span><span class="op" id="5496677">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496682">ignoreUint</span><span class="op" id="5496692">,</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496695">tFloat</span><span class="op" id="5496701">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5496705">ignoreUint</span><span class="op" id="5496715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496718">tBytes</span><span class="op" id="5496724">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5496728">ignoreUint8Array</span><span class="op" id="5496744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496747">tString</span><span class="op" id="5496754">:</span>&nbsp;&nbsp;<span class="ident" id="5496757">ignoreUint8Array</span><span class="op" id="5496773">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5496776">tComplex</span><span class="op" id="5496784">:</span>&nbsp;<span class="ident" id="5496786">ignoreTwoUints</span><span class="op" id="5496800">,</span><br>
<span class="lineno"></span><span class="op" id="5496802">}</span><br>
<span class="lineno">755</span><br>
<span class="lineno"></span><span class="comment" id="5496805">//&nbsp;decOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;the&nbsp;base&nbsp;type&nbsp;under&nbsp;rt&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5496872">//&nbsp;the&nbsp;indirection&nbsp;count&nbsp;to&nbsp;reach&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5496910">func</span>&nbsp;<span class="op" id="5496915">(</span><span class="ident" id="5496916">dec</span>&nbsp;<span class="op" id="5496920">*</span><span class="ident" id="5496921">Decoder</span><span class="op" id="5496928">)</span>&nbsp;<span class="ident" id="5496930">decOpFor</span><span class="op" id="5496938">(</span><span class="ident" id="5496939">wireId</span>&nbsp;<span class="ident" id="5496946">typeId</span><span class="op" id="5496952">,</span>&nbsp;<span class="ident" id="5496954">rt</span>&nbsp;<span class="ident" id="5496957">reflect</span><span class="op" id="5496964">.</span><span class="ident" id="5496965">Type</span><span class="op" id="5496969">,</span>&nbsp;<span class="ident" id="5496971">name</span>&nbsp;<span class="builtintype" id="5496976">string</span><span class="op" id="5496982">,</span>&nbsp;<span class="ident" id="5496984">inProgress</span>&nbsp;<span class="keyword" id="5496995">map</span><span class="op" id="5496998">[</span><span class="ident" id="5496999">reflect</span><span class="op" id="5497006">.</span><span class="ident" id="5497007">Type</span><span class="op" id="5497011">]</span><span class="op" id="5497012">*</span><span class="ident" id="5497013">decOp</span><span class="op" id="5497018">)</span>&nbsp;<span class="op" id="5497020">*</span><span class="ident" id="5497021">decOp</span>&nbsp;<span class="op" id="5497027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497030">ut</span>&nbsp;<span class="op" id="5497033">:=</span>&nbsp;<span class="ident" id="5497036">userType</span><span class="op" id="5497044">(</span><span class="ident" id="5497045">rt</span><span class="op" id="5497047">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5497050">//&nbsp;If&nbsp;the&nbsp;type&nbsp;implements&nbsp;GobEncoder,&nbsp;we&nbsp;handle&nbsp;it&nbsp;without&nbsp;further&nbsp;processing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497130">if</span>&nbsp;<span class="ident" id="5497133">ut</span><span class="op" id="5497135">.</span><span class="ident" id="5497136">externalDec</span>&nbsp;<span class="op" id="5497148">!=</span>&nbsp;<span class="num" id="5497151">0</span>&nbsp;<span class="op" id="5497153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497157">return</span>&nbsp;<span class="ident" id="5497164">dec</span><span class="op" id="5497167">.</span><span class="ident" id="5497168">gobDecodeOpFor</span><span class="op" id="5497182">(</span><span class="ident" id="5497183">ut</span><span class="op" id="5497185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5497188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5497192">//&nbsp;If&nbsp;this&nbsp;type&nbsp;is&nbsp;already&nbsp;in&nbsp;progress,&nbsp;it&#39;s&nbsp;a&nbsp;recursive&nbsp;type&nbsp;(e.g.&nbsp;map[string]*T).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5497277">//&nbsp;Return&nbsp;the&nbsp;pointer&nbsp;to&nbsp;the&nbsp;op&nbsp;we&#39;re&nbsp;already&nbsp;building.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497334">if</span>&nbsp;<span class="ident" id="5497337">opPtr</span>&nbsp;<span class="op" id="5497343">:=</span>&nbsp;<span class="ident" id="5497346">inProgress</span><span class="op" id="5497356">[</span><span class="ident" id="5497357">rt</span><span class="op" id="5497359">]</span><span class="op" id="5497360">;</span>&nbsp;<span class="ident" id="5497362">opPtr</span>&nbsp;<span class="op" id="5497368">!=</span>&nbsp;<span class="builtintype" id="5497371">nil</span>&nbsp;<span class="op" id="5497375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497379">return</span>&nbsp;<span class="ident" id="5497386">opPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5497393">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497396">typ</span>&nbsp;<span class="op" id="5497400">:=</span>&nbsp;<span class="ident" id="5497403">ut</span><span class="op" id="5497405">.</span><span class="ident" id="5497406">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497412">var</span>&nbsp;<span class="ident" id="5497416">op</span>&nbsp;<span class="ident" id="5497419">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497426">k</span>&nbsp;<span class="op" id="5497428">:=</span>&nbsp;<span class="ident" id="5497431">typ</span><span class="op" id="5497434">.</span><span class="ident" id="5497435">Kind</span><span class="op" id="5497439">(</span><span class="op" id="5497440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497443">if</span>&nbsp;<span class="builtintype" id="5497446">int</span><span class="op" id="5497449">(</span><span class="ident" id="5497450">k</span><span class="op" id="5497451">)</span>&nbsp;<span class="op" id="5497453">&lt;</span>&nbsp;<span class="builtinfunc" id="5497455">len</span><span class="op" id="5497458">(</span><span class="ident" id="5497459">decOpTable</span><span class="op" id="5497469">)</span>&nbsp;<span class="op" id="5497471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497475">op</span>&nbsp;<span class="op" id="5497478">=</span>&nbsp;<span class="ident" id="5497480">decOpTable</span><span class="op" id="5497490">[</span><span class="ident" id="5497491">k</span><span class="op" id="5497492">]</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5497495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497498">if</span>&nbsp;<span class="ident" id="5497501">op</span>&nbsp;<span class="op" id="5497504">==</span>&nbsp;<span class="builtintype" id="5497507">nil</span>&nbsp;<span class="op" id="5497511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497515">inProgress</span><span class="op" id="5497525">[</span><span class="ident" id="5497526">rt</span><span class="op" id="5497528">]</span>&nbsp;<span class="op" id="5497530">=</span>&nbsp;<span class="op" id="5497532">&amp;</span><span class="ident" id="5497533">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5497538">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497557">switch</span>&nbsp;<span class="ident" id="5497564">t</span>&nbsp;<span class="op" id="5497566">:=</span>&nbsp;<span class="ident" id="5497569">typ</span><span class="op" id="5497572">;</span>&nbsp;<span class="ident" id="5497574">t</span><span class="op" id="5497575">.</span><span class="ident" id="5497576">Kind</span><span class="op" id="5497580">(</span><span class="op" id="5497581">)</span>&nbsp;<span class="op" id="5497583">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497587">case</span>&nbsp;<span class="ident" id="5497592">reflect</span><span class="op" id="5497599">.</span><span class="ident" id="5497600">Array</span><span class="op" id="5497605">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497610">name</span>&nbsp;<span class="op" id="5497615">=</span>&nbsp;<span class="string" id="5497617">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="5497631">+</span>&nbsp;<span class="ident" id="5497633">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497641">elemId</span>&nbsp;<span class="op" id="5497648">:=</span>&nbsp;<span class="ident" id="5497651">dec</span><span class="op" id="5497654">.</span><span class="ident" id="5497655">wireType</span><span class="op" id="5497663">[</span><span class="ident" id="5497664">wireId</span><span class="op" id="5497670">]</span><span class="op" id="5497671">.</span><span class="ident" id="5497672">ArrayT</span><span class="op" id="5497678">.</span><span class="ident" id="5497679">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497687">elemOp</span>&nbsp;<span class="op" id="5497694">:=</span>&nbsp;<span class="ident" id="5497697">dec</span><span class="op" id="5497700">.</span><span class="ident" id="5497701">decOpFor</span><span class="op" id="5497709">(</span><span class="ident" id="5497710">elemId</span><span class="op" id="5497716">,</span>&nbsp;<span class="ident" id="5497718">t</span><span class="op" id="5497719">.</span><span class="ident" id="5497720">Elem</span><span class="op" id="5497724">(</span><span class="op" id="5497725">)</span><span class="op" id="5497726">,</span>&nbsp;<span class="ident" id="5497728">name</span><span class="op" id="5497732">,</span>&nbsp;<span class="ident" id="5497734">inProgress</span><span class="op" id="5497744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497749">ovfl</span>&nbsp;<span class="op" id="5497754">:=</span>&nbsp;<span class="ident" id="5497757">overflow</span><span class="op" id="5497765">(</span><span class="ident" id="5497766">name</span><span class="op" id="5497770">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497775">helper</span>&nbsp;<span class="op" id="5497782">:=</span>&nbsp;<span class="ident" id="5497785">decArrayHelper</span><span class="op" id="5497799">[</span><span class="ident" id="5497800">t</span><span class="op" id="5497801">.</span><span class="ident" id="5497802">Elem</span><span class="op" id="5497806">(</span><span class="op" id="5497807">)</span><span class="op" id="5497808">.</span><span class="ident" id="5497809">Kind</span><span class="op" id="5497813">(</span><span class="op" id="5497814">)</span><span class="op" id="5497815">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497820">op</span>&nbsp;<span class="op" id="5497823">=</span>&nbsp;<span class="keyword" id="5497825">func</span><span class="op" id="5497829">(</span><span class="ident" id="5497830">i</span>&nbsp;<span class="op" id="5497832">*</span><span class="ident" id="5497833">decInstr</span><span class="op" id="5497841">,</span>&nbsp;<span class="ident" id="5497843">state</span>&nbsp;<span class="op" id="5497849">*</span><span class="ident" id="5497850">decoderState</span><span class="op" id="5497862">,</span>&nbsp;<span class="ident" id="5497864">value</span>&nbsp;<span class="ident" id="5497870">reflect</span><span class="op" id="5497877">.</span><span class="ident" id="5497878">Value</span><span class="op" id="5497883">)</span>&nbsp;<span class="op" id="5497885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497891">state</span><span class="op" id="5497896">.</span><span class="ident" id="5497897">dec</span><span class="op" id="5497900">.</span><span class="ident" id="5497901">decodeArray</span><span class="op" id="5497912">(</span><span class="ident" id="5497913">t</span><span class="op" id="5497914">,</span>&nbsp;<span class="ident" id="5497916">state</span><span class="op" id="5497921">,</span>&nbsp;<span class="ident" id="5497923">value</span><span class="op" id="5497928">,</span>&nbsp;<span class="op" id="5497930">*</span><span class="ident" id="5497931">elemOp</span><span class="op" id="5497937">,</span>&nbsp;<span class="ident" id="5497939">t</span><span class="op" id="5497940">.</span><span class="ident" id="5497941">Len</span><span class="op" id="5497944">(</span><span class="op" id="5497945">)</span><span class="op" id="5497946">,</span>&nbsp;<span class="ident" id="5497948">ovfl</span><span class="op" id="5497952">,</span>&nbsp;<span class="ident" id="5497954">helper</span><span class="op" id="5497960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5497965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497970">case</span>&nbsp;<span class="ident" id="5497975">reflect</span><span class="op" id="5497982">.</span><span class="ident" id="5497983">Map</span><span class="op" id="5497986">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497991">keyId</span>&nbsp;<span class="op" id="5497997">:=</span>&nbsp;<span class="ident" id="5498000">dec</span><span class="op" id="5498003">.</span><span class="ident" id="5498004">wireType</span><span class="op" id="5498012">[</span><span class="ident" id="5498013">wireId</span><span class="op" id="5498019">]</span><span class="op" id="5498020">.</span><span class="ident" id="5498021">MapT</span><span class="op" id="5498025">.</span><span class="ident" id="5498026">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498033">elemId</span>&nbsp;<span class="op" id="5498040">:=</span>&nbsp;<span class="ident" id="5498043">dec</span><span class="op" id="5498046">.</span><span class="ident" id="5498047">wireType</span><span class="op" id="5498055">[</span><span class="ident" id="5498056">wireId</span><span class="op" id="5498062">]</span><span class="op" id="5498063">.</span><span class="ident" id="5498064">MapT</span><span class="op" id="5498068">.</span><span class="ident" id="5498069">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498077">keyOp</span>&nbsp;<span class="op" id="5498083">:=</span>&nbsp;<span class="ident" id="5498086">dec</span><span class="op" id="5498089">.</span><span class="ident" id="5498090">decOpFor</span><span class="op" id="5498098">(</span><span class="ident" id="5498099">keyId</span><span class="op" id="5498104">,</span>&nbsp;<span class="ident" id="5498106">t</span><span class="op" id="5498107">.</span><span class="ident" id="5498108">Key</span><span class="op" id="5498111">(</span><span class="op" id="5498112">)</span><span class="op" id="5498113">,</span>&nbsp;<span class="string" id="5498115">&#34;key&nbsp;of&nbsp;&#34;</span><span class="op" id="5498124">+</span><span class="ident" id="5498125">name</span><span class="op" id="5498129">,</span>&nbsp;<span class="ident" id="5498131">inProgress</span><span class="op" id="5498141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498146">elemOp</span>&nbsp;<span class="op" id="5498153">:=</span>&nbsp;<span class="ident" id="5498156">dec</span><span class="op" id="5498159">.</span><span class="ident" id="5498160">decOpFor</span><span class="op" id="5498168">(</span><span class="ident" id="5498169">elemId</span><span class="op" id="5498175">,</span>&nbsp;<span class="ident" id="5498177">t</span><span class="op" id="5498178">.</span><span class="ident" id="5498179">Elem</span><span class="op" id="5498183">(</span><span class="op" id="5498184">)</span><span class="op" id="5498185">,</span>&nbsp;<span class="string" id="5498187">&#34;element&nbsp;of&nbsp;&#34;</span><span class="op" id="5498200">+</span><span class="ident" id="5498201">name</span><span class="op" id="5498205">,</span>&nbsp;<span class="ident" id="5498207">inProgress</span><span class="op" id="5498217">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498222">ovfl</span>&nbsp;<span class="op" id="5498227">:=</span>&nbsp;<span class="ident" id="5498230">overflow</span><span class="op" id="5498238">(</span><span class="ident" id="5498239">name</span><span class="op" id="5498243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498248">op</span>&nbsp;<span class="op" id="5498251">=</span>&nbsp;<span class="keyword" id="5498253">func</span><span class="op" id="5498257">(</span><span class="ident" id="5498258">i</span>&nbsp;<span class="op" id="5498260">*</span><span class="ident" id="5498261">decInstr</span><span class="op" id="5498269">,</span>&nbsp;<span class="ident" id="5498271">state</span>&nbsp;<span class="op" id="5498277">*</span><span class="ident" id="5498278">decoderState</span><span class="op" id="5498290">,</span>&nbsp;<span class="ident" id="5498292">value</span>&nbsp;<span class="ident" id="5498298">reflect</span><span class="op" id="5498305">.</span><span class="ident" id="5498306">Value</span><span class="op" id="5498311">)</span>&nbsp;<span class="op" id="5498313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498319">state</span><span class="op" id="5498324">.</span><span class="ident" id="5498325">dec</span><span class="op" id="5498328">.</span><span class="ident" id="5498329">decodeMap</span><span class="op" id="5498338">(</span><span class="ident" id="5498339">t</span><span class="op" id="5498340">,</span>&nbsp;<span class="ident" id="5498342">state</span><span class="op" id="5498347">,</span>&nbsp;<span class="ident" id="5498349">value</span><span class="op" id="5498354">,</span>&nbsp;<span class="op" id="5498356">*</span><span class="ident" id="5498357">keyOp</span><span class="op" id="5498362">,</span>&nbsp;<span class="op" id="5498364">*</span><span class="ident" id="5498365">elemOp</span><span class="op" id="5498371">,</span>&nbsp;<span class="ident" id="5498373">ovfl</span><span class="op" id="5498377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5498382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498387">case</span>&nbsp;<span class="ident" id="5498392">reflect</span><span class="op" id="5498399">.</span><span class="ident" id="5498400">Slice</span><span class="op" id="5498405">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498410">name</span>&nbsp;<span class="op" id="5498415">=</span>&nbsp;<span class="string" id="5498417">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="5498431">+</span>&nbsp;<span class="ident" id="5498433">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498441">if</span>&nbsp;<span class="ident" id="5498444">t</span><span class="op" id="5498445">.</span><span class="ident" id="5498446">Elem</span><span class="op" id="5498450">(</span><span class="op" id="5498451">)</span><span class="op" id="5498452">.</span><span class="ident" id="5498453">Kind</span><span class="op" id="5498457">(</span><span class="op" id="5498458">)</span>&nbsp;<span class="op" id="5498460">==</span>&nbsp;<span class="ident" id="5498463">reflect</span><span class="op" id="5498470">.</span><span class="ident" id="5498471">Uint8</span>&nbsp;<span class="op" id="5498477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498483">op</span>&nbsp;<span class="op" id="5498486">=</span>&nbsp;<span class="ident" id="5498488">decUint8Slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498506">break</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5498515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498520">var</span>&nbsp;<span class="ident" id="5498524">elemId</span>&nbsp;<span class="ident" id="5498531">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498541">if</span>&nbsp;<span class="ident" id="5498544">tt</span><span class="op" id="5498546">,</span>&nbsp;<span class="ident" id="5498548">ok</span>&nbsp;<span class="op" id="5498551">:=</span>&nbsp;<span class="ident" id="5498554">builtinIdToType</span><span class="op" id="5498569">[</span><span class="ident" id="5498570">wireId</span><span class="op" id="5498576">]</span><span class="op" id="5498577">;</span>&nbsp;<span class="ident" id="5498579">ok</span>&nbsp;<span class="op" id="5498582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498588">elemId</span>&nbsp;<span class="op" id="5498595">=</span>&nbsp;<span class="ident" id="5498597">tt</span><span class="op" id="5498599">.</span><span class="op" id="5498600">(</span><span class="op" id="5498601">*</span><span class="ident" id="5498602">sliceType</span><span class="op" id="5498611">)</span><span class="op" id="5498612">.</span><span class="ident" id="5498613">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5498621">}</span>&nbsp;<span class="keyword" id="5498623">else</span>&nbsp;<span class="op" id="5498628">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498634">elemId</span>&nbsp;<span class="op" id="5498641">=</span>&nbsp;<span class="ident" id="5498643">dec</span><span class="op" id="5498646">.</span><span class="ident" id="5498647">wireType</span><span class="op" id="5498655">[</span><span class="ident" id="5498656">wireId</span><span class="op" id="5498662">]</span><span class="op" id="5498663">.</span><span class="ident" id="5498664">SliceT</span><span class="op" id="5498670">.</span><span class="ident" id="5498671">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5498679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498684">elemOp</span>&nbsp;<span class="op" id="5498691">:=</span>&nbsp;<span class="ident" id="5498694">dec</span><span class="op" id="5498697">.</span><span class="ident" id="5498698">decOpFor</span><span class="op" id="5498706">(</span><span class="ident" id="5498707">elemId</span><span class="op" id="5498713">,</span>&nbsp;<span class="ident" id="5498715">t</span><span class="op" id="5498716">.</span><span class="ident" id="5498717">Elem</span><span class="op" id="5498721">(</span><span class="op" id="5498722">)</span><span class="op" id="5498723">,</span>&nbsp;<span class="ident" id="5498725">name</span><span class="op" id="5498729">,</span>&nbsp;<span class="ident" id="5498731">inProgress</span><span class="op" id="5498741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498746">ovfl</span>&nbsp;<span class="op" id="5498751">:=</span>&nbsp;<span class="ident" id="5498754">overflow</span><span class="op" id="5498762">(</span><span class="ident" id="5498763">name</span><span class="op" id="5498767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498772">helper</span>&nbsp;<span class="op" id="5498779">:=</span>&nbsp;<span class="ident" id="5498782">decSliceHelper</span><span class="op" id="5498796">[</span><span class="ident" id="5498797">t</span><span class="op" id="5498798">.</span><span class="ident" id="5498799">Elem</span><span class="op" id="5498803">(</span><span class="op" id="5498804">)</span><span class="op" id="5498805">.</span><span class="ident" id="5498806">Kind</span><span class="op" id="5498810">(</span><span class="op" id="5498811">)</span><span class="op" id="5498812">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498817">op</span>&nbsp;<span class="op" id="5498820">=</span>&nbsp;<span class="keyword" id="5498822">func</span><span class="op" id="5498826">(</span><span class="ident" id="5498827">i</span>&nbsp;<span class="op" id="5498829">*</span><span class="ident" id="5498830">decInstr</span><span class="op" id="5498838">,</span>&nbsp;<span class="ident" id="5498840">state</span>&nbsp;<span class="op" id="5498846">*</span><span class="ident" id="5498847">decoderState</span><span class="op" id="5498859">,</span>&nbsp;<span class="ident" id="5498861">value</span>&nbsp;<span class="ident" id="5498867">reflect</span><span class="op" id="5498874">.</span><span class="ident" id="5498875">Value</span><span class="op" id="5498880">)</span>&nbsp;<span class="op" id="5498882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5498888">state</span><span class="op" id="5498893">.</span><span class="ident" id="5498894">dec</span><span class="op" id="5498897">.</span><span class="ident" id="5498898">decodeSlice</span><span class="op" id="5498909">(</span><span class="ident" id="5498910">state</span><span class="op" id="5498915">,</span>&nbsp;<span class="ident" id="5498917">value</span><span class="op" id="5498922">,</span>&nbsp;<span class="op" id="5498924">*</span><span class="ident" id="5498925">elemOp</span><span class="op" id="5498931">,</span>&nbsp;<span class="ident" id="5498933">ovfl</span><span class="op" id="5498937">,</span>&nbsp;<span class="ident" id="5498939">helper</span><span class="op" id="5498945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5498950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5498955">case</span>&nbsp;<span class="ident" id="5498960">reflect</span><span class="op" id="5498967">.</span><span class="ident" id="5498968">Struct</span><span class="op" id="5498974">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5498979">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5499054">ut</span>&nbsp;<span class="op" id="5499057">:=</span>&nbsp;<span class="ident" id="5499060">userType</span><span class="op" id="5499068">(</span><span class="ident" id="5499069">typ</span><span class="op" id="5499072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5499077">enginePtr</span><span class="op" id="5499086">,</span>&nbsp;<span class="ident" id="5499088">err</span>&nbsp;<span class="op" id="5499092">:=</span>&nbsp;<span class="ident" id="5499095">dec</span><span class="op" id="5499098">.</span><span class="ident" id="5499099">getDecEnginePtr</span><span class="op" id="5499114">(</span><span class="ident" id="5499115">wireId</span><span class="op" id="5499121">,</span>&nbsp;<span class="ident" id="5499123">ut</span><span class="op" id="5499125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5499130">if</span>&nbsp;<span class="ident" id="5499133">err</span>&nbsp;<span class="op" id="5499137">!=</span>&nbsp;<span class="builtintype" id="5499140">nil</span>&nbsp;<span class="op" id="5499144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5499150">error_</span><span class="op" id="5499156">(</span><span class="ident" id="5499157">err</span><span class="op" id="5499160">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5499165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5499170">op</span>&nbsp;<span class="op" id="5499173">=</span>&nbsp;<span class="keyword" id="5499175">func</span><span class="op" id="5499179">(</span><span class="ident" id="5499180">i</span>&nbsp;<span class="op" id="5499182">*</span><span class="ident" id="5499183">decInstr</span><span class="op" id="5499191">,</span>&nbsp;<span class="ident" id="5499193">state</span>&nbsp;<span class="op" id="5499199">*</span><span class="ident" id="5499200">decoderState</span><span class="op" id="5499212">,</span>&nbsp;<span class="ident" id="5499214">value</span>&nbsp;<span class="ident" id="5499220">reflect</span><span class="op" id="5499227">.</span><span class="ident" id="5499228">Value</span><span class="op" id="5499233">)</span>&nbsp;<span class="op" id="5499235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5499241">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5499318">dec</span><span class="op" id="5499321">.</span><span class="ident" id="5499322">decodeStruct</span><span class="op" id="5499334">(</span><span class="op" id="5499335">*</span><span class="ident" id="5499336">enginePtr</span><span class="op" id="5499345">,</span>&nbsp;<span class="ident" id="5499347">ut</span><span class="op" id="5499349">,</span>&nbsp;<span class="ident" id="5499351">value</span><span class="op" id="5499356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5499361">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5499365">case</span>&nbsp;<span class="ident" id="5499370">reflect</span><span class="op" id="5499377">.</span><span class="ident" id="5499378">Interface</span><span class="op" id="5499387">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5499392">op</span>&nbsp;<span class="op" id="5499395">=</span>&nbsp;<span class="keyword" id="5499397">func</span><span class="op" id="5499401">(</span><span class="ident" id="5499402">i</span>&nbsp;<span class="op" id="5499404">*</span><span class="ident" id="5499405">decInstr</span><span class="op" id="5499413">,</span>&nbsp;<span class="ident" id="5499415">state</span>&nbsp;<span class="op" id="5499421">*</span><span class="ident" id="5499422">decoderState</span><span class="op" id="5499434">,</span>&nbsp;<span class="ident" id="5499436">value</span>&nbsp;<span class="ident" id="5499442">reflect</span><span class="op" id="5499449">.</span><span class="ident" id="5499450">Value</span><span class="op" id="5499455">)</span>&nbsp;<span class="op" id="5499457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5499463">state</span><span class="op" id="5499468">.</span><span class="ident" id="5499469">dec</span><span class="op" id="5499472">.</span><span class="ident" id="5499473">decodeInterface</span><span class="op" id="5499488">(</span><span class="ident" id="5499489">t</span><span class="op" id="5499490">,</span>&nbsp;<span class="ident" id="5499492">state</span><span class="op" id="5499497">,</span>&nbsp;<span class="ident" id="5499499">value</span><span class="op" id="5499504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5499509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5499513">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5499516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5499519">if</span>&nbsp;<span class="ident" id="5499522">op</span>&nbsp;<span class="op" id="5499525">==</span>&nbsp;<span class="builtintype" id="5499528">nil</span>&nbsp;<span class="op" id="5499532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5499536">errorf</span><span class="op" id="5499542">(</span><span class="string" id="5499543">&#34;decode&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5499572">,</span>&nbsp;<span class="ident" id="5499574">rt</span><span class="op" id="5499576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5499579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5499582">return</span>&nbsp;<span class="op" id="5499589">&amp;</span><span class="ident" id="5499590">op</span><br>
<span class="lineno">840</span><span class="op" id="5499593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5499596">//&nbsp;decIgnoreOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;a&nbsp;field&nbsp;that&nbsp;has&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5499675">func</span>&nbsp;<span class="op" id="5499680">(</span><span class="ident" id="5499681">dec</span>&nbsp;<span class="op" id="5499685">*</span><span class="ident" id="5499686">Decoder</span><span class="op" id="5499693">)</span>&nbsp;<span class="ident" id="5499695">decIgnoreOpFor</span><span class="op" id="5499709">(</span><span class="ident" id="5499710">wireId</span>&nbsp;<span class="ident" id="5499717">typeId</span><span class="op" id="5499723">)</span>&nbsp;<span class="ident" id="5499725">decOp</span>&nbsp;<span class="op" id="5499731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5499734">op</span><span class="op" id="5499736">,</span>&nbsp;<span class="ident" id="5499738">ok</span>&nbsp;<span class="op" id="5499741">:=</span>&nbsp;<span class="ident" id="5499744">decIgnoreOpMap</span><span class="op" id="5499758">[</span><span class="ident" id="5499759">wireId</span><span class="op" id="5499765">]</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5499768">if</span>&nbsp;<span class="op" id="5499771">!</span><span class="ident" id="5499772">ok</span>&nbsp;<span class="op" id="5499775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5499779">if</span>&nbsp;<span class="ident" id="5499782">wireId</span>&nbsp;<span class="op" id="5499789">==</span>&nbsp;<span class="ident" id="5499792">tInterface</span>&nbsp;<span class="op" id="5499803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5499808">//&nbsp;Special&nbsp;case&nbsp;because&nbsp;it&#39;s&nbsp;a&nbsp;method:&nbsp;the&nbsp;ignored&nbsp;item&nbsp;might</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5499873">//&nbsp;define&nbsp;types&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;record&nbsp;their&nbsp;state&nbsp;in&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5499942">op</span>&nbsp;<span class="op" id="5499945">=</span>&nbsp;<span class="keyword" id="5499947">func</span><span class="op" id="5499951">(</span><span class="ident" id="5499952">i</span>&nbsp;<span class="op" id="5499954">*</span><span class="ident" id="5499955">decInstr</span><span class="op" id="5499963">,</span>&nbsp;<span class="ident" id="5499965">state</span>&nbsp;<span class="op" id="5499971">*</span><span class="ident" id="5499972">decoderState</span><span class="op" id="5499984">,</span>&nbsp;<span class="ident" id="5499986">value</span>&nbsp;<span class="ident" id="5499992">reflect</span><span class="op" id="5499999">.</span><span class="ident" id="5500000">Value</span><span class="op" id="5500005">)</span>&nbsp;<span class="op" id="5500007">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500013">state</span><span class="op" id="5500018">.</span><span class="ident" id="5500019">dec</span><span class="op" id="5500022">.</span><span class="ident" id="5500023">ignoreInterface</span><span class="op" id="5500038">(</span><span class="ident" id="5500039">state</span><span class="op" id="5500044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5500049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5500054">return</span>&nbsp;<span class="ident" id="5500061">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5500066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5500070">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500089">wire</span>&nbsp;<span class="op" id="5500094">:=</span>&nbsp;<span class="ident" id="5500097">dec</span><span class="op" id="5500100">.</span><span class="ident" id="5500101">wireType</span><span class="op" id="5500109">[</span><span class="ident" id="5500110">wireId</span><span class="op" id="5500116">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5500120">switch</span>&nbsp;<span class="op" id="5500127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5500131">case</span>&nbsp;<span class="ident" id="5500136">wire</span>&nbsp;<span class="op" id="5500141">==</span>&nbsp;<span class="builtintype" id="5500144">nil</span><span class="op" id="5500147">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500152">errorf</span><span class="op" id="5500158">(</span><span class="string" id="5500159">&#34;bad&nbsp;data:&nbsp;undefined&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5500188">,</span>&nbsp;<span class="ident" id="5500190">wireId</span><span class="op" id="5500196">.</span><span class="builtintype" id="5500197">string</span><span class="op" id="5500203">(</span><span class="op" id="5500204">)</span><span class="op" id="5500205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5500209">case</span>&nbsp;<span class="ident" id="5500214">wire</span><span class="op" id="5500218">.</span><span class="ident" id="5500219">ArrayT</span>&nbsp;<span class="op" id="5500226">!=</span>&nbsp;<span class="builtintype" id="5500229">nil</span><span class="op" id="5500232">:</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500237">elemId</span>&nbsp;<span class="op" id="5500244">:=</span>&nbsp;<span class="ident" id="5500247">wire</span><span class="op" id="5500251">.</span><span class="ident" id="5500252">ArrayT</span><span class="op" id="5500258">.</span><span class="ident" id="5500259">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500267">elemOp</span>&nbsp;<span class="op" id="5500274">:=</span>&nbsp;<span class="ident" id="5500277">dec</span><span class="op" id="5500280">.</span><span class="ident" id="5500281">decIgnoreOpFor</span><span class="op" id="5500295">(</span><span class="ident" id="5500296">elemId</span><span class="op" id="5500302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500307">op</span>&nbsp;<span class="op" id="5500310">=</span>&nbsp;<span class="keyword" id="5500312">func</span><span class="op" id="5500316">(</span><span class="ident" id="5500317">i</span>&nbsp;<span class="op" id="5500319">*</span><span class="ident" id="5500320">decInstr</span><span class="op" id="5500328">,</span>&nbsp;<span class="ident" id="5500330">state</span>&nbsp;<span class="op" id="5500336">*</span><span class="ident" id="5500337">decoderState</span><span class="op" id="5500349">,</span>&nbsp;<span class="ident" id="5500351">value</span>&nbsp;<span class="ident" id="5500357">reflect</span><span class="op" id="5500364">.</span><span class="ident" id="5500365">Value</span><span class="op" id="5500370">)</span>&nbsp;<span class="op" id="5500372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500378">state</span><span class="op" id="5500383">.</span><span class="ident" id="5500384">dec</span><span class="op" id="5500387">.</span><span class="ident" id="5500388">ignoreArray</span><span class="op" id="5500399">(</span><span class="ident" id="5500400">state</span><span class="op" id="5500405">,</span>&nbsp;<span class="ident" id="5500407">elemOp</span><span class="op" id="5500413">,</span>&nbsp;<span class="ident" id="5500415">wire</span><span class="op" id="5500419">.</span><span class="ident" id="5500420">ArrayT</span><span class="op" id="5500426">.</span><span class="ident" id="5500427">Len</span><span class="op" id="5500430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5500435">}</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5500440">case</span>&nbsp;<span class="ident" id="5500445">wire</span><span class="op" id="5500449">.</span><span class="ident" id="5500450">MapT</span>&nbsp;<span class="op" id="5500455">!=</span>&nbsp;<span class="builtintype" id="5500458">nil</span><span class="op" id="5500461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500466">keyId</span>&nbsp;<span class="op" id="5500472">:=</span>&nbsp;<span class="ident" id="5500475">dec</span><span class="op" id="5500478">.</span><span class="ident" id="5500479">wireType</span><span class="op" id="5500487">[</span><span class="ident" id="5500488">wireId</span><span class="op" id="5500494">]</span><span class="op" id="5500495">.</span><span class="ident" id="5500496">MapT</span><span class="op" id="5500500">.</span><span class="ident" id="5500501">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500508">elemId</span>&nbsp;<span class="op" id="5500515">:=</span>&nbsp;<span class="ident" id="5500518">dec</span><span class="op" id="5500521">.</span><span class="ident" id="5500522">wireType</span><span class="op" id="5500530">[</span><span class="ident" id="5500531">wireId</span><span class="op" id="5500537">]</span><span class="op" id="5500538">.</span><span class="ident" id="5500539">MapT</span><span class="op" id="5500543">.</span><span class="ident" id="5500544">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500552">keyOp</span>&nbsp;<span class="op" id="5500558">:=</span>&nbsp;<span class="ident" id="5500561">dec</span><span class="op" id="5500564">.</span><span class="ident" id="5500565">decIgnoreOpFor</span><span class="op" id="5500579">(</span><span class="ident" id="5500580">keyId</span><span class="op" id="5500585">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500590">elemOp</span>&nbsp;<span class="op" id="5500597">:=</span>&nbsp;<span class="ident" id="5500600">dec</span><span class="op" id="5500603">.</span><span class="ident" id="5500604">decIgnoreOpFor</span><span class="op" id="5500618">(</span><span class="ident" id="5500619">elemId</span><span class="op" id="5500625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500630">op</span>&nbsp;<span class="op" id="5500633">=</span>&nbsp;<span class="keyword" id="5500635">func</span><span class="op" id="5500639">(</span><span class="ident" id="5500640">i</span>&nbsp;<span class="op" id="5500642">*</span><span class="ident" id="5500643">decInstr</span><span class="op" id="5500651">,</span>&nbsp;<span class="ident" id="5500653">state</span>&nbsp;<span class="op" id="5500659">*</span><span class="ident" id="5500660">decoderState</span><span class="op" id="5500672">,</span>&nbsp;<span class="ident" id="5500674">value</span>&nbsp;<span class="ident" id="5500680">reflect</span><span class="op" id="5500687">.</span><span class="ident" id="5500688">Value</span><span class="op" id="5500693">)</span>&nbsp;<span class="op" id="5500695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500701">state</span><span class="op" id="5500706">.</span><span class="ident" id="5500707">dec</span><span class="op" id="5500710">.</span><span class="ident" id="5500711">ignoreMap</span><span class="op" id="5500720">(</span><span class="ident" id="5500721">state</span><span class="op" id="5500726">,</span>&nbsp;<span class="ident" id="5500728">keyOp</span><span class="op" id="5500733">,</span>&nbsp;<span class="ident" id="5500735">elemOp</span><span class="op" id="5500741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5500746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5500751">case</span>&nbsp;<span class="ident" id="5500756">wire</span><span class="op" id="5500760">.</span><span class="ident" id="5500761">SliceT</span>&nbsp;<span class="op" id="5500768">!=</span>&nbsp;<span class="builtintype" id="5500771">nil</span><span class="op" id="5500774">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500779">elemId</span>&nbsp;<span class="op" id="5500786">:=</span>&nbsp;<span class="ident" id="5500789">wire</span><span class="op" id="5500793">.</span><span class="ident" id="5500794">SliceT</span><span class="op" id="5500800">.</span><span class="ident" id="5500801">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500809">elemOp</span>&nbsp;<span class="op" id="5500816">:=</span>&nbsp;<span class="ident" id="5500819">dec</span><span class="op" id="5500822">.</span><span class="ident" id="5500823">decIgnoreOpFor</span><span class="op" id="5500837">(</span><span class="ident" id="5500838">elemId</span><span class="op" id="5500844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500849">op</span>&nbsp;<span class="op" id="5500852">=</span>&nbsp;<span class="keyword" id="5500854">func</span><span class="op" id="5500858">(</span><span class="ident" id="5500859">i</span>&nbsp;<span class="op" id="5500861">*</span><span class="ident" id="5500862">decInstr</span><span class="op" id="5500870">,</span>&nbsp;<span class="ident" id="5500872">state</span>&nbsp;<span class="op" id="5500878">*</span><span class="ident" id="5500879">decoderState</span><span class="op" id="5500891">,</span>&nbsp;<span class="ident" id="5500893">value</span>&nbsp;<span class="ident" id="5500899">reflect</span><span class="op" id="5500906">.</span><span class="ident" id="5500907">Value</span><span class="op" id="5500912">)</span>&nbsp;<span class="op" id="5500914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5500920">state</span><span class="op" id="5500925">.</span><span class="ident" id="5500926">dec</span><span class="op" id="5500929">.</span><span class="ident" id="5500930">ignoreSlice</span><span class="op" id="5500941">(</span><span class="ident" id="5500942">state</span><span class="op" id="5500947">,</span>&nbsp;<span class="ident" id="5500949">elemOp</span><span class="op" id="5500955">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5500960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5500965">case</span>&nbsp;<span class="ident" id="5500970">wire</span><span class="op" id="5500974">.</span><span class="ident" id="5500975">StructT</span>&nbsp;<span class="op" id="5500983">!=</span>&nbsp;<span class="builtintype" id="5500986">nil</span><span class="op" id="5500989">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5500994">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501069">enginePtr</span><span class="op" id="5501078">,</span>&nbsp;<span class="ident" id="5501080">err</span>&nbsp;<span class="op" id="5501084">:=</span>&nbsp;<span class="ident" id="5501087">dec</span><span class="op" id="5501090">.</span><span class="ident" id="5501091">getIgnoreEnginePtr</span><span class="op" id="5501109">(</span><span class="ident" id="5501110">wireId</span><span class="op" id="5501116">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501121">if</span>&nbsp;<span class="ident" id="5501124">err</span>&nbsp;<span class="op" id="5501128">!=</span>&nbsp;<span class="builtintype" id="5501131">nil</span>&nbsp;<span class="op" id="5501135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501141">error_</span><span class="op" id="5501147">(</span><span class="ident" id="5501148">err</span><span class="op" id="5501151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5501156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501161">op</span>&nbsp;<span class="op" id="5501164">=</span>&nbsp;<span class="keyword" id="5501166">func</span><span class="op" id="5501170">(</span><span class="ident" id="5501171">i</span>&nbsp;<span class="op" id="5501173">*</span><span class="ident" id="5501174">decInstr</span><span class="op" id="5501182">,</span>&nbsp;<span class="ident" id="5501184">state</span>&nbsp;<span class="op" id="5501190">*</span><span class="ident" id="5501191">decoderState</span><span class="op" id="5501203">,</span>&nbsp;<span class="ident" id="5501205">value</span>&nbsp;<span class="ident" id="5501211">reflect</span><span class="op" id="5501218">.</span><span class="ident" id="5501219">Value</span><span class="op" id="5501224">)</span>&nbsp;<span class="op" id="5501226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5501232">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501308">state</span><span class="op" id="5501313">.</span><span class="ident" id="5501314">dec</span><span class="op" id="5501317">.</span><span class="ident" id="5501318">ignoreStruct</span><span class="op" id="5501330">(</span><span class="op" id="5501331">*</span><span class="ident" id="5501332">enginePtr</span><span class="op" id="5501341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5501346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501351">case</span>&nbsp;<span class="ident" id="5501356">wire</span><span class="op" id="5501360">.</span><span class="ident" id="5501361">GobEncoderT</span>&nbsp;<span class="op" id="5501373">!=</span>&nbsp;<span class="builtintype" id="5501376">nil</span><span class="op" id="5501379">,</span>&nbsp;<span class="ident" id="5501381">wire</span><span class="op" id="5501385">.</span><span class="ident" id="5501386">BinaryMarshalerT</span>&nbsp;<span class="op" id="5501403">!=</span>&nbsp;<span class="builtintype" id="5501406">nil</span><span class="op" id="5501409">,</span>&nbsp;<span class="ident" id="5501411">wire</span><span class="op" id="5501415">.</span><span class="ident" id="5501416">TextMarshalerT</span>&nbsp;<span class="op" id="5501431">!=</span>&nbsp;<span class="builtintype" id="5501434">nil</span><span class="op" id="5501437">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501442">op</span>&nbsp;<span class="op" id="5501445">=</span>&nbsp;<span class="keyword" id="5501447">func</span><span class="op" id="5501451">(</span><span class="ident" id="5501452">i</span>&nbsp;<span class="op" id="5501454">*</span><span class="ident" id="5501455">decInstr</span><span class="op" id="5501463">,</span>&nbsp;<span class="ident" id="5501465">state</span>&nbsp;<span class="op" id="5501471">*</span><span class="ident" id="5501472">decoderState</span><span class="op" id="5501484">,</span>&nbsp;<span class="ident" id="5501486">value</span>&nbsp;<span class="ident" id="5501492">reflect</span><span class="op" id="5501499">.</span><span class="ident" id="5501500">Value</span><span class="op" id="5501505">)</span>&nbsp;<span class="op" id="5501507">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501513">state</span><span class="op" id="5501518">.</span><span class="ident" id="5501519">dec</span><span class="op" id="5501522">.</span><span class="ident" id="5501523">ignoreGobDecoder</span><span class="op" id="5501539">(</span><span class="ident" id="5501540">state</span><span class="op" id="5501545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5501550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5501554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5501557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501560">if</span>&nbsp;<span class="ident" id="5501563">op</span>&nbsp;<span class="op" id="5501566">==</span>&nbsp;<span class="builtintype" id="5501569">nil</span>&nbsp;<span class="op" id="5501573">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501577">errorf</span><span class="op" id="5501583">(</span><span class="string" id="5501584">&#34;bad&nbsp;data:&nbsp;ignore&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5501623">,</span>&nbsp;<span class="ident" id="5501625">wireId</span><span class="op" id="5501631">.</span><span class="builtintype" id="5501632">string</span><span class="op" id="5501638">(</span><span class="op" id="5501639">)</span><span class="op" id="5501640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5501643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501646">return</span>&nbsp;<span class="ident" id="5501653">op</span><br>
<span class="lineno"></span><span class="op" id="5501656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="5501659">//&nbsp;gobDecodeOpFor&nbsp;returns&nbsp;the&nbsp;op&nbsp;for&nbsp;a&nbsp;type&nbsp;that&nbsp;is&nbsp;known&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span><span class="comment" id="5501730">//&nbsp;GobDecoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5501745">func</span>&nbsp;<span class="op" id="5501750">(</span><span class="ident" id="5501751">dec</span>&nbsp;<span class="op" id="5501755">*</span><span class="ident" id="5501756">Decoder</span><span class="op" id="5501763">)</span>&nbsp;<span class="ident" id="5501765">gobDecodeOpFor</span><span class="op" id="5501779">(</span><span class="ident" id="5501780">ut</span>&nbsp;<span class="op" id="5501783">*</span><span class="ident" id="5501784">userTypeInfo</span><span class="op" id="5501796">)</span>&nbsp;<span class="op" id="5501798">*</span><span class="ident" id="5501799">decOp</span>&nbsp;<span class="op" id="5501805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501808">rcvrType</span>&nbsp;<span class="op" id="5501817">:=</span>&nbsp;<span class="ident" id="5501820">ut</span><span class="op" id="5501822">.</span><span class="ident" id="5501823">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501829">if</span>&nbsp;<span class="ident" id="5501832">ut</span><span class="op" id="5501834">.</span><span class="ident" id="5501835">decIndir</span>&nbsp;<span class="op" id="5501844">==</span>&nbsp;<span class="op" id="5501847">-</span><span class="num" id="5501848">1</span>&nbsp;<span class="op" id="5501850">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501854">rcvrType</span>&nbsp;<span class="op" id="5501863">=</span>&nbsp;<span class="ident" id="5501865">reflect</span><span class="op" id="5501872">.</span><span class="ident" id="5501873">PtrTo</span><span class="op" id="5501878">(</span><span class="ident" id="5501879">rcvrType</span><span class="op" id="5501887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5501890">}</span>&nbsp;<span class="keyword" id="5501892">else</span>&nbsp;<span class="keyword" id="5501897">if</span>&nbsp;<span class="ident" id="5501900">ut</span><span class="op" id="5501902">.</span><span class="ident" id="5501903">decIndir</span>&nbsp;<span class="op" id="5501912">&gt;</span>&nbsp;<span class="num" id="5501914">0</span>&nbsp;<span class="op" id="5501916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501920">for</span>&nbsp;<span class="ident" id="5501924">i</span>&nbsp;<span class="op" id="5501926">:=</span>&nbsp;<span class="builtintype" id="5501929">int8</span><span class="op" id="5501933">(</span><span class="num" id="5501934">0</span><span class="op" id="5501935">)</span><span class="op" id="5501936">;</span>&nbsp;<span class="ident" id="5501938">i</span>&nbsp;<span class="op" id="5501940">&lt;</span>&nbsp;<span class="ident" id="5501942">ut</span><span class="op" id="5501944">.</span><span class="ident" id="5501945">decIndir</span><span class="op" id="5501953">;</span>&nbsp;<span class="ident" id="5501955">i</span><span class="op" id="5501956">++</span>&nbsp;<span class="op" id="5501959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5501964">rcvrType</span>&nbsp;<span class="op" id="5501973">=</span>&nbsp;<span class="ident" id="5501975">rcvrType</span><span class="op" id="5501983">.</span><span class="ident" id="5501984">Elem</span><span class="op" id="5501988">(</span><span class="op" id="5501989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5501993">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5501996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5501999">var</span>&nbsp;<span class="ident" id="5502003">op</span>&nbsp;<span class="ident" id="5502006">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502013">op</span>&nbsp;<span class="op" id="5502016">=</span>&nbsp;<span class="keyword" id="5502018">func</span><span class="op" id="5502022">(</span><span class="ident" id="5502023">i</span>&nbsp;<span class="op" id="5502025">*</span><span class="ident" id="5502026">decInstr</span><span class="op" id="5502034">,</span>&nbsp;<span class="ident" id="5502036">state</span>&nbsp;<span class="op" id="5502042">*</span><span class="ident" id="5502043">decoderState</span><span class="op" id="5502055">,</span>&nbsp;<span class="ident" id="5502057">value</span>&nbsp;<span class="ident" id="5502063">reflect</span><span class="op" id="5502070">.</span><span class="ident" id="5502071">Value</span><span class="op" id="5502076">)</span>&nbsp;<span class="op" id="5502078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5502082">//&nbsp;We&nbsp;now&nbsp;have&nbsp;the&nbsp;base&nbsp;type.&nbsp;We&nbsp;need&nbsp;its&nbsp;address&nbsp;if&nbsp;the&nbsp;receiver&nbsp;is&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5502164">if</span>&nbsp;<span class="ident" id="5502167">value</span><span class="op" id="5502172">.</span><span class="ident" id="5502173">Kind</span><span class="op" id="5502177">(</span><span class="op" id="5502178">)</span>&nbsp;<span class="op" id="5502180">!=</span>&nbsp;<span class="ident" id="5502183">reflect</span><span class="op" id="5502190">.</span><span class="ident" id="5502191">Ptr</span>&nbsp;<span class="op" id="5502195">&amp;&amp;</span>&nbsp;<span class="ident" id="5502198">rcvrType</span><span class="op" id="5502206">.</span><span class="ident" id="5502207">Kind</span><span class="op" id="5502211">(</span><span class="op" id="5502212">)</span>&nbsp;<span class="op" id="5502214">==</span>&nbsp;<span class="ident" id="5502217">reflect</span><span class="op" id="5502224">.</span><span class="ident" id="5502225">Ptr</span>&nbsp;<span class="op" id="5502229">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502234">value</span>&nbsp;<span class="op" id="5502240">=</span>&nbsp;<span class="ident" id="5502242">value</span><span class="op" id="5502247">.</span><span class="ident" id="5502248">Addr</span><span class="op" id="5502252">(</span><span class="op" id="5502253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5502257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502261">state</span><span class="op" id="5502266">.</span><span class="ident" id="5502267">dec</span><span class="op" id="5502270">.</span><span class="ident" id="5502271">decodeGobDecoder</span><span class="op" id="5502287">(</span><span class="ident" id="5502288">ut</span><span class="op" id="5502290">,</span>&nbsp;<span class="ident" id="5502292">state</span><span class="op" id="5502297">,</span>&nbsp;<span class="ident" id="5502299">value</span><span class="op" id="5502304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5502307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5502310">return</span>&nbsp;<span class="op" id="5502317">&amp;</span><span class="ident" id="5502318">op</span><br>
<span class="lineno">925</span><span class="op" id="5502321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5502324">//&nbsp;compatibleType&nbsp;asks:&nbsp;Are&nbsp;these&nbsp;two&nbsp;gob&nbsp;Types&nbsp;compatible?</span><br>
<span class="lineno"></span><span class="comment" id="5502384">//&nbsp;Answers&nbsp;the&nbsp;question&nbsp;for&nbsp;basic&nbsp;types,&nbsp;arrays,&nbsp;maps&nbsp;and&nbsp;slices,&nbsp;plus</span><br>
<span class="lineno"></span><span class="comment" id="5502455">//&nbsp;GobEncoder/Decoder&nbsp;pairs.</span><br>
<span class="lineno">930</span><span class="comment" id="5502484">//&nbsp;Structs&nbsp;are&nbsp;considered&nbsp;ok;&nbsp;fields&nbsp;will&nbsp;be&nbsp;checked&nbsp;later.</span><br>
<span class="lineno"></span><span class="keyword" id="5502544">func</span>&nbsp;<span class="op" id="5502549">(</span><span class="ident" id="5502550">dec</span>&nbsp;<span class="op" id="5502554">*</span><span class="ident" id="5502555">Decoder</span><span class="op" id="5502562">)</span>&nbsp;<span class="ident" id="5502564">compatibleType</span><span class="op" id="5502578">(</span><span class="ident" id="5502579">fr</span>&nbsp;<span class="ident" id="5502582">reflect</span><span class="op" id="5502589">.</span><span class="ident" id="5502590">Type</span><span class="op" id="5502594">,</span>&nbsp;<span class="ident" id="5502596">fw</span>&nbsp;<span class="ident" id="5502599">typeId</span><span class="op" id="5502605">,</span>&nbsp;<span class="ident" id="5502607">inProgress</span>&nbsp;<span class="keyword" id="5502618">map</span><span class="op" id="5502621">[</span><span class="ident" id="5502622">reflect</span><span class="op" id="5502629">.</span><span class="ident" id="5502630">Type</span><span class="op" id="5502634">]</span><span class="ident" id="5502635">typeId</span><span class="op" id="5502641">)</span>&nbsp;<span class="builtintype" id="5502643">bool</span>&nbsp;<span class="op" id="5502648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5502651">if</span>&nbsp;<span class="ident" id="5502654">rhs</span><span class="op" id="5502657">,</span>&nbsp;<span class="ident" id="5502659">ok</span>&nbsp;<span class="op" id="5502662">:=</span>&nbsp;<span class="ident" id="5502665">inProgress</span><span class="op" id="5502675">[</span><span class="ident" id="5502676">fr</span><span class="op" id="5502678">]</span><span class="op" id="5502679">;</span>&nbsp;<span class="ident" id="5502681">ok</span>&nbsp;<span class="op" id="5502684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5502688">return</span>&nbsp;<span class="ident" id="5502695">rhs</span>&nbsp;<span class="op" id="5502699">==</span>&nbsp;<span class="ident" id="5502702">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5502706">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502709">inProgress</span><span class="op" id="5502719">[</span><span class="ident" id="5502720">fr</span><span class="op" id="5502722">]</span>&nbsp;<span class="op" id="5502724">=</span>&nbsp;<span class="ident" id="5502726">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502730">ut</span>&nbsp;<span class="op" id="5502733">:=</span>&nbsp;<span class="ident" id="5502736">userType</span><span class="op" id="5502744">(</span><span class="ident" id="5502745">fr</span><span class="op" id="5502747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5502750">wire</span><span class="op" id="5502754">,</span>&nbsp;<span class="ident" id="5502756">ok</span>&nbsp;<span class="op" id="5502759">:=</span>&nbsp;<span class="ident" id="5502762">dec</span><span class="op" id="5502765">.</span><span class="ident" id="5502766">wireType</span><span class="op" id="5502774">[</span><span class="ident" id="5502775">fw</span><span class="op" id="5502777">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5502780">//&nbsp;If&nbsp;wire&nbsp;was&nbsp;encoded&nbsp;with&nbsp;an&nbsp;encoding&nbsp;method,&nbsp;fr&nbsp;must&nbsp;have&nbsp;that&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5502855">//&nbsp;And&nbsp;if&nbsp;not,&nbsp;it&nbsp;must&nbsp;not.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5502884">//&nbsp;At&nbsp;most&nbsp;one&nbsp;of&nbsp;the&nbsp;booleans&nbsp;in&nbsp;ut&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5502930">//&nbsp;We&nbsp;could&nbsp;possibly&nbsp;relax&nbsp;this&nbsp;constraint&nbsp;in&nbsp;the&nbsp;future&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5503000">//&nbsp;choose&nbsp;the&nbsp;decoding&nbsp;method&nbsp;using&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;wireType.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5503063">//&nbsp;The&nbsp;parentheses&nbsp;look&nbsp;odd&nbsp;but&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503109">if</span>&nbsp;<span class="op" id="5503112">(</span><span class="ident" id="5503113">ut</span><span class="op" id="5503115">.</span><span class="ident" id="5503116">externalDec</span>&nbsp;<span class="op" id="5503128">==</span>&nbsp;<span class="ident" id="5503131">xGob</span><span class="op" id="5503135">)</span>&nbsp;<span class="op" id="5503137">!=</span>&nbsp;<span class="op" id="5503140">(</span><span class="ident" id="5503141">ok</span>&nbsp;<span class="op" id="5503144">&amp;&amp;</span>&nbsp;<span class="ident" id="5503147">wire</span><span class="op" id="5503151">.</span><span class="ident" id="5503152">GobEncoderT</span>&nbsp;<span class="op" id="5503164">!=</span>&nbsp;<span class="builtintype" id="5503167">nil</span><span class="op" id="5503170">)</span>&nbsp;<span class="op" id="5503172">||</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5503177">(</span><span class="ident" id="5503178">ut</span><span class="op" id="5503180">.</span><span class="ident" id="5503181">externalDec</span>&nbsp;<span class="op" id="5503193">==</span>&nbsp;<span class="ident" id="5503196">xBinary</span><span class="op" id="5503203">)</span>&nbsp;<span class="op" id="5503205">!=</span>&nbsp;<span class="op" id="5503208">(</span><span class="ident" id="5503209">ok</span>&nbsp;<span class="op" id="5503212">&amp;&amp;</span>&nbsp;<span class="ident" id="5503215">wire</span><span class="op" id="5503219">.</span><span class="ident" id="5503220">BinaryMarshalerT</span>&nbsp;<span class="op" id="5503237">!=</span>&nbsp;<span class="builtintype" id="5503240">nil</span><span class="op" id="5503243">)</span>&nbsp;<span class="op" id="5503245">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5503250">(</span><span class="ident" id="5503251">ut</span><span class="op" id="5503253">.</span><span class="ident" id="5503254">externalDec</span>&nbsp;<span class="op" id="5503266">==</span>&nbsp;<span class="ident" id="5503269">xText</span><span class="op" id="5503274">)</span>&nbsp;<span class="op" id="5503276">!=</span>&nbsp;<span class="op" id="5503279">(</span><span class="ident" id="5503280">ok</span>&nbsp;<span class="op" id="5503283">&amp;&amp;</span>&nbsp;<span class="ident" id="5503286">wire</span><span class="op" id="5503290">.</span><span class="ident" id="5503291">TextMarshalerT</span>&nbsp;<span class="op" id="5503306">!=</span>&nbsp;<span class="builtintype" id="5503309">nil</span><span class="op" id="5503312">)</span>&nbsp;<span class="op" id="5503314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503318">return</span>&nbsp;<span class="builtintype" id="5503325">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5503332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503335">if</span>&nbsp;<span class="ident" id="5503338">ut</span><span class="op" id="5503340">.</span><span class="ident" id="5503341">externalDec</span>&nbsp;<span class="op" id="5503353">!=</span>&nbsp;<span class="num" id="5503356">0</span>&nbsp;<span class="op" id="5503358">{</span>&nbsp;<span class="comment" id="5503360">//&nbsp;This&nbsp;test&nbsp;trumps&nbsp;all&nbsp;others.</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503394">return</span>&nbsp;<span class="builtintype" id="5503401">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5503407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503410">switch</span>&nbsp;<span class="ident" id="5503417">t</span>&nbsp;<span class="op" id="5503419">:=</span>&nbsp;<span class="ident" id="5503422">ut</span><span class="op" id="5503424">.</span><span class="ident" id="5503425">base</span><span class="op" id="5503429">;</span>&nbsp;<span class="ident" id="5503431">t</span><span class="op" id="5503432">.</span><span class="ident" id="5503433">Kind</span><span class="op" id="5503437">(</span><span class="op" id="5503438">)</span>&nbsp;<span class="op" id="5503440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503443">default</span><span class="op" id="5503450">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5503454">//&nbsp;chan,&nbsp;etc:&nbsp;cannot&nbsp;handle.</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503485">return</span>&nbsp;<span class="builtintype" id="5503492">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503499">case</span>&nbsp;<span class="ident" id="5503504">reflect</span><span class="op" id="5503511">.</span><span class="ident" id="5503512">Bool</span><span class="op" id="5503516">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503520">return</span>&nbsp;<span class="ident" id="5503527">fw</span>&nbsp;<span class="op" id="5503530">==</span>&nbsp;<span class="ident" id="5503533">tBool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503540">case</span>&nbsp;<span class="ident" id="5503545">reflect</span><span class="op" id="5503552">.</span><span class="ident" id="5503553">Int</span><span class="op" id="5503556">,</span>&nbsp;<span class="ident" id="5503558">reflect</span><span class="op" id="5503565">.</span><span class="ident" id="5503566">Int8</span><span class="op" id="5503570">,</span>&nbsp;<span class="ident" id="5503572">reflect</span><span class="op" id="5503579">.</span><span class="ident" id="5503580">Int16</span><span class="op" id="5503585">,</span>&nbsp;<span class="ident" id="5503587">reflect</span><span class="op" id="5503594">.</span><span class="ident" id="5503595">Int32</span><span class="op" id="5503600">,</span>&nbsp;<span class="ident" id="5503602">reflect</span><span class="op" id="5503609">.</span><span class="ident" id="5503610">Int64</span><span class="op" id="5503615">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503619">return</span>&nbsp;<span class="ident" id="5503626">fw</span>&nbsp;<span class="op" id="5503629">==</span>&nbsp;<span class="ident" id="5503632">tInt</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503638">case</span>&nbsp;<span class="ident" id="5503643">reflect</span><span class="op" id="5503650">.</span><span class="ident" id="5503651">Uint</span><span class="op" id="5503655">,</span>&nbsp;<span class="ident" id="5503657">reflect</span><span class="op" id="5503664">.</span><span class="ident" id="5503665">Uint8</span><span class="op" id="5503670">,</span>&nbsp;<span class="ident" id="5503672">reflect</span><span class="op" id="5503679">.</span><span class="ident" id="5503680">Uint16</span><span class="op" id="5503686">,</span>&nbsp;<span class="ident" id="5503688">reflect</span><span class="op" id="5503695">.</span><span class="ident" id="5503696">Uint32</span><span class="op" id="5503702">,</span>&nbsp;<span class="ident" id="5503704">reflect</span><span class="op" id="5503711">.</span><span class="ident" id="5503712">Uint64</span><span class="op" id="5503718">,</span>&nbsp;<span class="ident" id="5503720">reflect</span><span class="op" id="5503727">.</span><span class="ident" id="5503728">Uintptr</span><span class="op" id="5503735">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503739">return</span>&nbsp;<span class="ident" id="5503746">fw</span>&nbsp;<span class="op" id="5503749">==</span>&nbsp;<span class="ident" id="5503752">tUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503759">case</span>&nbsp;<span class="ident" id="5503764">reflect</span><span class="op" id="5503771">.</span><span class="ident" id="5503772">Float32</span><span class="op" id="5503779">,</span>&nbsp;<span class="ident" id="5503781">reflect</span><span class="op" id="5503788">.</span><span class="ident" id="5503789">Float64</span><span class="op" id="5503796">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503800">return</span>&nbsp;<span class="ident" id="5503807">fw</span>&nbsp;<span class="op" id="5503810">==</span>&nbsp;<span class="ident" id="5503813">tFloat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503821">case</span>&nbsp;<span class="ident" id="5503826">reflect</span><span class="op" id="5503833">.</span><span class="ident" id="5503834">Complex64</span><span class="op" id="5503843">,</span>&nbsp;<span class="ident" id="5503845">reflect</span><span class="op" id="5503852">.</span><span class="ident" id="5503853">Complex128</span><span class="op" id="5503863">:</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503867">return</span>&nbsp;<span class="ident" id="5503874">fw</span>&nbsp;<span class="op" id="5503877">==</span>&nbsp;<span class="ident" id="5503880">tComplex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503890">case</span>&nbsp;<span class="ident" id="5503895">reflect</span><span class="op" id="5503902">.</span><span class="ident" id="5503903">String</span><span class="op" id="5503909">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503913">return</span>&nbsp;<span class="ident" id="5503920">fw</span>&nbsp;<span class="op" id="5503923">==</span>&nbsp;<span class="ident" id="5503926">tString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503935">case</span>&nbsp;<span class="ident" id="5503940">reflect</span><span class="op" id="5503947">.</span><span class="ident" id="5503948">Interface</span><span class="op" id="5503957">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503961">return</span>&nbsp;<span class="ident" id="5503968">fw</span>&nbsp;<span class="op" id="5503971">==</span>&nbsp;<span class="ident" id="5503974">tInterface</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5503986">case</span>&nbsp;<span class="ident" id="5503991">reflect</span><span class="op" id="5503998">.</span><span class="ident" id="5503999">Array</span><span class="op" id="5504004">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504008">if</span>&nbsp;<span class="op" id="5504011">!</span><span class="ident" id="5504012">ok</span>&nbsp;<span class="op" id="5504015">||</span>&nbsp;<span class="ident" id="5504018">wire</span><span class="op" id="5504022">.</span><span class="ident" id="5504023">ArrayT</span>&nbsp;<span class="op" id="5504030">==</span>&nbsp;<span class="builtintype" id="5504033">nil</span>&nbsp;<span class="op" id="5504037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504042">return</span>&nbsp;<span class="builtintype" id="5504049">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5504057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504061">array</span>&nbsp;<span class="op" id="5504067">:=</span>&nbsp;<span class="ident" id="5504070">wire</span><span class="op" id="5504074">.</span><span class="ident" id="5504075">ArrayT</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504084">return</span>&nbsp;<span class="ident" id="5504091">t</span><span class="op" id="5504092">.</span><span class="ident" id="5504093">Len</span><span class="op" id="5504096">(</span><span class="op" id="5504097">)</span>&nbsp;<span class="op" id="5504099">==</span>&nbsp;<span class="ident" id="5504102">array</span><span class="op" id="5504107">.</span><span class="ident" id="5504108">Len</span>&nbsp;<span class="op" id="5504112">&amp;&amp;</span>&nbsp;<span class="ident" id="5504115">dec</span><span class="op" id="5504118">.</span><span class="ident" id="5504119">compatibleType</span><span class="op" id="5504133">(</span><span class="ident" id="5504134">t</span><span class="op" id="5504135">.</span><span class="ident" id="5504136">Elem</span><span class="op" id="5504140">(</span><span class="op" id="5504141">)</span><span class="op" id="5504142">,</span>&nbsp;<span class="ident" id="5504144">array</span><span class="op" id="5504149">.</span><span class="ident" id="5504150">Elem</span><span class="op" id="5504154">,</span>&nbsp;<span class="ident" id="5504156">inProgress</span><span class="op" id="5504166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504169">case</span>&nbsp;<span class="ident" id="5504174">reflect</span><span class="op" id="5504181">.</span><span class="ident" id="5504182">Map</span><span class="op" id="5504185">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504189">if</span>&nbsp;<span class="op" id="5504192">!</span><span class="ident" id="5504193">ok</span>&nbsp;<span class="op" id="5504196">||</span>&nbsp;<span class="ident" id="5504199">wire</span><span class="op" id="5504203">.</span><span class="ident" id="5504204">MapT</span>&nbsp;<span class="op" id="5504209">==</span>&nbsp;<span class="builtintype" id="5504212">nil</span>&nbsp;<span class="op" id="5504216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504221">return</span>&nbsp;<span class="builtintype" id="5504228">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5504236">}</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504240">MapType</span>&nbsp;<span class="op" id="5504248">:=</span>&nbsp;<span class="ident" id="5504251">wire</span><span class="op" id="5504255">.</span><span class="ident" id="5504256">MapT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504263">return</span>&nbsp;<span class="ident" id="5504270">dec</span><span class="op" id="5504273">.</span><span class="ident" id="5504274">compatibleType</span><span class="op" id="5504288">(</span><span class="ident" id="5504289">t</span><span class="op" id="5504290">.</span><span class="ident" id="5504291">Key</span><span class="op" id="5504294">(</span><span class="op" id="5504295">)</span><span class="op" id="5504296">,</span>&nbsp;<span class="ident" id="5504298">MapType</span><span class="op" id="5504305">.</span><span class="ident" id="5504306">Key</span><span class="op" id="5504309">,</span>&nbsp;<span class="ident" id="5504311">inProgress</span><span class="op" id="5504321">)</span>&nbsp;<span class="op" id="5504323">&amp;&amp;</span>&nbsp;<span class="ident" id="5504326">dec</span><span class="op" id="5504329">.</span><span class="ident" id="5504330">compatibleType</span><span class="op" id="5504344">(</span><span class="ident" id="5504345">t</span><span class="op" id="5504346">.</span><span class="ident" id="5504347">Elem</span><span class="op" id="5504351">(</span><span class="op" id="5504352">)</span><span class="op" id="5504353">,</span>&nbsp;<span class="ident" id="5504355">MapType</span><span class="op" id="5504362">.</span><span class="ident" id="5504363">Elem</span><span class="op" id="5504367">,</span>&nbsp;<span class="ident" id="5504369">inProgress</span><span class="op" id="5504379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504382">case</span>&nbsp;<span class="ident" id="5504387">reflect</span><span class="op" id="5504394">.</span><span class="ident" id="5504395">Slice</span><span class="op" id="5504400">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5504404">//&nbsp;Is&nbsp;it&nbsp;an&nbsp;array&nbsp;of&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504434">if</span>&nbsp;<span class="ident" id="5504437">t</span><span class="op" id="5504438">.</span><span class="ident" id="5504439">Elem</span><span class="op" id="5504443">(</span><span class="op" id="5504444">)</span><span class="op" id="5504445">.</span><span class="ident" id="5504446">Kind</span><span class="op" id="5504450">(</span><span class="op" id="5504451">)</span>&nbsp;<span class="op" id="5504453">==</span>&nbsp;<span class="ident" id="5504456">reflect</span><span class="op" id="5504463">.</span><span class="ident" id="5504464">Uint8</span>&nbsp;<span class="op" id="5504470">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504475">return</span>&nbsp;<span class="ident" id="5504482">fw</span>&nbsp;<span class="op" id="5504485">==</span>&nbsp;<span class="ident" id="5504488">tBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5504497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5504501">//&nbsp;Extract&nbsp;and&nbsp;compare&nbsp;element&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504541">var</span>&nbsp;<span class="ident" id="5504545">sw</span>&nbsp;<span class="op" id="5504548">*</span><span class="ident" id="5504549">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504561">if</span>&nbsp;<span class="ident" id="5504564">tt</span><span class="op" id="5504566">,</span>&nbsp;<span class="ident" id="5504568">ok</span>&nbsp;<span class="op" id="5504571">:=</span>&nbsp;<span class="ident" id="5504574">builtinIdToType</span><span class="op" id="5504589">[</span><span class="ident" id="5504590">fw</span><span class="op" id="5504592">]</span><span class="op" id="5504593">;</span>&nbsp;<span class="ident" id="5504595">ok</span>&nbsp;<span class="op" id="5504598">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504603">sw</span><span class="op" id="5504605">,</span>&nbsp;<span class="ident" id="5504607">_</span>&nbsp;<span class="op" id="5504609">=</span>&nbsp;<span class="ident" id="5504611">tt</span><span class="op" id="5504613">.</span><span class="op" id="5504614">(</span><span class="op" id="5504615">*</span><span class="ident" id="5504616">sliceType</span><span class="op" id="5504625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5504629">}</span>&nbsp;<span class="keyword" id="5504631">else</span>&nbsp;<span class="keyword" id="5504636">if</span>&nbsp;<span class="ident" id="5504639">wire</span>&nbsp;<span class="op" id="5504644">!=</span>&nbsp;<span class="builtintype" id="5504647">nil</span>&nbsp;<span class="op" id="5504651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504656">sw</span>&nbsp;<span class="op" id="5504659">=</span>&nbsp;<span class="ident" id="5504661">wire</span><span class="op" id="5504665">.</span><span class="ident" id="5504666">SliceT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5504675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5504679">elem</span>&nbsp;<span class="op" id="5504684">:=</span>&nbsp;<span class="ident" id="5504687">userType</span><span class="op" id="5504695">(</span><span class="ident" id="5504696">t</span><span class="op" id="5504697">.</span><span class="ident" id="5504698">Elem</span><span class="op" id="5504702">(</span><span class="op" id="5504703">)</span><span class="op" id="5504704">)</span><span class="op" id="5504705">.</span><span class="ident" id="5504706">base</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504713">return</span>&nbsp;<span class="ident" id="5504720">sw</span>&nbsp;<span class="op" id="5504723">!=</span>&nbsp;<span class="builtintype" id="5504726">nil</span>&nbsp;<span class="op" id="5504730">&amp;&amp;</span>&nbsp;<span class="ident" id="5504733">dec</span><span class="op" id="5504736">.</span><span class="ident" id="5504737">compatibleType</span><span class="op" id="5504751">(</span><span class="ident" id="5504752">elem</span><span class="op" id="5504756">,</span>&nbsp;<span class="ident" id="5504758">sw</span><span class="op" id="5504760">.</span><span class="ident" id="5504761">Elem</span><span class="op" id="5504765">,</span>&nbsp;<span class="ident" id="5504767">inProgress</span><span class="op" id="5504777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504780">case</span>&nbsp;<span class="ident" id="5504785">reflect</span><span class="op" id="5504792">.</span><span class="ident" id="5504793">Struct</span><span class="op" id="5504799">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504803">return</span>&nbsp;<span class="builtintype" id="5504810">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5504816">}</span><br>
<span class="lineno"></span><span class="op" id="5504818">}</span><br>
<span class="lineno">1000</span><br>
<span class="lineno"></span><span class="comment" id="5504821">//&nbsp;typeString&nbsp;returns&nbsp;a&nbsp;human-readable&nbsp;description&nbsp;of&nbsp;the&nbsp;type&nbsp;identified&nbsp;by&nbsp;remoteId.</span><br>
<span class="lineno"></span><span class="keyword" id="5504908">func</span>&nbsp;<span class="op" id="5504913">(</span><span class="ident" id="5504914">dec</span>&nbsp;<span class="op" id="5504918">*</span><span class="ident" id="5504919">Decoder</span><span class="op" id="5504926">)</span>&nbsp;<span class="ident" id="5504928">typeString</span><span class="op" id="5504938">(</span><span class="ident" id="5504939">remoteId</span>&nbsp;<span class="ident" id="5504948">typeId</span><span class="op" id="5504954">)</span>&nbsp;<span class="builtintype" id="5504956">string</span>&nbsp;<span class="op" id="5504963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5504966">if</span>&nbsp;<span class="ident" id="5504969">t</span>&nbsp;<span class="op" id="5504971">:=</span>&nbsp;<span class="ident" id="5504974">idToType</span><span class="op" id="5504982">[</span><span class="ident" id="5504983">remoteId</span><span class="op" id="5504991">]</span><span class="op" id="5504992">;</span>&nbsp;<span class="ident" id="5504994">t</span>&nbsp;<span class="op" id="5504996">!=</span>&nbsp;<span class="builtintype" id="5504999">nil</span>&nbsp;<span class="op" id="5505003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5505007">//&nbsp;globally&nbsp;known&nbsp;type.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5505033">return</span>&nbsp;<span class="ident" id="5505040">t</span><span class="op" id="5505041">.</span><span class="builtintype" id="5505042">string</span><span class="op" id="5505048">(</span><span class="op" id="5505049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5505052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5505055">return</span>&nbsp;<span class="ident" id="5505062">dec</span><span class="op" id="5505065">.</span><span class="ident" id="5505066">wireType</span><span class="op" id="5505074">[</span><span class="ident" id="5505075">remoteId</span><span class="op" id="5505083">]</span><span class="op" id="5505084">.</span><span class="builtintype" id="5505085">string</span><span class="op" id="5505091">(</span><span class="op" id="5505092">)</span><br>
<span class="lineno"></span><span class="op" id="5505094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1010</span><span class="comment" id="5505097">//&nbsp;compileSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value,&nbsp;including</span><br>
<span class="lineno"></span><span class="comment" id="5505186">//&nbsp;GobDecoders.</span><br>
<span class="lineno"></span><span class="keyword" id="5505202">func</span>&nbsp;<span class="op" id="5505207">(</span><span class="ident" id="5505208">dec</span>&nbsp;<span class="op" id="5505212">*</span><span class="ident" id="5505213">Decoder</span><span class="op" id="5505220">)</span>&nbsp;<span class="ident" id="5505222">compileSingle</span><span class="op" id="5505235">(</span><span class="ident" id="5505236">remoteId</span>&nbsp;<span class="ident" id="5505245">typeId</span><span class="op" id="5505251">,</span>&nbsp;<span class="ident" id="5505253">ut</span>&nbsp;<span class="op" id="5505256">*</span><span class="ident" id="5505257">userTypeInfo</span><span class="op" id="5505269">)</span>&nbsp;<span class="op" id="5505271">(</span><span class="ident" id="5505272">engine</span>&nbsp;<span class="op" id="5505279">*</span><span class="ident" id="5505280">decEngine</span><span class="op" id="5505289">,</span>&nbsp;<span class="ident" id="5505291">err</span>&nbsp;<span class="builtintype" id="5505295">error</span><span class="op" id="5505300">)</span>&nbsp;<span class="op" id="5505302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5505305">rt</span>&nbsp;<span class="op" id="5505308">:=</span>&nbsp;<span class="ident" id="5505311">ut</span><span class="op" id="5505313">.</span><span class="ident" id="5505314">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5505320">engine</span>&nbsp;<span class="op" id="5505327">=</span>&nbsp;<span class="builtinfunc" id="5505329">new</span><span class="op" id="5505332">(</span><span class="ident" id="5505333">decEngine</span><span class="op" id="5505342">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5505345">engine</span><span class="op" id="5505351">.</span><span class="ident" id="5505352">instr</span>&nbsp;<span class="op" id="5505358">=</span>&nbsp;<span class="builtinfunc" id="5505360">make</span><span class="op" id="5505364">(</span><span class="op" id="5505365">[</span><span class="op" id="5505366">]</span><span class="ident" id="5505367">decInstr</span><span class="op" id="5505375">,</span>&nbsp;<span class="num" id="5505377">1</span><span class="op" id="5505378">)</span>&nbsp;<span class="comment" id="5505380">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5505393">name</span>&nbsp;<span class="op" id="5505398">:=</span>&nbsp;<span class="ident" id="5505401">rt</span><span class="op" id="5505403">.</span><span class="ident" id="5505404">String</span><span class="op" id="5505410">(</span><span class="op" id="5505411">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5505428">//&nbsp;best&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5505447">if</span>&nbsp;<span class="op" id="5505450">!</span><span class="ident" id="5505451">dec</span><span class="op" id="5505454">.</span><span class="ident" id="5505455">compatibleType</span><span class="op" id="5505469">(</span><span class="ident" id="5505470">rt</span><span class="op" id="5505472">,</span>&nbsp;<span class="ident" id="5505474">remoteId</span><span class="op" id="5505482">,</span>&nbsp;<span class="builtinfunc" id="5505484">make</span><span class="op" id="5505488">(</span><span class="keyword" id="5505489">map</span><span class="op" id="5505492">[</span><span class="ident" id="5505493">reflect</span><span class="op" id="5505500">.</span><span class="ident" id="5505501">Type</span><span class="op" id="5505505">]</span><span class="ident" id="5505506">typeId</span><span class="op" id="5505512">)</span><span class="op" id="5505513">)</span>&nbsp;<span class="op" id="5505515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5505519">remoteType</span>&nbsp;<span class="op" id="5505530">:=</span>&nbsp;<span class="ident" id="5505533">dec</span><span class="op" id="5505536">.</span><span class="ident" id="5505537">typeString</span><span class="op" id="5505547">(</span><span class="ident" id="5505548">remoteId</span><span class="op" id="5505556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5505560">//&nbsp;Common&nbsp;confusing&nbsp;case:&nbsp;local&nbsp;interface&nbsp;type,&nbsp;remote&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5505632">if</span>&nbsp;<span class="ident" id="5505635">ut</span><span class="op" id="5505637">.</span><span class="ident" id="5505638">base</span><span class="op" id="5505642">.</span><span class="ident" id="5505643">Kind</span><span class="op" id="5505647">(</span><span class="op" id="5505648">)</span>&nbsp;<span class="op" id="5505650">==</span>&nbsp;<span class="ident" id="5505653">reflect</span><span class="op" id="5505660">.</span><span class="ident" id="5505661">Interface</span>&nbsp;<span class="op" id="5505671">&amp;&amp;</span>&nbsp;<span class="ident" id="5505674">remoteId</span>&nbsp;<span class="op" id="5505683">!=</span>&nbsp;<span class="ident" id="5505686">tInterface</span>&nbsp;<span class="op" id="5505697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5505702">return</span>&nbsp;<span class="builtintype" id="5505709">nil</span><span class="op" id="5505712">,</span>&nbsp;<span class="ident" id="5505714">errors</span><span class="op" id="5505720">.</span><span class="ident" id="5505721">New</span><span class="op" id="5505724">(</span><span class="string" id="5505725">&#34;gob:&nbsp;local&nbsp;interface&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5505754">+</span>&nbsp;<span class="ident" id="5505756">name</span>&nbsp;<span class="op" id="5505761">+</span>&nbsp;<span class="string" id="5505763">&#34;&nbsp;can&nbsp;only&nbsp;be&nbsp;decoded&nbsp;from&nbsp;remote&nbsp;interface&nbsp;type;&nbsp;received&nbsp;concrete&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5505838">+</span>&nbsp;<span class="ident" id="5505840">remoteType</span><span class="op" id="5505850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5505854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5505858">return</span>&nbsp;<span class="builtintype" id="5505865">nil</span><span class="op" id="5505868">,</span>&nbsp;<span class="ident" id="5505870">errors</span><span class="op" id="5505876">.</span><span class="ident" id="5505877">New</span><span class="op" id="5505880">(</span><span class="string" id="5505881">&#34;gob:&nbsp;decoding&nbsp;into&nbsp;local&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5505914">+</span>&nbsp;<span class="ident" id="5505916">name</span>&nbsp;<span class="op" id="5505921">+</span>&nbsp;<span class="string" id="5505923">&#34;,&nbsp;received&nbsp;remote&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5505949">+</span>&nbsp;<span class="ident" id="5505951">remoteType</span><span class="op" id="5505961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5505964">}</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5505967">op</span>&nbsp;<span class="op" id="5505970">:=</span>&nbsp;<span class="ident" id="5505973">dec</span><span class="op" id="5505976">.</span><span class="ident" id="5505977">decOpFor</span><span class="op" id="5505985">(</span><span class="ident" id="5505986">remoteId</span><span class="op" id="5505994">,</span>&nbsp;<span class="ident" id="5505996">rt</span><span class="op" id="5505998">,</span>&nbsp;<span class="ident" id="5506000">name</span><span class="op" id="5506004">,</span>&nbsp;<span class="builtinfunc" id="5506006">make</span><span class="op" id="5506010">(</span><span class="keyword" id="5506011">map</span><span class="op" id="5506014">[</span><span class="ident" id="5506015">reflect</span><span class="op" id="5506022">.</span><span class="ident" id="5506023">Type</span><span class="op" id="5506027">]</span><span class="op" id="5506028">*</span><span class="ident" id="5506029">decOp</span><span class="op" id="5506034">)</span><span class="op" id="5506035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506038">ovfl</span>&nbsp;<span class="op" id="5506043">:=</span>&nbsp;<span class="ident" id="5506046">errors</span><span class="op" id="5506052">.</span><span class="ident" id="5506053">New</span><span class="op" id="5506056">(</span><span class="string" id="5506057">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="5506071">+</span>&nbsp;<span class="ident" id="5506073">name</span>&nbsp;<span class="op" id="5506078">+</span>&nbsp;<span class="string" id="5506080">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="5506096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506099">engine</span><span class="op" id="5506105">.</span><span class="ident" id="5506106">instr</span><span class="op" id="5506111">[</span><span class="ident" id="5506112">singletonField</span><span class="op" id="5506126">]</span>&nbsp;<span class="op" id="5506128">=</span>&nbsp;<span class="ident" id="5506130">decInstr</span><span class="op" id="5506138">{</span><span class="op" id="5506139">*</span><span class="ident" id="5506140">op</span><span class="op" id="5506142">,</span>&nbsp;<span class="ident" id="5506144">singletonField</span><span class="op" id="5506158">,</span>&nbsp;<span class="builtintype" id="5506160">nil</span><span class="op" id="5506163">,</span>&nbsp;<span class="ident" id="5506165">ovfl</span><span class="op" id="5506169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506172">engine</span><span class="op" id="5506178">.</span><span class="ident" id="5506179">numInstr</span>&nbsp;<span class="op" id="5506188">=</span>&nbsp;<span class="num" id="5506190">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5506193">return</span><br>
<span class="lineno">1030</span><span class="op" id="5506200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5506203">//&nbsp;compileIgnoreSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value&nbsp;that&nbsp;will&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5506311">func</span>&nbsp;<span class="op" id="5506316">(</span><span class="ident" id="5506317">dec</span>&nbsp;<span class="op" id="5506321">*</span><span class="ident" id="5506322">Decoder</span><span class="op" id="5506329">)</span>&nbsp;<span class="ident" id="5506331">compileIgnoreSingle</span><span class="op" id="5506350">(</span><span class="ident" id="5506351">remoteId</span>&nbsp;<span class="ident" id="5506360">typeId</span><span class="op" id="5506366">)</span>&nbsp;<span class="op" id="5506368">(</span><span class="ident" id="5506369">engine</span>&nbsp;<span class="op" id="5506376">*</span><span class="ident" id="5506377">decEngine</span><span class="op" id="5506386">,</span>&nbsp;<span class="ident" id="5506388">err</span>&nbsp;<span class="builtintype" id="5506392">error</span><span class="op" id="5506397">)</span>&nbsp;<span class="op" id="5506399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506402">engine</span>&nbsp;<span class="op" id="5506409">=</span>&nbsp;<span class="builtinfunc" id="5506411">new</span><span class="op" id="5506414">(</span><span class="ident" id="5506415">decEngine</span><span class="op" id="5506424">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506427">engine</span><span class="op" id="5506433">.</span><span class="ident" id="5506434">instr</span>&nbsp;<span class="op" id="5506440">=</span>&nbsp;<span class="builtinfunc" id="5506442">make</span><span class="op" id="5506446">(</span><span class="op" id="5506447">[</span><span class="op" id="5506448">]</span><span class="ident" id="5506449">decInstr</span><span class="op" id="5506457">,</span>&nbsp;<span class="num" id="5506459">1</span><span class="op" id="5506460">)</span>&nbsp;<span class="comment" id="5506462">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506475">op</span>&nbsp;<span class="op" id="5506478">:=</span>&nbsp;<span class="ident" id="5506481">dec</span><span class="op" id="5506484">.</span><span class="ident" id="5506485">decIgnoreOpFor</span><span class="op" id="5506499">(</span><span class="ident" id="5506500">remoteId</span><span class="op" id="5506508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506511">ovfl</span>&nbsp;<span class="op" id="5506516">:=</span>&nbsp;<span class="ident" id="5506519">overflow</span><span class="op" id="5506527">(</span><span class="ident" id="5506528">dec</span><span class="op" id="5506531">.</span><span class="ident" id="5506532">typeString</span><span class="op" id="5506542">(</span><span class="ident" id="5506543">remoteId</span><span class="op" id="5506551">)</span><span class="op" id="5506552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506555">engine</span><span class="op" id="5506561">.</span><span class="ident" id="5506562">instr</span><span class="op" id="5506567">[</span><span class="num" id="5506568">0</span><span class="op" id="5506569">]</span>&nbsp;<span class="op" id="5506571">=</span>&nbsp;<span class="ident" id="5506573">decInstr</span><span class="op" id="5506581">{</span><span class="ident" id="5506582">op</span><span class="op" id="5506584">,</span>&nbsp;<span class="num" id="5506586">0</span><span class="op" id="5506587">,</span>&nbsp;<span class="builtintype" id="5506589">nil</span><span class="op" id="5506592">,</span>&nbsp;<span class="ident" id="5506594">ovfl</span><span class="op" id="5506598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506601">engine</span><span class="op" id="5506607">.</span><span class="ident" id="5506608">numInstr</span>&nbsp;<span class="op" id="5506617">=</span>&nbsp;<span class="num" id="5506619">1</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5506622">return</span><br>
<span class="lineno"></span><span class="op" id="5506629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5506632">//&nbsp;compileDec&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;value.&nbsp;&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;a&nbsp;struct,</span><br>
<span class="lineno"></span><span class="comment" id="5506718">//&nbsp;it&nbsp;calls&nbsp;out&nbsp;to&nbsp;compileSingle.</span><br>
<span class="lineno">1045</span><span class="keyword" id="5506752">func</span>&nbsp;<span class="op" id="5506757">(</span><span class="ident" id="5506758">dec</span>&nbsp;<span class="op" id="5506762">*</span><span class="ident" id="5506763">Decoder</span><span class="op" id="5506770">)</span>&nbsp;<span class="ident" id="5506772">compileDec</span><span class="op" id="5506782">(</span><span class="ident" id="5506783">remoteId</span>&nbsp;<span class="ident" id="5506792">typeId</span><span class="op" id="5506798">,</span>&nbsp;<span class="ident" id="5506800">ut</span>&nbsp;<span class="op" id="5506803">*</span><span class="ident" id="5506804">userTypeInfo</span><span class="op" id="5506816">)</span>&nbsp;<span class="op" id="5506818">(</span><span class="ident" id="5506819">engine</span>&nbsp;<span class="op" id="5506826">*</span><span class="ident" id="5506827">decEngine</span><span class="op" id="5506836">,</span>&nbsp;<span class="ident" id="5506838">err</span>&nbsp;<span class="builtintype" id="5506842">error</span><span class="op" id="5506847">)</span>&nbsp;<span class="op" id="5506849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506852">rt</span>&nbsp;<span class="op" id="5506855">:=</span>&nbsp;<span class="ident" id="5506858">ut</span><span class="op" id="5506860">.</span><span class="ident" id="5506861">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5506867">srt</span>&nbsp;<span class="op" id="5506871">:=</span>&nbsp;<span class="ident" id="5506874">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5506878">if</span>&nbsp;<span class="ident" id="5506881">srt</span><span class="op" id="5506884">.</span><span class="ident" id="5506885">Kind</span><span class="op" id="5506889">(</span><span class="op" id="5506890">)</span>&nbsp;<span class="op" id="5506892">!=</span>&nbsp;<span class="ident" id="5506895">reflect</span><span class="op" id="5506902">.</span><span class="ident" id="5506903">Struct</span>&nbsp;<span class="op" id="5506910">||</span>&nbsp;<span class="ident" id="5506913">ut</span><span class="op" id="5506915">.</span><span class="ident" id="5506916">externalDec</span>&nbsp;<span class="op" id="5506928">!=</span>&nbsp;<span class="num" id="5506931">0</span>&nbsp;<span class="op" id="5506933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5506937">return</span>&nbsp;<span class="ident" id="5506944">dec</span><span class="op" id="5506947">.</span><span class="ident" id="5506948">compileSingle</span><span class="op" id="5506961">(</span><span class="ident" id="5506962">remoteId</span><span class="op" id="5506970">,</span>&nbsp;<span class="ident" id="5506972">ut</span><span class="op" id="5506974">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5506977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5506980">var</span>&nbsp;<span class="ident" id="5506984">wireStruct</span>&nbsp;<span class="op" id="5506995">*</span><span class="ident" id="5506996">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5507008">//&nbsp;Builtin&nbsp;types&nbsp;can&nbsp;come&nbsp;from&nbsp;global&nbsp;pool;&nbsp;the&nbsp;rest&nbsp;must&nbsp;be&nbsp;defined&nbsp;by&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5507094">//&nbsp;Also&nbsp;we&nbsp;know&nbsp;we&#39;re&nbsp;decoding&nbsp;a&nbsp;struct&nbsp;now,&nbsp;so&nbsp;the&nbsp;client&nbsp;must&nbsp;have&nbsp;sent&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5507174">if</span>&nbsp;<span class="ident" id="5507177">t</span><span class="op" id="5507178">,</span>&nbsp;<span class="ident" id="5507180">ok</span>&nbsp;<span class="op" id="5507183">:=</span>&nbsp;<span class="ident" id="5507186">builtinIdToType</span><span class="op" id="5507201">[</span><span class="ident" id="5507202">remoteId</span><span class="op" id="5507210">]</span><span class="op" id="5507211">;</span>&nbsp;<span class="ident" id="5507213">ok</span>&nbsp;<span class="op" id="5507216">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5507220">wireStruct</span><span class="op" id="5507230">,</span>&nbsp;<span class="ident" id="5507232">_</span>&nbsp;<span class="op" id="5507234">=</span>&nbsp;<span class="ident" id="5507236">t</span><span class="op" id="5507237">.</span><span class="op" id="5507238">(</span><span class="op" id="5507239">*</span><span class="ident" id="5507240">structType</span><span class="op" id="5507250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5507253">}</span>&nbsp;<span class="keyword" id="5507255">else</span>&nbsp;<span class="op" id="5507260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5507264">wire</span>&nbsp;<span class="op" id="5507269">:=</span>&nbsp;<span class="ident" id="5507272">dec</span><span class="op" id="5507275">.</span><span class="ident" id="5507276">wireType</span><span class="op" id="5507284">[</span><span class="ident" id="5507285">remoteId</span><span class="op" id="5507293">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5507297">if</span>&nbsp;<span class="ident" id="5507300">wire</span>&nbsp;<span class="op" id="5507305">==</span>&nbsp;<span class="builtintype" id="5507308">nil</span>&nbsp;<span class="op" id="5507312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5507317">error_</span><span class="op" id="5507323">(</span><span class="ident" id="5507324">errBadType</span><span class="op" id="5507334">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5507338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5507342">wireStruct</span>&nbsp;<span class="op" id="5507353">=</span>&nbsp;<span class="ident" id="5507355">wire</span><span class="op" id="5507359">.</span><span class="ident" id="5507360">StructT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5507369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5507372">if</span>&nbsp;<span class="ident" id="5507375">wireStruct</span>&nbsp;<span class="op" id="5507386">==</span>&nbsp;<span class="builtintype" id="5507389">nil</span>&nbsp;<span class="op" id="5507393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5507397">errorf</span><span class="op" id="5507403">(</span><span class="string" id="5507404">&#34;type&nbsp;mismatch&nbsp;in&nbsp;decoder:&nbsp;want&nbsp;struct&nbsp;type&nbsp;%s;&nbsp;got&nbsp;non-struct&#34;</span><span class="op" id="5507467">,</span>&nbsp;<span class="ident" id="5507469">rt</span><span class="op" id="5507471">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5507474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5507477">engine</span>&nbsp;<span class="op" id="5507484">=</span>&nbsp;<span class="builtinfunc" id="5507486">new</span><span class="op" id="5507489">(</span><span class="ident" id="5507490">decEngine</span><span class="op" id="5507499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5507502">engine</span><span class="op" id="5507508">.</span><span class="ident" id="5507509">instr</span>&nbsp;<span class="op" id="5507515">=</span>&nbsp;<span class="builtinfunc" id="5507517">make</span><span class="op" id="5507521">(</span><span class="op" id="5507522">[</span><span class="op" id="5507523">]</span><span class="ident" id="5507524">decInstr</span><span class="op" id="5507532">,</span>&nbsp;<span class="builtinfunc" id="5507534">len</span><span class="op" id="5507537">(</span><span class="ident" id="5507538">wireStruct</span><span class="op" id="5507548">.</span><span class="ident" id="5507549">Field</span><span class="op" id="5507554">)</span><span class="op" id="5507555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5507558">seen</span>&nbsp;<span class="op" id="5507563">:=</span>&nbsp;<span class="builtinfunc" id="5507566">make</span><span class="op" id="5507570">(</span><span class="keyword" id="5507571">map</span><span class="op" id="5507574">[</span><span class="ident" id="5507575">reflect</span><span class="op" id="5507582">.</span><span class="ident" id="5507583">Type</span><span class="op" id="5507587">]</span><span class="op" id="5507588">*</span><span class="ident" id="5507589">decOp</span><span class="op" id="5507594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5507597">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;wire&nbsp;type.</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5507640">for</span>&nbsp;<span class="ident" id="5507644">fieldnum</span>&nbsp;<span class="op" id="5507653">:=</span>&nbsp;<span class="num" id="5507656">0</span><span class="op" id="5507657">;</span>&nbsp;<span class="ident" id="5507659">fieldnum</span>&nbsp;<span class="op" id="5507668">&lt;</span>&nbsp;<span class="builtinfunc" id="5507670">len</span><span class="op" id="5507673">(</span><span class="ident" id="5507674">wireStruct</span><span class="op" id="5507684">.</span><span class="ident" id="5507685">Field</span><span class="op" id="5507690">)</span><span class="op" id="5507691">;</span>&nbsp;<span class="ident" id="5507693">fieldnum</span><span class="op" id="5507701">++</span>&nbsp;<span class="op" id="5507704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5507708">wireField</span>&nbsp;<span class="op" id="5507718">:=</span>&nbsp;<span class="ident" id="5507721">wireStruct</span><span class="op" id="5507731">.</span><span class="ident" id="5507732">Field</span><span class="op" id="5507737">[</span><span class="ident" id="5507738">fieldnum</span><span class="op" id="5507746">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5507750">if</span>&nbsp;<span class="ident" id="5507753">wireField</span><span class="op" id="5507762">.</span><span class="ident" id="5507763">Name</span>&nbsp;<span class="op" id="5507768">==</span>&nbsp;<span class="string" id="5507771">&#34;&#34;</span>&nbsp;<span class="op" id="5507774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5507779">errorf</span><span class="op" id="5507785">(</span><span class="string" id="5507786">&#34;empty&nbsp;name&nbsp;for&nbsp;remote&nbsp;field&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5507826">,</span>&nbsp;<span class="ident" id="5507828">wireStruct</span><span class="op" id="5507838">.</span><span class="ident" id="5507839">Name</span><span class="op" id="5507843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5507847">}</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5507851">ovfl</span>&nbsp;<span class="op" id="5507856">:=</span>&nbsp;<span class="ident" id="5507859">overflow</span><span class="op" id="5507867">(</span><span class="ident" id="5507868">wireField</span><span class="op" id="5507877">.</span><span class="ident" id="5507878">Name</span><span class="op" id="5507882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5507886">//&nbsp;Find&nbsp;the&nbsp;field&nbsp;of&nbsp;the&nbsp;local&nbsp;type&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5507944">localField</span><span class="op" id="5507954">,</span>&nbsp;<span class="ident" id="5507956">present</span>&nbsp;<span class="op" id="5507964">:=</span>&nbsp;<span class="ident" id="5507967">srt</span><span class="op" id="5507970">.</span><span class="ident" id="5507971">FieldByName</span><span class="op" id="5507982">(</span><span class="ident" id="5507983">wireField</span><span class="op" id="5507992">.</span><span class="ident" id="5507993">Name</span><span class="op" id="5507997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5508001">//&nbsp;TODO(r):&nbsp;anonymous&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5508031">if</span>&nbsp;<span class="op" id="5508034">!</span><span class="ident" id="5508035">present</span>&nbsp;<span class="op" id="5508043">||</span>&nbsp;<span class="op" id="5508046">!</span><span class="ident" id="5508047">isExported</span><span class="op" id="5508057">(</span><span class="ident" id="5508058">wireField</span><span class="op" id="5508067">.</span><span class="ident" id="5508068">Name</span><span class="op" id="5508072">)</span>&nbsp;<span class="op" id="5508074">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508079">op</span>&nbsp;<span class="op" id="5508082">:=</span>&nbsp;<span class="ident" id="5508085">dec</span><span class="op" id="5508088">.</span><span class="ident" id="5508089">decIgnoreOpFor</span><span class="op" id="5508103">(</span><span class="ident" id="5508104">wireField</span><span class="op" id="5508113">.</span><span class="ident" id="5508114">Id</span><span class="op" id="5508116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508121">engine</span><span class="op" id="5508127">.</span><span class="ident" id="5508128">instr</span><span class="op" id="5508133">[</span><span class="ident" id="5508134">fieldnum</span><span class="op" id="5508142">]</span>&nbsp;<span class="op" id="5508144">=</span>&nbsp;<span class="ident" id="5508146">decInstr</span><span class="op" id="5508154">{</span><span class="ident" id="5508155">op</span><span class="op" id="5508157">,</span>&nbsp;<span class="ident" id="5508159">fieldnum</span><span class="op" id="5508167">,</span>&nbsp;<span class="builtintype" id="5508169">nil</span><span class="op" id="5508172">,</span>&nbsp;<span class="ident" id="5508174">ovfl</span><span class="op" id="5508178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5508183">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5508194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5508198">if</span>&nbsp;<span class="op" id="5508201">!</span><span class="ident" id="5508202">dec</span><span class="op" id="5508205">.</span><span class="ident" id="5508206">compatibleType</span><span class="op" id="5508220">(</span><span class="ident" id="5508221">localField</span><span class="op" id="5508231">.</span><span class="ident" id="5508232">Type</span><span class="op" id="5508236">,</span>&nbsp;<span class="ident" id="5508238">wireField</span><span class="op" id="5508247">.</span><span class="ident" id="5508248">Id</span><span class="op" id="5508250">,</span>&nbsp;<span class="builtinfunc" id="5508252">make</span><span class="op" id="5508256">(</span><span class="keyword" id="5508257">map</span><span class="op" id="5508260">[</span><span class="ident" id="5508261">reflect</span><span class="op" id="5508268">.</span><span class="ident" id="5508269">Type</span><span class="op" id="5508273">]</span><span class="ident" id="5508274">typeId</span><span class="op" id="5508280">)</span><span class="op" id="5508281">)</span>&nbsp;<span class="op" id="5508283">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508288">errorf</span><span class="op" id="5508294">(</span><span class="string" id="5508295">&#34;wrong&nbsp;type&nbsp;(%s)&nbsp;for&nbsp;received&nbsp;field&nbsp;%s.%s&#34;</span><span class="op" id="5508337">,</span>&nbsp;<span class="ident" id="5508339">localField</span><span class="op" id="5508349">.</span><span class="ident" id="5508350">Type</span><span class="op" id="5508354">,</span>&nbsp;<span class="ident" id="5508356">wireStruct</span><span class="op" id="5508366">.</span><span class="ident" id="5508367">Name</span><span class="op" id="5508371">,</span>&nbsp;<span class="ident" id="5508373">wireField</span><span class="op" id="5508382">.</span><span class="ident" id="5508383">Name</span><span class="op" id="5508387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5508391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508395">op</span>&nbsp;<span class="op" id="5508398">:=</span>&nbsp;<span class="ident" id="5508401">dec</span><span class="op" id="5508404">.</span><span class="ident" id="5508405">decOpFor</span><span class="op" id="5508413">(</span><span class="ident" id="5508414">wireField</span><span class="op" id="5508423">.</span><span class="ident" id="5508424">Id</span><span class="op" id="5508426">,</span>&nbsp;<span class="ident" id="5508428">localField</span><span class="op" id="5508438">.</span><span class="ident" id="5508439">Type</span><span class="op" id="5508443">,</span>&nbsp;<span class="ident" id="5508445">localField</span><span class="op" id="5508455">.</span><span class="ident" id="5508456">Name</span><span class="op" id="5508460">,</span>&nbsp;<span class="ident" id="5508462">seen</span><span class="op" id="5508466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508470">engine</span><span class="op" id="5508476">.</span><span class="ident" id="5508477">instr</span><span class="op" id="5508482">[</span><span class="ident" id="5508483">fieldnum</span><span class="op" id="5508491">]</span>&nbsp;<span class="op" id="5508493">=</span>&nbsp;<span class="ident" id="5508495">decInstr</span><span class="op" id="5508503">{</span><span class="op" id="5508504">*</span><span class="ident" id="5508505">op</span><span class="op" id="5508507">,</span>&nbsp;<span class="ident" id="5508509">fieldnum</span><span class="op" id="5508517">,</span>&nbsp;<span class="ident" id="5508519">localField</span><span class="op" id="5508529">.</span><span class="ident" id="5508530">Index</span><span class="op" id="5508535">,</span>&nbsp;<span class="ident" id="5508537">ovfl</span><span class="op" id="5508541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508545">engine</span><span class="op" id="5508551">.</span><span class="ident" id="5508552">numInstr</span><span class="op" id="5508560">++</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5508564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5508567">return</span><br>
<span class="lineno"></span><span class="op" id="5508574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5508577">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type.</span><br>
<span class="lineno">1095</span><span class="keyword" id="5508639">func</span>&nbsp;<span class="op" id="5508644">(</span><span class="ident" id="5508645">dec</span>&nbsp;<span class="op" id="5508649">*</span><span class="ident" id="5508650">Decoder</span><span class="op" id="5508657">)</span>&nbsp;<span class="ident" id="5508659">getDecEnginePtr</span><span class="op" id="5508674">(</span><span class="ident" id="5508675">remoteId</span>&nbsp;<span class="ident" id="5508684">typeId</span><span class="op" id="5508690">,</span>&nbsp;<span class="ident" id="5508692">ut</span>&nbsp;<span class="op" id="5508695">*</span><span class="ident" id="5508696">userTypeInfo</span><span class="op" id="5508708">)</span>&nbsp;<span class="op" id="5508710">(</span><span class="ident" id="5508711">enginePtr</span>&nbsp;<span class="op" id="5508721">*</span><span class="op" id="5508722">*</span><span class="ident" id="5508723">decEngine</span><span class="op" id="5508732">,</span>&nbsp;<span class="ident" id="5508734">err</span>&nbsp;<span class="builtintype" id="5508738">error</span><span class="op" id="5508743">)</span>&nbsp;<span class="op" id="5508745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508748">rt</span>&nbsp;<span class="op" id="5508751">:=</span>&nbsp;<span class="ident" id="5508754">ut</span><span class="op" id="5508756">.</span><span class="ident" id="5508757">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508763">decoderMap</span><span class="op" id="5508773">,</span>&nbsp;<span class="ident" id="5508775">ok</span>&nbsp;<span class="op" id="5508778">:=</span>&nbsp;<span class="ident" id="5508781">dec</span><span class="op" id="5508784">.</span><span class="ident" id="5508785">decoderCache</span><span class="op" id="5508797">[</span><span class="ident" id="5508798">rt</span><span class="op" id="5508800">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5508803">if</span>&nbsp;<span class="op" id="5508806">!</span><span class="ident" id="5508807">ok</span>&nbsp;<span class="op" id="5508810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508814">decoderMap</span>&nbsp;<span class="op" id="5508825">=</span>&nbsp;<span class="builtinfunc" id="5508827">make</span><span class="op" id="5508831">(</span><span class="keyword" id="5508832">map</span><span class="op" id="5508835">[</span><span class="ident" id="5508836">typeId</span><span class="op" id="5508842">]</span><span class="op" id="5508843">*</span><span class="op" id="5508844">*</span><span class="ident" id="5508845">decEngine</span><span class="op" id="5508854">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5508858">dec</span><span class="op" id="5508861">.</span><span class="ident" id="5508862">decoderCache</span><span class="op" id="5508874">[</span><span class="ident" id="5508875">rt</span><span class="op" id="5508877">]</span>&nbsp;<span class="op" id="5508879">=</span>&nbsp;<span class="ident" id="5508881">decoderMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5508893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5508896">if</span>&nbsp;<span class="ident" id="5508899">enginePtr</span><span class="op" id="5508908">,</span>&nbsp;<span class="ident" id="5508910">ok</span>&nbsp;<span class="op" id="5508913">=</span>&nbsp;<span class="ident" id="5508915">decoderMap</span><span class="op" id="5508925">[</span><span class="ident" id="5508926">remoteId</span><span class="op" id="5508934">]</span><span class="op" id="5508935">;</span>&nbsp;<span class="op" id="5508937">!</span><span class="ident" id="5508938">ok</span>&nbsp;<span class="op" id="5508941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5508945">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5509024">enginePtr</span>&nbsp;<span class="op" id="5509034">=</span>&nbsp;<span class="builtinfunc" id="5509036">new</span><span class="op" id="5509039">(</span><span class="op" id="5509040">*</span><span class="ident" id="5509041">decEngine</span><span class="op" id="5509050">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5509054">decoderMap</span><span class="op" id="5509064">[</span><span class="ident" id="5509065">remoteId</span><span class="op" id="5509073">]</span>&nbsp;<span class="op" id="5509075">=</span>&nbsp;<span class="ident" id="5509077">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5509089">*</span><span class="ident" id="5509090">enginePtr</span><span class="op" id="5509099">,</span>&nbsp;<span class="ident" id="5509101">err</span>&nbsp;<span class="op" id="5509105">=</span>&nbsp;<span class="ident" id="5509107">dec</span><span class="op" id="5509110">.</span><span class="ident" id="5509111">compileDec</span><span class="op" id="5509121">(</span><span class="ident" id="5509122">remoteId</span><span class="op" id="5509130">,</span>&nbsp;<span class="ident" id="5509132">ut</span><span class="op" id="5509134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509138">if</span>&nbsp;<span class="ident" id="5509141">err</span>&nbsp;<span class="op" id="5509145">!=</span>&nbsp;<span class="builtintype" id="5509148">nil</span>&nbsp;<span class="op" id="5509152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5509157">delete</span><span class="op" id="5509163">(</span><span class="ident" id="5509164">decoderMap</span><span class="op" id="5509174">,</span>&nbsp;<span class="ident" id="5509176">remoteId</span><span class="op" id="5509184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5509188">}</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5509191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509194">return</span><br>
<span class="lineno"></span><span class="op" id="5509201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5509204">//&nbsp;emptyStruct&nbsp;is&nbsp;the&nbsp;type&nbsp;we&nbsp;compile&nbsp;into&nbsp;when&nbsp;ignoring&nbsp;a&nbsp;struct&nbsp;value.</span><br>
<span class="lineno">1115</span><span class="keyword" id="5509277">type</span>&nbsp;<span class="ident" id="5509282">emptyStruct</span>&nbsp;<span class="keyword" id="5509294">struct</span><span class="op" id="5509300">{</span><span class="op" id="5509301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5509304">var</span>&nbsp;<span class="ident" id="5509308">emptyStructType</span>&nbsp;<span class="op" id="5509324">=</span>&nbsp;<span class="ident" id="5509326">reflect</span><span class="op" id="5509333">.</span><span class="ident" id="5509334">TypeOf</span><span class="op" id="5509340">(</span><span class="ident" id="5509341">emptyStruct</span><span class="op" id="5509352">{</span><span class="op" id="5509353">}</span><span class="op" id="5509354">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5509357">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type&nbsp;when&nbsp;the&nbsp;value&nbsp;is&nbsp;to&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno">1120</span><span class="keyword" id="5509453">func</span>&nbsp;<span class="op" id="5509458">(</span><span class="ident" id="5509459">dec</span>&nbsp;<span class="op" id="5509463">*</span><span class="ident" id="5509464">Decoder</span><span class="op" id="5509471">)</span>&nbsp;<span class="ident" id="5509473">getIgnoreEnginePtr</span><span class="op" id="5509491">(</span><span class="ident" id="5509492">wireId</span>&nbsp;<span class="ident" id="5509499">typeId</span><span class="op" id="5509505">)</span>&nbsp;<span class="op" id="5509507">(</span><span class="ident" id="5509508">enginePtr</span>&nbsp;<span class="op" id="5509518">*</span><span class="op" id="5509519">*</span><span class="ident" id="5509520">decEngine</span><span class="op" id="5509529">,</span>&nbsp;<span class="ident" id="5509531">err</span>&nbsp;<span class="builtintype" id="5509535">error</span><span class="op" id="5509540">)</span>&nbsp;<span class="op" id="5509542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509545">var</span>&nbsp;<span class="ident" id="5509549">ok</span>&nbsp;<span class="builtintype" id="5509552">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509558">if</span>&nbsp;<span class="ident" id="5509561">enginePtr</span><span class="op" id="5509570">,</span>&nbsp;<span class="ident" id="5509572">ok</span>&nbsp;<span class="op" id="5509575">=</span>&nbsp;<span class="ident" id="5509577">dec</span><span class="op" id="5509580">.</span><span class="ident" id="5509581">ignorerCache</span><span class="op" id="5509593">[</span><span class="ident" id="5509594">wireId</span><span class="op" id="5509600">]</span><span class="op" id="5509601">;</span>&nbsp;<span class="op" id="5509603">!</span><span class="ident" id="5509604">ok</span>&nbsp;<span class="op" id="5509607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5509611">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5509690">enginePtr</span>&nbsp;<span class="op" id="5509700">=</span>&nbsp;<span class="builtinfunc" id="5509702">new</span><span class="op" id="5509705">(</span><span class="op" id="5509706">*</span><span class="ident" id="5509707">decEngine</span><span class="op" id="5509716">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5509720">dec</span><span class="op" id="5509723">.</span><span class="ident" id="5509724">ignorerCache</span><span class="op" id="5509736">[</span><span class="ident" id="5509737">wireId</span><span class="op" id="5509743">]</span>&nbsp;<span class="op" id="5509745">=</span>&nbsp;<span class="ident" id="5509747">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5509759">wire</span>&nbsp;<span class="op" id="5509764">:=</span>&nbsp;<span class="ident" id="5509767">dec</span><span class="op" id="5509770">.</span><span class="ident" id="5509771">wireType</span><span class="op" id="5509779">[</span><span class="ident" id="5509780">wireId</span><span class="op" id="5509786">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509790">if</span>&nbsp;<span class="ident" id="5509793">wire</span>&nbsp;<span class="op" id="5509798">!=</span>&nbsp;<span class="builtintype" id="5509801">nil</span>&nbsp;<span class="op" id="5509805">&amp;&amp;</span>&nbsp;<span class="ident" id="5509808">wire</span><span class="op" id="5509812">.</span><span class="ident" id="5509813">StructT</span>&nbsp;<span class="op" id="5509821">!=</span>&nbsp;<span class="builtintype" id="5509824">nil</span>&nbsp;<span class="op" id="5509828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5509833">*</span><span class="ident" id="5509834">enginePtr</span><span class="op" id="5509843">,</span>&nbsp;<span class="ident" id="5509845">err</span>&nbsp;<span class="op" id="5509849">=</span>&nbsp;<span class="ident" id="5509851">dec</span><span class="op" id="5509854">.</span><span class="ident" id="5509855">compileDec</span><span class="op" id="5509865">(</span><span class="ident" id="5509866">wireId</span><span class="op" id="5509872">,</span>&nbsp;<span class="ident" id="5509874">userType</span><span class="op" id="5509882">(</span><span class="ident" id="5509883">emptyStructType</span><span class="op" id="5509898">)</span><span class="op" id="5509899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5509903">}</span>&nbsp;<span class="keyword" id="5509905">else</span>&nbsp;<span class="op" id="5509910">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5509915">*</span><span class="ident" id="5509916">enginePtr</span><span class="op" id="5509925">,</span>&nbsp;<span class="ident" id="5509927">err</span>&nbsp;<span class="op" id="5509931">=</span>&nbsp;<span class="ident" id="5509933">dec</span><span class="op" id="5509936">.</span><span class="ident" id="5509937">compileIgnoreSingle</span><span class="op" id="5509956">(</span><span class="ident" id="5509957">wireId</span><span class="op" id="5509963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5509967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5509971">if</span>&nbsp;<span class="ident" id="5509974">err</span>&nbsp;<span class="op" id="5509978">!=</span>&nbsp;<span class="builtintype" id="5509981">nil</span>&nbsp;<span class="op" id="5509985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5509990">delete</span><span class="op" id="5509996">(</span><span class="ident" id="5509997">dec</span><span class="op" id="5510000">.</span><span class="ident" id="5510001">ignorerCache</span><span class="op" id="5510013">,</span>&nbsp;<span class="ident" id="5510015">wireId</span><span class="op" id="5510021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5510025">}</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5510028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5510031">return</span><br>
<span class="lineno"></span><span class="op" id="5510038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5510041">//&nbsp;decodeValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">1140</span><span class="keyword" id="5510125">func</span>&nbsp;<span class="op" id="5510130">(</span><span class="ident" id="5510131">dec</span>&nbsp;<span class="op" id="5510135">*</span><span class="ident" id="5510136">Decoder</span><span class="op" id="5510143">)</span>&nbsp;<span class="ident" id="5510145">decodeValue</span><span class="op" id="5510156">(</span><span class="ident" id="5510157">wireId</span>&nbsp;<span class="ident" id="5510164">typeId</span><span class="op" id="5510170">,</span>&nbsp;<span class="ident" id="5510172">value</span>&nbsp;<span class="ident" id="5510178">reflect</span><span class="op" id="5510185">.</span><span class="ident" id="5510186">Value</span><span class="op" id="5510191">)</span>&nbsp;<span class="op" id="5510193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5510196">defer</span>&nbsp;<span class="ident" id="5510202">catchError</span><span class="op" id="5510212">(</span><span class="op" id="5510213">&amp;</span><span class="ident" id="5510214">dec</span><span class="op" id="5510217">.</span><span class="ident" id="5510218">err</span><span class="op" id="5510221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5510224">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;nil,&nbsp;it&nbsp;means&nbsp;we&nbsp;should&nbsp;just&nbsp;ignore&nbsp;this&nbsp;item.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5510291">if</span>&nbsp;<span class="op" id="5510294">!</span><span class="ident" id="5510295">value</span><span class="op" id="5510300">.</span><span class="ident" id="5510301">IsValid</span><span class="op" id="5510308">(</span><span class="op" id="5510309">)</span>&nbsp;<span class="op" id="5510311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510315">dec</span><span class="op" id="5510318">.</span><span class="ident" id="5510319">decodeIgnoredValue</span><span class="op" id="5510337">(</span><span class="ident" id="5510338">wireId</span><span class="op" id="5510344">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5510348">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5510356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5510359">//&nbsp;Dereference&nbsp;down&nbsp;to&nbsp;the&nbsp;underlying&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510404">ut</span>&nbsp;<span class="op" id="5510407">:=</span>&nbsp;<span class="ident" id="5510410">userType</span><span class="op" id="5510418">(</span><span class="ident" id="5510419">value</span><span class="op" id="5510424">.</span><span class="ident" id="5510425">Type</span><span class="op" id="5510429">(</span><span class="op" id="5510430">)</span><span class="op" id="5510431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510434">base</span>&nbsp;<span class="op" id="5510439">:=</span>&nbsp;<span class="ident" id="5510442">ut</span><span class="op" id="5510444">.</span><span class="ident" id="5510445">base</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5510451">var</span>&nbsp;<span class="ident" id="5510455">enginePtr</span>&nbsp;<span class="op" id="5510465">*</span><span class="op" id="5510466">*</span><span class="ident" id="5510467">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510478">enginePtr</span><span class="op" id="5510487">,</span>&nbsp;<span class="ident" id="5510489">dec</span><span class="op" id="5510492">.</span><span class="ident" id="5510493">err</span>&nbsp;<span class="op" id="5510497">=</span>&nbsp;<span class="ident" id="5510499">dec</span><span class="op" id="5510502">.</span><span class="ident" id="5510503">getDecEnginePtr</span><span class="op" id="5510518">(</span><span class="ident" id="5510519">wireId</span><span class="op" id="5510525">,</span>&nbsp;<span class="ident" id="5510527">ut</span><span class="op" id="5510529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5510532">if</span>&nbsp;<span class="ident" id="5510535">dec</span><span class="op" id="5510538">.</span><span class="ident" id="5510539">err</span>&nbsp;<span class="op" id="5510543">!=</span>&nbsp;<span class="builtintype" id="5510546">nil</span>&nbsp;<span class="op" id="5510550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5510554">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5510562">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510565">value</span>&nbsp;<span class="op" id="5510571">=</span>&nbsp;<span class="ident" id="5510573">decAlloc</span><span class="op" id="5510581">(</span><span class="ident" id="5510582">value</span><span class="op" id="5510587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510590">engine</span>&nbsp;<span class="op" id="5510597">:=</span>&nbsp;<span class="op" id="5510600">*</span><span class="ident" id="5510601">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5510612">if</span>&nbsp;<span class="ident" id="5510615">st</span>&nbsp;<span class="op" id="5510618">:=</span>&nbsp;<span class="ident" id="5510621">base</span><span class="op" id="5510625">;</span>&nbsp;<span class="ident" id="5510627">st</span><span class="op" id="5510629">.</span><span class="ident" id="5510630">Kind</span><span class="op" id="5510634">(</span><span class="op" id="5510635">)</span>&nbsp;<span class="op" id="5510637">==</span>&nbsp;<span class="ident" id="5510640">reflect</span><span class="op" id="5510647">.</span><span class="ident" id="5510648">Struct</span>&nbsp;<span class="op" id="5510655">&amp;&amp;</span>&nbsp;<span class="ident" id="5510658">ut</span><span class="op" id="5510660">.</span><span class="ident" id="5510661">externalDec</span>&nbsp;<span class="op" id="5510673">==</span>&nbsp;<span class="num" id="5510676">0</span>&nbsp;<span class="op" id="5510678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5510682">if</span>&nbsp;<span class="ident" id="5510685">engine</span><span class="op" id="5510691">.</span><span class="ident" id="5510692">numInstr</span>&nbsp;<span class="op" id="5510701">==</span>&nbsp;<span class="num" id="5510704">0</span>&nbsp;<span class="op" id="5510706">&amp;&amp;</span>&nbsp;<span class="ident" id="5510709">st</span><span class="op" id="5510711">.</span><span class="ident" id="5510712">NumField</span><span class="op" id="5510720">(</span><span class="op" id="5510721">)</span>&nbsp;<span class="op" id="5510723">&gt;</span>&nbsp;<span class="num" id="5510725">0</span>&nbsp;<span class="op" id="5510727">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510733">dec</span><span class="op" id="5510736">.</span><span class="ident" id="5510737">wireType</span><span class="op" id="5510745">[</span><span class="ident" id="5510746">wireId</span><span class="op" id="5510752">]</span>&nbsp;<span class="op" id="5510754">!=</span>&nbsp;<span class="builtintype" id="5510757">nil</span>&nbsp;<span class="op" id="5510761">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5510764">len</span><span class="op" id="5510767">(</span><span class="ident" id="5510768">dec</span><span class="op" id="5510771">.</span><span class="ident" id="5510772">wireType</span><span class="op" id="5510780">[</span><span class="ident" id="5510781">wireId</span><span class="op" id="5510787">]</span><span class="op" id="5510788">.</span><span class="ident" id="5510789">StructT</span><span class="op" id="5510796">.</span><span class="ident" id="5510797">Field</span><span class="op" id="5510802">)</span>&nbsp;<span class="op" id="5510804">&gt;</span>&nbsp;<span class="num" id="5510806">0</span>&nbsp;<span class="op" id="5510808">{</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510813">name</span>&nbsp;<span class="op" id="5510818">:=</span>&nbsp;<span class="ident" id="5510821">base</span><span class="op" id="5510825">.</span><span class="ident" id="5510826">Name</span><span class="op" id="5510830">(</span><span class="op" id="5510831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510836">errorf</span><span class="op" id="5510842">(</span><span class="string" id="5510843">&#34;type&nbsp;mismatch:&nbsp;no&nbsp;fields&nbsp;matched&nbsp;compiling&nbsp;decoder&nbsp;for&nbsp;%s&#34;</span><span class="op" id="5510902">,</span>&nbsp;<span class="ident" id="5510904">name</span><span class="op" id="5510908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5510912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510916">dec</span><span class="op" id="5510919">.</span><span class="ident" id="5510920">decodeStruct</span><span class="op" id="5510932">(</span><span class="ident" id="5510933">engine</span><span class="op" id="5510939">,</span>&nbsp;<span class="ident" id="5510941">ut</span><span class="op" id="5510943">,</span>&nbsp;<span class="ident" id="5510945">value</span><span class="op" id="5510950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5510953">}</span>&nbsp;<span class="keyword" id="5510955">else</span>&nbsp;<span class="op" id="5510960">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5510964">dec</span><span class="op" id="5510967">.</span><span class="ident" id="5510968">decodeSingle</span><span class="op" id="5510980">(</span><span class="ident" id="5510981">engine</span><span class="op" id="5510987">,</span>&nbsp;<span class="ident" id="5510989">ut</span><span class="op" id="5510991">,</span>&nbsp;<span class="ident" id="5510993">value</span><span class="op" id="5510998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5511001">}</span><br>
<span class="lineno"></span><span class="op" id="5511003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5511006">//&nbsp;decodeIgnoredValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;and&nbsp;discards&nbsp;it.</span><br>
<span class="lineno">1170</span><span class="keyword" id="5511112">func</span>&nbsp;<span class="op" id="5511117">(</span><span class="ident" id="5511118">dec</span>&nbsp;<span class="op" id="5511122">*</span><span class="ident" id="5511123">Decoder</span><span class="op" id="5511130">)</span>&nbsp;<span class="ident" id="5511132">decodeIgnoredValue</span><span class="op" id="5511150">(</span><span class="ident" id="5511151">wireId</span>&nbsp;<span class="ident" id="5511158">typeId</span><span class="op" id="5511164">)</span>&nbsp;<span class="op" id="5511166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511169">var</span>&nbsp;<span class="ident" id="5511173">enginePtr</span>&nbsp;<span class="op" id="5511183">*</span><span class="op" id="5511184">*</span><span class="ident" id="5511185">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511196">enginePtr</span><span class="op" id="5511205">,</span>&nbsp;<span class="ident" id="5511207">dec</span><span class="op" id="5511210">.</span><span class="ident" id="5511211">err</span>&nbsp;<span class="op" id="5511215">=</span>&nbsp;<span class="ident" id="5511217">dec</span><span class="op" id="5511220">.</span><span class="ident" id="5511221">getIgnoreEnginePtr</span><span class="op" id="5511239">(</span><span class="ident" id="5511240">wireId</span><span class="op" id="5511246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511249">if</span>&nbsp;<span class="ident" id="5511252">dec</span><span class="op" id="5511255">.</span><span class="ident" id="5511256">err</span>&nbsp;<span class="op" id="5511260">!=</span>&nbsp;<span class="builtintype" id="5511263">nil</span>&nbsp;<span class="op" id="5511267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511271">return</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5511279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511282">wire</span>&nbsp;<span class="op" id="5511287">:=</span>&nbsp;<span class="ident" id="5511290">dec</span><span class="op" id="5511293">.</span><span class="ident" id="5511294">wireType</span><span class="op" id="5511302">[</span><span class="ident" id="5511303">wireId</span><span class="op" id="5511309">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511312">if</span>&nbsp;<span class="ident" id="5511315">wire</span>&nbsp;<span class="op" id="5511320">!=</span>&nbsp;<span class="builtintype" id="5511323">nil</span>&nbsp;<span class="op" id="5511327">&amp;&amp;</span>&nbsp;<span class="ident" id="5511330">wire</span><span class="op" id="5511334">.</span><span class="ident" id="5511335">StructT</span>&nbsp;<span class="op" id="5511343">!=</span>&nbsp;<span class="builtintype" id="5511346">nil</span>&nbsp;<span class="op" id="5511350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511354">dec</span><span class="op" id="5511357">.</span><span class="ident" id="5511358">ignoreStruct</span><span class="op" id="5511370">(</span><span class="op" id="5511371">*</span><span class="ident" id="5511372">enginePtr</span><span class="op" id="5511381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5511384">}</span>&nbsp;<span class="keyword" id="5511386">else</span>&nbsp;<span class="op" id="5511391">{</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511395">dec</span><span class="op" id="5511398">.</span><span class="ident" id="5511399">ignoreSingle</span><span class="op" id="5511411">(</span><span class="op" id="5511412">*</span><span class="ident" id="5511413">enginePtr</span><span class="op" id="5511422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5511425">}</span><br>
<span class="lineno"></span><span class="op" id="5511427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5511430">func</span>&nbsp;<span class="ident" id="5511435">init</span><span class="op" id="5511439">(</span><span class="op" id="5511440">)</span>&nbsp;<span class="op" id="5511442">{</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511445">var</span>&nbsp;<span class="ident" id="5511449">iop</span><span class="op" id="5511452">,</span>&nbsp;<span class="ident" id="5511454">uop</span>&nbsp;<span class="ident" id="5511458">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511465">switch</span>&nbsp;<span class="ident" id="5511472">reflect</span><span class="op" id="5511479">.</span><span class="ident" id="5511480">TypeOf</span><span class="op" id="5511486">(</span><span class="builtintype" id="5511487">int</span><span class="op" id="5511490">(</span><span class="num" id="5511491">0</span><span class="op" id="5511492">)</span><span class="op" id="5511493">)</span><span class="op" id="5511494">.</span><span class="ident" id="5511495">Bits</span><span class="op" id="5511499">(</span><span class="op" id="5511500">)</span>&nbsp;<span class="op" id="5511502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511505">case</span>&nbsp;<span class="num" id="5511510">32</span><span class="op" id="5511512">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511516">iop</span>&nbsp;<span class="op" id="5511520">=</span>&nbsp;<span class="ident" id="5511522">decInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511533">uop</span>&nbsp;<span class="op" id="5511537">=</span>&nbsp;<span class="ident" id="5511539">decUint32</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511550">case</span>&nbsp;<span class="num" id="5511555">64</span><span class="op" id="5511557">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511561">iop</span>&nbsp;<span class="op" id="5511565">=</span>&nbsp;<span class="ident" id="5511567">decInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511578">uop</span>&nbsp;<span class="op" id="5511582">=</span>&nbsp;<span class="ident" id="5511584">decUint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511595">default</span><span class="op" id="5511602">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5511606">panic</span><span class="op" id="5511611">(</span><span class="string" id="5511612">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;int/uint&#34;</span><span class="op" id="5511643">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5511646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511649">decOpTable</span><span class="op" id="5511659">[</span><span class="ident" id="5511660">reflect</span><span class="op" id="5511667">.</span><span class="ident" id="5511668">Int</span><span class="op" id="5511671">]</span>&nbsp;<span class="op" id="5511673">=</span>&nbsp;<span class="ident" id="5511675">iop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511680">decOpTable</span><span class="op" id="5511690">[</span><span class="ident" id="5511691">reflect</span><span class="op" id="5511698">.</span><span class="ident" id="5511699">Uint</span><span class="op" id="5511703">]</span>&nbsp;<span class="op" id="5511705">=</span>&nbsp;<span class="ident" id="5511707">uop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5511713">//&nbsp;Finally&nbsp;uintptr</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511733">switch</span>&nbsp;<span class="ident" id="5511740">reflect</span><span class="op" id="5511747">.</span><span class="ident" id="5511748">TypeOf</span><span class="op" id="5511754">(</span><span class="builtintype" id="5511755">uintptr</span><span class="op" id="5511762">(</span><span class="num" id="5511763">0</span><span class="op" id="5511764">)</span><span class="op" id="5511765">)</span><span class="op" id="5511766">.</span><span class="ident" id="5511767">Bits</span><span class="op" id="5511771">(</span><span class="op" id="5511772">)</span>&nbsp;<span class="op" id="5511774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511777">case</span>&nbsp;<span class="num" id="5511782">32</span><span class="op" id="5511784">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511788">uop</span>&nbsp;<span class="op" id="5511792">=</span>&nbsp;<span class="ident" id="5511794">decUint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511805">case</span>&nbsp;<span class="num" id="5511810">64</span><span class="op" id="5511812">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511816">uop</span>&nbsp;<span class="op" id="5511820">=</span>&nbsp;<span class="ident" id="5511822">decUint64</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5511833">default</span><span class="op" id="5511840">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5511844">panic</span><span class="op" id="5511849">(</span><span class="string" id="5511850">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;uintptr&#34;</span><span class="op" id="5511880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5511883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5511886">decOpTable</span><span class="op" id="5511896">[</span><span class="ident" id="5511897">reflect</span><span class="op" id="5511904">.</span><span class="ident" id="5511905">Uintptr</span><span class="op" id="5511912">]</span>&nbsp;<span class="op" id="5511914">=</span>&nbsp;<span class="ident" id="5511916">uop</span><br>
<span class="lineno"></span><span class="op" id="5511920">}</span><br>
<span class="lineno">1210</span><br>
<span class="lineno"></span><span class="comment" id="5511923">//&nbsp;Gob&nbsp;depends&nbsp;on&nbsp;being&nbsp;able&nbsp;to&nbsp;take&nbsp;the&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="5511972">//&nbsp;of&nbsp;zeroed&nbsp;Values&nbsp;it&nbsp;creates,&nbsp;so&nbsp;use&nbsp;this&nbsp;wrapper&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="5512032">//&nbsp;of&nbsp;the&nbsp;standard&nbsp;reflect.Zero.</span><br>
<span class="lineno"></span><span class="comment" id="5512065">//&nbsp;Each&nbsp;call&nbsp;allocates&nbsp;once.</span><br>
<span class="lineno">1215</span><span class="keyword" id="5512094">func</span>&nbsp;<span class="ident" id="5512099">allocValue</span><span class="op" id="5512109">(</span><span class="ident" id="5512110">t</span>&nbsp;<span class="ident" id="5512112">reflect</span><span class="op" id="5512119">.</span><span class="ident" id="5512120">Type</span><span class="op" id="5512124">)</span>&nbsp;<span class="ident" id="5512126">reflect</span><span class="op" id="5512133">.</span><span class="ident" id="5512134">Value</span>&nbsp;<span class="op" id="5512140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5512143">return</span>&nbsp;<span class="ident" id="5512150">reflect</span><span class="op" id="5512157">.</span><span class="ident" id="5512158">New</span><span class="op" id="5512161">(</span><span class="ident" id="5512162">t</span><span class="op" id="5512163">)</span><span class="op" id="5512164">.</span><span class="ident" id="5512165">Elem</span><span class="op" id="5512169">(</span><span class="op" id="5512170">)</span><br>
<span class="lineno"></span><span class="op" id="5512172">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
