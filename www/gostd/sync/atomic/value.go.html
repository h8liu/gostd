<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync/atomic</h2>
<ul>
<li><a href="/gostd/sync/atomic/atomic_test.go.html">atomic_test.go</a></li>
<li><a href="/gostd/sync/atomic/doc.go.html">doc.go</a></li>
<li><a href="/gostd/sync/atomic/value.go.html" class="current">value.go</a></li>
<li><a href="/gostd/sync/atomic/value_test.go.html">value_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1415715">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1415770">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1415824">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1415875">package</span>&nbsp;<span class="ident" id="1415883">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1415891">import</span>&nbsp;<span class="op" id="1415898">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1415901">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1415910">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="1415913">//&nbsp;A&nbsp;Value&nbsp;provides&nbsp;an&nbsp;atomic&nbsp;load&nbsp;and&nbsp;store&nbsp;of&nbsp;a&nbsp;consistently&nbsp;typed&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1415989">//&nbsp;Values&nbsp;can&nbsp;be&nbsp;created&nbsp;as&nbsp;part&nbsp;of&nbsp;other&nbsp;data&nbsp;structures.</span><br>
<span class="lineno"></span><span class="comment" id="1416048">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Value&nbsp;returns&nbsp;nil&nbsp;from&nbsp;Load.</span><br>
<span class="lineno"></span><span class="comment" id="1416101">//&nbsp;Once&nbsp;Store&nbsp;has&nbsp;been&nbsp;called,&nbsp;a&nbsp;Value&nbsp;must&nbsp;not&nbsp;be&nbsp;copied.</span><br>
<span class="lineno">15</span><span class="keyword" id="1416160">type</span>&nbsp;<span class="ident" id="1416165">Value</span>&nbsp;<span class="keyword" id="1416171">struct</span>&nbsp;<span class="op" id="1416178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1416181">v</span>&nbsp;<span class="keyword" id="1416183">interface</span><span class="op" id="1416192">{</span><span class="op" id="1416193">}</span><br>
<span class="lineno"></span><span class="op" id="1416195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1416198">//&nbsp;ifaceWords&nbsp;is&nbsp;interface{}&nbsp;internal&nbsp;representation.</span><br>
<span class="lineno">20</span><span class="keyword" id="1416252">type</span>&nbsp;<span class="ident" id="1416257">ifaceWords</span>&nbsp;<span class="keyword" id="1416268">struct</span>&nbsp;<span class="op" id="1416275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1416278">typ</span>&nbsp;&nbsp;<span class="ident" id="1416283">unsafe</span><span class="op" id="1416289">.</span><span class="ident" id="1416290">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1416299">data</span>&nbsp;<span class="ident" id="1416304">unsafe</span><span class="op" id="1416310">.</span><span class="ident" id="1416311">Pointer</span><br>
<span class="lineno"></span><span class="op" id="1416319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1416322">//&nbsp;Load&nbsp;returns&nbsp;the&nbsp;value&nbsp;set&nbsp;by&nbsp;the&nbsp;most&nbsp;recent&nbsp;Store.</span><br>
<span class="lineno"></span><span class="comment" id="1416378">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;there&nbsp;has&nbsp;been&nbsp;no&nbsp;call&nbsp;to&nbsp;Store&nbsp;for&nbsp;this&nbsp;Value.</span><br>
<span class="lineno"></span><span class="keyword" id="1416447">func</span>&nbsp;<span class="op" id="1416452">(</span><span class="ident" id="1416453">v</span>&nbsp;<span class="op" id="1416455">*</span><span class="ident" id="1416456">Value</span><span class="op" id="1416461">)</span>&nbsp;<span class="ident" id="1416463">Load</span><span class="op" id="1416467">(</span><span class="op" id="1416468">)</span>&nbsp;<span class="op" id="1416470">(</span><span class="ident" id="1416471">x</span>&nbsp;<span class="keyword" id="1416473">interface</span><span class="op" id="1416482">{</span><span class="op" id="1416483">}</span><span class="op" id="1416484">)</span>&nbsp;<span class="op" id="1416486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1416489">vp</span>&nbsp;<span class="op" id="1416492">:=</span>&nbsp;<span class="op" id="1416495">(</span><span class="op" id="1416496">*</span><span class="ident" id="1416497">ifaceWords</span><span class="op" id="1416507">)</span><span class="op" id="1416508">(</span><span class="ident" id="1416509">unsafe</span><span class="op" id="1416515">.</span><span class="ident" id="1416516">Pointer</span><span class="op" id="1416523">(</span><span class="ident" id="1416524">v</span><span class="op" id="1416525">)</span><span class="op" id="1416526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1416529">typ</span>&nbsp;<span class="op" id="1416533">:=</span>&nbsp;<span class="ident" id="1416536">LoadPointer</span><span class="op" id="1416547">(</span><span class="op" id="1416548">&amp;</span><span class="ident" id="1416549">vp</span><span class="op" id="1416551">.</span><span class="ident" id="1416552">typ</span><span class="op" id="1416555">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1416558">if</span>&nbsp;<span class="ident" id="1416561">typ</span>&nbsp;<span class="op" id="1416565">==</span>&nbsp;<span class="ident" id="1416568">nil</span>&nbsp;<span class="op" id="1416572">||</span>&nbsp;<span class="builtintype" id="1416575">uintptr</span><span class="op" id="1416582">(</span><span class="ident" id="1416583">typ</span><span class="op" id="1416586">)</span>&nbsp;<span class="op" id="1416588">==</span>&nbsp;<span class="op" id="1416591">^</span><span class="builtintype" id="1416592">uintptr</span><span class="op" id="1416599">(</span><span class="num" id="1416600">0</span><span class="op" id="1416601">)</span>&nbsp;<span class="op" id="1416603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1416607">//&nbsp;First&nbsp;store&nbsp;not&nbsp;yet&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1416643">return</span>&nbsp;<span class="ident" id="1416650">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1416655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1416658">data</span>&nbsp;<span class="op" id="1416663">:=</span>&nbsp;<span class="ident" id="1416666">LoadPointer</span><span class="op" id="1416677">(</span><span class="op" id="1416678">&amp;</span><span class="ident" id="1416679">vp</span><span class="op" id="1416681">.</span><span class="ident" id="1416682">data</span><span class="op" id="1416686">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1416689">xp</span>&nbsp;<span class="op" id="1416692">:=</span>&nbsp;<span class="op" id="1416695">(</span><span class="op" id="1416696">*</span><span class="ident" id="1416697">ifaceWords</span><span class="op" id="1416707">)</span><span class="op" id="1416708">(</span><span class="ident" id="1416709">unsafe</span><span class="op" id="1416715">.</span><span class="ident" id="1416716">Pointer</span><span class="op" id="1416723">(</span><span class="op" id="1416724">&amp;</span><span class="ident" id="1416725">x</span><span class="op" id="1416726">)</span><span class="op" id="1416727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1416730">xp</span><span class="op" id="1416732">.</span><span class="ident" id="1416733">typ</span>&nbsp;<span class="op" id="1416737">=</span>&nbsp;<span class="ident" id="1416739">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1416744">xp</span><span class="op" id="1416746">.</span><span class="ident" id="1416747">data</span>&nbsp;<span class="op" id="1416752">=</span>&nbsp;<span class="ident" id="1416754">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1416760">return</span><br>
<span class="lineno"></span><span class="op" id="1416767">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="1416770">//&nbsp;Store&nbsp;sets&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;Value&nbsp;to&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="1416813">//&nbsp;All&nbsp;calls&nbsp;to&nbsp;Store&nbsp;for&nbsp;a&nbsp;given&nbsp;Value&nbsp;must&nbsp;use&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="1416896">//&nbsp;Store&nbsp;of&nbsp;an&nbsp;inconsistent&nbsp;type&nbsp;panics,&nbsp;as&nbsp;does&nbsp;Store(nil).</span><br>
<span class="lineno"></span><span class="keyword" id="1416957">func</span>&nbsp;<span class="op" id="1416962">(</span><span class="ident" id="1416963">v</span>&nbsp;<span class="op" id="1416965">*</span><span class="ident" id="1416966">Value</span><span class="op" id="1416971">)</span>&nbsp;<span class="ident" id="1416973">Store</span><span class="op" id="1416978">(</span><span class="ident" id="1416979">x</span>&nbsp;<span class="keyword" id="1416981">interface</span><span class="op" id="1416990">{</span><span class="op" id="1416991">}</span><span class="op" id="1416992">)</span>&nbsp;<span class="op" id="1416994">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1416997">if</span>&nbsp;<span class="ident" id="1417000">x</span>&nbsp;<span class="op" id="1417002">==</span>&nbsp;<span class="ident" id="1417005">nil</span>&nbsp;<span class="op" id="1417009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1417013">panic</span><span class="op" id="1417018">(</span><span class="string" id="1417019">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;nil&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1417063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1417066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1417069">vp</span>&nbsp;<span class="op" id="1417072">:=</span>&nbsp;<span class="op" id="1417075">(</span><span class="op" id="1417076">*</span><span class="ident" id="1417077">ifaceWords</span><span class="op" id="1417087">)</span><span class="op" id="1417088">(</span><span class="ident" id="1417089">unsafe</span><span class="op" id="1417095">.</span><span class="ident" id="1417096">Pointer</span><span class="op" id="1417103">(</span><span class="ident" id="1417104">v</span><span class="op" id="1417105">)</span><span class="op" id="1417106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1417109">xp</span>&nbsp;<span class="op" id="1417112">:=</span>&nbsp;<span class="op" id="1417115">(</span><span class="op" id="1417116">*</span><span class="ident" id="1417117">ifaceWords</span><span class="op" id="1417127">)</span><span class="op" id="1417128">(</span><span class="ident" id="1417129">unsafe</span><span class="op" id="1417135">.</span><span class="ident" id="1417136">Pointer</span><span class="op" id="1417143">(</span><span class="op" id="1417144">&amp;</span><span class="ident" id="1417145">x</span><span class="op" id="1417146">)</span><span class="op" id="1417147">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1417150">for</span>&nbsp;<span class="op" id="1417154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1417158">typ</span>&nbsp;<span class="op" id="1417162">:=</span>&nbsp;<span class="ident" id="1417165">LoadPointer</span><span class="op" id="1417176">(</span><span class="op" id="1417177">&amp;</span><span class="ident" id="1417178">vp</span><span class="op" id="1417180">.</span><span class="ident" id="1417181">typ</span><span class="op" id="1417184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1417188">if</span>&nbsp;<span class="ident" id="1417191">typ</span>&nbsp;<span class="op" id="1417195">==</span>&nbsp;<span class="ident" id="1417198">nil</span>&nbsp;<span class="op" id="1417202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1417207">//&nbsp;Attempt&nbsp;to&nbsp;start&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1417243">//&nbsp;Disable&nbsp;preemption&nbsp;so&nbsp;that&nbsp;other&nbsp;goroutines&nbsp;can&nbsp;use</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1417301">//&nbsp;active&nbsp;spin&nbsp;wait&nbsp;to&nbsp;wait&nbsp;for&nbsp;completion;&nbsp;and&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1417360">//&nbsp;GC&nbsp;does&nbsp;not&nbsp;see&nbsp;the&nbsp;fake&nbsp;type&nbsp;accidentally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1417410">runtime_procPin</span><span class="op" id="1417425">(</span><span class="op" id="1417426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1417431">if</span>&nbsp;<span class="op" id="1417434">!</span><span class="ident" id="1417435">CompareAndSwapPointer</span><span class="op" id="1417456">(</span><span class="op" id="1417457">&amp;</span><span class="ident" id="1417458">vp</span><span class="op" id="1417460">.</span><span class="ident" id="1417461">typ</span><span class="op" id="1417464">,</span>&nbsp;<span class="ident" id="1417466">nil</span><span class="op" id="1417469">,</span>&nbsp;<span class="ident" id="1417471">unsafe</span><span class="op" id="1417477">.</span><span class="ident" id="1417478">Pointer</span><span class="op" id="1417485">(</span><span class="op" id="1417486">^</span><span class="builtintype" id="1417487">uintptr</span><span class="op" id="1417494">(</span><span class="num" id="1417495">0</span><span class="op" id="1417496">)</span><span class="op" id="1417497">)</span><span class="op" id="1417498">)</span>&nbsp;<span class="op" id="1417500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1417506">runtime_procUnpin</span><span class="op" id="1417523">(</span><span class="op" id="1417524">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1417530">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1417542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1417547">//&nbsp;Complete&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1417575">StorePointer</span><span class="op" id="1417587">(</span><span class="op" id="1417588">&amp;</span><span class="ident" id="1417589">vp</span><span class="op" id="1417591">.</span><span class="ident" id="1417592">data</span><span class="op" id="1417596">,</span>&nbsp;<span class="ident" id="1417598">xp</span><span class="op" id="1417600">.</span><span class="ident" id="1417601">data</span><span class="op" id="1417605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1417610">StorePointer</span><span class="op" id="1417622">(</span><span class="op" id="1417623">&amp;</span><span class="ident" id="1417624">vp</span><span class="op" id="1417626">.</span><span class="ident" id="1417627">typ</span><span class="op" id="1417630">,</span>&nbsp;<span class="ident" id="1417632">xp</span><span class="op" id="1417634">.</span><span class="ident" id="1417635">typ</span><span class="op" id="1417638">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1417643">runtime_procUnpin</span><span class="op" id="1417660">(</span><span class="op" id="1417661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1417666">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1417675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1417679">if</span>&nbsp;<span class="builtintype" id="1417682">uintptr</span><span class="op" id="1417689">(</span><span class="ident" id="1417690">typ</span><span class="op" id="1417693">)</span>&nbsp;<span class="op" id="1417695">==</span>&nbsp;<span class="op" id="1417698">^</span><span class="builtintype" id="1417699">uintptr</span><span class="op" id="1417706">(</span><span class="num" id="1417707">0</span><span class="op" id="1417708">)</span>&nbsp;<span class="op" id="1417710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1417715">//&nbsp;First&nbsp;store&nbsp;in&nbsp;progress.&nbsp;Wait.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1417752">//&nbsp;Since&nbsp;we&nbsp;disable&nbsp;preemption&nbsp;around&nbsp;the&nbsp;first&nbsp;store,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1417810">//&nbsp;we&nbsp;can&nbsp;wait&nbsp;with&nbsp;active&nbsp;spinning.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1417850">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1417861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1417865">//&nbsp;First&nbsp;store&nbsp;completed.&nbsp;Check&nbsp;type&nbsp;and&nbsp;overwrite&nbsp;data.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1417924">if</span>&nbsp;<span class="ident" id="1417927">typ</span>&nbsp;<span class="op" id="1417931">!=</span>&nbsp;<span class="ident" id="1417934">xp</span><span class="op" id="1417936">.</span><span class="ident" id="1417937">typ</span>&nbsp;<span class="op" id="1417941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1417946">panic</span><span class="op" id="1417951">(</span><span class="string" id="1417952">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;inconsistently&nbsp;typed&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1418013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1418017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1418021">StorePointer</span><span class="op" id="1418033">(</span><span class="op" id="1418034">&amp;</span><span class="ident" id="1418035">vp</span><span class="op" id="1418037">.</span><span class="ident" id="1418038">data</span><span class="op" id="1418042">,</span>&nbsp;<span class="ident" id="1418044">xp</span><span class="op" id="1418046">.</span><span class="ident" id="1418047">data</span><span class="op" id="1418051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1418055">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1418063">}</span><br>
<span class="lineno"></span><span class="op" id="1418065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1418068">//&nbsp;Disable/enable&nbsp;preemption,&nbsp;implemented&nbsp;in&nbsp;runtime.</span><br>
<span class="lineno"></span><span class="keyword" id="1418122">func</span>&nbsp;<span class="ident" id="1418127">runtime_procPin</span><span class="op" id="1418142">(</span><span class="op" id="1418143">)</span><br>
<span class="lineno">85</span><span class="keyword" id="1418145">func</span>&nbsp;<span class="ident" id="1418150">runtime_procUnpin</span><span class="op" id="1418167">(</span><span class="op" id="1418168">)</span>
</div>
</body>
</html>
