<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3396285">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3396341">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3396395">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3396446">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3396511">package</span>&nbsp;<span class="ident" id="3396519">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3396524">import</span>&nbsp;<span class="op" id="3396531">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3396534">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3396540">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="3396550">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3396553">func</span>&nbsp;<span class="ident" id="3396558">joinIPv4Group</span><span class="op" id="3396571">(</span><span class="ident" id="3396572">fd</span>&nbsp;<span class="op" id="3396575">*</span><span class="ident" id="3396576">netFD</span><span class="op" id="3396581">,</span>&nbsp;<span class="ident" id="3396583">ifi</span>&nbsp;<span class="op" id="3396587">*</span><span class="ident" id="3396588">Interface</span><span class="op" id="3396597">,</span>&nbsp;<span class="ident" id="3396599">ip</span>&nbsp;<span class="ident" id="3396602">IP</span><span class="op" id="3396604">)</span>&nbsp;<span class="builtintype" id="3396606">error</span>&nbsp;<span class="op" id="3396612">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396615">mreq</span>&nbsp;<span class="op" id="3396620">:=</span>&nbsp;<span class="op" id="3396623">&amp;</span><span class="ident" id="3396624">syscall</span><span class="op" id="3396631">.</span><span class="ident" id="3396632">IPMreq</span><span class="op" id="3396638">{</span><span class="ident" id="3396639">Multiaddr</span><span class="op" id="3396648">:</span>&nbsp;<span class="op" id="3396650">[</span><span class="num" id="3396651">4</span><span class="op" id="3396652">]</span><span class="builtintype" id="3396653">byte</span><span class="op" id="3396657">{</span><span class="ident" id="3396658">ip</span><span class="op" id="3396660">[</span><span class="num" id="3396661">0</span><span class="op" id="3396662">]</span><span class="op" id="3396663">,</span>&nbsp;<span class="ident" id="3396665">ip</span><span class="op" id="3396667">[</span><span class="num" id="3396668">1</span><span class="op" id="3396669">]</span><span class="op" id="3396670">,</span>&nbsp;<span class="ident" id="3396672">ip</span><span class="op" id="3396674">[</span><span class="num" id="3396675">2</span><span class="op" id="3396676">]</span><span class="op" id="3396677">,</span>&nbsp;<span class="ident" id="3396679">ip</span><span class="op" id="3396681">[</span><span class="num" id="3396682">3</span><span class="op" id="3396683">]</span><span class="op" id="3396684">}</span><span class="op" id="3396685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396688">if</span>&nbsp;<span class="ident" id="3396691">err</span>&nbsp;<span class="op" id="3396695">:=</span>&nbsp;<span class="ident" id="3396698">setIPv4MreqToInterface</span><span class="op" id="3396720">(</span><span class="ident" id="3396721">mreq</span><span class="op" id="3396725">,</span>&nbsp;<span class="ident" id="3396727">ifi</span><span class="op" id="3396730">)</span><span class="op" id="3396731">;</span>&nbsp;<span class="ident" id="3396733">err</span>&nbsp;<span class="op" id="3396737">!=</span>&nbsp;<span class="ident" id="3396740">nil</span>&nbsp;<span class="op" id="3396744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396748">return</span>&nbsp;<span class="ident" id="3396755">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3396760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396763">if</span>&nbsp;<span class="ident" id="3396766">err</span>&nbsp;<span class="op" id="3396770">:=</span>&nbsp;<span class="ident" id="3396773">fd</span><span class="op" id="3396775">.</span><span class="ident" id="3396776">incref</span><span class="op" id="3396782">(</span><span class="op" id="3396783">)</span><span class="op" id="3396784">;</span>&nbsp;<span class="ident" id="3396786">err</span>&nbsp;<span class="op" id="3396790">!=</span>&nbsp;<span class="ident" id="3396793">nil</span>&nbsp;<span class="op" id="3396797">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396801">return</span>&nbsp;<span class="ident" id="3396808">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3396813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396816">defer</span>&nbsp;<span class="ident" id="3396822">fd</span><span class="op" id="3396824">.</span><span class="ident" id="3396825">decref</span><span class="op" id="3396831">(</span><span class="op" id="3396832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396835">return</span>&nbsp;<span class="ident" id="3396842">os</span><span class="op" id="3396844">.</span><span class="ident" id="3396845">NewSyscallError</span><span class="op" id="3396860">(</span><span class="string" id="3396861">&#34;setsockopt&#34;</span><span class="op" id="3396873">,</span>&nbsp;<span class="ident" id="3396875">syscall</span><span class="op" id="3396882">.</span><span class="ident" id="3396883">SetsockoptIPMreq</span><span class="op" id="3396899">(</span><span class="ident" id="3396900">fd</span><span class="op" id="3396902">.</span><span class="ident" id="3396903">sysfd</span><span class="op" id="3396908">,</span>&nbsp;<span class="ident" id="3396910">syscall</span><span class="op" id="3396917">.</span><span class="ident" id="3396918">IPPROTO_IP</span><span class="op" id="3396928">,</span>&nbsp;<span class="ident" id="3396930">syscall</span><span class="op" id="3396937">.</span><span class="ident" id="3396938">IP_ADD_MEMBERSHIP</span><span class="op" id="3396955">,</span>&nbsp;<span class="ident" id="3396957">mreq</span><span class="op" id="3396961">)</span><span class="op" id="3396962">)</span><br>
<span class="lineno"></span><span class="op" id="3396964">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3396967">func</span>&nbsp;<span class="ident" id="3396972">setIPv6MulticastInterface</span><span class="op" id="3396997">(</span><span class="ident" id="3396998">fd</span>&nbsp;<span class="op" id="3397001">*</span><span class="ident" id="3397002">netFD</span><span class="op" id="3397007">,</span>&nbsp;<span class="ident" id="3397009">ifi</span>&nbsp;<span class="op" id="3397013">*</span><span class="ident" id="3397014">Interface</span><span class="op" id="3397023">)</span>&nbsp;<span class="builtintype" id="3397025">error</span>&nbsp;<span class="op" id="3397031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397034">var</span>&nbsp;<span class="ident" id="3397038">v</span>&nbsp;<span class="builtintype" id="3397040">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397045">if</span>&nbsp;<span class="ident" id="3397048">ifi</span>&nbsp;<span class="op" id="3397052">!=</span>&nbsp;<span class="ident" id="3397055">nil</span>&nbsp;<span class="op" id="3397059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397063">v</span>&nbsp;<span class="op" id="3397065">=</span>&nbsp;<span class="ident" id="3397067">ifi</span><span class="op" id="3397070">.</span><span class="ident" id="3397071">Index</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3397078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397081">if</span>&nbsp;<span class="ident" id="3397084">err</span>&nbsp;<span class="op" id="3397088">:=</span>&nbsp;<span class="ident" id="3397091">fd</span><span class="op" id="3397093">.</span><span class="ident" id="3397094">incref</span><span class="op" id="3397100">(</span><span class="op" id="3397101">)</span><span class="op" id="3397102">;</span>&nbsp;<span class="ident" id="3397104">err</span>&nbsp;<span class="op" id="3397108">!=</span>&nbsp;<span class="ident" id="3397111">nil</span>&nbsp;<span class="op" id="3397115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397119">return</span>&nbsp;<span class="ident" id="3397126">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3397131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397134">defer</span>&nbsp;<span class="ident" id="3397140">fd</span><span class="op" id="3397142">.</span><span class="ident" id="3397143">decref</span><span class="op" id="3397149">(</span><span class="op" id="3397150">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397153">return</span>&nbsp;<span class="ident" id="3397160">os</span><span class="op" id="3397162">.</span><span class="ident" id="3397163">NewSyscallError</span><span class="op" id="3397178">(</span><span class="string" id="3397179">&#34;setsockopt&#34;</span><span class="op" id="3397191">,</span>&nbsp;<span class="ident" id="3397193">syscall</span><span class="op" id="3397200">.</span><span class="ident" id="3397201">SetsockoptInt</span><span class="op" id="3397214">(</span><span class="ident" id="3397215">fd</span><span class="op" id="3397217">.</span><span class="ident" id="3397218">sysfd</span><span class="op" id="3397223">,</span>&nbsp;<span class="ident" id="3397225">syscall</span><span class="op" id="3397232">.</span><span class="ident" id="3397233">IPPROTO_IPV6</span><span class="op" id="3397245">,</span>&nbsp;<span class="ident" id="3397247">syscall</span><span class="op" id="3397254">.</span><span class="ident" id="3397255">IPV6_MULTICAST_IF</span><span class="op" id="3397272">,</span>&nbsp;<span class="ident" id="3397274">v</span><span class="op" id="3397275">)</span><span class="op" id="3397276">)</span><br>
<span class="lineno"></span><span class="op" id="3397278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3397281">func</span>&nbsp;<span class="ident" id="3397286">setIPv6MulticastLoopback</span><span class="op" id="3397310">(</span><span class="ident" id="3397311">fd</span>&nbsp;<span class="op" id="3397314">*</span><span class="ident" id="3397315">netFD</span><span class="op" id="3397320">,</span>&nbsp;<span class="ident" id="3397322">v</span>&nbsp;<span class="builtintype" id="3397324">bool</span><span class="op" id="3397328">)</span>&nbsp;<span class="builtintype" id="3397330">error</span>&nbsp;<span class="op" id="3397336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397339">if</span>&nbsp;<span class="ident" id="3397342">err</span>&nbsp;<span class="op" id="3397346">:=</span>&nbsp;<span class="ident" id="3397349">fd</span><span class="op" id="3397351">.</span><span class="ident" id="3397352">incref</span><span class="op" id="3397358">(</span><span class="op" id="3397359">)</span><span class="op" id="3397360">;</span>&nbsp;<span class="ident" id="3397362">err</span>&nbsp;<span class="op" id="3397366">!=</span>&nbsp;<span class="ident" id="3397369">nil</span>&nbsp;<span class="op" id="3397373">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397377">return</span>&nbsp;<span class="ident" id="3397384">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3397389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397392">defer</span>&nbsp;<span class="ident" id="3397398">fd</span><span class="op" id="3397400">.</span><span class="ident" id="3397401">decref</span><span class="op" id="3397407">(</span><span class="op" id="3397408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397411">return</span>&nbsp;<span class="ident" id="3397418">os</span><span class="op" id="3397420">.</span><span class="ident" id="3397421">NewSyscallError</span><span class="op" id="3397436">(</span><span class="string" id="3397437">&#34;setsockopt&#34;</span><span class="op" id="3397449">,</span>&nbsp;<span class="ident" id="3397451">syscall</span><span class="op" id="3397458">.</span><span class="ident" id="3397459">SetsockoptInt</span><span class="op" id="3397472">(</span><span class="ident" id="3397473">fd</span><span class="op" id="3397475">.</span><span class="ident" id="3397476">sysfd</span><span class="op" id="3397481">,</span>&nbsp;<span class="ident" id="3397483">syscall</span><span class="op" id="3397490">.</span><span class="ident" id="3397491">IPPROTO_IPV6</span><span class="op" id="3397503">,</span>&nbsp;<span class="ident" id="3397505">syscall</span><span class="op" id="3397512">.</span><span class="ident" id="3397513">IPV6_MULTICAST_LOOP</span><span class="op" id="3397532">,</span>&nbsp;<span class="ident" id="3397534">boolint</span><span class="op" id="3397541">(</span><span class="ident" id="3397542">v</span><span class="op" id="3397543">)</span><span class="op" id="3397544">)</span><span class="op" id="3397545">)</span><br>
<span class="lineno"></span><span class="op" id="3397547">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3397550">func</span>&nbsp;<span class="ident" id="3397555">joinIPv6Group</span><span class="op" id="3397568">(</span><span class="ident" id="3397569">fd</span>&nbsp;<span class="op" id="3397572">*</span><span class="ident" id="3397573">netFD</span><span class="op" id="3397578">,</span>&nbsp;<span class="ident" id="3397580">ifi</span>&nbsp;<span class="op" id="3397584">*</span><span class="ident" id="3397585">Interface</span><span class="op" id="3397594">,</span>&nbsp;<span class="ident" id="3397596">ip</span>&nbsp;<span class="ident" id="3397599">IP</span><span class="op" id="3397601">)</span>&nbsp;<span class="builtintype" id="3397603">error</span>&nbsp;<span class="op" id="3397609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397612">mreq</span>&nbsp;<span class="op" id="3397617">:=</span>&nbsp;<span class="op" id="3397620">&amp;</span><span class="ident" id="3397621">syscall</span><span class="op" id="3397628">.</span><span class="ident" id="3397629">IPv6Mreq</span><span class="op" id="3397637">{</span><span class="op" id="3397638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3397641">copy</span><span class="op" id="3397645">(</span><span class="ident" id="3397646">mreq</span><span class="op" id="3397650">.</span><span class="ident" id="3397651">Multiaddr</span><span class="op" id="3397660">[</span><span class="op" id="3397661">:</span><span class="op" id="3397662">]</span><span class="op" id="3397663">,</span>&nbsp;<span class="ident" id="3397665">ip</span><span class="op" id="3397667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397670">if</span>&nbsp;<span class="ident" id="3397673">ifi</span>&nbsp;<span class="op" id="3397677">!=</span>&nbsp;<span class="ident" id="3397680">nil</span>&nbsp;<span class="op" id="3397684">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397688">mreq</span><span class="op" id="3397692">.</span><span class="ident" id="3397693">Interface</span>&nbsp;<span class="op" id="3397703">=</span>&nbsp;<span class="builtintype" id="3397705">uint32</span><span class="op" id="3397711">(</span><span class="ident" id="3397712">ifi</span><span class="op" id="3397715">.</span><span class="ident" id="3397716">Index</span><span class="op" id="3397721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3397724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397727">if</span>&nbsp;<span class="ident" id="3397730">err</span>&nbsp;<span class="op" id="3397734">:=</span>&nbsp;<span class="ident" id="3397737">fd</span><span class="op" id="3397739">.</span><span class="ident" id="3397740">incref</span><span class="op" id="3397746">(</span><span class="op" id="3397747">)</span><span class="op" id="3397748">;</span>&nbsp;<span class="ident" id="3397750">err</span>&nbsp;<span class="op" id="3397754">!=</span>&nbsp;<span class="ident" id="3397757">nil</span>&nbsp;<span class="op" id="3397761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397765">return</span>&nbsp;<span class="ident" id="3397772">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3397777">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397780">defer</span>&nbsp;<span class="ident" id="3397786">fd</span><span class="op" id="3397788">.</span><span class="ident" id="3397789">decref</span><span class="op" id="3397795">(</span><span class="op" id="3397796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397799">return</span>&nbsp;<span class="ident" id="3397806">os</span><span class="op" id="3397808">.</span><span class="ident" id="3397809">NewSyscallError</span><span class="op" id="3397824">(</span><span class="string" id="3397825">&#34;setsockopt&#34;</span><span class="op" id="3397837">,</span>&nbsp;<span class="ident" id="3397839">syscall</span><span class="op" id="3397846">.</span><span class="ident" id="3397847">SetsockoptIPv6Mreq</span><span class="op" id="3397865">(</span><span class="ident" id="3397866">fd</span><span class="op" id="3397868">.</span><span class="ident" id="3397869">sysfd</span><span class="op" id="3397874">,</span>&nbsp;<span class="ident" id="3397876">syscall</span><span class="op" id="3397883">.</span><span class="ident" id="3397884">IPPROTO_IPV6</span><span class="op" id="3397896">,</span>&nbsp;<span class="ident" id="3397898">syscall</span><span class="op" id="3397905">.</span><span class="ident" id="3397906">IPV6_JOIN_GROUP</span><span class="op" id="3397921">,</span>&nbsp;<span class="ident" id="3397923">mreq</span><span class="op" id="3397927">)</span><span class="op" id="3397928">)</span><br>
<span class="lineno"></span><span class="op" id="3397930">}</span>
</div>
</body>
</html>
