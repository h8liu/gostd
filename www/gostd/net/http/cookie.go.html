<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2981025">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2981080">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2981134">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2981185">package</span>&nbsp;<span class="ident" id="2981193">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2981199">import</span>&nbsp;<span class="op" id="2981206">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2981209">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2981218">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2981225">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2981232">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2981239">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2981250">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2981261">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="2981268">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2981271">//&nbsp;This&nbsp;implementation&nbsp;is&nbsp;done&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265:</span><br>
<span class="lineno"></span><span class="comment" id="2981325">//</span><br>
<span class="lineno"></span><span class="comment" id="2981328">//&nbsp;&nbsp;&nbsp;&nbsp;http://tools.ietf.org/html/rfc6265</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="2981370">//&nbsp;A&nbsp;Cookie&nbsp;represents&nbsp;an&nbsp;HTTP&nbsp;cookie&nbsp;as&nbsp;sent&nbsp;in&nbsp;the&nbsp;Set-Cookie&nbsp;header&nbsp;of&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2981447">//&nbsp;HTTP&nbsp;response&nbsp;or&nbsp;the&nbsp;Cookie&nbsp;header&nbsp;of&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="2981505">type</span>&nbsp;<span class="ident" id="2981510">Cookie</span>&nbsp;<span class="keyword" id="2981517">struct</span>&nbsp;<span class="op" id="2981524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981527">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2981538">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981546">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2981557">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981565">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2981576">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981584">Domain</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2981595">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981603">Expires</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2981614">time</span><span class="op" id="2981618">.</span><span class="ident" id="2981619">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981625">RawExpires</span>&nbsp;<span class="builtintype" id="2981636">string</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2981645">//&nbsp;MaxAge=0&nbsp;means&nbsp;no&nbsp;&#39;Max-Age&#39;&nbsp;attribute&nbsp;specified.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2981698">//&nbsp;MaxAge&lt;0&nbsp;means&nbsp;delete&nbsp;cookie&nbsp;now,&nbsp;equivalently&nbsp;&#39;Max-Age:&nbsp;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2981762">//&nbsp;MaxAge&gt;0&nbsp;means&nbsp;Max-Age&nbsp;attribute&nbsp;present&nbsp;and&nbsp;given&nbsp;in&nbsp;seconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981828">MaxAge</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2981837">int</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981842">Secure</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2981851">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981857">HttpOnly</span>&nbsp;<span class="builtintype" id="2981866">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981872">Raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2981881">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2981889">Unparsed</span>&nbsp;<span class="op" id="2981898">[</span><span class="op" id="2981899">]</span><span class="builtintype" id="2981900">string</span>&nbsp;<span class="comment" id="2981907">//&nbsp;Raw&nbsp;text&nbsp;of&nbsp;unparsed&nbsp;attribute-value&nbsp;pairs</span><br>
<span class="lineno"></span><span class="op" id="2981953">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="2981956">//&nbsp;readSetCookies&nbsp;parses&nbsp;all&nbsp;&#34;Set-Cookie&#34;&nbsp;values&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="2982010">//&nbsp;the&nbsp;header&nbsp;h&nbsp;and&nbsp;returns&nbsp;the&nbsp;successfully&nbsp;parsed&nbsp;Cookies.</span><br>
<span class="lineno"></span><span class="keyword" id="2982071">func</span>&nbsp;<span class="ident" id="2982076">readSetCookies</span><span class="op" id="2982090">(</span><span class="ident" id="2982091">h</span>&nbsp;<span class="ident" id="2982093">Header</span><span class="op" id="2982099">)</span>&nbsp;<span class="op" id="2982101">[</span><span class="op" id="2982102">]</span><span class="op" id="2982103">*</span><span class="ident" id="2982104">Cookie</span>&nbsp;<span class="op" id="2982111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982114">cookies</span>&nbsp;<span class="op" id="2982122">:=</span>&nbsp;<span class="op" id="2982125">[</span><span class="op" id="2982126">]</span><span class="op" id="2982127">*</span><span class="ident" id="2982128">Cookie</span><span class="op" id="2982134">{</span><span class="op" id="2982135">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982138">for</span>&nbsp;<span class="ident" id="2982142">_</span><span class="op" id="2982143">,</span>&nbsp;<span class="ident" id="2982145">line</span>&nbsp;<span class="op" id="2982150">:=</span>&nbsp;<span class="keyword" id="2982153">range</span>&nbsp;<span class="ident" id="2982159">h</span><span class="op" id="2982160">[</span><span class="string" id="2982161">&#34;Set-Cookie&#34;</span><span class="op" id="2982173">]</span>&nbsp;<span class="op" id="2982175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982179">parts</span>&nbsp;<span class="op" id="2982185">:=</span>&nbsp;<span class="ident" id="2982188">strings</span><span class="op" id="2982195">.</span><span class="ident" id="2982196">Split</span><span class="op" id="2982201">(</span><span class="ident" id="2982202">strings</span><span class="op" id="2982209">.</span><span class="ident" id="2982210">TrimSpace</span><span class="op" id="2982219">(</span><span class="ident" id="2982220">line</span><span class="op" id="2982224">)</span><span class="op" id="2982225">,</span>&nbsp;<span class="string" id="2982227">&#34;;&#34;</span><span class="op" id="2982230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982234">if</span>&nbsp;<span class="builtinfunc" id="2982237">len</span><span class="op" id="2982240">(</span><span class="ident" id="2982241">parts</span><span class="op" id="2982246">)</span>&nbsp;<span class="op" id="2982248">==</span>&nbsp;<span class="num" id="2982251">1</span>&nbsp;<span class="op" id="2982253">&amp;&amp;</span>&nbsp;<span class="ident" id="2982256">parts</span><span class="op" id="2982261">[</span><span class="num" id="2982262">0</span><span class="op" id="2982263">]</span>&nbsp;<span class="op" id="2982265">==</span>&nbsp;<span class="string" id="2982268">&#34;&#34;</span>&nbsp;<span class="op" id="2982271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982276">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2982287">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982291">parts</span><span class="op" id="2982296">[</span><span class="num" id="2982297">0</span><span class="op" id="2982298">]</span>&nbsp;<span class="op" id="2982300">=</span>&nbsp;<span class="ident" id="2982302">strings</span><span class="op" id="2982309">.</span><span class="ident" id="2982310">TrimSpace</span><span class="op" id="2982319">(</span><span class="ident" id="2982320">parts</span><span class="op" id="2982325">[</span><span class="num" id="2982326">0</span><span class="op" id="2982327">]</span><span class="op" id="2982328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982332">j</span>&nbsp;<span class="op" id="2982334">:=</span>&nbsp;<span class="ident" id="2982337">strings</span><span class="op" id="2982344">.</span><span class="ident" id="2982345">Index</span><span class="op" id="2982350">(</span><span class="ident" id="2982351">parts</span><span class="op" id="2982356">[</span><span class="num" id="2982357">0</span><span class="op" id="2982358">]</span><span class="op" id="2982359">,</span>&nbsp;<span class="string" id="2982361">&#34;=&#34;</span><span class="op" id="2982364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982368">if</span>&nbsp;<span class="ident" id="2982371">j</span>&nbsp;<span class="op" id="2982373">&lt;</span>&nbsp;<span class="num" id="2982375">0</span>&nbsp;<span class="op" id="2982377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982382">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2982393">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982397">name</span><span class="op" id="2982401">,</span>&nbsp;<span class="ident" id="2982403">value</span>&nbsp;<span class="op" id="2982409">:=</span>&nbsp;<span class="ident" id="2982412">parts</span><span class="op" id="2982417">[</span><span class="num" id="2982418">0</span><span class="op" id="2982419">]</span><span class="op" id="2982420">[</span><span class="op" id="2982421">:</span><span class="ident" id="2982422">j</span><span class="op" id="2982423">]</span><span class="op" id="2982424">,</span>&nbsp;<span class="ident" id="2982426">parts</span><span class="op" id="2982431">[</span><span class="num" id="2982432">0</span><span class="op" id="2982433">]</span><span class="op" id="2982434">[</span><span class="ident" id="2982435">j</span><span class="op" id="2982436">+</span><span class="num" id="2982437">1</span><span class="op" id="2982438">:</span><span class="op" id="2982439">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982443">if</span>&nbsp;<span class="op" id="2982446">!</span><span class="ident" id="2982447">isCookieNameValid</span><span class="op" id="2982464">(</span><span class="ident" id="2982465">name</span><span class="op" id="2982469">)</span>&nbsp;<span class="op" id="2982471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982476">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2982487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982491">value</span><span class="op" id="2982496">,</span>&nbsp;<span class="ident" id="2982498">success</span>&nbsp;<span class="op" id="2982506">:=</span>&nbsp;<span class="ident" id="2982509">parseCookieValue</span><span class="op" id="2982525">(</span><span class="ident" id="2982526">value</span><span class="op" id="2982531">,</span>&nbsp;<span class="builtintype" id="2982533">true</span><span class="op" id="2982537">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982541">if</span>&nbsp;<span class="op" id="2982544">!</span><span class="ident" id="2982545">success</span>&nbsp;<span class="op" id="2982553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982558">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2982569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982573">c</span>&nbsp;<span class="op" id="2982575">:=</span>&nbsp;<span class="op" id="2982578">&amp;</span><span class="ident" id="2982579">Cookie</span><span class="op" id="2982585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982590">Name</span><span class="op" id="2982594">:</span>&nbsp;&nbsp;<span class="ident" id="2982597">name</span><span class="op" id="2982601">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982606">Value</span><span class="op" id="2982611">:</span>&nbsp;<span class="ident" id="2982613">value</span><span class="op" id="2982618">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982623">Raw</span><span class="op" id="2982626">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2982630">line</span><span class="op" id="2982634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2982638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982642">for</span>&nbsp;<span class="ident" id="2982646">i</span>&nbsp;<span class="op" id="2982648">:=</span>&nbsp;<span class="num" id="2982651">1</span><span class="op" id="2982652">;</span>&nbsp;<span class="ident" id="2982654">i</span>&nbsp;<span class="op" id="2982656">&lt;</span>&nbsp;<span class="builtinfunc" id="2982658">len</span><span class="op" id="2982661">(</span><span class="ident" id="2982662">parts</span><span class="op" id="2982667">)</span><span class="op" id="2982668">;</span>&nbsp;<span class="ident" id="2982670">i</span><span class="op" id="2982671">++</span>&nbsp;<span class="op" id="2982674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982679">parts</span><span class="op" id="2982684">[</span><span class="ident" id="2982685">i</span><span class="op" id="2982686">]</span>&nbsp;<span class="op" id="2982688">=</span>&nbsp;<span class="ident" id="2982690">strings</span><span class="op" id="2982697">.</span><span class="ident" id="2982698">TrimSpace</span><span class="op" id="2982707">(</span><span class="ident" id="2982708">parts</span><span class="op" id="2982713">[</span><span class="ident" id="2982714">i</span><span class="op" id="2982715">]</span><span class="op" id="2982716">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982721">if</span>&nbsp;<span class="builtinfunc" id="2982724">len</span><span class="op" id="2982727">(</span><span class="ident" id="2982728">parts</span><span class="op" id="2982733">[</span><span class="ident" id="2982734">i</span><span class="op" id="2982735">]</span><span class="op" id="2982736">)</span>&nbsp;<span class="op" id="2982738">==</span>&nbsp;<span class="num" id="2982741">0</span>&nbsp;<span class="op" id="2982743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982749">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2982761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982767">attr</span><span class="op" id="2982771">,</span>&nbsp;<span class="ident" id="2982773">val</span>&nbsp;<span class="op" id="2982777">:=</span>&nbsp;<span class="ident" id="2982780">parts</span><span class="op" id="2982785">[</span><span class="ident" id="2982786">i</span><span class="op" id="2982787">]</span><span class="op" id="2982788">,</span>&nbsp;<span class="string" id="2982790">&#34;&#34;</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982796">if</span>&nbsp;<span class="ident" id="2982799">j</span>&nbsp;<span class="op" id="2982801">:=</span>&nbsp;<span class="ident" id="2982804">strings</span><span class="op" id="2982811">.</span><span class="ident" id="2982812">Index</span><span class="op" id="2982817">(</span><span class="ident" id="2982818">attr</span><span class="op" id="2982822">,</span>&nbsp;<span class="string" id="2982824">&#34;=&#34;</span><span class="op" id="2982827">)</span><span class="op" id="2982828">;</span>&nbsp;<span class="ident" id="2982830">j</span>&nbsp;<span class="op" id="2982832">&gt;=</span>&nbsp;<span class="num" id="2982835">0</span>&nbsp;<span class="op" id="2982837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982843">attr</span><span class="op" id="2982847">,</span>&nbsp;<span class="ident" id="2982849">val</span>&nbsp;<span class="op" id="2982853">=</span>&nbsp;<span class="ident" id="2982855">attr</span><span class="op" id="2982859">[</span><span class="op" id="2982860">:</span><span class="ident" id="2982861">j</span><span class="op" id="2982862">]</span><span class="op" id="2982863">,</span>&nbsp;<span class="ident" id="2982865">attr</span><span class="op" id="2982869">[</span><span class="ident" id="2982870">j</span><span class="op" id="2982871">+</span><span class="num" id="2982872">1</span><span class="op" id="2982873">:</span><span class="op" id="2982874">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2982879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982884">lowerAttr</span>&nbsp;<span class="op" id="2982894">:=</span>&nbsp;<span class="ident" id="2982897">strings</span><span class="op" id="2982904">.</span><span class="ident" id="2982905">ToLower</span><span class="op" id="2982912">(</span><span class="ident" id="2982913">attr</span><span class="op" id="2982917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982922">val</span><span class="op" id="2982925">,</span>&nbsp;<span class="ident" id="2982927">success</span>&nbsp;<span class="op" id="2982935">=</span>&nbsp;<span class="ident" id="2982937">parseCookieValue</span><span class="op" id="2982953">(</span><span class="ident" id="2982954">val</span><span class="op" id="2982957">,</span>&nbsp;<span class="builtintype" id="2982959">false</span><span class="op" id="2982964">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2982969">if</span>&nbsp;<span class="op" id="2982972">!</span><span class="ident" id="2982973">success</span>&nbsp;<span class="op" id="2982981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2982987">c</span><span class="op" id="2982988">.</span><span class="ident" id="2982989">Unparsed</span>&nbsp;<span class="op" id="2982998">=</span>&nbsp;<span class="builtinfunc" id="2983000">append</span><span class="op" id="2983006">(</span><span class="ident" id="2983007">c</span><span class="op" id="2983008">.</span><span class="ident" id="2983009">Unparsed</span><span class="op" id="2983017">,</span>&nbsp;<span class="ident" id="2983019">parts</span><span class="op" id="2983024">[</span><span class="ident" id="2983025">i</span><span class="op" id="2983026">]</span><span class="op" id="2983027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983033">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983050">switch</span>&nbsp;<span class="ident" id="2983057">lowerAttr</span>&nbsp;<span class="op" id="2983067">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983072">case</span>&nbsp;<span class="string" id="2983077">&#34;secure&#34;</span><span class="op" id="2983085">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983091">c</span><span class="op" id="2983092">.</span><span class="ident" id="2983093">Secure</span>&nbsp;<span class="op" id="2983100">=</span>&nbsp;<span class="builtintype" id="2983102">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983111">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983123">case</span>&nbsp;<span class="string" id="2983128">&#34;httponly&#34;</span><span class="op" id="2983138">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983144">c</span><span class="op" id="2983145">.</span><span class="ident" id="2983146">HttpOnly</span>&nbsp;<span class="op" id="2983155">=</span>&nbsp;<span class="builtintype" id="2983157">true</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983166">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983178">case</span>&nbsp;<span class="string" id="2983183">&#34;domain&#34;</span><span class="op" id="2983191">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983197">c</span><span class="op" id="2983198">.</span><span class="ident" id="2983199">Domain</span>&nbsp;<span class="op" id="2983206">=</span>&nbsp;<span class="ident" id="2983208">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983216">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983228">case</span>&nbsp;<span class="string" id="2983233">&#34;max-age&#34;</span><span class="op" id="2983242">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983248">secs</span><span class="op" id="2983252">,</span>&nbsp;<span class="ident" id="2983254">err</span>&nbsp;<span class="op" id="2983258">:=</span>&nbsp;<span class="ident" id="2983261">strconv</span><span class="op" id="2983268">.</span><span class="ident" id="2983269">Atoi</span><span class="op" id="2983273">(</span><span class="ident" id="2983274">val</span><span class="op" id="2983277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983283">if</span>&nbsp;<span class="ident" id="2983286">err</span>&nbsp;<span class="op" id="2983290">!=</span>&nbsp;<span class="ident" id="2983293">nil</span>&nbsp;<span class="op" id="2983297">||</span>&nbsp;<span class="ident" id="2983300">secs</span>&nbsp;<span class="op" id="2983305">!=</span>&nbsp;<span class="num" id="2983308">0</span>&nbsp;<span class="op" id="2983310">&amp;&amp;</span>&nbsp;<span class="ident" id="2983313">val</span><span class="op" id="2983316">[</span><span class="num" id="2983317">0</span><span class="op" id="2983318">]</span>&nbsp;<span class="op" id="2983320">==</span>&nbsp;<span class="string" id="2983323">&#39;0&#39;</span>&nbsp;<span class="op" id="2983327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983334">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983350">if</span>&nbsp;<span class="ident" id="2983353">secs</span>&nbsp;<span class="op" id="2983358">&lt;=</span>&nbsp;<span class="num" id="2983361">0</span>&nbsp;<span class="op" id="2983363">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983370">c</span><span class="op" id="2983371">.</span><span class="ident" id="2983372">MaxAge</span>&nbsp;<span class="op" id="2983379">=</span>&nbsp;<span class="op" id="2983381">-</span><span class="num" id="2983382">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983388">}</span>&nbsp;<span class="keyword" id="2983390">else</span>&nbsp;<span class="op" id="2983395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983402">c</span><span class="op" id="2983403">.</span><span class="ident" id="2983404">MaxAge</span>&nbsp;<span class="op" id="2983411">=</span>&nbsp;<span class="ident" id="2983413">secs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983428">continue</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983440">case</span>&nbsp;<span class="string" id="2983445">&#34;expires&#34;</span><span class="op" id="2983454">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983460">c</span><span class="op" id="2983461">.</span><span class="ident" id="2983462">RawExpires</span>&nbsp;<span class="op" id="2983473">=</span>&nbsp;<span class="ident" id="2983475">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983483">exptime</span><span class="op" id="2983490">,</span>&nbsp;<span class="ident" id="2983492">err</span>&nbsp;<span class="op" id="2983496">:=</span>&nbsp;<span class="ident" id="2983499">time</span><span class="op" id="2983503">.</span><span class="ident" id="2983504">Parse</span><span class="op" id="2983509">(</span><span class="ident" id="2983510">time</span><span class="op" id="2983514">.</span><span class="ident" id="2983515">RFC1123</span><span class="op" id="2983522">,</span>&nbsp;<span class="ident" id="2983524">val</span><span class="op" id="2983527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983533">if</span>&nbsp;<span class="ident" id="2983536">err</span>&nbsp;<span class="op" id="2983540">!=</span>&nbsp;<span class="ident" id="2983543">nil</span>&nbsp;<span class="op" id="2983547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983554">exptime</span><span class="op" id="2983561">,</span>&nbsp;<span class="ident" id="2983563">err</span>&nbsp;<span class="op" id="2983567">=</span>&nbsp;<span class="ident" id="2983569">time</span><span class="op" id="2983573">.</span><span class="ident" id="2983574">Parse</span><span class="op" id="2983579">(</span><span class="string" id="2983580">&#34;Mon,&nbsp;02-Jan-2006&nbsp;15:04:05&nbsp;MST&#34;</span><span class="op" id="2983611">,</span>&nbsp;<span class="ident" id="2983613">val</span><span class="op" id="2983616">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983623">if</span>&nbsp;<span class="ident" id="2983626">err</span>&nbsp;<span class="op" id="2983630">!=</span>&nbsp;<span class="ident" id="2983633">nil</span>&nbsp;<span class="op" id="2983637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983645">c</span><span class="op" id="2983646">.</span><span class="ident" id="2983647">Expires</span>&nbsp;<span class="op" id="2983655">=</span>&nbsp;<span class="ident" id="2983657">time</span><span class="op" id="2983661">.</span><span class="ident" id="2983662">Time</span><span class="op" id="2983666">{</span><span class="op" id="2983667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983675">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983692">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983698">c</span><span class="op" id="2983699">.</span><span class="ident" id="2983700">Expires</span>&nbsp;<span class="op" id="2983708">=</span>&nbsp;<span class="ident" id="2983710">exptime</span><span class="op" id="2983717">.</span><span class="ident" id="2983718">UTC</span><span class="op" id="2983721">(</span><span class="op" id="2983722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983728">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983740">case</span>&nbsp;<span class="string" id="2983745">&#34;path&#34;</span><span class="op" id="2983751">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983757">c</span><span class="op" id="2983758">.</span><span class="ident" id="2983759">Path</span>&nbsp;<span class="op" id="2983764">=</span>&nbsp;<span class="ident" id="2983766">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983774">continue</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983791">c</span><span class="op" id="2983792">.</span><span class="ident" id="2983793">Unparsed</span>&nbsp;<span class="op" id="2983802">=</span>&nbsp;<span class="builtinfunc" id="2983804">append</span><span class="op" id="2983810">(</span><span class="ident" id="2983811">c</span><span class="op" id="2983812">.</span><span class="ident" id="2983813">Unparsed</span><span class="op" id="2983821">,</span>&nbsp;<span class="ident" id="2983823">parts</span><span class="op" id="2983828">[</span><span class="ident" id="2983829">i</span><span class="op" id="2983830">]</span><span class="op" id="2983831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2983839">cookies</span>&nbsp;<span class="op" id="2983847">=</span>&nbsp;<span class="builtinfunc" id="2983849">append</span><span class="op" id="2983855">(</span><span class="ident" id="2983856">cookies</span><span class="op" id="2983863">,</span>&nbsp;<span class="ident" id="2983865">c</span><span class="op" id="2983866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2983869">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2983872">return</span>&nbsp;<span class="ident" id="2983879">cookies</span><br>
<span class="lineno"></span><span class="op" id="2983887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2983890">//&nbsp;SetCookie&nbsp;adds&nbsp;a&nbsp;Set-Cookie&nbsp;header&nbsp;to&nbsp;the&nbsp;provided&nbsp;ResponseWriter&#39;s&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="2983970">func</span>&nbsp;<span class="ident" id="2983975">SetCookie</span><span class="op" id="2983984">(</span><span class="ident" id="2983985">w</span>&nbsp;<span class="ident" id="2983987">ResponseWriter</span><span class="op" id="2984001">,</span>&nbsp;<span class="ident" id="2984003">cookie</span>&nbsp;<span class="op" id="2984010">*</span><span class="ident" id="2984011">Cookie</span><span class="op" id="2984017">)</span>&nbsp;<span class="op" id="2984019">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2984022">w</span><span class="op" id="2984023">.</span><span class="ident" id="2984024">Header</span><span class="op" id="2984030">(</span><span class="op" id="2984031">)</span><span class="op" id="2984032">.</span><span class="ident" id="2984033">Add</span><span class="op" id="2984036">(</span><span class="string" id="2984037">&#34;Set-Cookie&#34;</span><span class="op" id="2984049">,</span>&nbsp;<span class="ident" id="2984051">cookie</span><span class="op" id="2984057">.</span><span class="ident" id="2984058">String</span><span class="op" id="2984064">(</span><span class="op" id="2984065">)</span><span class="op" id="2984066">)</span><br>
<span class="lineno"></span><span class="op" id="2984068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2984071">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;serialization&nbsp;of&nbsp;the&nbsp;cookie&nbsp;for&nbsp;use&nbsp;in&nbsp;a&nbsp;Cookie</span><br>
<span class="lineno"></span><span class="comment" id="2984141">//&nbsp;header&nbsp;(if&nbsp;only&nbsp;Name&nbsp;and&nbsp;Value&nbsp;are&nbsp;set)&nbsp;or&nbsp;a&nbsp;Set-Cookie&nbsp;response</span><br>
<span class="lineno">135</span><span class="comment" id="2984209">//&nbsp;header&nbsp;(if&nbsp;other&nbsp;fields&nbsp;are&nbsp;set).</span><br>
<span class="lineno"></span><span class="keyword" id="2984246">func</span>&nbsp;<span class="op" id="2984251">(</span><span class="ident" id="2984252">c</span>&nbsp;<span class="op" id="2984254">*</span><span class="ident" id="2984255">Cookie</span><span class="op" id="2984261">)</span>&nbsp;<span class="ident" id="2984263">String</span><span class="op" id="2984269">(</span><span class="op" id="2984270">)</span>&nbsp;<span class="builtintype" id="2984272">string</span>&nbsp;<span class="op" id="2984279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2984282">var</span>&nbsp;<span class="ident" id="2984286">b</span>&nbsp;<span class="ident" id="2984288">bytes</span><span class="op" id="2984293">.</span><span class="ident" id="2984294">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2984302">fmt</span><span class="op" id="2984305">.</span><span class="ident" id="2984306">Fprintf</span><span class="op" id="2984313">(</span><span class="op" id="2984314">&amp;</span><span class="ident" id="2984315">b</span><span class="op" id="2984316">,</span>&nbsp;<span class="string" id="2984318">&#34;%s=%s&#34;</span><span class="op" id="2984325">,</span>&nbsp;<span class="ident" id="2984327">sanitizeCookieName</span><span class="op" id="2984345">(</span><span class="ident" id="2984346">c</span><span class="op" id="2984347">.</span><span class="ident" id="2984348">Name</span><span class="op" id="2984352">)</span><span class="op" id="2984353">,</span>&nbsp;<span class="ident" id="2984355">sanitizeCookieValue</span><span class="op" id="2984374">(</span><span class="ident" id="2984375">c</span><span class="op" id="2984376">.</span><span class="ident" id="2984377">Value</span><span class="op" id="2984382">)</span><span class="op" id="2984383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2984386">if</span>&nbsp;<span class="builtinfunc" id="2984389">len</span><span class="op" id="2984392">(</span><span class="ident" id="2984393">c</span><span class="op" id="2984394">.</span><span class="ident" id="2984395">Path</span><span class="op" id="2984399">)</span>&nbsp;<span class="op" id="2984401">&gt;</span>&nbsp;<span class="num" id="2984403">0</span>&nbsp;<span class="op" id="2984405">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2984409">fmt</span><span class="op" id="2984412">.</span><span class="ident" id="2984413">Fprintf</span><span class="op" id="2984420">(</span><span class="op" id="2984421">&amp;</span><span class="ident" id="2984422">b</span><span class="op" id="2984423">,</span>&nbsp;<span class="string" id="2984425">&#34;;&nbsp;Path=%s&#34;</span><span class="op" id="2984436">,</span>&nbsp;<span class="ident" id="2984438">sanitizeCookiePath</span><span class="op" id="2984456">(</span><span class="ident" id="2984457">c</span><span class="op" id="2984458">.</span><span class="ident" id="2984459">Path</span><span class="op" id="2984463">)</span><span class="op" id="2984464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2984467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2984470">if</span>&nbsp;<span class="builtinfunc" id="2984473">len</span><span class="op" id="2984476">(</span><span class="ident" id="2984477">c</span><span class="op" id="2984478">.</span><span class="ident" id="2984479">Domain</span><span class="op" id="2984485">)</span>&nbsp;<span class="op" id="2984487">&gt;</span>&nbsp;<span class="num" id="2984489">0</span>&nbsp;<span class="op" id="2984491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2984495">if</span>&nbsp;<span class="ident" id="2984498">validCookieDomain</span><span class="op" id="2984515">(</span><span class="ident" id="2984516">c</span><span class="op" id="2984517">.</span><span class="ident" id="2984518">Domain</span><span class="op" id="2984524">)</span>&nbsp;<span class="op" id="2984526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2984531">//&nbsp;A&nbsp;c.Domain&nbsp;containing&nbsp;illegal&nbsp;characters&nbsp;is&nbsp;not</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2984585">//&nbsp;sanitized&nbsp;but&nbsp;simply&nbsp;dropped&nbsp;which&nbsp;turns&nbsp;the&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2984643">//&nbsp;into&nbsp;a&nbsp;host-only&nbsp;cookie.&nbsp;A&nbsp;leading&nbsp;dot&nbsp;is&nbsp;okay</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2984696">//&nbsp;but&nbsp;won&#39;t&nbsp;be&nbsp;sent.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2984721">d</span>&nbsp;<span class="op" id="2984723">:=</span>&nbsp;<span class="ident" id="2984726">c</span><span class="op" id="2984727">.</span><span class="ident" id="2984728">Domain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2984738">if</span>&nbsp;<span class="ident" id="2984741">d</span><span class="op" id="2984742">[</span><span class="num" id="2984743">0</span><span class="op" id="2984744">]</span>&nbsp;<span class="op" id="2984746">==</span>&nbsp;<span class="string" id="2984749">&#39;.&#39;</span>&nbsp;<span class="op" id="2984753">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2984759">d</span>&nbsp;<span class="op" id="2984761">=</span>&nbsp;<span class="ident" id="2984763">d</span><span class="op" id="2984764">[</span><span class="num" id="2984765">1</span><span class="op" id="2984766">:</span><span class="op" id="2984767">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2984772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2984777">fmt</span><span class="op" id="2984780">.</span><span class="ident" id="2984781">Fprintf</span><span class="op" id="2984788">(</span><span class="op" id="2984789">&amp;</span><span class="ident" id="2984790">b</span><span class="op" id="2984791">,</span>&nbsp;<span class="string" id="2984793">&#34;;&nbsp;Domain=%s&#34;</span><span class="op" id="2984806">,</span>&nbsp;<span class="ident" id="2984808">d</span><span class="op" id="2984809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2984813">}</span>&nbsp;<span class="keyword" id="2984815">else</span>&nbsp;<span class="op" id="2984820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2984825">log</span><span class="op" id="2984828">.</span><span class="ident" id="2984829">Printf</span><span class="op" id="2984835">(</span><span class="string" id="2984836">&#34;net/http:&nbsp;invalid&nbsp;Cookie.Domain&nbsp;%q;&nbsp;dropping&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="2984899">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2984905">c</span><span class="op" id="2984906">.</span><span class="ident" id="2984907">Domain</span><span class="op" id="2984913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2984917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2984920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2984923">if</span>&nbsp;<span class="ident" id="2984926">c</span><span class="op" id="2984927">.</span><span class="ident" id="2984928">Expires</span><span class="op" id="2984935">.</span><span class="ident" id="2984936">Unix</span><span class="op" id="2984940">(</span><span class="op" id="2984941">)</span>&nbsp;<span class="op" id="2984943">&gt;</span>&nbsp;<span class="num" id="2984945">0</span>&nbsp;<span class="op" id="2984947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2984951">fmt</span><span class="op" id="2984954">.</span><span class="ident" id="2984955">Fprintf</span><span class="op" id="2984962">(</span><span class="op" id="2984963">&amp;</span><span class="ident" id="2984964">b</span><span class="op" id="2984965">,</span>&nbsp;<span class="string" id="2984967">&#34;;&nbsp;Expires=%s&#34;</span><span class="op" id="2984981">,</span>&nbsp;<span class="ident" id="2984983">c</span><span class="op" id="2984984">.</span><span class="ident" id="2984985">Expires</span><span class="op" id="2984992">.</span><span class="ident" id="2984993">UTC</span><span class="op" id="2984996">(</span><span class="op" id="2984997">)</span><span class="op" id="2984998">.</span><span class="ident" id="2984999">Format</span><span class="op" id="2985005">(</span><span class="ident" id="2985006">time</span><span class="op" id="2985010">.</span><span class="ident" id="2985011">RFC1123</span><span class="op" id="2985018">)</span><span class="op" id="2985019">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2985022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985025">if</span>&nbsp;<span class="ident" id="2985028">c</span><span class="op" id="2985029">.</span><span class="ident" id="2985030">MaxAge</span>&nbsp;<span class="op" id="2985037">&gt;</span>&nbsp;<span class="num" id="2985039">0</span>&nbsp;<span class="op" id="2985041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2985045">fmt</span><span class="op" id="2985048">.</span><span class="ident" id="2985049">Fprintf</span><span class="op" id="2985056">(</span><span class="op" id="2985057">&amp;</span><span class="ident" id="2985058">b</span><span class="op" id="2985059">,</span>&nbsp;<span class="string" id="2985061">&#34;;&nbsp;Max-Age=%d&#34;</span><span class="op" id="2985075">,</span>&nbsp;<span class="ident" id="2985077">c</span><span class="op" id="2985078">.</span><span class="ident" id="2985079">MaxAge</span><span class="op" id="2985085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2985088">}</span>&nbsp;<span class="keyword" id="2985090">else</span>&nbsp;<span class="keyword" id="2985095">if</span>&nbsp;<span class="ident" id="2985098">c</span><span class="op" id="2985099">.</span><span class="ident" id="2985100">MaxAge</span>&nbsp;<span class="op" id="2985107">&lt;</span>&nbsp;<span class="num" id="2985109">0</span>&nbsp;<span class="op" id="2985111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2985115">fmt</span><span class="op" id="2985118">.</span><span class="ident" id="2985119">Fprintf</span><span class="op" id="2985126">(</span><span class="op" id="2985127">&amp;</span><span class="ident" id="2985128">b</span><span class="op" id="2985129">,</span>&nbsp;<span class="string" id="2985131">&#34;;&nbsp;Max-Age=0&#34;</span><span class="op" id="2985144">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2985147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985150">if</span>&nbsp;<span class="ident" id="2985153">c</span><span class="op" id="2985154">.</span><span class="ident" id="2985155">HttpOnly</span>&nbsp;<span class="op" id="2985164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2985168">fmt</span><span class="op" id="2985171">.</span><span class="ident" id="2985172">Fprintf</span><span class="op" id="2985179">(</span><span class="op" id="2985180">&amp;</span><span class="ident" id="2985181">b</span><span class="op" id="2985182">,</span>&nbsp;<span class="string" id="2985184">&#34;;&nbsp;HttpOnly&#34;</span><span class="op" id="2985196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2985199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985202">if</span>&nbsp;<span class="ident" id="2985205">c</span><span class="op" id="2985206">.</span><span class="ident" id="2985207">Secure</span>&nbsp;<span class="op" id="2985214">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2985218">fmt</span><span class="op" id="2985221">.</span><span class="ident" id="2985222">Fprintf</span><span class="op" id="2985229">(</span><span class="op" id="2985230">&amp;</span><span class="ident" id="2985231">b</span><span class="op" id="2985232">,</span>&nbsp;<span class="string" id="2985234">&#34;;&nbsp;Secure&#34;</span><span class="op" id="2985244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2985247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985250">return</span>&nbsp;<span class="ident" id="2985257">b</span><span class="op" id="2985258">.</span><span class="ident" id="2985259">String</span><span class="op" id="2985265">(</span><span class="op" id="2985266">)</span><br>
<span class="lineno"></span><span class="op" id="2985268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="2985271">//&nbsp;readCookies&nbsp;parses&nbsp;all&nbsp;&#34;Cookie&#34;&nbsp;values&nbsp;from&nbsp;the&nbsp;header&nbsp;h&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2985335">//&nbsp;returns&nbsp;the&nbsp;successfully&nbsp;parsed&nbsp;Cookies.</span><br>
<span class="lineno"></span><span class="comment" id="2985379">//</span><br>
<span class="lineno"></span><span class="comment" id="2985382">//&nbsp;if&nbsp;filter&nbsp;isn&#39;t&nbsp;empty,&nbsp;only&nbsp;cookies&nbsp;of&nbsp;that&nbsp;name&nbsp;are&nbsp;returned</span><br>
<span class="lineno"></span><span class="keyword" id="2985447">func</span>&nbsp;<span class="ident" id="2985452">readCookies</span><span class="op" id="2985463">(</span><span class="ident" id="2985464">h</span>&nbsp;<span class="ident" id="2985466">Header</span><span class="op" id="2985472">,</span>&nbsp;<span class="ident" id="2985474">filter</span>&nbsp;<span class="builtintype" id="2985481">string</span><span class="op" id="2985487">)</span>&nbsp;<span class="op" id="2985489">[</span><span class="op" id="2985490">]</span><span class="op" id="2985491">*</span><span class="ident" id="2985492">Cookie</span>&nbsp;<span class="op" id="2985499">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2985502">cookies</span>&nbsp;<span class="op" id="2985510">:=</span>&nbsp;<span class="op" id="2985513">[</span><span class="op" id="2985514">]</span><span class="op" id="2985515">*</span><span class="ident" id="2985516">Cookie</span><span class="op" id="2985522">{</span><span class="op" id="2985523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2985526">lines</span><span class="op" id="2985531">,</span>&nbsp;<span class="ident" id="2985533">ok</span>&nbsp;<span class="op" id="2985536">:=</span>&nbsp;<span class="ident" id="2985539">h</span><span class="op" id="2985540">[</span><span class="string" id="2985541">&#34;Cookie&#34;</span><span class="op" id="2985549">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985552">if</span>&nbsp;<span class="op" id="2985555">!</span><span class="ident" id="2985556">ok</span>&nbsp;<span class="op" id="2985559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985563">return</span>&nbsp;<span class="ident" id="2985570">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2985579">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985583">for</span>&nbsp;<span class="ident" id="2985587">_</span><span class="op" id="2985588">,</span>&nbsp;<span class="ident" id="2985590">line</span>&nbsp;<span class="op" id="2985595">:=</span>&nbsp;<span class="keyword" id="2985598">range</span>&nbsp;<span class="ident" id="2985604">lines</span>&nbsp;<span class="op" id="2985610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2985614">parts</span>&nbsp;<span class="op" id="2985620">:=</span>&nbsp;<span class="ident" id="2985623">strings</span><span class="op" id="2985630">.</span><span class="ident" id="2985631">Split</span><span class="op" id="2985636">(</span><span class="ident" id="2985637">strings</span><span class="op" id="2985644">.</span><span class="ident" id="2985645">TrimSpace</span><span class="op" id="2985654">(</span><span class="ident" id="2985655">line</span><span class="op" id="2985659">)</span><span class="op" id="2985660">,</span>&nbsp;<span class="string" id="2985662">&#34;;&#34;</span><span class="op" id="2985665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985669">if</span>&nbsp;<span class="builtinfunc" id="2985672">len</span><span class="op" id="2985675">(</span><span class="ident" id="2985676">parts</span><span class="op" id="2985681">)</span>&nbsp;<span class="op" id="2985683">==</span>&nbsp;<span class="num" id="2985686">1</span>&nbsp;<span class="op" id="2985688">&amp;&amp;</span>&nbsp;<span class="ident" id="2985691">parts</span><span class="op" id="2985696">[</span><span class="num" id="2985697">0</span><span class="op" id="2985698">]</span>&nbsp;<span class="op" id="2985700">==</span>&nbsp;<span class="string" id="2985703">&#34;&#34;</span>&nbsp;<span class="op" id="2985706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985711">continue</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2985722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2985726">//&nbsp;Per-line&nbsp;attributes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2985751">parsedPairs</span>&nbsp;<span class="op" id="2985763">:=</span>&nbsp;<span class="num" id="2985766">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985770">for</span>&nbsp;<span class="ident" id="2985774">i</span>&nbsp;<span class="op" id="2985776">:=</span>&nbsp;<span class="num" id="2985779">0</span><span class="op" id="2985780">;</span>&nbsp;<span class="ident" id="2985782">i</span>&nbsp;<span class="op" id="2985784">&lt;</span>&nbsp;<span class="builtinfunc" id="2985786">len</span><span class="op" id="2985789">(</span><span class="ident" id="2985790">parts</span><span class="op" id="2985795">)</span><span class="op" id="2985796">;</span>&nbsp;<span class="ident" id="2985798">i</span><span class="op" id="2985799">++</span>&nbsp;<span class="op" id="2985802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2985807">parts</span><span class="op" id="2985812">[</span><span class="ident" id="2985813">i</span><span class="op" id="2985814">]</span>&nbsp;<span class="op" id="2985816">=</span>&nbsp;<span class="ident" id="2985818">strings</span><span class="op" id="2985825">.</span><span class="ident" id="2985826">TrimSpace</span><span class="op" id="2985835">(</span><span class="ident" id="2985836">parts</span><span class="op" id="2985841">[</span><span class="ident" id="2985842">i</span><span class="op" id="2985843">]</span><span class="op" id="2985844">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985849">if</span>&nbsp;<span class="builtinfunc" id="2985852">len</span><span class="op" id="2985855">(</span><span class="ident" id="2985856">parts</span><span class="op" id="2985861">[</span><span class="ident" id="2985862">i</span><span class="op" id="2985863">]</span><span class="op" id="2985864">)</span>&nbsp;<span class="op" id="2985866">==</span>&nbsp;<span class="num" id="2985869">0</span>&nbsp;<span class="op" id="2985871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985877">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2985889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2985894">name</span><span class="op" id="2985898">,</span>&nbsp;<span class="ident" id="2985900">val</span>&nbsp;<span class="op" id="2985904">:=</span>&nbsp;<span class="ident" id="2985907">parts</span><span class="op" id="2985912">[</span><span class="ident" id="2985913">i</span><span class="op" id="2985914">]</span><span class="op" id="2985915">,</span>&nbsp;<span class="string" id="2985917">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2985923">if</span>&nbsp;<span class="ident" id="2985926">j</span>&nbsp;<span class="op" id="2985928">:=</span>&nbsp;<span class="ident" id="2985931">strings</span><span class="op" id="2985938">.</span><span class="ident" id="2985939">Index</span><span class="op" id="2985944">(</span><span class="ident" id="2985945">name</span><span class="op" id="2985949">,</span>&nbsp;<span class="string" id="2985951">&#34;=&#34;</span><span class="op" id="2985954">)</span><span class="op" id="2985955">;</span>&nbsp;<span class="ident" id="2985957">j</span>&nbsp;<span class="op" id="2985959">&gt;=</span>&nbsp;<span class="num" id="2985962">0</span>&nbsp;<span class="op" id="2985964">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2985970">name</span><span class="op" id="2985974">,</span>&nbsp;<span class="ident" id="2985976">val</span>&nbsp;<span class="op" id="2985980">=</span>&nbsp;<span class="ident" id="2985982">name</span><span class="op" id="2985986">[</span><span class="op" id="2985987">:</span><span class="ident" id="2985988">j</span><span class="op" id="2985989">]</span><span class="op" id="2985990">,</span>&nbsp;<span class="ident" id="2985992">name</span><span class="op" id="2985996">[</span><span class="ident" id="2985997">j</span><span class="op" id="2985998">+</span><span class="num" id="2985999">1</span><span class="op" id="2986000">:</span><span class="op" id="2986001">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2986006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986011">if</span>&nbsp;<span class="op" id="2986014">!</span><span class="ident" id="2986015">isCookieNameValid</span><span class="op" id="2986032">(</span><span class="ident" id="2986033">name</span><span class="op" id="2986037">)</span>&nbsp;<span class="op" id="2986039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986045">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2986057">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986062">if</span>&nbsp;<span class="ident" id="2986065">filter</span>&nbsp;<span class="op" id="2986072">!=</span>&nbsp;<span class="string" id="2986075">&#34;&#34;</span>&nbsp;<span class="op" id="2986078">&amp;&amp;</span>&nbsp;<span class="ident" id="2986081">filter</span>&nbsp;<span class="op" id="2986088">!=</span>&nbsp;<span class="ident" id="2986091">name</span>&nbsp;<span class="op" id="2986096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986102">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2986114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2986119">val</span><span class="op" id="2986122">,</span>&nbsp;<span class="ident" id="2986124">success</span>&nbsp;<span class="op" id="2986132">:=</span>&nbsp;<span class="ident" id="2986135">parseCookieValue</span><span class="op" id="2986151">(</span><span class="ident" id="2986152">val</span><span class="op" id="2986155">,</span>&nbsp;<span class="builtintype" id="2986157">true</span><span class="op" id="2986161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986166">if</span>&nbsp;<span class="op" id="2986169">!</span><span class="ident" id="2986170">success</span>&nbsp;<span class="op" id="2986178">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986184">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2986196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2986201">cookies</span>&nbsp;<span class="op" id="2986209">=</span>&nbsp;<span class="builtinfunc" id="2986211">append</span><span class="op" id="2986217">(</span><span class="ident" id="2986218">cookies</span><span class="op" id="2986225">,</span>&nbsp;<span class="op" id="2986227">&amp;</span><span class="ident" id="2986228">Cookie</span><span class="op" id="2986234">{</span><span class="ident" id="2986235">Name</span><span class="op" id="2986239">:</span>&nbsp;<span class="ident" id="2986241">name</span><span class="op" id="2986245">,</span>&nbsp;<span class="ident" id="2986247">Value</span><span class="op" id="2986252">:</span>&nbsp;<span class="ident" id="2986254">val</span><span class="op" id="2986257">}</span><span class="op" id="2986258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2986263">parsedPairs</span><span class="op" id="2986274">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2986279">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2986282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986285">return</span>&nbsp;<span class="ident" id="2986292">cookies</span><br>
<span class="lineno"></span><span class="op" id="2986300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2986303">//&nbsp;validCookieDomain&nbsp;returns&nbsp;wheter&nbsp;v&nbsp;is&nbsp;a&nbsp;valid&nbsp;cookie&nbsp;domain-value.</span><br>
<span class="lineno">220</span><span class="keyword" id="2986373">func</span>&nbsp;<span class="ident" id="2986378">validCookieDomain</span><span class="op" id="2986395">(</span><span class="ident" id="2986396">v</span>&nbsp;<span class="builtintype" id="2986398">string</span><span class="op" id="2986404">)</span>&nbsp;<span class="builtintype" id="2986406">bool</span>&nbsp;<span class="op" id="2986411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986414">if</span>&nbsp;<span class="ident" id="2986417">isCookieDomainName</span><span class="op" id="2986435">(</span><span class="ident" id="2986436">v</span><span class="op" id="2986437">)</span>&nbsp;<span class="op" id="2986439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986443">return</span>&nbsp;<span class="builtintype" id="2986450">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2986456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986459">if</span>&nbsp;<span class="ident" id="2986462">net</span><span class="op" id="2986465">.</span><span class="ident" id="2986466">ParseIP</span><span class="op" id="2986473">(</span><span class="ident" id="2986474">v</span><span class="op" id="2986475">)</span>&nbsp;<span class="op" id="2986477">!=</span>&nbsp;<span class="ident" id="2986480">nil</span>&nbsp;<span class="op" id="2986484">&amp;&amp;</span>&nbsp;<span class="op" id="2986487">!</span><span class="ident" id="2986488">strings</span><span class="op" id="2986495">.</span><span class="ident" id="2986496">Contains</span><span class="op" id="2986504">(</span><span class="ident" id="2986505">v</span><span class="op" id="2986506">,</span>&nbsp;<span class="string" id="2986508">&#34;:&#34;</span><span class="op" id="2986511">)</span>&nbsp;<span class="op" id="2986513">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986517">return</span>&nbsp;<span class="builtintype" id="2986524">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2986530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986533">return</span>&nbsp;<span class="builtintype" id="2986540">false</span><br>
<span class="lineno"></span><span class="op" id="2986546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="2986549">//&nbsp;isCookieDomainName&nbsp;returns&nbsp;whether&nbsp;s&nbsp;is&nbsp;a&nbsp;valid&nbsp;domain&nbsp;name&nbsp;or&nbsp;a&nbsp;valid</span><br>
<span class="lineno"></span><span class="comment" id="2986623">//&nbsp;domain&nbsp;name&nbsp;with&nbsp;a&nbsp;leading&nbsp;dot&nbsp;&#39;.&#39;.&nbsp;&nbsp;It&nbsp;is&nbsp;almost&nbsp;a&nbsp;direct&nbsp;copy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2986693">//&nbsp;package&nbsp;net&#39;s&nbsp;isDomainName.</span><br>
<span class="lineno"></span><span class="keyword" id="2986724">func</span>&nbsp;<span class="ident" id="2986729">isCookieDomainName</span><span class="op" id="2986747">(</span><span class="ident" id="2986748">s</span>&nbsp;<span class="builtintype" id="2986750">string</span><span class="op" id="2986756">)</span>&nbsp;<span class="builtintype" id="2986758">bool</span>&nbsp;<span class="op" id="2986763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986766">if</span>&nbsp;<span class="builtinfunc" id="2986769">len</span><span class="op" id="2986772">(</span><span class="ident" id="2986773">s</span><span class="op" id="2986774">)</span>&nbsp;<span class="op" id="2986776">==</span>&nbsp;<span class="num" id="2986779">0</span>&nbsp;<span class="op" id="2986781">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986785">return</span>&nbsp;<span class="builtintype" id="2986792">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2986799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986802">if</span>&nbsp;<span class="builtinfunc" id="2986805">len</span><span class="op" id="2986808">(</span><span class="ident" id="2986809">s</span><span class="op" id="2986810">)</span>&nbsp;<span class="op" id="2986812">&gt;</span>&nbsp;<span class="num" id="2986814">255</span>&nbsp;<span class="op" id="2986818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986822">return</span>&nbsp;<span class="builtintype" id="2986829">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2986836">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2986840">if</span>&nbsp;<span class="ident" id="2986843">s</span><span class="op" id="2986844">[</span><span class="num" id="2986845">0</span><span class="op" id="2986846">]</span>&nbsp;<span class="op" id="2986848">==</span>&nbsp;<span class="string" id="2986851">&#39;.&#39;</span>&nbsp;<span class="op" id="2986855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2986859">//&nbsp;A&nbsp;cookie&nbsp;a&nbsp;domain&nbsp;attribute&nbsp;may&nbsp;start&nbsp;with&nbsp;a&nbsp;leading&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2986922">s</span>&nbsp;<span class="op" id="2986924">=</span>&nbsp;<span class="ident" id="2986926">s</span><span class="op" id="2986927">[</span><span class="num" id="2986928">1</span><span class="op" id="2986929">:</span><span class="op" id="2986930">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2986933">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2986936">last</span>&nbsp;<span class="op" id="2986941">:=</span>&nbsp;<span class="builtintype" id="2986944">byte</span><span class="op" id="2986948">(</span><span class="string" id="2986949">&#39;.&#39;</span><span class="op" id="2986952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2986955">ok</span>&nbsp;<span class="op" id="2986958">:=</span>&nbsp;<span class="builtintype" id="2986961">false</span>&nbsp;<span class="comment" id="2986967">//&nbsp;Ok&nbsp;once&nbsp;we&#39;ve&nbsp;seen&nbsp;a&nbsp;letter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987000">partlen</span>&nbsp;<span class="op" id="2987008">:=</span>&nbsp;<span class="num" id="2987011">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987014">for</span>&nbsp;<span class="ident" id="2987018">i</span>&nbsp;<span class="op" id="2987020">:=</span>&nbsp;<span class="num" id="2987023">0</span><span class="op" id="2987024">;</span>&nbsp;<span class="ident" id="2987026">i</span>&nbsp;<span class="op" id="2987028">&lt;</span>&nbsp;<span class="builtinfunc" id="2987030">len</span><span class="op" id="2987033">(</span><span class="ident" id="2987034">s</span><span class="op" id="2987035">)</span><span class="op" id="2987036">;</span>&nbsp;<span class="ident" id="2987038">i</span><span class="op" id="2987039">++</span>&nbsp;<span class="op" id="2987042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987046">c</span>&nbsp;<span class="op" id="2987048">:=</span>&nbsp;<span class="ident" id="2987051">s</span><span class="op" id="2987052">[</span><span class="ident" id="2987053">i</span><span class="op" id="2987054">]</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987058">switch</span>&nbsp;<span class="op" id="2987065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987069">default</span><span class="op" id="2987076">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987081">return</span>&nbsp;<span class="builtintype" id="2987088">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987096">case</span>&nbsp;<span class="string" id="2987101">&#39;a&#39;</span>&nbsp;<span class="op" id="2987105">&lt;=</span>&nbsp;<span class="ident" id="2987108">c</span>&nbsp;<span class="op" id="2987110">&amp;&amp;</span>&nbsp;<span class="ident" id="2987113">c</span>&nbsp;<span class="op" id="2987115">&lt;=</span>&nbsp;<span class="string" id="2987118">&#39;z&#39;</span>&nbsp;<span class="op" id="2987122">||</span>&nbsp;<span class="string" id="2987125">&#39;A&#39;</span>&nbsp;<span class="op" id="2987129">&lt;=</span>&nbsp;<span class="ident" id="2987132">c</span>&nbsp;<span class="op" id="2987134">&amp;&amp;</span>&nbsp;<span class="ident" id="2987137">c</span>&nbsp;<span class="op" id="2987139">&lt;=</span>&nbsp;<span class="string" id="2987142">&#39;Z&#39;</span><span class="op" id="2987145">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2987150">//&nbsp;No&nbsp;&#39;_&#39;&nbsp;allowed&nbsp;here&nbsp;(in&nbsp;contrast&nbsp;to&nbsp;package&nbsp;net).</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987206">ok</span>&nbsp;<span class="op" id="2987209">=</span>&nbsp;<span class="builtintype" id="2987211">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987219">partlen</span><span class="op" id="2987226">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987231">case</span>&nbsp;<span class="string" id="2987236">&#39;0&#39;</span>&nbsp;<span class="op" id="2987240">&lt;=</span>&nbsp;<span class="ident" id="2987243">c</span>&nbsp;<span class="op" id="2987245">&amp;&amp;</span>&nbsp;<span class="ident" id="2987248">c</span>&nbsp;<span class="op" id="2987250">&lt;=</span>&nbsp;<span class="string" id="2987253">&#39;9&#39;</span><span class="op" id="2987256">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2987261">//&nbsp;fine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987272">partlen</span><span class="op" id="2987279">++</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987284">case</span>&nbsp;<span class="ident" id="2987289">c</span>&nbsp;<span class="op" id="2987291">==</span>&nbsp;<span class="string" id="2987294">&#39;-&#39;</span><span class="op" id="2987297">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2987302">//&nbsp;Byte&nbsp;before&nbsp;dash&nbsp;cannot&nbsp;be&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987340">if</span>&nbsp;<span class="ident" id="2987343">last</span>&nbsp;<span class="op" id="2987348">==</span>&nbsp;<span class="string" id="2987351">&#39;.&#39;</span>&nbsp;<span class="op" id="2987355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987361">return</span>&nbsp;<span class="builtintype" id="2987368">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2987377">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987382">partlen</span><span class="op" id="2987389">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987394">case</span>&nbsp;<span class="ident" id="2987399">c</span>&nbsp;<span class="op" id="2987401">==</span>&nbsp;<span class="string" id="2987404">&#39;.&#39;</span><span class="op" id="2987407">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2987412">//&nbsp;Byte&nbsp;before&nbsp;dot&nbsp;cannot&nbsp;be&nbsp;dot,&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987455">if</span>&nbsp;<span class="ident" id="2987458">last</span>&nbsp;<span class="op" id="2987463">==</span>&nbsp;<span class="string" id="2987466">&#39;.&#39;</span>&nbsp;<span class="op" id="2987470">||</span>&nbsp;<span class="ident" id="2987473">last</span>&nbsp;<span class="op" id="2987478">==</span>&nbsp;<span class="string" id="2987481">&#39;-&#39;</span>&nbsp;<span class="op" id="2987485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987491">return</span>&nbsp;<span class="builtintype" id="2987498">false</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2987507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987512">if</span>&nbsp;<span class="ident" id="2987515">partlen</span>&nbsp;<span class="op" id="2987523">&gt;</span>&nbsp;<span class="num" id="2987525">63</span>&nbsp;<span class="op" id="2987528">||</span>&nbsp;<span class="ident" id="2987531">partlen</span>&nbsp;<span class="op" id="2987539">==</span>&nbsp;<span class="num" id="2987542">0</span>&nbsp;<span class="op" id="2987544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987550">return</span>&nbsp;<span class="builtintype" id="2987557">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2987566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987571">partlen</span>&nbsp;<span class="op" id="2987579">=</span>&nbsp;<span class="num" id="2987581">0</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2987585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2987589">last</span>&nbsp;<span class="op" id="2987594">=</span>&nbsp;<span class="ident" id="2987596">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2987599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987602">if</span>&nbsp;<span class="ident" id="2987605">last</span>&nbsp;<span class="op" id="2987610">==</span>&nbsp;<span class="string" id="2987613">&#39;-&#39;</span>&nbsp;<span class="op" id="2987617">||</span>&nbsp;<span class="ident" id="2987620">partlen</span>&nbsp;<span class="op" id="2987628">&gt;</span>&nbsp;<span class="num" id="2987630">63</span>&nbsp;<span class="op" id="2987633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987637">return</span>&nbsp;<span class="builtintype" id="2987644">false</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2987651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987655">return</span>&nbsp;<span class="ident" id="2987662">ok</span><br>
<span class="lineno"></span><span class="op" id="2987665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="2987668">var</span>&nbsp;<span class="ident" id="2987672">cookieNameSanitizer</span>&nbsp;<span class="op" id="2987692">=</span>&nbsp;<span class="ident" id="2987694">strings</span><span class="op" id="2987701">.</span><span class="ident" id="2987702">NewReplacer</span><span class="op" id="2987713">(</span><span class="string" id="2987714">&#34;\n&#34;</span><span class="op" id="2987718">,</span>&nbsp;<span class="string" id="2987720">&#34;-&#34;</span><span class="op" id="2987723">,</span>&nbsp;<span class="string" id="2987725">&#34;\r&#34;</span><span class="op" id="2987729">,</span>&nbsp;<span class="string" id="2987731">&#34;-&#34;</span><span class="op" id="2987734">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2987737">func</span>&nbsp;<span class="ident" id="2987742">sanitizeCookieName</span><span class="op" id="2987760">(</span><span class="ident" id="2987761">n</span>&nbsp;<span class="builtintype" id="2987763">string</span><span class="op" id="2987769">)</span>&nbsp;<span class="builtintype" id="2987771">string</span>&nbsp;<span class="op" id="2987778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2987781">return</span>&nbsp;<span class="ident" id="2987788">cookieNameSanitizer</span><span class="op" id="2987807">.</span><span class="ident" id="2987808">Replace</span><span class="op" id="2987815">(</span><span class="ident" id="2987816">n</span><span class="op" id="2987817">)</span><br>
<span class="lineno"></span><span class="op" id="2987819">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span><span class="comment" id="2987822">//&nbsp;http://tools.ietf.org/html/rfc6265#section-4.1.1</span><br>
<span class="lineno"></span><span class="comment" id="2987874">//&nbsp;cookie-value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;*cookie-octet&nbsp;/&nbsp;(&nbsp;DQUOTE&nbsp;*cookie-octet&nbsp;DQUOTE&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2987945">//&nbsp;cookie-octet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;%x21&nbsp;/&nbsp;%x23-2B&nbsp;/&nbsp;%x2D-3A&nbsp;/&nbsp;%x3C-5B&nbsp;/&nbsp;%x5D-7E</span><br>
<span class="lineno"></span><span class="comment" id="2988013">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;US-ASCII&nbsp;characters&nbsp;excluding&nbsp;CTLs,</span><br>
<span class="lineno">295</span><span class="comment" id="2988064">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;whitespace&nbsp;DQUOTE,&nbsp;comma,&nbsp;semicolon,</span><br>
<span class="lineno"></span><span class="comment" id="2988116">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;and&nbsp;backslash</span><br>
<span class="lineno"></span><span class="comment" id="2988145">//&nbsp;We&nbsp;loosen&nbsp;this&nbsp;as&nbsp;spaces&nbsp;and&nbsp;commas&nbsp;are&nbsp;common&nbsp;in&nbsp;cookie&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="2988212">//&nbsp;but&nbsp;we&nbsp;produce&nbsp;a&nbsp;quoted&nbsp;cookie-value&nbsp;in&nbsp;when&nbsp;value&nbsp;starts&nbsp;or&nbsp;ends</span><br>
<span class="lineno"></span><span class="comment" id="2988281">//&nbsp;with&nbsp;a&nbsp;comma&nbsp;or&nbsp;space.</span><br>
<span class="lineno">300</span><span class="comment" id="2988307">//&nbsp;See&nbsp;http://golang.org/issue/7243&nbsp;for&nbsp;the&nbsp;discussion.</span><br>
<span class="lineno"></span><span class="keyword" id="2988363">func</span>&nbsp;<span class="ident" id="2988368">sanitizeCookieValue</span><span class="op" id="2988387">(</span><span class="ident" id="2988388">v</span>&nbsp;<span class="builtintype" id="2988390">string</span><span class="op" id="2988396">)</span>&nbsp;<span class="builtintype" id="2988398">string</span>&nbsp;<span class="op" id="2988405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2988408">v</span>&nbsp;<span class="op" id="2988410">=</span>&nbsp;<span class="ident" id="2988412">sanitizeOrWarn</span><span class="op" id="2988426">(</span><span class="string" id="2988427">&#34;Cookie.Value&#34;</span><span class="op" id="2988441">,</span>&nbsp;<span class="ident" id="2988443">validCookieValueByte</span><span class="op" id="2988463">,</span>&nbsp;<span class="ident" id="2988465">v</span><span class="op" id="2988466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988469">if</span>&nbsp;<span class="builtinfunc" id="2988472">len</span><span class="op" id="2988475">(</span><span class="ident" id="2988476">v</span><span class="op" id="2988477">)</span>&nbsp;<span class="op" id="2988479">==</span>&nbsp;<span class="num" id="2988482">0</span>&nbsp;<span class="op" id="2988484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988488">return</span>&nbsp;<span class="ident" id="2988495">v</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2988498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988501">if</span>&nbsp;<span class="ident" id="2988504">v</span><span class="op" id="2988505">[</span><span class="num" id="2988506">0</span><span class="op" id="2988507">]</span>&nbsp;<span class="op" id="2988509">==</span>&nbsp;<span class="string" id="2988512">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="2988516">||</span>&nbsp;<span class="ident" id="2988519">v</span><span class="op" id="2988520">[</span><span class="num" id="2988521">0</span><span class="op" id="2988522">]</span>&nbsp;<span class="op" id="2988524">==</span>&nbsp;<span class="string" id="2988527">&#39;,&#39;</span>&nbsp;<span class="op" id="2988531">||</span>&nbsp;<span class="ident" id="2988534">v</span><span class="op" id="2988535">[</span><span class="builtinfunc" id="2988536">len</span><span class="op" id="2988539">(</span><span class="ident" id="2988540">v</span><span class="op" id="2988541">)</span><span class="op" id="2988542">-</span><span class="num" id="2988543">1</span><span class="op" id="2988544">]</span>&nbsp;<span class="op" id="2988546">==</span>&nbsp;<span class="string" id="2988549">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="2988553">||</span>&nbsp;<span class="ident" id="2988556">v</span><span class="op" id="2988557">[</span><span class="builtinfunc" id="2988558">len</span><span class="op" id="2988561">(</span><span class="ident" id="2988562">v</span><span class="op" id="2988563">)</span><span class="op" id="2988564">-</span><span class="num" id="2988565">1</span><span class="op" id="2988566">]</span>&nbsp;<span class="op" id="2988568">==</span>&nbsp;<span class="string" id="2988571">&#39;,&#39;</span>&nbsp;<span class="op" id="2988575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988579">return</span>&nbsp;<span class="string" id="2988586">`&#34;`</span>&nbsp;<span class="op" id="2988590">+</span>&nbsp;<span class="ident" id="2988592">v</span>&nbsp;<span class="op" id="2988594">+</span>&nbsp;<span class="string" id="2988596">`&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2988601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988604">return</span>&nbsp;<span class="ident" id="2988611">v</span><br>
<span class="lineno">310</span><span class="op" id="2988613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2988616">func</span>&nbsp;<span class="ident" id="2988621">validCookieValueByte</span><span class="op" id="2988641">(</span><span class="ident" id="2988642">b</span>&nbsp;<span class="builtintype" id="2988644">byte</span><span class="op" id="2988648">)</span>&nbsp;<span class="builtintype" id="2988650">bool</span>&nbsp;<span class="op" id="2988655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988658">return</span>&nbsp;<span class="num" id="2988665">0x20</span>&nbsp;<span class="op" id="2988670">&lt;=</span>&nbsp;<span class="ident" id="2988673">b</span>&nbsp;<span class="op" id="2988675">&amp;&amp;</span>&nbsp;<span class="ident" id="2988678">b</span>&nbsp;<span class="op" id="2988680">&lt;</span>&nbsp;<span class="num" id="2988682">0x7f</span>&nbsp;<span class="op" id="2988687">&amp;&amp;</span>&nbsp;<span class="ident" id="2988690">b</span>&nbsp;<span class="op" id="2988692">!=</span>&nbsp;<span class="string" id="2988695">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="2988699">&amp;&amp;</span>&nbsp;<span class="ident" id="2988702">b</span>&nbsp;<span class="op" id="2988704">!=</span>&nbsp;<span class="string" id="2988707">&#39;;&#39;</span>&nbsp;<span class="op" id="2988711">&amp;&amp;</span>&nbsp;<span class="ident" id="2988714">b</span>&nbsp;<span class="op" id="2988716">!=</span>&nbsp;<span class="string" id="2988719">&#39;\\&#39;</span><br>
<span class="lineno"></span><span class="op" id="2988724">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="2988727">//&nbsp;path-av&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&#34;Path=&#34;&nbsp;path-value</span><br>
<span class="lineno"></span><span class="comment" id="2988769">//&nbsp;path-value&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&lt;any&nbsp;CHAR&nbsp;except&nbsp;CTLs&nbsp;or&nbsp;&#34;;&#34;&gt;</span><br>
<span class="lineno"></span><span class="keyword" id="2988822">func</span>&nbsp;<span class="ident" id="2988827">sanitizeCookiePath</span><span class="op" id="2988845">(</span><span class="ident" id="2988846">v</span>&nbsp;<span class="builtintype" id="2988848">string</span><span class="op" id="2988854">)</span>&nbsp;<span class="builtintype" id="2988856">string</span>&nbsp;<span class="op" id="2988863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988866">return</span>&nbsp;<span class="ident" id="2988873">sanitizeOrWarn</span><span class="op" id="2988887">(</span><span class="string" id="2988888">&#34;Cookie.Path&#34;</span><span class="op" id="2988901">,</span>&nbsp;<span class="ident" id="2988903">validCookiePathByte</span><span class="op" id="2988922">,</span>&nbsp;<span class="ident" id="2988924">v</span><span class="op" id="2988925">)</span><br>
<span class="lineno">320</span><span class="op" id="2988927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2988930">func</span>&nbsp;<span class="ident" id="2988935">validCookiePathByte</span><span class="op" id="2988954">(</span><span class="ident" id="2988955">b</span>&nbsp;<span class="builtintype" id="2988957">byte</span><span class="op" id="2988961">)</span>&nbsp;<span class="builtintype" id="2988963">bool</span>&nbsp;<span class="op" id="2988968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2988971">return</span>&nbsp;<span class="num" id="2988978">0x20</span>&nbsp;<span class="op" id="2988983">&lt;=</span>&nbsp;<span class="ident" id="2988986">b</span>&nbsp;<span class="op" id="2988988">&amp;&amp;</span>&nbsp;<span class="ident" id="2988991">b</span>&nbsp;<span class="op" id="2988993">&lt;</span>&nbsp;<span class="num" id="2988995">0x7f</span>&nbsp;<span class="op" id="2989000">&amp;&amp;</span>&nbsp;<span class="ident" id="2989003">b</span>&nbsp;<span class="op" id="2989005">!=</span>&nbsp;<span class="string" id="2989008">&#39;;&#39;</span><br>
<span class="lineno"></span><span class="op" id="2989012">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="2989015">func</span>&nbsp;<span class="ident" id="2989020">sanitizeOrWarn</span><span class="op" id="2989034">(</span><span class="ident" id="2989035">fieldName</span>&nbsp;<span class="builtintype" id="2989045">string</span><span class="op" id="2989051">,</span>&nbsp;<span class="ident" id="2989053">valid</span>&nbsp;<span class="keyword" id="2989059">func</span><span class="op" id="2989063">(</span><span class="builtintype" id="2989064">byte</span><span class="op" id="2989068">)</span>&nbsp;<span class="builtintype" id="2989070">bool</span><span class="op" id="2989074">,</span>&nbsp;<span class="ident" id="2989076">v</span>&nbsp;<span class="builtintype" id="2989078">string</span><span class="op" id="2989084">)</span>&nbsp;<span class="builtintype" id="2989086">string</span>&nbsp;<span class="op" id="2989093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2989096">ok</span>&nbsp;<span class="op" id="2989099">:=</span>&nbsp;<span class="builtintype" id="2989102">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989108">for</span>&nbsp;<span class="ident" id="2989112">i</span>&nbsp;<span class="op" id="2989114">:=</span>&nbsp;<span class="num" id="2989117">0</span><span class="op" id="2989118">;</span>&nbsp;<span class="ident" id="2989120">i</span>&nbsp;<span class="op" id="2989122">&lt;</span>&nbsp;<span class="builtinfunc" id="2989124">len</span><span class="op" id="2989127">(</span><span class="ident" id="2989128">v</span><span class="op" id="2989129">)</span><span class="op" id="2989130">;</span>&nbsp;<span class="ident" id="2989132">i</span><span class="op" id="2989133">++</span>&nbsp;<span class="op" id="2989136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989140">if</span>&nbsp;<span class="ident" id="2989143">valid</span><span class="op" id="2989148">(</span><span class="ident" id="2989149">v</span><span class="op" id="2989150">[</span><span class="ident" id="2989151">i</span><span class="op" id="2989152">]</span><span class="op" id="2989153">)</span>&nbsp;<span class="op" id="2989155">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989160">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2989171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2989175">log</span><span class="op" id="2989178">.</span><span class="ident" id="2989179">Printf</span><span class="op" id="2989185">(</span><span class="string" id="2989186">&#34;net/http:&nbsp;invalid&nbsp;byte&nbsp;%q&nbsp;in&nbsp;%s;&nbsp;dropping&nbsp;invalid&nbsp;bytes&#34;</span><span class="op" id="2989243">,</span>&nbsp;<span class="ident" id="2989245">v</span><span class="op" id="2989246">[</span><span class="ident" id="2989247">i</span><span class="op" id="2989248">]</span><span class="op" id="2989249">,</span>&nbsp;<span class="ident" id="2989251">fieldName</span><span class="op" id="2989260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2989264">ok</span>&nbsp;<span class="op" id="2989267">=</span>&nbsp;<span class="builtintype" id="2989269">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989277">break</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2989284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989287">if</span>&nbsp;<span class="ident" id="2989290">ok</span>&nbsp;<span class="op" id="2989293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989297">return</span>&nbsp;<span class="ident" id="2989304">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2989307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2989310">buf</span>&nbsp;<span class="op" id="2989314">:=</span>&nbsp;<span class="builtinfunc" id="2989317">make</span><span class="op" id="2989321">(</span><span class="op" id="2989322">[</span><span class="op" id="2989323">]</span><span class="builtintype" id="2989324">byte</span><span class="op" id="2989328">,</span>&nbsp;<span class="num" id="2989330">0</span><span class="op" id="2989331">,</span>&nbsp;<span class="builtinfunc" id="2989333">len</span><span class="op" id="2989336">(</span><span class="ident" id="2989337">v</span><span class="op" id="2989338">)</span><span class="op" id="2989339">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989342">for</span>&nbsp;<span class="ident" id="2989346">i</span>&nbsp;<span class="op" id="2989348">:=</span>&nbsp;<span class="num" id="2989351">0</span><span class="op" id="2989352">;</span>&nbsp;<span class="ident" id="2989354">i</span>&nbsp;<span class="op" id="2989356">&lt;</span>&nbsp;<span class="builtinfunc" id="2989358">len</span><span class="op" id="2989361">(</span><span class="ident" id="2989362">v</span><span class="op" id="2989363">)</span><span class="op" id="2989364">;</span>&nbsp;<span class="ident" id="2989366">i</span><span class="op" id="2989367">++</span>&nbsp;<span class="op" id="2989370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989374">if</span>&nbsp;<span class="ident" id="2989377">b</span>&nbsp;<span class="op" id="2989379">:=</span>&nbsp;<span class="ident" id="2989382">v</span><span class="op" id="2989383">[</span><span class="ident" id="2989384">i</span><span class="op" id="2989385">]</span><span class="op" id="2989386">;</span>&nbsp;<span class="ident" id="2989388">valid</span><span class="op" id="2989393">(</span><span class="ident" id="2989394">b</span><span class="op" id="2989395">)</span>&nbsp;<span class="op" id="2989397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2989402">buf</span>&nbsp;<span class="op" id="2989406">=</span>&nbsp;<span class="builtinfunc" id="2989408">append</span><span class="op" id="2989414">(</span><span class="ident" id="2989415">buf</span><span class="op" id="2989418">,</span>&nbsp;<span class="ident" id="2989420">b</span><span class="op" id="2989421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2989425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2989428">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989431">return</span>&nbsp;<span class="builtintype" id="2989438">string</span><span class="op" id="2989444">(</span><span class="ident" id="2989445">buf</span><span class="op" id="2989448">)</span><br>
<span class="lineno"></span><span class="op" id="2989450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2989453">func</span>&nbsp;<span class="ident" id="2989458">parseCookieValue</span><span class="op" id="2989474">(</span><span class="ident" id="2989475">raw</span>&nbsp;<span class="builtintype" id="2989479">string</span><span class="op" id="2989485">,</span>&nbsp;<span class="ident" id="2989487">allowDoubleQuote</span>&nbsp;<span class="builtintype" id="2989504">bool</span><span class="op" id="2989508">)</span>&nbsp;<span class="op" id="2989510">(</span><span class="builtintype" id="2989511">string</span><span class="op" id="2989517">,</span>&nbsp;<span class="builtintype" id="2989519">bool</span><span class="op" id="2989523">)</span>&nbsp;<span class="op" id="2989525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2989528">//&nbsp;Strip&nbsp;the&nbsp;quotes,&nbsp;if&nbsp;present.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989562">if</span>&nbsp;<span class="ident" id="2989565">allowDoubleQuote</span>&nbsp;<span class="op" id="2989582">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2989585">len</span><span class="op" id="2989588">(</span><span class="ident" id="2989589">raw</span><span class="op" id="2989592">)</span>&nbsp;<span class="op" id="2989594">&gt;</span>&nbsp;<span class="num" id="2989596">1</span>&nbsp;<span class="op" id="2989598">&amp;&amp;</span>&nbsp;<span class="ident" id="2989601">raw</span><span class="op" id="2989604">[</span><span class="num" id="2989605">0</span><span class="op" id="2989606">]</span>&nbsp;<span class="op" id="2989608">==</span>&nbsp;<span class="string" id="2989611">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="2989615">&amp;&amp;</span>&nbsp;<span class="ident" id="2989618">raw</span><span class="op" id="2989621">[</span><span class="builtinfunc" id="2989622">len</span><span class="op" id="2989625">(</span><span class="ident" id="2989626">raw</span><span class="op" id="2989629">)</span><span class="op" id="2989630">-</span><span class="num" id="2989631">1</span><span class="op" id="2989632">]</span>&nbsp;<span class="op" id="2989634">==</span>&nbsp;<span class="string" id="2989637">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="2989641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2989645">raw</span>&nbsp;<span class="op" id="2989649">=</span>&nbsp;<span class="ident" id="2989651">raw</span><span class="op" id="2989654">[</span><span class="num" id="2989655">1</span>&nbsp;<span class="op" id="2989657">:</span>&nbsp;<span class="builtinfunc" id="2989659">len</span><span class="op" id="2989662">(</span><span class="ident" id="2989663">raw</span><span class="op" id="2989666">)</span><span class="op" id="2989667">-</span><span class="num" id="2989668">1</span><span class="op" id="2989669">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2989672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989675">for</span>&nbsp;<span class="ident" id="2989679">i</span>&nbsp;<span class="op" id="2989681">:=</span>&nbsp;<span class="num" id="2989684">0</span><span class="op" id="2989685">;</span>&nbsp;<span class="ident" id="2989687">i</span>&nbsp;<span class="op" id="2989689">&lt;</span>&nbsp;<span class="builtinfunc" id="2989691">len</span><span class="op" id="2989694">(</span><span class="ident" id="2989695">raw</span><span class="op" id="2989698">)</span><span class="op" id="2989699">;</span>&nbsp;<span class="ident" id="2989701">i</span><span class="op" id="2989702">++</span>&nbsp;<span class="op" id="2989705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989709">if</span>&nbsp;<span class="op" id="2989712">!</span><span class="ident" id="2989713">validCookieValueByte</span><span class="op" id="2989733">(</span><span class="ident" id="2989734">raw</span><span class="op" id="2989737">[</span><span class="ident" id="2989738">i</span><span class="op" id="2989739">]</span><span class="op" id="2989740">)</span>&nbsp;<span class="op" id="2989742">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989747">return</span>&nbsp;<span class="string" id="2989754">&#34;&#34;</span><span class="op" id="2989756">,</span>&nbsp;<span class="builtintype" id="2989758">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2989766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2989769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989772">return</span>&nbsp;<span class="ident" id="2989779">raw</span><span class="op" id="2989782">,</span>&nbsp;<span class="builtintype" id="2989784">true</span><br>
<span class="lineno"></span><span class="op" id="2989789">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="2989792">func</span>&nbsp;<span class="ident" id="2989797">isCookieNameValid</span><span class="op" id="2989814">(</span><span class="ident" id="2989815">raw</span>&nbsp;<span class="builtintype" id="2989819">string</span><span class="op" id="2989825">)</span>&nbsp;<span class="builtintype" id="2989827">bool</span>&nbsp;<span class="op" id="2989832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2989835">return</span>&nbsp;<span class="ident" id="2989842">strings</span><span class="op" id="2989849">.</span><span class="ident" id="2989850">IndexFunc</span><span class="op" id="2989859">(</span><span class="ident" id="2989860">raw</span><span class="op" id="2989863">,</span>&nbsp;<span class="ident" id="2989865">isNotToken</span><span class="op" id="2989875">)</span>&nbsp;<span class="op" id="2989877">&lt;</span>&nbsp;<span class="num" id="2989879">0</span><br>
<span class="lineno"></span><span class="op" id="2989881">}</span>
</div>
</body>
</html>
