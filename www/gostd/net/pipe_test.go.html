<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8284600">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8284656">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8284710">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8284761">package</span>&nbsp;<span class="ident" id="8284769">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8284774">import</span>&nbsp;<span class="op" id="8284781">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8284784">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8284793">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8284799">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8284809">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8284812">func</span>&nbsp;<span class="ident" id="8284817">checkWrite</span><span class="op" id="8284827">(</span><span class="ident" id="8284828">t</span>&nbsp;<span class="op" id="8284830">*</span><span class="ident" id="8284831">testing</span><span class="op" id="8284838">.</span><span class="ident" id="8284839">T</span><span class="op" id="8284840">,</span>&nbsp;<span class="ident" id="8284842">w</span>&nbsp;<span class="ident" id="8284844">io</span><span class="op" id="8284846">.</span><span class="ident" id="8284847">Writer</span><span class="op" id="8284853">,</span>&nbsp;<span class="ident" id="8284855">data</span>&nbsp;<span class="op" id="8284860">[</span><span class="op" id="8284861">]</span><span class="builtintype" id="8284862">byte</span><span class="op" id="8284866">,</span>&nbsp;<span class="ident" id="8284868">c</span>&nbsp;<span class="keyword" id="8284870">chan</span>&nbsp;<span class="builtintype" id="8284875">int</span><span class="op" id="8284878">)</span>&nbsp;<span class="op" id="8284880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284883">n</span><span class="op" id="8284884">,</span>&nbsp;<span class="ident" id="8284886">err</span>&nbsp;<span class="op" id="8284890">:=</span>&nbsp;<span class="ident" id="8284893">w</span><span class="op" id="8284894">.</span><span class="ident" id="8284895">Write</span><span class="op" id="8284900">(</span><span class="ident" id="8284901">data</span><span class="op" id="8284905">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284908">if</span>&nbsp;<span class="ident" id="8284911">err</span>&nbsp;<span class="op" id="8284915">!=</span>&nbsp;<span class="ident" id="8284918">nil</span>&nbsp;<span class="op" id="8284922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284926">t</span><span class="op" id="8284927">.</span><span class="ident" id="8284928">Errorf</span><span class="op" id="8284934">(</span><span class="string" id="8284935">&#34;write:&nbsp;%v&#34;</span><span class="op" id="8284946">,</span>&nbsp;<span class="ident" id="8284948">err</span><span class="op" id="8284951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8284954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284957">if</span>&nbsp;<span class="ident" id="8284960">n</span>&nbsp;<span class="op" id="8284962">!=</span>&nbsp;<span class="builtinfunc" id="8284965">len</span><span class="op" id="8284968">(</span><span class="ident" id="8284969">data</span><span class="op" id="8284973">)</span>&nbsp;<span class="op" id="8284975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284979">t</span><span class="op" id="8284980">.</span><span class="ident" id="8284981">Errorf</span><span class="op" id="8284987">(</span><span class="string" id="8284988">&#34;short&nbsp;write:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="8285011">,</span>&nbsp;<span class="ident" id="8285013">n</span><span class="op" id="8285014">,</span>&nbsp;<span class="builtinfunc" id="8285016">len</span><span class="op" id="8285019">(</span><span class="ident" id="8285020">data</span><span class="op" id="8285024">)</span><span class="op" id="8285025">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285031">c</span>&nbsp;<span class="op" id="8285033">&lt;-</span>&nbsp;<span class="num" id="8285036">0</span><br>
<span class="lineno"></span><span class="op" id="8285038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8285041">func</span>&nbsp;<span class="ident" id="8285046">checkRead</span><span class="op" id="8285055">(</span><span class="ident" id="8285056">t</span>&nbsp;<span class="op" id="8285058">*</span><span class="ident" id="8285059">testing</span><span class="op" id="8285066">.</span><span class="ident" id="8285067">T</span><span class="op" id="8285068">,</span>&nbsp;<span class="ident" id="8285070">r</span>&nbsp;<span class="ident" id="8285072">io</span><span class="op" id="8285074">.</span><span class="ident" id="8285075">Reader</span><span class="op" id="8285081">,</span>&nbsp;<span class="ident" id="8285083">data</span>&nbsp;<span class="op" id="8285088">[</span><span class="op" id="8285089">]</span><span class="builtintype" id="8285090">byte</span><span class="op" id="8285094">,</span>&nbsp;<span class="ident" id="8285096">wantErr</span>&nbsp;<span class="builtintype" id="8285104">error</span><span class="op" id="8285109">)</span>&nbsp;<span class="op" id="8285111">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285114">buf</span>&nbsp;<span class="op" id="8285118">:=</span>&nbsp;<span class="builtinfunc" id="8285121">make</span><span class="op" id="8285125">(</span><span class="op" id="8285126">[</span><span class="op" id="8285127">]</span><span class="builtintype" id="8285128">byte</span><span class="op" id="8285132">,</span>&nbsp;<span class="builtinfunc" id="8285134">len</span><span class="op" id="8285137">(</span><span class="ident" id="8285138">data</span><span class="op" id="8285142">)</span><span class="op" id="8285143">+</span><span class="num" id="8285144">10</span><span class="op" id="8285146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285149">n</span><span class="op" id="8285150">,</span>&nbsp;<span class="ident" id="8285152">err</span>&nbsp;<span class="op" id="8285156">:=</span>&nbsp;<span class="ident" id="8285159">r</span><span class="op" id="8285160">.</span><span class="ident" id="8285161">Read</span><span class="op" id="8285165">(</span><span class="ident" id="8285166">buf</span><span class="op" id="8285169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285172">if</span>&nbsp;<span class="ident" id="8285175">err</span>&nbsp;<span class="op" id="8285179">!=</span>&nbsp;<span class="ident" id="8285182">wantErr</span>&nbsp;<span class="op" id="8285190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285194">t</span><span class="op" id="8285195">.</span><span class="ident" id="8285196">Errorf</span><span class="op" id="8285202">(</span><span class="string" id="8285203">&#34;read:&nbsp;%v&#34;</span><span class="op" id="8285213">,</span>&nbsp;<span class="ident" id="8285215">err</span><span class="op" id="8285218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285222">return</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285233">if</span>&nbsp;<span class="ident" id="8285236">n</span>&nbsp;<span class="op" id="8285238">!=</span>&nbsp;<span class="builtinfunc" id="8285241">len</span><span class="op" id="8285244">(</span><span class="ident" id="8285245">data</span><span class="op" id="8285249">)</span>&nbsp;<span class="op" id="8285251">||</span>&nbsp;<span class="op" id="8285254">!</span><span class="ident" id="8285255">bytes</span><span class="op" id="8285260">.</span><span class="ident" id="8285261">Equal</span><span class="op" id="8285266">(</span><span class="ident" id="8285267">buf</span><span class="op" id="8285270">[</span><span class="num" id="8285271">0</span><span class="op" id="8285272">:</span><span class="ident" id="8285273">n</span><span class="op" id="8285274">]</span><span class="op" id="8285275">,</span>&nbsp;<span class="ident" id="8285277">data</span><span class="op" id="8285281">)</span>&nbsp;<span class="op" id="8285283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285287">t</span><span class="op" id="8285288">.</span><span class="ident" id="8285289">Errorf</span><span class="op" id="8285295">(</span><span class="string" id="8285296">&#34;bad&nbsp;read:&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8285314">,</span>&nbsp;<span class="ident" id="8285316">buf</span><span class="op" id="8285319">[</span><span class="num" id="8285320">0</span><span class="op" id="8285321">:</span><span class="ident" id="8285322">n</span><span class="op" id="8285323">]</span><span class="op" id="8285324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285328">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285336">}</span><br>
<span class="lineno">35</span><span class="op" id="8285338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8285341">//&nbsp;Test&nbsp;a&nbsp;simple&nbsp;read/write/close&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="8285385">//&nbsp;Assumes&nbsp;that&nbsp;the&nbsp;underlying&nbsp;io.Pipe&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="8285439">//&nbsp;is&nbsp;solid&nbsp;and&nbsp;we&#39;re&nbsp;just&nbsp;testing&nbsp;the&nbsp;net&nbsp;wrapping.</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="8285493">func</span>&nbsp;<span class="ident" id="8285498">TestPipe</span><span class="op" id="8285506">(</span><span class="ident" id="8285507">t</span>&nbsp;<span class="op" id="8285509">*</span><span class="ident" id="8285510">testing</span><span class="op" id="8285517">.</span><span class="ident" id="8285518">T</span><span class="op" id="8285519">)</span>&nbsp;<span class="op" id="8285521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285524">c</span>&nbsp;<span class="op" id="8285526">:=</span>&nbsp;<span class="builtinfunc" id="8285529">make</span><span class="op" id="8285533">(</span><span class="keyword" id="8285534">chan</span>&nbsp;<span class="builtintype" id="8285539">int</span><span class="op" id="8285542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285545">cli</span><span class="op" id="8285548">,</span>&nbsp;<span class="ident" id="8285550">srv</span>&nbsp;<span class="op" id="8285554">:=</span>&nbsp;<span class="ident" id="8285557">Pipe</span><span class="op" id="8285561">(</span><span class="op" id="8285562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285565">go</span>&nbsp;<span class="ident" id="8285568">checkWrite</span><span class="op" id="8285578">(</span><span class="ident" id="8285579">t</span><span class="op" id="8285580">,</span>&nbsp;<span class="ident" id="8285582">cli</span><span class="op" id="8285585">,</span>&nbsp;<span class="op" id="8285587">[</span><span class="op" id="8285588">]</span><span class="builtintype" id="8285589">byte</span><span class="op" id="8285593">(</span><span class="string" id="8285594">&#34;hello,&nbsp;world&#34;</span><span class="op" id="8285608">)</span><span class="op" id="8285609">,</span>&nbsp;<span class="ident" id="8285611">c</span><span class="op" id="8285612">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285615">checkRead</span><span class="op" id="8285624">(</span><span class="ident" id="8285625">t</span><span class="op" id="8285626">,</span>&nbsp;<span class="ident" id="8285628">srv</span><span class="op" id="8285631">,</span>&nbsp;<span class="op" id="8285633">[</span><span class="op" id="8285634">]</span><span class="builtintype" id="8285635">byte</span><span class="op" id="8285639">(</span><span class="string" id="8285640">&#34;hello,&nbsp;world&#34;</span><span class="op" id="8285654">)</span><span class="op" id="8285655">,</span>&nbsp;<span class="ident" id="8285657">nil</span><span class="op" id="8285660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285663">&lt;-</span><span class="ident" id="8285665">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285668">go</span>&nbsp;<span class="ident" id="8285671">checkWrite</span><span class="op" id="8285681">(</span><span class="ident" id="8285682">t</span><span class="op" id="8285683">,</span>&nbsp;<span class="ident" id="8285685">srv</span><span class="op" id="8285688">,</span>&nbsp;<span class="op" id="8285690">[</span><span class="op" id="8285691">]</span><span class="builtintype" id="8285692">byte</span><span class="op" id="8285696">(</span><span class="string" id="8285697">&#34;line&nbsp;2&#34;</span><span class="op" id="8285705">)</span><span class="op" id="8285706">,</span>&nbsp;<span class="ident" id="8285708">c</span><span class="op" id="8285709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285712">checkRead</span><span class="op" id="8285721">(</span><span class="ident" id="8285722">t</span><span class="op" id="8285723">,</span>&nbsp;<span class="ident" id="8285725">cli</span><span class="op" id="8285728">,</span>&nbsp;<span class="op" id="8285730">[</span><span class="op" id="8285731">]</span><span class="builtintype" id="8285732">byte</span><span class="op" id="8285736">(</span><span class="string" id="8285737">&#34;line&nbsp;2&#34;</span><span class="op" id="8285745">)</span><span class="op" id="8285746">,</span>&nbsp;<span class="ident" id="8285748">nil</span><span class="op" id="8285751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285754">&lt;-</span><span class="ident" id="8285756">c</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285759">go</span>&nbsp;<span class="ident" id="8285762">checkWrite</span><span class="op" id="8285772">(</span><span class="ident" id="8285773">t</span><span class="op" id="8285774">,</span>&nbsp;<span class="ident" id="8285776">cli</span><span class="op" id="8285779">,</span>&nbsp;<span class="op" id="8285781">[</span><span class="op" id="8285782">]</span><span class="builtintype" id="8285783">byte</span><span class="op" id="8285787">(</span><span class="string" id="8285788">&#34;a&nbsp;third&nbsp;line&#34;</span><span class="op" id="8285802">)</span><span class="op" id="8285803">,</span>&nbsp;<span class="ident" id="8285805">c</span><span class="op" id="8285806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285809">checkRead</span><span class="op" id="8285818">(</span><span class="ident" id="8285819">t</span><span class="op" id="8285820">,</span>&nbsp;<span class="ident" id="8285822">srv</span><span class="op" id="8285825">,</span>&nbsp;<span class="op" id="8285827">[</span><span class="op" id="8285828">]</span><span class="builtintype" id="8285829">byte</span><span class="op" id="8285833">(</span><span class="string" id="8285834">&#34;a&nbsp;third&nbsp;line&#34;</span><span class="op" id="8285848">)</span><span class="op" id="8285849">,</span>&nbsp;<span class="ident" id="8285851">nil</span><span class="op" id="8285854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285857">&lt;-</span><span class="ident" id="8285859">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285862">go</span>&nbsp;<span class="ident" id="8285865">srv</span><span class="op" id="8285868">.</span><span class="ident" id="8285869">Close</span><span class="op" id="8285874">(</span><span class="op" id="8285875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285878">checkRead</span><span class="op" id="8285887">(</span><span class="ident" id="8285888">t</span><span class="op" id="8285889">,</span>&nbsp;<span class="ident" id="8285891">cli</span><span class="op" id="8285894">,</span>&nbsp;<span class="ident" id="8285896">nil</span><span class="op" id="8285899">,</span>&nbsp;<span class="ident" id="8285901">io</span><span class="op" id="8285903">.</span><span class="ident" id="8285904">EOF</span><span class="op" id="8285907">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285910">cli</span><span class="op" id="8285913">.</span><span class="ident" id="8285914">Close</span><span class="op" id="8285919">(</span><span class="op" id="8285920">)</span><br>
<span class="lineno"></span><span class="op" id="8285922">}</span>
</div>
</body>
</html>
