<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7955945">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7956000">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7956054">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7956105">package</span>&nbsp;<span class="ident" id="7956113">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7956118">import</span>&nbsp;<span class="op" id="7956125">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7956128">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7956137">&#34;encoding/hex&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7956153">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7956163">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7956171">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7956178">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7956184">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7956197">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7956204">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7956215">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7956226">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="7956233">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="7956236">//&nbsp;TLS&nbsp;reference&nbsp;tests&nbsp;run&nbsp;a&nbsp;connection&nbsp;against&nbsp;a&nbsp;reference&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="7956311">//&nbsp;(OpenSSL)&nbsp;of&nbsp;TLS&nbsp;and&nbsp;record&nbsp;the&nbsp;bytes&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;The&nbsp;Go</span><br>
<span class="lineno"></span><span class="comment" id="7956388">//&nbsp;code,&nbsp;during&nbsp;a&nbsp;test,&nbsp;is&nbsp;configured&nbsp;with&nbsp;deterministic&nbsp;randomness&nbsp;and&nbsp;so&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7956467">//&nbsp;reference&nbsp;test&nbsp;can&nbsp;be&nbsp;reproduced&nbsp;exactly&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno">25</span><span class="comment" id="7956526">//</span><br>
<span class="lineno"></span><span class="comment" id="7956529">//&nbsp;In&nbsp;order&nbsp;to&nbsp;save&nbsp;everyone&nbsp;who&nbsp;wishes&nbsp;to&nbsp;run&nbsp;the&nbsp;tests&nbsp;from&nbsp;needing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7956603">//&nbsp;reference&nbsp;implementation&nbsp;installed,&nbsp;the&nbsp;reference&nbsp;connections&nbsp;are&nbsp;saved&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7956681">//&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata&nbsp;directory.&nbsp;Thus&nbsp;running&nbsp;the&nbsp;tests&nbsp;involves&nbsp;nothing</span><br>
<span class="lineno"></span><span class="comment" id="7956757">//&nbsp;external,&nbsp;but&nbsp;creating&nbsp;and&nbsp;updating&nbsp;them&nbsp;requires&nbsp;the&nbsp;reference</span><br>
<span class="lineno">30</span><span class="comment" id="7956824">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="comment" id="7956843">//</span><br>
<span class="lineno"></span><span class="comment" id="7956846">//&nbsp;Tests&nbsp;can&nbsp;be&nbsp;updated&nbsp;by&nbsp;running&nbsp;them&nbsp;with&nbsp;the&nbsp;-update&nbsp;flag.&nbsp;This&nbsp;will&nbsp;cause</span><br>
<span class="lineno"></span><span class="comment" id="7956925">//&nbsp;the&nbsp;test&nbsp;files.&nbsp;Generally&nbsp;one&nbsp;should&nbsp;combine&nbsp;the&nbsp;-update&nbsp;flag&nbsp;with&nbsp;-test.run</span><br>
<span class="lineno"></span><span class="comment" id="7957005">//&nbsp;to&nbsp;updated&nbsp;a&nbsp;specific&nbsp;test.&nbsp;Since&nbsp;the&nbsp;reference&nbsp;implementation&nbsp;will&nbsp;always</span><br>
<span class="lineno">35</span><span class="comment" id="7957083">//&nbsp;generate&nbsp;fresh&nbsp;random&nbsp;numbers,&nbsp;large&nbsp;parts&nbsp;of&nbsp;the&nbsp;reference&nbsp;connection&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="7957162">//&nbsp;always&nbsp;change.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7957181">var</span>&nbsp;<span class="ident" id="7957185">update</span>&nbsp;<span class="op" id="7957192">=</span>&nbsp;<span class="ident" id="7957194">flag</span><span class="op" id="7957198">.</span><span class="ident" id="7957199">Bool</span><span class="op" id="7957203">(</span><span class="string" id="7957204">&#34;update&#34;</span><span class="op" id="7957212">,</span>&nbsp;<span class="builtintype" id="7957214">false</span><span class="op" id="7957219">,</span>&nbsp;<span class="string" id="7957221">&#34;update&nbsp;golden&nbsp;files&nbsp;on&nbsp;disk&#34;</span><span class="op" id="7957250">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="7957253">//&nbsp;recordingConn&nbsp;is&nbsp;a&nbsp;net.Conn&nbsp;that&nbsp;records&nbsp;the&nbsp;traffic&nbsp;that&nbsp;passes&nbsp;through&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="7957333">//&nbsp;WriteTo&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;produce&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;later&nbsp;be&nbsp;loaded&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="7957407">//&nbsp;ParseTestData.</span><br>
<span class="lineno"></span><span class="keyword" id="7957425">type</span>&nbsp;<span class="ident" id="7957430">recordingConn</span>&nbsp;<span class="keyword" id="7957444">struct</span>&nbsp;<span class="op" id="7957451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957454">net</span><span class="op" id="7957457">.</span><span class="ident" id="7957458">Conn</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957464">sync</span><span class="op" id="7957468">.</span><span class="ident" id="7957469">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957476">flows</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7957484">[</span><span class="op" id="7957485">]</span><span class="op" id="7957486">[</span><span class="op" id="7957487">]</span><span class="builtintype" id="7957488">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957494">reading</span>&nbsp;<span class="builtintype" id="7957502">bool</span><br>
<span class="lineno"></span><span class="op" id="7957507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="7957510">func</span>&nbsp;<span class="op" id="7957515">(</span><span class="ident" id="7957516">r</span>&nbsp;<span class="op" id="7957518">*</span><span class="ident" id="7957519">recordingConn</span><span class="op" id="7957532">)</span>&nbsp;<span class="ident" id="7957534">Read</span><span class="op" id="7957538">(</span><span class="ident" id="7957539">b</span>&nbsp;<span class="op" id="7957541">[</span><span class="op" id="7957542">]</span><span class="builtintype" id="7957543">byte</span><span class="op" id="7957547">)</span>&nbsp;<span class="op" id="7957549">(</span><span class="ident" id="7957550">n</span>&nbsp;<span class="builtintype" id="7957552">int</span><span class="op" id="7957555">,</span>&nbsp;<span class="ident" id="7957557">err</span>&nbsp;<span class="builtintype" id="7957561">error</span><span class="op" id="7957566">)</span>&nbsp;<span class="op" id="7957568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957571">if</span>&nbsp;<span class="ident" id="7957574">n</span><span class="op" id="7957575">,</span>&nbsp;<span class="ident" id="7957577">err</span>&nbsp;<span class="op" id="7957581">=</span>&nbsp;<span class="ident" id="7957583">r</span><span class="op" id="7957584">.</span><span class="ident" id="7957585">Conn</span><span class="op" id="7957589">.</span><span class="ident" id="7957590">Read</span><span class="op" id="7957594">(</span><span class="ident" id="7957595">b</span><span class="op" id="7957596">)</span><span class="op" id="7957597">;</span>&nbsp;<span class="ident" id="7957599">n</span>&nbsp;<span class="op" id="7957601">==</span>&nbsp;<span class="num" id="7957604">0</span>&nbsp;<span class="op" id="7957606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957610">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957621">b</span>&nbsp;<span class="op" id="7957623">=</span>&nbsp;<span class="ident" id="7957625">b</span><span class="op" id="7957626">[</span><span class="op" id="7957627">:</span><span class="ident" id="7957628">n</span><span class="op" id="7957629">]</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957633">r</span><span class="op" id="7957634">.</span><span class="ident" id="7957635">Lock</span><span class="op" id="7957639">(</span><span class="op" id="7957640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957643">defer</span>&nbsp;<span class="ident" id="7957649">r</span><span class="op" id="7957650">.</span><span class="ident" id="7957651">Unlock</span><span class="op" id="7957657">(</span><span class="op" id="7957658">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957662">if</span>&nbsp;<span class="ident" id="7957665">l</span>&nbsp;<span class="op" id="7957667">:=</span>&nbsp;<span class="builtinfunc" id="7957670">len</span><span class="op" id="7957673">(</span><span class="ident" id="7957674">r</span><span class="op" id="7957675">.</span><span class="ident" id="7957676">flows</span><span class="op" id="7957681">)</span><span class="op" id="7957682">;</span>&nbsp;<span class="ident" id="7957684">l</span>&nbsp;<span class="op" id="7957686">==</span>&nbsp;<span class="num" id="7957689">0</span>&nbsp;<span class="op" id="7957691">||</span>&nbsp;<span class="op" id="7957694">!</span><span class="ident" id="7957695">r</span><span class="op" id="7957696">.</span><span class="ident" id="7957697">reading</span>&nbsp;<span class="op" id="7957705">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957709">buf</span>&nbsp;<span class="op" id="7957713">:=</span>&nbsp;<span class="builtinfunc" id="7957716">make</span><span class="op" id="7957720">(</span><span class="op" id="7957721">[</span><span class="op" id="7957722">]</span><span class="builtintype" id="7957723">byte</span><span class="op" id="7957727">,</span>&nbsp;<span class="builtinfunc" id="7957729">len</span><span class="op" id="7957732">(</span><span class="ident" id="7957733">b</span><span class="op" id="7957734">)</span><span class="op" id="7957735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7957739">copy</span><span class="op" id="7957743">(</span><span class="ident" id="7957744">buf</span><span class="op" id="7957747">,</span>&nbsp;<span class="ident" id="7957749">b</span><span class="op" id="7957750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957754">r</span><span class="op" id="7957755">.</span><span class="ident" id="7957756">flows</span>&nbsp;<span class="op" id="7957762">=</span>&nbsp;<span class="builtinfunc" id="7957764">append</span><span class="op" id="7957770">(</span><span class="ident" id="7957771">r</span><span class="op" id="7957772">.</span><span class="ident" id="7957773">flows</span><span class="op" id="7957778">,</span>&nbsp;<span class="ident" id="7957780">buf</span><span class="op" id="7957783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957786">}</span>&nbsp;<span class="keyword" id="7957788">else</span>&nbsp;<span class="op" id="7957793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957797">r</span><span class="op" id="7957798">.</span><span class="ident" id="7957799">flows</span><span class="op" id="7957804">[</span><span class="ident" id="7957805">l</span><span class="op" id="7957806">-</span><span class="num" id="7957807">1</span><span class="op" id="7957808">]</span>&nbsp;<span class="op" id="7957810">=</span>&nbsp;<span class="builtinfunc" id="7957812">append</span><span class="op" id="7957818">(</span><span class="ident" id="7957819">r</span><span class="op" id="7957820">.</span><span class="ident" id="7957821">flows</span><span class="op" id="7957826">[</span><span class="ident" id="7957827">l</span><span class="op" id="7957828">-</span><span class="num" id="7957829">1</span><span class="op" id="7957830">]</span><span class="op" id="7957831">,</span>&nbsp;<span class="ident" id="7957833">b</span><span class="op" id="7957834">[</span><span class="op" id="7957835">:</span><span class="ident" id="7957836">n</span><span class="op" id="7957837">]</span><span class="op" id="7957838">...</span><span class="op" id="7957841">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957847">r</span><span class="op" id="7957848">.</span><span class="ident" id="7957849">reading</span>&nbsp;<span class="op" id="7957857">=</span>&nbsp;<span class="builtintype" id="7957859">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957865">return</span><br>
<span class="lineno"></span><span class="op" id="7957872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="7957875">func</span>&nbsp;<span class="op" id="7957880">(</span><span class="ident" id="7957881">r</span>&nbsp;<span class="op" id="7957883">*</span><span class="ident" id="7957884">recordingConn</span><span class="op" id="7957897">)</span>&nbsp;<span class="ident" id="7957899">Write</span><span class="op" id="7957904">(</span><span class="ident" id="7957905">b</span>&nbsp;<span class="op" id="7957907">[</span><span class="op" id="7957908">]</span><span class="builtintype" id="7957909">byte</span><span class="op" id="7957913">)</span>&nbsp;<span class="op" id="7957915">(</span><span class="ident" id="7957916">n</span>&nbsp;<span class="builtintype" id="7957918">int</span><span class="op" id="7957921">,</span>&nbsp;<span class="ident" id="7957923">err</span>&nbsp;<span class="builtintype" id="7957927">error</span><span class="op" id="7957932">)</span>&nbsp;<span class="op" id="7957934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957937">if</span>&nbsp;<span class="ident" id="7957940">n</span><span class="op" id="7957941">,</span>&nbsp;<span class="ident" id="7957943">err</span>&nbsp;<span class="op" id="7957947">=</span>&nbsp;<span class="ident" id="7957949">r</span><span class="op" id="7957950">.</span><span class="ident" id="7957951">Conn</span><span class="op" id="7957955">.</span><span class="ident" id="7957956">Write</span><span class="op" id="7957961">(</span><span class="ident" id="7957962">b</span><span class="op" id="7957963">)</span><span class="op" id="7957964">;</span>&nbsp;<span class="ident" id="7957966">n</span>&nbsp;<span class="op" id="7957968">==</span>&nbsp;<span class="num" id="7957971">0</span>&nbsp;<span class="op" id="7957973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957977">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957988">b</span>&nbsp;<span class="op" id="7957990">=</span>&nbsp;<span class="ident" id="7957992">b</span><span class="op" id="7957993">[</span><span class="op" id="7957994">:</span><span class="ident" id="7957995">n</span><span class="op" id="7957996">]</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958000">r</span><span class="op" id="7958001">.</span><span class="ident" id="7958002">Lock</span><span class="op" id="7958006">(</span><span class="op" id="7958007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958010">defer</span>&nbsp;<span class="ident" id="7958016">r</span><span class="op" id="7958017">.</span><span class="ident" id="7958018">Unlock</span><span class="op" id="7958024">(</span><span class="op" id="7958025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958029">if</span>&nbsp;<span class="ident" id="7958032">l</span>&nbsp;<span class="op" id="7958034">:=</span>&nbsp;<span class="builtinfunc" id="7958037">len</span><span class="op" id="7958040">(</span><span class="ident" id="7958041">r</span><span class="op" id="7958042">.</span><span class="ident" id="7958043">flows</span><span class="op" id="7958048">)</span><span class="op" id="7958049">;</span>&nbsp;<span class="ident" id="7958051">l</span>&nbsp;<span class="op" id="7958053">==</span>&nbsp;<span class="num" id="7958056">0</span>&nbsp;<span class="op" id="7958058">||</span>&nbsp;<span class="ident" id="7958061">r</span><span class="op" id="7958062">.</span><span class="ident" id="7958063">reading</span>&nbsp;<span class="op" id="7958071">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958075">buf</span>&nbsp;<span class="op" id="7958079">:=</span>&nbsp;<span class="builtinfunc" id="7958082">make</span><span class="op" id="7958086">(</span><span class="op" id="7958087">[</span><span class="op" id="7958088">]</span><span class="builtintype" id="7958089">byte</span><span class="op" id="7958093">,</span>&nbsp;<span class="builtinfunc" id="7958095">len</span><span class="op" id="7958098">(</span><span class="ident" id="7958099">b</span><span class="op" id="7958100">)</span><span class="op" id="7958101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7958105">copy</span><span class="op" id="7958109">(</span><span class="ident" id="7958110">buf</span><span class="op" id="7958113">,</span>&nbsp;<span class="ident" id="7958115">b</span><span class="op" id="7958116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958120">r</span><span class="op" id="7958121">.</span><span class="ident" id="7958122">flows</span>&nbsp;<span class="op" id="7958128">=</span>&nbsp;<span class="builtinfunc" id="7958130">append</span><span class="op" id="7958136">(</span><span class="ident" id="7958137">r</span><span class="op" id="7958138">.</span><span class="ident" id="7958139">flows</span><span class="op" id="7958144">,</span>&nbsp;<span class="ident" id="7958146">buf</span><span class="op" id="7958149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7958152">}</span>&nbsp;<span class="keyword" id="7958154">else</span>&nbsp;<span class="op" id="7958159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958163">r</span><span class="op" id="7958164">.</span><span class="ident" id="7958165">flows</span><span class="op" id="7958170">[</span><span class="ident" id="7958171">l</span><span class="op" id="7958172">-</span><span class="num" id="7958173">1</span><span class="op" id="7958174">]</span>&nbsp;<span class="op" id="7958176">=</span>&nbsp;<span class="builtinfunc" id="7958178">append</span><span class="op" id="7958184">(</span><span class="ident" id="7958185">r</span><span class="op" id="7958186">.</span><span class="ident" id="7958187">flows</span><span class="op" id="7958192">[</span><span class="ident" id="7958193">l</span><span class="op" id="7958194">-</span><span class="num" id="7958195">1</span><span class="op" id="7958196">]</span><span class="op" id="7958197">,</span>&nbsp;<span class="ident" id="7958199">b</span><span class="op" id="7958200">[</span><span class="op" id="7958201">:</span><span class="ident" id="7958202">n</span><span class="op" id="7958203">]</span><span class="op" id="7958204">...</span><span class="op" id="7958207">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7958210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958213">r</span><span class="op" id="7958214">.</span><span class="ident" id="7958215">reading</span>&nbsp;<span class="op" id="7958223">=</span>&nbsp;<span class="builtintype" id="7958225">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958232">return</span><br>
<span class="lineno"></span><span class="op" id="7958239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="7958242">//&nbsp;WriteTo&nbsp;writes&nbsp;Go&nbsp;source&nbsp;code&nbsp;to&nbsp;w&nbsp;that&nbsp;contains&nbsp;the&nbsp;recorded&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="7958316">func</span>&nbsp;<span class="op" id="7958321">(</span><span class="ident" id="7958322">r</span>&nbsp;<span class="op" id="7958324">*</span><span class="ident" id="7958325">recordingConn</span><span class="op" id="7958338">)</span>&nbsp;<span class="ident" id="7958340">WriteTo</span><span class="op" id="7958347">(</span><span class="ident" id="7958348">w</span>&nbsp;<span class="ident" id="7958350">io</span><span class="op" id="7958352">.</span><span class="ident" id="7958353">Writer</span><span class="op" id="7958359">)</span>&nbsp;<span class="op" id="7958361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7958364">//&nbsp;TLS&nbsp;always&nbsp;starts&nbsp;with&nbsp;a&nbsp;client&nbsp;to&nbsp;server&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958416">clientToServer</span>&nbsp;<span class="op" id="7958431">:=</span>&nbsp;<span class="builtintype" id="7958434">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958441">for</span>&nbsp;<span class="ident" id="7958445">i</span><span class="op" id="7958446">,</span>&nbsp;<span class="ident" id="7958448">flow</span>&nbsp;<span class="op" id="7958453">:=</span>&nbsp;<span class="keyword" id="7958456">range</span>&nbsp;<span class="ident" id="7958462">r</span><span class="op" id="7958463">.</span><span class="ident" id="7958464">flows</span>&nbsp;<span class="op" id="7958470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958474">source</span><span class="op" id="7958480">,</span>&nbsp;<span class="ident" id="7958482">dest</span>&nbsp;<span class="op" id="7958487">:=</span>&nbsp;<span class="string" id="7958490">&#34;client&#34;</span><span class="op" id="7958498">,</span>&nbsp;<span class="string" id="7958500">&#34;server&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958511">if</span>&nbsp;<span class="op" id="7958514">!</span><span class="ident" id="7958515">clientToServer</span>&nbsp;<span class="op" id="7958530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958535">source</span><span class="op" id="7958541">,</span>&nbsp;<span class="ident" id="7958543">dest</span>&nbsp;<span class="op" id="7958548">=</span>&nbsp;<span class="ident" id="7958550">dest</span><span class="op" id="7958554">,</span>&nbsp;<span class="ident" id="7958556">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7958565">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958569">fmt</span><span class="op" id="7958572">.</span><span class="ident" id="7958573">Fprintf</span><span class="op" id="7958580">(</span><span class="ident" id="7958581">w</span><span class="op" id="7958582">,</span>&nbsp;<span class="string" id="7958584">&#34;&gt;&gt;&gt;&nbsp;Flow&nbsp;%d&nbsp;(%s&nbsp;to&nbsp;%s)\n&#34;</span><span class="op" id="7958610">,</span>&nbsp;<span class="ident" id="7958612">i</span><span class="op" id="7958613">+</span><span class="num" id="7958614">1</span><span class="op" id="7958615">,</span>&nbsp;<span class="ident" id="7958617">source</span><span class="op" id="7958623">,</span>&nbsp;<span class="ident" id="7958625">dest</span><span class="op" id="7958629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958633">dumper</span>&nbsp;<span class="op" id="7958640">:=</span>&nbsp;<span class="ident" id="7958643">hex</span><span class="op" id="7958646">.</span><span class="ident" id="7958647">Dumper</span><span class="op" id="7958653">(</span><span class="ident" id="7958654">w</span><span class="op" id="7958655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958659">dumper</span><span class="op" id="7958665">.</span><span class="ident" id="7958666">Write</span><span class="op" id="7958671">(</span><span class="ident" id="7958672">flow</span><span class="op" id="7958676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958680">dumper</span><span class="op" id="7958686">.</span><span class="ident" id="7958687">Close</span><span class="op" id="7958692">(</span><span class="op" id="7958693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958697">clientToServer</span>&nbsp;<span class="op" id="7958712">=</span>&nbsp;<span class="op" id="7958714">!</span><span class="ident" id="7958715">clientToServer</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7958731">}</span><br>
<span class="lineno"></span><span class="op" id="7958733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7958736">func</span>&nbsp;<span class="ident" id="7958741">parseTestData</span><span class="op" id="7958754">(</span><span class="ident" id="7958755">r</span>&nbsp;<span class="ident" id="7958757">io</span><span class="op" id="7958759">.</span><span class="ident" id="7958760">Reader</span><span class="op" id="7958766">)</span>&nbsp;<span class="op" id="7958768">(</span><span class="ident" id="7958769">flows</span>&nbsp;<span class="op" id="7958775">[</span><span class="op" id="7958776">]</span><span class="op" id="7958777">[</span><span class="op" id="7958778">]</span><span class="builtintype" id="7958779">byte</span><span class="op" id="7958783">,</span>&nbsp;<span class="ident" id="7958785">err</span>&nbsp;<span class="builtintype" id="7958789">error</span><span class="op" id="7958794">)</span>&nbsp;<span class="op" id="7958796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958799">var</span>&nbsp;<span class="ident" id="7958803">currentFlow</span>&nbsp;<span class="op" id="7958815">[</span><span class="op" id="7958816">]</span><span class="builtintype" id="7958817">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958824">scanner</span>&nbsp;<span class="op" id="7958832">:=</span>&nbsp;<span class="ident" id="7958835">bufio</span><span class="op" id="7958840">.</span><span class="ident" id="7958841">NewScanner</span><span class="op" id="7958851">(</span><span class="ident" id="7958852">r</span><span class="op" id="7958853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958856">for</span>&nbsp;<span class="ident" id="7958860">scanner</span><span class="op" id="7958867">.</span><span class="ident" id="7958868">Scan</span><span class="op" id="7958872">(</span><span class="op" id="7958873">)</span>&nbsp;<span class="op" id="7958875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958879">line</span>&nbsp;<span class="op" id="7958884">:=</span>&nbsp;<span class="ident" id="7958887">scanner</span><span class="op" id="7958894">.</span><span class="ident" id="7958895">Text</span><span class="op" id="7958899">(</span><span class="op" id="7958900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7958904">//&nbsp;If&nbsp;the&nbsp;line&nbsp;starts&nbsp;with&nbsp;&#34;&gt;&gt;&gt;&nbsp;&#34;&nbsp;then&nbsp;it&nbsp;marks&nbsp;the&nbsp;beginning</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7958968">//&nbsp;of&nbsp;a&nbsp;new&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958988">if</span>&nbsp;<span class="ident" id="7958991">strings</span><span class="op" id="7958998">.</span><span class="ident" id="7958999">HasPrefix</span><span class="op" id="7959008">(</span><span class="ident" id="7959009">line</span><span class="op" id="7959013">,</span>&nbsp;<span class="string" id="7959015">&#34;&gt;&gt;&gt;&nbsp;&#34;</span><span class="op" id="7959021">)</span>&nbsp;<span class="op" id="7959023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7959028">if</span>&nbsp;<span class="builtinfunc" id="7959031">len</span><span class="op" id="7959034">(</span><span class="ident" id="7959035">currentFlow</span><span class="op" id="7959046">)</span>&nbsp;<span class="op" id="7959048">&gt;</span>&nbsp;<span class="num" id="7959050">0</span>&nbsp;<span class="op" id="7959052">||</span>&nbsp;<span class="builtinfunc" id="7959055">len</span><span class="op" id="7959058">(</span><span class="ident" id="7959059">flows</span><span class="op" id="7959064">)</span>&nbsp;<span class="op" id="7959066">&gt;</span>&nbsp;<span class="num" id="7959068">0</span>&nbsp;<span class="op" id="7959070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959076">flows</span>&nbsp;<span class="op" id="7959082">=</span>&nbsp;<span class="builtinfunc" id="7959084">append</span><span class="op" id="7959090">(</span><span class="ident" id="7959091">flows</span><span class="op" id="7959096">,</span>&nbsp;<span class="ident" id="7959098">currentFlow</span><span class="op" id="7959109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959115">currentFlow</span>&nbsp;<span class="op" id="7959127">=</span>&nbsp;<span class="ident" id="7959129">nil</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7959136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7959141">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7959152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7959157">//&nbsp;Otherwise&nbsp;the&nbsp;line&nbsp;is&nbsp;a&nbsp;line&nbsp;of&nbsp;hex&nbsp;dump&nbsp;that&nbsp;looks&nbsp;like:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7959220">//&nbsp;00000170&nbsp;&nbsp;fc&nbsp;f5&nbsp;06&nbsp;bf&nbsp;(...)&nbsp;&nbsp;|.....X{&amp;?......!|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7959273">//&nbsp;(Some&nbsp;bytes&nbsp;have&nbsp;been&nbsp;omitted&nbsp;from&nbsp;the&nbsp;middle&nbsp;section.)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7959335">if</span>&nbsp;<span class="ident" id="7959338">i</span>&nbsp;<span class="op" id="7959340">:=</span>&nbsp;<span class="ident" id="7959343">strings</span><span class="op" id="7959350">.</span><span class="ident" id="7959351">IndexByte</span><span class="op" id="7959360">(</span><span class="ident" id="7959361">line</span><span class="op" id="7959365">,</span>&nbsp;<span class="string" id="7959367">&#39;&nbsp;&#39;</span><span class="op" id="7959370">)</span><span class="op" id="7959371">;</span>&nbsp;<span class="ident" id="7959373">i</span>&nbsp;<span class="op" id="7959375">&gt;=</span>&nbsp;<span class="num" id="7959378">0</span>&nbsp;<span class="op" id="7959380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959385">line</span>&nbsp;<span class="op" id="7959390">=</span>&nbsp;<span class="ident" id="7959392">line</span><span class="op" id="7959396">[</span><span class="ident" id="7959397">i</span><span class="op" id="7959398">:</span><span class="op" id="7959399">]</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7959403">}</span>&nbsp;<span class="keyword" id="7959405">else</span>&nbsp;<span class="op" id="7959410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7959415">return</span>&nbsp;<span class="ident" id="7959422">nil</span><span class="op" id="7959425">,</span>&nbsp;<span class="ident" id="7959427">errors</span><span class="op" id="7959433">.</span><span class="ident" id="7959434">New</span><span class="op" id="7959437">(</span><span class="string" id="7959438">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="7959457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7959461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7959466">if</span>&nbsp;<span class="ident" id="7959469">i</span>&nbsp;<span class="op" id="7959471">:=</span>&nbsp;<span class="ident" id="7959474">strings</span><span class="op" id="7959481">.</span><span class="ident" id="7959482">IndexByte</span><span class="op" id="7959491">(</span><span class="ident" id="7959492">line</span><span class="op" id="7959496">,</span>&nbsp;<span class="string" id="7959498">&#39;|&#39;</span><span class="op" id="7959501">)</span><span class="op" id="7959502">;</span>&nbsp;<span class="ident" id="7959504">i</span>&nbsp;<span class="op" id="7959506">&gt;=</span>&nbsp;<span class="num" id="7959509">0</span>&nbsp;<span class="op" id="7959511">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959516">line</span>&nbsp;<span class="op" id="7959521">=</span>&nbsp;<span class="ident" id="7959523">line</span><span class="op" id="7959527">[</span><span class="op" id="7959528">:</span><span class="ident" id="7959529">i</span><span class="op" id="7959530">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7959534">}</span>&nbsp;<span class="keyword" id="7959536">else</span>&nbsp;<span class="op" id="7959541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7959546">return</span>&nbsp;<span class="ident" id="7959553">nil</span><span class="op" id="7959556">,</span>&nbsp;<span class="ident" id="7959558">errors</span><span class="op" id="7959564">.</span><span class="ident" id="7959565">New</span><span class="op" id="7959568">(</span><span class="string" id="7959569">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="7959588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7959592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959597">hexBytes</span>&nbsp;<span class="op" id="7959606">:=</span>&nbsp;<span class="ident" id="7959609">strings</span><span class="op" id="7959616">.</span><span class="ident" id="7959617">Fields</span><span class="op" id="7959623">(</span><span class="ident" id="7959624">line</span><span class="op" id="7959628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7959632">for</span>&nbsp;<span class="ident" id="7959636">_</span><span class="op" id="7959637">,</span>&nbsp;<span class="ident" id="7959639">hexByte</span>&nbsp;<span class="op" id="7959647">:=</span>&nbsp;<span class="keyword" id="7959650">range</span>&nbsp;<span class="ident" id="7959656">hexBytes</span>&nbsp;<span class="op" id="7959665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959670">val</span><span class="op" id="7959673">,</span>&nbsp;<span class="ident" id="7959675">err</span>&nbsp;<span class="op" id="7959679">:=</span>&nbsp;<span class="ident" id="7959682">strconv</span><span class="op" id="7959689">.</span><span class="ident" id="7959690">ParseUint</span><span class="op" id="7959699">(</span><span class="ident" id="7959700">hexByte</span><span class="op" id="7959707">,</span>&nbsp;<span class="num" id="7959709">16</span><span class="op" id="7959711">,</span>&nbsp;<span class="num" id="7959713">8</span><span class="op" id="7959714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7959719">if</span>&nbsp;<span class="ident" id="7959722">err</span>&nbsp;<span class="op" id="7959726">!=</span>&nbsp;<span class="ident" id="7959729">nil</span>&nbsp;<span class="op" id="7959733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7959739">return</span>&nbsp;<span class="ident" id="7959746">nil</span><span class="op" id="7959749">,</span>&nbsp;<span class="ident" id="7959751">errors</span><span class="op" id="7959757">.</span><span class="ident" id="7959758">New</span><span class="op" id="7959761">(</span><span class="string" id="7959762">&#34;invalid&nbsp;hex&nbsp;byte&nbsp;in&nbsp;test&nbsp;data:&nbsp;&#34;</span>&nbsp;<span class="op" id="7959796">+</span>&nbsp;<span class="ident" id="7959798">err</span><span class="op" id="7959801">.</span><span class="ident" id="7959802">Error</span><span class="op" id="7959807">(</span><span class="op" id="7959808">)</span><span class="op" id="7959809">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7959814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959819">currentFlow</span>&nbsp;<span class="op" id="7959831">=</span>&nbsp;<span class="builtinfunc" id="7959833">append</span><span class="op" id="7959839">(</span><span class="ident" id="7959840">currentFlow</span><span class="op" id="7959851">,</span>&nbsp;<span class="builtintype" id="7959853">byte</span><span class="op" id="7959857">(</span><span class="ident" id="7959858">val</span><span class="op" id="7959861">)</span><span class="op" id="7959862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7959866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7959869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7959873">if</span>&nbsp;<span class="builtinfunc" id="7959876">len</span><span class="op" id="7959879">(</span><span class="ident" id="7959880">currentFlow</span><span class="op" id="7959891">)</span>&nbsp;<span class="op" id="7959893">&gt;</span>&nbsp;<span class="num" id="7959895">0</span>&nbsp;<span class="op" id="7959897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959901">flows</span>&nbsp;<span class="op" id="7959907">=</span>&nbsp;<span class="builtinfunc" id="7959909">append</span><span class="op" id="7959915">(</span><span class="ident" id="7959916">flows</span><span class="op" id="7959921">,</span>&nbsp;<span class="ident" id="7959923">currentFlow</span><span class="op" id="7959934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7959937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7959941">return</span>&nbsp;<span class="ident" id="7959948">flows</span><span class="op" id="7959953">,</span>&nbsp;<span class="ident" id="7959955">nil</span><br>
<span class="lineno">155</span><span class="op" id="7959959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7959962">//&nbsp;tempFile&nbsp;creates&nbsp;a&nbsp;temp&nbsp;file&nbsp;containing&nbsp;contents&nbsp;and&nbsp;returns&nbsp;its&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="7960036">func</span>&nbsp;<span class="ident" id="7960041">tempFile</span><span class="op" id="7960049">(</span><span class="ident" id="7960050">contents</span>&nbsp;<span class="builtintype" id="7960059">string</span><span class="op" id="7960065">)</span>&nbsp;<span class="builtintype" id="7960067">string</span>&nbsp;<span class="op" id="7960074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7960077">file</span><span class="op" id="7960081">,</span>&nbsp;<span class="ident" id="7960083">err</span>&nbsp;<span class="op" id="7960087">:=</span>&nbsp;<span class="ident" id="7960090">ioutil</span><span class="op" id="7960096">.</span><span class="ident" id="7960097">TempFile</span><span class="op" id="7960105">(</span><span class="string" id="7960106">&#34;&#34;</span><span class="op" id="7960108">,</span>&nbsp;<span class="string" id="7960110">&#34;go-tls-test&#34;</span><span class="op" id="7960123">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7960126">if</span>&nbsp;<span class="ident" id="7960129">err</span>&nbsp;<span class="op" id="7960133">!=</span>&nbsp;<span class="ident" id="7960136">nil</span>&nbsp;<span class="op" id="7960140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7960144">panic</span><span class="op" id="7960149">(</span><span class="string" id="7960150">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file:&nbsp;&#34;</span>&nbsp;<span class="op" id="7960181">+</span>&nbsp;<span class="ident" id="7960183">err</span><span class="op" id="7960186">.</span><span class="ident" id="7960187">Error</span><span class="op" id="7960192">(</span><span class="op" id="7960193">)</span><span class="op" id="7960194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7960197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7960200">path</span>&nbsp;<span class="op" id="7960205">:=</span>&nbsp;<span class="ident" id="7960208">file</span><span class="op" id="7960212">.</span><span class="ident" id="7960213">Name</span><span class="op" id="7960217">(</span><span class="op" id="7960218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7960221">file</span><span class="op" id="7960225">.</span><span class="ident" id="7960226">WriteString</span><span class="op" id="7960237">(</span><span class="ident" id="7960238">contents</span><span class="op" id="7960246">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7960249">file</span><span class="op" id="7960253">.</span><span class="ident" id="7960254">Close</span><span class="op" id="7960259">(</span><span class="op" id="7960260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7960263">return</span>&nbsp;<span class="ident" id="7960270">path</span><br>
<span class="lineno"></span><span class="op" id="7960275">}</span>
</div>
</body>
</html>
