<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5390976">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5391031">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5391085">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5391136">package</span>&nbsp;<span class="ident" id="5391144">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5391150">import</span>&nbsp;<span class="op" id="5391157">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5391160">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5391165">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="5391168">//&nbsp;maxCodeLength&nbsp;is&nbsp;the&nbsp;maximum&nbsp;(inclusive)&nbsp;number&nbsp;of&nbsp;bits&nbsp;in&nbsp;a&nbsp;Huffman&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="5391246">const</span>&nbsp;<span class="ident" id="5391252">maxCodeLength</span>&nbsp;<span class="op" id="5391266">=</span>&nbsp;<span class="num" id="5391268">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5391272">//&nbsp;maxNCodes&nbsp;is&nbsp;the&nbsp;maximum&nbsp;(inclusive)&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;a&nbsp;Huffman&nbsp;tree.</span><br>
<span class="lineno">15</span><span class="keyword" id="5391347">const</span>&nbsp;<span class="ident" id="5391353">maxNCodes</span>&nbsp;<span class="op" id="5391363">=</span>&nbsp;<span class="num" id="5391365">256</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5391370">//&nbsp;lutSize&nbsp;is&nbsp;the&nbsp;log-2&nbsp;size&nbsp;of&nbsp;the&nbsp;Huffman&nbsp;decoder&#39;s&nbsp;look-up&nbsp;table.</span><br>
<span class="lineno"></span><span class="keyword" id="5391439">const</span>&nbsp;<span class="ident" id="5391445">lutSize</span>&nbsp;<span class="op" id="5391453">=</span>&nbsp;<span class="num" id="5391455">8</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5391458">//&nbsp;huffman&nbsp;is&nbsp;a&nbsp;Huffman&nbsp;decoder,&nbsp;specified&nbsp;in&nbsp;section&nbsp;C.</span><br>
<span class="lineno"></span><span class="keyword" id="5391515">type</span>&nbsp;<span class="ident" id="5391520">huffman</span>&nbsp;<span class="keyword" id="5391528">struct</span>&nbsp;<span class="op" id="5391535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5391538">//&nbsp;length&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5391585">nCodes</span>&nbsp;<span class="builtintype" id="5391592">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5391599">//&nbsp;lut&nbsp;is&nbsp;the&nbsp;look-up&nbsp;table&nbsp;for&nbsp;the&nbsp;next&nbsp;lutSize&nbsp;bits&nbsp;in&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5391673">//&nbsp;The&nbsp;high&nbsp;8&nbsp;bits&nbsp;of&nbsp;the&nbsp;uint16&nbsp;are&nbsp;the&nbsp;encoded&nbsp;value.&nbsp;The&nbsp;low&nbsp;8&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5391745">//&nbsp;are&nbsp;1&nbsp;plus&nbsp;the&nbsp;code&nbsp;length,&nbsp;or&nbsp;0&nbsp;if&nbsp;the&nbsp;value&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;fit&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5391818">//&nbsp;lutSize&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5391836">lut</span>&nbsp;<span class="op" id="5391840">[</span><span class="num" id="5391841">1</span>&nbsp;<span class="op" id="5391843">&lt;&lt;</span>&nbsp;<span class="ident" id="5391846"><a href="/image/jpeg/huffman.go.html#5391445">lutSize</a></span><span class="op" id="5391853">]</span><span class="builtintype" id="5391854">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5391862">//&nbsp;vals&nbsp;are&nbsp;the&nbsp;decoded&nbsp;values,&nbsp;sorted&nbsp;by&nbsp;their&nbsp;encoding.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5391921">vals</span>&nbsp;<span class="op" id="5391926">[</span><span class="ident" id="5391927"><a href="/image/jpeg/huffman.go.html#5391353">maxNCodes</a></span><span class="op" id="5391936">]</span><span class="builtintype" id="5391937">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5391944">//&nbsp;minCodes[i]&nbsp;is&nbsp;the&nbsp;minimum&nbsp;code&nbsp;of&nbsp;length&nbsp;i,&nbsp;or&nbsp;-1&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5392015">//&nbsp;codes&nbsp;of&nbsp;that&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392041">minCodes</span>&nbsp;<span class="op" id="5392050">[</span><span class="ident" id="5392051"><a href="/image/jpeg/huffman.go.html#5391252">maxCodeLength</a></span><span class="op" id="5392064">]</span><span class="builtintype" id="5392065">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5392072">//&nbsp;maxCodes[i]&nbsp;is&nbsp;the&nbsp;maximum&nbsp;code&nbsp;of&nbsp;length&nbsp;i,&nbsp;or&nbsp;-1&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5392143">//&nbsp;codes&nbsp;of&nbsp;that&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392169">maxCodes</span>&nbsp;<span class="op" id="5392178">[</span><span class="ident" id="5392179"><a href="/image/jpeg/huffman.go.html#5391252">maxCodeLength</a></span><span class="op" id="5392192">]</span><span class="builtintype" id="5392193">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5392200">//&nbsp;valsIndices[i]&nbsp;is&nbsp;the&nbsp;index&nbsp;into&nbsp;vals&nbsp;of&nbsp;minCodes[i].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392258">valsIndices</span>&nbsp;<span class="op" id="5392270">[</span><span class="ident" id="5392271"><a href="/image/jpeg/huffman.go.html#5391252">maxCodeLength</a></span><span class="op" id="5392284">]</span><span class="builtintype" id="5392285">int32</span><br>
<span class="lineno"></span><span class="op" id="5392291">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="5392294">//&nbsp;errShortHuffmanData&nbsp;means&nbsp;that&nbsp;an&nbsp;unexpected&nbsp;EOF&nbsp;occurred&nbsp;while&nbsp;decoding</span><br>
<span class="lineno"></span><span class="comment" id="5392370">//&nbsp;Huffman&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5392387">var</span>&nbsp;<span class="ident" id="5392391">errShortHuffmanData</span>&nbsp;<span class="op" id="5392411">=</span>&nbsp;<span class="ident" id="5392413"><a href="/image/jpeg/reader.go.html#5402996">FormatError</a></span><span class="op" id="5392424">(</span><span class="string" id="5392425">&#34;short&nbsp;Huffman&nbsp;data&#34;</span><span class="op" id="5392445">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5392448">//&nbsp;ensureNBits&nbsp;reads&nbsp;bytes&nbsp;from&nbsp;the&nbsp;byte&nbsp;buffer&nbsp;to&nbsp;ensure&nbsp;that&nbsp;d.bits.n&nbsp;is&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5392526">//&nbsp;least&nbsp;n.&nbsp;For&nbsp;best&nbsp;performance&nbsp;(avoiding&nbsp;function&nbsp;calls&nbsp;inside&nbsp;hot&nbsp;loops),</span><br>
<span class="lineno"></span><span class="comment" id="5392603">//&nbsp;the&nbsp;caller&nbsp;is&nbsp;the&nbsp;one&nbsp;responsible&nbsp;for&nbsp;first&nbsp;checking&nbsp;that&nbsp;d.bits.n&nbsp;&lt;&nbsp;n.</span><br>
<span class="lineno"></span><span class="keyword" id="5392678">func</span>&nbsp;<span class="op" id="5392683">(</span><span class="ident" id="5392684">d</span>&nbsp;<span class="op" id="5392686">*</span><span class="ident" id="5392687"><a href="/image/jpeg/reader.go.html#5405509">decoder</a></span><span class="op" id="5392694">)</span>&nbsp;<span class="ident" id="5392696">ensureNBits</span><span class="op" id="5392707">(</span><span class="ident" id="5392708">n</span>&nbsp;<span class="builtintype" id="5392710">int32</span><span class="op" id="5392715">)</span>&nbsp;<span class="builtintype" id="5392717">error</span>&nbsp;<span class="op" id="5392723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5392726">for</span>&nbsp;<span class="op" id="5392730">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392734">c</span><span class="op" id="5392735">,</span>&nbsp;<span class="ident" id="5392737">err</span>&nbsp;<span class="op" id="5392741">:=</span>&nbsp;<span class="ident" id="5392744"><a href="/image/jpeg/huffman.go.html#5392684">d</a></span><span class="op" id="5392745">.</span><span class="ident" id="5392746">readByteStuffedByte</span><span class="op" id="5392765">(</span><span class="op" id="5392766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5392770">if</span>&nbsp;<span class="ident" id="5392773"><a href="/image/jpeg/huffman.go.html#5392737">err</a></span>&nbsp;<span class="op" id="5392777">!=</span>&nbsp;<span class="ident" id="5392780">nil</span>&nbsp;<span class="op" id="5392784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5392789">if</span>&nbsp;<span class="ident" id="5392792"><a href="/image/jpeg/huffman.go.html#5392737">err</a></span>&nbsp;<span class="op" id="5392796">==</span>&nbsp;<span class="ident" id="5392799"><a href="/image/jpeg/huffman.go.html#5391160">io</a></span><span class="op" id="5392801">.</span><span class="ident" id="5392802">EOF</span>&nbsp;<span class="op" id="5392806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5392812">return</span>&nbsp;<span class="ident" id="5392819"><a href="/image/jpeg/huffman.go.html#5392391">errShortHuffmanData</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5392842">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5392847">return</span>&nbsp;<span class="ident" id="5392854"><a href="/image/jpeg/huffman.go.html#5392737">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5392860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392864"><a href="/image/jpeg/huffman.go.html#5392684">d</a></span><span class="op" id="5392865">.</span><span class="ident" id="5392866">bits</span><span class="op" id="5392870">.</span><span class="ident" id="5392871">a</span>&nbsp;<span class="op" id="5392873">=</span>&nbsp;<span class="ident" id="5392875"><a href="/image/jpeg/huffman.go.html#5392684">d</a></span><span class="op" id="5392876">.</span><span class="ident" id="5392877">bits</span><span class="op" id="5392881">.</span><span class="ident" id="5392882">a</span><span class="op" id="5392883">&lt;&lt;</span><span class="num" id="5392885">8</span>&nbsp;<span class="op" id="5392887">|</span>&nbsp;<span class="builtintype" id="5392889">uint32</span><span class="op" id="5392895">(</span><span class="ident" id="5392896"><a href="/image/jpeg/huffman.go.html#5392734">c</a></span><span class="op" id="5392897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392901"><a href="/image/jpeg/huffman.go.html#5392684">d</a></span><span class="op" id="5392902">.</span><span class="ident" id="5392903">bits</span><span class="op" id="5392907">.</span><span class="ident" id="5392908">n</span>&nbsp;<span class="op" id="5392910">+=</span>&nbsp;<span class="num" id="5392913">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5392917">if</span>&nbsp;<span class="ident" id="5392920"><a href="/image/jpeg/huffman.go.html#5392684">d</a></span><span class="op" id="5392921">.</span><span class="ident" id="5392922">bits</span><span class="op" id="5392926">.</span><span class="ident" id="5392927">m</span>&nbsp;<span class="op" id="5392929">==</span>&nbsp;<span class="num" id="5392932">0</span>&nbsp;<span class="op" id="5392934">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392939"><a href="/image/jpeg/huffman.go.html#5392684">d</a></span><span class="op" id="5392940">.</span><span class="ident" id="5392941">bits</span><span class="op" id="5392945">.</span><span class="ident" id="5392946">m</span>&nbsp;<span class="op" id="5392948">=</span>&nbsp;<span class="num" id="5392950">1</span>&nbsp;<span class="op" id="5392952">&lt;&lt;</span>&nbsp;<span class="num" id="5392955">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5392959">}</span>&nbsp;<span class="keyword" id="5392961">else</span>&nbsp;<span class="op" id="5392966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392971"><a href="/image/jpeg/huffman.go.html#5392684">d</a></span><span class="op" id="5392972">.</span><span class="ident" id="5392973">bits</span><span class="op" id="5392977">.</span><span class="ident" id="5392978">m</span>&nbsp;<span class="op" id="5392980">&lt;&lt;=</span>&nbsp;<span class="num" id="5392984">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5392988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5392992">if</span>&nbsp;<span class="ident" id="5392995"><a href="/image/jpeg/huffman.go.html#5392684">d</a></span><span class="op" id="5392996">.</span><span class="ident" id="5392997">bits</span><span class="op" id="5393001">.</span><span class="ident" id="5393002">n</span>&nbsp;<span class="op" id="5393004">&gt;=</span>&nbsp;<span class="ident" id="5393007"><a href="/image/jpeg/huffman.go.html#5392708">n</a></span>&nbsp;<span class="op" id="5393009">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393014">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393028">return</span>&nbsp;<span class="ident" id="5393035">nil</span><br>
<span class="lineno"></span><span class="op" id="5393039">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="5393042">//&nbsp;receiveExtend&nbsp;is&nbsp;the&nbsp;composition&nbsp;of&nbsp;RECEIVE&nbsp;and&nbsp;EXTEND,&nbsp;specified&nbsp;in&nbsp;section</span><br>
<span class="lineno"></span><span class="comment" id="5393122">//&nbsp;F.2.2.1.</span><br>
<span class="lineno"></span><span class="keyword" id="5393134">func</span>&nbsp;<span class="op" id="5393139">(</span><span class="ident" id="5393140">d</span>&nbsp;<span class="op" id="5393142">*</span><span class="ident" id="5393143"><a href="/image/jpeg/reader.go.html#5405509">decoder</a></span><span class="op" id="5393150">)</span>&nbsp;<span class="ident" id="5393152">receiveExtend</span><span class="op" id="5393165">(</span><span class="ident" id="5393166">t</span>&nbsp;<span class="builtintype" id="5393168">uint8</span><span class="op" id="5393173">)</span>&nbsp;<span class="op" id="5393175">(</span><span class="builtintype" id="5393176">int32</span><span class="op" id="5393181">,</span>&nbsp;<span class="builtintype" id="5393183">error</span><span class="op" id="5393188">)</span>&nbsp;<span class="op" id="5393190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393193">if</span>&nbsp;<span class="ident" id="5393196"><a href="/image/jpeg/huffman.go.html#5393140">d</a></span><span class="op" id="5393197">.</span><span class="ident" id="5393198">bits</span><span class="op" id="5393202">.</span><span class="ident" id="5393203">n</span>&nbsp;<span class="op" id="5393205">&lt;</span>&nbsp;<span class="builtintype" id="5393207">int32</span><span class="op" id="5393212">(</span><span class="ident" id="5393213"><a href="/image/jpeg/huffman.go.html#5393166">t</a></span><span class="op" id="5393214">)</span>&nbsp;<span class="op" id="5393216">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393220">if</span>&nbsp;<span class="ident" id="5393223">err</span>&nbsp;<span class="op" id="5393227">:=</span>&nbsp;<span class="ident" id="5393230"><a href="/image/jpeg/huffman.go.html#5393140">d</a></span><span class="op" id="5393231">.</span><span class="ident" id="5393232">ensureNBits</span><span class="op" id="5393243">(</span><span class="builtintype" id="5393244">int32</span><span class="op" id="5393249">(</span><span class="ident" id="5393250"><a href="/image/jpeg/huffman.go.html#5393166">t</a></span><span class="op" id="5393251">)</span><span class="op" id="5393252">)</span><span class="op" id="5393253">;</span>&nbsp;<span class="ident" id="5393255"><a href="/image/jpeg/huffman.go.html#5393223">err</a></span>&nbsp;<span class="op" id="5393259">!=</span>&nbsp;<span class="ident" id="5393262">nil</span>&nbsp;<span class="op" id="5393266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393271">return</span>&nbsp;<span class="num" id="5393278">0</span><span class="op" id="5393279">,</span>&nbsp;<span class="ident" id="5393281"><a href="/image/jpeg/huffman.go.html#5393223">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393293"><a href="/image/jpeg/huffman.go.html#5393140">d</a></span><span class="op" id="5393294">.</span><span class="ident" id="5393295">bits</span><span class="op" id="5393299">.</span><span class="ident" id="5393300">n</span>&nbsp;<span class="op" id="5393302">-=</span>&nbsp;<span class="builtintype" id="5393305">int32</span><span class="op" id="5393310">(</span><span class="ident" id="5393311"><a href="/image/jpeg/huffman.go.html#5393166">t</a></span><span class="op" id="5393312">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393315"><a href="/image/jpeg/huffman.go.html#5393140">d</a></span><span class="op" id="5393316">.</span><span class="ident" id="5393317">bits</span><span class="op" id="5393321">.</span><span class="ident" id="5393322">m</span>&nbsp;<span class="op" id="5393324">&gt;&gt;=</span>&nbsp;<span class="ident" id="5393328"><a href="/image/jpeg/huffman.go.html#5393166">t</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393331">s</span>&nbsp;<span class="op" id="5393333">:=</span>&nbsp;<span class="builtintype" id="5393336">int32</span><span class="op" id="5393341">(</span><span class="num" id="5393342">1</span><span class="op" id="5393343">)</span>&nbsp;<span class="op" id="5393345">&lt;&lt;</span>&nbsp;<span class="ident" id="5393348"><a href="/image/jpeg/huffman.go.html#5393166">t</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393351">x</span>&nbsp;<span class="op" id="5393353">:=</span>&nbsp;<span class="builtintype" id="5393356">int32</span><span class="op" id="5393361">(</span><span class="ident" id="5393362"><a href="/image/jpeg/huffman.go.html#5393140">d</a></span><span class="op" id="5393363">.</span><span class="ident" id="5393364">bits</span><span class="op" id="5393368">.</span><span class="ident" id="5393369">a</span><span class="op" id="5393370">&gt;&gt;</span><span class="builtintype" id="5393372">uint8</span><span class="op" id="5393377">(</span><span class="ident" id="5393378"><a href="/image/jpeg/huffman.go.html#5393140">d</a></span><span class="op" id="5393379">.</span><span class="ident" id="5393380">bits</span><span class="op" id="5393384">.</span><span class="ident" id="5393385">n</span><span class="op" id="5393386">)</span><span class="op" id="5393387">)</span>&nbsp;<span class="op" id="5393389">&amp;</span>&nbsp;<span class="op" id="5393391">(</span><span class="ident" id="5393392"><a href="/image/jpeg/huffman.go.html#5393331">s</a></span>&nbsp;<span class="op" id="5393394">-</span>&nbsp;<span class="num" id="5393396">1</span><span class="op" id="5393397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393400">if</span>&nbsp;<span class="ident" id="5393403"><a href="/image/jpeg/huffman.go.html#5393351">x</a></span>&nbsp;<span class="op" id="5393405">&lt;</span>&nbsp;<span class="ident" id="5393407"><a href="/image/jpeg/huffman.go.html#5393331">s</a></span><span class="op" id="5393408">&gt;&gt;</span><span class="num" id="5393410">1</span>&nbsp;<span class="op" id="5393412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393416"><a href="/image/jpeg/huffman.go.html#5393351">x</a></span>&nbsp;<span class="op" id="5393418">+=</span>&nbsp;<span class="op" id="5393421">(</span><span class="op" id="5393422">(</span><span class="op" id="5393423">-</span><span class="num" id="5393424">1</span><span class="op" id="5393425">)</span>&nbsp;<span class="op" id="5393427">&lt;&lt;</span>&nbsp;<span class="ident" id="5393430"><a href="/image/jpeg/huffman.go.html#5393166">t</a></span><span class="op" id="5393431">)</span>&nbsp;<span class="op" id="5393433">+</span>&nbsp;<span class="num" id="5393435">1</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393441">return</span>&nbsp;<span class="ident" id="5393448"><a href="/image/jpeg/huffman.go.html#5393351">x</a></span><span class="op" id="5393449">,</span>&nbsp;<span class="ident" id="5393451">nil</span><br>
<span class="lineno"></span><span class="op" id="5393455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5393458">//&nbsp;processDHT&nbsp;processes&nbsp;a&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker,&nbsp;and&nbsp;initializes&nbsp;a&nbsp;huffman</span><br>
<span class="lineno">90</span><span class="comment" id="5393539">//&nbsp;struct&nbsp;from&nbsp;its&nbsp;contents.&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.4.2.</span><br>
<span class="lineno"></span><span class="keyword" id="5393598">func</span>&nbsp;<span class="op" id="5393603">(</span><span class="ident" id="5393604">d</span>&nbsp;<span class="op" id="5393606">*</span><span class="ident" id="5393607"><a href="/image/jpeg/reader.go.html#5405509">decoder</a></span><span class="op" id="5393614">)</span>&nbsp;<span class="ident" id="5393616">processDHT</span><span class="op" id="5393626">(</span><span class="ident" id="5393627">n</span>&nbsp;<span class="builtintype" id="5393629">int</span><span class="op" id="5393632">)</span>&nbsp;<span class="builtintype" id="5393634">error</span>&nbsp;<span class="op" id="5393640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393643">for</span>&nbsp;<span class="ident" id="5393647"><a href="/image/jpeg/huffman.go.html#5393627">n</a></span>&nbsp;<span class="op" id="5393649">&gt;</span>&nbsp;<span class="num" id="5393651">0</span>&nbsp;<span class="op" id="5393653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393657">if</span>&nbsp;<span class="ident" id="5393660"><a href="/image/jpeg/huffman.go.html#5393627">n</a></span>&nbsp;<span class="op" id="5393662">&lt;</span>&nbsp;<span class="num" id="5393664">17</span>&nbsp;<span class="op" id="5393667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393672">return</span>&nbsp;<span class="ident" id="5393679"><a href="/image/jpeg/reader.go.html#5402996">FormatError</a></span><span class="op" id="5393690">(</span><span class="string" id="5393691">&#34;DHT&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="5393713">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393721">if</span>&nbsp;<span class="ident" id="5393724">err</span>&nbsp;<span class="op" id="5393728">:=</span>&nbsp;<span class="ident" id="5393731"><a href="/image/jpeg/huffman.go.html#5393604">d</a></span><span class="op" id="5393732">.</span><span class="ident" id="5393733">readFull</span><span class="op" id="5393741">(</span><span class="ident" id="5393742"><a href="/image/jpeg/huffman.go.html#5393604">d</a></span><span class="op" id="5393743">.</span><span class="ident" id="5393744">tmp</span><span class="op" id="5393747">[</span><span class="op" id="5393748">:</span><span class="num" id="5393749">17</span><span class="op" id="5393751">]</span><span class="op" id="5393752">)</span><span class="op" id="5393753">;</span>&nbsp;<span class="ident" id="5393755"><a href="/image/jpeg/huffman.go.html#5393724">err</a></span>&nbsp;<span class="op" id="5393759">!=</span>&nbsp;<span class="ident" id="5393762">nil</span>&nbsp;<span class="op" id="5393766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393771">return</span>&nbsp;<span class="ident" id="5393778"><a href="/image/jpeg/huffman.go.html#5393724">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393788">tc</span>&nbsp;<span class="op" id="5393791">:=</span>&nbsp;<span class="ident" id="5393794"><a href="/image/jpeg/huffman.go.html#5393604">d</a></span><span class="op" id="5393795">.</span><span class="ident" id="5393796">tmp</span><span class="op" id="5393799">[</span><span class="num" id="5393800">0</span><span class="op" id="5393801">]</span>&nbsp;<span class="op" id="5393803">&gt;&gt;</span>&nbsp;<span class="num" id="5393806">4</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393810">if</span>&nbsp;<span class="ident" id="5393813"><a href="/image/jpeg/huffman.go.html#5393788">tc</a></span>&nbsp;<span class="op" id="5393816">&gt;</span>&nbsp;<span class="ident" id="5393818"><a href="/image/jpeg/reader.go.html#5403602">maxTc</a></span>&nbsp;<span class="op" id="5393824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393829">return</span>&nbsp;<span class="ident" id="5393836"><a href="/image/jpeg/reader.go.html#5402996">FormatError</a></span><span class="op" id="5393847">(</span><span class="string" id="5393848">&#34;bad&nbsp;Tc&nbsp;value&#34;</span><span class="op" id="5393862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393870">th</span>&nbsp;<span class="op" id="5393873">:=</span>&nbsp;<span class="ident" id="5393876"><a href="/image/jpeg/huffman.go.html#5393604">d</a></span><span class="op" id="5393877">.</span><span class="ident" id="5393878">tmp</span><span class="op" id="5393881">[</span><span class="num" id="5393882">0</span><span class="op" id="5393883">]</span>&nbsp;<span class="op" id="5393885">&amp;</span>&nbsp;<span class="num" id="5393887">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393894">if</span>&nbsp;<span class="ident" id="5393897"><a href="/image/jpeg/huffman.go.html#5393870">th</a></span>&nbsp;<span class="op" id="5393900">&gt;</span>&nbsp;<span class="ident" id="5393902"><a href="/image/jpeg/reader.go.html#5403615">maxTh</a></span>&nbsp;<span class="op" id="5393908">||</span>&nbsp;<span class="op" id="5393911">!</span><span class="ident" id="5393912"><a href="/image/jpeg/huffman.go.html#5393604">d</a></span><span class="op" id="5393913">.</span><span class="ident" id="5393914">progressive</span>&nbsp;<span class="op" id="5393926">&amp;&amp;</span>&nbsp;<span class="ident" id="5393929"><a href="/image/jpeg/huffman.go.html#5393870">th</a></span>&nbsp;<span class="op" id="5393932">&gt;</span>&nbsp;<span class="num" id="5393934">1</span>&nbsp;<span class="op" id="5393936">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393941">return</span>&nbsp;<span class="ident" id="5393948"><a href="/image/jpeg/reader.go.html#5402996">FormatError</a></span><span class="op" id="5393959">(</span><span class="string" id="5393960">&#34;bad&nbsp;Th&nbsp;value&#34;</span><span class="op" id="5393974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393982">h</span>&nbsp;<span class="op" id="5393984">:=</span>&nbsp;<span class="op" id="5393987">&amp;</span><span class="ident" id="5393988"><a href="/image/jpeg/huffman.go.html#5393604">d</a></span><span class="op" id="5393989">.</span><span class="ident" id="5393990">huff</span><span class="op" id="5393994">[</span><span class="ident" id="5393995"><a href="/image/jpeg/huffman.go.html#5393788">tc</a></span><span class="op" id="5393997">]</span><span class="op" id="5393998">[</span><span class="ident" id="5393999"><a href="/image/jpeg/huffman.go.html#5393870">th</a></span><span class="op" id="5394001">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394006">//&nbsp;Read&nbsp;nCodes&nbsp;and&nbsp;h.vals&nbsp;(and&nbsp;derive&nbsp;h.nCodes).</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394057">//&nbsp;nCodes[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;with&nbsp;code&nbsp;length&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394115">//&nbsp;h.nCodes&nbsp;is&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394159"><a href="/image/jpeg/huffman.go.html#5393982">h</a></span><span class="op" id="5394160">.</span><span class="ident" id="5394161">nCodes</span>&nbsp;<span class="op" id="5394168">=</span>&nbsp;<span class="num" id="5394170">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394174">var</span>&nbsp;<span class="ident" id="5394178">nCodes</span>&nbsp;<span class="op" id="5394185">[</span><span class="ident" id="5394186"><a href="/image/jpeg/huffman.go.html#5391252">maxCodeLength</a></span><span class="op" id="5394199">]</span><span class="builtintype" id="5394200">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394208">for</span>&nbsp;<span class="ident" id="5394212">i</span>&nbsp;<span class="op" id="5394214">:=</span>&nbsp;<span class="keyword" id="5394217">range</span>&nbsp;<span class="ident" id="5394223"><a href="/image/jpeg/huffman.go.html#5394178">nCodes</a></span>&nbsp;<span class="op" id="5394230">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394235"><a href="/image/jpeg/huffman.go.html#5394178">nCodes</a></span><span class="op" id="5394241">[</span><span class="ident" id="5394242"><a href="/image/jpeg/huffman.go.html#5394212">i</a></span><span class="op" id="5394243">]</span>&nbsp;<span class="op" id="5394245">=</span>&nbsp;<span class="builtintype" id="5394247">int32</span><span class="op" id="5394252">(</span><span class="ident" id="5394253"><a href="/image/jpeg/huffman.go.html#5393604">d</a></span><span class="op" id="5394254">.</span><span class="ident" id="5394255">tmp</span><span class="op" id="5394258">[</span><span class="ident" id="5394259"><a href="/image/jpeg/huffman.go.html#5394212">i</a></span><span class="op" id="5394260">+</span><span class="num" id="5394261">1</span><span class="op" id="5394262">]</span><span class="op" id="5394263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394268"><a href="/image/jpeg/huffman.go.html#5393982">h</a></span><span class="op" id="5394269">.</span><span class="ident" id="5394270">nCodes</span>&nbsp;<span class="op" id="5394277">+=</span>&nbsp;<span class="ident" id="5394280"><a href="/image/jpeg/huffman.go.html#5394178">nCodes</a></span><span class="op" id="5394286">[</span><span class="ident" id="5394287"><a href="/image/jpeg/huffman.go.html#5394212">i</a></span><span class="op" id="5394288">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5394292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394296">if</span>&nbsp;<span class="ident" id="5394299"><a href="/image/jpeg/huffman.go.html#5393982">h</a></span><span class="op" id="5394300">.</span><span class="ident" id="5394301">nCodes</span>&nbsp;<span class="op" id="5394308">==</span>&nbsp;<span class="num" id="5394311">0</span>&nbsp;<span class="op" id="5394313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394318">return</span>&nbsp;<span class="ident" id="5394325"><a href="/image/jpeg/reader.go.html#5402996">FormatError</a></span><span class="op" id="5394336">(</span><span class="string" id="5394337">&#34;Huffman&nbsp;table&nbsp;has&nbsp;zero&nbsp;length&#34;</span><span class="op" id="5394368">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5394372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394376">if</span>&nbsp;<span class="ident" id="5394379"><a href="/image/jpeg/huffman.go.html#5393982">h</a></span><span class="op" id="5394380">.</span><span class="ident" id="5394381">nCodes</span>&nbsp;<span class="op" id="5394388">&gt;</span>&nbsp;<span class="ident" id="5394390"><a href="/image/jpeg/huffman.go.html#5391353">maxNCodes</a></span>&nbsp;<span class="op" id="5394400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394405">return</span>&nbsp;<span class="ident" id="5394412"><a href="/image/jpeg/reader.go.html#5402996">FormatError</a></span><span class="op" id="5394423">(</span><span class="string" id="5394424">&#34;Huffman&nbsp;table&nbsp;has&nbsp;excessive&nbsp;length&#34;</span><span class="op" id="5394460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5394464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394468"><a href="/image/jpeg/huffman.go.html#5393627">n</a></span>&nbsp;<span class="op" id="5394470">-=</span>&nbsp;<span class="builtintype" id="5394473">int</span><span class="op" id="5394476">(</span><span class="ident" id="5394477"><a href="/image/jpeg/huffman.go.html#5393982">h</a></span><span class="op" id="5394478">.</span><span class="ident" id="5394479">nCodes</span><span class="op" id="5394485">)</span>&nbsp;<span class="op" id="5394487">+</span>&nbsp;<span class="num" id="5394489">17</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394494">if</span>&nbsp;<span class="ident" id="5394497"><a href="/image/jpeg/huffman.go.html#5393627">n</a></span>&nbsp;<span class="op" id="5394499">&lt;</span>&nbsp;<span class="num" id="5394501">0</span>&nbsp;<span class="op" id="5394503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394508">return</span>&nbsp;<span class="ident" id="5394515"><a href="/image/jpeg/reader.go.html#5402996">FormatError</a></span><span class="op" id="5394526">(</span><span class="string" id="5394527">&#34;DHT&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="5394549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5394553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394557">if</span>&nbsp;<span class="ident" id="5394560">err</span>&nbsp;<span class="op" id="5394564">:=</span>&nbsp;<span class="ident" id="5394567"><a href="/image/jpeg/huffman.go.html#5393604">d</a></span><span class="op" id="5394568">.</span><span class="ident" id="5394569">readFull</span><span class="op" id="5394577">(</span><span class="ident" id="5394578"><a href="/image/jpeg/huffman.go.html#5393982">h</a></span><span class="op" id="5394579">.</span><span class="ident" id="5394580">vals</span><span class="op" id="5394584">[</span><span class="op" id="5394585">:</span><span class="ident" id="5394586"><a href="/image/jpeg/huffman.go.html#5393982">h</a></span><span class="op" id="5394587">.</span><span class="ident" id="5394588">nCodes</span><span class="op" id="5394594">]</span><span class="op" id="5394595">)</span><span class="op" id="5394596">;</span>&nbsp;<span class="ident" id="5394598"><a href="/image/jpeg/huffman.go.html#5394560">err</a></span>&nbsp;<span class="op" id="5394602">!=</span>&nbsp;<span class="ident" id="5394605">nil</span>&nbsp;<span class="op" id="5394609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394614">return</span>&nbsp;<span class="ident" id="5394621"><a href="/image/jpeg/huffman.go.html#5394560">err</a></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5394627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394632">//&nbsp;Derive&nbsp;the&nbsp;look-up&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394663">for</span>&nbsp;<span class="ident" id="5394667">i</span>&nbsp;<span class="op" id="5394669">:=</span>&nbsp;<span class="keyword" id="5394672">range</span>&nbsp;<span class="ident" id="5394678"><a href="/image/jpeg/huffman.go.html#5393982">h</a></span><span class="op" id="5394679">.</span><span class="ident" id="5394680">lut</span>&nbsp;<span class="op" id="5394684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394689"><a href="/image/jpeg/huffman.go.html#5393982">h</a></span><span class="op" id="5394690">.</span><span class="ident" id="5394691">lut</span><span class="op" id="5394694">[</span><span class="ident" id="5394695"><a href="/image/jpeg/huffman.go.html#5394667">i</a></span><span class="op" id="5394696">]</span>&nbsp;<span class="op" id="5394698">=</span>&nbsp;<span class="num" id="5394700">0</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5394704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394708">var</span>&nbsp;<span class="ident" id="5394712">x</span><span class="op" id="5394713">,</span>&nbsp;<span class="ident" id="5394715">code</span>&nbsp;<span class="builtintype" id="5394720">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394729">for</span>&nbsp;<span class="ident" id="5394733">i</span>&nbsp;<span class="op" id="5394735">:=</span>&nbsp;<span class="builtintype" id="5394738">uint32</span><span class="op" id="5394744">(</span><span class="num" id="5394745">0</span><span class="op" id="5394746">)</span><span class="op" id="5394747">;</span>&nbsp;<span class="ident" id="5394749"><a href="/image/jpeg/huffman.go.html#5394733">i</a></span>&nbsp;<span class="op" id="5394751">&lt;</span>&nbsp;<span class="ident" id="5394753"><a href="/image/jpeg/huffman.go.html#5391445">lutSize</a></span><span class="op" id="5394760">;</span>&nbsp;<span class="ident" id="5394762"><a href="/image/jpeg/huffman.go.html#5394733">i</a></span><span class="op" id="5394763">++</span>&nbsp;<span class="op" id="5394766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394771"><a href="/image/jpeg/huffman.go.html#5394715">code</a></span>&nbsp;<span class="op" id="5394776">&lt;&lt;=</span>&nbsp;<span class="num" id="5394780">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394785">for</span>&nbsp;<span class="ident" id="5394789">j</span>&nbsp;<span class="op" id="5394791">:=</span>&nbsp;<span class="builtintype" id="5394794">int32</span><span class="op" id="5394799">(</span><span class="num" id="5394800">0</span><span class="op" id="5394801">)</span><span class="op" id="5394802">;</span>&nbsp;<span class="ident" id="5394804"><a href="/image/jpeg/huffman.go.html#5394789">j</a></span>&nbsp;<span class="op" id="5394806">&lt;</span>&nbsp;<span class="ident" id="5394808"><a href="/image/jpeg/huffman.go.html#5394178">nCodes</a></span><span class="op" id="5394814">[</span><span class="ident" id="5394815"><a href="/image/jpeg/huffman.go.html#5394733">i</a></span><span class="op" id="5394816">]</span><span class="op" id="5394817">;</span>&nbsp;<span class="ident" id="5394819"><a href="/image/jpeg/huffman.go.html#5394789">j</a></span><span class="op" id="5394820">++</span>&nbsp;<span class="op" id="5394823">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394829">//&nbsp;The&nbsp;codeLength&nbsp;is&nbsp;1+i,&nbsp;so&nbsp;shift&nbsp;code&nbsp;by&nbsp;8-(1+i)&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394887">//&nbsp;calculate&nbsp;the&nbsp;high&nbsp;bits&nbsp;for&nbsp;every&nbsp;8-bit&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394943">//&nbsp;whose&nbsp;codeLength&#39;s&nbsp;high&nbsp;bits&nbsp;matches&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394993">//&nbsp;The&nbsp;high&nbsp;8&nbsp;bits&nbsp;of&nbsp;lutValue&nbsp;are&nbsp;the&nbsp;encoded&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395051">//&nbsp;The&nbsp;low&nbsp;8&nbsp;bits&nbsp;are&nbsp;1&nbsp;plus&nbsp;the&nbsp;codeLength.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395100">base</span>&nbsp;<span class="op" id="5395105">:=</span>&nbsp;<span class="builtintype" id="5395108">uint8</span><span class="op" id="5395113">(</span><span class="ident" id="5395114"><a href="/image/jpeg/huffman.go.html#5394715">code</a></span>&nbsp;<span class="op" id="5395119">&lt;&lt;</span>&nbsp;<span class="op" id="5395122">(</span><span class="num" id="5395123">7</span>&nbsp;<span class="op" id="5395125">-</span>&nbsp;<span class="ident" id="5395127"><a href="/image/jpeg/huffman.go.html#5394733">i</a></span><span class="op" id="5395128">)</span><span class="op" id="5395129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395135">lutValue</span>&nbsp;<span class="op" id="5395144">:=</span>&nbsp;<span class="builtintype" id="5395147">uint16</span><span class="op" id="5395153">(</span><span class="ident" id="5395154"><a href="/image/jpeg/huffman.go.html#5393982">h</a></span><span class="op" id="5395155">.</span><span class="ident" id="5395156">vals</span><span class="op" id="5395160">[</span><span class="ident" id="5395161"><a href="/image/jpeg/huffman.go.html#5394712">x</a></span><span class="op" id="5395162">]</span><span class="op" id="5395163">)</span><span class="op" id="5395164">&lt;&lt;</span><span class="num" id="5395166">8</span>&nbsp;<span class="op" id="5395168">|</span>&nbsp;<span class="builtintype" id="5395170">uint16</span><span class="op" id="5395176">(</span><span class="num" id="5395177">2</span><span class="op" id="5395178">+</span><span class="ident" id="5395179"><a href="/image/jpeg/huffman.go.html#5394733">i</a></span><span class="op" id="5395180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395186">for</span>&nbsp;<span class="ident" id="5395190">k</span>&nbsp;<span class="op" id="5395192">:=</span>&nbsp;<span class="builtintype" id="5395195">uint8</span><span class="op" id="5395200">(</span><span class="num" id="5395201">0</span><span class="op" id="5395202">)</span><span class="op" id="5395203">;</span>&nbsp;<span class="ident" id="5395205"><a href="/image/jpeg/huffman.go.html#5395190">k</a></span>&nbsp;<span class="op" id="5395207">&lt;</span>&nbsp;<span class="num" id="5395209">1</span><span class="op" id="5395210">&lt;&lt;</span><span class="op" id="5395212">(</span><span class="num" id="5395213">7</span><span class="op" id="5395214">-</span><span class="ident" id="5395215"><a href="/image/jpeg/huffman.go.html#5394733">i</a></span><span class="op" id="5395216">)</span><span class="op" id="5395217">;</span>&nbsp;<span class="ident" id="5395219"><a href="/image/jpeg/huffman.go.html#5395190">k</a></span><span class="op" id="5395220">++</span>&nbsp;<span class="op" id="5395223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395230"><a href="/image/jpeg/huffman.go.html#5393982">h</a></span><span class="op" id="5395231">.</span><span class="ident" id="5395232">lut</span><span class="op" id="5395235">[</span><span class="ident" id="5395236"><a href="/image/jpeg/huffman.go.html#5395100">base</a></span><span class="op" id="5395240">|</span><span class="ident" id="5395241"><a href="/image/jpeg/huffman.go.html#5395190">k</a></span><span class="op" id="5395242">]</span>&nbsp;<span class="op" id="5395244">=</span>&nbsp;<span class="ident" id="5395246"><a href="/image/jpeg/huffman.go.html#5395135">lutValue</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5395259">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395265"><a href="/image/jpeg/huffman.go.html#5394715">code</a></span><span class="op" id="5395269">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395276"><a href="/image/jpeg/huffman.go.html#5394712">x</a></span><span class="op" id="5395277">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5395283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5395287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395292">//&nbsp;Derive&nbsp;minCodes,&nbsp;maxCodes,&nbsp;and&nbsp;valsIndices.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395341">var</span>&nbsp;<span class="ident" id="5395345">c</span><span class="op" id="5395346">,</span>&nbsp;<span class="ident" id="5395348">index</span>&nbsp;<span class="builtintype" id="5395354">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395362">for</span>&nbsp;<span class="ident" id="5395366">i</span><span class="op" id="5395367">,</span>&nbsp;<span class="ident" id="5395369">n</span>&nbsp;<span class="op" id="5395371">:=</span>&nbsp;<span class="keyword" id="5395374">range</span>&nbsp;<span class="ident" id="5395380"><a href="/image/jpeg/huffman.go.html#5394178">nCodes</a></span>&nbsp;<span class="op" id="5395387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395392">if</span>&nbsp;<span class="ident" id="5395395"><a href="/image/jpeg/huffman.go.html#5395369">n</a></span>&nbsp;<span class="op" id="5395397">==</span>&nbsp;<span class="num" id="5395400">0</span>&nbsp;<span class="op" id="5395402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395408"><a href="/image/jpeg/huffman.go.html#5393982">h</a></span><span class="op" id="5395409">.</span><span class="ident" id="5395410">minCodes</span><span class="op" id="5395418">[</span><span class="ident" id="5395419"><a href="/image/jpeg/huffman.go.html#5395366">i</a></span><span class="op" id="5395420">]</span>&nbsp;<span class="op" id="5395422">=</span>&nbsp;<span class="op" id="5395424">-</span><span class="num" id="5395425">1</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395431"><a href="/image/jpeg/huffman.go.html#5393982">h</a></span><span class="op" id="5395432">.</span><span class="ident" id="5395433">maxCodes</span><span class="op" id="5395441">[</span><span class="ident" id="5395442"><a href="/image/jpeg/huffman.go.html#5395366">i</a></span><span class="op" id="5395443">]</span>&nbsp;<span class="op" id="5395445">=</span>&nbsp;<span class="op" id="5395447">-</span><span class="num" id="5395448">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395454"><a href="/image/jpeg/huffman.go.html#5393982">h</a></span><span class="op" id="5395455">.</span><span class="ident" id="5395456">valsIndices</span><span class="op" id="5395467">[</span><span class="ident" id="5395468"><a href="/image/jpeg/huffman.go.html#5395366">i</a></span><span class="op" id="5395469">]</span>&nbsp;<span class="op" id="5395471">=</span>&nbsp;<span class="op" id="5395473">-</span><span class="num" id="5395474">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5395479">}</span>&nbsp;<span class="keyword" id="5395481">else</span>&nbsp;<span class="op" id="5395486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395492"><a href="/image/jpeg/huffman.go.html#5393982">h</a></span><span class="op" id="5395493">.</span><span class="ident" id="5395494">minCodes</span><span class="op" id="5395502">[</span><span class="ident" id="5395503"><a href="/image/jpeg/huffman.go.html#5395366">i</a></span><span class="op" id="5395504">]</span>&nbsp;<span class="op" id="5395506">=</span>&nbsp;<span class="ident" id="5395508"><a href="/image/jpeg/huffman.go.html#5395345">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395514"><a href="/image/jpeg/huffman.go.html#5393982">h</a></span><span class="op" id="5395515">.</span><span class="ident" id="5395516">maxCodes</span><span class="op" id="5395524">[</span><span class="ident" id="5395525"><a href="/image/jpeg/huffman.go.html#5395366">i</a></span><span class="op" id="5395526">]</span>&nbsp;<span class="op" id="5395528">=</span>&nbsp;<span class="ident" id="5395530"><a href="/image/jpeg/huffman.go.html#5395345">c</a></span>&nbsp;<span class="op" id="5395532">+</span>&nbsp;<span class="ident" id="5395534"><a href="/image/jpeg/huffman.go.html#5395369">n</a></span>&nbsp;<span class="op" id="5395536">-</span>&nbsp;<span class="num" id="5395538">1</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395544"><a href="/image/jpeg/huffman.go.html#5393982">h</a></span><span class="op" id="5395545">.</span><span class="ident" id="5395546">valsIndices</span><span class="op" id="5395557">[</span><span class="ident" id="5395558"><a href="/image/jpeg/huffman.go.html#5395366">i</a></span><span class="op" id="5395559">]</span>&nbsp;<span class="op" id="5395561">=</span>&nbsp;<span class="ident" id="5395563"><a href="/image/jpeg/huffman.go.html#5395348">index</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395573"><a href="/image/jpeg/huffman.go.html#5395345">c</a></span>&nbsp;<span class="op" id="5395575">+=</span>&nbsp;<span class="ident" id="5395578"><a href="/image/jpeg/huffman.go.html#5395369">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395584"><a href="/image/jpeg/huffman.go.html#5395348">index</a></span>&nbsp;<span class="op" id="5395590">+=</span>&nbsp;<span class="ident" id="5395593"><a href="/image/jpeg/huffman.go.html#5395369">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5395598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395603"><a href="/image/jpeg/huffman.go.html#5395345">c</a></span>&nbsp;<span class="op" id="5395605">&lt;&lt;=</span>&nbsp;<span class="num" id="5395609">1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5395613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5395616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395619">return</span>&nbsp;<span class="ident" id="5395626">nil</span><br>
<span class="lineno"></span><span class="op" id="5395630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5395633">//&nbsp;decodeHuffman&nbsp;returns&nbsp;the&nbsp;next&nbsp;Huffman-coded&nbsp;value&nbsp;from&nbsp;the&nbsp;bit-stream,</span><br>
<span class="lineno"></span><span class="comment" id="5395708">//&nbsp;decoded&nbsp;according&nbsp;to&nbsp;h.</span><br>
<span class="lineno"></span><span class="keyword" id="5395735">func</span>&nbsp;<span class="op" id="5395740">(</span><span class="ident" id="5395741">d</span>&nbsp;<span class="op" id="5395743">*</span><span class="ident" id="5395744"><a href="/image/jpeg/reader.go.html#5405509">decoder</a></span><span class="op" id="5395751">)</span>&nbsp;<span class="ident" id="5395753">decodeHuffman</span><span class="op" id="5395766">(</span><span class="ident" id="5395767">h</span>&nbsp;<span class="op" id="5395769">*</span><span class="ident" id="5395770"><a href="/image/jpeg/huffman.go.html#5391520">huffman</a></span><span class="op" id="5395777">)</span>&nbsp;<span class="op" id="5395779">(</span><span class="builtintype" id="5395780">uint8</span><span class="op" id="5395785">,</span>&nbsp;<span class="builtintype" id="5395787">error</span><span class="op" id="5395792">)</span>&nbsp;<span class="op" id="5395794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395797">if</span>&nbsp;<span class="ident" id="5395800"><a href="/image/jpeg/huffman.go.html#5395767">h</a></span><span class="op" id="5395801">.</span><span class="ident" id="5395802">nCodes</span>&nbsp;<span class="op" id="5395809">==</span>&nbsp;<span class="num" id="5395812">0</span>&nbsp;<span class="op" id="5395814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395818">return</span>&nbsp;<span class="num" id="5395825">0</span><span class="op" id="5395826">,</span>&nbsp;<span class="ident" id="5395828"><a href="/image/jpeg/reader.go.html#5402996">FormatError</a></span><span class="op" id="5395839">(</span><span class="string" id="5395840">&#34;uninitialized&nbsp;Huffman&nbsp;table&#34;</span><span class="op" id="5395869">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5395872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395876">if</span>&nbsp;<span class="ident" id="5395879"><a href="/image/jpeg/huffman.go.html#5395741">d</a></span><span class="op" id="5395880">.</span><span class="ident" id="5395881">bits</span><span class="op" id="5395885">.</span><span class="ident" id="5395886">n</span>&nbsp;<span class="op" id="5395888">&lt;</span>&nbsp;<span class="num" id="5395890">8</span>&nbsp;<span class="op" id="5395892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395896">if</span>&nbsp;<span class="ident" id="5395899">err</span>&nbsp;<span class="op" id="5395903">:=</span>&nbsp;<span class="ident" id="5395906"><a href="/image/jpeg/huffman.go.html#5395741">d</a></span><span class="op" id="5395907">.</span><span class="ident" id="5395908">ensureNBits</span><span class="op" id="5395919">(</span><span class="num" id="5395920">8</span><span class="op" id="5395921">)</span><span class="op" id="5395922">;</span>&nbsp;<span class="ident" id="5395924"><a href="/image/jpeg/huffman.go.html#5395899">err</a></span>&nbsp;<span class="op" id="5395928">!=</span>&nbsp;<span class="ident" id="5395931">nil</span>&nbsp;<span class="op" id="5395935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395940">if</span>&nbsp;<span class="ident" id="5395943"><a href="/image/jpeg/huffman.go.html#5395899">err</a></span>&nbsp;<span class="op" id="5395947">!=</span>&nbsp;<span class="ident" id="5395950"><a href="/image/jpeg/reader.go.html#5408327">errMissingFF00</a></span>&nbsp;<span class="op" id="5395965">&amp;&amp;</span>&nbsp;<span class="ident" id="5395968"><a href="/image/jpeg/huffman.go.html#5395899">err</a></span>&nbsp;<span class="op" id="5395972">!=</span>&nbsp;<span class="ident" id="5395975"><a href="/image/jpeg/huffman.go.html#5392391">errShortHuffmanData</a></span>&nbsp;<span class="op" id="5395995">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396001">return</span>&nbsp;<span class="num" id="5396008">0</span><span class="op" id="5396009">,</span>&nbsp;<span class="ident" id="5396011"><a href="/image/jpeg/huffman.go.html#5395899">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5396023">//&nbsp;There&nbsp;are&nbsp;no&nbsp;more&nbsp;bytes&nbsp;of&nbsp;data&nbsp;in&nbsp;this&nbsp;segment,&nbsp;but&nbsp;we&nbsp;may&nbsp;still</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5396095">//&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;the&nbsp;next&nbsp;symbol&nbsp;out&nbsp;of&nbsp;the&nbsp;previously&nbsp;read&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5396166">//&nbsp;First,&nbsp;undo&nbsp;the&nbsp;readByte&nbsp;that&nbsp;the&nbsp;ensureNBits&nbsp;call&nbsp;made.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396229"><a href="/image/jpeg/huffman.go.html#5395741">d</a></span><span class="op" id="5396230">.</span><span class="ident" id="5396231">unreadByteStuffedByte</span><span class="op" id="5396252">(</span><span class="op" id="5396253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396258">goto</span>&nbsp;<span class="ident" id="5396263">slowPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396280">if</span>&nbsp;<span class="ident" id="5396283">v</span>&nbsp;<span class="op" id="5396285">:=</span>&nbsp;<span class="ident" id="5396288"><a href="/image/jpeg/huffman.go.html#5395767">h</a></span><span class="op" id="5396289">.</span><span class="ident" id="5396290">lut</span><span class="op" id="5396293">[</span><span class="op" id="5396294">(</span><span class="ident" id="5396295"><a href="/image/jpeg/huffman.go.html#5395741">d</a></span><span class="op" id="5396296">.</span><span class="ident" id="5396297">bits</span><span class="op" id="5396301">.</span><span class="ident" id="5396302">a</span><span class="op" id="5396303">&gt;&gt;</span><span class="builtintype" id="5396305">uint32</span><span class="op" id="5396311">(</span><span class="ident" id="5396312"><a href="/image/jpeg/huffman.go.html#5395741">d</a></span><span class="op" id="5396313">.</span><span class="ident" id="5396314">bits</span><span class="op" id="5396318">.</span><span class="ident" id="5396319">n</span><span class="op" id="5396320">-</span><span class="ident" id="5396321"><a href="/image/jpeg/huffman.go.html#5391445">lutSize</a></span><span class="op" id="5396328">)</span><span class="op" id="5396329">)</span><span class="op" id="5396330">&amp;</span><span class="num" id="5396331">0xff</span><span class="op" id="5396335">]</span><span class="op" id="5396336">;</span>&nbsp;<span class="ident" id="5396338"><a href="/image/jpeg/huffman.go.html#5396283">v</a></span>&nbsp;<span class="op" id="5396340">!=</span>&nbsp;<span class="num" id="5396343">0</span>&nbsp;<span class="op" id="5396345">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396349">n</span>&nbsp;<span class="op" id="5396351">:=</span>&nbsp;<span class="op" id="5396354">(</span><span class="ident" id="5396355"><a href="/image/jpeg/huffman.go.html#5396283">v</a></span>&nbsp;<span class="op" id="5396357">&amp;</span>&nbsp;<span class="num" id="5396359">0xff</span><span class="op" id="5396363">)</span>&nbsp;<span class="op" id="5396365">-</span>&nbsp;<span class="num" id="5396367">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396371"><a href="/image/jpeg/huffman.go.html#5395741">d</a></span><span class="op" id="5396372">.</span><span class="ident" id="5396373">bits</span><span class="op" id="5396377">.</span><span class="ident" id="5396378">n</span>&nbsp;<span class="op" id="5396380">-=</span>&nbsp;<span class="builtintype" id="5396383">int32</span><span class="op" id="5396388">(</span><span class="ident" id="5396389"><a href="/image/jpeg/huffman.go.html#5396349">n</a></span><span class="op" id="5396390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396394"><a href="/image/jpeg/huffman.go.html#5395741">d</a></span><span class="op" id="5396395">.</span><span class="ident" id="5396396">bits</span><span class="op" id="5396400">.</span><span class="ident" id="5396401">m</span>&nbsp;<span class="op" id="5396403">&gt;&gt;=</span>&nbsp;<span class="ident" id="5396407"><a href="/image/jpeg/huffman.go.html#5396349">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396411">return</span>&nbsp;<span class="builtintype" id="5396418">uint8</span><span class="op" id="5396423">(</span><span class="ident" id="5396424"><a href="/image/jpeg/huffman.go.html#5396283">v</a></span>&nbsp;<span class="op" id="5396426">&gt;&gt;</span>&nbsp;<span class="num" id="5396429">8</span><span class="op" id="5396430">)</span><span class="op" id="5396431">,</span>&nbsp;<span class="ident" id="5396433">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396438">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="ident" id="5396441">slowPath</span><span class="op" id="5396449">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396452">for</span>&nbsp;<span class="ident" id="5396456">i</span><span class="op" id="5396457">,</span>&nbsp;<span class="ident" id="5396459">code</span>&nbsp;<span class="op" id="5396464">:=</span>&nbsp;<span class="num" id="5396467">0</span><span class="op" id="5396468">,</span>&nbsp;<span class="builtintype" id="5396470">int32</span><span class="op" id="5396475">(</span><span class="num" id="5396476">0</span><span class="op" id="5396477">)</span><span class="op" id="5396478">;</span>&nbsp;<span class="ident" id="5396480"><a href="/image/jpeg/huffman.go.html#5396456">i</a></span>&nbsp;<span class="op" id="5396482">&lt;</span>&nbsp;<span class="ident" id="5396484"><a href="/image/jpeg/huffman.go.html#5391252">maxCodeLength</a></span><span class="op" id="5396497">;</span>&nbsp;<span class="ident" id="5396499"><a href="/image/jpeg/huffman.go.html#5396456">i</a></span><span class="op" id="5396500">++</span>&nbsp;<span class="op" id="5396503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396507">if</span>&nbsp;<span class="ident" id="5396510"><a href="/image/jpeg/huffman.go.html#5395741">d</a></span><span class="op" id="5396511">.</span><span class="ident" id="5396512">bits</span><span class="op" id="5396516">.</span><span class="ident" id="5396517">n</span>&nbsp;<span class="op" id="5396519">==</span>&nbsp;<span class="num" id="5396522">0</span>&nbsp;<span class="op" id="5396524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396529">if</span>&nbsp;<span class="ident" id="5396532">err</span>&nbsp;<span class="op" id="5396536">:=</span>&nbsp;<span class="ident" id="5396539"><a href="/image/jpeg/huffman.go.html#5395741">d</a></span><span class="op" id="5396540">.</span><span class="ident" id="5396541">ensureNBits</span><span class="op" id="5396552">(</span><span class="num" id="5396553">1</span><span class="op" id="5396554">)</span><span class="op" id="5396555">;</span>&nbsp;<span class="ident" id="5396557"><a href="/image/jpeg/huffman.go.html#5396532">err</a></span>&nbsp;<span class="op" id="5396561">!=</span>&nbsp;<span class="ident" id="5396564">nil</span>&nbsp;<span class="op" id="5396568">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396574">return</span>&nbsp;<span class="num" id="5396581">0</span><span class="op" id="5396582">,</span>&nbsp;<span class="ident" id="5396584"><a href="/image/jpeg/huffman.go.html#5396532">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396599">if</span>&nbsp;<span class="ident" id="5396602"><a href="/image/jpeg/huffman.go.html#5395741">d</a></span><span class="op" id="5396603">.</span><span class="ident" id="5396604">bits</span><span class="op" id="5396608">.</span><span class="ident" id="5396609">a</span><span class="op" id="5396610">&amp;</span><span class="ident" id="5396611"><a href="/image/jpeg/huffman.go.html#5395741">d</a></span><span class="op" id="5396612">.</span><span class="ident" id="5396613">bits</span><span class="op" id="5396617">.</span><span class="ident" id="5396618">m</span>&nbsp;<span class="op" id="5396620">!=</span>&nbsp;<span class="num" id="5396623">0</span>&nbsp;<span class="op" id="5396625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396630"><a href="/image/jpeg/huffman.go.html#5396459">code</a></span>&nbsp;<span class="op" id="5396635">|=</span>&nbsp;<span class="num" id="5396638">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396646"><a href="/image/jpeg/huffman.go.html#5395741">d</a></span><span class="op" id="5396647">.</span><span class="ident" id="5396648">bits</span><span class="op" id="5396652">.</span><span class="ident" id="5396653">n</span><span class="op" id="5396654">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396659"><a href="/image/jpeg/huffman.go.html#5395741">d</a></span><span class="op" id="5396660">.</span><span class="ident" id="5396661">bits</span><span class="op" id="5396665">.</span><span class="ident" id="5396666">m</span>&nbsp;<span class="op" id="5396668">&gt;&gt;=</span>&nbsp;<span class="num" id="5396672">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396676">if</span>&nbsp;<span class="ident" id="5396679"><a href="/image/jpeg/huffman.go.html#5396459">code</a></span>&nbsp;<span class="op" id="5396684">&lt;=</span>&nbsp;<span class="ident" id="5396687"><a href="/image/jpeg/huffman.go.html#5395767">h</a></span><span class="op" id="5396688">.</span><span class="ident" id="5396689">maxCodes</span><span class="op" id="5396697">[</span><span class="ident" id="5396698"><a href="/image/jpeg/huffman.go.html#5396456">i</a></span><span class="op" id="5396699">]</span>&nbsp;<span class="op" id="5396701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396706">return</span>&nbsp;<span class="ident" id="5396713"><a href="/image/jpeg/huffman.go.html#5395767">h</a></span><span class="op" id="5396714">.</span><span class="ident" id="5396715">vals</span><span class="op" id="5396719">[</span><span class="ident" id="5396720"><a href="/image/jpeg/huffman.go.html#5395767">h</a></span><span class="op" id="5396721">.</span><span class="ident" id="5396722">valsIndices</span><span class="op" id="5396733">[</span><span class="ident" id="5396734"><a href="/image/jpeg/huffman.go.html#5396456">i</a></span><span class="op" id="5396735">]</span><span class="op" id="5396736">+</span><span class="ident" id="5396737"><a href="/image/jpeg/huffman.go.html#5396459">code</a></span><span class="op" id="5396741">-</span><span class="ident" id="5396742"><a href="/image/jpeg/huffman.go.html#5395767">h</a></span><span class="op" id="5396743">.</span><span class="ident" id="5396744">minCodes</span><span class="op" id="5396752">[</span><span class="ident" id="5396753"><a href="/image/jpeg/huffman.go.html#5396456">i</a></span><span class="op" id="5396754">]</span><span class="op" id="5396755">]</span><span class="op" id="5396756">,</span>&nbsp;<span class="ident" id="5396758">nil</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396768"><a href="/image/jpeg/huffman.go.html#5396459">code</a></span>&nbsp;<span class="op" id="5396773">&lt;&lt;=</span>&nbsp;<span class="num" id="5396777">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396783">return</span>&nbsp;<span class="num" id="5396790">0</span><span class="op" id="5396791">,</span>&nbsp;<span class="ident" id="5396793"><a href="/image/jpeg/reader.go.html#5402996">FormatError</a></span><span class="op" id="5396804">(</span><span class="string" id="5396805">&#34;bad&nbsp;Huffman&nbsp;code&#34;</span><span class="op" id="5396823">)</span><br>
<span class="lineno"></span><span class="op" id="5396825">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="5396828">func</span>&nbsp;<span class="op" id="5396833">(</span><span class="ident" id="5396834">d</span>&nbsp;<span class="op" id="5396836">*</span><span class="ident" id="5396837"><a href="/image/jpeg/reader.go.html#5405509">decoder</a></span><span class="op" id="5396844">)</span>&nbsp;<span class="ident" id="5396846">decodeBit</span><span class="op" id="5396855">(</span><span class="op" id="5396856">)</span>&nbsp;<span class="op" id="5396858">(</span><span class="builtintype" id="5396859">bool</span><span class="op" id="5396863">,</span>&nbsp;<span class="builtintype" id="5396865">error</span><span class="op" id="5396870">)</span>&nbsp;<span class="op" id="5396872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396875">if</span>&nbsp;<span class="ident" id="5396878"><a href="/image/jpeg/huffman.go.html#5396834">d</a></span><span class="op" id="5396879">.</span><span class="ident" id="5396880">bits</span><span class="op" id="5396884">.</span><span class="ident" id="5396885">n</span>&nbsp;<span class="op" id="5396887">==</span>&nbsp;<span class="num" id="5396890">0</span>&nbsp;<span class="op" id="5396892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396896">if</span>&nbsp;<span class="ident" id="5396899">err</span>&nbsp;<span class="op" id="5396903">:=</span>&nbsp;<span class="ident" id="5396906"><a href="/image/jpeg/huffman.go.html#5396834">d</a></span><span class="op" id="5396907">.</span><span class="ident" id="5396908">ensureNBits</span><span class="op" id="5396919">(</span><span class="num" id="5396920">1</span><span class="op" id="5396921">)</span><span class="op" id="5396922">;</span>&nbsp;<span class="ident" id="5396924"><a href="/image/jpeg/huffman.go.html#5396899">err</a></span>&nbsp;<span class="op" id="5396928">!=</span>&nbsp;<span class="ident" id="5396931">nil</span>&nbsp;<span class="op" id="5396935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396940">return</span>&nbsp;<span class="ident" id="5396947">false</span><span class="op" id="5396952">,</span>&nbsp;<span class="ident" id="5396954"><a href="/image/jpeg/huffman.go.html#5396899">err</a></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396966">ret</span>&nbsp;<span class="op" id="5396970">:=</span>&nbsp;<span class="ident" id="5396973"><a href="/image/jpeg/huffman.go.html#5396834">d</a></span><span class="op" id="5396974">.</span><span class="ident" id="5396975">bits</span><span class="op" id="5396979">.</span><span class="ident" id="5396980">a</span><span class="op" id="5396981">&amp;</span><span class="ident" id="5396982"><a href="/image/jpeg/huffman.go.html#5396834">d</a></span><span class="op" id="5396983">.</span><span class="ident" id="5396984">bits</span><span class="op" id="5396988">.</span><span class="ident" id="5396989">m</span>&nbsp;<span class="op" id="5396991">!=</span>&nbsp;<span class="num" id="5396994">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396997"><a href="/image/jpeg/huffman.go.html#5396834">d</a></span><span class="op" id="5396998">.</span><span class="ident" id="5396999">bits</span><span class="op" id="5397003">.</span><span class="ident" id="5397004">n</span><span class="op" id="5397005">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397009"><a href="/image/jpeg/huffman.go.html#5396834">d</a></span><span class="op" id="5397010">.</span><span class="ident" id="5397011">bits</span><span class="op" id="5397015">.</span><span class="ident" id="5397016">m</span>&nbsp;<span class="op" id="5397018">&gt;&gt;=</span>&nbsp;<span class="num" id="5397022">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397025">return</span>&nbsp;<span class="ident" id="5397032"><a href="/image/jpeg/huffman.go.html#5396966">ret</a></span><span class="op" id="5397035">,</span>&nbsp;<span class="ident" id="5397037">nil</span><br>
<span class="lineno"></span><span class="op" id="5397041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5397044">func</span>&nbsp;<span class="op" id="5397049">(</span><span class="ident" id="5397050">d</span>&nbsp;<span class="op" id="5397052">*</span><span class="ident" id="5397053"><a href="/image/jpeg/reader.go.html#5405509">decoder</a></span><span class="op" id="5397060">)</span>&nbsp;<span class="ident" id="5397062">decodeBits</span><span class="op" id="5397072">(</span><span class="ident" id="5397073">n</span>&nbsp;<span class="builtintype" id="5397075">int32</span><span class="op" id="5397080">)</span>&nbsp;<span class="op" id="5397082">(</span><span class="builtintype" id="5397083">uint32</span><span class="op" id="5397089">,</span>&nbsp;<span class="builtintype" id="5397091">error</span><span class="op" id="5397096">)</span>&nbsp;<span class="op" id="5397098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397101">if</span>&nbsp;<span class="ident" id="5397104"><a href="/image/jpeg/huffman.go.html#5397050">d</a></span><span class="op" id="5397105">.</span><span class="ident" id="5397106">bits</span><span class="op" id="5397110">.</span><span class="ident" id="5397111">n</span>&nbsp;<span class="op" id="5397113">&lt;</span>&nbsp;<span class="ident" id="5397115"><a href="/image/jpeg/huffman.go.html#5397073">n</a></span>&nbsp;<span class="op" id="5397117">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397121">if</span>&nbsp;<span class="ident" id="5397124">err</span>&nbsp;<span class="op" id="5397128">:=</span>&nbsp;<span class="ident" id="5397131"><a href="/image/jpeg/huffman.go.html#5397050">d</a></span><span class="op" id="5397132">.</span><span class="ident" id="5397133">ensureNBits</span><span class="op" id="5397144">(</span><span class="ident" id="5397145"><a href="/image/jpeg/huffman.go.html#5397073">n</a></span><span class="op" id="5397146">)</span><span class="op" id="5397147">;</span>&nbsp;<span class="ident" id="5397149"><a href="/image/jpeg/huffman.go.html#5397124">err</a></span>&nbsp;<span class="op" id="5397153">!=</span>&nbsp;<span class="ident" id="5397156">nil</span>&nbsp;<span class="op" id="5397160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397165">return</span>&nbsp;<span class="num" id="5397172">0</span><span class="op" id="5397173">,</span>&nbsp;<span class="ident" id="5397175"><a href="/image/jpeg/huffman.go.html#5397124">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5397181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5397184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397187">ret</span>&nbsp;<span class="op" id="5397191">:=</span>&nbsp;<span class="ident" id="5397194"><a href="/image/jpeg/huffman.go.html#5397050">d</a></span><span class="op" id="5397195">.</span><span class="ident" id="5397196">bits</span><span class="op" id="5397200">.</span><span class="ident" id="5397201">a</span>&nbsp;<span class="op" id="5397203">&gt;&gt;</span>&nbsp;<span class="builtintype" id="5397206">uint32</span><span class="op" id="5397212">(</span><span class="ident" id="5397213"><a href="/image/jpeg/huffman.go.html#5397050">d</a></span><span class="op" id="5397214">.</span><span class="ident" id="5397215">bits</span><span class="op" id="5397219">.</span><span class="ident" id="5397220">n</span><span class="op" id="5397221">-</span><span class="ident" id="5397222"><a href="/image/jpeg/huffman.go.html#5397073">n</a></span><span class="op" id="5397223">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397226"><a href="/image/jpeg/huffman.go.html#5397187">ret</a></span>&nbsp;<span class="op" id="5397230">&amp;=</span>&nbsp;<span class="op" id="5397233">(</span><span class="num" id="5397234">1</span>&nbsp;<span class="op" id="5397236">&lt;&lt;</span>&nbsp;<span class="builtintype" id="5397239">uint32</span><span class="op" id="5397245">(</span><span class="ident" id="5397246"><a href="/image/jpeg/huffman.go.html#5397073">n</a></span><span class="op" id="5397247">)</span><span class="op" id="5397248">)</span>&nbsp;<span class="op" id="5397250">-</span>&nbsp;<span class="num" id="5397252">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397255"><a href="/image/jpeg/huffman.go.html#5397050">d</a></span><span class="op" id="5397256">.</span><span class="ident" id="5397257">bits</span><span class="op" id="5397261">.</span><span class="ident" id="5397262">n</span>&nbsp;<span class="op" id="5397264">-=</span>&nbsp;<span class="ident" id="5397267"><a href="/image/jpeg/huffman.go.html#5397073">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397270"><a href="/image/jpeg/huffman.go.html#5397050">d</a></span><span class="op" id="5397271">.</span><span class="ident" id="5397272">bits</span><span class="op" id="5397276">.</span><span class="ident" id="5397277">m</span>&nbsp;<span class="op" id="5397279">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="5397283">uint32</span><span class="op" id="5397289">(</span><span class="ident" id="5397290"><a href="/image/jpeg/huffman.go.html#5397073">n</a></span><span class="op" id="5397291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397294">return</span>&nbsp;<span class="ident" id="5397301"><a href="/image/jpeg/huffman.go.html#5397187">ret</a></span><span class="op" id="5397304">,</span>&nbsp;<span class="ident" id="5397306">nil</span><br>
<span class="lineno"></span><span class="op" id="5397310">}</span>
</div>
</body>
</html>
