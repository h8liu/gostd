<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/binary</h2>
<ul>
<li><a href="/gostd/encoding/binary/binary.go.html">binary.go</a></li>
<li><a href="/gostd/encoding/binary/binary_test.go.html">binary_test.go</a></li>
<li><a href="/gostd/encoding/binary/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/binary/varint.go.html" class="current">varint.go</a></li>
<li><a href="/gostd/encoding/binary/varint_test.go.html">varint_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4146010">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4146066">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4146120">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4146171">package</span>&nbsp;<span class="ident" id="4146179">binary</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4146187">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;&#34;varint&#34;&nbsp;encoding&nbsp;of&nbsp;64-bit&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="4146249">//&nbsp;The&nbsp;encoding&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="4146269">//&nbsp;-&nbsp;unsigned&nbsp;integers&nbsp;are&nbsp;serialized&nbsp;7&nbsp;bits&nbsp;at&nbsp;a&nbsp;time,&nbsp;starting&nbsp;with&nbsp;the</span><br>
<span class="lineno">10</span><span class="comment" id="4146343">//&nbsp;&nbsp;&nbsp;least&nbsp;significant&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4146371">//&nbsp;-&nbsp;the&nbsp;most&nbsp;significant&nbsp;bit&nbsp;(msb)&nbsp;in&nbsp;each&nbsp;output&nbsp;byte&nbsp;indicates&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="4146446">//&nbsp;&nbsp;&nbsp;is&nbsp;a&nbsp;continuation&nbsp;byte&nbsp;(msb&nbsp;=&nbsp;1)</span><br>
<span class="lineno"></span><span class="comment" id="4146484">//&nbsp;-&nbsp;signed&nbsp;integers&nbsp;are&nbsp;mapped&nbsp;to&nbsp;unsigned&nbsp;integers&nbsp;using&nbsp;&#34;zig-zag&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4146553">//&nbsp;&nbsp;&nbsp;encoding:&nbsp;Positive&nbsp;values&nbsp;x&nbsp;are&nbsp;written&nbsp;as&nbsp;2*x&nbsp;+&nbsp;0,&nbsp;negative&nbsp;values</span><br>
<span class="lineno">15</span><span class="comment" id="4146626">//&nbsp;&nbsp;&nbsp;are&nbsp;written&nbsp;as&nbsp;2*(^x)&nbsp;+&nbsp;1;&nbsp;that&nbsp;is,&nbsp;negative&nbsp;numbers&nbsp;are&nbsp;complemented</span><br>
<span class="lineno"></span><span class="comment" id="4146701">//&nbsp;&nbsp;&nbsp;and&nbsp;whether&nbsp;to&nbsp;complement&nbsp;is&nbsp;encoded&nbsp;in&nbsp;bit&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="4146753">//</span><br>
<span class="lineno"></span><span class="comment" id="4146756">//&nbsp;Design&nbsp;note:</span><br>
<span class="lineno"></span><span class="comment" id="4146772">//&nbsp;At&nbsp;most&nbsp;10&nbsp;bytes&nbsp;are&nbsp;needed&nbsp;for&nbsp;64-bit&nbsp;values.&nbsp;The&nbsp;encoding&nbsp;could</span><br>
<span class="lineno">20</span><span class="comment" id="4146841">//&nbsp;be&nbsp;more&nbsp;dense:&nbsp;a&nbsp;full&nbsp;64-bit&nbsp;value&nbsp;needs&nbsp;an&nbsp;extra&nbsp;byte&nbsp;just&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="4146920">//&nbsp;Instead,&nbsp;the&nbsp;msb&nbsp;of&nbsp;the&nbsp;previous&nbsp;byte&nbsp;could&nbsp;be&nbsp;used&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63&nbsp;since&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="4146999">//&nbsp;know&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;more&nbsp;than&nbsp;64&nbsp;bits.&nbsp;This&nbsp;is&nbsp;a&nbsp;trivial&nbsp;improvement&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4147075">//&nbsp;would&nbsp;reduce&nbsp;the&nbsp;maximum&nbsp;encoding&nbsp;length&nbsp;to&nbsp;9&nbsp;bytes.&nbsp;However,&nbsp;it&nbsp;breaks&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4147154">//&nbsp;invariant&nbsp;that&nbsp;the&nbsp;msb&nbsp;is&nbsp;always&nbsp;the&nbsp;&#34;continuation&nbsp;bit&#34;&nbsp;and&nbsp;thus&nbsp;makes&nbsp;the</span><br>
<span class="lineno">25</span><span class="comment" id="4147232">//&nbsp;format&nbsp;incompatible&nbsp;with&nbsp;a&nbsp;varint&nbsp;encoding&nbsp;for&nbsp;larger&nbsp;numbers&nbsp;(say&nbsp;128-bit).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4147313">import</span>&nbsp;<span class="op" id="4147320">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4147323">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4147333">&#34;io&#34;</span><br>
<span class="lineno">30</span><span class="op" id="4147338">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4147341">//&nbsp;MaxVarintLenN&nbsp;is&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;a&nbsp;varint-encoded&nbsp;N-bit&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="4147415">const</span>&nbsp;<span class="op" id="4147421">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4147424">MaxVarintLen16</span>&nbsp;<span class="op" id="4147439">=</span>&nbsp;<span class="num" id="4147441">3</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4147444">MaxVarintLen32</span>&nbsp;<span class="op" id="4147459">=</span>&nbsp;<span class="num" id="4147461">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4147464">MaxVarintLen64</span>&nbsp;<span class="op" id="4147479">=</span>&nbsp;<span class="num" id="4147481">10</span><br>
<span class="lineno"></span><span class="op" id="4147484">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4147487">//&nbsp;PutUvarint&nbsp;encodes&nbsp;a&nbsp;uint64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">40</span><span class="comment" id="4147568">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutUvarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="4147622">func</span>&nbsp;<span class="ident" id="4147627">PutUvarint</span><span class="op" id="4147637">(</span><span class="ident" id="4147638">buf</span>&nbsp;<span class="op" id="4147642">[</span><span class="op" id="4147643">]</span><span class="builtintype" id="4147644">byte</span><span class="op" id="4147648">,</span>&nbsp;<span class="ident" id="4147650">x</span>&nbsp;<span class="builtintype" id="4147652">uint64</span><span class="op" id="4147658">)</span>&nbsp;<span class="builtintype" id="4147660">int</span>&nbsp;<span class="op" id="4147664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4147667">i</span>&nbsp;<span class="op" id="4147669">:=</span>&nbsp;<span class="num" id="4147672">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4147675">for</span>&nbsp;<span class="ident" id="4147679">x</span>&nbsp;<span class="op" id="4147681">&gt;=</span>&nbsp;<span class="num" id="4147684">0x80</span>&nbsp;<span class="op" id="4147689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4147693">buf</span><span class="op" id="4147696">[</span><span class="ident" id="4147697">i</span><span class="op" id="4147698">]</span>&nbsp;<span class="op" id="4147700">=</span>&nbsp;<span class="builtintype" id="4147702">byte</span><span class="op" id="4147706">(</span><span class="ident" id="4147707">x</span><span class="op" id="4147708">)</span>&nbsp;<span class="op" id="4147710">|</span>&nbsp;<span class="num" id="4147712">0x80</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4147719">x</span>&nbsp;<span class="op" id="4147721">&gt;&gt;=</span>&nbsp;<span class="num" id="4147725">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4147729">i</span><span class="op" id="4147730">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4147734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4147737">buf</span><span class="op" id="4147740">[</span><span class="ident" id="4147741">i</span><span class="op" id="4147742">]</span>&nbsp;<span class="op" id="4147744">=</span>&nbsp;<span class="builtintype" id="4147746">byte</span><span class="op" id="4147750">(</span><span class="ident" id="4147751">x</span><span class="op" id="4147752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4147755">return</span>&nbsp;<span class="ident" id="4147762">i</span>&nbsp;<span class="op" id="4147764">+</span>&nbsp;<span class="num" id="4147766">1</span><br>
<span class="lineno">50</span><span class="op" id="4147768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4147771">//&nbsp;Uvarint&nbsp;decodes&nbsp;a&nbsp;uint64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4147839">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4147907">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;meaning:</span><br>
<span class="lineno">55</span><span class="comment" id="4147953">//</span><br>
<span class="lineno"></span><span class="comment" id="4147956">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="4147981">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="4148029">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="4148080">//</span><br>
<span class="lineno">60</span><span class="keyword" id="4148083">func</span>&nbsp;<span class="ident" id="4148088">Uvarint</span><span class="op" id="4148095">(</span><span class="ident" id="4148096">buf</span>&nbsp;<span class="op" id="4148100">[</span><span class="op" id="4148101">]</span><span class="builtintype" id="4148102">byte</span><span class="op" id="4148106">)</span>&nbsp;<span class="op" id="4148108">(</span><span class="builtintype" id="4148109">uint64</span><span class="op" id="4148115">,</span>&nbsp;<span class="builtintype" id="4148117">int</span><span class="op" id="4148120">)</span>&nbsp;<span class="op" id="4148122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4148125">var</span>&nbsp;<span class="ident" id="4148129">x</span>&nbsp;<span class="builtintype" id="4148131">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4148139">var</span>&nbsp;<span class="ident" id="4148143">s</span>&nbsp;<span class="builtintype" id="4148145">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4148151">for</span>&nbsp;<span class="ident" id="4148155">i</span><span class="op" id="4148156">,</span>&nbsp;<span class="ident" id="4148158">b</span>&nbsp;<span class="op" id="4148160">:=</span>&nbsp;<span class="keyword" id="4148163">range</span>&nbsp;<span class="ident" id="4148169">buf</span>&nbsp;<span class="op" id="4148173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4148177">if</span>&nbsp;<span class="ident" id="4148180">b</span>&nbsp;<span class="op" id="4148182">&lt;</span>&nbsp;<span class="num" id="4148184">0x80</span>&nbsp;<span class="op" id="4148189">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4148194">if</span>&nbsp;<span class="ident" id="4148197">i</span>&nbsp;<span class="op" id="4148199">&gt;</span>&nbsp;<span class="num" id="4148201">9</span>&nbsp;<span class="op" id="4148203">||</span>&nbsp;<span class="ident" id="4148206">i</span>&nbsp;<span class="op" id="4148208">==</span>&nbsp;<span class="num" id="4148211">9</span>&nbsp;<span class="op" id="4148213">&amp;&amp;</span>&nbsp;<span class="ident" id="4148216">b</span>&nbsp;<span class="op" id="4148218">&gt;</span>&nbsp;<span class="num" id="4148220">1</span>&nbsp;<span class="op" id="4148222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4148228">return</span>&nbsp;<span class="num" id="4148235">0</span><span class="op" id="4148236">,</span>&nbsp;<span class="op" id="4148238">-</span><span class="op" id="4148239">(</span><span class="ident" id="4148240">i</span>&nbsp;<span class="op" id="4148242">+</span>&nbsp;<span class="num" id="4148244">1</span><span class="op" id="4148245">)</span>&nbsp;<span class="comment" id="4148247">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4148262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4148267">return</span>&nbsp;<span class="ident" id="4148274">x</span>&nbsp;<span class="op" id="4148276">|</span>&nbsp;<span class="builtintype" id="4148278">uint64</span><span class="op" id="4148284">(</span><span class="ident" id="4148285">b</span><span class="op" id="4148286">)</span><span class="op" id="4148287">&lt;&lt;</span><span class="ident" id="4148289">s</span><span class="op" id="4148290">,</span>&nbsp;<span class="ident" id="4148292">i</span>&nbsp;<span class="op" id="4148294">+</span>&nbsp;<span class="num" id="4148296">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4148300">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4148304">x</span>&nbsp;<span class="op" id="4148306">|=</span>&nbsp;<span class="builtintype" id="4148309">uint64</span><span class="op" id="4148315">(</span><span class="ident" id="4148316">b</span><span class="op" id="4148317">&amp;</span><span class="num" id="4148318">0x7f</span><span class="op" id="4148322">)</span>&nbsp;<span class="op" id="4148324">&lt;&lt;</span>&nbsp;<span class="ident" id="4148327">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4148331">s</span>&nbsp;<span class="op" id="4148333">+=</span>&nbsp;<span class="num" id="4148336">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4148339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4148342">return</span>&nbsp;<span class="num" id="4148349">0</span><span class="op" id="4148350">,</span>&nbsp;<span class="num" id="4148352">0</span><br>
<span class="lineno"></span><span class="op" id="4148354">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4148357">//&nbsp;PutVarint&nbsp;encodes&nbsp;an&nbsp;int64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="4148437">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutVarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="4148490">func</span>&nbsp;<span class="ident" id="4148495">PutVarint</span><span class="op" id="4148504">(</span><span class="ident" id="4148505">buf</span>&nbsp;<span class="op" id="4148509">[</span><span class="op" id="4148510">]</span><span class="builtintype" id="4148511">byte</span><span class="op" id="4148515">,</span>&nbsp;<span class="ident" id="4148517">x</span>&nbsp;<span class="builtintype" id="4148519">int64</span><span class="op" id="4148524">)</span>&nbsp;<span class="builtintype" id="4148526">int</span>&nbsp;<span class="op" id="4148530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4148533">ux</span>&nbsp;<span class="op" id="4148536">:=</span>&nbsp;<span class="builtintype" id="4148539">uint64</span><span class="op" id="4148545">(</span><span class="ident" id="4148546">x</span><span class="op" id="4148547">)</span>&nbsp;<span class="op" id="4148549">&lt;&lt;</span>&nbsp;<span class="num" id="4148552">1</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4148555">if</span>&nbsp;<span class="ident" id="4148558">x</span>&nbsp;<span class="op" id="4148560">&lt;</span>&nbsp;<span class="num" id="4148562">0</span>&nbsp;<span class="op" id="4148564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4148568">ux</span>&nbsp;<span class="op" id="4148571">=</span>&nbsp;<span class="op" id="4148573">^</span><span class="ident" id="4148574">ux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4148578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4148581">return</span>&nbsp;<span class="ident" id="4148588">PutUvarint</span><span class="op" id="4148598">(</span><span class="ident" id="4148599">buf</span><span class="op" id="4148602">,</span>&nbsp;<span class="ident" id="4148604">ux</span><span class="op" id="4148606">)</span><br>
<span class="lineno"></span><span class="op" id="4148608">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4148611">//&nbsp;Varint&nbsp;decodes&nbsp;an&nbsp;int64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4148678">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4148746">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;with&nbsp;the&nbsp;following&nbsp;meaning:</span><br>
<span class="lineno"></span><span class="comment" id="4148811">//</span><br>
<span class="lineno">90</span><span class="comment" id="4148814">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="4148839">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="4148887">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="4148938">//</span><br>
<span class="lineno"></span><span class="keyword" id="4148941">func</span>&nbsp;<span class="ident" id="4148946">Varint</span><span class="op" id="4148952">(</span><span class="ident" id="4148953">buf</span>&nbsp;<span class="op" id="4148957">[</span><span class="op" id="4148958">]</span><span class="builtintype" id="4148959">byte</span><span class="op" id="4148963">)</span>&nbsp;<span class="op" id="4148965">(</span><span class="builtintype" id="4148966">int64</span><span class="op" id="4148971">,</span>&nbsp;<span class="builtintype" id="4148973">int</span><span class="op" id="4148976">)</span>&nbsp;<span class="op" id="4148978">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4148981">ux</span><span class="op" id="4148983">,</span>&nbsp;<span class="ident" id="4148985">n</span>&nbsp;<span class="op" id="4148987">:=</span>&nbsp;<span class="ident" id="4148990">Uvarint</span><span class="op" id="4148997">(</span><span class="ident" id="4148998">buf</span><span class="op" id="4149001">)</span>&nbsp;<span class="comment" id="4149003">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4149043">x</span>&nbsp;<span class="op" id="4149045">:=</span>&nbsp;<span class="builtintype" id="4149048">int64</span><span class="op" id="4149053">(</span><span class="ident" id="4149054">ux</span>&nbsp;<span class="op" id="4149057">&gt;&gt;</span>&nbsp;<span class="num" id="4149060">1</span><span class="op" id="4149061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4149064">if</span>&nbsp;<span class="ident" id="4149067">ux</span><span class="op" id="4149069">&amp;</span><span class="num" id="4149070">1</span>&nbsp;<span class="op" id="4149072">!=</span>&nbsp;<span class="num" id="4149075">0</span>&nbsp;<span class="op" id="4149077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4149081">x</span>&nbsp;<span class="op" id="4149083">=</span>&nbsp;<span class="op" id="4149085">^</span><span class="ident" id="4149086">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4149089">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4149092">return</span>&nbsp;<span class="ident" id="4149099">x</span><span class="op" id="4149100">,</span>&nbsp;<span class="ident" id="4149102">n</span><br>
<span class="lineno"></span><span class="op" id="4149104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4149107">var</span>&nbsp;<span class="ident" id="4149111">overflow</span>&nbsp;<span class="op" id="4149120">=</span>&nbsp;<span class="ident" id="4149122">errors</span><span class="op" id="4149128">.</span><span class="ident" id="4149129">New</span><span class="op" id="4149132">(</span><span class="string" id="4149133">&#34;binary:&nbsp;varint&nbsp;overflows&nbsp;a&nbsp;64-bit&nbsp;integer&#34;</span><span class="op" id="4149176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="4149179">//&nbsp;ReadUvarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64.</span><br>
<span class="lineno"></span><span class="keyword" id="4149263">func</span>&nbsp;<span class="ident" id="4149268">ReadUvarint</span><span class="op" id="4149279">(</span><span class="ident" id="4149280">r</span>&nbsp;<span class="ident" id="4149282">io</span><span class="op" id="4149284">.</span><span class="ident" id="4149285">ByteReader</span><span class="op" id="4149295">)</span>&nbsp;<span class="op" id="4149297">(</span><span class="builtintype" id="4149298">uint64</span><span class="op" id="4149304">,</span>&nbsp;<span class="builtintype" id="4149306">error</span><span class="op" id="4149311">)</span>&nbsp;<span class="op" id="4149313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4149316">var</span>&nbsp;<span class="ident" id="4149320">x</span>&nbsp;<span class="builtintype" id="4149322">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4149330">var</span>&nbsp;<span class="ident" id="4149334">s</span>&nbsp;<span class="builtintype" id="4149336">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4149342">for</span>&nbsp;<span class="ident" id="4149346">i</span>&nbsp;<span class="op" id="4149348">:=</span>&nbsp;<span class="num" id="4149351">0</span><span class="op" id="4149352">;</span>&nbsp;<span class="op" id="4149354">;</span>&nbsp;<span class="ident" id="4149356">i</span><span class="op" id="4149357">++</span>&nbsp;<span class="op" id="4149360">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4149364">b</span><span class="op" id="4149365">,</span>&nbsp;<span class="ident" id="4149367">err</span>&nbsp;<span class="op" id="4149371">:=</span>&nbsp;<span class="ident" id="4149374">r</span><span class="op" id="4149375">.</span><span class="ident" id="4149376">ReadByte</span><span class="op" id="4149384">(</span><span class="op" id="4149385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4149389">if</span>&nbsp;<span class="ident" id="4149392">err</span>&nbsp;<span class="op" id="4149396">!=</span>&nbsp;<span class="builtintype" id="4149399">nil</span>&nbsp;<span class="op" id="4149403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4149408">return</span>&nbsp;<span class="ident" id="4149415">x</span><span class="op" id="4149416">,</span>&nbsp;<span class="ident" id="4149418">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4149424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4149428">if</span>&nbsp;<span class="ident" id="4149431">b</span>&nbsp;<span class="op" id="4149433">&lt;</span>&nbsp;<span class="num" id="4149435">0x80</span>&nbsp;<span class="op" id="4149440">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4149445">if</span>&nbsp;<span class="ident" id="4149448">i</span>&nbsp;<span class="op" id="4149450">&gt;</span>&nbsp;<span class="num" id="4149452">9</span>&nbsp;<span class="op" id="4149454">||</span>&nbsp;<span class="ident" id="4149457">i</span>&nbsp;<span class="op" id="4149459">==</span>&nbsp;<span class="num" id="4149462">9</span>&nbsp;<span class="op" id="4149464">&amp;&amp;</span>&nbsp;<span class="ident" id="4149467">b</span>&nbsp;<span class="op" id="4149469">&gt;</span>&nbsp;<span class="num" id="4149471">1</span>&nbsp;<span class="op" id="4149473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4149479">return</span>&nbsp;<span class="ident" id="4149486">x</span><span class="op" id="4149487">,</span>&nbsp;<span class="ident" id="4149489">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4149501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4149506">return</span>&nbsp;<span class="ident" id="4149513">x</span>&nbsp;<span class="op" id="4149515">|</span>&nbsp;<span class="builtintype" id="4149517">uint64</span><span class="op" id="4149523">(</span><span class="ident" id="4149524">b</span><span class="op" id="4149525">)</span><span class="op" id="4149526">&lt;&lt;</span><span class="ident" id="4149528">s</span><span class="op" id="4149529">,</span>&nbsp;<span class="builtintype" id="4149531">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4149537">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4149541">x</span>&nbsp;<span class="op" id="4149543">|=</span>&nbsp;<span class="builtintype" id="4149546">uint64</span><span class="op" id="4149552">(</span><span class="ident" id="4149553">b</span><span class="op" id="4149554">&amp;</span><span class="num" id="4149555">0x7f</span><span class="op" id="4149559">)</span>&nbsp;<span class="op" id="4149561">&lt;&lt;</span>&nbsp;<span class="ident" id="4149564">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4149568">s</span>&nbsp;<span class="op" id="4149570">+=</span>&nbsp;<span class="num" id="4149573">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4149576">}</span><br>
<span class="lineno"></span><span class="op" id="4149578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="4149581">//&nbsp;ReadVarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;int64.</span><br>
<span class="lineno"></span><span class="keyword" id="4149662">func</span>&nbsp;<span class="ident" id="4149667">ReadVarint</span><span class="op" id="4149677">(</span><span class="ident" id="4149678">r</span>&nbsp;<span class="ident" id="4149680">io</span><span class="op" id="4149682">.</span><span class="ident" id="4149683">ByteReader</span><span class="op" id="4149693">)</span>&nbsp;<span class="op" id="4149695">(</span><span class="builtintype" id="4149696">int64</span><span class="op" id="4149701">,</span>&nbsp;<span class="builtintype" id="4149703">error</span><span class="op" id="4149708">)</span>&nbsp;<span class="op" id="4149710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4149713">ux</span><span class="op" id="4149715">,</span>&nbsp;<span class="ident" id="4149717">err</span>&nbsp;<span class="op" id="4149721">:=</span>&nbsp;<span class="ident" id="4149724">ReadUvarint</span><span class="op" id="4149735">(</span><span class="ident" id="4149736">r</span><span class="op" id="4149737">)</span>&nbsp;<span class="comment" id="4149739">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4149779">x</span>&nbsp;<span class="op" id="4149781">:=</span>&nbsp;<span class="builtintype" id="4149784">int64</span><span class="op" id="4149789">(</span><span class="ident" id="4149790">ux</span>&nbsp;<span class="op" id="4149793">&gt;&gt;</span>&nbsp;<span class="num" id="4149796">1</span><span class="op" id="4149797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4149800">if</span>&nbsp;<span class="ident" id="4149803">ux</span><span class="op" id="4149805">&amp;</span><span class="num" id="4149806">1</span>&nbsp;<span class="op" id="4149808">!=</span>&nbsp;<span class="num" id="4149811">0</span>&nbsp;<span class="op" id="4149813">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4149817">x</span>&nbsp;<span class="op" id="4149819">=</span>&nbsp;<span class="op" id="4149821">^</span><span class="ident" id="4149822">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4149825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4149828">return</span>&nbsp;<span class="ident" id="4149835">x</span><span class="op" id="4149836">,</span>&nbsp;<span class="ident" id="4149838">err</span><br>
<span class="lineno"></span><span class="op" id="4149842">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
