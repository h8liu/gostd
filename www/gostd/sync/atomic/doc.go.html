<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync/atomic</h2>
<ul>
<li><a href="/gostd/sync/atomic/atomic_test.go.html">atomic_test.go</a></li>
<li><a href="/gostd/sync/atomic/doc.go.html">doc.go</a></li>
<li><a href="/gostd/sync/atomic/value.go.html">value.go</a></li>
<li><a href="/gostd/sync/atomic/value_test.go.html">value_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1453196">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1453252">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1453306">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1453357">//&nbsp;Package&nbsp;atomic&nbsp;provides&nbsp;low-level&nbsp;atomic&nbsp;memory&nbsp;primitives</span><br>
<span class="lineno"></span><span class="comment" id="1453419">//&nbsp;useful&nbsp;for&nbsp;implementing&nbsp;synchronization&nbsp;algorithms.</span><br>
<span class="lineno"></span><span class="comment" id="1453474">//</span><br>
<span class="lineno"></span><span class="comment" id="1453477">//&nbsp;These&nbsp;functions&nbsp;require&nbsp;great&nbsp;care&nbsp;to&nbsp;be&nbsp;used&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="comment" id="1453537">//&nbsp;Except&nbsp;for&nbsp;special,&nbsp;low-level&nbsp;applications,&nbsp;synchronization&nbsp;is&nbsp;better</span><br>
<span class="lineno">10</span><span class="comment" id="1453610">//&nbsp;done&nbsp;with&nbsp;channels&nbsp;or&nbsp;the&nbsp;facilities&nbsp;of&nbsp;the&nbsp;sync&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="1453671">//&nbsp;Share&nbsp;memory&nbsp;by&nbsp;communicating;</span><br>
<span class="lineno"></span><span class="comment" id="1453705">//&nbsp;don&#39;t&nbsp;communicate&nbsp;by&nbsp;sharing&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1453745">//</span><br>
<span class="lineno"></span><span class="comment" id="1453748">//&nbsp;The&nbsp;swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;SwapT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno">15</span><span class="comment" id="1453821">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1453839">//</span><br>
<span class="lineno"></span><span class="comment" id="1453842">//&nbsp;&nbsp;&nbsp;&nbspold&nbsp;=&nbsp;*addr</span><br>
<span class="lineno"></span><span class="comment" id="1453857">//&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1453872">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;old</span><br>
<span class="lineno">20</span><span class="comment" id="1453886">//</span><br>
<span class="lineno"></span><span class="comment" id="1453889">//&nbsp;The&nbsp;compare-and-swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;CompareAndSwapT</span><br>
<span class="lineno"></span><span class="comment" id="1453959">//&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1454002">//</span><br>
<span class="lineno"></span><span class="comment" id="1454005">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;*addr&nbsp;==&nbsp;old&nbsp;{</span><br>
<span class="lineno">25</span><span class="comment" id="1454026">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1454042">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="1454058">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="1454063">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;false</span><br>
<span class="lineno"></span><span class="comment" id="1454079">//</span><br>
<span class="lineno">30</span><span class="comment" id="1454082">//&nbsp;The&nbsp;add&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;AddT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno"></span><span class="comment" id="1454153">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1454171">//</span><br>
<span class="lineno"></span><span class="comment" id="1454174">//&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;+=&nbsp;delta</span><br>
<span class="lineno"></span><span class="comment" id="1454192">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;*addr</span><br>
<span class="lineno">35</span><span class="comment" id="1454208">//</span><br>
<span class="lineno"></span><span class="comment" id="1454211">//&nbsp;The&nbsp;load&nbsp;and&nbsp;store&nbsp;operations,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;LoadT&nbsp;and&nbsp;StoreT</span><br>
<span class="lineno"></span><span class="comment" id="1454281">//&nbsp;functions,&nbsp;are&nbsp;the&nbsp;atomic&nbsp;equivalents&nbsp;of&nbsp;&#34;return&nbsp;*addr&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1454344">//&nbsp;&#34;*addr&nbsp;=&nbsp;val&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1454362">//</span><br>
<span class="lineno">40</span><span class="keyword" id="1454365">package</span>&nbsp;<span class="ident" id="1454373">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1454381">import</span>&nbsp;<span class="op" id="1454388">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1454391">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1454400">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1454403">//&nbsp;BUG(rsc):&nbsp;On&nbsp;x86-32,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;Pentium&nbsp;MMX.</span><br>
<span class="lineno"></span><span class="comment" id="1454501">//</span><br>
<span class="lineno"></span><span class="comment" id="1454504">//&nbsp;On&nbsp;non-Linux&nbsp;ARM,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;ARMv6k&nbsp;core.</span><br>
<span class="lineno"></span><span class="comment" id="1454599">//</span><br>
<span class="lineno">50</span><span class="comment" id="1454602">//&nbsp;On&nbsp;both&nbsp;ARM&nbsp;and&nbsp;x86-32,&nbsp;it&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;arrange&nbsp;for&nbsp;64-bit</span><br>
<span class="lineno"></span><span class="comment" id="1454685">//&nbsp;alignment&nbsp;of&nbsp;64-bit&nbsp;words&nbsp;accessed&nbsp;atomically.&nbsp;The&nbsp;first&nbsp;word&nbsp;in&nbsp;a&nbsp;global</span><br>
<span class="lineno"></span><span class="comment" id="1454762">//&nbsp;variable&nbsp;or&nbsp;in&nbsp;an&nbsp;allocated&nbsp;struct&nbsp;or&nbsp;slice&nbsp;can&nbsp;be&nbsp;relied&nbsp;upon&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1454834">//&nbsp;64-bit&nbsp;aligned.</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1454854">//&nbsp;SwapInt32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1454938">func</span>&nbsp;<span class="ident" id="1454943">SwapInt32</span><span class="op" id="1454952">(</span><span class="ident" id="1454953">addr</span>&nbsp;<span class="op" id="1454958">*</span><span class="builtintype" id="1454959">int32</span><span class="op" id="1454964">,</span>&nbsp;<span class="builtinfunc" id="1454966">new</span>&nbsp;<span class="builtintype" id="1454970">int32</span><span class="op" id="1454975">)</span>&nbsp;<span class="op" id="1454977">(</span><span class="ident" id="1454978">old</span>&nbsp;<span class="builtintype" id="1454982">int32</span><span class="op" id="1454987">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1454990">//&nbsp;SwapInt64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1455074">func</span>&nbsp;<span class="ident" id="1455079">SwapInt64</span><span class="op" id="1455088">(</span><span class="ident" id="1455089">addr</span>&nbsp;<span class="op" id="1455094">*</span><span class="ident" id="1455095">int64</span><span class="op" id="1455100">,</span>&nbsp;<span class="builtinfunc" id="1455102">new</span>&nbsp;<span class="ident" id="1455106">int64</span><span class="op" id="1455111">)</span>&nbsp;<span class="op" id="1455113">(</span><span class="ident" id="1455114">old</span>&nbsp;<span class="ident" id="1455118">int64</span><span class="op" id="1455123">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="1455126">//&nbsp;SwapUint32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1455211">func</span>&nbsp;<span class="ident" id="1455216">SwapUint32</span><span class="op" id="1455226">(</span><span class="ident" id="1455227">addr</span>&nbsp;<span class="op" id="1455232">*</span><span class="builtintype" id="1455233">uint32</span><span class="op" id="1455239">,</span>&nbsp;<span class="builtinfunc" id="1455241">new</span>&nbsp;<span class="builtintype" id="1455245">uint32</span><span class="op" id="1455251">)</span>&nbsp;<span class="op" id="1455253">(</span><span class="ident" id="1455254">old</span>&nbsp;<span class="builtintype" id="1455258">uint32</span><span class="op" id="1455264">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1455267">//&nbsp;SwapUint64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno">65</span><span class="keyword" id="1455352">func</span>&nbsp;<span class="ident" id="1455357">SwapUint64</span><span class="op" id="1455367">(</span><span class="ident" id="1455368">addr</span>&nbsp;<span class="op" id="1455373">*</span><span class="ident" id="1455374">uint64</span><span class="op" id="1455380">,</span>&nbsp;<span class="builtinfunc" id="1455382">new</span>&nbsp;<span class="ident" id="1455386">uint64</span><span class="op" id="1455392">)</span>&nbsp;<span class="op" id="1455394">(</span><span class="ident" id="1455395">old</span>&nbsp;<span class="ident" id="1455399">uint64</span><span class="op" id="1455405">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1455408">//&nbsp;SwapUintptr&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1455494">func</span>&nbsp;<span class="ident" id="1455499">SwapUintptr</span><span class="op" id="1455510">(</span><span class="ident" id="1455511">addr</span>&nbsp;<span class="op" id="1455516">*</span><span class="builtintype" id="1455517">uintptr</span><span class="op" id="1455524">,</span>&nbsp;<span class="builtinfunc" id="1455526">new</span>&nbsp;<span class="builtintype" id="1455530">uintptr</span><span class="op" id="1455537">)</span>&nbsp;<span class="op" id="1455539">(</span><span class="ident" id="1455540">old</span>&nbsp;<span class="builtintype" id="1455544">uintptr</span><span class="op" id="1455551">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="1455554">//&nbsp;SwapPointer&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1455640">func</span>&nbsp;<span class="ident" id="1455645">SwapPointer</span><span class="op" id="1455656">(</span><span class="ident" id="1455657">addr</span>&nbsp;<span class="op" id="1455662">*</span><span class="ident" id="1455663">unsafe</span><span class="op" id="1455669">.</span><span class="ident" id="1455670">Pointer</span><span class="op" id="1455677">,</span>&nbsp;<span class="builtinfunc" id="1455679">new</span>&nbsp;<span class="ident" id="1455683">unsafe</span><span class="op" id="1455689">.</span><span class="ident" id="1455690">Pointer</span><span class="op" id="1455697">)</span>&nbsp;<span class="op" id="1455699">(</span><span class="ident" id="1455700">old</span>&nbsp;<span class="ident" id="1455704">unsafe</span><span class="op" id="1455710">.</span><span class="ident" id="1455711">Pointer</span><span class="op" id="1455718">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1455721">//&nbsp;CompareAndSwapInt32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int32&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1455804">func</span>&nbsp;<span class="ident" id="1455809">CompareAndSwapInt32</span><span class="op" id="1455828">(</span><span class="ident" id="1455829">addr</span>&nbsp;<span class="op" id="1455834">*</span><span class="builtintype" id="1455835">int32</span><span class="op" id="1455840">,</span>&nbsp;<span class="ident" id="1455842">old</span><span class="op" id="1455845">,</span>&nbsp;<span class="builtinfunc" id="1455847">new</span>&nbsp;<span class="builtintype" id="1455851">int32</span><span class="op" id="1455856">)</span>&nbsp;<span class="op" id="1455858">(</span><span class="ident" id="1455859">swapped</span>&nbsp;<span class="builtintype" id="1455867">bool</span><span class="op" id="1455871">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="1455874">//&nbsp;CompareAndSwapInt64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1455957">func</span>&nbsp;<span class="ident" id="1455962">CompareAndSwapInt64</span><span class="op" id="1455981">(</span><span class="ident" id="1455982">addr</span>&nbsp;<span class="op" id="1455987">*</span><span class="ident" id="1455988">int64</span><span class="op" id="1455993">,</span>&nbsp;<span class="ident" id="1455995">old</span><span class="op" id="1455998">,</span>&nbsp;<span class="builtinfunc" id="1456000">new</span>&nbsp;<span class="ident" id="1456004">int64</span><span class="op" id="1456009">)</span>&nbsp;<span class="op" id="1456011">(</span><span class="ident" id="1456012">swapped</span>&nbsp;<span class="builtintype" id="1456020">bool</span><span class="op" id="1456024">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1456027">//&nbsp;CompareAndSwapUint32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint32&nbsp;value.</span><br>
<span class="lineno">80</span><span class="keyword" id="1456111">func</span>&nbsp;<span class="ident" id="1456116">CompareAndSwapUint32</span><span class="op" id="1456136">(</span><span class="ident" id="1456137">addr</span>&nbsp;<span class="op" id="1456142">*</span><span class="builtintype" id="1456143">uint32</span><span class="op" id="1456149">,</span>&nbsp;<span class="ident" id="1456151">old</span><span class="op" id="1456154">,</span>&nbsp;<span class="builtinfunc" id="1456156">new</span>&nbsp;<span class="builtintype" id="1456160">uint32</span><span class="op" id="1456166">)</span>&nbsp;<span class="op" id="1456168">(</span><span class="ident" id="1456169">swapped</span>&nbsp;<span class="builtintype" id="1456177">bool</span><span class="op" id="1456181">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1456184">//&nbsp;CompareAndSwapUint64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1456268">func</span>&nbsp;<span class="ident" id="1456273">CompareAndSwapUint64</span><span class="op" id="1456293">(</span><span class="ident" id="1456294">addr</span>&nbsp;<span class="op" id="1456299">*</span><span class="ident" id="1456300">uint64</span><span class="op" id="1456306">,</span>&nbsp;<span class="ident" id="1456308">old</span><span class="op" id="1456311">,</span>&nbsp;<span class="builtinfunc" id="1456313">new</span>&nbsp;<span class="ident" id="1456317">uint64</span><span class="op" id="1456323">)</span>&nbsp;<span class="op" id="1456325">(</span><span class="ident" id="1456326">swapped</span>&nbsp;<span class="builtintype" id="1456334">bool</span><span class="op" id="1456338">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1456341">//&nbsp;CompareAndSwapUintptr&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uintptr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1456427">func</span>&nbsp;<span class="ident" id="1456432">CompareAndSwapUintptr</span><span class="op" id="1456453">(</span><span class="ident" id="1456454">addr</span>&nbsp;<span class="op" id="1456459">*</span><span class="builtintype" id="1456460">uintptr</span><span class="op" id="1456467">,</span>&nbsp;<span class="ident" id="1456469">old</span><span class="op" id="1456472">,</span>&nbsp;<span class="builtinfunc" id="1456474">new</span>&nbsp;<span class="builtintype" id="1456478">uintptr</span><span class="op" id="1456485">)</span>&nbsp;<span class="op" id="1456487">(</span><span class="ident" id="1456488">swapped</span>&nbsp;<span class="builtintype" id="1456496">bool</span><span class="op" id="1456500">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1456503">//&nbsp;CompareAndSwapPointer&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;unsafe.Pointer&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1456596">func</span>&nbsp;<span class="ident" id="1456601">CompareAndSwapPointer</span><span class="op" id="1456622">(</span><span class="ident" id="1456623">addr</span>&nbsp;<span class="op" id="1456628">*</span><span class="ident" id="1456629">unsafe</span><span class="op" id="1456635">.</span><span class="ident" id="1456636">Pointer</span><span class="op" id="1456643">,</span>&nbsp;<span class="ident" id="1456645">old</span><span class="op" id="1456648">,</span>&nbsp;<span class="builtinfunc" id="1456650">new</span>&nbsp;<span class="ident" id="1456654">unsafe</span><span class="op" id="1456660">.</span><span class="ident" id="1456661">Pointer</span><span class="op" id="1456668">)</span>&nbsp;<span class="op" id="1456670">(</span><span class="ident" id="1456671">swapped</span>&nbsp;<span class="builtintype" id="1456679">bool</span><span class="op" id="1456683">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="1456686">//&nbsp;AddInt32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1456756">func</span>&nbsp;<span class="ident" id="1456761">AddInt32</span><span class="op" id="1456769">(</span><span class="ident" id="1456770">addr</span>&nbsp;<span class="op" id="1456775">*</span><span class="builtintype" id="1456776">int32</span><span class="op" id="1456781">,</span>&nbsp;<span class="ident" id="1456783">delta</span>&nbsp;<span class="builtintype" id="1456789">int32</span><span class="op" id="1456794">)</span>&nbsp;<span class="op" id="1456796">(</span><span class="builtinfunc" id="1456797">new</span>&nbsp;<span class="builtintype" id="1456801">int32</span><span class="op" id="1456806">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1456809">//&nbsp;AddUint32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">95</span><span class="comment" id="1456880">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1456970">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(0)).</span><br>
<span class="lineno"></span><span class="keyword" id="1457034">func</span>&nbsp;<span class="ident" id="1457039">AddUint32</span><span class="op" id="1457048">(</span><span class="ident" id="1457049">addr</span>&nbsp;<span class="op" id="1457054">*</span><span class="builtintype" id="1457055">uint32</span><span class="op" id="1457061">,</span>&nbsp;<span class="ident" id="1457063">delta</span>&nbsp;<span class="builtintype" id="1457069">uint32</span><span class="op" id="1457075">)</span>&nbsp;<span class="op" id="1457077">(</span><span class="builtinfunc" id="1457078">new</span>&nbsp;<span class="builtintype" id="1457082">uint32</span><span class="op" id="1457088">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1457091">//&nbsp;AddInt64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">100</span><span class="keyword" id="1457161">func</span>&nbsp;<span class="ident" id="1457166">AddInt64</span><span class="op" id="1457174">(</span><span class="ident" id="1457175">addr</span>&nbsp;<span class="op" id="1457180">*</span><span class="ident" id="1457181">int64</span><span class="op" id="1457186">,</span>&nbsp;<span class="ident" id="1457188">delta</span>&nbsp;<span class="ident" id="1457194">int64</span><span class="op" id="1457199">)</span>&nbsp;<span class="op" id="1457201">(</span><span class="builtinfunc" id="1457202">new</span>&nbsp;<span class="ident" id="1457206">int64</span><span class="op" id="1457211">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1457214">//&nbsp;AddUint64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1457285">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1457375">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(0)).</span><br>
<span class="lineno">105</span><span class="keyword" id="1457439">func</span>&nbsp;<span class="ident" id="1457444">AddUint64</span><span class="op" id="1457453">(</span><span class="ident" id="1457454">addr</span>&nbsp;<span class="op" id="1457459">*</span><span class="ident" id="1457460">uint64</span><span class="op" id="1457466">,</span>&nbsp;<span class="ident" id="1457468">delta</span>&nbsp;<span class="ident" id="1457474">uint64</span><span class="op" id="1457480">)</span>&nbsp;<span class="op" id="1457482">(</span><span class="builtinfunc" id="1457483">new</span>&nbsp;<span class="ident" id="1457487">uint64</span><span class="op" id="1457493">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1457496">//&nbsp;AddUintptr&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1457568">func</span>&nbsp;<span class="ident" id="1457573">AddUintptr</span><span class="op" id="1457583">(</span><span class="ident" id="1457584">addr</span>&nbsp;<span class="op" id="1457589">*</span><span class="builtintype" id="1457590">uintptr</span><span class="op" id="1457597">,</span>&nbsp;<span class="ident" id="1457599">delta</span>&nbsp;<span class="builtintype" id="1457605">uintptr</span><span class="op" id="1457612">)</span>&nbsp;<span class="op" id="1457614">(</span><span class="builtinfunc" id="1457615">new</span>&nbsp;<span class="builtintype" id="1457619">uintptr</span><span class="op" id="1457626">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1457629">//&nbsp;LoadInt32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1457666">func</span>&nbsp;<span class="ident" id="1457671">LoadInt32</span><span class="op" id="1457680">(</span><span class="ident" id="1457681">addr</span>&nbsp;<span class="op" id="1457686">*</span><span class="builtintype" id="1457687">int32</span><span class="op" id="1457692">)</span>&nbsp;<span class="op" id="1457694">(</span><span class="ident" id="1457695">val</span>&nbsp;<span class="builtintype" id="1457699">int32</span><span class="op" id="1457704">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1457707">//&nbsp;LoadInt64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1457744">func</span>&nbsp;<span class="ident" id="1457749">LoadInt64</span><span class="op" id="1457758">(</span><span class="ident" id="1457759">addr</span>&nbsp;<span class="op" id="1457764">*</span><span class="ident" id="1457765">int64</span><span class="op" id="1457770">)</span>&nbsp;<span class="op" id="1457772">(</span><span class="ident" id="1457773">val</span>&nbsp;<span class="ident" id="1457777">int64</span><span class="op" id="1457782">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1457785">//&nbsp;LoadUint32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1457823">func</span>&nbsp;<span class="ident" id="1457828">LoadUint32</span><span class="op" id="1457838">(</span><span class="ident" id="1457839">addr</span>&nbsp;<span class="op" id="1457844">*</span><span class="builtintype" id="1457845">uint32</span><span class="op" id="1457851">)</span>&nbsp;<span class="op" id="1457853">(</span><span class="ident" id="1457854">val</span>&nbsp;<span class="builtintype" id="1457858">uint32</span><span class="op" id="1457864">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1457867">//&nbsp;LoadUint64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno">120</span><span class="keyword" id="1457905">func</span>&nbsp;<span class="ident" id="1457910">LoadUint64</span><span class="op" id="1457920">(</span><span class="ident" id="1457921">addr</span>&nbsp;<span class="op" id="1457926">*</span><span class="ident" id="1457927">uint64</span><span class="op" id="1457933">)</span>&nbsp;<span class="op" id="1457935">(</span><span class="ident" id="1457936">val</span>&nbsp;<span class="ident" id="1457940">uint64</span><span class="op" id="1457946">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1457949">//&nbsp;LoadUintptr&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1457988">func</span>&nbsp;<span class="ident" id="1457993">LoadUintptr</span><span class="op" id="1458004">(</span><span class="ident" id="1458005">addr</span>&nbsp;<span class="op" id="1458010">*</span><span class="builtintype" id="1458011">uintptr</span><span class="op" id="1458018">)</span>&nbsp;<span class="op" id="1458020">(</span><span class="ident" id="1458021">val</span>&nbsp;<span class="builtintype" id="1458025">uintptr</span><span class="op" id="1458032">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="1458035">//&nbsp;LoadPointer&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1458074">func</span>&nbsp;<span class="ident" id="1458079">LoadPointer</span><span class="op" id="1458090">(</span><span class="ident" id="1458091">addr</span>&nbsp;<span class="op" id="1458096">*</span><span class="ident" id="1458097">unsafe</span><span class="op" id="1458103">.</span><span class="ident" id="1458104">Pointer</span><span class="op" id="1458111">)</span>&nbsp;<span class="op" id="1458113">(</span><span class="ident" id="1458114">val</span>&nbsp;<span class="ident" id="1458118">unsafe</span><span class="op" id="1458124">.</span><span class="ident" id="1458125">Pointer</span><span class="op" id="1458132">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1458135">//&nbsp;StoreInt32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1458183">func</span>&nbsp;<span class="ident" id="1458188">StoreInt32</span><span class="op" id="1458198">(</span><span class="ident" id="1458199">addr</span>&nbsp;<span class="op" id="1458204">*</span><span class="builtintype" id="1458205">int32</span><span class="op" id="1458210">,</span>&nbsp;<span class="ident" id="1458212">val</span>&nbsp;<span class="builtintype" id="1458216">int32</span><span class="op" id="1458221">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1458224">//&nbsp;StoreInt64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1458272">func</span>&nbsp;<span class="ident" id="1458277">StoreInt64</span><span class="op" id="1458287">(</span><span class="ident" id="1458288">addr</span>&nbsp;<span class="op" id="1458293">*</span><span class="ident" id="1458294">int64</span><span class="op" id="1458299">,</span>&nbsp;<span class="ident" id="1458301">val</span>&nbsp;<span class="ident" id="1458305">int64</span><span class="op" id="1458310">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1458313">//&nbsp;StoreUint32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno">135</span><span class="keyword" id="1458362">func</span>&nbsp;<span class="ident" id="1458367">StoreUint32</span><span class="op" id="1458378">(</span><span class="ident" id="1458379">addr</span>&nbsp;<span class="op" id="1458384">*</span><span class="builtintype" id="1458385">uint32</span><span class="op" id="1458391">,</span>&nbsp;<span class="ident" id="1458393">val</span>&nbsp;<span class="builtintype" id="1458397">uint32</span><span class="op" id="1458403">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1458406">//&nbsp;StoreUint64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1458455">func</span>&nbsp;<span class="ident" id="1458460">StoreUint64</span><span class="op" id="1458471">(</span><span class="ident" id="1458472">addr</span>&nbsp;<span class="op" id="1458477">*</span><span class="ident" id="1458478">uint64</span><span class="op" id="1458484">,</span>&nbsp;<span class="ident" id="1458486">val</span>&nbsp;<span class="ident" id="1458490">uint64</span><span class="op" id="1458496">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1458499">//&nbsp;StoreUintptr&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1458549">func</span>&nbsp;<span class="ident" id="1458554">StoreUintptr</span><span class="op" id="1458566">(</span><span class="ident" id="1458567">addr</span>&nbsp;<span class="op" id="1458572">*</span><span class="builtintype" id="1458573">uintptr</span><span class="op" id="1458580">,</span>&nbsp;<span class="ident" id="1458582">val</span>&nbsp;<span class="builtintype" id="1458586">uintptr</span><span class="op" id="1458593">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1458596">//&nbsp;StorePointer&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1458646">func</span>&nbsp;<span class="ident" id="1458651">StorePointer</span><span class="op" id="1458663">(</span><span class="ident" id="1458664">addr</span>&nbsp;<span class="op" id="1458669">*</span><span class="ident" id="1458670">unsafe</span><span class="op" id="1458676">.</span><span class="ident" id="1458677">Pointer</span><span class="op" id="1458684">,</span>&nbsp;<span class="ident" id="1458686">val</span>&nbsp;<span class="ident" id="1458690">unsafe</span><span class="op" id="1458696">.</span><span class="ident" id="1458697">Pointer</span><span class="op" id="1458704">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1458707">//&nbsp;Helper&nbsp;for&nbsp;ARM.&nbsp;&nbsp;Linker&nbsp;will&nbsp;discard&nbsp;on&nbsp;other&nbsp;systems</span><br>
<span class="lineno"></span><span class="keyword" id="1458764">func</span>&nbsp;<span class="ident" id="1458769">panic64</span><span class="op" id="1458776">(</span><span class="op" id="1458777">)</span>&nbsp;<span class="op" id="1458779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1458782">panic</span><span class="op" id="1458787">(</span><span class="string" id="1458788">&#34;sync/atomic:&nbsp;broken&nbsp;64-bit&nbsp;atomic&nbsp;operations&nbsp;(buggy&nbsp;QEMU)&#34;</span><span class="op" id="1458847">)</span><br>
<span class="lineno"></span><span class="op" id="1458849">}</span>
</div>
</body>
</html>
