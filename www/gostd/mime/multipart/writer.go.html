<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4281625">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4281680">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4281734">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4281785">package</span>&nbsp;<span class="ident" id="4281793">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4281804">import</span>&nbsp;<span class="op" id="4281811">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4281814">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4281823">&#34;crypto/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4281838">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4281848">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4281855">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4281861">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4281878">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4281888">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4281891">//&nbsp;A&nbsp;Writer&nbsp;generates&nbsp;multipart&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="4281933">type</span>&nbsp;<span class="ident" id="4281938">Writer</span>&nbsp;<span class="keyword" id="4281945">struct</span>&nbsp;<span class="op" id="4281952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281955">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281964">io</span><span class="op" id="4281966">.</span><span class="ident" id="4281967">Writer</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281975">boundary</span>&nbsp;<span class="builtintype" id="4281984">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281992">lastpart</span>&nbsp;<span class="op" id="4282001">*</span><span class="ident" id="4282002">part</span><br>
<span class="lineno"></span><span class="op" id="4282007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4282010">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;multipart&nbsp;Writer&nbsp;with&nbsp;a&nbsp;random&nbsp;boundary,</span><br>
<span class="lineno">25</span><span class="comment" id="4282078">//&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4282095">func</span>&nbsp;<span class="ident" id="4282100">NewWriter</span><span class="op" id="4282109">(</span><span class="ident" id="4282110">w</span>&nbsp;<span class="ident" id="4282112">io</span><span class="op" id="4282114">.</span><span class="ident" id="4282115">Writer</span><span class="op" id="4282121">)</span>&nbsp;<span class="op" id="4282123">*</span><span class="ident" id="4282124">Writer</span>&nbsp;<span class="op" id="4282131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282134">return</span>&nbsp;<span class="op" id="4282141">&amp;</span><span class="ident" id="4282142">Writer</span><span class="op" id="4282148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4282152">w</span><span class="op" id="4282153">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282162">w</span><span class="op" id="4282163">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4282167">boundary</span><span class="op" id="4282175">:</span>&nbsp;<span class="ident" id="4282177">randomBoundary</span><span class="op" id="4282191">(</span><span class="op" id="4282192">)</span><span class="op" id="4282193">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4282196">}</span><br>
<span class="lineno"></span><span class="op" id="4282198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4282201">//&nbsp;Boundary&nbsp;returns&nbsp;the&nbsp;Writer&#39;s&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="4282244">func</span>&nbsp;<span class="op" id="4282249">(</span><span class="ident" id="4282250">w</span>&nbsp;<span class="op" id="4282252">*</span><span class="ident" id="4282253">Writer</span><span class="op" id="4282259">)</span>&nbsp;<span class="ident" id="4282261">Boundary</span><span class="op" id="4282269">(</span><span class="op" id="4282270">)</span>&nbsp;<span class="builtintype" id="4282272">string</span>&nbsp;<span class="op" id="4282279">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282282">return</span>&nbsp;<span class="ident" id="4282289">w</span><span class="op" id="4282290">.</span><span class="ident" id="4282291">boundary</span><br>
<span class="lineno"></span><span class="op" id="4282300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4282303">//&nbsp;SetBoundary&nbsp;overrides&nbsp;the&nbsp;Writer&#39;s&nbsp;default&nbsp;randomly-generated</span><br>
<span class="lineno"></span><span class="comment" id="4282368">//&nbsp;boundary&nbsp;separator&nbsp;with&nbsp;an&nbsp;explicit&nbsp;value.</span><br>
<span class="lineno">40</span><span class="comment" id="4282414">//</span><br>
<span class="lineno"></span><span class="comment" id="4282417">//&nbsp;SetBoundary&nbsp;must&nbsp;be&nbsp;called&nbsp;before&nbsp;any&nbsp;parts&nbsp;are&nbsp;created,&nbsp;may&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="4282486">//&nbsp;contain&nbsp;certain&nbsp;ASCII&nbsp;characters,&nbsp;and&nbsp;must&nbsp;be&nbsp;1-69&nbsp;bytes&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="4282552">func</span>&nbsp;<span class="op" id="4282557">(</span><span class="ident" id="4282558">w</span>&nbsp;<span class="op" id="4282560">*</span><span class="ident" id="4282561">Writer</span><span class="op" id="4282567">)</span>&nbsp;<span class="ident" id="4282569">SetBoundary</span><span class="op" id="4282580">(</span><span class="ident" id="4282581">boundary</span>&nbsp;<span class="builtintype" id="4282590">string</span><span class="op" id="4282596">)</span>&nbsp;<span class="builtintype" id="4282598">error</span>&nbsp;<span class="op" id="4282604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282607">if</span>&nbsp;<span class="ident" id="4282610">w</span><span class="op" id="4282611">.</span><span class="ident" id="4282612">lastpart</span>&nbsp;<span class="op" id="4282621">!=</span>&nbsp;<span class="ident" id="4282624">nil</span>&nbsp;<span class="op" id="4282628">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282632">return</span>&nbsp;<span class="ident" id="4282639">errors</span><span class="op" id="4282645">.</span><span class="ident" id="4282646">New</span><span class="op" id="4282649">(</span><span class="string" id="4282650">&#34;mime:&nbsp;SetBoundary&nbsp;called&nbsp;after&nbsp;write&#34;</span><span class="op" id="4282688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4282691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4282694">//&nbsp;rfc2046#section-5.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282720">if</span>&nbsp;<span class="builtinfunc" id="4282723">len</span><span class="op" id="4282726">(</span><span class="ident" id="4282727">boundary</span><span class="op" id="4282735">)</span>&nbsp;<span class="op" id="4282737">&lt;</span>&nbsp;<span class="num" id="4282739">1</span>&nbsp;<span class="op" id="4282741">||</span>&nbsp;<span class="builtinfunc" id="4282744">len</span><span class="op" id="4282747">(</span><span class="ident" id="4282748">boundary</span><span class="op" id="4282756">)</span>&nbsp;<span class="op" id="4282758">&gt;</span>&nbsp;<span class="num" id="4282760">69</span>&nbsp;<span class="op" id="4282763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282767">return</span>&nbsp;<span class="ident" id="4282774">errors</span><span class="op" id="4282780">.</span><span class="ident" id="4282781">New</span><span class="op" id="4282784">(</span><span class="string" id="4282785">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;length&#34;</span><span class="op" id="4282816">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4282819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282822">for</span>&nbsp;<span class="ident" id="4282826">_</span><span class="op" id="4282827">,</span>&nbsp;<span class="ident" id="4282829">b</span>&nbsp;<span class="op" id="4282831">:=</span>&nbsp;<span class="keyword" id="4282834">range</span>&nbsp;<span class="ident" id="4282840">boundary</span>&nbsp;<span class="op" id="4282849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282853">if</span>&nbsp;<span class="string" id="4282856">&#39;A&#39;</span>&nbsp;<span class="op" id="4282860">&lt;=</span>&nbsp;<span class="ident" id="4282863">b</span>&nbsp;<span class="op" id="4282865">&amp;&amp;</span>&nbsp;<span class="ident" id="4282868">b</span>&nbsp;<span class="op" id="4282870">&lt;=</span>&nbsp;<span class="string" id="4282873">&#39;Z&#39;</span>&nbsp;<span class="op" id="4282877">||</span>&nbsp;<span class="string" id="4282880">&#39;a&#39;</span>&nbsp;<span class="op" id="4282884">&lt;=</span>&nbsp;<span class="ident" id="4282887">b</span>&nbsp;<span class="op" id="4282889">&amp;&amp;</span>&nbsp;<span class="ident" id="4282892">b</span>&nbsp;<span class="op" id="4282894">&lt;=</span>&nbsp;<span class="string" id="4282897">&#39;z&#39;</span>&nbsp;<span class="op" id="4282901">||</span>&nbsp;<span class="string" id="4282904">&#39;0&#39;</span>&nbsp;<span class="op" id="4282908">&lt;=</span>&nbsp;<span class="ident" id="4282911">b</span>&nbsp;<span class="op" id="4282913">&amp;&amp;</span>&nbsp;<span class="ident" id="4282916">b</span>&nbsp;<span class="op" id="4282918">&lt;=</span>&nbsp;<span class="string" id="4282921">&#39;9&#39;</span>&nbsp;<span class="op" id="4282925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282930">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4282941">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282945">switch</span>&nbsp;<span class="ident" id="4282952">b</span>&nbsp;<span class="op" id="4282954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282958">case</span>&nbsp;<span class="string" id="4282963">&#39;\&#39;&#39;</span><span class="op" id="4282967">,</span>&nbsp;<span class="string" id="4282969">&#39;(&#39;</span><span class="op" id="4282972">,</span>&nbsp;<span class="string" id="4282974">&#39;)&#39;</span><span class="op" id="4282977">,</span>&nbsp;<span class="string" id="4282979">&#39;+&#39;</span><span class="op" id="4282982">,</span>&nbsp;<span class="string" id="4282984">&#39;_&#39;</span><span class="op" id="4282987">,</span>&nbsp;<span class="string" id="4282989">&#39;,&#39;</span><span class="op" id="4282992">,</span>&nbsp;<span class="string" id="4282994">&#39;-&#39;</span><span class="op" id="4282997">,</span>&nbsp;<span class="string" id="4282999">&#39;.&#39;</span><span class="op" id="4283002">,</span>&nbsp;<span class="string" id="4283004">&#39;/&#39;</span><span class="op" id="4283007">,</span>&nbsp;<span class="string" id="4283009">&#39;:&#39;</span><span class="op" id="4283012">,</span>&nbsp;<span class="string" id="4283014">&#39;=&#39;</span><span class="op" id="4283017">,</span>&nbsp;<span class="string" id="4283019">&#39;?&#39;</span><span class="op" id="4283022">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283027">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4283038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283042">return</span>&nbsp;<span class="ident" id="4283049">errors</span><span class="op" id="4283055">.</span><span class="ident" id="4283056">New</span><span class="op" id="4283059">(</span><span class="string" id="4283060">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;character&#34;</span><span class="op" id="4283094">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4283097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283100">w</span><span class="op" id="4283101">.</span><span class="ident" id="4283102">boundary</span>&nbsp;<span class="op" id="4283111">=</span>&nbsp;<span class="ident" id="4283113">boundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283123">return</span>&nbsp;<span class="ident" id="4283130">nil</span><br>
<span class="lineno"></span><span class="op" id="4283134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="4283137">//&nbsp;FormDataContentType&nbsp;returns&nbsp;the&nbsp;Content-Type&nbsp;for&nbsp;an&nbsp;HTTP</span><br>
<span class="lineno"></span><span class="comment" id="4283197">//&nbsp;multipart/form-data&nbsp;with&nbsp;this&nbsp;Writer&#39;s&nbsp;Boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="4283249">func</span>&nbsp;<span class="op" id="4283254">(</span><span class="ident" id="4283255">w</span>&nbsp;<span class="op" id="4283257">*</span><span class="ident" id="4283258">Writer</span><span class="op" id="4283264">)</span>&nbsp;<span class="ident" id="4283266">FormDataContentType</span><span class="op" id="4283285">(</span><span class="op" id="4283286">)</span>&nbsp;<span class="builtintype" id="4283288">string</span>&nbsp;<span class="op" id="4283295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283298">return</span>&nbsp;<span class="string" id="4283305">&#34;multipart/form-data;&nbsp;boundary=&#34;</span>&nbsp;<span class="op" id="4283338">+</span>&nbsp;<span class="ident" id="4283340">w</span><span class="op" id="4283341">.</span><span class="ident" id="4283342">boundary</span><br>
<span class="lineno"></span><span class="op" id="4283351">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4283354">func</span>&nbsp;<span class="ident" id="4283359">randomBoundary</span><span class="op" id="4283373">(</span><span class="op" id="4283374">)</span>&nbsp;<span class="builtintype" id="4283376">string</span>&nbsp;<span class="op" id="4283383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283386">var</span>&nbsp;<span class="ident" id="4283390">buf</span>&nbsp;<span class="op" id="4283394">[</span><span class="num" id="4283395">30</span><span class="op" id="4283397">]</span><span class="builtintype" id="4283398">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283404">_</span><span class="op" id="4283405">,</span>&nbsp;<span class="ident" id="4283407">err</span>&nbsp;<span class="op" id="4283411">:=</span>&nbsp;<span class="ident" id="4283414">io</span><span class="op" id="4283416">.</span><span class="ident" id="4283417">ReadFull</span><span class="op" id="4283425">(</span><span class="ident" id="4283426">rand</span><span class="op" id="4283430">.</span><span class="ident" id="4283431">Reader</span><span class="op" id="4283437">,</span>&nbsp;<span class="ident" id="4283439">buf</span><span class="op" id="4283442">[</span><span class="op" id="4283443">:</span><span class="op" id="4283444">]</span><span class="op" id="4283445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283448">if</span>&nbsp;<span class="ident" id="4283451">err</span>&nbsp;<span class="op" id="4283455">!=</span>&nbsp;<span class="ident" id="4283458">nil</span>&nbsp;<span class="op" id="4283462">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4283466">panic</span><span class="op" id="4283471">(</span><span class="ident" id="4283472">err</span><span class="op" id="4283475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4283478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283481">return</span>&nbsp;<span class="ident" id="4283488">fmt</span><span class="op" id="4283491">.</span><span class="ident" id="4283492">Sprintf</span><span class="op" id="4283499">(</span><span class="string" id="4283500">&#34;%x&#34;</span><span class="op" id="4283504">,</span>&nbsp;<span class="ident" id="4283506">buf</span><span class="op" id="4283509">[</span><span class="op" id="4283510">:</span><span class="op" id="4283511">]</span><span class="op" id="4283512">)</span><br>
<span class="lineno"></span><span class="op" id="4283514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4283517">//&nbsp;CreatePart&nbsp;creates&nbsp;a&nbsp;new&nbsp;multipart&nbsp;section&nbsp;with&nbsp;the&nbsp;provided</span><br>
<span class="lineno"></span><span class="comment" id="4283581">//&nbsp;header.&nbsp;The&nbsp;body&nbsp;of&nbsp;the&nbsp;part&nbsp;should&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="4283647">//&nbsp;Writer.&nbsp;After&nbsp;calling&nbsp;CreatePart,&nbsp;any&nbsp;previous&nbsp;part&nbsp;may&nbsp;no&nbsp;longer</span><br>
<span class="lineno"></span><span class="comment" id="4283716">//&nbsp;be&nbsp;written&nbsp;to.</span><br>
<span class="lineno"></span><span class="keyword" id="4283734">func</span>&nbsp;<span class="op" id="4283739">(</span><span class="ident" id="4283740">w</span>&nbsp;<span class="op" id="4283742">*</span><span class="ident" id="4283743">Writer</span><span class="op" id="4283749">)</span>&nbsp;<span class="ident" id="4283751">CreatePart</span><span class="op" id="4283761">(</span><span class="ident" id="4283762">header</span>&nbsp;<span class="ident" id="4283769">textproto</span><span class="op" id="4283778">.</span><span class="ident" id="4283779">MIMEHeader</span><span class="op" id="4283789">)</span>&nbsp;<span class="op" id="4283791">(</span><span class="ident" id="4283792">io</span><span class="op" id="4283794">.</span><span class="ident" id="4283795">Writer</span><span class="op" id="4283801">,</span>&nbsp;<span class="builtintype" id="4283803">error</span><span class="op" id="4283808">)</span>&nbsp;<span class="op" id="4283810">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283813">if</span>&nbsp;<span class="ident" id="4283816">w</span><span class="op" id="4283817">.</span><span class="ident" id="4283818">lastpart</span>&nbsp;<span class="op" id="4283827">!=</span>&nbsp;<span class="ident" id="4283830">nil</span>&nbsp;<span class="op" id="4283834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283838">if</span>&nbsp;<span class="ident" id="4283841">err</span>&nbsp;<span class="op" id="4283845">:=</span>&nbsp;<span class="ident" id="4283848">w</span><span class="op" id="4283849">.</span><span class="ident" id="4283850">lastpart</span><span class="op" id="4283858">.</span><span class="builtinfunc" id="4283859">close</span><span class="op" id="4283864">(</span><span class="op" id="4283865">)</span><span class="op" id="4283866">;</span>&nbsp;<span class="ident" id="4283868">err</span>&nbsp;<span class="op" id="4283872">!=</span>&nbsp;<span class="ident" id="4283875">nil</span>&nbsp;<span class="op" id="4283879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283884">return</span>&nbsp;<span class="ident" id="4283891">nil</span><span class="op" id="4283894">,</span>&nbsp;<span class="ident" id="4283896">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4283902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4283905">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283908">var</span>&nbsp;<span class="ident" id="4283912">b</span>&nbsp;<span class="ident" id="4283914">bytes</span><span class="op" id="4283919">.</span><span class="ident" id="4283920">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283928">if</span>&nbsp;<span class="ident" id="4283931">w</span><span class="op" id="4283932">.</span><span class="ident" id="4283933">lastpart</span>&nbsp;<span class="op" id="4283942">!=</span>&nbsp;<span class="ident" id="4283945">nil</span>&nbsp;<span class="op" id="4283949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283953">fmt</span><span class="op" id="4283956">.</span><span class="ident" id="4283957">Fprintf</span><span class="op" id="4283964">(</span><span class="op" id="4283965">&amp;</span><span class="ident" id="4283966">b</span><span class="op" id="4283967">,</span>&nbsp;<span class="string" id="4283969">&#34;\r\n--%s\r\n&#34;</span><span class="op" id="4283983">,</span>&nbsp;<span class="ident" id="4283985">w</span><span class="op" id="4283986">.</span><span class="ident" id="4283987">boundary</span><span class="op" id="4283995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4283998">}</span>&nbsp;<span class="keyword" id="4284000">else</span>&nbsp;<span class="op" id="4284005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284009">fmt</span><span class="op" id="4284012">.</span><span class="ident" id="4284013">Fprintf</span><span class="op" id="4284020">(</span><span class="op" id="4284021">&amp;</span><span class="ident" id="4284022">b</span><span class="op" id="4284023">,</span>&nbsp;<span class="string" id="4284025">&#34;--%s\r\n&#34;</span><span class="op" id="4284035">,</span>&nbsp;<span class="ident" id="4284037">w</span><span class="op" id="4284038">.</span><span class="ident" id="4284039">boundary</span><span class="op" id="4284047">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4284050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4284053">//&nbsp;TODO(bradfitz):&nbsp;move&nbsp;this&nbsp;to&nbsp;textproto.MimeHeader.Write(w),&nbsp;have&nbsp;it&nbsp;sort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4284130">//&nbsp;and&nbsp;clean,&nbsp;like&nbsp;http.Header.Write(w)&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284177">for</span>&nbsp;<span class="ident" id="4284181">k</span><span class="op" id="4284182">,</span>&nbsp;<span class="ident" id="4284184">vv</span>&nbsp;<span class="op" id="4284187">:=</span>&nbsp;<span class="keyword" id="4284190">range</span>&nbsp;<span class="ident" id="4284196">header</span>&nbsp;<span class="op" id="4284203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284207">for</span>&nbsp;<span class="ident" id="4284211">_</span><span class="op" id="4284212">,</span>&nbsp;<span class="ident" id="4284214">v</span>&nbsp;<span class="op" id="4284216">:=</span>&nbsp;<span class="keyword" id="4284219">range</span>&nbsp;<span class="ident" id="4284225">vv</span>&nbsp;<span class="op" id="4284228">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284233">fmt</span><span class="op" id="4284236">.</span><span class="ident" id="4284237">Fprintf</span><span class="op" id="4284244">(</span><span class="op" id="4284245">&amp;</span><span class="ident" id="4284246">b</span><span class="op" id="4284247">,</span>&nbsp;<span class="string" id="4284249">&#34;%s:&nbsp;%s\r\n&#34;</span><span class="op" id="4284261">,</span>&nbsp;<span class="ident" id="4284263">k</span><span class="op" id="4284264">,</span>&nbsp;<span class="ident" id="4284266">v</span><span class="op" id="4284267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4284271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4284274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284277">fmt</span><span class="op" id="4284280">.</span><span class="ident" id="4284281">Fprintf</span><span class="op" id="4284288">(</span><span class="op" id="4284289">&amp;</span><span class="ident" id="4284290">b</span><span class="op" id="4284291">,</span>&nbsp;<span class="string" id="4284293">&#34;\r\n&#34;</span><span class="op" id="4284299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284302">_</span><span class="op" id="4284303">,</span>&nbsp;<span class="ident" id="4284305">err</span>&nbsp;<span class="op" id="4284309">:=</span>&nbsp;<span class="ident" id="4284312">io</span><span class="op" id="4284314">.</span><span class="ident" id="4284315">Copy</span><span class="op" id="4284319">(</span><span class="ident" id="4284320">w</span><span class="op" id="4284321">.</span><span class="ident" id="4284322">w</span><span class="op" id="4284323">,</span>&nbsp;<span class="op" id="4284325">&amp;</span><span class="ident" id="4284326">b</span><span class="op" id="4284327">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284330">if</span>&nbsp;<span class="ident" id="4284333">err</span>&nbsp;<span class="op" id="4284337">!=</span>&nbsp;<span class="ident" id="4284340">nil</span>&nbsp;<span class="op" id="4284344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284348">return</span>&nbsp;<span class="ident" id="4284355">nil</span><span class="op" id="4284358">,</span>&nbsp;<span class="ident" id="4284360">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4284365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284368">p</span>&nbsp;<span class="op" id="4284370">:=</span>&nbsp;<span class="op" id="4284373">&amp;</span><span class="ident" id="4284374">part</span><span class="op" id="4284378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284382">mw</span><span class="op" id="4284384">:</span>&nbsp;<span class="ident" id="4284386">w</span><span class="op" id="4284387">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4284390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284393">w</span><span class="op" id="4284394">.</span><span class="ident" id="4284395">lastpart</span>&nbsp;<span class="op" id="4284404">=</span>&nbsp;<span class="ident" id="4284406">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284409">return</span>&nbsp;<span class="ident" id="4284416">p</span><span class="op" id="4284417">,</span>&nbsp;<span class="ident" id="4284419">nil</span><br>
<span class="lineno"></span><span class="op" id="4284423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="4284426">var</span>&nbsp;<span class="ident" id="4284430">quoteEscaper</span>&nbsp;<span class="op" id="4284443">=</span>&nbsp;<span class="ident" id="4284445">strings</span><span class="op" id="4284452">.</span><span class="ident" id="4284453">NewReplacer</span><span class="op" id="4284464">(</span><span class="string" id="4284465">&#34;\\&#34;</span><span class="op" id="4284469">,</span>&nbsp;<span class="string" id="4284471">&#34;\\\\&#34;</span><span class="op" id="4284477">,</span>&nbsp;<span class="string" id="4284479">`&#34;`</span><span class="op" id="4284482">,</span>&nbsp;<span class="string" id="4284484">&#34;\\\&#34;&#34;</span><span class="op" id="4284490">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4284493">func</span>&nbsp;<span class="ident" id="4284498">escapeQuotes</span><span class="op" id="4284510">(</span><span class="ident" id="4284511">s</span>&nbsp;<span class="builtintype" id="4284513">string</span><span class="op" id="4284519">)</span>&nbsp;<span class="builtintype" id="4284521">string</span>&nbsp;<span class="op" id="4284528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284531">return</span>&nbsp;<span class="ident" id="4284538">quoteEscaper</span><span class="op" id="4284550">.</span><span class="ident" id="4284551">Replace</span><span class="op" id="4284558">(</span><span class="ident" id="4284559">s</span><span class="op" id="4284560">)</span><br>
<span class="lineno"></span><span class="op" id="4284562">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="4284565">//&nbsp;CreateFormFile&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;around&nbsp;CreatePart.&nbsp;It&nbsp;creates</span><br>
<span class="lineno"></span><span class="comment" id="4284638">//&nbsp;a&nbsp;new&nbsp;form-data&nbsp;header&nbsp;with&nbsp;the&nbsp;provided&nbsp;field&nbsp;name&nbsp;and&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4284708">func</span>&nbsp;<span class="op" id="4284713">(</span><span class="ident" id="4284714">w</span>&nbsp;<span class="op" id="4284716">*</span><span class="ident" id="4284717">Writer</span><span class="op" id="4284723">)</span>&nbsp;<span class="ident" id="4284725">CreateFormFile</span><span class="op" id="4284739">(</span><span class="ident" id="4284740">fieldname</span><span class="op" id="4284749">,</span>&nbsp;<span class="ident" id="4284751">filename</span>&nbsp;<span class="builtintype" id="4284760">string</span><span class="op" id="4284766">)</span>&nbsp;<span class="op" id="4284768">(</span><span class="ident" id="4284769">io</span><span class="op" id="4284771">.</span><span class="ident" id="4284772">Writer</span><span class="op" id="4284778">,</span>&nbsp;<span class="builtintype" id="4284780">error</span><span class="op" id="4284785">)</span>&nbsp;<span class="op" id="4284787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284790">h</span>&nbsp;<span class="op" id="4284792">:=</span>&nbsp;<span class="builtinfunc" id="4284795">make</span><span class="op" id="4284799">(</span><span class="ident" id="4284800">textproto</span><span class="op" id="4284809">.</span><span class="ident" id="4284810">MIMEHeader</span><span class="op" id="4284820">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284823">h</span><span class="op" id="4284824">.</span><span class="ident" id="4284825">Set</span><span class="op" id="4284828">(</span><span class="string" id="4284829">&#34;Content-Disposition&#34;</span><span class="op" id="4284850">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284854">fmt</span><span class="op" id="4284857">.</span><span class="ident" id="4284858">Sprintf</span><span class="op" id="4284865">(</span><span class="string" id="4284866">`form-data;&nbsp;name=&#34;%s&#34;;&nbsp;filename=&#34;%s&#34;`</span><span class="op" id="4284903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284908">escapeQuotes</span><span class="op" id="4284920">(</span><span class="ident" id="4284921">fieldname</span><span class="op" id="4284930">)</span><span class="op" id="4284931">,</span>&nbsp;<span class="ident" id="4284933">escapeQuotes</span><span class="op" id="4284945">(</span><span class="ident" id="4284946">filename</span><span class="op" id="4284954">)</span><span class="op" id="4284955">)</span><span class="op" id="4284956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284959">h</span><span class="op" id="4284960">.</span><span class="ident" id="4284961">Set</span><span class="op" id="4284964">(</span><span class="string" id="4284965">&#34;Content-Type&#34;</span><span class="op" id="4284979">,</span>&nbsp;<span class="string" id="4284981">&#34;application/octet-stream&#34;</span><span class="op" id="4285007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285010">return</span>&nbsp;<span class="ident" id="4285017">w</span><span class="op" id="4285018">.</span><span class="ident" id="4285019">CreatePart</span><span class="op" id="4285029">(</span><span class="ident" id="4285030">h</span><span class="op" id="4285031">)</span><br>
<span class="lineno">130</span><span class="op" id="4285033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4285036">//&nbsp;CreateFormField&nbsp;calls&nbsp;CreatePart&nbsp;with&nbsp;a&nbsp;header&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4285096">//&nbsp;given&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4285117">func</span>&nbsp;<span class="op" id="4285122">(</span><span class="ident" id="4285123">w</span>&nbsp;<span class="op" id="4285125">*</span><span class="ident" id="4285126">Writer</span><span class="op" id="4285132">)</span>&nbsp;<span class="ident" id="4285134">CreateFormField</span><span class="op" id="4285149">(</span><span class="ident" id="4285150">fieldname</span>&nbsp;<span class="builtintype" id="4285160">string</span><span class="op" id="4285166">)</span>&nbsp;<span class="op" id="4285168">(</span><span class="ident" id="4285169">io</span><span class="op" id="4285171">.</span><span class="ident" id="4285172">Writer</span><span class="op" id="4285178">,</span>&nbsp;<span class="builtintype" id="4285180">error</span><span class="op" id="4285185">)</span>&nbsp;<span class="op" id="4285187">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285190">h</span>&nbsp;<span class="op" id="4285192">:=</span>&nbsp;<span class="builtinfunc" id="4285195">make</span><span class="op" id="4285199">(</span><span class="ident" id="4285200">textproto</span><span class="op" id="4285209">.</span><span class="ident" id="4285210">MIMEHeader</span><span class="op" id="4285220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285223">h</span><span class="op" id="4285224">.</span><span class="ident" id="4285225">Set</span><span class="op" id="4285228">(</span><span class="string" id="4285229">&#34;Content-Disposition&#34;</span><span class="op" id="4285250">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285254">fmt</span><span class="op" id="4285257">.</span><span class="ident" id="4285258">Sprintf</span><span class="op" id="4285265">(</span><span class="string" id="4285266">`form-data;&nbsp;name=&#34;%s&#34;`</span><span class="op" id="4285288">,</span>&nbsp;<span class="ident" id="4285290">escapeQuotes</span><span class="op" id="4285302">(</span><span class="ident" id="4285303">fieldname</span><span class="op" id="4285312">)</span><span class="op" id="4285313">)</span><span class="op" id="4285314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285317">return</span>&nbsp;<span class="ident" id="4285324">w</span><span class="op" id="4285325">.</span><span class="ident" id="4285326">CreatePart</span><span class="op" id="4285336">(</span><span class="ident" id="4285337">h</span><span class="op" id="4285338">)</span><br>
<span class="lineno"></span><span class="op" id="4285340">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="4285343">//&nbsp;WriteField&nbsp;calls&nbsp;CreateFormField&nbsp;and&nbsp;then&nbsp;writes&nbsp;the&nbsp;given&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4285412">func</span>&nbsp;<span class="op" id="4285417">(</span><span class="ident" id="4285418">w</span>&nbsp;<span class="op" id="4285420">*</span><span class="ident" id="4285421">Writer</span><span class="op" id="4285427">)</span>&nbsp;<span class="ident" id="4285429">WriteField</span><span class="op" id="4285439">(</span><span class="ident" id="4285440">fieldname</span><span class="op" id="4285449">,</span>&nbsp;<span class="ident" id="4285451">value</span>&nbsp;<span class="builtintype" id="4285457">string</span><span class="op" id="4285463">)</span>&nbsp;<span class="builtintype" id="4285465">error</span>&nbsp;<span class="op" id="4285471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285474">p</span><span class="op" id="4285475">,</span>&nbsp;<span class="ident" id="4285477">err</span>&nbsp;<span class="op" id="4285481">:=</span>&nbsp;<span class="ident" id="4285484">w</span><span class="op" id="4285485">.</span><span class="ident" id="4285486">CreateFormField</span><span class="op" id="4285501">(</span><span class="ident" id="4285502">fieldname</span><span class="op" id="4285511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285514">if</span>&nbsp;<span class="ident" id="4285517">err</span>&nbsp;<span class="op" id="4285521">!=</span>&nbsp;<span class="ident" id="4285524">nil</span>&nbsp;<span class="op" id="4285528">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285532">return</span>&nbsp;<span class="ident" id="4285539">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4285544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285547">_</span><span class="op" id="4285548">,</span>&nbsp;<span class="ident" id="4285550">err</span>&nbsp;<span class="op" id="4285554">=</span>&nbsp;<span class="ident" id="4285556">p</span><span class="op" id="4285557">.</span><span class="ident" id="4285558">Write</span><span class="op" id="4285563">(</span><span class="op" id="4285564">[</span><span class="op" id="4285565">]</span><span class="builtintype" id="4285566">byte</span><span class="op" id="4285570">(</span><span class="ident" id="4285571">value</span><span class="op" id="4285576">)</span><span class="op" id="4285577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285580">return</span>&nbsp;<span class="ident" id="4285587">err</span><br>
<span class="lineno"></span><span class="op" id="4285591">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="4285594">//&nbsp;Close&nbsp;finishes&nbsp;the&nbsp;multipart&nbsp;message&nbsp;and&nbsp;writes&nbsp;the&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="4285658">//&nbsp;boundary&nbsp;end&nbsp;line&nbsp;to&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="4285694">func</span>&nbsp;<span class="op" id="4285699">(</span><span class="ident" id="4285700">w</span>&nbsp;<span class="op" id="4285702">*</span><span class="ident" id="4285703">Writer</span><span class="op" id="4285709">)</span>&nbsp;<span class="ident" id="4285711">Close</span><span class="op" id="4285716">(</span><span class="op" id="4285717">)</span>&nbsp;<span class="builtintype" id="4285719">error</span>&nbsp;<span class="op" id="4285725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285728">if</span>&nbsp;<span class="ident" id="4285731">w</span><span class="op" id="4285732">.</span><span class="ident" id="4285733">lastpart</span>&nbsp;<span class="op" id="4285742">!=</span>&nbsp;<span class="ident" id="4285745">nil</span>&nbsp;<span class="op" id="4285749">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285753">if</span>&nbsp;<span class="ident" id="4285756">err</span>&nbsp;<span class="op" id="4285760">:=</span>&nbsp;<span class="ident" id="4285763">w</span><span class="op" id="4285764">.</span><span class="ident" id="4285765">lastpart</span><span class="op" id="4285773">.</span><span class="builtinfunc" id="4285774">close</span><span class="op" id="4285779">(</span><span class="op" id="4285780">)</span><span class="op" id="4285781">;</span>&nbsp;<span class="ident" id="4285783">err</span>&nbsp;<span class="op" id="4285787">!=</span>&nbsp;<span class="ident" id="4285790">nil</span>&nbsp;<span class="op" id="4285794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285799">return</span>&nbsp;<span class="ident" id="4285806">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4285812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285816">w</span><span class="op" id="4285817">.</span><span class="ident" id="4285818">lastpart</span>&nbsp;<span class="op" id="4285827">=</span>&nbsp;<span class="ident" id="4285829">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4285834">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285837">_</span><span class="op" id="4285838">,</span>&nbsp;<span class="ident" id="4285840">err</span>&nbsp;<span class="op" id="4285844">:=</span>&nbsp;<span class="ident" id="4285847">fmt</span><span class="op" id="4285850">.</span><span class="ident" id="4285851">Fprintf</span><span class="op" id="4285858">(</span><span class="ident" id="4285859">w</span><span class="op" id="4285860">.</span><span class="ident" id="4285861">w</span><span class="op" id="4285862">,</span>&nbsp;<span class="string" id="4285864">&#34;\r\n--%s--\r\n&#34;</span><span class="op" id="4285880">,</span>&nbsp;<span class="ident" id="4285882">w</span><span class="op" id="4285883">.</span><span class="ident" id="4285884">boundary</span><span class="op" id="4285892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285895">return</span>&nbsp;<span class="ident" id="4285902">err</span><br>
<span class="lineno"></span><span class="op" id="4285906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4285909">type</span>&nbsp;<span class="ident" id="4285914">part</span>&nbsp;<span class="keyword" id="4285919">struct</span>&nbsp;<span class="op" id="4285926">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285929">mw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4285936">*</span><span class="ident" id="4285937">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285945">closed</span>&nbsp;<span class="builtintype" id="4285952">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285958">we</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4285965">error</span>&nbsp;<span class="comment" id="4285971">//&nbsp;last&nbsp;error&nbsp;that&nbsp;occurred&nbsp;writing</span><br>
<span class="lineno"></span><span class="op" id="4286007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="4286010">func</span>&nbsp;<span class="op" id="4286015">(</span><span class="ident" id="4286016">p</span>&nbsp;<span class="op" id="4286018">*</span><span class="ident" id="4286019">part</span><span class="op" id="4286023">)</span>&nbsp;<span class="builtinfunc" id="4286025">close</span><span class="op" id="4286030">(</span><span class="op" id="4286031">)</span>&nbsp;<span class="builtintype" id="4286033">error</span>&nbsp;<span class="op" id="4286039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286042">p</span><span class="op" id="4286043">.</span><span class="ident" id="4286044">closed</span>&nbsp;<span class="op" id="4286051">=</span>&nbsp;<span class="builtintype" id="4286053">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286059">return</span>&nbsp;<span class="ident" id="4286066">p</span><span class="op" id="4286067">.</span><span class="ident" id="4286068">we</span><br>
<span class="lineno"></span><span class="op" id="4286071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="4286074">func</span>&nbsp;<span class="op" id="4286079">(</span><span class="ident" id="4286080">p</span>&nbsp;<span class="op" id="4286082">*</span><span class="ident" id="4286083">part</span><span class="op" id="4286087">)</span>&nbsp;<span class="ident" id="4286089">Write</span><span class="op" id="4286094">(</span><span class="ident" id="4286095">d</span>&nbsp;<span class="op" id="4286097">[</span><span class="op" id="4286098">]</span><span class="builtintype" id="4286099">byte</span><span class="op" id="4286103">)</span>&nbsp;<span class="op" id="4286105">(</span><span class="ident" id="4286106">n</span>&nbsp;<span class="builtintype" id="4286108">int</span><span class="op" id="4286111">,</span>&nbsp;<span class="ident" id="4286113">err</span>&nbsp;<span class="builtintype" id="4286117">error</span><span class="op" id="4286122">)</span>&nbsp;<span class="op" id="4286124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286127">if</span>&nbsp;<span class="ident" id="4286130">p</span><span class="op" id="4286131">.</span><span class="ident" id="4286132">closed</span>&nbsp;<span class="op" id="4286139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286143">return</span>&nbsp;<span class="num" id="4286150">0</span><span class="op" id="4286151">,</span>&nbsp;<span class="ident" id="4286153">errors</span><span class="op" id="4286159">.</span><span class="ident" id="4286160">New</span><span class="op" id="4286163">(</span><span class="string" id="4286164">&#34;multipart:&nbsp;can&#39;t&nbsp;write&nbsp;to&nbsp;finished&nbsp;part&#34;</span><span class="op" id="4286205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4286208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286211">n</span><span class="op" id="4286212">,</span>&nbsp;<span class="ident" id="4286214">err</span>&nbsp;<span class="op" id="4286218">=</span>&nbsp;<span class="ident" id="4286220">p</span><span class="op" id="4286221">.</span><span class="ident" id="4286222">mw</span><span class="op" id="4286224">.</span><span class="ident" id="4286225">w</span><span class="op" id="4286226">.</span><span class="ident" id="4286227">Write</span><span class="op" id="4286232">(</span><span class="ident" id="4286233">d</span><span class="op" id="4286234">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286237">if</span>&nbsp;<span class="ident" id="4286240">err</span>&nbsp;<span class="op" id="4286244">!=</span>&nbsp;<span class="ident" id="4286247">nil</span>&nbsp;<span class="op" id="4286251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286255">p</span><span class="op" id="4286256">.</span><span class="ident" id="4286257">we</span>&nbsp;<span class="op" id="4286260">=</span>&nbsp;<span class="ident" id="4286262">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4286267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286270">return</span><br>
<span class="lineno"></span><span class="op" id="4286277">}</span>
</div>
</body>
</html>
