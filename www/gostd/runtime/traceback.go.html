<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html" class="current">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1727934">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1727989">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1728043">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1728094">package</span>&nbsp;<span class="ident" id="1728102">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1728111">import</span>&nbsp;<span class="string" id="1728118">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1728128">//&nbsp;The&nbsp;code&nbsp;in&nbsp;this&nbsp;file&nbsp;implements&nbsp;stack&nbsp;trace&nbsp;walking&nbsp;for&nbsp;all&nbsp;architectures.</span><br>
<span class="lineno">10</span><span class="comment" id="1728207">//&nbsp;The&nbsp;most&nbsp;important&nbsp;fact&nbsp;about&nbsp;a&nbsp;given&nbsp;architecture&nbsp;is&nbsp;whether&nbsp;it&nbsp;uses&nbsp;a&nbsp;link&nbsp;register.</span><br>
<span class="lineno"></span><span class="comment" id="1728297">//&nbsp;On&nbsp;systems&nbsp;with&nbsp;link&nbsp;registers,&nbsp;the&nbsp;prologue&nbsp;for&nbsp;a&nbsp;non-leaf&nbsp;function&nbsp;stores&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1728380">//&nbsp;incoming&nbsp;value&nbsp;of&nbsp;LR&nbsp;at&nbsp;the&nbsp;bottom&nbsp;of&nbsp;the&nbsp;newly&nbsp;allocated&nbsp;stack&nbsp;frame.</span><br>
<span class="lineno"></span><span class="comment" id="1728454">//&nbsp;On&nbsp;systems&nbsp;without&nbsp;link&nbsp;registers,&nbsp;the&nbsp;architecture&nbsp;pushes&nbsp;a&nbsp;return&nbsp;PC&nbsp;during</span><br>
<span class="lineno"></span><span class="comment" id="1728535">//&nbsp;the&nbsp;call&nbsp;instruction,&nbsp;so&nbsp;the&nbsp;return&nbsp;PC&nbsp;ends&nbsp;up&nbsp;above&nbsp;the&nbsp;stack&nbsp;frame.</span><br>
<span class="lineno">15</span><span class="comment" id="1728608">//&nbsp;In&nbsp;this&nbsp;file,&nbsp;the&nbsp;return&nbsp;PC&nbsp;is&nbsp;always&nbsp;called&nbsp;LR,&nbsp;no&nbsp;matter&nbsp;how&nbsp;it&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="1728688">//</span><br>
<span class="lineno"></span><span class="comment" id="1728691">//&nbsp;To&nbsp;date,&nbsp;the&nbsp;opposite&nbsp;of&nbsp;a&nbsp;link&nbsp;register&nbsp;architecture&nbsp;is&nbsp;an&nbsp;x86&nbsp;architecture.</span><br>
<span class="lineno"></span><span class="comment" id="1728772">//&nbsp;This&nbsp;code&nbsp;may&nbsp;need&nbsp;to&nbsp;change&nbsp;if&nbsp;some&nbsp;other&nbsp;kind&nbsp;of&nbsp;non-link-register</span><br>
<span class="lineno"></span><span class="comment" id="1728844">//&nbsp;architecture&nbsp;comes&nbsp;along.</span><br>
<span class="lineno">20</span><span class="comment" id="1728873">//</span><br>
<span class="lineno"></span><span class="comment" id="1728876">//&nbsp;The&nbsp;other&nbsp;important&nbsp;fact&nbsp;is&nbsp;the&nbsp;size&nbsp;of&nbsp;a&nbsp;pointer:&nbsp;on&nbsp;32-bit&nbsp;systems&nbsp;the&nbsp;LR</span><br>
<span class="lineno"></span><span class="comment" id="1728955">//&nbsp;takes&nbsp;up&nbsp;only&nbsp;4&nbsp;bytes&nbsp;on&nbsp;the&nbsp;stack,&nbsp;while&nbsp;on&nbsp;64-bit&nbsp;systems&nbsp;it&nbsp;takes&nbsp;up&nbsp;8&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="1729039">//&nbsp;Typically&nbsp;this&nbsp;is&nbsp;ptrSize.</span><br>
<span class="lineno"></span><span class="comment" id="1729069">//</span><br>
<span class="lineno">25</span><span class="comment" id="1729072">//&nbsp;As&nbsp;an&nbsp;exception,&nbsp;amd64p32&nbsp;has&nbsp;ptrSize&nbsp;==&nbsp;4&nbsp;but&nbsp;the&nbsp;CALL&nbsp;instruction&nbsp;still</span><br>
<span class="lineno"></span><span class="comment" id="1729149">//&nbsp;stores&nbsp;an&nbsp;8-byte&nbsp;return&nbsp;PC&nbsp;onto&nbsp;the&nbsp;stack.&nbsp;To&nbsp;accommodate&nbsp;this,&nbsp;we&nbsp;use&nbsp;regSize</span><br>
<span class="lineno"></span><span class="comment" id="1729231">//&nbsp;as&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;architecture-pushed&nbsp;return&nbsp;PC.</span><br>
<span class="lineno"></span><span class="comment" id="1729284">//</span><br>
<span class="lineno"></span><span class="comment" id="1729287">//&nbsp;usesLR&nbsp;is&nbsp;defined&nbsp;below.&nbsp;ptrSize&nbsp;and&nbsp;regSize&nbsp;are&nbsp;defined&nbsp;in&nbsp;stubs.go.</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="1729361">const</span>&nbsp;<span class="ident" id="1729367">usesLR</span>&nbsp;<span class="op" id="1729374">=</span>&nbsp;<span class="ident" id="1729376">GOARCH</span>&nbsp;<span class="op" id="1729383">!=</span>&nbsp;<span class="string" id="1729386">&#34;amd64&#34;</span>&nbsp;<span class="op" id="1729394">&amp;&amp;</span>&nbsp;<span class="ident" id="1729397">GOARCH</span>&nbsp;<span class="op" id="1729404">!=</span>&nbsp;<span class="string" id="1729407">&#34;amd64p32&#34;</span>&nbsp;<span class="op" id="1729418">&amp;&amp;</span>&nbsp;<span class="ident" id="1729421">GOARCH</span>&nbsp;<span class="op" id="1729428">!=</span>&nbsp;<span class="string" id="1729431">&#34;386&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1729438">var</span>&nbsp;<span class="op" id="1729442">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1729445">//&nbsp;initialized&nbsp;in&nbsp;tracebackinit</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1729478">deferprocPC</span>&nbsp;<span class="builtintype" id="1729490">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1729499">goexitPC</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1729511">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1729520">jmpdeferPC</span>&nbsp;&nbsp;<span class="builtintype" id="1729532">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1729541">mcallPC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1729553">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1729562">morestackPC</span>&nbsp;<span class="builtintype" id="1729574">uintptr</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1729583">mstartPC</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1729595">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1729604">newprocPC</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1729616">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1729625">rt0_goPC</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1729637">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1729646">sigpanicPC</span>&nbsp;&nbsp;<span class="builtintype" id="1729658">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1729668">externalthreadhandlerp</span>&nbsp;<span class="builtintype" id="1729691">uintptr</span>&nbsp;<span class="comment" id="1729699">//&nbsp;initialized&nbsp;elsewhere</span><br>
<span class="lineno"></span><span class="op" id="1729724">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1729727">func</span>&nbsp;<span class="ident" id="1729732">tracebackinit</span><span class="op" id="1729745">(</span><span class="op" id="1729746">)</span>&nbsp;<span class="op" id="1729748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1729751">//&nbsp;Go&nbsp;variable&nbsp;initialization&nbsp;happens&nbsp;late&nbsp;during&nbsp;runtime&nbsp;startup.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1729819">//&nbsp;Instead&nbsp;of&nbsp;initializing&nbsp;the&nbsp;variables&nbsp;above&nbsp;in&nbsp;the&nbsp;declarations,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1729888">//&nbsp;schedinit&nbsp;calls&nbsp;this&nbsp;function&nbsp;so&nbsp;that&nbsp;the&nbsp;variables&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1729948">//&nbsp;initialized&nbsp;and&nbsp;available&nbsp;earlier&nbsp;in&nbsp;the&nbsp;startup&nbsp;sequence.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730011">deferprocPC</span>&nbsp;<span class="op" id="1730023">=</span>&nbsp;<span class="ident" id="1730025">funcPC</span><span class="op" id="1730031">(</span><span class="ident" id="1730032">deferproc</span><span class="op" id="1730041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730044">goexitPC</span>&nbsp;<span class="op" id="1730053">=</span>&nbsp;<span class="ident" id="1730055">funcPC</span><span class="op" id="1730061">(</span><span class="ident" id="1730062">goexit</span><span class="op" id="1730068">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730071">jmpdeferPC</span>&nbsp;<span class="op" id="1730082">=</span>&nbsp;<span class="ident" id="1730084">funcPC</span><span class="op" id="1730090">(</span><span class="ident" id="1730091">jmpdefer</span><span class="op" id="1730099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730102">mcallPC</span>&nbsp;<span class="op" id="1730110">=</span>&nbsp;<span class="ident" id="1730112">funcPC</span><span class="op" id="1730118">(</span><span class="ident" id="1730119">mcall</span><span class="op" id="1730124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730127">morestackPC</span>&nbsp;<span class="op" id="1730139">=</span>&nbsp;<span class="ident" id="1730141">funcPC</span><span class="op" id="1730147">(</span><span class="ident" id="1730148">morestack</span><span class="op" id="1730157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730160">mstartPC</span>&nbsp;<span class="op" id="1730169">=</span>&nbsp;<span class="ident" id="1730171">funcPC</span><span class="op" id="1730177">(</span><span class="ident" id="1730178">mstart</span><span class="op" id="1730184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730187">newprocPC</span>&nbsp;<span class="op" id="1730197">=</span>&nbsp;<span class="ident" id="1730199">funcPC</span><span class="op" id="1730205">(</span><span class="ident" id="1730206">newproc</span><span class="op" id="1730213">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730216">rt0_goPC</span>&nbsp;<span class="op" id="1730225">=</span>&nbsp;<span class="ident" id="1730227">funcPC</span><span class="op" id="1730233">(</span><span class="ident" id="1730234">rt0_go</span><span class="op" id="1730240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730243">sigpanicPC</span>&nbsp;<span class="op" id="1730254">=</span>&nbsp;<span class="ident" id="1730256">funcPC</span><span class="op" id="1730262">(</span><span class="ident" id="1730263">sigpanic</span><span class="op" id="1730271">)</span><br>
<span class="lineno"></span><span class="op" id="1730273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1730276">//&nbsp;Traceback&nbsp;over&nbsp;the&nbsp;deferred&nbsp;function&nbsp;calls.</span><br>
<span class="lineno">65</span><span class="comment" id="1730323">//&nbsp;Report&nbsp;them&nbsp;like&nbsp;calls&nbsp;that&nbsp;have&nbsp;been&nbsp;invoked&nbsp;but&nbsp;not&nbsp;started&nbsp;executing&nbsp;yet.</span><br>
<span class="lineno"></span><span class="keyword" id="1730403">func</span>&nbsp;<span class="ident" id="1730408">tracebackdefers</span><span class="op" id="1730423">(</span><span class="ident" id="1730424">gp</span>&nbsp;<span class="op" id="1730427">*</span><span class="ident" id="1730428">g</span><span class="op" id="1730429">,</span>&nbsp;<span class="ident" id="1730431">callback</span>&nbsp;<span class="keyword" id="1730440">func</span><span class="op" id="1730444">(</span><span class="op" id="1730445">*</span><span class="ident" id="1730446">stkframe</span><span class="op" id="1730454">,</span>&nbsp;<span class="ident" id="1730456">unsafe</span><span class="op" id="1730462">.</span><span class="ident" id="1730463">Pointer</span><span class="op" id="1730470">)</span>&nbsp;<span class="builtintype" id="1730472">bool</span><span class="op" id="1730476">,</span>&nbsp;<span class="ident" id="1730478">v</span>&nbsp;<span class="ident" id="1730480">unsafe</span><span class="op" id="1730486">.</span><span class="ident" id="1730487">Pointer</span><span class="op" id="1730494">)</span>&nbsp;<span class="op" id="1730496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1730499">var</span>&nbsp;<span class="ident" id="1730503">frame</span>&nbsp;<span class="ident" id="1730509">stkframe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1730519">for</span>&nbsp;<span class="ident" id="1730523">d</span>&nbsp;<span class="op" id="1730525">:=</span>&nbsp;<span class="ident" id="1730528">gp</span><span class="op" id="1730530">.</span><span class="ident" id="1730531">_defer</span><span class="op" id="1730537">;</span>&nbsp;<span class="ident" id="1730539">d</span>&nbsp;<span class="op" id="1730541">!=</span>&nbsp;<span class="builtintype" id="1730544">nil</span><span class="op" id="1730547">;</span>&nbsp;<span class="ident" id="1730549">d</span>&nbsp;<span class="op" id="1730551">=</span>&nbsp;<span class="ident" id="1730553">d</span><span class="op" id="1730554">.</span><span class="ident" id="1730555">link</span>&nbsp;<span class="op" id="1730560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730564">fn</span>&nbsp;<span class="op" id="1730567">:=</span>&nbsp;<span class="ident" id="1730570">d</span><span class="op" id="1730571">.</span><span class="ident" id="1730572">fn</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1730577">if</span>&nbsp;<span class="ident" id="1730580">fn</span>&nbsp;<span class="op" id="1730583">==</span>&nbsp;<span class="builtintype" id="1730586">nil</span>&nbsp;<span class="op" id="1730590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1730595">//&nbsp;Defer&nbsp;of&nbsp;nil&nbsp;function.&nbsp;Args&nbsp;don&#39;t&nbsp;matter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730643">frame</span><span class="op" id="1730648">.</span><span class="ident" id="1730649">pc</span>&nbsp;<span class="op" id="1730652">=</span>&nbsp;<span class="num" id="1730654">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730659">frame</span><span class="op" id="1730664">.</span><span class="ident" id="1730665">fn</span>&nbsp;<span class="op" id="1730668">=</span>&nbsp;<span class="builtintype" id="1730670">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730677">frame</span><span class="op" id="1730682">.</span><span class="ident" id="1730683">argp</span>&nbsp;<span class="op" id="1730688">=</span>&nbsp;<span class="num" id="1730690">0</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730695">frame</span><span class="op" id="1730700">.</span><span class="ident" id="1730701">arglen</span>&nbsp;<span class="op" id="1730708">=</span>&nbsp;<span class="num" id="1730710">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730715">frame</span><span class="op" id="1730720">.</span><span class="ident" id="1730721">argmap</span>&nbsp;<span class="op" id="1730728">=</span>&nbsp;<span class="builtintype" id="1730730">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1730736">}</span>&nbsp;<span class="keyword" id="1730738">else</span>&nbsp;<span class="op" id="1730743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730748">frame</span><span class="op" id="1730753">.</span><span class="ident" id="1730754">pc</span>&nbsp;<span class="op" id="1730757">=</span>&nbsp;<span class="builtintype" id="1730759">uintptr</span><span class="op" id="1730766">(</span><span class="ident" id="1730767">fn</span><span class="op" id="1730769">.</span><span class="ident" id="1730770">fn</span><span class="op" id="1730772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730777">f</span>&nbsp;<span class="op" id="1730779">:=</span>&nbsp;<span class="ident" id="1730782">findfunc</span><span class="op" id="1730790">(</span><span class="ident" id="1730791">frame</span><span class="op" id="1730796">.</span><span class="ident" id="1730797">pc</span><span class="op" id="1730799">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1730804">if</span>&nbsp;<span class="ident" id="1730807">f</span>&nbsp;<span class="op" id="1730809">==</span>&nbsp;<span class="builtintype" id="1730812">nil</span>&nbsp;<span class="op" id="1730816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1730822">print</span><span class="op" id="1730827">(</span><span class="string" id="1730828">&#34;runtime:&nbsp;unknown&nbsp;pc&nbsp;in&nbsp;defer&nbsp;&#34;</span><span class="op" id="1730859">,</span>&nbsp;<span class="ident" id="1730861">hex</span><span class="op" id="1730864">(</span><span class="ident" id="1730865">frame</span><span class="op" id="1730870">.</span><span class="ident" id="1730871">pc</span><span class="op" id="1730873">)</span><span class="op" id="1730874">,</span>&nbsp;<span class="string" id="1730876">&#34;\n&#34;</span><span class="op" id="1730880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730886">gothrow</span><span class="op" id="1730893">(</span><span class="string" id="1730894">&#34;unknown&nbsp;pc&#34;</span><span class="op" id="1730906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1730911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730916">frame</span><span class="op" id="1730921">.</span><span class="ident" id="1730922">fn</span>&nbsp;<span class="op" id="1730925">=</span>&nbsp;<span class="ident" id="1730927">f</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730932">frame</span><span class="op" id="1730937">.</span><span class="ident" id="1730938">argp</span>&nbsp;<span class="op" id="1730943">=</span>&nbsp;<span class="builtintype" id="1730945">uintptr</span><span class="op" id="1730952">(</span><span class="ident" id="1730953">deferArgs</span><span class="op" id="1730962">(</span><span class="ident" id="1730963">d</span><span class="op" id="1730964">)</span><span class="op" id="1730965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1730970">setArgInfo</span><span class="op" id="1730980">(</span><span class="op" id="1730981">&amp;</span><span class="ident" id="1730982">frame</span><span class="op" id="1730987">,</span>&nbsp;<span class="ident" id="1730989">f</span><span class="op" id="1730990">,</span>&nbsp;<span class="builtintype" id="1730992">true</span><span class="op" id="1730996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1731000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1731004">frame</span><span class="op" id="1731009">.</span><span class="ident" id="1731010">continpc</span>&nbsp;<span class="op" id="1731019">=</span>&nbsp;<span class="ident" id="1731021">frame</span><span class="op" id="1731026">.</span><span class="ident" id="1731027">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1731032">if</span>&nbsp;<span class="op" id="1731035">!</span><span class="ident" id="1731036">callback</span><span class="op" id="1731044">(</span><span class="op" id="1731045">(</span><span class="op" id="1731046">*</span><span class="ident" id="1731047">stkframe</span><span class="op" id="1731055">)</span><span class="op" id="1731056">(</span><span class="ident" id="1731057">noescape</span><span class="op" id="1731065">(</span><span class="ident" id="1731066">unsafe</span><span class="op" id="1731072">.</span><span class="ident" id="1731073">Pointer</span><span class="op" id="1731080">(</span><span class="op" id="1731081">&amp;</span><span class="ident" id="1731082">frame</span><span class="op" id="1731087">)</span><span class="op" id="1731088">)</span><span class="op" id="1731089">)</span><span class="op" id="1731090">,</span>&nbsp;<span class="ident" id="1731092">v</span><span class="op" id="1731093">)</span>&nbsp;<span class="op" id="1731095">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1731100">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1731109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1731112">}</span><br>
<span class="lineno"></span><span class="op" id="1731114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="1731117">//&nbsp;Generic&nbsp;traceback.&nbsp;&nbsp;Handles&nbsp;runtime&nbsp;stack&nbsp;prints&nbsp;(pcbuf&nbsp;==&nbsp;nil),</span><br>
<span class="lineno"></span><span class="comment" id="1731185">//&nbsp;the&nbsp;runtime.Callers&nbsp;function&nbsp;(pcbuf&nbsp;!=&nbsp;nil),&nbsp;as&nbsp;well&nbsp;as&nbsp;the&nbsp;garbage</span><br>
<span class="lineno"></span><span class="comment" id="1731256">//&nbsp;collector&nbsp;(callback&nbsp;!=&nbsp;nil).&nbsp;&nbsp;A&nbsp;little&nbsp;clunky&nbsp;to&nbsp;merge&nbsp;these,&nbsp;but&nbsp;avoids</span><br>
<span class="lineno"></span><span class="comment" id="1731332">//&nbsp;duplicating&nbsp;the&nbsp;code&nbsp;and&nbsp;all&nbsp;its&nbsp;subtlety.</span><br>
<span class="lineno"></span><span class="keyword" id="1731378">func</span>&nbsp;<span class="ident" id="1731383">gentraceback</span><span class="op" id="1731395">(</span><span class="ident" id="1731396">pc0</span>&nbsp;<span class="builtintype" id="1731400">uintptr</span><span class="op" id="1731407">,</span>&nbsp;<span class="ident" id="1731409">sp0</span>&nbsp;<span class="builtintype" id="1731413">uintptr</span><span class="op" id="1731420">,</span>&nbsp;<span class="ident" id="1731422">lr0</span>&nbsp;<span class="builtintype" id="1731426">uintptr</span><span class="op" id="1731433">,</span>&nbsp;<span class="ident" id="1731435">gp</span>&nbsp;<span class="op" id="1731438">*</span><span class="ident" id="1731439">g</span><span class="op" id="1731440">,</span>&nbsp;<span class="ident" id="1731442">skip</span>&nbsp;<span class="builtintype" id="1731447">int</span><span class="op" id="1731450">,</span>&nbsp;<span class="ident" id="1731452">pcbuf</span>&nbsp;<span class="op" id="1731458">*</span><span class="builtintype" id="1731459">uintptr</span><span class="op" id="1731466">,</span>&nbsp;<span class="ident" id="1731468">max</span>&nbsp;<span class="builtintype" id="1731472">int</span><span class="op" id="1731475">,</span>&nbsp;<span class="ident" id="1731477">callback</span>&nbsp;<span class="keyword" id="1731486">func</span><span class="op" id="1731490">(</span><span class="op" id="1731491">*</span><span class="ident" id="1731492">stkframe</span><span class="op" id="1731500">,</span>&nbsp;<span class="ident" id="1731502">unsafe</span><span class="op" id="1731508">.</span><span class="ident" id="1731509">Pointer</span><span class="op" id="1731516">)</span>&nbsp;<span class="builtintype" id="1731518">bool</span><span class="op" id="1731522">,</span>&nbsp;<span class="ident" id="1731524">v</span>&nbsp;<span class="ident" id="1731526">unsafe</span><span class="op" id="1731532">.</span><span class="ident" id="1731533">Pointer</span><span class="op" id="1731540">,</span>&nbsp;<span class="ident" id="1731542">flags</span>&nbsp;<span class="builtintype" id="1731548">uint</span><span class="op" id="1731552">)</span>&nbsp;<span class="builtintype" id="1731554">int</span>&nbsp;<span class="op" id="1731558">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1731561">if</span>&nbsp;<span class="ident" id="1731564">goexitPC</span>&nbsp;<span class="op" id="1731573">==</span>&nbsp;<span class="num" id="1731576">0</span>&nbsp;<span class="op" id="1731578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1731582">gothrow</span><span class="op" id="1731589">(</span><span class="string" id="1731590">&#34;gentraceback&nbsp;before&nbsp;goexitPC&nbsp;initialization&#34;</span><span class="op" id="1731635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1731638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1731641">g</span>&nbsp;<span class="op" id="1731643">:=</span>&nbsp;<span class="ident" id="1731646">getg</span><span class="op" id="1731650">(</span><span class="op" id="1731651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1731654">if</span>&nbsp;<span class="ident" id="1731657">g</span>&nbsp;<span class="op" id="1731659">==</span>&nbsp;<span class="ident" id="1731662">gp</span>&nbsp;<span class="op" id="1731665">&amp;&amp;</span>&nbsp;<span class="ident" id="1731668">g</span>&nbsp;<span class="op" id="1731670">==</span>&nbsp;<span class="ident" id="1731673">g</span><span class="op" id="1731674">.</span><span class="ident" id="1731675">m</span><span class="op" id="1731676">.</span><span class="ident" id="1731677">curg</span>&nbsp;<span class="op" id="1731682">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1731686">//&nbsp;The&nbsp;starting&nbsp;sp&nbsp;has&nbsp;been&nbsp;passed&nbsp;in&nbsp;as&nbsp;a&nbsp;uintptr,&nbsp;and&nbsp;the&nbsp;caller&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1731759">//&nbsp;have&nbsp;other&nbsp;uintptr-typed&nbsp;stack&nbsp;references&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1731815">//&nbsp;If&nbsp;during&nbsp;one&nbsp;of&nbsp;the&nbsp;calls&nbsp;that&nbsp;got&nbsp;us&nbsp;here&nbsp;or&nbsp;during&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1731885">//&nbsp;callbacks&nbsp;below&nbsp;the&nbsp;stack&nbsp;must&nbsp;be&nbsp;grown,&nbsp;all&nbsp;these&nbsp;uintptr&nbsp;references</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1731960">//&nbsp;to&nbsp;the&nbsp;stack&nbsp;will&nbsp;not&nbsp;be&nbsp;updated,&nbsp;and&nbsp;gentraceback&nbsp;will&nbsp;continue</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1732030">//&nbsp;to&nbsp;inspect&nbsp;the&nbsp;old&nbsp;stack&nbsp;memory,&nbsp;which&nbsp;may&nbsp;no&nbsp;longer&nbsp;be&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1732098">//&nbsp;Even&nbsp;if&nbsp;all&nbsp;the&nbsp;variables&nbsp;were&nbsp;updated&nbsp;correctly,&nbsp;it&nbsp;is&nbsp;not&nbsp;clear&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1732174">//&nbsp;we&nbsp;want&nbsp;to&nbsp;expose&nbsp;a&nbsp;traceback&nbsp;that&nbsp;begins&nbsp;on&nbsp;one&nbsp;stack&nbsp;and&nbsp;ends</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1732243">//&nbsp;on&nbsp;another&nbsp;stack.&nbsp;That&nbsp;could&nbsp;confuse&nbsp;callers&nbsp;quite&nbsp;a&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1732306">//&nbsp;Instead,&nbsp;we&nbsp;require&nbsp;that&nbsp;gentraceback&nbsp;and&nbsp;any&nbsp;other&nbsp;function&nbsp;that</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1732377">//&nbsp;accepts&nbsp;an&nbsp;sp&nbsp;for&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;(typically&nbsp;obtained&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1732445">//&nbsp;calling&nbsp;getcallersp)&nbsp;must&nbsp;not&nbsp;run&nbsp;on&nbsp;that&nbsp;goroutine&#39;s&nbsp;stack&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1732514">//&nbsp;instead&nbsp;on&nbsp;the&nbsp;g0&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1732544">gothrow</span><span class="op" id="1732551">(</span><span class="string" id="1732552">&#34;gentraceback&nbsp;cannot&nbsp;trace&nbsp;user&nbsp;goroutine&nbsp;on&nbsp;its&nbsp;own&nbsp;stack&#34;</span><span class="op" id="1732611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1732614">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1732617">gotraceback</span>&nbsp;<span class="op" id="1732629">:=</span>&nbsp;<span class="ident" id="1732632">gotraceback</span><span class="op" id="1732643">(</span><span class="builtintype" id="1732644">nil</span><span class="op" id="1732647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1732650">if</span>&nbsp;<span class="ident" id="1732653">pc0</span>&nbsp;<span class="op" id="1732657">==</span>&nbsp;<span class="op" id="1732660">^</span><span class="builtintype" id="1732661">uintptr</span><span class="op" id="1732668">(</span><span class="num" id="1732669">0</span><span class="op" id="1732670">)</span>&nbsp;<span class="op" id="1732672">&amp;&amp;</span>&nbsp;<span class="ident" id="1732675">sp0</span>&nbsp;<span class="op" id="1732679">==</span>&nbsp;<span class="op" id="1732682">^</span><span class="builtintype" id="1732683">uintptr</span><span class="op" id="1732690">(</span><span class="num" id="1732691">0</span><span class="op" id="1732692">)</span>&nbsp;<span class="op" id="1732694">{</span>&nbsp;<span class="comment" id="1732696">//&nbsp;Signal&nbsp;to&nbsp;fetch&nbsp;saved&nbsp;values&nbsp;from&nbsp;gp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1732739">if</span>&nbsp;<span class="ident" id="1732742">gp</span><span class="op" id="1732744">.</span><span class="ident" id="1732745">syscallsp</span>&nbsp;<span class="op" id="1732755">!=</span>&nbsp;<span class="num" id="1732758">0</span>&nbsp;<span class="op" id="1732760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1732765">pc0</span>&nbsp;<span class="op" id="1732769">=</span>&nbsp;<span class="ident" id="1732771">gp</span><span class="op" id="1732773">.</span><span class="ident" id="1732774">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1732787">sp0</span>&nbsp;<span class="op" id="1732791">=</span>&nbsp;<span class="ident" id="1732793">gp</span><span class="op" id="1732795">.</span><span class="ident" id="1732796">syscallsp</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1732809">if</span>&nbsp;<span class="ident" id="1732812">usesLR</span>&nbsp;<span class="op" id="1732819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1732825">lr0</span>&nbsp;<span class="op" id="1732829">=</span>&nbsp;<span class="num" id="1732831">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1732836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1732840">}</span>&nbsp;<span class="keyword" id="1732842">else</span>&nbsp;<span class="op" id="1732847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1732852">pc0</span>&nbsp;<span class="op" id="1732856">=</span>&nbsp;<span class="ident" id="1732858">gp</span><span class="op" id="1732860">.</span><span class="ident" id="1732861">sched</span><span class="op" id="1732866">.</span><span class="ident" id="1732867">pc</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1732873">sp0</span>&nbsp;<span class="op" id="1732877">=</span>&nbsp;<span class="ident" id="1732879">gp</span><span class="op" id="1732881">.</span><span class="ident" id="1732882">sched</span><span class="op" id="1732887">.</span><span class="ident" id="1732888">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1732894">if</span>&nbsp;<span class="ident" id="1732897">usesLR</span>&nbsp;<span class="op" id="1732904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1732910">lr0</span>&nbsp;<span class="op" id="1732914">=</span>&nbsp;<span class="ident" id="1732916">gp</span><span class="op" id="1732918">.</span><span class="ident" id="1732919">sched</span><span class="op" id="1732924">.</span><span class="ident" id="1732925">lr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1732931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1732935">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1732938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1732942">nprint</span>&nbsp;<span class="op" id="1732949">:=</span>&nbsp;<span class="num" id="1732952">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1732955">var</span>&nbsp;<span class="ident" id="1732959">frame</span>&nbsp;<span class="ident" id="1732965">stkframe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1732975">frame</span><span class="op" id="1732980">.</span><span class="ident" id="1732981">pc</span>&nbsp;<span class="op" id="1732984">=</span>&nbsp;<span class="ident" id="1732986">pc0</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1732991">frame</span><span class="op" id="1732996">.</span><span class="ident" id="1732997">sp</span>&nbsp;<span class="op" id="1733000">=</span>&nbsp;<span class="ident" id="1733002">sp0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1733007">if</span>&nbsp;<span class="ident" id="1733010">usesLR</span>&nbsp;<span class="op" id="1733017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1733021">frame</span><span class="op" id="1733026">.</span><span class="ident" id="1733027">lr</span>&nbsp;<span class="op" id="1733030">=</span>&nbsp;<span class="ident" id="1733032">lr0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1733037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1733040">waspanic</span>&nbsp;<span class="op" id="1733049">:=</span>&nbsp;<span class="builtintype" id="1733052">false</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1733059">wasnewproc</span>&nbsp;<span class="op" id="1733070">:=</span>&nbsp;<span class="builtintype" id="1733073">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1733080">printing</span>&nbsp;<span class="op" id="1733089">:=</span>&nbsp;<span class="ident" id="1733092">pcbuf</span>&nbsp;<span class="op" id="1733098">==</span>&nbsp;<span class="builtintype" id="1733101">nil</span>&nbsp;<span class="op" id="1733105">&amp;&amp;</span>&nbsp;<span class="ident" id="1733108">callback</span>&nbsp;<span class="op" id="1733117">==</span>&nbsp;<span class="builtintype" id="1733120">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1733125">_defer</span>&nbsp;<span class="op" id="1733132">:=</span>&nbsp;<span class="ident" id="1733135">gp</span><span class="op" id="1733137">.</span><span class="ident" id="1733138">_defer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1733147">for</span>&nbsp;<span class="ident" id="1733151">_defer</span>&nbsp;<span class="op" id="1733158">!=</span>&nbsp;<span class="builtintype" id="1733161">nil</span>&nbsp;<span class="op" id="1733165">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1733168">uintptr</span><span class="op" id="1733175">(</span><span class="ident" id="1733176">_defer</span><span class="op" id="1733182">.</span><span class="ident" id="1733183">argp</span><span class="op" id="1733187">)</span>&nbsp;<span class="op" id="1733189">==</span>&nbsp;<span class="ident" id="1733192">_NoArgs</span>&nbsp;<span class="op" id="1733200">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1733204">_defer</span>&nbsp;<span class="op" id="1733211">=</span>&nbsp;<span class="ident" id="1733213">_defer</span><span class="op" id="1733219">.</span><span class="ident" id="1733220">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1733226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1733230">//&nbsp;If&nbsp;the&nbsp;PC&nbsp;is&nbsp;zero,&nbsp;it&#39;s&nbsp;likely&nbsp;a&nbsp;nil&nbsp;function&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1733286">//&nbsp;Start&nbsp;in&nbsp;the&nbsp;caller&#39;s&nbsp;frame.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1733319">if</span>&nbsp;<span class="ident" id="1733322">frame</span><span class="op" id="1733327">.</span><span class="ident" id="1733328">pc</span>&nbsp;<span class="op" id="1733331">==</span>&nbsp;<span class="num" id="1733334">0</span>&nbsp;<span class="op" id="1733336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1733340">if</span>&nbsp;<span class="ident" id="1733343">usesLR</span>&nbsp;<span class="op" id="1733350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1733355">frame</span><span class="op" id="1733360">.</span><span class="ident" id="1733361">pc</span>&nbsp;<span class="op" id="1733364">=</span>&nbsp;<span class="op" id="1733366">*</span><span class="op" id="1733367">(</span><span class="op" id="1733368">*</span><span class="builtintype" id="1733369">uintptr</span><span class="op" id="1733376">)</span><span class="op" id="1733377">(</span><span class="ident" id="1733378">unsafe</span><span class="op" id="1733384">.</span><span class="ident" id="1733385">Pointer</span><span class="op" id="1733392">(</span><span class="ident" id="1733393">frame</span><span class="op" id="1733398">.</span><span class="ident" id="1733399">sp</span><span class="op" id="1733401">)</span><span class="op" id="1733402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1733407">frame</span><span class="op" id="1733412">.</span><span class="ident" id="1733413">lr</span>&nbsp;<span class="op" id="1733416">=</span>&nbsp;<span class="num" id="1733418">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1733422">}</span>&nbsp;<span class="keyword" id="1733424">else</span>&nbsp;<span class="op" id="1733429">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1733434">frame</span><span class="op" id="1733439">.</span><span class="ident" id="1733440">pc</span>&nbsp;<span class="op" id="1733443">=</span>&nbsp;<span class="builtintype" id="1733445">uintptr</span><span class="op" id="1733452">(</span><span class="op" id="1733453">*</span><span class="op" id="1733454">(</span><span class="op" id="1733455">*</span><span class="ident" id="1733456">uintreg</span><span class="op" id="1733463">)</span><span class="op" id="1733464">(</span><span class="ident" id="1733465">unsafe</span><span class="op" id="1733471">.</span><span class="ident" id="1733472">Pointer</span><span class="op" id="1733479">(</span><span class="ident" id="1733480">frame</span><span class="op" id="1733485">.</span><span class="ident" id="1733486">sp</span><span class="op" id="1733488">)</span><span class="op" id="1733489">)</span><span class="op" id="1733490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1733495">frame</span><span class="op" id="1733500">.</span><span class="ident" id="1733501">sp</span>&nbsp;<span class="op" id="1733504">+=</span>&nbsp;<span class="ident" id="1733507">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1733517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1733520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1733524">f</span>&nbsp;<span class="op" id="1733526">:=</span>&nbsp;<span class="ident" id="1733529">findfunc</span><span class="op" id="1733537">(</span><span class="ident" id="1733538">frame</span><span class="op" id="1733543">.</span><span class="ident" id="1733544">pc</span><span class="op" id="1733546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1733549">if</span>&nbsp;<span class="ident" id="1733552">f</span>&nbsp;<span class="op" id="1733554">==</span>&nbsp;<span class="builtintype" id="1733557">nil</span>&nbsp;<span class="op" id="1733561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1733565">if</span>&nbsp;<span class="ident" id="1733568">callback</span>&nbsp;<span class="op" id="1733577">!=</span>&nbsp;<span class="builtintype" id="1733580">nil</span>&nbsp;<span class="op" id="1733584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1733589">print</span><span class="op" id="1733594">(</span><span class="string" id="1733595">&#34;runtime:&nbsp;unknown&nbsp;pc&nbsp;&#34;</span><span class="op" id="1733617">,</span>&nbsp;<span class="ident" id="1733619">hex</span><span class="op" id="1733622">(</span><span class="ident" id="1733623">frame</span><span class="op" id="1733628">.</span><span class="ident" id="1733629">pc</span><span class="op" id="1733631">)</span><span class="op" id="1733632">,</span>&nbsp;<span class="string" id="1733634">&#34;\n&#34;</span><span class="op" id="1733638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1733643">gothrow</span><span class="op" id="1733650">(</span><span class="string" id="1733651">&#34;unknown&nbsp;pc&#34;</span><span class="op" id="1733663">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1733667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1733671">return</span>&nbsp;<span class="num" id="1733678">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1733681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1733684">frame</span><span class="op" id="1733689">.</span><span class="ident" id="1733690">fn</span>&nbsp;<span class="op" id="1733693">=</span>&nbsp;<span class="ident" id="1733695">f</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1733699">n</span>&nbsp;<span class="op" id="1733701">:=</span>&nbsp;<span class="num" id="1733704">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1733707">for</span>&nbsp;<span class="ident" id="1733711">n</span>&nbsp;<span class="op" id="1733713">&lt;</span>&nbsp;<span class="ident" id="1733715">max</span>&nbsp;<span class="op" id="1733719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1733723">//&nbsp;Typically:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1733739">//&nbsp;&nbsp;&nbsp;&nbsp;pc&nbsp;is&nbsp;the&nbsp;PC&nbsp;of&nbsp;the&nbsp;running&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1733782">//&nbsp;&nbsp;&nbsp;&nbsp;sp&nbsp;is&nbsp;the&nbsp;stack&nbsp;pointer&nbsp;at&nbsp;that&nbsp;program&nbsp;counter.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1733836">//&nbsp;&nbsp;&nbsp;&nbsp;fp&nbsp;is&nbsp;the&nbsp;frame&nbsp;pointer&nbsp;(caller&#39;s&nbsp;stack&nbsp;pointer)&nbsp;at&nbsp;that&nbsp;program&nbsp;counter,&nbsp;or&nbsp;nil&nbsp;if&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1733934">//&nbsp;&nbsp;&nbsp;&nbsp;stk&nbsp;is&nbsp;the&nbsp;stack&nbsp;containing&nbsp;sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1733971">//&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;caller&#39;s&nbsp;program&nbsp;counter&nbsp;is&nbsp;lr,&nbsp;unless&nbsp;lr&nbsp;is&nbsp;zero,&nbsp;in&nbsp;which&nbsp;case&nbsp;it&nbsp;is&nbsp;*(uintptr*)sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1734066">f</span>&nbsp;<span class="op" id="1734068">=</span>&nbsp;<span class="ident" id="1734070">frame</span><span class="op" id="1734075">.</span><span class="ident" id="1734076">fn</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1734082">//&nbsp;Found&nbsp;an&nbsp;actual&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1734113">//&nbsp;Derive&nbsp;frame&nbsp;pointer&nbsp;and&nbsp;link&nbsp;register.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1734158">if</span>&nbsp;<span class="ident" id="1734161">frame</span><span class="op" id="1734166">.</span><span class="ident" id="1734167">fp</span>&nbsp;<span class="op" id="1734170">==</span>&nbsp;<span class="num" id="1734173">0</span>&nbsp;<span class="op" id="1734175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1734180">frame</span><span class="op" id="1734185">.</span><span class="ident" id="1734186">fp</span>&nbsp;<span class="op" id="1734189">=</span>&nbsp;<span class="ident" id="1734191">frame</span><span class="op" id="1734196">.</span><span class="ident" id="1734197">sp</span>&nbsp;<span class="op" id="1734200">+</span>&nbsp;<span class="builtintype" id="1734202">uintptr</span><span class="op" id="1734209">(</span><span class="ident" id="1734210">funcspdelta</span><span class="op" id="1734221">(</span><span class="ident" id="1734222">f</span><span class="op" id="1734223">,</span>&nbsp;<span class="ident" id="1734225">frame</span><span class="op" id="1734230">.</span><span class="ident" id="1734231">pc</span><span class="op" id="1734233">)</span><span class="op" id="1734234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1734239">if</span>&nbsp;<span class="op" id="1734242">!</span><span class="ident" id="1734243">usesLR</span>&nbsp;<span class="op" id="1734250">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1734256">//&nbsp;On&nbsp;x86,&nbsp;call&nbsp;instruction&nbsp;pushes&nbsp;return&nbsp;PC&nbsp;before&nbsp;entering&nbsp;new&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1734335">frame</span><span class="op" id="1734340">.</span><span class="ident" id="1734341">fp</span>&nbsp;<span class="op" id="1734344">+=</span>&nbsp;<span class="ident" id="1734347">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1734358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1734362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1734366">var</span>&nbsp;<span class="ident" id="1734370">flr</span>&nbsp;<span class="op" id="1734374">*</span><span class="ident" id="1734375">_func</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1734383">if</span>&nbsp;<span class="ident" id="1734386">topofstack</span><span class="op" id="1734396">(</span><span class="ident" id="1734397">f</span><span class="op" id="1734398">)</span>&nbsp;<span class="op" id="1734400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1734405">frame</span><span class="op" id="1734410">.</span><span class="ident" id="1734411">lr</span>&nbsp;<span class="op" id="1734414">=</span>&nbsp;<span class="num" id="1734416">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1734421">flr</span>&nbsp;<span class="op" id="1734425">=</span>&nbsp;<span class="builtintype" id="1734427">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1734433">}</span>&nbsp;<span class="keyword" id="1734435">else</span>&nbsp;<span class="keyword" id="1734440">if</span>&nbsp;<span class="ident" id="1734443">usesLR</span>&nbsp;<span class="op" id="1734450">&amp;&amp;</span>&nbsp;<span class="ident" id="1734453">f</span><span class="op" id="1734454">.</span><span class="ident" id="1734455">entry</span>&nbsp;<span class="op" id="1734461">==</span>&nbsp;<span class="ident" id="1734464">jmpdeferPC</span>&nbsp;<span class="op" id="1734475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1734480">//&nbsp;jmpdefer&nbsp;modifies&nbsp;SP/LR/PC&nbsp;non-atomically.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1734529">//&nbsp;If&nbsp;a&nbsp;profiling&nbsp;interrupt&nbsp;arrives&nbsp;during&nbsp;jmpdefer,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1734585">//&nbsp;the&nbsp;stack&nbsp;unwind&nbsp;may&nbsp;see&nbsp;a&nbsp;mismatched&nbsp;register&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1734642">//&nbsp;and&nbsp;get&nbsp;confused.&nbsp;Stop&nbsp;if&nbsp;we&nbsp;see&nbsp;PC&nbsp;within&nbsp;jmpdefer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1734700">//&nbsp;to&nbsp;avoid&nbsp;that&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1734731">//&nbsp;See&nbsp;golang.org/issue/8153.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1734764">if</span>&nbsp;<span class="ident" id="1734767">callback</span>&nbsp;<span class="op" id="1734776">!=</span>&nbsp;<span class="builtintype" id="1734779">nil</span>&nbsp;<span class="op" id="1734783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1734789">gothrow</span><span class="op" id="1734796">(</span><span class="string" id="1734797">&#34;traceback_arm:&nbsp;found&nbsp;jmpdefer&nbsp;when&nbsp;tracing&nbsp;with&nbsp;callback&#34;</span><span class="op" id="1734855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1734860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1734865">frame</span><span class="op" id="1734870">.</span><span class="ident" id="1734871">lr</span>&nbsp;<span class="op" id="1734874">=</span>&nbsp;<span class="num" id="1734876">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1734880">}</span>&nbsp;<span class="keyword" id="1734882">else</span>&nbsp;<span class="op" id="1734887">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1734892">if</span>&nbsp;<span class="ident" id="1734895">usesLR</span>&nbsp;<span class="op" id="1734902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1734908">if</span>&nbsp;<span class="ident" id="1734911">n</span>&nbsp;<span class="op" id="1734913">==</span>&nbsp;<span class="num" id="1734916">0</span>&nbsp;<span class="op" id="1734918">&amp;&amp;</span>&nbsp;<span class="ident" id="1734921">frame</span><span class="op" id="1734926">.</span><span class="ident" id="1734927">sp</span>&nbsp;<span class="op" id="1734930">&lt;</span>&nbsp;<span class="ident" id="1734932">frame</span><span class="op" id="1734937">.</span><span class="ident" id="1734938">fp</span>&nbsp;<span class="op" id="1734941">||</span>&nbsp;<span class="ident" id="1734944">frame</span><span class="op" id="1734949">.</span><span class="ident" id="1734950">lr</span>&nbsp;<span class="op" id="1734953">==</span>&nbsp;<span class="num" id="1734956">0</span>&nbsp;<span class="op" id="1734958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1734965">frame</span><span class="op" id="1734970">.</span><span class="ident" id="1734971">lr</span>&nbsp;<span class="op" id="1734974">=</span>&nbsp;<span class="op" id="1734976">*</span><span class="op" id="1734977">(</span><span class="op" id="1734978">*</span><span class="builtintype" id="1734979">uintptr</span><span class="op" id="1734986">)</span><span class="op" id="1734987">(</span><span class="ident" id="1734988">unsafe</span><span class="op" id="1734994">.</span><span class="ident" id="1734995">Pointer</span><span class="op" id="1735002">(</span><span class="ident" id="1735003">frame</span><span class="op" id="1735008">.</span><span class="ident" id="1735009">sp</span><span class="op" id="1735011">)</span><span class="op" id="1735012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1735018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1735023">}</span>&nbsp;<span class="keyword" id="1735025">else</span>&nbsp;<span class="op" id="1735030">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1735036">if</span>&nbsp;<span class="ident" id="1735039">frame</span><span class="op" id="1735044">.</span><span class="ident" id="1735045">lr</span>&nbsp;<span class="op" id="1735048">==</span>&nbsp;<span class="num" id="1735051">0</span>&nbsp;<span class="op" id="1735053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1735060">frame</span><span class="op" id="1735065">.</span><span class="ident" id="1735066">lr</span>&nbsp;<span class="op" id="1735069">=</span>&nbsp;<span class="builtintype" id="1735071">uintptr</span><span class="op" id="1735078">(</span><span class="op" id="1735079">*</span><span class="op" id="1735080">(</span><span class="op" id="1735081">*</span><span class="ident" id="1735082">uintreg</span><span class="op" id="1735089">)</span><span class="op" id="1735090">(</span><span class="ident" id="1735091">unsafe</span><span class="op" id="1735097">.</span><span class="ident" id="1735098">Pointer</span><span class="op" id="1735105">(</span><span class="ident" id="1735106">frame</span><span class="op" id="1735111">.</span><span class="ident" id="1735112">fp</span>&nbsp;<span class="op" id="1735115">-</span>&nbsp;<span class="ident" id="1735117">regSize</span><span class="op" id="1735124">)</span><span class="op" id="1735125">)</span><span class="op" id="1735126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1735132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1735137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1735142">flr</span>&nbsp;<span class="op" id="1735146">=</span>&nbsp;<span class="ident" id="1735148">findfunc</span><span class="op" id="1735156">(</span><span class="ident" id="1735157">frame</span><span class="op" id="1735162">.</span><span class="ident" id="1735163">lr</span><span class="op" id="1735165">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1735170">if</span>&nbsp;<span class="ident" id="1735173">flr</span>&nbsp;<span class="op" id="1735177">==</span>&nbsp;<span class="builtintype" id="1735180">nil</span>&nbsp;<span class="op" id="1735184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1735190">//&nbsp;This&nbsp;happens&nbsp;if&nbsp;you&nbsp;get&nbsp;a&nbsp;profiling&nbsp;interrupt&nbsp;at&nbsp;just&nbsp;the&nbsp;wrong&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1735267">//&nbsp;In&nbsp;that&nbsp;context&nbsp;it&nbsp;is&nbsp;okay&nbsp;to&nbsp;stop&nbsp;early.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1735316">//&nbsp;But&nbsp;if&nbsp;callback&nbsp;is&nbsp;set,&nbsp;we&#39;re&nbsp;doing&nbsp;a&nbsp;garbage&nbsp;collection&nbsp;and&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1735389">//&nbsp;get&nbsp;everything,&nbsp;so&nbsp;crash&nbsp;loudly.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1735429">if</span>&nbsp;<span class="ident" id="1735432">callback</span>&nbsp;<span class="op" id="1735441">!=</span>&nbsp;<span class="builtintype" id="1735444">nil</span>&nbsp;<span class="op" id="1735448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1735455">print</span><span class="op" id="1735460">(</span><span class="string" id="1735461">&#34;runtime:&nbsp;unexpected&nbsp;return&nbsp;pc&nbsp;for&nbsp;&#34;</span><span class="op" id="1735497">,</span>&nbsp;<span class="ident" id="1735499">gofuncname</span><span class="op" id="1735509">(</span><span class="ident" id="1735510">f</span><span class="op" id="1735511">)</span><span class="op" id="1735512">,</span>&nbsp;<span class="string" id="1735514">&#34;&nbsp;called&nbsp;from&nbsp;&#34;</span><span class="op" id="1735529">,</span>&nbsp;<span class="ident" id="1735531">hex</span><span class="op" id="1735534">(</span><span class="ident" id="1735535">frame</span><span class="op" id="1735540">.</span><span class="ident" id="1735541">lr</span><span class="op" id="1735543">)</span><span class="op" id="1735544">,</span>&nbsp;<span class="string" id="1735546">&#34;\n&#34;</span><span class="op" id="1735550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1735557">gothrow</span><span class="op" id="1735564">(</span><span class="string" id="1735565">&#34;unknown&nbsp;caller&nbsp;pc&#34;</span><span class="op" id="1735584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1735590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1735595">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1735599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1735604">frame</span><span class="op" id="1735609">.</span><span class="ident" id="1735610">varp</span>&nbsp;<span class="op" id="1735615">=</span>&nbsp;<span class="ident" id="1735617">frame</span><span class="op" id="1735622">.</span><span class="ident" id="1735623">fp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1735628">if</span>&nbsp;<span class="op" id="1735631">!</span><span class="ident" id="1735632">usesLR</span>&nbsp;<span class="op" id="1735639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1735644">//&nbsp;On&nbsp;x86,&nbsp;call&nbsp;instruction&nbsp;pushes&nbsp;return&nbsp;PC&nbsp;before&nbsp;entering&nbsp;new&nbsp;function.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1735722">frame</span><span class="op" id="1735727">.</span><span class="ident" id="1735728">varp</span>&nbsp;<span class="op" id="1735733">-=</span>&nbsp;<span class="ident" id="1735736">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1735746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1735751">//&nbsp;Derive&nbsp;size&nbsp;of&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1735782">//&nbsp;Most&nbsp;functions&nbsp;have&nbsp;a&nbsp;fixed-size&nbsp;argument&nbsp;block,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1735836">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;metadata&nbsp;about&nbsp;the&nbsp;function&nbsp;f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1735886">//&nbsp;Not&nbsp;all,&nbsp;though:&nbsp;there&nbsp;are&nbsp;some&nbsp;variadic&nbsp;functions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1735942">//&nbsp;in&nbsp;package&nbsp;runtime&nbsp;and&nbsp;reflect,&nbsp;and&nbsp;for&nbsp;those&nbsp;we&nbsp;use&nbsp;call-specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1736014">//&nbsp;metadata&nbsp;recorded&nbsp;by&nbsp;f&#39;s&nbsp;caller.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1736052">if</span>&nbsp;<span class="ident" id="1736055">callback</span>&nbsp;<span class="op" id="1736064">!=</span>&nbsp;<span class="builtintype" id="1736067">nil</span>&nbsp;<span class="op" id="1736071">||</span>&nbsp;<span class="ident" id="1736074">printing</span>&nbsp;<span class="op" id="1736083">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736088">frame</span><span class="op" id="1736093">.</span><span class="ident" id="1736094">argp</span>&nbsp;<span class="op" id="1736099">=</span>&nbsp;<span class="ident" id="1736101">frame</span><span class="op" id="1736106">.</span><span class="ident" id="1736107">fp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1736113">if</span>&nbsp;<span class="ident" id="1736116">usesLR</span>&nbsp;<span class="op" id="1736123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736129">frame</span><span class="op" id="1736134">.</span><span class="ident" id="1736135">argp</span>&nbsp;<span class="op" id="1736140">+=</span>&nbsp;<span class="ident" id="1736143">ptrSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1736154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736159">setArgInfo</span><span class="op" id="1736169">(</span><span class="op" id="1736170">&amp;</span><span class="ident" id="1736171">frame</span><span class="op" id="1736176">,</span>&nbsp;<span class="ident" id="1736178">f</span><span class="op" id="1736179">,</span>&nbsp;<span class="ident" id="1736181">callback</span>&nbsp;<span class="op" id="1736190">!=</span>&nbsp;<span class="builtintype" id="1736193">nil</span><span class="op" id="1736196">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1736200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1736205">//&nbsp;Determine&nbsp;function&nbsp;SP&nbsp;where&nbsp;deferproc&nbsp;would&nbsp;find&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1736274">var</span>&nbsp;<span class="ident" id="1736278">sparg</span>&nbsp;<span class="builtintype" id="1736284">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1736294">if</span>&nbsp;<span class="ident" id="1736297">usesLR</span>&nbsp;<span class="op" id="1736304">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1736309">//&nbsp;On&nbsp;link&nbsp;register&nbsp;architectures,&nbsp;that&#39;s&nbsp;the&nbsp;standard&nbsp;bottom-of-stack&nbsp;plus&nbsp;1&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1736395">//&nbsp;for&nbsp;the&nbsp;saved&nbsp;LR.&nbsp;If&nbsp;the&nbsp;previous&nbsp;frame&nbsp;was&nbsp;a&nbsp;direct&nbsp;call&nbsp;to&nbsp;newproc/deferproc,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1736481">//&nbsp;however,&nbsp;the&nbsp;SP&nbsp;is&nbsp;three&nbsp;words&nbsp;lower&nbsp;than&nbsp;normal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1736537">//&nbsp;If&nbsp;the&nbsp;function&nbsp;has&nbsp;no&nbsp;frame&nbsp;at&nbsp;all&nbsp;-&nbsp;perhaps&nbsp;it&nbsp;just&nbsp;started,&nbsp;or&nbsp;perhaps</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1736617">//&nbsp;it&nbsp;is&nbsp;a&nbsp;leaf&nbsp;with&nbsp;no&nbsp;local&nbsp;variables&nbsp;-&nbsp;then&nbsp;we&nbsp;cannot&nbsp;possibly&nbsp;find&nbsp;its</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1736695">//&nbsp;SP&nbsp;in&nbsp;a&nbsp;defer,&nbsp;and&nbsp;we&nbsp;might&nbsp;confuse&nbsp;its&nbsp;SP&nbsp;for&nbsp;its&nbsp;caller&#39;s&nbsp;SP,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1736768">//&nbsp;leave&nbsp;sparg=0&nbsp;in&nbsp;that&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1736802">if</span>&nbsp;<span class="ident" id="1736805">frame</span><span class="op" id="1736810">.</span><span class="ident" id="1736811">fp</span>&nbsp;<span class="op" id="1736814">!=</span>&nbsp;<span class="ident" id="1736817">frame</span><span class="op" id="1736822">.</span><span class="ident" id="1736823">sp</span>&nbsp;<span class="op" id="1736826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736832">sparg</span>&nbsp;<span class="op" id="1736838">=</span>&nbsp;<span class="ident" id="1736840">frame</span><span class="op" id="1736845">.</span><span class="ident" id="1736846">sp</span>&nbsp;<span class="op" id="1736849">+</span>&nbsp;<span class="ident" id="1736851">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1736863">if</span>&nbsp;<span class="ident" id="1736866">wasnewproc</span>&nbsp;<span class="op" id="1736877">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1736884">sparg</span>&nbsp;<span class="op" id="1736890">+=</span>&nbsp;<span class="num" id="1736893">3</span>&nbsp;<span class="op" id="1736895">*</span>&nbsp;<span class="ident" id="1736897">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1736909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1736914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1736918">}</span>&nbsp;<span class="keyword" id="1736920">else</span>&nbsp;<span class="op" id="1736925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1736930">//&nbsp;On&nbsp;x86&nbsp;that&#39;s&nbsp;the&nbsp;standard&nbsp;bottom-of-stack,&nbsp;so&nbsp;SP&nbsp;exactly.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1736995">//&nbsp;If&nbsp;the&nbsp;previous&nbsp;frame&nbsp;was&nbsp;a&nbsp;direct&nbsp;call&nbsp;to&nbsp;newproc/deferproc,&nbsp;however,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1737072">//&nbsp;the&nbsp;SP&nbsp;is&nbsp;two&nbsp;words&nbsp;lower&nbsp;than&nbsp;normal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1737117">sparg</span>&nbsp;<span class="op" id="1737123">=</span>&nbsp;<span class="ident" id="1737125">frame</span><span class="op" id="1737130">.</span><span class="ident" id="1737131">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1737137">if</span>&nbsp;<span class="ident" id="1737140">wasnewproc</span>&nbsp;<span class="op" id="1737151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1737157">sparg</span>&nbsp;<span class="op" id="1737163">+=</span>&nbsp;<span class="num" id="1737166">2</span>&nbsp;<span class="op" id="1737168">*</span>&nbsp;<span class="ident" id="1737170">ptrSize</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1737181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1737185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1737190">//&nbsp;Determine&nbsp;frame&#39;s&nbsp;&#39;continuation&nbsp;PC&#39;,&nbsp;where&nbsp;it&nbsp;can&nbsp;continue.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1737255">//&nbsp;Normally&nbsp;this&nbsp;is&nbsp;the&nbsp;return&nbsp;address&nbsp;on&nbsp;the&nbsp;stack,&nbsp;but&nbsp;if&nbsp;sigpanic</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1737326">//&nbsp;is&nbsp;immediately&nbsp;below&nbsp;this&nbsp;function&nbsp;on&nbsp;the&nbsp;stack,&nbsp;then&nbsp;the&nbsp;frame</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1737395">//&nbsp;stopped&nbsp;executing&nbsp;due&nbsp;to&nbsp;a&nbsp;trap,&nbsp;and&nbsp;frame.pc&nbsp;is&nbsp;probably&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1737462">//&nbsp;a&nbsp;safe&nbsp;point&nbsp;for&nbsp;looking&nbsp;up&nbsp;liveness&nbsp;information.&nbsp;In&nbsp;this&nbsp;panicking&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1737541">//&nbsp;the&nbsp;function&nbsp;either&nbsp;doesn&#39;t&nbsp;return&nbsp;at&nbsp;all&nbsp;(if&nbsp;it&nbsp;has&nbsp;no&nbsp;defers&nbsp;or&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1737619">//&nbsp;defers&nbsp;do&nbsp;not&nbsp;recover)&nbsp;or&nbsp;it&nbsp;returns&nbsp;from&nbsp;one&nbsp;of&nbsp;the&nbsp;calls&nbsp;to</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1737686">//&nbsp;deferproc&nbsp;a&nbsp;second&nbsp;time&nbsp;(if&nbsp;the&nbsp;corresponding&nbsp;deferred&nbsp;func&nbsp;recovers).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1737762">//&nbsp;It&nbsp;suffices&nbsp;to&nbsp;assume&nbsp;that&nbsp;the&nbsp;most&nbsp;recent&nbsp;deferproc&nbsp;is&nbsp;the&nbsp;one&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1737836">//&nbsp;returns;&nbsp;everything&nbsp;live&nbsp;at&nbsp;earlier&nbsp;deferprocs&nbsp;is&nbsp;still&nbsp;live&nbsp;at&nbsp;that&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1737915">frame</span><span class="op" id="1737920">.</span><span class="ident" id="1737921">continpc</span>&nbsp;<span class="op" id="1737930">=</span>&nbsp;<span class="ident" id="1737932">frame</span><span class="op" id="1737937">.</span><span class="ident" id="1737938">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1737943">if</span>&nbsp;<span class="ident" id="1737946">waspanic</span>&nbsp;<span class="op" id="1737955">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1737960">if</span>&nbsp;<span class="ident" id="1737963">_defer</span>&nbsp;<span class="op" id="1737970">!=</span>&nbsp;<span class="builtintype" id="1737973">nil</span>&nbsp;<span class="op" id="1737977">&amp;&amp;</span>&nbsp;<span class="ident" id="1737980">_defer</span><span class="op" id="1737986">.</span><span class="ident" id="1737987">argp</span>&nbsp;<span class="op" id="1737992">==</span>&nbsp;<span class="ident" id="1737995">sparg</span>&nbsp;<span class="op" id="1738001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738007">frame</span><span class="op" id="1738012">.</span><span class="ident" id="1738013">continpc</span>&nbsp;<span class="op" id="1738022">=</span>&nbsp;<span class="ident" id="1738024">_defer</span><span class="op" id="1738030">.</span><span class="ident" id="1738031">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1738037">}</span>&nbsp;<span class="keyword" id="1738039">else</span>&nbsp;<span class="op" id="1738044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738050">frame</span><span class="op" id="1738055">.</span><span class="ident" id="1738056">continpc</span>&nbsp;<span class="op" id="1738065">=</span>&nbsp;<span class="num" id="1738067">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1738072">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1738076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1738081">//&nbsp;Unwind&nbsp;our&nbsp;local&nbsp;defer&nbsp;stack&nbsp;past&nbsp;this&nbsp;frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1738132">for</span>&nbsp;<span class="ident" id="1738136">_defer</span>&nbsp;<span class="op" id="1738143">!=</span>&nbsp;<span class="builtintype" id="1738146">nil</span>&nbsp;<span class="op" id="1738150">&amp;&amp;</span>&nbsp;<span class="op" id="1738153">(</span><span class="ident" id="1738154">_defer</span><span class="op" id="1738160">.</span><span class="ident" id="1738161">argp</span>&nbsp;<span class="op" id="1738166">==</span>&nbsp;<span class="ident" id="1738169">sparg</span>&nbsp;<span class="op" id="1738175">||</span>&nbsp;<span class="ident" id="1738178">_defer</span><span class="op" id="1738184">.</span><span class="ident" id="1738185">argp</span>&nbsp;<span class="op" id="1738190">==</span>&nbsp;<span class="ident" id="1738193">_NoArgs</span><span class="op" id="1738200">)</span>&nbsp;<span class="op" id="1738202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738207">_defer</span>&nbsp;<span class="op" id="1738214">=</span>&nbsp;<span class="ident" id="1738216">_defer</span><span class="op" id="1738222">.</span><span class="ident" id="1738223">link</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1738230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1738235">if</span>&nbsp;<span class="ident" id="1738238">skip</span>&nbsp;<span class="op" id="1738243">&gt;</span>&nbsp;<span class="num" id="1738245">0</span>&nbsp;<span class="op" id="1738247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738252">skip</span><span class="op" id="1738256">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1738262">goto</span>&nbsp;<span class="ident" id="1738267">skipped</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1738277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1738282">if</span>&nbsp;<span class="ident" id="1738285">pcbuf</span>&nbsp;<span class="op" id="1738291">!=</span>&nbsp;<span class="builtintype" id="1738294">nil</span>&nbsp;<span class="op" id="1738298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1738303">(</span><span class="op" id="1738304">*</span><span class="op" id="1738305">[</span><span class="num" id="1738306">1</span>&nbsp;<span class="op" id="1738308">&lt;&lt;</span>&nbsp;<span class="num" id="1738311">20</span><span class="op" id="1738313">]</span><span class="builtintype" id="1738314">uintptr</span><span class="op" id="1738321">)</span><span class="op" id="1738322">(</span><span class="ident" id="1738323">unsafe</span><span class="op" id="1738329">.</span><span class="ident" id="1738330">Pointer</span><span class="op" id="1738337">(</span><span class="ident" id="1738338">pcbuf</span><span class="op" id="1738343">)</span><span class="op" id="1738344">)</span><span class="op" id="1738345">[</span><span class="ident" id="1738346">n</span><span class="op" id="1738347">]</span>&nbsp;<span class="op" id="1738349">=</span>&nbsp;<span class="ident" id="1738351">frame</span><span class="op" id="1738356">.</span><span class="ident" id="1738357">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1738362">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1738366">if</span>&nbsp;<span class="ident" id="1738369">callback</span>&nbsp;<span class="op" id="1738378">!=</span>&nbsp;<span class="builtintype" id="1738381">nil</span>&nbsp;<span class="op" id="1738385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1738390">if</span>&nbsp;<span class="op" id="1738393">!</span><span class="ident" id="1738394">callback</span><span class="op" id="1738402">(</span><span class="op" id="1738403">(</span><span class="op" id="1738404">*</span><span class="ident" id="1738405">stkframe</span><span class="op" id="1738413">)</span><span class="op" id="1738414">(</span><span class="ident" id="1738415">noescape</span><span class="op" id="1738423">(</span><span class="ident" id="1738424">unsafe</span><span class="op" id="1738430">.</span><span class="ident" id="1738431">Pointer</span><span class="op" id="1738438">(</span><span class="op" id="1738439">&amp;</span><span class="ident" id="1738440">frame</span><span class="op" id="1738445">)</span><span class="op" id="1738446">)</span><span class="op" id="1738447">)</span><span class="op" id="1738448">,</span>&nbsp;<span class="ident" id="1738450">v</span><span class="op" id="1738451">)</span>&nbsp;<span class="op" id="1738453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1738459">return</span>&nbsp;<span class="ident" id="1738466">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1738471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1738475">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1738479">if</span>&nbsp;<span class="ident" id="1738482">printing</span>&nbsp;<span class="op" id="1738491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1738496">if</span>&nbsp;<span class="op" id="1738499">(</span><span class="ident" id="1738500">flags</span><span class="op" id="1738505">&amp;</span><span class="ident" id="1738506">_TraceRuntimeFrames</span><span class="op" id="1738525">)</span>&nbsp;<span class="op" id="1738527">!=</span>&nbsp;<span class="num" id="1738530">0</span>&nbsp;<span class="op" id="1738532">||</span>&nbsp;<span class="ident" id="1738535">showframe</span><span class="op" id="1738544">(</span><span class="ident" id="1738545">f</span><span class="op" id="1738546">,</span>&nbsp;<span class="ident" id="1738548">gp</span><span class="op" id="1738550">)</span>&nbsp;<span class="op" id="1738552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1738558">//&nbsp;Print&nbsp;during&nbsp;crash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1738585">//&nbsp;&nbsp;&nbsp;&nbsp;main(0x1,&nbsp;0x2,&nbsp;0x3)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1738612">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/home/rsc/go/src/runtime/x.go:23&nbsp;+0xf</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1738658">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738665">tracepc</span>&nbsp;<span class="op" id="1738673">:=</span>&nbsp;<span class="ident" id="1738676">frame</span><span class="op" id="1738681">.</span><span class="ident" id="1738682">pc</span>&nbsp;<span class="comment" id="1738685">//&nbsp;back&nbsp;up&nbsp;to&nbsp;CALL&nbsp;instruction&nbsp;for&nbsp;funcline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1738734">if</span>&nbsp;<span class="op" id="1738737">(</span><span class="ident" id="1738738">n</span>&nbsp;<span class="op" id="1738740">&gt;</span>&nbsp;<span class="num" id="1738742">0</span>&nbsp;<span class="op" id="1738744">||</span>&nbsp;<span class="ident" id="1738747">flags</span><span class="op" id="1738752">&amp;</span><span class="ident" id="1738753">_TraceTrap</span>&nbsp;<span class="op" id="1738764">==</span>&nbsp;<span class="num" id="1738767">0</span><span class="op" id="1738768">)</span>&nbsp;<span class="op" id="1738770">&amp;&amp;</span>&nbsp;<span class="ident" id="1738773">frame</span><span class="op" id="1738778">.</span><span class="ident" id="1738779">pc</span>&nbsp;<span class="op" id="1738782">&gt;</span>&nbsp;<span class="ident" id="1738784">f</span><span class="op" id="1738785">.</span><span class="ident" id="1738786">entry</span>&nbsp;<span class="op" id="1738792">&amp;&amp;</span>&nbsp;<span class="op" id="1738795">!</span><span class="ident" id="1738796">waspanic</span>&nbsp;<span class="op" id="1738805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738812">tracepc</span><span class="op" id="1738819">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1738826">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1738832">print</span><span class="op" id="1738837">(</span><span class="ident" id="1738838">gofuncname</span><span class="op" id="1738848">(</span><span class="ident" id="1738849">f</span><span class="op" id="1738850">)</span><span class="op" id="1738851">,</span>&nbsp;<span class="string" id="1738853">&#34;(&#34;</span><span class="op" id="1738856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1738862">argp</span>&nbsp;<span class="op" id="1738867">:=</span>&nbsp;<span class="op" id="1738870">(</span><span class="op" id="1738871">*</span><span class="op" id="1738872">[</span><span class="num" id="1738873">100</span><span class="op" id="1738876">]</span><span class="builtintype" id="1738877">uintptr</span><span class="op" id="1738884">)</span><span class="op" id="1738885">(</span><span class="ident" id="1738886">unsafe</span><span class="op" id="1738892">.</span><span class="ident" id="1738893">Pointer</span><span class="op" id="1738900">(</span><span class="ident" id="1738901">frame</span><span class="op" id="1738906">.</span><span class="ident" id="1738907">argp</span><span class="op" id="1738911">)</span><span class="op" id="1738912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1738918">for</span>&nbsp;<span class="ident" id="1738922">i</span>&nbsp;<span class="op" id="1738924">:=</span>&nbsp;<span class="builtintype" id="1738927">uintptr</span><span class="op" id="1738934">(</span><span class="num" id="1738935">0</span><span class="op" id="1738936">)</span><span class="op" id="1738937">;</span>&nbsp;<span class="ident" id="1738939">i</span>&nbsp;<span class="op" id="1738941">&lt;</span>&nbsp;<span class="ident" id="1738943">frame</span><span class="op" id="1738948">.</span><span class="ident" id="1738949">arglen</span><span class="op" id="1738955">/</span><span class="ident" id="1738956">ptrSize</span><span class="op" id="1738963">;</span>&nbsp;<span class="ident" id="1738965">i</span><span class="op" id="1738966">++</span>&nbsp;<span class="op" id="1738969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1738976">if</span>&nbsp;<span class="ident" id="1738979">i</span>&nbsp;<span class="op" id="1738981">&gt;=</span>&nbsp;<span class="num" id="1738984">10</span>&nbsp;<span class="op" id="1738987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1738995">print</span><span class="op" id="1739000">(</span><span class="string" id="1739001">&#34;,&nbsp;...&#34;</span><span class="op" id="1739008">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1739016">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1739027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1739034">if</span>&nbsp;<span class="ident" id="1739037">i</span>&nbsp;<span class="op" id="1739039">!=</span>&nbsp;<span class="num" id="1739042">0</span>&nbsp;<span class="op" id="1739044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1739052">print</span><span class="op" id="1739057">(</span><span class="string" id="1739058">&#34;,&nbsp;&#34;</span><span class="op" id="1739062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1739069">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1739076">print</span><span class="op" id="1739081">(</span><span class="ident" id="1739082">hex</span><span class="op" id="1739085">(</span><span class="ident" id="1739086">argp</span><span class="op" id="1739090">[</span><span class="ident" id="1739091">i</span><span class="op" id="1739092">]</span><span class="op" id="1739093">)</span><span class="op" id="1739094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1739100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1739106">print</span><span class="op" id="1739111">(</span><span class="string" id="1739112">&#34;)\n&#34;</span><span class="op" id="1739117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1739123">var</span>&nbsp;<span class="ident" id="1739127">file</span>&nbsp;<span class="builtintype" id="1739132">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739143">line</span>&nbsp;<span class="op" id="1739148">:=</span>&nbsp;<span class="ident" id="1739151">funcline</span><span class="op" id="1739159">(</span><span class="ident" id="1739160">f</span><span class="op" id="1739161">,</span>&nbsp;<span class="ident" id="1739163">tracepc</span><span class="op" id="1739170">,</span>&nbsp;<span class="op" id="1739172">&amp;</span><span class="ident" id="1739173">file</span><span class="op" id="1739177">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1739183">print</span><span class="op" id="1739188">(</span><span class="string" id="1739189">&#34;\t&#34;</span><span class="op" id="1739193">,</span>&nbsp;<span class="ident" id="1739195">file</span><span class="op" id="1739199">,</span>&nbsp;<span class="string" id="1739201">&#34;:&#34;</span><span class="op" id="1739204">,</span>&nbsp;<span class="ident" id="1739206">line</span><span class="op" id="1739210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1739216">if</span>&nbsp;<span class="ident" id="1739219">frame</span><span class="op" id="1739224">.</span><span class="ident" id="1739225">pc</span>&nbsp;<span class="op" id="1739228">&gt;</span>&nbsp;<span class="ident" id="1739230">f</span><span class="op" id="1739231">.</span><span class="ident" id="1739232">entry</span>&nbsp;<span class="op" id="1739238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1739245">print</span><span class="op" id="1739250">(</span><span class="string" id="1739251">&#34;&nbsp;+&#34;</span><span class="op" id="1739255">,</span>&nbsp;<span class="ident" id="1739257">hex</span><span class="op" id="1739260">(</span><span class="ident" id="1739261">frame</span><span class="op" id="1739266">.</span><span class="ident" id="1739267">pc</span><span class="op" id="1739269">-</span><span class="ident" id="1739270">f</span><span class="op" id="1739271">.</span><span class="ident" id="1739272">entry</span><span class="op" id="1739277">)</span><span class="op" id="1739278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1739284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1739290">if</span>&nbsp;<span class="ident" id="1739293">g</span><span class="op" id="1739294">.</span><span class="ident" id="1739295">m</span><span class="op" id="1739296">.</span><span class="ident" id="1739297">throwing</span>&nbsp;<span class="op" id="1739306">&gt;</span>&nbsp;<span class="num" id="1739308">0</span>&nbsp;<span class="op" id="1739310">&amp;&amp;</span>&nbsp;<span class="ident" id="1739313">gp</span>&nbsp;<span class="op" id="1739316">==</span>&nbsp;<span class="ident" id="1739319">g</span><span class="op" id="1739320">.</span><span class="ident" id="1739321">m</span><span class="op" id="1739322">.</span><span class="ident" id="1739323">curg</span>&nbsp;<span class="op" id="1739328">||</span>&nbsp;<span class="ident" id="1739331">gotraceback</span>&nbsp;<span class="op" id="1739343">&gt;=</span>&nbsp;<span class="num" id="1739346">2</span>&nbsp;<span class="op" id="1739348">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1739355">print</span><span class="op" id="1739360">(</span><span class="string" id="1739361">&#34;&nbsp;fp=&#34;</span><span class="op" id="1739367">,</span>&nbsp;<span class="ident" id="1739369">hex</span><span class="op" id="1739372">(</span><span class="ident" id="1739373">frame</span><span class="op" id="1739378">.</span><span class="ident" id="1739379">fp</span><span class="op" id="1739381">)</span><span class="op" id="1739382">,</span>&nbsp;<span class="string" id="1739384">&#34;&nbsp;sp=&#34;</span><span class="op" id="1739390">,</span>&nbsp;<span class="ident" id="1739392">hex</span><span class="op" id="1739395">(</span><span class="ident" id="1739396">frame</span><span class="op" id="1739401">.</span><span class="ident" id="1739402">sp</span><span class="op" id="1739404">)</span><span class="op" id="1739405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1739411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1739417">print</span><span class="op" id="1739422">(</span><span class="string" id="1739423">&#34;\n&#34;</span><span class="op" id="1739427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739433">nprint</span><span class="op" id="1739439">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1739445">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1739449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739453">n</span><span class="op" id="1739454">++</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739459">skipped</span><span class="op" id="1739466">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739470">waspanic</span>&nbsp;<span class="op" id="1739479">=</span>&nbsp;<span class="ident" id="1739481">f</span><span class="op" id="1739482">.</span><span class="ident" id="1739483">entry</span>&nbsp;<span class="op" id="1739489">==</span>&nbsp;<span class="ident" id="1739492">sigpanicPC</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739505">wasnewproc</span>&nbsp;<span class="op" id="1739516">=</span>&nbsp;<span class="ident" id="1739518">f</span><span class="op" id="1739519">.</span><span class="ident" id="1739520">entry</span>&nbsp;<span class="op" id="1739526">==</span>&nbsp;<span class="ident" id="1739529">newprocPC</span>&nbsp;<span class="op" id="1739539">||</span>&nbsp;<span class="ident" id="1739542">f</span><span class="op" id="1739543">.</span><span class="ident" id="1739544">entry</span>&nbsp;<span class="op" id="1739550">==</span>&nbsp;<span class="ident" id="1739553">deferprocPC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1739568">//&nbsp;Do&nbsp;not&nbsp;unwind&nbsp;past&nbsp;the&nbsp;bottom&nbsp;of&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1739617">if</span>&nbsp;<span class="ident" id="1739620">flr</span>&nbsp;<span class="op" id="1739624">==</span>&nbsp;<span class="builtintype" id="1739627">nil</span>&nbsp;<span class="op" id="1739631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1739636">break</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1739644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1739649">//&nbsp;Unwind&nbsp;to&nbsp;next&nbsp;frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739676">frame</span><span class="op" id="1739681">.</span><span class="ident" id="1739682">fn</span>&nbsp;<span class="op" id="1739685">=</span>&nbsp;<span class="ident" id="1739687">flr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739693">frame</span><span class="op" id="1739698">.</span><span class="ident" id="1739699">pc</span>&nbsp;<span class="op" id="1739702">=</span>&nbsp;<span class="ident" id="1739704">frame</span><span class="op" id="1739709">.</span><span class="ident" id="1739710">lr</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739715">frame</span><span class="op" id="1739720">.</span><span class="ident" id="1739721">lr</span>&nbsp;<span class="op" id="1739724">=</span>&nbsp;<span class="num" id="1739726">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739730">frame</span><span class="op" id="1739735">.</span><span class="ident" id="1739736">sp</span>&nbsp;<span class="op" id="1739739">=</span>&nbsp;<span class="ident" id="1739741">frame</span><span class="op" id="1739746">.</span><span class="ident" id="1739747">fp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739752">frame</span><span class="op" id="1739757">.</span><span class="ident" id="1739758">fp</span>&nbsp;<span class="op" id="1739761">=</span>&nbsp;<span class="num" id="1739763">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739767">frame</span><span class="op" id="1739772">.</span><span class="ident" id="1739773">argmap</span>&nbsp;<span class="op" id="1739780">=</span>&nbsp;<span class="builtintype" id="1739782">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1739789">//&nbsp;On&nbsp;link&nbsp;register&nbsp;architectures,&nbsp;sighandler&nbsp;saves&nbsp;the&nbsp;LR&nbsp;on&nbsp;stack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1739859">//&nbsp;before&nbsp;faking&nbsp;a&nbsp;call&nbsp;to&nbsp;sigpanic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1739898">if</span>&nbsp;<span class="ident" id="1739901">usesLR</span>&nbsp;<span class="op" id="1739908">&amp;&amp;</span>&nbsp;<span class="ident" id="1739911">waspanic</span>&nbsp;<span class="op" id="1739920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739925">x</span>&nbsp;<span class="op" id="1739927">:=</span>&nbsp;<span class="op" id="1739930">*</span><span class="op" id="1739931">(</span><span class="op" id="1739932">*</span><span class="builtintype" id="1739933">uintptr</span><span class="op" id="1739940">)</span><span class="op" id="1739941">(</span><span class="ident" id="1739942">unsafe</span><span class="op" id="1739948">.</span><span class="ident" id="1739949">Pointer</span><span class="op" id="1739956">(</span><span class="ident" id="1739957">frame</span><span class="op" id="1739962">.</span><span class="ident" id="1739963">sp</span><span class="op" id="1739965">)</span><span class="op" id="1739966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739971">frame</span><span class="op" id="1739976">.</span><span class="ident" id="1739977">sp</span>&nbsp;<span class="op" id="1739980">+=</span>&nbsp;<span class="ident" id="1739983">ptrSize</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1739994">f</span>&nbsp;<span class="op" id="1739996">=</span>&nbsp;<span class="ident" id="1739998">findfunc</span><span class="op" id="1740006">(</span><span class="ident" id="1740007">frame</span><span class="op" id="1740012">.</span><span class="ident" id="1740013">pc</span><span class="op" id="1740015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1740020">frame</span><span class="op" id="1740025">.</span><span class="ident" id="1740026">fn</span>&nbsp;<span class="op" id="1740029">=</span>&nbsp;<span class="ident" id="1740031">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1740036">if</span>&nbsp;<span class="ident" id="1740039">f</span>&nbsp;<span class="op" id="1740041">==</span>&nbsp;<span class="builtintype" id="1740044">nil</span>&nbsp;<span class="op" id="1740048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1740054">frame</span><span class="op" id="1740059">.</span><span class="ident" id="1740060">pc</span>&nbsp;<span class="op" id="1740063">=</span>&nbsp;<span class="ident" id="1740065">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1740070">}</span>&nbsp;<span class="keyword" id="1740072">else</span>&nbsp;<span class="keyword" id="1740077">if</span>&nbsp;<span class="ident" id="1740080">f</span><span class="op" id="1740081">.</span><span class="ident" id="1740082">frame</span>&nbsp;<span class="op" id="1740088">==</span>&nbsp;<span class="num" id="1740091">0</span>&nbsp;<span class="op" id="1740093">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1740099">frame</span><span class="op" id="1740104">.</span><span class="ident" id="1740105">lr</span>&nbsp;<span class="op" id="1740108">=</span>&nbsp;<span class="ident" id="1740110">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1740115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1740119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1740122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1740126">if</span>&nbsp;<span class="ident" id="1740129">pcbuf</span>&nbsp;<span class="op" id="1740135">==</span>&nbsp;<span class="builtintype" id="1740138">nil</span>&nbsp;<span class="op" id="1740142">&amp;&amp;</span>&nbsp;<span class="ident" id="1740145">callback</span>&nbsp;<span class="op" id="1740154">==</span>&nbsp;<span class="builtintype" id="1740157">nil</span>&nbsp;<span class="op" id="1740161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1740165">n</span>&nbsp;<span class="op" id="1740167">=</span>&nbsp;<span class="ident" id="1740169">nprint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1740177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1740181">//&nbsp;If&nbsp;callback&nbsp;!=&nbsp;nil,&nbsp;we&#39;re&nbsp;being&nbsp;called&nbsp;to&nbsp;gather&nbsp;stack&nbsp;information&nbsp;during</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1740259">//&nbsp;garbage&nbsp;collection&nbsp;or&nbsp;stack&nbsp;growth.&nbsp;In&nbsp;that&nbsp;context,&nbsp;require&nbsp;that&nbsp;we&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1740337">//&nbsp;up&nbsp;the&nbsp;entire&nbsp;defer&nbsp;stack.&nbsp;If&nbsp;not,&nbsp;then&nbsp;there&nbsp;is&nbsp;a&nbsp;bug&nbsp;somewhere&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1740414">//&nbsp;garbage&nbsp;collection&nbsp;or&nbsp;stack&nbsp;growth&nbsp;may&nbsp;not&nbsp;have&nbsp;seen&nbsp;the&nbsp;correct&nbsp;picture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1740491">//&nbsp;of&nbsp;the&nbsp;stack.&nbsp;Crash&nbsp;now&nbsp;instead&nbsp;of&nbsp;silently&nbsp;executing&nbsp;the&nbsp;garbage&nbsp;collection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1740572">//&nbsp;or&nbsp;stack&nbsp;copy&nbsp;incorrectly&nbsp;and&nbsp;setting&nbsp;up&nbsp;for&nbsp;a&nbsp;mysterious&nbsp;crash&nbsp;later.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1740647">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1740651">//&nbsp;Note&nbsp;that&nbsp;panic&nbsp;!=&nbsp;nil&nbsp;is&nbsp;okay&nbsp;here:&nbsp;there&nbsp;can&nbsp;be&nbsp;leftover&nbsp;panics,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1740722">//&nbsp;because&nbsp;the&nbsp;defers&nbsp;on&nbsp;the&nbsp;panic&nbsp;stack&nbsp;do&nbsp;not&nbsp;nest&nbsp;in&nbsp;frame&nbsp;order&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1740794">//&nbsp;they&nbsp;do&nbsp;on&nbsp;the&nbsp;defer&nbsp;stack.&nbsp;If&nbsp;you&nbsp;have:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1740839">//</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1740843">//&nbsp;&nbsp;&nbsp;&nbsp;frame&nbsp;1&nbsp;defers&nbsp;d1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1740865">//&nbsp;&nbsp;&nbsp;&nbsp;frame&nbsp;2&nbsp;defers&nbsp;d2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1740887">//&nbsp;&nbsp;&nbsp;&nbsp;frame&nbsp;3&nbsp;defers&nbsp;d3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1740909">//&nbsp;&nbsp;&nbsp;&nbsp;frame&nbsp;4&nbsp;panics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1740928">//&nbsp;&nbsp;&nbsp;&nbsp;frame&nbsp;4&#39;s&nbsp;panic&nbsp;starts&nbsp;running&nbsp;defers</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1740970">//&nbsp;&nbsp;&nbsp;&nbsp;frame&nbsp;5,&nbsp;running&nbsp;d3,&nbsp;defers&nbsp;d4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741005">//&nbsp;&nbsp;&nbsp;&nbsp;frame&nbsp;5&nbsp;panics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741024">//&nbsp;&nbsp;&nbsp;&nbsp;frame&nbsp;5&#39;s&nbsp;panic&nbsp;starts&nbsp;running&nbsp;defers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741066">//&nbsp;&nbsp;&nbsp;&nbsp;frame&nbsp;6,&nbsp;running&nbsp;d4,&nbsp;garbage&nbsp;collects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741108">//&nbsp;&nbsp;&nbsp;&nbsp;frame&nbsp;6,&nbsp;running&nbsp;d2,&nbsp;garbage&nbsp;collects</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741150">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741154">//&nbsp;During&nbsp;the&nbsp;execution&nbsp;of&nbsp;d4,&nbsp;the&nbsp;panic&nbsp;stack&nbsp;is&nbsp;d4&nbsp;-&gt;&nbsp;d3,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741221">//&nbsp;is&nbsp;nested&nbsp;properly,&nbsp;and&nbsp;we&#39;ll&nbsp;treat&nbsp;frame&nbsp;3&nbsp;as&nbsp;resumable,&nbsp;because&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741294">//&nbsp;can&nbsp;find&nbsp;d3.&nbsp;(And&nbsp;in&nbsp;fact&nbsp;frame&nbsp;3&nbsp;is&nbsp;resumable.&nbsp;If&nbsp;d4&nbsp;recovers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741361">//&nbsp;and&nbsp;frame&nbsp;5&nbsp;continues&nbsp;running,&nbsp;d3,&nbsp;d3&nbsp;can&nbsp;recover&nbsp;and&nbsp;we&#39;ll</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741425">//&nbsp;resume&nbsp;execution&nbsp;in&nbsp;(returning&nbsp;from)&nbsp;frame&nbsp;3.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741476">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741480">//&nbsp;During&nbsp;the&nbsp;execution&nbsp;of&nbsp;d2,&nbsp;however,&nbsp;the&nbsp;panic&nbsp;stack&nbsp;is&nbsp;d2&nbsp;-&gt;&nbsp;d3,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741550">//&nbsp;which&nbsp;is&nbsp;inverted.&nbsp;The&nbsp;scan&nbsp;will&nbsp;match&nbsp;d2&nbsp;to&nbsp;frame&nbsp;2&nbsp;but&nbsp;having</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741618">//&nbsp;d2&nbsp;on&nbsp;the&nbsp;stack&nbsp;until&nbsp;then&nbsp;means&nbsp;it&nbsp;will&nbsp;not&nbsp;match&nbsp;d3&nbsp;to&nbsp;frame&nbsp;3.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741688">//&nbsp;This&nbsp;is&nbsp;okay:&nbsp;if&nbsp;we&#39;re&nbsp;running&nbsp;d2,&nbsp;then&nbsp;all&nbsp;the&nbsp;defers&nbsp;after&nbsp;d2&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741761">//&nbsp;completed&nbsp;and&nbsp;their&nbsp;corresponding&nbsp;frames&nbsp;are&nbsp;dead.&nbsp;Not&nbsp;finding&nbsp;d3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741831">//&nbsp;for&nbsp;frame&nbsp;3&nbsp;means&nbsp;we&#39;ll&nbsp;set&nbsp;frame&nbsp;3&#39;s&nbsp;continpc&nbsp;==&nbsp;0,&nbsp;which&nbsp;is&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741905">//&nbsp;(frame&nbsp;3&nbsp;is&nbsp;dead).&nbsp;At&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;walk&nbsp;the&nbsp;panic&nbsp;stack&nbsp;can&nbsp;thus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1741976">//&nbsp;contain&nbsp;defers&nbsp;(d3&nbsp;in&nbsp;this&nbsp;case)&nbsp;for&nbsp;dead&nbsp;frames.&nbsp;The&nbsp;inversion&nbsp;here</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1742049">//&nbsp;always&nbsp;indicates&nbsp;a&nbsp;dead&nbsp;frame,&nbsp;and&nbsp;the&nbsp;effect&nbsp;of&nbsp;the&nbsp;inversion&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1742123">//&nbsp;scan&nbsp;is&nbsp;to&nbsp;hide&nbsp;those&nbsp;dead&nbsp;frames,&nbsp;so&nbsp;the&nbsp;scan&nbsp;is&nbsp;still&nbsp;okay:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1742189">//&nbsp;what&#39;s&nbsp;left&nbsp;on&nbsp;the&nbsp;panic&nbsp;stack&nbsp;are&nbsp;exactly&nbsp;(and&nbsp;only)&nbsp;the&nbsp;dead&nbsp;frames.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1742264">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1742268">//&nbsp;We&nbsp;require&nbsp;callback&nbsp;!=&nbsp;nil&nbsp;here&nbsp;because&nbsp;only&nbsp;when&nbsp;callback&nbsp;!=&nbsp;nil</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1742338">//&nbsp;do&nbsp;we&nbsp;know&nbsp;that&nbsp;gentraceback&nbsp;is&nbsp;being&nbsp;called&nbsp;in&nbsp;a&nbsp;&#34;must&nbsp;be&nbsp;correct&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1742410">//&nbsp;context&nbsp;as&nbsp;opposed&nbsp;to&nbsp;a&nbsp;&#34;best&nbsp;effort&#34;&nbsp;context.&nbsp;The&nbsp;tracebacks&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1742481">//&nbsp;callbacks&nbsp;only&nbsp;happen&nbsp;when&nbsp;everything&nbsp;is&nbsp;stopped&nbsp;nicely.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1742542">//&nbsp;At&nbsp;other&nbsp;times,&nbsp;such&nbsp;as&nbsp;when&nbsp;gathering&nbsp;a&nbsp;stack&nbsp;for&nbsp;a&nbsp;profiling&nbsp;signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1742616">//&nbsp;or&nbsp;when&nbsp;printing&nbsp;a&nbsp;traceback&nbsp;during&nbsp;a&nbsp;crash,&nbsp;everything&nbsp;may&nbsp;not&nbsp;be</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1742687">//&nbsp;stopped&nbsp;nicely,&nbsp;and&nbsp;the&nbsp;stack&nbsp;walk&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;complete.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1742755">//&nbsp;It&#39;s&nbsp;okay&nbsp;in&nbsp;those&nbsp;situations&nbsp;not&nbsp;to&nbsp;use&nbsp;up&nbsp;the&nbsp;entire&nbsp;defer&nbsp;stack:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1742827">//&nbsp;incomplete&nbsp;information&nbsp;then&nbsp;is&nbsp;still&nbsp;better&nbsp;than&nbsp;nothing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742889">if</span>&nbsp;<span class="ident" id="1742892">callback</span>&nbsp;<span class="op" id="1742901">!=</span>&nbsp;<span class="builtintype" id="1742904">nil</span>&nbsp;<span class="op" id="1742908">&amp;&amp;</span>&nbsp;<span class="ident" id="1742911">n</span>&nbsp;<span class="op" id="1742913">&lt;</span>&nbsp;<span class="ident" id="1742915">max</span>&nbsp;<span class="op" id="1742919">&amp;&amp;</span>&nbsp;<span class="ident" id="1742922">_defer</span>&nbsp;<span class="op" id="1742929">!=</span>&nbsp;<span class="builtintype" id="1742932">nil</span>&nbsp;<span class="op" id="1742936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1742940">if</span>&nbsp;<span class="ident" id="1742943">_defer</span>&nbsp;<span class="op" id="1742950">!=</span>&nbsp;<span class="builtintype" id="1742953">nil</span>&nbsp;<span class="op" id="1742957">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1742962">print</span><span class="op" id="1742967">(</span><span class="string" id="1742968">&#34;runtime:&nbsp;g&#34;</span><span class="op" id="1742980">,</span>&nbsp;<span class="ident" id="1742982">gp</span><span class="op" id="1742984">.</span><span class="ident" id="1742985">goid</span><span class="op" id="1742989">,</span>&nbsp;<span class="string" id="1742991">&#34;:&nbsp;leftover&nbsp;defer&nbsp;argp=&#34;</span><span class="op" id="1743015">,</span>&nbsp;<span class="ident" id="1743017">hex</span><span class="op" id="1743020">(</span><span class="ident" id="1743021">_defer</span><span class="op" id="1743027">.</span><span class="ident" id="1743028">argp</span><span class="op" id="1743032">)</span><span class="op" id="1743033">,</span>&nbsp;<span class="string" id="1743035">&#34;&nbsp;pc=&#34;</span><span class="op" id="1743041">,</span>&nbsp;<span class="ident" id="1743043">hex</span><span class="op" id="1743046">(</span><span class="ident" id="1743047">_defer</span><span class="op" id="1743053">.</span><span class="ident" id="1743054">pc</span><span class="op" id="1743056">)</span><span class="op" id="1743057">,</span>&nbsp;<span class="string" id="1743059">&#34;\n&#34;</span><span class="op" id="1743063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1743067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1743071">for</span>&nbsp;<span class="ident" id="1743075">_defer</span>&nbsp;<span class="op" id="1743082">=</span>&nbsp;<span class="ident" id="1743084">gp</span><span class="op" id="1743086">.</span><span class="ident" id="1743087">_defer</span><span class="op" id="1743093">;</span>&nbsp;<span class="ident" id="1743095">_defer</span>&nbsp;<span class="op" id="1743102">!=</span>&nbsp;<span class="builtintype" id="1743105">nil</span><span class="op" id="1743108">;</span>&nbsp;<span class="ident" id="1743110">_defer</span>&nbsp;<span class="op" id="1743117">=</span>&nbsp;<span class="ident" id="1743119">_defer</span><span class="op" id="1743125">.</span><span class="ident" id="1743126">link</span>&nbsp;<span class="op" id="1743131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1743136">print</span><span class="op" id="1743141">(</span><span class="string" id="1743142">&#34;\tdefer&nbsp;&#34;</span><span class="op" id="1743152">,</span>&nbsp;<span class="ident" id="1743154">_defer</span><span class="op" id="1743160">,</span>&nbsp;<span class="string" id="1743162">&#34;&nbsp;argp=&#34;</span><span class="op" id="1743170">,</span>&nbsp;<span class="ident" id="1743172">hex</span><span class="op" id="1743175">(</span><span class="ident" id="1743176">_defer</span><span class="op" id="1743182">.</span><span class="ident" id="1743183">argp</span><span class="op" id="1743187">)</span><span class="op" id="1743188">,</span>&nbsp;<span class="string" id="1743190">&#34;&nbsp;pc=&#34;</span><span class="op" id="1743196">,</span>&nbsp;<span class="ident" id="1743198">hex</span><span class="op" id="1743201">(</span><span class="ident" id="1743202">_defer</span><span class="op" id="1743208">.</span><span class="ident" id="1743209">pc</span><span class="op" id="1743211">)</span><span class="op" id="1743212">,</span>&nbsp;<span class="string" id="1743214">&#34;\n&#34;</span><span class="op" id="1743218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1743222">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1743226">gothrow</span><span class="op" id="1743233">(</span><span class="string" id="1743234">&#34;traceback&nbsp;has&nbsp;leftover&nbsp;defers&#34;</span><span class="op" id="1743265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1743268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1743272">return</span>&nbsp;<span class="ident" id="1743279">n</span><br>
<span class="lineno"></span><span class="op" id="1743281">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="keyword" id="1743284">func</span>&nbsp;<span class="ident" id="1743289">setArgInfo</span><span class="op" id="1743299">(</span><span class="ident" id="1743300">frame</span>&nbsp;<span class="op" id="1743306">*</span><span class="ident" id="1743307">stkframe</span><span class="op" id="1743315">,</span>&nbsp;<span class="ident" id="1743317">f</span>&nbsp;<span class="op" id="1743319">*</span><span class="ident" id="1743320">_func</span><span class="op" id="1743325">,</span>&nbsp;<span class="ident" id="1743327">needArgMap</span>&nbsp;<span class="builtintype" id="1743338">bool</span><span class="op" id="1743342">)</span>&nbsp;<span class="op" id="1743344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1743347">frame</span><span class="op" id="1743352">.</span><span class="ident" id="1743353">arglen</span>&nbsp;<span class="op" id="1743360">=</span>&nbsp;<span class="builtintype" id="1743362">uintptr</span><span class="op" id="1743369">(</span><span class="ident" id="1743370">f</span><span class="op" id="1743371">.</span><span class="ident" id="1743372">args</span><span class="op" id="1743376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1743379">if</span>&nbsp;<span class="ident" id="1743382">needArgMap</span>&nbsp;<span class="op" id="1743393">&amp;&amp;</span>&nbsp;<span class="ident" id="1743396">f</span><span class="op" id="1743397">.</span><span class="ident" id="1743398">args</span>&nbsp;<span class="op" id="1743403">==</span>&nbsp;<span class="ident" id="1743406">_ArgsSizeUnknown</span>&nbsp;<span class="op" id="1743423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1743427">//&nbsp;Extract&nbsp;argument&nbsp;bitmaps&nbsp;for&nbsp;reflect&nbsp;stubs&nbsp;from&nbsp;the&nbsp;calls&nbsp;they&nbsp;made&nbsp;to&nbsp;reflect.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1743512">switch</span>&nbsp;<span class="ident" id="1743519">gofuncname</span><span class="op" id="1743529">(</span><span class="ident" id="1743530">f</span><span class="op" id="1743531">)</span>&nbsp;<span class="op" id="1743533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1743537">case</span>&nbsp;<span class="string" id="1743542">&#34;reflect.makeFuncStub&#34;</span><span class="op" id="1743564">,</span>&nbsp;<span class="string" id="1743566">&#34;reflect.methodValueCall&#34;</span><span class="op" id="1743591">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1743596">arg0</span>&nbsp;<span class="op" id="1743601">:=</span>&nbsp;<span class="ident" id="1743604">frame</span><span class="op" id="1743609">.</span><span class="ident" id="1743610">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1743616">if</span>&nbsp;<span class="ident" id="1743619">usesLR</span>&nbsp;<span class="op" id="1743626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1743632">arg0</span>&nbsp;<span class="op" id="1743637">+=</span>&nbsp;<span class="ident" id="1743640">ptrSize</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1743651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1743656">fn</span>&nbsp;<span class="op" id="1743659">:=</span>&nbsp;<span class="op" id="1743662">*</span><span class="op" id="1743663">(</span><span class="op" id="1743664">*</span><span class="op" id="1743665">*</span><span class="op" id="1743666">[</span><span class="num" id="1743667">2</span><span class="op" id="1743668">]</span><span class="builtintype" id="1743669">uintptr</span><span class="op" id="1743676">)</span><span class="op" id="1743677">(</span><span class="ident" id="1743678">unsafe</span><span class="op" id="1743684">.</span><span class="ident" id="1743685">Pointer</span><span class="op" id="1743692">(</span><span class="ident" id="1743693">arg0</span><span class="op" id="1743697">)</span><span class="op" id="1743698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1743703">if</span>&nbsp;<span class="ident" id="1743706">fn</span><span class="op" id="1743708">[</span><span class="num" id="1743709">0</span><span class="op" id="1743710">]</span>&nbsp;<span class="op" id="1743712">!=</span>&nbsp;<span class="ident" id="1743715">f</span><span class="op" id="1743716">.</span><span class="ident" id="1743717">entry</span>&nbsp;<span class="op" id="1743723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1743729">print</span><span class="op" id="1743734">(</span><span class="string" id="1743735">&#34;runtime:&nbsp;confused&nbsp;by&nbsp;&#34;</span><span class="op" id="1743758">,</span>&nbsp;<span class="ident" id="1743760">gofuncname</span><span class="op" id="1743770">(</span><span class="ident" id="1743771">f</span><span class="op" id="1743772">)</span><span class="op" id="1743773">,</span>&nbsp;<span class="string" id="1743775">&#34;\n&#34;</span><span class="op" id="1743779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1743785">gothrow</span><span class="op" id="1743792">(</span><span class="string" id="1743793">&#34;reflect&nbsp;mismatch&#34;</span><span class="op" id="1743811">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1743816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1743821">bv</span>&nbsp;<span class="op" id="1743824">:=</span>&nbsp;<span class="op" id="1743827">(</span><span class="op" id="1743828">*</span><span class="ident" id="1743829">bitvector</span><span class="op" id="1743838">)</span><span class="op" id="1743839">(</span><span class="ident" id="1743840">unsafe</span><span class="op" id="1743846">.</span><span class="ident" id="1743847">Pointer</span><span class="op" id="1743854">(</span><span class="ident" id="1743855">fn</span><span class="op" id="1743857">[</span><span class="num" id="1743858">1</span><span class="op" id="1743859">]</span><span class="op" id="1743860">)</span><span class="op" id="1743861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1743866">frame</span><span class="op" id="1743871">.</span><span class="ident" id="1743872">arglen</span>&nbsp;<span class="op" id="1743879">=</span>&nbsp;<span class="builtintype" id="1743881">uintptr</span><span class="op" id="1743888">(</span><span class="ident" id="1743889">bv</span><span class="op" id="1743891">.</span><span class="ident" id="1743892">n</span>&nbsp;<span class="op" id="1743894">/</span>&nbsp;<span class="num" id="1743896">2</span>&nbsp;<span class="op" id="1743898">*</span>&nbsp;<span class="ident" id="1743900">ptrSize</span><span class="op" id="1743907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1743912">frame</span><span class="op" id="1743917">.</span><span class="ident" id="1743918">argmap</span>&nbsp;<span class="op" id="1743925">=</span>&nbsp;<span class="ident" id="1743927">bv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1743932">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1743935">}</span><br>
<span class="lineno"></span><span class="op" id="1743937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1743940">func</span>&nbsp;<span class="ident" id="1743945">printcreatedby</span><span class="op" id="1743959">(</span><span class="ident" id="1743960">gp</span>&nbsp;<span class="op" id="1743963">*</span><span class="ident" id="1743964">g</span><span class="op" id="1743965">)</span>&nbsp;<span class="op" id="1743967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1743970">//&nbsp;Show&nbsp;what&nbsp;created&nbsp;goroutine,&nbsp;except&nbsp;main&nbsp;goroutine&nbsp;(goid&nbsp;1).</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1744035">pc</span>&nbsp;<span class="op" id="1744038">:=</span>&nbsp;<span class="ident" id="1744041">gp</span><span class="op" id="1744043">.</span><span class="ident" id="1744044">gopc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1744050">f</span>&nbsp;<span class="op" id="1744052">:=</span>&nbsp;<span class="ident" id="1744055">findfunc</span><span class="op" id="1744063">(</span><span class="ident" id="1744064">pc</span><span class="op" id="1744066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1744069">if</span>&nbsp;<span class="ident" id="1744072">f</span>&nbsp;<span class="op" id="1744074">!=</span>&nbsp;<span class="builtintype" id="1744077">nil</span>&nbsp;<span class="op" id="1744081">&amp;&amp;</span>&nbsp;<span class="ident" id="1744084">showframe</span><span class="op" id="1744093">(</span><span class="ident" id="1744094">f</span><span class="op" id="1744095">,</span>&nbsp;<span class="ident" id="1744097">gp</span><span class="op" id="1744099">)</span>&nbsp;<span class="op" id="1744101">&amp;&amp;</span>&nbsp;<span class="ident" id="1744104">gp</span><span class="op" id="1744106">.</span><span class="ident" id="1744107">goid</span>&nbsp;<span class="op" id="1744112">!=</span>&nbsp;<span class="num" id="1744115">1</span>&nbsp;<span class="op" id="1744117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1744121">print</span><span class="op" id="1744126">(</span><span class="string" id="1744127">&#34;created&nbsp;by&nbsp;&#34;</span><span class="op" id="1744140">,</span>&nbsp;<span class="ident" id="1744142">gofuncname</span><span class="op" id="1744152">(</span><span class="ident" id="1744153">f</span><span class="op" id="1744154">)</span><span class="op" id="1744155">,</span>&nbsp;<span class="string" id="1744157">&#34;\n&#34;</span><span class="op" id="1744161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1744165">tracepc</span>&nbsp;<span class="op" id="1744173">:=</span>&nbsp;<span class="ident" id="1744176">pc</span>&nbsp;<span class="comment" id="1744179">//&nbsp;back&nbsp;up&nbsp;to&nbsp;CALL&nbsp;instruction&nbsp;for&nbsp;funcline.</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1744226">if</span>&nbsp;<span class="ident" id="1744229">pc</span>&nbsp;<span class="op" id="1744232">&gt;</span>&nbsp;<span class="ident" id="1744234">f</span><span class="op" id="1744235">.</span><span class="ident" id="1744236">entry</span>&nbsp;<span class="op" id="1744242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1744247">tracepc</span>&nbsp;<span class="op" id="1744255">-=</span>&nbsp;<span class="ident" id="1744258">_PCQuantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1744271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1744275">var</span>&nbsp;<span class="ident" id="1744279">file</span>&nbsp;<span class="builtintype" id="1744284">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1744293">line</span>&nbsp;<span class="op" id="1744298">:=</span>&nbsp;<span class="ident" id="1744301">funcline</span><span class="op" id="1744309">(</span><span class="ident" id="1744310">f</span><span class="op" id="1744311">,</span>&nbsp;<span class="ident" id="1744313">tracepc</span><span class="op" id="1744320">,</span>&nbsp;<span class="op" id="1744322">&amp;</span><span class="ident" id="1744323">file</span><span class="op" id="1744327">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1744331">print</span><span class="op" id="1744336">(</span><span class="string" id="1744337">&#34;\t&#34;</span><span class="op" id="1744341">,</span>&nbsp;<span class="ident" id="1744343">file</span><span class="op" id="1744347">,</span>&nbsp;<span class="string" id="1744349">&#34;:&#34;</span><span class="op" id="1744352">,</span>&nbsp;<span class="ident" id="1744354">line</span><span class="op" id="1744358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1744362">if</span>&nbsp;<span class="ident" id="1744365">pc</span>&nbsp;<span class="op" id="1744368">&gt;</span>&nbsp;<span class="ident" id="1744370">f</span><span class="op" id="1744371">.</span><span class="ident" id="1744372">entry</span>&nbsp;<span class="op" id="1744378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1744383">print</span><span class="op" id="1744388">(</span><span class="string" id="1744389">&#34;&nbsp;+&#34;</span><span class="op" id="1744393">,</span>&nbsp;<span class="ident" id="1744395">hex</span><span class="op" id="1744398">(</span><span class="ident" id="1744399">pc</span><span class="op" id="1744401">-</span><span class="ident" id="1744402">f</span><span class="op" id="1744403">.</span><span class="ident" id="1744404">entry</span><span class="op" id="1744409">)</span><span class="op" id="1744410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1744414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1744418">print</span><span class="op" id="1744423">(</span><span class="string" id="1744424">&#34;\n&#34;</span><span class="op" id="1744428">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1744431">}</span><br>
<span class="lineno"></span><span class="op" id="1744433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1744436">func</span>&nbsp;<span class="ident" id="1744441">traceback</span><span class="op" id="1744450">(</span><span class="ident" id="1744451">pc</span>&nbsp;<span class="builtintype" id="1744454">uintptr</span><span class="op" id="1744461">,</span>&nbsp;<span class="ident" id="1744463">sp</span>&nbsp;<span class="builtintype" id="1744466">uintptr</span><span class="op" id="1744473">,</span>&nbsp;<span class="ident" id="1744475">lr</span>&nbsp;<span class="builtintype" id="1744478">uintptr</span><span class="op" id="1744485">,</span>&nbsp;<span class="ident" id="1744487">gp</span>&nbsp;<span class="op" id="1744490">*</span><span class="ident" id="1744491">g</span><span class="op" id="1744492">)</span>&nbsp;<span class="op" id="1744494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1744497">traceback1</span><span class="op" id="1744507">(</span><span class="ident" id="1744508">pc</span><span class="op" id="1744510">,</span>&nbsp;<span class="ident" id="1744512">sp</span><span class="op" id="1744514">,</span>&nbsp;<span class="ident" id="1744516">lr</span><span class="op" id="1744518">,</span>&nbsp;<span class="ident" id="1744520">gp</span><span class="op" id="1744522">,</span>&nbsp;<span class="num" id="1744524">0</span><span class="op" id="1744525">)</span><br>
<span class="lineno">495</span><span class="op" id="1744527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1744530">//&nbsp;tracebacktrap&nbsp;is&nbsp;like&nbsp;traceback&nbsp;but&nbsp;expects&nbsp;that&nbsp;the&nbsp;PC&nbsp;and&nbsp;SP&nbsp;were&nbsp;obtained</span><br>
<span class="lineno"></span><span class="comment" id="1744610">//&nbsp;from&nbsp;a&nbsp;trap,&nbsp;not&nbsp;from&nbsp;gp-&gt;sched&nbsp;or&nbsp;gp-&gt;syscallpc/gp-&gt;syscallsp&nbsp;or&nbsp;getcallerpc/getcallersp.</span><br>
<span class="lineno"></span><span class="comment" id="1744704">//&nbsp;Because&nbsp;they&nbsp;are&nbsp;from&nbsp;a&nbsp;trap&nbsp;instead&nbsp;of&nbsp;from&nbsp;a&nbsp;saved&nbsp;pair,</span><br>
<span class="lineno">500</span><span class="comment" id="1744766">//&nbsp;the&nbsp;initial&nbsp;PC&nbsp;must&nbsp;not&nbsp;be&nbsp;rewound&nbsp;to&nbsp;the&nbsp;previous&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="1744833">//&nbsp;(All&nbsp;the&nbsp;saved&nbsp;pairs&nbsp;record&nbsp;a&nbsp;PC&nbsp;that&nbsp;is&nbsp;a&nbsp;return&nbsp;address,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="1744901">//&nbsp;rewind&nbsp;it&nbsp;into&nbsp;the&nbsp;CALL&nbsp;instruction.)</span><br>
<span class="lineno"></span><span class="keyword" id="1744942">func</span>&nbsp;<span class="ident" id="1744947">tracebacktrap</span><span class="op" id="1744960">(</span><span class="ident" id="1744961">pc</span>&nbsp;<span class="builtintype" id="1744964">uintptr</span><span class="op" id="1744971">,</span>&nbsp;<span class="ident" id="1744973">sp</span>&nbsp;<span class="builtintype" id="1744976">uintptr</span><span class="op" id="1744983">,</span>&nbsp;<span class="ident" id="1744985">lr</span>&nbsp;<span class="builtintype" id="1744988">uintptr</span><span class="op" id="1744995">,</span>&nbsp;<span class="ident" id="1744997">gp</span>&nbsp;<span class="op" id="1745000">*</span><span class="ident" id="1745001">g</span><span class="op" id="1745002">)</span>&nbsp;<span class="op" id="1745004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1745007">traceback1</span><span class="op" id="1745017">(</span><span class="ident" id="1745018">pc</span><span class="op" id="1745020">,</span>&nbsp;<span class="ident" id="1745022">sp</span><span class="op" id="1745024">,</span>&nbsp;<span class="ident" id="1745026">lr</span><span class="op" id="1745028">,</span>&nbsp;<span class="ident" id="1745030">gp</span><span class="op" id="1745032">,</span>&nbsp;<span class="ident" id="1745034">_TraceTrap</span><span class="op" id="1745044">)</span><br>
<span class="lineno">505</span><span class="op" id="1745046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1745049">func</span>&nbsp;<span class="ident" id="1745054">traceback1</span><span class="op" id="1745064">(</span><span class="ident" id="1745065">pc</span>&nbsp;<span class="builtintype" id="1745068">uintptr</span><span class="op" id="1745075">,</span>&nbsp;<span class="ident" id="1745077">sp</span>&nbsp;<span class="builtintype" id="1745080">uintptr</span><span class="op" id="1745087">,</span>&nbsp;<span class="ident" id="1745089">lr</span>&nbsp;<span class="builtintype" id="1745092">uintptr</span><span class="op" id="1745099">,</span>&nbsp;<span class="ident" id="1745101">gp</span>&nbsp;<span class="op" id="1745104">*</span><span class="ident" id="1745105">g</span><span class="op" id="1745106">,</span>&nbsp;<span class="ident" id="1745108">flags</span>&nbsp;<span class="builtintype" id="1745114">uint</span><span class="op" id="1745118">)</span>&nbsp;<span class="op" id="1745120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745123">var</span>&nbsp;<span class="ident" id="1745127">n</span>&nbsp;<span class="builtintype" id="1745129">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745134">if</span>&nbsp;<span class="ident" id="1745137">readgstatus</span><span class="op" id="1745148">(</span><span class="ident" id="1745149">gp</span><span class="op" id="1745151">)</span><span class="op" id="1745152">&amp;^</span><span class="ident" id="1745154">_Gscan</span>&nbsp;<span class="op" id="1745161">==</span>&nbsp;<span class="ident" id="1745164">_Gsyscall</span>&nbsp;<span class="op" id="1745174">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1745178">//&nbsp;Override&nbsp;registers&nbsp;if&nbsp;blocked&nbsp;in&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1745229">pc</span>&nbsp;<span class="op" id="1745232">=</span>&nbsp;<span class="ident" id="1745234">gp</span><span class="op" id="1745236">.</span><span class="ident" id="1745237">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1745249">sp</span>&nbsp;<span class="op" id="1745252">=</span>&nbsp;<span class="ident" id="1745254">gp</span><span class="op" id="1745256">.</span><span class="ident" id="1745257">syscallsp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1745269">flags</span>&nbsp;<span class="op" id="1745275">&amp;^=</span>&nbsp;<span class="ident" id="1745279">_TraceTrap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1745291">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1745294">//&nbsp;Print&nbsp;traceback.&nbsp;By&nbsp;default,&nbsp;omits&nbsp;runtime&nbsp;frames.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1745349">//&nbsp;If&nbsp;that&nbsp;means&nbsp;we&nbsp;print&nbsp;nothing&nbsp;at&nbsp;all,&nbsp;repeat&nbsp;forcing&nbsp;all&nbsp;frames&nbsp;printed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1745427">n</span>&nbsp;<span class="op" id="1745429">=</span>&nbsp;<span class="ident" id="1745431">gentraceback</span><span class="op" id="1745443">(</span><span class="ident" id="1745444">pc</span><span class="op" id="1745446">,</span>&nbsp;<span class="ident" id="1745448">sp</span><span class="op" id="1745450">,</span>&nbsp;<span class="ident" id="1745452">lr</span><span class="op" id="1745454">,</span>&nbsp;<span class="ident" id="1745456">gp</span><span class="op" id="1745458">,</span>&nbsp;<span class="num" id="1745460">0</span><span class="op" id="1745461">,</span>&nbsp;<span class="builtintype" id="1745463">nil</span><span class="op" id="1745466">,</span>&nbsp;<span class="ident" id="1745468">_TracebackMaxFrames</span><span class="op" id="1745487">,</span>&nbsp;<span class="builtintype" id="1745489">nil</span><span class="op" id="1745492">,</span>&nbsp;<span class="builtintype" id="1745494">nil</span><span class="op" id="1745497">,</span>&nbsp;<span class="ident" id="1745499">flags</span><span class="op" id="1745504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745507">if</span>&nbsp;<span class="ident" id="1745510">n</span>&nbsp;<span class="op" id="1745512">==</span>&nbsp;<span class="num" id="1745515">0</span>&nbsp;<span class="op" id="1745517">&amp;&amp;</span>&nbsp;<span class="op" id="1745520">(</span><span class="ident" id="1745521">flags</span><span class="op" id="1745526">&amp;</span><span class="ident" id="1745527">_TraceRuntimeFrames</span><span class="op" id="1745546">)</span>&nbsp;<span class="op" id="1745548">==</span>&nbsp;<span class="num" id="1745551">0</span>&nbsp;<span class="op" id="1745553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1745557">n</span>&nbsp;<span class="op" id="1745559">=</span>&nbsp;<span class="ident" id="1745561">gentraceback</span><span class="op" id="1745573">(</span><span class="ident" id="1745574">pc</span><span class="op" id="1745576">,</span>&nbsp;<span class="ident" id="1745578">sp</span><span class="op" id="1745580">,</span>&nbsp;<span class="ident" id="1745582">lr</span><span class="op" id="1745584">,</span>&nbsp;<span class="ident" id="1745586">gp</span><span class="op" id="1745588">,</span>&nbsp;<span class="num" id="1745590">0</span><span class="op" id="1745591">,</span>&nbsp;<span class="builtintype" id="1745593">nil</span><span class="op" id="1745596">,</span>&nbsp;<span class="ident" id="1745598">_TracebackMaxFrames</span><span class="op" id="1745617">,</span>&nbsp;<span class="builtintype" id="1745619">nil</span><span class="op" id="1745622">,</span>&nbsp;<span class="builtintype" id="1745624">nil</span><span class="op" id="1745627">,</span>&nbsp;<span class="ident" id="1745629">flags</span><span class="op" id="1745634">|</span><span class="ident" id="1745635">_TraceRuntimeFrames</span><span class="op" id="1745654">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1745657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745660">if</span>&nbsp;<span class="ident" id="1745663">n</span>&nbsp;<span class="op" id="1745665">==</span>&nbsp;<span class="ident" id="1745668">_TracebackMaxFrames</span>&nbsp;<span class="op" id="1745688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1745692">print</span><span class="op" id="1745697">(</span><span class="string" id="1745698">&#34;...additional&nbsp;frames&nbsp;elided...\n&#34;</span><span class="op" id="1745732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1745735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1745738">printcreatedby</span><span class="op" id="1745752">(</span><span class="ident" id="1745753">gp</span><span class="op" id="1745755">)</span><br>
<span class="lineno">525</span><span class="op" id="1745757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1745760">func</span>&nbsp;<span class="ident" id="1745765">callers</span><span class="op" id="1745772">(</span><span class="ident" id="1745773">skip</span>&nbsp;<span class="builtintype" id="1745778">int</span><span class="op" id="1745781">,</span>&nbsp;<span class="ident" id="1745783">pcbuf</span>&nbsp;<span class="op" id="1745789">*</span><span class="builtintype" id="1745790">uintptr</span><span class="op" id="1745797">,</span>&nbsp;<span class="ident" id="1745799">m</span>&nbsp;<span class="builtintype" id="1745801">int</span><span class="op" id="1745804">)</span>&nbsp;<span class="builtintype" id="1745806">int</span>&nbsp;<span class="op" id="1745810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1745813">sp</span>&nbsp;<span class="op" id="1745816">:=</span>&nbsp;<span class="ident" id="1745819">getcallersp</span><span class="op" id="1745830">(</span><span class="ident" id="1745831">unsafe</span><span class="op" id="1745837">.</span><span class="ident" id="1745838">Pointer</span><span class="op" id="1745845">(</span><span class="op" id="1745846">&amp;</span><span class="ident" id="1745847">skip</span><span class="op" id="1745851">)</span><span class="op" id="1745852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1745855">pc</span>&nbsp;<span class="op" id="1745858">:=</span>&nbsp;<span class="builtintype" id="1745861">uintptr</span><span class="op" id="1745868">(</span><span class="ident" id="1745869">getcallerpc</span><span class="op" id="1745880">(</span><span class="ident" id="1745881">unsafe</span><span class="op" id="1745887">.</span><span class="ident" id="1745888">Pointer</span><span class="op" id="1745895">(</span><span class="op" id="1745896">&amp;</span><span class="ident" id="1745897">skip</span><span class="op" id="1745901">)</span><span class="op" id="1745902">)</span><span class="op" id="1745903">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1745906">var</span>&nbsp;<span class="ident" id="1745910">n</span>&nbsp;<span class="builtintype" id="1745912">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1745917">onM</span><span class="op" id="1745920">(</span><span class="keyword" id="1745921">func</span><span class="op" id="1745925">(</span><span class="op" id="1745926">)</span>&nbsp;<span class="op" id="1745928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1745932">n</span>&nbsp;<span class="op" id="1745934">=</span>&nbsp;<span class="ident" id="1745936">gentraceback</span><span class="op" id="1745948">(</span><span class="ident" id="1745949">pc</span><span class="op" id="1745951">,</span>&nbsp;<span class="ident" id="1745953">sp</span><span class="op" id="1745955">,</span>&nbsp;<span class="num" id="1745957">0</span><span class="op" id="1745958">,</span>&nbsp;<span class="ident" id="1745960">getg</span><span class="op" id="1745964">(</span><span class="op" id="1745965">)</span><span class="op" id="1745966">,</span>&nbsp;<span class="ident" id="1745968">skip</span><span class="op" id="1745972">,</span>&nbsp;<span class="ident" id="1745974">pcbuf</span><span class="op" id="1745979">,</span>&nbsp;<span class="ident" id="1745981">m</span><span class="op" id="1745982">,</span>&nbsp;<span class="builtintype" id="1745984">nil</span><span class="op" id="1745987">,</span>&nbsp;<span class="builtintype" id="1745989">nil</span><span class="op" id="1745992">,</span>&nbsp;<span class="num" id="1745994">0</span><span class="op" id="1745995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1745998">}</span><span class="op" id="1745999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1746002">return</span>&nbsp;<span class="ident" id="1746009">n</span><br>
<span class="lineno">535</span><span class="op" id="1746011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1746014">func</span>&nbsp;<span class="ident" id="1746019">gcallers</span><span class="op" id="1746027">(</span><span class="ident" id="1746028">gp</span>&nbsp;<span class="op" id="1746031">*</span><span class="ident" id="1746032">g</span><span class="op" id="1746033">,</span>&nbsp;<span class="ident" id="1746035">skip</span>&nbsp;<span class="builtintype" id="1746040">int</span><span class="op" id="1746043">,</span>&nbsp;<span class="ident" id="1746045">pcbuf</span>&nbsp;<span class="op" id="1746051">*</span><span class="builtintype" id="1746052">uintptr</span><span class="op" id="1746059">,</span>&nbsp;<span class="ident" id="1746061">m</span>&nbsp;<span class="builtintype" id="1746063">int</span><span class="op" id="1746066">)</span>&nbsp;<span class="builtintype" id="1746068">int</span>&nbsp;<span class="op" id="1746072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1746075">return</span>&nbsp;<span class="ident" id="1746082">gentraceback</span><span class="op" id="1746094">(</span><span class="op" id="1746095">^</span><span class="builtintype" id="1746096">uintptr</span><span class="op" id="1746103">(</span><span class="num" id="1746104">0</span><span class="op" id="1746105">)</span><span class="op" id="1746106">,</span>&nbsp;<span class="op" id="1746108">^</span><span class="builtintype" id="1746109">uintptr</span><span class="op" id="1746116">(</span><span class="num" id="1746117">0</span><span class="op" id="1746118">)</span><span class="op" id="1746119">,</span>&nbsp;<span class="num" id="1746121">0</span><span class="op" id="1746122">,</span>&nbsp;<span class="ident" id="1746124">gp</span><span class="op" id="1746126">,</span>&nbsp;<span class="ident" id="1746128">skip</span><span class="op" id="1746132">,</span>&nbsp;<span class="ident" id="1746134">pcbuf</span><span class="op" id="1746139">,</span>&nbsp;<span class="ident" id="1746141">m</span><span class="op" id="1746142">,</span>&nbsp;<span class="builtintype" id="1746144">nil</span><span class="op" id="1746147">,</span>&nbsp;<span class="builtintype" id="1746149">nil</span><span class="op" id="1746152">,</span>&nbsp;<span class="num" id="1746154">0</span><span class="op" id="1746155">)</span><br>
<span class="lineno"></span><span class="op" id="1746157">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span><span class="keyword" id="1746160">func</span>&nbsp;<span class="ident" id="1746165">showframe</span><span class="op" id="1746174">(</span><span class="ident" id="1746175">f</span>&nbsp;<span class="op" id="1746177">*</span><span class="ident" id="1746178">_func</span><span class="op" id="1746183">,</span>&nbsp;<span class="ident" id="1746185">gp</span>&nbsp;<span class="op" id="1746188">*</span><span class="ident" id="1746189">g</span><span class="op" id="1746190">)</span>&nbsp;<span class="builtintype" id="1746192">bool</span>&nbsp;<span class="op" id="1746197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1746200">g</span>&nbsp;<span class="op" id="1746202">:=</span>&nbsp;<span class="ident" id="1746205">getg</span><span class="op" id="1746209">(</span><span class="op" id="1746210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1746213">if</span>&nbsp;<span class="ident" id="1746216">g</span><span class="op" id="1746217">.</span><span class="ident" id="1746218">m</span><span class="op" id="1746219">.</span><span class="ident" id="1746220">throwing</span>&nbsp;<span class="op" id="1746229">&gt;</span>&nbsp;<span class="num" id="1746231">0</span>&nbsp;<span class="op" id="1746233">&amp;&amp;</span>&nbsp;<span class="ident" id="1746236">gp</span>&nbsp;<span class="op" id="1746239">!=</span>&nbsp;<span class="builtintype" id="1746242">nil</span>&nbsp;<span class="op" id="1746246">&amp;&amp;</span>&nbsp;<span class="op" id="1746249">(</span><span class="ident" id="1746250">gp</span>&nbsp;<span class="op" id="1746253">==</span>&nbsp;<span class="ident" id="1746256">g</span><span class="op" id="1746257">.</span><span class="ident" id="1746258">m</span><span class="op" id="1746259">.</span><span class="ident" id="1746260">curg</span>&nbsp;<span class="op" id="1746265">||</span>&nbsp;<span class="ident" id="1746268">gp</span>&nbsp;<span class="op" id="1746271">==</span>&nbsp;<span class="ident" id="1746274">g</span><span class="op" id="1746275">.</span><span class="ident" id="1746276">m</span><span class="op" id="1746277">.</span><span class="ident" id="1746278">caughtsig</span><span class="op" id="1746287">)</span>&nbsp;<span class="op" id="1746289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1746293">return</span>&nbsp;<span class="builtintype" id="1746300">true</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1746306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1746309">traceback</span>&nbsp;<span class="op" id="1746319">:=</span>&nbsp;<span class="ident" id="1746322">gotraceback</span><span class="op" id="1746333">(</span><span class="builtintype" id="1746334">nil</span><span class="op" id="1746337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1746340">name</span>&nbsp;<span class="op" id="1746345">:=</span>&nbsp;<span class="ident" id="1746348">gostringnocopy</span><span class="op" id="1746362">(</span><span class="ident" id="1746363">funcname</span><span class="op" id="1746371">(</span><span class="ident" id="1746372">f</span><span class="op" id="1746373">)</span><span class="op" id="1746374">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1746378">//&nbsp;Special&nbsp;case:&nbsp;always&nbsp;show&nbsp;runtime.panic&nbsp;frame,&nbsp;so&nbsp;that&nbsp;we&nbsp;can</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1746444">//&nbsp;see&nbsp;where&nbsp;a&nbsp;panic&nbsp;started&nbsp;in&nbsp;the&nbsp;middle&nbsp;of&nbsp;a&nbsp;stack&nbsp;trace.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1746506">//&nbsp;See&nbsp;golang.org/issue/5832.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1746537">if</span>&nbsp;<span class="ident" id="1746540">name</span>&nbsp;<span class="op" id="1746545">==</span>&nbsp;<span class="string" id="1746548">&#34;runtime.panic&#34;</span>&nbsp;<span class="op" id="1746564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1746568">return</span>&nbsp;<span class="builtintype" id="1746575">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1746581">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1746585">return</span>&nbsp;<span class="ident" id="1746592">traceback</span>&nbsp;<span class="op" id="1746602">&gt;</span>&nbsp;<span class="num" id="1746604">1</span>&nbsp;<span class="op" id="1746606">||</span>&nbsp;<span class="ident" id="1746609">f</span>&nbsp;<span class="op" id="1746611">!=</span>&nbsp;<span class="builtintype" id="1746614">nil</span>&nbsp;<span class="op" id="1746618">&amp;&amp;</span>&nbsp;<span class="ident" id="1746621">contains</span><span class="op" id="1746629">(</span><span class="ident" id="1746630">name</span><span class="op" id="1746634">,</span>&nbsp;<span class="string" id="1746636">&#34;.&#34;</span><span class="op" id="1746639">)</span>&nbsp;<span class="op" id="1746641">&amp;&amp;</span>&nbsp;<span class="op" id="1746644">(</span><span class="op" id="1746645">!</span><span class="ident" id="1746646">hasprefix</span><span class="op" id="1746655">(</span><span class="ident" id="1746656">name</span><span class="op" id="1746660">,</span>&nbsp;<span class="string" id="1746662">&#34;runtime.&#34;</span><span class="op" id="1746672">)</span>&nbsp;<span class="op" id="1746674">||</span>&nbsp;<span class="ident" id="1746677">isExportedRuntime</span><span class="op" id="1746694">(</span><span class="ident" id="1746695">name</span><span class="op" id="1746699">)</span><span class="op" id="1746700">)</span><br>
<span class="lineno"></span><span class="op" id="1746702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1746705">//&nbsp;isExportedRuntime&nbsp;reports&nbsp;whether&nbsp;name&nbsp;is&nbsp;an&nbsp;exported&nbsp;runtime&nbsp;function.</span><br>
<span class="lineno">560</span><span class="comment" id="1746780">//&nbsp;It&nbsp;is&nbsp;only&nbsp;for&nbsp;runtime&nbsp;functions,&nbsp;so&nbsp;ASCII&nbsp;A-Z&nbsp;is&nbsp;fine.</span><br>
<span class="lineno"></span><span class="keyword" id="1746839">func</span>&nbsp;<span class="ident" id="1746844">isExportedRuntime</span><span class="op" id="1746861">(</span><span class="ident" id="1746862">name</span>&nbsp;<span class="builtintype" id="1746867">string</span><span class="op" id="1746873">)</span>&nbsp;<span class="builtintype" id="1746875">bool</span>&nbsp;<span class="op" id="1746880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1746883">const</span>&nbsp;<span class="ident" id="1746889">n</span>&nbsp;<span class="op" id="1746891">=</span>&nbsp;<span class="builtinfunc" id="1746893">len</span><span class="op" id="1746896">(</span><span class="string" id="1746897">&#34;runtime.&#34;</span><span class="op" id="1746907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1746910">return</span>&nbsp;<span class="builtinfunc" id="1746917">len</span><span class="op" id="1746920">(</span><span class="ident" id="1746921">name</span><span class="op" id="1746925">)</span>&nbsp;<span class="op" id="1746927">&gt;</span>&nbsp;<span class="ident" id="1746929">n</span>&nbsp;<span class="op" id="1746931">&amp;&amp;</span>&nbsp;<span class="ident" id="1746934">name</span><span class="op" id="1746938">[</span><span class="op" id="1746939">:</span><span class="ident" id="1746940">n</span><span class="op" id="1746941">]</span>&nbsp;<span class="op" id="1746943">==</span>&nbsp;<span class="string" id="1746946">&#34;runtime.&#34;</span>&nbsp;<span class="op" id="1746957">&amp;&amp;</span>&nbsp;<span class="string" id="1746960">&#39;A&#39;</span>&nbsp;<span class="op" id="1746964">&lt;=</span>&nbsp;<span class="ident" id="1746967">name</span><span class="op" id="1746971">[</span><span class="ident" id="1746972">n</span><span class="op" id="1746973">]</span>&nbsp;<span class="op" id="1746975">&amp;&amp;</span>&nbsp;<span class="ident" id="1746978">name</span><span class="op" id="1746982">[</span><span class="ident" id="1746983">n</span><span class="op" id="1746984">]</span>&nbsp;<span class="op" id="1746986">&lt;=</span>&nbsp;<span class="string" id="1746989">&#39;Z&#39;</span><br>
<span class="lineno"></span><span class="op" id="1746993">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="keyword" id="1746996">var</span>&nbsp;<span class="ident" id="1747000">gStatusStrings</span>&nbsp;<span class="op" id="1747015">=</span>&nbsp;<span class="op" id="1747017">[</span><span class="op" id="1747018">...</span><span class="op" id="1747021">]</span><span class="builtintype" id="1747022">string</span><span class="op" id="1747028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747031">_Gidle</span><span class="op" id="1747037">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1747044">&#34;idle&#34;</span><span class="op" id="1747050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747053">_Grunnable</span><span class="op" id="1747063">:</span>&nbsp;&nbsp;<span class="string" id="1747066">&#34;runnable&#34;</span><span class="op" id="1747076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747079">_Grunning</span><span class="op" id="1747088">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1747092">&#34;running&#34;</span><span class="op" id="1747101">,</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747104">_Gsyscall</span><span class="op" id="1747113">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1747117">&#34;syscall&#34;</span><span class="op" id="1747126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747129">_Gwaiting</span><span class="op" id="1747138">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1747142">&#34;waiting&#34;</span><span class="op" id="1747151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747154">_Gdead</span><span class="op" id="1747160">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1747167">&#34;dead&#34;</span><span class="op" id="1747173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747176">_Genqueue</span><span class="op" id="1747185">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1747189">&#34;enqueue&#34;</span><span class="op" id="1747198">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747201">_Gcopystack</span><span class="op" id="1747212">:</span>&nbsp;<span class="string" id="1747214">&#34;copystack&#34;</span><span class="op" id="1747225">,</span><br>
<span class="lineno">575</span><span class="op" id="1747227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1747230">var</span>&nbsp;<span class="ident" id="1747234">gScanStatusStrings</span>&nbsp;<span class="op" id="1747253">=</span>&nbsp;<span class="op" id="1747255">[</span><span class="op" id="1747256">...</span><span class="op" id="1747259">]</span><span class="builtintype" id="1747260">string</span><span class="op" id="1747266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="1747269">0</span><span class="op" id="1747270">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1747281">&#34;scan&#34;</span><span class="op" id="1747287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747290">_Grunnable</span><span class="op" id="1747300">:</span>&nbsp;<span class="string" id="1747302">&#34;scanrunnable&#34;</span><span class="op" id="1747316">,</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747319">_Grunning</span><span class="op" id="1747328">:</span>&nbsp;&nbsp;<span class="string" id="1747331">&#34;scanrunning&#34;</span><span class="op" id="1747344">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747347">_Gsyscall</span><span class="op" id="1747356">:</span>&nbsp;&nbsp;<span class="string" id="1747359">&#34;scansyscall&#34;</span><span class="op" id="1747372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747375">_Gwaiting</span><span class="op" id="1747384">:</span>&nbsp;&nbsp;<span class="string" id="1747387">&#34;scanwaiting&#34;</span><span class="op" id="1747400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747403">_Gdead</span><span class="op" id="1747409">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1747415">&#34;scandead&#34;</span><span class="op" id="1747425">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747428">_Genqueue</span><span class="op" id="1747437">:</span>&nbsp;&nbsp;<span class="string" id="1747440">&#34;scanenqueue&#34;</span><span class="op" id="1747453">,</span><br>
<span class="lineno">585</span><span class="op" id="1747455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1747458">func</span>&nbsp;<span class="ident" id="1747463">goroutineheader</span><span class="op" id="1747478">(</span><span class="ident" id="1747479">gp</span>&nbsp;<span class="op" id="1747482">*</span><span class="ident" id="1747483">g</span><span class="op" id="1747484">)</span>&nbsp;<span class="op" id="1747486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747489">gpstatus</span>&nbsp;<span class="op" id="1747498">:=</span>&nbsp;<span class="ident" id="1747501">readgstatus</span><span class="op" id="1747512">(</span><span class="ident" id="1747513">gp</span><span class="op" id="1747515">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1747519">//&nbsp;Basic&nbsp;string&nbsp;status</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1747543">var</span>&nbsp;<span class="ident" id="1747547">status</span>&nbsp;<span class="builtintype" id="1747554">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1747562">if</span>&nbsp;<span class="num" id="1747565">0</span>&nbsp;<span class="op" id="1747567">&lt;=</span>&nbsp;<span class="ident" id="1747570">gpstatus</span>&nbsp;<span class="op" id="1747579">&amp;&amp;</span>&nbsp;<span class="ident" id="1747582">gpstatus</span>&nbsp;<span class="op" id="1747591">&lt;</span>&nbsp;<span class="builtintype" id="1747593">uint32</span><span class="op" id="1747599">(</span><span class="builtinfunc" id="1747600">len</span><span class="op" id="1747603">(</span><span class="ident" id="1747604">gStatusStrings</span><span class="op" id="1747618">)</span><span class="op" id="1747619">)</span>&nbsp;<span class="op" id="1747621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747625">status</span>&nbsp;<span class="op" id="1747632">=</span>&nbsp;<span class="ident" id="1747634">gStatusStrings</span><span class="op" id="1747648">[</span><span class="ident" id="1747649">gpstatus</span><span class="op" id="1747657">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1747660">}</span>&nbsp;<span class="keyword" id="1747662">else</span>&nbsp;<span class="keyword" id="1747667">if</span>&nbsp;<span class="ident" id="1747670">gpstatus</span><span class="op" id="1747678">&amp;</span><span class="ident" id="1747679">_Gscan</span>&nbsp;<span class="op" id="1747686">!=</span>&nbsp;<span class="num" id="1747689">0</span>&nbsp;<span class="op" id="1747691">&amp;&amp;</span>&nbsp;<span class="num" id="1747694">0</span>&nbsp;<span class="op" id="1747696">&lt;=</span>&nbsp;<span class="ident" id="1747699">gpstatus</span><span class="op" id="1747707">&amp;^</span><span class="ident" id="1747709">_Gscan</span>&nbsp;<span class="op" id="1747716">&amp;&amp;</span>&nbsp;<span class="ident" id="1747719">gpstatus</span><span class="op" id="1747727">&amp;^</span><span class="ident" id="1747729">_Gscan</span>&nbsp;<span class="op" id="1747736">&lt;</span>&nbsp;<span class="builtintype" id="1747738">uint32</span><span class="op" id="1747744">(</span><span class="builtinfunc" id="1747745">len</span><span class="op" id="1747748">(</span><span class="ident" id="1747749">gStatusStrings</span><span class="op" id="1747763">)</span><span class="op" id="1747764">)</span>&nbsp;<span class="op" id="1747766">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747770">status</span>&nbsp;<span class="op" id="1747777">=</span>&nbsp;<span class="ident" id="1747779">gStatusStrings</span><span class="op" id="1747793">[</span><span class="ident" id="1747794">gpstatus</span><span class="op" id="1747802">&amp;^</span><span class="ident" id="1747804">_Gscan</span><span class="op" id="1747810">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1747813">}</span>&nbsp;<span class="keyword" id="1747815">else</span>&nbsp;<span class="op" id="1747820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747824">status</span>&nbsp;<span class="op" id="1747831">=</span>&nbsp;<span class="string" id="1747833">&#34;???&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1747840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1747844">//&nbsp;Override.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1747858">if</span>&nbsp;<span class="op" id="1747861">(</span><span class="ident" id="1747862">gpstatus</span>&nbsp;<span class="op" id="1747871">==</span>&nbsp;<span class="ident" id="1747874">_Gwaiting</span>&nbsp;<span class="op" id="1747884">||</span>&nbsp;<span class="ident" id="1747887">gpstatus</span>&nbsp;<span class="op" id="1747896">==</span>&nbsp;<span class="ident" id="1747899">_Gscanwaiting</span><span class="op" id="1747912">)</span>&nbsp;<span class="op" id="1747914">&amp;&amp;</span>&nbsp;<span class="ident" id="1747917">gp</span><span class="op" id="1747919">.</span><span class="ident" id="1747920">waitreason</span>&nbsp;<span class="op" id="1747931">!=</span>&nbsp;<span class="string" id="1747934">&#34;&#34;</span>&nbsp;<span class="op" id="1747937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1747941">status</span>&nbsp;<span class="op" id="1747948">=</span>&nbsp;<span class="ident" id="1747950">gp</span><span class="op" id="1747952">.</span><span class="ident" id="1747953">waitreason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1747965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1747969">//&nbsp;approx&nbsp;time&nbsp;the&nbsp;G&nbsp;is&nbsp;blocked,&nbsp;in&nbsp;minutes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748014">var</span>&nbsp;<span class="ident" id="1748018">waitfor</span>&nbsp;<span class="ident" id="1748026">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1748033">gpstatus</span>&nbsp;<span class="op" id="1748042">&amp;^=</span>&nbsp;<span class="ident" id="1748046">_Gscan</span>&nbsp;<span class="comment" id="1748053">//&nbsp;drop&nbsp;the&nbsp;scan&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748075">if</span>&nbsp;<span class="op" id="1748078">(</span><span class="ident" id="1748079">gpstatus</span>&nbsp;<span class="op" id="1748088">==</span>&nbsp;<span class="ident" id="1748091">_Gwaiting</span>&nbsp;<span class="op" id="1748101">||</span>&nbsp;<span class="ident" id="1748104">gpstatus</span>&nbsp;<span class="op" id="1748113">==</span>&nbsp;<span class="ident" id="1748116">_Gsyscall</span><span class="op" id="1748125">)</span>&nbsp;<span class="op" id="1748127">&amp;&amp;</span>&nbsp;<span class="ident" id="1748130">gp</span><span class="op" id="1748132">.</span><span class="ident" id="1748133">waitsince</span>&nbsp;<span class="op" id="1748143">!=</span>&nbsp;<span class="num" id="1748146">0</span>&nbsp;<span class="op" id="1748148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1748152">waitfor</span>&nbsp;<span class="op" id="1748160">=</span>&nbsp;<span class="op" id="1748162">(</span><span class="ident" id="1748163">nanotime</span><span class="op" id="1748171">(</span><span class="op" id="1748172">)</span>&nbsp;<span class="op" id="1748174">-</span>&nbsp;<span class="ident" id="1748176">gp</span><span class="op" id="1748178">.</span><span class="ident" id="1748179">waitsince</span><span class="op" id="1748188">)</span>&nbsp;<span class="op" id="1748190">/</span>&nbsp;<span class="num" id="1748192">60e9</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1748198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1748201">print</span><span class="op" id="1748206">(</span><span class="string" id="1748207">&#34;goroutine&nbsp;&#34;</span><span class="op" id="1748219">,</span>&nbsp;<span class="ident" id="1748221">gp</span><span class="op" id="1748223">.</span><span class="ident" id="1748224">goid</span><span class="op" id="1748228">,</span>&nbsp;<span class="string" id="1748230">&#34;&nbsp;[&#34;</span><span class="op" id="1748234">,</span>&nbsp;<span class="ident" id="1748236">status</span><span class="op" id="1748242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748245">if</span>&nbsp;<span class="ident" id="1748248">waitfor</span>&nbsp;<span class="op" id="1748256">&gt;=</span>&nbsp;<span class="num" id="1748259">1</span>&nbsp;<span class="op" id="1748261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1748265">print</span><span class="op" id="1748270">(</span><span class="string" id="1748271">&#34;,&nbsp;&#34;</span><span class="op" id="1748275">,</span>&nbsp;<span class="ident" id="1748277">waitfor</span><span class="op" id="1748284">,</span>&nbsp;<span class="string" id="1748286">&#34;&nbsp;minutes&#34;</span><span class="op" id="1748296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1748299">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748302">if</span>&nbsp;<span class="ident" id="1748305">gp</span><span class="op" id="1748307">.</span><span class="ident" id="1748308">lockedm</span>&nbsp;<span class="op" id="1748316">!=</span>&nbsp;<span class="builtintype" id="1748319">nil</span>&nbsp;<span class="op" id="1748323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1748327">print</span><span class="op" id="1748332">(</span><span class="string" id="1748333">&#34;,&nbsp;locked&nbsp;to&nbsp;thread&#34;</span><span class="op" id="1748353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1748356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1748359">print</span><span class="op" id="1748364">(</span><span class="string" id="1748365">&#34;]:\n&#34;</span><span class="op" id="1748371">)</span><br>
<span class="lineno"></span><span class="op" id="1748373">}</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span><span class="keyword" id="1748376">func</span>&nbsp;<span class="ident" id="1748381">tracebackothers</span><span class="op" id="1748396">(</span><span class="ident" id="1748397">me</span>&nbsp;<span class="op" id="1748400">*</span><span class="ident" id="1748401">g</span><span class="op" id="1748402">)</span>&nbsp;<span class="op" id="1748404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1748407">level</span>&nbsp;<span class="op" id="1748413">:=</span>&nbsp;<span class="ident" id="1748416">gotraceback</span><span class="op" id="1748427">(</span><span class="builtintype" id="1748428">nil</span><span class="op" id="1748431">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1748435">//&nbsp;Show&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;first,&nbsp;if&nbsp;we&nbsp;haven&#39;t&nbsp;already.</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1748496">g</span>&nbsp;<span class="op" id="1748498">:=</span>&nbsp;<span class="ident" id="1748501">getg</span><span class="op" id="1748505">(</span><span class="op" id="1748506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1748509">gp</span>&nbsp;<span class="op" id="1748512">:=</span>&nbsp;<span class="ident" id="1748515">g</span><span class="op" id="1748516">.</span><span class="ident" id="1748517">m</span><span class="op" id="1748518">.</span><span class="ident" id="1748519">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748525">if</span>&nbsp;<span class="ident" id="1748528">gp</span>&nbsp;<span class="op" id="1748531">!=</span>&nbsp;<span class="builtintype" id="1748534">nil</span>&nbsp;<span class="op" id="1748538">&amp;&amp;</span>&nbsp;<span class="ident" id="1748541">gp</span>&nbsp;<span class="op" id="1748544">!=</span>&nbsp;<span class="ident" id="1748547">me</span>&nbsp;<span class="op" id="1748550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1748554">print</span><span class="op" id="1748559">(</span><span class="string" id="1748560">&#34;\n&#34;</span><span class="op" id="1748564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1748568">goroutineheader</span><span class="op" id="1748583">(</span><span class="ident" id="1748584">gp</span><span class="op" id="1748586">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1748590">traceback</span><span class="op" id="1748599">(</span><span class="op" id="1748600">^</span><span class="builtintype" id="1748601">uintptr</span><span class="op" id="1748608">(</span><span class="num" id="1748609">0</span><span class="op" id="1748610">)</span><span class="op" id="1748611">,</span>&nbsp;<span class="op" id="1748613">^</span><span class="builtintype" id="1748614">uintptr</span><span class="op" id="1748621">(</span><span class="num" id="1748622">0</span><span class="op" id="1748623">)</span><span class="op" id="1748624">,</span>&nbsp;<span class="num" id="1748626">0</span><span class="op" id="1748627">,</span>&nbsp;<span class="ident" id="1748629">gp</span><span class="op" id="1748631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1748634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1748638">lock</span><span class="op" id="1748642">(</span><span class="op" id="1748643">&amp;</span><span class="ident" id="1748644">allglock</span><span class="op" id="1748652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748655">for</span>&nbsp;<span class="ident" id="1748659">_</span><span class="op" id="1748660">,</span>&nbsp;<span class="ident" id="1748662">gp</span>&nbsp;<span class="op" id="1748665">:=</span>&nbsp;<span class="keyword" id="1748668">range</span>&nbsp;<span class="ident" id="1748674">allgs</span>&nbsp;<span class="op" id="1748680">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748684">if</span>&nbsp;<span class="ident" id="1748687">gp</span>&nbsp;<span class="op" id="1748690">==</span>&nbsp;<span class="ident" id="1748693">me</span>&nbsp;<span class="op" id="1748696">||</span>&nbsp;<span class="ident" id="1748699">gp</span>&nbsp;<span class="op" id="1748702">==</span>&nbsp;<span class="ident" id="1748705">g</span><span class="op" id="1748706">.</span><span class="ident" id="1748707">m</span><span class="op" id="1748708">.</span><span class="ident" id="1748709">curg</span>&nbsp;<span class="op" id="1748714">||</span>&nbsp;<span class="ident" id="1748717">readgstatus</span><span class="op" id="1748728">(</span><span class="ident" id="1748729">gp</span><span class="op" id="1748731">)</span>&nbsp;<span class="op" id="1748733">==</span>&nbsp;<span class="ident" id="1748736">_Gdead</span>&nbsp;<span class="op" id="1748743">||</span>&nbsp;<span class="ident" id="1748746">gp</span><span class="op" id="1748748">.</span><span class="ident" id="1748749">issystem</span>&nbsp;<span class="op" id="1748758">&amp;&amp;</span>&nbsp;<span class="ident" id="1748761">level</span>&nbsp;<span class="op" id="1748767">&lt;</span>&nbsp;<span class="num" id="1748769">2</span>&nbsp;<span class="op" id="1748771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748776">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1748787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1748791">print</span><span class="op" id="1748796">(</span><span class="string" id="1748797">&#34;\n&#34;</span><span class="op" id="1748801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1748805">goroutineheader</span><span class="op" id="1748820">(</span><span class="ident" id="1748821">gp</span><span class="op" id="1748823">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1748827">if</span>&nbsp;<span class="ident" id="1748830">readgstatus</span><span class="op" id="1748841">(</span><span class="ident" id="1748842">gp</span><span class="op" id="1748844">)</span><span class="op" id="1748845">&amp;^</span><span class="ident" id="1748847">_Gscan</span>&nbsp;<span class="op" id="1748854">==</span>&nbsp;<span class="ident" id="1748857">_Grunning</span>&nbsp;<span class="op" id="1748867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1748872">print</span><span class="op" id="1748877">(</span><span class="string" id="1748878">&#34;\tgoroutine&nbsp;running&nbsp;on&nbsp;other&nbsp;thread;&nbsp;stack&nbsp;unavailable\n&#34;</span><span class="op" id="1748936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1748941">printcreatedby</span><span class="op" id="1748955">(</span><span class="ident" id="1748956">gp</span><span class="op" id="1748958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1748962">}</span>&nbsp;<span class="keyword" id="1748964">else</span>&nbsp;<span class="op" id="1748969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1748974">traceback</span><span class="op" id="1748983">(</span><span class="op" id="1748984">^</span><span class="builtintype" id="1748985">uintptr</span><span class="op" id="1748992">(</span><span class="num" id="1748993">0</span><span class="op" id="1748994">)</span><span class="op" id="1748995">,</span>&nbsp;<span class="op" id="1748997">^</span><span class="builtintype" id="1748998">uintptr</span><span class="op" id="1749005">(</span><span class="num" id="1749006">0</span><span class="op" id="1749007">)</span><span class="op" id="1749008">,</span>&nbsp;<span class="num" id="1749010">0</span><span class="op" id="1749011">,</span>&nbsp;<span class="ident" id="1749013">gp</span><span class="op" id="1749015">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1749019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1749022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1749025">unlock</span><span class="op" id="1749031">(</span><span class="op" id="1749032">&amp;</span><span class="ident" id="1749033">allglock</span><span class="op" id="1749041">)</span><br>
<span class="lineno"></span><span class="op" id="1749043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">650</span><span class="comment" id="1749046">//&nbsp;Does&nbsp;f&nbsp;mark&nbsp;the&nbsp;top&nbsp;of&nbsp;a&nbsp;goroutine&nbsp;stack?</span><br>
<span class="lineno"></span><span class="keyword" id="1749091">func</span>&nbsp;<span class="ident" id="1749096">topofstack</span><span class="op" id="1749106">(</span><span class="ident" id="1749107">f</span>&nbsp;<span class="op" id="1749109">*</span><span class="ident" id="1749110">_func</span><span class="op" id="1749115">)</span>&nbsp;<span class="builtintype" id="1749117">bool</span>&nbsp;<span class="op" id="1749122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1749125">pc</span>&nbsp;<span class="op" id="1749128">:=</span>&nbsp;<span class="ident" id="1749131">f</span><span class="op" id="1749132">.</span><span class="ident" id="1749133">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1749140">return</span>&nbsp;<span class="ident" id="1749147">pc</span>&nbsp;<span class="op" id="1749150">==</span>&nbsp;<span class="ident" id="1749153">goexitPC</span>&nbsp;<span class="op" id="1749162">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1749167">pc</span>&nbsp;<span class="op" id="1749170">==</span>&nbsp;<span class="ident" id="1749173">mstartPC</span>&nbsp;<span class="op" id="1749182">||</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1749187">pc</span>&nbsp;<span class="op" id="1749190">==</span>&nbsp;<span class="ident" id="1749193">mcallPC</span>&nbsp;<span class="op" id="1749201">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1749206">pc</span>&nbsp;<span class="op" id="1749209">==</span>&nbsp;<span class="ident" id="1749212">morestackPC</span>&nbsp;<span class="op" id="1749224">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1749229">pc</span>&nbsp;<span class="op" id="1749232">==</span>&nbsp;<span class="ident" id="1749235">rt0_goPC</span>&nbsp;<span class="op" id="1749244">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1749249">externalthreadhandlerp</span>&nbsp;<span class="op" id="1749272">!=</span>&nbsp;<span class="num" id="1749275">0</span>&nbsp;<span class="op" id="1749277">&amp;&amp;</span>&nbsp;<span class="ident" id="1749280">pc</span>&nbsp;<span class="op" id="1749283">==</span>&nbsp;<span class="ident" id="1749286">externalthreadhandlerp</span><br>
<span class="lineno"></span><span class="op" id="1749309">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
