<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword">package</span>&nbsp;<span class="ident">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">import</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;crypto/hmac&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Split&nbsp;a&nbsp;premaster&nbsp;secret&nbsp;in&nbsp;two&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">splitPreMasterSecret</span><span class="op">(</span><span class="ident">secret</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">s1</span><span class="op">,</span>&nbsp;<span class="ident">s2</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s1</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">secret</span><span class="op">[</span><span class="num">0</span>&nbsp;<span class="op">:</span>&nbsp;<span class="op">(</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">secret</span><span class="op">)</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="op">/</span><span class="num">2</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s2</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">secret</span><span class="op">[</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">secret</span><span class="op">)</span><span class="op">/</span><span class="num">2</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;pHash&nbsp;implements&nbsp;the&nbsp;P_hash&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">pHash</span><span class="op">(</span><span class="ident">result</span><span class="op">,</span>&nbsp;<span class="ident">secret</span><span class="op">,</span>&nbsp;<span class="ident">seed</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">hash</span>&nbsp;<span class="keyword">func</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="ident">hash</span><span class="op">.</span><span class="ident">Hash</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">h</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">hmac</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="ident">hash</span><span class="op">,</span>&nbsp;<span class="ident">secret</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">h</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">seed</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">a</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">nil</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">j</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">j</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">result</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">h</span><span class="op">.</span><span class="ident">Reset</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">h</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">a</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">h</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">seed</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">nil</span><span class="op">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">todo</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">b</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">j</span><span class="op">+</span><span class="ident">todo</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">result</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">todo</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">result</span><span class="op">)</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">result</span><span class="op">[</span><span class="ident">j</span><span class="op">:</span><span class="ident">j</span><span class="op">+</span><span class="ident">todo</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">b</span><span class="op">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">j</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">todo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">h</span><span class="op">.</span><span class="ident">Reset</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">h</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">a</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">a</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">nil</span><span class="op">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;prf10&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">prf10</span><span class="op">(</span><span class="ident">result</span><span class="op">,</span>&nbsp;<span class="ident">secret</span><span class="op">,</span>&nbsp;<span class="ident">label</span><span class="op">,</span>&nbsp;<span class="ident">seed</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hashSHA1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">sha1</span><span class="op">.</span><span class="ident">New</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hashMD5</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">md5</span><span class="op">.</span><span class="ident">New</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">labelAndSeed</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">label</span><span class="op">)</span><span class="op">+</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">seed</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">labelAndSeed</span><span class="op">,</span>&nbsp;<span class="ident">label</span><span class="op">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">labelAndSeed</span><span class="op">[</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">label</span><span class="op">)</span><span class="op">:</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">seed</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s1</span><span class="op">,</span>&nbsp;<span class="ident">s2</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">splitPreMasterSecret</span><span class="op">(</span><span class="ident">secret</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pHash</span><span class="op">(</span><span class="ident">result</span><span class="op">,</span>&nbsp;<span class="ident">s1</span><span class="op">,</span>&nbsp;<span class="ident">labelAndSeed</span><span class="op">,</span>&nbsp;<span class="ident">hashMD5</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">result2</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">result</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pHash</span><span class="op">(</span><span class="ident">result2</span><span class="op">,</span>&nbsp;<span class="ident">s2</span><span class="op">,</span>&nbsp;<span class="ident">labelAndSeed</span><span class="op">,</span>&nbsp;<span class="ident">hashSHA1</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span><span class="op">,</span>&nbsp;<span class="ident">b</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="keyword">range</span>&nbsp;<span class="ident">result2</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">result</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">^=</span>&nbsp;<span class="ident">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">65</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;prf12&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.2&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">prf12</span><span class="op">(</span><span class="ident">result</span><span class="op">,</span>&nbsp;<span class="ident">secret</span><span class="op">,</span>&nbsp;<span class="ident">label</span><span class="op">,</span>&nbsp;<span class="ident">seed</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">labelAndSeed</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">label</span><span class="op">)</span><span class="op">+</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">seed</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">labelAndSeed</span><span class="op">,</span>&nbsp;<span class="ident">label</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">labelAndSeed</span><span class="op">[</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">label</span><span class="op">)</span><span class="op">:</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">seed</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pHash</span><span class="op">(</span><span class="ident">result</span><span class="op">,</span>&nbsp;<span class="ident">secret</span><span class="op">,</span>&nbsp;<span class="ident">labelAndSeed</span><span class="op">,</span>&nbsp;<span class="ident">sha256</span><span class="op">.</span><span class="ident">New</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;prf30&nbsp;implements&nbsp;the&nbsp;SSL&nbsp;3.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;www.mozilla.org/projects/security/pki/nss/ssl/draft302.txt&nbsp;section&nbsp;6.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">prf30</span><span class="op">(</span><span class="ident">result</span><span class="op">,</span>&nbsp;<span class="ident">secret</span><span class="op">,</span>&nbsp;<span class="ident">label</span><span class="op">,</span>&nbsp;<span class="ident">seed</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hashSHA1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">sha1</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hashMD5</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">md5</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">done</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;RFC5246&nbsp;section&nbsp;6.3&nbsp;says&nbsp;that&nbsp;the&nbsp;largest&nbsp;PRF&nbsp;output&nbsp;needed&nbsp;is&nbsp;128</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;bytes.&nbsp;Since&nbsp;no&nbsp;more&nbsp;ciphersuites&nbsp;will&nbsp;be&nbsp;added&nbsp;to&nbsp;SSLv3,&nbsp;this&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;remain&nbsp;true.&nbsp;Each&nbsp;iteration&nbsp;gives&nbsp;us&nbsp;16&nbsp;bytes&nbsp;so&nbsp;10&nbsp;iterations&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;be&nbsp;sufficient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">b</span>&nbsp;<span class="op">[</span><span class="num">11</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">done</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">result</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">j</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">j</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">i</span><span class="op">;</span>&nbsp;<span class="ident">j</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b</span><span class="op">[</span><span class="ident">j</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="string">&#39;A&#39;</span>&nbsp;<span class="op">+</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">i</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hashSHA1</span><span class="op">.</span><span class="ident">Reset</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hashSHA1</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">b</span><span class="op">[</span><span class="op">:</span><span class="ident">i</span><span class="op">+</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hashSHA1</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">secret</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hashSHA1</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">seed</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">digest</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">hashSHA1</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">nil</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hashMD5</span><span class="op">.</span><span class="ident">Reset</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hashMD5</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">secret</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hashMD5</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">digest</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">done</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">result</span><span class="op">[</span><span class="ident">done</span><span class="op">:</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">hashMD5</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">nil</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">i</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="op">(</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">tlsRandomLength</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">32</span>&nbsp;<span class="comment">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;random&nbsp;nonce&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">masterSecretLength</span>&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">48</span>&nbsp;<span class="comment">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;master&nbsp;secret&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">finishedVerifyLength</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">12</span>&nbsp;<span class="comment">//&nbsp;Length&nbsp;of&nbsp;verify_data&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword">var</span>&nbsp;<span class="ident">masterSecretLabel</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">(</span><span class="string">&#34;master&nbsp;secret&#34;</span><span class="op">)</span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">keyExpansionLabel</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">(</span><span class="string">&#34;key&nbsp;expansion&#34;</span><span class="op">)</span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">clientFinishedLabel</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">(</span><span class="string">&#34;client&nbsp;finished&#34;</span><span class="op">)</span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">serverFinishedLabel</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">(</span><span class="string">&#34;server&nbsp;finished&#34;</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword">func</span>&nbsp;<span class="ident">prfForVersion</span><span class="op">(</span><span class="ident">version</span>&nbsp;<span class="builtintype">uint16</span><span class="op">)</span>&nbsp;<span class="keyword">func</span><span class="op">(</span><span class="ident">result</span><span class="op">,</span>&nbsp;<span class="ident">secret</span><span class="op">,</span>&nbsp;<span class="ident">label</span><span class="op">,</span>&nbsp;<span class="ident">seed</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">switch</span>&nbsp;<span class="ident">version</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">VersionSSL30</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">prf30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">VersionTLS10</span><span class="op">,</span>&nbsp;<span class="ident">VersionTLS11</span><span class="op">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">prf10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">VersionTLS12</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">prf12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">default</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">panic</span><span class="op">(</span><span class="string">&#34;unknown&nbsp;version&#34;</span><span class="op">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;masterFromPreMasterSecret&nbsp;generates&nbsp;the&nbsp;master&nbsp;secret&nbsp;from&nbsp;the&nbsp;pre-master</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;secret.&nbsp;See&nbsp;http://tools.ietf.org/html/rfc5246#section-8.1</span><br>
<span class="lineno">135</span><span class="keyword">func</span>&nbsp;<span class="ident">masterFromPreMasterSecret</span><span class="op">(</span><span class="ident">version</span>&nbsp;<span class="builtintype">uint16</span><span class="op">,</span>&nbsp;<span class="ident">preMasterSecret</span><span class="op">,</span>&nbsp;<span class="ident">clientRandom</span><span class="op">,</span>&nbsp;<span class="ident">serverRandom</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">seed</span>&nbsp;<span class="op">[</span><span class="ident">tlsRandomLength</span>&nbsp;<span class="op">*</span>&nbsp;<span class="num">2</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">seed</span><span class="op">[</span><span class="num">0</span><span class="op">:</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">clientRandom</span><span class="op">)</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">clientRandom</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">seed</span><span class="op">[</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">clientRandom</span><span class="op">)</span><span class="op">:</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">serverRandom</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">masterSecret</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">masterSecretLength</span><span class="op">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">prfForVersion</span><span class="op">(</span><span class="ident">version</span><span class="op">)</span><span class="op">(</span><span class="ident">masterSecret</span><span class="op">,</span>&nbsp;<span class="ident">preMasterSecret</span><span class="op">,</span>&nbsp;<span class="ident">masterSecretLabel</span><span class="op">,</span>&nbsp;<span class="ident">seed</span><span class="op">[</span><span class="num">0</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">masterSecret</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;keysFromMasterSecret&nbsp;generates&nbsp;the&nbsp;connection&nbsp;keys&nbsp;from&nbsp;the&nbsp;master</span><br>
<span class="lineno">145</span><span class="comment">//&nbsp;secret,&nbsp;given&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MAC&nbsp;key,&nbsp;cipher&nbsp;key&nbsp;and&nbsp;IV,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;6.3.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">keysFromMasterSecret</span><span class="op">(</span><span class="ident">version</span>&nbsp;<span class="builtintype">uint16</span><span class="op">,</span>&nbsp;<span class="ident">masterSecret</span><span class="op">,</span>&nbsp;<span class="ident">clientRandom</span><span class="op">,</span>&nbsp;<span class="ident">serverRandom</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">macLen</span><span class="op">,</span>&nbsp;<span class="ident">keyLen</span><span class="op">,</span>&nbsp;<span class="ident">ivLen</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">clientMAC</span><span class="op">,</span>&nbsp;<span class="ident">serverMAC</span><span class="op">,</span>&nbsp;<span class="ident">clientKey</span><span class="op">,</span>&nbsp;<span class="ident">serverKey</span><span class="op">,</span>&nbsp;<span class="ident">clientIV</span><span class="op">,</span>&nbsp;<span class="ident">serverIV</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">seed</span>&nbsp;<span class="op">[</span><span class="ident">tlsRandomLength</span>&nbsp;<span class="op">*</span>&nbsp;<span class="num">2</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">seed</span><span class="op">[</span><span class="num">0</span><span class="op">:</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">clientRandom</span><span class="op">)</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">serverRandom</span><span class="op">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">seed</span><span class="op">[</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">serverRandom</span><span class="op">)</span><span class="op">:</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">clientRandom</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">2</span><span class="op">*</span><span class="ident">macLen</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">2</span><span class="op">*</span><span class="ident">keyLen</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">2</span><span class="op">*</span><span class="ident">ivLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">keyMaterial</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">n</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">prfForVersion</span><span class="op">(</span><span class="ident">version</span><span class="op">)</span><span class="op">(</span><span class="ident">keyMaterial</span><span class="op">,</span>&nbsp;<span class="ident">masterSecret</span><span class="op">,</span>&nbsp;<span class="ident">keyExpansionLabel</span><span class="op">,</span>&nbsp;<span class="ident">seed</span><span class="op">[</span><span class="num">0</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">clientMAC</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">keyMaterial</span><span class="op">[</span><span class="op">:</span><span class="ident">macLen</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">keyMaterial</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">keyMaterial</span><span class="op">[</span><span class="ident">macLen</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">serverMAC</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">keyMaterial</span><span class="op">[</span><span class="op">:</span><span class="ident">macLen</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">keyMaterial</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">keyMaterial</span><span class="op">[</span><span class="ident">macLen</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">clientKey</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">keyMaterial</span><span class="op">[</span><span class="op">:</span><span class="ident">keyLen</span><span class="op">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">keyMaterial</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">keyMaterial</span><span class="op">[</span><span class="ident">keyLen</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">serverKey</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">keyMaterial</span><span class="op">[</span><span class="op">:</span><span class="ident">keyLen</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">keyMaterial</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">keyMaterial</span><span class="op">[</span><span class="ident">keyLen</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">clientIV</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">keyMaterial</span><span class="op">[</span><span class="op">:</span><span class="ident">ivLen</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">keyMaterial</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">keyMaterial</span><span class="op">[</span><span class="ident">ivLen</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">serverIV</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">keyMaterial</span><span class="op">[</span><span class="op">:</span><span class="ident">ivLen</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">newFinishedHash</span><span class="op">(</span><span class="ident">version</span>&nbsp;<span class="builtintype">uint16</span><span class="op">)</span>&nbsp;<span class="ident">finishedHash</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">version</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="ident">VersionTLS12</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">finishedHash</span><span class="op">{</span><span class="ident">sha256</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">sha256</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><span class="op">,</span>&nbsp;<span class="ident">version</span><span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">finishedHash</span><span class="op">{</span><span class="ident">sha1</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">sha1</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">md5</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">md5</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">version</span><span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;A&nbsp;finishedHash&nbsp;calculates&nbsp;the&nbsp;hash&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake&nbsp;messages&nbsp;suitable</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;for&nbsp;including&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">finishedHash</span>&nbsp;<span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">client</span>&nbsp;<span class="ident">hash</span><span class="op">.</span><span class="ident">Hash</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">server</span>&nbsp;<span class="ident">hash</span><span class="op">.</span><span class="ident">Hash</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Prior&nbsp;to&nbsp;TLS&nbsp;1.2,&nbsp;an&nbsp;additional&nbsp;MD5&nbsp;hash&nbsp;is&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">clientMD5</span>&nbsp;<span class="ident">hash</span><span class="op">.</span><span class="ident">Hash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">serverMD5</span>&nbsp;<span class="ident">hash</span><span class="op">.</span><span class="ident">Hash</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">version</span>&nbsp;<span class="builtintype">uint16</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">h</span>&nbsp;<span class="ident">finishedHash</span><span class="op">)</span>&nbsp;<span class="ident">Write</span><span class="op">(</span><span class="ident">msg</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">n</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="builtintype">error</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">h</span><span class="op">.</span><span class="ident">client</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">msg</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">h</span><span class="op">.</span><span class="ident">server</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">msg</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">version</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">VersionTLS12</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">h</span><span class="op">.</span><span class="ident">clientMD5</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">msg</span><span class="op">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">h</span><span class="op">.</span><span class="ident">serverMD5</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">msg</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">msg</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment">//&nbsp;finishedSum30&nbsp;calculates&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;SSLv3</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Finished&nbsp;message&nbsp;given&nbsp;the&nbsp;MD5&nbsp;and&nbsp;SHA1&nbsp;hashes&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">finishedSum30</span><span class="op">(</span><span class="ident">md5</span><span class="op">,</span>&nbsp;<span class="ident">sha1</span>&nbsp;<span class="ident">hash</span><span class="op">.</span><span class="ident">Hash</span><span class="op">,</span>&nbsp;<span class="ident">masterSecret</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">magic</span>&nbsp;<span class="op">[</span><span class="num">4</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">md5</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">magic</span><span class="op">[</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">md5</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">masterSecret</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">md5</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">ssl30Pad1</span><span class="op">[</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">md5Digest</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">md5</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">nil</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">md5</span><span class="op">.</span><span class="ident">Reset</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">md5</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">masterSecret</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">md5</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">ssl30Pad2</span><span class="op">[</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">md5</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">md5Digest</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">md5Digest</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">md5</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">nil</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sha1</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">magic</span><span class="op">[</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sha1</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">masterSecret</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sha1</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">ssl30Pad1</span><span class="op">[</span><span class="op">:</span><span class="num">40</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sha1Digest</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">sha1</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">nil</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sha1</span><span class="op">.</span><span class="ident">Reset</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sha1</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">masterSecret</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sha1</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">ssl30Pad2</span><span class="op">[</span><span class="op">:</span><span class="num">40</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sha1</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">sha1Digest</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sha1Digest</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">sha1</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">nil</span><span class="op">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">ret</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">md5Digest</span><span class="op">)</span><span class="op">+</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">sha1Digest</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">ret</span><span class="op">,</span>&nbsp;<span class="ident">md5Digest</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">ret</span><span class="op">[</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">md5Digest</span><span class="op">)</span><span class="op">:</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">sha1Digest</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">ret</span><br>
<span class="lineno">230</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">ssl3ClientFinishedMagic</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="num">4</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">{</span><span class="num">0x43</span><span class="op">,</span>&nbsp;<span class="num">0x4c</span><span class="op">,</span>&nbsp;<span class="num">0x4e</span><span class="op">,</span>&nbsp;<span class="num">0x54</span><span class="op">}</span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">ssl3ServerFinishedMagic</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="num">4</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">{</span><span class="num">0x53</span><span class="op">,</span>&nbsp;<span class="num">0x52</span><span class="op">,</span>&nbsp;<span class="num">0x56</span><span class="op">,</span>&nbsp;<span class="num">0x52</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment">//&nbsp;clientSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;client&#39;s</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">h</span>&nbsp;<span class="ident">finishedHash</span><span class="op">)</span>&nbsp;<span class="ident">clientSum</span><span class="op">(</span><span class="ident">masterSecret</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">version</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">VersionSSL30</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">finishedSum30</span><span class="op">(</span><span class="ident">h</span><span class="op">.</span><span class="ident">clientMD5</span><span class="op">,</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">client</span><span class="op">,</span>&nbsp;<span class="ident">masterSecret</span><span class="op">,</span>&nbsp;<span class="ident">ssl3ClientFinishedMagic</span><span class="op">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">finishedVerifyLength</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">version</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="ident">VersionTLS12</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">seed</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">client</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">nil</span><span class="op">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">prf12</span><span class="op">(</span><span class="ident">out</span><span class="op">,</span>&nbsp;<span class="ident">masterSecret</span><span class="op">,</span>&nbsp;<span class="ident">clientFinishedLabel</span><span class="op">,</span>&nbsp;<span class="ident">seed</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">seed</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">md5</span><span class="op">.</span><span class="ident">Size</span><span class="op">+</span><span class="ident">sha1</span><span class="op">.</span><span class="ident">Size</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">seed</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">clientMD5</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">seed</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">seed</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">client</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">seed</span><span class="op">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">prf10</span><span class="op">(</span><span class="ident">out</span><span class="op">,</span>&nbsp;<span class="ident">masterSecret</span><span class="op">,</span>&nbsp;<span class="ident">clientFinishedLabel</span><span class="op">,</span>&nbsp;<span class="ident">seed</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">out</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment">//&nbsp;serverSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;server&#39;s</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">h</span>&nbsp;<span class="ident">finishedHash</span><span class="op">)</span>&nbsp;<span class="ident">serverSum</span><span class="op">(</span><span class="ident">masterSecret</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">version</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">VersionSSL30</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">finishedSum30</span><span class="op">(</span><span class="ident">h</span><span class="op">.</span><span class="ident">serverMD5</span><span class="op">,</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">server</span><span class="op">,</span>&nbsp;<span class="ident">masterSecret</span><span class="op">,</span>&nbsp;<span class="ident">ssl3ServerFinishedMagic</span><span class="op">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">finishedVerifyLength</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">version</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="ident">VersionTLS12</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">seed</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">server</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">nil</span><span class="op">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">prf12</span><span class="op">(</span><span class="ident">out</span><span class="op">,</span>&nbsp;<span class="ident">masterSecret</span><span class="op">,</span>&nbsp;<span class="ident">serverFinishedLabel</span><span class="op">,</span>&nbsp;<span class="ident">seed</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">seed</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">md5</span><span class="op">.</span><span class="ident">Size</span><span class="op">+</span><span class="ident">sha1</span><span class="op">.</span><span class="ident">Size</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">seed</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">serverMD5</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">seed</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">seed</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">server</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">seed</span><span class="op">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">prf10</span><span class="op">(</span><span class="ident">out</span><span class="op">,</span>&nbsp;<span class="ident">masterSecret</span><span class="op">,</span>&nbsp;<span class="ident">serverFinishedLabel</span><span class="op">,</span>&nbsp;<span class="ident">seed</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">out</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="comment">//&nbsp;hashForClientCertificate&nbsp;returns&nbsp;a&nbsp;digest,&nbsp;hash&nbsp;function,&nbsp;and&nbsp;TLS&nbsp;1.2&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;id&nbsp;suitable&nbsp;for&nbsp;signing&nbsp;by&nbsp;a&nbsp;TLS&nbsp;client&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">h</span>&nbsp;<span class="ident">finishedHash</span><span class="op">)</span>&nbsp;<span class="ident">hashForClientCertificate</span><span class="op">(</span><span class="ident">sigType</span>&nbsp;<span class="builtintype">uint8</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">crypto</span><span class="op">.</span><span class="ident">Hash</span><span class="op">,</span>&nbsp;<span class="builtintype">uint8</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">version</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="ident">VersionTLS12</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">digest</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">server</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">nil</span><span class="op">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">digest</span><span class="op">,</span>&nbsp;<span class="ident">crypto</span><span class="op">.</span><span class="ident">SHA256</span><span class="op">,</span>&nbsp;<span class="ident">hashSHA256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">sigType</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">signatureECDSA</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">digest</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">server</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">nil</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">digest</span><span class="op">,</span>&nbsp;<span class="ident">crypto</span><span class="op">.</span><span class="ident">SHA1</span><span class="op">,</span>&nbsp;<span class="ident">hashSHA1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">digest</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="num">36</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">digest</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">serverMD5</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">digest</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">digest</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">h</span><span class="op">.</span><span class="ident">server</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">digest</span><span class="op">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">digest</span><span class="op">,</span>&nbsp;<span class="ident">crypto</span><span class="op">.</span><span class="ident">MD5SHA1</span><span class="op">,</span>&nbsp;<span class="num">0</span>&nbsp;<span class="comment">/*&nbsp;not&nbsp;specified&nbsp;in&nbsp;TLS&nbsp;1.2.&nbsp;*/</span><br>
<span class="lineno"></span><span class="op">}</span>
</div>
</body>
</html>
