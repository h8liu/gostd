<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html" class="current">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6549434">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6549489">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6549543">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6549594">package</span>&nbsp;<span class="ident" id="6549602">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6549608">import</span>&nbsp;<span class="op" id="6549615">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6549618">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6549627">&#34;math&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6549635">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6549646">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6549657">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="6549667">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6549670">type</span>&nbsp;<span class="ident" id="6549675">Optionals</span>&nbsp;<span class="keyword" id="6549685">struct</span>&nbsp;<span class="op" id="6549692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549695">Sr</span>&nbsp;<span class="builtintype" id="6549698">string</span>&nbsp;<span class="string" id="6549705">`json:&#34;sr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549718">So</span>&nbsp;<span class="builtintype" id="6549721">string</span>&nbsp;<span class="string" id="6549728">`json:&#34;so,omitempty&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549751">Sw</span>&nbsp;<span class="builtintype" id="6549754">string</span>&nbsp;<span class="string" id="6549761">`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549774">Ir</span>&nbsp;<span class="builtintype" id="6549777">int</span>&nbsp;<span class="string" id="6549781">`json:&#34;omitempty&#34;`</span>&nbsp;<span class="comment" id="6549800">//&nbsp;actually&nbsp;named&nbsp;omitempty,&nbsp;not&nbsp;an&nbsp;option</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549844">Io</span>&nbsp;<span class="builtintype" id="6549847">int</span>&nbsp;<span class="string" id="6549851">`json:&#34;io,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549875">Slr</span>&nbsp;<span class="op" id="6549879">[</span><span class="op" id="6549880">]</span><span class="builtintype" id="6549881">string</span>&nbsp;<span class="string" id="6549888">`json:&#34;slr,random&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549909">Slo</span>&nbsp;<span class="op" id="6549913">[</span><span class="op" id="6549914">]</span><span class="builtintype" id="6549915">string</span>&nbsp;<span class="string" id="6549922">`json:&#34;slo,omitempty&#34;`</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549947">Mr</span>&nbsp;<span class="keyword" id="6549950">map</span><span class="op" id="6549953">[</span><span class="builtintype" id="6549954">string</span><span class="op" id="6549960">]</span><span class="keyword" id="6549961">interface</span><span class="op" id="6549970">{</span><span class="op" id="6549971">}</span>&nbsp;<span class="string" id="6549973">`json:&#34;mr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549986">Mo</span>&nbsp;<span class="keyword" id="6549989">map</span><span class="op" id="6549992">[</span><span class="builtintype" id="6549993">string</span><span class="op" id="6549999">]</span><span class="keyword" id="6550000">interface</span><span class="op" id="6550009">{</span><span class="op" id="6550010">}</span>&nbsp;<span class="string" id="6550012">`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550034">Fr</span>&nbsp;<span class="builtintype" id="6550037">float64</span>&nbsp;<span class="string" id="6550045">`json:&#34;fr&#34;`</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550058">Fo</span>&nbsp;<span class="builtintype" id="6550061">float64</span>&nbsp;<span class="string" id="6550069">`json:&#34;fo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550093">Br</span>&nbsp;<span class="builtintype" id="6550096">bool</span>&nbsp;<span class="string" id="6550101">`json:&#34;br&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550114">Bo</span>&nbsp;<span class="builtintype" id="6550117">bool</span>&nbsp;<span class="string" id="6550122">`json:&#34;bo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550146">Ur</span>&nbsp;<span class="builtintype" id="6550149">uint</span>&nbsp;<span class="string" id="6550154">`json:&#34;ur&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550167">Uo</span>&nbsp;<span class="builtintype" id="6550170">uint</span>&nbsp;<span class="string" id="6550175">`json:&#34;uo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550199">Str</span>&nbsp;<span class="keyword" id="6550203">struct</span><span class="op" id="6550209">{</span><span class="op" id="6550210">}</span>&nbsp;<span class="string" id="6550212">`json:&#34;str&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550226">Sto</span>&nbsp;<span class="keyword" id="6550230">struct</span><span class="op" id="6550236">{</span><span class="op" id="6550237">}</span>&nbsp;<span class="string" id="6550239">`json:&#34;sto,omitempty&#34;`</span><br>
<span class="lineno">40</span><span class="op" id="6550262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6550265">var</span>&nbsp;<span class="ident" id="6550269">optionalsExpected</span>&nbsp;<span class="op" id="6550287">=</span>&nbsp;<span class="string" id="6550289">`{<br>
<span class="lineno"></span>&nbsp;&#34;sr&#34;:&nbsp;&#34;&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;omitempty&#34;:&nbsp;0,<br>
<span class="lineno">45</span>&nbsp;&#34;slr&#34;:&nbsp;null,<br>
<span class="lineno"></span>&nbsp;&#34;mr&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;fr&#34;:&nbsp;0,<br>
<span class="lineno"></span>&nbsp;&#34;br&#34;:&nbsp;false,<br>
<span class="lineno"></span>&nbsp;&#34;ur&#34;:&nbsp;0,<br>
<span class="lineno">50</span>&nbsp;&#34;str&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;sto&#34;:&nbsp;{}<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6550406">func</span>&nbsp;<span class="ident" id="6550411">TestOmitEmpty</span><span class="op" id="6550424">(</span><span class="ident" id="6550425">t</span>&nbsp;<span class="op" id="6550427">*</span><span class="ident" id="6550428">testing</span><span class="op" id="6550435">.</span><span class="ident" id="6550436">T</span><span class="op" id="6550437">)</span>&nbsp;<span class="op" id="6550439">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6550442">var</span>&nbsp;<span class="ident" id="6550446">o</span>&nbsp;<span class="ident" id="6550448">Optionals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550459">o</span><span class="op" id="6550460">.</span><span class="ident" id="6550461">Sw</span>&nbsp;<span class="op" id="6550464">=</span>&nbsp;<span class="string" id="6550466">&#34;something&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550479">o</span><span class="op" id="6550480">.</span><span class="ident" id="6550481">Mr</span>&nbsp;<span class="op" id="6550484">=</span>&nbsp;<span class="keyword" id="6550486">map</span><span class="op" id="6550489">[</span><span class="builtintype" id="6550490">string</span><span class="op" id="6550496">]</span><span class="keyword" id="6550497">interface</span><span class="op" id="6550506">{</span><span class="op" id="6550507">}</span><span class="op" id="6550508">{</span><span class="op" id="6550509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550512">o</span><span class="op" id="6550513">.</span><span class="ident" id="6550514">Mo</span>&nbsp;<span class="op" id="6550517">=</span>&nbsp;<span class="keyword" id="6550519">map</span><span class="op" id="6550522">[</span><span class="builtintype" id="6550523">string</span><span class="op" id="6550529">]</span><span class="keyword" id="6550530">interface</span><span class="op" id="6550539">{</span><span class="op" id="6550540">}</span><span class="op" id="6550541">{</span><span class="op" id="6550542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550546">got</span><span class="op" id="6550549">,</span>&nbsp;<span class="ident" id="6550551">err</span>&nbsp;<span class="op" id="6550555">:=</span>&nbsp;<span class="ident" id="6550558">MarshalIndent</span><span class="op" id="6550571">(</span><span class="op" id="6550572">&amp;</span><span class="ident" id="6550573">o</span><span class="op" id="6550574">,</span>&nbsp;<span class="string" id="6550576">&#34;&#34;</span><span class="op" id="6550578">,</span>&nbsp;<span class="string" id="6550580">&#34;&nbsp;&#34;</span><span class="op" id="6550583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6550586">if</span>&nbsp;<span class="ident" id="6550589">err</span>&nbsp;<span class="op" id="6550593">!=</span>&nbsp;<span class="ident" id="6550596">nil</span>&nbsp;<span class="op" id="6550600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550604">t</span><span class="op" id="6550605">.</span><span class="ident" id="6550606">Fatal</span><span class="op" id="6550611">(</span><span class="ident" id="6550612">err</span><span class="op" id="6550615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6550618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6550621">if</span>&nbsp;<span class="ident" id="6550624">got</span>&nbsp;<span class="op" id="6550628">:=</span>&nbsp;<span class="builtintype" id="6550631">string</span><span class="op" id="6550637">(</span><span class="ident" id="6550638">got</span><span class="op" id="6550641">)</span><span class="op" id="6550642">;</span>&nbsp;<span class="ident" id="6550644">got</span>&nbsp;<span class="op" id="6550648">!=</span>&nbsp;<span class="ident" id="6550651">optionalsExpected</span>&nbsp;<span class="op" id="6550669">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550673">t</span><span class="op" id="6550674">.</span><span class="ident" id="6550675">Errorf</span><span class="op" id="6550681">(</span><span class="string" id="6550682">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="6550704">,</span>&nbsp;<span class="ident" id="6550706">got</span><span class="op" id="6550709">,</span>&nbsp;<span class="ident" id="6550711">optionalsExpected</span><span class="op" id="6550728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6550731">}</span><br>
<span class="lineno"></span><span class="op" id="6550733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6550736">type</span>&nbsp;<span class="ident" id="6550741">StringTag</span>&nbsp;<span class="keyword" id="6550751">struct</span>&nbsp;<span class="op" id="6550758">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550761">BoolStr</span>&nbsp;<span class="builtintype" id="6550769">bool</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6550776">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550794">IntStr</span>&nbsp;&nbsp;<span class="ident" id="6550802">int64</span>&nbsp;&nbsp;<span class="string" id="6550809">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550827">StrStr</span>&nbsp;&nbsp;<span class="builtintype" id="6550835">string</span>&nbsp;<span class="string" id="6550842">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="op" id="6550859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6550862">var</span>&nbsp;<span class="ident" id="6550866">stringTagExpected</span>&nbsp;<span class="op" id="6550884">=</span>&nbsp;<span class="string" id="6550886">`{<br>
<span class="lineno"></span>&nbsp;&#34;BoolStr&#34;:&nbsp;&#34;true&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;IntStr&#34;:&nbsp;&#34;42&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;StrStr&#34;:&nbsp;&#34;\&#34;xzbit\&#34;&#34;<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="6550953">func</span>&nbsp;<span class="ident" id="6550958">TestStringTag</span><span class="op" id="6550971">(</span><span class="ident" id="6550972">t</span>&nbsp;<span class="op" id="6550974">*</span><span class="ident" id="6550975">testing</span><span class="op" id="6550982">.</span><span class="ident" id="6550983">T</span><span class="op" id="6550984">)</span>&nbsp;<span class="op" id="6550986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6550989">var</span>&nbsp;<span class="ident" id="6550993">s</span>&nbsp;<span class="ident" id="6550995">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551006">s</span><span class="op" id="6551007">.</span><span class="ident" id="6551008">BoolStr</span>&nbsp;<span class="op" id="6551016">=</span>&nbsp;<span class="builtintype" id="6551018">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551024">s</span><span class="op" id="6551025">.</span><span class="ident" id="6551026">IntStr</span>&nbsp;<span class="op" id="6551033">=</span>&nbsp;<span class="num" id="6551035">42</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551039">s</span><span class="op" id="6551040">.</span><span class="ident" id="6551041">StrStr</span>&nbsp;<span class="op" id="6551048">=</span>&nbsp;<span class="string" id="6551050">&#34;xzbit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551059">got</span><span class="op" id="6551062">,</span>&nbsp;<span class="ident" id="6551064">err</span>&nbsp;<span class="op" id="6551068">:=</span>&nbsp;<span class="ident" id="6551071">MarshalIndent</span><span class="op" id="6551084">(</span><span class="op" id="6551085">&amp;</span><span class="ident" id="6551086">s</span><span class="op" id="6551087">,</span>&nbsp;<span class="string" id="6551089">&#34;&#34;</span><span class="op" id="6551091">,</span>&nbsp;<span class="string" id="6551093">&#34;&nbsp;&#34;</span><span class="op" id="6551096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551099">if</span>&nbsp;<span class="ident" id="6551102">err</span>&nbsp;<span class="op" id="6551106">!=</span>&nbsp;<span class="ident" id="6551109">nil</span>&nbsp;<span class="op" id="6551113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551117">t</span><span class="op" id="6551118">.</span><span class="ident" id="6551119">Fatal</span><span class="op" id="6551124">(</span><span class="ident" id="6551125">err</span><span class="op" id="6551128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6551131">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551134">if</span>&nbsp;<span class="ident" id="6551137">got</span>&nbsp;<span class="op" id="6551141">:=</span>&nbsp;<span class="builtintype" id="6551144">string</span><span class="op" id="6551150">(</span><span class="ident" id="6551151">got</span><span class="op" id="6551154">)</span><span class="op" id="6551155">;</span>&nbsp;<span class="ident" id="6551157">got</span>&nbsp;<span class="op" id="6551161">!=</span>&nbsp;<span class="ident" id="6551164">stringTagExpected</span>&nbsp;<span class="op" id="6551182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551186">t</span><span class="op" id="6551187">.</span><span class="ident" id="6551188">Fatalf</span><span class="op" id="6551194">(</span><span class="string" id="6551195">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="6551217">,</span>&nbsp;<span class="ident" id="6551219">got</span><span class="op" id="6551222">,</span>&nbsp;<span class="ident" id="6551224">stringTagExpected</span><span class="op" id="6551241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6551244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6551248">//&nbsp;Verify&nbsp;that&nbsp;it&nbsp;round-trips.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551280">var</span>&nbsp;<span class="ident" id="6551284">s2</span>&nbsp;<span class="ident" id="6551287">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551298">err</span>&nbsp;<span class="op" id="6551302">=</span>&nbsp;<span class="ident" id="6551304">NewDecoder</span><span class="op" id="6551314">(</span><span class="ident" id="6551315">bytes</span><span class="op" id="6551320">.</span><span class="ident" id="6551321">NewReader</span><span class="op" id="6551330">(</span><span class="ident" id="6551331">got</span><span class="op" id="6551334">)</span><span class="op" id="6551335">)</span><span class="op" id="6551336">.</span><span class="ident" id="6551337">Decode</span><span class="op" id="6551343">(</span><span class="op" id="6551344">&amp;</span><span class="ident" id="6551345">s2</span><span class="op" id="6551347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551350">if</span>&nbsp;<span class="ident" id="6551353">err</span>&nbsp;<span class="op" id="6551357">!=</span>&nbsp;<span class="ident" id="6551360">nil</span>&nbsp;<span class="op" id="6551364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551368">t</span><span class="op" id="6551369">.</span><span class="ident" id="6551370">Fatalf</span><span class="op" id="6551376">(</span><span class="string" id="6551377">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="6551389">,</span>&nbsp;<span class="ident" id="6551391">err</span><span class="op" id="6551394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6551397">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551400">if</span>&nbsp;<span class="op" id="6551403">!</span><span class="ident" id="6551404">reflect</span><span class="op" id="6551411">.</span><span class="ident" id="6551412">DeepEqual</span><span class="op" id="6551421">(</span><span class="ident" id="6551422">s</span><span class="op" id="6551423">,</span>&nbsp;<span class="ident" id="6551425">s2</span><span class="op" id="6551427">)</span>&nbsp;<span class="op" id="6551429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551433">t</span><span class="op" id="6551434">.</span><span class="ident" id="6551435">Fatalf</span><span class="op" id="6551441">(</span><span class="string" id="6551442">&#34;decode&nbsp;didn&#39;t&nbsp;match.\nsource:&nbsp;%#v\nEncoded&nbsp;as:\n%s\ndecode:&nbsp;%#v&#34;</span><span class="op" id="6551507">,</span>&nbsp;<span class="ident" id="6551509">s</span><span class="op" id="6551510">,</span>&nbsp;<span class="builtintype" id="6551512">string</span><span class="op" id="6551518">(</span><span class="ident" id="6551519">got</span><span class="op" id="6551522">)</span><span class="op" id="6551523">,</span>&nbsp;<span class="ident" id="6551525">s2</span><span class="op" id="6551527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6551530">}</span><br>
<span class="lineno"></span><span class="op" id="6551532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="6551535">//&nbsp;byte&nbsp;slices&nbsp;are&nbsp;special&nbsp;even&nbsp;if&nbsp;they&#39;re&nbsp;renamed&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="6551593">type</span>&nbsp;<span class="ident" id="6551598">renamedByte</span>&nbsp;<span class="builtintype" id="6551610">byte</span><br>
<span class="lineno"></span><span class="keyword" id="6551615">type</span>&nbsp;<span class="ident" id="6551620">renamedByteSlice</span>&nbsp;<span class="op" id="6551637">[</span><span class="op" id="6551638">]</span><span class="builtintype" id="6551639">byte</span><br>
<span class="lineno"></span><span class="keyword" id="6551644">type</span>&nbsp;<span class="ident" id="6551649">renamedRenamedByteSlice</span>&nbsp;<span class="op" id="6551673">[</span><span class="op" id="6551674">]</span><span class="ident" id="6551675">renamedByte</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6551688">func</span>&nbsp;<span class="ident" id="6551693">TestEncodeRenamedByteSlice</span><span class="op" id="6551719">(</span><span class="ident" id="6551720">t</span>&nbsp;<span class="op" id="6551722">*</span><span class="ident" id="6551723">testing</span><span class="op" id="6551730">.</span><span class="ident" id="6551731">T</span><span class="op" id="6551732">)</span>&nbsp;<span class="op" id="6551734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551737">s</span>&nbsp;<span class="op" id="6551739">:=</span>&nbsp;<span class="ident" id="6551742">renamedByteSlice</span><span class="op" id="6551758">(</span><span class="string" id="6551759">&#34;abc&#34;</span><span class="op" id="6551764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551767">result</span><span class="op" id="6551773">,</span>&nbsp;<span class="ident" id="6551775">err</span>&nbsp;<span class="op" id="6551779">:=</span>&nbsp;<span class="ident" id="6551782">Marshal</span><span class="op" id="6551789">(</span><span class="ident" id="6551790">s</span><span class="op" id="6551791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551794">if</span>&nbsp;<span class="ident" id="6551797">err</span>&nbsp;<span class="op" id="6551801">!=</span>&nbsp;<span class="ident" id="6551804">nil</span>&nbsp;<span class="op" id="6551808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551812">t</span><span class="op" id="6551813">.</span><span class="ident" id="6551814">Fatal</span><span class="op" id="6551819">(</span><span class="ident" id="6551820">err</span><span class="op" id="6551823">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6551826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551829">expect</span>&nbsp;<span class="op" id="6551836">:=</span>&nbsp;<span class="string" id="6551839">`&#34;YWJj&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551849">if</span>&nbsp;<span class="builtintype" id="6551852">string</span><span class="op" id="6551858">(</span><span class="ident" id="6551859">result</span><span class="op" id="6551865">)</span>&nbsp;<span class="op" id="6551867">!=</span>&nbsp;<span class="ident" id="6551870">expect</span>&nbsp;<span class="op" id="6551877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551881">t</span><span class="op" id="6551882">.</span><span class="ident" id="6551883">Errorf</span><span class="op" id="6551889">(</span><span class="string" id="6551890">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6551907">,</span>&nbsp;<span class="ident" id="6551909">result</span><span class="op" id="6551915">,</span>&nbsp;<span class="ident" id="6551917">expect</span><span class="op" id="6551923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6551926">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551929">r</span>&nbsp;<span class="op" id="6551931">:=</span>&nbsp;<span class="ident" id="6551934">renamedRenamedByteSlice</span><span class="op" id="6551957">(</span><span class="string" id="6551958">&#34;abc&#34;</span><span class="op" id="6551963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551966">result</span><span class="op" id="6551972">,</span>&nbsp;<span class="ident" id="6551974">err</span>&nbsp;<span class="op" id="6551978">=</span>&nbsp;<span class="ident" id="6551980">Marshal</span><span class="op" id="6551987">(</span><span class="ident" id="6551988">r</span><span class="op" id="6551989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551992">if</span>&nbsp;<span class="ident" id="6551995">err</span>&nbsp;<span class="op" id="6551999">!=</span>&nbsp;<span class="ident" id="6552002">nil</span>&nbsp;<span class="op" id="6552006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552010">t</span><span class="op" id="6552011">.</span><span class="ident" id="6552012">Fatal</span><span class="op" id="6552017">(</span><span class="ident" id="6552018">err</span><span class="op" id="6552021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552024">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6552027">if</span>&nbsp;<span class="builtintype" id="6552030">string</span><span class="op" id="6552036">(</span><span class="ident" id="6552037">result</span><span class="op" id="6552043">)</span>&nbsp;<span class="op" id="6552045">!=</span>&nbsp;<span class="ident" id="6552048">expect</span>&nbsp;<span class="op" id="6552055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552059">t</span><span class="op" id="6552060">.</span><span class="ident" id="6552061">Errorf</span><span class="op" id="6552067">(</span><span class="string" id="6552068">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6552085">,</span>&nbsp;<span class="ident" id="6552087">result</span><span class="op" id="6552093">,</span>&nbsp;<span class="ident" id="6552095">expect</span><span class="op" id="6552101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552104">}</span><br>
<span class="lineno"></span><span class="op" id="6552106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="6552109">var</span>&nbsp;<span class="ident" id="6552113">unsupportedValues</span>&nbsp;<span class="op" id="6552131">=</span>&nbsp;<span class="op" id="6552133">[</span><span class="op" id="6552134">]</span><span class="keyword" id="6552135">interface</span><span class="op" id="6552144">{</span><span class="op" id="6552145">}</span><span class="op" id="6552146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552149">math</span><span class="op" id="6552153">.</span><span class="ident" id="6552154">NaN</span><span class="op" id="6552157">(</span><span class="op" id="6552158">)</span><span class="op" id="6552159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552162">math</span><span class="op" id="6552166">.</span><span class="ident" id="6552167">Inf</span><span class="op" id="6552170">(</span><span class="op" id="6552171">-</span><span class="num" id="6552172">1</span><span class="op" id="6552173">)</span><span class="op" id="6552174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552177">math</span><span class="op" id="6552181">.</span><span class="ident" id="6552182">Inf</span><span class="op" id="6552185">(</span><span class="num" id="6552186">1</span><span class="op" id="6552187">)</span><span class="op" id="6552188">,</span><br>
<span class="lineno"></span><span class="op" id="6552190">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="6552193">func</span>&nbsp;<span class="ident" id="6552198">TestUnsupportedValues</span><span class="op" id="6552219">(</span><span class="ident" id="6552220">t</span>&nbsp;<span class="op" id="6552222">*</span><span class="ident" id="6552223">testing</span><span class="op" id="6552230">.</span><span class="ident" id="6552231">T</span><span class="op" id="6552232">)</span>&nbsp;<span class="op" id="6552234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6552237">for</span>&nbsp;<span class="ident" id="6552241">_</span><span class="op" id="6552242">,</span>&nbsp;<span class="ident" id="6552244">v</span>&nbsp;<span class="op" id="6552246">:=</span>&nbsp;<span class="keyword" id="6552249">range</span>&nbsp;<span class="ident" id="6552255">unsupportedValues</span>&nbsp;<span class="op" id="6552273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6552277">if</span>&nbsp;<span class="ident" id="6552280">_</span><span class="op" id="6552281">,</span>&nbsp;<span class="ident" id="6552283">err</span>&nbsp;<span class="op" id="6552287">:=</span>&nbsp;<span class="ident" id="6552290">Marshal</span><span class="op" id="6552297">(</span><span class="ident" id="6552298">v</span><span class="op" id="6552299">)</span><span class="op" id="6552300">;</span>&nbsp;<span class="ident" id="6552302">err</span>&nbsp;<span class="op" id="6552306">!=</span>&nbsp;<span class="ident" id="6552309">nil</span>&nbsp;<span class="op" id="6552313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6552318">if</span>&nbsp;<span class="ident" id="6552321">_</span><span class="op" id="6552322">,</span>&nbsp;<span class="ident" id="6552324">ok</span>&nbsp;<span class="op" id="6552327">:=</span>&nbsp;<span class="ident" id="6552330">err</span><span class="op" id="6552333">.</span><span class="op" id="6552334">(</span><span class="op" id="6552335">*</span><span class="ident" id="6552336">UnsupportedValueError</span><span class="op" id="6552357">)</span><span class="op" id="6552358">;</span>&nbsp;<span class="op" id="6552360">!</span><span class="ident" id="6552361">ok</span>&nbsp;<span class="op" id="6552364">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552370">t</span><span class="op" id="6552371">.</span><span class="ident" id="6552372">Errorf</span><span class="op" id="6552378">(</span><span class="string" id="6552379">&#34;for&nbsp;%v,&nbsp;got&nbsp;%T&nbsp;want&nbsp;UnsupportedValueError&#34;</span><span class="op" id="6552422">,</span>&nbsp;<span class="ident" id="6552424">v</span><span class="op" id="6552425">,</span>&nbsp;<span class="ident" id="6552427">err</span><span class="op" id="6552430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552439">}</span>&nbsp;<span class="keyword" id="6552441">else</span>&nbsp;<span class="op" id="6552446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552451">t</span><span class="op" id="6552452">.</span><span class="ident" id="6552453">Errorf</span><span class="op" id="6552459">(</span><span class="string" id="6552460">&#34;for&nbsp;%v,&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6552484">,</span>&nbsp;<span class="ident" id="6552486">v</span><span class="op" id="6552487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552491">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552494">}</span><br>
<span class="lineno"></span><span class="op" id="6552496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6552499">//&nbsp;Ref&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="6552567">type</span>&nbsp;<span class="ident" id="6552572">Ref</span>&nbsp;<span class="builtintype" id="6552576">int</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="6552581">func</span>&nbsp;<span class="op" id="6552586">(</span><span class="op" id="6552587">*</span><span class="ident" id="6552588">Ref</span><span class="op" id="6552591">)</span>&nbsp;<span class="ident" id="6552593">MarshalJSON</span><span class="op" id="6552604">(</span><span class="op" id="6552605">)</span>&nbsp;<span class="op" id="6552607">(</span><span class="op" id="6552608">[</span><span class="op" id="6552609">]</span><span class="builtintype" id="6552610">byte</span><span class="op" id="6552614">,</span>&nbsp;<span class="builtintype" id="6552616">error</span><span class="op" id="6552621">)</span>&nbsp;<span class="op" id="6552623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6552626">return</span>&nbsp;<span class="op" id="6552633">[</span><span class="op" id="6552634">]</span><span class="builtintype" id="6552635">byte</span><span class="op" id="6552639">(</span><span class="string" id="6552640">`&#34;ref&#34;`</span><span class="op" id="6552647">)</span><span class="op" id="6552648">,</span>&nbsp;<span class="ident" id="6552650">nil</span><br>
<span class="lineno"></span><span class="op" id="6552654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="6552657">func</span>&nbsp;<span class="op" id="6552662">(</span><span class="ident" id="6552663">r</span>&nbsp;<span class="op" id="6552665">*</span><span class="ident" id="6552666">Ref</span><span class="op" id="6552669">)</span>&nbsp;<span class="ident" id="6552671">UnmarshalJSON</span><span class="op" id="6552684">(</span><span class="op" id="6552685">[</span><span class="op" id="6552686">]</span><span class="builtintype" id="6552687">byte</span><span class="op" id="6552691">)</span>&nbsp;<span class="builtintype" id="6552693">error</span>&nbsp;<span class="op" id="6552699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552702">*</span><span class="ident" id="6552703">r</span>&nbsp;<span class="op" id="6552705">=</span>&nbsp;<span class="num" id="6552707">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6552711">return</span>&nbsp;<span class="ident" id="6552718">nil</span><br>
<span class="lineno"></span><span class="op" id="6552722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6552725">//&nbsp;Val&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="6552775">type</span>&nbsp;<span class="ident" id="6552780">Val</span>&nbsp;<span class="builtintype" id="6552784">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6552789">func</span>&nbsp;<span class="op" id="6552794">(</span><span class="ident" id="6552795">Val</span><span class="op" id="6552798">)</span>&nbsp;<span class="ident" id="6552800">MarshalJSON</span><span class="op" id="6552811">(</span><span class="op" id="6552812">)</span>&nbsp;<span class="op" id="6552814">(</span><span class="op" id="6552815">[</span><span class="op" id="6552816">]</span><span class="builtintype" id="6552817">byte</span><span class="op" id="6552821">,</span>&nbsp;<span class="builtintype" id="6552823">error</span><span class="op" id="6552828">)</span>&nbsp;<span class="op" id="6552830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6552833">return</span>&nbsp;<span class="op" id="6552840">[</span><span class="op" id="6552841">]</span><span class="builtintype" id="6552842">byte</span><span class="op" id="6552846">(</span><span class="string" id="6552847">`&#34;val&#34;`</span><span class="op" id="6552854">)</span><span class="op" id="6552855">,</span>&nbsp;<span class="ident" id="6552857">nil</span><br>
<span class="lineno">165</span><span class="op" id="6552861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6552864">//&nbsp;RefText&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="6552936">type</span>&nbsp;<span class="ident" id="6552941">RefText</span>&nbsp;<span class="builtintype" id="6552949">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="6552954">func</span>&nbsp;<span class="op" id="6552959">(</span><span class="op" id="6552960">*</span><span class="ident" id="6552961">RefText</span><span class="op" id="6552968">)</span>&nbsp;<span class="ident" id="6552970">MarshalText</span><span class="op" id="6552981">(</span><span class="op" id="6552982">)</span>&nbsp;<span class="op" id="6552984">(</span><span class="op" id="6552985">[</span><span class="op" id="6552986">]</span><span class="builtintype" id="6552987">byte</span><span class="op" id="6552991">,</span>&nbsp;<span class="builtintype" id="6552993">error</span><span class="op" id="6552998">)</span>&nbsp;<span class="op" id="6553000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553003">return</span>&nbsp;<span class="op" id="6553010">[</span><span class="op" id="6553011">]</span><span class="builtintype" id="6553012">byte</span><span class="op" id="6553016">(</span><span class="string" id="6553017">`&#34;ref&#34;`</span><span class="op" id="6553024">)</span><span class="op" id="6553025">,</span>&nbsp;<span class="ident" id="6553027">nil</span><br>
<span class="lineno"></span><span class="op" id="6553031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6553034">func</span>&nbsp;<span class="op" id="6553039">(</span><span class="ident" id="6553040">r</span>&nbsp;<span class="op" id="6553042">*</span><span class="ident" id="6553043">RefText</span><span class="op" id="6553050">)</span>&nbsp;<span class="ident" id="6553052">UnmarshalText</span><span class="op" id="6553065">(</span><span class="op" id="6553066">[</span><span class="op" id="6553067">]</span><span class="builtintype" id="6553068">byte</span><span class="op" id="6553072">)</span>&nbsp;<span class="builtintype" id="6553074">error</span>&nbsp;<span class="op" id="6553080">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6553083">*</span><span class="ident" id="6553084">r</span>&nbsp;<span class="op" id="6553086">=</span>&nbsp;<span class="num" id="6553088">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553092">return</span>&nbsp;<span class="ident" id="6553099">nil</span><br>
<span class="lineno"></span><span class="op" id="6553103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6553106">//&nbsp;ValText&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno">180</span><span class="keyword" id="6553160">type</span>&nbsp;<span class="ident" id="6553165">ValText</span>&nbsp;<span class="builtintype" id="6553173">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6553178">func</span>&nbsp;<span class="op" id="6553183">(</span><span class="ident" id="6553184">ValText</span><span class="op" id="6553191">)</span>&nbsp;<span class="ident" id="6553193">MarshalText</span><span class="op" id="6553204">(</span><span class="op" id="6553205">)</span>&nbsp;<span class="op" id="6553207">(</span><span class="op" id="6553208">[</span><span class="op" id="6553209">]</span><span class="builtintype" id="6553210">byte</span><span class="op" id="6553214">,</span>&nbsp;<span class="builtintype" id="6553216">error</span><span class="op" id="6553221">)</span>&nbsp;<span class="op" id="6553223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553226">return</span>&nbsp;<span class="op" id="6553233">[</span><span class="op" id="6553234">]</span><span class="builtintype" id="6553235">byte</span><span class="op" id="6553239">(</span><span class="string" id="6553240">`&#34;val&#34;`</span><span class="op" id="6553247">)</span><span class="op" id="6553248">,</span>&nbsp;<span class="ident" id="6553250">nil</span><br>
<span class="lineno"></span><span class="op" id="6553254">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="6553257">func</span>&nbsp;<span class="ident" id="6553262">TestRefValMarshal</span><span class="op" id="6553279">(</span><span class="ident" id="6553280">t</span>&nbsp;<span class="op" id="6553282">*</span><span class="ident" id="6553283">testing</span><span class="op" id="6553290">.</span><span class="ident" id="6553291">T</span><span class="op" id="6553292">)</span>&nbsp;<span class="op" id="6553294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553297">var</span>&nbsp;<span class="ident" id="6553301">s</span>&nbsp;<span class="op" id="6553303">=</span>&nbsp;<span class="keyword" id="6553305">struct</span>&nbsp;<span class="op" id="6553312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553316">R0</span>&nbsp;<span class="ident" id="6553319">Ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553325">R1</span>&nbsp;<span class="op" id="6553328">*</span><span class="ident" id="6553329">Ref</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553335">R2</span>&nbsp;<span class="ident" id="6553338">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553348">R3</span>&nbsp;<span class="op" id="6553351">*</span><span class="ident" id="6553352">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553362">V0</span>&nbsp;<span class="ident" id="6553365">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553371">V1</span>&nbsp;<span class="op" id="6553374">*</span><span class="ident" id="6553375">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553381">V2</span>&nbsp;<span class="ident" id="6553384">ValText</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553394">V3</span>&nbsp;<span class="op" id="6553397">*</span><span class="ident" id="6553398">ValText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6553407">}</span><span class="op" id="6553408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553412">R0</span><span class="op" id="6553414">:</span>&nbsp;<span class="num" id="6553416">12</span><span class="op" id="6553418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553422">R1</span><span class="op" id="6553424">:</span>&nbsp;<span class="builtinfunc" id="6553426">new</span><span class="op" id="6553429">(</span><span class="ident" id="6553430">Ref</span><span class="op" id="6553433">)</span><span class="op" id="6553434">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553438">R2</span><span class="op" id="6553440">:</span>&nbsp;<span class="num" id="6553442">14</span><span class="op" id="6553444">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553448">R3</span><span class="op" id="6553450">:</span>&nbsp;<span class="builtinfunc" id="6553452">new</span><span class="op" id="6553455">(</span><span class="ident" id="6553456">RefText</span><span class="op" id="6553463">)</span><span class="op" id="6553464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553468">V0</span><span class="op" id="6553470">:</span>&nbsp;<span class="num" id="6553472">13</span><span class="op" id="6553474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553478">V1</span><span class="op" id="6553480">:</span>&nbsp;<span class="builtinfunc" id="6553482">new</span><span class="op" id="6553485">(</span><span class="ident" id="6553486">Val</span><span class="op" id="6553489">)</span><span class="op" id="6553490">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553494">V2</span><span class="op" id="6553496">:</span>&nbsp;<span class="num" id="6553498">15</span><span class="op" id="6553500">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553504">V3</span><span class="op" id="6553506">:</span>&nbsp;<span class="builtinfunc" id="6553508">new</span><span class="op" id="6553511">(</span><span class="ident" id="6553512">ValText</span><span class="op" id="6553519">)</span><span class="op" id="6553520">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6553523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553526">const</span>&nbsp;<span class="ident" id="6553532">want</span>&nbsp;<span class="op" id="6553537">=</span>&nbsp;<span class="string" id="6553539">`{&#34;R0&#34;:&#34;ref&#34;,&#34;R1&#34;:&#34;ref&#34;,&#34;R2&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;R3&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;V0&#34;:&#34;val&#34;,&#34;V1&#34;:&#34;val&#34;,&#34;V2&#34;:&#34;\&#34;val\&#34;&#34;,&#34;V3&#34;:&#34;\&#34;val\&#34;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553648">b</span><span class="op" id="6553649">,</span>&nbsp;<span class="ident" id="6553651">err</span>&nbsp;<span class="op" id="6553655">:=</span>&nbsp;<span class="ident" id="6553658">Marshal</span><span class="op" id="6553665">(</span><span class="op" id="6553666">&amp;</span><span class="ident" id="6553667">s</span><span class="op" id="6553668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553671">if</span>&nbsp;<span class="ident" id="6553674">err</span>&nbsp;<span class="op" id="6553678">!=</span>&nbsp;<span class="ident" id="6553681">nil</span>&nbsp;<span class="op" id="6553685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553689">t</span><span class="op" id="6553690">.</span><span class="ident" id="6553691">Fatalf</span><span class="op" id="6553697">(</span><span class="string" id="6553698">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="6553711">,</span>&nbsp;<span class="ident" id="6553713">err</span><span class="op" id="6553716">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6553719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553722">if</span>&nbsp;<span class="ident" id="6553725">got</span>&nbsp;<span class="op" id="6553729">:=</span>&nbsp;<span class="builtintype" id="6553732">string</span><span class="op" id="6553738">(</span><span class="ident" id="6553739">b</span><span class="op" id="6553740">)</span><span class="op" id="6553741">;</span>&nbsp;<span class="ident" id="6553743">got</span>&nbsp;<span class="op" id="6553747">!=</span>&nbsp;<span class="ident" id="6553750">want</span>&nbsp;<span class="op" id="6553755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553759">t</span><span class="op" id="6553760">.</span><span class="ident" id="6553761">Errorf</span><span class="op" id="6553767">(</span><span class="string" id="6553768">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6553785">,</span>&nbsp;<span class="ident" id="6553787">got</span><span class="op" id="6553790">,</span>&nbsp;<span class="ident" id="6553792">want</span><span class="op" id="6553796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6553799">}</span><br>
<span class="lineno"></span><span class="op" id="6553801">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="6553804">//&nbsp;C&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="6553858">type</span>&nbsp;<span class="ident" id="6553863">C</span>&nbsp;<span class="builtintype" id="6553865">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6553870">func</span>&nbsp;<span class="op" id="6553875">(</span><span class="ident" id="6553876">C</span><span class="op" id="6553877">)</span>&nbsp;<span class="ident" id="6553879">MarshalJSON</span><span class="op" id="6553890">(</span><span class="op" id="6553891">)</span>&nbsp;<span class="op" id="6553893">(</span><span class="op" id="6553894">[</span><span class="op" id="6553895">]</span><span class="builtintype" id="6553896">byte</span><span class="op" id="6553900">,</span>&nbsp;<span class="builtintype" id="6553902">error</span><span class="op" id="6553907">)</span>&nbsp;<span class="op" id="6553909">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553912">return</span>&nbsp;<span class="op" id="6553919">[</span><span class="op" id="6553920">]</span><span class="builtintype" id="6553921">byte</span><span class="op" id="6553925">(</span><span class="string" id="6553926">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="6553933">)</span><span class="op" id="6553934">,</span>&nbsp;<span class="ident" id="6553936">nil</span><br>
<span class="lineno"></span><span class="op" id="6553940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6553943">//&nbsp;CText&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="6554001">type</span>&nbsp;<span class="ident" id="6554006">CText</span>&nbsp;<span class="builtintype" id="6554012">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="6554017">func</span>&nbsp;<span class="op" id="6554022">(</span><span class="ident" id="6554023">CText</span><span class="op" id="6554028">)</span>&nbsp;<span class="ident" id="6554030">MarshalText</span><span class="op" id="6554041">(</span><span class="op" id="6554042">)</span>&nbsp;<span class="op" id="6554044">(</span><span class="op" id="6554045">[</span><span class="op" id="6554046">]</span><span class="builtintype" id="6554047">byte</span><span class="op" id="6554051">,</span>&nbsp;<span class="builtintype" id="6554053">error</span><span class="op" id="6554058">)</span>&nbsp;<span class="op" id="6554060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554063">return</span>&nbsp;<span class="op" id="6554070">[</span><span class="op" id="6554071">]</span><span class="builtintype" id="6554072">byte</span><span class="op" id="6554076">(</span><span class="string" id="6554077">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="6554084">)</span><span class="op" id="6554085">,</span>&nbsp;<span class="ident" id="6554087">nil</span><br>
<span class="lineno"></span><span class="op" id="6554091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6554094">func</span>&nbsp;<span class="ident" id="6554099">TestMarshalerEscaping</span><span class="op" id="6554120">(</span><span class="ident" id="6554121">t</span>&nbsp;<span class="op" id="6554123">*</span><span class="ident" id="6554124">testing</span><span class="op" id="6554131">.</span><span class="ident" id="6554132">T</span><span class="op" id="6554133">)</span>&nbsp;<span class="op" id="6554135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554138">var</span>&nbsp;<span class="ident" id="6554142">c</span>&nbsp;<span class="ident" id="6554144">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554147">want</span>&nbsp;<span class="op" id="6554152">:=</span>&nbsp;<span class="string" id="6554155">`&#34;\u003c\u0026\u003e&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554179">b</span><span class="op" id="6554180">,</span>&nbsp;<span class="ident" id="6554182">err</span>&nbsp;<span class="op" id="6554186">:=</span>&nbsp;<span class="ident" id="6554189">Marshal</span><span class="op" id="6554196">(</span><span class="ident" id="6554197">c</span><span class="op" id="6554198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554201">if</span>&nbsp;<span class="ident" id="6554204">err</span>&nbsp;<span class="op" id="6554208">!=</span>&nbsp;<span class="ident" id="6554211">nil</span>&nbsp;<span class="op" id="6554215">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554219">t</span><span class="op" id="6554220">.</span><span class="ident" id="6554221">Fatalf</span><span class="op" id="6554227">(</span><span class="string" id="6554228">&#34;Marshal(c):&nbsp;%v&#34;</span><span class="op" id="6554244">,</span>&nbsp;<span class="ident" id="6554246">err</span><span class="op" id="6554249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6554252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554255">if</span>&nbsp;<span class="ident" id="6554258">got</span>&nbsp;<span class="op" id="6554262">:=</span>&nbsp;<span class="builtintype" id="6554265">string</span><span class="op" id="6554271">(</span><span class="ident" id="6554272">b</span><span class="op" id="6554273">)</span><span class="op" id="6554274">;</span>&nbsp;<span class="ident" id="6554276">got</span>&nbsp;<span class="op" id="6554280">!=</span>&nbsp;<span class="ident" id="6554283">want</span>&nbsp;<span class="op" id="6554288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554292">t</span><span class="op" id="6554293">.</span><span class="ident" id="6554294">Errorf</span><span class="op" id="6554300">(</span><span class="string" id="6554301">&#34;Marshal(c)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6554329">,</span>&nbsp;<span class="ident" id="6554331">got</span><span class="op" id="6554334">,</span>&nbsp;<span class="ident" id="6554336">want</span><span class="op" id="6554340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6554343">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554347">var</span>&nbsp;<span class="ident" id="6554351">ct</span>&nbsp;<span class="ident" id="6554354">CText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554361">want</span>&nbsp;<span class="op" id="6554366">=</span>&nbsp;<span class="string" id="6554368">`&#34;\&#34;\u003c\u0026\u003e\&#34;&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554396">b</span><span class="op" id="6554397">,</span>&nbsp;<span class="ident" id="6554399">err</span>&nbsp;<span class="op" id="6554403">=</span>&nbsp;<span class="ident" id="6554405">Marshal</span><span class="op" id="6554412">(</span><span class="ident" id="6554413">ct</span><span class="op" id="6554415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554418">if</span>&nbsp;<span class="ident" id="6554421">err</span>&nbsp;<span class="op" id="6554425">!=</span>&nbsp;<span class="ident" id="6554428">nil</span>&nbsp;<span class="op" id="6554432">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554436">t</span><span class="op" id="6554437">.</span><span class="ident" id="6554438">Fatalf</span><span class="op" id="6554444">(</span><span class="string" id="6554445">&#34;Marshal(ct):&nbsp;%v&#34;</span><span class="op" id="6554462">,</span>&nbsp;<span class="ident" id="6554464">err</span><span class="op" id="6554467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6554470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554473">if</span>&nbsp;<span class="ident" id="6554476">got</span>&nbsp;<span class="op" id="6554480">:=</span>&nbsp;<span class="builtintype" id="6554483">string</span><span class="op" id="6554489">(</span><span class="ident" id="6554490">b</span><span class="op" id="6554491">)</span><span class="op" id="6554492">;</span>&nbsp;<span class="ident" id="6554494">got</span>&nbsp;<span class="op" id="6554498">!=</span>&nbsp;<span class="ident" id="6554501">want</span>&nbsp;<span class="op" id="6554506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554510">t</span><span class="op" id="6554511">.</span><span class="ident" id="6554512">Errorf</span><span class="op" id="6554518">(</span><span class="string" id="6554519">&#34;Marshal(ct)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6554548">,</span>&nbsp;<span class="ident" id="6554550">got</span><span class="op" id="6554553">,</span>&nbsp;<span class="ident" id="6554555">want</span><span class="op" id="6554559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6554562">}</span><br>
<span class="lineno">250</span><span class="op" id="6554564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6554567">type</span>&nbsp;<span class="ident" id="6554572">IntType</span>&nbsp;<span class="builtintype" id="6554580">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6554585">type</span>&nbsp;<span class="ident" id="6554590">MyStruct</span>&nbsp;<span class="keyword" id="6554599">struct</span>&nbsp;<span class="op" id="6554606">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554609">IntType</span><br>
<span class="lineno"></span><span class="op" id="6554617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6554620">func</span>&nbsp;<span class="ident" id="6554625">TestAnonymousNonstruct</span><span class="op" id="6554647">(</span><span class="ident" id="6554648">t</span>&nbsp;<span class="op" id="6554650">*</span><span class="ident" id="6554651">testing</span><span class="op" id="6554658">.</span><span class="ident" id="6554659">T</span><span class="op" id="6554660">)</span>&nbsp;<span class="op" id="6554662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554665">var</span>&nbsp;<span class="ident" id="6554669">i</span>&nbsp;<span class="ident" id="6554671">IntType</span>&nbsp;<span class="op" id="6554679">=</span>&nbsp;<span class="num" id="6554681">11</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554685">a</span>&nbsp;<span class="op" id="6554687">:=</span>&nbsp;<span class="ident" id="6554690">MyStruct</span><span class="op" id="6554698">{</span><span class="ident" id="6554699">i</span><span class="op" id="6554700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554703">const</span>&nbsp;<span class="ident" id="6554709">want</span>&nbsp;<span class="op" id="6554714">=</span>&nbsp;<span class="string" id="6554716">`{&#34;IntType&#34;:11}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554735">b</span><span class="op" id="6554736">,</span>&nbsp;<span class="ident" id="6554738">err</span>&nbsp;<span class="op" id="6554742">:=</span>&nbsp;<span class="ident" id="6554745">Marshal</span><span class="op" id="6554752">(</span><span class="ident" id="6554753">a</span><span class="op" id="6554754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554757">if</span>&nbsp;<span class="ident" id="6554760">err</span>&nbsp;<span class="op" id="6554764">!=</span>&nbsp;<span class="ident" id="6554767">nil</span>&nbsp;<span class="op" id="6554771">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554775">t</span><span class="op" id="6554776">.</span><span class="ident" id="6554777">Fatalf</span><span class="op" id="6554783">(</span><span class="string" id="6554784">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="6554797">,</span>&nbsp;<span class="ident" id="6554799">err</span><span class="op" id="6554802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6554805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6554808">if</span>&nbsp;<span class="ident" id="6554811">got</span>&nbsp;<span class="op" id="6554815">:=</span>&nbsp;<span class="builtintype" id="6554818">string</span><span class="op" id="6554824">(</span><span class="ident" id="6554825">b</span><span class="op" id="6554826">)</span><span class="op" id="6554827">;</span>&nbsp;<span class="ident" id="6554829">got</span>&nbsp;<span class="op" id="6554833">!=</span>&nbsp;<span class="ident" id="6554836">want</span>&nbsp;<span class="op" id="6554841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554845">t</span><span class="op" id="6554846">.</span><span class="ident" id="6554847">Errorf</span><span class="op" id="6554853">(</span><span class="string" id="6554854">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6554871">,</span>&nbsp;<span class="ident" id="6554873">got</span><span class="op" id="6554876">,</span>&nbsp;<span class="ident" id="6554878">want</span><span class="op" id="6554882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6554885">}</span><br>
<span class="lineno">270</span><span class="op" id="6554887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6554890">type</span>&nbsp;<span class="ident" id="6554895">BugA</span>&nbsp;<span class="keyword" id="6554900">struct</span>&nbsp;<span class="op" id="6554907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554910">S</span>&nbsp;<span class="builtintype" id="6554912">string</span><br>
<span class="lineno"></span><span class="op" id="6554919">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="6554922">type</span>&nbsp;<span class="ident" id="6554927">BugB</span>&nbsp;<span class="keyword" id="6554932">struct</span>&nbsp;<span class="op" id="6554939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554942">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554948">S</span>&nbsp;<span class="builtintype" id="6554950">string</span><br>
<span class="lineno"></span><span class="op" id="6554957">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="6554960">type</span>&nbsp;<span class="ident" id="6554965">BugC</span>&nbsp;<span class="keyword" id="6554970">struct</span>&nbsp;<span class="op" id="6554977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554980">S</span>&nbsp;<span class="builtintype" id="6554982">string</span><br>
<span class="lineno"></span><span class="op" id="6554989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="6554992">//&nbsp;Legal&nbsp;Go:&nbsp;We&nbsp;never&nbsp;use&nbsp;the&nbsp;repeated&nbsp;embedded&nbsp;field&nbsp;(S).</span><br>
<span class="lineno"></span><span class="keyword" id="6555051">type</span>&nbsp;<span class="ident" id="6555056">BugX</span>&nbsp;<span class="keyword" id="6555061">struct</span>&nbsp;<span class="op" id="6555068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555071">A</span>&nbsp;<span class="builtintype" id="6555073">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555078">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555084">BugB</span><br>
<span class="lineno">290</span><span class="op" id="6555089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6555092">//&nbsp;Issue&nbsp;5245.</span><br>
<span class="lineno"></span><span class="keyword" id="6555107">func</span>&nbsp;<span class="ident" id="6555112">TestEmbeddedBug</span><span class="op" id="6555127">(</span><span class="ident" id="6555128">t</span>&nbsp;<span class="op" id="6555130">*</span><span class="ident" id="6555131">testing</span><span class="op" id="6555138">.</span><span class="ident" id="6555139">T</span><span class="op" id="6555140">)</span>&nbsp;<span class="op" id="6555142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555145">v</span>&nbsp;<span class="op" id="6555147">:=</span>&nbsp;<span class="ident" id="6555150">BugB</span><span class="op" id="6555154">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555158">BugA</span><span class="op" id="6555162">{</span><span class="string" id="6555163">&#34;A&#34;</span><span class="op" id="6555166">}</span><span class="op" id="6555167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6555171">&#34;B&#34;</span><span class="op" id="6555174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6555177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555180">b</span><span class="op" id="6555181">,</span>&nbsp;<span class="ident" id="6555183">err</span>&nbsp;<span class="op" id="6555187">:=</span>&nbsp;<span class="ident" id="6555190">Marshal</span><span class="op" id="6555197">(</span><span class="ident" id="6555198">v</span><span class="op" id="6555199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6555202">if</span>&nbsp;<span class="ident" id="6555205">err</span>&nbsp;<span class="op" id="6555209">!=</span>&nbsp;<span class="ident" id="6555212">nil</span>&nbsp;<span class="op" id="6555216">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555220">t</span><span class="op" id="6555221">.</span><span class="ident" id="6555222">Fatal</span><span class="op" id="6555227">(</span><span class="string" id="6555228">&#34;Marshal:&#34;</span><span class="op" id="6555238">,</span>&nbsp;<span class="ident" id="6555240">err</span><span class="op" id="6555243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6555246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555249">want</span>&nbsp;<span class="op" id="6555254">:=</span>&nbsp;<span class="string" id="6555257">`{&#34;S&#34;:&#34;B&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555270">got</span>&nbsp;<span class="op" id="6555274">:=</span>&nbsp;<span class="builtintype" id="6555277">string</span><span class="op" id="6555283">(</span><span class="ident" id="6555284">b</span><span class="op" id="6555285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6555288">if</span>&nbsp;<span class="ident" id="6555291">got</span>&nbsp;<span class="op" id="6555295">!=</span>&nbsp;<span class="ident" id="6555298">want</span>&nbsp;<span class="op" id="6555303">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555307">t</span><span class="op" id="6555308">.</span><span class="ident" id="6555309">Fatalf</span><span class="op" id="6555315">(</span><span class="string" id="6555316">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6555341">,</span>&nbsp;<span class="ident" id="6555343">got</span><span class="op" id="6555346">,</span>&nbsp;<span class="ident" id="6555348">want</span><span class="op" id="6555352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6555355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6555358">//&nbsp;Now&nbsp;check&nbsp;that&nbsp;the&nbsp;duplicate&nbsp;field,&nbsp;S,&nbsp;does&nbsp;not&nbsp;appear.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555418">x</span>&nbsp;<span class="op" id="6555420">:=</span>&nbsp;<span class="ident" id="6555423">BugX</span><span class="op" id="6555427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555431">A</span><span class="op" id="6555432">:</span>&nbsp;<span class="num" id="6555434">23</span><span class="op" id="6555436">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6555439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555442">b</span><span class="op" id="6555443">,</span>&nbsp;<span class="ident" id="6555445">err</span>&nbsp;<span class="op" id="6555449">=</span>&nbsp;<span class="ident" id="6555451">Marshal</span><span class="op" id="6555458">(</span><span class="ident" id="6555459">x</span><span class="op" id="6555460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6555463">if</span>&nbsp;<span class="ident" id="6555466">err</span>&nbsp;<span class="op" id="6555470">!=</span>&nbsp;<span class="ident" id="6555473">nil</span>&nbsp;<span class="op" id="6555477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555481">t</span><span class="op" id="6555482">.</span><span class="ident" id="6555483">Fatal</span><span class="op" id="6555488">(</span><span class="string" id="6555489">&#34;Marshal:&#34;</span><span class="op" id="6555499">,</span>&nbsp;<span class="ident" id="6555501">err</span><span class="op" id="6555504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6555507">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555510">want</span>&nbsp;<span class="op" id="6555515">=</span>&nbsp;<span class="string" id="6555517">`{&#34;A&#34;:23}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555529">got</span>&nbsp;<span class="op" id="6555533">=</span>&nbsp;<span class="builtintype" id="6555535">string</span><span class="op" id="6555541">(</span><span class="ident" id="6555542">b</span><span class="op" id="6555543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6555546">if</span>&nbsp;<span class="ident" id="6555549">got</span>&nbsp;<span class="op" id="6555553">!=</span>&nbsp;<span class="ident" id="6555556">want</span>&nbsp;<span class="op" id="6555561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555565">t</span><span class="op" id="6555566">.</span><span class="ident" id="6555567">Fatalf</span><span class="op" id="6555573">(</span><span class="string" id="6555574">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6555599">,</span>&nbsp;<span class="ident" id="6555601">got</span><span class="op" id="6555604">,</span>&nbsp;<span class="ident" id="6555606">want</span><span class="op" id="6555610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6555613">}</span><br>
<span class="lineno">320</span><span class="op" id="6555615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6555618">type</span>&nbsp;<span class="ident" id="6555623">BugD</span>&nbsp;<span class="keyword" id="6555628">struct</span>&nbsp;<span class="op" id="6555635">{</span>&nbsp;<span class="comment" id="6555637">//&nbsp;Same&nbsp;as&nbsp;BugA&nbsp;after&nbsp;tagging.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555669">XXX</span>&nbsp;<span class="builtintype" id="6555673">string</span>&nbsp;<span class="string" id="6555680">`json:&#34;S&#34;`</span><br>
<span class="lineno"></span><span class="op" id="6555691">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="6555694">//&nbsp;BugD&#39;s&nbsp;tagged&nbsp;S&nbsp;field&nbsp;should&nbsp;dominate&nbsp;BugA&#39;s.</span><br>
<span class="lineno"></span><span class="keyword" id="6555743">type</span>&nbsp;<span class="ident" id="6555748">BugY</span>&nbsp;<span class="keyword" id="6555753">struct</span>&nbsp;<span class="op" id="6555760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555763">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555769">BugD</span><br>
<span class="lineno">330</span><span class="op" id="6555774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6555777">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;dominates&nbsp;untagged&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="6555836">func</span>&nbsp;<span class="ident" id="6555841">TestTaggedFieldDominates</span><span class="op" id="6555865">(</span><span class="ident" id="6555866">t</span>&nbsp;<span class="op" id="6555868">*</span><span class="ident" id="6555869">testing</span><span class="op" id="6555876">.</span><span class="ident" id="6555877">T</span><span class="op" id="6555878">)</span>&nbsp;<span class="op" id="6555880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555883">v</span>&nbsp;<span class="op" id="6555885">:=</span>&nbsp;<span class="ident" id="6555888">BugY</span><span class="op" id="6555892">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555896">BugA</span><span class="op" id="6555900">{</span><span class="string" id="6555901">&#34;BugA&#34;</span><span class="op" id="6555907">}</span><span class="op" id="6555908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555912">BugD</span><span class="op" id="6555916">{</span><span class="string" id="6555917">&#34;BugD&#34;</span><span class="op" id="6555923">}</span><span class="op" id="6555924">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6555927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555930">b</span><span class="op" id="6555931">,</span>&nbsp;<span class="ident" id="6555933">err</span>&nbsp;<span class="op" id="6555937">:=</span>&nbsp;<span class="ident" id="6555940">Marshal</span><span class="op" id="6555947">(</span><span class="ident" id="6555948">v</span><span class="op" id="6555949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6555952">if</span>&nbsp;<span class="ident" id="6555955">err</span>&nbsp;<span class="op" id="6555959">!=</span>&nbsp;<span class="ident" id="6555962">nil</span>&nbsp;<span class="op" id="6555966">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555970">t</span><span class="op" id="6555971">.</span><span class="ident" id="6555972">Fatal</span><span class="op" id="6555977">(</span><span class="string" id="6555978">&#34;Marshal:&#34;</span><span class="op" id="6555988">,</span>&nbsp;<span class="ident" id="6555990">err</span><span class="op" id="6555993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6555996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6555999">want</span>&nbsp;<span class="op" id="6556004">:=</span>&nbsp;<span class="string" id="6556007">`{&#34;S&#34;:&#34;BugD&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556023">got</span>&nbsp;<span class="op" id="6556027">:=</span>&nbsp;<span class="builtintype" id="6556030">string</span><span class="op" id="6556036">(</span><span class="ident" id="6556037">b</span><span class="op" id="6556038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6556041">if</span>&nbsp;<span class="ident" id="6556044">got</span>&nbsp;<span class="op" id="6556048">!=</span>&nbsp;<span class="ident" id="6556051">want</span>&nbsp;<span class="op" id="6556056">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556060">t</span><span class="op" id="6556061">.</span><span class="ident" id="6556062">Fatalf</span><span class="op" id="6556068">(</span><span class="string" id="6556069">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6556094">,</span>&nbsp;<span class="ident" id="6556096">got</span><span class="op" id="6556099">,</span>&nbsp;<span class="ident" id="6556101">want</span><span class="op" id="6556105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6556108">}</span><br>
<span class="lineno"></span><span class="op" id="6556110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6556113">//&nbsp;There&nbsp;are&nbsp;no&nbsp;tags&nbsp;here,&nbsp;so&nbsp;S&nbsp;should&nbsp;not&nbsp;appear.</span><br>
<span class="lineno">350</span><span class="keyword" id="6556164">type</span>&nbsp;<span class="ident" id="6556169">BugZ</span>&nbsp;<span class="keyword" id="6556174">struct</span>&nbsp;<span class="op" id="6556181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556184">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556190">BugC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556196">BugY</span>&nbsp;<span class="comment" id="6556201">//&nbsp;Contains&nbsp;a&nbsp;tagged&nbsp;S&nbsp;field&nbsp;through&nbsp;BugD;&nbsp;should&nbsp;not&nbsp;dominate.</span><br>
<span class="lineno"></span><span class="op" id="6556265">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="6556268">func</span>&nbsp;<span class="ident" id="6556273">TestDuplicatedFieldDisappears</span><span class="op" id="6556302">(</span><span class="ident" id="6556303">t</span>&nbsp;<span class="op" id="6556305">*</span><span class="ident" id="6556306">testing</span><span class="op" id="6556313">.</span><span class="ident" id="6556314">T</span><span class="op" id="6556315">)</span>&nbsp;<span class="op" id="6556317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556320">v</span>&nbsp;<span class="op" id="6556322">:=</span>&nbsp;<span class="ident" id="6556325">BugZ</span><span class="op" id="6556329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556333">BugA</span><span class="op" id="6556337">{</span><span class="string" id="6556338">&#34;BugA&#34;</span><span class="op" id="6556344">}</span><span class="op" id="6556345">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556349">BugC</span><span class="op" id="6556353">{</span><span class="string" id="6556354">&#34;BugC&#34;</span><span class="op" id="6556360">}</span><span class="op" id="6556361">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556365">BugY</span><span class="op" id="6556369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556374">BugA</span><span class="op" id="6556378">{</span><span class="string" id="6556379">&#34;nested&nbsp;BugA&#34;</span><span class="op" id="6556392">}</span><span class="op" id="6556393">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556398">BugD</span><span class="op" id="6556402">{</span><span class="string" id="6556403">&#34;nested&nbsp;BugD&#34;</span><span class="op" id="6556416">}</span><span class="op" id="6556417">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6556421">}</span><span class="op" id="6556422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6556425">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556428">b</span><span class="op" id="6556429">,</span>&nbsp;<span class="ident" id="6556431">err</span>&nbsp;<span class="op" id="6556435">:=</span>&nbsp;<span class="ident" id="6556438">Marshal</span><span class="op" id="6556445">(</span><span class="ident" id="6556446">v</span><span class="op" id="6556447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6556450">if</span>&nbsp;<span class="ident" id="6556453">err</span>&nbsp;<span class="op" id="6556457">!=</span>&nbsp;<span class="ident" id="6556460">nil</span>&nbsp;<span class="op" id="6556464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556468">t</span><span class="op" id="6556469">.</span><span class="ident" id="6556470">Fatal</span><span class="op" id="6556475">(</span><span class="string" id="6556476">&#34;Marshal:&#34;</span><span class="op" id="6556486">,</span>&nbsp;<span class="ident" id="6556488">err</span><span class="op" id="6556491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6556494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556497">want</span>&nbsp;<span class="op" id="6556502">:=</span>&nbsp;<span class="string" id="6556505">`{}`</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556511">got</span>&nbsp;<span class="op" id="6556515">:=</span>&nbsp;<span class="builtintype" id="6556518">string</span><span class="op" id="6556524">(</span><span class="ident" id="6556525">b</span><span class="op" id="6556526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6556529">if</span>&nbsp;<span class="ident" id="6556532">got</span>&nbsp;<span class="op" id="6556536">!=</span>&nbsp;<span class="ident" id="6556539">want</span>&nbsp;<span class="op" id="6556544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556548">t</span><span class="op" id="6556549">.</span><span class="ident" id="6556550">Fatalf</span><span class="op" id="6556556">(</span><span class="string" id="6556557">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6556582">,</span>&nbsp;<span class="ident" id="6556584">got</span><span class="op" id="6556587">,</span>&nbsp;<span class="ident" id="6556589">want</span><span class="op" id="6556593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6556596">}</span><br>
<span class="lineno"></span><span class="op" id="6556598">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="6556601">func</span>&nbsp;<span class="ident" id="6556606">TestStringBytes</span><span class="op" id="6556621">(</span><span class="ident" id="6556622">t</span>&nbsp;<span class="op" id="6556624">*</span><span class="ident" id="6556625">testing</span><span class="op" id="6556632">.</span><span class="ident" id="6556633">T</span><span class="op" id="6556634">)</span>&nbsp;<span class="op" id="6556636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6556639">//&nbsp;Test&nbsp;that&nbsp;encodeState.stringBytes&nbsp;and&nbsp;encodeState.string&nbsp;use&nbsp;the&nbsp;same&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556723">es</span>&nbsp;<span class="op" id="6556726">:=</span>&nbsp;<span class="op" id="6556729">&amp;</span><span class="ident" id="6556730">encodeState</span><span class="op" id="6556741">{</span><span class="op" id="6556742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6556745">var</span>&nbsp;<span class="ident" id="6556749">r</span>&nbsp;<span class="op" id="6556751">[</span><span class="op" id="6556752">]</span><span class="builtintype" id="6556753">rune</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6556759">for</span>&nbsp;<span class="ident" id="6556763">i</span>&nbsp;<span class="op" id="6556765">:=</span>&nbsp;<span class="string" id="6556768">&#39;\u0000&#39;</span><span class="op" id="6556776">;</span>&nbsp;<span class="ident" id="6556778">i</span>&nbsp;<span class="op" id="6556780">&lt;=</span>&nbsp;<span class="ident" id="6556783">unicode</span><span class="op" id="6556790">.</span><span class="ident" id="6556791">MaxRune</span><span class="op" id="6556798">;</span>&nbsp;<span class="ident" id="6556800">i</span><span class="op" id="6556801">++</span>&nbsp;<span class="op" id="6556804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556808">r</span>&nbsp;<span class="op" id="6556810">=</span>&nbsp;<span class="builtinfunc" id="6556812">append</span><span class="op" id="6556818">(</span><span class="ident" id="6556819">r</span><span class="op" id="6556820">,</span>&nbsp;<span class="ident" id="6556822">i</span><span class="op" id="6556823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6556826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556829">s</span>&nbsp;<span class="op" id="6556831">:=</span>&nbsp;<span class="builtintype" id="6556834">string</span><span class="op" id="6556840">(</span><span class="ident" id="6556841">r</span><span class="op" id="6556842">)</span>&nbsp;<span class="op" id="6556844">+</span>&nbsp;<span class="string" id="6556846">&#34;\xff\xff\xffhello&#34;</span>&nbsp;<span class="comment" id="6556866">//&nbsp;some&nbsp;invalid&nbsp;UTF-8&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556893">_</span><span class="op" id="6556894">,</span>&nbsp;<span class="ident" id="6556896">err</span>&nbsp;<span class="op" id="6556900">:=</span>&nbsp;<span class="ident" id="6556903">es</span><span class="op" id="6556905">.</span><span class="builtintype" id="6556906">string</span><span class="op" id="6556912">(</span><span class="ident" id="6556913">s</span><span class="op" id="6556914">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6556917">if</span>&nbsp;<span class="ident" id="6556920">err</span>&nbsp;<span class="op" id="6556924">!=</span>&nbsp;<span class="ident" id="6556927">nil</span>&nbsp;<span class="op" id="6556931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556935">t</span><span class="op" id="6556936">.</span><span class="ident" id="6556937">Fatal</span><span class="op" id="6556942">(</span><span class="ident" id="6556943">err</span><span class="op" id="6556946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6556949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556953">esBytes</span>&nbsp;<span class="op" id="6556961">:=</span>&nbsp;<span class="op" id="6556964">&amp;</span><span class="ident" id="6556965">encodeState</span><span class="op" id="6556976">{</span><span class="op" id="6556977">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6556980">_</span><span class="op" id="6556981">,</span>&nbsp;<span class="ident" id="6556983">err</span>&nbsp;<span class="op" id="6556987">=</span>&nbsp;<span class="ident" id="6556989">esBytes</span><span class="op" id="6556996">.</span><span class="ident" id="6556997">stringBytes</span><span class="op" id="6557008">(</span><span class="op" id="6557009">[</span><span class="op" id="6557010">]</span><span class="builtintype" id="6557011">byte</span><span class="op" id="6557015">(</span><span class="ident" id="6557016">s</span><span class="op" id="6557017">)</span><span class="op" id="6557018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6557021">if</span>&nbsp;<span class="ident" id="6557024">err</span>&nbsp;<span class="op" id="6557028">!=</span>&nbsp;<span class="ident" id="6557031">nil</span>&nbsp;<span class="op" id="6557035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557039">t</span><span class="op" id="6557040">.</span><span class="ident" id="6557041">Fatal</span><span class="op" id="6557046">(</span><span class="ident" id="6557047">err</span><span class="op" id="6557050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6557053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557057">enc</span>&nbsp;<span class="op" id="6557061">:=</span>&nbsp;<span class="ident" id="6557064">es</span><span class="op" id="6557066">.</span><span class="ident" id="6557067">Buffer</span><span class="op" id="6557073">.</span><span class="ident" id="6557074">String</span><span class="op" id="6557080">(</span><span class="op" id="6557081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557084">encBytes</span>&nbsp;<span class="op" id="6557093">:=</span>&nbsp;<span class="ident" id="6557096">esBytes</span><span class="op" id="6557103">.</span><span class="ident" id="6557104">Buffer</span><span class="op" id="6557110">.</span><span class="ident" id="6557111">String</span><span class="op" id="6557117">(</span><span class="op" id="6557118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6557121">if</span>&nbsp;<span class="ident" id="6557124">enc</span>&nbsp;<span class="op" id="6557128">!=</span>&nbsp;<span class="ident" id="6557131">encBytes</span>&nbsp;<span class="op" id="6557140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557144">i</span>&nbsp;<span class="op" id="6557146">:=</span>&nbsp;<span class="num" id="6557149">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6557153">for</span>&nbsp;<span class="ident" id="6557157">i</span>&nbsp;<span class="op" id="6557159">&lt;</span>&nbsp;<span class="builtinfunc" id="6557161">len</span><span class="op" id="6557164">(</span><span class="ident" id="6557165">enc</span><span class="op" id="6557168">)</span>&nbsp;<span class="op" id="6557170">&amp;&amp;</span>&nbsp;<span class="ident" id="6557173">i</span>&nbsp;<span class="op" id="6557175">&lt;</span>&nbsp;<span class="builtinfunc" id="6557177">len</span><span class="op" id="6557180">(</span><span class="ident" id="6557181">encBytes</span><span class="op" id="6557189">)</span>&nbsp;<span class="op" id="6557191">&amp;&amp;</span>&nbsp;<span class="ident" id="6557194">enc</span><span class="op" id="6557197">[</span><span class="ident" id="6557198">i</span><span class="op" id="6557199">]</span>&nbsp;<span class="op" id="6557201">==</span>&nbsp;<span class="ident" id="6557204">encBytes</span><span class="op" id="6557212">[</span><span class="ident" id="6557213">i</span><span class="op" id="6557214">]</span>&nbsp;<span class="op" id="6557216">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557221">i</span><span class="op" id="6557222">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6557227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557231">enc</span>&nbsp;<span class="op" id="6557235">=</span>&nbsp;<span class="ident" id="6557237">enc</span><span class="op" id="6557240">[</span><span class="ident" id="6557241">i</span><span class="op" id="6557242">:</span><span class="op" id="6557243">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557247">encBytes</span>&nbsp;<span class="op" id="6557256">=</span>&nbsp;<span class="ident" id="6557258">encBytes</span><span class="op" id="6557266">[</span><span class="ident" id="6557267">i</span><span class="op" id="6557268">:</span><span class="op" id="6557269">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557273">i</span>&nbsp;<span class="op" id="6557275">=</span>&nbsp;<span class="num" id="6557277">0</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6557281">for</span>&nbsp;<span class="ident" id="6557285">i</span>&nbsp;<span class="op" id="6557287">&lt;</span>&nbsp;<span class="builtinfunc" id="6557289">len</span><span class="op" id="6557292">(</span><span class="ident" id="6557293">enc</span><span class="op" id="6557296">)</span>&nbsp;<span class="op" id="6557298">&amp;&amp;</span>&nbsp;<span class="ident" id="6557301">i</span>&nbsp;<span class="op" id="6557303">&lt;</span>&nbsp;<span class="builtinfunc" id="6557305">len</span><span class="op" id="6557308">(</span><span class="ident" id="6557309">encBytes</span><span class="op" id="6557317">)</span>&nbsp;<span class="op" id="6557319">&amp;&amp;</span>&nbsp;<span class="ident" id="6557322">enc</span><span class="op" id="6557325">[</span><span class="builtinfunc" id="6557326">len</span><span class="op" id="6557329">(</span><span class="ident" id="6557330">enc</span><span class="op" id="6557333">)</span><span class="op" id="6557334">-</span><span class="ident" id="6557335">i</span><span class="op" id="6557336">-</span><span class="num" id="6557337">1</span><span class="op" id="6557338">]</span>&nbsp;<span class="op" id="6557340">==</span>&nbsp;<span class="ident" id="6557343">encBytes</span><span class="op" id="6557351">[</span><span class="builtinfunc" id="6557352">len</span><span class="op" id="6557355">(</span><span class="ident" id="6557356">encBytes</span><span class="op" id="6557364">)</span><span class="op" id="6557365">-</span><span class="ident" id="6557366">i</span><span class="op" id="6557367">-</span><span class="num" id="6557368">1</span><span class="op" id="6557369">]</span>&nbsp;<span class="op" id="6557371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557376">i</span><span class="op" id="6557377">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6557382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557386">enc</span>&nbsp;<span class="op" id="6557390">=</span>&nbsp;<span class="ident" id="6557392">enc</span><span class="op" id="6557395">[</span><span class="op" id="6557396">:</span><span class="builtinfunc" id="6557397">len</span><span class="op" id="6557400">(</span><span class="ident" id="6557401">enc</span><span class="op" id="6557404">)</span><span class="op" id="6557405">-</span><span class="ident" id="6557406">i</span><span class="op" id="6557407">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557411">encBytes</span>&nbsp;<span class="op" id="6557420">=</span>&nbsp;<span class="ident" id="6557422">encBytes</span><span class="op" id="6557430">[</span><span class="op" id="6557431">:</span><span class="builtinfunc" id="6557432">len</span><span class="op" id="6557435">(</span><span class="ident" id="6557436">encBytes</span><span class="op" id="6557444">)</span><span class="op" id="6557445">-</span><span class="ident" id="6557446">i</span><span class="op" id="6557447">]</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6557452">if</span>&nbsp;<span class="builtinfunc" id="6557455">len</span><span class="op" id="6557458">(</span><span class="ident" id="6557459">enc</span><span class="op" id="6557462">)</span>&nbsp;<span class="op" id="6557464">&gt;</span>&nbsp;<span class="num" id="6557466">20</span>&nbsp;<span class="op" id="6557469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557474">enc</span>&nbsp;<span class="op" id="6557478">=</span>&nbsp;<span class="ident" id="6557480">enc</span><span class="op" id="6557483">[</span><span class="op" id="6557484">:</span><span class="num" id="6557485">20</span><span class="op" id="6557487">]</span>&nbsp;<span class="op" id="6557489">+</span>&nbsp;<span class="string" id="6557491">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6557499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6557503">if</span>&nbsp;<span class="builtinfunc" id="6557506">len</span><span class="op" id="6557509">(</span><span class="ident" id="6557510">encBytes</span><span class="op" id="6557518">)</span>&nbsp;<span class="op" id="6557520">&gt;</span>&nbsp;<span class="num" id="6557522">20</span>&nbsp;<span class="op" id="6557525">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557530">encBytes</span>&nbsp;<span class="op" id="6557539">=</span>&nbsp;<span class="ident" id="6557541">encBytes</span><span class="op" id="6557549">[</span><span class="op" id="6557550">:</span><span class="num" id="6557551">20</span><span class="op" id="6557553">]</span>&nbsp;<span class="op" id="6557555">+</span>&nbsp;<span class="string" id="6557557">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6557565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557570">t</span><span class="op" id="6557571">.</span><span class="ident" id="6557572">Errorf</span><span class="op" id="6557578">(</span><span class="string" id="6557579">&#34;encodings&nbsp;differ&nbsp;at&nbsp;%#q&nbsp;vs&nbsp;%#q&#34;</span><span class="op" id="6557611">,</span>&nbsp;<span class="ident" id="6557613">enc</span><span class="op" id="6557616">,</span>&nbsp;<span class="ident" id="6557618">encBytes</span><span class="op" id="6557626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6557629">}</span><br>
<span class="lineno">420</span><span class="op" id="6557631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6557634">func</span>&nbsp;<span class="ident" id="6557639">TestIssue6458</span><span class="op" id="6557652">(</span><span class="ident" id="6557653">t</span>&nbsp;<span class="op" id="6557655">*</span><span class="ident" id="6557656">testing</span><span class="op" id="6557663">.</span><span class="ident" id="6557664">T</span><span class="op" id="6557665">)</span>&nbsp;<span class="op" id="6557667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6557670">type</span>&nbsp;<span class="ident" id="6557675">Foo</span>&nbsp;<span class="keyword" id="6557679">struct</span>&nbsp;<span class="op" id="6557686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557690">M</span>&nbsp;<span class="ident" id="6557692">RawMessage</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6557704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557707">x</span>&nbsp;<span class="op" id="6557709">:=</span>&nbsp;<span class="ident" id="6557712">Foo</span><span class="op" id="6557715">{</span><span class="ident" id="6557716">RawMessage</span><span class="op" id="6557726">(</span><span class="string" id="6557727">`&#34;foo&#34;`</span><span class="op" id="6557734">)</span><span class="op" id="6557735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557739">b</span><span class="op" id="6557740">,</span>&nbsp;<span class="ident" id="6557742">err</span>&nbsp;<span class="op" id="6557746">:=</span>&nbsp;<span class="ident" id="6557749">Marshal</span><span class="op" id="6557756">(</span><span class="op" id="6557757">&amp;</span><span class="ident" id="6557758">x</span><span class="op" id="6557759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6557762">if</span>&nbsp;<span class="ident" id="6557765">err</span>&nbsp;<span class="op" id="6557769">!=</span>&nbsp;<span class="ident" id="6557772">nil</span>&nbsp;<span class="op" id="6557776">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557780">t</span><span class="op" id="6557781">.</span><span class="ident" id="6557782">Fatal</span><span class="op" id="6557787">(</span><span class="ident" id="6557788">err</span><span class="op" id="6557791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6557794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6557797">if</span>&nbsp;<span class="ident" id="6557800">want</span>&nbsp;<span class="op" id="6557805">:=</span>&nbsp;<span class="string" id="6557808">`{&#34;M&#34;:&#34;foo&#34;}`</span><span class="op" id="6557821">;</span>&nbsp;<span class="builtintype" id="6557823">string</span><span class="op" id="6557829">(</span><span class="ident" id="6557830">b</span><span class="op" id="6557831">)</span>&nbsp;<span class="op" id="6557833">!=</span>&nbsp;<span class="ident" id="6557836">want</span>&nbsp;<span class="op" id="6557841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557845">t</span><span class="op" id="6557846">.</span><span class="ident" id="6557847">Errorf</span><span class="op" id="6557853">(</span><span class="string" id="6557854">&#34;Marshal(&amp;x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6557883">,</span>&nbsp;<span class="ident" id="6557885">b</span><span class="op" id="6557886">,</span>&nbsp;<span class="ident" id="6557888">want</span><span class="op" id="6557892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6557895">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557899">b</span><span class="op" id="6557900">,</span>&nbsp;<span class="ident" id="6557902">err</span>&nbsp;<span class="op" id="6557906">=</span>&nbsp;<span class="ident" id="6557908">Marshal</span><span class="op" id="6557915">(</span><span class="ident" id="6557916">x</span><span class="op" id="6557917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6557920">if</span>&nbsp;<span class="ident" id="6557923">err</span>&nbsp;<span class="op" id="6557927">!=</span>&nbsp;<span class="ident" id="6557930">nil</span>&nbsp;<span class="op" id="6557934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6557938">t</span><span class="op" id="6557939">.</span><span class="ident" id="6557940">Fatal</span><span class="op" id="6557945">(</span><span class="ident" id="6557946">err</span><span class="op" id="6557949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6557952">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6557956">if</span>&nbsp;<span class="ident" id="6557959">want</span>&nbsp;<span class="op" id="6557964">:=</span>&nbsp;<span class="string" id="6557967">`{&#34;M&#34;:&#34;ImZvbyI=&#34;}`</span><span class="op" id="6557985">;</span>&nbsp;<span class="builtintype" id="6557987">string</span><span class="op" id="6557993">(</span><span class="ident" id="6557994">b</span><span class="op" id="6557995">)</span>&nbsp;<span class="op" id="6557997">!=</span>&nbsp;<span class="ident" id="6558000">want</span>&nbsp;<span class="op" id="6558005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6558009">t</span><span class="op" id="6558010">.</span><span class="ident" id="6558011">Errorf</span><span class="op" id="6558017">(</span><span class="string" id="6558018">&#34;Marshal(x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6558046">,</span>&nbsp;<span class="ident" id="6558048">b</span><span class="op" id="6558049">,</span>&nbsp;<span class="ident" id="6558051">want</span><span class="op" id="6558055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6558058">}</span><br>
<span class="lineno"></span><span class="op" id="6558060">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="6558063">func</span>&nbsp;<span class="ident" id="6558068">TestHTMLEscape</span><span class="op" id="6558082">(</span><span class="ident" id="6558083">t</span>&nbsp;<span class="op" id="6558085">*</span><span class="ident" id="6558086">testing</span><span class="op" id="6558093">.</span><span class="ident" id="6558094">T</span><span class="op" id="6558095">)</span>&nbsp;<span class="op" id="6558097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6558100">var</span>&nbsp;<span class="ident" id="6558104">b</span><span class="op" id="6558105">,</span>&nbsp;<span class="ident" id="6558107">want</span>&nbsp;<span class="ident" id="6558112">bytes</span><span class="op" id="6558117">.</span><span class="ident" id="6558118">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6558126">m</span>&nbsp;<span class="op" id="6558128">:=</span>&nbsp;<span class="string" id="6558131">`{&#34;M&#34;:&#34;&lt;html&gt;foo&nbsp;&amp;`</span>&nbsp;<span class="op" id="6558151">+</span>&nbsp;<span class="string" id="6558153">&#34;\xe2\x80\xa8&nbsp;\xe2\x80\xa9&#34;</span>&nbsp;<span class="op" id="6558181">+</span>&nbsp;<span class="string" id="6558183">`&lt;/html&gt;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6558196">want</span><span class="op" id="6558200">.</span><span class="ident" id="6558201">Write</span><span class="op" id="6558206">(</span><span class="op" id="6558207">[</span><span class="op" id="6558208">]</span><span class="builtintype" id="6558209">byte</span><span class="op" id="6558213">(</span><span class="string" id="6558214">`{&#34;M&#34;:&#34;\u003chtml\u003efoo&nbsp;\u0026\u2028&nbsp;\u2029\u003c/html\u003e&#34;}`</span><span class="op" id="6558280">)</span><span class="op" id="6558281">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6558284">HTMLEscape</span><span class="op" id="6558294">(</span><span class="op" id="6558295">&amp;</span><span class="ident" id="6558296">b</span><span class="op" id="6558297">,</span>&nbsp;<span class="op" id="6558299">[</span><span class="op" id="6558300">]</span><span class="builtintype" id="6558301">byte</span><span class="op" id="6558305">(</span><span class="ident" id="6558306">m</span><span class="op" id="6558307">)</span><span class="op" id="6558308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6558311">if</span>&nbsp;<span class="op" id="6558314">!</span><span class="ident" id="6558315">bytes</span><span class="op" id="6558320">.</span><span class="ident" id="6558321">Equal</span><span class="op" id="6558326">(</span><span class="ident" id="6558327">b</span><span class="op" id="6558328">.</span><span class="ident" id="6558329">Bytes</span><span class="op" id="6558334">(</span><span class="op" id="6558335">)</span><span class="op" id="6558336">,</span>&nbsp;<span class="ident" id="6558338">want</span><span class="op" id="6558342">.</span><span class="ident" id="6558343">Bytes</span><span class="op" id="6558348">(</span><span class="op" id="6558349">)</span><span class="op" id="6558350">)</span>&nbsp;<span class="op" id="6558352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6558356">t</span><span class="op" id="6558357">.</span><span class="ident" id="6558358">Errorf</span><span class="op" id="6558364">(</span><span class="string" id="6558365">&#34;HTMLEscape(&amp;b,&nbsp;[]byte(m))&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6558406">,</span>&nbsp;<span class="ident" id="6558408">b</span><span class="op" id="6558409">.</span><span class="ident" id="6558410">Bytes</span><span class="op" id="6558415">(</span><span class="op" id="6558416">)</span><span class="op" id="6558417">,</span>&nbsp;<span class="ident" id="6558419">want</span><span class="op" id="6558423">.</span><span class="ident" id="6558424">Bytes</span><span class="op" id="6558429">(</span><span class="op" id="6558430">)</span><span class="op" id="6558431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6558434">}</span><br>
<span class="lineno"></span><span class="op" id="6558436">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="6558439">//&nbsp;golang.org/issue/8582</span><br>
<span class="lineno"></span><span class="keyword" id="6558464">func</span>&nbsp;<span class="ident" id="6558469">TestEncodePointerString</span><span class="op" id="6558492">(</span><span class="ident" id="6558493">t</span>&nbsp;<span class="op" id="6558495">*</span><span class="ident" id="6558496">testing</span><span class="op" id="6558503">.</span><span class="ident" id="6558504">T</span><span class="op" id="6558505">)</span>&nbsp;<span class="op" id="6558507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6558510">type</span>&nbsp;<span class="ident" id="6558515">stringPointer</span>&nbsp;<span class="keyword" id="6558529">struct</span>&nbsp;<span class="op" id="6558536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6558540">N</span>&nbsp;<span class="op" id="6558542">*</span><span class="ident" id="6558543">int64</span>&nbsp;<span class="string" id="6558549">`json:&#34;n,string&#34;`</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6558568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6558571">var</span>&nbsp;<span class="ident" id="6558575">n</span>&nbsp;<span class="ident" id="6558577">int64</span>&nbsp;<span class="op" id="6558583">=</span>&nbsp;<span class="num" id="6558585">42</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6558589">b</span><span class="op" id="6558590">,</span>&nbsp;<span class="ident" id="6558592">err</span>&nbsp;<span class="op" id="6558596">:=</span>&nbsp;<span class="ident" id="6558599">Marshal</span><span class="op" id="6558606">(</span><span class="ident" id="6558607">stringPointer</span><span class="op" id="6558620">{</span><span class="ident" id="6558621">N</span><span class="op" id="6558622">:</span>&nbsp;<span class="op" id="6558624">&amp;</span><span class="ident" id="6558625">n</span><span class="op" id="6558626">}</span><span class="op" id="6558627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6558630">if</span>&nbsp;<span class="ident" id="6558633">err</span>&nbsp;<span class="op" id="6558637">!=</span>&nbsp;<span class="ident" id="6558640">nil</span>&nbsp;<span class="op" id="6558644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6558648">t</span><span class="op" id="6558649">.</span><span class="ident" id="6558650">Fatalf</span><span class="op" id="6558656">(</span><span class="string" id="6558657">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="6558670">,</span>&nbsp;<span class="ident" id="6558672">err</span><span class="op" id="6558675">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6558678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6558681">if</span>&nbsp;<span class="ident" id="6558684">got</span><span class="op" id="6558687">,</span>&nbsp;<span class="ident" id="6558689">want</span>&nbsp;<span class="op" id="6558694">:=</span>&nbsp;<span class="builtintype" id="6558697">string</span><span class="op" id="6558703">(</span><span class="ident" id="6558704">b</span><span class="op" id="6558705">)</span><span class="op" id="6558706">,</span>&nbsp;<span class="string" id="6558708">`{&#34;n&#34;:&#34;42&#34;}`</span><span class="op" id="6558720">;</span>&nbsp;<span class="ident" id="6558722">got</span>&nbsp;<span class="op" id="6558726">!=</span>&nbsp;<span class="ident" id="6558729">want</span>&nbsp;<span class="op" id="6558734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6558738">t</span><span class="op" id="6558739">.</span><span class="ident" id="6558740">Errorf</span><span class="op" id="6558746">(</span><span class="string" id="6558747">&#34;Marshal&nbsp;=&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6558770">,</span>&nbsp;<span class="ident" id="6558772">got</span><span class="op" id="6558775">,</span>&nbsp;<span class="ident" id="6558777">want</span><span class="op" id="6558781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6558784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6558787">var</span>&nbsp;<span class="ident" id="6558791">back</span>&nbsp;<span class="ident" id="6558796">stringPointer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6558811">err</span>&nbsp;<span class="op" id="6558815">=</span>&nbsp;<span class="ident" id="6558817">Unmarshal</span><span class="op" id="6558826">(</span><span class="ident" id="6558827">b</span><span class="op" id="6558828">,</span>&nbsp;<span class="op" id="6558830">&amp;</span><span class="ident" id="6558831">back</span><span class="op" id="6558835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6558838">if</span>&nbsp;<span class="ident" id="6558841">err</span>&nbsp;<span class="op" id="6558845">!=</span>&nbsp;<span class="ident" id="6558848">nil</span>&nbsp;<span class="op" id="6558852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6558856">t</span><span class="op" id="6558857">.</span><span class="ident" id="6558858">Fatalf</span><span class="op" id="6558864">(</span><span class="string" id="6558865">&#34;Unmarshal:&nbsp;%v&#34;</span><span class="op" id="6558880">,</span>&nbsp;<span class="ident" id="6558882">err</span><span class="op" id="6558885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6558888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6558891">if</span>&nbsp;<span class="ident" id="6558894">back</span><span class="op" id="6558898">.</span><span class="ident" id="6558899">N</span>&nbsp;<span class="op" id="6558901">==</span>&nbsp;<span class="ident" id="6558904">nil</span>&nbsp;<span class="op" id="6558908">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6558912">t</span><span class="op" id="6558913">.</span><span class="ident" id="6558914">Fatalf</span><span class="op" id="6558920">(</span><span class="string" id="6558921">&#34;Unmarshalled&nbsp;nil&nbsp;N&nbsp;field&#34;</span><span class="op" id="6558947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6558950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6558953">if</span>&nbsp;<span class="op" id="6558956">*</span><span class="ident" id="6558957">back</span><span class="op" id="6558961">.</span><span class="ident" id="6558962">N</span>&nbsp;<span class="op" id="6558964">!=</span>&nbsp;<span class="num" id="6558967">42</span>&nbsp;<span class="op" id="6558970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6558974">t</span><span class="op" id="6558975">.</span><span class="ident" id="6558976">Fatalf</span><span class="op" id="6558982">(</span><span class="string" id="6558983">&#34;*N&nbsp;=&nbsp;%d;&nbsp;want&nbsp;42&#34;</span><span class="op" id="6559001">,</span>&nbsp;<span class="op" id="6559003">*</span><span class="ident" id="6559004">back</span><span class="op" id="6559008">.</span><span class="ident" id="6559009">N</span><span class="op" id="6559010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559013">}</span><br>
<span class="lineno">480</span><span class="op" id="6559015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6559018">var</span>&nbsp;<span class="ident" id="6559022">encodeStringTests</span>&nbsp;<span class="op" id="6559040">=</span>&nbsp;<span class="op" id="6559042">[</span><span class="op" id="6559043">]</span><span class="keyword" id="6559044">struct</span>&nbsp;<span class="op" id="6559051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6559054">in</span>&nbsp;&nbsp;<span class="builtintype" id="6559058">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6559066">out</span>&nbsp;<span class="builtintype" id="6559070">string</span><br>
<span class="lineno">485</span><span class="op" id="6559077">}</span><span class="op" id="6559078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559081">{</span><span class="string" id="6559082">&#34;\x00&#34;</span><span class="op" id="6559088">,</span>&nbsp;<span class="string" id="6559090">`&#34;\u0000&#34;`</span><span class="op" id="6559100">}</span><span class="op" id="6559101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559104">{</span><span class="string" id="6559105">&#34;\x01&#34;</span><span class="op" id="6559111">,</span>&nbsp;<span class="string" id="6559113">`&#34;\u0001&#34;`</span><span class="op" id="6559123">}</span><span class="op" id="6559124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559127">{</span><span class="string" id="6559128">&#34;\x02&#34;</span><span class="op" id="6559134">,</span>&nbsp;<span class="string" id="6559136">`&#34;\u0002&#34;`</span><span class="op" id="6559146">}</span><span class="op" id="6559147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559150">{</span><span class="string" id="6559151">&#34;\x03&#34;</span><span class="op" id="6559157">,</span>&nbsp;<span class="string" id="6559159">`&#34;\u0003&#34;`</span><span class="op" id="6559169">}</span><span class="op" id="6559170">,</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559173">{</span><span class="string" id="6559174">&#34;\x04&#34;</span><span class="op" id="6559180">,</span>&nbsp;<span class="string" id="6559182">`&#34;\u0004&#34;`</span><span class="op" id="6559192">}</span><span class="op" id="6559193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559196">{</span><span class="string" id="6559197">&#34;\x05&#34;</span><span class="op" id="6559203">,</span>&nbsp;<span class="string" id="6559205">`&#34;\u0005&#34;`</span><span class="op" id="6559215">}</span><span class="op" id="6559216">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559219">{</span><span class="string" id="6559220">&#34;\x06&#34;</span><span class="op" id="6559226">,</span>&nbsp;<span class="string" id="6559228">`&#34;\u0006&#34;`</span><span class="op" id="6559238">}</span><span class="op" id="6559239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559242">{</span><span class="string" id="6559243">&#34;\x07&#34;</span><span class="op" id="6559249">,</span>&nbsp;<span class="string" id="6559251">`&#34;\u0007&#34;`</span><span class="op" id="6559261">}</span><span class="op" id="6559262">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559265">{</span><span class="string" id="6559266">&#34;\x08&#34;</span><span class="op" id="6559272">,</span>&nbsp;<span class="string" id="6559274">`&#34;\u0008&#34;`</span><span class="op" id="6559284">}</span><span class="op" id="6559285">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559288">{</span><span class="string" id="6559289">&#34;\x09&#34;</span><span class="op" id="6559295">,</span>&nbsp;<span class="string" id="6559297">`&#34;\t&#34;`</span><span class="op" id="6559303">}</span><span class="op" id="6559304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559307">{</span><span class="string" id="6559308">&#34;\x0a&#34;</span><span class="op" id="6559314">,</span>&nbsp;<span class="string" id="6559316">`&#34;\n&#34;`</span><span class="op" id="6559322">}</span><span class="op" id="6559323">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559326">{</span><span class="string" id="6559327">&#34;\x0b&#34;</span><span class="op" id="6559333">,</span>&nbsp;<span class="string" id="6559335">`&#34;\u000b&#34;`</span><span class="op" id="6559345">}</span><span class="op" id="6559346">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559349">{</span><span class="string" id="6559350">&#34;\x0c&#34;</span><span class="op" id="6559356">,</span>&nbsp;<span class="string" id="6559358">`&#34;\u000c&#34;`</span><span class="op" id="6559368">}</span><span class="op" id="6559369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559372">{</span><span class="string" id="6559373">&#34;\x0d&#34;</span><span class="op" id="6559379">,</span>&nbsp;<span class="string" id="6559381">`&#34;\r&#34;`</span><span class="op" id="6559387">}</span><span class="op" id="6559388">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559391">{</span><span class="string" id="6559392">&#34;\x0e&#34;</span><span class="op" id="6559398">,</span>&nbsp;<span class="string" id="6559400">`&#34;\u000e&#34;`</span><span class="op" id="6559410">}</span><span class="op" id="6559411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559414">{</span><span class="string" id="6559415">&#34;\x0f&#34;</span><span class="op" id="6559421">,</span>&nbsp;<span class="string" id="6559423">`&#34;\u000f&#34;`</span><span class="op" id="6559433">}</span><span class="op" id="6559434">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559437">{</span><span class="string" id="6559438">&#34;\x10&#34;</span><span class="op" id="6559444">,</span>&nbsp;<span class="string" id="6559446">`&#34;\u0010&#34;`</span><span class="op" id="6559456">}</span><span class="op" id="6559457">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559460">{</span><span class="string" id="6559461">&#34;\x11&#34;</span><span class="op" id="6559467">,</span>&nbsp;<span class="string" id="6559469">`&#34;\u0011&#34;`</span><span class="op" id="6559479">}</span><span class="op" id="6559480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559483">{</span><span class="string" id="6559484">&#34;\x12&#34;</span><span class="op" id="6559490">,</span>&nbsp;<span class="string" id="6559492">`&#34;\u0012&#34;`</span><span class="op" id="6559502">}</span><span class="op" id="6559503">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559506">{</span><span class="string" id="6559507">&#34;\x13&#34;</span><span class="op" id="6559513">,</span>&nbsp;<span class="string" id="6559515">`&#34;\u0013&#34;`</span><span class="op" id="6559525">}</span><span class="op" id="6559526">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559529">{</span><span class="string" id="6559530">&#34;\x14&#34;</span><span class="op" id="6559536">,</span>&nbsp;<span class="string" id="6559538">`&#34;\u0014&#34;`</span><span class="op" id="6559548">}</span><span class="op" id="6559549">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559552">{</span><span class="string" id="6559553">&#34;\x15&#34;</span><span class="op" id="6559559">,</span>&nbsp;<span class="string" id="6559561">`&#34;\u0015&#34;`</span><span class="op" id="6559571">}</span><span class="op" id="6559572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559575">{</span><span class="string" id="6559576">&#34;\x16&#34;</span><span class="op" id="6559582">,</span>&nbsp;<span class="string" id="6559584">`&#34;\u0016&#34;`</span><span class="op" id="6559594">}</span><span class="op" id="6559595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559598">{</span><span class="string" id="6559599">&#34;\x17&#34;</span><span class="op" id="6559605">,</span>&nbsp;<span class="string" id="6559607">`&#34;\u0017&#34;`</span><span class="op" id="6559617">}</span><span class="op" id="6559618">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559621">{</span><span class="string" id="6559622">&#34;\x18&#34;</span><span class="op" id="6559628">,</span>&nbsp;<span class="string" id="6559630">`&#34;\u0018&#34;`</span><span class="op" id="6559640">}</span><span class="op" id="6559641">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559644">{</span><span class="string" id="6559645">&#34;\x19&#34;</span><span class="op" id="6559651">,</span>&nbsp;<span class="string" id="6559653">`&#34;\u0019&#34;`</span><span class="op" id="6559663">}</span><span class="op" id="6559664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559667">{</span><span class="string" id="6559668">&#34;\x1a&#34;</span><span class="op" id="6559674">,</span>&nbsp;<span class="string" id="6559676">`&#34;\u001a&#34;`</span><span class="op" id="6559686">}</span><span class="op" id="6559687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559690">{</span><span class="string" id="6559691">&#34;\x1b&#34;</span><span class="op" id="6559697">,</span>&nbsp;<span class="string" id="6559699">`&#34;\u001b&#34;`</span><span class="op" id="6559709">}</span><span class="op" id="6559710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559713">{</span><span class="string" id="6559714">&#34;\x1c&#34;</span><span class="op" id="6559720">,</span>&nbsp;<span class="string" id="6559722">`&#34;\u001c&#34;`</span><span class="op" id="6559732">}</span><span class="op" id="6559733">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559736">{</span><span class="string" id="6559737">&#34;\x1d&#34;</span><span class="op" id="6559743">,</span>&nbsp;<span class="string" id="6559745">`&#34;\u001d&#34;`</span><span class="op" id="6559755">}</span><span class="op" id="6559756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559759">{</span><span class="string" id="6559760">&#34;\x1e&#34;</span><span class="op" id="6559766">,</span>&nbsp;<span class="string" id="6559768">`&#34;\u001e&#34;`</span><span class="op" id="6559778">}</span><span class="op" id="6559779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559782">{</span><span class="string" id="6559783">&#34;\x1f&#34;</span><span class="op" id="6559789">,</span>&nbsp;<span class="string" id="6559791">`&#34;\u001f&#34;`</span><span class="op" id="6559801">}</span><span class="op" id="6559802">,</span><br>
<span class="lineno"></span><span class="op" id="6559804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">520</span><span class="keyword" id="6559807">func</span>&nbsp;<span class="ident" id="6559812">TestEncodeString</span><span class="op" id="6559828">(</span><span class="ident" id="6559829">t</span>&nbsp;<span class="op" id="6559831">*</span><span class="ident" id="6559832">testing</span><span class="op" id="6559839">.</span><span class="ident" id="6559840">T</span><span class="op" id="6559841">)</span>&nbsp;<span class="op" id="6559843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6559846">for</span>&nbsp;<span class="ident" id="6559850">_</span><span class="op" id="6559851">,</span>&nbsp;<span class="ident" id="6559853">tt</span>&nbsp;<span class="op" id="6559856">:=</span>&nbsp;<span class="keyword" id="6559859">range</span>&nbsp;<span class="ident" id="6559865">encodeStringTests</span>&nbsp;<span class="op" id="6559883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6559887">b</span><span class="op" id="6559888">,</span>&nbsp;<span class="ident" id="6559890">err</span>&nbsp;<span class="op" id="6559894">:=</span>&nbsp;<span class="ident" id="6559897">Marshal</span><span class="op" id="6559904">(</span><span class="ident" id="6559905">tt</span><span class="op" id="6559907">.</span><span class="ident" id="6559908">in</span><span class="op" id="6559910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6559914">if</span>&nbsp;<span class="ident" id="6559917">err</span>&nbsp;<span class="op" id="6559921">!=</span>&nbsp;<span class="ident" id="6559924">nil</span>&nbsp;<span class="op" id="6559928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6559933">t</span><span class="op" id="6559934">.</span><span class="ident" id="6559935">Errorf</span><span class="op" id="6559941">(</span><span class="string" id="6559942">&#34;Marshal(%q):&nbsp;%v&#34;</span><span class="op" id="6559959">,</span>&nbsp;<span class="ident" id="6559961">tt</span><span class="op" id="6559963">.</span><span class="ident" id="6559964">in</span><span class="op" id="6559966">,</span>&nbsp;<span class="ident" id="6559968">err</span><span class="op" id="6559971">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6559976">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6559987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6559991">out</span>&nbsp;<span class="op" id="6559995">:=</span>&nbsp;<span class="builtintype" id="6559998">string</span><span class="op" id="6560004">(</span><span class="ident" id="6560005">b</span><span class="op" id="6560006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6560010">if</span>&nbsp;<span class="ident" id="6560013">out</span>&nbsp;<span class="op" id="6560017">!=</span>&nbsp;<span class="ident" id="6560020">tt</span><span class="op" id="6560022">.</span><span class="ident" id="6560023">out</span>&nbsp;<span class="op" id="6560027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6560032">t</span><span class="op" id="6560033">.</span><span class="ident" id="6560034">Errorf</span><span class="op" id="6560040">(</span><span class="string" id="6560041">&#34;Marshal(%q)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6560070">,</span>&nbsp;<span class="ident" id="6560072">tt</span><span class="op" id="6560074">.</span><span class="ident" id="6560075">in</span><span class="op" id="6560077">,</span>&nbsp;<span class="ident" id="6560079">out</span><span class="op" id="6560082">,</span>&nbsp;<span class="ident" id="6560084">tt</span><span class="op" id="6560086">.</span><span class="ident" id="6560087">out</span><span class="op" id="6560090">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6560094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6560097">}</span><br>
<span class="lineno"></span><span class="op" id="6560099">}</span>
</div>
</body>
</html>
