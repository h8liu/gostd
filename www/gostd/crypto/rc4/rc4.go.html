<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3927805">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3927860">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3927914">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3927965">//&nbsp;Package&nbsp;rc4&nbsp;implements&nbsp;RC4&nbsp;encryption,&nbsp;as&nbsp;defined&nbsp;in&nbsp;Bruce&nbsp;Schneier&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3928038">//&nbsp;Applied&nbsp;Cryptography.</span><br>
<span class="lineno"></span><span class="keyword" id="3928063">package</span>&nbsp;<span class="ident" id="3928071">rc4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3928076">//&nbsp;BUG(agl):&nbsp;RC4&nbsp;is&nbsp;in&nbsp;common&nbsp;use&nbsp;but&nbsp;has&nbsp;design&nbsp;weaknesses&nbsp;that&nbsp;make</span><br>
<span class="lineno">10</span><span class="comment" id="3928146">//&nbsp;it&nbsp;a&nbsp;poor&nbsp;choice&nbsp;for&nbsp;new&nbsp;protocols.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3928186">import</span>&nbsp;<span class="string" id="3928193">&#34;strconv&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3928204">//&nbsp;A&nbsp;Cipher&nbsp;is&nbsp;an&nbsp;instance&nbsp;of&nbsp;RC4&nbsp;using&nbsp;a&nbsp;particular&nbsp;key.</span><br>
<span class="lineno">15</span><span class="keyword" id="3928262">type</span>&nbsp;<span class="ident" id="3928267">Cipher</span>&nbsp;<span class="keyword" id="3928274">struct</span>&nbsp;<span class="op" id="3928281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928284">s</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3928289">[</span><span class="num" id="3928290">256</span><span class="op" id="3928293">]</span><span class="builtintype" id="3928294">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928302">i</span><span class="op" id="3928303">,</span>&nbsp;<span class="ident" id="3928305">j</span>&nbsp;<span class="builtintype" id="3928307">uint8</span><br>
<span class="lineno"></span><span class="op" id="3928313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3928316">type</span>&nbsp;<span class="ident" id="3928321">KeySizeError</span>&nbsp;<span class="builtintype" id="3928334">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3928339">func</span>&nbsp;<span class="op" id="3928344">(</span><span class="ident" id="3928345">k</span>&nbsp;<span class="ident" id="3928347">KeySizeError</span><span class="op" id="3928359">)</span>&nbsp;<span class="ident" id="3928361">Error</span><span class="op" id="3928366">(</span><span class="op" id="3928367">)</span>&nbsp;<span class="builtintype" id="3928369">string</span>&nbsp;<span class="op" id="3928376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928379">return</span>&nbsp;<span class="string" id="3928386">&#34;crypto/rc4:&nbsp;invalid&nbsp;key&nbsp;size&nbsp;&#34;</span>&nbsp;<span class="op" id="3928418">+</span>&nbsp;<span class="ident" id="3928420">strconv</span><span class="op" id="3928427">.</span><span class="ident" id="3928428">Itoa</span><span class="op" id="3928432">(</span><span class="builtintype" id="3928433">int</span><span class="op" id="3928436">(</span><span class="ident" id="3928437">k</span><span class="op" id="3928438">)</span><span class="op" id="3928439">)</span><br>
<span class="lineno"></span><span class="op" id="3928441">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="3928444">//&nbsp;NewCipher&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;Cipher.&nbsp;&nbsp;The&nbsp;key&nbsp;argument&nbsp;should&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3928523">//&nbsp;RC4&nbsp;key,&nbsp;at&nbsp;least&nbsp;1&nbsp;byte&nbsp;and&nbsp;at&nbsp;most&nbsp;256&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3928574">func</span>&nbsp;<span class="ident" id="3928579">NewCipher</span><span class="op" id="3928588">(</span><span class="ident" id="3928589">key</span>&nbsp;<span class="op" id="3928593">[</span><span class="op" id="3928594">]</span><span class="builtintype" id="3928595">byte</span><span class="op" id="3928599">)</span>&nbsp;<span class="op" id="3928601">(</span><span class="op" id="3928602">*</span><span class="ident" id="3928603">Cipher</span><span class="op" id="3928609">,</span>&nbsp;<span class="builtintype" id="3928611">error</span><span class="op" id="3928616">)</span>&nbsp;<span class="op" id="3928618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928621">k</span>&nbsp;<span class="op" id="3928623">:=</span>&nbsp;<span class="builtinfunc" id="3928626">len</span><span class="op" id="3928629">(</span><span class="ident" id="3928630">key</span><span class="op" id="3928633">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928636">if</span>&nbsp;<span class="ident" id="3928639">k</span>&nbsp;<span class="op" id="3928641">&lt;</span>&nbsp;<span class="num" id="3928643">1</span>&nbsp;<span class="op" id="3928645">||</span>&nbsp;<span class="ident" id="3928648">k</span>&nbsp;<span class="op" id="3928650">&gt;</span>&nbsp;<span class="num" id="3928652">256</span>&nbsp;<span class="op" id="3928656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928660">return</span>&nbsp;<span class="ident" id="3928667">nil</span><span class="op" id="3928670">,</span>&nbsp;<span class="ident" id="3928672">KeySizeError</span><span class="op" id="3928684">(</span><span class="ident" id="3928685">k</span><span class="op" id="3928686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928692">var</span>&nbsp;<span class="ident" id="3928696">c</span>&nbsp;<span class="ident" id="3928698">Cipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928706">for</span>&nbsp;<span class="ident" id="3928710">i</span>&nbsp;<span class="op" id="3928712">:=</span>&nbsp;<span class="num" id="3928715">0</span><span class="op" id="3928716">;</span>&nbsp;<span class="ident" id="3928718">i</span>&nbsp;<span class="op" id="3928720">&lt;</span>&nbsp;<span class="num" id="3928722">256</span><span class="op" id="3928725">;</span>&nbsp;<span class="ident" id="3928727">i</span><span class="op" id="3928728">++</span>&nbsp;<span class="op" id="3928731">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928735">c</span><span class="op" id="3928736">.</span><span class="ident" id="3928737">s</span><span class="op" id="3928738">[</span><span class="ident" id="3928739">i</span><span class="op" id="3928740">]</span>&nbsp;<span class="op" id="3928742">=</span>&nbsp;<span class="builtintype" id="3928744">uint32</span><span class="op" id="3928750">(</span><span class="ident" id="3928751">i</span><span class="op" id="3928752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928758">var</span>&nbsp;<span class="ident" id="3928762">j</span>&nbsp;<span class="builtintype" id="3928764">uint8</span>&nbsp;<span class="op" id="3928770">=</span>&nbsp;<span class="num" id="3928772">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928775">for</span>&nbsp;<span class="ident" id="3928779">i</span>&nbsp;<span class="op" id="3928781">:=</span>&nbsp;<span class="num" id="3928784">0</span><span class="op" id="3928785">;</span>&nbsp;<span class="ident" id="3928787">i</span>&nbsp;<span class="op" id="3928789">&lt;</span>&nbsp;<span class="num" id="3928791">256</span><span class="op" id="3928794">;</span>&nbsp;<span class="ident" id="3928796">i</span><span class="op" id="3928797">++</span>&nbsp;<span class="op" id="3928800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928804">j</span>&nbsp;<span class="op" id="3928806">+=</span>&nbsp;<span class="builtintype" id="3928809">uint8</span><span class="op" id="3928814">(</span><span class="ident" id="3928815">c</span><span class="op" id="3928816">.</span><span class="ident" id="3928817">s</span><span class="op" id="3928818">[</span><span class="ident" id="3928819">i</span><span class="op" id="3928820">]</span><span class="op" id="3928821">)</span>&nbsp;<span class="op" id="3928823">+</span>&nbsp;<span class="ident" id="3928825">key</span><span class="op" id="3928828">[</span><span class="ident" id="3928829">i</span><span class="op" id="3928830">%</span><span class="ident" id="3928831">k</span><span class="op" id="3928832">]</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928836">c</span><span class="op" id="3928837">.</span><span class="ident" id="3928838">s</span><span class="op" id="3928839">[</span><span class="ident" id="3928840">i</span><span class="op" id="3928841">]</span><span class="op" id="3928842">,</span>&nbsp;<span class="ident" id="3928844">c</span><span class="op" id="3928845">.</span><span class="ident" id="3928846">s</span><span class="op" id="3928847">[</span><span class="ident" id="3928848">j</span><span class="op" id="3928849">]</span>&nbsp;<span class="op" id="3928851">=</span>&nbsp;<span class="ident" id="3928853">c</span><span class="op" id="3928854">.</span><span class="ident" id="3928855">s</span><span class="op" id="3928856">[</span><span class="ident" id="3928857">j</span><span class="op" id="3928858">]</span><span class="op" id="3928859">,</span>&nbsp;<span class="ident" id="3928861">c</span><span class="op" id="3928862">.</span><span class="ident" id="3928863">s</span><span class="op" id="3928864">[</span><span class="ident" id="3928865">i</span><span class="op" id="3928866">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928872">return</span>&nbsp;<span class="op" id="3928879">&amp;</span><span class="ident" id="3928880">c</span><span class="op" id="3928881">,</span>&nbsp;<span class="ident" id="3928883">nil</span><br>
<span class="lineno"></span><span class="op" id="3928887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="3928890">//&nbsp;Reset&nbsp;zeros&nbsp;the&nbsp;key&nbsp;data&nbsp;so&nbsp;that&nbsp;it&nbsp;will&nbsp;no&nbsp;longer&nbsp;appear&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3928958">//&nbsp;process&#39;s&nbsp;memory.</span><br>
<span class="lineno"></span><span class="keyword" id="3928979">func</span>&nbsp;<span class="op" id="3928984">(</span><span class="ident" id="3928985">c</span>&nbsp;<span class="op" id="3928987">*</span><span class="ident" id="3928988">Cipher</span><span class="op" id="3928994">)</span>&nbsp;<span class="ident" id="3928996">Reset</span><span class="op" id="3929001">(</span><span class="op" id="3929002">)</span>&nbsp;<span class="op" id="3929004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929007">for</span>&nbsp;<span class="ident" id="3929011">i</span>&nbsp;<span class="op" id="3929013">:=</span>&nbsp;<span class="keyword" id="3929016">range</span>&nbsp;<span class="ident" id="3929022">c</span><span class="op" id="3929023">.</span><span class="ident" id="3929024">s</span>&nbsp;<span class="op" id="3929026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929030">c</span><span class="op" id="3929031">.</span><span class="ident" id="3929032">s</span><span class="op" id="3929033">[</span><span class="ident" id="3929034">i</span><span class="op" id="3929035">]</span>&nbsp;<span class="op" id="3929037">=</span>&nbsp;<span class="num" id="3929039">0</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3929042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929045">c</span><span class="op" id="3929046">.</span><span class="ident" id="3929047">i</span><span class="op" id="3929048">,</span>&nbsp;<span class="ident" id="3929050">c</span><span class="op" id="3929051">.</span><span class="ident" id="3929052">j</span>&nbsp;<span class="op" id="3929054">=</span>&nbsp;<span class="num" id="3929056">0</span><span class="op" id="3929057">,</span>&nbsp;<span class="num" id="3929059">0</span><br>
<span class="lineno"></span><span class="op" id="3929061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3929064">//&nbsp;xorKeyStreamGeneric&nbsp;sets&nbsp;dst&nbsp;to&nbsp;the&nbsp;result&nbsp;of&nbsp;XORing&nbsp;src&nbsp;with&nbsp;the</span><br>
<span class="lineno">55</span><span class="comment" id="3929133">//&nbsp;key&nbsp;stream.&nbsp;&nbsp;Dst&nbsp;and&nbsp;src&nbsp;may&nbsp;be&nbsp;the&nbsp;same&nbsp;slice&nbsp;but&nbsp;otherwise&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="3929204">//&nbsp;not&nbsp;overlap.</span><br>
<span class="lineno"></span><span class="comment" id="3929220">//</span><br>
<span class="lineno"></span><span class="comment" id="3929223">//&nbsp;This&nbsp;is&nbsp;the&nbsp;pure&nbsp;Go&nbsp;version.&nbsp;rc4_{amd64,386,arm}*&nbsp;contain&nbsp;assembly</span><br>
<span class="lineno"></span><span class="comment" id="3929293">//&nbsp;implementations.&nbsp;This&nbsp;is&nbsp;here&nbsp;for&nbsp;tests&nbsp;and&nbsp;to&nbsp;prevent&nbsp;bitrot.</span><br>
<span class="lineno">60</span><span class="keyword" id="3929359">func</span>&nbsp;<span class="op" id="3929364">(</span><span class="ident" id="3929365">c</span>&nbsp;<span class="op" id="3929367">*</span><span class="ident" id="3929368">Cipher</span><span class="op" id="3929374">)</span>&nbsp;<span class="ident" id="3929376">xorKeyStreamGeneric</span><span class="op" id="3929395">(</span><span class="ident" id="3929396">dst</span><span class="op" id="3929399">,</span>&nbsp;<span class="ident" id="3929401">src</span>&nbsp;<span class="op" id="3929405">[</span><span class="op" id="3929406">]</span><span class="builtintype" id="3929407">byte</span><span class="op" id="3929411">)</span>&nbsp;<span class="op" id="3929413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929416">i</span><span class="op" id="3929417">,</span>&nbsp;<span class="ident" id="3929419">j</span>&nbsp;<span class="op" id="3929421">:=</span>&nbsp;<span class="ident" id="3929424">c</span><span class="op" id="3929425">.</span><span class="ident" id="3929426">i</span><span class="op" id="3929427">,</span>&nbsp;<span class="ident" id="3929429">c</span><span class="op" id="3929430">.</span><span class="ident" id="3929431">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929434">for</span>&nbsp;<span class="ident" id="3929438">k</span><span class="op" id="3929439">,</span>&nbsp;<span class="ident" id="3929441">v</span>&nbsp;<span class="op" id="3929443">:=</span>&nbsp;<span class="keyword" id="3929446">range</span>&nbsp;<span class="ident" id="3929452">src</span>&nbsp;<span class="op" id="3929456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929460">i</span>&nbsp;<span class="op" id="3929462">+=</span>&nbsp;<span class="num" id="3929465">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929469">j</span>&nbsp;<span class="op" id="3929471">+=</span>&nbsp;<span class="builtintype" id="3929474">uint8</span><span class="op" id="3929479">(</span><span class="ident" id="3929480">c</span><span class="op" id="3929481">.</span><span class="ident" id="3929482">s</span><span class="op" id="3929483">[</span><span class="ident" id="3929484">i</span><span class="op" id="3929485">]</span><span class="op" id="3929486">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929490">c</span><span class="op" id="3929491">.</span><span class="ident" id="3929492">s</span><span class="op" id="3929493">[</span><span class="ident" id="3929494">i</span><span class="op" id="3929495">]</span><span class="op" id="3929496">,</span>&nbsp;<span class="ident" id="3929498">c</span><span class="op" id="3929499">.</span><span class="ident" id="3929500">s</span><span class="op" id="3929501">[</span><span class="ident" id="3929502">j</span><span class="op" id="3929503">]</span>&nbsp;<span class="op" id="3929505">=</span>&nbsp;<span class="ident" id="3929507">c</span><span class="op" id="3929508">.</span><span class="ident" id="3929509">s</span><span class="op" id="3929510">[</span><span class="ident" id="3929511">j</span><span class="op" id="3929512">]</span><span class="op" id="3929513">,</span>&nbsp;<span class="ident" id="3929515">c</span><span class="op" id="3929516">.</span><span class="ident" id="3929517">s</span><span class="op" id="3929518">[</span><span class="ident" id="3929519">i</span><span class="op" id="3929520">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929524">dst</span><span class="op" id="3929527">[</span><span class="ident" id="3929528">k</span><span class="op" id="3929529">]</span>&nbsp;<span class="op" id="3929531">=</span>&nbsp;<span class="ident" id="3929533">v</span>&nbsp;<span class="op" id="3929535">^</span>&nbsp;<span class="builtintype" id="3929537">uint8</span><span class="op" id="3929542">(</span><span class="ident" id="3929543">c</span><span class="op" id="3929544">.</span><span class="ident" id="3929545">s</span><span class="op" id="3929546">[</span><span class="builtintype" id="3929547">uint8</span><span class="op" id="3929552">(</span><span class="ident" id="3929553">c</span><span class="op" id="3929554">.</span><span class="ident" id="3929555">s</span><span class="op" id="3929556">[</span><span class="ident" id="3929557">i</span><span class="op" id="3929558">]</span><span class="op" id="3929559">+</span><span class="ident" id="3929560">c</span><span class="op" id="3929561">.</span><span class="ident" id="3929562">s</span><span class="op" id="3929563">[</span><span class="ident" id="3929564">j</span><span class="op" id="3929565">]</span><span class="op" id="3929566">)</span><span class="op" id="3929567">]</span><span class="op" id="3929568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3929571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929574">c</span><span class="op" id="3929575">.</span><span class="ident" id="3929576">i</span><span class="op" id="3929577">,</span>&nbsp;<span class="ident" id="3929579">c</span><span class="op" id="3929580">.</span><span class="ident" id="3929581">j</span>&nbsp;<span class="op" id="3929583">=</span>&nbsp;<span class="ident" id="3929585">i</span><span class="op" id="3929586">,</span>&nbsp;<span class="ident" id="3929588">j</span><br>
<span class="lineno"></span><span class="op" id="3929590">}</span>
</div>
</body>
</html>
