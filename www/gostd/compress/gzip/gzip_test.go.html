<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6528601">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6528656">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6528710">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6528761">package</span>&nbsp;<span class="ident" id="6528769">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6528775">import</span>&nbsp;<span class="op" id="6528782">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6528785">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6528794">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6528803">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6528816">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6528827">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6528834">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6528837">//&nbsp;TestEmpty&nbsp;tests&nbsp;that&nbsp;an&nbsp;empty&nbsp;payload&nbsp;still&nbsp;forms&nbsp;a&nbsp;valid&nbsp;GZIP&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="6528911">func</span>&nbsp;<span class="ident" id="6528916">TestEmpty</span><span class="op" id="6528925">(</span><span class="ident" id="6528926">t</span>&nbsp;<span class="op" id="6528928">*</span><span class="ident" id="6528929">testing</span><span class="op" id="6528936">.</span><span class="ident" id="6528937">T</span><span class="op" id="6528938">)</span>&nbsp;<span class="op" id="6528940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6528943">buf</span>&nbsp;<span class="op" id="6528947">:=</span>&nbsp;<span class="builtinfunc" id="6528950">new</span><span class="op" id="6528953">(</span><span class="ident" id="6528954">bytes</span><span class="op" id="6528959">.</span><span class="ident" id="6528960">Buffer</span><span class="op" id="6528966">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6528970">if</span>&nbsp;<span class="ident" id="6528973">err</span>&nbsp;<span class="op" id="6528977">:=</span>&nbsp;<span class="ident" id="6528980">NewWriter</span><span class="op" id="6528989">(</span><span class="ident" id="6528990">buf</span><span class="op" id="6528993">)</span><span class="op" id="6528994">.</span><span class="ident" id="6528995">Close</span><span class="op" id="6529000">(</span><span class="op" id="6529001">)</span><span class="op" id="6529002">;</span>&nbsp;<span class="ident" id="6529004">err</span>&nbsp;<span class="op" id="6529008">!=</span>&nbsp;<span class="ident" id="6529011">nil</span>&nbsp;<span class="op" id="6529015">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529019">t</span><span class="op" id="6529020">.</span><span class="ident" id="6529021">Fatalf</span><span class="op" id="6529027">(</span><span class="string" id="6529028">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="6529046">,</span>&nbsp;<span class="ident" id="6529048">err</span><span class="op" id="6529051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529058">r</span><span class="op" id="6529059">,</span>&nbsp;<span class="ident" id="6529061">err</span>&nbsp;<span class="op" id="6529065">:=</span>&nbsp;<span class="ident" id="6529068">NewReader</span><span class="op" id="6529077">(</span><span class="ident" id="6529078">buf</span><span class="op" id="6529081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529084">if</span>&nbsp;<span class="ident" id="6529087">err</span>&nbsp;<span class="op" id="6529091">!=</span>&nbsp;<span class="ident" id="6529094">nil</span>&nbsp;<span class="op" id="6529098">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529102">t</span><span class="op" id="6529103">.</span><span class="ident" id="6529104">Fatalf</span><span class="op" id="6529110">(</span><span class="string" id="6529111">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6529126">,</span>&nbsp;<span class="ident" id="6529128">err</span><span class="op" id="6529131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529137">b</span><span class="op" id="6529138">,</span>&nbsp;<span class="ident" id="6529140">err</span>&nbsp;<span class="op" id="6529144">:=</span>&nbsp;<span class="ident" id="6529147">ioutil</span><span class="op" id="6529153">.</span><span class="ident" id="6529154">ReadAll</span><span class="op" id="6529161">(</span><span class="ident" id="6529162">r</span><span class="op" id="6529163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529166">if</span>&nbsp;<span class="ident" id="6529169">err</span>&nbsp;<span class="op" id="6529173">!=</span>&nbsp;<span class="ident" id="6529176">nil</span>&nbsp;<span class="op" id="6529180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529184">t</span><span class="op" id="6529185">.</span><span class="ident" id="6529186">Fatalf</span><span class="op" id="6529192">(</span><span class="string" id="6529193">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="6529206">,</span>&nbsp;<span class="ident" id="6529208">err</span><span class="op" id="6529211">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529217">if</span>&nbsp;<span class="builtinfunc" id="6529220">len</span><span class="op" id="6529223">(</span><span class="ident" id="6529224">b</span><span class="op" id="6529225">)</span>&nbsp;<span class="op" id="6529227">!=</span>&nbsp;<span class="num" id="6529230">0</span>&nbsp;<span class="op" id="6529232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529236">t</span><span class="op" id="6529237">.</span><span class="ident" id="6529238">Fatalf</span><span class="op" id="6529244">(</span><span class="string" id="6529245">&#34;got&nbsp;%d&nbsp;bytes,&nbsp;want&nbsp;0&#34;</span><span class="op" id="6529267">,</span>&nbsp;<span class="builtinfunc" id="6529269">len</span><span class="op" id="6529272">(</span><span class="ident" id="6529273">b</span><span class="op" id="6529274">)</span><span class="op" id="6529275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529281">if</span>&nbsp;<span class="ident" id="6529284">err</span>&nbsp;<span class="op" id="6529288">:=</span>&nbsp;<span class="ident" id="6529291">r</span><span class="op" id="6529292">.</span><span class="ident" id="6529293">Close</span><span class="op" id="6529298">(</span><span class="op" id="6529299">)</span><span class="op" id="6529300">;</span>&nbsp;<span class="ident" id="6529302">err</span>&nbsp;<span class="op" id="6529306">!=</span>&nbsp;<span class="ident" id="6529309">nil</span>&nbsp;<span class="op" id="6529313">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529317">t</span><span class="op" id="6529318">.</span><span class="ident" id="6529319">Fatalf</span><span class="op" id="6529325">(</span><span class="string" id="6529326">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="6529344">,</span>&nbsp;<span class="ident" id="6529346">err</span><span class="op" id="6529349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529352">}</span><br>
<span class="lineno"></span><span class="op" id="6529354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6529357">//&nbsp;TestRoundTrip&nbsp;tests&nbsp;that&nbsp;gzipping&nbsp;and&nbsp;then&nbsp;gunzipping&nbsp;is&nbsp;the&nbsp;identity</span><br>
<span class="lineno">40</span><span class="comment" id="6529430">//&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="6529443">func</span>&nbsp;<span class="ident" id="6529448">TestRoundTrip</span><span class="op" id="6529461">(</span><span class="ident" id="6529462">t</span>&nbsp;<span class="op" id="6529464">*</span><span class="ident" id="6529465">testing</span><span class="op" id="6529472">.</span><span class="ident" id="6529473">T</span><span class="op" id="6529474">)</span>&nbsp;<span class="op" id="6529476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529479">buf</span>&nbsp;<span class="op" id="6529483">:=</span>&nbsp;<span class="builtinfunc" id="6529486">new</span><span class="op" id="6529489">(</span><span class="ident" id="6529490">bytes</span><span class="op" id="6529495">.</span><span class="ident" id="6529496">Buffer</span><span class="op" id="6529502">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529506">w</span>&nbsp;<span class="op" id="6529508">:=</span>&nbsp;<span class="ident" id="6529511">NewWriter</span><span class="op" id="6529520">(</span><span class="ident" id="6529521">buf</span><span class="op" id="6529524">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529527">w</span><span class="op" id="6529528">.</span><span class="ident" id="6529529">Comment</span>&nbsp;<span class="op" id="6529537">=</span>&nbsp;<span class="string" id="6529539">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529550">w</span><span class="op" id="6529551">.</span><span class="ident" id="6529552">Extra</span>&nbsp;<span class="op" id="6529558">=</span>&nbsp;<span class="op" id="6529560">[</span><span class="op" id="6529561">]</span><span class="builtintype" id="6529562">byte</span><span class="op" id="6529566">(</span><span class="string" id="6529567">&#34;extra&#34;</span><span class="op" id="6529574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529577">w</span><span class="op" id="6529578">.</span><span class="ident" id="6529579">ModTime</span>&nbsp;<span class="op" id="6529587">=</span>&nbsp;<span class="ident" id="6529589">time</span><span class="op" id="6529593">.</span><span class="ident" id="6529594">Unix</span><span class="op" id="6529598">(</span><span class="num" id="6529599">1e8</span><span class="op" id="6529602">,</span>&nbsp;<span class="num" id="6529604">0</span><span class="op" id="6529605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529608">w</span><span class="op" id="6529609">.</span><span class="ident" id="6529610">Name</span>&nbsp;<span class="op" id="6529615">=</span>&nbsp;<span class="string" id="6529617">&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529625">if</span>&nbsp;<span class="ident" id="6529628">_</span><span class="op" id="6529629">,</span>&nbsp;<span class="ident" id="6529631">err</span>&nbsp;<span class="op" id="6529635">:=</span>&nbsp;<span class="ident" id="6529638">w</span><span class="op" id="6529639">.</span><span class="ident" id="6529640">Write</span><span class="op" id="6529645">(</span><span class="op" id="6529646">[</span><span class="op" id="6529647">]</span><span class="builtintype" id="6529648">byte</span><span class="op" id="6529652">(</span><span class="string" id="6529653">&#34;payload&#34;</span><span class="op" id="6529662">)</span><span class="op" id="6529663">)</span><span class="op" id="6529664">;</span>&nbsp;<span class="ident" id="6529666">err</span>&nbsp;<span class="op" id="6529670">!=</span>&nbsp;<span class="ident" id="6529673">nil</span>&nbsp;<span class="op" id="6529677">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529681">t</span><span class="op" id="6529682">.</span><span class="ident" id="6529683">Fatalf</span><span class="op" id="6529689">(</span><span class="string" id="6529690">&#34;Write:&nbsp;%v&#34;</span><span class="op" id="6529701">,</span>&nbsp;<span class="ident" id="6529703">err</span><span class="op" id="6529706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529712">if</span>&nbsp;<span class="ident" id="6529715">err</span>&nbsp;<span class="op" id="6529719">:=</span>&nbsp;<span class="ident" id="6529722">w</span><span class="op" id="6529723">.</span><span class="ident" id="6529724">Close</span><span class="op" id="6529729">(</span><span class="op" id="6529730">)</span><span class="op" id="6529731">;</span>&nbsp;<span class="ident" id="6529733">err</span>&nbsp;<span class="op" id="6529737">!=</span>&nbsp;<span class="ident" id="6529740">nil</span>&nbsp;<span class="op" id="6529744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529748">t</span><span class="op" id="6529749">.</span><span class="ident" id="6529750">Fatalf</span><span class="op" id="6529756">(</span><span class="string" id="6529757">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="6529775">,</span>&nbsp;<span class="ident" id="6529777">err</span><span class="op" id="6529780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529783">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529787">r</span><span class="op" id="6529788">,</span>&nbsp;<span class="ident" id="6529790">err</span>&nbsp;<span class="op" id="6529794">:=</span>&nbsp;<span class="ident" id="6529797">NewReader</span><span class="op" id="6529806">(</span><span class="ident" id="6529807">buf</span><span class="op" id="6529810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529813">if</span>&nbsp;<span class="ident" id="6529816">err</span>&nbsp;<span class="op" id="6529820">!=</span>&nbsp;<span class="ident" id="6529823">nil</span>&nbsp;<span class="op" id="6529827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529831">t</span><span class="op" id="6529832">.</span><span class="ident" id="6529833">Fatalf</span><span class="op" id="6529839">(</span><span class="string" id="6529840">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6529855">,</span>&nbsp;<span class="ident" id="6529857">err</span><span class="op" id="6529860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529863">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529866">b</span><span class="op" id="6529867">,</span>&nbsp;<span class="ident" id="6529869">err</span>&nbsp;<span class="op" id="6529873">:=</span>&nbsp;<span class="ident" id="6529876">ioutil</span><span class="op" id="6529882">.</span><span class="ident" id="6529883">ReadAll</span><span class="op" id="6529890">(</span><span class="ident" id="6529891">r</span><span class="op" id="6529892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529895">if</span>&nbsp;<span class="ident" id="6529898">err</span>&nbsp;<span class="op" id="6529902">!=</span>&nbsp;<span class="ident" id="6529905">nil</span>&nbsp;<span class="op" id="6529909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529913">t</span><span class="op" id="6529914">.</span><span class="ident" id="6529915">Fatalf</span><span class="op" id="6529921">(</span><span class="string" id="6529922">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="6529935">,</span>&nbsp;<span class="ident" id="6529937">err</span><span class="op" id="6529940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6529943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6529946">if</span>&nbsp;<span class="builtintype" id="6529949">string</span><span class="op" id="6529955">(</span><span class="ident" id="6529956">b</span><span class="op" id="6529957">)</span>&nbsp;<span class="op" id="6529959">!=</span>&nbsp;<span class="string" id="6529962">&#34;payload&#34;</span>&nbsp;<span class="op" id="6529972">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6529976">t</span><span class="op" id="6529977">.</span><span class="ident" id="6529978">Fatalf</span><span class="op" id="6529984">(</span><span class="string" id="6529985">&#34;payload&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6530009">,</span>&nbsp;<span class="builtintype" id="6530011">string</span><span class="op" id="6530017">(</span><span class="ident" id="6530018">b</span><span class="op" id="6530019">)</span><span class="op" id="6530020">,</span>&nbsp;<span class="string" id="6530022">&#34;payload&#34;</span><span class="op" id="6530031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530037">if</span>&nbsp;<span class="ident" id="6530040">r</span><span class="op" id="6530041">.</span><span class="ident" id="6530042">Comment</span>&nbsp;<span class="op" id="6530050">!=</span>&nbsp;<span class="string" id="6530053">&#34;comment&#34;</span>&nbsp;<span class="op" id="6530063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530067">t</span><span class="op" id="6530068">.</span><span class="ident" id="6530069">Fatalf</span><span class="op" id="6530075">(</span><span class="string" id="6530076">&#34;comment&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6530100">,</span>&nbsp;<span class="ident" id="6530102">r</span><span class="op" id="6530103">.</span><span class="ident" id="6530104">Comment</span><span class="op" id="6530111">,</span>&nbsp;<span class="string" id="6530113">&#34;comment&#34;</span><span class="op" id="6530122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530125">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530128">if</span>&nbsp;<span class="builtintype" id="6530131">string</span><span class="op" id="6530137">(</span><span class="ident" id="6530138">r</span><span class="op" id="6530139">.</span><span class="ident" id="6530140">Extra</span><span class="op" id="6530145">)</span>&nbsp;<span class="op" id="6530147">!=</span>&nbsp;<span class="string" id="6530150">&#34;extra&#34;</span>&nbsp;<span class="op" id="6530158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530162">t</span><span class="op" id="6530163">.</span><span class="ident" id="6530164">Fatalf</span><span class="op" id="6530170">(</span><span class="string" id="6530171">&#34;extra&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6530193">,</span>&nbsp;<span class="ident" id="6530195">r</span><span class="op" id="6530196">.</span><span class="ident" id="6530197">Extra</span><span class="op" id="6530202">,</span>&nbsp;<span class="string" id="6530204">&#34;extra&#34;</span><span class="op" id="6530211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530217">if</span>&nbsp;<span class="ident" id="6530220">r</span><span class="op" id="6530221">.</span><span class="ident" id="6530222">ModTime</span><span class="op" id="6530229">.</span><span class="ident" id="6530230">Unix</span><span class="op" id="6530234">(</span><span class="op" id="6530235">)</span>&nbsp;<span class="op" id="6530237">!=</span>&nbsp;<span class="num" id="6530240">1e8</span>&nbsp;<span class="op" id="6530244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530248">t</span><span class="op" id="6530249">.</span><span class="ident" id="6530250">Fatalf</span><span class="op" id="6530256">(</span><span class="string" id="6530257">&#34;mtime&nbsp;is&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6530279">,</span>&nbsp;<span class="ident" id="6530281">r</span><span class="op" id="6530282">.</span><span class="ident" id="6530283">ModTime</span><span class="op" id="6530290">.</span><span class="ident" id="6530291">Unix</span><span class="op" id="6530295">(</span><span class="op" id="6530296">)</span><span class="op" id="6530297">,</span>&nbsp;<span class="builtintype" id="6530299">uint32</span><span class="op" id="6530305">(</span><span class="num" id="6530306">1e8</span><span class="op" id="6530309">)</span><span class="op" id="6530310">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530316">if</span>&nbsp;<span class="ident" id="6530319">r</span><span class="op" id="6530320">.</span><span class="ident" id="6530321">Name</span>&nbsp;<span class="op" id="6530326">!=</span>&nbsp;<span class="string" id="6530329">&#34;name&#34;</span>&nbsp;<span class="op" id="6530336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530340">t</span><span class="op" id="6530341">.</span><span class="ident" id="6530342">Fatalf</span><span class="op" id="6530348">(</span><span class="string" id="6530349">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6530370">,</span>&nbsp;<span class="ident" id="6530372">r</span><span class="op" id="6530373">.</span><span class="ident" id="6530374">Name</span><span class="op" id="6530378">,</span>&nbsp;<span class="string" id="6530380">&#34;name&#34;</span><span class="op" id="6530386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530392">if</span>&nbsp;<span class="ident" id="6530395">err</span>&nbsp;<span class="op" id="6530399">:=</span>&nbsp;<span class="ident" id="6530402">r</span><span class="op" id="6530403">.</span><span class="ident" id="6530404">Close</span><span class="op" id="6530409">(</span><span class="op" id="6530410">)</span><span class="op" id="6530411">;</span>&nbsp;<span class="ident" id="6530413">err</span>&nbsp;<span class="op" id="6530417">!=</span>&nbsp;<span class="ident" id="6530420">nil</span>&nbsp;<span class="op" id="6530424">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530428">t</span><span class="op" id="6530429">.</span><span class="ident" id="6530430">Fatalf</span><span class="op" id="6530436">(</span><span class="string" id="6530437">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="6530455">,</span>&nbsp;<span class="ident" id="6530457">err</span><span class="op" id="6530460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530463">}</span><br>
<span class="lineno"></span><span class="op" id="6530465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6530468">//&nbsp;TestLatin1&nbsp;tests&nbsp;the&nbsp;internal&nbsp;functions&nbsp;for&nbsp;converting&nbsp;to&nbsp;and&nbsp;from&nbsp;Latin-1.</span><br>
<span class="lineno">85</span><span class="keyword" id="6530547">func</span>&nbsp;<span class="ident" id="6530552">TestLatin1</span><span class="op" id="6530562">(</span><span class="ident" id="6530563">t</span>&nbsp;<span class="op" id="6530565">*</span><span class="ident" id="6530566">testing</span><span class="op" id="6530573">.</span><span class="ident" id="6530574">T</span><span class="op" id="6530575">)</span>&nbsp;<span class="op" id="6530577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530580">latin1</span>&nbsp;<span class="op" id="6530587">:=</span>&nbsp;<span class="op" id="6530590">[</span><span class="op" id="6530591">]</span><span class="builtintype" id="6530592">byte</span><span class="op" id="6530596">{</span><span class="num" id="6530597">0xc4</span><span class="op" id="6530601">,</span>&nbsp;<span class="string" id="6530603">&#39;u&#39;</span><span class="op" id="6530606">,</span>&nbsp;<span class="num" id="6530608">0xdf</span><span class="op" id="6530612">,</span>&nbsp;<span class="string" id="6530614">&#39;e&#39;</span><span class="op" id="6530617">,</span>&nbsp;<span class="string" id="6530619">&#39;r&#39;</span><span class="op" id="6530622">,</span>&nbsp;<span class="string" id="6530624">&#39;u&#39;</span><span class="op" id="6530627">,</span>&nbsp;<span class="string" id="6530629">&#39;n&#39;</span><span class="op" id="6530632">,</span>&nbsp;<span class="string" id="6530634">&#39;g&#39;</span><span class="op" id="6530637">,</span>&nbsp;<span class="num" id="6530639">0</span><span class="op" id="6530640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530643">utf8</span>&nbsp;<span class="op" id="6530648">:=</span>&nbsp;<span class="string" id="6530651">&#34;Äußerung&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530665">z</span>&nbsp;<span class="op" id="6530667">:=</span>&nbsp;<span class="ident" id="6530670">Reader</span><span class="op" id="6530676">{</span><span class="ident" id="6530677">r</span><span class="op" id="6530678">:</span>&nbsp;<span class="ident" id="6530680">bufio</span><span class="op" id="6530685">.</span><span class="ident" id="6530686">NewReader</span><span class="op" id="6530695">(</span><span class="ident" id="6530696">bytes</span><span class="op" id="6530701">.</span><span class="ident" id="6530702">NewReader</span><span class="op" id="6530711">(</span><span class="ident" id="6530712">latin1</span><span class="op" id="6530718">)</span><span class="op" id="6530719">)</span><span class="op" id="6530720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530723">s</span><span class="op" id="6530724">,</span>&nbsp;<span class="ident" id="6530726">err</span>&nbsp;<span class="op" id="6530730">:=</span>&nbsp;<span class="ident" id="6530733">z</span><span class="op" id="6530734">.</span><span class="ident" id="6530735">readString</span><span class="op" id="6530745">(</span><span class="op" id="6530746">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530749">if</span>&nbsp;<span class="ident" id="6530752">err</span>&nbsp;<span class="op" id="6530756">!=</span>&nbsp;<span class="ident" id="6530759">nil</span>&nbsp;<span class="op" id="6530763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530767">t</span><span class="op" id="6530768">.</span><span class="ident" id="6530769">Fatalf</span><span class="op" id="6530775">(</span><span class="string" id="6530776">&#34;readString:&nbsp;%v&#34;</span><span class="op" id="6530792">,</span>&nbsp;<span class="ident" id="6530794">err</span><span class="op" id="6530797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530803">if</span>&nbsp;<span class="ident" id="6530806">s</span>&nbsp;<span class="op" id="6530808">!=</span>&nbsp;<span class="ident" id="6530811">utf8</span>&nbsp;<span class="op" id="6530816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530820">t</span><span class="op" id="6530821">.</span><span class="ident" id="6530822">Fatalf</span><span class="op" id="6530828">(</span><span class="string" id="6530829">&#34;read&nbsp;latin-1:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6530860">,</span>&nbsp;<span class="ident" id="6530862">s</span><span class="op" id="6530863">,</span>&nbsp;<span class="ident" id="6530865">utf8</span><span class="op" id="6530869">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6530872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530876">buf</span>&nbsp;<span class="op" id="6530880">:=</span>&nbsp;<span class="ident" id="6530883">bytes</span><span class="op" id="6530888">.</span><span class="ident" id="6530889">NewBuffer</span><span class="op" id="6530898">(</span><span class="builtinfunc" id="6530899">make</span><span class="op" id="6530903">(</span><span class="op" id="6530904">[</span><span class="op" id="6530905">]</span><span class="builtintype" id="6530906">byte</span><span class="op" id="6530910">,</span>&nbsp;<span class="num" id="6530912">0</span><span class="op" id="6530913">,</span>&nbsp;<span class="builtinfunc" id="6530915">len</span><span class="op" id="6530918">(</span><span class="ident" id="6530919">latin1</span><span class="op" id="6530925">)</span><span class="op" id="6530926">)</span><span class="op" id="6530927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530930">c</span>&nbsp;<span class="op" id="6530932">:=</span>&nbsp;<span class="ident" id="6530935">Writer</span><span class="op" id="6530941">{</span><span class="ident" id="6530942">w</span><span class="op" id="6530943">:</span>&nbsp;<span class="ident" id="6530945">buf</span><span class="op" id="6530948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6530951">if</span>&nbsp;<span class="ident" id="6530954">err</span>&nbsp;<span class="op" id="6530958">=</span>&nbsp;<span class="ident" id="6530960">c</span><span class="op" id="6530961">.</span><span class="ident" id="6530962">writeString</span><span class="op" id="6530973">(</span><span class="ident" id="6530974">utf8</span><span class="op" id="6530978">)</span><span class="op" id="6530979">;</span>&nbsp;<span class="ident" id="6530981">err</span>&nbsp;<span class="op" id="6530985">!=</span>&nbsp;<span class="ident" id="6530988">nil</span>&nbsp;<span class="op" id="6530992">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6530996">t</span><span class="op" id="6530997">.</span><span class="ident" id="6530998">Fatalf</span><span class="op" id="6531004">(</span><span class="string" id="6531005">&#34;writeString:&nbsp;%v&#34;</span><span class="op" id="6531022">,</span>&nbsp;<span class="ident" id="6531024">err</span><span class="op" id="6531027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531033">s</span>&nbsp;<span class="op" id="6531035">=</span>&nbsp;<span class="ident" id="6531037">buf</span><span class="op" id="6531040">.</span><span class="ident" id="6531041">String</span><span class="op" id="6531047">(</span><span class="op" id="6531048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6531051">if</span>&nbsp;<span class="ident" id="6531054">s</span>&nbsp;<span class="op" id="6531056">!=</span>&nbsp;<span class="builtintype" id="6531059">string</span><span class="op" id="6531065">(</span><span class="ident" id="6531066">latin1</span><span class="op" id="6531072">)</span>&nbsp;<span class="op" id="6531074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531078">t</span><span class="op" id="6531079">.</span><span class="ident" id="6531080">Fatalf</span><span class="op" id="6531086">(</span><span class="string" id="6531087">&#34;write&nbsp;utf-8:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6531117">,</span>&nbsp;<span class="ident" id="6531119">s</span><span class="op" id="6531120">,</span>&nbsp;<span class="builtintype" id="6531122">string</span><span class="op" id="6531128">(</span><span class="ident" id="6531129">latin1</span><span class="op" id="6531135">)</span><span class="op" id="6531136">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531139">}</span><br>
<span class="lineno"></span><span class="op" id="6531141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6531144">//&nbsp;TestLatin1RoundTrip&nbsp;tests&nbsp;that&nbsp;metadata&nbsp;that&nbsp;is&nbsp;representable&nbsp;in&nbsp;Latin-1</span><br>
<span class="lineno"></span><span class="comment" id="6531220">//&nbsp;survives&nbsp;a&nbsp;round&nbsp;trip.</span><br>
<span class="lineno">110</span><span class="keyword" id="6531246">func</span>&nbsp;<span class="ident" id="6531251">TestLatin1RoundTrip</span><span class="op" id="6531270">(</span><span class="ident" id="6531271">t</span>&nbsp;<span class="op" id="6531273">*</span><span class="ident" id="6531274">testing</span><span class="op" id="6531281">.</span><span class="ident" id="6531282">T</span><span class="op" id="6531283">)</span>&nbsp;<span class="op" id="6531285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531288">testCases</span>&nbsp;<span class="op" id="6531298">:=</span>&nbsp;<span class="op" id="6531301">[</span><span class="op" id="6531302">]</span><span class="keyword" id="6531303">struct</span>&nbsp;<span class="op" id="6531310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531314">name</span>&nbsp;<span class="builtintype" id="6531319">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531328">ok</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6531333">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531339">}</span><span class="op" id="6531340">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531344">{</span><span class="string" id="6531345">&#34;&#34;</span><span class="op" id="6531347">,</span>&nbsp;<span class="builtintype" id="6531349">true</span><span class="op" id="6531353">}</span><span class="op" id="6531354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531358">{</span><span class="string" id="6531359">&#34;ASCII&nbsp;is&nbsp;OK&#34;</span><span class="op" id="6531372">,</span>&nbsp;<span class="builtintype" id="6531374">true</span><span class="op" id="6531378">}</span><span class="op" id="6531379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531383">{</span><span class="string" id="6531384">&#34;unless&nbsp;it&nbsp;contains&nbsp;a&nbsp;NUL\x00&#34;</span><span class="op" id="6531414">,</span>&nbsp;<span class="builtintype" id="6531416">false</span><span class="op" id="6531421">}</span><span class="op" id="6531422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531426">{</span><span class="string" id="6531427">&#34;no&nbsp;matter&nbsp;where&nbsp;\x00&nbsp;occurs&#34;</span><span class="op" id="6531456">,</span>&nbsp;<span class="builtintype" id="6531458">false</span><span class="op" id="6531463">}</span><span class="op" id="6531464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531468">{</span><span class="string" id="6531469">&#34;\x00\x00\x00&#34;</span><span class="op" id="6531483">,</span>&nbsp;<span class="builtintype" id="6531485">false</span><span class="op" id="6531490">}</span><span class="op" id="6531491">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531495">{</span><span class="string" id="6531496">&#34;Látin-1&nbsp;also&nbsp;passes&nbsp;(U+00E1)&#34;</span><span class="op" id="6531527">,</span>&nbsp;<span class="builtintype" id="6531529">true</span><span class="op" id="6531533">}</span><span class="op" id="6531534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531538">{</span><span class="string" id="6531539">&#34;but&nbsp;LĀtin&nbsp;Extended-A&nbsp;(U+0100)&nbsp;does&nbsp;not&#34;</span><span class="op" id="6531580">,</span>&nbsp;<span class="builtintype" id="6531582">false</span><span class="op" id="6531587">}</span><span class="op" id="6531588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531592">{</span><span class="string" id="6531593">&#34;neither&nbsp;does&nbsp;日本語&#34;</span><span class="op" id="6531617">,</span>&nbsp;<span class="builtintype" id="6531619">false</span><span class="op" id="6531624">}</span><span class="op" id="6531625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531629">{</span><span class="string" id="6531630">&#34;invalid&nbsp;UTF-8&nbsp;also&nbsp;\xffails&#34;</span><span class="op" id="6531659">,</span>&nbsp;<span class="builtintype" id="6531661">false</span><span class="op" id="6531666">}</span><span class="op" id="6531667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531671">{</span><span class="string" id="6531672">&#34;\x00&nbsp;as&nbsp;does&nbsp;Látin-1&nbsp;with&nbsp;NUL&#34;</span><span class="op" id="6531704">,</span>&nbsp;<span class="builtintype" id="6531706">false</span><span class="op" id="6531711">}</span><span class="op" id="6531712">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6531718">for</span>&nbsp;<span class="ident" id="6531722">_</span><span class="op" id="6531723">,</span>&nbsp;<span class="ident" id="6531725">tc</span>&nbsp;<span class="op" id="6531728">:=</span>&nbsp;<span class="keyword" id="6531731">range</span>&nbsp;<span class="ident" id="6531737">testCases</span>&nbsp;<span class="op" id="6531747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531751">buf</span>&nbsp;<span class="op" id="6531755">:=</span>&nbsp;<span class="builtinfunc" id="6531758">new</span><span class="op" id="6531761">(</span><span class="ident" id="6531762">bytes</span><span class="op" id="6531767">.</span><span class="ident" id="6531768">Buffer</span><span class="op" id="6531774">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531779">w</span>&nbsp;<span class="op" id="6531781">:=</span>&nbsp;<span class="ident" id="6531784">NewWriter</span><span class="op" id="6531793">(</span><span class="ident" id="6531794">buf</span><span class="op" id="6531797">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531801">w</span><span class="op" id="6531802">.</span><span class="ident" id="6531803">Name</span>&nbsp;<span class="op" id="6531808">=</span>&nbsp;<span class="ident" id="6531810">tc</span><span class="op" id="6531812">.</span><span class="ident" id="6531813">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531820">err</span>&nbsp;<span class="op" id="6531824">:=</span>&nbsp;<span class="ident" id="6531827">w</span><span class="op" id="6531828">.</span><span class="ident" id="6531829">Close</span><span class="op" id="6531834">(</span><span class="op" id="6531835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6531839">if</span>&nbsp;<span class="op" id="6531842">(</span><span class="ident" id="6531843">err</span>&nbsp;<span class="op" id="6531847">==</span>&nbsp;<span class="ident" id="6531850">nil</span><span class="op" id="6531853">)</span>&nbsp;<span class="op" id="6531855">!=</span>&nbsp;<span class="ident" id="6531858">tc</span><span class="op" id="6531860">.</span><span class="ident" id="6531861">ok</span>&nbsp;<span class="op" id="6531864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531869">t</span><span class="op" id="6531870">.</span><span class="ident" id="6531871">Errorf</span><span class="op" id="6531877">(</span><span class="string" id="6531878">&#34;Writer.Close:&nbsp;name&nbsp;=&nbsp;%q,&nbsp;err&nbsp;=&nbsp;%v&#34;</span><span class="op" id="6531913">,</span>&nbsp;<span class="ident" id="6531915">tc</span><span class="op" id="6531917">.</span><span class="ident" id="6531918">name</span><span class="op" id="6531922">,</span>&nbsp;<span class="ident" id="6531924">err</span><span class="op" id="6531927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6531932">continue</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6531947">if</span>&nbsp;<span class="op" id="6531950">!</span><span class="ident" id="6531951">tc</span><span class="op" id="6531953">.</span><span class="ident" id="6531954">ok</span>&nbsp;<span class="op" id="6531957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6531962">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6531973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531978">r</span><span class="op" id="6531979">,</span>&nbsp;<span class="ident" id="6531981">err</span>&nbsp;<span class="op" id="6531985">:=</span>&nbsp;<span class="ident" id="6531988">NewReader</span><span class="op" id="6531997">(</span><span class="ident" id="6531998">buf</span><span class="op" id="6532001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532005">if</span>&nbsp;<span class="ident" id="6532008">err</span>&nbsp;<span class="op" id="6532012">!=</span>&nbsp;<span class="ident" id="6532015">nil</span>&nbsp;<span class="op" id="6532019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532024">t</span><span class="op" id="6532025">.</span><span class="ident" id="6532026">Errorf</span><span class="op" id="6532032">(</span><span class="string" id="6532033">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6532048">,</span>&nbsp;<span class="ident" id="6532050">err</span><span class="op" id="6532053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532058">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532069">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532073">_</span><span class="op" id="6532074">,</span>&nbsp;<span class="ident" id="6532076">err</span>&nbsp;<span class="op" id="6532080">=</span>&nbsp;<span class="ident" id="6532082">ioutil</span><span class="op" id="6532088">.</span><span class="ident" id="6532089">ReadAll</span><span class="op" id="6532096">(</span><span class="ident" id="6532097">r</span><span class="op" id="6532098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532102">if</span>&nbsp;<span class="ident" id="6532105">err</span>&nbsp;<span class="op" id="6532109">!=</span>&nbsp;<span class="ident" id="6532112">nil</span>&nbsp;<span class="op" id="6532116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532121">t</span><span class="op" id="6532122">.</span><span class="ident" id="6532123">Errorf</span><span class="op" id="6532129">(</span><span class="string" id="6532130">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="6532143">,</span>&nbsp;<span class="ident" id="6532145">err</span><span class="op" id="6532148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532153">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532164">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532168">if</span>&nbsp;<span class="ident" id="6532171">r</span><span class="op" id="6532172">.</span><span class="ident" id="6532173">Name</span>&nbsp;<span class="op" id="6532178">!=</span>&nbsp;<span class="ident" id="6532181">tc</span><span class="op" id="6532183">.</span><span class="ident" id="6532184">name</span>&nbsp;<span class="op" id="6532189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532194">t</span><span class="op" id="6532195">.</span><span class="ident" id="6532196">Errorf</span><span class="op" id="6532202">(</span><span class="string" id="6532203">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6532224">,</span>&nbsp;<span class="ident" id="6532226">r</span><span class="op" id="6532227">.</span><span class="ident" id="6532228">Name</span><span class="op" id="6532232">,</span>&nbsp;<span class="ident" id="6532234">tc</span><span class="op" id="6532236">.</span><span class="ident" id="6532237">name</span><span class="op" id="6532241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532246">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532261">if</span>&nbsp;<span class="ident" id="6532264">err</span>&nbsp;<span class="op" id="6532268">:=</span>&nbsp;<span class="ident" id="6532271">r</span><span class="op" id="6532272">.</span><span class="ident" id="6532273">Close</span><span class="op" id="6532278">(</span><span class="op" id="6532279">)</span><span class="op" id="6532280">;</span>&nbsp;<span class="ident" id="6532282">err</span>&nbsp;<span class="op" id="6532286">!=</span>&nbsp;<span class="ident" id="6532289">nil</span>&nbsp;<span class="op" id="6532293">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532298">t</span><span class="op" id="6532299">.</span><span class="ident" id="6532300">Errorf</span><span class="op" id="6532306">(</span><span class="string" id="6532307">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="6532325">,</span>&nbsp;<span class="ident" id="6532327">err</span><span class="op" id="6532330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532335">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532349">}</span><br>
<span class="lineno"></span><span class="op" id="6532351">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="6532354">func</span>&nbsp;<span class="ident" id="6532359">TestWriterFlush</span><span class="op" id="6532374">(</span><span class="ident" id="6532375">t</span>&nbsp;<span class="op" id="6532377">*</span><span class="ident" id="6532378">testing</span><span class="op" id="6532385">.</span><span class="ident" id="6532386">T</span><span class="op" id="6532387">)</span>&nbsp;<span class="op" id="6532389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532392">buf</span>&nbsp;<span class="op" id="6532396">:=</span>&nbsp;<span class="builtinfunc" id="6532399">new</span><span class="op" id="6532402">(</span><span class="ident" id="6532403">bytes</span><span class="op" id="6532408">.</span><span class="ident" id="6532409">Buffer</span><span class="op" id="6532415">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532419">w</span>&nbsp;<span class="op" id="6532421">:=</span>&nbsp;<span class="ident" id="6532424">NewWriter</span><span class="op" id="6532433">(</span><span class="ident" id="6532434">buf</span><span class="op" id="6532437">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532440">w</span><span class="op" id="6532441">.</span><span class="ident" id="6532442">Comment</span>&nbsp;<span class="op" id="6532450">=</span>&nbsp;<span class="string" id="6532452">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532463">w</span><span class="op" id="6532464">.</span><span class="ident" id="6532465">Extra</span>&nbsp;<span class="op" id="6532471">=</span>&nbsp;<span class="op" id="6532473">[</span><span class="op" id="6532474">]</span><span class="builtintype" id="6532475">byte</span><span class="op" id="6532479">(</span><span class="string" id="6532480">&#34;extra&#34;</span><span class="op" id="6532487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532490">w</span><span class="op" id="6532491">.</span><span class="ident" id="6532492">ModTime</span>&nbsp;<span class="op" id="6532500">=</span>&nbsp;<span class="ident" id="6532502">time</span><span class="op" id="6532506">.</span><span class="ident" id="6532507">Unix</span><span class="op" id="6532511">(</span><span class="num" id="6532512">1e8</span><span class="op" id="6532515">,</span>&nbsp;<span class="num" id="6532517">0</span><span class="op" id="6532518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532521">w</span><span class="op" id="6532522">.</span><span class="ident" id="6532523">Name</span>&nbsp;<span class="op" id="6532528">=</span>&nbsp;<span class="string" id="6532530">&#34;name&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532539">n0</span>&nbsp;<span class="op" id="6532542">:=</span>&nbsp;<span class="ident" id="6532545">buf</span><span class="op" id="6532548">.</span><span class="ident" id="6532549">Len</span><span class="op" id="6532552">(</span><span class="op" id="6532553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532556">if</span>&nbsp;<span class="ident" id="6532559">n0</span>&nbsp;<span class="op" id="6532562">!=</span>&nbsp;<span class="num" id="6532565">0</span>&nbsp;<span class="op" id="6532567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532571">t</span><span class="op" id="6532572">.</span><span class="ident" id="6532573">Fatalf</span><span class="op" id="6532579">(</span><span class="string" id="6532580">&#34;buffer&nbsp;size&nbsp;=&nbsp;%d&nbsp;before&nbsp;writes;&nbsp;want&nbsp;0&#34;</span><span class="op" id="6532620">,</span>&nbsp;<span class="ident" id="6532622">n0</span><span class="op" id="6532624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532631">if</span>&nbsp;<span class="ident" id="6532634">err</span>&nbsp;<span class="op" id="6532638">:=</span>&nbsp;<span class="ident" id="6532641">w</span><span class="op" id="6532642">.</span><span class="ident" id="6532643">Flush</span><span class="op" id="6532648">(</span><span class="op" id="6532649">)</span><span class="op" id="6532650">;</span>&nbsp;<span class="ident" id="6532652">err</span>&nbsp;<span class="op" id="6532656">!=</span>&nbsp;<span class="ident" id="6532659">nil</span>&nbsp;<span class="op" id="6532663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532667">t</span><span class="op" id="6532668">.</span><span class="ident" id="6532669">Fatal</span><span class="op" id="6532674">(</span><span class="ident" id="6532675">err</span><span class="op" id="6532678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532685">n1</span>&nbsp;<span class="op" id="6532688">:=</span>&nbsp;<span class="ident" id="6532691">buf</span><span class="op" id="6532694">.</span><span class="ident" id="6532695">Len</span><span class="op" id="6532698">(</span><span class="op" id="6532699">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532702">if</span>&nbsp;<span class="ident" id="6532705">n1</span>&nbsp;<span class="op" id="6532708">==</span>&nbsp;<span class="num" id="6532711">0</span>&nbsp;<span class="op" id="6532713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532717">t</span><span class="op" id="6532718">.</span><span class="ident" id="6532719">Fatal</span><span class="op" id="6532724">(</span><span class="string" id="6532725">&#34;no&nbsp;data&nbsp;after&nbsp;first&nbsp;flush&#34;</span><span class="op" id="6532752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532759">w</span><span class="op" id="6532760">.</span><span class="ident" id="6532761">Write</span><span class="op" id="6532766">(</span><span class="op" id="6532767">[</span><span class="op" id="6532768">]</span><span class="builtintype" id="6532769">byte</span><span class="op" id="6532773">(</span><span class="string" id="6532774">&#34;x&#34;</span><span class="op" id="6532777">)</span><span class="op" id="6532778">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532782">n2</span>&nbsp;<span class="op" id="6532785">:=</span>&nbsp;<span class="ident" id="6532788">buf</span><span class="op" id="6532791">.</span><span class="ident" id="6532792">Len</span><span class="op" id="6532795">(</span><span class="op" id="6532796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532799">if</span>&nbsp;<span class="ident" id="6532802">n1</span>&nbsp;<span class="op" id="6532805">!=</span>&nbsp;<span class="ident" id="6532808">n2</span>&nbsp;<span class="op" id="6532811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532815">t</span><span class="op" id="6532816">.</span><span class="ident" id="6532817">Fatalf</span><span class="op" id="6532823">(</span><span class="string" id="6532824">&#34;after&nbsp;writing&nbsp;a&nbsp;single&nbsp;byte,&nbsp;size&nbsp;changed&nbsp;from&nbsp;%d&nbsp;to&nbsp;%d;&nbsp;want&nbsp;no&nbsp;change&#34;</span><span class="op" id="6532897">,</span>&nbsp;<span class="ident" id="6532899">n1</span><span class="op" id="6532901">,</span>&nbsp;<span class="ident" id="6532903">n2</span><span class="op" id="6532905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532908">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532912">if</span>&nbsp;<span class="ident" id="6532915">err</span>&nbsp;<span class="op" id="6532919">:=</span>&nbsp;<span class="ident" id="6532922">w</span><span class="op" id="6532923">.</span><span class="ident" id="6532924">Flush</span><span class="op" id="6532929">(</span><span class="op" id="6532930">)</span><span class="op" id="6532931">;</span>&nbsp;<span class="ident" id="6532933">err</span>&nbsp;<span class="op" id="6532937">!=</span>&nbsp;<span class="ident" id="6532940">nil</span>&nbsp;<span class="op" id="6532944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532948">t</span><span class="op" id="6532949">.</span><span class="ident" id="6532950">Fatal</span><span class="op" id="6532955">(</span><span class="ident" id="6532956">err</span><span class="op" id="6532959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532966">n3</span>&nbsp;<span class="op" id="6532969">:=</span>&nbsp;<span class="ident" id="6532972">buf</span><span class="op" id="6532975">.</span><span class="ident" id="6532976">Len</span><span class="op" id="6532979">(</span><span class="op" id="6532980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532983">if</span>&nbsp;<span class="ident" id="6532986">n2</span>&nbsp;<span class="op" id="6532989">==</span>&nbsp;<span class="ident" id="6532992">n3</span>&nbsp;<span class="op" id="6532995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532999">t</span><span class="op" id="6533000">.</span><span class="ident" id="6533001">Fatal</span><span class="op" id="6533006">(</span><span class="string" id="6533007">&#34;Flush&nbsp;didn&#39;t&nbsp;flush&nbsp;any&nbsp;data&#34;</span><span class="op" id="6533036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6533039">}</span><br>
<span class="lineno"></span><span class="op" id="6533041">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="6533044">//&nbsp;Multiple&nbsp;gzip&nbsp;files&nbsp;concatenated&nbsp;form&nbsp;a&nbsp;valid&nbsp;gzip&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6533104">func</span>&nbsp;<span class="ident" id="6533109">TestConcat</span><span class="op" id="6533119">(</span><span class="ident" id="6533120">t</span>&nbsp;<span class="op" id="6533122">*</span><span class="ident" id="6533123">testing</span><span class="op" id="6533130">.</span><span class="ident" id="6533131">T</span><span class="op" id="6533132">)</span>&nbsp;<span class="op" id="6533134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533137">var</span>&nbsp;<span class="ident" id="6533141">buf</span>&nbsp;<span class="ident" id="6533145">bytes</span><span class="op" id="6533150">.</span><span class="ident" id="6533151">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533159">w</span>&nbsp;<span class="op" id="6533161">:=</span>&nbsp;<span class="ident" id="6533164">NewWriter</span><span class="op" id="6533173">(</span><span class="op" id="6533174">&amp;</span><span class="ident" id="6533175">buf</span><span class="op" id="6533178">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533181">w</span><span class="op" id="6533182">.</span><span class="ident" id="6533183">Write</span><span class="op" id="6533188">(</span><span class="op" id="6533189">[</span><span class="op" id="6533190">]</span><span class="builtintype" id="6533191">byte</span><span class="op" id="6533195">(</span><span class="string" id="6533196">&#34;hello&nbsp;&#34;</span><span class="op" id="6533204">)</span><span class="op" id="6533205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533208">w</span><span class="op" id="6533209">.</span><span class="ident" id="6533210">Close</span><span class="op" id="6533215">(</span><span class="op" id="6533216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533219">w</span>&nbsp;<span class="op" id="6533221">=</span>&nbsp;<span class="ident" id="6533223">NewWriter</span><span class="op" id="6533232">(</span><span class="op" id="6533233">&amp;</span><span class="ident" id="6533234">buf</span><span class="op" id="6533237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533240">w</span><span class="op" id="6533241">.</span><span class="ident" id="6533242">Write</span><span class="op" id="6533247">(</span><span class="op" id="6533248">[</span><span class="op" id="6533249">]</span><span class="builtintype" id="6533250">byte</span><span class="op" id="6533254">(</span><span class="string" id="6533255">&#34;world\n&#34;</span><span class="op" id="6533264">)</span><span class="op" id="6533265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533268">w</span><span class="op" id="6533269">.</span><span class="ident" id="6533270">Close</span><span class="op" id="6533275">(</span><span class="op" id="6533276">)</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533280">r</span><span class="op" id="6533281">,</span>&nbsp;<span class="ident" id="6533283">err</span>&nbsp;<span class="op" id="6533287">:=</span>&nbsp;<span class="ident" id="6533290">NewReader</span><span class="op" id="6533299">(</span><span class="op" id="6533300">&amp;</span><span class="ident" id="6533301">buf</span><span class="op" id="6533304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533307">data</span><span class="op" id="6533311">,</span>&nbsp;<span class="ident" id="6533313">err</span>&nbsp;<span class="op" id="6533317">:=</span>&nbsp;<span class="ident" id="6533320">ioutil</span><span class="op" id="6533326">.</span><span class="ident" id="6533327">ReadAll</span><span class="op" id="6533334">(</span><span class="ident" id="6533335">r</span><span class="op" id="6533336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533339">if</span>&nbsp;<span class="builtintype" id="6533342">string</span><span class="op" id="6533348">(</span><span class="ident" id="6533349">data</span><span class="op" id="6533353">)</span>&nbsp;<span class="op" id="6533355">!=</span>&nbsp;<span class="string" id="6533358">&#34;hello&nbsp;world\n&#34;</span>&nbsp;<span class="op" id="6533374">||</span>&nbsp;<span class="ident" id="6533377">err</span>&nbsp;<span class="op" id="6533381">!=</span>&nbsp;<span class="ident" id="6533384">nil</span>&nbsp;<span class="op" id="6533388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533392">t</span><span class="op" id="6533393">.</span><span class="ident" id="6533394">Fatalf</span><span class="op" id="6533400">(</span><span class="string" id="6533401">&#34;ReadAll&nbsp;=&nbsp;%q,&nbsp;%v,&nbsp;want&nbsp;%q,&nbsp;nil&#34;</span><span class="op" id="6533433">,</span>&nbsp;<span class="ident" id="6533435">data</span><span class="op" id="6533439">,</span>&nbsp;<span class="ident" id="6533441">err</span><span class="op" id="6533444">,</span>&nbsp;<span class="string" id="6533446">&#34;hello&nbsp;world&#34;</span><span class="op" id="6533459">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6533462">}</span><br>
<span class="lineno"></span><span class="op" id="6533464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6533467">func</span>&nbsp;<span class="ident" id="6533472">TestWriterReset</span><span class="op" id="6533487">(</span><span class="ident" id="6533488">t</span>&nbsp;<span class="op" id="6533490">*</span><span class="ident" id="6533491">testing</span><span class="op" id="6533498">.</span><span class="ident" id="6533499">T</span><span class="op" id="6533500">)</span>&nbsp;<span class="op" id="6533502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533505">buf</span>&nbsp;<span class="op" id="6533509">:=</span>&nbsp;<span class="builtinfunc" id="6533512">new</span><span class="op" id="6533515">(</span><span class="ident" id="6533516">bytes</span><span class="op" id="6533521">.</span><span class="ident" id="6533522">Buffer</span><span class="op" id="6533528">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533531">buf2</span>&nbsp;<span class="op" id="6533536">:=</span>&nbsp;<span class="builtinfunc" id="6533539">new</span><span class="op" id="6533542">(</span><span class="ident" id="6533543">bytes</span><span class="op" id="6533548">.</span><span class="ident" id="6533549">Buffer</span><span class="op" id="6533555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533558">z</span>&nbsp;<span class="op" id="6533560">:=</span>&nbsp;<span class="ident" id="6533563">NewWriter</span><span class="op" id="6533572">(</span><span class="ident" id="6533573">buf</span><span class="op" id="6533576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533579">msg</span>&nbsp;<span class="op" id="6533583">:=</span>&nbsp;<span class="op" id="6533586">[</span><span class="op" id="6533587">]</span><span class="builtintype" id="6533588">byte</span><span class="op" id="6533592">(</span><span class="string" id="6533593">&#34;hello&nbsp;world&#34;</span><span class="op" id="6533606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533609">z</span><span class="op" id="6533610">.</span><span class="ident" id="6533611">Write</span><span class="op" id="6533616">(</span><span class="ident" id="6533617">msg</span><span class="op" id="6533620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533623">z</span><span class="op" id="6533624">.</span><span class="ident" id="6533625">Close</span><span class="op" id="6533630">(</span><span class="op" id="6533631">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533634">z</span><span class="op" id="6533635">.</span><span class="ident" id="6533636">Reset</span><span class="op" id="6533641">(</span><span class="ident" id="6533642">buf2</span><span class="op" id="6533646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533649">z</span><span class="op" id="6533650">.</span><span class="ident" id="6533651">Write</span><span class="op" id="6533656">(</span><span class="ident" id="6533657">msg</span><span class="op" id="6533660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533663">z</span><span class="op" id="6533664">.</span><span class="ident" id="6533665">Close</span><span class="op" id="6533670">(</span><span class="op" id="6533671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533674">if</span>&nbsp;<span class="ident" id="6533677">buf</span><span class="op" id="6533680">.</span><span class="ident" id="6533681">String</span><span class="op" id="6533687">(</span><span class="op" id="6533688">)</span>&nbsp;<span class="op" id="6533690">!=</span>&nbsp;<span class="ident" id="6533693">buf2</span><span class="op" id="6533697">.</span><span class="ident" id="6533698">String</span><span class="op" id="6533704">(</span><span class="op" id="6533705">)</span>&nbsp;<span class="op" id="6533707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533711">t</span><span class="op" id="6533712">.</span><span class="ident" id="6533713">Errorf</span><span class="op" id="6533719">(</span><span class="string" id="6533720">&#34;buf2&nbsp;%q&nbsp;!=&nbsp;original&nbsp;buf&nbsp;of&nbsp;%q&#34;</span><span class="op" id="6533751">,</span>&nbsp;<span class="ident" id="6533753">buf2</span><span class="op" id="6533757">.</span><span class="ident" id="6533758">String</span><span class="op" id="6533764">(</span><span class="op" id="6533765">)</span><span class="op" id="6533766">,</span>&nbsp;<span class="ident" id="6533768">buf</span><span class="op" id="6533771">.</span><span class="ident" id="6533772">String</span><span class="op" id="6533778">(</span><span class="op" id="6533779">)</span><span class="op" id="6533780">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6533783">}</span><br>
<span class="lineno"></span><span class="op" id="6533785">}</span>
</div>
</body>
</html>
