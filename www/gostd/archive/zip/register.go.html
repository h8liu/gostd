<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html" class="current">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5420381">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5420436">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5420490">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5420541">package</span>&nbsp;<span class="ident" id="5420549">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5420554">import</span>&nbsp;<span class="op" id="5420561">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5420564">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5420582">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5420592">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5420598">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5420611">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5420618">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5420621">//&nbsp;A&nbsp;Compressor&nbsp;returns&nbsp;a&nbsp;compressing&nbsp;writer,&nbsp;writing&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5420682">//&nbsp;provided&nbsp;writer.&nbsp;On&nbsp;Close,&nbsp;any&nbsp;pending&nbsp;data&nbsp;should&nbsp;be&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5420748">type</span>&nbsp;<span class="ident" id="5420753">Compressor</span>&nbsp;<span class="keyword" id="5420764">func</span><span class="op" id="5420768">(</span><span class="ident" id="5420769">io</span><span class="op" id="5420771">.</span><span class="ident" id="5420772">Writer</span><span class="op" id="5420778">)</span>&nbsp;<span class="op" id="5420780">(</span><span class="ident" id="5420781">io</span><span class="op" id="5420783">.</span><span class="ident" id="5420784">WriteCloser</span><span class="op" id="5420795">,</span>&nbsp;<span class="builtintype" id="5420797">error</span><span class="op" id="5420802">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5420805">//&nbsp;Decompressor&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;wraps&nbsp;a&nbsp;Reader&nbsp;with&nbsp;a&nbsp;decompressing&nbsp;Reader.</span><br>
<span class="lineno">20</span><span class="comment" id="5420884">//&nbsp;The&nbsp;decompressed&nbsp;ReadCloser&nbsp;is&nbsp;returned&nbsp;to&nbsp;callers&nbsp;who&nbsp;open&nbsp;files&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5420958">//&nbsp;within&nbsp;the&nbsp;archive.&nbsp;&nbsp;These&nbsp;callers&nbsp;are&nbsp;responsible&nbsp;for&nbsp;closing&nbsp;this&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="5421036">//&nbsp;when&nbsp;they&#39;re&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="keyword" id="5421070">type</span>&nbsp;<span class="ident" id="5421075">Decompressor</span>&nbsp;<span class="keyword" id="5421088">func</span><span class="op" id="5421092">(</span><span class="ident" id="5421093">io</span><span class="op" id="5421095">.</span><span class="ident" id="5421096">Reader</span><span class="op" id="5421102">)</span>&nbsp;<span class="ident" id="5421104">io</span><span class="op" id="5421106">.</span><span class="ident" id="5421107">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5421119">var</span>&nbsp;<span class="ident" id="5421123">flateWriterPool</span>&nbsp;<span class="ident" id="5421139">sync</span><span class="op" id="5421143">.</span><span class="ident" id="5421144">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5421150">func</span>&nbsp;<span class="ident" id="5421155">newFlateWriter</span><span class="op" id="5421169">(</span><span class="ident" id="5421170">w</span>&nbsp;<span class="ident" id="5421172">io</span><span class="op" id="5421174">.</span><span class="ident" id="5421175">Writer</span><span class="op" id="5421181">)</span>&nbsp;<span class="ident" id="5421183">io</span><span class="op" id="5421185">.</span><span class="ident" id="5421186">WriteCloser</span>&nbsp;<span class="op" id="5421198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421201">fw</span><span class="op" id="5421203">,</span>&nbsp;<span class="ident" id="5421205">ok</span>&nbsp;<span class="op" id="5421208">:=</span>&nbsp;<span class="ident" id="5421211">flateWriterPool</span><span class="op" id="5421226">.</span><span class="ident" id="5421227">Get</span><span class="op" id="5421230">(</span><span class="op" id="5421231">)</span><span class="op" id="5421232">.</span><span class="op" id="5421233">(</span><span class="op" id="5421234">*</span><span class="ident" id="5421235">flate</span><span class="op" id="5421240">.</span><span class="ident" id="5421241">Writer</span><span class="op" id="5421247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421250">if</span>&nbsp;<span class="ident" id="5421253">ok</span>&nbsp;<span class="op" id="5421256">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421260">fw</span><span class="op" id="5421262">.</span><span class="ident" id="5421263">Reset</span><span class="op" id="5421268">(</span><span class="ident" id="5421269">w</span><span class="op" id="5421270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5421273">}</span>&nbsp;<span class="keyword" id="5421275">else</span>&nbsp;<span class="op" id="5421280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421284">fw</span><span class="op" id="5421286">,</span>&nbsp;<span class="ident" id="5421288">_</span>&nbsp;<span class="op" id="5421290">=</span>&nbsp;<span class="ident" id="5421292">flate</span><span class="op" id="5421297">.</span><span class="ident" id="5421298">NewWriter</span><span class="op" id="5421307">(</span><span class="ident" id="5421308">w</span><span class="op" id="5421309">,</span>&nbsp;<span class="num" id="5421311">5</span><span class="op" id="5421312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5421315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421318">return</span>&nbsp;<span class="op" id="5421325">&amp;</span><span class="ident" id="5421326">pooledFlateWriter</span><span class="op" id="5421343">{</span><span class="ident" id="5421344">fw</span><span class="op" id="5421346">:</span>&nbsp;<span class="ident" id="5421348">fw</span><span class="op" id="5421350">}</span><br>
<span class="lineno">35</span><span class="op" id="5421352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5421355">type</span>&nbsp;<span class="ident" id="5421360">pooledFlateWriter</span>&nbsp;<span class="keyword" id="5421378">struct</span>&nbsp;<span class="op" id="5421385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421388">mu</span>&nbsp;<span class="ident" id="5421391">sync</span><span class="op" id="5421395">.</span><span class="ident" id="5421396">Mutex</span>&nbsp;<span class="comment" id="5421402">//&nbsp;guards&nbsp;Close&nbsp;and&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421429">fw</span>&nbsp;<span class="op" id="5421432">*</span><span class="ident" id="5421433">flate</span><span class="op" id="5421438">.</span><span class="ident" id="5421439">Writer</span><br>
<span class="lineno">40</span><span class="op" id="5421446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5421449">func</span>&nbsp;<span class="op" id="5421454">(</span><span class="ident" id="5421455">w</span>&nbsp;<span class="op" id="5421457">*</span><span class="ident" id="5421458">pooledFlateWriter</span><span class="op" id="5421475">)</span>&nbsp;<span class="ident" id="5421477">Write</span><span class="op" id="5421482">(</span><span class="ident" id="5421483">p</span>&nbsp;<span class="op" id="5421485">[</span><span class="op" id="5421486">]</span><span class="builtintype" id="5421487">byte</span><span class="op" id="5421491">)</span>&nbsp;<span class="op" id="5421493">(</span><span class="ident" id="5421494">n</span>&nbsp;<span class="builtintype" id="5421496">int</span><span class="op" id="5421499">,</span>&nbsp;<span class="ident" id="5421501">err</span>&nbsp;<span class="builtintype" id="5421505">error</span><span class="op" id="5421510">)</span>&nbsp;<span class="op" id="5421512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421515">w</span><span class="op" id="5421516">.</span><span class="ident" id="5421517">mu</span><span class="op" id="5421519">.</span><span class="ident" id="5421520">Lock</span><span class="op" id="5421524">(</span><span class="op" id="5421525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421528">defer</span>&nbsp;<span class="ident" id="5421534">w</span><span class="op" id="5421535">.</span><span class="ident" id="5421536">mu</span><span class="op" id="5421538">.</span><span class="ident" id="5421539">Unlock</span><span class="op" id="5421545">(</span><span class="op" id="5421546">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421549">if</span>&nbsp;<span class="ident" id="5421552">w</span><span class="op" id="5421553">.</span><span class="ident" id="5421554">fw</span>&nbsp;<span class="op" id="5421557">==</span>&nbsp;<span class="builtintype" id="5421560">nil</span>&nbsp;<span class="op" id="5421564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421568">return</span>&nbsp;<span class="num" id="5421575">0</span><span class="op" id="5421576">,</span>&nbsp;<span class="ident" id="5421578">errors</span><span class="op" id="5421584">.</span><span class="ident" id="5421585">New</span><span class="op" id="5421588">(</span><span class="string" id="5421589">&#34;Write&nbsp;after&nbsp;Close&#34;</span><span class="op" id="5421608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5421611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421614">return</span>&nbsp;<span class="ident" id="5421621">w</span><span class="op" id="5421622">.</span><span class="ident" id="5421623">fw</span><span class="op" id="5421625">.</span><span class="ident" id="5421626">Write</span><span class="op" id="5421631">(</span><span class="ident" id="5421632">p</span><span class="op" id="5421633">)</span><br>
<span class="lineno"></span><span class="op" id="5421635">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5421638">func</span>&nbsp;<span class="op" id="5421643">(</span><span class="ident" id="5421644">w</span>&nbsp;<span class="op" id="5421646">*</span><span class="ident" id="5421647">pooledFlateWriter</span><span class="op" id="5421664">)</span>&nbsp;<span class="ident" id="5421666">Close</span><span class="op" id="5421671">(</span><span class="op" id="5421672">)</span>&nbsp;<span class="builtintype" id="5421674">error</span>&nbsp;<span class="op" id="5421680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421683">w</span><span class="op" id="5421684">.</span><span class="ident" id="5421685">mu</span><span class="op" id="5421687">.</span><span class="ident" id="5421688">Lock</span><span class="op" id="5421692">(</span><span class="op" id="5421693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421696">defer</span>&nbsp;<span class="ident" id="5421702">w</span><span class="op" id="5421703">.</span><span class="ident" id="5421704">mu</span><span class="op" id="5421706">.</span><span class="ident" id="5421707">Unlock</span><span class="op" id="5421713">(</span><span class="op" id="5421714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421717">var</span>&nbsp;<span class="ident" id="5421721">err</span>&nbsp;<span class="builtintype" id="5421725">error</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421732">if</span>&nbsp;<span class="ident" id="5421735">w</span><span class="op" id="5421736">.</span><span class="ident" id="5421737">fw</span>&nbsp;<span class="op" id="5421740">!=</span>&nbsp;<span class="builtintype" id="5421743">nil</span>&nbsp;<span class="op" id="5421747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421751">err</span>&nbsp;<span class="op" id="5421755">=</span>&nbsp;<span class="ident" id="5421757">w</span><span class="op" id="5421758">.</span><span class="ident" id="5421759">fw</span><span class="op" id="5421761">.</span><span class="ident" id="5421762">Close</span><span class="op" id="5421767">(</span><span class="op" id="5421768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421772">flateWriterPool</span><span class="op" id="5421787">.</span><span class="ident" id="5421788">Put</span><span class="op" id="5421791">(</span><span class="ident" id="5421792">w</span><span class="op" id="5421793">.</span><span class="ident" id="5421794">fw</span><span class="op" id="5421796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421800">w</span><span class="op" id="5421801">.</span><span class="ident" id="5421802">fw</span>&nbsp;<span class="op" id="5421805">=</span>&nbsp;<span class="builtintype" id="5421807">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5421812">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421815">return</span>&nbsp;<span class="ident" id="5421822">err</span><br>
<span class="lineno"></span><span class="op" id="5421826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5421829">var</span>&nbsp;<span class="op" id="5421833">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421836">mu</span>&nbsp;<span class="ident" id="5421839">sync</span><span class="op" id="5421843">.</span><span class="ident" id="5421844">RWMutex</span>&nbsp;<span class="comment" id="5421852">//&nbsp;guards&nbsp;compressor&nbsp;and&nbsp;decompressor&nbsp;maps</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421897">compressors</span>&nbsp;<span class="op" id="5421909">=</span>&nbsp;<span class="keyword" id="5421911">map</span><span class="op" id="5421914">[</span><span class="builtintype" id="5421915">uint16</span><span class="op" id="5421921">]</span><span class="ident" id="5421922">Compressor</span><span class="op" id="5421932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421936">Store</span><span class="op" id="5421941">:</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421945">func</span><span class="op" id="5421949">(</span><span class="ident" id="5421950">w</span>&nbsp;<span class="ident" id="5421952">io</span><span class="op" id="5421954">.</span><span class="ident" id="5421955">Writer</span><span class="op" id="5421961">)</span>&nbsp;<span class="op" id="5421963">(</span><span class="ident" id="5421964">io</span><span class="op" id="5421966">.</span><span class="ident" id="5421967">WriteCloser</span><span class="op" id="5421978">,</span>&nbsp;<span class="builtintype" id="5421980">error</span><span class="op" id="5421985">)</span>&nbsp;<span class="op" id="5421987">{</span>&nbsp;<span class="keyword" id="5421989">return</span>&nbsp;<span class="op" id="5421996">&amp;</span><span class="ident" id="5421997">nopCloser</span><span class="op" id="5422006">{</span><span class="ident" id="5422007">w</span><span class="op" id="5422008">}</span><span class="op" id="5422009">,</span>&nbsp;<span class="builtintype" id="5422011">nil</span>&nbsp;<span class="op" id="5422015">}</span><span class="op" id="5422016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422020">Deflate</span><span class="op" id="5422027">:</span>&nbsp;<span class="keyword" id="5422029">func</span><span class="op" id="5422033">(</span><span class="ident" id="5422034">w</span>&nbsp;<span class="ident" id="5422036">io</span><span class="op" id="5422038">.</span><span class="ident" id="5422039">Writer</span><span class="op" id="5422045">)</span>&nbsp;<span class="op" id="5422047">(</span><span class="ident" id="5422048">io</span><span class="op" id="5422050">.</span><span class="ident" id="5422051">WriteCloser</span><span class="op" id="5422062">,</span>&nbsp;<span class="builtintype" id="5422064">error</span><span class="op" id="5422069">)</span>&nbsp;<span class="op" id="5422071">{</span>&nbsp;<span class="keyword" id="5422073">return</span>&nbsp;<span class="ident" id="5422080">newFlateWriter</span><span class="op" id="5422094">(</span><span class="ident" id="5422095">w</span><span class="op" id="5422096">)</span><span class="op" id="5422097">,</span>&nbsp;<span class="builtintype" id="5422099">nil</span>&nbsp;<span class="op" id="5422103">}</span><span class="op" id="5422104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5422107">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422111">decompressors</span>&nbsp;<span class="op" id="5422125">=</span>&nbsp;<span class="keyword" id="5422127">map</span><span class="op" id="5422130">[</span><span class="builtintype" id="5422131">uint16</span><span class="op" id="5422137">]</span><span class="ident" id="5422138">Decompressor</span><span class="op" id="5422150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422154">Store</span><span class="op" id="5422159">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5422163">ioutil</span><span class="op" id="5422169">.</span><span class="ident" id="5422170">NopCloser</span><span class="op" id="5422179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422183">Deflate</span><span class="op" id="5422190">:</span>&nbsp;<span class="ident" id="5422192">flate</span><span class="op" id="5422197">.</span><span class="ident" id="5422198">NewReader</span><span class="op" id="5422207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5422210">}</span><br>
<span class="lineno">75</span><span class="op" id="5422212">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5422215">//&nbsp;RegisterDecompressor&nbsp;allows&nbsp;custom&nbsp;decompressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="keyword" id="5422294">func</span>&nbsp;<span class="ident" id="5422299">RegisterDecompressor</span><span class="op" id="5422319">(</span><span class="ident" id="5422320">method</span>&nbsp;<span class="builtintype" id="5422327">uint16</span><span class="op" id="5422333">,</span>&nbsp;<span class="ident" id="5422335">d</span>&nbsp;<span class="ident" id="5422337">Decompressor</span><span class="op" id="5422349">)</span>&nbsp;<span class="op" id="5422351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422354">mu</span><span class="op" id="5422356">.</span><span class="ident" id="5422357">Lock</span><span class="op" id="5422361">(</span><span class="op" id="5422362">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5422365">defer</span>&nbsp;<span class="ident" id="5422371">mu</span><span class="op" id="5422373">.</span><span class="ident" id="5422374">Unlock</span><span class="op" id="5422380">(</span><span class="op" id="5422381">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5422385">if</span>&nbsp;<span class="ident" id="5422388">_</span><span class="op" id="5422389">,</span>&nbsp;<span class="ident" id="5422391">ok</span>&nbsp;<span class="op" id="5422394">:=</span>&nbsp;<span class="ident" id="5422397">decompressors</span><span class="op" id="5422410">[</span><span class="ident" id="5422411">method</span><span class="op" id="5422417">]</span><span class="op" id="5422418">;</span>&nbsp;<span class="ident" id="5422420">ok</span>&nbsp;<span class="op" id="5422423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5422427">panic</span><span class="op" id="5422432">(</span><span class="string" id="5422433">&#34;decompressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="5422466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5422469">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422472">decompressors</span><span class="op" id="5422485">[</span><span class="ident" id="5422486">method</span><span class="op" id="5422492">]</span>&nbsp;<span class="op" id="5422494">=</span>&nbsp;<span class="ident" id="5422496">d</span><br>
<span class="lineno"></span><span class="op" id="5422498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5422501">//&nbsp;RegisterCompressor&nbsp;registers&nbsp;custom&nbsp;compressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="comment" id="5422579">//&nbsp;The&nbsp;common&nbsp;methods&nbsp;Store&nbsp;and&nbsp;Deflate&nbsp;are&nbsp;built&nbsp;in.</span><br>
<span class="lineno">90</span><span class="keyword" id="5422633">func</span>&nbsp;<span class="ident" id="5422638">RegisterCompressor</span><span class="op" id="5422656">(</span><span class="ident" id="5422657">method</span>&nbsp;<span class="builtintype" id="5422664">uint16</span><span class="op" id="5422670">,</span>&nbsp;<span class="ident" id="5422672">comp</span>&nbsp;<span class="ident" id="5422677">Compressor</span><span class="op" id="5422687">)</span>&nbsp;<span class="op" id="5422689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422692">mu</span><span class="op" id="5422694">.</span><span class="ident" id="5422695">Lock</span><span class="op" id="5422699">(</span><span class="op" id="5422700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5422703">defer</span>&nbsp;<span class="ident" id="5422709">mu</span><span class="op" id="5422711">.</span><span class="ident" id="5422712">Unlock</span><span class="op" id="5422718">(</span><span class="op" id="5422719">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5422723">if</span>&nbsp;<span class="ident" id="5422726">_</span><span class="op" id="5422727">,</span>&nbsp;<span class="ident" id="5422729">ok</span>&nbsp;<span class="op" id="5422732">:=</span>&nbsp;<span class="ident" id="5422735">compressors</span><span class="op" id="5422746">[</span><span class="ident" id="5422747">method</span><span class="op" id="5422753">]</span><span class="op" id="5422754">;</span>&nbsp;<span class="ident" id="5422756">ok</span>&nbsp;<span class="op" id="5422759">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5422763">panic</span><span class="op" id="5422768">(</span><span class="string" id="5422769">&#34;compressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="5422800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5422803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422806">compressors</span><span class="op" id="5422817">[</span><span class="ident" id="5422818">method</span><span class="op" id="5422824">]</span>&nbsp;<span class="op" id="5422826">=</span>&nbsp;<span class="ident" id="5422828">comp</span><br>
<span class="lineno"></span><span class="op" id="5422833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="5422836">func</span>&nbsp;<span class="ident" id="5422841">compressor</span><span class="op" id="5422851">(</span><span class="ident" id="5422852">method</span>&nbsp;<span class="builtintype" id="5422859">uint16</span><span class="op" id="5422865">)</span>&nbsp;<span class="ident" id="5422867">Compressor</span>&nbsp;<span class="op" id="5422878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422881">mu</span><span class="op" id="5422883">.</span><span class="ident" id="5422884">RLock</span><span class="op" id="5422889">(</span><span class="op" id="5422890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5422893">defer</span>&nbsp;<span class="ident" id="5422899">mu</span><span class="op" id="5422901">.</span><span class="ident" id="5422902">RUnlock</span><span class="op" id="5422909">(</span><span class="op" id="5422910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5422913">return</span>&nbsp;<span class="ident" id="5422920">compressors</span><span class="op" id="5422931">[</span><span class="ident" id="5422932">method</span><span class="op" id="5422938">]</span><br>
<span class="lineno"></span><span class="op" id="5422940">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="5422943">func</span>&nbsp;<span class="ident" id="5422948">decompressor</span><span class="op" id="5422960">(</span><span class="ident" id="5422961">method</span>&nbsp;<span class="builtintype" id="5422968">uint16</span><span class="op" id="5422974">)</span>&nbsp;<span class="ident" id="5422976">Decompressor</span>&nbsp;<span class="op" id="5422989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422992">mu</span><span class="op" id="5422994">.</span><span class="ident" id="5422995">RLock</span><span class="op" id="5423000">(</span><span class="op" id="5423001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423004">defer</span>&nbsp;<span class="ident" id="5423010">mu</span><span class="op" id="5423012">.</span><span class="ident" id="5423013">RUnlock</span><span class="op" id="5423020">(</span><span class="op" id="5423021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423024">return</span>&nbsp;<span class="ident" id="5423031">decompressors</span><span class="op" id="5423044">[</span><span class="ident" id="5423045">method</span><span class="op" id="5423051">]</span><br>
<span class="lineno">110</span><span class="op" id="5423053">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
