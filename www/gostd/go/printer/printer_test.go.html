<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html" class="current">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7840955">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7841010">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7841064">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7841115">package</span>&nbsp;<span class="ident" id="7841123">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7841132">import</span>&nbsp;<span class="op" id="7841139">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7841142">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7841151">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7841161">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7841169">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7841176">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7841186">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7841199">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7841211">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7841224">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7841241">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7841252">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7841259">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7841262">const</span>&nbsp;<span class="op" id="7841268">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7841271">dataDir</span>&nbsp;&nbsp;<span class="op" id="7841280">=</span>&nbsp;<span class="string" id="7841282">&#34;testdata&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7841294">tabwidth</span>&nbsp;<span class="op" id="7841303">=</span>&nbsp;<span class="num" id="7841305">8</span><br>
<span class="lineno"></span><span class="op" id="7841307">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="7841310">var</span>&nbsp;<span class="ident" id="7841314">update</span>&nbsp;<span class="op" id="7841321">=</span>&nbsp;<span class="ident" id="7841323">flag</span><span class="op" id="7841327">.</span><span class="ident" id="7841328">Bool</span><span class="op" id="7841332">(</span><span class="string" id="7841333">&#34;update&#34;</span><span class="op" id="7841341">,</span>&nbsp;<span class="builtintype" id="7841343">false</span><span class="op" id="7841348">,</span>&nbsp;<span class="string" id="7841350">&#34;update&nbsp;golden&nbsp;files&#34;</span><span class="op" id="7841371">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7841374">var</span>&nbsp;<span class="ident" id="7841378">fset</span>&nbsp;<span class="op" id="7841383">=</span>&nbsp;<span class="ident" id="7841385">token</span><span class="op" id="7841390">.</span><span class="ident" id="7841391">NewFileSet</span><span class="op" id="7841401">(</span><span class="op" id="7841402">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7841405">type</span>&nbsp;<span class="ident" id="7841410">checkMode</span>&nbsp;<span class="builtintype" id="7841420">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7841426">const</span>&nbsp;<span class="op" id="7841432">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7841435">export</span>&nbsp;<span class="ident" id="7841442">checkMode</span>&nbsp;<span class="op" id="7841452">=</span>&nbsp;<span class="num" id="7841454">1</span>&nbsp;<span class="op" id="7841456">&lt;&lt;</span>&nbsp;<span class="ident" id="7841459">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7841465">rawFormat</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7841476">idempotent</span><br>
<span class="lineno"></span><span class="op" id="7841487">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7841490">//&nbsp;format&nbsp;parses&nbsp;src,&nbsp;prints&nbsp;the&nbsp;corresponding&nbsp;AST,&nbsp;verifies&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="7841565">//&nbsp;src&nbsp;is&nbsp;syntactically&nbsp;correct,&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;src&nbsp;or&nbsp;an&nbsp;error</span><br>
<span class="lineno">40</span><span class="comment" id="7841640">//&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="7841651">func</span>&nbsp;<span class="ident" id="7841656">format</span><span class="op" id="7841662">(</span><span class="ident" id="7841663">src</span>&nbsp;<span class="op" id="7841667">[</span><span class="op" id="7841668">]</span><span class="builtintype" id="7841669">byte</span><span class="op" id="7841673">,</span>&nbsp;<span class="ident" id="7841675">mode</span>&nbsp;<span class="ident" id="7841680">checkMode</span><span class="op" id="7841689">)</span>&nbsp;<span class="op" id="7841691">(</span><span class="op" id="7841692">[</span><span class="op" id="7841693">]</span><span class="builtintype" id="7841694">byte</span><span class="op" id="7841698">,</span>&nbsp;<span class="builtintype" id="7841700">error</span><span class="op" id="7841705">)</span>&nbsp;<span class="op" id="7841707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7841710">//&nbsp;parse&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7841724">f</span><span class="op" id="7841725">,</span>&nbsp;<span class="ident" id="7841727">err</span>&nbsp;<span class="op" id="7841731">:=</span>&nbsp;<span class="ident" id="7841734">parser</span><span class="op" id="7841740">.</span><span class="ident" id="7841741">ParseFile</span><span class="op" id="7841750">(</span><span class="ident" id="7841751">fset</span><span class="op" id="7841755">,</span>&nbsp;<span class="string" id="7841757">&#34;&#34;</span><span class="op" id="7841759">,</span>&nbsp;<span class="ident" id="7841761">src</span><span class="op" id="7841764">,</span>&nbsp;<span class="ident" id="7841766">parser</span><span class="op" id="7841772">.</span><span class="ident" id="7841773">ParseComments</span><span class="op" id="7841786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7841789">if</span>&nbsp;<span class="ident" id="7841792">err</span>&nbsp;<span class="op" id="7841796">!=</span>&nbsp;<span class="ident" id="7841799">nil</span>&nbsp;<span class="op" id="7841803">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7841807">return</span>&nbsp;<span class="ident" id="7841814">nil</span><span class="op" id="7841817">,</span>&nbsp;<span class="ident" id="7841819">fmt</span><span class="op" id="7841822">.</span><span class="ident" id="7841823">Errorf</span><span class="op" id="7841829">(</span><span class="string" id="7841830">&#34;parse:&nbsp;%s\n%s&#34;</span><span class="op" id="7841845">,</span>&nbsp;<span class="ident" id="7841847">err</span><span class="op" id="7841850">,</span>&nbsp;<span class="ident" id="7841852">src</span><span class="op" id="7841855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7841858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7841862">//&nbsp;filter&nbsp;exports&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7841894">if</span>&nbsp;<span class="ident" id="7841897">mode</span><span class="op" id="7841901">&amp;</span><span class="ident" id="7841902">export</span>&nbsp;<span class="op" id="7841909">!=</span>&nbsp;<span class="num" id="7841912">0</span>&nbsp;<span class="op" id="7841914">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7841918">ast</span><span class="op" id="7841921">.</span><span class="ident" id="7841922">FileExports</span><span class="op" id="7841933">(</span><span class="ident" id="7841934">f</span><span class="op" id="7841935">)</span>&nbsp;<span class="comment" id="7841937">//&nbsp;ignore&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7841956">f</span><span class="op" id="7841957">.</span><span class="ident" id="7841958">Comments</span>&nbsp;<span class="op" id="7841967">=</span>&nbsp;<span class="ident" id="7841969">nil</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7841975">//&nbsp;don&#39;t&nbsp;print&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;in&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7842020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7842024">//&nbsp;determine&nbsp;printer&nbsp;configuration</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842060">cfg</span>&nbsp;<span class="op" id="7842064">:=</span>&nbsp;<span class="ident" id="7842067">Config</span><span class="op" id="7842073">{</span><span class="ident" id="7842074">Tabwidth</span><span class="op" id="7842082">:</span>&nbsp;<span class="ident" id="7842084">tabwidth</span><span class="op" id="7842092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842095">if</span>&nbsp;<span class="ident" id="7842098">mode</span><span class="op" id="7842102">&amp;</span><span class="ident" id="7842103">rawFormat</span>&nbsp;<span class="op" id="7842113">!=</span>&nbsp;<span class="num" id="7842116">0</span>&nbsp;<span class="op" id="7842118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842122">cfg</span><span class="op" id="7842125">.</span><span class="ident" id="7842126">Mode</span>&nbsp;<span class="op" id="7842131">|=</span>&nbsp;<span class="ident" id="7842134">RawFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7842145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7842149">//&nbsp;print&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842163">var</span>&nbsp;<span class="ident" id="7842167">buf</span>&nbsp;<span class="ident" id="7842171">bytes</span><span class="op" id="7842176">.</span><span class="ident" id="7842177">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842185">if</span>&nbsp;<span class="ident" id="7842188">err</span>&nbsp;<span class="op" id="7842192">:=</span>&nbsp;<span class="ident" id="7842195">cfg</span><span class="op" id="7842198">.</span><span class="ident" id="7842199">Fprint</span><span class="op" id="7842205">(</span><span class="op" id="7842206">&amp;</span><span class="ident" id="7842207">buf</span><span class="op" id="7842210">,</span>&nbsp;<span class="ident" id="7842212">fset</span><span class="op" id="7842216">,</span>&nbsp;<span class="ident" id="7842218">f</span><span class="op" id="7842219">)</span><span class="op" id="7842220">;</span>&nbsp;<span class="ident" id="7842222">err</span>&nbsp;<span class="op" id="7842226">!=</span>&nbsp;<span class="ident" id="7842229">nil</span>&nbsp;<span class="op" id="7842233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842237">return</span>&nbsp;<span class="ident" id="7842244">nil</span><span class="op" id="7842247">,</span>&nbsp;<span class="ident" id="7842249">fmt</span><span class="op" id="7842252">.</span><span class="ident" id="7842253">Errorf</span><span class="op" id="7842259">(</span><span class="string" id="7842260">&#34;print:&nbsp;%s&#34;</span><span class="op" id="7842271">,</span>&nbsp;<span class="ident" id="7842273">err</span><span class="op" id="7842276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7842279">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7842283">//&nbsp;make&nbsp;sure&nbsp;formatted&nbsp;output&nbsp;is&nbsp;syntactically&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842339">res</span>&nbsp;<span class="op" id="7842343">:=</span>&nbsp;<span class="ident" id="7842346">buf</span><span class="op" id="7842349">.</span><span class="ident" id="7842350">Bytes</span><span class="op" id="7842355">(</span><span class="op" id="7842356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842359">if</span>&nbsp;<span class="ident" id="7842362">_</span><span class="op" id="7842363">,</span>&nbsp;<span class="ident" id="7842365">err</span>&nbsp;<span class="op" id="7842369">:=</span>&nbsp;<span class="ident" id="7842372">parser</span><span class="op" id="7842378">.</span><span class="ident" id="7842379">ParseFile</span><span class="op" id="7842388">(</span><span class="ident" id="7842389">fset</span><span class="op" id="7842393">,</span>&nbsp;<span class="string" id="7842395">&#34;&#34;</span><span class="op" id="7842397">,</span>&nbsp;<span class="ident" id="7842399">res</span><span class="op" id="7842402">,</span>&nbsp;<span class="num" id="7842404">0</span><span class="op" id="7842405">)</span><span class="op" id="7842406">;</span>&nbsp;<span class="ident" id="7842408">err</span>&nbsp;<span class="op" id="7842412">!=</span>&nbsp;<span class="ident" id="7842415">nil</span>&nbsp;<span class="op" id="7842419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842423">return</span>&nbsp;<span class="ident" id="7842430">nil</span><span class="op" id="7842433">,</span>&nbsp;<span class="ident" id="7842435">fmt</span><span class="op" id="7842438">.</span><span class="ident" id="7842439">Errorf</span><span class="op" id="7842445">(</span><span class="string" id="7842446">&#34;re-parse:&nbsp;%s\n%s&#34;</span><span class="op" id="7842464">,</span>&nbsp;<span class="ident" id="7842466">err</span><span class="op" id="7842469">,</span>&nbsp;<span class="ident" id="7842471">buf</span><span class="op" id="7842474">.</span><span class="ident" id="7842475">Bytes</span><span class="op" id="7842480">(</span><span class="op" id="7842481">)</span><span class="op" id="7842482">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7842485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842489">return</span>&nbsp;<span class="ident" id="7842496">res</span><span class="op" id="7842499">,</span>&nbsp;<span class="ident" id="7842501">nil</span><br>
<span class="lineno"></span><span class="op" id="7842505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="7842508">//&nbsp;lineAt&nbsp;returns&nbsp;the&nbsp;line&nbsp;in&nbsp;text&nbsp;starting&nbsp;at&nbsp;offset&nbsp;offs.</span><br>
<span class="lineno"></span><span class="keyword" id="7842568">func</span>&nbsp;<span class="ident" id="7842573">lineAt</span><span class="op" id="7842579">(</span><span class="ident" id="7842580">text</span>&nbsp;<span class="op" id="7842585">[</span><span class="op" id="7842586">]</span><span class="builtintype" id="7842587">byte</span><span class="op" id="7842591">,</span>&nbsp;<span class="ident" id="7842593">offs</span>&nbsp;<span class="builtintype" id="7842598">int</span><span class="op" id="7842601">)</span>&nbsp;<span class="op" id="7842603">[</span><span class="op" id="7842604">]</span><span class="builtintype" id="7842605">byte</span>&nbsp;<span class="op" id="7842610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842613">i</span>&nbsp;<span class="op" id="7842615">:=</span>&nbsp;<span class="ident" id="7842618">offs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842624">for</span>&nbsp;<span class="ident" id="7842628">i</span>&nbsp;<span class="op" id="7842630">&lt;</span>&nbsp;<span class="builtinfunc" id="7842632">len</span><span class="op" id="7842635">(</span><span class="ident" id="7842636">text</span><span class="op" id="7842640">)</span>&nbsp;<span class="op" id="7842642">&amp;&amp;</span>&nbsp;<span class="ident" id="7842645">text</span><span class="op" id="7842649">[</span><span class="ident" id="7842650">i</span><span class="op" id="7842651">]</span>&nbsp;<span class="op" id="7842653">!=</span>&nbsp;<span class="string" id="7842656">&#39;\n&#39;</span>&nbsp;<span class="op" id="7842661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842665">i</span><span class="op" id="7842666">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7842670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842673">return</span>&nbsp;<span class="ident" id="7842680">text</span><span class="op" id="7842684">[</span><span class="ident" id="7842685">offs</span><span class="op" id="7842689">:</span><span class="ident" id="7842690">i</span><span class="op" id="7842691">]</span><br>
<span class="lineno"></span><span class="op" id="7842693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7842696">//&nbsp;diff&nbsp;compares&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno">85</span><span class="keyword" id="7842722">func</span>&nbsp;<span class="ident" id="7842727">diff</span><span class="op" id="7842731">(</span><span class="ident" id="7842732">aname</span><span class="op" id="7842737">,</span>&nbsp;<span class="ident" id="7842739">bname</span>&nbsp;<span class="builtintype" id="7842745">string</span><span class="op" id="7842751">,</span>&nbsp;<span class="ident" id="7842753">a</span><span class="op" id="7842754">,</span>&nbsp;<span class="ident" id="7842756">b</span>&nbsp;<span class="op" id="7842758">[</span><span class="op" id="7842759">]</span><span class="builtintype" id="7842760">byte</span><span class="op" id="7842764">)</span>&nbsp;<span class="builtintype" id="7842766">error</span>&nbsp;<span class="op" id="7842772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842775">var</span>&nbsp;<span class="ident" id="7842779">buf</span>&nbsp;<span class="ident" id="7842783">bytes</span><span class="op" id="7842788">.</span><span class="ident" id="7842789">Buffer</span>&nbsp;<span class="comment" id="7842796">//&nbsp;holding&nbsp;long&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7842828">//&nbsp;compare&nbsp;lengths</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7842848">if</span>&nbsp;<span class="builtinfunc" id="7842851">len</span><span class="op" id="7842854">(</span><span class="ident" id="7842855">a</span><span class="op" id="7842856">)</span>&nbsp;<span class="op" id="7842858">!=</span>&nbsp;<span class="builtinfunc" id="7842861">len</span><span class="op" id="7842864">(</span><span class="ident" id="7842865">b</span><span class="op" id="7842866">)</span>&nbsp;<span class="op" id="7842868">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842872">fmt</span><span class="op" id="7842875">.</span><span class="ident" id="7842876">Fprintf</span><span class="op" id="7842883">(</span><span class="op" id="7842884">&amp;</span><span class="ident" id="7842885">buf</span><span class="op" id="7842888">,</span>&nbsp;<span class="string" id="7842890">&#34;\nlength&nbsp;changed:&nbsp;len(%s)&nbsp;=&nbsp;%d,&nbsp;len(%s)&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7842936">,</span>&nbsp;<span class="ident" id="7842938">aname</span><span class="op" id="7842943">,</span>&nbsp;<span class="builtinfunc" id="7842945">len</span><span class="op" id="7842948">(</span><span class="ident" id="7842949">a</span><span class="op" id="7842950">)</span><span class="op" id="7842951">,</span>&nbsp;<span class="ident" id="7842953">bname</span><span class="op" id="7842958">,</span>&nbsp;<span class="builtinfunc" id="7842960">len</span><span class="op" id="7842963">(</span><span class="ident" id="7842964">b</span><span class="op" id="7842965">)</span><span class="op" id="7842966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7842969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7842973">//&nbsp;compare&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842994">line</span>&nbsp;<span class="op" id="7842999">:=</span>&nbsp;<span class="num" id="7843002">1</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843005">offs</span>&nbsp;<span class="op" id="7843010">:=</span>&nbsp;<span class="num" id="7843013">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843016">for</span>&nbsp;<span class="ident" id="7843020">i</span>&nbsp;<span class="op" id="7843022">:=</span>&nbsp;<span class="num" id="7843025">0</span><span class="op" id="7843026">;</span>&nbsp;<span class="ident" id="7843028">i</span>&nbsp;<span class="op" id="7843030">&lt;</span>&nbsp;<span class="builtinfunc" id="7843032">len</span><span class="op" id="7843035">(</span><span class="ident" id="7843036">a</span><span class="op" id="7843037">)</span>&nbsp;<span class="op" id="7843039">&amp;&amp;</span>&nbsp;<span class="ident" id="7843042">i</span>&nbsp;<span class="op" id="7843044">&lt;</span>&nbsp;<span class="builtinfunc" id="7843046">len</span><span class="op" id="7843049">(</span><span class="ident" id="7843050">b</span><span class="op" id="7843051">)</span><span class="op" id="7843052">;</span>&nbsp;<span class="ident" id="7843054">i</span><span class="op" id="7843055">++</span>&nbsp;<span class="op" id="7843058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843062">ch</span>&nbsp;<span class="op" id="7843065">:=</span>&nbsp;<span class="ident" id="7843068">a</span><span class="op" id="7843069">[</span><span class="ident" id="7843070">i</span><span class="op" id="7843071">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843075">if</span>&nbsp;<span class="ident" id="7843078">ch</span>&nbsp;<span class="op" id="7843081">!=</span>&nbsp;<span class="ident" id="7843084">b</span><span class="op" id="7843085">[</span><span class="ident" id="7843086">i</span><span class="op" id="7843087">]</span>&nbsp;<span class="op" id="7843089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843094">fmt</span><span class="op" id="7843097">.</span><span class="ident" id="7843098">Fprintf</span><span class="op" id="7843105">(</span><span class="op" id="7843106">&amp;</span><span class="ident" id="7843107">buf</span><span class="op" id="7843110">,</span>&nbsp;<span class="string" id="7843112">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="7843128">,</span>&nbsp;<span class="ident" id="7843130">aname</span><span class="op" id="7843135">,</span>&nbsp;<span class="ident" id="7843137">line</span><span class="op" id="7843141">,</span>&nbsp;<span class="ident" id="7843143">i</span><span class="op" id="7843144">-</span><span class="ident" id="7843145">offs</span><span class="op" id="7843149">+</span><span class="num" id="7843150">1</span><span class="op" id="7843151">,</span>&nbsp;<span class="ident" id="7843153">lineAt</span><span class="op" id="7843159">(</span><span class="ident" id="7843160">a</span><span class="op" id="7843161">,</span>&nbsp;<span class="ident" id="7843163">offs</span><span class="op" id="7843167">)</span><span class="op" id="7843168">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843173">fmt</span><span class="op" id="7843176">.</span><span class="ident" id="7843177">Fprintf</span><span class="op" id="7843184">(</span><span class="op" id="7843185">&amp;</span><span class="ident" id="7843186">buf</span><span class="op" id="7843189">,</span>&nbsp;<span class="string" id="7843191">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="7843207">,</span>&nbsp;<span class="ident" id="7843209">bname</span><span class="op" id="7843214">,</span>&nbsp;<span class="ident" id="7843216">line</span><span class="op" id="7843220">,</span>&nbsp;<span class="ident" id="7843222">i</span><span class="op" id="7843223">-</span><span class="ident" id="7843224">offs</span><span class="op" id="7843228">+</span><span class="num" id="7843229">1</span><span class="op" id="7843230">,</span>&nbsp;<span class="ident" id="7843232">lineAt</span><span class="op" id="7843238">(</span><span class="ident" id="7843239">b</span><span class="op" id="7843240">,</span>&nbsp;<span class="ident" id="7843242">offs</span><span class="op" id="7843246">)</span><span class="op" id="7843247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843252">fmt</span><span class="op" id="7843255">.</span><span class="ident" id="7843256">Fprintf</span><span class="op" id="7843263">(</span><span class="op" id="7843264">&amp;</span><span class="ident" id="7843265">buf</span><span class="op" id="7843268">,</span>&nbsp;<span class="string" id="7843270">&#34;\n\n&#34;</span><span class="op" id="7843276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843281">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7843289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843293">if</span>&nbsp;<span class="ident" id="7843296">ch</span>&nbsp;<span class="op" id="7843299">==</span>&nbsp;<span class="string" id="7843302">&#39;\n&#39;</span>&nbsp;<span class="op" id="7843307">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843312">line</span><span class="op" id="7843316">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843322">offs</span>&nbsp;<span class="op" id="7843327">=</span>&nbsp;<span class="ident" id="7843329">i</span>&nbsp;<span class="op" id="7843331">+</span>&nbsp;<span class="num" id="7843333">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7843337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7843340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843344">if</span>&nbsp;<span class="ident" id="7843347">buf</span><span class="op" id="7843350">.</span><span class="ident" id="7843351">Len</span><span class="op" id="7843354">(</span><span class="op" id="7843355">)</span>&nbsp;<span class="op" id="7843357">&gt;</span>&nbsp;<span class="num" id="7843359">0</span>&nbsp;<span class="op" id="7843361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843365">return</span>&nbsp;<span class="ident" id="7843372">errors</span><span class="op" id="7843378">.</span><span class="ident" id="7843379">New</span><span class="op" id="7843382">(</span><span class="ident" id="7843383">buf</span><span class="op" id="7843386">.</span><span class="ident" id="7843387">String</span><span class="op" id="7843393">(</span><span class="op" id="7843394">)</span><span class="op" id="7843395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7843398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843401">return</span>&nbsp;<span class="ident" id="7843408">nil</span><br>
<span class="lineno"></span><span class="op" id="7843412">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="7843415">func</span>&nbsp;<span class="ident" id="7843420">runcheck</span><span class="op" id="7843428">(</span><span class="ident" id="7843429">t</span>&nbsp;<span class="op" id="7843431">*</span><span class="ident" id="7843432">testing</span><span class="op" id="7843439">.</span><span class="ident" id="7843440">T</span><span class="op" id="7843441">,</span>&nbsp;<span class="ident" id="7843443">source</span><span class="op" id="7843449">,</span>&nbsp;<span class="ident" id="7843451">golden</span>&nbsp;<span class="builtintype" id="7843458">string</span><span class="op" id="7843464">,</span>&nbsp;<span class="ident" id="7843466">mode</span>&nbsp;<span class="ident" id="7843471">checkMode</span><span class="op" id="7843480">)</span>&nbsp;<span class="op" id="7843482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843485">src</span><span class="op" id="7843488">,</span>&nbsp;<span class="ident" id="7843490">err</span>&nbsp;<span class="op" id="7843494">:=</span>&nbsp;<span class="ident" id="7843497">ioutil</span><span class="op" id="7843503">.</span><span class="ident" id="7843504">ReadFile</span><span class="op" id="7843512">(</span><span class="ident" id="7843513">source</span><span class="op" id="7843519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843522">if</span>&nbsp;<span class="ident" id="7843525">err</span>&nbsp;<span class="op" id="7843529">!=</span>&nbsp;<span class="ident" id="7843532">nil</span>&nbsp;<span class="op" id="7843536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843540">t</span><span class="op" id="7843541">.</span><span class="ident" id="7843542">Error</span><span class="op" id="7843547">(</span><span class="ident" id="7843548">err</span><span class="op" id="7843551">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843555">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7843563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843567">res</span><span class="op" id="7843570">,</span>&nbsp;<span class="ident" id="7843572">err</span>&nbsp;<span class="op" id="7843576">:=</span>&nbsp;<span class="ident" id="7843579">format</span><span class="op" id="7843585">(</span><span class="ident" id="7843586">src</span><span class="op" id="7843589">,</span>&nbsp;<span class="ident" id="7843591">mode</span><span class="op" id="7843595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843598">if</span>&nbsp;<span class="ident" id="7843601">err</span>&nbsp;<span class="op" id="7843605">!=</span>&nbsp;<span class="ident" id="7843608">nil</span>&nbsp;<span class="op" id="7843612">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843616">t</span><span class="op" id="7843617">.</span><span class="ident" id="7843618">Error</span><span class="op" id="7843623">(</span><span class="ident" id="7843624">err</span><span class="op" id="7843627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843631">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7843639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7843643">//&nbsp;update&nbsp;golden&nbsp;files&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843680">if</span>&nbsp;<span class="op" id="7843683">*</span><span class="ident" id="7843684">update</span>&nbsp;<span class="op" id="7843691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843695">if</span>&nbsp;<span class="ident" id="7843698">err</span>&nbsp;<span class="op" id="7843702">:=</span>&nbsp;<span class="ident" id="7843705">ioutil</span><span class="op" id="7843711">.</span><span class="ident" id="7843712">WriteFile</span><span class="op" id="7843721">(</span><span class="ident" id="7843722">golden</span><span class="op" id="7843728">,</span>&nbsp;<span class="ident" id="7843730">res</span><span class="op" id="7843733">,</span>&nbsp;<span class="num" id="7843735">0644</span><span class="op" id="7843739">)</span><span class="op" id="7843740">;</span>&nbsp;<span class="ident" id="7843742">err</span>&nbsp;<span class="op" id="7843746">!=</span>&nbsp;<span class="ident" id="7843749">nil</span>&nbsp;<span class="op" id="7843753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843758">t</span><span class="op" id="7843759">.</span><span class="ident" id="7843760">Error</span><span class="op" id="7843765">(</span><span class="ident" id="7843766">err</span><span class="op" id="7843769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7843773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843777">return</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7843785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7843789">//&nbsp;get&nbsp;golden</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843804">gld</span><span class="op" id="7843807">,</span>&nbsp;<span class="ident" id="7843809">err</span>&nbsp;<span class="op" id="7843813">:=</span>&nbsp;<span class="ident" id="7843816">ioutil</span><span class="op" id="7843822">.</span><span class="ident" id="7843823">ReadFile</span><span class="op" id="7843831">(</span><span class="ident" id="7843832">golden</span><span class="op" id="7843838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843841">if</span>&nbsp;<span class="ident" id="7843844">err</span>&nbsp;<span class="op" id="7843848">!=</span>&nbsp;<span class="ident" id="7843851">nil</span>&nbsp;<span class="op" id="7843855">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843859">t</span><span class="op" id="7843860">.</span><span class="ident" id="7843861">Error</span><span class="op" id="7843866">(</span><span class="ident" id="7843867">err</span><span class="op" id="7843870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843874">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7843882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7843886">//&nbsp;formatted&nbsp;source&nbsp;and&nbsp;golden&nbsp;must&nbsp;be&nbsp;the&nbsp;same</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7843935">if</span>&nbsp;<span class="ident" id="7843938">err</span>&nbsp;<span class="op" id="7843942">:=</span>&nbsp;<span class="ident" id="7843945">diff</span><span class="op" id="7843949">(</span><span class="ident" id="7843950">source</span><span class="op" id="7843956">,</span>&nbsp;<span class="ident" id="7843958">golden</span><span class="op" id="7843964">,</span>&nbsp;<span class="ident" id="7843966">res</span><span class="op" id="7843969">,</span>&nbsp;<span class="ident" id="7843971">gld</span><span class="op" id="7843974">)</span><span class="op" id="7843975">;</span>&nbsp;<span class="ident" id="7843977">err</span>&nbsp;<span class="op" id="7843981">!=</span>&nbsp;<span class="ident" id="7843984">nil</span>&nbsp;<span class="op" id="7843988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7843992">t</span><span class="op" id="7843993">.</span><span class="ident" id="7843994">Error</span><span class="op" id="7843999">(</span><span class="ident" id="7844000">err</span><span class="op" id="7844003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7844007">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7844015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7844019">if</span>&nbsp;<span class="ident" id="7844022">mode</span><span class="op" id="7844026">&amp;</span><span class="ident" id="7844027">idempotent</span>&nbsp;<span class="op" id="7844038">!=</span>&nbsp;<span class="num" id="7844041">0</span>&nbsp;<span class="op" id="7844043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7844047">//&nbsp;formatting&nbsp;golden&nbsp;must&nbsp;be&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7844089">//&nbsp;(This&nbsp;is&nbsp;very&nbsp;difficult&nbsp;to&nbsp;achieve&nbsp;in&nbsp;general&nbsp;and&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7844152">//&nbsp;it&nbsp;is&nbsp;only&nbsp;checked&nbsp;for&nbsp;files&nbsp;explicitly&nbsp;marked&nbsp;as&nbsp;such.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7844214">res</span><span class="op" id="7844217">,</span>&nbsp;<span class="ident" id="7844219">err</span>&nbsp;<span class="op" id="7844223">=</span>&nbsp;<span class="ident" id="7844225">format</span><span class="op" id="7844231">(</span><span class="ident" id="7844232">gld</span><span class="op" id="7844235">,</span>&nbsp;<span class="ident" id="7844237">mode</span><span class="op" id="7844241">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7844245">if</span>&nbsp;<span class="ident" id="7844248">err</span>&nbsp;<span class="op" id="7844252">:=</span>&nbsp;<span class="ident" id="7844255">diff</span><span class="op" id="7844259">(</span><span class="ident" id="7844260">golden</span><span class="op" id="7844266">,</span>&nbsp;<span class="ident" id="7844268">fmt</span><span class="op" id="7844271">.</span><span class="ident" id="7844272">Sprintf</span><span class="op" id="7844279">(</span><span class="string" id="7844280">&#34;format(%s)&#34;</span><span class="op" id="7844292">,</span>&nbsp;<span class="ident" id="7844294">golden</span><span class="op" id="7844300">)</span><span class="op" id="7844301">,</span>&nbsp;<span class="ident" id="7844303">gld</span><span class="op" id="7844306">,</span>&nbsp;<span class="ident" id="7844308">res</span><span class="op" id="7844311">)</span><span class="op" id="7844312">;</span>&nbsp;<span class="ident" id="7844314">err</span>&nbsp;<span class="op" id="7844318">!=</span>&nbsp;<span class="ident" id="7844321">nil</span>&nbsp;<span class="op" id="7844325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7844330">t</span><span class="op" id="7844331">.</span><span class="ident" id="7844332">Errorf</span><span class="op" id="7844338">(</span><span class="string" id="7844339">&#34;golden&nbsp;is&nbsp;not&nbsp;idempotent:&nbsp;%s&#34;</span><span class="op" id="7844369">,</span>&nbsp;<span class="ident" id="7844371">err</span><span class="op" id="7844374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7844378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7844381">}</span><br>
<span class="lineno"></span><span class="op" id="7844383">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="7844386">func</span>&nbsp;<span class="ident" id="7844391">check</span><span class="op" id="7844396">(</span><span class="ident" id="7844397">t</span>&nbsp;<span class="op" id="7844399">*</span><span class="ident" id="7844400">testing</span><span class="op" id="7844407">.</span><span class="ident" id="7844408">T</span><span class="op" id="7844409">,</span>&nbsp;<span class="ident" id="7844411">source</span><span class="op" id="7844417">,</span>&nbsp;<span class="ident" id="7844419">golden</span>&nbsp;<span class="builtintype" id="7844426">string</span><span class="op" id="7844432">,</span>&nbsp;<span class="ident" id="7844434">mode</span>&nbsp;<span class="ident" id="7844439">checkMode</span><span class="op" id="7844448">)</span>&nbsp;<span class="op" id="7844450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7844453">//&nbsp;run&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7844470">cc</span>&nbsp;<span class="op" id="7844473">:=</span>&nbsp;<span class="builtinfunc" id="7844476">make</span><span class="op" id="7844480">(</span><span class="keyword" id="7844481">chan</span>&nbsp;<span class="builtintype" id="7844486">int</span><span class="op" id="7844489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7844492">go</span>&nbsp;<span class="keyword" id="7844495">func</span><span class="op" id="7844499">(</span><span class="op" id="7844500">)</span>&nbsp;<span class="op" id="7844502">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7844506">runcheck</span><span class="op" id="7844514">(</span><span class="ident" id="7844515">t</span><span class="op" id="7844516">,</span>&nbsp;<span class="ident" id="7844518">source</span><span class="op" id="7844524">,</span>&nbsp;<span class="ident" id="7844526">golden</span><span class="op" id="7844532">,</span>&nbsp;<span class="ident" id="7844534">mode</span><span class="op" id="7844538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7844542">cc</span>&nbsp;<span class="op" id="7844545">&lt;-</span>&nbsp;<span class="num" id="7844548">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7844551">}</span><span class="op" id="7844552">(</span><span class="op" id="7844553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7844557">//&nbsp;wait&nbsp;with&nbsp;timeout</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7844579">select</span>&nbsp;<span class="op" id="7844586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7844589">case</span>&nbsp;<span class="op" id="7844594">&lt;-</span><span class="ident" id="7844596">time</span><span class="op" id="7844600">.</span><span class="ident" id="7844601">After</span><span class="op" id="7844606">(</span><span class="num" id="7844607">10</span>&nbsp;<span class="op" id="7844610">*</span>&nbsp;<span class="ident" id="7844612">time</span><span class="op" id="7844616">.</span><span class="ident" id="7844617">Second</span><span class="op" id="7844623">)</span><span class="op" id="7844624">:</span>&nbsp;<span class="comment" id="7844626">//&nbsp;plenty&nbsp;of&nbsp;a&nbsp;safety&nbsp;margin,&nbsp;even&nbsp;for&nbsp;very&nbsp;slow&nbsp;machines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7844686">//&nbsp;test&nbsp;running&nbsp;past&nbsp;time&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7844718">t</span><span class="op" id="7844719">.</span><span class="ident" id="7844720">Errorf</span><span class="op" id="7844726">(</span><span class="string" id="7844727">&#34;%s:&nbsp;running&nbsp;too&nbsp;slowly&#34;</span><span class="op" id="7844751">,</span>&nbsp;<span class="ident" id="7844753">source</span><span class="op" id="7844759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7844762">case</span>&nbsp;<span class="op" id="7844767">&lt;-</span><span class="ident" id="7844769">cc</span><span class="op" id="7844771">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7844775">//&nbsp;test&nbsp;finished&nbsp;within&nbsp;allotted&nbsp;time&nbsp;margin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7844821">}</span><br>
<span class="lineno"></span><span class="op" id="7844823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7844826">type</span>&nbsp;<span class="ident" id="7844831">entry</span>&nbsp;<span class="keyword" id="7844837">struct</span>&nbsp;<span class="op" id="7844844">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7844847">source</span><span class="op" id="7844853">,</span>&nbsp;<span class="ident" id="7844855">golden</span>&nbsp;<span class="builtintype" id="7844862">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7844870">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7844885">checkMode</span><br>
<span class="lineno"></span><span class="op" id="7844895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7844898">//&nbsp;Use&nbsp;go&nbsp;test&nbsp;-update&nbsp;to&nbsp;create/update&nbsp;the&nbsp;respective&nbsp;golden&nbsp;files.</span><br>
<span class="lineno">185</span><span class="keyword" id="7844967">var</span>&nbsp;<span class="ident" id="7844971">data</span>&nbsp;<span class="op" id="7844976">=</span>&nbsp;<span class="op" id="7844978">[</span><span class="op" id="7844979">]</span><span class="ident" id="7844980">entry</span><span class="op" id="7844985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7844988">{</span><span class="string" id="7844989">&#34;empty.input&#34;</span><span class="op" id="7845002">,</span>&nbsp;<span class="string" id="7845004">&#34;empty.golden&#34;</span><span class="op" id="7845018">,</span>&nbsp;<span class="ident" id="7845020">idempotent</span><span class="op" id="7845030">}</span><span class="op" id="7845031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7845034">{</span><span class="string" id="7845035">&#34;comments.input&#34;</span><span class="op" id="7845051">,</span>&nbsp;<span class="string" id="7845053">&#34;comments.golden&#34;</span><span class="op" id="7845070">,</span>&nbsp;<span class="num" id="7845072">0</span><span class="op" id="7845073">}</span><span class="op" id="7845074">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7845077">{</span><span class="string" id="7845078">&#34;comments.input&#34;</span><span class="op" id="7845094">,</span>&nbsp;<span class="string" id="7845096">&#34;comments.x&#34;</span><span class="op" id="7845108">,</span>&nbsp;<span class="ident" id="7845110">export</span><span class="op" id="7845116">}</span><span class="op" id="7845117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7845120">{</span><span class="string" id="7845121">&#34;comments2.input&#34;</span><span class="op" id="7845138">,</span>&nbsp;<span class="string" id="7845140">&#34;comments2.golden&#34;</span><span class="op" id="7845158">,</span>&nbsp;<span class="ident" id="7845160">idempotent</span><span class="op" id="7845170">}</span><span class="op" id="7845171">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7845174">{</span><span class="string" id="7845175">&#34;linebreaks.input&#34;</span><span class="op" id="7845193">,</span>&nbsp;<span class="string" id="7845195">&#34;linebreaks.golden&#34;</span><span class="op" id="7845214">,</span>&nbsp;<span class="ident" id="7845216">idempotent</span><span class="op" id="7845226">}</span><span class="op" id="7845227">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7845230">{</span><span class="string" id="7845231">&#34;expressions.input&#34;</span><span class="op" id="7845250">,</span>&nbsp;<span class="string" id="7845252">&#34;expressions.golden&#34;</span><span class="op" id="7845272">,</span>&nbsp;<span class="ident" id="7845274">idempotent</span><span class="op" id="7845284">}</span><span class="op" id="7845285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7845288">{</span><span class="string" id="7845289">&#34;expressions.input&#34;</span><span class="op" id="7845308">,</span>&nbsp;<span class="string" id="7845310">&#34;expressions.raw&#34;</span><span class="op" id="7845327">,</span>&nbsp;<span class="ident" id="7845329">rawFormat</span>&nbsp;<span class="op" id="7845339">|</span>&nbsp;<span class="ident" id="7845341">idempotent</span><span class="op" id="7845351">}</span><span class="op" id="7845352">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7845355">{</span><span class="string" id="7845356">&#34;declarations.input&#34;</span><span class="op" id="7845376">,</span>&nbsp;<span class="string" id="7845378">&#34;declarations.golden&#34;</span><span class="op" id="7845399">,</span>&nbsp;<span class="num" id="7845401">0</span><span class="op" id="7845402">}</span><span class="op" id="7845403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7845406">{</span><span class="string" id="7845407">&#34;statements.input&#34;</span><span class="op" id="7845425">,</span>&nbsp;<span class="string" id="7845427">&#34;statements.golden&#34;</span><span class="op" id="7845446">,</span>&nbsp;<span class="num" id="7845448">0</span><span class="op" id="7845449">}</span><span class="op" id="7845450">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7845453">{</span><span class="string" id="7845454">&#34;slow.input&#34;</span><span class="op" id="7845466">,</span>&nbsp;<span class="string" id="7845468">&#34;slow.golden&#34;</span><span class="op" id="7845481">,</span>&nbsp;<span class="ident" id="7845483">idempotent</span><span class="op" id="7845493">}</span><span class="op" id="7845494">,</span><br>
<span class="lineno"></span><span class="op" id="7845496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7845499">func</span>&nbsp;<span class="ident" id="7845504">TestFiles</span><span class="op" id="7845513">(</span><span class="ident" id="7845514">t</span>&nbsp;<span class="op" id="7845516">*</span><span class="ident" id="7845517">testing</span><span class="op" id="7845524">.</span><span class="ident" id="7845525">T</span><span class="op" id="7845526">)</span>&nbsp;<span class="op" id="7845528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7845531">for</span>&nbsp;<span class="ident" id="7845535">_</span><span class="op" id="7845536">,</span>&nbsp;<span class="ident" id="7845538">e</span>&nbsp;<span class="op" id="7845540">:=</span>&nbsp;<span class="keyword" id="7845543">range</span>&nbsp;<span class="ident" id="7845549">data</span>&nbsp;<span class="op" id="7845554">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7845558">source</span>&nbsp;<span class="op" id="7845565">:=</span>&nbsp;<span class="ident" id="7845568">filepath</span><span class="op" id="7845576">.</span><span class="ident" id="7845577">Join</span><span class="op" id="7845581">(</span><span class="ident" id="7845582">dataDir</span><span class="op" id="7845589">,</span>&nbsp;<span class="ident" id="7845591">e</span><span class="op" id="7845592">.</span><span class="ident" id="7845593">source</span><span class="op" id="7845599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7845603">golden</span>&nbsp;<span class="op" id="7845610">:=</span>&nbsp;<span class="ident" id="7845613">filepath</span><span class="op" id="7845621">.</span><span class="ident" id="7845622">Join</span><span class="op" id="7845626">(</span><span class="ident" id="7845627">dataDir</span><span class="op" id="7845634">,</span>&nbsp;<span class="ident" id="7845636">e</span><span class="op" id="7845637">.</span><span class="ident" id="7845638">golden</span><span class="op" id="7845644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7845648">check</span><span class="op" id="7845653">(</span><span class="ident" id="7845654">t</span><span class="op" id="7845655">,</span>&nbsp;<span class="ident" id="7845657">source</span><span class="op" id="7845663">,</span>&nbsp;<span class="ident" id="7845665">golden</span><span class="op" id="7845671">,</span>&nbsp;<span class="ident" id="7845673">e</span><span class="op" id="7845674">.</span><span class="ident" id="7845675">mode</span><span class="op" id="7845679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7845683">//&nbsp;TODO(gri)&nbsp;check&nbsp;that&nbsp;golden&nbsp;is&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7845730">//check(t,&nbsp;golden,&nbsp;golden,&nbsp;e.mode)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7845766">}</span><br>
<span class="lineno"></span><span class="op" id="7845768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7845771">//&nbsp;TestLineComments,&nbsp;using&nbsp;a&nbsp;simple&nbsp;test&nbsp;case,&nbsp;checks&nbsp;that&nbsp;consecutive&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="7845847">//&nbsp;comments&nbsp;are&nbsp;properly&nbsp;terminated&nbsp;with&nbsp;a&nbsp;newline&nbsp;even&nbsp;if&nbsp;the&nbsp;AST&nbsp;position</span><br>
<span class="lineno">210</span><span class="comment" id="7845923">//&nbsp;information&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="comment" id="7845952">//</span><br>
<span class="lineno"></span><span class="keyword" id="7845955">func</span>&nbsp;<span class="ident" id="7845960">TestLineComments</span><span class="op" id="7845976">(</span><span class="ident" id="7845977">t</span>&nbsp;<span class="op" id="7845979">*</span><span class="ident" id="7845980">testing</span><span class="op" id="7845987">.</span><span class="ident" id="7845988">T</span><span class="op" id="7845989">)</span>&nbsp;<span class="op" id="7845991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7845994">const</span>&nbsp;<span class="ident" id="7846000">src</span>&nbsp;<span class="op" id="7846004">=</span>&nbsp;<span class="string" id="7846006">`//&nbsp;comment&nbsp;1<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;comment&nbsp;2<br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;comment&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;main<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7846067">fset</span>&nbsp;<span class="op" id="7846072">:=</span>&nbsp;<span class="ident" id="7846075">token</span><span class="op" id="7846080">.</span><span class="ident" id="7846081">NewFileSet</span><span class="op" id="7846091">(</span><span class="op" id="7846092">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7846095">f</span><span class="op" id="7846096">,</span>&nbsp;<span class="ident" id="7846098">err</span>&nbsp;<span class="op" id="7846102">:=</span>&nbsp;<span class="ident" id="7846105">parser</span><span class="op" id="7846111">.</span><span class="ident" id="7846112">ParseFile</span><span class="op" id="7846121">(</span><span class="ident" id="7846122">fset</span><span class="op" id="7846126">,</span>&nbsp;<span class="string" id="7846128">&#34;&#34;</span><span class="op" id="7846130">,</span>&nbsp;<span class="ident" id="7846132">src</span><span class="op" id="7846135">,</span>&nbsp;<span class="ident" id="7846137">parser</span><span class="op" id="7846143">.</span><span class="ident" id="7846144">ParseComments</span><span class="op" id="7846157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7846160">if</span>&nbsp;<span class="ident" id="7846163">err</span>&nbsp;<span class="op" id="7846167">!=</span>&nbsp;<span class="ident" id="7846170">nil</span>&nbsp;<span class="op" id="7846174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7846178">panic</span><span class="op" id="7846183">(</span><span class="ident" id="7846184">err</span><span class="op" id="7846187">)</span>&nbsp;<span class="comment" id="7846189">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7846207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7846211">var</span>&nbsp;<span class="ident" id="7846215">buf</span>&nbsp;<span class="ident" id="7846219">bytes</span><span class="op" id="7846224">.</span><span class="ident" id="7846225">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7846233">fset</span>&nbsp;<span class="op" id="7846238">=</span>&nbsp;<span class="ident" id="7846240">token</span><span class="op" id="7846245">.</span><span class="ident" id="7846246">NewFileSet</span><span class="op" id="7846256">(</span><span class="op" id="7846257">)</span>&nbsp;<span class="comment" id="7846259">//&nbsp;use&nbsp;the&nbsp;wrong&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7846286">Fprint</span><span class="op" id="7846292">(</span><span class="op" id="7846293">&amp;</span><span class="ident" id="7846294">buf</span><span class="op" id="7846297">,</span>&nbsp;<span class="ident" id="7846299">fset</span><span class="op" id="7846303">,</span>&nbsp;<span class="ident" id="7846305">f</span><span class="op" id="7846306">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7846310">nlines</span>&nbsp;<span class="op" id="7846317">:=</span>&nbsp;<span class="num" id="7846320">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7846323">for</span>&nbsp;<span class="ident" id="7846327">_</span><span class="op" id="7846328">,</span>&nbsp;<span class="ident" id="7846330">ch</span>&nbsp;<span class="op" id="7846333">:=</span>&nbsp;<span class="keyword" id="7846336">range</span>&nbsp;<span class="ident" id="7846342">buf</span><span class="op" id="7846345">.</span><span class="ident" id="7846346">Bytes</span><span class="op" id="7846351">(</span><span class="op" id="7846352">)</span>&nbsp;<span class="op" id="7846354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7846358">if</span>&nbsp;<span class="ident" id="7846361">ch</span>&nbsp;<span class="op" id="7846364">==</span>&nbsp;<span class="string" id="7846367">&#39;\n&#39;</span>&nbsp;<span class="op" id="7846372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7846377">nlines</span><span class="op" id="7846383">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7846388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7846391">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7846395">const</span>&nbsp;<span class="ident" id="7846401">expected</span>&nbsp;<span class="op" id="7846410">=</span>&nbsp;<span class="num" id="7846412">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7846415">if</span>&nbsp;<span class="ident" id="7846418">nlines</span>&nbsp;<span class="op" id="7846425">&lt;</span>&nbsp;<span class="ident" id="7846427">expected</span>&nbsp;<span class="op" id="7846436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7846440">t</span><span class="op" id="7846441">.</span><span class="ident" id="7846442">Errorf</span><span class="op" id="7846448">(</span><span class="string" id="7846449">&#34;got&nbsp;%d,&nbsp;expected&nbsp;%d\n&#34;</span><span class="op" id="7846472">,</span>&nbsp;<span class="ident" id="7846474">nlines</span><span class="op" id="7846480">,</span>&nbsp;<span class="ident" id="7846482">expected</span><span class="op" id="7846490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7846494">t</span><span class="op" id="7846495">.</span><span class="ident" id="7846496">Errorf</span><span class="op" id="7846502">(</span><span class="string" id="7846503">&#34;result:\n%s&#34;</span><span class="op" id="7846516">,</span>&nbsp;<span class="ident" id="7846518">buf</span><span class="op" id="7846521">.</span><span class="ident" id="7846522">Bytes</span><span class="op" id="7846527">(</span><span class="op" id="7846528">)</span><span class="op" id="7846529">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7846532">}</span><br>
<span class="lineno"></span><span class="op" id="7846534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7846537">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;can&nbsp;be&nbsp;invoked&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span><span class="keyword" id="7846602">func</span>&nbsp;<span class="ident" id="7846607">init</span><span class="op" id="7846611">(</span><span class="op" id="7846612">)</span>&nbsp;<span class="op" id="7846614">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7846617">const</span>&nbsp;<span class="ident" id="7846623">name</span>&nbsp;<span class="op" id="7846628">=</span>&nbsp;<span class="string" id="7846630">&#34;foobar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7846640">var</span>&nbsp;<span class="ident" id="7846644">buf</span>&nbsp;<span class="ident" id="7846648">bytes</span><span class="op" id="7846653">.</span><span class="ident" id="7846654">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7846662">if</span>&nbsp;<span class="ident" id="7846665">err</span>&nbsp;<span class="op" id="7846669">:=</span>&nbsp;<span class="ident" id="7846672">Fprint</span><span class="op" id="7846678">(</span><span class="op" id="7846679">&amp;</span><span class="ident" id="7846680">buf</span><span class="op" id="7846683">,</span>&nbsp;<span class="ident" id="7846685">fset</span><span class="op" id="7846689">,</span>&nbsp;<span class="op" id="7846691">&amp;</span><span class="ident" id="7846692">ast</span><span class="op" id="7846695">.</span><span class="ident" id="7846696">Ident</span><span class="op" id="7846701">{</span><span class="ident" id="7846702">Name</span><span class="op" id="7846706">:</span>&nbsp;<span class="ident" id="7846708">name</span><span class="op" id="7846712">}</span><span class="op" id="7846713">)</span><span class="op" id="7846714">;</span>&nbsp;<span class="ident" id="7846716">err</span>&nbsp;<span class="op" id="7846720">!=</span>&nbsp;<span class="ident" id="7846723">nil</span>&nbsp;<span class="op" id="7846727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7846731">panic</span><span class="op" id="7846736">(</span><span class="ident" id="7846737">err</span><span class="op" id="7846740">)</span>&nbsp;<span class="comment" id="7846742">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7846760">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7846763">//&nbsp;in&nbsp;debug&nbsp;mode,&nbsp;the&nbsp;result&nbsp;contains&nbsp;additional&nbsp;information;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7846826">//&nbsp;ignore&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7846840">if</span>&nbsp;<span class="ident" id="7846843">s</span>&nbsp;<span class="op" id="7846845">:=</span>&nbsp;<span class="ident" id="7846848">buf</span><span class="op" id="7846851">.</span><span class="ident" id="7846852">String</span><span class="op" id="7846858">(</span><span class="op" id="7846859">)</span><span class="op" id="7846860">;</span>&nbsp;<span class="op" id="7846862">!</span><span class="ident" id="7846863">debug</span>&nbsp;<span class="op" id="7846869">&amp;&amp;</span>&nbsp;<span class="ident" id="7846872">s</span>&nbsp;<span class="op" id="7846874">!=</span>&nbsp;<span class="ident" id="7846877">name</span>&nbsp;<span class="op" id="7846882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7846886">panic</span><span class="op" id="7846891">(</span><span class="string" id="7846892">&#34;got&nbsp;&#34;</span>&nbsp;<span class="op" id="7846899">+</span>&nbsp;<span class="ident" id="7846901">s</span>&nbsp;<span class="op" id="7846903">+</span>&nbsp;<span class="string" id="7846905">&#34;,&nbsp;want&nbsp;&#34;</span>&nbsp;<span class="op" id="7846915">+</span>&nbsp;<span class="ident" id="7846917">name</span><span class="op" id="7846921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7846924">}</span><br>
<span class="lineno">255</span><span class="op" id="7846926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7846929">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;doesn&#39;t&nbsp;crash&nbsp;if&nbsp;the&nbsp;AST&nbsp;contains&nbsp;BadXXX&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="7847004">func</span>&nbsp;<span class="ident" id="7847009">TestBadNodes</span><span class="op" id="7847021">(</span><span class="ident" id="7847022">t</span>&nbsp;<span class="op" id="7847024">*</span><span class="ident" id="7847025">testing</span><span class="op" id="7847032">.</span><span class="ident" id="7847033">T</span><span class="op" id="7847034">)</span>&nbsp;<span class="op" id="7847036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7847039">const</span>&nbsp;<span class="ident" id="7847045">src</span>&nbsp;<span class="op" id="7847049">=</span>&nbsp;<span class="string" id="7847051">&#34;package&nbsp;p\n(&#34;</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7847067">const</span>&nbsp;<span class="ident" id="7847073">res</span>&nbsp;<span class="op" id="7847077">=</span>&nbsp;<span class="string" id="7847079">&#34;package&nbsp;p\nBadDecl\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7847103">f</span><span class="op" id="7847104">,</span>&nbsp;<span class="ident" id="7847106">err</span>&nbsp;<span class="op" id="7847110">:=</span>&nbsp;<span class="ident" id="7847113">parser</span><span class="op" id="7847119">.</span><span class="ident" id="7847120">ParseFile</span><span class="op" id="7847129">(</span><span class="ident" id="7847130">fset</span><span class="op" id="7847134">,</span>&nbsp;<span class="string" id="7847136">&#34;&#34;</span><span class="op" id="7847138">,</span>&nbsp;<span class="ident" id="7847140">src</span><span class="op" id="7847143">,</span>&nbsp;<span class="ident" id="7847145">parser</span><span class="op" id="7847151">.</span><span class="ident" id="7847152">ParseComments</span><span class="op" id="7847165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7847168">if</span>&nbsp;<span class="ident" id="7847171">err</span>&nbsp;<span class="op" id="7847175">==</span>&nbsp;<span class="ident" id="7847178">nil</span>&nbsp;<span class="op" id="7847182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7847186">t</span><span class="op" id="7847187">.</span><span class="ident" id="7847188">Error</span><span class="op" id="7847193">(</span><span class="string" id="7847194">&#34;expected&nbsp;illegal&nbsp;program&#34;</span><span class="op" id="7847220">)</span>&nbsp;<span class="comment" id="7847222">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7847240">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7847243">var</span>&nbsp;<span class="ident" id="7847247">buf</span>&nbsp;<span class="ident" id="7847251">bytes</span><span class="op" id="7847256">.</span><span class="ident" id="7847257">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7847265">Fprint</span><span class="op" id="7847271">(</span><span class="op" id="7847272">&amp;</span><span class="ident" id="7847273">buf</span><span class="op" id="7847276">,</span>&nbsp;<span class="ident" id="7847278">fset</span><span class="op" id="7847282">,</span>&nbsp;<span class="ident" id="7847284">f</span><span class="op" id="7847285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7847288">if</span>&nbsp;<span class="ident" id="7847291">buf</span><span class="op" id="7847294">.</span><span class="ident" id="7847295">String</span><span class="op" id="7847301">(</span><span class="op" id="7847302">)</span>&nbsp;<span class="op" id="7847304">!=</span>&nbsp;<span class="ident" id="7847307">res</span>&nbsp;<span class="op" id="7847311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7847315">t</span><span class="op" id="7847316">.</span><span class="ident" id="7847317">Errorf</span><span class="op" id="7847323">(</span><span class="string" id="7847324">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7847345">,</span>&nbsp;<span class="ident" id="7847347">buf</span><span class="op" id="7847350">.</span><span class="ident" id="7847351">String</span><span class="op" id="7847357">(</span><span class="op" id="7847358">)</span><span class="op" id="7847359">,</span>&nbsp;<span class="ident" id="7847361">res</span><span class="op" id="7847364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7847367">}</span><br>
<span class="lineno">270</span><span class="op" id="7847369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7847372">//&nbsp;testComment&nbsp;verifies&nbsp;that&nbsp;f&nbsp;can&nbsp;be&nbsp;parsed&nbsp;again&nbsp;after&nbsp;printing&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="7847441">//&nbsp;with&nbsp;its&nbsp;first&nbsp;comment&nbsp;set&nbsp;to&nbsp;comment&nbsp;at&nbsp;any&nbsp;possible&nbsp;source&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="7847513">func</span>&nbsp;<span class="ident" id="7847518">testComment</span><span class="op" id="7847529">(</span><span class="ident" id="7847530">t</span>&nbsp;<span class="op" id="7847532">*</span><span class="ident" id="7847533">testing</span><span class="op" id="7847540">.</span><span class="ident" id="7847541">T</span><span class="op" id="7847542">,</span>&nbsp;<span class="ident" id="7847544">f</span>&nbsp;<span class="op" id="7847546">*</span><span class="ident" id="7847547">ast</span><span class="op" id="7847550">.</span><span class="ident" id="7847551">File</span><span class="op" id="7847555">,</span>&nbsp;<span class="ident" id="7847557">srclen</span>&nbsp;<span class="builtintype" id="7847564">int</span><span class="op" id="7847567">,</span>&nbsp;<span class="ident" id="7847569">comment</span>&nbsp;<span class="op" id="7847577">*</span><span class="ident" id="7847578">ast</span><span class="op" id="7847581">.</span><span class="ident" id="7847582">Comment</span><span class="op" id="7847589">)</span>&nbsp;<span class="op" id="7847591">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7847594">f</span><span class="op" id="7847595">.</span><span class="ident" id="7847596">Comments</span><span class="op" id="7847604">[</span><span class="num" id="7847605">0</span><span class="op" id="7847606">]</span><span class="op" id="7847607">.</span><span class="ident" id="7847608">List</span><span class="op" id="7847612">[</span><span class="num" id="7847613">0</span><span class="op" id="7847614">]</span>&nbsp;<span class="op" id="7847616">=</span>&nbsp;<span class="ident" id="7847618">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7847627">var</span>&nbsp;<span class="ident" id="7847631">buf</span>&nbsp;<span class="ident" id="7847635">bytes</span><span class="op" id="7847640">.</span><span class="ident" id="7847641">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7847649">for</span>&nbsp;<span class="ident" id="7847653">offs</span>&nbsp;<span class="op" id="7847658">:=</span>&nbsp;<span class="num" id="7847661">0</span><span class="op" id="7847662">;</span>&nbsp;<span class="ident" id="7847664">offs</span>&nbsp;<span class="op" id="7847669">&lt;=</span>&nbsp;<span class="ident" id="7847672">srclen</span><span class="op" id="7847678">;</span>&nbsp;<span class="ident" id="7847680">offs</span><span class="op" id="7847684">++</span>&nbsp;<span class="op" id="7847687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7847691">buf</span><span class="op" id="7847694">.</span><span class="ident" id="7847695">Reset</span><span class="op" id="7847700">(</span><span class="op" id="7847701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7847705">//&nbsp;Printing&nbsp;f&nbsp;should&nbsp;result&nbsp;in&nbsp;a&nbsp;correct&nbsp;program&nbsp;no</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7847759">//&nbsp;matter&nbsp;what&nbsp;the&nbsp;(incorrect)&nbsp;comment&nbsp;position&nbsp;is.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7847813">if</span>&nbsp;<span class="ident" id="7847816">err</span>&nbsp;<span class="op" id="7847820">:=</span>&nbsp;<span class="ident" id="7847823">Fprint</span><span class="op" id="7847829">(</span><span class="op" id="7847830">&amp;</span><span class="ident" id="7847831">buf</span><span class="op" id="7847834">,</span>&nbsp;<span class="ident" id="7847836">fset</span><span class="op" id="7847840">,</span>&nbsp;<span class="ident" id="7847842">f</span><span class="op" id="7847843">)</span><span class="op" id="7847844">;</span>&nbsp;<span class="ident" id="7847846">err</span>&nbsp;<span class="op" id="7847850">!=</span>&nbsp;<span class="ident" id="7847853">nil</span>&nbsp;<span class="op" id="7847857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7847862">t</span><span class="op" id="7847863">.</span><span class="ident" id="7847864">Error</span><span class="op" id="7847869">(</span><span class="ident" id="7847870">err</span><span class="op" id="7847873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7847877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7847881">if</span>&nbsp;<span class="ident" id="7847884">_</span><span class="op" id="7847885">,</span>&nbsp;<span class="ident" id="7847887">err</span>&nbsp;<span class="op" id="7847891">:=</span>&nbsp;<span class="ident" id="7847894">parser</span><span class="op" id="7847900">.</span><span class="ident" id="7847901">ParseFile</span><span class="op" id="7847910">(</span><span class="ident" id="7847911">fset</span><span class="op" id="7847915">,</span>&nbsp;<span class="string" id="7847917">&#34;&#34;</span><span class="op" id="7847919">,</span>&nbsp;<span class="ident" id="7847921">buf</span><span class="op" id="7847924">.</span><span class="ident" id="7847925">Bytes</span><span class="op" id="7847930">(</span><span class="op" id="7847931">)</span><span class="op" id="7847932">,</span>&nbsp;<span class="num" id="7847934">0</span><span class="op" id="7847935">)</span><span class="op" id="7847936">;</span>&nbsp;<span class="ident" id="7847938">err</span>&nbsp;<span class="op" id="7847942">!=</span>&nbsp;<span class="ident" id="7847945">nil</span>&nbsp;<span class="op" id="7847949">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7847954">t</span><span class="op" id="7847955">.</span><span class="ident" id="7847956">Fatalf</span><span class="op" id="7847962">(</span><span class="string" id="7847963">&#34;incorrect&nbsp;program&nbsp;for&nbsp;pos&nbsp;=&nbsp;%d:\n%s&#34;</span><span class="op" id="7848000">,</span>&nbsp;<span class="ident" id="7848002">comment</span><span class="op" id="7848009">.</span><span class="ident" id="7848010">Slash</span><span class="op" id="7848015">,</span>&nbsp;<span class="ident" id="7848017">buf</span><span class="op" id="7848020">.</span><span class="ident" id="7848021">String</span><span class="op" id="7848027">(</span><span class="op" id="7848028">)</span><span class="op" id="7848029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7848033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7848037">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;just&nbsp;an&nbsp;offset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7848082">//&nbsp;Move&nbsp;comment&nbsp;one&nbsp;byte&nbsp;down&nbsp;in&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7848129">comment</span><span class="op" id="7848136">.</span><span class="ident" id="7848137">Slash</span><span class="op" id="7848142">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7848146">}</span><br>
<span class="lineno"></span><span class="op" id="7848148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7848151">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;produces&nbsp;a&nbsp;correct&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="7848205">//&nbsp;even&nbsp;if&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;comments&nbsp;introducing&nbsp;newlines</span><br>
<span class="lineno">295</span><span class="comment" id="7848274">//&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="keyword" id="7848291">func</span>&nbsp;<span class="ident" id="7848296">TestBadComments</span><span class="op" id="7848311">(</span><span class="ident" id="7848312">t</span>&nbsp;<span class="op" id="7848314">*</span><span class="ident" id="7848315">testing</span><span class="op" id="7848322">.</span><span class="ident" id="7848323">T</span><span class="op" id="7848324">)</span>&nbsp;<span class="op" id="7848326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7848329">const</span>&nbsp;<span class="ident" id="7848335">src</span>&nbsp;<span class="op" id="7848339">=</span>&nbsp;<span class="string" id="7848341">`<br>
<span class="lineno"></span>//&nbsp;first&nbsp;comment&nbsp;-&nbsp;text&nbsp;and&nbsp;position&nbsp;changed&nbsp;by&nbsp;test<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">300</span>import&nbsp;&#34;fmt&#34;<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14&nbsp;//&nbsp;rough&nbsp;circle<br>
<span class="lineno"></span>var&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;x,&nbsp;y,&nbsp;z&nbsp;int&nbsp;=&nbsp;1,&nbsp;2,&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;u,&nbsp;v&nbsp;float64<br>
<span class="lineno">305</span>)<br>
<span class="lineno"></span>func&nbsp;fibo(n&nbsp;int)&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;n&nbsp;&lt;&nbsp;2&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;n&nbsp;/*&nbsp;seed&nbsp;values&nbsp;*/<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;fibo(n-1)&nbsp;+&nbsp;fibo(n-2)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7848595">f</span><span class="op" id="7848596">,</span>&nbsp;<span class="ident" id="7848598">err</span>&nbsp;<span class="op" id="7848602">:=</span>&nbsp;<span class="ident" id="7848605">parser</span><span class="op" id="7848611">.</span><span class="ident" id="7848612">ParseFile</span><span class="op" id="7848621">(</span><span class="ident" id="7848622">fset</span><span class="op" id="7848626">,</span>&nbsp;<span class="string" id="7848628">&#34;&#34;</span><span class="op" id="7848630">,</span>&nbsp;<span class="ident" id="7848632">src</span><span class="op" id="7848635">,</span>&nbsp;<span class="ident" id="7848637">parser</span><span class="op" id="7848643">.</span><span class="ident" id="7848644">ParseComments</span><span class="op" id="7848657">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7848660">if</span>&nbsp;<span class="ident" id="7848663">err</span>&nbsp;<span class="op" id="7848667">!=</span>&nbsp;<span class="ident" id="7848670">nil</span>&nbsp;<span class="op" id="7848674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7848678">t</span><span class="op" id="7848679">.</span><span class="ident" id="7848680">Error</span><span class="op" id="7848685">(</span><span class="ident" id="7848686">err</span><span class="op" id="7848689">)</span>&nbsp;<span class="comment" id="7848691">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7848709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7848713">comment</span>&nbsp;<span class="op" id="7848721">:=</span>&nbsp;<span class="ident" id="7848724">f</span><span class="op" id="7848725">.</span><span class="ident" id="7848726">Comments</span><span class="op" id="7848734">[</span><span class="num" id="7848735">0</span><span class="op" id="7848736">]</span><span class="op" id="7848737">.</span><span class="ident" id="7848738">List</span><span class="op" id="7848742">[</span><span class="num" id="7848743">0</span><span class="op" id="7848744">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7848747">pos</span>&nbsp;<span class="op" id="7848751">:=</span>&nbsp;<span class="ident" id="7848754">comment</span><span class="op" id="7848761">.</span><span class="ident" id="7848762">Pos</span><span class="op" id="7848765">(</span><span class="op" id="7848766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7848769">if</span>&nbsp;<span class="ident" id="7848772">fset</span><span class="op" id="7848776">.</span><span class="ident" id="7848777">Position</span><span class="op" id="7848785">(</span><span class="ident" id="7848786">pos</span><span class="op" id="7848789">)</span><span class="op" id="7848790">.</span><span class="ident" id="7848791">Offset</span>&nbsp;<span class="op" id="7848798">!=</span>&nbsp;<span class="num" id="7848801">1</span>&nbsp;<span class="op" id="7848803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7848807">t</span><span class="op" id="7848808">.</span><span class="ident" id="7848809">Error</span><span class="op" id="7848814">(</span><span class="string" id="7848815">&#34;expected&nbsp;offset&nbsp;1&#34;</span><span class="op" id="7848834">)</span>&nbsp;<span class="comment" id="7848836">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7848854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7848858">testComment</span><span class="op" id="7848869">(</span><span class="ident" id="7848870">t</span><span class="op" id="7848871">,</span>&nbsp;<span class="ident" id="7848873">f</span><span class="op" id="7848874">,</span>&nbsp;<span class="builtinfunc" id="7848876">len</span><span class="op" id="7848879">(</span><span class="ident" id="7848880">src</span><span class="op" id="7848883">)</span><span class="op" id="7848884">,</span>&nbsp;<span class="op" id="7848886">&amp;</span><span class="ident" id="7848887">ast</span><span class="op" id="7848890">.</span><span class="ident" id="7848891">Comment</span><span class="op" id="7848898">{</span><span class="ident" id="7848899">Slash</span><span class="op" id="7848904">:</span>&nbsp;<span class="ident" id="7848906">pos</span><span class="op" id="7848909">,</span>&nbsp;<span class="ident" id="7848911">Text</span><span class="op" id="7848915">:</span>&nbsp;<span class="string" id="7848917">&#34;//-style&nbsp;comment&#34;</span><span class="op" id="7848935">}</span><span class="op" id="7848936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7848939">testComment</span><span class="op" id="7848950">(</span><span class="ident" id="7848951">t</span><span class="op" id="7848952">,</span>&nbsp;<span class="ident" id="7848954">f</span><span class="op" id="7848955">,</span>&nbsp;<span class="builtinfunc" id="7848957">len</span><span class="op" id="7848960">(</span><span class="ident" id="7848961">src</span><span class="op" id="7848964">)</span><span class="op" id="7848965">,</span>&nbsp;<span class="op" id="7848967">&amp;</span><span class="ident" id="7848968">ast</span><span class="op" id="7848971">.</span><span class="ident" id="7848972">Comment</span><span class="op" id="7848979">{</span><span class="ident" id="7848980">Slash</span><span class="op" id="7848985">:</span>&nbsp;<span class="ident" id="7848987">pos</span><span class="op" id="7848990">,</span>&nbsp;<span class="ident" id="7848992">Text</span><span class="op" id="7848996">:</span>&nbsp;<span class="string" id="7848998">&#34;/*-style&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="7849019">}</span><span class="op" id="7849020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7849023">testComment</span><span class="op" id="7849034">(</span><span class="ident" id="7849035">t</span><span class="op" id="7849036">,</span>&nbsp;<span class="ident" id="7849038">f</span><span class="op" id="7849039">,</span>&nbsp;<span class="builtinfunc" id="7849041">len</span><span class="op" id="7849044">(</span><span class="ident" id="7849045">src</span><span class="op" id="7849048">)</span><span class="op" id="7849049">,</span>&nbsp;<span class="op" id="7849051">&amp;</span><span class="ident" id="7849052">ast</span><span class="op" id="7849055">.</span><span class="ident" id="7849056">Comment</span><span class="op" id="7849063">{</span><span class="ident" id="7849064">Slash</span><span class="op" id="7849069">:</span>&nbsp;<span class="ident" id="7849071">pos</span><span class="op" id="7849074">,</span>&nbsp;<span class="ident" id="7849076">Text</span><span class="op" id="7849080">:</span>&nbsp;<span class="string" id="7849082">&#34;/*-style&nbsp;\n&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="7849106">}</span><span class="op" id="7849107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7849110">testComment</span><span class="op" id="7849121">(</span><span class="ident" id="7849122">t</span><span class="op" id="7849123">,</span>&nbsp;<span class="ident" id="7849125">f</span><span class="op" id="7849126">,</span>&nbsp;<span class="builtinfunc" id="7849128">len</span><span class="op" id="7849131">(</span><span class="ident" id="7849132">src</span><span class="op" id="7849135">)</span><span class="op" id="7849136">,</span>&nbsp;<span class="op" id="7849138">&amp;</span><span class="ident" id="7849139">ast</span><span class="op" id="7849142">.</span><span class="ident" id="7849143">Comment</span><span class="op" id="7849150">{</span><span class="ident" id="7849151">Slash</span><span class="op" id="7849156">:</span>&nbsp;<span class="ident" id="7849158">pos</span><span class="op" id="7849161">,</span>&nbsp;<span class="ident" id="7849163">Text</span><span class="op" id="7849167">:</span>&nbsp;<span class="string" id="7849169">&#34;/*-style&nbsp;comment&nbsp;\n\n\n&nbsp;*/&#34;</span><span class="op" id="7849197">}</span><span class="op" id="7849198">)</span><br>
<span class="lineno"></span><span class="op" id="7849200">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="7849203">type</span>&nbsp;<span class="ident" id="7849208">visitor</span>&nbsp;<span class="keyword" id="7849216">chan</span>&nbsp;<span class="op" id="7849221">*</span><span class="ident" id="7849222">ast</span><span class="op" id="7849225">.</span><span class="ident" id="7849226">Ident</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7849233">func</span>&nbsp;<span class="op" id="7849238">(</span><span class="ident" id="7849239">v</span>&nbsp;<span class="ident" id="7849241">visitor</span><span class="op" id="7849248">)</span>&nbsp;<span class="ident" id="7849250">Visit</span><span class="op" id="7849255">(</span><span class="ident" id="7849256">n</span>&nbsp;<span class="ident" id="7849258">ast</span><span class="op" id="7849261">.</span><span class="ident" id="7849262">Node</span><span class="op" id="7849266">)</span>&nbsp;<span class="op" id="7849268">(</span><span class="ident" id="7849269">w</span>&nbsp;<span class="ident" id="7849271">ast</span><span class="op" id="7849274">.</span><span class="ident" id="7849275">Visitor</span><span class="op" id="7849282">)</span>&nbsp;<span class="op" id="7849284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7849287">if</span>&nbsp;<span class="ident" id="7849290">ident</span><span class="op" id="7849295">,</span>&nbsp;<span class="ident" id="7849297">ok</span>&nbsp;<span class="op" id="7849300">:=</span>&nbsp;<span class="ident" id="7849303">n</span><span class="op" id="7849304">.</span><span class="op" id="7849305">(</span><span class="op" id="7849306">*</span><span class="ident" id="7849307">ast</span><span class="op" id="7849310">.</span><span class="ident" id="7849311">Ident</span><span class="op" id="7849316">)</span><span class="op" id="7849317">;</span>&nbsp;<span class="ident" id="7849319">ok</span>&nbsp;<span class="op" id="7849322">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7849326">v</span>&nbsp;<span class="op" id="7849328">&lt;-</span>&nbsp;<span class="ident" id="7849331">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7849338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7849341">return</span>&nbsp;<span class="ident" id="7849348">v</span><br>
<span class="lineno"></span><span class="op" id="7849350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="7849353">//&nbsp;idents&nbsp;is&nbsp;an&nbsp;iterator&nbsp;that&nbsp;returns&nbsp;all&nbsp;idents&nbsp;in&nbsp;f&nbsp;via&nbsp;the&nbsp;result&nbsp;channel.</span><br>
<span class="lineno"></span><span class="keyword" id="7849431">func</span>&nbsp;<span class="ident" id="7849436">idents</span><span class="op" id="7849442">(</span><span class="ident" id="7849443">f</span>&nbsp;<span class="op" id="7849445">*</span><span class="ident" id="7849446">ast</span><span class="op" id="7849449">.</span><span class="ident" id="7849450">File</span><span class="op" id="7849454">)</span>&nbsp;<span class="op" id="7849456">&lt;-</span><span class="keyword" id="7849458">chan</span>&nbsp;<span class="op" id="7849463">*</span><span class="ident" id="7849464">ast</span><span class="op" id="7849467">.</span><span class="ident" id="7849468">Ident</span>&nbsp;<span class="op" id="7849474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7849477">v</span>&nbsp;<span class="op" id="7849479">:=</span>&nbsp;<span class="builtinfunc" id="7849482">make</span><span class="op" id="7849486">(</span><span class="ident" id="7849487">visitor</span><span class="op" id="7849494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7849497">go</span>&nbsp;<span class="keyword" id="7849500">func</span><span class="op" id="7849504">(</span><span class="op" id="7849505">)</span>&nbsp;<span class="op" id="7849507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7849511">ast</span><span class="op" id="7849514">.</span><span class="ident" id="7849515">Walk</span><span class="op" id="7849519">(</span><span class="ident" id="7849520">v</span><span class="op" id="7849521">,</span>&nbsp;<span class="ident" id="7849523">f</span><span class="op" id="7849524">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7849528">close</span><span class="op" id="7849533">(</span><span class="ident" id="7849534">v</span><span class="op" id="7849535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7849538">}</span><span class="op" id="7849539">(</span><span class="op" id="7849540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7849543">return</span>&nbsp;<span class="ident" id="7849550">v</span><br>
<span class="lineno"></span><span class="op" id="7849552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="7849555">//&nbsp;identCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;found&nbsp;in&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="7849615">func</span>&nbsp;<span class="ident" id="7849620">identCount</span><span class="op" id="7849630">(</span><span class="ident" id="7849631">f</span>&nbsp;<span class="op" id="7849633">*</span><span class="ident" id="7849634">ast</span><span class="op" id="7849637">.</span><span class="ident" id="7849638">File</span><span class="op" id="7849642">)</span>&nbsp;<span class="builtintype" id="7849644">int</span>&nbsp;<span class="op" id="7849648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7849651">n</span>&nbsp;<span class="op" id="7849653">:=</span>&nbsp;<span class="num" id="7849656">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7849659">for</span>&nbsp;<span class="keyword" id="7849663">range</span>&nbsp;<span class="ident" id="7849669">idents</span><span class="op" id="7849675">(</span><span class="ident" id="7849676">f</span><span class="op" id="7849677">)</span>&nbsp;<span class="op" id="7849679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7849683">n</span><span class="op" id="7849684">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7849688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7849691">return</span>&nbsp;<span class="ident" id="7849698">n</span><br>
<span class="lineno"></span><span class="op" id="7849700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7849703">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;SourcePos&nbsp;mode&nbsp;emits&nbsp;correct&nbsp;//line&nbsp;comments</span><br>
<span class="lineno">360</span><span class="comment" id="7849767">//&nbsp;by&nbsp;testing&nbsp;that&nbsp;position&nbsp;information&nbsp;for&nbsp;matching&nbsp;identifiers</span><br>
<span class="lineno"></span><span class="comment" id="7849832">//&nbsp;is&nbsp;maintained.</span><br>
<span class="lineno"></span><span class="keyword" id="7849850">func</span>&nbsp;<span class="ident" id="7849855">TestSourcePos</span><span class="op" id="7849868">(</span><span class="ident" id="7849869">t</span>&nbsp;<span class="op" id="7849871">*</span><span class="ident" id="7849872">testing</span><span class="op" id="7849879">.</span><span class="ident" id="7849880">T</span><span class="op" id="7849881">)</span>&nbsp;<span class="op" id="7849883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7849886">const</span>&nbsp;<span class="ident" id="7849892">src</span>&nbsp;<span class="op" id="7849896">=</span>&nbsp;<span class="string" id="7849898">`<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">365</span>import&nbsp;(&nbsp;&#34;go/printer&#34;;&nbsp;&#34;math&#34;&nbsp;)<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14;&nbsp;var&nbsp;x&nbsp;=&nbsp;0<br>
<span class="lineno"></span>type&nbsp;t&nbsp;struct{&nbsp;x,&nbsp;y,&nbsp;z&nbsp;int;&nbsp;u,&nbsp;v,&nbsp;w&nbsp;float32&nbsp;}<br>
<span class="lineno"></span>func&nbsp;(t&nbsp;*t)&nbsp;foo(a,&nbsp;b,&nbsp;c&nbsp;int)&nbsp;int&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;a*t.x&nbsp;+&nbsp;b*t.y&nbsp;+<br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;two&nbsp;extra&nbsp;lines&nbsp;here<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;...<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c*t.z<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7850123">//&nbsp;parse&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7850142">f1</span><span class="op" id="7850144">,</span>&nbsp;<span class="ident" id="7850146">err</span>&nbsp;<span class="op" id="7850150">:=</span>&nbsp;<span class="ident" id="7850153">parser</span><span class="op" id="7850159">.</span><span class="ident" id="7850160">ParseFile</span><span class="op" id="7850169">(</span><span class="ident" id="7850170">fset</span><span class="op" id="7850174">,</span>&nbsp;<span class="string" id="7850176">&#34;src&#34;</span><span class="op" id="7850181">,</span>&nbsp;<span class="ident" id="7850183">src</span><span class="op" id="7850186">,</span>&nbsp;<span class="ident" id="7850188">parser</span><span class="op" id="7850194">.</span><span class="ident" id="7850195">ParseComments</span><span class="op" id="7850208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7850211">if</span>&nbsp;<span class="ident" id="7850214">err</span>&nbsp;<span class="op" id="7850218">!=</span>&nbsp;<span class="ident" id="7850221">nil</span>&nbsp;<span class="op" id="7850225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7850229">t</span><span class="op" id="7850230">.</span><span class="ident" id="7850231">Fatal</span><span class="op" id="7850236">(</span><span class="ident" id="7850237">err</span><span class="op" id="7850240">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7850243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7850247">//&nbsp;pretty-print&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7850273">var</span>&nbsp;<span class="ident" id="7850277">buf</span>&nbsp;<span class="ident" id="7850281">bytes</span><span class="op" id="7850286">.</span><span class="ident" id="7850287">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7850295">err</span>&nbsp;<span class="op" id="7850299">=</span>&nbsp;<span class="op" id="7850301">(</span><span class="op" id="7850302">&amp;</span><span class="ident" id="7850303">Config</span><span class="op" id="7850309">{</span><span class="ident" id="7850310">Mode</span><span class="op" id="7850314">:</span>&nbsp;<span class="ident" id="7850316">UseSpaces</span>&nbsp;<span class="op" id="7850326">|</span>&nbsp;<span class="ident" id="7850328">SourcePos</span><span class="op" id="7850337">,</span>&nbsp;<span class="ident" id="7850339">Tabwidth</span><span class="op" id="7850347">:</span>&nbsp;<span class="num" id="7850349">8</span><span class="op" id="7850350">}</span><span class="op" id="7850351">)</span><span class="op" id="7850352">.</span><span class="ident" id="7850353">Fprint</span><span class="op" id="7850359">(</span><span class="op" id="7850360">&amp;</span><span class="ident" id="7850361">buf</span><span class="op" id="7850364">,</span>&nbsp;<span class="ident" id="7850366">fset</span><span class="op" id="7850370">,</span>&nbsp;<span class="ident" id="7850372">f1</span><span class="op" id="7850374">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7850377">if</span>&nbsp;<span class="ident" id="7850380">err</span>&nbsp;<span class="op" id="7850384">!=</span>&nbsp;<span class="ident" id="7850387">nil</span>&nbsp;<span class="op" id="7850391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7850395">t</span><span class="op" id="7850396">.</span><span class="ident" id="7850397">Fatal</span><span class="op" id="7850402">(</span><span class="ident" id="7850403">err</span><span class="op" id="7850406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7850409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7850413">//&nbsp;parse&nbsp;pretty&nbsp;printed&nbsp;original</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7850447">//&nbsp;(//line&nbsp;comments&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;even&nbsp;w/o&nbsp;parser.ParseComments&nbsp;set)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7850523">f2</span><span class="op" id="7850525">,</span>&nbsp;<span class="ident" id="7850527">err</span>&nbsp;<span class="op" id="7850531">:=</span>&nbsp;<span class="ident" id="7850534">parser</span><span class="op" id="7850540">.</span><span class="ident" id="7850541">ParseFile</span><span class="op" id="7850550">(</span><span class="ident" id="7850551">fset</span><span class="op" id="7850555">,</span>&nbsp;<span class="string" id="7850557">&#34;&#34;</span><span class="op" id="7850559">,</span>&nbsp;<span class="ident" id="7850561">buf</span><span class="op" id="7850564">.</span><span class="ident" id="7850565">Bytes</span><span class="op" id="7850570">(</span><span class="op" id="7850571">)</span><span class="op" id="7850572">,</span>&nbsp;<span class="num" id="7850574">0</span><span class="op" id="7850575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7850578">if</span>&nbsp;<span class="ident" id="7850581">err</span>&nbsp;<span class="op" id="7850585">!=</span>&nbsp;<span class="ident" id="7850588">nil</span>&nbsp;<span class="op" id="7850592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7850596">t</span><span class="op" id="7850597">.</span><span class="ident" id="7850598">Fatalf</span><span class="op" id="7850604">(</span><span class="string" id="7850605">&#34;%s\n%s&#34;</span><span class="op" id="7850613">,</span>&nbsp;<span class="ident" id="7850615">err</span><span class="op" id="7850618">,</span>&nbsp;<span class="ident" id="7850620">buf</span><span class="op" id="7850623">.</span><span class="ident" id="7850624">Bytes</span><span class="op" id="7850629">(</span><span class="op" id="7850630">)</span><span class="op" id="7850631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7850634">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7850638">//&nbsp;At&nbsp;this&nbsp;point&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;identifiers&nbsp;in&nbsp;f2&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7850709">//&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;corresponding&nbsp;identifiers&nbsp;in&nbsp;f1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7850781">//&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;&gt;&nbsp;0&nbsp;(test&nbsp;should&nbsp;run)&nbsp;and&nbsp;must&nbsp;match</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7850852">n1</span>&nbsp;<span class="op" id="7850855">:=</span>&nbsp;<span class="ident" id="7850858">identCount</span><span class="op" id="7850868">(</span><span class="ident" id="7850869">f1</span><span class="op" id="7850871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7850874">n2</span>&nbsp;<span class="op" id="7850877">:=</span>&nbsp;<span class="ident" id="7850880">identCount</span><span class="op" id="7850890">(</span><span class="ident" id="7850891">f2</span><span class="op" id="7850893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7850896">if</span>&nbsp;<span class="ident" id="7850899">n1</span>&nbsp;<span class="op" id="7850902">==</span>&nbsp;<span class="num" id="7850905">0</span>&nbsp;<span class="op" id="7850907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7850911">t</span><span class="op" id="7850912">.</span><span class="ident" id="7850913">Fatal</span><span class="op" id="7850918">(</span><span class="string" id="7850919">&#34;got&nbsp;no&nbsp;idents&#34;</span><span class="op" id="7850934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7850937">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7850940">if</span>&nbsp;<span class="ident" id="7850943">n2</span>&nbsp;<span class="op" id="7850946">!=</span>&nbsp;<span class="ident" id="7850949">n1</span>&nbsp;<span class="op" id="7850952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7850956">t</span><span class="op" id="7850957">.</span><span class="ident" id="7850958">Errorf</span><span class="op" id="7850964">(</span><span class="string" id="7850965">&#34;got&nbsp;%d&nbsp;idents;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7850989">,</span>&nbsp;<span class="ident" id="7850991">n2</span><span class="op" id="7850993">,</span>&nbsp;<span class="ident" id="7850995">n1</span><span class="op" id="7850997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7851000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7851004">//&nbsp;verify&nbsp;that&nbsp;all&nbsp;identifiers&nbsp;have&nbsp;correct&nbsp;line&nbsp;information</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7851066">i2range</span>&nbsp;<span class="op" id="7851074">:=</span>&nbsp;<span class="ident" id="7851077">idents</span><span class="op" id="7851083">(</span><span class="ident" id="7851084">f2</span><span class="op" id="7851086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7851089">for</span>&nbsp;<span class="ident" id="7851093">i1</span>&nbsp;<span class="op" id="7851096">:=</span>&nbsp;<span class="keyword" id="7851099">range</span>&nbsp;<span class="ident" id="7851105">idents</span><span class="op" id="7851111">(</span><span class="ident" id="7851112">f1</span><span class="op" id="7851114">)</span>&nbsp;<span class="op" id="7851116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7851120">i2</span>&nbsp;<span class="op" id="7851123">:=</span>&nbsp;<span class="op" id="7851126">&lt;-</span><span class="ident" id="7851128">i2range</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7851139">if</span>&nbsp;<span class="ident" id="7851142">i2</span><span class="op" id="7851144">.</span><span class="ident" id="7851145">Name</span>&nbsp;<span class="op" id="7851150">!=</span>&nbsp;<span class="ident" id="7851153">i1</span><span class="op" id="7851155">.</span><span class="ident" id="7851156">Name</span>&nbsp;<span class="op" id="7851161">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7851166">t</span><span class="op" id="7851167">.</span><span class="ident" id="7851168">Errorf</span><span class="op" id="7851174">(</span><span class="string" id="7851175">&#34;got&nbsp;ident&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7851198">,</span>&nbsp;<span class="ident" id="7851200">i2</span><span class="op" id="7851202">.</span><span class="ident" id="7851203">Name</span><span class="op" id="7851207">,</span>&nbsp;<span class="ident" id="7851209">i1</span><span class="op" id="7851211">.</span><span class="ident" id="7851212">Name</span><span class="op" id="7851216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7851220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7851225">l1</span>&nbsp;<span class="op" id="7851228">:=</span>&nbsp;<span class="ident" id="7851231">fset</span><span class="op" id="7851235">.</span><span class="ident" id="7851236">Position</span><span class="op" id="7851244">(</span><span class="ident" id="7851245">i1</span><span class="op" id="7851247">.</span><span class="ident" id="7851248">Pos</span><span class="op" id="7851251">(</span><span class="op" id="7851252">)</span><span class="op" id="7851253">)</span><span class="op" id="7851254">.</span><span class="ident" id="7851255">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7851262">l2</span>&nbsp;<span class="op" id="7851265">:=</span>&nbsp;<span class="ident" id="7851268">fset</span><span class="op" id="7851272">.</span><span class="ident" id="7851273">Position</span><span class="op" id="7851281">(</span><span class="ident" id="7851282">i2</span><span class="op" id="7851284">.</span><span class="ident" id="7851285">Pos</span><span class="op" id="7851288">(</span><span class="op" id="7851289">)</span><span class="op" id="7851290">)</span><span class="op" id="7851291">.</span><span class="ident" id="7851292">Line</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7851299">if</span>&nbsp;<span class="ident" id="7851302">l2</span>&nbsp;<span class="op" id="7851305">!=</span>&nbsp;<span class="ident" id="7851308">l1</span>&nbsp;<span class="op" id="7851311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7851316">t</span><span class="op" id="7851317">.</span><span class="ident" id="7851318">Errorf</span><span class="op" id="7851324">(</span><span class="string" id="7851325">&#34;got&nbsp;line&nbsp;%d;&nbsp;want&nbsp;%d&nbsp;for&nbsp;%s&#34;</span><span class="op" id="7851354">,</span>&nbsp;<span class="ident" id="7851356">l2</span><span class="op" id="7851358">,</span>&nbsp;<span class="ident" id="7851360">l1</span><span class="op" id="7851362">,</span>&nbsp;<span class="ident" id="7851364">i1</span><span class="op" id="7851366">.</span><span class="ident" id="7851367">Name</span><span class="op" id="7851371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7851375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7851378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7851382">if</span>&nbsp;<span class="ident" id="7851385">t</span><span class="op" id="7851386">.</span><span class="ident" id="7851387">Failed</span><span class="op" id="7851393">(</span><span class="op" id="7851394">)</span>&nbsp;<span class="op" id="7851396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7851400">t</span><span class="op" id="7851401">.</span><span class="ident" id="7851402">Logf</span><span class="op" id="7851406">(</span><span class="string" id="7851407">&#34;\n%s&#34;</span><span class="op" id="7851413">,</span>&nbsp;<span class="ident" id="7851415">buf</span><span class="op" id="7851418">.</span><span class="ident" id="7851419">Bytes</span><span class="op" id="7851424">(</span><span class="op" id="7851425">)</span><span class="op" id="7851426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7851429">}</span><br>
<span class="lineno"></span><span class="op" id="7851431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="7851434">var</span>&nbsp;<span class="ident" id="7851438">decls</span>&nbsp;<span class="op" id="7851444">=</span>&nbsp;<span class="op" id="7851446">[</span><span class="op" id="7851447">]</span><span class="builtintype" id="7851448">string</span><span class="op" id="7851454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7851457">`import&nbsp;&#34;fmt&#34;`</span><span class="op" id="7851471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7851474">&#34;const&nbsp;pi&nbsp;=&nbsp;3.1415\nconst&nbsp;e&nbsp;=&nbsp;2.71828\n\nvar&nbsp;x&nbsp;=&nbsp;pi&#34;</span><span class="op" id="7851526">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7851529">&#34;func&nbsp;sum(x,&nbsp;y&nbsp;int)&nbsp;int\t{&nbsp;return&nbsp;x&nbsp;+&nbsp;y&nbsp;}&#34;</span><span class="op" id="7851571">,</span><br>
<span class="lineno"></span><span class="op" id="7851573">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="keyword" id="7851576">func</span>&nbsp;<span class="ident" id="7851581">TestDeclLists</span><span class="op" id="7851594">(</span><span class="ident" id="7851595">t</span>&nbsp;<span class="op" id="7851597">*</span><span class="ident" id="7851598">testing</span><span class="op" id="7851605">.</span><span class="ident" id="7851606">T</span><span class="op" id="7851607">)</span>&nbsp;<span class="op" id="7851609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7851612">for</span>&nbsp;<span class="ident" id="7851616">_</span><span class="op" id="7851617">,</span>&nbsp;<span class="ident" id="7851619">src</span>&nbsp;<span class="op" id="7851623">:=</span>&nbsp;<span class="keyword" id="7851626">range</span>&nbsp;<span class="ident" id="7851632">decls</span>&nbsp;<span class="op" id="7851638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7851642">file</span><span class="op" id="7851646">,</span>&nbsp;<span class="ident" id="7851648">err</span>&nbsp;<span class="op" id="7851652">:=</span>&nbsp;<span class="ident" id="7851655">parser</span><span class="op" id="7851661">.</span><span class="ident" id="7851662">ParseFile</span><span class="op" id="7851671">(</span><span class="ident" id="7851672">fset</span><span class="op" id="7851676">,</span>&nbsp;<span class="string" id="7851678">&#34;&#34;</span><span class="op" id="7851680">,</span>&nbsp;<span class="string" id="7851682">&#34;package&nbsp;p;&#34;</span><span class="op" id="7851694">+</span><span class="ident" id="7851695">src</span><span class="op" id="7851698">,</span>&nbsp;<span class="ident" id="7851700">parser</span><span class="op" id="7851706">.</span><span class="ident" id="7851707">ParseComments</span><span class="op" id="7851720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7851724">if</span>&nbsp;<span class="ident" id="7851727">err</span>&nbsp;<span class="op" id="7851731">!=</span>&nbsp;<span class="ident" id="7851734">nil</span>&nbsp;<span class="op" id="7851738">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7851743">panic</span><span class="op" id="7851748">(</span><span class="ident" id="7851749">err</span><span class="op" id="7851752">)</span>&nbsp;<span class="comment" id="7851754">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7851773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7851778">var</span>&nbsp;<span class="ident" id="7851782">buf</span>&nbsp;<span class="ident" id="7851786">bytes</span><span class="op" id="7851791">.</span><span class="ident" id="7851792">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7851801">err</span>&nbsp;<span class="op" id="7851805">=</span>&nbsp;<span class="ident" id="7851807">Fprint</span><span class="op" id="7851813">(</span><span class="op" id="7851814">&amp;</span><span class="ident" id="7851815">buf</span><span class="op" id="7851818">,</span>&nbsp;<span class="ident" id="7851820">fset</span><span class="op" id="7851824">,</span>&nbsp;<span class="ident" id="7851826">file</span><span class="op" id="7851830">.</span><span class="ident" id="7851831">Decls</span><span class="op" id="7851836">)</span>&nbsp;<span class="comment" id="7851838">//&nbsp;only&nbsp;print&nbsp;declarations</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7851867">if</span>&nbsp;<span class="ident" id="7851870">err</span>&nbsp;<span class="op" id="7851874">!=</span>&nbsp;<span class="ident" id="7851877">nil</span>&nbsp;<span class="op" id="7851881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7851886">panic</span><span class="op" id="7851891">(</span><span class="ident" id="7851892">err</span><span class="op" id="7851895">)</span>&nbsp;<span class="comment" id="7851897">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7851916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7851921">out</span>&nbsp;<span class="op" id="7851925">:=</span>&nbsp;<span class="ident" id="7851928">buf</span><span class="op" id="7851931">.</span><span class="ident" id="7851932">String</span><span class="op" id="7851938">(</span><span class="op" id="7851939">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7851943">if</span>&nbsp;<span class="ident" id="7851946">out</span>&nbsp;<span class="op" id="7851950">!=</span>&nbsp;<span class="ident" id="7851953">src</span>&nbsp;<span class="op" id="7851957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7851962">t</span><span class="op" id="7851963">.</span><span class="ident" id="7851964">Errorf</span><span class="op" id="7851970">(</span><span class="string" id="7851971">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="7851995">,</span>&nbsp;<span class="ident" id="7851997">out</span><span class="op" id="7852000">,</span>&nbsp;<span class="ident" id="7852002">src</span><span class="op" id="7852005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7852009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7852012">}</span><br>
<span class="lineno"></span><span class="op" id="7852014">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="7852017">var</span>&nbsp;<span class="ident" id="7852021">stmts</span>&nbsp;<span class="op" id="7852027">=</span>&nbsp;<span class="op" id="7852029">[</span><span class="op" id="7852030">]</span><span class="builtintype" id="7852031">string</span><span class="op" id="7852037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7852040">&#34;i&nbsp;:=&nbsp;0&#34;</span><span class="op" id="7852048">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7852051">&#34;select&nbsp;{}\nvar&nbsp;a,&nbsp;b&nbsp;=&nbsp;1,&nbsp;2\nreturn&nbsp;a&nbsp;+&nbsp;b&#34;</span><span class="op" id="7852093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7852096">&#34;go&nbsp;f()\ndefer&nbsp;func()&nbsp;{}()&#34;</span><span class="op" id="7852123">,</span><br>
<span class="lineno">460</span><span class="op" id="7852125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7852128">func</span>&nbsp;<span class="ident" id="7852133">TestStmtLists</span><span class="op" id="7852146">(</span><span class="ident" id="7852147">t</span>&nbsp;<span class="op" id="7852149">*</span><span class="ident" id="7852150">testing</span><span class="op" id="7852157">.</span><span class="ident" id="7852158">T</span><span class="op" id="7852159">)</span>&nbsp;<span class="op" id="7852161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7852164">for</span>&nbsp;<span class="ident" id="7852168">_</span><span class="op" id="7852169">,</span>&nbsp;<span class="ident" id="7852171">src</span>&nbsp;<span class="op" id="7852175">:=</span>&nbsp;<span class="keyword" id="7852178">range</span>&nbsp;<span class="ident" id="7852184">stmts</span>&nbsp;<span class="op" id="7852190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7852194">file</span><span class="op" id="7852198">,</span>&nbsp;<span class="ident" id="7852200">err</span>&nbsp;<span class="op" id="7852204">:=</span>&nbsp;<span class="ident" id="7852207">parser</span><span class="op" id="7852213">.</span><span class="ident" id="7852214">ParseFile</span><span class="op" id="7852223">(</span><span class="ident" id="7852224">fset</span><span class="op" id="7852228">,</span>&nbsp;<span class="string" id="7852230">&#34;&#34;</span><span class="op" id="7852232">,</span>&nbsp;<span class="string" id="7852234">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="7852257">+</span><span class="ident" id="7852258">src</span><span class="op" id="7852261">+</span><span class="string" id="7852262">&#34;}&#34;</span><span class="op" id="7852265">,</span>&nbsp;<span class="ident" id="7852267">parser</span><span class="op" id="7852273">.</span><span class="ident" id="7852274">ParseComments</span><span class="op" id="7852287">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7852291">if</span>&nbsp;<span class="ident" id="7852294">err</span>&nbsp;<span class="op" id="7852298">!=</span>&nbsp;<span class="ident" id="7852301">nil</span>&nbsp;<span class="op" id="7852305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7852310">panic</span><span class="op" id="7852315">(</span><span class="ident" id="7852316">err</span><span class="op" id="7852319">)</span>&nbsp;<span class="comment" id="7852321">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7852340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7852345">var</span>&nbsp;<span class="ident" id="7852349">buf</span>&nbsp;<span class="ident" id="7852353">bytes</span><span class="op" id="7852358">.</span><span class="ident" id="7852359">Buffer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7852368">err</span>&nbsp;<span class="op" id="7852372">=</span>&nbsp;<span class="ident" id="7852374">Fprint</span><span class="op" id="7852380">(</span><span class="op" id="7852381">&amp;</span><span class="ident" id="7852382">buf</span><span class="op" id="7852385">,</span>&nbsp;<span class="ident" id="7852387">fset</span><span class="op" id="7852391">,</span>&nbsp;<span class="ident" id="7852393">file</span><span class="op" id="7852397">.</span><span class="ident" id="7852398">Decls</span><span class="op" id="7852403">[</span><span class="num" id="7852404">0</span><span class="op" id="7852405">]</span><span class="op" id="7852406">.</span><span class="op" id="7852407">(</span><span class="op" id="7852408">*</span><span class="ident" id="7852409">ast</span><span class="op" id="7852412">.</span><span class="ident" id="7852413">FuncDecl</span><span class="op" id="7852421">)</span><span class="op" id="7852422">.</span><span class="ident" id="7852423">Body</span><span class="op" id="7852427">.</span><span class="ident" id="7852428">List</span><span class="op" id="7852432">)</span>&nbsp;<span class="comment" id="7852434">//&nbsp;only&nbsp;print&nbsp;statements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7852461">if</span>&nbsp;<span class="ident" id="7852464">err</span>&nbsp;<span class="op" id="7852468">!=</span>&nbsp;<span class="ident" id="7852471">nil</span>&nbsp;<span class="op" id="7852475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7852480">panic</span><span class="op" id="7852485">(</span><span class="ident" id="7852486">err</span><span class="op" id="7852489">)</span>&nbsp;<span class="comment" id="7852491">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7852510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7852515">out</span>&nbsp;<span class="op" id="7852519">:=</span>&nbsp;<span class="ident" id="7852522">buf</span><span class="op" id="7852525">.</span><span class="ident" id="7852526">String</span><span class="op" id="7852532">(</span><span class="op" id="7852533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7852537">if</span>&nbsp;<span class="ident" id="7852540">out</span>&nbsp;<span class="op" id="7852544">!=</span>&nbsp;<span class="ident" id="7852547">src</span>&nbsp;<span class="op" id="7852551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7852556">t</span><span class="op" id="7852557">.</span><span class="ident" id="7852558">Errorf</span><span class="op" id="7852564">(</span><span class="string" id="7852565">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="7852589">,</span>&nbsp;<span class="ident" id="7852591">out</span><span class="op" id="7852594">,</span>&nbsp;<span class="ident" id="7852596">src</span><span class="op" id="7852599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7852603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7852606">}</span><br>
<span class="lineno">480</span><span class="op" id="7852608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7852611">func</span>&nbsp;<span class="ident" id="7852616">TestBaseIndent</span><span class="op" id="7852630">(</span><span class="ident" id="7852631">t</span>&nbsp;<span class="op" id="7852633">*</span><span class="ident" id="7852634">testing</span><span class="op" id="7852641">.</span><span class="ident" id="7852642">T</span><span class="op" id="7852643">)</span>&nbsp;<span class="op" id="7852645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7852648">//&nbsp;The&nbsp;testfile&nbsp;must&nbsp;not&nbsp;contain&nbsp;multi-line&nbsp;raw&nbsp;strings&nbsp;since&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7852717">//&nbsp;are&nbsp;not&nbsp;indented&nbsp;(because&nbsp;their&nbsp;values&nbsp;must&nbsp;not&nbsp;change)&nbsp;and&nbsp;make</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7852786">//&nbsp;this&nbsp;test&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7852806">const</span>&nbsp;<span class="ident" id="7852812">filename</span>&nbsp;<span class="op" id="7852821">=</span>&nbsp;<span class="string" id="7852823">&#34;printer.go&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7852837">src</span><span class="op" id="7852840">,</span>&nbsp;<span class="ident" id="7852842">err</span>&nbsp;<span class="op" id="7852846">:=</span>&nbsp;<span class="ident" id="7852849">ioutil</span><span class="op" id="7852855">.</span><span class="ident" id="7852856">ReadFile</span><span class="op" id="7852864">(</span><span class="ident" id="7852865">filename</span><span class="op" id="7852873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7852876">if</span>&nbsp;<span class="ident" id="7852879">err</span>&nbsp;<span class="op" id="7852883">!=</span>&nbsp;<span class="ident" id="7852886">nil</span>&nbsp;<span class="op" id="7852890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7852894">panic</span><span class="op" id="7852899">(</span><span class="ident" id="7852900">err</span><span class="op" id="7852903">)</span>&nbsp;<span class="comment" id="7852905">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7852923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7852927">file</span><span class="op" id="7852931">,</span>&nbsp;<span class="ident" id="7852933">err</span>&nbsp;<span class="op" id="7852937">:=</span>&nbsp;<span class="ident" id="7852940">parser</span><span class="op" id="7852946">.</span><span class="ident" id="7852947">ParseFile</span><span class="op" id="7852956">(</span><span class="ident" id="7852957">fset</span><span class="op" id="7852961">,</span>&nbsp;<span class="ident" id="7852963">filename</span><span class="op" id="7852971">,</span>&nbsp;<span class="ident" id="7852973">src</span><span class="op" id="7852976">,</span>&nbsp;<span class="num" id="7852978">0</span><span class="op" id="7852979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7852982">if</span>&nbsp;<span class="ident" id="7852985">err</span>&nbsp;<span class="op" id="7852989">!=</span>&nbsp;<span class="ident" id="7852992">nil</span>&nbsp;<span class="op" id="7852996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7853000">panic</span><span class="op" id="7853005">(</span><span class="ident" id="7853006">err</span><span class="op" id="7853009">)</span>&nbsp;<span class="comment" id="7853011">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7853029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7853033">var</span>&nbsp;<span class="ident" id="7853037">buf</span>&nbsp;<span class="ident" id="7853041">bytes</span><span class="op" id="7853046">.</span><span class="ident" id="7853047">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7853055">for</span>&nbsp;<span class="ident" id="7853059">indent</span>&nbsp;<span class="op" id="7853066">:=</span>&nbsp;<span class="num" id="7853069">0</span><span class="op" id="7853070">;</span>&nbsp;<span class="ident" id="7853072">indent</span>&nbsp;<span class="op" id="7853079">&lt;</span>&nbsp;<span class="num" id="7853081">4</span><span class="op" id="7853082">;</span>&nbsp;<span class="ident" id="7853084">indent</span><span class="op" id="7853090">++</span>&nbsp;<span class="op" id="7853093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7853097">buf</span><span class="op" id="7853100">.</span><span class="ident" id="7853101">Reset</span><span class="op" id="7853106">(</span><span class="op" id="7853107">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7853111">(</span><span class="op" id="7853112">&amp;</span><span class="ident" id="7853113">Config</span><span class="op" id="7853119">{</span><span class="ident" id="7853120">Tabwidth</span><span class="op" id="7853128">:</span>&nbsp;<span class="ident" id="7853130">tabwidth</span><span class="op" id="7853138">,</span>&nbsp;<span class="ident" id="7853140">Indent</span><span class="op" id="7853146">:</span>&nbsp;<span class="ident" id="7853148">indent</span><span class="op" id="7853154">}</span><span class="op" id="7853155">)</span><span class="op" id="7853156">.</span><span class="ident" id="7853157">Fprint</span><span class="op" id="7853163">(</span><span class="op" id="7853164">&amp;</span><span class="ident" id="7853165">buf</span><span class="op" id="7853168">,</span>&nbsp;<span class="ident" id="7853170">fset</span><span class="op" id="7853174">,</span>&nbsp;<span class="ident" id="7853176">file</span><span class="op" id="7853180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7853184">//&nbsp;all&nbsp;code&nbsp;must&nbsp;be&nbsp;indented&nbsp;by&nbsp;at&nbsp;least&nbsp;&#39;indent&#39;&nbsp;tabs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7853241">lines</span>&nbsp;<span class="op" id="7853247">:=</span>&nbsp;<span class="ident" id="7853250">bytes</span><span class="op" id="7853255">.</span><span class="ident" id="7853256">Split</span><span class="op" id="7853261">(</span><span class="ident" id="7853262">buf</span><span class="op" id="7853265">.</span><span class="ident" id="7853266">Bytes</span><span class="op" id="7853271">(</span><span class="op" id="7853272">)</span><span class="op" id="7853273">,</span>&nbsp;<span class="op" id="7853275">[</span><span class="op" id="7853276">]</span><span class="builtintype" id="7853277">byte</span><span class="op" id="7853281">{</span><span class="string" id="7853282">&#39;\n&#39;</span><span class="op" id="7853286">}</span><span class="op" id="7853287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7853291">for</span>&nbsp;<span class="ident" id="7853295">i</span><span class="op" id="7853296">,</span>&nbsp;<span class="ident" id="7853298">line</span>&nbsp;<span class="op" id="7853303">:=</span>&nbsp;<span class="keyword" id="7853306">range</span>&nbsp;<span class="ident" id="7853312">lines</span>&nbsp;<span class="op" id="7853318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7853323">if</span>&nbsp;<span class="builtinfunc" id="7853326">len</span><span class="op" id="7853329">(</span><span class="ident" id="7853330">line</span><span class="op" id="7853334">)</span>&nbsp;<span class="op" id="7853336">==</span>&nbsp;<span class="num" id="7853339">0</span>&nbsp;<span class="op" id="7853341">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7853347">continue</span>&nbsp;<span class="comment" id="7853356">//&nbsp;empty&nbsp;lines&nbsp;don&#39;t&nbsp;have&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7853397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7853402">n</span>&nbsp;<span class="op" id="7853404">:=</span>&nbsp;<span class="num" id="7853407">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7853412">for</span>&nbsp;<span class="ident" id="7853416">j</span><span class="op" id="7853417">,</span>&nbsp;<span class="ident" id="7853419">b</span>&nbsp;<span class="op" id="7853421">:=</span>&nbsp;<span class="keyword" id="7853424">range</span>&nbsp;<span class="ident" id="7853430">line</span>&nbsp;<span class="op" id="7853435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7853441">if</span>&nbsp;<span class="ident" id="7853444">b</span>&nbsp;<span class="op" id="7853446">!=</span>&nbsp;<span class="string" id="7853449">&#39;\t&#39;</span>&nbsp;<span class="op" id="7853454">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7853461">//&nbsp;end&nbsp;of&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7853488">n</span>&nbsp;<span class="op" id="7853490">=</span>&nbsp;<span class="ident" id="7853492">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7853499">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7853509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7853514">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7853519">if</span>&nbsp;<span class="ident" id="7853522">n</span>&nbsp;<span class="op" id="7853524">&lt;</span>&nbsp;<span class="ident" id="7853526">indent</span>&nbsp;<span class="op" id="7853533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7853539">t</span><span class="op" id="7853540">.</span><span class="ident" id="7853541">Errorf</span><span class="op" id="7853547">(</span><span class="string" id="7853548">&#34;line&nbsp;%d:&nbsp;got&nbsp;only&nbsp;%d&nbsp;tabs;&nbsp;want&nbsp;at&nbsp;least&nbsp;%d:&nbsp;%q&#34;</span><span class="op" id="7853597">,</span>&nbsp;<span class="ident" id="7853599">i</span><span class="op" id="7853600">,</span>&nbsp;<span class="ident" id="7853602">n</span><span class="op" id="7853603">,</span>&nbsp;<span class="ident" id="7853605">indent</span><span class="op" id="7853611">,</span>&nbsp;<span class="ident" id="7853613">line</span><span class="op" id="7853617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7853622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7853626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7853629">}</span><br>
<span class="lineno">520</span><span class="op" id="7853631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7853634">//&nbsp;TestFuncType&nbsp;tests&nbsp;that&nbsp;an&nbsp;ast.FuncType&nbsp;with&nbsp;a&nbsp;nil&nbsp;Params&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="7853701">//&nbsp;can&nbsp;be&nbsp;printed&nbsp;(per&nbsp;go/ast&nbsp;specification).&nbsp;Test&nbsp;case&nbsp;for&nbsp;issue&nbsp;3870.</span><br>
<span class="lineno"></span><span class="keyword" id="7853773">func</span>&nbsp;<span class="ident" id="7853778">TestFuncType</span><span class="op" id="7853790">(</span><span class="ident" id="7853791">t</span>&nbsp;<span class="op" id="7853793">*</span><span class="ident" id="7853794">testing</span><span class="op" id="7853801">.</span><span class="ident" id="7853802">T</span><span class="op" id="7853803">)</span>&nbsp;<span class="op" id="7853805">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7853808">src</span>&nbsp;<span class="op" id="7853812">:=</span>&nbsp;<span class="op" id="7853815">&amp;</span><span class="ident" id="7853816">ast</span><span class="op" id="7853819">.</span><span class="ident" id="7853820">File</span><span class="op" id="7853824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7853828">Name</span><span class="op" id="7853832">:</span>&nbsp;<span class="op" id="7853834">&amp;</span><span class="ident" id="7853835">ast</span><span class="op" id="7853838">.</span><span class="ident" id="7853839">Ident</span><span class="op" id="7853844">{</span><span class="ident" id="7853845">Name</span><span class="op" id="7853849">:</span>&nbsp;<span class="string" id="7853851">&#34;p&#34;</span><span class="op" id="7853854">}</span><span class="op" id="7853855">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7853859">Decls</span><span class="op" id="7853864">:</span>&nbsp;<span class="op" id="7853866">[</span><span class="op" id="7853867">]</span><span class="ident" id="7853868">ast</span><span class="op" id="7853871">.</span><span class="ident" id="7853872">Decl</span><span class="op" id="7853876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7853881">&amp;</span><span class="ident" id="7853882">ast</span><span class="op" id="7853885">.</span><span class="ident" id="7853886">FuncDecl</span><span class="op" id="7853894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7853900">Name</span><span class="op" id="7853904">:</span>&nbsp;<span class="op" id="7853906">&amp;</span><span class="ident" id="7853907">ast</span><span class="op" id="7853910">.</span><span class="ident" id="7853911">Ident</span><span class="op" id="7853916">{</span><span class="ident" id="7853917">Name</span><span class="op" id="7853921">:</span>&nbsp;<span class="string" id="7853923">&#34;f&#34;</span><span class="op" id="7853926">}</span><span class="op" id="7853927">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7853933">Type</span><span class="op" id="7853937">:</span>&nbsp;<span class="op" id="7853939">&amp;</span><span class="ident" id="7853940">ast</span><span class="op" id="7853943">.</span><span class="ident" id="7853944">FuncType</span><span class="op" id="7853952">{</span><span class="op" id="7853953">}</span><span class="op" id="7853954">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7853959">}</span><span class="op" id="7853960">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7853964">}</span><span class="op" id="7853965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7853968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7853972">var</span>&nbsp;<span class="ident" id="7853976">buf</span>&nbsp;<span class="ident" id="7853980">bytes</span><span class="op" id="7853985">.</span><span class="ident" id="7853986">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7853994">if</span>&nbsp;<span class="ident" id="7853997">err</span>&nbsp;<span class="op" id="7854001">:=</span>&nbsp;<span class="ident" id="7854004">Fprint</span><span class="op" id="7854010">(</span><span class="op" id="7854011">&amp;</span><span class="ident" id="7854012">buf</span><span class="op" id="7854015">,</span>&nbsp;<span class="ident" id="7854017">fset</span><span class="op" id="7854021">,</span>&nbsp;<span class="ident" id="7854023">src</span><span class="op" id="7854026">)</span><span class="op" id="7854027">;</span>&nbsp;<span class="ident" id="7854029">err</span>&nbsp;<span class="op" id="7854033">!=</span>&nbsp;<span class="ident" id="7854036">nil</span>&nbsp;<span class="op" id="7854040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7854044">t</span><span class="op" id="7854045">.</span><span class="ident" id="7854046">Fatal</span><span class="op" id="7854051">(</span><span class="ident" id="7854052">err</span><span class="op" id="7854055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7854058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7854061">got</span>&nbsp;<span class="op" id="7854065">:=</span>&nbsp;<span class="ident" id="7854068">buf</span><span class="op" id="7854071">.</span><span class="ident" id="7854072">String</span><span class="op" id="7854078">(</span><span class="op" id="7854079">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7854083">const</span>&nbsp;<span class="ident" id="7854089">want</span>&nbsp;<span class="op" id="7854094">=</span>&nbsp;<span class="string" id="7854096">`package&nbsp;p<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;f()<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7854121">if</span>&nbsp;<span class="ident" id="7854124">got</span>&nbsp;<span class="op" id="7854128">!=</span>&nbsp;<span class="ident" id="7854131">want</span>&nbsp;<span class="op" id="7854136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7854140">t</span><span class="op" id="7854141">.</span><span class="ident" id="7854142">Fatalf</span><span class="op" id="7854148">(</span><span class="string" id="7854149">&#34;got:\n%s\nwant:\n%s\n&#34;</span><span class="op" id="7854172">,</span>&nbsp;<span class="ident" id="7854174">got</span><span class="op" id="7854177">,</span>&nbsp;<span class="ident" id="7854179">want</span><span class="op" id="7854183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7854186">}</span><br>
<span class="lineno"></span><span class="op" id="7854188">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="7854191">//&nbsp;TextX&nbsp;is&nbsp;a&nbsp;skeleton&nbsp;test&nbsp;that&nbsp;can&nbsp;be&nbsp;filled&nbsp;in&nbsp;for&nbsp;debugging&nbsp;one-off&nbsp;cases.</span><br>
<span class="lineno"></span><span class="comment" id="7854270">//&nbsp;Do&nbsp;not&nbsp;remove.</span><br>
<span class="lineno"></span><span class="keyword" id="7854288">func</span>&nbsp;<span class="ident" id="7854293">TestX</span><span class="op" id="7854298">(</span><span class="ident" id="7854299">t</span>&nbsp;<span class="op" id="7854301">*</span><span class="ident" id="7854302">testing</span><span class="op" id="7854309">.</span><span class="ident" id="7854310">T</span><span class="op" id="7854311">)</span>&nbsp;<span class="op" id="7854313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7854316">const</span>&nbsp;<span class="ident" id="7854322">src</span>&nbsp;<span class="op" id="7854326">=</span>&nbsp;<span class="string" id="7854328">`<br>
<span class="lineno">555</span>package&nbsp;p<br>
<span class="lineno"></span>func&nbsp;_()&nbsp;{}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7854355">_</span><span class="op" id="7854356">,</span>&nbsp;<span class="ident" id="7854358">err</span>&nbsp;<span class="op" id="7854362">:=</span>&nbsp;<span class="ident" id="7854365">format</span><span class="op" id="7854371">(</span><span class="op" id="7854372">[</span><span class="op" id="7854373">]</span><span class="builtintype" id="7854374">byte</span><span class="op" id="7854378">(</span><span class="ident" id="7854379">src</span><span class="op" id="7854382">)</span><span class="op" id="7854383">,</span>&nbsp;<span class="num" id="7854385">0</span><span class="op" id="7854386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7854389">if</span>&nbsp;<span class="ident" id="7854392">err</span>&nbsp;<span class="op" id="7854396">!=</span>&nbsp;<span class="ident" id="7854399">nil</span>&nbsp;<span class="op" id="7854403">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7854407">t</span><span class="op" id="7854408">.</span><span class="ident" id="7854409">Error</span><span class="op" id="7854414">(</span><span class="ident" id="7854415">err</span><span class="op" id="7854418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7854421">}</span><br>
<span class="lineno"></span><span class="op" id="7854423">}</span>
</div>
</body>
</html>
