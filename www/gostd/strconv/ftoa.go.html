<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strconv</h2>
<ul>
<li><a href="/gostd/strconv/atob.go.html">atob.go</a></li>
<li><a href="/gostd/strconv/atob_test.go.html">atob_test.go</a></li>
<li><a href="/gostd/strconv/atof.go.html">atof.go</a></li>
<li><a href="/gostd/strconv/atof_test.go.html">atof_test.go</a></li>
<li><a href="/gostd/strconv/atoi.go.html">atoi.go</a></li>
<li><a href="/gostd/strconv/atoi_test.go.html">atoi_test.go</a></li>
<li><a href="/gostd/strconv/decimal.go.html">decimal.go</a></li>
<li><a href="/gostd/strconv/decimal_test.go.html">decimal_test.go</a></li>
<li><a href="/gostd/strconv/extfloat.go.html">extfloat.go</a></li>
<li><a href="/gostd/strconv/fp_test.go.html">fp_test.go</a></li>
<li><a href="/gostd/strconv/ftoa.go.html" class="current">ftoa.go</a></li>
<li><a href="/gostd/strconv/ftoa_test.go.html">ftoa_test.go</a></li>
<li><a href="/gostd/strconv/internal_test.go.html">internal_test.go</a></li>
<li><a href="/gostd/strconv/isprint.go.html">isprint.go</a></li>
<li><a href="/gostd/strconv/itoa.go.html">itoa.go</a></li>
<li><a href="/gostd/strconv/itoa_test.go.html">itoa_test.go</a></li>
<li><a href="/gostd/strconv/quote.go.html">quote.go</a></li>
<li><a href="/gostd/strconv/quote_example_test.go.html">quote_example_test.go</a></li>
<li><a href="/gostd/strconv/quote_test.go.html">quote_test.go</a></li>
<li><a href="/gostd/strconv/strconv_test.go.html">strconv_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2130728">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2130783">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2130837">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2130888">//&nbsp;Binary&nbsp;to&nbsp;decimal&nbsp;floating&nbsp;point&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="comment" id="2130936">//&nbsp;Algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2130950">//&nbsp;&nbsp;&nbsp;1)&nbsp;store&nbsp;mantissa&nbsp;in&nbsp;multiprecision&nbsp;decimal</span><br>
<span class="lineno"></span><span class="comment" id="2130999">//&nbsp;&nbsp;&nbsp;2)&nbsp;shift&nbsp;decimal&nbsp;by&nbsp;exponent</span><br>
<span class="lineno"></span><span class="comment" id="2131033">//&nbsp;&nbsp;&nbsp;3)&nbsp;read&nbsp;digits&nbsp;out&nbsp;&amp;&nbsp;format</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2131067">package</span>&nbsp;<span class="ident" id="2131075">strconv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2131084">import</span>&nbsp;<span class="string" id="2131091">&#34;math&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2131099">//&nbsp;TODO:&nbsp;move&nbsp;elsewhere?</span><br>
<span class="lineno"></span><span class="keyword" id="2131124">type</span>&nbsp;<span class="ident" id="2131129">floatInfo</span>&nbsp;<span class="keyword" id="2131139">struct</span>&nbsp;<span class="op" id="2131146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2131149">mantbits</span>&nbsp;<span class="builtintype" id="2131158">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2131164">expbits</span>&nbsp;&nbsp;<span class="builtintype" id="2131173">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2131179">bias</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2131188">int</span><br>
<span class="lineno">20</span><span class="op" id="2131192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2131195">var</span>&nbsp;<span class="ident" id="2131199">float32info</span>&nbsp;<span class="op" id="2131211">=</span>&nbsp;<span class="ident" id="2131213">floatInfo</span><span class="op" id="2131222">{</span><span class="num" id="2131223">23</span><span class="op" id="2131225">,</span>&nbsp;<span class="num" id="2131227">8</span><span class="op" id="2131228">,</span>&nbsp;<span class="op" id="2131230">-</span><span class="num" id="2131231">127</span><span class="op" id="2131234">}</span><br>
<span class="lineno"></span><span class="keyword" id="2131236">var</span>&nbsp;<span class="ident" id="2131240">float64info</span>&nbsp;<span class="op" id="2131252">=</span>&nbsp;<span class="ident" id="2131254">floatInfo</span><span class="op" id="2131263">{</span><span class="num" id="2131264">52</span><span class="op" id="2131266">,</span>&nbsp;<span class="num" id="2131268">11</span><span class="op" id="2131270">,</span>&nbsp;<span class="op" id="2131272">-</span><span class="num" id="2131273">1023</span><span class="op" id="2131277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2131280">//&nbsp;FormatFloat&nbsp;converts&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f&nbsp;to&nbsp;a&nbsp;string,</span><br>
<span class="lineno"></span><span class="comment" id="2131345">//&nbsp;according&nbsp;to&nbsp;the&nbsp;format&nbsp;fmt&nbsp;and&nbsp;precision&nbsp;prec.&nbsp;&nbsp;It&nbsp;rounds&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2131411">//&nbsp;result&nbsp;assuming&nbsp;that&nbsp;the&nbsp;original&nbsp;was&nbsp;obtained&nbsp;from&nbsp;a&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="2131483">//&nbsp;value&nbsp;of&nbsp;bitSize&nbsp;bits&nbsp;(32&nbsp;for&nbsp;float32,&nbsp;64&nbsp;for&nbsp;float64).</span><br>
<span class="lineno"></span><span class="comment" id="2131542">//</span><br>
<span class="lineno">30</span><span class="comment" id="2131545">//&nbsp;The&nbsp;format&nbsp;fmt&nbsp;is&nbsp;one&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2131573">//&nbsp;&#39;b&#39;&nbsp;(-ddddp±ddd,&nbsp;a&nbsp;binary&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2131614">//&nbsp;&#39;e&#39;&nbsp;(-d.dddde±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2131657">//&nbsp;&#39;E&#39;&nbsp;(-d.ddddE±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2131700">//&nbsp;&#39;f&#39;&nbsp;(-ddd.dddd,&nbsp;no&nbsp;exponent),</span><br>
<span class="lineno">35</span><span class="comment" id="2131733">//&nbsp;&#39;g&#39;&nbsp;(&#39;e&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise),&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2131785">//&nbsp;&#39;G&#39;&nbsp;(&#39;E&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise).</span><br>
<span class="lineno"></span><span class="comment" id="2131834">//</span><br>
<span class="lineno"></span><span class="comment" id="2131837">//&nbsp;The&nbsp;precision&nbsp;prec&nbsp;controls&nbsp;the&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2131889">//&nbsp;(excluding&nbsp;the&nbsp;exponent)&nbsp;printed&nbsp;by&nbsp;the&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;g&#39;,&nbsp;and&nbsp;&#39;G&#39;&nbsp;formats.</span><br>
<span class="lineno">40</span><span class="comment" id="2131969">//&nbsp;For&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;and&nbsp;&#39;f&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span><span class="comment" id="2132046">//&nbsp;For&nbsp;&#39;g&#39;&nbsp;and&nbsp;&#39;G&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="2132099">//&nbsp;The&nbsp;special&nbsp;precision&nbsp;-1&nbsp;uses&nbsp;the&nbsp;smallest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2132162">//&nbsp;necessary&nbsp;such&nbsp;that&nbsp;ParseFloat&nbsp;will&nbsp;return&nbsp;f&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="keyword" id="2132219">func</span>&nbsp;<span class="ident" id="2132224">FormatFloat</span><span class="op" id="2132235">(</span><span class="ident" id="2132236">f</span>&nbsp;<span class="builtintype" id="2132238">float64</span><span class="op" id="2132245">,</span>&nbsp;<span class="ident" id="2132247">fmt</span>&nbsp;<span class="builtintype" id="2132251">byte</span><span class="op" id="2132255">,</span>&nbsp;<span class="ident" id="2132257">prec</span><span class="op" id="2132261">,</span>&nbsp;<span class="ident" id="2132263">bitSize</span>&nbsp;<span class="builtintype" id="2132271">int</span><span class="op" id="2132274">)</span>&nbsp;<span class="builtintype" id="2132276">string</span>&nbsp;<span class="op" id="2132283">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2132286">return</span>&nbsp;<span class="builtintype" id="2132293">string</span><span class="op" id="2132299">(</span><span class="ident" id="2132300">genericFtoa</span><span class="op" id="2132311">(</span><span class="builtinfunc" id="2132312">make</span><span class="op" id="2132316">(</span><span class="op" id="2132317">[</span><span class="op" id="2132318">]</span><span class="builtintype" id="2132319">byte</span><span class="op" id="2132323">,</span>&nbsp;<span class="num" id="2132325">0</span><span class="op" id="2132326">,</span>&nbsp;<span class="ident" id="2132328">max</span><span class="op" id="2132331">(</span><span class="ident" id="2132332">prec</span><span class="op" id="2132336">+</span><span class="num" id="2132337">4</span><span class="op" id="2132338">,</span>&nbsp;<span class="num" id="2132340">24</span><span class="op" id="2132342">)</span><span class="op" id="2132343">)</span><span class="op" id="2132344">,</span>&nbsp;<span class="ident" id="2132346">f</span><span class="op" id="2132347">,</span>&nbsp;<span class="ident" id="2132349">fmt</span><span class="op" id="2132352">,</span>&nbsp;<span class="ident" id="2132354">prec</span><span class="op" id="2132358">,</span>&nbsp;<span class="ident" id="2132360">bitSize</span><span class="op" id="2132367">)</span><span class="op" id="2132368">)</span><br>
<span class="lineno"></span><span class="op" id="2132370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2132373">//&nbsp;AppendFloat&nbsp;appends&nbsp;the&nbsp;string&nbsp;form&nbsp;of&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f,</span><br>
<span class="lineno"></span><span class="comment" id="2132444">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;FormatFloat,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno">50</span><span class="keyword" id="2132516">func</span>&nbsp;<span class="ident" id="2132521">AppendFloat</span><span class="op" id="2132532">(</span><span class="ident" id="2132533">dst</span>&nbsp;<span class="op" id="2132537">[</span><span class="op" id="2132538">]</span><span class="builtintype" id="2132539">byte</span><span class="op" id="2132543">,</span>&nbsp;<span class="ident" id="2132545">f</span>&nbsp;<span class="builtintype" id="2132547">float64</span><span class="op" id="2132554">,</span>&nbsp;<span class="ident" id="2132556">fmt</span>&nbsp;<span class="builtintype" id="2132560">byte</span><span class="op" id="2132564">,</span>&nbsp;<span class="ident" id="2132566">prec</span>&nbsp;<span class="builtintype" id="2132571">int</span><span class="op" id="2132574">,</span>&nbsp;<span class="ident" id="2132576">bitSize</span>&nbsp;<span class="builtintype" id="2132584">int</span><span class="op" id="2132587">)</span>&nbsp;<span class="op" id="2132589">[</span><span class="op" id="2132590">]</span><span class="builtintype" id="2132591">byte</span>&nbsp;<span class="op" id="2132596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2132599">return</span>&nbsp;<span class="ident" id="2132606">genericFtoa</span><span class="op" id="2132617">(</span><span class="ident" id="2132618">dst</span><span class="op" id="2132621">,</span>&nbsp;<span class="ident" id="2132623">f</span><span class="op" id="2132624">,</span>&nbsp;<span class="ident" id="2132626">fmt</span><span class="op" id="2132629">,</span>&nbsp;<span class="ident" id="2132631">prec</span><span class="op" id="2132635">,</span>&nbsp;<span class="ident" id="2132637">bitSize</span><span class="op" id="2132644">)</span><br>
<span class="lineno"></span><span class="op" id="2132646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2132649">func</span>&nbsp;<span class="ident" id="2132654">genericFtoa</span><span class="op" id="2132665">(</span><span class="ident" id="2132666">dst</span>&nbsp;<span class="op" id="2132670">[</span><span class="op" id="2132671">]</span><span class="builtintype" id="2132672">byte</span><span class="op" id="2132676">,</span>&nbsp;<span class="ident" id="2132678">val</span>&nbsp;<span class="builtintype" id="2132682">float64</span><span class="op" id="2132689">,</span>&nbsp;<span class="ident" id="2132691">fmt</span>&nbsp;<span class="builtintype" id="2132695">byte</span><span class="op" id="2132699">,</span>&nbsp;<span class="ident" id="2132701">prec</span><span class="op" id="2132705">,</span>&nbsp;<span class="ident" id="2132707">bitSize</span>&nbsp;<span class="builtintype" id="2132715">int</span><span class="op" id="2132718">)</span>&nbsp;<span class="op" id="2132720">[</span><span class="op" id="2132721">]</span><span class="builtintype" id="2132722">byte</span>&nbsp;<span class="op" id="2132727">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2132730">var</span>&nbsp;<span class="ident" id="2132734">bits</span>&nbsp;<span class="builtintype" id="2132739">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2132747">var</span>&nbsp;<span class="ident" id="2132751">flt</span>&nbsp;<span class="op" id="2132755">*</span><span class="ident" id="2132756">floatInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2132767">switch</span>&nbsp;<span class="ident" id="2132774">bitSize</span>&nbsp;<span class="op" id="2132782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2132785">case</span>&nbsp;<span class="num" id="2132790">32</span><span class="op" id="2132792">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2132796">bits</span>&nbsp;<span class="op" id="2132801">=</span>&nbsp;<span class="builtintype" id="2132803">uint64</span><span class="op" id="2132809">(</span><span class="ident" id="2132810">math</span><span class="op" id="2132814">.</span><span class="ident" id="2132815">Float32bits</span><span class="op" id="2132826">(</span><span class="builtintype" id="2132827">float32</span><span class="op" id="2132834">(</span><span class="ident" id="2132835">val</span><span class="op" id="2132838">)</span><span class="op" id="2132839">)</span><span class="op" id="2132840">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2132844">flt</span>&nbsp;<span class="op" id="2132848">=</span>&nbsp;<span class="op" id="2132850">&amp;</span><span class="ident" id="2132851">float32info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2132864">case</span>&nbsp;<span class="num" id="2132869">64</span><span class="op" id="2132871">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2132875">bits</span>&nbsp;<span class="op" id="2132880">=</span>&nbsp;<span class="ident" id="2132882">math</span><span class="op" id="2132886">.</span><span class="ident" id="2132887">Float64bits</span><span class="op" id="2132898">(</span><span class="ident" id="2132899">val</span><span class="op" id="2132902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2132906">flt</span>&nbsp;<span class="op" id="2132910">=</span>&nbsp;<span class="op" id="2132912">&amp;</span><span class="ident" id="2132913">float64info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2132926">default</span><span class="op" id="2132933">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2132937">panic</span><span class="op" id="2132942">(</span><span class="string" id="2132943">&#34;strconv:&nbsp;illegal&nbsp;AppendFloat/FormatFloat&nbsp;bitSize&#34;</span><span class="op" id="2132993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2132996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2133000">neg</span>&nbsp;<span class="op" id="2133004">:=</span>&nbsp;<span class="ident" id="2133007">bits</span><span class="op" id="2133011">&gt;&gt;</span><span class="op" id="2133013">(</span><span class="ident" id="2133014">flt</span><span class="op" id="2133017">.</span><span class="ident" id="2133018">expbits</span><span class="op" id="2133025">+</span><span class="ident" id="2133026">flt</span><span class="op" id="2133029">.</span><span class="ident" id="2133030">mantbits</span><span class="op" id="2133038">)</span>&nbsp;<span class="op" id="2133040">!=</span>&nbsp;<span class="num" id="2133043">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2133046">exp</span>&nbsp;<span class="op" id="2133050">:=</span>&nbsp;<span class="builtintype" id="2133053">int</span><span class="op" id="2133056">(</span><span class="ident" id="2133057">bits</span><span class="op" id="2133061">&gt;&gt;</span><span class="ident" id="2133063">flt</span><span class="op" id="2133066">.</span><span class="ident" id="2133067">mantbits</span><span class="op" id="2133075">)</span>&nbsp;<span class="op" id="2133077">&amp;</span>&nbsp;<span class="op" id="2133079">(</span><span class="num" id="2133080">1</span><span class="op" id="2133081">&lt;&lt;</span><span class="ident" id="2133083">flt</span><span class="op" id="2133086">.</span><span class="ident" id="2133087">expbits</span>&nbsp;<span class="op" id="2133095">-</span>&nbsp;<span class="num" id="2133097">1</span><span class="op" id="2133098">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2133101">mant</span>&nbsp;<span class="op" id="2133106">:=</span>&nbsp;<span class="ident" id="2133109">bits</span>&nbsp;<span class="op" id="2133114">&amp;</span>&nbsp;<span class="op" id="2133116">(</span><span class="builtintype" id="2133117">uint64</span><span class="op" id="2133123">(</span><span class="num" id="2133124">1</span><span class="op" id="2133125">)</span><span class="op" id="2133126">&lt;&lt;</span><span class="ident" id="2133128">flt</span><span class="op" id="2133131">.</span><span class="ident" id="2133132">mantbits</span>&nbsp;<span class="op" id="2133141">-</span>&nbsp;<span class="num" id="2133143">1</span><span class="op" id="2133144">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133148">switch</span>&nbsp;<span class="ident" id="2133155">exp</span>&nbsp;<span class="op" id="2133159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133162">case</span>&nbsp;<span class="num" id="2133167">1</span><span class="op" id="2133168">&lt;&lt;</span><span class="ident" id="2133170">flt</span><span class="op" id="2133173">.</span><span class="ident" id="2133174">expbits</span>&nbsp;<span class="op" id="2133182">-</span>&nbsp;<span class="num" id="2133184">1</span><span class="op" id="2133185">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2133189">//&nbsp;Inf,&nbsp;NaN</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133203">var</span>&nbsp;<span class="ident" id="2133207">s</span>&nbsp;<span class="builtintype" id="2133209">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133218">switch</span>&nbsp;<span class="op" id="2133225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133229">case</span>&nbsp;<span class="ident" id="2133234">mant</span>&nbsp;<span class="op" id="2133239">!=</span>&nbsp;<span class="num" id="2133242">0</span><span class="op" id="2133243">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2133248">s</span>&nbsp;<span class="op" id="2133250">=</span>&nbsp;<span class="string" id="2133252">&#34;NaN&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133260">case</span>&nbsp;<span class="ident" id="2133265">neg</span><span class="op" id="2133268">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2133273">s</span>&nbsp;<span class="op" id="2133275">=</span>&nbsp;<span class="string" id="2133277">&#34;-Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133286">default</span><span class="op" id="2133293">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2133298">s</span>&nbsp;<span class="op" id="2133300">=</span>&nbsp;<span class="string" id="2133302">&#34;+Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2133311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133315">return</span>&nbsp;<span class="builtinfunc" id="2133322">append</span><span class="op" id="2133328">(</span><span class="ident" id="2133329">dst</span><span class="op" id="2133332">,</span>&nbsp;<span class="ident" id="2133334">s</span><span class="op" id="2133335">...</span><span class="op" id="2133338">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133342">case</span>&nbsp;<span class="num" id="2133347">0</span><span class="op" id="2133348">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2133352">//&nbsp;denormalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2133370">exp</span><span class="op" id="2133373">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133378">default</span><span class="op" id="2133385">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2133389">//&nbsp;add&nbsp;implicit&nbsp;top&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2133415">mant</span>&nbsp;<span class="op" id="2133420">|=</span>&nbsp;<span class="builtintype" id="2133423">uint64</span><span class="op" id="2133429">(</span><span class="num" id="2133430">1</span><span class="op" id="2133431">)</span>&nbsp;<span class="op" id="2133433">&lt;&lt;</span>&nbsp;<span class="ident" id="2133436">flt</span><span class="op" id="2133439">.</span><span class="ident" id="2133440">mantbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2133450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2133453">exp</span>&nbsp;<span class="op" id="2133457">+=</span>&nbsp;<span class="ident" id="2133460">flt</span><span class="op" id="2133463">.</span><span class="ident" id="2133464">bias</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2133471">//&nbsp;Pick&nbsp;off&nbsp;easy&nbsp;binary&nbsp;format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133504">if</span>&nbsp;<span class="ident" id="2133507">fmt</span>&nbsp;<span class="op" id="2133511">==</span>&nbsp;<span class="string" id="2133514">&#39;b&#39;</span>&nbsp;<span class="op" id="2133518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133522">return</span>&nbsp;<span class="ident" id="2133529">fmtB</span><span class="op" id="2133533">(</span><span class="ident" id="2133534">dst</span><span class="op" id="2133537">,</span>&nbsp;<span class="ident" id="2133539">neg</span><span class="op" id="2133542">,</span>&nbsp;<span class="ident" id="2133544">mant</span><span class="op" id="2133548">,</span>&nbsp;<span class="ident" id="2133550">exp</span><span class="op" id="2133553">,</span>&nbsp;<span class="ident" id="2133555">flt</span><span class="op" id="2133558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2133561">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133565">if</span>&nbsp;<span class="op" id="2133568">!</span><span class="ident" id="2133569">optimize</span>&nbsp;<span class="op" id="2133578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133582">return</span>&nbsp;<span class="ident" id="2133589">bigFtoa</span><span class="op" id="2133596">(</span><span class="ident" id="2133597">dst</span><span class="op" id="2133600">,</span>&nbsp;<span class="ident" id="2133602">prec</span><span class="op" id="2133606">,</span>&nbsp;<span class="ident" id="2133608">fmt</span><span class="op" id="2133611">,</span>&nbsp;<span class="ident" id="2133613">neg</span><span class="op" id="2133616">,</span>&nbsp;<span class="ident" id="2133618">mant</span><span class="op" id="2133622">,</span>&nbsp;<span class="ident" id="2133624">exp</span><span class="op" id="2133627">,</span>&nbsp;<span class="ident" id="2133629">flt</span><span class="op" id="2133632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2133635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133639">var</span>&nbsp;<span class="ident" id="2133643">digs</span>&nbsp;<span class="ident" id="2133648">decimalSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2133662">ok</span>&nbsp;<span class="op" id="2133665">:=</span>&nbsp;<span class="builtintype" id="2133668">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2133675">//&nbsp;Negative&nbsp;precision&nbsp;means&nbsp;&#34;only&nbsp;as&nbsp;much&nbsp;as&nbsp;needed&nbsp;to&nbsp;be&nbsp;exact.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2133742">shortest</span>&nbsp;<span class="op" id="2133751">:=</span>&nbsp;<span class="ident" id="2133754">prec</span>&nbsp;<span class="op" id="2133759">&lt;</span>&nbsp;<span class="num" id="2133761">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133764">if</span>&nbsp;<span class="ident" id="2133767">shortest</span>&nbsp;<span class="op" id="2133776">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2133780">//&nbsp;Try&nbsp;Grisu3&nbsp;algorithm.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2133807">f</span>&nbsp;<span class="op" id="2133809">:=</span>&nbsp;<span class="builtinfunc" id="2133812">new</span><span class="op" id="2133815">(</span><span class="ident" id="2133816">extFloat</span><span class="op" id="2133824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2133828">lower</span><span class="op" id="2133833">,</span>&nbsp;<span class="ident" id="2133835">upper</span>&nbsp;<span class="op" id="2133841">:=</span>&nbsp;<span class="ident" id="2133844">f</span><span class="op" id="2133845">.</span><span class="ident" id="2133846">AssignComputeBounds</span><span class="op" id="2133865">(</span><span class="ident" id="2133866">mant</span><span class="op" id="2133870">,</span>&nbsp;<span class="ident" id="2133872">exp</span><span class="op" id="2133875">,</span>&nbsp;<span class="ident" id="2133877">neg</span><span class="op" id="2133880">,</span>&nbsp;<span class="ident" id="2133882">flt</span><span class="op" id="2133885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133889">var</span>&nbsp;<span class="ident" id="2133893">buf</span>&nbsp;<span class="op" id="2133897">[</span><span class="num" id="2133898">32</span><span class="op" id="2133900">]</span><span class="builtintype" id="2133901">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2133908">digs</span><span class="op" id="2133912">.</span><span class="ident" id="2133913">d</span>&nbsp;<span class="op" id="2133915">=</span>&nbsp;<span class="ident" id="2133917">buf</span><span class="op" id="2133920">[</span><span class="op" id="2133921">:</span><span class="op" id="2133922">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2133926">ok</span>&nbsp;<span class="op" id="2133929">=</span>&nbsp;<span class="ident" id="2133931">f</span><span class="op" id="2133932">.</span><span class="ident" id="2133933">ShortestDecimal</span><span class="op" id="2133948">(</span><span class="op" id="2133949">&amp;</span><span class="ident" id="2133950">digs</span><span class="op" id="2133954">,</span>&nbsp;<span class="op" id="2133956">&amp;</span><span class="ident" id="2133957">lower</span><span class="op" id="2133962">,</span>&nbsp;<span class="op" id="2133964">&amp;</span><span class="ident" id="2133965">upper</span><span class="op" id="2133970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133974">if</span>&nbsp;<span class="op" id="2133977">!</span><span class="ident" id="2133978">ok</span>&nbsp;<span class="op" id="2133981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2133986">return</span>&nbsp;<span class="ident" id="2133993">bigFtoa</span><span class="op" id="2134000">(</span><span class="ident" id="2134001">dst</span><span class="op" id="2134004">,</span>&nbsp;<span class="ident" id="2134006">prec</span><span class="op" id="2134010">,</span>&nbsp;<span class="ident" id="2134012">fmt</span><span class="op" id="2134015">,</span>&nbsp;<span class="ident" id="2134017">neg</span><span class="op" id="2134020">,</span>&nbsp;<span class="ident" id="2134022">mant</span><span class="op" id="2134026">,</span>&nbsp;<span class="ident" id="2134028">exp</span><span class="op" id="2134031">,</span>&nbsp;<span class="ident" id="2134033">flt</span><span class="op" id="2134036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2134040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2134044">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134093">switch</span>&nbsp;<span class="ident" id="2134100">fmt</span>&nbsp;<span class="op" id="2134104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134108">case</span>&nbsp;<span class="string" id="2134113">&#39;e&#39;</span><span class="op" id="2134116">,</span>&nbsp;<span class="string" id="2134118">&#39;E&#39;</span><span class="op" id="2134121">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134126">prec</span>&nbsp;<span class="op" id="2134131">=</span>&nbsp;<span class="ident" id="2134133">digs</span><span class="op" id="2134137">.</span><span class="ident" id="2134138">nd</span>&nbsp;<span class="op" id="2134141">-</span>&nbsp;<span class="num" id="2134143">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134147">case</span>&nbsp;<span class="string" id="2134152">&#39;f&#39;</span><span class="op" id="2134155">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134160">prec</span>&nbsp;<span class="op" id="2134165">=</span>&nbsp;<span class="ident" id="2134167">max</span><span class="op" id="2134170">(</span><span class="ident" id="2134171">digs</span><span class="op" id="2134175">.</span><span class="ident" id="2134176">nd</span><span class="op" id="2134178">-</span><span class="ident" id="2134179">digs</span><span class="op" id="2134183">.</span><span class="ident" id="2134184">dp</span><span class="op" id="2134186">,</span>&nbsp;<span class="num" id="2134188">0</span><span class="op" id="2134189">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134193">case</span>&nbsp;<span class="string" id="2134198">&#39;g&#39;</span><span class="op" id="2134201">,</span>&nbsp;<span class="string" id="2134203">&#39;G&#39;</span><span class="op" id="2134206">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134211">prec</span>&nbsp;<span class="op" id="2134216">=</span>&nbsp;<span class="ident" id="2134218">digs</span><span class="op" id="2134222">.</span><span class="ident" id="2134223">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2134228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2134231">}</span>&nbsp;<span class="keyword" id="2134233">else</span>&nbsp;<span class="keyword" id="2134238">if</span>&nbsp;<span class="ident" id="2134241">fmt</span>&nbsp;<span class="op" id="2134245">!=</span>&nbsp;<span class="string" id="2134248">&#39;f&#39;</span>&nbsp;<span class="op" id="2134252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2134256">//&nbsp;Fixed&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134285">digits</span>&nbsp;<span class="op" id="2134292">:=</span>&nbsp;<span class="ident" id="2134295">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134302">switch</span>&nbsp;<span class="ident" id="2134309">fmt</span>&nbsp;<span class="op" id="2134313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134317">case</span>&nbsp;<span class="string" id="2134322">&#39;e&#39;</span><span class="op" id="2134325">,</span>&nbsp;<span class="string" id="2134327">&#39;E&#39;</span><span class="op" id="2134330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134335">digits</span><span class="op" id="2134341">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134346">case</span>&nbsp;<span class="string" id="2134351">&#39;g&#39;</span><span class="op" id="2134354">,</span>&nbsp;<span class="string" id="2134356">&#39;G&#39;</span><span class="op" id="2134359">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134364">if</span>&nbsp;<span class="ident" id="2134367">prec</span>&nbsp;<span class="op" id="2134372">==</span>&nbsp;<span class="num" id="2134375">0</span>&nbsp;<span class="op" id="2134377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134383">prec</span>&nbsp;<span class="op" id="2134388">=</span>&nbsp;<span class="num" id="2134390">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2134395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134400">digits</span>&nbsp;<span class="op" id="2134407">=</span>&nbsp;<span class="ident" id="2134409">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2134416">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134420">if</span>&nbsp;<span class="ident" id="2134423">digits</span>&nbsp;<span class="op" id="2134430">&lt;=</span>&nbsp;<span class="num" id="2134433">15</span>&nbsp;<span class="op" id="2134436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2134441">//&nbsp;try&nbsp;fast&nbsp;algorithm&nbsp;when&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;is&nbsp;reasonable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134507">var</span>&nbsp;<span class="ident" id="2134511">buf</span>&nbsp;<span class="op" id="2134515">[</span><span class="num" id="2134516">24</span><span class="op" id="2134518">]</span><span class="builtintype" id="2134519">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134527">digs</span><span class="op" id="2134531">.</span><span class="ident" id="2134532">d</span>&nbsp;<span class="op" id="2134534">=</span>&nbsp;<span class="ident" id="2134536">buf</span><span class="op" id="2134539">[</span><span class="op" id="2134540">:</span><span class="op" id="2134541">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134546">f</span>&nbsp;<span class="op" id="2134548">:=</span>&nbsp;<span class="ident" id="2134551">extFloat</span><span class="op" id="2134559">{</span><span class="ident" id="2134560">mant</span><span class="op" id="2134564">,</span>&nbsp;<span class="ident" id="2134566">exp</span>&nbsp;<span class="op" id="2134570">-</span>&nbsp;<span class="builtintype" id="2134572">int</span><span class="op" id="2134575">(</span><span class="ident" id="2134576">flt</span><span class="op" id="2134579">.</span><span class="ident" id="2134580">mantbits</span><span class="op" id="2134588">)</span><span class="op" id="2134589">,</span>&nbsp;<span class="ident" id="2134591">neg</span><span class="op" id="2134594">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134599">ok</span>&nbsp;<span class="op" id="2134602">=</span>&nbsp;<span class="ident" id="2134604">f</span><span class="op" id="2134605">.</span><span class="ident" id="2134606">FixedDecimal</span><span class="op" id="2134618">(</span><span class="op" id="2134619">&amp;</span><span class="ident" id="2134620">digs</span><span class="op" id="2134624">,</span>&nbsp;<span class="ident" id="2134626">digits</span><span class="op" id="2134632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2134636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2134639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134642">if</span>&nbsp;<span class="op" id="2134645">!</span><span class="ident" id="2134646">ok</span>&nbsp;<span class="op" id="2134649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134653">return</span>&nbsp;<span class="ident" id="2134660">bigFtoa</span><span class="op" id="2134667">(</span><span class="ident" id="2134668">dst</span><span class="op" id="2134671">,</span>&nbsp;<span class="ident" id="2134673">prec</span><span class="op" id="2134677">,</span>&nbsp;<span class="ident" id="2134679">fmt</span><span class="op" id="2134682">,</span>&nbsp;<span class="ident" id="2134684">neg</span><span class="op" id="2134687">,</span>&nbsp;<span class="ident" id="2134689">mant</span><span class="op" id="2134693">,</span>&nbsp;<span class="ident" id="2134695">exp</span><span class="op" id="2134698">,</span>&nbsp;<span class="ident" id="2134700">flt</span><span class="op" id="2134703">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2134706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2134709">return</span>&nbsp;<span class="ident" id="2134716">formatDigits</span><span class="op" id="2134728">(</span><span class="ident" id="2134729">dst</span><span class="op" id="2134732">,</span>&nbsp;<span class="ident" id="2134734">shortest</span><span class="op" id="2134742">,</span>&nbsp;<span class="ident" id="2134744">neg</span><span class="op" id="2134747">,</span>&nbsp;<span class="ident" id="2134749">digs</span><span class="op" id="2134753">,</span>&nbsp;<span class="ident" id="2134755">prec</span><span class="op" id="2134759">,</span>&nbsp;<span class="ident" id="2134761">fmt</span><span class="op" id="2134764">)</span><br>
<span class="lineno"></span><span class="op" id="2134766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2134769">//&nbsp;bigFtoa&nbsp;uses&nbsp;multiprecision&nbsp;computations&nbsp;to&nbsp;format&nbsp;a&nbsp;float.</span><br>
<span class="lineno">155</span><span class="keyword" id="2134832">func</span>&nbsp;<span class="ident" id="2134837">bigFtoa</span><span class="op" id="2134844">(</span><span class="ident" id="2134845">dst</span>&nbsp;<span class="op" id="2134849">[</span><span class="op" id="2134850">]</span><span class="builtintype" id="2134851">byte</span><span class="op" id="2134855">,</span>&nbsp;<span class="ident" id="2134857">prec</span>&nbsp;<span class="builtintype" id="2134862">int</span><span class="op" id="2134865">,</span>&nbsp;<span class="ident" id="2134867">fmt</span>&nbsp;<span class="builtintype" id="2134871">byte</span><span class="op" id="2134875">,</span>&nbsp;<span class="ident" id="2134877">neg</span>&nbsp;<span class="builtintype" id="2134881">bool</span><span class="op" id="2134885">,</span>&nbsp;<span class="ident" id="2134887">mant</span>&nbsp;<span class="builtintype" id="2134892">uint64</span><span class="op" id="2134898">,</span>&nbsp;<span class="ident" id="2134900">exp</span>&nbsp;<span class="builtintype" id="2134904">int</span><span class="op" id="2134907">,</span>&nbsp;<span class="ident" id="2134909">flt</span>&nbsp;<span class="op" id="2134913">*</span><span class="ident" id="2134914">floatInfo</span><span class="op" id="2134923">)</span>&nbsp;<span class="op" id="2134925">[</span><span class="op" id="2134926">]</span><span class="builtintype" id="2134927">byte</span>&nbsp;<span class="op" id="2134932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134935">d</span>&nbsp;<span class="op" id="2134937">:=</span>&nbsp;<span class="builtinfunc" id="2134940">new</span><span class="op" id="2134943">(</span><span class="ident" id="2134944">decimal</span><span class="op" id="2134951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134954">d</span><span class="op" id="2134955">.</span><span class="ident" id="2134956">Assign</span><span class="op" id="2134962">(</span><span class="ident" id="2134963">mant</span><span class="op" id="2134967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2134970">d</span><span class="op" id="2134971">.</span><span class="ident" id="2134972">Shift</span><span class="op" id="2134977">(</span><span class="ident" id="2134978">exp</span>&nbsp;<span class="op" id="2134982">-</span>&nbsp;<span class="builtintype" id="2134984">int</span><span class="op" id="2134987">(</span><span class="ident" id="2134988">flt</span><span class="op" id="2134991">.</span><span class="ident" id="2134992">mantbits</span><span class="op" id="2135000">)</span><span class="op" id="2135001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135004">var</span>&nbsp;<span class="ident" id="2135008">digs</span>&nbsp;<span class="ident" id="2135013">decimalSlice</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135027">shortest</span>&nbsp;<span class="op" id="2135036">:=</span>&nbsp;<span class="ident" id="2135039">prec</span>&nbsp;<span class="op" id="2135044">&lt;</span>&nbsp;<span class="num" id="2135046">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135049">if</span>&nbsp;<span class="ident" id="2135052">shortest</span>&nbsp;<span class="op" id="2135061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135065">roundShortest</span><span class="op" id="2135078">(</span><span class="ident" id="2135079">d</span><span class="op" id="2135080">,</span>&nbsp;<span class="ident" id="2135082">mant</span><span class="op" id="2135086">,</span>&nbsp;<span class="ident" id="2135088">exp</span><span class="op" id="2135091">,</span>&nbsp;<span class="ident" id="2135093">flt</span><span class="op" id="2135096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135100">digs</span>&nbsp;<span class="op" id="2135105">=</span>&nbsp;<span class="ident" id="2135107">decimalSlice</span><span class="op" id="2135119">{</span><span class="ident" id="2135120">d</span><span class="op" id="2135121">:</span>&nbsp;<span class="ident" id="2135123">d</span><span class="op" id="2135124">.</span><span class="ident" id="2135125">d</span><span class="op" id="2135126">[</span><span class="op" id="2135127">:</span><span class="op" id="2135128">]</span><span class="op" id="2135129">,</span>&nbsp;<span class="ident" id="2135131">nd</span><span class="op" id="2135133">:</span>&nbsp;<span class="ident" id="2135135">d</span><span class="op" id="2135136">.</span><span class="ident" id="2135137">nd</span><span class="op" id="2135139">,</span>&nbsp;<span class="ident" id="2135141">dp</span><span class="op" id="2135143">:</span>&nbsp;<span class="ident" id="2135145">d</span><span class="op" id="2135146">.</span><span class="ident" id="2135147">dp</span><span class="op" id="2135149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2135153">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135202">switch</span>&nbsp;<span class="ident" id="2135209">fmt</span>&nbsp;<span class="op" id="2135213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135217">case</span>&nbsp;<span class="string" id="2135222">&#39;e&#39;</span><span class="op" id="2135225">,</span>&nbsp;<span class="string" id="2135227">&#39;E&#39;</span><span class="op" id="2135230">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135235">prec</span>&nbsp;<span class="op" id="2135240">=</span>&nbsp;<span class="ident" id="2135242">digs</span><span class="op" id="2135246">.</span><span class="ident" id="2135247">nd</span>&nbsp;<span class="op" id="2135250">-</span>&nbsp;<span class="num" id="2135252">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135256">case</span>&nbsp;<span class="string" id="2135261">&#39;f&#39;</span><span class="op" id="2135264">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135269">prec</span>&nbsp;<span class="op" id="2135274">=</span>&nbsp;<span class="ident" id="2135276">max</span><span class="op" id="2135279">(</span><span class="ident" id="2135280">digs</span><span class="op" id="2135284">.</span><span class="ident" id="2135285">nd</span><span class="op" id="2135287">-</span><span class="ident" id="2135288">digs</span><span class="op" id="2135292">.</span><span class="ident" id="2135293">dp</span><span class="op" id="2135295">,</span>&nbsp;<span class="num" id="2135297">0</span><span class="op" id="2135298">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135302">case</span>&nbsp;<span class="string" id="2135307">&#39;g&#39;</span><span class="op" id="2135310">,</span>&nbsp;<span class="string" id="2135312">&#39;G&#39;</span><span class="op" id="2135315">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135320">prec</span>&nbsp;<span class="op" id="2135325">=</span>&nbsp;<span class="ident" id="2135327">digs</span><span class="op" id="2135331">.</span><span class="ident" id="2135332">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2135337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2135340">}</span>&nbsp;<span class="keyword" id="2135342">else</span>&nbsp;<span class="op" id="2135347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2135351">//&nbsp;Round&nbsp;appropriately.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135377">switch</span>&nbsp;<span class="ident" id="2135384">fmt</span>&nbsp;<span class="op" id="2135388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135392">case</span>&nbsp;<span class="string" id="2135397">&#39;e&#39;</span><span class="op" id="2135400">,</span>&nbsp;<span class="string" id="2135402">&#39;E&#39;</span><span class="op" id="2135405">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135410">d</span><span class="op" id="2135411">.</span><span class="ident" id="2135412">Round</span><span class="op" id="2135417">(</span><span class="ident" id="2135418">prec</span>&nbsp;<span class="op" id="2135423">+</span>&nbsp;<span class="num" id="2135425">1</span><span class="op" id="2135426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135430">case</span>&nbsp;<span class="string" id="2135435">&#39;f&#39;</span><span class="op" id="2135438">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135443">d</span><span class="op" id="2135444">.</span><span class="ident" id="2135445">Round</span><span class="op" id="2135450">(</span><span class="ident" id="2135451">d</span><span class="op" id="2135452">.</span><span class="ident" id="2135453">dp</span>&nbsp;<span class="op" id="2135456">+</span>&nbsp;<span class="ident" id="2135458">prec</span><span class="op" id="2135462">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135466">case</span>&nbsp;<span class="string" id="2135471">&#39;g&#39;</span><span class="op" id="2135474">,</span>&nbsp;<span class="string" id="2135476">&#39;G&#39;</span><span class="op" id="2135479">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135484">if</span>&nbsp;<span class="ident" id="2135487">prec</span>&nbsp;<span class="op" id="2135492">==</span>&nbsp;<span class="num" id="2135495">0</span>&nbsp;<span class="op" id="2135497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135503">prec</span>&nbsp;<span class="op" id="2135508">=</span>&nbsp;<span class="num" id="2135510">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2135515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135520">d</span><span class="op" id="2135521">.</span><span class="ident" id="2135522">Round</span><span class="op" id="2135527">(</span><span class="ident" id="2135528">prec</span><span class="op" id="2135532">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2135536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135540">digs</span>&nbsp;<span class="op" id="2135545">=</span>&nbsp;<span class="ident" id="2135547">decimalSlice</span><span class="op" id="2135559">{</span><span class="ident" id="2135560">d</span><span class="op" id="2135561">:</span>&nbsp;<span class="ident" id="2135563">d</span><span class="op" id="2135564">.</span><span class="ident" id="2135565">d</span><span class="op" id="2135566">[</span><span class="op" id="2135567">:</span><span class="op" id="2135568">]</span><span class="op" id="2135569">,</span>&nbsp;<span class="ident" id="2135571">nd</span><span class="op" id="2135573">:</span>&nbsp;<span class="ident" id="2135575">d</span><span class="op" id="2135576">.</span><span class="ident" id="2135577">nd</span><span class="op" id="2135579">,</span>&nbsp;<span class="ident" id="2135581">dp</span><span class="op" id="2135583">:</span>&nbsp;<span class="ident" id="2135585">d</span><span class="op" id="2135586">.</span><span class="ident" id="2135587">dp</span><span class="op" id="2135589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2135592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135595">return</span>&nbsp;<span class="ident" id="2135602">formatDigits</span><span class="op" id="2135614">(</span><span class="ident" id="2135615">dst</span><span class="op" id="2135618">,</span>&nbsp;<span class="ident" id="2135620">shortest</span><span class="op" id="2135628">,</span>&nbsp;<span class="ident" id="2135630">neg</span><span class="op" id="2135633">,</span>&nbsp;<span class="ident" id="2135635">digs</span><span class="op" id="2135639">,</span>&nbsp;<span class="ident" id="2135641">prec</span><span class="op" id="2135645">,</span>&nbsp;<span class="ident" id="2135647">fmt</span><span class="op" id="2135650">)</span><br>
<span class="lineno"></span><span class="op" id="2135652">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="2135655">func</span>&nbsp;<span class="ident" id="2135660">formatDigits</span><span class="op" id="2135672">(</span><span class="ident" id="2135673">dst</span>&nbsp;<span class="op" id="2135677">[</span><span class="op" id="2135678">]</span><span class="builtintype" id="2135679">byte</span><span class="op" id="2135683">,</span>&nbsp;<span class="ident" id="2135685">shortest</span>&nbsp;<span class="builtintype" id="2135694">bool</span><span class="op" id="2135698">,</span>&nbsp;<span class="ident" id="2135700">neg</span>&nbsp;<span class="builtintype" id="2135704">bool</span><span class="op" id="2135708">,</span>&nbsp;<span class="ident" id="2135710">digs</span>&nbsp;<span class="ident" id="2135715">decimalSlice</span><span class="op" id="2135727">,</span>&nbsp;<span class="ident" id="2135729">prec</span>&nbsp;<span class="builtintype" id="2135734">int</span><span class="op" id="2135737">,</span>&nbsp;<span class="ident" id="2135739">fmt</span>&nbsp;<span class="builtintype" id="2135743">byte</span><span class="op" id="2135747">)</span>&nbsp;<span class="op" id="2135749">[</span><span class="op" id="2135750">]</span><span class="builtintype" id="2135751">byte</span>&nbsp;<span class="op" id="2135756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135759">switch</span>&nbsp;<span class="ident" id="2135766">fmt</span>&nbsp;<span class="op" id="2135770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135773">case</span>&nbsp;<span class="string" id="2135778">&#39;e&#39;</span><span class="op" id="2135781">,</span>&nbsp;<span class="string" id="2135783">&#39;E&#39;</span><span class="op" id="2135786">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135790">return</span>&nbsp;<span class="ident" id="2135797">fmtE</span><span class="op" id="2135801">(</span><span class="ident" id="2135802">dst</span><span class="op" id="2135805">,</span>&nbsp;<span class="ident" id="2135807">neg</span><span class="op" id="2135810">,</span>&nbsp;<span class="ident" id="2135812">digs</span><span class="op" id="2135816">,</span>&nbsp;<span class="ident" id="2135818">prec</span><span class="op" id="2135822">,</span>&nbsp;<span class="ident" id="2135824">fmt</span><span class="op" id="2135827">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135830">case</span>&nbsp;<span class="string" id="2135835">&#39;f&#39;</span><span class="op" id="2135838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135842">return</span>&nbsp;<span class="ident" id="2135849">fmtF</span><span class="op" id="2135853">(</span><span class="ident" id="2135854">dst</span><span class="op" id="2135857">,</span>&nbsp;<span class="ident" id="2135859">neg</span><span class="op" id="2135862">,</span>&nbsp;<span class="ident" id="2135864">digs</span><span class="op" id="2135868">,</span>&nbsp;<span class="ident" id="2135870">prec</span><span class="op" id="2135874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135877">case</span>&nbsp;<span class="string" id="2135882">&#39;g&#39;</span><span class="op" id="2135885">,</span>&nbsp;<span class="string" id="2135887">&#39;G&#39;</span><span class="op" id="2135890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2135894">//&nbsp;trailing&nbsp;fractional&nbsp;zeros&nbsp;in&nbsp;&#39;e&#39;&nbsp;form&nbsp;will&nbsp;be&nbsp;trimmed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2135954">eprec</span>&nbsp;<span class="op" id="2135960">:=</span>&nbsp;<span class="ident" id="2135963">prec</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2135970">if</span>&nbsp;<span class="ident" id="2135973">eprec</span>&nbsp;<span class="op" id="2135979">&gt;</span>&nbsp;<span class="ident" id="2135981">digs</span><span class="op" id="2135985">.</span><span class="ident" id="2135986">nd</span>&nbsp;<span class="op" id="2135989">&amp;&amp;</span>&nbsp;<span class="ident" id="2135992">digs</span><span class="op" id="2135996">.</span><span class="ident" id="2135997">nd</span>&nbsp;<span class="op" id="2136000">&gt;=</span>&nbsp;<span class="ident" id="2136003">digs</span><span class="op" id="2136007">.</span><span class="ident" id="2136008">dp</span>&nbsp;<span class="op" id="2136011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2136016">eprec</span>&nbsp;<span class="op" id="2136022">=</span>&nbsp;<span class="ident" id="2136024">digs</span><span class="op" id="2136028">.</span><span class="ident" id="2136029">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2136034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2136038">//&nbsp;%e&nbsp;is&nbsp;used&nbsp;if&nbsp;the&nbsp;exponent&nbsp;from&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2136090">//&nbsp;is&nbsp;less&nbsp;than&nbsp;-4&nbsp;or&nbsp;greater&nbsp;than&nbsp;or&nbsp;equal&nbsp;to&nbsp;the&nbsp;precision.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2136154">//&nbsp;if&nbsp;precision&nbsp;was&nbsp;the&nbsp;shortest&nbsp;possible,&nbsp;use&nbsp;precision&nbsp;6&nbsp;for&nbsp;this&nbsp;decision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2136234">if</span>&nbsp;<span class="ident" id="2136237">shortest</span>&nbsp;<span class="op" id="2136246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2136251">eprec</span>&nbsp;<span class="op" id="2136257">=</span>&nbsp;<span class="num" id="2136259">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2136263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2136267">exp</span>&nbsp;<span class="op" id="2136271">:=</span>&nbsp;<span class="ident" id="2136274">digs</span><span class="op" id="2136278">.</span><span class="ident" id="2136279">dp</span>&nbsp;<span class="op" id="2136282">-</span>&nbsp;<span class="num" id="2136284">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2136288">if</span>&nbsp;<span class="ident" id="2136291">exp</span>&nbsp;<span class="op" id="2136295">&lt;</span>&nbsp;<span class="op" id="2136297">-</span><span class="num" id="2136298">4</span>&nbsp;<span class="op" id="2136300">||</span>&nbsp;<span class="ident" id="2136303">exp</span>&nbsp;<span class="op" id="2136307">&gt;=</span>&nbsp;<span class="ident" id="2136310">eprec</span>&nbsp;<span class="op" id="2136316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2136321">if</span>&nbsp;<span class="ident" id="2136324">prec</span>&nbsp;<span class="op" id="2136329">&gt;</span>&nbsp;<span class="ident" id="2136331">digs</span><span class="op" id="2136335">.</span><span class="ident" id="2136336">nd</span>&nbsp;<span class="op" id="2136339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2136345">prec</span>&nbsp;<span class="op" id="2136350">=</span>&nbsp;<span class="ident" id="2136352">digs</span><span class="op" id="2136356">.</span><span class="ident" id="2136357">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2136363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2136368">return</span>&nbsp;<span class="ident" id="2136375">fmtE</span><span class="op" id="2136379">(</span><span class="ident" id="2136380">dst</span><span class="op" id="2136383">,</span>&nbsp;<span class="ident" id="2136385">neg</span><span class="op" id="2136388">,</span>&nbsp;<span class="ident" id="2136390">digs</span><span class="op" id="2136394">,</span>&nbsp;<span class="ident" id="2136396">prec</span><span class="op" id="2136400">-</span><span class="num" id="2136401">1</span><span class="op" id="2136402">,</span>&nbsp;<span class="ident" id="2136404">fmt</span><span class="op" id="2136407">+</span><span class="string" id="2136408">&#39;e&#39;</span><span class="op" id="2136411">-</span><span class="string" id="2136412">&#39;g&#39;</span><span class="op" id="2136415">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2136419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2136423">if</span>&nbsp;<span class="ident" id="2136426">prec</span>&nbsp;<span class="op" id="2136431">&gt;</span>&nbsp;<span class="ident" id="2136433">digs</span><span class="op" id="2136437">.</span><span class="ident" id="2136438">dp</span>&nbsp;<span class="op" id="2136441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2136446">prec</span>&nbsp;<span class="op" id="2136451">=</span>&nbsp;<span class="ident" id="2136453">digs</span><span class="op" id="2136457">.</span><span class="ident" id="2136458">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2136463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2136467">return</span>&nbsp;<span class="ident" id="2136474">fmtF</span><span class="op" id="2136478">(</span><span class="ident" id="2136479">dst</span><span class="op" id="2136482">,</span>&nbsp;<span class="ident" id="2136484">neg</span><span class="op" id="2136487">,</span>&nbsp;<span class="ident" id="2136489">digs</span><span class="op" id="2136493">,</span>&nbsp;<span class="ident" id="2136495">max</span><span class="op" id="2136498">(</span><span class="ident" id="2136499">prec</span><span class="op" id="2136503">-</span><span class="ident" id="2136504">digs</span><span class="op" id="2136508">.</span><span class="ident" id="2136509">dp</span><span class="op" id="2136511">,</span>&nbsp;<span class="num" id="2136513">0</span><span class="op" id="2136514">)</span><span class="op" id="2136515">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2136518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2136522">//&nbsp;unknown&nbsp;format</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2136541">return</span>&nbsp;<span class="builtinfunc" id="2136548">append</span><span class="op" id="2136554">(</span><span class="ident" id="2136555">dst</span><span class="op" id="2136558">,</span>&nbsp;<span class="string" id="2136560">&#39;%&#39;</span><span class="op" id="2136563">,</span>&nbsp;<span class="ident" id="2136565">fmt</span><span class="op" id="2136568">)</span><br>
<span class="lineno"></span><span class="op" id="2136570">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="2136573">//&nbsp;Round&nbsp;d&nbsp;(=&nbsp;mant&nbsp;*&nbsp;2^exp)&nbsp;to&nbsp;the&nbsp;shortest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2136634">//&nbsp;that&nbsp;will&nbsp;let&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;value&nbsp;be&nbsp;precisely</span><br>
<span class="lineno"></span><span class="comment" id="2136698">//&nbsp;reconstructed.&nbsp;&nbsp;Size&nbsp;is&nbsp;original&nbsp;floating&nbsp;point&nbsp;size&nbsp;(64&nbsp;or&nbsp;32).</span><br>
<span class="lineno"></span><span class="keyword" id="2136766">func</span>&nbsp;<span class="ident" id="2136771">roundShortest</span><span class="op" id="2136784">(</span><span class="ident" id="2136785">d</span>&nbsp;<span class="op" id="2136787">*</span><span class="ident" id="2136788">decimal</span><span class="op" id="2136795">,</span>&nbsp;<span class="ident" id="2136797">mant</span>&nbsp;<span class="builtintype" id="2136802">uint64</span><span class="op" id="2136808">,</span>&nbsp;<span class="ident" id="2136810">exp</span>&nbsp;<span class="builtintype" id="2136814">int</span><span class="op" id="2136817">,</span>&nbsp;<span class="ident" id="2136819">flt</span>&nbsp;<span class="op" id="2136823">*</span><span class="ident" id="2136824">floatInfo</span><span class="op" id="2136833">)</span>&nbsp;<span class="op" id="2136835">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2136838">//&nbsp;If&nbsp;mantissa&nbsp;is&nbsp;zero,&nbsp;the&nbsp;number&nbsp;is&nbsp;zero;&nbsp;stop&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2136893">if</span>&nbsp;<span class="ident" id="2136896">mant</span>&nbsp;<span class="op" id="2136901">==</span>&nbsp;<span class="num" id="2136904">0</span>&nbsp;<span class="op" id="2136906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2136910">d</span><span class="op" id="2136911">.</span><span class="ident" id="2136912">nd</span>&nbsp;<span class="op" id="2136915">=</span>&nbsp;<span class="num" id="2136917">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2136921">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2136929">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2136933">//&nbsp;Compute&nbsp;upper&nbsp;and&nbsp;lower&nbsp;such&nbsp;that&nbsp;any&nbsp;decimal&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2136990">//&nbsp;between&nbsp;upper&nbsp;and&nbsp;lower&nbsp;(possibly&nbsp;inclusive)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2137039">//&nbsp;will&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;number.</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2137094">//&nbsp;We&nbsp;may&nbsp;see&nbsp;at&nbsp;once&nbsp;that&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2137154">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2137158">//&nbsp;Suppose&nbsp;d&nbsp;is&nbsp;not&nbsp;denormal,&nbsp;so&nbsp;that&nbsp;2^exp&nbsp;&lt;=&nbsp;d&nbsp;&lt;&nbsp;10^dp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2137217">//&nbsp;The&nbsp;closest&nbsp;shorter&nbsp;number&nbsp;is&nbsp;at&nbsp;least&nbsp;10^(dp-nd)&nbsp;away.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2137277">//&nbsp;The&nbsp;lower/upper&nbsp;bounds&nbsp;computed&nbsp;below&nbsp;are&nbsp;at&nbsp;distance</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2137335">//&nbsp;at&nbsp;most&nbsp;2^(exp-mantbits).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2137365">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2137369">//&nbsp;So&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest&nbsp;if&nbsp;10^(dp-nd)&nbsp;&gt;&nbsp;2^(exp-mantbits),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2137441">//&nbsp;or&nbsp;equivalently&nbsp;log2(10)*(dp-nd)&nbsp;&gt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2137494">//&nbsp;It&nbsp;is&nbsp;true&nbsp;if&nbsp;332/100*(dp-nd)&nbsp;&gt;=&nbsp;exp-mantbits&nbsp;(log2(10)&nbsp;&gt;&nbsp;3.32).</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2137563">minexp</span>&nbsp;<span class="op" id="2137570">:=</span>&nbsp;<span class="ident" id="2137573">flt</span><span class="op" id="2137576">.</span><span class="ident" id="2137577">bias</span>&nbsp;<span class="op" id="2137582">+</span>&nbsp;<span class="num" id="2137584">1</span>&nbsp;<span class="comment" id="2137586">//&nbsp;minimum&nbsp;possible&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2137616">if</span>&nbsp;<span class="ident" id="2137619">exp</span>&nbsp;<span class="op" id="2137623">&gt;</span>&nbsp;<span class="ident" id="2137625">minexp</span>&nbsp;<span class="op" id="2137632">&amp;&amp;</span>&nbsp;<span class="num" id="2137635">332</span><span class="op" id="2137638">*</span><span class="op" id="2137639">(</span><span class="ident" id="2137640">d</span><span class="op" id="2137641">.</span><span class="ident" id="2137642">dp</span><span class="op" id="2137644">-</span><span class="ident" id="2137645">d</span><span class="op" id="2137646">.</span><span class="ident" id="2137647">nd</span><span class="op" id="2137649">)</span>&nbsp;<span class="op" id="2137651">&gt;=</span>&nbsp;<span class="num" id="2137654">100</span><span class="op" id="2137657">*</span><span class="op" id="2137658">(</span><span class="ident" id="2137659">exp</span><span class="op" id="2137662">-</span><span class="builtintype" id="2137663">int</span><span class="op" id="2137666">(</span><span class="ident" id="2137667">flt</span><span class="op" id="2137670">.</span><span class="ident" id="2137671">mantbits</span><span class="op" id="2137679">)</span><span class="op" id="2137680">)</span>&nbsp;<span class="op" id="2137682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2137686">//&nbsp;The&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2137723">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2137731">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2137735">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2137768">//&nbsp;Next&nbsp;highest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant+1&nbsp;&lt;&lt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2137834">//&nbsp;Our&nbsp;upper&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mant*2+1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2137902">upper</span>&nbsp;<span class="op" id="2137908">:=</span>&nbsp;<span class="builtinfunc" id="2137911">new</span><span class="op" id="2137914">(</span><span class="ident" id="2137915">decimal</span><span class="op" id="2137922">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2137925">upper</span><span class="op" id="2137930">.</span><span class="ident" id="2137931">Assign</span><span class="op" id="2137937">(</span><span class="ident" id="2137938">mant</span><span class="op" id="2137942">*</span><span class="num" id="2137943">2</span>&nbsp;<span class="op" id="2137945">+</span>&nbsp;<span class="num" id="2137947">1</span><span class="op" id="2137948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2137951">upper</span><span class="op" id="2137956">.</span><span class="ident" id="2137957">Shift</span><span class="op" id="2137962">(</span><span class="ident" id="2137963">exp</span>&nbsp;<span class="op" id="2137967">-</span>&nbsp;<span class="builtintype" id="2137969">int</span><span class="op" id="2137972">(</span><span class="ident" id="2137973">flt</span><span class="op" id="2137976">.</span><span class="ident" id="2137977">mantbits</span><span class="op" id="2137985">)</span>&nbsp;<span class="op" id="2137987">-</span>&nbsp;<span class="num" id="2137989">1</span><span class="op" id="2137990">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2137994">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2138027">//&nbsp;Next&nbsp;lowest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant-1&nbsp;&lt;&lt;&nbsp;exp-mantbits,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2138092">//&nbsp;unless&nbsp;mant-1&nbsp;drops&nbsp;the&nbsp;significant&nbsp;bit&nbsp;and&nbsp;exp&nbsp;is&nbsp;not&nbsp;the&nbsp;minimum&nbsp;exp,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2138168">//&nbsp;in&nbsp;which&nbsp;case&nbsp;the&nbsp;next&nbsp;lowest&nbsp;is&nbsp;mant*2-1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2138233">//&nbsp;Either&nbsp;way,&nbsp;call&nbsp;it&nbsp;mantlo&nbsp;&lt;&lt;&nbsp;explo-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2138283">//&nbsp;Our&nbsp;lower&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mantlo*2+1&nbsp;&lt;&lt;&nbsp;explo-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2138355">var</span>&nbsp;<span class="ident" id="2138359">mantlo</span>&nbsp;<span class="builtintype" id="2138366">uint64</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2138374">var</span>&nbsp;<span class="ident" id="2138378">explo</span>&nbsp;<span class="builtintype" id="2138384">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2138389">if</span>&nbsp;<span class="ident" id="2138392">mant</span>&nbsp;<span class="op" id="2138397">&gt;</span>&nbsp;<span class="num" id="2138399">1</span><span class="op" id="2138400">&lt;&lt;</span><span class="ident" id="2138402">flt</span><span class="op" id="2138405">.</span><span class="ident" id="2138406">mantbits</span>&nbsp;<span class="op" id="2138415">||</span>&nbsp;<span class="ident" id="2138418">exp</span>&nbsp;<span class="op" id="2138422">==</span>&nbsp;<span class="ident" id="2138425">minexp</span>&nbsp;<span class="op" id="2138432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2138436">mantlo</span>&nbsp;<span class="op" id="2138443">=</span>&nbsp;<span class="ident" id="2138445">mant</span>&nbsp;<span class="op" id="2138450">-</span>&nbsp;<span class="num" id="2138452">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2138456">explo</span>&nbsp;<span class="op" id="2138462">=</span>&nbsp;<span class="ident" id="2138464">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2138469">}</span>&nbsp;<span class="keyword" id="2138471">else</span>&nbsp;<span class="op" id="2138476">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2138480">mantlo</span>&nbsp;<span class="op" id="2138487">=</span>&nbsp;<span class="ident" id="2138489">mant</span><span class="op" id="2138493">*</span><span class="num" id="2138494">2</span>&nbsp;<span class="op" id="2138496">-</span>&nbsp;<span class="num" id="2138498">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2138502">explo</span>&nbsp;<span class="op" id="2138508">=</span>&nbsp;<span class="ident" id="2138510">exp</span>&nbsp;<span class="op" id="2138514">-</span>&nbsp;<span class="num" id="2138516">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2138519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2138522">lower</span>&nbsp;<span class="op" id="2138528">:=</span>&nbsp;<span class="builtinfunc" id="2138531">new</span><span class="op" id="2138534">(</span><span class="ident" id="2138535">decimal</span><span class="op" id="2138542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2138545">lower</span><span class="op" id="2138550">.</span><span class="ident" id="2138551">Assign</span><span class="op" id="2138557">(</span><span class="ident" id="2138558">mantlo</span><span class="op" id="2138564">*</span><span class="num" id="2138565">2</span>&nbsp;<span class="op" id="2138567">+</span>&nbsp;<span class="num" id="2138569">1</span><span class="op" id="2138570">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2138573">lower</span><span class="op" id="2138578">.</span><span class="ident" id="2138579">Shift</span><span class="op" id="2138584">(</span><span class="ident" id="2138585">explo</span>&nbsp;<span class="op" id="2138591">-</span>&nbsp;<span class="builtintype" id="2138593">int</span><span class="op" id="2138596">(</span><span class="ident" id="2138597">flt</span><span class="op" id="2138600">.</span><span class="ident" id="2138601">mantbits</span><span class="op" id="2138609">)</span>&nbsp;<span class="op" id="2138611">-</span>&nbsp;<span class="num" id="2138613">1</span><span class="op" id="2138614">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2138618">//&nbsp;The&nbsp;upper&nbsp;and&nbsp;lower&nbsp;bounds&nbsp;are&nbsp;possible&nbsp;outputs&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2138678">//&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;is&nbsp;even,&nbsp;so&nbsp;that&nbsp;IEEE&nbsp;round-to-even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2138740">//&nbsp;would&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;and&nbsp;not&nbsp;the&nbsp;neighbors.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2138804">inclusive</span>&nbsp;<span class="op" id="2138814">:=</span>&nbsp;<span class="ident" id="2138817">mant</span><span class="op" id="2138821">%</span><span class="num" id="2138822">2</span>&nbsp;<span class="op" id="2138824">==</span>&nbsp;<span class="num" id="2138827">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2138831">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;figure&nbsp;out&nbsp;the&nbsp;minimum&nbsp;number&nbsp;of&nbsp;digits&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2138896">//&nbsp;Walk&nbsp;along&nbsp;until&nbsp;d&nbsp;has&nbsp;distinguished&nbsp;itself&nbsp;from&nbsp;upper&nbsp;and&nbsp;lower.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2138966">for</span>&nbsp;<span class="ident" id="2138970">i</span>&nbsp;<span class="op" id="2138972">:=</span>&nbsp;<span class="num" id="2138975">0</span><span class="op" id="2138976">;</span>&nbsp;<span class="ident" id="2138978">i</span>&nbsp;<span class="op" id="2138980">&lt;</span>&nbsp;<span class="ident" id="2138982">d</span><span class="op" id="2138983">.</span><span class="ident" id="2138984">nd</span><span class="op" id="2138986">;</span>&nbsp;<span class="ident" id="2138988">i</span><span class="op" id="2138989">++</span>&nbsp;<span class="op" id="2138992">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2138996">var</span>&nbsp;<span class="ident" id="2139000">l</span><span class="op" id="2139001">,</span>&nbsp;<span class="ident" id="2139003">m</span><span class="op" id="2139004">,</span>&nbsp;<span class="ident" id="2139006">u</span>&nbsp;<span class="builtintype" id="2139008">byte</span>&nbsp;<span class="comment" id="2139013">//&nbsp;lower,&nbsp;middle,&nbsp;upper&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2139046">if</span>&nbsp;<span class="ident" id="2139049">i</span>&nbsp;<span class="op" id="2139051">&lt;</span>&nbsp;<span class="ident" id="2139053">lower</span><span class="op" id="2139058">.</span><span class="ident" id="2139059">nd</span>&nbsp;<span class="op" id="2139062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2139067">l</span>&nbsp;<span class="op" id="2139069">=</span>&nbsp;<span class="ident" id="2139071">lower</span><span class="op" id="2139076">.</span><span class="ident" id="2139077">d</span><span class="op" id="2139078">[</span><span class="ident" id="2139079">i</span><span class="op" id="2139080">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2139084">}</span>&nbsp;<span class="keyword" id="2139086">else</span>&nbsp;<span class="op" id="2139091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2139096">l</span>&nbsp;<span class="op" id="2139098">=</span>&nbsp;<span class="string" id="2139100">&#39;0&#39;</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2139106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2139110">m</span>&nbsp;<span class="op" id="2139112">=</span>&nbsp;<span class="ident" id="2139114">d</span><span class="op" id="2139115">.</span><span class="ident" id="2139116">d</span><span class="op" id="2139117">[</span><span class="ident" id="2139118">i</span><span class="op" id="2139119">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2139123">if</span>&nbsp;<span class="ident" id="2139126">i</span>&nbsp;<span class="op" id="2139128">&lt;</span>&nbsp;<span class="ident" id="2139130">upper</span><span class="op" id="2139135">.</span><span class="ident" id="2139136">nd</span>&nbsp;<span class="op" id="2139139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2139144">u</span>&nbsp;<span class="op" id="2139146">=</span>&nbsp;<span class="ident" id="2139148">upper</span><span class="op" id="2139153">.</span><span class="ident" id="2139154">d</span><span class="op" id="2139155">[</span><span class="ident" id="2139156">i</span><span class="op" id="2139157">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2139161">}</span>&nbsp;<span class="keyword" id="2139163">else</span>&nbsp;<span class="op" id="2139168">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2139173">u</span>&nbsp;<span class="op" id="2139175">=</span>&nbsp;<span class="string" id="2139177">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2139183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2139188">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;down&nbsp;(truncate)&nbsp;if&nbsp;lower&nbsp;has&nbsp;a&nbsp;different&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2139254">//&nbsp;or&nbsp;if&nbsp;lower&nbsp;is&nbsp;inclusive&nbsp;and&nbsp;is&nbsp;exactly&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;down.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2139328">okdown</span>&nbsp;<span class="op" id="2139335">:=</span>&nbsp;<span class="ident" id="2139338">l</span>&nbsp;<span class="op" id="2139340">!=</span>&nbsp;<span class="ident" id="2139343">m</span>&nbsp;<span class="op" id="2139345">||</span>&nbsp;<span class="op" id="2139348">(</span><span class="ident" id="2139349">inclusive</span>&nbsp;<span class="op" id="2139359">&amp;&amp;</span>&nbsp;<span class="ident" id="2139362">l</span>&nbsp;<span class="op" id="2139364">==</span>&nbsp;<span class="ident" id="2139367">m</span>&nbsp;<span class="op" id="2139369">&amp;&amp;</span>&nbsp;<span class="ident" id="2139372">i</span><span class="op" id="2139373">+</span><span class="num" id="2139374">1</span>&nbsp;<span class="op" id="2139376">==</span>&nbsp;<span class="ident" id="2139379">lower</span><span class="op" id="2139384">.</span><span class="ident" id="2139385">nd</span><span class="op" id="2139387">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2139392">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;up&nbsp;if&nbsp;upper&nbsp;has&nbsp;a&nbsp;different&nbsp;digit&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2139449">//&nbsp;either&nbsp;upper&nbsp;is&nbsp;inclusive&nbsp;or&nbsp;upper&nbsp;is&nbsp;bigger&nbsp;than&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2139531">okup</span>&nbsp;<span class="op" id="2139536">:=</span>&nbsp;<span class="ident" id="2139539">m</span>&nbsp;<span class="op" id="2139541">!=</span>&nbsp;<span class="ident" id="2139544">u</span>&nbsp;<span class="op" id="2139546">&amp;&amp;</span>&nbsp;<span class="op" id="2139549">(</span><span class="ident" id="2139550">inclusive</span>&nbsp;<span class="op" id="2139560">||</span>&nbsp;<span class="ident" id="2139563">m</span><span class="op" id="2139564">+</span><span class="num" id="2139565">1</span>&nbsp;<span class="op" id="2139567">&lt;</span>&nbsp;<span class="ident" id="2139569">u</span>&nbsp;<span class="op" id="2139571">||</span>&nbsp;<span class="ident" id="2139574">i</span><span class="op" id="2139575">+</span><span class="num" id="2139576">1</span>&nbsp;<span class="op" id="2139578">&lt;</span>&nbsp;<span class="ident" id="2139580">upper</span><span class="op" id="2139585">.</span><span class="ident" id="2139586">nd</span><span class="op" id="2139588">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2139593">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;either,&nbsp;then&nbsp;round&nbsp;to&nbsp;the&nbsp;nearest&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2139656">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;only&nbsp;one,&nbsp;do&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2139697">switch</span>&nbsp;<span class="op" id="2139704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2139708">case</span>&nbsp;<span class="ident" id="2139713">okdown</span>&nbsp;<span class="op" id="2139720">&amp;&amp;</span>&nbsp;<span class="ident" id="2139723">okup</span><span class="op" id="2139727">:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2139732">d</span><span class="op" id="2139733">.</span><span class="ident" id="2139734">Round</span><span class="op" id="2139739">(</span><span class="ident" id="2139740">i</span>&nbsp;<span class="op" id="2139742">+</span>&nbsp;<span class="num" id="2139744">1</span><span class="op" id="2139745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2139750">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2139759">case</span>&nbsp;<span class="ident" id="2139764">okdown</span><span class="op" id="2139770">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2139775">d</span><span class="op" id="2139776">.</span><span class="ident" id="2139777">RoundDown</span><span class="op" id="2139786">(</span><span class="ident" id="2139787">i</span>&nbsp;<span class="op" id="2139789">+</span>&nbsp;<span class="num" id="2139791">1</span><span class="op" id="2139792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2139797">return</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2139806">case</span>&nbsp;<span class="ident" id="2139811">okup</span><span class="op" id="2139815">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2139820">d</span><span class="op" id="2139821">.</span><span class="ident" id="2139822">RoundUp</span><span class="op" id="2139829">(</span><span class="ident" id="2139830">i</span>&nbsp;<span class="op" id="2139832">+</span>&nbsp;<span class="num" id="2139834">1</span><span class="op" id="2139835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2139840">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2139849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2139852">}</span><br>
<span class="lineno">325</span><span class="op" id="2139854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2139857">type</span>&nbsp;<span class="ident" id="2139862">decimalSlice</span>&nbsp;<span class="keyword" id="2139875">struct</span>&nbsp;<span class="op" id="2139882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2139885">d</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2139892">[</span><span class="op" id="2139893">]</span><span class="builtintype" id="2139894">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2139900">nd</span><span class="op" id="2139902">,</span>&nbsp;<span class="ident" id="2139904">dp</span>&nbsp;<span class="builtintype" id="2139907">int</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2139912">neg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2139919">bool</span><br>
<span class="lineno"></span><span class="op" id="2139924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2139927">//&nbsp;%e:&nbsp;-d.ddddde±dd</span><br>
<span class="lineno"></span><span class="keyword" id="2139948">func</span>&nbsp;<span class="ident" id="2139953">fmtE</span><span class="op" id="2139957">(</span><span class="ident" id="2139958">dst</span>&nbsp;<span class="op" id="2139962">[</span><span class="op" id="2139963">]</span><span class="builtintype" id="2139964">byte</span><span class="op" id="2139968">,</span>&nbsp;<span class="ident" id="2139970">neg</span>&nbsp;<span class="builtintype" id="2139974">bool</span><span class="op" id="2139978">,</span>&nbsp;<span class="ident" id="2139980">d</span>&nbsp;<span class="ident" id="2139982">decimalSlice</span><span class="op" id="2139994">,</span>&nbsp;<span class="ident" id="2139996">prec</span>&nbsp;<span class="builtintype" id="2140001">int</span><span class="op" id="2140004">,</span>&nbsp;<span class="ident" id="2140006">fmt</span>&nbsp;<span class="builtintype" id="2140010">byte</span><span class="op" id="2140014">)</span>&nbsp;<span class="op" id="2140016">[</span><span class="op" id="2140017">]</span><span class="builtintype" id="2140018">byte</span>&nbsp;<span class="op" id="2140023">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2140026">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2140035">if</span>&nbsp;<span class="ident" id="2140038">neg</span>&nbsp;<span class="op" id="2140042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140046">dst</span>&nbsp;<span class="op" id="2140050">=</span>&nbsp;<span class="builtinfunc" id="2140052">append</span><span class="op" id="2140058">(</span><span class="ident" id="2140059">dst</span><span class="op" id="2140062">,</span>&nbsp;<span class="string" id="2140064">&#39;-&#39;</span><span class="op" id="2140067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2140070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2140074">//&nbsp;first&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140090">ch</span>&nbsp;<span class="op" id="2140093">:=</span>&nbsp;<span class="builtintype" id="2140096">byte</span><span class="op" id="2140100">(</span><span class="string" id="2140101">&#39;0&#39;</span><span class="op" id="2140104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2140107">if</span>&nbsp;<span class="ident" id="2140110">d</span><span class="op" id="2140111">.</span><span class="ident" id="2140112">nd</span>&nbsp;<span class="op" id="2140115">!=</span>&nbsp;<span class="num" id="2140118">0</span>&nbsp;<span class="op" id="2140120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140124">ch</span>&nbsp;<span class="op" id="2140127">=</span>&nbsp;<span class="ident" id="2140129">d</span><span class="op" id="2140130">.</span><span class="ident" id="2140131">d</span><span class="op" id="2140132">[</span><span class="num" id="2140133">0</span><span class="op" id="2140134">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2140137">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140140">dst</span>&nbsp;<span class="op" id="2140144">=</span>&nbsp;<span class="builtinfunc" id="2140146">append</span><span class="op" id="2140152">(</span><span class="ident" id="2140153">dst</span><span class="op" id="2140156">,</span>&nbsp;<span class="ident" id="2140158">ch</span><span class="op" id="2140160">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2140164">//&nbsp;.moredigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2140180">if</span>&nbsp;<span class="ident" id="2140183">prec</span>&nbsp;<span class="op" id="2140188">&gt;</span>&nbsp;<span class="num" id="2140190">0</span>&nbsp;<span class="op" id="2140192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140196">dst</span>&nbsp;<span class="op" id="2140200">=</span>&nbsp;<span class="builtinfunc" id="2140202">append</span><span class="op" id="2140208">(</span><span class="ident" id="2140209">dst</span><span class="op" id="2140212">,</span>&nbsp;<span class="string" id="2140214">&#39;.&#39;</span><span class="op" id="2140217">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140221">i</span>&nbsp;<span class="op" id="2140223">:=</span>&nbsp;<span class="num" id="2140226">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140230">m</span>&nbsp;<span class="op" id="2140232">:=</span>&nbsp;<span class="ident" id="2140235">d</span><span class="op" id="2140236">.</span><span class="ident" id="2140237">nd</span>&nbsp;<span class="op" id="2140240">+</span>&nbsp;<span class="ident" id="2140242">prec</span>&nbsp;<span class="op" id="2140247">+</span>&nbsp;<span class="num" id="2140249">1</span>&nbsp;<span class="op" id="2140251">-</span>&nbsp;<span class="ident" id="2140253">max</span><span class="op" id="2140256">(</span><span class="ident" id="2140257">d</span><span class="op" id="2140258">.</span><span class="ident" id="2140259">nd</span><span class="op" id="2140261">,</span>&nbsp;<span class="ident" id="2140263">prec</span><span class="op" id="2140267">+</span><span class="num" id="2140268">1</span><span class="op" id="2140269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2140273">for</span>&nbsp;<span class="ident" id="2140277">i</span>&nbsp;<span class="op" id="2140279">&lt;</span>&nbsp;<span class="ident" id="2140281">m</span>&nbsp;<span class="op" id="2140283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140288">dst</span>&nbsp;<span class="op" id="2140292">=</span>&nbsp;<span class="builtinfunc" id="2140294">append</span><span class="op" id="2140300">(</span><span class="ident" id="2140301">dst</span><span class="op" id="2140304">,</span>&nbsp;<span class="ident" id="2140306">d</span><span class="op" id="2140307">.</span><span class="ident" id="2140308">d</span><span class="op" id="2140309">[</span><span class="ident" id="2140310">i</span><span class="op" id="2140311">]</span><span class="op" id="2140312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140317">i</span><span class="op" id="2140318">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2140323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2140327">for</span>&nbsp;<span class="ident" id="2140331">i</span>&nbsp;<span class="op" id="2140333">&lt;=</span>&nbsp;<span class="ident" id="2140336">prec</span>&nbsp;<span class="op" id="2140341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140346">dst</span>&nbsp;<span class="op" id="2140350">=</span>&nbsp;<span class="builtinfunc" id="2140352">append</span><span class="op" id="2140358">(</span><span class="ident" id="2140359">dst</span><span class="op" id="2140362">,</span>&nbsp;<span class="string" id="2140364">&#39;0&#39;</span><span class="op" id="2140367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140372">i</span><span class="op" id="2140373">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2140378">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2140381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2140385">//&nbsp;e±</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140393">dst</span>&nbsp;<span class="op" id="2140397">=</span>&nbsp;<span class="builtinfunc" id="2140399">append</span><span class="op" id="2140405">(</span><span class="ident" id="2140406">dst</span><span class="op" id="2140409">,</span>&nbsp;<span class="ident" id="2140411">fmt</span><span class="op" id="2140414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140417">exp</span>&nbsp;<span class="op" id="2140421">:=</span>&nbsp;<span class="ident" id="2140424">d</span><span class="op" id="2140425">.</span><span class="ident" id="2140426">dp</span>&nbsp;<span class="op" id="2140429">-</span>&nbsp;<span class="num" id="2140431">1</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2140434">if</span>&nbsp;<span class="ident" id="2140437">d</span><span class="op" id="2140438">.</span><span class="ident" id="2140439">nd</span>&nbsp;<span class="op" id="2140442">==</span>&nbsp;<span class="num" id="2140445">0</span>&nbsp;<span class="op" id="2140447">{</span>&nbsp;<span class="comment" id="2140449">//&nbsp;special&nbsp;case:&nbsp;0&nbsp;has&nbsp;exponent&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140485">exp</span>&nbsp;<span class="op" id="2140489">=</span>&nbsp;<span class="num" id="2140491">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2140494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2140497">if</span>&nbsp;<span class="ident" id="2140500">exp</span>&nbsp;<span class="op" id="2140504">&lt;</span>&nbsp;<span class="num" id="2140506">0</span>&nbsp;<span class="op" id="2140508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140512">ch</span>&nbsp;<span class="op" id="2140515">=</span>&nbsp;<span class="string" id="2140517">&#39;-&#39;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140523">exp</span>&nbsp;<span class="op" id="2140527">=</span>&nbsp;<span class="op" id="2140529">-</span><span class="ident" id="2140530">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2140535">}</span>&nbsp;<span class="keyword" id="2140537">else</span>&nbsp;<span class="op" id="2140542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140546">ch</span>&nbsp;<span class="op" id="2140549">=</span>&nbsp;<span class="string" id="2140551">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2140556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140559">dst</span>&nbsp;<span class="op" id="2140563">=</span>&nbsp;<span class="builtinfunc" id="2140565">append</span><span class="op" id="2140571">(</span><span class="ident" id="2140572">dst</span><span class="op" id="2140575">,</span>&nbsp;<span class="ident" id="2140577">ch</span><span class="op" id="2140579">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2140583">//&nbsp;dddd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2140592">var</span>&nbsp;<span class="ident" id="2140596">buf</span>&nbsp;<span class="op" id="2140600">[</span><span class="num" id="2140601">3</span><span class="op" id="2140602">]</span><span class="builtintype" id="2140603">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140609">i</span>&nbsp;<span class="op" id="2140611">:=</span>&nbsp;<span class="builtinfunc" id="2140614">len</span><span class="op" id="2140617">(</span><span class="ident" id="2140618">buf</span><span class="op" id="2140621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2140624">for</span>&nbsp;<span class="ident" id="2140628">exp</span>&nbsp;<span class="op" id="2140632">&gt;=</span>&nbsp;<span class="num" id="2140635">10</span>&nbsp;<span class="op" id="2140638">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140642">i</span><span class="op" id="2140643">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140648">buf</span><span class="op" id="2140651">[</span><span class="ident" id="2140652">i</span><span class="op" id="2140653">]</span>&nbsp;<span class="op" id="2140655">=</span>&nbsp;<span class="builtintype" id="2140657">byte</span><span class="op" id="2140661">(</span><span class="ident" id="2140662">exp</span><span class="op" id="2140665">%</span><span class="num" id="2140666">10</span>&nbsp;<span class="op" id="2140669">+</span>&nbsp;<span class="string" id="2140671">&#39;0&#39;</span><span class="op" id="2140674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140678">exp</span>&nbsp;<span class="op" id="2140682">/=</span>&nbsp;<span class="num" id="2140685">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2140689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2140692">//&nbsp;exp&nbsp;&lt;&nbsp;10</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140705">i</span><span class="op" id="2140706">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140710">buf</span><span class="op" id="2140713">[</span><span class="ident" id="2140714">i</span><span class="op" id="2140715">]</span>&nbsp;<span class="op" id="2140717">=</span>&nbsp;<span class="builtintype" id="2140719">byte</span><span class="op" id="2140723">(</span><span class="ident" id="2140724">exp</span>&nbsp;<span class="op" id="2140728">+</span>&nbsp;<span class="string" id="2140730">&#39;0&#39;</span><span class="op" id="2140733">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2140737">switch</span>&nbsp;<span class="ident" id="2140744">i</span>&nbsp;<span class="op" id="2140746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2140749">case</span>&nbsp;<span class="num" id="2140754">0</span><span class="op" id="2140755">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140759">dst</span>&nbsp;<span class="op" id="2140763">=</span>&nbsp;<span class="builtinfunc" id="2140765">append</span><span class="op" id="2140771">(</span><span class="ident" id="2140772">dst</span><span class="op" id="2140775">,</span>&nbsp;<span class="ident" id="2140777">buf</span><span class="op" id="2140780">[</span><span class="num" id="2140781">0</span><span class="op" id="2140782">]</span><span class="op" id="2140783">,</span>&nbsp;<span class="ident" id="2140785">buf</span><span class="op" id="2140788">[</span><span class="num" id="2140789">1</span><span class="op" id="2140790">]</span><span class="op" id="2140791">,</span>&nbsp;<span class="ident" id="2140793">buf</span><span class="op" id="2140796">[</span><span class="num" id="2140797">2</span><span class="op" id="2140798">]</span><span class="op" id="2140799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2140802">case</span>&nbsp;<span class="num" id="2140807">1</span><span class="op" id="2140808">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140812">dst</span>&nbsp;<span class="op" id="2140816">=</span>&nbsp;<span class="builtinfunc" id="2140818">append</span><span class="op" id="2140824">(</span><span class="ident" id="2140825">dst</span><span class="op" id="2140828">,</span>&nbsp;<span class="ident" id="2140830">buf</span><span class="op" id="2140833">[</span><span class="num" id="2140834">1</span><span class="op" id="2140835">]</span><span class="op" id="2140836">,</span>&nbsp;<span class="ident" id="2140838">buf</span><span class="op" id="2140841">[</span><span class="num" id="2140842">2</span><span class="op" id="2140843">]</span><span class="op" id="2140844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2140847">case</span>&nbsp;<span class="num" id="2140852">2</span><span class="op" id="2140853">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2140857">//&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2140877">dst</span>&nbsp;<span class="op" id="2140881">=</span>&nbsp;<span class="builtinfunc" id="2140883">append</span><span class="op" id="2140889">(</span><span class="ident" id="2140890">dst</span><span class="op" id="2140893">,</span>&nbsp;<span class="string" id="2140895">&#39;0&#39;</span><span class="op" id="2140898">,</span>&nbsp;<span class="ident" id="2140900">buf</span><span class="op" id="2140903">[</span><span class="num" id="2140904">2</span><span class="op" id="2140905">]</span><span class="op" id="2140906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2140909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2140912">return</span>&nbsp;<span class="ident" id="2140919">dst</span><br>
<span class="lineno"></span><span class="op" id="2140923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="2140926">//&nbsp;%f:&nbsp;-ddddddd.ddddd</span><br>
<span class="lineno"></span><span class="keyword" id="2140948">func</span>&nbsp;<span class="ident" id="2140953">fmtF</span><span class="op" id="2140957">(</span><span class="ident" id="2140958">dst</span>&nbsp;<span class="op" id="2140962">[</span><span class="op" id="2140963">]</span><span class="builtintype" id="2140964">byte</span><span class="op" id="2140968">,</span>&nbsp;<span class="ident" id="2140970">neg</span>&nbsp;<span class="builtintype" id="2140974">bool</span><span class="op" id="2140978">,</span>&nbsp;<span class="ident" id="2140980">d</span>&nbsp;<span class="ident" id="2140982">decimalSlice</span><span class="op" id="2140994">,</span>&nbsp;<span class="ident" id="2140996">prec</span>&nbsp;<span class="builtintype" id="2141001">int</span><span class="op" id="2141004">)</span>&nbsp;<span class="op" id="2141006">[</span><span class="op" id="2141007">]</span><span class="builtintype" id="2141008">byte</span>&nbsp;<span class="op" id="2141013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2141016">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2141025">if</span>&nbsp;<span class="ident" id="2141028">neg</span>&nbsp;<span class="op" id="2141032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141036">dst</span>&nbsp;<span class="op" id="2141040">=</span>&nbsp;<span class="builtinfunc" id="2141042">append</span><span class="op" id="2141048">(</span><span class="ident" id="2141049">dst</span><span class="op" id="2141052">,</span>&nbsp;<span class="string" id="2141054">&#39;-&#39;</span><span class="op" id="2141057">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2141060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2141064">//&nbsp;integer,&nbsp;padded&nbsp;with&nbsp;zeros&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2141106">if</span>&nbsp;<span class="ident" id="2141109">d</span><span class="op" id="2141110">.</span><span class="ident" id="2141111">dp</span>&nbsp;<span class="op" id="2141114">&gt;</span>&nbsp;<span class="num" id="2141116">0</span>&nbsp;<span class="op" id="2141118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2141122">var</span>&nbsp;<span class="ident" id="2141126">i</span>&nbsp;<span class="builtintype" id="2141128">int</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2141134">for</span>&nbsp;<span class="ident" id="2141138">i</span>&nbsp;<span class="op" id="2141140">=</span>&nbsp;<span class="num" id="2141142">0</span><span class="op" id="2141143">;</span>&nbsp;<span class="ident" id="2141145">i</span>&nbsp;<span class="op" id="2141147">&lt;</span>&nbsp;<span class="ident" id="2141149">d</span><span class="op" id="2141150">.</span><span class="ident" id="2141151">dp</span>&nbsp;<span class="op" id="2141154">&amp;&amp;</span>&nbsp;<span class="ident" id="2141157">i</span>&nbsp;<span class="op" id="2141159">&lt;</span>&nbsp;<span class="ident" id="2141161">d</span><span class="op" id="2141162">.</span><span class="ident" id="2141163">nd</span><span class="op" id="2141165">;</span>&nbsp;<span class="ident" id="2141167">i</span><span class="op" id="2141168">++</span>&nbsp;<span class="op" id="2141171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141176">dst</span>&nbsp;<span class="op" id="2141180">=</span>&nbsp;<span class="builtinfunc" id="2141182">append</span><span class="op" id="2141188">(</span><span class="ident" id="2141189">dst</span><span class="op" id="2141192">,</span>&nbsp;<span class="ident" id="2141194">d</span><span class="op" id="2141195">.</span><span class="ident" id="2141196">d</span><span class="op" id="2141197">[</span><span class="ident" id="2141198">i</span><span class="op" id="2141199">]</span><span class="op" id="2141200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2141204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2141208">for</span>&nbsp;<span class="op" id="2141212">;</span>&nbsp;<span class="ident" id="2141214">i</span>&nbsp;<span class="op" id="2141216">&lt;</span>&nbsp;<span class="ident" id="2141218">d</span><span class="op" id="2141219">.</span><span class="ident" id="2141220">dp</span><span class="op" id="2141222">;</span>&nbsp;<span class="ident" id="2141224">i</span><span class="op" id="2141225">++</span>&nbsp;<span class="op" id="2141228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141233">dst</span>&nbsp;<span class="op" id="2141237">=</span>&nbsp;<span class="builtinfunc" id="2141239">append</span><span class="op" id="2141245">(</span><span class="ident" id="2141246">dst</span><span class="op" id="2141249">,</span>&nbsp;<span class="string" id="2141251">&#39;0&#39;</span><span class="op" id="2141254">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2141258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2141261">}</span>&nbsp;<span class="keyword" id="2141263">else</span>&nbsp;<span class="op" id="2141268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141272">dst</span>&nbsp;<span class="op" id="2141276">=</span>&nbsp;<span class="builtinfunc" id="2141278">append</span><span class="op" id="2141284">(</span><span class="ident" id="2141285">dst</span><span class="op" id="2141288">,</span>&nbsp;<span class="string" id="2141290">&#39;0&#39;</span><span class="op" id="2141293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2141296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2141300">//&nbsp;fraction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2141313">if</span>&nbsp;<span class="ident" id="2141316">prec</span>&nbsp;<span class="op" id="2141321">&gt;</span>&nbsp;<span class="num" id="2141323">0</span>&nbsp;<span class="op" id="2141325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141329">dst</span>&nbsp;<span class="op" id="2141333">=</span>&nbsp;<span class="builtinfunc" id="2141335">append</span><span class="op" id="2141341">(</span><span class="ident" id="2141342">dst</span><span class="op" id="2141345">,</span>&nbsp;<span class="string" id="2141347">&#39;.&#39;</span><span class="op" id="2141350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2141354">for</span>&nbsp;<span class="ident" id="2141358">i</span>&nbsp;<span class="op" id="2141360">:=</span>&nbsp;<span class="num" id="2141363">0</span><span class="op" id="2141364">;</span>&nbsp;<span class="ident" id="2141366">i</span>&nbsp;<span class="op" id="2141368">&lt;</span>&nbsp;<span class="ident" id="2141370">prec</span><span class="op" id="2141374">;</span>&nbsp;<span class="ident" id="2141376">i</span><span class="op" id="2141377">++</span>&nbsp;<span class="op" id="2141380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141385">ch</span>&nbsp;<span class="op" id="2141388">:=</span>&nbsp;<span class="builtintype" id="2141391">byte</span><span class="op" id="2141395">(</span><span class="string" id="2141396">&#39;0&#39;</span><span class="op" id="2141399">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2141404">if</span>&nbsp;<span class="ident" id="2141407">j</span>&nbsp;<span class="op" id="2141409">:=</span>&nbsp;<span class="ident" id="2141412">d</span><span class="op" id="2141413">.</span><span class="ident" id="2141414">dp</span>&nbsp;<span class="op" id="2141417">+</span>&nbsp;<span class="ident" id="2141419">i</span><span class="op" id="2141420">;</span>&nbsp;<span class="num" id="2141422">0</span>&nbsp;<span class="op" id="2141424">&lt;=</span>&nbsp;<span class="ident" id="2141427">j</span>&nbsp;<span class="op" id="2141429">&amp;&amp;</span>&nbsp;<span class="ident" id="2141432">j</span>&nbsp;<span class="op" id="2141434">&lt;</span>&nbsp;<span class="ident" id="2141436">d</span><span class="op" id="2141437">.</span><span class="ident" id="2141438">nd</span>&nbsp;<span class="op" id="2141441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141447">ch</span>&nbsp;<span class="op" id="2141450">=</span>&nbsp;<span class="ident" id="2141452">d</span><span class="op" id="2141453">.</span><span class="ident" id="2141454">d</span><span class="op" id="2141455">[</span><span class="ident" id="2141456">j</span><span class="op" id="2141457">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2141462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141467">dst</span>&nbsp;<span class="op" id="2141471">=</span>&nbsp;<span class="builtinfunc" id="2141473">append</span><span class="op" id="2141479">(</span><span class="ident" id="2141480">dst</span><span class="op" id="2141483">,</span>&nbsp;<span class="ident" id="2141485">ch</span><span class="op" id="2141487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2141491">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2141494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2141498">return</span>&nbsp;<span class="ident" id="2141505">dst</span><br>
<span class="lineno"></span><span class="op" id="2141509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="comment" id="2141512">//&nbsp;%b:&nbsp;-ddddddddp+ddd</span><br>
<span class="lineno"></span><span class="keyword" id="2141534">func</span>&nbsp;<span class="ident" id="2141539">fmtB</span><span class="op" id="2141543">(</span><span class="ident" id="2141544">dst</span>&nbsp;<span class="op" id="2141548">[</span><span class="op" id="2141549">]</span><span class="builtintype" id="2141550">byte</span><span class="op" id="2141554">,</span>&nbsp;<span class="ident" id="2141556">neg</span>&nbsp;<span class="builtintype" id="2141560">bool</span><span class="op" id="2141564">,</span>&nbsp;<span class="ident" id="2141566">mant</span>&nbsp;<span class="builtintype" id="2141571">uint64</span><span class="op" id="2141577">,</span>&nbsp;<span class="ident" id="2141579">exp</span>&nbsp;<span class="builtintype" id="2141583">int</span><span class="op" id="2141586">,</span>&nbsp;<span class="ident" id="2141588">flt</span>&nbsp;<span class="op" id="2141592">*</span><span class="ident" id="2141593">floatInfo</span><span class="op" id="2141602">)</span>&nbsp;<span class="op" id="2141604">[</span><span class="op" id="2141605">]</span><span class="builtintype" id="2141606">byte</span>&nbsp;<span class="op" id="2141611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2141614">var</span>&nbsp;<span class="ident" id="2141618">buf</span>&nbsp;<span class="op" id="2141622">[</span><span class="num" id="2141623">50</span><span class="op" id="2141625">]</span><span class="builtintype" id="2141626">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141632">w</span>&nbsp;<span class="op" id="2141634">:=</span>&nbsp;<span class="builtinfunc" id="2141637">len</span><span class="op" id="2141640">(</span><span class="ident" id="2141641">buf</span><span class="op" id="2141644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141647">exp</span>&nbsp;<span class="op" id="2141651">-=</span>&nbsp;<span class="builtintype" id="2141654">int</span><span class="op" id="2141657">(</span><span class="ident" id="2141658">flt</span><span class="op" id="2141661">.</span><span class="ident" id="2141662">mantbits</span><span class="op" id="2141670">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141673">esign</span>&nbsp;<span class="op" id="2141679">:=</span>&nbsp;<span class="builtintype" id="2141682">byte</span><span class="op" id="2141686">(</span><span class="string" id="2141687">&#39;+&#39;</span><span class="op" id="2141690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2141693">if</span>&nbsp;<span class="ident" id="2141696">exp</span>&nbsp;<span class="op" id="2141700">&lt;</span>&nbsp;<span class="num" id="2141702">0</span>&nbsp;<span class="op" id="2141704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141708">esign</span>&nbsp;<span class="op" id="2141714">=</span>&nbsp;<span class="string" id="2141716">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141722">exp</span>&nbsp;<span class="op" id="2141726">=</span>&nbsp;<span class="op" id="2141728">-</span><span class="ident" id="2141729">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2141734">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141737">n</span>&nbsp;<span class="op" id="2141739">:=</span>&nbsp;<span class="num" id="2141742">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2141745">for</span>&nbsp;<span class="ident" id="2141749">exp</span>&nbsp;<span class="op" id="2141753">&gt;</span>&nbsp;<span class="num" id="2141755">0</span>&nbsp;<span class="op" id="2141757">||</span>&nbsp;<span class="ident" id="2141760">n</span>&nbsp;<span class="op" id="2141762">&lt;</span>&nbsp;<span class="num" id="2141764">1</span>&nbsp;<span class="op" id="2141766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141770">n</span><span class="op" id="2141771">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141776">w</span><span class="op" id="2141777">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141782">buf</span><span class="op" id="2141785">[</span><span class="ident" id="2141786">w</span><span class="op" id="2141787">]</span>&nbsp;<span class="op" id="2141789">=</span>&nbsp;<span class="builtintype" id="2141791">byte</span><span class="op" id="2141795">(</span><span class="ident" id="2141796">exp</span><span class="op" id="2141799">%</span><span class="num" id="2141800">10</span>&nbsp;<span class="op" id="2141803">+</span>&nbsp;<span class="string" id="2141805">&#39;0&#39;</span><span class="op" id="2141808">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141812">exp</span>&nbsp;<span class="op" id="2141816">/=</span>&nbsp;<span class="num" id="2141819">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2141823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141826">w</span><span class="op" id="2141827">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141831">buf</span><span class="op" id="2141834">[</span><span class="ident" id="2141835">w</span><span class="op" id="2141836">]</span>&nbsp;<span class="op" id="2141838">=</span>&nbsp;<span class="ident" id="2141840">esign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141847">w</span><span class="op" id="2141848">--</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141852">buf</span><span class="op" id="2141855">[</span><span class="ident" id="2141856">w</span><span class="op" id="2141857">]</span>&nbsp;<span class="op" id="2141859">=</span>&nbsp;<span class="string" id="2141861">&#39;p&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141866">n</span>&nbsp;<span class="op" id="2141868">=</span>&nbsp;<span class="num" id="2141870">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2141873">for</span>&nbsp;<span class="ident" id="2141877">mant</span>&nbsp;<span class="op" id="2141882">&gt;</span>&nbsp;<span class="num" id="2141884">0</span>&nbsp;<span class="op" id="2141886">||</span>&nbsp;<span class="ident" id="2141889">n</span>&nbsp;<span class="op" id="2141891">&lt;</span>&nbsp;<span class="num" id="2141893">1</span>&nbsp;<span class="op" id="2141895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141899">n</span><span class="op" id="2141900">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141905">w</span><span class="op" id="2141906">--</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141911">buf</span><span class="op" id="2141914">[</span><span class="ident" id="2141915">w</span><span class="op" id="2141916">]</span>&nbsp;<span class="op" id="2141918">=</span>&nbsp;<span class="builtintype" id="2141920">byte</span><span class="op" id="2141924">(</span><span class="ident" id="2141925">mant</span><span class="op" id="2141929">%</span><span class="num" id="2141930">10</span>&nbsp;<span class="op" id="2141933">+</span>&nbsp;<span class="string" id="2141935">&#39;0&#39;</span><span class="op" id="2141938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141942">mant</span>&nbsp;<span class="op" id="2141947">/=</span>&nbsp;<span class="num" id="2141950">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2141954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2141957">if</span>&nbsp;<span class="ident" id="2141960">neg</span>&nbsp;<span class="op" id="2141964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141968">w</span><span class="op" id="2141969">--</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2141974">buf</span><span class="op" id="2141977">[</span><span class="ident" id="2141978">w</span><span class="op" id="2141979">]</span>&nbsp;<span class="op" id="2141981">=</span>&nbsp;<span class="string" id="2141983">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2141988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2141991">return</span>&nbsp;<span class="builtinfunc" id="2141998">append</span><span class="op" id="2142004">(</span><span class="ident" id="2142005">dst</span><span class="op" id="2142008">,</span>&nbsp;<span class="ident" id="2142010">buf</span><span class="op" id="2142013">[</span><span class="ident" id="2142014">w</span><span class="op" id="2142015">:</span><span class="op" id="2142016">]</span><span class="op" id="2142017">...</span><span class="op" id="2142020">)</span><br>
<span class="lineno"></span><span class="op" id="2142022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="keyword" id="2142025">func</span>&nbsp;<span class="ident" id="2142030">max</span><span class="op" id="2142033">(</span><span class="ident" id="2142034">a</span><span class="op" id="2142035">,</span>&nbsp;<span class="ident" id="2142037">b</span>&nbsp;<span class="builtintype" id="2142039">int</span><span class="op" id="2142042">)</span>&nbsp;<span class="builtintype" id="2142044">int</span>&nbsp;<span class="op" id="2142048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2142051">if</span>&nbsp;<span class="ident" id="2142054">a</span>&nbsp;<span class="op" id="2142056">&gt;</span>&nbsp;<span class="ident" id="2142058">b</span>&nbsp;<span class="op" id="2142060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2142064">return</span>&nbsp;<span class="ident" id="2142071">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2142074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2142077">return</span>&nbsp;<span class="ident" id="2142084">b</span><br>
<span class="lineno">475</span><span class="op" id="2142086">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
