<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html" class="current">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6056296">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6056351">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6056405">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6056456">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;host&nbsp;side&nbsp;of&nbsp;CGI&nbsp;(being&nbsp;the&nbsp;webserver</span><br>
<span class="lineno"></span><span class="comment" id="6056522">//&nbsp;parent&nbsp;process).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6056543">//&nbsp;Package&nbsp;cgi&nbsp;implements&nbsp;CGI&nbsp;(Common&nbsp;Gateway&nbsp;Interface)&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="6056613">//&nbsp;in&nbsp;RFC&nbsp;3875.</span><br>
<span class="lineno">10</span><span class="comment" id="6056629">//</span><br>
<span class="lineno"></span><span class="comment" id="6056632">//&nbsp;Note&nbsp;that&nbsp;using&nbsp;CGI&nbsp;means&nbsp;starting&nbsp;a&nbsp;new&nbsp;process&nbsp;to&nbsp;handle&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="6056699">//&nbsp;request,&nbsp;which&nbsp;is&nbsp;typically&nbsp;less&nbsp;efficient&nbsp;than&nbsp;using&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6056758">//&nbsp;long-running&nbsp;server.&nbsp;&nbsp;This&nbsp;package&nbsp;is&nbsp;intended&nbsp;primarily&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6056822">//&nbsp;compatibility&nbsp;with&nbsp;existing&nbsp;systems.</span><br>
<span class="lineno">15</span><span class="keyword" id="6056862">package</span>&nbsp;<span class="ident" id="6056870">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6056875">import</span>&nbsp;<span class="op" id="6056882">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6056885">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6056894">&#34;fmt&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6056901">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6056907">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6056914">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6056926">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6056932">&#34;os/exec&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6056943">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6056960">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6056970">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6056981">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6056992">&#34;strings&#34;</span><br>
<span class="lineno">30</span><span class="op" id="6057002">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6057005">var</span>&nbsp;<span class="ident" id="6057009">trailingPort</span>&nbsp;<span class="op" id="6057022">=</span>&nbsp;<span class="ident" id="6057024">regexp</span><span class="op" id="6057030">.</span><span class="ident" id="6057031">MustCompile</span><span class="op" id="6057042">(</span><span class="string" id="6057043">`:([0-9]+)$`</span><span class="op" id="6057055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6057058">var</span>&nbsp;<span class="ident" id="6057062">osDefaultInheritEnv</span>&nbsp;<span class="op" id="6057082">=</span>&nbsp;<span class="keyword" id="6057084">map</span><span class="op" id="6057087">[</span><span class="builtintype" id="6057088">string</span><span class="op" id="6057094">]</span><span class="op" id="6057095">[</span><span class="op" id="6057096">]</span><span class="builtintype" id="6057097">string</span><span class="op" id="6057103">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6057106">&#34;darwin&#34;</span><span class="op" id="6057114">:</span>&nbsp;&nbsp;<span class="op" id="6057117">{</span><span class="string" id="6057118">&#34;DYLD_LIBRARY_PATH&#34;</span><span class="op" id="6057137">}</span><span class="op" id="6057138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6057141">&#34;freebsd&#34;</span><span class="op" id="6057150">:</span>&nbsp;<span class="op" id="6057152">{</span><span class="string" id="6057153">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6057170">}</span><span class="op" id="6057171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6057174">&#34;hpux&#34;</span><span class="op" id="6057180">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6057185">{</span><span class="string" id="6057186">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6057203">,</span>&nbsp;<span class="string" id="6057205">&#34;SHLIB_PATH&#34;</span><span class="op" id="6057217">}</span><span class="op" id="6057218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6057221">&#34;irix&#34;</span><span class="op" id="6057227">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6057232">{</span><span class="string" id="6057233">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6057250">,</span>&nbsp;<span class="string" id="6057252">&#34;LD_LIBRARYN32_PATH&#34;</span><span class="op" id="6057272">,</span>&nbsp;<span class="string" id="6057274">&#34;LD_LIBRARY64_PATH&#34;</span><span class="op" id="6057293">}</span><span class="op" id="6057294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6057297">&#34;linux&#34;</span><span class="op" id="6057304">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6057308">{</span><span class="string" id="6057309">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6057326">}</span><span class="op" id="6057327">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6057330">&#34;openbsd&#34;</span><span class="op" id="6057339">:</span>&nbsp;<span class="op" id="6057341">{</span><span class="string" id="6057342">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6057359">}</span><span class="op" id="6057360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6057363">&#34;solaris&#34;</span><span class="op" id="6057372">:</span>&nbsp;<span class="op" id="6057374">{</span><span class="string" id="6057375">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="6057392">,</span>&nbsp;<span class="string" id="6057394">&#34;LD_LIBRARY_PATH_32&#34;</span><span class="op" id="6057414">,</span>&nbsp;<span class="string" id="6057416">&#34;LD_LIBRARY_PATH_64&#34;</span><span class="op" id="6057436">}</span><span class="op" id="6057437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6057440">&#34;windows&#34;</span><span class="op" id="6057449">:</span>&nbsp;<span class="op" id="6057451">{</span><span class="string" id="6057452">&#34;SystemRoot&#34;</span><span class="op" id="6057464">,</span>&nbsp;<span class="string" id="6057466">&#34;COMSPEC&#34;</span><span class="op" id="6057475">,</span>&nbsp;<span class="string" id="6057477">&#34;PATHEXT&#34;</span><span class="op" id="6057486">,</span>&nbsp;<span class="string" id="6057488">&#34;WINDIR&#34;</span><span class="op" id="6057496">}</span><span class="op" id="6057497">,</span><br>
<span class="lineno"></span><span class="op" id="6057499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="6057502">//&nbsp;Handler&nbsp;runs&nbsp;an&nbsp;executable&nbsp;in&nbsp;a&nbsp;subprocess&nbsp;with&nbsp;a&nbsp;CGI&nbsp;environment.</span><br>
<span class="lineno"></span><span class="keyword" id="6057572">type</span>&nbsp;<span class="ident" id="6057577">Handler</span>&nbsp;<span class="keyword" id="6057585">struct</span>&nbsp;<span class="op" id="6057592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057595">Path</span>&nbsp;<span class="builtintype" id="6057600">string</span>&nbsp;<span class="comment" id="6057607">//&nbsp;path&nbsp;to&nbsp;the&nbsp;CGI&nbsp;executable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057638">Root</span>&nbsp;<span class="builtintype" id="6057643">string</span>&nbsp;<span class="comment" id="6057650">//&nbsp;root&nbsp;URI&nbsp;prefix&nbsp;of&nbsp;handler&nbsp;or&nbsp;empty&nbsp;for&nbsp;&#34;/&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6057699">//&nbsp;Dir&nbsp;specifies&nbsp;the&nbsp;CGI&nbsp;executable&#39;s&nbsp;working&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6057757">//&nbsp;If&nbsp;Dir&nbsp;is&nbsp;empty,&nbsp;the&nbsp;base&nbsp;directory&nbsp;of&nbsp;Path&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6057814">//&nbsp;If&nbsp;Path&nbsp;has&nbsp;no&nbsp;base&nbsp;directory,&nbsp;the&nbsp;current&nbsp;working</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6057869">//&nbsp;directory&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057892">Dir</span>&nbsp;<span class="builtintype" id="6057896">string</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057905">Env</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6057916">[</span><span class="op" id="6057917">]</span><span class="builtintype" id="6057918">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6057928">//&nbsp;extra&nbsp;environment&nbsp;variables&nbsp;to&nbsp;set,&nbsp;if&nbsp;any,&nbsp;as&nbsp;&#34;key=value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057991">InheritEnv</span>&nbsp;<span class="op" id="6058002">[</span><span class="op" id="6058003">]</span><span class="builtintype" id="6058004">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6058014">//&nbsp;environment&nbsp;variables&nbsp;to&nbsp;inherit&nbsp;from&nbsp;host,&nbsp;as&nbsp;&#34;key&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058071">Logger</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6058082">*</span><span class="ident" id="6058083">log</span><span class="op" id="6058086">.</span><span class="ident" id="6058087">Logger</span>&nbsp;<span class="comment" id="6058094">//&nbsp;optional&nbsp;log&nbsp;for&nbsp;errors&nbsp;or&nbsp;nil&nbsp;to&nbsp;use&nbsp;log.Print</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058146">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6058157">[</span><span class="op" id="6058158">]</span><span class="builtintype" id="6058159">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6058169">//&nbsp;optional&nbsp;arguments&nbsp;to&nbsp;pass&nbsp;to&nbsp;child&nbsp;process</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6058218">//&nbsp;PathLocationHandler&nbsp;specifies&nbsp;the&nbsp;root&nbsp;http&nbsp;Handler&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6058279">//&nbsp;should&nbsp;handle&nbsp;internal&nbsp;redirects&nbsp;when&nbsp;the&nbsp;CGI&nbsp;process</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6058337">//&nbsp;returns&nbsp;a&nbsp;Location&nbsp;header&nbsp;value&nbsp;starting&nbsp;with&nbsp;a&nbsp;&#34;/&#34;,&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6058397">//&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;3875&nbsp;§&nbsp;6.3.2.&nbsp;This&nbsp;will&nbsp;likely&nbsp;be</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6058453">//&nbsp;http.DefaultServeMux.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6058479">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6058483">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;CGI&nbsp;response&nbsp;with&nbsp;a&nbsp;local&nbsp;URI&nbsp;path&nbsp;is&nbsp;instead&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6058548">//&nbsp;back&nbsp;to&nbsp;the&nbsp;client&nbsp;and&nbsp;not&nbsp;redirected&nbsp;internally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058602">PathLocationHandler</span>&nbsp;<span class="ident" id="6058622">http</span><span class="op" id="6058626">.</span><span class="ident" id="6058627">Handler</span><br>
<span class="lineno">70</span><span class="op" id="6058635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6058638">//&nbsp;removeLeadingDuplicates&nbsp;remove&nbsp;leading&nbsp;duplicate&nbsp;in&nbsp;environments.</span><br>
<span class="lineno"></span><span class="comment" id="6058707">//&nbsp;It&#39;s&nbsp;possible&nbsp;to&nbsp;override&nbsp;environment&nbsp;like&nbsp;following.</span><br>
<span class="lineno"></span><span class="comment" id="6058764">//&nbsp;&nbsp;&nbsp;&nbsp;cgi.Handler{</span><br>
<span class="lineno">75</span><span class="comment" id="6058783">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="6058795">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Env:&nbsp;[]string{&#34;SCRIPT_FILENAME=foo.php&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="6058845">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="keyword" id="6058853">func</span>&nbsp;<span class="ident" id="6058858">removeLeadingDuplicates</span><span class="op" id="6058881">(</span><span class="ident" id="6058882">env</span>&nbsp;<span class="op" id="6058886">[</span><span class="op" id="6058887">]</span><span class="builtintype" id="6058888">string</span><span class="op" id="6058894">)</span>&nbsp;<span class="op" id="6058896">(</span><span class="ident" id="6058897">ret</span>&nbsp;<span class="op" id="6058901">[</span><span class="op" id="6058902">]</span><span class="builtintype" id="6058903">string</span><span class="op" id="6058909">)</span>&nbsp;<span class="op" id="6058911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058914">n</span>&nbsp;<span class="op" id="6058916">:=</span>&nbsp;<span class="builtinfunc" id="6058919">len</span><span class="op" id="6058922">(</span><span class="ident" id="6058923">env</span><span class="op" id="6058926">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6058929">for</span>&nbsp;<span class="ident" id="6058933">i</span>&nbsp;<span class="op" id="6058935">:=</span>&nbsp;<span class="num" id="6058938">0</span><span class="op" id="6058939">;</span>&nbsp;<span class="ident" id="6058941">i</span>&nbsp;<span class="op" id="6058943">&lt;</span>&nbsp;<span class="ident" id="6058945">n</span><span class="op" id="6058946">;</span>&nbsp;<span class="ident" id="6058948">i</span><span class="op" id="6058949">++</span>&nbsp;<span class="op" id="6058952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058956">e</span>&nbsp;<span class="op" id="6058958">:=</span>&nbsp;<span class="ident" id="6058961">env</span><span class="op" id="6058964">[</span><span class="ident" id="6058965">i</span><span class="op" id="6058966">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058970">s</span>&nbsp;<span class="op" id="6058972">:=</span>&nbsp;<span class="ident" id="6058975">strings</span><span class="op" id="6058982">.</span><span class="ident" id="6058983">SplitN</span><span class="op" id="6058989">(</span><span class="ident" id="6058990">e</span><span class="op" id="6058991">,</span>&nbsp;<span class="string" id="6058993">&#34;=&#34;</span><span class="op" id="6058996">,</span>&nbsp;<span class="num" id="6058998">2</span><span class="op" id="6058999">)</span><span class="op" id="6059000">[</span><span class="num" id="6059001">0</span><span class="op" id="6059002">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059006">found</span>&nbsp;<span class="op" id="6059012">:=</span>&nbsp;<span class="builtintype" id="6059015">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059023">for</span>&nbsp;<span class="ident" id="6059027">j</span>&nbsp;<span class="op" id="6059029">:=</span>&nbsp;<span class="ident" id="6059032">i</span>&nbsp;<span class="op" id="6059034">+</span>&nbsp;<span class="num" id="6059036">1</span><span class="op" id="6059037">;</span>&nbsp;<span class="ident" id="6059039">j</span>&nbsp;<span class="op" id="6059041">&lt;</span>&nbsp;<span class="ident" id="6059043">n</span><span class="op" id="6059044">;</span>&nbsp;<span class="ident" id="6059046">j</span><span class="op" id="6059047">++</span>&nbsp;<span class="op" id="6059050">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059055">if</span>&nbsp;<span class="ident" id="6059058">s</span>&nbsp;<span class="op" id="6059060">==</span>&nbsp;<span class="ident" id="6059063">strings</span><span class="op" id="6059070">.</span><span class="ident" id="6059071">SplitN</span><span class="op" id="6059077">(</span><span class="ident" id="6059078">env</span><span class="op" id="6059081">[</span><span class="ident" id="6059082">j</span><span class="op" id="6059083">]</span><span class="op" id="6059084">,</span>&nbsp;<span class="string" id="6059086">&#34;=&#34;</span><span class="op" id="6059089">,</span>&nbsp;<span class="num" id="6059091">2</span><span class="op" id="6059092">)</span><span class="op" id="6059093">[</span><span class="num" id="6059094">0</span><span class="op" id="6059095">]</span>&nbsp;<span class="op" id="6059097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059103">found</span>&nbsp;<span class="op" id="6059109">=</span>&nbsp;<span class="builtintype" id="6059111">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059120">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6059129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6059133">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059137">if</span>&nbsp;<span class="op" id="6059140">!</span><span class="ident" id="6059141">found</span>&nbsp;<span class="op" id="6059147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059152">ret</span>&nbsp;<span class="op" id="6059156">=</span>&nbsp;<span class="builtinfunc" id="6059158">append</span><span class="op" id="6059164">(</span><span class="ident" id="6059165">ret</span><span class="op" id="6059168">,</span>&nbsp;<span class="ident" id="6059170">e</span><span class="op" id="6059171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6059175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6059178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059181">return</span><br>
<span class="lineno">95</span><span class="op" id="6059188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6059191">func</span>&nbsp;<span class="op" id="6059196">(</span><span class="ident" id="6059197">h</span>&nbsp;<span class="op" id="6059199">*</span><span class="ident" id="6059200">Handler</span><span class="op" id="6059207">)</span>&nbsp;<span class="ident" id="6059209">ServeHTTP</span><span class="op" id="6059218">(</span><span class="ident" id="6059219">rw</span>&nbsp;<span class="ident" id="6059222">http</span><span class="op" id="6059226">.</span><span class="ident" id="6059227">ResponseWriter</span><span class="op" id="6059241">,</span>&nbsp;<span class="ident" id="6059243">req</span>&nbsp;<span class="op" id="6059247">*</span><span class="ident" id="6059248">http</span><span class="op" id="6059252">.</span><span class="ident" id="6059253">Request</span><span class="op" id="6059260">)</span>&nbsp;<span class="op" id="6059262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059265">root</span>&nbsp;<span class="op" id="6059270">:=</span>&nbsp;<span class="ident" id="6059273">h</span><span class="op" id="6059274">.</span><span class="ident" id="6059275">Root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059281">if</span>&nbsp;<span class="ident" id="6059284">root</span>&nbsp;<span class="op" id="6059289">==</span>&nbsp;<span class="string" id="6059292">&#34;&#34;</span>&nbsp;<span class="op" id="6059295">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059299">root</span>&nbsp;<span class="op" id="6059304">=</span>&nbsp;<span class="string" id="6059306">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6059311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059315">if</span>&nbsp;<span class="builtinfunc" id="6059318">len</span><span class="op" id="6059321">(</span><span class="ident" id="6059322">req</span><span class="op" id="6059325">.</span><span class="ident" id="6059326">TransferEncoding</span><span class="op" id="6059342">)</span>&nbsp;<span class="op" id="6059344">&gt;</span>&nbsp;<span class="num" id="6059346">0</span>&nbsp;<span class="op" id="6059348">&amp;&amp;</span>&nbsp;<span class="ident" id="6059351">req</span><span class="op" id="6059354">.</span><span class="ident" id="6059355">TransferEncoding</span><span class="op" id="6059371">[</span><span class="num" id="6059372">0</span><span class="op" id="6059373">]</span>&nbsp;<span class="op" id="6059375">==</span>&nbsp;<span class="string" id="6059378">&#34;chunked&#34;</span>&nbsp;<span class="op" id="6059388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059392">rw</span><span class="op" id="6059394">.</span><span class="ident" id="6059395">WriteHeader</span><span class="op" id="6059406">(</span><span class="ident" id="6059407">http</span><span class="op" id="6059411">.</span><span class="ident" id="6059412">StatusBadRequest</span><span class="op" id="6059428">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059432">rw</span><span class="op" id="6059434">.</span><span class="ident" id="6059435">Write</span><span class="op" id="6059440">(</span><span class="op" id="6059441">[</span><span class="op" id="6059442">]</span><span class="builtintype" id="6059443">byte</span><span class="op" id="6059447">(</span><span class="string" id="6059448">&#34;Chunked&nbsp;request&nbsp;bodies&nbsp;are&nbsp;not&nbsp;supported&nbsp;by&nbsp;CGI.&#34;</span><span class="op" id="6059498">)</span><span class="op" id="6059499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059503">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6059511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059515">pathInfo</span>&nbsp;<span class="op" id="6059524">:=</span>&nbsp;<span class="ident" id="6059527">req</span><span class="op" id="6059530">.</span><span class="ident" id="6059531">URL</span><span class="op" id="6059534">.</span><span class="ident" id="6059535">Path</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059541">if</span>&nbsp;<span class="ident" id="6059544">root</span>&nbsp;<span class="op" id="6059549">!=</span>&nbsp;<span class="string" id="6059552">&#34;/&#34;</span>&nbsp;<span class="op" id="6059556">&amp;&amp;</span>&nbsp;<span class="ident" id="6059559">strings</span><span class="op" id="6059566">.</span><span class="ident" id="6059567">HasPrefix</span><span class="op" id="6059576">(</span><span class="ident" id="6059577">pathInfo</span><span class="op" id="6059585">,</span>&nbsp;<span class="ident" id="6059587">root</span><span class="op" id="6059591">)</span>&nbsp;<span class="op" id="6059593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059597">pathInfo</span>&nbsp;<span class="op" id="6059606">=</span>&nbsp;<span class="ident" id="6059608">pathInfo</span><span class="op" id="6059616">[</span><span class="builtinfunc" id="6059617">len</span><span class="op" id="6059620">(</span><span class="ident" id="6059621">root</span><span class="op" id="6059625">)</span><span class="op" id="6059626">:</span><span class="op" id="6059627">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6059630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059634">port</span>&nbsp;<span class="op" id="6059639">:=</span>&nbsp;<span class="string" id="6059642">&#34;80&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059648">if</span>&nbsp;<span class="ident" id="6059651">matches</span>&nbsp;<span class="op" id="6059659">:=</span>&nbsp;<span class="ident" id="6059662">trailingPort</span><span class="op" id="6059674">.</span><span class="ident" id="6059675">FindStringSubmatch</span><span class="op" id="6059693">(</span><span class="ident" id="6059694">req</span><span class="op" id="6059697">.</span><span class="ident" id="6059698">Host</span><span class="op" id="6059702">)</span><span class="op" id="6059703">;</span>&nbsp;<span class="builtinfunc" id="6059705">len</span><span class="op" id="6059708">(</span><span class="ident" id="6059709">matches</span><span class="op" id="6059716">)</span>&nbsp;<span class="op" id="6059718">!=</span>&nbsp;<span class="num" id="6059721">0</span>&nbsp;<span class="op" id="6059723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059727">port</span>&nbsp;<span class="op" id="6059732">=</span>&nbsp;<span class="ident" id="6059734">matches</span><span class="op" id="6059741">[</span><span class="num" id="6059742">1</span><span class="op" id="6059743">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6059746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6059750">env</span>&nbsp;<span class="op" id="6059754">:=</span>&nbsp;<span class="op" id="6059757">[</span><span class="op" id="6059758">]</span><span class="builtintype" id="6059759">string</span><span class="op" id="6059765">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6059769">&#34;SERVER_SOFTWARE=go&#34;</span><span class="op" id="6059789">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6059793">&#34;SERVER_NAME=&#34;</span>&nbsp;<span class="op" id="6059808">+</span>&nbsp;<span class="ident" id="6059810">req</span><span class="op" id="6059813">.</span><span class="ident" id="6059814">Host</span><span class="op" id="6059818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6059822">&#34;SERVER_PROTOCOL=HTTP/1.1&#34;</span><span class="op" id="6059848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6059852">&#34;HTTP_HOST=&#34;</span>&nbsp;<span class="op" id="6059865">+</span>&nbsp;<span class="ident" id="6059867">req</span><span class="op" id="6059870">.</span><span class="ident" id="6059871">Host</span><span class="op" id="6059875">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6059879">&#34;GATEWAY_INTERFACE=CGI/1.1&#34;</span><span class="op" id="6059906">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6059910">&#34;REQUEST_METHOD=&#34;</span>&nbsp;<span class="op" id="6059928">+</span>&nbsp;<span class="ident" id="6059930">req</span><span class="op" id="6059933">.</span><span class="ident" id="6059934">Method</span><span class="op" id="6059940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6059944">&#34;QUERY_STRING=&#34;</span>&nbsp;<span class="op" id="6059960">+</span>&nbsp;<span class="ident" id="6059962">req</span><span class="op" id="6059965">.</span><span class="ident" id="6059966">URL</span><span class="op" id="6059969">.</span><span class="ident" id="6059970">RawQuery</span><span class="op" id="6059978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6059982">&#34;REQUEST_URI=&#34;</span>&nbsp;<span class="op" id="6059997">+</span>&nbsp;<span class="ident" id="6059999">req</span><span class="op" id="6060002">.</span><span class="ident" id="6060003">URL</span><span class="op" id="6060006">.</span><span class="ident" id="6060007">RequestURI</span><span class="op" id="6060017">(</span><span class="op" id="6060018">)</span><span class="op" id="6060019">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6060023">&#34;PATH_INFO=&#34;</span>&nbsp;<span class="op" id="6060036">+</span>&nbsp;<span class="ident" id="6060038">pathInfo</span><span class="op" id="6060046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6060050">&#34;SCRIPT_NAME=&#34;</span>&nbsp;<span class="op" id="6060065">+</span>&nbsp;<span class="ident" id="6060067">root</span><span class="op" id="6060071">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6060075">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="6060094">+</span>&nbsp;<span class="ident" id="6060096">h</span><span class="op" id="6060097">.</span><span class="ident" id="6060098">Path</span><span class="op" id="6060102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6060106">&#34;REMOTE_ADDR=&#34;</span>&nbsp;<span class="op" id="6060121">+</span>&nbsp;<span class="ident" id="6060123">req</span><span class="op" id="6060126">.</span><span class="ident" id="6060127">RemoteAddr</span><span class="op" id="6060137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6060141">&#34;REMOTE_HOST=&#34;</span>&nbsp;<span class="op" id="6060156">+</span>&nbsp;<span class="ident" id="6060158">req</span><span class="op" id="6060161">.</span><span class="ident" id="6060162">RemoteAddr</span><span class="op" id="6060172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6060176">&#34;SERVER_PORT=&#34;</span>&nbsp;<span class="op" id="6060191">+</span>&nbsp;<span class="ident" id="6060193">port</span><span class="op" id="6060197">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6060200">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6060204">if</span>&nbsp;<span class="ident" id="6060207">req</span><span class="op" id="6060210">.</span><span class="ident" id="6060211">TLS</span>&nbsp;<span class="op" id="6060215">!=</span>&nbsp;<span class="builtintype" id="6060218">nil</span>&nbsp;<span class="op" id="6060222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060226">env</span>&nbsp;<span class="op" id="6060230">=</span>&nbsp;<span class="builtinfunc" id="6060232">append</span><span class="op" id="6060238">(</span><span class="ident" id="6060239">env</span><span class="op" id="6060242">,</span>&nbsp;<span class="string" id="6060244">&#34;HTTPS=on&#34;</span><span class="op" id="6060254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6060257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6060261">for</span>&nbsp;<span class="ident" id="6060265">k</span><span class="op" id="6060266">,</span>&nbsp;<span class="ident" id="6060268">v</span>&nbsp;<span class="op" id="6060270">:=</span>&nbsp;<span class="keyword" id="6060273">range</span>&nbsp;<span class="ident" id="6060279">req</span><span class="op" id="6060282">.</span><span class="ident" id="6060283">Header</span>&nbsp;<span class="op" id="6060290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060294">k</span>&nbsp;<span class="op" id="6060296">=</span>&nbsp;<span class="ident" id="6060298">strings</span><span class="op" id="6060305">.</span><span class="ident" id="6060306">Map</span><span class="op" id="6060309">(</span><span class="ident" id="6060310">upperCaseAndUnderscore</span><span class="op" id="6060332">,</span>&nbsp;<span class="ident" id="6060334">k</span><span class="op" id="6060335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060339">joinStr</span>&nbsp;<span class="op" id="6060347">:=</span>&nbsp;<span class="string" id="6060350">&#34;,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6060357">if</span>&nbsp;<span class="ident" id="6060360">k</span>&nbsp;<span class="op" id="6060362">==</span>&nbsp;<span class="string" id="6060365">&#34;COOKIE&#34;</span>&nbsp;<span class="op" id="6060374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060379">joinStr</span>&nbsp;<span class="op" id="6060387">=</span>&nbsp;<span class="string" id="6060389">&#34;;&nbsp;&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6060396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060400">env</span>&nbsp;<span class="op" id="6060404">=</span>&nbsp;<span class="builtinfunc" id="6060406">append</span><span class="op" id="6060412">(</span><span class="ident" id="6060413">env</span><span class="op" id="6060416">,</span>&nbsp;<span class="string" id="6060418">&#34;HTTP_&#34;</span><span class="op" id="6060425">+</span><span class="ident" id="6060426">k</span><span class="op" id="6060427">+</span><span class="string" id="6060428">&#34;=&#34;</span><span class="op" id="6060431">+</span><span class="ident" id="6060432">strings</span><span class="op" id="6060439">.</span><span class="ident" id="6060440">Join</span><span class="op" id="6060444">(</span><span class="ident" id="6060445">v</span><span class="op" id="6060446">,</span>&nbsp;<span class="ident" id="6060448">joinStr</span><span class="op" id="6060455">)</span><span class="op" id="6060456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6060459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6060463">if</span>&nbsp;<span class="ident" id="6060466">req</span><span class="op" id="6060469">.</span><span class="ident" id="6060470">ContentLength</span>&nbsp;<span class="op" id="6060484">&gt;</span>&nbsp;<span class="num" id="6060486">0</span>&nbsp;<span class="op" id="6060488">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060492">env</span>&nbsp;<span class="op" id="6060496">=</span>&nbsp;<span class="builtinfunc" id="6060498">append</span><span class="op" id="6060504">(</span><span class="ident" id="6060505">env</span><span class="op" id="6060508">,</span>&nbsp;<span class="ident" id="6060510">fmt</span><span class="op" id="6060513">.</span><span class="ident" id="6060514">Sprintf</span><span class="op" id="6060521">(</span><span class="string" id="6060522">&#34;CONTENT_LENGTH=%d&#34;</span><span class="op" id="6060541">,</span>&nbsp;<span class="ident" id="6060543">req</span><span class="op" id="6060546">.</span><span class="ident" id="6060547">ContentLength</span><span class="op" id="6060560">)</span><span class="op" id="6060561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6060564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6060567">if</span>&nbsp;<span class="ident" id="6060570">ctype</span>&nbsp;<span class="op" id="6060576">:=</span>&nbsp;<span class="ident" id="6060579">req</span><span class="op" id="6060582">.</span><span class="ident" id="6060583">Header</span><span class="op" id="6060589">.</span><span class="ident" id="6060590">Get</span><span class="op" id="6060593">(</span><span class="string" id="6060594">&#34;Content-Type&#34;</span><span class="op" id="6060608">)</span><span class="op" id="6060609">;</span>&nbsp;<span class="ident" id="6060611">ctype</span>&nbsp;<span class="op" id="6060617">!=</span>&nbsp;<span class="string" id="6060620">&#34;&#34;</span>&nbsp;<span class="op" id="6060623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060627">env</span>&nbsp;<span class="op" id="6060631">=</span>&nbsp;<span class="builtinfunc" id="6060633">append</span><span class="op" id="6060639">(</span><span class="ident" id="6060640">env</span><span class="op" id="6060643">,</span>&nbsp;<span class="string" id="6060645">&#34;CONTENT_TYPE=&#34;</span><span class="op" id="6060660">+</span><span class="ident" id="6060661">ctype</span><span class="op" id="6060666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6060669">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6060673">if</span>&nbsp;<span class="ident" id="6060676">h</span><span class="op" id="6060677">.</span><span class="ident" id="6060678">Env</span>&nbsp;<span class="op" id="6060682">!=</span>&nbsp;<span class="builtintype" id="6060685">nil</span>&nbsp;<span class="op" id="6060689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060693">env</span>&nbsp;<span class="op" id="6060697">=</span>&nbsp;<span class="builtinfunc" id="6060699">append</span><span class="op" id="6060705">(</span><span class="ident" id="6060706">env</span><span class="op" id="6060709">,</span>&nbsp;<span class="ident" id="6060711">h</span><span class="op" id="6060712">.</span><span class="ident" id="6060713">Env</span><span class="op" id="6060716">...</span><span class="op" id="6060719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6060722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060726">envPath</span>&nbsp;<span class="op" id="6060734">:=</span>&nbsp;<span class="ident" id="6060737">os</span><span class="op" id="6060739">.</span><span class="ident" id="6060740">Getenv</span><span class="op" id="6060746">(</span><span class="string" id="6060747">&#34;PATH&#34;</span><span class="op" id="6060753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6060756">if</span>&nbsp;<span class="ident" id="6060759">envPath</span>&nbsp;<span class="op" id="6060767">==</span>&nbsp;<span class="string" id="6060770">&#34;&#34;</span>&nbsp;<span class="op" id="6060773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060777">envPath</span>&nbsp;<span class="op" id="6060785">=</span>&nbsp;<span class="string" id="6060787">&#34;/bin:/usr/bin:/usr/ucb:/usr/bsd:/usr/local/bin&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6060837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060840">env</span>&nbsp;<span class="op" id="6060844">=</span>&nbsp;<span class="builtinfunc" id="6060846">append</span><span class="op" id="6060852">(</span><span class="ident" id="6060853">env</span><span class="op" id="6060856">,</span>&nbsp;<span class="string" id="6060858">&#34;PATH=&#34;</span><span class="op" id="6060865">+</span><span class="ident" id="6060866">envPath</span><span class="op" id="6060873">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6060877">for</span>&nbsp;<span class="ident" id="6060881">_</span><span class="op" id="6060882">,</span>&nbsp;<span class="ident" id="6060884">e</span>&nbsp;<span class="op" id="6060886">:=</span>&nbsp;<span class="keyword" id="6060889">range</span>&nbsp;<span class="ident" id="6060895">h</span><span class="op" id="6060896">.</span><span class="ident" id="6060897">InheritEnv</span>&nbsp;<span class="op" id="6060908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6060912">if</span>&nbsp;<span class="ident" id="6060915">v</span>&nbsp;<span class="op" id="6060917">:=</span>&nbsp;<span class="ident" id="6060920">os</span><span class="op" id="6060922">.</span><span class="ident" id="6060923">Getenv</span><span class="op" id="6060929">(</span><span class="ident" id="6060930">e</span><span class="op" id="6060931">)</span><span class="op" id="6060932">;</span>&nbsp;<span class="ident" id="6060934">v</span>&nbsp;<span class="op" id="6060936">!=</span>&nbsp;<span class="string" id="6060939">&#34;&#34;</span>&nbsp;<span class="op" id="6060942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6060947">env</span>&nbsp;<span class="op" id="6060951">=</span>&nbsp;<span class="builtinfunc" id="6060953">append</span><span class="op" id="6060959">(</span><span class="ident" id="6060960">env</span><span class="op" id="6060963">,</span>&nbsp;<span class="ident" id="6060965">e</span><span class="op" id="6060966">+</span><span class="string" id="6060967">&#34;=&#34;</span><span class="op" id="6060970">+</span><span class="ident" id="6060971">v</span><span class="op" id="6060972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6060976">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6060979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6060983">for</span>&nbsp;<span class="ident" id="6060987">_</span><span class="op" id="6060988">,</span>&nbsp;<span class="ident" id="6060990">e</span>&nbsp;<span class="op" id="6060992">:=</span>&nbsp;<span class="keyword" id="6060995">range</span>&nbsp;<span class="ident" id="6061001">osDefaultInheritEnv</span><span class="op" id="6061020">[</span><span class="ident" id="6061021">runtime</span><span class="op" id="6061028">.</span><span class="ident" id="6061029">GOOS</span><span class="op" id="6061033">]</span>&nbsp;<span class="op" id="6061035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6061039">if</span>&nbsp;<span class="ident" id="6061042">v</span>&nbsp;<span class="op" id="6061044">:=</span>&nbsp;<span class="ident" id="6061047">os</span><span class="op" id="6061049">.</span><span class="ident" id="6061050">Getenv</span><span class="op" id="6061056">(</span><span class="ident" id="6061057">e</span><span class="op" id="6061058">)</span><span class="op" id="6061059">;</span>&nbsp;<span class="ident" id="6061061">v</span>&nbsp;<span class="op" id="6061063">!=</span>&nbsp;<span class="string" id="6061066">&#34;&#34;</span>&nbsp;<span class="op" id="6061069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061074">env</span>&nbsp;<span class="op" id="6061078">=</span>&nbsp;<span class="builtinfunc" id="6061080">append</span><span class="op" id="6061086">(</span><span class="ident" id="6061087">env</span><span class="op" id="6061090">,</span>&nbsp;<span class="ident" id="6061092">e</span><span class="op" id="6061093">+</span><span class="string" id="6061094">&#34;=&#34;</span><span class="op" id="6061097">+</span><span class="ident" id="6061098">v</span><span class="op" id="6061099">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061110">env</span>&nbsp;<span class="op" id="6061114">=</span>&nbsp;<span class="ident" id="6061116">removeLeadingDuplicates</span><span class="op" id="6061139">(</span><span class="ident" id="6061140">env</span><span class="op" id="6061143">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6061147">var</span>&nbsp;<span class="ident" id="6061151">cwd</span><span class="op" id="6061154">,</span>&nbsp;<span class="ident" id="6061156">path</span>&nbsp;<span class="builtintype" id="6061161">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6061169">if</span>&nbsp;<span class="ident" id="6061172">h</span><span class="op" id="6061173">.</span><span class="ident" id="6061174">Dir</span>&nbsp;<span class="op" id="6061178">!=</span>&nbsp;<span class="string" id="6061181">&#34;&#34;</span>&nbsp;<span class="op" id="6061184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061188">path</span>&nbsp;<span class="op" id="6061193">=</span>&nbsp;<span class="ident" id="6061195">h</span><span class="op" id="6061196">.</span><span class="ident" id="6061197">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061204">cwd</span>&nbsp;<span class="op" id="6061208">=</span>&nbsp;<span class="ident" id="6061210">h</span><span class="op" id="6061211">.</span><span class="ident" id="6061212">Dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061217">}</span>&nbsp;<span class="keyword" id="6061219">else</span>&nbsp;<span class="op" id="6061224">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061228">cwd</span><span class="op" id="6061231">,</span>&nbsp;<span class="ident" id="6061233">path</span>&nbsp;<span class="op" id="6061238">=</span>&nbsp;<span class="ident" id="6061240">filepath</span><span class="op" id="6061248">.</span><span class="ident" id="6061249">Split</span><span class="op" id="6061254">(</span><span class="ident" id="6061255">h</span><span class="op" id="6061256">.</span><span class="ident" id="6061257">Path</span><span class="op" id="6061261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6061267">if</span>&nbsp;<span class="ident" id="6061270">cwd</span>&nbsp;<span class="op" id="6061274">==</span>&nbsp;<span class="string" id="6061277">&#34;&#34;</span>&nbsp;<span class="op" id="6061280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061284">cwd</span>&nbsp;<span class="op" id="6061288">=</span>&nbsp;<span class="string" id="6061290">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061295">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061299">internalError</span>&nbsp;<span class="op" id="6061313">:=</span>&nbsp;<span class="keyword" id="6061316">func</span><span class="op" id="6061320">(</span><span class="ident" id="6061321">err</span>&nbsp;<span class="builtintype" id="6061325">error</span><span class="op" id="6061330">)</span>&nbsp;<span class="op" id="6061332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061336">rw</span><span class="op" id="6061338">.</span><span class="ident" id="6061339">WriteHeader</span><span class="op" id="6061350">(</span><span class="ident" id="6061351">http</span><span class="op" id="6061355">.</span><span class="ident" id="6061356">StatusInternalServerError</span><span class="op" id="6061381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061385">h</span><span class="op" id="6061386">.</span><span class="ident" id="6061387">printf</span><span class="op" id="6061393">(</span><span class="string" id="6061394">&#34;CGI&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="6061409">,</span>&nbsp;<span class="ident" id="6061411">err</span><span class="op" id="6061414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061417">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061421">cmd</span>&nbsp;<span class="op" id="6061425">:=</span>&nbsp;<span class="op" id="6061428">&amp;</span><span class="ident" id="6061429">exec</span><span class="op" id="6061433">.</span><span class="ident" id="6061434">Cmd</span><span class="op" id="6061437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061441">Path</span><span class="op" id="6061445">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6061449">path</span><span class="op" id="6061453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061457">Args</span><span class="op" id="6061461">:</span>&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6061465">append</span><span class="op" id="6061471">(</span><span class="op" id="6061472">[</span><span class="op" id="6061473">]</span><span class="builtintype" id="6061474">string</span><span class="op" id="6061480">{</span><span class="ident" id="6061481">h</span><span class="op" id="6061482">.</span><span class="ident" id="6061483">Path</span><span class="op" id="6061487">}</span><span class="op" id="6061488">,</span>&nbsp;<span class="ident" id="6061490">h</span><span class="op" id="6061491">.</span><span class="ident" id="6061492">Args</span><span class="op" id="6061496">...</span><span class="op" id="6061499">)</span><span class="op" id="6061500">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061504">Dir</span><span class="op" id="6061507">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061512">cwd</span><span class="op" id="6061515">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061519">Env</span><span class="op" id="6061522">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061527">env</span><span class="op" id="6061530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061534">Stderr</span><span class="op" id="6061540">:</span>&nbsp;<span class="ident" id="6061542">os</span><span class="op" id="6061544">.</span><span class="ident" id="6061545">Stderr</span><span class="op" id="6061551">,</span>&nbsp;<span class="comment" id="6061553">//&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6061568">if</span>&nbsp;<span class="ident" id="6061571">req</span><span class="op" id="6061574">.</span><span class="ident" id="6061575">ContentLength</span>&nbsp;<span class="op" id="6061589">!=</span>&nbsp;<span class="num" id="6061592">0</span>&nbsp;<span class="op" id="6061594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061598">cmd</span><span class="op" id="6061601">.</span><span class="ident" id="6061602">Stdin</span>&nbsp;<span class="op" id="6061608">=</span>&nbsp;<span class="ident" id="6061610">req</span><span class="op" id="6061613">.</span><span class="ident" id="6061614">Body</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061623">stdoutRead</span><span class="op" id="6061633">,</span>&nbsp;<span class="ident" id="6061635">err</span>&nbsp;<span class="op" id="6061639">:=</span>&nbsp;<span class="ident" id="6061642">cmd</span><span class="op" id="6061645">.</span><span class="ident" id="6061646">StdoutPipe</span><span class="op" id="6061656">(</span><span class="op" id="6061657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6061660">if</span>&nbsp;<span class="ident" id="6061663">err</span>&nbsp;<span class="op" id="6061667">!=</span>&nbsp;<span class="builtintype" id="6061670">nil</span>&nbsp;<span class="op" id="6061674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061678">internalError</span><span class="op" id="6061691">(</span><span class="ident" id="6061692">err</span><span class="op" id="6061695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6061699">return</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061711">err</span>&nbsp;<span class="op" id="6061715">=</span>&nbsp;<span class="ident" id="6061717">cmd</span><span class="op" id="6061720">.</span><span class="ident" id="6061721">Start</span><span class="op" id="6061726">(</span><span class="op" id="6061727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6061730">if</span>&nbsp;<span class="ident" id="6061733">err</span>&nbsp;<span class="op" id="6061737">!=</span>&nbsp;<span class="builtintype" id="6061740">nil</span>&nbsp;<span class="op" id="6061744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061748">internalError</span><span class="op" id="6061761">(</span><span class="ident" id="6061762">err</span><span class="op" id="6061765">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6061769">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6061780">if</span>&nbsp;<span class="ident" id="6061783">hook</span>&nbsp;<span class="op" id="6061788">:=</span>&nbsp;<span class="ident" id="6061791">testHookStartProcess</span><span class="op" id="6061811">;</span>&nbsp;<span class="ident" id="6061813">hook</span>&nbsp;<span class="op" id="6061818">!=</span>&nbsp;<span class="builtintype" id="6061821">nil</span>&nbsp;<span class="op" id="6061825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061829">hook</span><span class="op" id="6061833">(</span><span class="ident" id="6061834">cmd</span><span class="op" id="6061837">.</span><span class="ident" id="6061838">Process</span><span class="op" id="6061845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6061848">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6061851">defer</span>&nbsp;<span class="ident" id="6061857">cmd</span><span class="op" id="6061860">.</span><span class="ident" id="6061861">Wait</span><span class="op" id="6061865">(</span><span class="op" id="6061866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6061869">defer</span>&nbsp;<span class="ident" id="6061875">stdoutRead</span><span class="op" id="6061885">.</span><span class="ident" id="6061886">Close</span><span class="op" id="6061891">(</span><span class="op" id="6061892">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061896">linebody</span>&nbsp;<span class="op" id="6061905">:=</span>&nbsp;<span class="ident" id="6061908">bufio</span><span class="op" id="6061913">.</span><span class="ident" id="6061914">NewReaderSize</span><span class="op" id="6061927">(</span><span class="ident" id="6061928">stdoutRead</span><span class="op" id="6061938">,</span>&nbsp;<span class="num" id="6061940">1024</span><span class="op" id="6061944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061947">headers</span>&nbsp;<span class="op" id="6061955">:=</span>&nbsp;<span class="builtinfunc" id="6061958">make</span><span class="op" id="6061962">(</span><span class="ident" id="6061963">http</span><span class="op" id="6061967">.</span><span class="ident" id="6061968">Header</span><span class="op" id="6061974">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061977">statusCode</span>&nbsp;<span class="op" id="6061988">:=</span>&nbsp;<span class="num" id="6061991">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061994">headerLines</span>&nbsp;<span class="op" id="6062006">:=</span>&nbsp;<span class="num" id="6062009">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062012">sawBlankLine</span>&nbsp;<span class="op" id="6062025">:=</span>&nbsp;<span class="builtintype" id="6062028">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6062035">for</span>&nbsp;<span class="op" id="6062039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062043">line</span><span class="op" id="6062047">,</span>&nbsp;<span class="ident" id="6062049">isPrefix</span><span class="op" id="6062057">,</span>&nbsp;<span class="ident" id="6062059">err</span>&nbsp;<span class="op" id="6062063">:=</span>&nbsp;<span class="ident" id="6062066">linebody</span><span class="op" id="6062074">.</span><span class="ident" id="6062075">ReadLine</span><span class="op" id="6062083">(</span><span class="op" id="6062084">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6062088">if</span>&nbsp;<span class="ident" id="6062091">isPrefix</span>&nbsp;<span class="op" id="6062100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062105">rw</span><span class="op" id="6062107">.</span><span class="ident" id="6062108">WriteHeader</span><span class="op" id="6062119">(</span><span class="ident" id="6062120">http</span><span class="op" id="6062124">.</span><span class="ident" id="6062125">StatusInternalServerError</span><span class="op" id="6062150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062155">h</span><span class="op" id="6062156">.</span><span class="ident" id="6062157">printf</span><span class="op" id="6062163">(</span><span class="string" id="6062164">&#34;cgi:&nbsp;long&nbsp;header&nbsp;line&nbsp;from&nbsp;subprocess.&#34;</span><span class="op" id="6062204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6062209">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6062218">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6062222">if</span>&nbsp;<span class="ident" id="6062225">err</span>&nbsp;<span class="op" id="6062229">==</span>&nbsp;<span class="ident" id="6062232">io</span><span class="op" id="6062234">.</span><span class="ident" id="6062235">EOF</span>&nbsp;<span class="op" id="6062239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6062244">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6062252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6062256">if</span>&nbsp;<span class="ident" id="6062259">err</span>&nbsp;<span class="op" id="6062263">!=</span>&nbsp;<span class="builtintype" id="6062266">nil</span>&nbsp;<span class="op" id="6062270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062275">rw</span><span class="op" id="6062277">.</span><span class="ident" id="6062278">WriteHeader</span><span class="op" id="6062289">(</span><span class="ident" id="6062290">http</span><span class="op" id="6062294">.</span><span class="ident" id="6062295">StatusInternalServerError</span><span class="op" id="6062320">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062325">h</span><span class="op" id="6062326">.</span><span class="ident" id="6062327">printf</span><span class="op" id="6062333">(</span><span class="string" id="6062334">&#34;cgi:&nbsp;error&nbsp;reading&nbsp;headers:&nbsp;%v&#34;</span><span class="op" id="6062366">,</span>&nbsp;<span class="ident" id="6062368">err</span><span class="op" id="6062371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6062376">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6062385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6062389">if</span>&nbsp;<span class="builtinfunc" id="6062392">len</span><span class="op" id="6062395">(</span><span class="ident" id="6062396">line</span><span class="op" id="6062400">)</span>&nbsp;<span class="op" id="6062402">==</span>&nbsp;<span class="num" id="6062405">0</span>&nbsp;<span class="op" id="6062407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062412">sawBlankLine</span>&nbsp;<span class="op" id="6062425">=</span>&nbsp;<span class="builtintype" id="6062427">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6062435">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6062443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062447">headerLines</span><span class="op" id="6062458">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062463">parts</span>&nbsp;<span class="op" id="6062469">:=</span>&nbsp;<span class="ident" id="6062472">strings</span><span class="op" id="6062479">.</span><span class="ident" id="6062480">SplitN</span><span class="op" id="6062486">(</span><span class="builtintype" id="6062487">string</span><span class="op" id="6062493">(</span><span class="ident" id="6062494">line</span><span class="op" id="6062498">)</span><span class="op" id="6062499">,</span>&nbsp;<span class="string" id="6062501">&#34;:&#34;</span><span class="op" id="6062504">,</span>&nbsp;<span class="num" id="6062506">2</span><span class="op" id="6062507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6062511">if</span>&nbsp;<span class="builtinfunc" id="6062514">len</span><span class="op" id="6062517">(</span><span class="ident" id="6062518">parts</span><span class="op" id="6062523">)</span>&nbsp;<span class="op" id="6062525">&lt;</span>&nbsp;<span class="num" id="6062527">2</span>&nbsp;<span class="op" id="6062529">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062534">h</span><span class="op" id="6062535">.</span><span class="ident" id="6062536">printf</span><span class="op" id="6062542">(</span><span class="string" id="6062543">&#34;cgi:&nbsp;bogus&nbsp;header&nbsp;line:&nbsp;%s&#34;</span><span class="op" id="6062571">,</span>&nbsp;<span class="builtintype" id="6062573">string</span><span class="op" id="6062579">(</span><span class="ident" id="6062580">line</span><span class="op" id="6062584">)</span><span class="op" id="6062585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6062590">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6062601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062605">header</span><span class="op" id="6062611">,</span>&nbsp;<span class="ident" id="6062613">val</span>&nbsp;<span class="op" id="6062617">:=</span>&nbsp;<span class="ident" id="6062620">parts</span><span class="op" id="6062625">[</span><span class="num" id="6062626">0</span><span class="op" id="6062627">]</span><span class="op" id="6062628">,</span>&nbsp;<span class="ident" id="6062630">parts</span><span class="op" id="6062635">[</span><span class="num" id="6062636">1</span><span class="op" id="6062637">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062641">header</span>&nbsp;<span class="op" id="6062648">=</span>&nbsp;<span class="ident" id="6062650">strings</span><span class="op" id="6062657">.</span><span class="ident" id="6062658">TrimSpace</span><span class="op" id="6062667">(</span><span class="ident" id="6062668">header</span><span class="op" id="6062674">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062678">val</span>&nbsp;<span class="op" id="6062682">=</span>&nbsp;<span class="ident" id="6062684">strings</span><span class="op" id="6062691">.</span><span class="ident" id="6062692">TrimSpace</span><span class="op" id="6062701">(</span><span class="ident" id="6062702">val</span><span class="op" id="6062705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6062709">switch</span>&nbsp;<span class="op" id="6062716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6062720">case</span>&nbsp;<span class="ident" id="6062725">header</span>&nbsp;<span class="op" id="6062732">==</span>&nbsp;<span class="string" id="6062735">&#34;Status&#34;</span><span class="op" id="6062743">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6062748">if</span>&nbsp;<span class="builtinfunc" id="6062751">len</span><span class="op" id="6062754">(</span><span class="ident" id="6062755">val</span><span class="op" id="6062758">)</span>&nbsp;<span class="op" id="6062760">&lt;</span>&nbsp;<span class="num" id="6062762">3</span>&nbsp;<span class="op" id="6062764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062770">h</span><span class="op" id="6062771">.</span><span class="ident" id="6062772">printf</span><span class="op" id="6062778">(</span><span class="string" id="6062779">&#34;cgi:&nbsp;bogus&nbsp;status&nbsp;(short):&nbsp;%q&#34;</span><span class="op" id="6062810">,</span>&nbsp;<span class="ident" id="6062812">val</span><span class="op" id="6062815">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6062821">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6062831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062836">code</span><span class="op" id="6062840">,</span>&nbsp;<span class="ident" id="6062842">err</span>&nbsp;<span class="op" id="6062846">:=</span>&nbsp;<span class="ident" id="6062849">strconv</span><span class="op" id="6062856">.</span><span class="ident" id="6062857">Atoi</span><span class="op" id="6062861">(</span><span class="ident" id="6062862">val</span><span class="op" id="6062865">[</span><span class="num" id="6062866">0</span><span class="op" id="6062867">:</span><span class="num" id="6062868">3</span><span class="op" id="6062869">]</span><span class="op" id="6062870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6062875">if</span>&nbsp;<span class="ident" id="6062878">err</span>&nbsp;<span class="op" id="6062882">!=</span>&nbsp;<span class="builtintype" id="6062885">nil</span>&nbsp;<span class="op" id="6062889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062895">h</span><span class="op" id="6062896">.</span><span class="ident" id="6062897">printf</span><span class="op" id="6062903">(</span><span class="string" id="6062904">&#34;cgi:&nbsp;bogus&nbsp;status:&nbsp;%q&#34;</span><span class="op" id="6062927">,</span>&nbsp;<span class="ident" id="6062929">val</span><span class="op" id="6062932">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062938">h</span><span class="op" id="6062939">.</span><span class="ident" id="6062940">printf</span><span class="op" id="6062946">(</span><span class="string" id="6062947">&#34;cgi:&nbsp;line&nbsp;was&nbsp;%q&#34;</span><span class="op" id="6062965">,</span>&nbsp;<span class="ident" id="6062967">line</span><span class="op" id="6062971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6062977">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6062987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6062992">statusCode</span>&nbsp;<span class="op" id="6063003">=</span>&nbsp;<span class="ident" id="6063005">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6063012">default</span><span class="op" id="6063019">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6063024">headers</span><span class="op" id="6063031">.</span><span class="ident" id="6063032">Add</span><span class="op" id="6063035">(</span><span class="ident" id="6063036">header</span><span class="op" id="6063042">,</span>&nbsp;<span class="ident" id="6063044">val</span><span class="op" id="6063047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6063051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6063054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6063057">if</span>&nbsp;<span class="ident" id="6063060">headerLines</span>&nbsp;<span class="op" id="6063072">==</span>&nbsp;<span class="num" id="6063075">0</span>&nbsp;<span class="op" id="6063077">||</span>&nbsp;<span class="op" id="6063080">!</span><span class="ident" id="6063081">sawBlankLine</span>&nbsp;<span class="op" id="6063094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6063098">rw</span><span class="op" id="6063100">.</span><span class="ident" id="6063101">WriteHeader</span><span class="op" id="6063112">(</span><span class="ident" id="6063113">http</span><span class="op" id="6063117">.</span><span class="ident" id="6063118">StatusInternalServerError</span><span class="op" id="6063143">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6063147">h</span><span class="op" id="6063148">.</span><span class="ident" id="6063149">printf</span><span class="op" id="6063155">(</span><span class="string" id="6063156">&#34;cgi:&nbsp;no&nbsp;headers&#34;</span><span class="op" id="6063173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6063177">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6063185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6063189">if</span>&nbsp;<span class="ident" id="6063192">loc</span>&nbsp;<span class="op" id="6063196">:=</span>&nbsp;<span class="ident" id="6063199">headers</span><span class="op" id="6063206">.</span><span class="ident" id="6063207">Get</span><span class="op" id="6063210">(</span><span class="string" id="6063211">&#34;Location&#34;</span><span class="op" id="6063221">)</span><span class="op" id="6063222">;</span>&nbsp;<span class="ident" id="6063224">loc</span>&nbsp;<span class="op" id="6063228">!=</span>&nbsp;<span class="string" id="6063231">&#34;&#34;</span>&nbsp;<span class="op" id="6063234">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6063238">if</span>&nbsp;<span class="ident" id="6063241">strings</span><span class="op" id="6063248">.</span><span class="ident" id="6063249">HasPrefix</span><span class="op" id="6063258">(</span><span class="ident" id="6063259">loc</span><span class="op" id="6063262">,</span>&nbsp;<span class="string" id="6063264">&#34;/&#34;</span><span class="op" id="6063267">)</span>&nbsp;<span class="op" id="6063269">&amp;&amp;</span>&nbsp;<span class="ident" id="6063272">h</span><span class="op" id="6063273">.</span><span class="ident" id="6063274">PathLocationHandler</span>&nbsp;<span class="op" id="6063294">!=</span>&nbsp;<span class="builtintype" id="6063297">nil</span>&nbsp;<span class="op" id="6063301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6063306">h</span><span class="op" id="6063307">.</span><span class="ident" id="6063308">handleInternalRedirect</span><span class="op" id="6063330">(</span><span class="ident" id="6063331">rw</span><span class="op" id="6063333">,</span>&nbsp;<span class="ident" id="6063335">req</span><span class="op" id="6063338">,</span>&nbsp;<span class="ident" id="6063340">loc</span><span class="op" id="6063343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6063348">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6063357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6063361">if</span>&nbsp;<span class="ident" id="6063364">statusCode</span>&nbsp;<span class="op" id="6063375">==</span>&nbsp;<span class="num" id="6063378">0</span>&nbsp;<span class="op" id="6063380">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6063385">statusCode</span>&nbsp;<span class="op" id="6063396">=</span>&nbsp;<span class="ident" id="6063398">http</span><span class="op" id="6063402">.</span><span class="ident" id="6063403">StatusFound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6063417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6063420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6063424">if</span>&nbsp;<span class="ident" id="6063427">statusCode</span>&nbsp;<span class="op" id="6063438">==</span>&nbsp;<span class="num" id="6063441">0</span>&nbsp;<span class="op" id="6063443">&amp;&amp;</span>&nbsp;<span class="ident" id="6063446">headers</span><span class="op" id="6063453">.</span><span class="ident" id="6063454">Get</span><span class="op" id="6063457">(</span><span class="string" id="6063458">&#34;Content-Type&#34;</span><span class="op" id="6063472">)</span>&nbsp;<span class="op" id="6063474">==</span>&nbsp;<span class="string" id="6063477">&#34;&#34;</span>&nbsp;<span class="op" id="6063480">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6063484">rw</span><span class="op" id="6063486">.</span><span class="ident" id="6063487">WriteHeader</span><span class="op" id="6063498">(</span><span class="ident" id="6063499">http</span><span class="op" id="6063503">.</span><span class="ident" id="6063504">StatusInternalServerError</span><span class="op" id="6063529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6063533">h</span><span class="op" id="6063534">.</span><span class="ident" id="6063535">printf</span><span class="op" id="6063541">(</span><span class="string" id="6063542">&#34;cgi:&nbsp;missing&nbsp;required&nbsp;Content-Type&nbsp;in&nbsp;headers&#34;</span><span class="op" id="6063589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6063593">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6063601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6063605">if</span>&nbsp;<span class="ident" id="6063608">statusCode</span>&nbsp;<span class="op" id="6063619">==</span>&nbsp;<span class="num" id="6063622">0</span>&nbsp;<span class="op" id="6063624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6063628">statusCode</span>&nbsp;<span class="op" id="6063639">=</span>&nbsp;<span class="ident" id="6063641">http</span><span class="op" id="6063645">.</span><span class="ident" id="6063646">StatusOK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6063656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6063660">//&nbsp;Copy&nbsp;headers&nbsp;to&nbsp;rw&#39;s&nbsp;headers,&nbsp;after&nbsp;we&#39;ve&nbsp;decided&nbsp;not&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6063721">//&nbsp;go&nbsp;into&nbsp;handleInternalRedirect,&nbsp;which&nbsp;won&#39;t&nbsp;want&nbsp;its&nbsp;rw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6063781">//&nbsp;headers&nbsp;to&nbsp;have&nbsp;been&nbsp;touched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6063815">for</span>&nbsp;<span class="ident" id="6063819">k</span><span class="op" id="6063820">,</span>&nbsp;<span class="ident" id="6063822">vv</span>&nbsp;<span class="op" id="6063825">:=</span>&nbsp;<span class="keyword" id="6063828">range</span>&nbsp;<span class="ident" id="6063834">headers</span>&nbsp;<span class="op" id="6063842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6063846">for</span>&nbsp;<span class="ident" id="6063850">_</span><span class="op" id="6063851">,</span>&nbsp;<span class="ident" id="6063853">v</span>&nbsp;<span class="op" id="6063855">:=</span>&nbsp;<span class="keyword" id="6063858">range</span>&nbsp;<span class="ident" id="6063864">vv</span>&nbsp;<span class="op" id="6063867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6063872">rw</span><span class="op" id="6063874">.</span><span class="ident" id="6063875">Header</span><span class="op" id="6063881">(</span><span class="op" id="6063882">)</span><span class="op" id="6063883">.</span><span class="ident" id="6063884">Add</span><span class="op" id="6063887">(</span><span class="ident" id="6063888">k</span><span class="op" id="6063889">,</span>&nbsp;<span class="ident" id="6063891">v</span><span class="op" id="6063892">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6063896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6063899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6063903">rw</span><span class="op" id="6063905">.</span><span class="ident" id="6063906">WriteHeader</span><span class="op" id="6063917">(</span><span class="ident" id="6063918">statusCode</span><span class="op" id="6063928">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6063932">_</span><span class="op" id="6063933">,</span>&nbsp;<span class="ident" id="6063935">err</span>&nbsp;<span class="op" id="6063939">=</span>&nbsp;<span class="ident" id="6063941">io</span><span class="op" id="6063943">.</span><span class="ident" id="6063944">Copy</span><span class="op" id="6063948">(</span><span class="ident" id="6063949">rw</span><span class="op" id="6063951">,</span>&nbsp;<span class="ident" id="6063953">linebody</span><span class="op" id="6063961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6063964">if</span>&nbsp;<span class="ident" id="6063967">err</span>&nbsp;<span class="op" id="6063971">!=</span>&nbsp;<span class="builtintype" id="6063974">nil</span>&nbsp;<span class="op" id="6063978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6063982">h</span><span class="op" id="6063983">.</span><span class="ident" id="6063984">printf</span><span class="op" id="6063990">(</span><span class="string" id="6063991">&#34;cgi:&nbsp;copy&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="6064012">,</span>&nbsp;<span class="ident" id="6064014">err</span><span class="op" id="6064017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6064021">//&nbsp;And&nbsp;kill&nbsp;the&nbsp;child&nbsp;CGI&nbsp;process&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;hang&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6064077">//&nbsp;the&nbsp;deferred&nbsp;cmd.Wait&nbsp;above&nbsp;if&nbsp;the&nbsp;error&nbsp;was&nbsp;just</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6064132">//&nbsp;the&nbsp;client&nbsp;(rw)&nbsp;going&nbsp;away.&nbsp;If&nbsp;it&nbsp;was&nbsp;a&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6064188">//&nbsp;(because&nbsp;the&nbsp;child&nbsp;died&nbsp;itself),&nbsp;then&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6064241">//&nbsp;kill&nbsp;of&nbsp;an&nbsp;already-dead&nbsp;process&nbsp;is&nbsp;harmless&nbsp;(the&nbsp;PID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6064299">//&nbsp;won&#39;t&nbsp;be&nbsp;reused&nbsp;until&nbsp;the&nbsp;Wait&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6064343">cmd</span><span class="op" id="6064346">.</span><span class="ident" id="6064347">Process</span><span class="op" id="6064354">.</span><span class="ident" id="6064355">Kill</span><span class="op" id="6064359">(</span><span class="op" id="6064360">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6064363">}</span><br>
<span class="lineno"></span><span class="op" id="6064365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6064368">func</span>&nbsp;<span class="op" id="6064373">(</span><span class="ident" id="6064374">h</span>&nbsp;<span class="op" id="6064376">*</span><span class="ident" id="6064377">Handler</span><span class="op" id="6064384">)</span>&nbsp;<span class="ident" id="6064386">printf</span><span class="op" id="6064392">(</span><span class="ident" id="6064393">format</span>&nbsp;<span class="builtintype" id="6064400">string</span><span class="op" id="6064406">,</span>&nbsp;<span class="ident" id="6064408">v</span>&nbsp;<span class="op" id="6064410">...</span><span class="keyword" id="6064413">interface</span><span class="op" id="6064422">{</span><span class="op" id="6064423">}</span><span class="op" id="6064424">)</span>&nbsp;<span class="op" id="6064426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6064429">if</span>&nbsp;<span class="ident" id="6064432">h</span><span class="op" id="6064433">.</span><span class="ident" id="6064434">Logger</span>&nbsp;<span class="op" id="6064441">!=</span>&nbsp;<span class="builtintype" id="6064444">nil</span>&nbsp;<span class="op" id="6064448">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6064452">h</span><span class="op" id="6064453">.</span><span class="ident" id="6064454">Logger</span><span class="op" id="6064460">.</span><span class="ident" id="6064461">Printf</span><span class="op" id="6064467">(</span><span class="ident" id="6064468">format</span><span class="op" id="6064474">,</span>&nbsp;<span class="ident" id="6064476">v</span><span class="op" id="6064477">...</span><span class="op" id="6064480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6064483">}</span>&nbsp;<span class="keyword" id="6064485">else</span>&nbsp;<span class="op" id="6064490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6064494">log</span><span class="op" id="6064497">.</span><span class="ident" id="6064498">Printf</span><span class="op" id="6064504">(</span><span class="ident" id="6064505">format</span><span class="op" id="6064511">,</span>&nbsp;<span class="ident" id="6064513">v</span><span class="op" id="6064514">...</span><span class="op" id="6064517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6064520">}</span><br>
<span class="lineno"></span><span class="op" id="6064522">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="6064525">func</span>&nbsp;<span class="op" id="6064530">(</span><span class="ident" id="6064531">h</span>&nbsp;<span class="op" id="6064533">*</span><span class="ident" id="6064534">Handler</span><span class="op" id="6064541">)</span>&nbsp;<span class="ident" id="6064543">handleInternalRedirect</span><span class="op" id="6064565">(</span><span class="ident" id="6064566">rw</span>&nbsp;<span class="ident" id="6064569">http</span><span class="op" id="6064573">.</span><span class="ident" id="6064574">ResponseWriter</span><span class="op" id="6064588">,</span>&nbsp;<span class="ident" id="6064590">req</span>&nbsp;<span class="op" id="6064594">*</span><span class="ident" id="6064595">http</span><span class="op" id="6064599">.</span><span class="ident" id="6064600">Request</span><span class="op" id="6064607">,</span>&nbsp;<span class="ident" id="6064609">path</span>&nbsp;<span class="builtintype" id="6064614">string</span><span class="op" id="6064620">)</span>&nbsp;<span class="op" id="6064622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6064625">url</span><span class="op" id="6064628">,</span>&nbsp;<span class="ident" id="6064630">err</span>&nbsp;<span class="op" id="6064634">:=</span>&nbsp;<span class="ident" id="6064637">req</span><span class="op" id="6064640">.</span><span class="ident" id="6064641">URL</span><span class="op" id="6064644">.</span><span class="ident" id="6064645">Parse</span><span class="op" id="6064650">(</span><span class="ident" id="6064651">path</span><span class="op" id="6064655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6064658">if</span>&nbsp;<span class="ident" id="6064661">err</span>&nbsp;<span class="op" id="6064665">!=</span>&nbsp;<span class="builtintype" id="6064668">nil</span>&nbsp;<span class="op" id="6064672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6064676">rw</span><span class="op" id="6064678">.</span><span class="ident" id="6064679">WriteHeader</span><span class="op" id="6064690">(</span><span class="ident" id="6064691">http</span><span class="op" id="6064695">.</span><span class="ident" id="6064696">StatusInternalServerError</span><span class="op" id="6064721">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6064725">h</span><span class="op" id="6064726">.</span><span class="ident" id="6064727">printf</span><span class="op" id="6064733">(</span><span class="string" id="6064734">&#34;cgi:&nbsp;error&nbsp;resolving&nbsp;local&nbsp;URI&nbsp;path&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="6064778">,</span>&nbsp;<span class="ident" id="6064780">path</span><span class="op" id="6064784">,</span>&nbsp;<span class="ident" id="6064786">err</span><span class="op" id="6064789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6064793">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6064801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6064804">//&nbsp;TODO:&nbsp;RFC&nbsp;3875&nbsp;isn&#39;t&nbsp;clear&nbsp;if&nbsp;only&nbsp;GET&nbsp;is&nbsp;supported,&nbsp;but&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6064868">//&nbsp;suggests&nbsp;so:&nbsp;&#34;Note&nbsp;that&nbsp;any&nbsp;message-body&nbsp;attached&nbsp;to&nbsp;the</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6064929">//&nbsp;request&nbsp;(such&nbsp;as&nbsp;for&nbsp;a&nbsp;POST&nbsp;request)&nbsp;may&nbsp;not&nbsp;be&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6064991">//&nbsp;to&nbsp;the&nbsp;resource&nbsp;that&nbsp;is&nbsp;the&nbsp;target&nbsp;of&nbsp;the&nbsp;redirect.&#34;&nbsp;&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6065052">//&nbsp;should&nbsp;do&nbsp;some&nbsp;tests&nbsp;against&nbsp;Apache&nbsp;to&nbsp;see&nbsp;how&nbsp;it&nbsp;handles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6065114">//&nbsp;POST,&nbsp;HEAD,&nbsp;etc.&nbsp;Does&nbsp;the&nbsp;internal&nbsp;redirect&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6065175">//&nbsp;method&nbsp;or&nbsp;just&nbsp;GET?&nbsp;What&nbsp;about&nbsp;incoming&nbsp;headers?</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6065228">//&nbsp;(e.g.&nbsp;Cookies)&nbsp;Which&nbsp;headers,&nbsp;if&nbsp;any,&nbsp;are&nbsp;copied&nbsp;into&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6065290">//&nbsp;second&nbsp;request?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065310">newReq</span>&nbsp;<span class="op" id="6065317">:=</span>&nbsp;<span class="op" id="6065320">&amp;</span><span class="ident" id="6065321">http</span><span class="op" id="6065325">.</span><span class="ident" id="6065326">Request</span><span class="op" id="6065333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065337">Method</span><span class="op" id="6065343">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6065349">&#34;GET&#34;</span><span class="op" id="6065354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065358">URL</span><span class="op" id="6065361">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065370">url</span><span class="op" id="6065373">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065377">Proto</span><span class="op" id="6065382">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6065389">&#34;HTTP/1.1&#34;</span><span class="op" id="6065399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065403">ProtoMajor</span><span class="op" id="6065413">:</span>&nbsp;<span class="num" id="6065415">1</span><span class="op" id="6065416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065420">ProtoMinor</span><span class="op" id="6065430">:</span>&nbsp;<span class="num" id="6065432">1</span><span class="op" id="6065433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065437">Header</span><span class="op" id="6065443">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6065449">make</span><span class="op" id="6065453">(</span><span class="ident" id="6065454">http</span><span class="op" id="6065458">.</span><span class="ident" id="6065459">Header</span><span class="op" id="6065465">)</span><span class="op" id="6065466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065470">Host</span><span class="op" id="6065474">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065482">url</span><span class="op" id="6065485">.</span><span class="ident" id="6065486">Host</span><span class="op" id="6065490">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065494">RemoteAddr</span><span class="op" id="6065504">:</span>&nbsp;<span class="ident" id="6065506">req</span><span class="op" id="6065509">.</span><span class="ident" id="6065510">RemoteAddr</span><span class="op" id="6065520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065524">TLS</span><span class="op" id="6065527">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065536">req</span><span class="op" id="6065539">.</span><span class="ident" id="6065540">TLS</span><span class="op" id="6065543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6065546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065549">h</span><span class="op" id="6065550">.</span><span class="ident" id="6065551">PathLocationHandler</span><span class="op" id="6065570">.</span><span class="ident" id="6065571">ServeHTTP</span><span class="op" id="6065580">(</span><span class="ident" id="6065581">rw</span><span class="op" id="6065583">,</span>&nbsp;<span class="ident" id="6065585">newReq</span><span class="op" id="6065591">)</span><br>
<span class="lineno"></span><span class="op" id="6065593">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="6065596">func</span>&nbsp;<span class="ident" id="6065601">upperCaseAndUnderscore</span><span class="op" id="6065623">(</span><span class="ident" id="6065624">r</span>&nbsp;<span class="builtintype" id="6065626">rune</span><span class="op" id="6065630">)</span>&nbsp;<span class="builtintype" id="6065632">rune</span>&nbsp;<span class="op" id="6065637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6065640">switch</span>&nbsp;<span class="op" id="6065647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6065650">case</span>&nbsp;<span class="ident" id="6065655">r</span>&nbsp;<span class="op" id="6065657">&gt;=</span>&nbsp;<span class="string" id="6065660">&#39;a&#39;</span>&nbsp;<span class="op" id="6065664">&amp;&amp;</span>&nbsp;<span class="ident" id="6065667">r</span>&nbsp;<span class="op" id="6065669">&lt;=</span>&nbsp;<span class="string" id="6065672">&#39;z&#39;</span><span class="op" id="6065675">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6065679">return</span>&nbsp;<span class="ident" id="6065686">r</span>&nbsp;<span class="op" id="6065688">-</span>&nbsp;<span class="op" id="6065690">(</span><span class="string" id="6065691">&#39;a&#39;</span>&nbsp;<span class="op" id="6065695">-</span>&nbsp;<span class="string" id="6065697">&#39;A&#39;</span><span class="op" id="6065700">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6065703">case</span>&nbsp;<span class="ident" id="6065708">r</span>&nbsp;<span class="op" id="6065710">==</span>&nbsp;<span class="string" id="6065713">&#39;-&#39;</span><span class="op" id="6065716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6065720">return</span>&nbsp;<span class="string" id="6065727">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6065732">case</span>&nbsp;<span class="ident" id="6065737">r</span>&nbsp;<span class="op" id="6065739">==</span>&nbsp;<span class="string" id="6065742">&#39;=&#39;</span><span class="op" id="6065745">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6065749">//&nbsp;Maybe&nbsp;not&nbsp;part&nbsp;of&nbsp;the&nbsp;CGI&nbsp;&#39;spec&#39;&nbsp;but&nbsp;would&nbsp;mess&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6065805">//&nbsp;the&nbsp;environment&nbsp;in&nbsp;any&nbsp;case,&nbsp;as&nbsp;Go&nbsp;represents&nbsp;the</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6065860">//&nbsp;environment&nbsp;as&nbsp;a&nbsp;slice&nbsp;of&nbsp;&#34;key=value&#34;&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6065912">return</span>&nbsp;<span class="string" id="6065919">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6065924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6065927">//&nbsp;TODO:&nbsp;other&nbsp;transformations&nbsp;in&nbsp;spec&nbsp;or&nbsp;practice?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6065980">return</span>&nbsp;<span class="ident" id="6065987">r</span><br>
<span class="lineno">375</span><span class="op" id="6065989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6065992">var</span>&nbsp;<span class="ident" id="6065996">testHookStartProcess</span>&nbsp;<span class="keyword" id="6066017">func</span><span class="op" id="6066021">(</span><span class="op" id="6066022">*</span><span class="ident" id="6066023">os</span><span class="op" id="6066025">.</span><span class="ident" id="6066026">Process</span><span class="op" id="6066033">)</span>&nbsp;<span class="comment" id="6066035">//&nbsp;nil&nbsp;except&nbsp;for&nbsp;some&nbsp;tests</span>
</div>
</body>
</html>
