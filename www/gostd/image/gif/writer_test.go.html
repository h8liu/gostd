<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8455888">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8455943">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8455997">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8456048">package</span>&nbsp;<span class="ident" id="8456056">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8456061">import</span>&nbsp;<span class="op" id="8456068">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8456071">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8456080">&#34;image&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8456089">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456104">_</span>&nbsp;<span class="string" id="8456106">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8456119">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8456132">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8456145">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8456151">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8456161">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8456164">func</span>&nbsp;<span class="ident" id="8456169">readImg</span><span class="op" id="8456176">(</span><span class="ident" id="8456177">filename</span>&nbsp;<span class="builtintype" id="8456186">string</span><span class="op" id="8456192">)</span>&nbsp;<span class="op" id="8456194">(</span><span class="ident" id="8456195">image</span><span class="op" id="8456200">.</span><span class="ident" id="8456201">Image</span><span class="op" id="8456206">,</span>&nbsp;<span class="builtintype" id="8456208">error</span><span class="op" id="8456213">)</span>&nbsp;<span class="op" id="8456215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456218">f</span><span class="op" id="8456219">,</span>&nbsp;<span class="ident" id="8456221">err</span>&nbsp;<span class="op" id="8456225">:=</span>&nbsp;<span class="ident" id="8456228">os</span><span class="op" id="8456230">.</span><span class="ident" id="8456231">Open</span><span class="op" id="8456235">(</span><span class="ident" id="8456236">filename</span><span class="op" id="8456244">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456247">if</span>&nbsp;<span class="ident" id="8456250">err</span>&nbsp;<span class="op" id="8456254">!=</span>&nbsp;<span class="builtintype" id="8456257">nil</span>&nbsp;<span class="op" id="8456261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456265">return</span>&nbsp;<span class="builtintype" id="8456272">nil</span><span class="op" id="8456275">,</span>&nbsp;<span class="ident" id="8456277">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8456282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456285">defer</span>&nbsp;<span class="ident" id="8456291">f</span><span class="op" id="8456292">.</span><span class="ident" id="8456293">Close</span><span class="op" id="8456298">(</span><span class="op" id="8456299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456302">m</span><span class="op" id="8456303">,</span>&nbsp;<span class="ident" id="8456305">_</span><span class="op" id="8456306">,</span>&nbsp;<span class="ident" id="8456308">err</span>&nbsp;<span class="op" id="8456312">:=</span>&nbsp;<span class="ident" id="8456315">image</span><span class="op" id="8456320">.</span><span class="ident" id="8456321">Decode</span><span class="op" id="8456327">(</span><span class="ident" id="8456328">f</span><span class="op" id="8456329">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456332">return</span>&nbsp;<span class="ident" id="8456339">m</span><span class="op" id="8456340">,</span>&nbsp;<span class="ident" id="8456342">err</span><br>
<span class="lineno"></span><span class="op" id="8456346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8456349">func</span>&nbsp;<span class="ident" id="8456354">readGIF</span><span class="op" id="8456361">(</span><span class="ident" id="8456362">filename</span>&nbsp;<span class="builtintype" id="8456371">string</span><span class="op" id="8456377">)</span>&nbsp;<span class="op" id="8456379">(</span><span class="op" id="8456380">*</span><span class="ident" id="8456381">GIF</span><span class="op" id="8456384">,</span>&nbsp;<span class="builtintype" id="8456386">error</span><span class="op" id="8456391">)</span>&nbsp;<span class="op" id="8456393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456396">f</span><span class="op" id="8456397">,</span>&nbsp;<span class="ident" id="8456399">err</span>&nbsp;<span class="op" id="8456403">:=</span>&nbsp;<span class="ident" id="8456406">os</span><span class="op" id="8456408">.</span><span class="ident" id="8456409">Open</span><span class="op" id="8456413">(</span><span class="ident" id="8456414">filename</span><span class="op" id="8456422">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456425">if</span>&nbsp;<span class="ident" id="8456428">err</span>&nbsp;<span class="op" id="8456432">!=</span>&nbsp;<span class="builtintype" id="8456435">nil</span>&nbsp;<span class="op" id="8456439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456443">return</span>&nbsp;<span class="builtintype" id="8456450">nil</span><span class="op" id="8456453">,</span>&nbsp;<span class="ident" id="8456455">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8456460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456463">defer</span>&nbsp;<span class="ident" id="8456469">f</span><span class="op" id="8456470">.</span><span class="ident" id="8456471">Close</span><span class="op" id="8456476">(</span><span class="op" id="8456477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456480">return</span>&nbsp;<span class="ident" id="8456487">DecodeAll</span><span class="op" id="8456496">(</span><span class="ident" id="8456497">f</span><span class="op" id="8456498">)</span><br>
<span class="lineno">35</span><span class="op" id="8456500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8456503">func</span>&nbsp;<span class="ident" id="8456508">delta</span><span class="op" id="8456513">(</span><span class="ident" id="8456514">u0</span><span class="op" id="8456516">,</span>&nbsp;<span class="ident" id="8456518">u1</span>&nbsp;<span class="builtintype" id="8456521">uint32</span><span class="op" id="8456527">)</span>&nbsp;<span class="ident" id="8456529">int64</span>&nbsp;<span class="op" id="8456535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456538">d</span>&nbsp;<span class="op" id="8456540">:=</span>&nbsp;<span class="ident" id="8456543">int64</span><span class="op" id="8456548">(</span><span class="ident" id="8456549">u0</span><span class="op" id="8456551">)</span>&nbsp;<span class="op" id="8456553">-</span>&nbsp;<span class="ident" id="8456555">int64</span><span class="op" id="8456560">(</span><span class="ident" id="8456561">u1</span><span class="op" id="8456563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456566">if</span>&nbsp;<span class="ident" id="8456569">d</span>&nbsp;<span class="op" id="8456571">&lt;</span>&nbsp;<span class="num" id="8456573">0</span>&nbsp;<span class="op" id="8456575">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456579">return</span>&nbsp;<span class="op" id="8456586">-</span><span class="ident" id="8456587">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8456590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456593">return</span>&nbsp;<span class="ident" id="8456600">d</span><br>
<span class="lineno"></span><span class="op" id="8456602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="8456605">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="8456681">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="8456706">func</span>&nbsp;<span class="ident" id="8456711">averageDelta</span><span class="op" id="8456723">(</span><span class="ident" id="8456724">m0</span><span class="op" id="8456726">,</span>&nbsp;<span class="ident" id="8456728">m1</span>&nbsp;<span class="ident" id="8456731">image</span><span class="op" id="8456736">.</span><span class="ident" id="8456737">Image</span><span class="op" id="8456742">)</span>&nbsp;<span class="ident" id="8456744">int64</span>&nbsp;<span class="op" id="8456750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456753">b</span>&nbsp;<span class="op" id="8456755">:=</span>&nbsp;<span class="ident" id="8456758">m0</span><span class="op" id="8456760">.</span><span class="ident" id="8456761">Bounds</span><span class="op" id="8456767">(</span><span class="op" id="8456768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456771">var</span>&nbsp;<span class="ident" id="8456775">sum</span><span class="op" id="8456778">,</span>&nbsp;<span class="ident" id="8456780">n</span>&nbsp;<span class="ident" id="8456782">int64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456789">for</span>&nbsp;<span class="ident" id="8456793">y</span>&nbsp;<span class="op" id="8456795">:=</span>&nbsp;<span class="ident" id="8456798">b</span><span class="op" id="8456799">.</span><span class="ident" id="8456800">Min</span><span class="op" id="8456803">.</span><span class="ident" id="8456804">Y</span><span class="op" id="8456805">;</span>&nbsp;<span class="ident" id="8456807">y</span>&nbsp;<span class="op" id="8456809">&lt;</span>&nbsp;<span class="ident" id="8456811">b</span><span class="op" id="8456812">.</span><span class="ident" id="8456813">Max</span><span class="op" id="8456816">.</span><span class="ident" id="8456817">Y</span><span class="op" id="8456818">;</span>&nbsp;<span class="ident" id="8456820">y</span><span class="op" id="8456821">++</span>&nbsp;<span class="op" id="8456824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456828">for</span>&nbsp;<span class="ident" id="8456832">x</span>&nbsp;<span class="op" id="8456834">:=</span>&nbsp;<span class="ident" id="8456837">b</span><span class="op" id="8456838">.</span><span class="ident" id="8456839">Min</span><span class="op" id="8456842">.</span><span class="ident" id="8456843">X</span><span class="op" id="8456844">;</span>&nbsp;<span class="ident" id="8456846">x</span>&nbsp;<span class="op" id="8456848">&lt;</span>&nbsp;<span class="ident" id="8456850">b</span><span class="op" id="8456851">.</span><span class="ident" id="8456852">Max</span><span class="op" id="8456855">.</span><span class="ident" id="8456856">X</span><span class="op" id="8456857">;</span>&nbsp;<span class="ident" id="8456859">x</span><span class="op" id="8456860">++</span>&nbsp;<span class="op" id="8456863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456868">c0</span>&nbsp;<span class="op" id="8456871">:=</span>&nbsp;<span class="ident" id="8456874">m0</span><span class="op" id="8456876">.</span><span class="ident" id="8456877">At</span><span class="op" id="8456879">(</span><span class="ident" id="8456880">x</span><span class="op" id="8456881">,</span>&nbsp;<span class="ident" id="8456883">y</span><span class="op" id="8456884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456889">c1</span>&nbsp;<span class="op" id="8456892">:=</span>&nbsp;<span class="ident" id="8456895">m1</span><span class="op" id="8456897">.</span><span class="ident" id="8456898">At</span><span class="op" id="8456900">(</span><span class="ident" id="8456901">x</span><span class="op" id="8456902">,</span>&nbsp;<span class="ident" id="8456904">y</span><span class="op" id="8456905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456910">r0</span><span class="op" id="8456912">,</span>&nbsp;<span class="ident" id="8456914">g0</span><span class="op" id="8456916">,</span>&nbsp;<span class="ident" id="8456918">b0</span><span class="op" id="8456920">,</span>&nbsp;<span class="ident" id="8456922">_</span>&nbsp;<span class="op" id="8456924">:=</span>&nbsp;<span class="ident" id="8456927">c0</span><span class="op" id="8456929">.</span><span class="ident" id="8456930">RGBA</span><span class="op" id="8456934">(</span><span class="op" id="8456935">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456940">r1</span><span class="op" id="8456942">,</span>&nbsp;<span class="ident" id="8456944">g1</span><span class="op" id="8456946">,</span>&nbsp;<span class="ident" id="8456948">b1</span><span class="op" id="8456950">,</span>&nbsp;<span class="ident" id="8456952">_</span>&nbsp;<span class="op" id="8456954">:=</span>&nbsp;<span class="ident" id="8456957">c1</span><span class="op" id="8456959">.</span><span class="ident" id="8456960">RGBA</span><span class="op" id="8456964">(</span><span class="op" id="8456965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456970">sum</span>&nbsp;<span class="op" id="8456974">+=</span>&nbsp;<span class="ident" id="8456977">delta</span><span class="op" id="8456982">(</span><span class="ident" id="8456983">r0</span><span class="op" id="8456985">,</span>&nbsp;<span class="ident" id="8456987">r1</span><span class="op" id="8456989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456994">sum</span>&nbsp;<span class="op" id="8456998">+=</span>&nbsp;<span class="ident" id="8457001">delta</span><span class="op" id="8457006">(</span><span class="ident" id="8457007">g0</span><span class="op" id="8457009">,</span>&nbsp;<span class="ident" id="8457011">g1</span><span class="op" id="8457013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457018">sum</span>&nbsp;<span class="op" id="8457022">+=</span>&nbsp;<span class="ident" id="8457025">delta</span><span class="op" id="8457030">(</span><span class="ident" id="8457031">b0</span><span class="op" id="8457033">,</span>&nbsp;<span class="ident" id="8457035">b1</span><span class="op" id="8457037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457042">n</span>&nbsp;<span class="op" id="8457044">+=</span>&nbsp;<span class="num" id="8457047">3</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8457051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8457054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457057">return</span>&nbsp;<span class="ident" id="8457064">sum</span>&nbsp;<span class="op" id="8457068">/</span>&nbsp;<span class="ident" id="8457070">n</span><br>
<span class="lineno"></span><span class="op" id="8457072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="8457075">var</span>&nbsp;<span class="ident" id="8457079">testCase</span>&nbsp;<span class="op" id="8457088">=</span>&nbsp;<span class="op" id="8457090">[</span><span class="op" id="8457091">]</span><span class="keyword" id="8457092">struct</span>&nbsp;<span class="op" id="8457099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457102">filename</span>&nbsp;&nbsp;<span class="builtintype" id="8457112">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457120">tolerance</span>&nbsp;<span class="ident" id="8457130">int64</span><br>
<span class="lineno"></span><span class="op" id="8457136">}</span><span class="op" id="8457137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8457140">{</span><span class="string" id="8457141">&#34;../testdata/video-001.png&#34;</span><span class="op" id="8457168">,</span>&nbsp;<span class="num" id="8457170">1</span>&nbsp;<span class="op" id="8457172">&lt;&lt;</span>&nbsp;<span class="num" id="8457175">12</span><span class="op" id="8457177">}</span><span class="op" id="8457178">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8457181">{</span><span class="string" id="8457182">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="8457209">,</span>&nbsp;<span class="num" id="8457211">0</span><span class="op" id="8457212">}</span><span class="op" id="8457213">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8457216">{</span><span class="string" id="8457217">&#34;../testdata/video-001.interlaced.gif&#34;</span><span class="op" id="8457255">,</span>&nbsp;<span class="num" id="8457257">0</span><span class="op" id="8457258">}</span><span class="op" id="8457259">,</span><br>
<span class="lineno"></span><span class="op" id="8457261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8457264">func</span>&nbsp;<span class="ident" id="8457269">TestWriter</span><span class="op" id="8457279">(</span><span class="ident" id="8457280">t</span>&nbsp;<span class="op" id="8457282">*</span><span class="ident" id="8457283">testing</span><span class="op" id="8457290">.</span><span class="ident" id="8457291">T</span><span class="op" id="8457292">)</span>&nbsp;<span class="op" id="8457294">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457297">for</span>&nbsp;<span class="ident" id="8457301">_</span><span class="op" id="8457302">,</span>&nbsp;<span class="ident" id="8457304">tc</span>&nbsp;<span class="op" id="8457307">:=</span>&nbsp;<span class="keyword" id="8457310">range</span>&nbsp;<span class="ident" id="8457316">testCase</span>&nbsp;<span class="op" id="8457325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457329">m0</span><span class="op" id="8457331">,</span>&nbsp;<span class="ident" id="8457333">err</span>&nbsp;<span class="op" id="8457337">:=</span>&nbsp;<span class="ident" id="8457340">readImg</span><span class="op" id="8457347">(</span><span class="ident" id="8457348">tc</span><span class="op" id="8457350">.</span><span class="ident" id="8457351">filename</span><span class="op" id="8457359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457363">if</span>&nbsp;<span class="ident" id="8457366">err</span>&nbsp;<span class="op" id="8457370">!=</span>&nbsp;<span class="builtintype" id="8457373">nil</span>&nbsp;<span class="op" id="8457377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457382">t</span><span class="op" id="8457383">.</span><span class="ident" id="8457384">Error</span><span class="op" id="8457389">(</span><span class="ident" id="8457390">tc</span><span class="op" id="8457392">.</span><span class="ident" id="8457393">filename</span><span class="op" id="8457401">,</span>&nbsp;<span class="ident" id="8457403">err</span><span class="op" id="8457406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457411">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8457422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457426">var</span>&nbsp;<span class="ident" id="8457430">buf</span>&nbsp;<span class="ident" id="8457434">bytes</span><span class="op" id="8457439">.</span><span class="ident" id="8457440">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457449">err</span>&nbsp;<span class="op" id="8457453">=</span>&nbsp;<span class="ident" id="8457455">Encode</span><span class="op" id="8457461">(</span><span class="op" id="8457462">&amp;</span><span class="ident" id="8457463">buf</span><span class="op" id="8457466">,</span>&nbsp;<span class="ident" id="8457468">m0</span><span class="op" id="8457470">,</span>&nbsp;<span class="builtintype" id="8457472">nil</span><span class="op" id="8457475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457479">if</span>&nbsp;<span class="ident" id="8457482">err</span>&nbsp;<span class="op" id="8457486">!=</span>&nbsp;<span class="builtintype" id="8457489">nil</span>&nbsp;<span class="op" id="8457493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457498">t</span><span class="op" id="8457499">.</span><span class="ident" id="8457500">Error</span><span class="op" id="8457505">(</span><span class="ident" id="8457506">tc</span><span class="op" id="8457508">.</span><span class="ident" id="8457509">filename</span><span class="op" id="8457517">,</span>&nbsp;<span class="ident" id="8457519">err</span><span class="op" id="8457522">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457527">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8457538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457542">m1</span><span class="op" id="8457544">,</span>&nbsp;<span class="ident" id="8457546">err</span>&nbsp;<span class="op" id="8457550">:=</span>&nbsp;<span class="ident" id="8457553">Decode</span><span class="op" id="8457559">(</span><span class="op" id="8457560">&amp;</span><span class="ident" id="8457561">buf</span><span class="op" id="8457564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457568">if</span>&nbsp;<span class="ident" id="8457571">err</span>&nbsp;<span class="op" id="8457575">!=</span>&nbsp;<span class="builtintype" id="8457578">nil</span>&nbsp;<span class="op" id="8457582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457587">t</span><span class="op" id="8457588">.</span><span class="ident" id="8457589">Error</span><span class="op" id="8457594">(</span><span class="ident" id="8457595">tc</span><span class="op" id="8457597">.</span><span class="ident" id="8457598">filename</span><span class="op" id="8457606">,</span>&nbsp;<span class="ident" id="8457608">err</span><span class="op" id="8457611">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457616">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8457627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457631">if</span>&nbsp;<span class="ident" id="8457634">m0</span><span class="op" id="8457636">.</span><span class="ident" id="8457637">Bounds</span><span class="op" id="8457643">(</span><span class="op" id="8457644">)</span>&nbsp;<span class="op" id="8457646">!=</span>&nbsp;<span class="ident" id="8457649">m1</span><span class="op" id="8457651">.</span><span class="ident" id="8457652">Bounds</span><span class="op" id="8457658">(</span><span class="op" id="8457659">)</span>&nbsp;<span class="op" id="8457661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457666">t</span><span class="op" id="8457667">.</span><span class="ident" id="8457668">Errorf</span><span class="op" id="8457674">(</span><span class="string" id="8457675">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="8457705">,</span>&nbsp;<span class="ident" id="8457707">tc</span><span class="op" id="8457709">.</span><span class="ident" id="8457710">filename</span><span class="op" id="8457718">,</span>&nbsp;<span class="ident" id="8457720">m0</span><span class="op" id="8457722">.</span><span class="ident" id="8457723">Bounds</span><span class="op" id="8457729">(</span><span class="op" id="8457730">)</span><span class="op" id="8457731">,</span>&nbsp;<span class="ident" id="8457733">m1</span><span class="op" id="8457735">.</span><span class="ident" id="8457736">Bounds</span><span class="op" id="8457742">(</span><span class="op" id="8457743">)</span><span class="op" id="8457744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457749">continue</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8457760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8457764">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457819">avgDelta</span>&nbsp;<span class="op" id="8457828">:=</span>&nbsp;<span class="ident" id="8457831">averageDelta</span><span class="op" id="8457843">(</span><span class="ident" id="8457844">m0</span><span class="op" id="8457846">,</span>&nbsp;<span class="ident" id="8457848">m1</span><span class="op" id="8457850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457854">if</span>&nbsp;<span class="ident" id="8457857">avgDelta</span>&nbsp;<span class="op" id="8457866">&gt;</span>&nbsp;<span class="ident" id="8457868">tc</span><span class="op" id="8457870">.</span><span class="ident" id="8457871">tolerance</span>&nbsp;<span class="op" id="8457881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457886">t</span><span class="op" id="8457887">.</span><span class="ident" id="8457888">Errorf</span><span class="op" id="8457894">(</span><span class="string" id="8457895">&#34;%s:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high.&nbsp;expected:&nbsp;%d,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8457948">,</span>&nbsp;<span class="ident" id="8457950">tc</span><span class="op" id="8457952">.</span><span class="ident" id="8457953">filename</span><span class="op" id="8457961">,</span>&nbsp;<span class="ident" id="8457963">tc</span><span class="op" id="8457965">.</span><span class="ident" id="8457966">tolerance</span><span class="op" id="8457975">,</span>&nbsp;<span class="ident" id="8457977">avgDelta</span><span class="op" id="8457985">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457990">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458004">}</span><br>
<span class="lineno"></span><span class="op" id="8458006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="8458009">func</span>&nbsp;<span class="ident" id="8458014">TestSubImage</span><span class="op" id="8458026">(</span><span class="ident" id="8458027">t</span>&nbsp;<span class="op" id="8458029">*</span><span class="ident" id="8458030">testing</span><span class="op" id="8458037">.</span><span class="ident" id="8458038">T</span><span class="op" id="8458039">)</span>&nbsp;<span class="op" id="8458041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458044">m0</span><span class="op" id="8458046">,</span>&nbsp;<span class="ident" id="8458048">err</span>&nbsp;<span class="op" id="8458052">:=</span>&nbsp;<span class="ident" id="8458055">readImg</span><span class="op" id="8458062">(</span><span class="string" id="8458063">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="8458090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8458093">if</span>&nbsp;<span class="ident" id="8458096">err</span>&nbsp;<span class="op" id="8458100">!=</span>&nbsp;<span class="builtintype" id="8458103">nil</span>&nbsp;<span class="op" id="8458107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458111">t</span><span class="op" id="8458112">.</span><span class="ident" id="8458113">Fatalf</span><span class="op" id="8458119">(</span><span class="string" id="8458120">&#34;readImg:&nbsp;%v&#34;</span><span class="op" id="8458133">,</span>&nbsp;<span class="ident" id="8458135">err</span><span class="op" id="8458138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458141">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458144">m0</span>&nbsp;<span class="op" id="8458147">=</span>&nbsp;<span class="ident" id="8458149">m0</span><span class="op" id="8458151">.</span><span class="op" id="8458152">(</span><span class="op" id="8458153">*</span><span class="ident" id="8458154">image</span><span class="op" id="8458159">.</span><span class="ident" id="8458160">Paletted</span><span class="op" id="8458168">)</span><span class="op" id="8458169">.</span><span class="ident" id="8458170">SubImage</span><span class="op" id="8458178">(</span><span class="ident" id="8458179">image</span><span class="op" id="8458184">.</span><span class="ident" id="8458185">Rect</span><span class="op" id="8458189">(</span><span class="num" id="8458190">0</span><span class="op" id="8458191">,</span>&nbsp;<span class="num" id="8458193">0</span><span class="op" id="8458194">,</span>&nbsp;<span class="num" id="8458196">50</span><span class="op" id="8458198">,</span>&nbsp;<span class="num" id="8458200">30</span><span class="op" id="8458202">)</span><span class="op" id="8458203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8458206">var</span>&nbsp;<span class="ident" id="8458210">buf</span>&nbsp;<span class="ident" id="8458214">bytes</span><span class="op" id="8458219">.</span><span class="ident" id="8458220">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458228">err</span>&nbsp;<span class="op" id="8458232">=</span>&nbsp;<span class="ident" id="8458234">Encode</span><span class="op" id="8458240">(</span><span class="op" id="8458241">&amp;</span><span class="ident" id="8458242">buf</span><span class="op" id="8458245">,</span>&nbsp;<span class="ident" id="8458247">m0</span><span class="op" id="8458249">,</span>&nbsp;<span class="builtintype" id="8458251">nil</span><span class="op" id="8458254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8458257">if</span>&nbsp;<span class="ident" id="8458260">err</span>&nbsp;<span class="op" id="8458264">!=</span>&nbsp;<span class="builtintype" id="8458267">nil</span>&nbsp;<span class="op" id="8458271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458275">t</span><span class="op" id="8458276">.</span><span class="ident" id="8458277">Fatalf</span><span class="op" id="8458283">(</span><span class="string" id="8458284">&#34;Encode:&nbsp;%v&#34;</span><span class="op" id="8458296">,</span>&nbsp;<span class="ident" id="8458298">err</span><span class="op" id="8458301">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458307">m1</span><span class="op" id="8458309">,</span>&nbsp;<span class="ident" id="8458311">err</span>&nbsp;<span class="op" id="8458315">:=</span>&nbsp;<span class="ident" id="8458318">Decode</span><span class="op" id="8458324">(</span><span class="op" id="8458325">&amp;</span><span class="ident" id="8458326">buf</span><span class="op" id="8458329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8458332">if</span>&nbsp;<span class="ident" id="8458335">err</span>&nbsp;<span class="op" id="8458339">!=</span>&nbsp;<span class="builtintype" id="8458342">nil</span>&nbsp;<span class="op" id="8458346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458350">t</span><span class="op" id="8458351">.</span><span class="ident" id="8458352">Fatalf</span><span class="op" id="8458358">(</span><span class="string" id="8458359">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="8458371">,</span>&nbsp;<span class="ident" id="8458373">err</span><span class="op" id="8458376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458379">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8458382">if</span>&nbsp;<span class="ident" id="8458385">m0</span><span class="op" id="8458387">.</span><span class="ident" id="8458388">Bounds</span><span class="op" id="8458394">(</span><span class="op" id="8458395">)</span>&nbsp;<span class="op" id="8458397">!=</span>&nbsp;<span class="ident" id="8458400">m1</span><span class="op" id="8458402">.</span><span class="ident" id="8458403">Bounds</span><span class="op" id="8458409">(</span><span class="op" id="8458410">)</span>&nbsp;<span class="op" id="8458412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458416">t</span><span class="op" id="8458417">.</span><span class="ident" id="8458418">Fatalf</span><span class="op" id="8458424">(</span><span class="string" id="8458425">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="8458451">,</span>&nbsp;<span class="ident" id="8458453">m0</span><span class="op" id="8458455">.</span><span class="ident" id="8458456">Bounds</span><span class="op" id="8458462">(</span><span class="op" id="8458463">)</span><span class="op" id="8458464">,</span>&nbsp;<span class="ident" id="8458466">m1</span><span class="op" id="8458468">.</span><span class="ident" id="8458469">Bounds</span><span class="op" id="8458475">(</span><span class="op" id="8458476">)</span><span class="op" id="8458477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8458483">if</span>&nbsp;<span class="ident" id="8458486">averageDelta</span><span class="op" id="8458498">(</span><span class="ident" id="8458499">m0</span><span class="op" id="8458501">,</span>&nbsp;<span class="ident" id="8458503">m1</span><span class="op" id="8458505">)</span>&nbsp;<span class="op" id="8458507">!=</span>&nbsp;<span class="num" id="8458510">0</span>&nbsp;<span class="op" id="8458512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458516">t</span><span class="op" id="8458517">.</span><span class="ident" id="8458518">Fatalf</span><span class="op" id="8458524">(</span><span class="string" id="8458525">&#34;images&nbsp;differ&#34;</span><span class="op" id="8458540">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458543">}</span><br>
<span class="lineno"></span><span class="op" id="8458545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8458548">var</span>&nbsp;<span class="ident" id="8458552">frames</span>&nbsp;<span class="op" id="8458559">=</span>&nbsp;<span class="op" id="8458561">[</span><span class="op" id="8458562">]</span><span class="builtintype" id="8458563">string</span><span class="op" id="8458569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8458572">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="8458599">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8458602">&#34;../testdata/video-005.gray.gif&#34;</span><span class="op" id="8458634">,</span><br>
<span class="lineno"></span><span class="op" id="8458636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8458639">func</span>&nbsp;<span class="ident" id="8458644">TestEncodeAll</span><span class="op" id="8458657">(</span><span class="ident" id="8458658">t</span>&nbsp;<span class="op" id="8458660">*</span><span class="ident" id="8458661">testing</span><span class="op" id="8458668">.</span><span class="ident" id="8458669">T</span><span class="op" id="8458670">)</span>&nbsp;<span class="op" id="8458672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458675">g0</span>&nbsp;<span class="op" id="8458678">:=</span>&nbsp;<span class="op" id="8458681">&amp;</span><span class="ident" id="8458682">GIF</span><span class="op" id="8458685">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458689">Image</span><span class="op" id="8458694">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8458700">make</span><span class="op" id="8458704">(</span><span class="op" id="8458705">[</span><span class="op" id="8458706">]</span><span class="op" id="8458707">*</span><span class="ident" id="8458708">image</span><span class="op" id="8458713">.</span><span class="ident" id="8458714">Paletted</span><span class="op" id="8458722">,</span>&nbsp;<span class="builtinfunc" id="8458724">len</span><span class="op" id="8458727">(</span><span class="ident" id="8458728">frames</span><span class="op" id="8458734">)</span><span class="op" id="8458735">)</span><span class="op" id="8458736">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458740">Delay</span><span class="op" id="8458745">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8458751">make</span><span class="op" id="8458755">(</span><span class="op" id="8458756">[</span><span class="op" id="8458757">]</span><span class="builtintype" id="8458758">int</span><span class="op" id="8458761">,</span>&nbsp;<span class="builtinfunc" id="8458763">len</span><span class="op" id="8458766">(</span><span class="ident" id="8458767">frames</span><span class="op" id="8458773">)</span><span class="op" id="8458774">)</span><span class="op" id="8458775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458779">LoopCount</span><span class="op" id="8458788">:</span>&nbsp;<span class="num" id="8458790">5</span><span class="op" id="8458791">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8458797">for</span>&nbsp;<span class="ident" id="8458801">i</span><span class="op" id="8458802">,</span>&nbsp;<span class="ident" id="8458804">f</span>&nbsp;<span class="op" id="8458806">:=</span>&nbsp;<span class="keyword" id="8458809">range</span>&nbsp;<span class="ident" id="8458815">frames</span>&nbsp;<span class="op" id="8458822">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458826">m</span><span class="op" id="8458827">,</span>&nbsp;<span class="ident" id="8458829">err</span>&nbsp;<span class="op" id="8458833">:=</span>&nbsp;<span class="ident" id="8458836">readGIF</span><span class="op" id="8458843">(</span><span class="ident" id="8458844">f</span><span class="op" id="8458845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8458849">if</span>&nbsp;<span class="ident" id="8458852">err</span>&nbsp;<span class="op" id="8458856">!=</span>&nbsp;<span class="builtintype" id="8458859">nil</span>&nbsp;<span class="op" id="8458863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458868">t</span><span class="op" id="8458869">.</span><span class="ident" id="8458870">Fatal</span><span class="op" id="8458875">(</span><span class="ident" id="8458876">f</span><span class="op" id="8458877">,</span>&nbsp;<span class="ident" id="8458879">err</span><span class="op" id="8458882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458890">g0</span><span class="op" id="8458892">.</span><span class="ident" id="8458893">Image</span><span class="op" id="8458898">[</span><span class="ident" id="8458899">i</span><span class="op" id="8458900">]</span>&nbsp;<span class="op" id="8458902">=</span>&nbsp;<span class="ident" id="8458904">m</span><span class="op" id="8458905">.</span><span class="ident" id="8458906">Image</span><span class="op" id="8458911">[</span><span class="num" id="8458912">0</span><span class="op" id="8458913">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8458919">var</span>&nbsp;<span class="ident" id="8458923">buf</span>&nbsp;<span class="ident" id="8458927">bytes</span><span class="op" id="8458932">.</span><span class="ident" id="8458933">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8458941">if</span>&nbsp;<span class="ident" id="8458944">err</span>&nbsp;<span class="op" id="8458948">:=</span>&nbsp;<span class="ident" id="8458951">EncodeAll</span><span class="op" id="8458960">(</span><span class="op" id="8458961">&amp;</span><span class="ident" id="8458962">buf</span><span class="op" id="8458965">,</span>&nbsp;<span class="ident" id="8458967">g0</span><span class="op" id="8458969">)</span><span class="op" id="8458970">;</span>&nbsp;<span class="ident" id="8458972">err</span>&nbsp;<span class="op" id="8458976">!=</span>&nbsp;<span class="builtintype" id="8458979">nil</span>&nbsp;<span class="op" id="8458983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458987">t</span><span class="op" id="8458988">.</span><span class="ident" id="8458989">Fatal</span><span class="op" id="8458994">(</span><span class="string" id="8458995">&#34;EncodeAll:&#34;</span><span class="op" id="8459007">,</span>&nbsp;<span class="ident" id="8459009">err</span><span class="op" id="8459012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8459015">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459018">g1</span><span class="op" id="8459020">,</span>&nbsp;<span class="ident" id="8459022">err</span>&nbsp;<span class="op" id="8459026">:=</span>&nbsp;<span class="ident" id="8459029">DecodeAll</span><span class="op" id="8459038">(</span><span class="op" id="8459039">&amp;</span><span class="ident" id="8459040">buf</span><span class="op" id="8459043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8459046">if</span>&nbsp;<span class="ident" id="8459049">err</span>&nbsp;<span class="op" id="8459053">!=</span>&nbsp;<span class="builtintype" id="8459056">nil</span>&nbsp;<span class="op" id="8459060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459064">t</span><span class="op" id="8459065">.</span><span class="ident" id="8459066">Fatal</span><span class="op" id="8459071">(</span><span class="string" id="8459072">&#34;DecodeAll:&#34;</span><span class="op" id="8459084">,</span>&nbsp;<span class="ident" id="8459086">err</span><span class="op" id="8459089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8459092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8459095">if</span>&nbsp;<span class="ident" id="8459098">g0</span><span class="op" id="8459100">.</span><span class="ident" id="8459101">LoopCount</span>&nbsp;<span class="op" id="8459111">!=</span>&nbsp;<span class="ident" id="8459114">g1</span><span class="op" id="8459116">.</span><span class="ident" id="8459117">LoopCount</span>&nbsp;<span class="op" id="8459127">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459131">t</span><span class="op" id="8459132">.</span><span class="ident" id="8459133">Errorf</span><span class="op" id="8459139">(</span><span class="string" id="8459140">&#34;loop&nbsp;counts&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="8459171">,</span>&nbsp;<span class="ident" id="8459173">g0</span><span class="op" id="8459175">.</span><span class="ident" id="8459176">LoopCount</span><span class="op" id="8459185">,</span>&nbsp;<span class="ident" id="8459187">g1</span><span class="op" id="8459189">.</span><span class="ident" id="8459190">LoopCount</span><span class="op" id="8459199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8459202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8459205">for</span>&nbsp;<span class="ident" id="8459209">i</span>&nbsp;<span class="op" id="8459211">:=</span>&nbsp;<span class="keyword" id="8459214">range</span>&nbsp;<span class="ident" id="8459220">g0</span><span class="op" id="8459222">.</span><span class="ident" id="8459223">Image</span>&nbsp;<span class="op" id="8459229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459233">m0</span><span class="op" id="8459235">,</span>&nbsp;<span class="ident" id="8459237">m1</span>&nbsp;<span class="op" id="8459240">:=</span>&nbsp;<span class="ident" id="8459243">g0</span><span class="op" id="8459245">.</span><span class="ident" id="8459246">Image</span><span class="op" id="8459251">[</span><span class="ident" id="8459252">i</span><span class="op" id="8459253">]</span><span class="op" id="8459254">,</span>&nbsp;<span class="ident" id="8459256">g1</span><span class="op" id="8459258">.</span><span class="ident" id="8459259">Image</span><span class="op" id="8459264">[</span><span class="ident" id="8459265">i</span><span class="op" id="8459266">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8459270">if</span>&nbsp;<span class="ident" id="8459273">m0</span><span class="op" id="8459275">.</span><span class="ident" id="8459276">Bounds</span><span class="op" id="8459282">(</span><span class="op" id="8459283">)</span>&nbsp;<span class="op" id="8459285">!=</span>&nbsp;<span class="ident" id="8459288">m1</span><span class="op" id="8459290">.</span><span class="ident" id="8459291">Bounds</span><span class="op" id="8459297">(</span><span class="op" id="8459298">)</span>&nbsp;<span class="op" id="8459300">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459305">t</span><span class="op" id="8459306">.</span><span class="ident" id="8459307">Errorf</span><span class="op" id="8459313">(</span><span class="string" id="8459314">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="8459344">,</span>&nbsp;<span class="ident" id="8459346">frames</span><span class="op" id="8459352">[</span><span class="ident" id="8459353">i</span><span class="op" id="8459354">]</span><span class="op" id="8459355">,</span>&nbsp;<span class="ident" id="8459357">m0</span><span class="op" id="8459359">.</span><span class="ident" id="8459360">Bounds</span><span class="op" id="8459366">(</span><span class="op" id="8459367">)</span><span class="op" id="8459368">,</span>&nbsp;<span class="ident" id="8459370">m1</span><span class="op" id="8459372">.</span><span class="ident" id="8459373">Bounds</span><span class="op" id="8459379">(</span><span class="op" id="8459380">)</span><span class="op" id="8459381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8459385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459389">d0</span><span class="op" id="8459391">,</span>&nbsp;<span class="ident" id="8459393">d1</span>&nbsp;<span class="op" id="8459396">:=</span>&nbsp;<span class="ident" id="8459399">g0</span><span class="op" id="8459401">.</span><span class="ident" id="8459402">Delay</span><span class="op" id="8459407">[</span><span class="ident" id="8459408">i</span><span class="op" id="8459409">]</span><span class="op" id="8459410">,</span>&nbsp;<span class="ident" id="8459412">g1</span><span class="op" id="8459414">.</span><span class="ident" id="8459415">Delay</span><span class="op" id="8459420">[</span><span class="ident" id="8459421">i</span><span class="op" id="8459422">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8459426">if</span>&nbsp;<span class="ident" id="8459429">d0</span>&nbsp;<span class="op" id="8459432">!=</span>&nbsp;<span class="ident" id="8459435">d1</span>&nbsp;<span class="op" id="8459438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459443">t</span><span class="op" id="8459444">.</span><span class="ident" id="8459445">Errorf</span><span class="op" id="8459451">(</span><span class="string" id="8459452">&#34;%s:&nbsp;delay&nbsp;values&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="8459488">,</span>&nbsp;<span class="ident" id="8459490">frames</span><span class="op" id="8459496">[</span><span class="ident" id="8459497">i</span><span class="op" id="8459498">]</span><span class="op" id="8459499">,</span>&nbsp;<span class="ident" id="8459501">d0</span><span class="op" id="8459503">,</span>&nbsp;<span class="ident" id="8459505">d1</span><span class="op" id="8459507">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8459511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8459514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459518">g1</span><span class="op" id="8459520">.</span><span class="ident" id="8459521">Delay</span>&nbsp;<span class="op" id="8459527">=</span>&nbsp;<span class="builtinfunc" id="8459529">make</span><span class="op" id="8459533">(</span><span class="op" id="8459534">[</span><span class="op" id="8459535">]</span><span class="builtintype" id="8459536">int</span><span class="op" id="8459539">,</span>&nbsp;<span class="num" id="8459541">1</span><span class="op" id="8459542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8459545">if</span>&nbsp;<span class="ident" id="8459548">err</span>&nbsp;<span class="op" id="8459552">:=</span>&nbsp;<span class="ident" id="8459555">EncodeAll</span><span class="op" id="8459564">(</span><span class="ident" id="8459565">ioutil</span><span class="op" id="8459571">.</span><span class="ident" id="8459572">Discard</span><span class="op" id="8459579">,</span>&nbsp;<span class="ident" id="8459581">g1</span><span class="op" id="8459583">)</span><span class="op" id="8459584">;</span>&nbsp;<span class="ident" id="8459586">err</span>&nbsp;<span class="op" id="8459590">==</span>&nbsp;<span class="builtintype" id="8459593">nil</span>&nbsp;<span class="op" id="8459597">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459601">t</span><span class="op" id="8459602">.</span><span class="ident" id="8459603">Error</span><span class="op" id="8459608">(</span><span class="string" id="8459609">&#34;expected&nbsp;error&nbsp;from&nbsp;mismatched&nbsp;delay&nbsp;and&nbsp;image&nbsp;slice&nbsp;lengths&#34;</span><span class="op" id="8459671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8459674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8459677">if</span>&nbsp;<span class="ident" id="8459680">err</span>&nbsp;<span class="op" id="8459684">:=</span>&nbsp;<span class="ident" id="8459687">EncodeAll</span><span class="op" id="8459696">(</span><span class="ident" id="8459697">ioutil</span><span class="op" id="8459703">.</span><span class="ident" id="8459704">Discard</span><span class="op" id="8459711">,</span>&nbsp;<span class="op" id="8459713">&amp;</span><span class="ident" id="8459714">GIF</span><span class="op" id="8459717">{</span><span class="op" id="8459718">}</span><span class="op" id="8459719">)</span><span class="op" id="8459720">;</span>&nbsp;<span class="ident" id="8459722">err</span>&nbsp;<span class="op" id="8459726">==</span>&nbsp;<span class="builtintype" id="8459729">nil</span>&nbsp;<span class="op" id="8459733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459737">t</span><span class="op" id="8459738">.</span><span class="ident" id="8459739">Error</span><span class="op" id="8459744">(</span><span class="string" id="8459745">&#34;expected&nbsp;error&nbsp;from&nbsp;providing&nbsp;empty&nbsp;gif&#34;</span><span class="op" id="8459786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8459789">}</span><br>
<span class="lineno">175</span><span class="op" id="8459791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8459794">func</span>&nbsp;<span class="ident" id="8459799">BenchmarkEncode</span><span class="op" id="8459814">(</span><span class="ident" id="8459815">b</span>&nbsp;<span class="op" id="8459817">*</span><span class="ident" id="8459818">testing</span><span class="op" id="8459825">.</span><span class="ident" id="8459826">B</span><span class="op" id="8459827">)</span>&nbsp;<span class="op" id="8459829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459832">b</span><span class="op" id="8459833">.</span><span class="ident" id="8459834">StopTimer</span><span class="op" id="8459843">(</span><span class="op" id="8459844">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459848">bo</span>&nbsp;<span class="op" id="8459851">:=</span>&nbsp;<span class="ident" id="8459854">image</span><span class="op" id="8459859">.</span><span class="ident" id="8459860">Rect</span><span class="op" id="8459864">(</span><span class="num" id="8459865">0</span><span class="op" id="8459866">,</span>&nbsp;<span class="num" id="8459868">0</span><span class="op" id="8459869">,</span>&nbsp;<span class="num" id="8459871">640</span><span class="op" id="8459874">,</span>&nbsp;<span class="num" id="8459876">480</span><span class="op" id="8459879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459882">rnd</span>&nbsp;<span class="op" id="8459886">:=</span>&nbsp;<span class="ident" id="8459889">rand</span><span class="op" id="8459893">.</span><span class="ident" id="8459894">New</span><span class="op" id="8459897">(</span><span class="ident" id="8459898">rand</span><span class="op" id="8459902">.</span><span class="ident" id="8459903">NewSource</span><span class="op" id="8459912">(</span><span class="num" id="8459913">123</span><span class="op" id="8459916">)</span><span class="op" id="8459917">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8459921">//&nbsp;Restrict&nbsp;to&nbsp;a&nbsp;256-color&nbsp;paletted&nbsp;image&nbsp;to&nbsp;avoid&nbsp;quantization&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459992">palette</span>&nbsp;<span class="op" id="8460000">:=</span>&nbsp;<span class="builtinfunc" id="8460003">make</span><span class="op" id="8460007">(</span><span class="ident" id="8460008">color</span><span class="op" id="8460013">.</span><span class="ident" id="8460014">Palette</span><span class="op" id="8460021">,</span>&nbsp;<span class="num" id="8460023">256</span><span class="op" id="8460026">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8460029">for</span>&nbsp;<span class="ident" id="8460033">i</span>&nbsp;<span class="op" id="8460035">:=</span>&nbsp;<span class="keyword" id="8460038">range</span>&nbsp;<span class="ident" id="8460044">palette</span>&nbsp;<span class="op" id="8460052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460056">palette</span><span class="op" id="8460063">[</span><span class="ident" id="8460064">i</span><span class="op" id="8460065">]</span>&nbsp;<span class="op" id="8460067">=</span>&nbsp;<span class="ident" id="8460069">color</span><span class="op" id="8460074">.</span><span class="ident" id="8460075">RGBA</span><span class="op" id="8460079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8460084">uint8</span><span class="op" id="8460089">(</span><span class="ident" id="8460090">rnd</span><span class="op" id="8460093">.</span><span class="ident" id="8460094">Intn</span><span class="op" id="8460098">(</span><span class="num" id="8460099">256</span><span class="op" id="8460102">)</span><span class="op" id="8460103">)</span><span class="op" id="8460104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8460109">uint8</span><span class="op" id="8460114">(</span><span class="ident" id="8460115">rnd</span><span class="op" id="8460118">.</span><span class="ident" id="8460119">Intn</span><span class="op" id="8460123">(</span><span class="num" id="8460124">256</span><span class="op" id="8460127">)</span><span class="op" id="8460128">)</span><span class="op" id="8460129">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8460134">uint8</span><span class="op" id="8460139">(</span><span class="ident" id="8460140">rnd</span><span class="op" id="8460143">.</span><span class="ident" id="8460144">Intn</span><span class="op" id="8460148">(</span><span class="num" id="8460149">256</span><span class="op" id="8460152">)</span><span class="op" id="8460153">)</span><span class="op" id="8460154">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8460159">255</span><span class="op" id="8460162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8460166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8460169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460172">img</span>&nbsp;<span class="op" id="8460176">:=</span>&nbsp;<span class="ident" id="8460179">image</span><span class="op" id="8460184">.</span><span class="ident" id="8460185">NewPaletted</span><span class="op" id="8460196">(</span><span class="ident" id="8460197">image</span><span class="op" id="8460202">.</span><span class="ident" id="8460203">Rect</span><span class="op" id="8460207">(</span><span class="num" id="8460208">0</span><span class="op" id="8460209">,</span>&nbsp;<span class="num" id="8460211">0</span><span class="op" id="8460212">,</span>&nbsp;<span class="num" id="8460214">640</span><span class="op" id="8460217">,</span>&nbsp;<span class="num" id="8460219">480</span><span class="op" id="8460222">)</span><span class="op" id="8460223">,</span>&nbsp;<span class="ident" id="8460225">palette</span><span class="op" id="8460232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8460235">for</span>&nbsp;<span class="ident" id="8460239">y</span>&nbsp;<span class="op" id="8460241">:=</span>&nbsp;<span class="ident" id="8460244">bo</span><span class="op" id="8460246">.</span><span class="ident" id="8460247">Min</span><span class="op" id="8460250">.</span><span class="ident" id="8460251">Y</span><span class="op" id="8460252">;</span>&nbsp;<span class="ident" id="8460254">y</span>&nbsp;<span class="op" id="8460256">&lt;</span>&nbsp;<span class="ident" id="8460258">bo</span><span class="op" id="8460260">.</span><span class="ident" id="8460261">Max</span><span class="op" id="8460264">.</span><span class="ident" id="8460265">Y</span><span class="op" id="8460266">;</span>&nbsp;<span class="ident" id="8460268">y</span><span class="op" id="8460269">++</span>&nbsp;<span class="op" id="8460272">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8460276">for</span>&nbsp;<span class="ident" id="8460280">x</span>&nbsp;<span class="op" id="8460282">:=</span>&nbsp;<span class="ident" id="8460285">bo</span><span class="op" id="8460287">.</span><span class="ident" id="8460288">Min</span><span class="op" id="8460291">.</span><span class="ident" id="8460292">X</span><span class="op" id="8460293">;</span>&nbsp;<span class="ident" id="8460295">x</span>&nbsp;<span class="op" id="8460297">&lt;</span>&nbsp;<span class="ident" id="8460299">bo</span><span class="op" id="8460301">.</span><span class="ident" id="8460302">Max</span><span class="op" id="8460305">.</span><span class="ident" id="8460306">X</span><span class="op" id="8460307">;</span>&nbsp;<span class="ident" id="8460309">x</span><span class="op" id="8460310">++</span>&nbsp;<span class="op" id="8460313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460318">img</span><span class="op" id="8460321">.</span><span class="ident" id="8460322">Set</span><span class="op" id="8460325">(</span><span class="ident" id="8460326">x</span><span class="op" id="8460327">,</span>&nbsp;<span class="ident" id="8460329">y</span><span class="op" id="8460330">,</span>&nbsp;<span class="ident" id="8460332">palette</span><span class="op" id="8460339">[</span><span class="ident" id="8460340">rnd</span><span class="op" id="8460343">.</span><span class="ident" id="8460344">Intn</span><span class="op" id="8460348">(</span><span class="num" id="8460349">256</span><span class="op" id="8460352">)</span><span class="op" id="8460353">]</span><span class="op" id="8460354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8460358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8460361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460365">b</span><span class="op" id="8460366">.</span><span class="ident" id="8460367">SetBytes</span><span class="op" id="8460375">(</span><span class="num" id="8460376">640</span>&nbsp;<span class="op" id="8460380">*</span>&nbsp;<span class="num" id="8460382">480</span>&nbsp;<span class="op" id="8460386">*</span>&nbsp;<span class="num" id="8460388">4</span><span class="op" id="8460389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460392">b</span><span class="op" id="8460393">.</span><span class="ident" id="8460394">StartTimer</span><span class="op" id="8460404">(</span><span class="op" id="8460405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8460408">for</span>&nbsp;<span class="ident" id="8460412">i</span>&nbsp;<span class="op" id="8460414">:=</span>&nbsp;<span class="num" id="8460417">0</span><span class="op" id="8460418">;</span>&nbsp;<span class="ident" id="8460420">i</span>&nbsp;<span class="op" id="8460422">&lt;</span>&nbsp;<span class="ident" id="8460424">b</span><span class="op" id="8460425">.</span><span class="ident" id="8460426">N</span><span class="op" id="8460427">;</span>&nbsp;<span class="ident" id="8460429">i</span><span class="op" id="8460430">++</span>&nbsp;<span class="op" id="8460433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460437">Encode</span><span class="op" id="8460443">(</span><span class="ident" id="8460444">ioutil</span><span class="op" id="8460450">.</span><span class="ident" id="8460451">Discard</span><span class="op" id="8460458">,</span>&nbsp;<span class="ident" id="8460460">img</span><span class="op" id="8460463">,</span>&nbsp;<span class="builtintype" id="8460465">nil</span><span class="op" id="8460468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8460471">}</span><br>
<span class="lineno">205</span><span class="op" id="8460473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8460476">func</span>&nbsp;<span class="ident" id="8460481">BenchmarkQuantizedEncode</span><span class="op" id="8460505">(</span><span class="ident" id="8460506">b</span>&nbsp;<span class="op" id="8460508">*</span><span class="ident" id="8460509">testing</span><span class="op" id="8460516">.</span><span class="ident" id="8460517">B</span><span class="op" id="8460518">)</span>&nbsp;<span class="op" id="8460520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460523">b</span><span class="op" id="8460524">.</span><span class="ident" id="8460525">StopTimer</span><span class="op" id="8460534">(</span><span class="op" id="8460535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460538">img</span>&nbsp;<span class="op" id="8460542">:=</span>&nbsp;<span class="ident" id="8460545">image</span><span class="op" id="8460550">.</span><span class="ident" id="8460551">NewRGBA</span><span class="op" id="8460558">(</span><span class="ident" id="8460559">image</span><span class="op" id="8460564">.</span><span class="ident" id="8460565">Rect</span><span class="op" id="8460569">(</span><span class="num" id="8460570">0</span><span class="op" id="8460571">,</span>&nbsp;<span class="num" id="8460573">0</span><span class="op" id="8460574">,</span>&nbsp;<span class="num" id="8460576">640</span><span class="op" id="8460579">,</span>&nbsp;<span class="num" id="8460581">480</span><span class="op" id="8460584">)</span><span class="op" id="8460585">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460588">bo</span>&nbsp;<span class="op" id="8460591">:=</span>&nbsp;<span class="ident" id="8460594">img</span><span class="op" id="8460597">.</span><span class="ident" id="8460598">Bounds</span><span class="op" id="8460604">(</span><span class="op" id="8460605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460608">rnd</span>&nbsp;<span class="op" id="8460612">:=</span>&nbsp;<span class="ident" id="8460615">rand</span><span class="op" id="8460619">.</span><span class="ident" id="8460620">New</span><span class="op" id="8460623">(</span><span class="ident" id="8460624">rand</span><span class="op" id="8460628">.</span><span class="ident" id="8460629">NewSource</span><span class="op" id="8460638">(</span><span class="num" id="8460639">123</span><span class="op" id="8460642">)</span><span class="op" id="8460643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8460646">for</span>&nbsp;<span class="ident" id="8460650">y</span>&nbsp;<span class="op" id="8460652">:=</span>&nbsp;<span class="ident" id="8460655">bo</span><span class="op" id="8460657">.</span><span class="ident" id="8460658">Min</span><span class="op" id="8460661">.</span><span class="ident" id="8460662">Y</span><span class="op" id="8460663">;</span>&nbsp;<span class="ident" id="8460665">y</span>&nbsp;<span class="op" id="8460667">&lt;</span>&nbsp;<span class="ident" id="8460669">bo</span><span class="op" id="8460671">.</span><span class="ident" id="8460672">Max</span><span class="op" id="8460675">.</span><span class="ident" id="8460676">Y</span><span class="op" id="8460677">;</span>&nbsp;<span class="ident" id="8460679">y</span><span class="op" id="8460680">++</span>&nbsp;<span class="op" id="8460683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8460687">for</span>&nbsp;<span class="ident" id="8460691">x</span>&nbsp;<span class="op" id="8460693">:=</span>&nbsp;<span class="ident" id="8460696">bo</span><span class="op" id="8460698">.</span><span class="ident" id="8460699">Min</span><span class="op" id="8460702">.</span><span class="ident" id="8460703">X</span><span class="op" id="8460704">;</span>&nbsp;<span class="ident" id="8460706">x</span>&nbsp;<span class="op" id="8460708">&lt;</span>&nbsp;<span class="ident" id="8460710">bo</span><span class="op" id="8460712">.</span><span class="ident" id="8460713">Max</span><span class="op" id="8460716">.</span><span class="ident" id="8460717">X</span><span class="op" id="8460718">;</span>&nbsp;<span class="ident" id="8460720">x</span><span class="op" id="8460721">++</span>&nbsp;<span class="op" id="8460724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460729">img</span><span class="op" id="8460732">.</span><span class="ident" id="8460733">SetRGBA</span><span class="op" id="8460740">(</span><span class="ident" id="8460741">x</span><span class="op" id="8460742">,</span>&nbsp;<span class="ident" id="8460744">y</span><span class="op" id="8460745">,</span>&nbsp;<span class="ident" id="8460747">color</span><span class="op" id="8460752">.</span><span class="ident" id="8460753">RGBA</span><span class="op" id="8460757">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8460763">uint8</span><span class="op" id="8460768">(</span><span class="ident" id="8460769">rnd</span><span class="op" id="8460772">.</span><span class="ident" id="8460773">Intn</span><span class="op" id="8460777">(</span><span class="num" id="8460778">256</span><span class="op" id="8460781">)</span><span class="op" id="8460782">)</span><span class="op" id="8460783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8460789">uint8</span><span class="op" id="8460794">(</span><span class="ident" id="8460795">rnd</span><span class="op" id="8460798">.</span><span class="ident" id="8460799">Intn</span><span class="op" id="8460803">(</span><span class="num" id="8460804">256</span><span class="op" id="8460807">)</span><span class="op" id="8460808">)</span><span class="op" id="8460809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8460815">uint8</span><span class="op" id="8460820">(</span><span class="ident" id="8460821">rnd</span><span class="op" id="8460824">.</span><span class="ident" id="8460825">Intn</span><span class="op" id="8460829">(</span><span class="num" id="8460830">256</span><span class="op" id="8460833">)</span><span class="op" id="8460834">)</span><span class="op" id="8460835">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8460841">255</span><span class="op" id="8460844">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8460849">}</span><span class="op" id="8460850">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8460854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8460857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460860">b</span><span class="op" id="8460861">.</span><span class="ident" id="8460862">SetBytes</span><span class="op" id="8460870">(</span><span class="num" id="8460871">640</span>&nbsp;<span class="op" id="8460875">*</span>&nbsp;<span class="num" id="8460877">480</span>&nbsp;<span class="op" id="8460881">*</span>&nbsp;<span class="num" id="8460883">4</span><span class="op" id="8460884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460887">b</span><span class="op" id="8460888">.</span><span class="ident" id="8460889">StartTimer</span><span class="op" id="8460899">(</span><span class="op" id="8460900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8460903">for</span>&nbsp;<span class="ident" id="8460907">i</span>&nbsp;<span class="op" id="8460909">:=</span>&nbsp;<span class="num" id="8460912">0</span><span class="op" id="8460913">;</span>&nbsp;<span class="ident" id="8460915">i</span>&nbsp;<span class="op" id="8460917">&lt;</span>&nbsp;<span class="ident" id="8460919">b</span><span class="op" id="8460920">.</span><span class="ident" id="8460921">N</span><span class="op" id="8460922">;</span>&nbsp;<span class="ident" id="8460924">i</span><span class="op" id="8460925">++</span>&nbsp;<span class="op" id="8460928">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460932">Encode</span><span class="op" id="8460938">(</span><span class="ident" id="8460939">ioutil</span><span class="op" id="8460945">.</span><span class="ident" id="8460946">Discard</span><span class="op" id="8460953">,</span>&nbsp;<span class="ident" id="8460955">img</span><span class="op" id="8460958">,</span>&nbsp;<span class="builtintype" id="8460960">nil</span><span class="op" id="8460963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8460966">}</span><br>
<span class="lineno"></span><span class="op" id="8460968">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
