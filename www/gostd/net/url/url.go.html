<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/url</h2>
<ul>
<li><a href="/gostd/net/url/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/url/url.go.html" class="current">url.go</a></li>
<li><a href="/gostd/net/url/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3652855">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3652910">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3652964">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3653015">//&nbsp;Package&nbsp;url&nbsp;parses&nbsp;URLs&nbsp;and&nbsp;implements&nbsp;query&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="comment" id="3653073">//&nbsp;See&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3653090">package</span>&nbsp;<span class="ident" id="3653098">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3653103">import</span>&nbsp;<span class="op" id="3653110">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3653113">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3653122">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3653132">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3653140">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3653151">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3653161">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3653164">//&nbsp;Error&nbsp;reports&nbsp;an&nbsp;error&nbsp;and&nbsp;the&nbsp;operation&nbsp;and&nbsp;URL&nbsp;that&nbsp;caused&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3653232">type</span>&nbsp;<span class="ident" id="3653237">Error</span>&nbsp;<span class="keyword" id="3653243">struct</span>&nbsp;<span class="op" id="3653250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653253">Op</span>&nbsp;&nbsp;<span class="builtintype" id="3653257">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653265">URL</span>&nbsp;<span class="builtintype" id="3653269">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653277">Err</span>&nbsp;<span class="builtintype" id="3653281">error</span><br>
<span class="lineno"></span><span class="op" id="3653287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3653290">func</span>&nbsp;<span class="op" id="3653295">(</span><span class="ident" id="3653296">e</span>&nbsp;<span class="op" id="3653298">*</span><span class="ident" id="3653299">Error</span><span class="op" id="3653304">)</span>&nbsp;<span class="ident" id="3653306">Error</span><span class="op" id="3653311">(</span><span class="op" id="3653312">)</span>&nbsp;<span class="builtintype" id="3653314">string</span>&nbsp;<span class="op" id="3653321">{</span>&nbsp;<span class="keyword" id="3653323">return</span>&nbsp;<span class="ident" id="3653330">e</span><span class="op" id="3653331">.</span><span class="ident" id="3653332">Op</span>&nbsp;<span class="op" id="3653335">+</span>&nbsp;<span class="string" id="3653337">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3653341">+</span>&nbsp;<span class="ident" id="3653343">e</span><span class="op" id="3653344">.</span><span class="ident" id="3653345">URL</span>&nbsp;<span class="op" id="3653349">+</span>&nbsp;<span class="string" id="3653351">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3653356">+</span>&nbsp;<span class="ident" id="3653358">e</span><span class="op" id="3653359">.</span><span class="ident" id="3653360">Err</span><span class="op" id="3653363">.</span><span class="ident" id="3653364">Error</span><span class="op" id="3653369">(</span><span class="op" id="3653370">)</span>&nbsp;<span class="op" id="3653372">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3653375">func</span>&nbsp;<span class="ident" id="3653380">ishex</span><span class="op" id="3653385">(</span><span class="ident" id="3653386">c</span>&nbsp;<span class="builtintype" id="3653388">byte</span><span class="op" id="3653392">)</span>&nbsp;<span class="builtintype" id="3653394">bool</span>&nbsp;<span class="op" id="3653399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653402">switch</span>&nbsp;<span class="op" id="3653409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653412">case</span>&nbsp;<span class="string" id="3653417">&#39;0&#39;</span>&nbsp;<span class="op" id="3653421">&lt;=</span>&nbsp;<span class="ident" id="3653424">c</span>&nbsp;<span class="op" id="3653426">&amp;&amp;</span>&nbsp;<span class="ident" id="3653429">c</span>&nbsp;<span class="op" id="3653431">&lt;=</span>&nbsp;<span class="string" id="3653434">&#39;9&#39;</span><span class="op" id="3653437">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653441">return</span>&nbsp;<span class="builtintype" id="3653448">true</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653454">case</span>&nbsp;<span class="string" id="3653459">&#39;a&#39;</span>&nbsp;<span class="op" id="3653463">&lt;=</span>&nbsp;<span class="ident" id="3653466">c</span>&nbsp;<span class="op" id="3653468">&amp;&amp;</span>&nbsp;<span class="ident" id="3653471">c</span>&nbsp;<span class="op" id="3653473">&lt;=</span>&nbsp;<span class="string" id="3653476">&#39;f&#39;</span><span class="op" id="3653479">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653483">return</span>&nbsp;<span class="builtintype" id="3653490">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653496">case</span>&nbsp;<span class="string" id="3653501">&#39;A&#39;</span>&nbsp;<span class="op" id="3653505">&lt;=</span>&nbsp;<span class="ident" id="3653508">c</span>&nbsp;<span class="op" id="3653510">&amp;&amp;</span>&nbsp;<span class="ident" id="3653513">c</span>&nbsp;<span class="op" id="3653515">&lt;=</span>&nbsp;<span class="string" id="3653518">&#39;F&#39;</span><span class="op" id="3653521">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653525">return</span>&nbsp;<span class="builtintype" id="3653532">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3653538">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653541">return</span>&nbsp;<span class="builtintype" id="3653548">false</span><br>
<span class="lineno"></span><span class="op" id="3653554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3653557">func</span>&nbsp;<span class="ident" id="3653562">unhex</span><span class="op" id="3653567">(</span><span class="ident" id="3653568">c</span>&nbsp;<span class="builtintype" id="3653570">byte</span><span class="op" id="3653574">)</span>&nbsp;<span class="builtintype" id="3653576">byte</span>&nbsp;<span class="op" id="3653581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653584">switch</span>&nbsp;<span class="op" id="3653591">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653594">case</span>&nbsp;<span class="string" id="3653599">&#39;0&#39;</span>&nbsp;<span class="op" id="3653603">&lt;=</span>&nbsp;<span class="ident" id="3653606">c</span>&nbsp;<span class="op" id="3653608">&amp;&amp;</span>&nbsp;<span class="ident" id="3653611">c</span>&nbsp;<span class="op" id="3653613">&lt;=</span>&nbsp;<span class="string" id="3653616">&#39;9&#39;</span><span class="op" id="3653619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653623">return</span>&nbsp;<span class="ident" id="3653630">c</span>&nbsp;<span class="op" id="3653632">-</span>&nbsp;<span class="string" id="3653634">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653639">case</span>&nbsp;<span class="string" id="3653644">&#39;a&#39;</span>&nbsp;<span class="op" id="3653648">&lt;=</span>&nbsp;<span class="ident" id="3653651">c</span>&nbsp;<span class="op" id="3653653">&amp;&amp;</span>&nbsp;<span class="ident" id="3653656">c</span>&nbsp;<span class="op" id="3653658">&lt;=</span>&nbsp;<span class="string" id="3653661">&#39;f&#39;</span><span class="op" id="3653664">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653668">return</span>&nbsp;<span class="ident" id="3653675">c</span>&nbsp;<span class="op" id="3653677">-</span>&nbsp;<span class="string" id="3653679">&#39;a&#39;</span>&nbsp;<span class="op" id="3653683">+</span>&nbsp;<span class="num" id="3653685">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653689">case</span>&nbsp;<span class="string" id="3653694">&#39;A&#39;</span>&nbsp;<span class="op" id="3653698">&lt;=</span>&nbsp;<span class="ident" id="3653701">c</span>&nbsp;<span class="op" id="3653703">&amp;&amp;</span>&nbsp;<span class="ident" id="3653706">c</span>&nbsp;<span class="op" id="3653708">&lt;=</span>&nbsp;<span class="string" id="3653711">&#39;F&#39;</span><span class="op" id="3653714">:</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653718">return</span>&nbsp;<span class="ident" id="3653725">c</span>&nbsp;<span class="op" id="3653727">-</span>&nbsp;<span class="string" id="3653729">&#39;A&#39;</span>&nbsp;<span class="op" id="3653733">+</span>&nbsp;<span class="num" id="3653735">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3653739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653742">return</span>&nbsp;<span class="num" id="3653749">0</span><br>
<span class="lineno"></span><span class="op" id="3653751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="3653754">type</span>&nbsp;<span class="ident" id="3653759">encoding</span>&nbsp;<span class="builtintype" id="3653768">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3653773">const</span>&nbsp;<span class="op" id="3653779">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653782">encodePath</span>&nbsp;<span class="ident" id="3653793">encoding</span>&nbsp;<span class="op" id="3653802">=</span>&nbsp;<span class="num" id="3653804">1</span>&nbsp;<span class="op" id="3653806">+</span>&nbsp;<span class="ident" id="3653808">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653814">encodeUserPassword</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653834">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3653856">encodeFragment</span><br>
<span class="lineno"></span><span class="op" id="3653871">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3653874">type</span>&nbsp;<span class="ident" id="3653879">EscapeError</span>&nbsp;<span class="builtintype" id="3653891">string</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3653899">func</span>&nbsp;<span class="op" id="3653904">(</span><span class="ident" id="3653905">e</span>&nbsp;<span class="ident" id="3653907">EscapeError</span><span class="op" id="3653918">)</span>&nbsp;<span class="ident" id="3653920">Error</span><span class="op" id="3653925">(</span><span class="op" id="3653926">)</span>&nbsp;<span class="builtintype" id="3653928">string</span>&nbsp;<span class="op" id="3653935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3653938">return</span>&nbsp;<span class="string" id="3653945">&#34;invalid&nbsp;URL&nbsp;escape&nbsp;&#34;</span>&nbsp;<span class="op" id="3653967">+</span>&nbsp;<span class="ident" id="3653969">strconv</span><span class="op" id="3653976">.</span><span class="ident" id="3653977">Quote</span><span class="op" id="3653982">(</span><span class="builtintype" id="3653983">string</span><span class="op" id="3653989">(</span><span class="ident" id="3653990">e</span><span class="op" id="3653991">)</span><span class="op" id="3653992">)</span><br>
<span class="lineno"></span><span class="op" id="3653994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3653997">//&nbsp;Return&nbsp;true&nbsp;if&nbsp;the&nbsp;specified&nbsp;character&nbsp;should&nbsp;be&nbsp;escaped&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3654062">//&nbsp;appearing&nbsp;in&nbsp;a&nbsp;URL&nbsp;string,&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3654115">func</span>&nbsp;<span class="ident" id="3654120">shouldEscape</span><span class="op" id="3654132">(</span><span class="ident" id="3654133">c</span>&nbsp;<span class="builtintype" id="3654135">byte</span><span class="op" id="3654139">,</span>&nbsp;<span class="ident" id="3654141">mode</span>&nbsp;<span class="ident" id="3654146">encoding</span><span class="op" id="3654154">)</span>&nbsp;<span class="builtintype" id="3654156">bool</span>&nbsp;<span class="op" id="3654161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3654164">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(alphanum)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3654207">if</span>&nbsp;<span class="string" id="3654210">&#39;A&#39;</span>&nbsp;<span class="op" id="3654214">&lt;=</span>&nbsp;<span class="ident" id="3654217">c</span>&nbsp;<span class="op" id="3654219">&amp;&amp;</span>&nbsp;<span class="ident" id="3654222">c</span>&nbsp;<span class="op" id="3654224">&lt;=</span>&nbsp;<span class="string" id="3654227">&#39;Z&#39;</span>&nbsp;<span class="op" id="3654231">||</span>&nbsp;<span class="string" id="3654234">&#39;a&#39;</span>&nbsp;<span class="op" id="3654238">&lt;=</span>&nbsp;<span class="ident" id="3654241">c</span>&nbsp;<span class="op" id="3654243">&amp;&amp;</span>&nbsp;<span class="ident" id="3654246">c</span>&nbsp;<span class="op" id="3654248">&lt;=</span>&nbsp;<span class="string" id="3654251">&#39;z&#39;</span>&nbsp;<span class="op" id="3654255">||</span>&nbsp;<span class="string" id="3654258">&#39;0&#39;</span>&nbsp;<span class="op" id="3654262">&lt;=</span>&nbsp;<span class="ident" id="3654265">c</span>&nbsp;<span class="op" id="3654267">&amp;&amp;</span>&nbsp;<span class="ident" id="3654270">c</span>&nbsp;<span class="op" id="3654272">&lt;=</span>&nbsp;<span class="string" id="3654275">&#39;9&#39;</span>&nbsp;<span class="op" id="3654279">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3654283">return</span>&nbsp;<span class="builtintype" id="3654290">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3654297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3654301">switch</span>&nbsp;<span class="ident" id="3654308">c</span>&nbsp;<span class="op" id="3654310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3654313">case</span>&nbsp;<span class="string" id="3654318">&#39;-&#39;</span><span class="op" id="3654321">,</span>&nbsp;<span class="string" id="3654323">&#39;_&#39;</span><span class="op" id="3654326">,</span>&nbsp;<span class="string" id="3654328">&#39;.&#39;</span><span class="op" id="3654331">,</span>&nbsp;<span class="string" id="3654333">&#39;~&#39;</span><span class="op" id="3654336">:</span>&nbsp;<span class="comment" id="3654338">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(mark)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3654378">return</span>&nbsp;<span class="builtintype" id="3654385">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3654393">case</span>&nbsp;<span class="string" id="3654398">&#39;$&#39;</span><span class="op" id="3654401">,</span>&nbsp;<span class="string" id="3654403">&#39;&amp;&#39;</span><span class="op" id="3654406">,</span>&nbsp;<span class="string" id="3654408">&#39;+&#39;</span><span class="op" id="3654411">,</span>&nbsp;<span class="string" id="3654413">&#39;,&#39;</span><span class="op" id="3654416">,</span>&nbsp;<span class="string" id="3654418">&#39;/&#39;</span><span class="op" id="3654421">,</span>&nbsp;<span class="string" id="3654423">&#39;:&#39;</span><span class="op" id="3654426">,</span>&nbsp;<span class="string" id="3654428">&#39;;&#39;</span><span class="op" id="3654431">,</span>&nbsp;<span class="string" id="3654433">&#39;=&#39;</span><span class="op" id="3654436">,</span>&nbsp;<span class="string" id="3654438">&#39;?&#39;</span><span class="op" id="3654441">,</span>&nbsp;<span class="string" id="3654443">&#39;@&#39;</span><span class="op" id="3654446">:</span>&nbsp;<span class="comment" id="3654448">//&nbsp;§2.2&nbsp;Reserved&nbsp;characters&nbsp;(reserved)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3654490">//&nbsp;Different&nbsp;sections&nbsp;of&nbsp;the&nbsp;URL&nbsp;allow&nbsp;a&nbsp;few&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3654540">//&nbsp;the&nbsp;reserved&nbsp;characters&nbsp;to&nbsp;appear&nbsp;unescaped.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3654590">switch</span>&nbsp;<span class="ident" id="3654597">mode</span>&nbsp;<span class="op" id="3654602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3654606">case</span>&nbsp;<span class="ident" id="3654611">encodePath</span><span class="op" id="3654621">:</span>&nbsp;<span class="comment" id="3654623">//&nbsp;§3.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3654635">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;:&nbsp;@&nbsp;&amp;&nbsp;=&nbsp;+&nbsp;$&nbsp;but&nbsp;saves&nbsp;/&nbsp;;&nbsp;,&nbsp;for&nbsp;assigning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3654698">//&nbsp;meaning&nbsp;to&nbsp;individual&nbsp;path&nbsp;segments.&nbsp;This&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3654754">//&nbsp;only&nbsp;manipulates&nbsp;the&nbsp;path&nbsp;as&nbsp;a&nbsp;whole,&nbsp;so&nbsp;we&nbsp;allow&nbsp;those</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3654816">//&nbsp;last&nbsp;two&nbsp;as&nbsp;well.&nbsp;That&nbsp;leaves&nbsp;only&nbsp;?&nbsp;to&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3654870">return</span>&nbsp;<span class="ident" id="3654877">c</span>&nbsp;<span class="op" id="3654879">==</span>&nbsp;<span class="string" id="3654882">&#39;?&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3654889">case</span>&nbsp;<span class="ident" id="3654894">encodeUserPassword</span><span class="op" id="3654912">:</span>&nbsp;<span class="comment" id="3654914">//&nbsp;§3.2.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3654928">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;&#39;;&#39;,&nbsp;&#39;:&#39;,&nbsp;&#39;&amp;&#39;,&nbsp;&#39;=&#39;,&nbsp;&#39;+&#39;,&nbsp;&#39;$&#39;,&nbsp;and&nbsp;&#39;,&#39;&nbsp;in</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3654990">//&nbsp;userinfo,&nbsp;so&nbsp;we&nbsp;must&nbsp;escape&nbsp;only&nbsp;&#39;@&#39;,&nbsp;&#39;/&#39;,&nbsp;and&nbsp;&#39;?&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3655048">//&nbsp;The&nbsp;parsing&nbsp;of&nbsp;userinfo&nbsp;treats&nbsp;&#39;:&#39;&nbsp;as&nbsp;special&nbsp;so&nbsp;we&nbsp;must&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3655118">//&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3655134">return</span>&nbsp;<span class="ident" id="3655141">c</span>&nbsp;<span class="op" id="3655143">==</span>&nbsp;<span class="string" id="3655146">&#39;@&#39;</span>&nbsp;<span class="op" id="3655150">||</span>&nbsp;<span class="ident" id="3655153">c</span>&nbsp;<span class="op" id="3655155">==</span>&nbsp;<span class="string" id="3655158">&#39;/&#39;</span>&nbsp;<span class="op" id="3655162">||</span>&nbsp;<span class="ident" id="3655165">c</span>&nbsp;<span class="op" id="3655167">==</span>&nbsp;<span class="string" id="3655170">&#39;?&#39;</span>&nbsp;<span class="op" id="3655174">||</span>&nbsp;<span class="ident" id="3655177">c</span>&nbsp;<span class="op" id="3655179">==</span>&nbsp;<span class="string" id="3655182">&#39;:&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3655189">case</span>&nbsp;<span class="ident" id="3655194">encodeQueryComponent</span><span class="op" id="3655214">:</span>&nbsp;<span class="comment" id="3655216">//&nbsp;§3.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3655228">//&nbsp;The&nbsp;RFC&nbsp;reserves&nbsp;(so&nbsp;we&nbsp;must&nbsp;escape)&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3655283">return</span>&nbsp;<span class="builtintype" id="3655290">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3655298">case</span>&nbsp;<span class="ident" id="3655303">encodeFragment</span><span class="op" id="3655317">:</span>&nbsp;<span class="comment" id="3655319">//&nbsp;§4.1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3655331">//&nbsp;The&nbsp;RFC&nbsp;text&nbsp;is&nbsp;silent&nbsp;but&nbsp;the&nbsp;grammar&nbsp;allows</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3655383">//&nbsp;everything,&nbsp;so&nbsp;escape&nbsp;nothing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3655420">return</span>&nbsp;<span class="builtintype" id="3655427">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3655435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3655438">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3655442">//&nbsp;Everything&nbsp;else&nbsp;must&nbsp;be&nbsp;escaped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3655479">return</span>&nbsp;<span class="builtintype" id="3655486">true</span><br>
<span class="lineno"></span><span class="op" id="3655491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3655494">//&nbsp;QueryUnescape&nbsp;does&nbsp;the&nbsp;inverse&nbsp;transformation&nbsp;of&nbsp;QueryEscape,&nbsp;converting</span><br>
<span class="lineno"></span><span class="comment" id="3655570">//&nbsp;%AB&nbsp;into&nbsp;the&nbsp;byte&nbsp;0xAB&nbsp;and&nbsp;&#39;+&#39;&nbsp;into&nbsp;&#39;&nbsp;&#39;&nbsp;(space).&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3655645">//&nbsp;any&nbsp;%&nbsp;is&nbsp;not&nbsp;followed&nbsp;by&nbsp;two&nbsp;hexadecimal&nbsp;digits.</span><br>
<span class="lineno"></span><span class="keyword" id="3655697">func</span>&nbsp;<span class="ident" id="3655702">QueryUnescape</span><span class="op" id="3655715">(</span><span class="ident" id="3655716">s</span>&nbsp;<span class="builtintype" id="3655718">string</span><span class="op" id="3655724">)</span>&nbsp;<span class="op" id="3655726">(</span><span class="builtintype" id="3655727">string</span><span class="op" id="3655733">,</span>&nbsp;<span class="builtintype" id="3655735">error</span><span class="op" id="3655740">)</span>&nbsp;<span class="op" id="3655742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3655745">return</span>&nbsp;<span class="ident" id="3655752">unescape</span><span class="op" id="3655760">(</span><span class="ident" id="3655761">s</span><span class="op" id="3655762">,</span>&nbsp;<span class="ident" id="3655764">encodeQueryComponent</span><span class="op" id="3655784">)</span><br>
<span class="lineno">115</span><span class="op" id="3655786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3655789">//&nbsp;unescape&nbsp;unescapes&nbsp;a&nbsp;string;&nbsp;the&nbsp;mode&nbsp;specifies</span><br>
<span class="lineno"></span><span class="comment" id="3655840">//&nbsp;which&nbsp;section&nbsp;of&nbsp;the&nbsp;URL&nbsp;string&nbsp;is&nbsp;being&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="3655895">func</span>&nbsp;<span class="ident" id="3655900">unescape</span><span class="op" id="3655908">(</span><span class="ident" id="3655909">s</span>&nbsp;<span class="builtintype" id="3655911">string</span><span class="op" id="3655917">,</span>&nbsp;<span class="ident" id="3655919">mode</span>&nbsp;<span class="ident" id="3655924">encoding</span><span class="op" id="3655932">)</span>&nbsp;<span class="op" id="3655934">(</span><span class="builtintype" id="3655935">string</span><span class="op" id="3655941">,</span>&nbsp;<span class="builtintype" id="3655943">error</span><span class="op" id="3655948">)</span>&nbsp;<span class="op" id="3655950">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3655953">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3655998">n</span>&nbsp;<span class="op" id="3656000">:=</span>&nbsp;<span class="num" id="3656003">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656006">hasPlus</span>&nbsp;<span class="op" id="3656014">:=</span>&nbsp;<span class="builtintype" id="3656017">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656024">for</span>&nbsp;<span class="ident" id="3656028">i</span>&nbsp;<span class="op" id="3656030">:=</span>&nbsp;<span class="num" id="3656033">0</span><span class="op" id="3656034">;</span>&nbsp;<span class="ident" id="3656036">i</span>&nbsp;<span class="op" id="3656038">&lt;</span>&nbsp;<span class="builtinfunc" id="3656040">len</span><span class="op" id="3656043">(</span><span class="ident" id="3656044">s</span><span class="op" id="3656045">)</span><span class="op" id="3656046">;</span>&nbsp;<span class="op" id="3656048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656052">switch</span>&nbsp;<span class="ident" id="3656059">s</span><span class="op" id="3656060">[</span><span class="ident" id="3656061">i</span><span class="op" id="3656062">]</span>&nbsp;<span class="op" id="3656064">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656068">case</span>&nbsp;<span class="string" id="3656073">&#39;%&#39;</span><span class="op" id="3656076">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656081">n</span><span class="op" id="3656082">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656088">if</span>&nbsp;<span class="ident" id="3656091">i</span><span class="op" id="3656092">+</span><span class="num" id="3656093">2</span>&nbsp;<span class="op" id="3656095">&gt;=</span>&nbsp;<span class="builtinfunc" id="3656098">len</span><span class="op" id="3656101">(</span><span class="ident" id="3656102">s</span><span class="op" id="3656103">)</span>&nbsp;<span class="op" id="3656105">||</span>&nbsp;<span class="op" id="3656108">!</span><span class="ident" id="3656109">ishex</span><span class="op" id="3656114">(</span><span class="ident" id="3656115">s</span><span class="op" id="3656116">[</span><span class="ident" id="3656117">i</span><span class="op" id="3656118">+</span><span class="num" id="3656119">1</span><span class="op" id="3656120">]</span><span class="op" id="3656121">)</span>&nbsp;<span class="op" id="3656123">||</span>&nbsp;<span class="op" id="3656126">!</span><span class="ident" id="3656127">ishex</span><span class="op" id="3656132">(</span><span class="ident" id="3656133">s</span><span class="op" id="3656134">[</span><span class="ident" id="3656135">i</span><span class="op" id="3656136">+</span><span class="num" id="3656137">2</span><span class="op" id="3656138">]</span><span class="op" id="3656139">)</span>&nbsp;<span class="op" id="3656141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656147">s</span>&nbsp;<span class="op" id="3656149">=</span>&nbsp;<span class="ident" id="3656151">s</span><span class="op" id="3656152">[</span><span class="ident" id="3656153">i</span><span class="op" id="3656154">:</span><span class="op" id="3656155">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656161">if</span>&nbsp;<span class="builtinfunc" id="3656164">len</span><span class="op" id="3656167">(</span><span class="ident" id="3656168">s</span><span class="op" id="3656169">)</span>&nbsp;<span class="op" id="3656171">&gt;</span>&nbsp;<span class="num" id="3656173">3</span>&nbsp;<span class="op" id="3656175">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656182">s</span>&nbsp;<span class="op" id="3656184">=</span>&nbsp;<span class="ident" id="3656186">s</span><span class="op" id="3656187">[</span><span class="num" id="3656188">0</span><span class="op" id="3656189">:</span><span class="num" id="3656190">3</span><span class="op" id="3656191">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3656197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656203">return</span>&nbsp;<span class="string" id="3656210">&#34;&#34;</span><span class="op" id="3656212">,</span>&nbsp;<span class="ident" id="3656214">EscapeError</span><span class="op" id="3656225">(</span><span class="ident" id="3656226">s</span><span class="op" id="3656227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3656232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656237">i</span>&nbsp;<span class="op" id="3656239">+=</span>&nbsp;<span class="num" id="3656242">3</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656246">case</span>&nbsp;<span class="string" id="3656251">&#39;+&#39;</span><span class="op" id="3656254">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656259">hasPlus</span>&nbsp;<span class="op" id="3656267">=</span>&nbsp;<span class="ident" id="3656269">mode</span>&nbsp;<span class="op" id="3656274">==</span>&nbsp;<span class="ident" id="3656277">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656301">i</span><span class="op" id="3656302">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656307">default</span><span class="op" id="3656314">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656319">i</span><span class="op" id="3656320">++</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3656325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3656328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656332">if</span>&nbsp;<span class="ident" id="3656335">n</span>&nbsp;<span class="op" id="3656337">==</span>&nbsp;<span class="num" id="3656340">0</span>&nbsp;<span class="op" id="3656342">&amp;&amp;</span>&nbsp;<span class="op" id="3656345">!</span><span class="ident" id="3656346">hasPlus</span>&nbsp;<span class="op" id="3656354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656358">return</span>&nbsp;<span class="ident" id="3656365">s</span><span class="op" id="3656366">,</span>&nbsp;<span class="builtintype" id="3656368">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3656373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656377">t</span>&nbsp;<span class="op" id="3656379">:=</span>&nbsp;<span class="builtinfunc" id="3656382">make</span><span class="op" id="3656386">(</span><span class="op" id="3656387">[</span><span class="op" id="3656388">]</span><span class="builtintype" id="3656389">byte</span><span class="op" id="3656393">,</span>&nbsp;<span class="builtinfunc" id="3656395">len</span><span class="op" id="3656398">(</span><span class="ident" id="3656399">s</span><span class="op" id="3656400">)</span><span class="op" id="3656401">-</span><span class="num" id="3656402">2</span><span class="op" id="3656403">*</span><span class="ident" id="3656404">n</span><span class="op" id="3656405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656408">j</span>&nbsp;<span class="op" id="3656410">:=</span>&nbsp;<span class="num" id="3656413">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656416">for</span>&nbsp;<span class="ident" id="3656420">i</span>&nbsp;<span class="op" id="3656422">:=</span>&nbsp;<span class="num" id="3656425">0</span><span class="op" id="3656426">;</span>&nbsp;<span class="ident" id="3656428">i</span>&nbsp;<span class="op" id="3656430">&lt;</span>&nbsp;<span class="builtinfunc" id="3656432">len</span><span class="op" id="3656435">(</span><span class="ident" id="3656436">s</span><span class="op" id="3656437">)</span><span class="op" id="3656438">;</span>&nbsp;<span class="op" id="3656440">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656444">switch</span>&nbsp;<span class="ident" id="3656451">s</span><span class="op" id="3656452">[</span><span class="ident" id="3656453">i</span><span class="op" id="3656454">]</span>&nbsp;<span class="op" id="3656456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656460">case</span>&nbsp;<span class="string" id="3656465">&#39;%&#39;</span><span class="op" id="3656468">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656473">t</span><span class="op" id="3656474">[</span><span class="ident" id="3656475">j</span><span class="op" id="3656476">]</span>&nbsp;<span class="op" id="3656478">=</span>&nbsp;<span class="ident" id="3656480">unhex</span><span class="op" id="3656485">(</span><span class="ident" id="3656486">s</span><span class="op" id="3656487">[</span><span class="ident" id="3656488">i</span><span class="op" id="3656489">+</span><span class="num" id="3656490">1</span><span class="op" id="3656491">]</span><span class="op" id="3656492">)</span><span class="op" id="3656493">&lt;&lt;</span><span class="num" id="3656495">4</span>&nbsp;<span class="op" id="3656497">|</span>&nbsp;<span class="ident" id="3656499">unhex</span><span class="op" id="3656504">(</span><span class="ident" id="3656505">s</span><span class="op" id="3656506">[</span><span class="ident" id="3656507">i</span><span class="op" id="3656508">+</span><span class="num" id="3656509">2</span><span class="op" id="3656510">]</span><span class="op" id="3656511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656516">j</span><span class="op" id="3656517">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656523">i</span>&nbsp;<span class="op" id="3656525">+=</span>&nbsp;<span class="num" id="3656528">3</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656532">case</span>&nbsp;<span class="string" id="3656537">&#39;+&#39;</span><span class="op" id="3656540">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656545">if</span>&nbsp;<span class="ident" id="3656548">mode</span>&nbsp;<span class="op" id="3656553">==</span>&nbsp;<span class="ident" id="3656556">encodeQueryComponent</span>&nbsp;<span class="op" id="3656577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656583">t</span><span class="op" id="3656584">[</span><span class="ident" id="3656585">j</span><span class="op" id="3656586">]</span>&nbsp;<span class="op" id="3656588">=</span>&nbsp;<span class="string" id="3656590">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3656597">}</span>&nbsp;<span class="keyword" id="3656599">else</span>&nbsp;<span class="op" id="3656604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656610">t</span><span class="op" id="3656611">[</span><span class="ident" id="3656612">j</span><span class="op" id="3656613">]</span>&nbsp;<span class="op" id="3656615">=</span>&nbsp;<span class="string" id="3656617">&#39;+&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3656624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656629">j</span><span class="op" id="3656630">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656636">i</span><span class="op" id="3656637">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656642">default</span><span class="op" id="3656649">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656654">t</span><span class="op" id="3656655">[</span><span class="ident" id="3656656">j</span><span class="op" id="3656657">]</span>&nbsp;<span class="op" id="3656659">=</span>&nbsp;<span class="ident" id="3656661">s</span><span class="op" id="3656662">[</span><span class="ident" id="3656663">i</span><span class="op" id="3656664">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656669">j</span><span class="op" id="3656670">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656676">i</span><span class="op" id="3656677">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3656682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3656685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656688">return</span>&nbsp;<span class="builtintype" id="3656695">string</span><span class="op" id="3656701">(</span><span class="ident" id="3656702">t</span><span class="op" id="3656703">)</span><span class="op" id="3656704">,</span>&nbsp;<span class="builtintype" id="3656706">nil</span><br>
<span class="lineno">170</span><span class="op" id="3656710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3656713">//&nbsp;QueryEscape&nbsp;escapes&nbsp;the&nbsp;string&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;safely&nbsp;placed</span><br>
<span class="lineno"></span><span class="comment" id="3656774">//&nbsp;inside&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno"></span><span class="keyword" id="3656797">func</span>&nbsp;<span class="ident" id="3656802">QueryEscape</span><span class="op" id="3656813">(</span><span class="ident" id="3656814">s</span>&nbsp;<span class="builtintype" id="3656816">string</span><span class="op" id="3656822">)</span>&nbsp;<span class="builtintype" id="3656824">string</span>&nbsp;<span class="op" id="3656831">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656834">return</span>&nbsp;<span class="ident" id="3656841">escape</span><span class="op" id="3656847">(</span><span class="ident" id="3656848">s</span><span class="op" id="3656849">,</span>&nbsp;<span class="ident" id="3656851">encodeQueryComponent</span><span class="op" id="3656871">)</span><br>
<span class="lineno"></span><span class="op" id="3656873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3656876">func</span>&nbsp;<span class="ident" id="3656881">escape</span><span class="op" id="3656887">(</span><span class="ident" id="3656888">s</span>&nbsp;<span class="builtintype" id="3656890">string</span><span class="op" id="3656896">,</span>&nbsp;<span class="ident" id="3656898">mode</span>&nbsp;<span class="ident" id="3656903">encoding</span><span class="op" id="3656911">)</span>&nbsp;<span class="builtintype" id="3656913">string</span>&nbsp;<span class="op" id="3656920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656923">spaceCount</span><span class="op" id="3656933">,</span>&nbsp;<span class="ident" id="3656935">hexCount</span>&nbsp;<span class="op" id="3656944">:=</span>&nbsp;<span class="num" id="3656947">0</span><span class="op" id="3656948">,</span>&nbsp;<span class="num" id="3656950">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656953">for</span>&nbsp;<span class="ident" id="3656957">i</span>&nbsp;<span class="op" id="3656959">:=</span>&nbsp;<span class="num" id="3656962">0</span><span class="op" id="3656963">;</span>&nbsp;<span class="ident" id="3656965">i</span>&nbsp;<span class="op" id="3656967">&lt;</span>&nbsp;<span class="builtinfunc" id="3656969">len</span><span class="op" id="3656972">(</span><span class="ident" id="3656973">s</span><span class="op" id="3656974">)</span><span class="op" id="3656975">;</span>&nbsp;<span class="ident" id="3656977">i</span><span class="op" id="3656978">++</span>&nbsp;<span class="op" id="3656981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3656985">c</span>&nbsp;<span class="op" id="3656987">:=</span>&nbsp;<span class="ident" id="3656990">s</span><span class="op" id="3656991">[</span><span class="ident" id="3656992">i</span><span class="op" id="3656993">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3656997">if</span>&nbsp;<span class="ident" id="3657000">shouldEscape</span><span class="op" id="3657012">(</span><span class="ident" id="3657013">c</span><span class="op" id="3657014">,</span>&nbsp;<span class="ident" id="3657016">mode</span><span class="op" id="3657020">)</span>&nbsp;<span class="op" id="3657022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657027">if</span>&nbsp;<span class="ident" id="3657030">c</span>&nbsp;<span class="op" id="3657032">==</span>&nbsp;<span class="string" id="3657035">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3657039">&amp;&amp;</span>&nbsp;<span class="ident" id="3657042">mode</span>&nbsp;<span class="op" id="3657047">==</span>&nbsp;<span class="ident" id="3657050">encodeQueryComponent</span>&nbsp;<span class="op" id="3657071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657077">spaceCount</span><span class="op" id="3657087">++</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3657093">}</span>&nbsp;<span class="keyword" id="3657095">else</span>&nbsp;<span class="op" id="3657100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657106">hexCount</span><span class="op" id="3657114">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3657120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3657124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3657127">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657131">if</span>&nbsp;<span class="ident" id="3657134">spaceCount</span>&nbsp;<span class="op" id="3657145">==</span>&nbsp;<span class="num" id="3657148">0</span>&nbsp;<span class="op" id="3657150">&amp;&amp;</span>&nbsp;<span class="ident" id="3657153">hexCount</span>&nbsp;<span class="op" id="3657162">==</span>&nbsp;<span class="num" id="3657165">0</span>&nbsp;<span class="op" id="3657167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657171">return</span>&nbsp;<span class="ident" id="3657178">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3657181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657185">t</span>&nbsp;<span class="op" id="3657187">:=</span>&nbsp;<span class="builtinfunc" id="3657190">make</span><span class="op" id="3657194">(</span><span class="op" id="3657195">[</span><span class="op" id="3657196">]</span><span class="builtintype" id="3657197">byte</span><span class="op" id="3657201">,</span>&nbsp;<span class="builtinfunc" id="3657203">len</span><span class="op" id="3657206">(</span><span class="ident" id="3657207">s</span><span class="op" id="3657208">)</span><span class="op" id="3657209">+</span><span class="num" id="3657210">2</span><span class="op" id="3657211">*</span><span class="ident" id="3657212">hexCount</span><span class="op" id="3657220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657223">j</span>&nbsp;<span class="op" id="3657225">:=</span>&nbsp;<span class="num" id="3657228">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657231">for</span>&nbsp;<span class="ident" id="3657235">i</span>&nbsp;<span class="op" id="3657237">:=</span>&nbsp;<span class="num" id="3657240">0</span><span class="op" id="3657241">;</span>&nbsp;<span class="ident" id="3657243">i</span>&nbsp;<span class="op" id="3657245">&lt;</span>&nbsp;<span class="builtinfunc" id="3657247">len</span><span class="op" id="3657250">(</span><span class="ident" id="3657251">s</span><span class="op" id="3657252">)</span><span class="op" id="3657253">;</span>&nbsp;<span class="ident" id="3657255">i</span><span class="op" id="3657256">++</span>&nbsp;<span class="op" id="3657259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657263">switch</span>&nbsp;<span class="ident" id="3657270">c</span>&nbsp;<span class="op" id="3657272">:=</span>&nbsp;<span class="ident" id="3657275">s</span><span class="op" id="3657276">[</span><span class="ident" id="3657277">i</span><span class="op" id="3657278">]</span><span class="op" id="3657279">;</span>&nbsp;<span class="op" id="3657281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657285">case</span>&nbsp;<span class="ident" id="3657290">c</span>&nbsp;<span class="op" id="3657292">==</span>&nbsp;<span class="string" id="3657295">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3657299">&amp;&amp;</span>&nbsp;<span class="ident" id="3657302">mode</span>&nbsp;<span class="op" id="3657307">==</span>&nbsp;<span class="ident" id="3657310">encodeQueryComponent</span><span class="op" id="3657330">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657335">t</span><span class="op" id="3657336">[</span><span class="ident" id="3657337">j</span><span class="op" id="3657338">]</span>&nbsp;<span class="op" id="3657340">=</span>&nbsp;<span class="string" id="3657342">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657349">j</span><span class="op" id="3657350">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657355">case</span>&nbsp;<span class="ident" id="3657360">shouldEscape</span><span class="op" id="3657372">(</span><span class="ident" id="3657373">c</span><span class="op" id="3657374">,</span>&nbsp;<span class="ident" id="3657376">mode</span><span class="op" id="3657380">)</span><span class="op" id="3657381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657386">t</span><span class="op" id="3657387">[</span><span class="ident" id="3657388">j</span><span class="op" id="3657389">]</span>&nbsp;<span class="op" id="3657391">=</span>&nbsp;<span class="string" id="3657393">&#39;%&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657400">t</span><span class="op" id="3657401">[</span><span class="ident" id="3657402">j</span><span class="op" id="3657403">+</span><span class="num" id="3657404">1</span><span class="op" id="3657405">]</span>&nbsp;<span class="op" id="3657407">=</span>&nbsp;<span class="string" id="3657409">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3657427">[</span><span class="ident" id="3657428">c</span><span class="op" id="3657429">&gt;&gt;</span><span class="num" id="3657431">4</span><span class="op" id="3657432">]</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657437">t</span><span class="op" id="3657438">[</span><span class="ident" id="3657439">j</span><span class="op" id="3657440">+</span><span class="num" id="3657441">2</span><span class="op" id="3657442">]</span>&nbsp;<span class="op" id="3657444">=</span>&nbsp;<span class="string" id="3657446">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3657464">[</span><span class="ident" id="3657465">c</span><span class="op" id="3657466">&amp;</span><span class="num" id="3657467">15</span><span class="op" id="3657469">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657474">j</span>&nbsp;<span class="op" id="3657476">+=</span>&nbsp;<span class="num" id="3657479">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657483">default</span><span class="op" id="3657490">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657495">t</span><span class="op" id="3657496">[</span><span class="ident" id="3657497">j</span><span class="op" id="3657498">]</span>&nbsp;<span class="op" id="3657500">=</span>&nbsp;<span class="ident" id="3657502">s</span><span class="op" id="3657503">[</span><span class="ident" id="3657504">i</span><span class="op" id="3657505">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3657510">j</span><span class="op" id="3657511">++</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3657516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3657519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3657522">return</span>&nbsp;<span class="builtintype" id="3657529">string</span><span class="op" id="3657535">(</span><span class="ident" id="3657536">t</span><span class="op" id="3657537">)</span><br>
<span class="lineno"></span><span class="op" id="3657539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3657542">//&nbsp;A&nbsp;URL&nbsp;represents&nbsp;a&nbsp;parsed&nbsp;URL&nbsp;(technically,&nbsp;a&nbsp;URI&nbsp;reference).</span><br>
<span class="lineno"></span><span class="comment" id="3657607">//&nbsp;The&nbsp;general&nbsp;form&nbsp;represented&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3657643">//</span><br>
<span class="lineno"></span><span class="comment" id="3657646">//&nbsp;&nbsp;&nbsp;&nbsp;scheme://[userinfo@]host/path[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3657698">//</span><br>
<span class="lineno">220</span><span class="comment" id="3657701">//&nbsp;URLs&nbsp;that&nbsp;do&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;slash&nbsp;after&nbsp;the&nbsp;scheme&nbsp;are&nbsp;interpreted&nbsp;as:</span><br>
<span class="lineno"></span><span class="comment" id="3657777">//</span><br>
<span class="lineno"></span><span class="comment" id="3657780">//&nbsp;&nbsp;&nbsp;&nbsp;scheme:opaque[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3657816">//</span><br>
<span class="lineno"></span><span class="comment" id="3657819">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;Path&nbsp;field&nbsp;is&nbsp;stored&nbsp;in&nbsp;decoded&nbsp;form:&nbsp;/%47%6f%2f&nbsp;becomes&nbsp;/Go/.</span><br>
<span class="lineno">225</span><span class="comment" id="3657899">//&nbsp;A&nbsp;consequence&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;impossible&nbsp;to&nbsp;tell&nbsp;which&nbsp;slashes&nbsp;in&nbsp;the&nbsp;Path&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="3657980">//&nbsp;slashes&nbsp;in&nbsp;the&nbsp;raw&nbsp;URL&nbsp;and&nbsp;which&nbsp;were&nbsp;%2f.&nbsp;This&nbsp;distinction&nbsp;is&nbsp;rarely&nbsp;important,</span><br>
<span class="lineno"></span><span class="comment" id="3658064">//&nbsp;but&nbsp;when&nbsp;it&nbsp;is&nbsp;a&nbsp;client&nbsp;must&nbsp;use&nbsp;other&nbsp;routines&nbsp;to&nbsp;parse&nbsp;the&nbsp;raw&nbsp;URL&nbsp;or&nbsp;construct</span><br>
<span class="lineno"></span><span class="comment" id="3658149">//&nbsp;the&nbsp;parsed&nbsp;URL.&nbsp;For&nbsp;example,&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;consult&nbsp;req.RequestURI,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3658228">//&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;can&nbsp;use&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Opaque:&nbsp;&#34;//example.com/Go%2f&#34;}</span><br>
<span class="lineno">230</span><span class="comment" id="3658310">//&nbsp;instead&nbsp;of&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Path:&nbsp;&#34;/Go/&#34;}.</span><br>
<span class="lineno"></span><span class="keyword" id="3658364">type</span>&nbsp;<span class="ident" id="3658369">URL</span>&nbsp;<span class="keyword" id="3658373">struct</span>&nbsp;<span class="op" id="3658380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658383">Scheme</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3658392">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658400">Opaque</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3658409">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3658419">//&nbsp;encoded&nbsp;opaque&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658443">User</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3658452">*</span><span class="ident" id="3658453">Userinfo</span>&nbsp;<span class="comment" id="3658462">//&nbsp;username&nbsp;and&nbsp;password&nbsp;information</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658500">Host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3658509">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3658519">//&nbsp;host&nbsp;or&nbsp;host:port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658541">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3658550">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658558">RawQuery</span>&nbsp;<span class="builtintype" id="3658567">string</span>&nbsp;<span class="comment" id="3658574">//&nbsp;encoded&nbsp;query&nbsp;values,&nbsp;without&nbsp;&#39;?&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3658612">Fragment</span>&nbsp;<span class="builtintype" id="3658621">string</span>&nbsp;<span class="comment" id="3658628">//&nbsp;fragment&nbsp;for&nbsp;references,&nbsp;without&nbsp;&#39;#&#39;</span><br>
<span class="lineno"></span><span class="op" id="3658668">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3658671">//&nbsp;User&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3658731">//&nbsp;and&nbsp;no&nbsp;password&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3658755">func</span>&nbsp;<span class="ident" id="3658760">User</span><span class="op" id="3658764">(</span><span class="ident" id="3658765">username</span>&nbsp;<span class="builtintype" id="3658774">string</span><span class="op" id="3658780">)</span>&nbsp;<span class="op" id="3658782">*</span><span class="ident" id="3658783">Userinfo</span>&nbsp;<span class="op" id="3658792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3658795">return</span>&nbsp;<span class="op" id="3658802">&amp;</span><span class="ident" id="3658803">Userinfo</span><span class="op" id="3658811">{</span><span class="ident" id="3658812">username</span><span class="op" id="3658820">,</span>&nbsp;<span class="string" id="3658822">&#34;&#34;</span><span class="op" id="3658824">,</span>&nbsp;<span class="builtintype" id="3658826">false</span><span class="op" id="3658831">}</span><br>
<span class="lineno">245</span><span class="op" id="3658833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3658836">//&nbsp;UserPassword&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3658904">//&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="3658921">//&nbsp;This&nbsp;functionality&nbsp;should&nbsp;only&nbsp;be&nbsp;used&nbsp;with&nbsp;legacy&nbsp;web&nbsp;sites.</span><br>
<span class="lineno">250</span><span class="comment" id="3658986">//&nbsp;RFC&nbsp;2396&nbsp;warns&nbsp;that&nbsp;interpreting&nbsp;Userinfo&nbsp;this&nbsp;way</span><br>
<span class="lineno"></span><span class="comment" id="3659040">//&nbsp;``is&nbsp;NOT&nbsp;RECOMMENDED,&nbsp;because&nbsp;the&nbsp;passing&nbsp;of&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="3659103">//&nbsp;information&nbsp;in&nbsp;clear&nbsp;text&nbsp;(such&nbsp;as&nbsp;URI)&nbsp;has&nbsp;proven&nbsp;to&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3659165">//&nbsp;security&nbsp;risk&nbsp;in&nbsp;almost&nbsp;every&nbsp;case&nbsp;where&nbsp;it&nbsp;has&nbsp;been&nbsp;used.&#39;&#39;</span><br>
<span class="lineno"></span><span class="keyword" id="3659229">func</span>&nbsp;<span class="ident" id="3659234">UserPassword</span><span class="op" id="3659246">(</span><span class="ident" id="3659247">username</span><span class="op" id="3659255">,</span>&nbsp;<span class="ident" id="3659257">password</span>&nbsp;<span class="builtintype" id="3659266">string</span><span class="op" id="3659272">)</span>&nbsp;<span class="op" id="3659274">*</span><span class="ident" id="3659275">Userinfo</span>&nbsp;<span class="op" id="3659284">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3659287">return</span>&nbsp;<span class="op" id="3659294">&amp;</span><span class="ident" id="3659295">Userinfo</span><span class="op" id="3659303">{</span><span class="ident" id="3659304">username</span><span class="op" id="3659312">,</span>&nbsp;<span class="ident" id="3659314">password</span><span class="op" id="3659322">,</span>&nbsp;<span class="builtintype" id="3659324">true</span><span class="op" id="3659328">}</span><br>
<span class="lineno"></span><span class="op" id="3659330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3659333">//&nbsp;The&nbsp;Userinfo&nbsp;type&nbsp;is&nbsp;an&nbsp;immutable&nbsp;encapsulation&nbsp;of&nbsp;username&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3659400">//&nbsp;password&nbsp;details&nbsp;for&nbsp;a&nbsp;URL.&nbsp;An&nbsp;existing&nbsp;Userinfo&nbsp;value&nbsp;is&nbsp;guaranteed</span><br>
<span class="lineno">260</span><span class="comment" id="3659472">//&nbsp;to&nbsp;have&nbsp;a&nbsp;username&nbsp;set&nbsp;(potentially&nbsp;empty,&nbsp;as&nbsp;allowed&nbsp;by&nbsp;RFC&nbsp;2396),</span><br>
<span class="lineno"></span><span class="comment" id="3659543">//&nbsp;and&nbsp;optionally&nbsp;a&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="3659573">type</span>&nbsp;<span class="ident" id="3659578">Userinfo</span>&nbsp;<span class="keyword" id="3659587">struct</span>&nbsp;<span class="op" id="3659594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3659597">username</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3659609">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3659617">password</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3659629">string</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3659637">passwordSet</span>&nbsp;<span class="builtintype" id="3659649">bool</span><br>
<span class="lineno"></span><span class="op" id="3659654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3659657">//&nbsp;Username&nbsp;returns&nbsp;the&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="3659691">func</span>&nbsp;<span class="op" id="3659696">(</span><span class="ident" id="3659697">u</span>&nbsp;<span class="op" id="3659699">*</span><span class="ident" id="3659700">Userinfo</span><span class="op" id="3659708">)</span>&nbsp;<span class="ident" id="3659710">Username</span><span class="op" id="3659718">(</span><span class="op" id="3659719">)</span>&nbsp;<span class="builtintype" id="3659721">string</span>&nbsp;<span class="op" id="3659728">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3659731">return</span>&nbsp;<span class="ident" id="3659738">u</span><span class="op" id="3659739">.</span><span class="ident" id="3659740">username</span><br>
<span class="lineno"></span><span class="op" id="3659749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3659752">//&nbsp;Password&nbsp;returns&nbsp;the&nbsp;password&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;set,&nbsp;and&nbsp;whether&nbsp;it&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3659827">func</span>&nbsp;<span class="op" id="3659832">(</span><span class="ident" id="3659833">u</span>&nbsp;<span class="op" id="3659835">*</span><span class="ident" id="3659836">Userinfo</span><span class="op" id="3659844">)</span>&nbsp;<span class="ident" id="3659846">Password</span><span class="op" id="3659854">(</span><span class="op" id="3659855">)</span>&nbsp;<span class="op" id="3659857">(</span><span class="builtintype" id="3659858">string</span><span class="op" id="3659864">,</span>&nbsp;<span class="builtintype" id="3659866">bool</span><span class="op" id="3659870">)</span>&nbsp;<span class="op" id="3659872">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3659875">if</span>&nbsp;<span class="ident" id="3659878">u</span><span class="op" id="3659879">.</span><span class="ident" id="3659880">passwordSet</span>&nbsp;<span class="op" id="3659892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3659896">return</span>&nbsp;<span class="ident" id="3659903">u</span><span class="op" id="3659904">.</span><span class="ident" id="3659905">password</span><span class="op" id="3659913">,</span>&nbsp;<span class="builtintype" id="3659915">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3659921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3659924">return</span>&nbsp;<span class="string" id="3659931">&#34;&#34;</span><span class="op" id="3659933">,</span>&nbsp;<span class="builtintype" id="3659935">false</span><br>
<span class="lineno"></span><span class="op" id="3659941">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3659944">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;userinfo&nbsp;information&nbsp;in&nbsp;the&nbsp;standard&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3660016">//&nbsp;of&nbsp;&#34;username[:password]&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3660045">func</span>&nbsp;<span class="op" id="3660050">(</span><span class="ident" id="3660051">u</span>&nbsp;<span class="op" id="3660053">*</span><span class="ident" id="3660054">Userinfo</span><span class="op" id="3660062">)</span>&nbsp;<span class="ident" id="3660064">String</span><span class="op" id="3660070">(</span><span class="op" id="3660071">)</span>&nbsp;<span class="builtintype" id="3660073">string</span>&nbsp;<span class="op" id="3660080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3660083">s</span>&nbsp;<span class="op" id="3660085">:=</span>&nbsp;<span class="ident" id="3660088">escape</span><span class="op" id="3660094">(</span><span class="ident" id="3660095">u</span><span class="op" id="3660096">.</span><span class="ident" id="3660097">username</span><span class="op" id="3660105">,</span>&nbsp;<span class="ident" id="3660107">encodeUserPassword</span><span class="op" id="3660125">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660128">if</span>&nbsp;<span class="ident" id="3660131">u</span><span class="op" id="3660132">.</span><span class="ident" id="3660133">passwordSet</span>&nbsp;<span class="op" id="3660145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3660149">s</span>&nbsp;<span class="op" id="3660151">+=</span>&nbsp;<span class="string" id="3660154">&#34;:&#34;</span>&nbsp;<span class="op" id="3660158">+</span>&nbsp;<span class="ident" id="3660160">escape</span><span class="op" id="3660166">(</span><span class="ident" id="3660167">u</span><span class="op" id="3660168">.</span><span class="ident" id="3660169">password</span><span class="op" id="3660177">,</span>&nbsp;<span class="ident" id="3660179">encodeUserPassword</span><span class="op" id="3660197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3660200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660203">return</span>&nbsp;<span class="ident" id="3660210">s</span><br>
<span class="lineno"></span><span class="op" id="3660212">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span><span class="comment" id="3660215">//&nbsp;Maybe&nbsp;rawurl&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;scheme:path.</span><br>
<span class="lineno"></span><span class="comment" id="3660259">//&nbsp;(Scheme&nbsp;must&nbsp;be&nbsp;[a-zA-Z][a-zA-Z0-9+-.]*)</span><br>
<span class="lineno"></span><span class="comment" id="3660303">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;scheme,&nbsp;path;&nbsp;else&nbsp;return&nbsp;&#34;&#34;,&nbsp;rawurl.</span><br>
<span class="lineno"></span><span class="keyword" id="3660358">func</span>&nbsp;<span class="ident" id="3660363">getscheme</span><span class="op" id="3660372">(</span><span class="ident" id="3660373">rawurl</span>&nbsp;<span class="builtintype" id="3660380">string</span><span class="op" id="3660386">)</span>&nbsp;<span class="op" id="3660388">(</span><span class="ident" id="3660389">scheme</span><span class="op" id="3660395">,</span>&nbsp;<span class="ident" id="3660397">path</span>&nbsp;<span class="builtintype" id="3660402">string</span><span class="op" id="3660408">,</span>&nbsp;<span class="ident" id="3660410">err</span>&nbsp;<span class="builtintype" id="3660414">error</span><span class="op" id="3660419">)</span>&nbsp;<span class="op" id="3660421">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660424">for</span>&nbsp;<span class="ident" id="3660428">i</span>&nbsp;<span class="op" id="3660430">:=</span>&nbsp;<span class="num" id="3660433">0</span><span class="op" id="3660434">;</span>&nbsp;<span class="ident" id="3660436">i</span>&nbsp;<span class="op" id="3660438">&lt;</span>&nbsp;<span class="builtinfunc" id="3660440">len</span><span class="op" id="3660443">(</span><span class="ident" id="3660444">rawurl</span><span class="op" id="3660450">)</span><span class="op" id="3660451">;</span>&nbsp;<span class="ident" id="3660453">i</span><span class="op" id="3660454">++</span>&nbsp;<span class="op" id="3660457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3660461">c</span>&nbsp;<span class="op" id="3660463">:=</span>&nbsp;<span class="ident" id="3660466">rawurl</span><span class="op" id="3660472">[</span><span class="ident" id="3660473">i</span><span class="op" id="3660474">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660478">switch</span>&nbsp;<span class="op" id="3660485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660489">case</span>&nbsp;<span class="string" id="3660494">&#39;a&#39;</span>&nbsp;<span class="op" id="3660498">&lt;=</span>&nbsp;<span class="ident" id="3660501">c</span>&nbsp;<span class="op" id="3660503">&amp;&amp;</span>&nbsp;<span class="ident" id="3660506">c</span>&nbsp;<span class="op" id="3660508">&lt;=</span>&nbsp;<span class="string" id="3660511">&#39;z&#39;</span>&nbsp;<span class="op" id="3660515">||</span>&nbsp;<span class="string" id="3660518">&#39;A&#39;</span>&nbsp;<span class="op" id="3660522">&lt;=</span>&nbsp;<span class="ident" id="3660525">c</span>&nbsp;<span class="op" id="3660527">&amp;&amp;</span>&nbsp;<span class="ident" id="3660530">c</span>&nbsp;<span class="op" id="3660532">&lt;=</span>&nbsp;<span class="string" id="3660535">&#39;Z&#39;</span><span class="op" id="3660538">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3660542">//&nbsp;do&nbsp;nothing</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660558">case</span>&nbsp;<span class="string" id="3660563">&#39;0&#39;</span>&nbsp;<span class="op" id="3660567">&lt;=</span>&nbsp;<span class="ident" id="3660570">c</span>&nbsp;<span class="op" id="3660572">&amp;&amp;</span>&nbsp;<span class="ident" id="3660575">c</span>&nbsp;<span class="op" id="3660577">&lt;=</span>&nbsp;<span class="string" id="3660580">&#39;9&#39;</span>&nbsp;<span class="op" id="3660584">||</span>&nbsp;<span class="ident" id="3660587">c</span>&nbsp;<span class="op" id="3660589">==</span>&nbsp;<span class="string" id="3660592">&#39;+&#39;</span>&nbsp;<span class="op" id="3660596">||</span>&nbsp;<span class="ident" id="3660599">c</span>&nbsp;<span class="op" id="3660601">==</span>&nbsp;<span class="string" id="3660604">&#39;-&#39;</span>&nbsp;<span class="op" id="3660608">||</span>&nbsp;<span class="ident" id="3660611">c</span>&nbsp;<span class="op" id="3660613">==</span>&nbsp;<span class="string" id="3660616">&#39;.&#39;</span><span class="op" id="3660619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660624">if</span>&nbsp;<span class="ident" id="3660627">i</span>&nbsp;<span class="op" id="3660629">==</span>&nbsp;<span class="num" id="3660632">0</span>&nbsp;<span class="op" id="3660634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660640">return</span>&nbsp;<span class="string" id="3660647">&#34;&#34;</span><span class="op" id="3660649">,</span>&nbsp;<span class="ident" id="3660651">rawurl</span><span class="op" id="3660657">,</span>&nbsp;<span class="builtintype" id="3660659">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3660666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660670">case</span>&nbsp;<span class="ident" id="3660675">c</span>&nbsp;<span class="op" id="3660677">==</span>&nbsp;<span class="string" id="3660680">&#39;:&#39;</span><span class="op" id="3660683">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660688">if</span>&nbsp;<span class="ident" id="3660691">i</span>&nbsp;<span class="op" id="3660693">==</span>&nbsp;<span class="num" id="3660696">0</span>&nbsp;<span class="op" id="3660698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660704">return</span>&nbsp;<span class="string" id="3660711">&#34;&#34;</span><span class="op" id="3660713">,</span>&nbsp;<span class="string" id="3660715">&#34;&#34;</span><span class="op" id="3660717">,</span>&nbsp;<span class="ident" id="3660719">errors</span><span class="op" id="3660725">.</span><span class="ident" id="3660726">New</span><span class="op" id="3660729">(</span><span class="string" id="3660730">&#34;missing&nbsp;protocol&nbsp;scheme&#34;</span><span class="op" id="3660755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3660760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660765">return</span>&nbsp;<span class="ident" id="3660772">rawurl</span><span class="op" id="3660778">[</span><span class="num" id="3660779">0</span><span class="op" id="3660780">:</span><span class="ident" id="3660781">i</span><span class="op" id="3660782">]</span><span class="op" id="3660783">,</span>&nbsp;<span class="ident" id="3660785">rawurl</span><span class="op" id="3660791">[</span><span class="ident" id="3660792">i</span><span class="op" id="3660793">+</span><span class="num" id="3660794">1</span><span class="op" id="3660795">:</span><span class="op" id="3660796">]</span><span class="op" id="3660797">,</span>&nbsp;<span class="builtintype" id="3660799">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660805">default</span><span class="op" id="3660812">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3660817">//&nbsp;we&nbsp;have&nbsp;encountered&nbsp;an&nbsp;invalid&nbsp;character,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3660865">//&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;valid&nbsp;scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660899">return</span>&nbsp;<span class="string" id="3660906">&#34;&#34;</span><span class="op" id="3660908">,</span>&nbsp;<span class="ident" id="3660910">rawurl</span><span class="op" id="3660916">,</span>&nbsp;<span class="builtintype" id="3660918">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3660924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3660927">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3660930">return</span>&nbsp;<span class="string" id="3660937">&#34;&#34;</span><span class="op" id="3660939">,</span>&nbsp;<span class="ident" id="3660941">rawurl</span><span class="op" id="3660947">,</span>&nbsp;<span class="builtintype" id="3660949">nil</span><br>
<span class="lineno"></span><span class="op" id="3660953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3660956">//&nbsp;Maybe&nbsp;s&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;t&nbsp;c&nbsp;u.</span><br>
<span class="lineno"></span><span class="comment" id="3660989">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;t,&nbsp;c&nbsp;u&nbsp;(or&nbsp;t,&nbsp;u&nbsp;if&nbsp;cutc&nbsp;==&nbsp;true).</span><br>
<span class="lineno">320</span><span class="comment" id="3661040">//&nbsp;If&nbsp;not,&nbsp;return&nbsp;s,&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3661065">func</span>&nbsp;<span class="ident" id="3661070">split</span><span class="op" id="3661075">(</span><span class="ident" id="3661076">s</span>&nbsp;<span class="builtintype" id="3661078">string</span><span class="op" id="3661084">,</span>&nbsp;<span class="ident" id="3661086">c</span>&nbsp;<span class="builtintype" id="3661088">string</span><span class="op" id="3661094">,</span>&nbsp;<span class="ident" id="3661096">cutc</span>&nbsp;<span class="builtintype" id="3661101">bool</span><span class="op" id="3661105">)</span>&nbsp;<span class="op" id="3661107">(</span><span class="builtintype" id="3661108">string</span><span class="op" id="3661114">,</span>&nbsp;<span class="builtintype" id="3661116">string</span><span class="op" id="3661122">)</span>&nbsp;<span class="op" id="3661124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3661127">i</span>&nbsp;<span class="op" id="3661129">:=</span>&nbsp;<span class="ident" id="3661132">strings</span><span class="op" id="3661139">.</span><span class="ident" id="3661140">Index</span><span class="op" id="3661145">(</span><span class="ident" id="3661146">s</span><span class="op" id="3661147">,</span>&nbsp;<span class="ident" id="3661149">c</span><span class="op" id="3661150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661153">if</span>&nbsp;<span class="ident" id="3661156">i</span>&nbsp;<span class="op" id="3661158">&lt;</span>&nbsp;<span class="num" id="3661160">0</span>&nbsp;<span class="op" id="3661162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661166">return</span>&nbsp;<span class="ident" id="3661173">s</span><span class="op" id="3661174">,</span>&nbsp;<span class="string" id="3661176">&#34;&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3661180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661183">if</span>&nbsp;<span class="ident" id="3661186">cutc</span>&nbsp;<span class="op" id="3661191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661195">return</span>&nbsp;<span class="ident" id="3661202">s</span><span class="op" id="3661203">[</span><span class="num" id="3661204">0</span><span class="op" id="3661205">:</span><span class="ident" id="3661206">i</span><span class="op" id="3661207">]</span><span class="op" id="3661208">,</span>&nbsp;<span class="ident" id="3661210">s</span><span class="op" id="3661211">[</span><span class="ident" id="3661212">i</span><span class="op" id="3661213">+</span><span class="builtinfunc" id="3661214">len</span><span class="op" id="3661217">(</span><span class="ident" id="3661218">c</span><span class="op" id="3661219">)</span><span class="op" id="3661220">:</span><span class="op" id="3661221">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3661224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661227">return</span>&nbsp;<span class="ident" id="3661234">s</span><span class="op" id="3661235">[</span><span class="num" id="3661236">0</span><span class="op" id="3661237">:</span><span class="ident" id="3661238">i</span><span class="op" id="3661239">]</span><span class="op" id="3661240">,</span>&nbsp;<span class="ident" id="3661242">s</span><span class="op" id="3661243">[</span><span class="ident" id="3661244">i</span><span class="op" id="3661245">:</span><span class="op" id="3661246">]</span><br>
<span class="lineno">330</span><span class="op" id="3661248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3661251">//&nbsp;Parse&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3661296">//&nbsp;The&nbsp;rawurl&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3661339">func</span>&nbsp;<span class="ident" id="3661344">Parse</span><span class="op" id="3661349">(</span><span class="ident" id="3661350">rawurl</span>&nbsp;<span class="builtintype" id="3661357">string</span><span class="op" id="3661363">)</span>&nbsp;<span class="op" id="3661365">(</span><span class="ident" id="3661366">url</span>&nbsp;<span class="op" id="3661370">*</span><span class="ident" id="3661371">URL</span><span class="op" id="3661374">,</span>&nbsp;<span class="ident" id="3661376">err</span>&nbsp;<span class="builtintype" id="3661380">error</span><span class="op" id="3661385">)</span>&nbsp;<span class="op" id="3661387">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3661390">//&nbsp;Cut&nbsp;off&nbsp;#frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3661408">u</span><span class="op" id="3661409">,</span>&nbsp;<span class="ident" id="3661411">frag</span>&nbsp;<span class="op" id="3661416">:=</span>&nbsp;<span class="ident" id="3661419">split</span><span class="op" id="3661424">(</span><span class="ident" id="3661425">rawurl</span><span class="op" id="3661431">,</span>&nbsp;<span class="string" id="3661433">&#34;#&#34;</span><span class="op" id="3661436">,</span>&nbsp;<span class="builtintype" id="3661438">true</span><span class="op" id="3661442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661445">if</span>&nbsp;<span class="ident" id="3661448">url</span><span class="op" id="3661451">,</span>&nbsp;<span class="ident" id="3661453">err</span>&nbsp;<span class="op" id="3661457">=</span>&nbsp;<span class="ident" id="3661459">parse</span><span class="op" id="3661464">(</span><span class="ident" id="3661465">u</span><span class="op" id="3661466">,</span>&nbsp;<span class="builtintype" id="3661468">false</span><span class="op" id="3661473">)</span><span class="op" id="3661474">;</span>&nbsp;<span class="ident" id="3661476">err</span>&nbsp;<span class="op" id="3661480">!=</span>&nbsp;<span class="builtintype" id="3661483">nil</span>&nbsp;<span class="op" id="3661487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661491">return</span>&nbsp;<span class="builtintype" id="3661498">nil</span><span class="op" id="3661501">,</span>&nbsp;<span class="ident" id="3661503">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3661508">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661511">if</span>&nbsp;<span class="ident" id="3661514">frag</span>&nbsp;<span class="op" id="3661519">==</span>&nbsp;<span class="string" id="3661522">&#34;&#34;</span>&nbsp;<span class="op" id="3661525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661529">return</span>&nbsp;<span class="ident" id="3661536">url</span><span class="op" id="3661539">,</span>&nbsp;<span class="builtintype" id="3661541">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3661546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661549">if</span>&nbsp;<span class="ident" id="3661552">url</span><span class="op" id="3661555">.</span><span class="ident" id="3661556">Fragment</span><span class="op" id="3661564">,</span>&nbsp;<span class="ident" id="3661566">err</span>&nbsp;<span class="op" id="3661570">=</span>&nbsp;<span class="ident" id="3661572">unescape</span><span class="op" id="3661580">(</span><span class="ident" id="3661581">frag</span><span class="op" id="3661585">,</span>&nbsp;<span class="ident" id="3661587">encodeFragment</span><span class="op" id="3661601">)</span><span class="op" id="3661602">;</span>&nbsp;<span class="ident" id="3661604">err</span>&nbsp;<span class="op" id="3661608">!=</span>&nbsp;<span class="builtintype" id="3661611">nil</span>&nbsp;<span class="op" id="3661615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661619">return</span>&nbsp;<span class="builtintype" id="3661626">nil</span><span class="op" id="3661629">,</span>&nbsp;<span class="op" id="3661631">&amp;</span><span class="ident" id="3661632">Error</span><span class="op" id="3661637">{</span><span class="string" id="3661638">&#34;parse&#34;</span><span class="op" id="3661645">,</span>&nbsp;<span class="ident" id="3661647">rawurl</span><span class="op" id="3661653">,</span>&nbsp;<span class="ident" id="3661655">err</span><span class="op" id="3661658">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3661661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3661664">return</span>&nbsp;<span class="ident" id="3661671">url</span><span class="op" id="3661674">,</span>&nbsp;<span class="builtintype" id="3661676">nil</span><br>
<span class="lineno"></span><span class="op" id="3661680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3661683">//&nbsp;ParseRequestURI&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.&nbsp;&nbsp;It&nbsp;assumes&nbsp;that</span><br>
<span class="lineno">350</span><span class="comment" id="3661755">//&nbsp;rawurl&nbsp;was&nbsp;received&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request,&nbsp;so&nbsp;the&nbsp;rawurl&nbsp;is&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="3661827">//&nbsp;only&nbsp;as&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;or&nbsp;an&nbsp;absolute&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3661875">//&nbsp;The&nbsp;string&nbsp;rawurl&nbsp;is&nbsp;assumed&nbsp;not&nbsp;to&nbsp;have&nbsp;a&nbsp;#fragment&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="comment" id="3661939">//&nbsp;(Web&nbsp;browsers&nbsp;strip&nbsp;#fragment&nbsp;before&nbsp;sending&nbsp;the&nbsp;URL&nbsp;to&nbsp;a&nbsp;web&nbsp;server.)</span><br>
<span class="lineno"></span><span class="keyword" id="3662013">func</span>&nbsp;<span class="ident" id="3662018">ParseRequestURI</span><span class="op" id="3662033">(</span><span class="ident" id="3662034">rawurl</span>&nbsp;<span class="builtintype" id="3662041">string</span><span class="op" id="3662047">)</span>&nbsp;<span class="op" id="3662049">(</span><span class="ident" id="3662050">url</span>&nbsp;<span class="op" id="3662054">*</span><span class="ident" id="3662055">URL</span><span class="op" id="3662058">,</span>&nbsp;<span class="ident" id="3662060">err</span>&nbsp;<span class="builtintype" id="3662064">error</span><span class="op" id="3662069">)</span>&nbsp;<span class="op" id="3662071">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662074">return</span>&nbsp;<span class="ident" id="3662081">parse</span><span class="op" id="3662086">(</span><span class="ident" id="3662087">rawurl</span><span class="op" id="3662093">,</span>&nbsp;<span class="builtintype" id="3662095">true</span><span class="op" id="3662099">)</span><br>
<span class="lineno"></span><span class="op" id="3662101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3662104">//&nbsp;parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;from&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;two&nbsp;contexts.&nbsp;&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3662168">//&nbsp;viaRequest&nbsp;is&nbsp;true,&nbsp;the&nbsp;URL&nbsp;is&nbsp;assumed&nbsp;to&nbsp;have&nbsp;arrived&nbsp;via&nbsp;an&nbsp;HTTP&nbsp;request,</span><br>
<span class="lineno">360</span><span class="comment" id="3662247">//&nbsp;in&nbsp;which&nbsp;case&nbsp;only&nbsp;absolute&nbsp;URLs&nbsp;or&nbsp;path-absolute&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="3662327">//&nbsp;If&nbsp;viaRequest&nbsp;is&nbsp;false,&nbsp;all&nbsp;forms&nbsp;of&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="keyword" id="3662394">func</span>&nbsp;<span class="ident" id="3662399">parse</span><span class="op" id="3662404">(</span><span class="ident" id="3662405">rawurl</span>&nbsp;<span class="builtintype" id="3662412">string</span><span class="op" id="3662418">,</span>&nbsp;<span class="ident" id="3662420">viaRequest</span>&nbsp;<span class="builtintype" id="3662431">bool</span><span class="op" id="3662435">)</span>&nbsp;<span class="op" id="3662437">(</span><span class="ident" id="3662438">url</span>&nbsp;<span class="op" id="3662442">*</span><span class="ident" id="3662443">URL</span><span class="op" id="3662446">,</span>&nbsp;<span class="ident" id="3662448">err</span>&nbsp;<span class="builtintype" id="3662452">error</span><span class="op" id="3662457">)</span>&nbsp;<span class="op" id="3662459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662462">var</span>&nbsp;<span class="ident" id="3662466">rest</span>&nbsp;<span class="builtintype" id="3662471">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662480">if</span>&nbsp;<span class="ident" id="3662483">rawurl</span>&nbsp;<span class="op" id="3662490">==</span>&nbsp;<span class="string" id="3662493">&#34;&#34;</span>&nbsp;<span class="op" id="3662496">&amp;&amp;</span>&nbsp;<span class="ident" id="3662499">viaRequest</span>&nbsp;<span class="op" id="3662510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662514">err</span>&nbsp;<span class="op" id="3662518">=</span>&nbsp;<span class="ident" id="3662520">errors</span><span class="op" id="3662526">.</span><span class="ident" id="3662527">New</span><span class="op" id="3662530">(</span><span class="string" id="3662531">&#34;empty&nbsp;url&#34;</span><span class="op" id="3662542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662546">goto</span>&nbsp;<span class="ident" id="3662551">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3662558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662561">url</span>&nbsp;<span class="op" id="3662565">=</span>&nbsp;<span class="builtinfunc" id="3662567">new</span><span class="op" id="3662570">(</span><span class="ident" id="3662571">URL</span><span class="op" id="3662574">)</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662578">if</span>&nbsp;<span class="ident" id="3662581">rawurl</span>&nbsp;<span class="op" id="3662588">==</span>&nbsp;<span class="string" id="3662591">&#34;*&#34;</span>&nbsp;<span class="op" id="3662595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662599">url</span><span class="op" id="3662602">.</span><span class="ident" id="3662603">Path</span>&nbsp;<span class="op" id="3662608">=</span>&nbsp;<span class="string" id="3662610">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662616">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3662624">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3662628">//&nbsp;Split&nbsp;off&nbsp;possible&nbsp;leading&nbsp;&#34;http:&#34;,&nbsp;&#34;mailto:&#34;,&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3662684">//&nbsp;Cannot&nbsp;contain&nbsp;escaped&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662723">if</span>&nbsp;<span class="ident" id="3662726">url</span><span class="op" id="3662729">.</span><span class="ident" id="3662730">Scheme</span><span class="op" id="3662736">,</span>&nbsp;<span class="ident" id="3662738">rest</span><span class="op" id="3662742">,</span>&nbsp;<span class="ident" id="3662744">err</span>&nbsp;<span class="op" id="3662748">=</span>&nbsp;<span class="ident" id="3662750">getscheme</span><span class="op" id="3662759">(</span><span class="ident" id="3662760">rawurl</span><span class="op" id="3662766">)</span><span class="op" id="3662767">;</span>&nbsp;<span class="ident" id="3662769">err</span>&nbsp;<span class="op" id="3662773">!=</span>&nbsp;<span class="builtintype" id="3662776">nil</span>&nbsp;<span class="op" id="3662780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662784">goto</span>&nbsp;<span class="ident" id="3662789">Error</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3662796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662799">url</span><span class="op" id="3662802">.</span><span class="ident" id="3662803">Scheme</span>&nbsp;<span class="op" id="3662810">=</span>&nbsp;<span class="ident" id="3662812">strings</span><span class="op" id="3662819">.</span><span class="ident" id="3662820">ToLower</span><span class="op" id="3662827">(</span><span class="ident" id="3662828">url</span><span class="op" id="3662831">.</span><span class="ident" id="3662832">Scheme</span><span class="op" id="3662838">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3662842">rest</span><span class="op" id="3662846">,</span>&nbsp;<span class="ident" id="3662848">url</span><span class="op" id="3662851">.</span><span class="ident" id="3662852">RawQuery</span>&nbsp;<span class="op" id="3662861">=</span>&nbsp;<span class="ident" id="3662863">split</span><span class="op" id="3662868">(</span><span class="ident" id="3662869">rest</span><span class="op" id="3662873">,</span>&nbsp;<span class="string" id="3662875">&#34;?&#34;</span><span class="op" id="3662878">,</span>&nbsp;<span class="builtintype" id="3662880">true</span><span class="op" id="3662884">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662888">if</span>&nbsp;<span class="op" id="3662891">!</span><span class="ident" id="3662892">strings</span><span class="op" id="3662899">.</span><span class="ident" id="3662900">HasPrefix</span><span class="op" id="3662909">(</span><span class="ident" id="3662910">rest</span><span class="op" id="3662914">,</span>&nbsp;<span class="string" id="3662916">&#34;/&#34;</span><span class="op" id="3662919">)</span>&nbsp;<span class="op" id="3662921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3662925">if</span>&nbsp;<span class="ident" id="3662928">url</span><span class="op" id="3662931">.</span><span class="ident" id="3662932">Scheme</span>&nbsp;<span class="op" id="3662939">!=</span>&nbsp;<span class="string" id="3662942">&#34;&#34;</span>&nbsp;<span class="op" id="3662945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3662950">//&nbsp;We&nbsp;consider&nbsp;rootless&nbsp;paths&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;as&nbsp;opaque.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663007">url</span><span class="op" id="3663010">.</span><span class="ident" id="3663011">Opaque</span>&nbsp;<span class="op" id="3663018">=</span>&nbsp;<span class="ident" id="3663020">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663028">return</span>&nbsp;<span class="ident" id="3663035">url</span><span class="op" id="3663038">,</span>&nbsp;<span class="builtintype" id="3663040">nil</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3663046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663050">if</span>&nbsp;<span class="ident" id="3663053">viaRequest</span>&nbsp;<span class="op" id="3663064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663069">err</span>&nbsp;<span class="op" id="3663073">=</span>&nbsp;<span class="ident" id="3663075">errors</span><span class="op" id="3663081">.</span><span class="ident" id="3663082">New</span><span class="op" id="3663085">(</span><span class="string" id="3663086">&#34;invalid&nbsp;URI&nbsp;for&nbsp;request&#34;</span><span class="op" id="3663111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663116">goto</span>&nbsp;<span class="ident" id="3663121">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3663129">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3663132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663136">if</span>&nbsp;<span class="op" id="3663139">(</span><span class="ident" id="3663140">url</span><span class="op" id="3663143">.</span><span class="ident" id="3663144">Scheme</span>&nbsp;<span class="op" id="3663151">!=</span>&nbsp;<span class="string" id="3663154">&#34;&#34;</span>&nbsp;<span class="op" id="3663157">||</span>&nbsp;<span class="op" id="3663160">!</span><span class="ident" id="3663161">viaRequest</span>&nbsp;<span class="op" id="3663172">&amp;&amp;</span>&nbsp;<span class="op" id="3663175">!</span><span class="ident" id="3663176">strings</span><span class="op" id="3663183">.</span><span class="ident" id="3663184">HasPrefix</span><span class="op" id="3663193">(</span><span class="ident" id="3663194">rest</span><span class="op" id="3663198">,</span>&nbsp;<span class="string" id="3663200">&#34;///&#34;</span><span class="op" id="3663205">)</span><span class="op" id="3663206">)</span>&nbsp;<span class="op" id="3663208">&amp;&amp;</span>&nbsp;<span class="ident" id="3663211">strings</span><span class="op" id="3663218">.</span><span class="ident" id="3663219">HasPrefix</span><span class="op" id="3663228">(</span><span class="ident" id="3663229">rest</span><span class="op" id="3663233">,</span>&nbsp;<span class="string" id="3663235">&#34;//&#34;</span><span class="op" id="3663239">)</span>&nbsp;<span class="op" id="3663241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663245">var</span>&nbsp;<span class="ident" id="3663249">authority</span>&nbsp;<span class="builtintype" id="3663259">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663268">authority</span><span class="op" id="3663277">,</span>&nbsp;<span class="ident" id="3663279">rest</span>&nbsp;<span class="op" id="3663284">=</span>&nbsp;<span class="ident" id="3663286">split</span><span class="op" id="3663291">(</span><span class="ident" id="3663292">rest</span><span class="op" id="3663296">[</span><span class="num" id="3663297">2</span><span class="op" id="3663298">:</span><span class="op" id="3663299">]</span><span class="op" id="3663300">,</span>&nbsp;<span class="string" id="3663302">&#34;/&#34;</span><span class="op" id="3663305">,</span>&nbsp;<span class="builtintype" id="3663307">false</span><span class="op" id="3663312">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663316">url</span><span class="op" id="3663319">.</span><span class="ident" id="3663320">User</span><span class="op" id="3663324">,</span>&nbsp;<span class="ident" id="3663326">url</span><span class="op" id="3663329">.</span><span class="ident" id="3663330">Host</span><span class="op" id="3663334">,</span>&nbsp;<span class="ident" id="3663336">err</span>&nbsp;<span class="op" id="3663340">=</span>&nbsp;<span class="ident" id="3663342">parseAuthority</span><span class="op" id="3663356">(</span><span class="ident" id="3663357">authority</span><span class="op" id="3663366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663370">if</span>&nbsp;<span class="ident" id="3663373">err</span>&nbsp;<span class="op" id="3663377">!=</span>&nbsp;<span class="builtintype" id="3663380">nil</span>&nbsp;<span class="op" id="3663384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663389">goto</span>&nbsp;<span class="ident" id="3663394">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3663402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663406">if</span>&nbsp;<span class="ident" id="3663409">strings</span><span class="op" id="3663416">.</span><span class="ident" id="3663417">Contains</span><span class="op" id="3663425">(</span><span class="ident" id="3663426">url</span><span class="op" id="3663429">.</span><span class="ident" id="3663430">Host</span><span class="op" id="3663434">,</span>&nbsp;<span class="string" id="3663436">&#34;%&#34;</span><span class="op" id="3663439">)</span>&nbsp;<span class="op" id="3663441">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663446">err</span>&nbsp;<span class="op" id="3663450">=</span>&nbsp;<span class="ident" id="3663452">errors</span><span class="op" id="3663458">.</span><span class="ident" id="3663459">New</span><span class="op" id="3663462">(</span><span class="string" id="3663463">&#34;hexadecimal&nbsp;escape&nbsp;in&nbsp;host&#34;</span><span class="op" id="3663491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663496">goto</span>&nbsp;<span class="ident" id="3663501">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3663509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3663512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663515">if</span>&nbsp;<span class="ident" id="3663518">url</span><span class="op" id="3663521">.</span><span class="ident" id="3663522">Path</span><span class="op" id="3663526">,</span>&nbsp;<span class="ident" id="3663528">err</span>&nbsp;<span class="op" id="3663532">=</span>&nbsp;<span class="ident" id="3663534">unescape</span><span class="op" id="3663542">(</span><span class="ident" id="3663543">rest</span><span class="op" id="3663547">,</span>&nbsp;<span class="ident" id="3663549">encodePath</span><span class="op" id="3663559">)</span><span class="op" id="3663560">;</span>&nbsp;<span class="ident" id="3663562">err</span>&nbsp;<span class="op" id="3663566">!=</span>&nbsp;<span class="builtintype" id="3663569">nil</span>&nbsp;<span class="op" id="3663573">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663577">goto</span>&nbsp;<span class="ident" id="3663582">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3663589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663592">return</span>&nbsp;<span class="ident" id="3663599">url</span><span class="op" id="3663602">,</span>&nbsp;<span class="builtintype" id="3663604">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3663609">Error</span><span class="op" id="3663614">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663617">return</span>&nbsp;<span class="builtintype" id="3663624">nil</span><span class="op" id="3663627">,</span>&nbsp;<span class="op" id="3663629">&amp;</span><span class="ident" id="3663630">Error</span><span class="op" id="3663635">{</span><span class="string" id="3663636">&#34;parse&#34;</span><span class="op" id="3663643">,</span>&nbsp;<span class="ident" id="3663645">rawurl</span><span class="op" id="3663651">,</span>&nbsp;<span class="ident" id="3663653">err</span><span class="op" id="3663656">}</span><br>
<span class="lineno"></span><span class="op" id="3663658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3663661">func</span>&nbsp;<span class="ident" id="3663666">parseAuthority</span><span class="op" id="3663680">(</span><span class="ident" id="3663681">authority</span>&nbsp;<span class="builtintype" id="3663691">string</span><span class="op" id="3663697">)</span>&nbsp;<span class="op" id="3663699">(</span><span class="ident" id="3663700">user</span>&nbsp;<span class="op" id="3663705">*</span><span class="ident" id="3663706">Userinfo</span><span class="op" id="3663714">,</span>&nbsp;<span class="ident" id="3663716">host</span>&nbsp;<span class="builtintype" id="3663721">string</span><span class="op" id="3663727">,</span>&nbsp;<span class="ident" id="3663729">err</span>&nbsp;<span class="builtintype" id="3663733">error</span><span class="op" id="3663738">)</span>&nbsp;<span class="op" id="3663740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663743">i</span>&nbsp;<span class="op" id="3663745">:=</span>&nbsp;<span class="ident" id="3663748">strings</span><span class="op" id="3663755">.</span><span class="ident" id="3663756">LastIndex</span><span class="op" id="3663765">(</span><span class="ident" id="3663766">authority</span><span class="op" id="3663775">,</span>&nbsp;<span class="string" id="3663777">&#34;@&#34;</span><span class="op" id="3663780">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663783">if</span>&nbsp;<span class="ident" id="3663786">i</span>&nbsp;<span class="op" id="3663788">&lt;</span>&nbsp;<span class="num" id="3663790">0</span>&nbsp;<span class="op" id="3663792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663796">host</span>&nbsp;<span class="op" id="3663801">=</span>&nbsp;<span class="ident" id="3663803">authority</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663815">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3663823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3663826">userinfo</span><span class="op" id="3663834">,</span>&nbsp;<span class="ident" id="3663836">host</span>&nbsp;<span class="op" id="3663841">:=</span>&nbsp;<span class="ident" id="3663844">authority</span><span class="op" id="3663853">[</span><span class="op" id="3663854">:</span><span class="ident" id="3663855">i</span><span class="op" id="3663856">]</span><span class="op" id="3663857">,</span>&nbsp;<span class="ident" id="3663859">authority</span><span class="op" id="3663868">[</span><span class="ident" id="3663869">i</span><span class="op" id="3663870">+</span><span class="num" id="3663871">1</span><span class="op" id="3663872">:</span><span class="op" id="3663873">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663876">if</span>&nbsp;<span class="ident" id="3663879">strings</span><span class="op" id="3663886">.</span><span class="ident" id="3663887">Index</span><span class="op" id="3663892">(</span><span class="ident" id="3663893">userinfo</span><span class="op" id="3663901">,</span>&nbsp;<span class="string" id="3663903">&#34;:&#34;</span><span class="op" id="3663906">)</span>&nbsp;<span class="op" id="3663908">&lt;</span>&nbsp;<span class="num" id="3663910">0</span>&nbsp;<span class="op" id="3663912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663916">if</span>&nbsp;<span class="ident" id="3663919">userinfo</span><span class="op" id="3663927">,</span>&nbsp;<span class="ident" id="3663929">err</span>&nbsp;<span class="op" id="3663933">=</span>&nbsp;<span class="ident" id="3663935">unescape</span><span class="op" id="3663943">(</span><span class="ident" id="3663944">userinfo</span><span class="op" id="3663952">,</span>&nbsp;<span class="ident" id="3663954">encodeUserPassword</span><span class="op" id="3663972">)</span><span class="op" id="3663973">;</span>&nbsp;<span class="ident" id="3663975">err</span>&nbsp;<span class="op" id="3663979">!=</span>&nbsp;<span class="builtintype" id="3663982">nil</span>&nbsp;<span class="op" id="3663986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3663991">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3664000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3664004">user</span>&nbsp;<span class="op" id="3664009">=</span>&nbsp;<span class="ident" id="3664011">User</span><span class="op" id="3664015">(</span><span class="ident" id="3664016">userinfo</span><span class="op" id="3664024">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3664027">}</span>&nbsp;<span class="keyword" id="3664029">else</span>&nbsp;<span class="op" id="3664034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3664038">username</span><span class="op" id="3664046">,</span>&nbsp;<span class="ident" id="3664048">password</span>&nbsp;<span class="op" id="3664057">:=</span>&nbsp;<span class="ident" id="3664060">split</span><span class="op" id="3664065">(</span><span class="ident" id="3664066">userinfo</span><span class="op" id="3664074">,</span>&nbsp;<span class="string" id="3664076">&#34;:&#34;</span><span class="op" id="3664079">,</span>&nbsp;<span class="builtintype" id="3664081">true</span><span class="op" id="3664085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664089">if</span>&nbsp;<span class="ident" id="3664092">username</span><span class="op" id="3664100">,</span>&nbsp;<span class="ident" id="3664102">err</span>&nbsp;<span class="op" id="3664106">=</span>&nbsp;<span class="ident" id="3664108">unescape</span><span class="op" id="3664116">(</span><span class="ident" id="3664117">username</span><span class="op" id="3664125">,</span>&nbsp;<span class="ident" id="3664127">encodeUserPassword</span><span class="op" id="3664145">)</span><span class="op" id="3664146">;</span>&nbsp;<span class="ident" id="3664148">err</span>&nbsp;<span class="op" id="3664152">!=</span>&nbsp;<span class="builtintype" id="3664155">nil</span>&nbsp;<span class="op" id="3664159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664164">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3664173">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664177">if</span>&nbsp;<span class="ident" id="3664180">password</span><span class="op" id="3664188">,</span>&nbsp;<span class="ident" id="3664190">err</span>&nbsp;<span class="op" id="3664194">=</span>&nbsp;<span class="ident" id="3664196">unescape</span><span class="op" id="3664204">(</span><span class="ident" id="3664205">password</span><span class="op" id="3664213">,</span>&nbsp;<span class="ident" id="3664215">encodeUserPassword</span><span class="op" id="3664233">)</span><span class="op" id="3664234">;</span>&nbsp;<span class="ident" id="3664236">err</span>&nbsp;<span class="op" id="3664240">!=</span>&nbsp;<span class="builtintype" id="3664243">nil</span>&nbsp;<span class="op" id="3664247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664252">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3664261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3664265">user</span>&nbsp;<span class="op" id="3664270">=</span>&nbsp;<span class="ident" id="3664272">UserPassword</span><span class="op" id="3664284">(</span><span class="ident" id="3664285">username</span><span class="op" id="3664293">,</span>&nbsp;<span class="ident" id="3664295">password</span><span class="op" id="3664303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3664306">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3664309">return</span><br>
<span class="lineno"></span><span class="op" id="3664316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3664319">//&nbsp;String&nbsp;reassembles&nbsp;the&nbsp;URL&nbsp;into&nbsp;a&nbsp;valid&nbsp;URL&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3664374">//&nbsp;The&nbsp;general&nbsp;form&nbsp;of&nbsp;the&nbsp;result&nbsp;is&nbsp;one&nbsp;of:</span><br>
<span class="lineno">445</span><span class="comment" id="3664419">//</span><br>
<span class="lineno"></span><span class="comment" id="3664422">//&nbsp;&nbsp;&nbsp;&nbsp;scheme:opaque</span><br>
<span class="lineno"></span><span class="comment" id="3664439">//&nbsp;&nbsp;&nbsp;&nbsp;scheme://userinfo@host/path?query#fragment</span><br>
<span class="lineno"></span><span class="comment" id="3664485">//</span><br>
<span class="lineno"></span><span class="comment" id="3664488">//&nbsp;If&nbsp;u.Opaque&nbsp;is&nbsp;non-empty,&nbsp;String&nbsp;uses&nbsp;the&nbsp;first&nbsp;form;</span><br>
<span class="lineno">450</span><span class="comment" id="3664545">//&nbsp;otherwise&nbsp;it&nbsp;uses&nbsp;the&nbsp;second&nbsp;form.</span><br>
<span class="lineno"></span><span class="comment" id="3664583">//</span><br>
<span class="lineno"></span><span class="comment" id="3664586">//&nbsp;In&nbsp;the&nbsp;second&nbsp;form,&nbsp;the&nbsp;following&nbsp;rules&nbsp;apply:</span><br>
<span class="lineno"></span><span class="comment" id="3664636">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Scheme&nbsp;is&nbsp;empty,&nbsp;scheme:&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3664683">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.User&nbsp;is&nbsp;nil,&nbsp;userinfo@&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">455</span><span class="comment" id="3664728">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;empty,&nbsp;host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3664771">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Scheme&nbsp;and&nbsp;u.Host&nbsp;are&nbsp;empty&nbsp;and&nbsp;u.User&nbsp;is&nbsp;nil,</span><br>
<span class="lineno"></span><span class="comment" id="3664828">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;entire&nbsp;scheme://userinfo@host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3664881">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;non-empty&nbsp;and&nbsp;u.Path&nbsp;begins&nbsp;with&nbsp;a&nbsp;/,</span><br>
<span class="lineno"></span><span class="comment" id="3664937">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;form&nbsp;host/path&nbsp;does&nbsp;not&nbsp;add&nbsp;its&nbsp;own&nbsp;/.</span><br>
<span class="lineno">460</span><span class="comment" id="3664986">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.RawQuery&nbsp;is&nbsp;empty,&nbsp;?query&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3665034">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;u.Fragment&nbsp;is&nbsp;empty,&nbsp;#fragment&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="keyword" id="3665085">func</span>&nbsp;<span class="op" id="3665090">(</span><span class="ident" id="3665091">u</span>&nbsp;<span class="op" id="3665093">*</span><span class="ident" id="3665094">URL</span><span class="op" id="3665097">)</span>&nbsp;<span class="ident" id="3665099">String</span><span class="op" id="3665105">(</span><span class="op" id="3665106">)</span>&nbsp;<span class="builtintype" id="3665108">string</span>&nbsp;<span class="op" id="3665115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665118">var</span>&nbsp;<span class="ident" id="3665122">buf</span>&nbsp;<span class="ident" id="3665126">bytes</span><span class="op" id="3665131">.</span><span class="ident" id="3665132">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665140">if</span>&nbsp;<span class="ident" id="3665143">u</span><span class="op" id="3665144">.</span><span class="ident" id="3665145">Scheme</span>&nbsp;<span class="op" id="3665152">!=</span>&nbsp;<span class="string" id="3665155">&#34;&#34;</span>&nbsp;<span class="op" id="3665158">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665162">buf</span><span class="op" id="3665165">.</span><span class="ident" id="3665166">WriteString</span><span class="op" id="3665177">(</span><span class="ident" id="3665178">u</span><span class="op" id="3665179">.</span><span class="ident" id="3665180">Scheme</span><span class="op" id="3665186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665190">buf</span><span class="op" id="3665193">.</span><span class="ident" id="3665194">WriteByte</span><span class="op" id="3665203">(</span><span class="string" id="3665204">&#39;:&#39;</span><span class="op" id="3665207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3665210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665213">if</span>&nbsp;<span class="ident" id="3665216">u</span><span class="op" id="3665217">.</span><span class="ident" id="3665218">Opaque</span>&nbsp;<span class="op" id="3665225">!=</span>&nbsp;<span class="string" id="3665228">&#34;&#34;</span>&nbsp;<span class="op" id="3665231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665235">buf</span><span class="op" id="3665238">.</span><span class="ident" id="3665239">WriteString</span><span class="op" id="3665250">(</span><span class="ident" id="3665251">u</span><span class="op" id="3665252">.</span><span class="ident" id="3665253">Opaque</span><span class="op" id="3665259">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3665262">}</span>&nbsp;<span class="keyword" id="3665264">else</span>&nbsp;<span class="op" id="3665269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665273">if</span>&nbsp;<span class="ident" id="3665276">u</span><span class="op" id="3665277">.</span><span class="ident" id="3665278">Scheme</span>&nbsp;<span class="op" id="3665285">!=</span>&nbsp;<span class="string" id="3665288">&#34;&#34;</span>&nbsp;<span class="op" id="3665291">||</span>&nbsp;<span class="ident" id="3665294">u</span><span class="op" id="3665295">.</span><span class="ident" id="3665296">Host</span>&nbsp;<span class="op" id="3665301">!=</span>&nbsp;<span class="string" id="3665304">&#34;&#34;</span>&nbsp;<span class="op" id="3665307">||</span>&nbsp;<span class="ident" id="3665310">u</span><span class="op" id="3665311">.</span><span class="ident" id="3665312">User</span>&nbsp;<span class="op" id="3665317">!=</span>&nbsp;<span class="builtintype" id="3665320">nil</span>&nbsp;<span class="op" id="3665324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665329">buf</span><span class="op" id="3665332">.</span><span class="ident" id="3665333">WriteString</span><span class="op" id="3665344">(</span><span class="string" id="3665345">&#34;//&#34;</span><span class="op" id="3665349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665354">if</span>&nbsp;<span class="ident" id="3665357">ui</span>&nbsp;<span class="op" id="3665360">:=</span>&nbsp;<span class="ident" id="3665363">u</span><span class="op" id="3665364">.</span><span class="ident" id="3665365">User</span><span class="op" id="3665369">;</span>&nbsp;<span class="ident" id="3665371">ui</span>&nbsp;<span class="op" id="3665374">!=</span>&nbsp;<span class="builtintype" id="3665377">nil</span>&nbsp;<span class="op" id="3665381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665387">buf</span><span class="op" id="3665390">.</span><span class="ident" id="3665391">WriteString</span><span class="op" id="3665402">(</span><span class="ident" id="3665403">ui</span><span class="op" id="3665405">.</span><span class="ident" id="3665406">String</span><span class="op" id="3665412">(</span><span class="op" id="3665413">)</span><span class="op" id="3665414">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665420">buf</span><span class="op" id="3665423">.</span><span class="ident" id="3665424">WriteByte</span><span class="op" id="3665433">(</span><span class="string" id="3665434">&#39;@&#39;</span><span class="op" id="3665437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3665442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665447">if</span>&nbsp;<span class="ident" id="3665450">h</span>&nbsp;<span class="op" id="3665452">:=</span>&nbsp;<span class="ident" id="3665455">u</span><span class="op" id="3665456">.</span><span class="ident" id="3665457">Host</span><span class="op" id="3665461">;</span>&nbsp;<span class="ident" id="3665463">h</span>&nbsp;<span class="op" id="3665465">!=</span>&nbsp;<span class="string" id="3665468">&#34;&#34;</span>&nbsp;<span class="op" id="3665471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665477">buf</span><span class="op" id="3665480">.</span><span class="ident" id="3665481">WriteString</span><span class="op" id="3665492">(</span><span class="ident" id="3665493">h</span><span class="op" id="3665494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3665499">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3665503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665507">if</span>&nbsp;<span class="ident" id="3665510">u</span><span class="op" id="3665511">.</span><span class="ident" id="3665512">Path</span>&nbsp;<span class="op" id="3665517">!=</span>&nbsp;<span class="string" id="3665520">&#34;&#34;</span>&nbsp;<span class="op" id="3665523">&amp;&amp;</span>&nbsp;<span class="ident" id="3665526">u</span><span class="op" id="3665527">.</span><span class="ident" id="3665528">Path</span><span class="op" id="3665532">[</span><span class="num" id="3665533">0</span><span class="op" id="3665534">]</span>&nbsp;<span class="op" id="3665536">!=</span>&nbsp;<span class="string" id="3665539">&#39;/&#39;</span>&nbsp;<span class="op" id="3665543">&amp;&amp;</span>&nbsp;<span class="ident" id="3665546">u</span><span class="op" id="3665547">.</span><span class="ident" id="3665548">Host</span>&nbsp;<span class="op" id="3665553">!=</span>&nbsp;<span class="string" id="3665556">&#34;&#34;</span>&nbsp;<span class="op" id="3665559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665564">buf</span><span class="op" id="3665567">.</span><span class="ident" id="3665568">WriteByte</span><span class="op" id="3665577">(</span><span class="string" id="3665578">&#39;/&#39;</span><span class="op" id="3665581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3665585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665589">buf</span><span class="op" id="3665592">.</span><span class="ident" id="3665593">WriteString</span><span class="op" id="3665604">(</span><span class="ident" id="3665605">escape</span><span class="op" id="3665611">(</span><span class="ident" id="3665612">u</span><span class="op" id="3665613">.</span><span class="ident" id="3665614">Path</span><span class="op" id="3665618">,</span>&nbsp;<span class="ident" id="3665620">encodePath</span><span class="op" id="3665630">)</span><span class="op" id="3665631">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3665634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665637">if</span>&nbsp;<span class="ident" id="3665640">u</span><span class="op" id="3665641">.</span><span class="ident" id="3665642">RawQuery</span>&nbsp;<span class="op" id="3665651">!=</span>&nbsp;<span class="string" id="3665654">&#34;&#34;</span>&nbsp;<span class="op" id="3665657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665661">buf</span><span class="op" id="3665664">.</span><span class="ident" id="3665665">WriteByte</span><span class="op" id="3665674">(</span><span class="string" id="3665675">&#39;?&#39;</span><span class="op" id="3665678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665682">buf</span><span class="op" id="3665685">.</span><span class="ident" id="3665686">WriteString</span><span class="op" id="3665697">(</span><span class="ident" id="3665698">u</span><span class="op" id="3665699">.</span><span class="ident" id="3665700">RawQuery</span><span class="op" id="3665708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3665711">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665714">if</span>&nbsp;<span class="ident" id="3665717">u</span><span class="op" id="3665718">.</span><span class="ident" id="3665719">Fragment</span>&nbsp;<span class="op" id="3665728">!=</span>&nbsp;<span class="string" id="3665731">&#34;&#34;</span>&nbsp;<span class="op" id="3665734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665738">buf</span><span class="op" id="3665741">.</span><span class="ident" id="3665742">WriteByte</span><span class="op" id="3665751">(</span><span class="string" id="3665752">&#39;#&#39;</span><span class="op" id="3665755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3665759">buf</span><span class="op" id="3665762">.</span><span class="ident" id="3665763">WriteString</span><span class="op" id="3665774">(</span><span class="ident" id="3665775">escape</span><span class="op" id="3665781">(</span><span class="ident" id="3665782">u</span><span class="op" id="3665783">.</span><span class="ident" id="3665784">Fragment</span><span class="op" id="3665792">,</span>&nbsp;<span class="ident" id="3665794">encodeFragment</span><span class="op" id="3665808">)</span><span class="op" id="3665809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3665812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3665815">return</span>&nbsp;<span class="ident" id="3665822">buf</span><span class="op" id="3665825">.</span><span class="ident" id="3665826">String</span><span class="op" id="3665832">(</span><span class="op" id="3665833">)</span><br>
<span class="lineno">495</span><span class="op" id="3665835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3665838">//&nbsp;Values&nbsp;maps&nbsp;a&nbsp;string&nbsp;key&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3665887">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;for&nbsp;query&nbsp;parameters&nbsp;and&nbsp;form&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3665949">//&nbsp;Unlike&nbsp;in&nbsp;the&nbsp;http.Header&nbsp;map,&nbsp;the&nbsp;keys&nbsp;in&nbsp;a&nbsp;Values&nbsp;map</span><br>
<span class="lineno">500</span><span class="comment" id="3666008">//&nbsp;are&nbsp;case-sensitive.</span><br>
<span class="lineno"></span><span class="keyword" id="3666031">type</span>&nbsp;<span class="ident" id="3666036">Values</span>&nbsp;<span class="keyword" id="3666043">map</span><span class="op" id="3666046">[</span><span class="builtintype" id="3666047">string</span><span class="op" id="3666053">]</span><span class="op" id="3666054">[</span><span class="op" id="3666055">]</span><span class="builtintype" id="3666056">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3666064">//&nbsp;Get&nbsp;gets&nbsp;the&nbsp;first&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3666123">//&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;values&nbsp;associated&nbsp;with&nbsp;the&nbsp;key,&nbsp;Get&nbsp;returns</span><br>
<span class="lineno">505</span><span class="comment" id="3666186">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values,&nbsp;use&nbsp;the&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="3666246">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3666259">func</span>&nbsp;<span class="op" id="3666264">(</span><span class="ident" id="3666265">v</span>&nbsp;<span class="ident" id="3666267">Values</span><span class="op" id="3666273">)</span>&nbsp;<span class="ident" id="3666275">Get</span><span class="op" id="3666278">(</span><span class="ident" id="3666279">key</span>&nbsp;<span class="builtintype" id="3666283">string</span><span class="op" id="3666289">)</span>&nbsp;<span class="builtintype" id="3666291">string</span>&nbsp;<span class="op" id="3666298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3666301">if</span>&nbsp;<span class="ident" id="3666304">v</span>&nbsp;<span class="op" id="3666306">==</span>&nbsp;<span class="builtintype" id="3666309">nil</span>&nbsp;<span class="op" id="3666313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3666317">return</span>&nbsp;<span class="string" id="3666324">&#34;&#34;</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3666328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3666331">vs</span><span class="op" id="3666333">,</span>&nbsp;<span class="ident" id="3666335">ok</span>&nbsp;<span class="op" id="3666338">:=</span>&nbsp;<span class="ident" id="3666341">v</span><span class="op" id="3666342">[</span><span class="ident" id="3666343">key</span><span class="op" id="3666346">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3666349">if</span>&nbsp;<span class="op" id="3666352">!</span><span class="ident" id="3666353">ok</span>&nbsp;<span class="op" id="3666356">||</span>&nbsp;<span class="builtinfunc" id="3666359">len</span><span class="op" id="3666362">(</span><span class="ident" id="3666363">vs</span><span class="op" id="3666365">)</span>&nbsp;<span class="op" id="3666367">==</span>&nbsp;<span class="num" id="3666370">0</span>&nbsp;<span class="op" id="3666372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3666376">return</span>&nbsp;<span class="string" id="3666383">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3666387">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3666390">return</span>&nbsp;<span class="ident" id="3666397">vs</span><span class="op" id="3666399">[</span><span class="num" id="3666400">0</span><span class="op" id="3666401">]</span><br>
<span class="lineno"></span><span class="op" id="3666403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3666406">//&nbsp;Set&nbsp;sets&nbsp;the&nbsp;key&nbsp;to&nbsp;value.&nbsp;It&nbsp;replaces&nbsp;any&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="3666461">//&nbsp;values.</span><br>
<span class="lineno">520</span><span class="keyword" id="3666472">func</span>&nbsp;<span class="op" id="3666477">(</span><span class="ident" id="3666478">v</span>&nbsp;<span class="ident" id="3666480">Values</span><span class="op" id="3666486">)</span>&nbsp;<span class="ident" id="3666488">Set</span><span class="op" id="3666491">(</span><span class="ident" id="3666492">key</span><span class="op" id="3666495">,</span>&nbsp;<span class="ident" id="3666497">value</span>&nbsp;<span class="builtintype" id="3666503">string</span><span class="op" id="3666509">)</span>&nbsp;<span class="op" id="3666511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3666514">v</span><span class="op" id="3666515">[</span><span class="ident" id="3666516">key</span><span class="op" id="3666519">]</span>&nbsp;<span class="op" id="3666521">=</span>&nbsp;<span class="op" id="3666523">[</span><span class="op" id="3666524">]</span><span class="builtintype" id="3666525">string</span><span class="op" id="3666531">{</span><span class="ident" id="3666532">value</span><span class="op" id="3666537">}</span><br>
<span class="lineno"></span><span class="op" id="3666539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3666542">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;value&nbsp;to&nbsp;key.&nbsp;It&nbsp;appends&nbsp;to&nbsp;any&nbsp;existing</span><br>
<span class="lineno">525</span><span class="comment" id="3666599">//&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3666630">func</span>&nbsp;<span class="op" id="3666635">(</span><span class="ident" id="3666636">v</span>&nbsp;<span class="ident" id="3666638">Values</span><span class="op" id="3666644">)</span>&nbsp;<span class="ident" id="3666646">Add</span><span class="op" id="3666649">(</span><span class="ident" id="3666650">key</span><span class="op" id="3666653">,</span>&nbsp;<span class="ident" id="3666655">value</span>&nbsp;<span class="builtintype" id="3666661">string</span><span class="op" id="3666667">)</span>&nbsp;<span class="op" id="3666669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3666672">v</span><span class="op" id="3666673">[</span><span class="ident" id="3666674">key</span><span class="op" id="3666677">]</span>&nbsp;<span class="op" id="3666679">=</span>&nbsp;<span class="builtinfunc" id="3666681">append</span><span class="op" id="3666687">(</span><span class="ident" id="3666688">v</span><span class="op" id="3666689">[</span><span class="ident" id="3666690">key</span><span class="op" id="3666693">]</span><span class="op" id="3666694">,</span>&nbsp;<span class="ident" id="3666696">value</span><span class="op" id="3666701">)</span><br>
<span class="lineno"></span><span class="op" id="3666703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="3666706">//&nbsp;Del&nbsp;deletes&nbsp;the&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3666753">func</span>&nbsp;<span class="op" id="3666758">(</span><span class="ident" id="3666759">v</span>&nbsp;<span class="ident" id="3666761">Values</span><span class="op" id="3666767">)</span>&nbsp;<span class="ident" id="3666769">Del</span><span class="op" id="3666772">(</span><span class="ident" id="3666773">key</span>&nbsp;<span class="builtintype" id="3666777">string</span><span class="op" id="3666783">)</span>&nbsp;<span class="op" id="3666785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3666788">delete</span><span class="op" id="3666794">(</span><span class="ident" id="3666795">v</span><span class="op" id="3666796">,</span>&nbsp;<span class="ident" id="3666798">key</span><span class="op" id="3666801">)</span><br>
<span class="lineno"></span><span class="op" id="3666803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3666806">//&nbsp;ParseQuery&nbsp;parses&nbsp;the&nbsp;URL-encoded&nbsp;query&nbsp;string&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3666868">//&nbsp;a&nbsp;map&nbsp;listing&nbsp;the&nbsp;values&nbsp;specified&nbsp;for&nbsp;each&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3666920">//&nbsp;ParseQuery&nbsp;always&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;map&nbsp;containing&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3666982">//&nbsp;valid&nbsp;query&nbsp;parameters&nbsp;found;&nbsp;err&nbsp;describes&nbsp;the&nbsp;first&nbsp;decoding&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="3667054">//&nbsp;encountered,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">540</span><span class="keyword" id="3667078">func</span>&nbsp;<span class="ident" id="3667083">ParseQuery</span><span class="op" id="3667093">(</span><span class="ident" id="3667094">query</span>&nbsp;<span class="builtintype" id="3667100">string</span><span class="op" id="3667106">)</span>&nbsp;<span class="op" id="3667108">(</span><span class="ident" id="3667109">m</span>&nbsp;<span class="ident" id="3667111">Values</span><span class="op" id="3667117">,</span>&nbsp;<span class="ident" id="3667119">err</span>&nbsp;<span class="builtintype" id="3667123">error</span><span class="op" id="3667128">)</span>&nbsp;<span class="op" id="3667130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667133">m</span>&nbsp;<span class="op" id="3667135">=</span>&nbsp;<span class="builtinfunc" id="3667137">make</span><span class="op" id="3667141">(</span><span class="ident" id="3667142">Values</span><span class="op" id="3667148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667151">err</span>&nbsp;<span class="op" id="3667155">=</span>&nbsp;<span class="ident" id="3667157">parseQuery</span><span class="op" id="3667167">(</span><span class="ident" id="3667168">m</span><span class="op" id="3667169">,</span>&nbsp;<span class="ident" id="3667171">query</span><span class="op" id="3667176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667179">return</span><br>
<span class="lineno"></span><span class="op" id="3667186">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="keyword" id="3667189">func</span>&nbsp;<span class="ident" id="3667194">parseQuery</span><span class="op" id="3667204">(</span><span class="ident" id="3667205">m</span>&nbsp;<span class="ident" id="3667207">Values</span><span class="op" id="3667213">,</span>&nbsp;<span class="ident" id="3667215">query</span>&nbsp;<span class="builtintype" id="3667221">string</span><span class="op" id="3667227">)</span>&nbsp;<span class="op" id="3667229">(</span><span class="ident" id="3667230">err</span>&nbsp;<span class="builtintype" id="3667234">error</span><span class="op" id="3667239">)</span>&nbsp;<span class="op" id="3667241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667244">for</span>&nbsp;<span class="ident" id="3667248">query</span>&nbsp;<span class="op" id="3667254">!=</span>&nbsp;<span class="string" id="3667257">&#34;&#34;</span>&nbsp;<span class="op" id="3667260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667264">key</span>&nbsp;<span class="op" id="3667268">:=</span>&nbsp;<span class="ident" id="3667271">query</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667279">if</span>&nbsp;<span class="ident" id="3667282">i</span>&nbsp;<span class="op" id="3667284">:=</span>&nbsp;<span class="ident" id="3667287">strings</span><span class="op" id="3667294">.</span><span class="ident" id="3667295">IndexAny</span><span class="op" id="3667303">(</span><span class="ident" id="3667304">key</span><span class="op" id="3667307">,</span>&nbsp;<span class="string" id="3667309">&#34;&amp;;&#34;</span><span class="op" id="3667313">)</span><span class="op" id="3667314">;</span>&nbsp;<span class="ident" id="3667316">i</span>&nbsp;<span class="op" id="3667318">&gt;=</span>&nbsp;<span class="num" id="3667321">0</span>&nbsp;<span class="op" id="3667323">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667328">key</span><span class="op" id="3667331">,</span>&nbsp;<span class="ident" id="3667333">query</span>&nbsp;<span class="op" id="3667339">=</span>&nbsp;<span class="ident" id="3667341">key</span><span class="op" id="3667344">[</span><span class="op" id="3667345">:</span><span class="ident" id="3667346">i</span><span class="op" id="3667347">]</span><span class="op" id="3667348">,</span>&nbsp;<span class="ident" id="3667350">key</span><span class="op" id="3667353">[</span><span class="ident" id="3667354">i</span><span class="op" id="3667355">+</span><span class="num" id="3667356">1</span><span class="op" id="3667357">:</span><span class="op" id="3667358">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3667362">}</span>&nbsp;<span class="keyword" id="3667364">else</span>&nbsp;<span class="op" id="3667369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667374">query</span>&nbsp;<span class="op" id="3667380">=</span>&nbsp;<span class="string" id="3667382">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3667387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667391">if</span>&nbsp;<span class="ident" id="3667394">key</span>&nbsp;<span class="op" id="3667398">==</span>&nbsp;<span class="string" id="3667401">&#34;&#34;</span>&nbsp;<span class="op" id="3667404">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667409">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3667420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667424">value</span>&nbsp;<span class="op" id="3667430">:=</span>&nbsp;<span class="string" id="3667433">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667438">if</span>&nbsp;<span class="ident" id="3667441">i</span>&nbsp;<span class="op" id="3667443">:=</span>&nbsp;<span class="ident" id="3667446">strings</span><span class="op" id="3667453">.</span><span class="ident" id="3667454">Index</span><span class="op" id="3667459">(</span><span class="ident" id="3667460">key</span><span class="op" id="3667463">,</span>&nbsp;<span class="string" id="3667465">&#34;=&#34;</span><span class="op" id="3667468">)</span><span class="op" id="3667469">;</span>&nbsp;<span class="ident" id="3667471">i</span>&nbsp;<span class="op" id="3667473">&gt;=</span>&nbsp;<span class="num" id="3667476">0</span>&nbsp;<span class="op" id="3667478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667483">key</span><span class="op" id="3667486">,</span>&nbsp;<span class="ident" id="3667488">value</span>&nbsp;<span class="op" id="3667494">=</span>&nbsp;<span class="ident" id="3667496">key</span><span class="op" id="3667499">[</span><span class="op" id="3667500">:</span><span class="ident" id="3667501">i</span><span class="op" id="3667502">]</span><span class="op" id="3667503">,</span>&nbsp;<span class="ident" id="3667505">key</span><span class="op" id="3667508">[</span><span class="ident" id="3667509">i</span><span class="op" id="3667510">+</span><span class="num" id="3667511">1</span><span class="op" id="3667512">:</span><span class="op" id="3667513">]</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3667517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667521">key</span><span class="op" id="3667524">,</span>&nbsp;<span class="ident" id="3667526">err1</span>&nbsp;<span class="op" id="3667531">:=</span>&nbsp;<span class="ident" id="3667534">QueryUnescape</span><span class="op" id="3667547">(</span><span class="ident" id="3667548">key</span><span class="op" id="3667551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667555">if</span>&nbsp;<span class="ident" id="3667558">err1</span>&nbsp;<span class="op" id="3667563">!=</span>&nbsp;<span class="builtintype" id="3667566">nil</span>&nbsp;<span class="op" id="3667570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667575">if</span>&nbsp;<span class="ident" id="3667578">err</span>&nbsp;<span class="op" id="3667582">==</span>&nbsp;<span class="builtintype" id="3667585">nil</span>&nbsp;<span class="op" id="3667589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667595">err</span>&nbsp;<span class="op" id="3667599">=</span>&nbsp;<span class="ident" id="3667601">err1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3667609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667614">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3667625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667629">value</span><span class="op" id="3667634">,</span>&nbsp;<span class="ident" id="3667636">err1</span>&nbsp;<span class="op" id="3667641">=</span>&nbsp;<span class="ident" id="3667643">QueryUnescape</span><span class="op" id="3667656">(</span><span class="ident" id="3667657">value</span><span class="op" id="3667662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667666">if</span>&nbsp;<span class="ident" id="3667669">err1</span>&nbsp;<span class="op" id="3667674">!=</span>&nbsp;<span class="builtintype" id="3667677">nil</span>&nbsp;<span class="op" id="3667681">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667686">if</span>&nbsp;<span class="ident" id="3667689">err</span>&nbsp;<span class="op" id="3667693">==</span>&nbsp;<span class="builtintype" id="3667696">nil</span>&nbsp;<span class="op" id="3667700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667706">err</span>&nbsp;<span class="op" id="3667710">=</span>&nbsp;<span class="ident" id="3667712">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3667720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667725">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3667736">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667740">m</span><span class="op" id="3667741">[</span><span class="ident" id="3667742">key</span><span class="op" id="3667745">]</span>&nbsp;<span class="op" id="3667747">=</span>&nbsp;<span class="builtinfunc" id="3667749">append</span><span class="op" id="3667755">(</span><span class="ident" id="3667756">m</span><span class="op" id="3667757">[</span><span class="ident" id="3667758">key</span><span class="op" id="3667761">]</span><span class="op" id="3667762">,</span>&nbsp;<span class="ident" id="3667764">value</span><span class="op" id="3667769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3667772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667775">return</span>&nbsp;<span class="ident" id="3667782">err</span><br>
<span class="lineno"></span><span class="op" id="3667786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="3667789">//&nbsp;Encode&nbsp;encodes&nbsp;the&nbsp;values&nbsp;into&nbsp;``URL&nbsp;encoded&#39;&#39;&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3667844">//&nbsp;(&#34;bar=baz&amp;foo=quux&#34;)&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3667883">func</span>&nbsp;<span class="op" id="3667888">(</span><span class="ident" id="3667889">v</span>&nbsp;<span class="ident" id="3667891">Values</span><span class="op" id="3667897">)</span>&nbsp;<span class="ident" id="3667899">Encode</span><span class="op" id="3667905">(</span><span class="op" id="3667906">)</span>&nbsp;<span class="builtintype" id="3667908">string</span>&nbsp;<span class="op" id="3667915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667918">if</span>&nbsp;<span class="ident" id="3667921">v</span>&nbsp;<span class="op" id="3667923">==</span>&nbsp;<span class="builtintype" id="3667926">nil</span>&nbsp;<span class="op" id="3667930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667934">return</span>&nbsp;<span class="string" id="3667941">&#34;&#34;</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3667945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667948">var</span>&nbsp;<span class="ident" id="3667952">buf</span>&nbsp;<span class="ident" id="3667956">bytes</span><span class="op" id="3667961">.</span><span class="ident" id="3667962">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667970">keys</span>&nbsp;<span class="op" id="3667975">:=</span>&nbsp;<span class="builtinfunc" id="3667978">make</span><span class="op" id="3667982">(</span><span class="op" id="3667983">[</span><span class="op" id="3667984">]</span><span class="builtintype" id="3667985">string</span><span class="op" id="3667991">,</span>&nbsp;<span class="num" id="3667993">0</span><span class="op" id="3667994">,</span>&nbsp;<span class="builtinfunc" id="3667996">len</span><span class="op" id="3667999">(</span><span class="ident" id="3668000">v</span><span class="op" id="3668001">)</span><span class="op" id="3668002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668005">for</span>&nbsp;<span class="ident" id="3668009">k</span>&nbsp;<span class="op" id="3668011">:=</span>&nbsp;<span class="keyword" id="3668014">range</span>&nbsp;<span class="ident" id="3668020">v</span>&nbsp;<span class="op" id="3668022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668026">keys</span>&nbsp;<span class="op" id="3668031">=</span>&nbsp;<span class="builtinfunc" id="3668033">append</span><span class="op" id="3668039">(</span><span class="ident" id="3668040">keys</span><span class="op" id="3668044">,</span>&nbsp;<span class="ident" id="3668046">k</span><span class="op" id="3668047">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3668050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668053">sort</span><span class="op" id="3668057">.</span><span class="ident" id="3668058">Strings</span><span class="op" id="3668065">(</span><span class="ident" id="3668066">keys</span><span class="op" id="3668070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668073">for</span>&nbsp;<span class="ident" id="3668077">_</span><span class="op" id="3668078">,</span>&nbsp;<span class="ident" id="3668080">k</span>&nbsp;<span class="op" id="3668082">:=</span>&nbsp;<span class="keyword" id="3668085">range</span>&nbsp;<span class="ident" id="3668091">keys</span>&nbsp;<span class="op" id="3668096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668100">vs</span>&nbsp;<span class="op" id="3668103">:=</span>&nbsp;<span class="ident" id="3668106">v</span><span class="op" id="3668107">[</span><span class="ident" id="3668108">k</span><span class="op" id="3668109">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668113">prefix</span>&nbsp;<span class="op" id="3668120">:=</span>&nbsp;<span class="ident" id="3668123">QueryEscape</span><span class="op" id="3668134">(</span><span class="ident" id="3668135">k</span><span class="op" id="3668136">)</span>&nbsp;<span class="op" id="3668138">+</span>&nbsp;<span class="string" id="3668140">&#34;=&#34;</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668146">for</span>&nbsp;<span class="ident" id="3668150">_</span><span class="op" id="3668151">,</span>&nbsp;<span class="ident" id="3668153">v</span>&nbsp;<span class="op" id="3668155">:=</span>&nbsp;<span class="keyword" id="3668158">range</span>&nbsp;<span class="ident" id="3668164">vs</span>&nbsp;<span class="op" id="3668167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668172">if</span>&nbsp;<span class="ident" id="3668175">buf</span><span class="op" id="3668178">.</span><span class="ident" id="3668179">Len</span><span class="op" id="3668182">(</span><span class="op" id="3668183">)</span>&nbsp;<span class="op" id="3668185">&gt;</span>&nbsp;<span class="num" id="3668187">0</span>&nbsp;<span class="op" id="3668189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668195">buf</span><span class="op" id="3668198">.</span><span class="ident" id="3668199">WriteByte</span><span class="op" id="3668208">(</span><span class="string" id="3668209">&#39;&amp;&#39;</span><span class="op" id="3668212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3668217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668222">buf</span><span class="op" id="3668225">.</span><span class="ident" id="3668226">WriteString</span><span class="op" id="3668237">(</span><span class="ident" id="3668238">prefix</span><span class="op" id="3668244">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668249">buf</span><span class="op" id="3668252">.</span><span class="ident" id="3668253">WriteString</span><span class="op" id="3668264">(</span><span class="ident" id="3668265">QueryEscape</span><span class="op" id="3668276">(</span><span class="ident" id="3668277">v</span><span class="op" id="3668278">)</span><span class="op" id="3668279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3668283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3668286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668289">return</span>&nbsp;<span class="ident" id="3668296">buf</span><span class="op" id="3668299">.</span><span class="ident" id="3668300">String</span><span class="op" id="3668306">(</span><span class="op" id="3668307">)</span><br>
<span class="lineno"></span><span class="op" id="3668309">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="comment" id="3668312">//&nbsp;resolvePath&nbsp;applies&nbsp;special&nbsp;path&nbsp;segments&nbsp;from&nbsp;refs&nbsp;and&nbsp;applies</span><br>
<span class="lineno"></span><span class="comment" id="3668379">//&nbsp;them&nbsp;to&nbsp;base,&nbsp;per&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3668410">func</span>&nbsp;<span class="ident" id="3668415">resolvePath</span><span class="op" id="3668426">(</span><span class="ident" id="3668427">base</span><span class="op" id="3668431">,</span>&nbsp;<span class="ident" id="3668433">ref</span>&nbsp;<span class="builtintype" id="3668437">string</span><span class="op" id="3668443">)</span>&nbsp;<span class="builtintype" id="3668445">string</span>&nbsp;<span class="op" id="3668452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668455">var</span>&nbsp;<span class="ident" id="3668459">full</span>&nbsp;<span class="builtintype" id="3668464">string</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668472">if</span>&nbsp;<span class="ident" id="3668475">ref</span>&nbsp;<span class="op" id="3668479">==</span>&nbsp;<span class="string" id="3668482">&#34;&#34;</span>&nbsp;<span class="op" id="3668485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668489">full</span>&nbsp;<span class="op" id="3668494">=</span>&nbsp;<span class="ident" id="3668496">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3668502">}</span>&nbsp;<span class="keyword" id="3668504">else</span>&nbsp;<span class="keyword" id="3668509">if</span>&nbsp;<span class="ident" id="3668512">ref</span><span class="op" id="3668515">[</span><span class="num" id="3668516">0</span><span class="op" id="3668517">]</span>&nbsp;<span class="op" id="3668519">!=</span>&nbsp;<span class="string" id="3668522">&#39;/&#39;</span>&nbsp;<span class="op" id="3668526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668530">i</span>&nbsp;<span class="op" id="3668532">:=</span>&nbsp;<span class="ident" id="3668535">strings</span><span class="op" id="3668542">.</span><span class="ident" id="3668543">LastIndex</span><span class="op" id="3668552">(</span><span class="ident" id="3668553">base</span><span class="op" id="3668557">,</span>&nbsp;<span class="string" id="3668559">&#34;/&#34;</span><span class="op" id="3668562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668566">full</span>&nbsp;<span class="op" id="3668571">=</span>&nbsp;<span class="ident" id="3668573">base</span><span class="op" id="3668577">[</span><span class="op" id="3668578">:</span><span class="ident" id="3668579">i</span><span class="op" id="3668580">+</span><span class="num" id="3668581">1</span><span class="op" id="3668582">]</span>&nbsp;<span class="op" id="3668584">+</span>&nbsp;<span class="ident" id="3668586">ref</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3668591">}</span>&nbsp;<span class="keyword" id="3668593">else</span>&nbsp;<span class="op" id="3668598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668602">full</span>&nbsp;<span class="op" id="3668607">=</span>&nbsp;<span class="ident" id="3668609">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3668614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668617">if</span>&nbsp;<span class="ident" id="3668620">full</span>&nbsp;<span class="op" id="3668625">==</span>&nbsp;<span class="string" id="3668628">&#34;&#34;</span>&nbsp;<span class="op" id="3668631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668635">return</span>&nbsp;<span class="string" id="3668642">&#34;&#34;</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3668646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668649">var</span>&nbsp;<span class="ident" id="3668653">dst</span>&nbsp;<span class="op" id="3668657">[</span><span class="op" id="3668658">]</span><span class="builtintype" id="3668659">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668667">src</span>&nbsp;<span class="op" id="3668671">:=</span>&nbsp;<span class="ident" id="3668674">strings</span><span class="op" id="3668681">.</span><span class="ident" id="3668682">Split</span><span class="op" id="3668687">(</span><span class="ident" id="3668688">full</span><span class="op" id="3668692">,</span>&nbsp;<span class="string" id="3668694">&#34;/&#34;</span><span class="op" id="3668697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668700">for</span>&nbsp;<span class="ident" id="3668704">_</span><span class="op" id="3668705">,</span>&nbsp;<span class="ident" id="3668707">elem</span>&nbsp;<span class="op" id="3668712">:=</span>&nbsp;<span class="keyword" id="3668715">range</span>&nbsp;<span class="ident" id="3668721">src</span>&nbsp;<span class="op" id="3668725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668729">switch</span>&nbsp;<span class="ident" id="3668736">elem</span>&nbsp;<span class="op" id="3668741">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668745">case</span>&nbsp;<span class="string" id="3668750">&#34;.&#34;</span><span class="op" id="3668753">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3668758">//&nbsp;drop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668768">case</span>&nbsp;<span class="string" id="3668773">&#34;..&#34;</span><span class="op" id="3668777">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668782">if</span>&nbsp;<span class="builtinfunc" id="3668785">len</span><span class="op" id="3668788">(</span><span class="ident" id="3668789">dst</span><span class="op" id="3668792">)</span>&nbsp;<span class="op" id="3668794">&gt;</span>&nbsp;<span class="num" id="3668796">0</span>&nbsp;<span class="op" id="3668798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668804">dst</span>&nbsp;<span class="op" id="3668808">=</span>&nbsp;<span class="ident" id="3668810">dst</span><span class="op" id="3668813">[</span><span class="op" id="3668814">:</span><span class="builtinfunc" id="3668815">len</span><span class="op" id="3668818">(</span><span class="ident" id="3668819">dst</span><span class="op" id="3668822">)</span><span class="op" id="3668823">-</span><span class="num" id="3668824">1</span><span class="op" id="3668825">]</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3668830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668834">default</span><span class="op" id="3668841">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668846">dst</span>&nbsp;<span class="op" id="3668850">=</span>&nbsp;<span class="builtinfunc" id="3668852">append</span><span class="op" id="3668858">(</span><span class="ident" id="3668859">dst</span><span class="op" id="3668862">,</span>&nbsp;<span class="ident" id="3668864">elem</span><span class="op" id="3668868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3668872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3668875">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668878">if</span>&nbsp;<span class="ident" id="3668881">last</span>&nbsp;<span class="op" id="3668886">:=</span>&nbsp;<span class="ident" id="3668889">src</span><span class="op" id="3668892">[</span><span class="builtinfunc" id="3668893">len</span><span class="op" id="3668896">(</span><span class="ident" id="3668897">src</span><span class="op" id="3668900">)</span><span class="op" id="3668901">-</span><span class="num" id="3668902">1</span><span class="op" id="3668903">]</span><span class="op" id="3668904">;</span>&nbsp;<span class="ident" id="3668906">last</span>&nbsp;<span class="op" id="3668911">==</span>&nbsp;<span class="string" id="3668914">&#34;.&#34;</span>&nbsp;<span class="op" id="3668918">||</span>&nbsp;<span class="ident" id="3668921">last</span>&nbsp;<span class="op" id="3668926">==</span>&nbsp;<span class="string" id="3668929">&#34;..&#34;</span>&nbsp;<span class="op" id="3668934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3668938">//&nbsp;Add&nbsp;final&nbsp;slash&nbsp;to&nbsp;the&nbsp;joined&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668979">dst</span>&nbsp;<span class="op" id="3668983">=</span>&nbsp;<span class="builtinfunc" id="3668985">append</span><span class="op" id="3668991">(</span><span class="ident" id="3668992">dst</span><span class="op" id="3668995">,</span>&nbsp;<span class="string" id="3668997">&#34;&#34;</span><span class="op" id="3668999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3669002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3669005">return</span>&nbsp;<span class="string" id="3669012">&#34;/&#34;</span>&nbsp;<span class="op" id="3669016">+</span>&nbsp;<span class="ident" id="3669018">strings</span><span class="op" id="3669025">.</span><span class="ident" id="3669026">TrimLeft</span><span class="op" id="3669034">(</span><span class="ident" id="3669035">strings</span><span class="op" id="3669042">.</span><span class="ident" id="3669043">Join</span><span class="op" id="3669047">(</span><span class="ident" id="3669048">dst</span><span class="op" id="3669051">,</span>&nbsp;<span class="string" id="3669053">&#34;/&#34;</span><span class="op" id="3669056">)</span><span class="op" id="3669057">,</span>&nbsp;<span class="string" id="3669059">&#34;/&#34;</span><span class="op" id="3669062">)</span><br>
<span class="lineno">640</span><span class="op" id="3669064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3669067">//&nbsp;IsAbs&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;URL&nbsp;is&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3669113">func</span>&nbsp;<span class="op" id="3669118">(</span><span class="ident" id="3669119">u</span>&nbsp;<span class="op" id="3669121">*</span><span class="ident" id="3669122">URL</span><span class="op" id="3669125">)</span>&nbsp;<span class="ident" id="3669127">IsAbs</span><span class="op" id="3669132">(</span><span class="op" id="3669133">)</span>&nbsp;<span class="builtintype" id="3669135">bool</span>&nbsp;<span class="op" id="3669140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3669143">return</span>&nbsp;<span class="ident" id="3669150">u</span><span class="op" id="3669151">.</span><span class="ident" id="3669152">Scheme</span>&nbsp;<span class="op" id="3669159">!=</span>&nbsp;<span class="string" id="3669162">&#34;&#34;</span><br>
<span class="lineno">645</span><span class="op" id="3669165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3669168">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;in&nbsp;the&nbsp;context&nbsp;of&nbsp;the&nbsp;receiver.&nbsp;&nbsp;The&nbsp;provided&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="3669240">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;Parse&nbsp;returns&nbsp;nil,&nbsp;err&nbsp;on&nbsp;parse</span><br>
<span class="lineno"></span><span class="comment" id="3669305">//&nbsp;failure,&nbsp;otherwise&nbsp;its&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;ResolveReference.</span><br>
<span class="lineno">650</span><span class="keyword" id="3669377">func</span>&nbsp;<span class="op" id="3669382">(</span><span class="ident" id="3669383">u</span>&nbsp;<span class="op" id="3669385">*</span><span class="ident" id="3669386">URL</span><span class="op" id="3669389">)</span>&nbsp;<span class="ident" id="3669391">Parse</span><span class="op" id="3669396">(</span><span class="ident" id="3669397">ref</span>&nbsp;<span class="builtintype" id="3669401">string</span><span class="op" id="3669407">)</span>&nbsp;<span class="op" id="3669409">(</span><span class="op" id="3669410">*</span><span class="ident" id="3669411">URL</span><span class="op" id="3669414">,</span>&nbsp;<span class="builtintype" id="3669416">error</span><span class="op" id="3669421">)</span>&nbsp;<span class="op" id="3669423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3669426">refurl</span><span class="op" id="3669432">,</span>&nbsp;<span class="ident" id="3669434">err</span>&nbsp;<span class="op" id="3669438">:=</span>&nbsp;<span class="ident" id="3669441">Parse</span><span class="op" id="3669446">(</span><span class="ident" id="3669447">ref</span><span class="op" id="3669450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3669453">if</span>&nbsp;<span class="ident" id="3669456">err</span>&nbsp;<span class="op" id="3669460">!=</span>&nbsp;<span class="builtintype" id="3669463">nil</span>&nbsp;<span class="op" id="3669467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3669471">return</span>&nbsp;<span class="builtintype" id="3669478">nil</span><span class="op" id="3669481">,</span>&nbsp;<span class="ident" id="3669483">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3669488">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3669491">return</span>&nbsp;<span class="ident" id="3669498">u</span><span class="op" id="3669499">.</span><span class="ident" id="3669500">ResolveReference</span><span class="op" id="3669516">(</span><span class="ident" id="3669517">refurl</span><span class="op" id="3669523">)</span><span class="op" id="3669524">,</span>&nbsp;<span class="builtintype" id="3669526">nil</span><br>
<span class="lineno"></span><span class="op" id="3669530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3669533">//&nbsp;ResolveReference&nbsp;resolves&nbsp;a&nbsp;URI&nbsp;reference&nbsp;to&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3669602">//&nbsp;an&nbsp;absolute&nbsp;base&nbsp;URI,&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;Section&nbsp;5.2.&nbsp;&nbsp;The&nbsp;URI&nbsp;reference</span><br>
<span class="lineno">660</span><span class="comment" id="3669672">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;ResolveReference&nbsp;always&nbsp;returns&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3669743">//&nbsp;URL&nbsp;instance,&nbsp;even&nbsp;if&nbsp;the&nbsp;returned&nbsp;URL&nbsp;is&nbsp;identical&nbsp;to&nbsp;either&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3669812">//&nbsp;base&nbsp;or&nbsp;reference.&nbsp;If&nbsp;ref&nbsp;is&nbsp;an&nbsp;absolute&nbsp;URL,&nbsp;then&nbsp;ResolveReference</span><br>
<span class="lineno"></span><span class="comment" id="3669883">//&nbsp;ignores&nbsp;base&nbsp;and&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;ref.</span><br>
<span class="lineno"></span><span class="keyword" id="3669926">func</span>&nbsp;<span class="op" id="3669931">(</span><span class="ident" id="3669932">u</span>&nbsp;<span class="op" id="3669934">*</span><span class="ident" id="3669935">URL</span><span class="op" id="3669938">)</span>&nbsp;<span class="ident" id="3669940">ResolveReference</span><span class="op" id="3669956">(</span><span class="ident" id="3669957">ref</span>&nbsp;<span class="op" id="3669961">*</span><span class="ident" id="3669962">URL</span><span class="op" id="3669965">)</span>&nbsp;<span class="op" id="3669967">*</span><span class="ident" id="3669968">URL</span>&nbsp;<span class="op" id="3669972">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3669975">url</span>&nbsp;<span class="op" id="3669979">:=</span>&nbsp;<span class="op" id="3669982">*</span><span class="ident" id="3669983">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3669988">if</span>&nbsp;<span class="ident" id="3669991">ref</span><span class="op" id="3669994">.</span><span class="ident" id="3669995">Scheme</span>&nbsp;<span class="op" id="3670002">==</span>&nbsp;<span class="string" id="3670005">&#34;&#34;</span>&nbsp;<span class="op" id="3670008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670012">url</span><span class="op" id="3670015">.</span><span class="ident" id="3670016">Scheme</span>&nbsp;<span class="op" id="3670023">=</span>&nbsp;<span class="ident" id="3670025">u</span><span class="op" id="3670026">.</span><span class="ident" id="3670027">Scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3670035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3670038">if</span>&nbsp;<span class="ident" id="3670041">ref</span><span class="op" id="3670044">.</span><span class="ident" id="3670045">Scheme</span>&nbsp;<span class="op" id="3670052">!=</span>&nbsp;<span class="string" id="3670055">&#34;&#34;</span>&nbsp;<span class="op" id="3670058">||</span>&nbsp;<span class="ident" id="3670061">ref</span><span class="op" id="3670064">.</span><span class="ident" id="3670065">Host</span>&nbsp;<span class="op" id="3670070">!=</span>&nbsp;<span class="string" id="3670073">&#34;&#34;</span>&nbsp;<span class="op" id="3670076">||</span>&nbsp;<span class="ident" id="3670079">ref</span><span class="op" id="3670082">.</span><span class="ident" id="3670083">User</span>&nbsp;<span class="op" id="3670088">!=</span>&nbsp;<span class="builtintype" id="3670091">nil</span>&nbsp;<span class="op" id="3670095">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3670099">//&nbsp;The&nbsp;&#34;absoluteURI&#34;&nbsp;or&nbsp;&#34;net_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670143">url</span><span class="op" id="3670146">.</span><span class="ident" id="3670147">Path</span>&nbsp;<span class="op" id="3670152">=</span>&nbsp;<span class="ident" id="3670154">resolvePath</span><span class="op" id="3670165">(</span><span class="ident" id="3670166">ref</span><span class="op" id="3670169">.</span><span class="ident" id="3670170">Path</span><span class="op" id="3670174">,</span>&nbsp;<span class="string" id="3670176">&#34;&#34;</span><span class="op" id="3670178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3670182">return</span>&nbsp;<span class="op" id="3670189">&amp;</span><span class="ident" id="3670190">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3670195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3670198">if</span>&nbsp;<span class="ident" id="3670201">ref</span><span class="op" id="3670204">.</span><span class="ident" id="3670205">Opaque</span>&nbsp;<span class="op" id="3670212">!=</span>&nbsp;<span class="string" id="3670215">&#34;&#34;</span>&nbsp;<span class="op" id="3670218">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670222">url</span><span class="op" id="3670225">.</span><span class="ident" id="3670226">User</span>&nbsp;<span class="op" id="3670231">=</span>&nbsp;<span class="builtintype" id="3670233">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670239">url</span><span class="op" id="3670242">.</span><span class="ident" id="3670243">Host</span>&nbsp;<span class="op" id="3670248">=</span>&nbsp;<span class="string" id="3670250">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670255">url</span><span class="op" id="3670258">.</span><span class="ident" id="3670259">Path</span>&nbsp;<span class="op" id="3670264">=</span>&nbsp;<span class="string" id="3670266">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3670271">return</span>&nbsp;<span class="op" id="3670278">&amp;</span><span class="ident" id="3670279">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3670284">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3670287">if</span>&nbsp;<span class="ident" id="3670290">ref</span><span class="op" id="3670293">.</span><span class="ident" id="3670294">Path</span>&nbsp;<span class="op" id="3670299">==</span>&nbsp;<span class="string" id="3670302">&#34;&#34;</span>&nbsp;<span class="op" id="3670305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3670309">if</span>&nbsp;<span class="ident" id="3670312">ref</span><span class="op" id="3670315">.</span><span class="ident" id="3670316">RawQuery</span>&nbsp;<span class="op" id="3670325">==</span>&nbsp;<span class="string" id="3670328">&#34;&#34;</span>&nbsp;<span class="op" id="3670331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670336">url</span><span class="op" id="3670339">.</span><span class="ident" id="3670340">RawQuery</span>&nbsp;<span class="op" id="3670349">=</span>&nbsp;<span class="ident" id="3670351">u</span><span class="op" id="3670352">.</span><span class="ident" id="3670353">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3670365">if</span>&nbsp;<span class="ident" id="3670368">ref</span><span class="op" id="3670371">.</span><span class="ident" id="3670372">Fragment</span>&nbsp;<span class="op" id="3670381">==</span>&nbsp;<span class="string" id="3670384">&#34;&#34;</span>&nbsp;<span class="op" id="3670387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670393">url</span><span class="op" id="3670396">.</span><span class="ident" id="3670397">Fragment</span>&nbsp;<span class="op" id="3670406">=</span>&nbsp;<span class="ident" id="3670408">u</span><span class="op" id="3670409">.</span><span class="ident" id="3670410">Fragment</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3670422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3670426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3670429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3670432">//&nbsp;The&nbsp;&#34;abs_path&#34;&nbsp;or&nbsp;&#34;rel_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670472">url</span><span class="op" id="3670475">.</span><span class="ident" id="3670476">Host</span>&nbsp;<span class="op" id="3670481">=</span>&nbsp;<span class="ident" id="3670483">u</span><span class="op" id="3670484">.</span><span class="ident" id="3670485">Host</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670491">url</span><span class="op" id="3670494">.</span><span class="ident" id="3670495">User</span>&nbsp;<span class="op" id="3670500">=</span>&nbsp;<span class="ident" id="3670502">u</span><span class="op" id="3670503">.</span><span class="ident" id="3670504">User</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670510">url</span><span class="op" id="3670513">.</span><span class="ident" id="3670514">Path</span>&nbsp;<span class="op" id="3670519">=</span>&nbsp;<span class="ident" id="3670521">resolvePath</span><span class="op" id="3670532">(</span><span class="ident" id="3670533">u</span><span class="op" id="3670534">.</span><span class="ident" id="3670535">Path</span><span class="op" id="3670539">,</span>&nbsp;<span class="ident" id="3670541">ref</span><span class="op" id="3670544">.</span><span class="ident" id="3670545">Path</span><span class="op" id="3670549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3670552">return</span>&nbsp;<span class="op" id="3670559">&amp;</span><span class="ident" id="3670560">url</span><br>
<span class="lineno"></span><span class="op" id="3670564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="3670567">//&nbsp;Query&nbsp;parses&nbsp;RawQuery&nbsp;and&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3670630">func</span>&nbsp;<span class="op" id="3670635">(</span><span class="ident" id="3670636">u</span>&nbsp;<span class="op" id="3670638">*</span><span class="ident" id="3670639">URL</span><span class="op" id="3670642">)</span>&nbsp;<span class="ident" id="3670644">Query</span><span class="op" id="3670649">(</span><span class="op" id="3670650">)</span>&nbsp;<span class="ident" id="3670652">Values</span>&nbsp;<span class="op" id="3670659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670662">v</span><span class="op" id="3670663">,</span>&nbsp;<span class="ident" id="3670665">_</span>&nbsp;<span class="op" id="3670667">:=</span>&nbsp;<span class="ident" id="3670670">ParseQuery</span><span class="op" id="3670680">(</span><span class="ident" id="3670681">u</span><span class="op" id="3670682">.</span><span class="ident" id="3670683">RawQuery</span><span class="op" id="3670691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3670694">return</span>&nbsp;<span class="ident" id="3670701">v</span><br>
<span class="lineno"></span><span class="op" id="3670703">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="comment" id="3670706">//&nbsp;RequestURI&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;path?query&nbsp;or&nbsp;opaque?query</span><br>
<span class="lineno"></span><span class="comment" id="3670767">//&nbsp;string&nbsp;that&nbsp;would&nbsp;be&nbsp;used&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;for&nbsp;u.</span><br>
<span class="lineno"></span><span class="keyword" id="3670822">func</span>&nbsp;<span class="op" id="3670827">(</span><span class="ident" id="3670828">u</span>&nbsp;<span class="op" id="3670830">*</span><span class="ident" id="3670831">URL</span><span class="op" id="3670834">)</span>&nbsp;<span class="ident" id="3670836">RequestURI</span><span class="op" id="3670846">(</span><span class="op" id="3670847">)</span>&nbsp;<span class="builtintype" id="3670849">string</span>&nbsp;<span class="op" id="3670856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670859">result</span>&nbsp;<span class="op" id="3670866">:=</span>&nbsp;<span class="ident" id="3670869">u</span><span class="op" id="3670870">.</span><span class="ident" id="3670871">Opaque</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3670879">if</span>&nbsp;<span class="ident" id="3670882">result</span>&nbsp;<span class="op" id="3670889">==</span>&nbsp;<span class="string" id="3670892">&#34;&#34;</span>&nbsp;<span class="op" id="3670895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670899">result</span>&nbsp;<span class="op" id="3670906">=</span>&nbsp;<span class="ident" id="3670908">escape</span><span class="op" id="3670914">(</span><span class="ident" id="3670915">u</span><span class="op" id="3670916">.</span><span class="ident" id="3670917">Path</span><span class="op" id="3670921">,</span>&nbsp;<span class="ident" id="3670923">encodePath</span><span class="op" id="3670933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3670937">if</span>&nbsp;<span class="ident" id="3670940">result</span>&nbsp;<span class="op" id="3670947">==</span>&nbsp;<span class="string" id="3670950">&#34;&#34;</span>&nbsp;<span class="op" id="3670953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670958">result</span>&nbsp;<span class="op" id="3670965">=</span>&nbsp;<span class="string" id="3670967">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3670973">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3670976">}</span>&nbsp;<span class="keyword" id="3670978">else</span>&nbsp;<span class="op" id="3670983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3670987">if</span>&nbsp;<span class="ident" id="3670990">strings</span><span class="op" id="3670997">.</span><span class="ident" id="3670998">HasPrefix</span><span class="op" id="3671007">(</span><span class="ident" id="3671008">result</span><span class="op" id="3671014">,</span>&nbsp;<span class="string" id="3671016">&#34;//&#34;</span><span class="op" id="3671020">)</span>&nbsp;<span class="op" id="3671022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3671027">result</span>&nbsp;<span class="op" id="3671034">=</span>&nbsp;<span class="ident" id="3671036">u</span><span class="op" id="3671037">.</span><span class="ident" id="3671038">Scheme</span>&nbsp;<span class="op" id="3671045">+</span>&nbsp;<span class="string" id="3671047">&#34;:&#34;</span>&nbsp;<span class="op" id="3671051">+</span>&nbsp;<span class="ident" id="3671053">result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3671062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3671065">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3671068">if</span>&nbsp;<span class="ident" id="3671071">u</span><span class="op" id="3671072">.</span><span class="ident" id="3671073">RawQuery</span>&nbsp;<span class="op" id="3671082">!=</span>&nbsp;<span class="string" id="3671085">&#34;&#34;</span>&nbsp;<span class="op" id="3671088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3671092">result</span>&nbsp;<span class="op" id="3671099">+=</span>&nbsp;<span class="string" id="3671102">&#34;?&#34;</span>&nbsp;<span class="op" id="3671106">+</span>&nbsp;<span class="ident" id="3671108">u</span><span class="op" id="3671109">.</span><span class="ident" id="3671110">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3671120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3671123">return</span>&nbsp;<span class="ident" id="3671130">result</span><br>
<span class="lineno"></span><span class="op" id="3671137">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
