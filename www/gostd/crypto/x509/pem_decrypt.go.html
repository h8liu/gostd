<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4238465">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4238520">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4238574">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4238625">package</span>&nbsp;<span class="ident" id="4238633">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4238639">//&nbsp;RFC&nbsp;1423&nbsp;describes&nbsp;the&nbsp;encryption&nbsp;of&nbsp;PEM&nbsp;blocks.&nbsp;The&nbsp;algorithm&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4238713">//&nbsp;generate&nbsp;a&nbsp;key&nbsp;from&nbsp;the&nbsp;password&nbsp;was&nbsp;derived&nbsp;by&nbsp;looking&nbsp;at&nbsp;the&nbsp;OpenSSL</span><br>
<span class="lineno"></span><span class="comment" id="4238787">//&nbsp;implementation.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4238807">import</span>&nbsp;<span class="op" id="4238814">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4238817">&#34;crypto/aes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4238831">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4238848">&#34;crypto/des&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4238862">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4238876">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4238892">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4238908">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4238918">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4238924">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4238934">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4238937">type</span>&nbsp;<span class="ident" id="4238942">PEMCipher</span>&nbsp;<span class="builtintype" id="4238952">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4238957">//&nbsp;Possible&nbsp;values&nbsp;for&nbsp;the&nbsp;EncryptPEMBlock&nbsp;encryption&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="4239022">const</span>&nbsp;<span class="op" id="4239028">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239031">_</span>&nbsp;<span class="ident" id="4239033">PEMCipher</span>&nbsp;<span class="op" id="4239043">=</span>&nbsp;<span class="ident" id="4239045">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239051">PEMCipherDES</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239065">PEMCipher3DES</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239080">PEMCipherAES128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239097">PEMCipherAES192</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239114">PEMCipherAES256</span><br>
<span class="lineno"></span><span class="op" id="4239130">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4239133">//&nbsp;rfc1423Algo&nbsp;holds&nbsp;a&nbsp;method&nbsp;for&nbsp;enciphering&nbsp;a&nbsp;PEM&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="4239192">type</span>&nbsp;<span class="ident" id="4239197">rfc1423Algo</span>&nbsp;<span class="keyword" id="4239209">struct</span>&nbsp;<span class="op" id="4239216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239219">cipher</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239230">PEMCipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239241">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4239252">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239260">cipherFunc</span>&nbsp;<span class="keyword" id="4239271">func</span><span class="op" id="4239275">(</span><span class="ident" id="4239276">key</span>&nbsp;<span class="op" id="4239280">[</span><span class="op" id="4239281">]</span><span class="builtintype" id="4239282">byte</span><span class="op" id="4239286">)</span>&nbsp;<span class="op" id="4239288">(</span><span class="ident" id="4239289">cipher</span><span class="op" id="4239295">.</span><span class="ident" id="4239296">Block</span><span class="op" id="4239301">,</span>&nbsp;<span class="builtintype" id="4239303">error</span><span class="op" id="4239308">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239311">keySize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4239322">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239327">blockSize</span>&nbsp;&nbsp;<span class="builtintype" id="4239338">int</span><br>
<span class="lineno"></span><span class="op" id="4239342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4239345">//&nbsp;rfc1423Algos&nbsp;holds&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;possible&nbsp;ways&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;PEM</span><br>
<span class="lineno">45</span><span class="comment" id="4239413">//&nbsp;block.&nbsp;&nbsp;The&nbsp;ivSize&nbsp;numbers&nbsp;were&nbsp;taken&nbsp;from&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="4239479">var</span>&nbsp;<span class="ident" id="4239483">rfc1423Algos</span>&nbsp;<span class="op" id="4239496">=</span>&nbsp;<span class="op" id="4239498">[</span><span class="op" id="4239499">]</span><span class="ident" id="4239500">rfc1423Algo</span><span class="op" id="4239511">{</span><span class="op" id="4239512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239515">cipher</span><span class="op" id="4239521">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239527">PEMCipherDES</span><span class="op" id="4239539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239542">name</span><span class="op" id="4239546">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4239554">&#34;DES-CBC&#34;</span><span class="op" id="4239563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239566">cipherFunc</span><span class="op" id="4239576">:</span>&nbsp;<span class="ident" id="4239578">des</span><span class="op" id="4239581">.</span><span class="ident" id="4239582">NewCipher</span><span class="op" id="4239591">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239594">keySize</span><span class="op" id="4239601">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4239606">8</span><span class="op" id="4239607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239610">blockSize</span><span class="op" id="4239619">:</span>&nbsp;&nbsp;<span class="ident" id="4239622">des</span><span class="op" id="4239625">.</span><span class="ident" id="4239626">BlockSize</span><span class="op" id="4239635">,</span><br>
<span class="lineno"></span><span class="op" id="4239637">}</span><span class="op" id="4239638">,</span>&nbsp;<span class="op" id="4239640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239643">cipher</span><span class="op" id="4239649">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239655">PEMCipher3DES</span><span class="op" id="4239668">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239671">name</span><span class="op" id="4239675">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4239683">&#34;DES-EDE3-CBC&#34;</span><span class="op" id="4239697">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239700">cipherFunc</span><span class="op" id="4239710">:</span>&nbsp;<span class="ident" id="4239712">des</span><span class="op" id="4239715">.</span><span class="ident" id="4239716">NewTripleDESCipher</span><span class="op" id="4239734">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239737">keySize</span><span class="op" id="4239744">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4239749">24</span><span class="op" id="4239751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239754">blockSize</span><span class="op" id="4239763">:</span>&nbsp;&nbsp;<span class="ident" id="4239766">des</span><span class="op" id="4239769">.</span><span class="ident" id="4239770">BlockSize</span><span class="op" id="4239779">,</span><br>
<span class="lineno"></span><span class="op" id="4239781">}</span><span class="op" id="4239782">,</span>&nbsp;<span class="op" id="4239784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239787">cipher</span><span class="op" id="4239793">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239799">PEMCipherAES128</span><span class="op" id="4239814">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239817">name</span><span class="op" id="4239821">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4239829">&#34;AES-128-CBC&#34;</span><span class="op" id="4239842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239845">cipherFunc</span><span class="op" id="4239855">:</span>&nbsp;<span class="ident" id="4239857">aes</span><span class="op" id="4239860">.</span><span class="ident" id="4239861">NewCipher</span><span class="op" id="4239870">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239873">keySize</span><span class="op" id="4239880">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4239885">16</span><span class="op" id="4239887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239890">blockSize</span><span class="op" id="4239899">:</span>&nbsp;&nbsp;<span class="ident" id="4239902">aes</span><span class="op" id="4239905">.</span><span class="ident" id="4239906">BlockSize</span><span class="op" id="4239915">,</span><br>
<span class="lineno"></span><span class="op" id="4239917">}</span><span class="op" id="4239918">,</span>&nbsp;<span class="op" id="4239920">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239923">cipher</span><span class="op" id="4239929">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239935">PEMCipherAES192</span><span class="op" id="4239950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239953">name</span><span class="op" id="4239957">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4239965">&#34;AES-192-CBC&#34;</span><span class="op" id="4239978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239981">cipherFunc</span><span class="op" id="4239991">:</span>&nbsp;<span class="ident" id="4239993">aes</span><span class="op" id="4239996">.</span><span class="ident" id="4239997">NewCipher</span><span class="op" id="4240006">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240009">keySize</span><span class="op" id="4240016">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4240021">24</span><span class="op" id="4240023">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240026">blockSize</span><span class="op" id="4240035">:</span>&nbsp;&nbsp;<span class="ident" id="4240038">aes</span><span class="op" id="4240041">.</span><span class="ident" id="4240042">BlockSize</span><span class="op" id="4240051">,</span><br>
<span class="lineno">70</span><span class="op" id="4240053">}</span><span class="op" id="4240054">,</span>&nbsp;<span class="op" id="4240056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240059">cipher</span><span class="op" id="4240065">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4240071">PEMCipherAES256</span><span class="op" id="4240086">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240089">name</span><span class="op" id="4240093">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4240101">&#34;AES-256-CBC&#34;</span><span class="op" id="4240114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240117">cipherFunc</span><span class="op" id="4240127">:</span>&nbsp;<span class="ident" id="4240129">aes</span><span class="op" id="4240132">.</span><span class="ident" id="4240133">NewCipher</span><span class="op" id="4240142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240145">keySize</span><span class="op" id="4240152">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4240157">32</span><span class="op" id="4240159">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240162">blockSize</span><span class="op" id="4240171">:</span>&nbsp;&nbsp;<span class="ident" id="4240174">aes</span><span class="op" id="4240177">.</span><span class="ident" id="4240178">BlockSize</span><span class="op" id="4240187">,</span><br>
<span class="lineno"></span><span class="op" id="4240189">}</span><span class="op" id="4240190">,</span><br>
<span class="lineno"></span><span class="op" id="4240192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4240195">//&nbsp;deriveKey&nbsp;uses&nbsp;a&nbsp;key&nbsp;derivation&nbsp;function&nbsp;to&nbsp;stretch&nbsp;the&nbsp;password&nbsp;into&nbsp;a&nbsp;key</span><br>
<span class="lineno">80</span><span class="comment" id="4240274">//&nbsp;with&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;our&nbsp;cipher&nbsp;requires.&nbsp;This&nbsp;algorithm&nbsp;was&nbsp;derived&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4240354">//&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="4240377">func</span>&nbsp;<span class="op" id="4240382">(</span><span class="ident" id="4240383">c</span>&nbsp;<span class="ident" id="4240385">rfc1423Algo</span><span class="op" id="4240396">)</span>&nbsp;<span class="ident" id="4240398">deriveKey</span><span class="op" id="4240407">(</span><span class="ident" id="4240408">password</span><span class="op" id="4240416">,</span>&nbsp;<span class="ident" id="4240418">salt</span>&nbsp;<span class="op" id="4240423">[</span><span class="op" id="4240424">]</span><span class="builtintype" id="4240425">byte</span><span class="op" id="4240429">)</span>&nbsp;<span class="op" id="4240431">[</span><span class="op" id="4240432">]</span><span class="builtintype" id="4240433">byte</span>&nbsp;<span class="op" id="4240438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240441">hash</span>&nbsp;<span class="op" id="4240446">:=</span>&nbsp;<span class="ident" id="4240449">md5</span><span class="op" id="4240452">.</span><span class="ident" id="4240453">New</span><span class="op" id="4240456">(</span><span class="op" id="4240457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240460">out</span>&nbsp;<span class="op" id="4240464">:=</span>&nbsp;<span class="builtinfunc" id="4240467">make</span><span class="op" id="4240471">(</span><span class="op" id="4240472">[</span><span class="op" id="4240473">]</span><span class="builtintype" id="4240474">byte</span><span class="op" id="4240478">,</span>&nbsp;<span class="ident" id="4240480">c</span><span class="op" id="4240481">.</span><span class="ident" id="4240482">keySize</span><span class="op" id="4240489">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4240492">var</span>&nbsp;<span class="ident" id="4240496">digest</span>&nbsp;<span class="op" id="4240503">[</span><span class="op" id="4240504">]</span><span class="builtintype" id="4240505">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4240512">for</span>&nbsp;<span class="ident" id="4240516">i</span>&nbsp;<span class="op" id="4240518">:=</span>&nbsp;<span class="num" id="4240521">0</span><span class="op" id="4240522">;</span>&nbsp;<span class="ident" id="4240524">i</span>&nbsp;<span class="op" id="4240526">&lt;</span>&nbsp;<span class="builtinfunc" id="4240528">len</span><span class="op" id="4240531">(</span><span class="ident" id="4240532">out</span><span class="op" id="4240535">)</span><span class="op" id="4240536">;</span>&nbsp;<span class="ident" id="4240538">i</span>&nbsp;<span class="op" id="4240540">+=</span>&nbsp;<span class="builtinfunc" id="4240543">len</span><span class="op" id="4240546">(</span><span class="ident" id="4240547">digest</span><span class="op" id="4240553">)</span>&nbsp;<span class="op" id="4240555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240559">hash</span><span class="op" id="4240563">.</span><span class="ident" id="4240564">Reset</span><span class="op" id="4240569">(</span><span class="op" id="4240570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240574">hash</span><span class="op" id="4240578">.</span><span class="ident" id="4240579">Write</span><span class="op" id="4240584">(</span><span class="ident" id="4240585">digest</span><span class="op" id="4240591">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240595">hash</span><span class="op" id="4240599">.</span><span class="ident" id="4240600">Write</span><span class="op" id="4240605">(</span><span class="ident" id="4240606">password</span><span class="op" id="4240614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240618">hash</span><span class="op" id="4240622">.</span><span class="ident" id="4240623">Write</span><span class="op" id="4240628">(</span><span class="ident" id="4240629">salt</span><span class="op" id="4240633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240637">digest</span>&nbsp;<span class="op" id="4240644">=</span>&nbsp;<span class="ident" id="4240646">hash</span><span class="op" id="4240650">.</span><span class="ident" id="4240651">Sum</span><span class="op" id="4240654">(</span><span class="ident" id="4240655">digest</span><span class="op" id="4240661">[</span><span class="op" id="4240662">:</span><span class="num" id="4240663">0</span><span class="op" id="4240664">]</span><span class="op" id="4240665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4240669">copy</span><span class="op" id="4240673">(</span><span class="ident" id="4240674">out</span><span class="op" id="4240677">[</span><span class="ident" id="4240678">i</span><span class="op" id="4240679">:</span><span class="op" id="4240680">]</span><span class="op" id="4240681">,</span>&nbsp;<span class="ident" id="4240683">digest</span><span class="op" id="4240689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4240692">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4240695">return</span>&nbsp;<span class="ident" id="4240702">out</span><br>
<span class="lineno"></span><span class="op" id="4240706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4240709">//&nbsp;IsEncryptedPEMBlock&nbsp;returns&nbsp;if&nbsp;the&nbsp;PEM&nbsp;block&nbsp;is&nbsp;password&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="4240780">func</span>&nbsp;<span class="ident" id="4240785">IsEncryptedPEMBlock</span><span class="op" id="4240804">(</span><span class="ident" id="4240805">b</span>&nbsp;<span class="op" id="4240807">*</span><span class="ident" id="4240808">pem</span><span class="op" id="4240811">.</span><span class="ident" id="4240812">Block</span><span class="op" id="4240817">)</span>&nbsp;<span class="builtintype" id="4240819">bool</span>&nbsp;<span class="op" id="4240824">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240827">_</span><span class="op" id="4240828">,</span>&nbsp;<span class="ident" id="4240830">ok</span>&nbsp;<span class="op" id="4240833">:=</span>&nbsp;<span class="ident" id="4240836">b</span><span class="op" id="4240837">.</span><span class="ident" id="4240838">Headers</span><span class="op" id="4240845">[</span><span class="string" id="4240846">&#34;DEK-Info&#34;</span><span class="op" id="4240856">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4240859">return</span>&nbsp;<span class="ident" id="4240866">ok</span><br>
<span class="lineno"></span><span class="op" id="4240869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4240872">//&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned&nbsp;when&nbsp;an&nbsp;incorrect&nbsp;password&nbsp;is&nbsp;detected.</span><br>
<span class="lineno">105</span><span class="keyword" id="4240950">var</span>&nbsp;<span class="ident" id="4240954">IncorrectPasswordError</span>&nbsp;<span class="op" id="4240977">=</span>&nbsp;<span class="ident" id="4240979">errors</span><span class="op" id="4240985">.</span><span class="ident" id="4240986">New</span><span class="op" id="4240989">(</span><span class="string" id="4240990">&#34;x509:&nbsp;decryption&nbsp;password&nbsp;incorrect&#34;</span><span class="op" id="4241027">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4241030">//&nbsp;DecryptPEMBlock&nbsp;takes&nbsp;a&nbsp;password&nbsp;encrypted&nbsp;PEM&nbsp;block&nbsp;and&nbsp;the&nbsp;password&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4241111">//&nbsp;encrypt&nbsp;it&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;decrypted&nbsp;DER&nbsp;encoded&nbsp;bytes.&nbsp;It&nbsp;inspects</span><br>
<span class="lineno"></span><span class="comment" id="4241189">//&nbsp;the&nbsp;DEK-Info&nbsp;header&nbsp;to&nbsp;determine&nbsp;the&nbsp;algorithm&nbsp;used&nbsp;for&nbsp;decryption.&nbsp;If&nbsp;no</span><br>
<span class="lineno">110</span><span class="comment" id="4241266">//&nbsp;DEK-Info&nbsp;header&nbsp;is&nbsp;present,&nbsp;an&nbsp;error&nbsp;is&nbsp;returned.&nbsp;If&nbsp;an&nbsp;incorrect&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="4241344">//&nbsp;is&nbsp;detected&nbsp;an&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="4241398">func</span>&nbsp;<span class="ident" id="4241403">DecryptPEMBlock</span><span class="op" id="4241418">(</span><span class="ident" id="4241419">b</span>&nbsp;<span class="op" id="4241421">*</span><span class="ident" id="4241422">pem</span><span class="op" id="4241425">.</span><span class="ident" id="4241426">Block</span><span class="op" id="4241431">,</span>&nbsp;<span class="ident" id="4241433">password</span>&nbsp;<span class="op" id="4241442">[</span><span class="op" id="4241443">]</span><span class="builtintype" id="4241444">byte</span><span class="op" id="4241448">)</span>&nbsp;<span class="op" id="4241450">(</span><span class="op" id="4241451">[</span><span class="op" id="4241452">]</span><span class="builtintype" id="4241453">byte</span><span class="op" id="4241457">,</span>&nbsp;<span class="builtintype" id="4241459">error</span><span class="op" id="4241464">)</span>&nbsp;<span class="op" id="4241466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4241469">dek</span><span class="op" id="4241472">,</span>&nbsp;<span class="ident" id="4241474">ok</span>&nbsp;<span class="op" id="4241477">:=</span>&nbsp;<span class="ident" id="4241480">b</span><span class="op" id="4241481">.</span><span class="ident" id="4241482">Headers</span><span class="op" id="4241489">[</span><span class="string" id="4241490">&#34;DEK-Info&#34;</span><span class="op" id="4241500">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241503">if</span>&nbsp;<span class="op" id="4241506">!</span><span class="ident" id="4241507">ok</span>&nbsp;<span class="op" id="4241510">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241514">return</span>&nbsp;<span class="ident" id="4241521">nil</span><span class="op" id="4241524">,</span>&nbsp;<span class="ident" id="4241526">errors</span><span class="op" id="4241532">.</span><span class="ident" id="4241533">New</span><span class="op" id="4241536">(</span><span class="string" id="4241537">&#34;x509:&nbsp;no&nbsp;DEK-Info&nbsp;header&nbsp;in&nbsp;block&#34;</span><span class="op" id="4241572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4241575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4241579">idx</span>&nbsp;<span class="op" id="4241583">:=</span>&nbsp;<span class="ident" id="4241586">strings</span><span class="op" id="4241593">.</span><span class="ident" id="4241594">Index</span><span class="op" id="4241599">(</span><span class="ident" id="4241600">dek</span><span class="op" id="4241603">,</span>&nbsp;<span class="string" id="4241605">&#34;,&#34;</span><span class="op" id="4241608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241611">if</span>&nbsp;<span class="ident" id="4241614">idx</span>&nbsp;<span class="op" id="4241618">==</span>&nbsp;<span class="op" id="4241621">-</span><span class="num" id="4241622">1</span>&nbsp;<span class="op" id="4241624">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241628">return</span>&nbsp;<span class="ident" id="4241635">nil</span><span class="op" id="4241638">,</span>&nbsp;<span class="ident" id="4241640">errors</span><span class="op" id="4241646">.</span><span class="ident" id="4241647">New</span><span class="op" id="4241650">(</span><span class="string" id="4241651">&#34;x509:&nbsp;malformed&nbsp;DEK-Info&nbsp;header&#34;</span><span class="op" id="4241684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4241687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4241691">mode</span><span class="op" id="4241695">,</span>&nbsp;<span class="ident" id="4241697">hexIV</span>&nbsp;<span class="op" id="4241703">:=</span>&nbsp;<span class="ident" id="4241706">dek</span><span class="op" id="4241709">[</span><span class="op" id="4241710">:</span><span class="ident" id="4241711">idx</span><span class="op" id="4241714">]</span><span class="op" id="4241715">,</span>&nbsp;<span class="ident" id="4241717">dek</span><span class="op" id="4241720">[</span><span class="ident" id="4241721">idx</span><span class="op" id="4241724">+</span><span class="num" id="4241725">1</span><span class="op" id="4241726">:</span><span class="op" id="4241727">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4241730">ciph</span>&nbsp;<span class="op" id="4241735">:=</span>&nbsp;<span class="ident" id="4241738">cipherByName</span><span class="op" id="4241750">(</span><span class="ident" id="4241751">mode</span><span class="op" id="4241755">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241758">if</span>&nbsp;<span class="ident" id="4241761">ciph</span>&nbsp;<span class="op" id="4241766">==</span>&nbsp;<span class="ident" id="4241769">nil</span>&nbsp;<span class="op" id="4241773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241777">return</span>&nbsp;<span class="ident" id="4241784">nil</span><span class="op" id="4241787">,</span>&nbsp;<span class="ident" id="4241789">errors</span><span class="op" id="4241795">.</span><span class="ident" id="4241796">New</span><span class="op" id="4241799">(</span><span class="string" id="4241800">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="4241831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4241834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4241837">iv</span><span class="op" id="4241839">,</span>&nbsp;<span class="ident" id="4241841">err</span>&nbsp;<span class="op" id="4241845">:=</span>&nbsp;<span class="ident" id="4241848">hex</span><span class="op" id="4241851">.</span><span class="ident" id="4241852">DecodeString</span><span class="op" id="4241864">(</span><span class="ident" id="4241865">hexIV</span><span class="op" id="4241870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241873">if</span>&nbsp;<span class="ident" id="4241876">err</span>&nbsp;<span class="op" id="4241880">!=</span>&nbsp;<span class="ident" id="4241883">nil</span>&nbsp;<span class="op" id="4241887">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241891">return</span>&nbsp;<span class="ident" id="4241898">nil</span><span class="op" id="4241901">,</span>&nbsp;<span class="ident" id="4241903">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4241908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241911">if</span>&nbsp;<span class="builtinfunc" id="4241914">len</span><span class="op" id="4241917">(</span><span class="ident" id="4241918">iv</span><span class="op" id="4241920">)</span>&nbsp;<span class="op" id="4241922">!=</span>&nbsp;<span class="ident" id="4241925">ciph</span><span class="op" id="4241929">.</span><span class="ident" id="4241930">blockSize</span>&nbsp;<span class="op" id="4241940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241944">return</span>&nbsp;<span class="ident" id="4241951">nil</span><span class="op" id="4241954">,</span>&nbsp;<span class="ident" id="4241956">errors</span><span class="op" id="4241962">.</span><span class="ident" id="4241963">New</span><span class="op" id="4241966">(</span><span class="string" id="4241967">&#34;x509:&nbsp;incorrect&nbsp;IV&nbsp;size&#34;</span><span class="op" id="4241992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4241995">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4241999">//&nbsp;Based&nbsp;on&nbsp;the&nbsp;OpenSSL&nbsp;implementation.&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4242070">//&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242104">key</span>&nbsp;<span class="op" id="4242108">:=</span>&nbsp;<span class="ident" id="4242111">ciph</span><span class="op" id="4242115">.</span><span class="ident" id="4242116">deriveKey</span><span class="op" id="4242125">(</span><span class="ident" id="4242126">password</span><span class="op" id="4242134">,</span>&nbsp;<span class="ident" id="4242136">iv</span><span class="op" id="4242138">[</span><span class="op" id="4242139">:</span><span class="num" id="4242140">8</span><span class="op" id="4242141">]</span><span class="op" id="4242142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242145">block</span><span class="op" id="4242150">,</span>&nbsp;<span class="ident" id="4242152">err</span>&nbsp;<span class="op" id="4242156">:=</span>&nbsp;<span class="ident" id="4242159">ciph</span><span class="op" id="4242163">.</span><span class="ident" id="4242164">cipherFunc</span><span class="op" id="4242174">(</span><span class="ident" id="4242175">key</span><span class="op" id="4242178">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242181">if</span>&nbsp;<span class="ident" id="4242184">err</span>&nbsp;<span class="op" id="4242188">!=</span>&nbsp;<span class="ident" id="4242191">nil</span>&nbsp;<span class="op" id="4242195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242199">return</span>&nbsp;<span class="ident" id="4242206">nil</span><span class="op" id="4242209">,</span>&nbsp;<span class="ident" id="4242211">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242220">data</span>&nbsp;<span class="op" id="4242225">:=</span>&nbsp;<span class="builtinfunc" id="4242228">make</span><span class="op" id="4242232">(</span><span class="op" id="4242233">[</span><span class="op" id="4242234">]</span><span class="builtintype" id="4242235">byte</span><span class="op" id="4242239">,</span>&nbsp;<span class="builtinfunc" id="4242241">len</span><span class="op" id="4242244">(</span><span class="ident" id="4242245">b</span><span class="op" id="4242246">.</span><span class="ident" id="4242247">Bytes</span><span class="op" id="4242252">)</span><span class="op" id="4242253">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242256">dec</span>&nbsp;<span class="op" id="4242260">:=</span>&nbsp;<span class="ident" id="4242263">cipher</span><span class="op" id="4242269">.</span><span class="ident" id="4242270">NewCBCDecrypter</span><span class="op" id="4242285">(</span><span class="ident" id="4242286">block</span><span class="op" id="4242291">,</span>&nbsp;<span class="ident" id="4242293">iv</span><span class="op" id="4242295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242298">dec</span><span class="op" id="4242301">.</span><span class="ident" id="4242302">CryptBlocks</span><span class="op" id="4242313">(</span><span class="ident" id="4242314">data</span><span class="op" id="4242318">,</span>&nbsp;<span class="ident" id="4242320">b</span><span class="op" id="4242321">.</span><span class="ident" id="4242322">Bytes</span><span class="op" id="4242327">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4242331">//&nbsp;Blocks&nbsp;are&nbsp;padded&nbsp;using&nbsp;a&nbsp;scheme&nbsp;where&nbsp;the&nbsp;last&nbsp;n&nbsp;bytes&nbsp;of&nbsp;padding&nbsp;are&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4242410">//&nbsp;equal&nbsp;to&nbsp;n.&nbsp;It&nbsp;can&nbsp;pad&nbsp;from&nbsp;1&nbsp;to&nbsp;blocksize&nbsp;bytes&nbsp;inclusive.&nbsp;See&nbsp;RFC&nbsp;1423.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4242488">//&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4242505">//&nbsp;&nbsp;&nbsp;&nbsp[x&nbsp;y&nbsp;z&nbsp;2&nbsp;2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4242521">//&nbsp;&nbsp;&nbsp;&nbsp[x&nbsp;y&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4242545">//&nbsp;If&nbsp;we&nbsp;detect&nbsp;a&nbsp;bad&nbsp;padding,&nbsp;we&nbsp;assume&nbsp;it&nbsp;is&nbsp;an&nbsp;invalid&nbsp;password.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242614">dlen</span>&nbsp;<span class="op" id="4242619">:=</span>&nbsp;<span class="builtinfunc" id="4242622">len</span><span class="op" id="4242625">(</span><span class="ident" id="4242626">data</span><span class="op" id="4242630">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242633">if</span>&nbsp;<span class="ident" id="4242636">dlen</span>&nbsp;<span class="op" id="4242641">==</span>&nbsp;<span class="num" id="4242644">0</span>&nbsp;<span class="op" id="4242646">||</span>&nbsp;<span class="ident" id="4242649">dlen</span><span class="op" id="4242653">%</span><span class="ident" id="4242654">ciph</span><span class="op" id="4242658">.</span><span class="ident" id="4242659">blockSize</span>&nbsp;<span class="op" id="4242669">!=</span>&nbsp;<span class="num" id="4242672">0</span>&nbsp;<span class="op" id="4242674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242678">return</span>&nbsp;<span class="ident" id="4242685">nil</span><span class="op" id="4242688">,</span>&nbsp;<span class="ident" id="4242690">errors</span><span class="op" id="4242696">.</span><span class="ident" id="4242697">New</span><span class="op" id="4242700">(</span><span class="string" id="4242701">&#34;x509:&nbsp;invalid&nbsp;padding&#34;</span><span class="op" id="4242724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242730">last</span>&nbsp;<span class="op" id="4242735">:=</span>&nbsp;<span class="builtintype" id="4242738">int</span><span class="op" id="4242741">(</span><span class="ident" id="4242742">data</span><span class="op" id="4242746">[</span><span class="ident" id="4242747">dlen</span><span class="op" id="4242751">-</span><span class="num" id="4242752">1</span><span class="op" id="4242753">]</span><span class="op" id="4242754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242757">if</span>&nbsp;<span class="ident" id="4242760">dlen</span>&nbsp;<span class="op" id="4242765">&lt;</span>&nbsp;<span class="ident" id="4242767">last</span>&nbsp;<span class="op" id="4242772">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242776">return</span>&nbsp;<span class="ident" id="4242783">nil</span><span class="op" id="4242786">,</span>&nbsp;<span class="ident" id="4242788">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242815">if</span>&nbsp;<span class="ident" id="4242818">last</span>&nbsp;<span class="op" id="4242823">==</span>&nbsp;<span class="num" id="4242826">0</span>&nbsp;<span class="op" id="4242828">||</span>&nbsp;<span class="ident" id="4242831">last</span>&nbsp;<span class="op" id="4242836">&gt;</span>&nbsp;<span class="ident" id="4242838">ciph</span><span class="op" id="4242842">.</span><span class="ident" id="4242843">blockSize</span>&nbsp;<span class="op" id="4242853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242857">return</span>&nbsp;<span class="ident" id="4242864">nil</span><span class="op" id="4242867">,</span>&nbsp;<span class="ident" id="4242869">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242893">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242896">for</span>&nbsp;<span class="ident" id="4242900">_</span><span class="op" id="4242901">,</span>&nbsp;<span class="ident" id="4242903">val</span>&nbsp;<span class="op" id="4242907">:=</span>&nbsp;<span class="keyword" id="4242910">range</span>&nbsp;<span class="ident" id="4242916">data</span><span class="op" id="4242920">[</span><span class="ident" id="4242921">dlen</span><span class="op" id="4242925">-</span><span class="ident" id="4242926">last</span><span class="op" id="4242930">:</span><span class="op" id="4242931">]</span>&nbsp;<span class="op" id="4242933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242937">if</span>&nbsp;<span class="builtintype" id="4242940">int</span><span class="op" id="4242943">(</span><span class="ident" id="4242944">val</span><span class="op" id="4242947">)</span>&nbsp;<span class="op" id="4242949">!=</span>&nbsp;<span class="ident" id="4242952">last</span>&nbsp;<span class="op" id="4242957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242962">return</span>&nbsp;<span class="ident" id="4242969">nil</span><span class="op" id="4242972">,</span>&nbsp;<span class="ident" id="4242974">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4243002">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243005">return</span>&nbsp;<span class="ident" id="4243012">data</span><span class="op" id="4243016">[</span><span class="op" id="4243017">:</span><span class="ident" id="4243018">dlen</span><span class="op" id="4243022">-</span><span class="ident" id="4243023">last</span><span class="op" id="4243027">]</span><span class="op" id="4243028">,</span>&nbsp;<span class="ident" id="4243030">nil</span><br>
<span class="lineno"></span><span class="op" id="4243034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4243037">//&nbsp;EncryptPEMBlock&nbsp;returns&nbsp;a&nbsp;PEM&nbsp;block&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;holding&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4243110">//&nbsp;given&nbsp;DER-encoded&nbsp;data&nbsp;encrypted&nbsp;with&nbsp;the&nbsp;specified&nbsp;algorithm&nbsp;and</span><br>
<span class="lineno">175</span><span class="comment" id="4243179">//&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="4243192">func</span>&nbsp;<span class="ident" id="4243197">EncryptPEMBlock</span><span class="op" id="4243212">(</span><span class="ident" id="4243213">rand</span>&nbsp;<span class="ident" id="4243218">io</span><span class="op" id="4243220">.</span><span class="ident" id="4243221">Reader</span><span class="op" id="4243227">,</span>&nbsp;<span class="ident" id="4243229">blockType</span>&nbsp;<span class="builtintype" id="4243239">string</span><span class="op" id="4243245">,</span>&nbsp;<span class="ident" id="4243247">data</span><span class="op" id="4243251">,</span>&nbsp;<span class="ident" id="4243253">password</span>&nbsp;<span class="op" id="4243262">[</span><span class="op" id="4243263">]</span><span class="builtintype" id="4243264">byte</span><span class="op" id="4243268">,</span>&nbsp;<span class="ident" id="4243270">alg</span>&nbsp;<span class="ident" id="4243274">PEMCipher</span><span class="op" id="4243283">)</span>&nbsp;<span class="op" id="4243285">(</span><span class="op" id="4243286">*</span><span class="ident" id="4243287">pem</span><span class="op" id="4243290">.</span><span class="ident" id="4243291">Block</span><span class="op" id="4243296">,</span>&nbsp;<span class="builtintype" id="4243298">error</span><span class="op" id="4243303">)</span>&nbsp;<span class="op" id="4243305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243308">ciph</span>&nbsp;<span class="op" id="4243313">:=</span>&nbsp;<span class="ident" id="4243316">cipherByKey</span><span class="op" id="4243327">(</span><span class="ident" id="4243328">alg</span><span class="op" id="4243331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243334">if</span>&nbsp;<span class="ident" id="4243337">ciph</span>&nbsp;<span class="op" id="4243342">==</span>&nbsp;<span class="ident" id="4243345">nil</span>&nbsp;<span class="op" id="4243349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243353">return</span>&nbsp;<span class="ident" id="4243360">nil</span><span class="op" id="4243363">,</span>&nbsp;<span class="ident" id="4243365">errors</span><span class="op" id="4243371">.</span><span class="ident" id="4243372">New</span><span class="op" id="4243375">(</span><span class="string" id="4243376">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="4243407">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4243410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243413">iv</span>&nbsp;<span class="op" id="4243416">:=</span>&nbsp;<span class="builtinfunc" id="4243419">make</span><span class="op" id="4243423">(</span><span class="op" id="4243424">[</span><span class="op" id="4243425">]</span><span class="builtintype" id="4243426">byte</span><span class="op" id="4243430">,</span>&nbsp;<span class="ident" id="4243432">ciph</span><span class="op" id="4243436">.</span><span class="ident" id="4243437">blockSize</span><span class="op" id="4243446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243449">if</span>&nbsp;<span class="ident" id="4243452">_</span><span class="op" id="4243453">,</span>&nbsp;<span class="ident" id="4243455">err</span>&nbsp;<span class="op" id="4243459">:=</span>&nbsp;<span class="ident" id="4243462">io</span><span class="op" id="4243464">.</span><span class="ident" id="4243465">ReadFull</span><span class="op" id="4243473">(</span><span class="ident" id="4243474">rand</span><span class="op" id="4243478">,</span>&nbsp;<span class="ident" id="4243480">iv</span><span class="op" id="4243482">)</span><span class="op" id="4243483">;</span>&nbsp;<span class="ident" id="4243485">err</span>&nbsp;<span class="op" id="4243489">!=</span>&nbsp;<span class="ident" id="4243492">nil</span>&nbsp;<span class="op" id="4243496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243500">return</span>&nbsp;<span class="ident" id="4243507">nil</span><span class="op" id="4243510">,</span>&nbsp;<span class="ident" id="4243512">errors</span><span class="op" id="4243518">.</span><span class="ident" id="4243519">New</span><span class="op" id="4243522">(</span><span class="string" id="4243523">&#34;x509:&nbsp;cannot&nbsp;generate&nbsp;IV:&nbsp;&#34;</span>&nbsp;<span class="op" id="4243552">+</span>&nbsp;<span class="ident" id="4243554">err</span><span class="op" id="4243557">.</span><span class="ident" id="4243558">Error</span><span class="op" id="4243563">(</span><span class="op" id="4243564">)</span><span class="op" id="4243565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4243568">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4243571">//&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4243635">//&nbsp;matching&nbsp;the&nbsp;key&nbsp;derivation&nbsp;in&nbsp;DecryptPEMBlock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243687">key</span>&nbsp;<span class="op" id="4243691">:=</span>&nbsp;<span class="ident" id="4243694">ciph</span><span class="op" id="4243698">.</span><span class="ident" id="4243699">deriveKey</span><span class="op" id="4243708">(</span><span class="ident" id="4243709">password</span><span class="op" id="4243717">,</span>&nbsp;<span class="ident" id="4243719">iv</span><span class="op" id="4243721">[</span><span class="op" id="4243722">:</span><span class="num" id="4243723">8</span><span class="op" id="4243724">]</span><span class="op" id="4243725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243728">block</span><span class="op" id="4243733">,</span>&nbsp;<span class="ident" id="4243735">err</span>&nbsp;<span class="op" id="4243739">:=</span>&nbsp;<span class="ident" id="4243742">ciph</span><span class="op" id="4243746">.</span><span class="ident" id="4243747">cipherFunc</span><span class="op" id="4243757">(</span><span class="ident" id="4243758">key</span><span class="op" id="4243761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243764">if</span>&nbsp;<span class="ident" id="4243767">err</span>&nbsp;<span class="op" id="4243771">!=</span>&nbsp;<span class="ident" id="4243774">nil</span>&nbsp;<span class="op" id="4243778">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243782">return</span>&nbsp;<span class="ident" id="4243789">nil</span><span class="op" id="4243792">,</span>&nbsp;<span class="ident" id="4243794">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4243799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243802">enc</span>&nbsp;<span class="op" id="4243806">:=</span>&nbsp;<span class="ident" id="4243809">cipher</span><span class="op" id="4243815">.</span><span class="ident" id="4243816">NewCBCEncrypter</span><span class="op" id="4243831">(</span><span class="ident" id="4243832">block</span><span class="op" id="4243837">,</span>&nbsp;<span class="ident" id="4243839">iv</span><span class="op" id="4243841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243844">pad</span>&nbsp;<span class="op" id="4243848">:=</span>&nbsp;<span class="ident" id="4243851">ciph</span><span class="op" id="4243855">.</span><span class="ident" id="4243856">blockSize</span>&nbsp;<span class="op" id="4243866">-</span>&nbsp;<span class="builtinfunc" id="4243868">len</span><span class="op" id="4243871">(</span><span class="ident" id="4243872">data</span><span class="op" id="4243876">)</span><span class="op" id="4243877">%</span><span class="ident" id="4243878">ciph</span><span class="op" id="4243882">.</span><span class="ident" id="4243883">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243894">encrypted</span>&nbsp;<span class="op" id="4243904">:=</span>&nbsp;<span class="builtinfunc" id="4243907">make</span><span class="op" id="4243911">(</span><span class="op" id="4243912">[</span><span class="op" id="4243913">]</span><span class="builtintype" id="4243914">byte</span><span class="op" id="4243918">,</span>&nbsp;<span class="builtinfunc" id="4243920">len</span><span class="op" id="4243923">(</span><span class="ident" id="4243924">data</span><span class="op" id="4243928">)</span><span class="op" id="4243929">,</span>&nbsp;<span class="builtinfunc" id="4243931">len</span><span class="op" id="4243934">(</span><span class="ident" id="4243935">data</span><span class="op" id="4243939">)</span><span class="op" id="4243940">+</span><span class="ident" id="4243941">pad</span><span class="op" id="4243944">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4243947">//&nbsp;We&nbsp;could&nbsp;save&nbsp;this&nbsp;copy&nbsp;by&nbsp;encrypting&nbsp;all&nbsp;the&nbsp;whole&nbsp;blocks&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4244013">//&nbsp;the&nbsp;data&nbsp;separately,&nbsp;but&nbsp;it&nbsp;doesn&#39;t&nbsp;seem&nbsp;worth&nbsp;the&nbsp;additional</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4244079">//&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4244089">copy</span><span class="op" id="4244093">(</span><span class="ident" id="4244094">encrypted</span><span class="op" id="4244103">,</span>&nbsp;<span class="ident" id="4244105">data</span><span class="op" id="4244109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4244112">//&nbsp;See&nbsp;RFC&nbsp;1423,&nbsp;section&nbsp;1.1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4244142">for</span>&nbsp;<span class="ident" id="4244146">i</span>&nbsp;<span class="op" id="4244148">:=</span>&nbsp;<span class="num" id="4244151">0</span><span class="op" id="4244152">;</span>&nbsp;<span class="ident" id="4244154">i</span>&nbsp;<span class="op" id="4244156">&lt;</span>&nbsp;<span class="ident" id="4244158">pad</span><span class="op" id="4244161">;</span>&nbsp;<span class="ident" id="4244163">i</span><span class="op" id="4244164">++</span>&nbsp;<span class="op" id="4244167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244171">encrypted</span>&nbsp;<span class="op" id="4244181">=</span>&nbsp;<span class="builtinfunc" id="4244183">append</span><span class="op" id="4244189">(</span><span class="ident" id="4244190">encrypted</span><span class="op" id="4244199">,</span>&nbsp;<span class="builtintype" id="4244201">byte</span><span class="op" id="4244205">(</span><span class="ident" id="4244206">pad</span><span class="op" id="4244209">)</span><span class="op" id="4244210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4244213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244216">enc</span><span class="op" id="4244219">.</span><span class="ident" id="4244220">CryptBlocks</span><span class="op" id="4244231">(</span><span class="ident" id="4244232">encrypted</span><span class="op" id="4244241">,</span>&nbsp;<span class="ident" id="4244243">encrypted</span><span class="op" id="4244252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4244256">return</span>&nbsp;<span class="op" id="4244263">&amp;</span><span class="ident" id="4244264">pem</span><span class="op" id="4244267">.</span><span class="ident" id="4244268">Block</span><span class="op" id="4244273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244277">Type</span><span class="op" id="4244281">:</span>&nbsp;<span class="ident" id="4244283">blockType</span><span class="op" id="4244292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244296">Headers</span><span class="op" id="4244303">:</span>&nbsp;<span class="keyword" id="4244305">map</span><span class="op" id="4244308">[</span><span class="builtintype" id="4244309">string</span><span class="op" id="4244315">]</span><span class="builtintype" id="4244316">string</span><span class="op" id="4244322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4244327">&#34;Proc-Type&#34;</span><span class="op" id="4244338">:</span>&nbsp;<span class="string" id="4244340">&#34;4,ENCRYPTED&#34;</span><span class="op" id="4244353">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4244358">&#34;DEK-Info&#34;</span><span class="op" id="4244368">:</span>&nbsp;&nbsp;<span class="ident" id="4244371">ciph</span><span class="op" id="4244375">.</span><span class="ident" id="4244376">name</span>&nbsp;<span class="op" id="4244381">+</span>&nbsp;<span class="string" id="4244383">&#34;,&#34;</span>&nbsp;<span class="op" id="4244387">+</span>&nbsp;<span class="ident" id="4244389">hex</span><span class="op" id="4244392">.</span><span class="ident" id="4244393">EncodeToString</span><span class="op" id="4244407">(</span><span class="ident" id="4244408">iv</span><span class="op" id="4244410">)</span><span class="op" id="4244411">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4244415">}</span><span class="op" id="4244416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244420">Bytes</span><span class="op" id="4244425">:</span>&nbsp;<span class="ident" id="4244427">encrypted</span><span class="op" id="4244436">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4244439">}</span><span class="op" id="4244440">,</span>&nbsp;<span class="ident" id="4244442">nil</span><br>
<span class="lineno"></span><span class="op" id="4244446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="4244449">func</span>&nbsp;<span class="ident" id="4244454">cipherByName</span><span class="op" id="4244466">(</span><span class="ident" id="4244467">name</span>&nbsp;<span class="builtintype" id="4244472">string</span><span class="op" id="4244478">)</span>&nbsp;<span class="op" id="4244480">*</span><span class="ident" id="4244481">rfc1423Algo</span>&nbsp;<span class="op" id="4244493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4244496">for</span>&nbsp;<span class="ident" id="4244500">i</span>&nbsp;<span class="op" id="4244502">:=</span>&nbsp;<span class="keyword" id="4244505">range</span>&nbsp;<span class="ident" id="4244511">rfc1423Algos</span>&nbsp;<span class="op" id="4244524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244528">alg</span>&nbsp;<span class="op" id="4244532">:=</span>&nbsp;<span class="op" id="4244535">&amp;</span><span class="ident" id="4244536">rfc1423Algos</span><span class="op" id="4244548">[</span><span class="ident" id="4244549">i</span><span class="op" id="4244550">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4244554">if</span>&nbsp;<span class="ident" id="4244557">alg</span><span class="op" id="4244560">.</span><span class="ident" id="4244561">name</span>&nbsp;<span class="op" id="4244566">==</span>&nbsp;<span class="ident" id="4244569">name</span>&nbsp;<span class="op" id="4244574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4244579">return</span>&nbsp;<span class="ident" id="4244586">alg</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4244592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4244595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4244598">return</span>&nbsp;<span class="ident" id="4244605">nil</span><br>
<span class="lineno"></span><span class="op" id="4244609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="4244612">func</span>&nbsp;<span class="ident" id="4244617">cipherByKey</span><span class="op" id="4244628">(</span><span class="ident" id="4244629">key</span>&nbsp;<span class="ident" id="4244633">PEMCipher</span><span class="op" id="4244642">)</span>&nbsp;<span class="op" id="4244644">*</span><span class="ident" id="4244645">rfc1423Algo</span>&nbsp;<span class="op" id="4244657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4244660">for</span>&nbsp;<span class="ident" id="4244664">i</span>&nbsp;<span class="op" id="4244666">:=</span>&nbsp;<span class="keyword" id="4244669">range</span>&nbsp;<span class="ident" id="4244675">rfc1423Algos</span>&nbsp;<span class="op" id="4244688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4244692">alg</span>&nbsp;<span class="op" id="4244696">:=</span>&nbsp;<span class="op" id="4244699">&amp;</span><span class="ident" id="4244700">rfc1423Algos</span><span class="op" id="4244712">[</span><span class="ident" id="4244713">i</span><span class="op" id="4244714">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4244718">if</span>&nbsp;<span class="ident" id="4244721">alg</span><span class="op" id="4244724">.</span><span class="ident" id="4244725">cipher</span>&nbsp;<span class="op" id="4244732">==</span>&nbsp;<span class="ident" id="4244735">key</span>&nbsp;<span class="op" id="4244739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4244744">return</span>&nbsp;<span class="ident" id="4244751">alg</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4244757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4244760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4244763">return</span>&nbsp;<span class="ident" id="4244770">nil</span><br>
<span class="lineno"></span><span class="op" id="4244774">}</span>
</div>
</body>
</html>
